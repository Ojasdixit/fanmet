var lle=Object.defineProperty;var e3=r=>{throw TypeError(r)};var dle=(r,n,o)=>n in r?lle(r,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[n]=o;var Tf=(r,n,o)=>dle(r,typeof n!="symbol"?n+"":n,o),CT=(r,n,o)=>n.has(r)||e3("Cannot "+o);var et=(r,n,o)=>(CT(r,n,"read from private field"),o?o.call(r):n.get(r)),Us=(r,n,o)=>n.has(r)?e3("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(r):n.set(r,o),ls=(r,n,o,l)=>(CT(r,n,"write to private field"),l?l.call(r,o):n.set(r,o),o),In=(r,n,o)=>(CT(r,n,"access private method"),o);var ty=(r,n,o,l)=>({set _(u){ls(r,n,u,o)},get _(){return et(r,n,l)}});function ule(r,n){for(var o=0;o<n.length;o++){const l=n[o];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in r)){const m=Object.getOwnPropertyDescriptor(l,u);m&&Object.defineProperty(r,u,m.get?m:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const g of m.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function o(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(u){if(u.ep)return;u.ep=!0;const m=o(u);fetch(u.href,m)}})();var Ra=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function W7(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function hle(r){if(r.__esModule)return r;var n=r.default;if(typeof n=="function"){var o=function l(){return this instanceof l?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};o.prototype=n.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(r).forEach(function(l){var u=Object.getOwnPropertyDescriptor(r,l);Object.defineProperty(o,l,u.get?u:{enumerable:!0,get:function(){return r[l]}})}),o}var G7={exports:{}},jx={},H7={exports:{}},_s={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gg=Symbol.for("react.element"),ple=Symbol.for("react.portal"),mle=Symbol.for("react.fragment"),fle=Symbol.for("react.strict_mode"),gle=Symbol.for("react.profiler"),_le=Symbol.for("react.provider"),vle=Symbol.for("react.context"),Ele=Symbol.for("react.forward_ref"),yle=Symbol.for("react.suspense"),xle=Symbol.for("react.memo"),ble=Symbol.for("react.lazy"),t3=Symbol.iterator;function wle(r){return r===null||typeof r!="object"?null:(r=t3&&r[t3]||r["@@iterator"],typeof r=="function"?r:null)}var z7={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K7=Object.assign,q7={};function Fp(r,n,o){this.props=r,this.context=n,this.refs=q7,this.updater=o||z7}Fp.prototype.isReactComponent={};Fp.prototype.setState=function(r,n){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,n,"setState")};Fp.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Y7(){}Y7.prototype=Fp.prototype;function oA(r,n,o){this.props=r,this.context=n,this.refs=q7,this.updater=o||z7}var cA=oA.prototype=new Y7;cA.constructor=oA;K7(cA,Fp.prototype);cA.isPureReactComponent=!0;var s3=Array.isArray,$7=Object.prototype.hasOwnProperty,lA={current:null},X7={key:!0,ref:!0,__self:!0,__source:!0};function J7(r,n,o){var l,u={},m=null,g=null;if(n!=null)for(l in n.ref!==void 0&&(g=n.ref),n.key!==void 0&&(m=""+n.key),n)$7.call(n,l)&&!X7.hasOwnProperty(l)&&(u[l]=n[l]);var E=arguments.length-2;if(E===1)u.children=o;else if(1<E){for(var y=Array(E),x=0;x<E;x++)y[x]=arguments[x+2];u.children=y}if(r&&r.defaultProps)for(l in E=r.defaultProps,E)u[l]===void 0&&(u[l]=E[l]);return{$$typeof:Gg,type:r,key:m,ref:g,props:u,_owner:lA.current}}function Sle(r,n){return{$$typeof:Gg,type:r.type,key:n,ref:r.ref,props:r.props,_owner:r._owner}}function dA(r){return typeof r=="object"&&r!==null&&r.$$typeof===Gg}function Cle(r){var n={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(o){return n[o]})}var r3=/\/+/g;function TT(r,n){return typeof r=="object"&&r!==null&&r.key!=null?Cle(""+r.key):n.toString(36)}function Dy(r,n,o,l,u){var m=typeof r;(m==="undefined"||m==="boolean")&&(r=null);var g=!1;if(r===null)g=!0;else switch(m){case"string":case"number":g=!0;break;case"object":switch(r.$$typeof){case Gg:case ple:g=!0}}if(g)return g=r,u=u(g),r=l===""?"."+TT(g,0):l,s3(u)?(o="",r!=null&&(o=r.replace(r3,"$&/")+"/"),Dy(u,n,o,"",function(x){return x})):u!=null&&(dA(u)&&(u=Sle(u,o+(!u.key||g&&g.key===u.key?"":(""+u.key).replace(r3,"$&/")+"/")+r)),n.push(u)),1;if(g=0,l=l===""?".":l+":",s3(r))for(var E=0;E<r.length;E++){m=r[E];var y=l+TT(m,E);g+=Dy(m,n,o,y,u)}else if(y=wle(r),typeof y=="function")for(r=y.call(r),E=0;!(m=r.next()).done;)m=m.value,y=l+TT(m,E++),g+=Dy(m,n,o,y,u);else if(m==="object")throw n=String(r),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return g}function sy(r,n,o){if(r==null)return r;var l=[],u=0;return Dy(r,l,"","",function(m){return n.call(o,m,u++)}),l}function Tle(r){if(r._status===-1){var n=r._result;n=n(),n.then(function(o){(r._status===0||r._status===-1)&&(r._status=1,r._result=o)},function(o){(r._status===0||r._status===-1)&&(r._status=2,r._result=o)}),r._status===-1&&(r._status=0,r._result=n)}if(r._status===1)return r._result.default;throw r._result}var Jn={current:null},Oy={transition:null},Nle={ReactCurrentDispatcher:Jn,ReactCurrentBatchConfig:Oy,ReactCurrentOwner:lA};function Q7(){throw Error("act(...) is not supported in production builds of React.")}_s.Children={map:sy,forEach:function(r,n,o){sy(r,function(){n.apply(this,arguments)},o)},count:function(r){var n=0;return sy(r,function(){n++}),n},toArray:function(r){return sy(r,function(n){return n})||[]},only:function(r){if(!dA(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};_s.Component=Fp;_s.Fragment=mle;_s.Profiler=gle;_s.PureComponent=oA;_s.StrictMode=fle;_s.Suspense=yle;_s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nle;_s.act=Q7;_s.cloneElement=function(r,n,o){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var l=K7({},r.props),u=r.key,m=r.ref,g=r._owner;if(n!=null){if(n.ref!==void 0&&(m=n.ref,g=lA.current),n.key!==void 0&&(u=""+n.key),r.type&&r.type.defaultProps)var E=r.type.defaultProps;for(y in n)$7.call(n,y)&&!X7.hasOwnProperty(y)&&(l[y]=n[y]===void 0&&E!==void 0?E[y]:n[y])}var y=arguments.length-2;if(y===1)l.children=o;else if(1<y){E=Array(y);for(var x=0;x<y;x++)E[x]=arguments[x+2];l.children=E}return{$$typeof:Gg,type:r.type,key:u,ref:m,props:l,_owner:g}};_s.createContext=function(r){return r={$$typeof:vle,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:_le,_context:r},r.Consumer=r};_s.createElement=J7;_s.createFactory=function(r){var n=J7.bind(null,r);return n.type=r,n};_s.createRef=function(){return{current:null}};_s.forwardRef=function(r){return{$$typeof:Ele,render:r}};_s.isValidElement=dA;_s.lazy=function(r){return{$$typeof:ble,_payload:{_status:-1,_result:r},_init:Tle}};_s.memo=function(r,n){return{$$typeof:xle,type:r,compare:n===void 0?null:n}};_s.startTransition=function(r){var n=Oy.transition;Oy.transition={};try{r()}finally{Oy.transition=n}};_s.unstable_act=Q7;_s.useCallback=function(r,n){return Jn.current.useCallback(r,n)};_s.useContext=function(r){return Jn.current.useContext(r)};_s.useDebugValue=function(){};_s.useDeferredValue=function(r){return Jn.current.useDeferredValue(r)};_s.useEffect=function(r,n){return Jn.current.useEffect(r,n)};_s.useId=function(){return Jn.current.useId()};_s.useImperativeHandle=function(r,n,o){return Jn.current.useImperativeHandle(r,n,o)};_s.useInsertionEffect=function(r,n){return Jn.current.useInsertionEffect(r,n)};_s.useLayoutEffect=function(r,n){return Jn.current.useLayoutEffect(r,n)};_s.useMemo=function(r,n){return Jn.current.useMemo(r,n)};_s.useReducer=function(r,n,o){return Jn.current.useReducer(r,n,o)};_s.useRef=function(r){return Jn.current.useRef(r)};_s.useState=function(r){return Jn.current.useState(r)};_s.useSyncExternalStore=function(r,n,o){return Jn.current.useSyncExternalStore(r,n,o)};_s.useTransition=function(){return Jn.current.useTransition()};_s.version="18.3.1";H7.exports=_s;var O=H7.exports;const uA=W7(O),Rle=ule({__proto__:null,default:uA},[O]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ale=O,Ile=Symbol.for("react.element"),Dle=Symbol.for("react.fragment"),Ole=Object.prototype.hasOwnProperty,jle=Ale.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ple={key:!0,ref:!0,__self:!0,__source:!0};function Z7(r,n,o){var l,u={},m=null,g=null;o!==void 0&&(m=""+o),n.key!==void 0&&(m=""+n.key),n.ref!==void 0&&(g=n.ref);for(l in n)Ole.call(n,l)&&!Ple.hasOwnProperty(l)&&(u[l]=n[l]);if(r&&r.defaultProps)for(l in n=r.defaultProps,n)u[l]===void 0&&(u[l]=n[l]);return{$$typeof:Ile,type:r,key:m,ref:g,props:u,_owner:jle.current}}jx.Fragment=Dle;jx.jsx=Z7;jx.jsxs=Z7;G7.exports=jx;var i=G7.exports,ON={},e9={exports:{}},qi={},t9={exports:{}},s9={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function n(ae,ge){var Se=ae.length;ae.push(ge);e:for(;0<Se;){var it=Se-1>>>1,Ue=ae[it];if(0<u(Ue,ge))ae[it]=ge,ae[Se]=Ue,Se=it;else break e}}function o(ae){return ae.length===0?null:ae[0]}function l(ae){if(ae.length===0)return null;var ge=ae[0],Se=ae.pop();if(Se!==ge){ae[0]=Se;e:for(var it=0,Ue=ae.length,ht=Ue>>>1;it<ht;){var qe=2*(it+1)-1,Me=ae[qe],st=qe+1,De=ae[st];if(0>u(Me,Se))st<Ue&&0>u(De,Me)?(ae[it]=De,ae[st]=Se,it=st):(ae[it]=Me,ae[qe]=Se,it=qe);else if(st<Ue&&0>u(De,Se))ae[it]=De,ae[st]=Se,it=st;else break e}}return ge}function u(ae,ge){var Se=ae.sortIndex-ge.sortIndex;return Se!==0?Se:ae.id-ge.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;r.unstable_now=function(){return m.now()}}else{var g=Date,E=g.now();r.unstable_now=function(){return g.now()-E}}var y=[],x=[],S=1,C=null,R=3,M=!1,G=!1,I=!1,j=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function D(ae){for(var ge=o(x);ge!==null;){if(ge.callback===null)l(x);else if(ge.startTime<=ae)l(x),ge.sortIndex=ge.expirationTime,n(y,ge);else break;ge=o(x)}}function V(ae){if(I=!1,D(ae),!G)if(o(y)!==null)G=!0,Fe(B);else{var ge=o(x);ge!==null&&be(V,ge.startTime-ae)}}function B(ae,ge){G=!1,I&&(I=!1,L(J),J=-1),M=!0;var Se=R;try{for(D(ge),C=o(y);C!==null&&(!(C.expirationTime>ge)||ae&&!he());){var it=C.callback;if(typeof it=="function"){C.callback=null,R=C.priorityLevel;var Ue=it(C.expirationTime<=ge);ge=r.unstable_now(),typeof Ue=="function"?C.callback=Ue:C===o(y)&&l(y),D(ge)}else l(y);C=o(y)}if(C!==null)var ht=!0;else{var qe=o(x);qe!==null&&be(V,qe.startTime-ge),ht=!1}return ht}finally{C=null,R=Se,M=!1}}var z=!1,H=null,J=-1,ee=5,ne=-1;function he(){return!(r.unstable_now()-ne<ee)}function ve(){if(H!==null){var ae=r.unstable_now();ne=ae;var ge=!0;try{ge=H(!0,ae)}finally{ge?ye():(z=!1,H=null)}}else z=!1}var ye;if(typeof N=="function")ye=function(){N(ve)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,ue=me.port2;me.port1.onmessage=ve,ye=function(){ue.postMessage(null)}}else ye=function(){j(ve,0)};function Fe(ae){H=ae,z||(z=!0,ye())}function be(ae,ge){J=j(function(){ae(r.unstable_now())},ge)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(ae){ae.callback=null},r.unstable_continueExecution=function(){G||M||(G=!0,Fe(B))},r.unstable_forceFrameRate=function(ae){0>ae||125<ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<ae?Math.floor(1e3/ae):5},r.unstable_getCurrentPriorityLevel=function(){return R},r.unstable_getFirstCallbackNode=function(){return o(y)},r.unstable_next=function(ae){switch(R){case 1:case 2:case 3:var ge=3;break;default:ge=R}var Se=R;R=ge;try{return ae()}finally{R=Se}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(ae,ge){switch(ae){case 1:case 2:case 3:case 4:case 5:break;default:ae=3}var Se=R;R=ae;try{return ge()}finally{R=Se}},r.unstable_scheduleCallback=function(ae,ge,Se){var it=r.unstable_now();switch(typeof Se=="object"&&Se!==null?(Se=Se.delay,Se=typeof Se=="number"&&0<Se?it+Se:it):Se=it,ae){case 1:var Ue=-1;break;case 2:Ue=250;break;case 5:Ue=1073741823;break;case 4:Ue=1e4;break;default:Ue=5e3}return Ue=Se+Ue,ae={id:S++,callback:ge,priorityLevel:ae,startTime:Se,expirationTime:Ue,sortIndex:-1},Se>it?(ae.sortIndex=Se,n(x,ae),o(y)===null&&ae===o(x)&&(I?(L(J),J=-1):I=!0,be(V,Se-it))):(ae.sortIndex=Ue,n(y,ae),G||M||(G=!0,Fe(B))),ae},r.unstable_shouldYield=he,r.unstable_wrapCallback=function(ae){var ge=R;return function(){var Se=R;R=ge;try{return ae.apply(this,arguments)}finally{R=Se}}}})(s9);t9.exports=s9;var kle=t9.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lle=O,Ki=kle;function ot(r){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+r,o=1;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+r+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r9=new Set,hg={};function du(r,n){Cp(r,n),Cp(r+"Capture",n)}function Cp(r,n){for(hg[r]=n,r=0;r<n.length;r++)r9.add(n[r])}var bc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jN=Object.prototype.hasOwnProperty,Mle=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,n3={},i3={};function Fle(r){return jN.call(i3,r)?!0:jN.call(n3,r)?!1:Mle.test(r)?i3[r]=!0:(n3[r]=!0,!1)}function Ule(r,n,o,l){if(o!==null&&o.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return l?!1:o!==null?!o.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Vle(r,n,o,l){if(n===null||typeof n>"u"||Ule(r,n,o,l))return!0;if(l)return!1;if(o!==null)switch(o.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Qn(r,n,o,l,u,m,g){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=l,this.attributeNamespace=u,this.mustUseProperty=o,this.propertyName=r,this.type=n,this.sanitizeURL=m,this.removeEmptyString=g}var yn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){yn[r]=new Qn(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var n=r[0];yn[n]=new Qn(n,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){yn[r]=new Qn(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){yn[r]=new Qn(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){yn[r]=new Qn(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){yn[r]=new Qn(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){yn[r]=new Qn(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){yn[r]=new Qn(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){yn[r]=new Qn(r,5,!1,r.toLowerCase(),null,!1,!1)});var hA=/[\-:]([a-z])/g;function pA(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var n=r.replace(hA,pA);yn[n]=new Qn(n,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var n=r.replace(hA,pA);yn[n]=new Qn(n,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var n=r.replace(hA,pA);yn[n]=new Qn(n,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){yn[r]=new Qn(r,1,!1,r.toLowerCase(),null,!1,!1)});yn.xlinkHref=new Qn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){yn[r]=new Qn(r,1,!1,r.toLowerCase(),null,!0,!0)});function mA(r,n,o,l){var u=yn.hasOwnProperty(n)?yn[n]:null;(u!==null?u.type!==0:l||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(Vle(n,o,u,l)&&(o=null),l||u===null?Fle(n)&&(o===null?r.removeAttribute(n):r.setAttribute(n,""+o)):u.mustUseProperty?r[u.propertyName]=o===null?u.type===3?!1:"":o:(n=u.attributeName,l=u.attributeNamespace,o===null?r.removeAttribute(n):(u=u.type,o=u===3||u===4&&o===!0?"":""+o,l?r.setAttributeNS(l,n,o):r.setAttribute(n,o))))}var Nc=Lle.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ry=Symbol.for("react.element"),Wh=Symbol.for("react.portal"),Gh=Symbol.for("react.fragment"),fA=Symbol.for("react.strict_mode"),PN=Symbol.for("react.profiler"),n9=Symbol.for("react.provider"),i9=Symbol.for("react.context"),gA=Symbol.for("react.forward_ref"),kN=Symbol.for("react.suspense"),LN=Symbol.for("react.suspense_list"),_A=Symbol.for("react.memo"),gl=Symbol.for("react.lazy"),a9=Symbol.for("react.offscreen"),a3=Symbol.iterator;function Nf(r){return r===null||typeof r!="object"?null:(r=a3&&r[a3]||r["@@iterator"],typeof r=="function"?r:null)}var Cr=Object.assign,NT;function Wf(r){if(NT===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);NT=n&&n[1]||""}return`
`+NT+r}var RT=!1;function AT(r,n){if(!r||RT)return"";RT=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(x){var l=x}Reflect.construct(r,[],n)}else{try{n.call()}catch(x){l=x}r.call(n.prototype)}else{try{throw Error()}catch(x){l=x}r()}}catch(x){if(x&&l&&typeof x.stack=="string"){for(var u=x.stack.split(`
`),m=l.stack.split(`
`),g=u.length-1,E=m.length-1;1<=g&&0<=E&&u[g]!==m[E];)E--;for(;1<=g&&0<=E;g--,E--)if(u[g]!==m[E]){if(g!==1||E!==1)do if(g--,E--,0>E||u[g]!==m[E]){var y=`
`+u[g].replace(" at new "," at ");return r.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",r.displayName)),y}while(1<=g&&0<=E);break}}}finally{RT=!1,Error.prepareStackTrace=o}return(r=r?r.displayName||r.name:"")?Wf(r):""}function Ble(r){switch(r.tag){case 5:return Wf(r.type);case 16:return Wf("Lazy");case 13:return Wf("Suspense");case 19:return Wf("SuspenseList");case 0:case 2:case 15:return r=AT(r.type,!1),r;case 11:return r=AT(r.type.render,!1),r;case 1:return r=AT(r.type,!0),r;default:return""}}function MN(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Gh:return"Fragment";case Wh:return"Portal";case PN:return"Profiler";case fA:return"StrictMode";case kN:return"Suspense";case LN:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case i9:return(r.displayName||"Context")+".Consumer";case n9:return(r._context.displayName||"Context")+".Provider";case gA:var n=r.render;return r=r.displayName,r||(r=n.displayName||n.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case _A:return n=r.displayName||null,n!==null?n:MN(r.type)||"Memo";case gl:n=r._payload,r=r._init;try{return MN(r(n))}catch{}}return null}function Wle(r){var n=r.type;switch(r.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=n.render,r=r.displayName||r.name||"",n.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return MN(n);case 8:return n===fA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Ul(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function o9(r){var n=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Gle(r){var n=o9(r)?"checked":"value",o=Object.getOwnPropertyDescriptor(r.constructor.prototype,n),l=""+r[n];if(!r.hasOwnProperty(n)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var u=o.get,m=o.set;return Object.defineProperty(r,n,{configurable:!0,get:function(){return u.call(this)},set:function(g){l=""+g,m.call(this,g)}}),Object.defineProperty(r,n,{enumerable:o.enumerable}),{getValue:function(){return l},setValue:function(g){l=""+g},stopTracking:function(){r._valueTracker=null,delete r[n]}}}}function ny(r){r._valueTracker||(r._valueTracker=Gle(r))}function c9(r){if(!r)return!1;var n=r._valueTracker;if(!n)return!0;var o=n.getValue(),l="";return r&&(l=o9(r)?r.checked?"true":"false":r.value),r=l,r!==o?(n.setValue(r),!0):!1}function Xy(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function FN(r,n){var o=n.checked;return Cr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??r._wrapperState.initialChecked})}function o3(r,n){var o=n.defaultValue==null?"":n.defaultValue,l=n.checked!=null?n.checked:n.defaultChecked;o=Ul(n.value!=null?n.value:o),r._wrapperState={initialChecked:l,initialValue:o,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function l9(r,n){n=n.checked,n!=null&&mA(r,"checked",n,!1)}function UN(r,n){l9(r,n);var o=Ul(n.value),l=n.type;if(o!=null)l==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+o):r.value!==""+o&&(r.value=""+o);else if(l==="submit"||l==="reset"){r.removeAttribute("value");return}n.hasOwnProperty("value")?VN(r,n.type,o):n.hasOwnProperty("defaultValue")&&VN(r,n.type,Ul(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(r.defaultChecked=!!n.defaultChecked)}function c3(r,n,o){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var l=n.type;if(!(l!=="submit"&&l!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+r._wrapperState.initialValue,o||n===r.value||(r.value=n),r.defaultValue=n}o=r.name,o!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,o!==""&&(r.name=o)}function VN(r,n,o){(n!=="number"||Xy(r.ownerDocument)!==r)&&(o==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+o&&(r.defaultValue=""+o))}var Gf=Array.isArray;function cp(r,n,o,l){if(r=r.options,n){n={};for(var u=0;u<o.length;u++)n["$"+o[u]]=!0;for(o=0;o<r.length;o++)u=n.hasOwnProperty("$"+r[o].value),r[o].selected!==u&&(r[o].selected=u),u&&l&&(r[o].defaultSelected=!0)}else{for(o=""+Ul(o),n=null,u=0;u<r.length;u++){if(r[u].value===o){r[u].selected=!0,l&&(r[u].defaultSelected=!0);return}n!==null||r[u].disabled||(n=r[u])}n!==null&&(n.selected=!0)}}function BN(r,n){if(n.dangerouslySetInnerHTML!=null)throw Error(ot(91));return Cr({},n,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function l3(r,n){var o=n.value;if(o==null){if(o=n.children,n=n.defaultValue,o!=null){if(n!=null)throw Error(ot(92));if(Gf(o)){if(1<o.length)throw Error(ot(93));o=o[0]}n=o}n==null&&(n=""),o=n}r._wrapperState={initialValue:Ul(o)}}function d9(r,n){var o=Ul(n.value),l=Ul(n.defaultValue);o!=null&&(o=""+o,o!==r.value&&(r.value=o),n.defaultValue==null&&r.defaultValue!==o&&(r.defaultValue=o)),l!=null&&(r.defaultValue=""+l)}function d3(r){var n=r.textContent;n===r._wrapperState.initialValue&&n!==""&&n!==null&&(r.value=n)}function u9(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function WN(r,n){return r==null||r==="http://www.w3.org/1999/xhtml"?u9(n):r==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var iy,h9=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,o,l,u){MSApp.execUnsafeLocalFunction(function(){return r(n,o,l,u)})}:r}(function(r,n){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=n;else{for(iy=iy||document.createElement("div"),iy.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=iy.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;n.firstChild;)r.appendChild(n.firstChild)}});function pg(r,n){if(n){var o=r.firstChild;if(o&&o===r.lastChild&&o.nodeType===3){o.nodeValue=n;return}}r.textContent=n}var $f={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Hle=["Webkit","ms","Moz","O"];Object.keys($f).forEach(function(r){Hle.forEach(function(n){n=n+r.charAt(0).toUpperCase()+r.substring(1),$f[n]=$f[r]})});function p9(r,n,o){return n==null||typeof n=="boolean"||n===""?"":o||typeof n!="number"||n===0||$f.hasOwnProperty(r)&&$f[r]?(""+n).trim():n+"px"}function m9(r,n){r=r.style;for(var o in n)if(n.hasOwnProperty(o)){var l=o.indexOf("--")===0,u=p9(o,n[o],l);o==="float"&&(o="cssFloat"),l?r.setProperty(o,u):r[o]=u}}var zle=Cr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function GN(r,n){if(n){if(zle[r]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(ot(137,r));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(ot(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(ot(61))}if(n.style!=null&&typeof n.style!="object")throw Error(ot(62))}}function HN(r,n){if(r.indexOf("-")===-1)return typeof n.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zN=null;function vA(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var KN=null,lp=null,dp=null;function u3(r){if(r=Kg(r)){if(typeof KN!="function")throw Error(ot(280));var n=r.stateNode;n&&(n=Fx(n),KN(r.stateNode,r.type,n))}}function f9(r){lp?dp?dp.push(r):dp=[r]:lp=r}function g9(){if(lp){var r=lp,n=dp;if(dp=lp=null,u3(r),n)for(r=0;r<n.length;r++)u3(n[r])}}function _9(r,n){return r(n)}function v9(){}var IT=!1;function E9(r,n,o){if(IT)return r(n,o);IT=!0;try{return _9(r,n,o)}finally{IT=!1,(lp!==null||dp!==null)&&(v9(),g9())}}function mg(r,n){var o=r.stateNode;if(o===null)return null;var l=Fx(o);if(l===null)return null;o=l[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(r=r.type,l=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!l;break e;default:r=!1}if(r)return null;if(o&&typeof o!="function")throw Error(ot(231,n,typeof o));return o}var qN=!1;if(bc)try{var Rf={};Object.defineProperty(Rf,"passive",{get:function(){qN=!0}}),window.addEventListener("test",Rf,Rf),window.removeEventListener("test",Rf,Rf)}catch{qN=!1}function Kle(r,n,o,l,u,m,g,E,y){var x=Array.prototype.slice.call(arguments,3);try{n.apply(o,x)}catch(S){this.onError(S)}}var Xf=!1,Jy=null,Qy=!1,YN=null,qle={onError:function(r){Xf=!0,Jy=r}};function Yle(r,n,o,l,u,m,g,E,y){Xf=!1,Jy=null,Kle.apply(qle,arguments)}function $le(r,n,o,l,u,m,g,E,y){if(Yle.apply(this,arguments),Xf){if(Xf){var x=Jy;Xf=!1,Jy=null}else throw Error(ot(198));Qy||(Qy=!0,YN=x)}}function uu(r){var n=r,o=r;if(r.alternate)for(;n.return;)n=n.return;else{r=n;do n=r,n.flags&4098&&(o=n.return),r=n.return;while(r)}return n.tag===3?o:null}function y9(r){if(r.tag===13){var n=r.memoizedState;if(n===null&&(r=r.alternate,r!==null&&(n=r.memoizedState)),n!==null)return n.dehydrated}return null}function h3(r){if(uu(r)!==r)throw Error(ot(188))}function Xle(r){var n=r.alternate;if(!n){if(n=uu(r),n===null)throw Error(ot(188));return n!==r?null:r}for(var o=r,l=n;;){var u=o.return;if(u===null)break;var m=u.alternate;if(m===null){if(l=u.return,l!==null){o=l;continue}break}if(u.child===m.child){for(m=u.child;m;){if(m===o)return h3(u),r;if(m===l)return h3(u),n;m=m.sibling}throw Error(ot(188))}if(o.return!==l.return)o=u,l=m;else{for(var g=!1,E=u.child;E;){if(E===o){g=!0,o=u,l=m;break}if(E===l){g=!0,l=u,o=m;break}E=E.sibling}if(!g){for(E=m.child;E;){if(E===o){g=!0,o=m,l=u;break}if(E===l){g=!0,l=m,o=u;break}E=E.sibling}if(!g)throw Error(ot(189))}}if(o.alternate!==l)throw Error(ot(190))}if(o.tag!==3)throw Error(ot(188));return o.stateNode.current===o?r:n}function x9(r){return r=Xle(r),r!==null?b9(r):null}function b9(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var n=b9(r);if(n!==null)return n;r=r.sibling}return null}var w9=Ki.unstable_scheduleCallback,p3=Ki.unstable_cancelCallback,Jle=Ki.unstable_shouldYield,Qle=Ki.unstable_requestPaint,Br=Ki.unstable_now,Zle=Ki.unstable_getCurrentPriorityLevel,EA=Ki.unstable_ImmediatePriority,S9=Ki.unstable_UserBlockingPriority,Zy=Ki.unstable_NormalPriority,ede=Ki.unstable_LowPriority,C9=Ki.unstable_IdlePriority,Px=null,Go=null;function tde(r){if(Go&&typeof Go.onCommitFiberRoot=="function")try{Go.onCommitFiberRoot(Px,r,void 0,(r.current.flags&128)===128)}catch{}}var lo=Math.clz32?Math.clz32:nde,sde=Math.log,rde=Math.LN2;function nde(r){return r>>>=0,r===0?32:31-(sde(r)/rde|0)|0}var ay=64,oy=4194304;function Hf(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function ex(r,n){var o=r.pendingLanes;if(o===0)return 0;var l=0,u=r.suspendedLanes,m=r.pingedLanes,g=o&268435455;if(g!==0){var E=g&~u;E!==0?l=Hf(E):(m&=g,m!==0&&(l=Hf(m)))}else g=o&~u,g!==0?l=Hf(g):m!==0&&(l=Hf(m));if(l===0)return 0;if(n!==0&&n!==l&&!(n&u)&&(u=l&-l,m=n&-n,u>=m||u===16&&(m&4194240)!==0))return n;if(l&4&&(l|=o&16),n=r.entangledLanes,n!==0)for(r=r.entanglements,n&=l;0<n;)o=31-lo(n),u=1<<o,l|=r[o],n&=~u;return l}function ide(r,n){switch(r){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ade(r,n){for(var o=r.suspendedLanes,l=r.pingedLanes,u=r.expirationTimes,m=r.pendingLanes;0<m;){var g=31-lo(m),E=1<<g,y=u[g];y===-1?(!(E&o)||E&l)&&(u[g]=ide(E,n)):y<=n&&(r.expiredLanes|=E),m&=~E}}function $N(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function T9(){var r=ay;return ay<<=1,!(ay&4194240)&&(ay=64),r}function DT(r){for(var n=[],o=0;31>o;o++)n.push(r);return n}function Hg(r,n,o){r.pendingLanes|=n,n!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,n=31-lo(n),r[n]=o}function ode(r,n){var o=r.pendingLanes&~n;r.pendingLanes=n,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=n,r.mutableReadLanes&=n,r.entangledLanes&=n,n=r.entanglements;var l=r.eventTimes;for(r=r.expirationTimes;0<o;){var u=31-lo(o),m=1<<u;n[u]=0,l[u]=-1,r[u]=-1,o&=~m}}function yA(r,n){var o=r.entangledLanes|=n;for(r=r.entanglements;o;){var l=31-lo(o),u=1<<l;u&n|r[l]&n&&(r[l]|=n),o&=~u}}var zs=0;function N9(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var R9,xA,A9,I9,D9,XN=!1,cy=[],Il=null,Dl=null,Ol=null,fg=new Map,gg=new Map,El=[],cde="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function m3(r,n){switch(r){case"focusin":case"focusout":Il=null;break;case"dragenter":case"dragleave":Dl=null;break;case"mouseover":case"mouseout":Ol=null;break;case"pointerover":case"pointerout":fg.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":gg.delete(n.pointerId)}}function Af(r,n,o,l,u,m){return r===null||r.nativeEvent!==m?(r={blockedOn:n,domEventName:o,eventSystemFlags:l,nativeEvent:m,targetContainers:[u]},n!==null&&(n=Kg(n),n!==null&&xA(n)),r):(r.eventSystemFlags|=l,n=r.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),r)}function lde(r,n,o,l,u){switch(n){case"focusin":return Il=Af(Il,r,n,o,l,u),!0;case"dragenter":return Dl=Af(Dl,r,n,o,l,u),!0;case"mouseover":return Ol=Af(Ol,r,n,o,l,u),!0;case"pointerover":var m=u.pointerId;return fg.set(m,Af(fg.get(m)||null,r,n,o,l,u)),!0;case"gotpointercapture":return m=u.pointerId,gg.set(m,Af(gg.get(m)||null,r,n,o,l,u)),!0}return!1}function O9(r){var n=zd(r.target);if(n!==null){var o=uu(n);if(o!==null){if(n=o.tag,n===13){if(n=y9(o),n!==null){r.blockedOn=n,D9(r.priority,function(){A9(o)});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){r.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}r.blockedOn=null}function jy(r){if(r.blockedOn!==null)return!1;for(var n=r.targetContainers;0<n.length;){var o=JN(r.domEventName,r.eventSystemFlags,n[0],r.nativeEvent);if(o===null){o=r.nativeEvent;var l=new o.constructor(o.type,o);zN=l,o.target.dispatchEvent(l),zN=null}else return n=Kg(o),n!==null&&xA(n),r.blockedOn=o,!1;n.shift()}return!0}function f3(r,n,o){jy(r)&&o.delete(n)}function dde(){XN=!1,Il!==null&&jy(Il)&&(Il=null),Dl!==null&&jy(Dl)&&(Dl=null),Ol!==null&&jy(Ol)&&(Ol=null),fg.forEach(f3),gg.forEach(f3)}function If(r,n){r.blockedOn===n&&(r.blockedOn=null,XN||(XN=!0,Ki.unstable_scheduleCallback(Ki.unstable_NormalPriority,dde)))}function _g(r){function n(u){return If(u,r)}if(0<cy.length){If(cy[0],r);for(var o=1;o<cy.length;o++){var l=cy[o];l.blockedOn===r&&(l.blockedOn=null)}}for(Il!==null&&If(Il,r),Dl!==null&&If(Dl,r),Ol!==null&&If(Ol,r),fg.forEach(n),gg.forEach(n),o=0;o<El.length;o++)l=El[o],l.blockedOn===r&&(l.blockedOn=null);for(;0<El.length&&(o=El[0],o.blockedOn===null);)O9(o),o.blockedOn===null&&El.shift()}var up=Nc.ReactCurrentBatchConfig,tx=!0;function ude(r,n,o,l){var u=zs,m=up.transition;up.transition=null;try{zs=1,bA(r,n,o,l)}finally{zs=u,up.transition=m}}function hde(r,n,o,l){var u=zs,m=up.transition;up.transition=null;try{zs=4,bA(r,n,o,l)}finally{zs=u,up.transition=m}}function bA(r,n,o,l){if(tx){var u=JN(r,n,o,l);if(u===null)BT(r,n,l,sx,o),m3(r,l);else if(lde(u,r,n,o,l))l.stopPropagation();else if(m3(r,l),n&4&&-1<cde.indexOf(r)){for(;u!==null;){var m=Kg(u);if(m!==null&&R9(m),m=JN(r,n,o,l),m===null&&BT(r,n,l,sx,o),m===u)break;u=m}u!==null&&l.stopPropagation()}else BT(r,n,l,null,o)}}var sx=null;function JN(r,n,o,l){if(sx=null,r=vA(l),r=zd(r),r!==null)if(n=uu(r),n===null)r=null;else if(o=n.tag,o===13){if(r=y9(n),r!==null)return r;r=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;r=null}else n!==r&&(r=null);return sx=r,null}function j9(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zle()){case EA:return 1;case S9:return 4;case Zy:case ede:return 16;case C9:return 536870912;default:return 16}default:return 16}}var Nl=null,wA=null,Py=null;function P9(){if(Py)return Py;var r,n=wA,o=n.length,l,u="value"in Nl?Nl.value:Nl.textContent,m=u.length;for(r=0;r<o&&n[r]===u[r];r++);var g=o-r;for(l=1;l<=g&&n[o-l]===u[m-l];l++);return Py=u.slice(r,1<l?1-l:void 0)}function ky(r){var n=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&n===13&&(r=13)):r=n,r===10&&(r=13),32<=r||r===13?r:0}function ly(){return!0}function g3(){return!1}function Yi(r){function n(o,l,u,m,g){this._reactName=o,this._targetInst=u,this.type=l,this.nativeEvent=m,this.target=g,this.currentTarget=null;for(var E in r)r.hasOwnProperty(E)&&(o=r[E],this[E]=o?o(m):m[E]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?ly:g3,this.isPropagationStopped=g3,this}return Cr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=ly)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=ly)},persist:function(){},isPersistent:ly}),n}var Up={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},SA=Yi(Up),zg=Cr({},Up,{view:0,detail:0}),pde=Yi(zg),OT,jT,Df,kx=Cr({},zg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:CA,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Df&&(Df&&r.type==="mousemove"?(OT=r.screenX-Df.screenX,jT=r.screenY-Df.screenY):jT=OT=0,Df=r),OT)},movementY:function(r){return"movementY"in r?r.movementY:jT}}),_3=Yi(kx),mde=Cr({},kx,{dataTransfer:0}),fde=Yi(mde),gde=Cr({},zg,{relatedTarget:0}),PT=Yi(gde),_de=Cr({},Up,{animationName:0,elapsedTime:0,pseudoElement:0}),vde=Yi(_de),Ede=Cr({},Up,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),yde=Yi(Ede),xde=Cr({},Up,{data:0}),v3=Yi(xde),bde={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wde={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sde={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cde(r){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(r):(r=Sde[r])?!!n[r]:!1}function CA(){return Cde}var Tde=Cr({},zg,{key:function(r){if(r.key){var n=bde[r.key]||r.key;if(n!=="Unidentified")return n}return r.type==="keypress"?(r=ky(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?wde[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:CA,charCode:function(r){return r.type==="keypress"?ky(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ky(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Nde=Yi(Tde),Rde=Cr({},kx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),E3=Yi(Rde),Ade=Cr({},zg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:CA}),Ide=Yi(Ade),Dde=Cr({},Up,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ode=Yi(Dde),jde=Cr({},kx,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Pde=Yi(jde),kde=[9,13,27,32],TA=bc&&"CompositionEvent"in window,Jf=null;bc&&"documentMode"in document&&(Jf=document.documentMode);var Lde=bc&&"TextEvent"in window&&!Jf,k9=bc&&(!TA||Jf&&8<Jf&&11>=Jf),y3=" ",x3=!1;function L9(r,n){switch(r){case"keyup":return kde.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function M9(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Hh=!1;function Mde(r,n){switch(r){case"compositionend":return M9(n);case"keypress":return n.which!==32?null:(x3=!0,y3);case"textInput":return r=n.data,r===y3&&x3?null:r;default:return null}}function Fde(r,n){if(Hh)return r==="compositionend"||!TA&&L9(r,n)?(r=P9(),Py=wA=Nl=null,Hh=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return k9&&n.locale!=="ko"?null:n.data;default:return null}}var Ude={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function b3(r){var n=r&&r.nodeName&&r.nodeName.toLowerCase();return n==="input"?!!Ude[r.type]:n==="textarea"}function F9(r,n,o,l){f9(l),n=rx(n,"onChange"),0<n.length&&(o=new SA("onChange","change",null,o,l),r.push({event:o,listeners:n}))}var Qf=null,vg=null;function Vde(r){$9(r,0)}function Lx(r){var n=qh(r);if(c9(n))return r}function Bde(r,n){if(r==="change")return n}var U9=!1;if(bc){var kT;if(bc){var LT="oninput"in document;if(!LT){var w3=document.createElement("div");w3.setAttribute("oninput","return;"),LT=typeof w3.oninput=="function"}kT=LT}else kT=!1;U9=kT&&(!document.documentMode||9<document.documentMode)}function S3(){Qf&&(Qf.detachEvent("onpropertychange",V9),vg=Qf=null)}function V9(r){if(r.propertyName==="value"&&Lx(vg)){var n=[];F9(n,vg,r,vA(r)),E9(Vde,n)}}function Wde(r,n,o){r==="focusin"?(S3(),Qf=n,vg=o,Qf.attachEvent("onpropertychange",V9)):r==="focusout"&&S3()}function Gde(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Lx(vg)}function Hde(r,n){if(r==="click")return Lx(n)}function zde(r,n){if(r==="input"||r==="change")return Lx(n)}function Kde(r,n){return r===n&&(r!==0||1/r===1/n)||r!==r&&n!==n}var ho=typeof Object.is=="function"?Object.is:Kde;function Eg(r,n){if(ho(r,n))return!0;if(typeof r!="object"||r===null||typeof n!="object"||n===null)return!1;var o=Object.keys(r),l=Object.keys(n);if(o.length!==l.length)return!1;for(l=0;l<o.length;l++){var u=o[l];if(!jN.call(n,u)||!ho(r[u],n[u]))return!1}return!0}function C3(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function T3(r,n){var o=C3(r);r=0;for(var l;o;){if(o.nodeType===3){if(l=r+o.textContent.length,r<=n&&l>=n)return{node:o,offset:n-r};r=l}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=C3(o)}}function B9(r,n){return r&&n?r===n?!0:r&&r.nodeType===3?!1:n&&n.nodeType===3?B9(r,n.parentNode):"contains"in r?r.contains(n):r.compareDocumentPosition?!!(r.compareDocumentPosition(n)&16):!1:!1}function W9(){for(var r=window,n=Xy();n instanceof r.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch{o=!1}if(o)r=n.contentWindow;else break;n=Xy(r.document)}return n}function NA(r){var n=r&&r.nodeName&&r.nodeName.toLowerCase();return n&&(n==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||n==="textarea"||r.contentEditable==="true")}function qde(r){var n=W9(),o=r.focusedElem,l=r.selectionRange;if(n!==o&&o&&o.ownerDocument&&B9(o.ownerDocument.documentElement,o)){if(l!==null&&NA(o)){if(n=l.start,r=l.end,r===void 0&&(r=n),"selectionStart"in o)o.selectionStart=n,o.selectionEnd=Math.min(r,o.value.length);else if(r=(n=o.ownerDocument||document)&&n.defaultView||window,r.getSelection){r=r.getSelection();var u=o.textContent.length,m=Math.min(l.start,u);l=l.end===void 0?m:Math.min(l.end,u),!r.extend&&m>l&&(u=l,l=m,m=u),u=T3(o,m);var g=T3(o,l);u&&g&&(r.rangeCount!==1||r.anchorNode!==u.node||r.anchorOffset!==u.offset||r.focusNode!==g.node||r.focusOffset!==g.offset)&&(n=n.createRange(),n.setStart(u.node,u.offset),r.removeAllRanges(),m>l?(r.addRange(n),r.extend(g.node,g.offset)):(n.setEnd(g.node,g.offset),r.addRange(n)))}}for(n=[],r=o;r=r.parentNode;)r.nodeType===1&&n.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<n.length;o++)r=n[o],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var Yde=bc&&"documentMode"in document&&11>=document.documentMode,zh=null,QN=null,Zf=null,ZN=!1;function N3(r,n,o){var l=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;ZN||zh==null||zh!==Xy(l)||(l=zh,"selectionStart"in l&&NA(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Zf&&Eg(Zf,l)||(Zf=l,l=rx(QN,"onSelect"),0<l.length&&(n=new SA("onSelect","select",null,n,o),r.push({event:n,listeners:l}),n.target=zh)))}function dy(r,n){var o={};return o[r.toLowerCase()]=n.toLowerCase(),o["Webkit"+r]="webkit"+n,o["Moz"+r]="moz"+n,o}var Kh={animationend:dy("Animation","AnimationEnd"),animationiteration:dy("Animation","AnimationIteration"),animationstart:dy("Animation","AnimationStart"),transitionend:dy("Transition","TransitionEnd")},MT={},G9={};bc&&(G9=document.createElement("div").style,"AnimationEvent"in window||(delete Kh.animationend.animation,delete Kh.animationiteration.animation,delete Kh.animationstart.animation),"TransitionEvent"in window||delete Kh.transitionend.transition);function Mx(r){if(MT[r])return MT[r];if(!Kh[r])return r;var n=Kh[r],o;for(o in n)if(n.hasOwnProperty(o)&&o in G9)return MT[r]=n[o];return r}var H9=Mx("animationend"),z9=Mx("animationiteration"),K9=Mx("animationstart"),q9=Mx("transitionend"),Y9=new Map,R3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Gl(r,n){Y9.set(r,n),du(n,[r])}for(var FT=0;FT<R3.length;FT++){var UT=R3[FT],$de=UT.toLowerCase(),Xde=UT[0].toUpperCase()+UT.slice(1);Gl($de,"on"+Xde)}Gl(H9,"onAnimationEnd");Gl(z9,"onAnimationIteration");Gl(K9,"onAnimationStart");Gl("dblclick","onDoubleClick");Gl("focusin","onFocus");Gl("focusout","onBlur");Gl(q9,"onTransitionEnd");Cp("onMouseEnter",["mouseout","mouseover"]);Cp("onMouseLeave",["mouseout","mouseover"]);Cp("onPointerEnter",["pointerout","pointerover"]);Cp("onPointerLeave",["pointerout","pointerover"]);du("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));du("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));du("onBeforeInput",["compositionend","keypress","textInput","paste"]);du("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));du("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));du("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Jde=new Set("cancel close invalid load scroll toggle".split(" ").concat(zf));function A3(r,n,o){var l=r.type||"unknown-event";r.currentTarget=o,$le(l,n,void 0,r),r.currentTarget=null}function $9(r,n){n=(n&4)!==0;for(var o=0;o<r.length;o++){var l=r[o],u=l.event;l=l.listeners;e:{var m=void 0;if(n)for(var g=l.length-1;0<=g;g--){var E=l[g],y=E.instance,x=E.currentTarget;if(E=E.listener,y!==m&&u.isPropagationStopped())break e;A3(u,E,x),m=y}else for(g=0;g<l.length;g++){if(E=l[g],y=E.instance,x=E.currentTarget,E=E.listener,y!==m&&u.isPropagationStopped())break e;A3(u,E,x),m=y}}}if(Qy)throw r=YN,Qy=!1,YN=null,r}function cr(r,n){var o=n[nR];o===void 0&&(o=n[nR]=new Set);var l=r+"__bubble";o.has(l)||(X9(n,r,2,!1),o.add(l))}function VT(r,n,o){var l=0;n&&(l|=4),X9(o,r,l,n)}var uy="_reactListening"+Math.random().toString(36).slice(2);function yg(r){if(!r[uy]){r[uy]=!0,r9.forEach(function(o){o!=="selectionchange"&&(Jde.has(o)||VT(o,!1,r),VT(o,!0,r))});var n=r.nodeType===9?r:r.ownerDocument;n===null||n[uy]||(n[uy]=!0,VT("selectionchange",!1,n))}}function X9(r,n,o,l){switch(j9(n)){case 1:var u=ude;break;case 4:u=hde;break;default:u=bA}o=u.bind(null,n,o,r),u=void 0,!qN||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),l?u!==void 0?r.addEventListener(n,o,{capture:!0,passive:u}):r.addEventListener(n,o,!0):u!==void 0?r.addEventListener(n,o,{passive:u}):r.addEventListener(n,o,!1)}function BT(r,n,o,l,u){var m=l;if(!(n&1)&&!(n&2)&&l!==null)e:for(;;){if(l===null)return;var g=l.tag;if(g===3||g===4){var E=l.stateNode.containerInfo;if(E===u||E.nodeType===8&&E.parentNode===u)break;if(g===4)for(g=l.return;g!==null;){var y=g.tag;if((y===3||y===4)&&(y=g.stateNode.containerInfo,y===u||y.nodeType===8&&y.parentNode===u))return;g=g.return}for(;E!==null;){if(g=zd(E),g===null)return;if(y=g.tag,y===5||y===6){l=m=g;continue e}E=E.parentNode}}l=l.return}E9(function(){var x=m,S=vA(o),C=[];e:{var R=Y9.get(r);if(R!==void 0){var M=SA,G=r;switch(r){case"keypress":if(ky(o)===0)break e;case"keydown":case"keyup":M=Nde;break;case"focusin":G="focus",M=PT;break;case"focusout":G="blur",M=PT;break;case"beforeblur":case"afterblur":M=PT;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":M=_3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":M=fde;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":M=Ide;break;case H9:case z9:case K9:M=vde;break;case q9:M=Ode;break;case"scroll":M=pde;break;case"wheel":M=Pde;break;case"copy":case"cut":case"paste":M=yde;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":M=E3}var I=(n&4)!==0,j=!I&&r==="scroll",L=I?R!==null?R+"Capture":null:R;I=[];for(var N=x,D;N!==null;){D=N;var V=D.stateNode;if(D.tag===5&&V!==null&&(D=V,L!==null&&(V=mg(N,L),V!=null&&I.push(xg(N,V,D)))),j)break;N=N.return}0<I.length&&(R=new M(R,G,null,o,S),C.push({event:R,listeners:I}))}}if(!(n&7)){e:{if(R=r==="mouseover"||r==="pointerover",M=r==="mouseout"||r==="pointerout",R&&o!==zN&&(G=o.relatedTarget||o.fromElement)&&(zd(G)||G[wc]))break e;if((M||R)&&(R=S.window===S?S:(R=S.ownerDocument)?R.defaultView||R.parentWindow:window,M?(G=o.relatedTarget||o.toElement,M=x,G=G?zd(G):null,G!==null&&(j=uu(G),G!==j||G.tag!==5&&G.tag!==6)&&(G=null)):(M=null,G=x),M!==G)){if(I=_3,V="onMouseLeave",L="onMouseEnter",N="mouse",(r==="pointerout"||r==="pointerover")&&(I=E3,V="onPointerLeave",L="onPointerEnter",N="pointer"),j=M==null?R:qh(M),D=G==null?R:qh(G),R=new I(V,N+"leave",M,o,S),R.target=j,R.relatedTarget=D,V=null,zd(S)===x&&(I=new I(L,N+"enter",G,o,S),I.target=D,I.relatedTarget=j,V=I),j=V,M&&G)t:{for(I=M,L=G,N=0,D=I;D;D=kh(D))N++;for(D=0,V=L;V;V=kh(V))D++;for(;0<N-D;)I=kh(I),N--;for(;0<D-N;)L=kh(L),D--;for(;N--;){if(I===L||L!==null&&I===L.alternate)break t;I=kh(I),L=kh(L)}I=null}else I=null;M!==null&&I3(C,R,M,I,!1),G!==null&&j!==null&&I3(C,j,G,I,!0)}}e:{if(R=x?qh(x):window,M=R.nodeName&&R.nodeName.toLowerCase(),M==="select"||M==="input"&&R.type==="file")var B=Bde;else if(b3(R))if(U9)B=zde;else{B=Gde;var z=Wde}else(M=R.nodeName)&&M.toLowerCase()==="input"&&(R.type==="checkbox"||R.type==="radio")&&(B=Hde);if(B&&(B=B(r,x))){F9(C,B,o,S);break e}z&&z(r,R,x),r==="focusout"&&(z=R._wrapperState)&&z.controlled&&R.type==="number"&&VN(R,"number",R.value)}switch(z=x?qh(x):window,r){case"focusin":(b3(z)||z.contentEditable==="true")&&(zh=z,QN=x,Zf=null);break;case"focusout":Zf=QN=zh=null;break;case"mousedown":ZN=!0;break;case"contextmenu":case"mouseup":case"dragend":ZN=!1,N3(C,o,S);break;case"selectionchange":if(Yde)break;case"keydown":case"keyup":N3(C,o,S)}var H;if(TA)e:{switch(r){case"compositionstart":var J="onCompositionStart";break e;case"compositionend":J="onCompositionEnd";break e;case"compositionupdate":J="onCompositionUpdate";break e}J=void 0}else Hh?L9(r,o)&&(J="onCompositionEnd"):r==="keydown"&&o.keyCode===229&&(J="onCompositionStart");J&&(k9&&o.locale!=="ko"&&(Hh||J!=="onCompositionStart"?J==="onCompositionEnd"&&Hh&&(H=P9()):(Nl=S,wA="value"in Nl?Nl.value:Nl.textContent,Hh=!0)),z=rx(x,J),0<z.length&&(J=new v3(J,r,null,o,S),C.push({event:J,listeners:z}),H?J.data=H:(H=M9(o),H!==null&&(J.data=H)))),(H=Lde?Mde(r,o):Fde(r,o))&&(x=rx(x,"onBeforeInput"),0<x.length&&(S=new v3("onBeforeInput","beforeinput",null,o,S),C.push({event:S,listeners:x}),S.data=H))}$9(C,n)})}function xg(r,n,o){return{instance:r,listener:n,currentTarget:o}}function rx(r,n){for(var o=n+"Capture",l=[];r!==null;){var u=r,m=u.stateNode;u.tag===5&&m!==null&&(u=m,m=mg(r,o),m!=null&&l.unshift(xg(r,m,u)),m=mg(r,n),m!=null&&l.push(xg(r,m,u))),r=r.return}return l}function kh(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function I3(r,n,o,l,u){for(var m=n._reactName,g=[];o!==null&&o!==l;){var E=o,y=E.alternate,x=E.stateNode;if(y!==null&&y===l)break;E.tag===5&&x!==null&&(E=x,u?(y=mg(o,m),y!=null&&g.unshift(xg(o,y,E))):u||(y=mg(o,m),y!=null&&g.push(xg(o,y,E)))),o=o.return}g.length!==0&&r.push({event:n,listeners:g})}var Qde=/\r\n?/g,Zde=/\u0000|\uFFFD/g;function D3(r){return(typeof r=="string"?r:""+r).replace(Qde,`
`).replace(Zde,"")}function hy(r,n,o){if(n=D3(n),D3(r)!==n&&o)throw Error(ot(425))}function nx(){}var eR=null,tR=null;function sR(r,n){return r==="textarea"||r==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var rR=typeof setTimeout=="function"?setTimeout:void 0,eue=typeof clearTimeout=="function"?clearTimeout:void 0,O3=typeof Promise=="function"?Promise:void 0,tue=typeof queueMicrotask=="function"?queueMicrotask:typeof O3<"u"?function(r){return O3.resolve(null).then(r).catch(sue)}:rR;function sue(r){setTimeout(function(){throw r})}function WT(r,n){var o=n,l=0;do{var u=o.nextSibling;if(r.removeChild(o),u&&u.nodeType===8)if(o=u.data,o==="/$"){if(l===0){r.removeChild(u),_g(n);return}l--}else o!=="$"&&o!=="$?"&&o!=="$!"||l++;o=u}while(o);_g(n)}function jl(r){for(;r!=null;r=r.nextSibling){var n=r.nodeType;if(n===1||n===3)break;if(n===8){if(n=r.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return r}function j3(r){r=r.previousSibling;for(var n=0;r;){if(r.nodeType===8){var o=r.data;if(o==="$"||o==="$!"||o==="$?"){if(n===0)return r;n--}else o==="/$"&&n++}r=r.previousSibling}return null}var Vp=Math.random().toString(36).slice(2),Wo="__reactFiber$"+Vp,bg="__reactProps$"+Vp,wc="__reactContainer$"+Vp,nR="__reactEvents$"+Vp,rue="__reactListeners$"+Vp,nue="__reactHandles$"+Vp;function zd(r){var n=r[Wo];if(n)return n;for(var o=r.parentNode;o;){if(n=o[wc]||o[Wo]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(r=j3(r);r!==null;){if(o=r[Wo])return o;r=j3(r)}return n}r=o,o=r.parentNode}return null}function Kg(r){return r=r[Wo]||r[wc],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function qh(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(ot(33))}function Fx(r){return r[bg]||null}var iR=[],Yh=-1;function Hl(r){return{current:r}}function lr(r){0>Yh||(r.current=iR[Yh],iR[Yh]=null,Yh--)}function rr(r,n){Yh++,iR[Yh]=r.current,r.current=n}var Vl={},Fn=Hl(Vl),bi=Hl(!1),nu=Vl;function Tp(r,n){var o=r.type.contextTypes;if(!o)return Vl;var l=r.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===n)return l.__reactInternalMemoizedMaskedChildContext;var u={},m;for(m in o)u[m]=n[m];return l&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=n,r.__reactInternalMemoizedMaskedChildContext=u),u}function wi(r){return r=r.childContextTypes,r!=null}function ix(){lr(bi),lr(Fn)}function P3(r,n,o){if(Fn.current!==Vl)throw Error(ot(168));rr(Fn,n),rr(bi,o)}function J9(r,n,o){var l=r.stateNode;if(n=n.childContextTypes,typeof l.getChildContext!="function")return o;l=l.getChildContext();for(var u in l)if(!(u in n))throw Error(ot(108,Wle(r)||"Unknown",u));return Cr({},o,l)}function ax(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Vl,nu=Fn.current,rr(Fn,r),rr(bi,bi.current),!0}function k3(r,n,o){var l=r.stateNode;if(!l)throw Error(ot(169));o?(r=J9(r,n,nu),l.__reactInternalMemoizedMergedChildContext=r,lr(bi),lr(Fn),rr(Fn,r)):lr(bi),rr(bi,o)}var _c=null,Ux=!1,GT=!1;function Q9(r){_c===null?_c=[r]:_c.push(r)}function iue(r){Ux=!0,Q9(r)}function zl(){if(!GT&&_c!==null){GT=!0;var r=0,n=zs;try{var o=_c;for(zs=1;r<o.length;r++){var l=o[r];do l=l(!0);while(l!==null)}_c=null,Ux=!1}catch(u){throw _c!==null&&(_c=_c.slice(r+1)),w9(EA,zl),u}finally{zs=n,GT=!1}}return null}var $h=[],Xh=0,ox=null,cx=0,ba=[],wa=0,iu=null,Ec=1,yc="";function Fd(r,n){$h[Xh++]=cx,$h[Xh++]=ox,ox=r,cx=n}function Z9(r,n,o){ba[wa++]=Ec,ba[wa++]=yc,ba[wa++]=iu,iu=r;var l=Ec;r=yc;var u=32-lo(l)-1;l&=~(1<<u),o+=1;var m=32-lo(n)+u;if(30<m){var g=u-u%5;m=(l&(1<<g)-1).toString(32),l>>=g,u-=g,Ec=1<<32-lo(n)+u|o<<u|l,yc=m+r}else Ec=1<<m|o<<u|l,yc=r}function RA(r){r.return!==null&&(Fd(r,1),Z9(r,1,0))}function AA(r){for(;r===ox;)ox=$h[--Xh],$h[Xh]=null,cx=$h[--Xh],$h[Xh]=null;for(;r===iu;)iu=ba[--wa],ba[wa]=null,yc=ba[--wa],ba[wa]=null,Ec=ba[--wa],ba[wa]=null}var zi=null,Hi=null,pr=!1,ao=null;function e8(r,n){var o=Ca(5,null,null,0);o.elementType="DELETED",o.stateNode=n,o.return=r,n=r.deletions,n===null?(r.deletions=[o],r.flags|=16):n.push(o)}function L3(r,n){switch(r.tag){case 5:var o=r.type;return n=n.nodeType!==1||o.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(r.stateNode=n,zi=r,Hi=jl(n.firstChild),!0):!1;case 6:return n=r.pendingProps===""||n.nodeType!==3?null:n,n!==null?(r.stateNode=n,zi=r,Hi=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(o=iu!==null?{id:Ec,overflow:yc}:null,r.memoizedState={dehydrated:n,treeContext:o,retryLane:1073741824},o=Ca(18,null,null,0),o.stateNode=n,o.return=r,r.child=o,zi=r,Hi=null,!0):!1;default:return!1}}function aR(r){return(r.mode&1)!==0&&(r.flags&128)===0}function oR(r){if(pr){var n=Hi;if(n){var o=n;if(!L3(r,n)){if(aR(r))throw Error(ot(418));n=jl(o.nextSibling);var l=zi;n&&L3(r,n)?e8(l,o):(r.flags=r.flags&-4097|2,pr=!1,zi=r)}}else{if(aR(r))throw Error(ot(418));r.flags=r.flags&-4097|2,pr=!1,zi=r}}}function M3(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;zi=r}function py(r){if(r!==zi)return!1;if(!pr)return M3(r),pr=!0,!1;var n;if((n=r.tag!==3)&&!(n=r.tag!==5)&&(n=r.type,n=n!=="head"&&n!=="body"&&!sR(r.type,r.memoizedProps)),n&&(n=Hi)){if(aR(r))throw t8(),Error(ot(418));for(;n;)e8(r,n),n=jl(n.nextSibling)}if(M3(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ot(317));e:{for(r=r.nextSibling,n=0;r;){if(r.nodeType===8){var o=r.data;if(o==="/$"){if(n===0){Hi=jl(r.nextSibling);break e}n--}else o!=="$"&&o!=="$!"&&o!=="$?"||n++}r=r.nextSibling}Hi=null}}else Hi=zi?jl(r.stateNode.nextSibling):null;return!0}function t8(){for(var r=Hi;r;)r=jl(r.nextSibling)}function Np(){Hi=zi=null,pr=!1}function IA(r){ao===null?ao=[r]:ao.push(r)}var aue=Nc.ReactCurrentBatchConfig;function Of(r,n,o){if(r=o.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(ot(309));var l=o.stateNode}if(!l)throw Error(ot(147,r));var u=l,m=""+r;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===m?n.ref:(n=function(g){var E=u.refs;g===null?delete E[m]:E[m]=g},n._stringRef=m,n)}if(typeof r!="string")throw Error(ot(284));if(!o._owner)throw Error(ot(290,r))}return r}function my(r,n){throw r=Object.prototype.toString.call(n),Error(ot(31,r==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":r))}function F3(r){var n=r._init;return n(r._payload)}function s8(r){function n(L,N){if(r){var D=L.deletions;D===null?(L.deletions=[N],L.flags|=16):D.push(N)}}function o(L,N){if(!r)return null;for(;N!==null;)n(L,N),N=N.sibling;return null}function l(L,N){for(L=new Map;N!==null;)N.key!==null?L.set(N.key,N):L.set(N.index,N),N=N.sibling;return L}function u(L,N){return L=Ml(L,N),L.index=0,L.sibling=null,L}function m(L,N,D){return L.index=D,r?(D=L.alternate,D!==null?(D=D.index,D<N?(L.flags|=2,N):D):(L.flags|=2,N)):(L.flags|=1048576,N)}function g(L){return r&&L.alternate===null&&(L.flags|=2),L}function E(L,N,D,V){return N===null||N.tag!==6?(N=XT(D,L.mode,V),N.return=L,N):(N=u(N,D),N.return=L,N)}function y(L,N,D,V){var B=D.type;return B===Gh?S(L,N,D.props.children,V,D.key):N!==null&&(N.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===gl&&F3(B)===N.type)?(V=u(N,D.props),V.ref=Of(L,N,D),V.return=L,V):(V=Wy(D.type,D.key,D.props,null,L.mode,V),V.ref=Of(L,N,D),V.return=L,V)}function x(L,N,D,V){return N===null||N.tag!==4||N.stateNode.containerInfo!==D.containerInfo||N.stateNode.implementation!==D.implementation?(N=JT(D,L.mode,V),N.return=L,N):(N=u(N,D.children||[]),N.return=L,N)}function S(L,N,D,V,B){return N===null||N.tag!==7?(N=tu(D,L.mode,V,B),N.return=L,N):(N=u(N,D),N.return=L,N)}function C(L,N,D){if(typeof N=="string"&&N!==""||typeof N=="number")return N=XT(""+N,L.mode,D),N.return=L,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case ry:return D=Wy(N.type,N.key,N.props,null,L.mode,D),D.ref=Of(L,null,N),D.return=L,D;case Wh:return N=JT(N,L.mode,D),N.return=L,N;case gl:var V=N._init;return C(L,V(N._payload),D)}if(Gf(N)||Nf(N))return N=tu(N,L.mode,D,null),N.return=L,N;my(L,N)}return null}function R(L,N,D,V){var B=N!==null?N.key:null;if(typeof D=="string"&&D!==""||typeof D=="number")return B!==null?null:E(L,N,""+D,V);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case ry:return D.key===B?y(L,N,D,V):null;case Wh:return D.key===B?x(L,N,D,V):null;case gl:return B=D._init,R(L,N,B(D._payload),V)}if(Gf(D)||Nf(D))return B!==null?null:S(L,N,D,V,null);my(L,D)}return null}function M(L,N,D,V,B){if(typeof V=="string"&&V!==""||typeof V=="number")return L=L.get(D)||null,E(N,L,""+V,B);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case ry:return L=L.get(V.key===null?D:V.key)||null,y(N,L,V,B);case Wh:return L=L.get(V.key===null?D:V.key)||null,x(N,L,V,B);case gl:var z=V._init;return M(L,N,D,z(V._payload),B)}if(Gf(V)||Nf(V))return L=L.get(D)||null,S(N,L,V,B,null);my(N,V)}return null}function G(L,N,D,V){for(var B=null,z=null,H=N,J=N=0,ee=null;H!==null&&J<D.length;J++){H.index>J?(ee=H,H=null):ee=H.sibling;var ne=R(L,H,D[J],V);if(ne===null){H===null&&(H=ee);break}r&&H&&ne.alternate===null&&n(L,H),N=m(ne,N,J),z===null?B=ne:z.sibling=ne,z=ne,H=ee}if(J===D.length)return o(L,H),pr&&Fd(L,J),B;if(H===null){for(;J<D.length;J++)H=C(L,D[J],V),H!==null&&(N=m(H,N,J),z===null?B=H:z.sibling=H,z=H);return pr&&Fd(L,J),B}for(H=l(L,H);J<D.length;J++)ee=M(H,L,J,D[J],V),ee!==null&&(r&&ee.alternate!==null&&H.delete(ee.key===null?J:ee.key),N=m(ee,N,J),z===null?B=ee:z.sibling=ee,z=ee);return r&&H.forEach(function(he){return n(L,he)}),pr&&Fd(L,J),B}function I(L,N,D,V){var B=Nf(D);if(typeof B!="function")throw Error(ot(150));if(D=B.call(D),D==null)throw Error(ot(151));for(var z=B=null,H=N,J=N=0,ee=null,ne=D.next();H!==null&&!ne.done;J++,ne=D.next()){H.index>J?(ee=H,H=null):ee=H.sibling;var he=R(L,H,ne.value,V);if(he===null){H===null&&(H=ee);break}r&&H&&he.alternate===null&&n(L,H),N=m(he,N,J),z===null?B=he:z.sibling=he,z=he,H=ee}if(ne.done)return o(L,H),pr&&Fd(L,J),B;if(H===null){for(;!ne.done;J++,ne=D.next())ne=C(L,ne.value,V),ne!==null&&(N=m(ne,N,J),z===null?B=ne:z.sibling=ne,z=ne);return pr&&Fd(L,J),B}for(H=l(L,H);!ne.done;J++,ne=D.next())ne=M(H,L,J,ne.value,V),ne!==null&&(r&&ne.alternate!==null&&H.delete(ne.key===null?J:ne.key),N=m(ne,N,J),z===null?B=ne:z.sibling=ne,z=ne);return r&&H.forEach(function(ve){return n(L,ve)}),pr&&Fd(L,J),B}function j(L,N,D,V){if(typeof D=="object"&&D!==null&&D.type===Gh&&D.key===null&&(D=D.props.children),typeof D=="object"&&D!==null){switch(D.$$typeof){case ry:e:{for(var B=D.key,z=N;z!==null;){if(z.key===B){if(B=D.type,B===Gh){if(z.tag===7){o(L,z.sibling),N=u(z,D.props.children),N.return=L,L=N;break e}}else if(z.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===gl&&F3(B)===z.type){o(L,z.sibling),N=u(z,D.props),N.ref=Of(L,z,D),N.return=L,L=N;break e}o(L,z);break}else n(L,z);z=z.sibling}D.type===Gh?(N=tu(D.props.children,L.mode,V,D.key),N.return=L,L=N):(V=Wy(D.type,D.key,D.props,null,L.mode,V),V.ref=Of(L,N,D),V.return=L,L=V)}return g(L);case Wh:e:{for(z=D.key;N!==null;){if(N.key===z)if(N.tag===4&&N.stateNode.containerInfo===D.containerInfo&&N.stateNode.implementation===D.implementation){o(L,N.sibling),N=u(N,D.children||[]),N.return=L,L=N;break e}else{o(L,N);break}else n(L,N);N=N.sibling}N=JT(D,L.mode,V),N.return=L,L=N}return g(L);case gl:return z=D._init,j(L,N,z(D._payload),V)}if(Gf(D))return G(L,N,D,V);if(Nf(D))return I(L,N,D,V);my(L,D)}return typeof D=="string"&&D!==""||typeof D=="number"?(D=""+D,N!==null&&N.tag===6?(o(L,N.sibling),N=u(N,D),N.return=L,L=N):(o(L,N),N=XT(D,L.mode,V),N.return=L,L=N),g(L)):o(L,N)}return j}var Rp=s8(!0),r8=s8(!1),lx=Hl(null),dx=null,Jh=null,DA=null;function OA(){DA=Jh=dx=null}function jA(r){var n=lx.current;lr(lx),r._currentValue=n}function cR(r,n,o){for(;r!==null;){var l=r.alternate;if((r.childLanes&n)!==n?(r.childLanes|=n,l!==null&&(l.childLanes|=n)):l!==null&&(l.childLanes&n)!==n&&(l.childLanes|=n),r===o)break;r=r.return}}function hp(r,n){dx=r,DA=Jh=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&n&&(Ei=!0),r.firstContext=null)}function Aa(r){var n=r._currentValue;if(DA!==r)if(r={context:r,memoizedValue:n,next:null},Jh===null){if(dx===null)throw Error(ot(308));Jh=r,dx.dependencies={lanes:0,firstContext:r}}else Jh=Jh.next=r;return n}var Kd=null;function PA(r){Kd===null?Kd=[r]:Kd.push(r)}function n8(r,n,o,l){var u=n.interleaved;return u===null?(o.next=o,PA(n)):(o.next=u.next,u.next=o),n.interleaved=o,Sc(r,l)}function Sc(r,n){r.lanes|=n;var o=r.alternate;for(o!==null&&(o.lanes|=n),o=r,r=r.return;r!==null;)r.childLanes|=n,o=r.alternate,o!==null&&(o.childLanes|=n),o=r,r=r.return;return o.tag===3?o.stateNode:null}var _l=!1;function kA(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function i8(r,n){r=r.updateQueue,n.updateQueue===r&&(n.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function xc(r,n){return{eventTime:r,lane:n,tag:0,payload:null,callback:null,next:null}}function Pl(r,n,o){var l=r.updateQueue;if(l===null)return null;if(l=l.shared,Ds&2){var u=l.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),l.pending=n,Sc(r,o)}return u=l.interleaved,u===null?(n.next=n,PA(l)):(n.next=u.next,u.next=n),l.interleaved=n,Sc(r,o)}function Ly(r,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194240)!==0)){var l=n.lanes;l&=r.pendingLanes,o|=l,n.lanes=o,yA(r,o)}}function U3(r,n){var o=r.updateQueue,l=r.alternate;if(l!==null&&(l=l.updateQueue,o===l)){var u=null,m=null;if(o=o.firstBaseUpdate,o!==null){do{var g={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};m===null?u=m=g:m=m.next=g,o=o.next}while(o!==null);m===null?u=m=n:m=m.next=n}else u=m=n;o={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:m,shared:l.shared,effects:l.effects},r.updateQueue=o;return}r=o.lastBaseUpdate,r===null?o.firstBaseUpdate=n:r.next=n,o.lastBaseUpdate=n}function ux(r,n,o,l){var u=r.updateQueue;_l=!1;var m=u.firstBaseUpdate,g=u.lastBaseUpdate,E=u.shared.pending;if(E!==null){u.shared.pending=null;var y=E,x=y.next;y.next=null,g===null?m=x:g.next=x,g=y;var S=r.alternate;S!==null&&(S=S.updateQueue,E=S.lastBaseUpdate,E!==g&&(E===null?S.firstBaseUpdate=x:E.next=x,S.lastBaseUpdate=y))}if(m!==null){var C=u.baseState;g=0,S=x=y=null,E=m;do{var R=E.lane,M=E.eventTime;if((l&R)===R){S!==null&&(S=S.next={eventTime:M,lane:0,tag:E.tag,payload:E.payload,callback:E.callback,next:null});e:{var G=r,I=E;switch(R=n,M=o,I.tag){case 1:if(G=I.payload,typeof G=="function"){C=G.call(M,C,R);break e}C=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=I.payload,R=typeof G=="function"?G.call(M,C,R):G,R==null)break e;C=Cr({},C,R);break e;case 2:_l=!0}}E.callback!==null&&E.lane!==0&&(r.flags|=64,R=u.effects,R===null?u.effects=[E]:R.push(E))}else M={eventTime:M,lane:R,tag:E.tag,payload:E.payload,callback:E.callback,next:null},S===null?(x=S=M,y=C):S=S.next=M,g|=R;if(E=E.next,E===null){if(E=u.shared.pending,E===null)break;R=E,E=R.next,R.next=null,u.lastBaseUpdate=R,u.shared.pending=null}}while(!0);if(S===null&&(y=C),u.baseState=y,u.firstBaseUpdate=x,u.lastBaseUpdate=S,n=u.shared.interleaved,n!==null){u=n;do g|=u.lane,u=u.next;while(u!==n)}else m===null&&(u.shared.lanes=0);ou|=g,r.lanes=g,r.memoizedState=C}}function V3(r,n,o){if(r=n.effects,n.effects=null,r!==null)for(n=0;n<r.length;n++){var l=r[n],u=l.callback;if(u!==null){if(l.callback=null,l=o,typeof u!="function")throw Error(ot(191,u));u.call(l)}}}var qg={},Ho=Hl(qg),wg=Hl(qg),Sg=Hl(qg);function qd(r){if(r===qg)throw Error(ot(174));return r}function LA(r,n){switch(rr(Sg,n),rr(wg,r),rr(Ho,qg),r=n.nodeType,r){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:WN(null,"");break;default:r=r===8?n.parentNode:n,n=r.namespaceURI||null,r=r.tagName,n=WN(n,r)}lr(Ho),rr(Ho,n)}function Ap(){lr(Ho),lr(wg),lr(Sg)}function a8(r){qd(Sg.current);var n=qd(Ho.current),o=WN(n,r.type);n!==o&&(rr(wg,r),rr(Ho,o))}function MA(r){wg.current===r&&(lr(Ho),lr(wg))}var xr=Hl(0);function hx(r){for(var n=r;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break;for(;n.sibling===null;){if(n.return===null||n.return===r)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var HT=[];function FA(){for(var r=0;r<HT.length;r++)HT[r]._workInProgressVersionPrimary=null;HT.length=0}var My=Nc.ReactCurrentDispatcher,zT=Nc.ReactCurrentBatchConfig,au=0,wr=null,tn=null,un=null,px=!1,eg=!1,Cg=0,oue=0;function Dn(){throw Error(ot(321))}function UA(r,n){if(n===null)return!1;for(var o=0;o<n.length&&o<r.length;o++)if(!ho(r[o],n[o]))return!1;return!0}function VA(r,n,o,l,u,m){if(au=m,wr=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,My.current=r===null||r.memoizedState===null?uue:hue,r=o(l,u),eg){m=0;do{if(eg=!1,Cg=0,25<=m)throw Error(ot(301));m+=1,un=tn=null,n.updateQueue=null,My.current=pue,r=o(l,u)}while(eg)}if(My.current=mx,n=tn!==null&&tn.next!==null,au=0,un=tn=wr=null,px=!1,n)throw Error(ot(300));return r}function BA(){var r=Cg!==0;return Cg=0,r}function Fo(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return un===null?wr.memoizedState=un=r:un=un.next=r,un}function Ia(){if(tn===null){var r=wr.alternate;r=r!==null?r.memoizedState:null}else r=tn.next;var n=un===null?wr.memoizedState:un.next;if(n!==null)un=n,tn=r;else{if(r===null)throw Error(ot(310));tn=r,r={memoizedState:tn.memoizedState,baseState:tn.baseState,baseQueue:tn.baseQueue,queue:tn.queue,next:null},un===null?wr.memoizedState=un=r:un=un.next=r}return un}function Tg(r,n){return typeof n=="function"?n(r):n}function KT(r){var n=Ia(),o=n.queue;if(o===null)throw Error(ot(311));o.lastRenderedReducer=r;var l=tn,u=l.baseQueue,m=o.pending;if(m!==null){if(u!==null){var g=u.next;u.next=m.next,m.next=g}l.baseQueue=u=m,o.pending=null}if(u!==null){m=u.next,l=l.baseState;var E=g=null,y=null,x=m;do{var S=x.lane;if((au&S)===S)y!==null&&(y=y.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),l=x.hasEagerState?x.eagerState:r(l,x.action);else{var C={lane:S,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};y===null?(E=y=C,g=l):y=y.next=C,wr.lanes|=S,ou|=S}x=x.next}while(x!==null&&x!==m);y===null?g=l:y.next=E,ho(l,n.memoizedState)||(Ei=!0),n.memoizedState=l,n.baseState=g,n.baseQueue=y,o.lastRenderedState=l}if(r=o.interleaved,r!==null){u=r;do m=u.lane,wr.lanes|=m,ou|=m,u=u.next;while(u!==r)}else u===null&&(o.lanes=0);return[n.memoizedState,o.dispatch]}function qT(r){var n=Ia(),o=n.queue;if(o===null)throw Error(ot(311));o.lastRenderedReducer=r;var l=o.dispatch,u=o.pending,m=n.memoizedState;if(u!==null){o.pending=null;var g=u=u.next;do m=r(m,g.action),g=g.next;while(g!==u);ho(m,n.memoizedState)||(Ei=!0),n.memoizedState=m,n.baseQueue===null&&(n.baseState=m),o.lastRenderedState=m}return[m,l]}function o8(){}function c8(r,n){var o=wr,l=Ia(),u=n(),m=!ho(l.memoizedState,u);if(m&&(l.memoizedState=u,Ei=!0),l=l.queue,WA(u8.bind(null,o,l,r),[r]),l.getSnapshot!==n||m||un!==null&&un.memoizedState.tag&1){if(o.flags|=2048,Ng(9,d8.bind(null,o,l,u,n),void 0,null),hn===null)throw Error(ot(349));au&30||l8(o,n,u)}return u}function l8(r,n,o){r.flags|=16384,r={getSnapshot:n,value:o},n=wr.updateQueue,n===null?(n={lastEffect:null,stores:null},wr.updateQueue=n,n.stores=[r]):(o=n.stores,o===null?n.stores=[r]:o.push(r))}function d8(r,n,o,l){n.value=o,n.getSnapshot=l,h8(n)&&p8(r)}function u8(r,n,o){return o(function(){h8(n)&&p8(r)})}function h8(r){var n=r.getSnapshot;r=r.value;try{var o=n();return!ho(r,o)}catch{return!0}}function p8(r){var n=Sc(r,1);n!==null&&uo(n,r,1,-1)}function B3(r){var n=Fo();return typeof r=="function"&&(r=r()),n.memoizedState=n.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tg,lastRenderedState:r},n.queue=r,r=r.dispatch=due.bind(null,wr,r),[n.memoizedState,r]}function Ng(r,n,o,l){return r={tag:r,create:n,destroy:o,deps:l,next:null},n=wr.updateQueue,n===null?(n={lastEffect:null,stores:null},wr.updateQueue=n,n.lastEffect=r.next=r):(o=n.lastEffect,o===null?n.lastEffect=r.next=r:(l=o.next,o.next=r,r.next=l,n.lastEffect=r)),r}function m8(){return Ia().memoizedState}function Fy(r,n,o,l){var u=Fo();wr.flags|=r,u.memoizedState=Ng(1|n,o,void 0,l===void 0?null:l)}function Vx(r,n,o,l){var u=Ia();l=l===void 0?null:l;var m=void 0;if(tn!==null){var g=tn.memoizedState;if(m=g.destroy,l!==null&&UA(l,g.deps)){u.memoizedState=Ng(n,o,m,l);return}}wr.flags|=r,u.memoizedState=Ng(1|n,o,m,l)}function W3(r,n){return Fy(8390656,8,r,n)}function WA(r,n){return Vx(2048,8,r,n)}function f8(r,n){return Vx(4,2,r,n)}function g8(r,n){return Vx(4,4,r,n)}function _8(r,n){if(typeof n=="function")return r=r(),n(r),function(){n(null)};if(n!=null)return r=r(),n.current=r,function(){n.current=null}}function v8(r,n,o){return o=o!=null?o.concat([r]):null,Vx(4,4,_8.bind(null,n,r),o)}function GA(){}function E8(r,n){var o=Ia();n=n===void 0?null:n;var l=o.memoizedState;return l!==null&&n!==null&&UA(n,l[1])?l[0]:(o.memoizedState=[r,n],r)}function y8(r,n){var o=Ia();n=n===void 0?null:n;var l=o.memoizedState;return l!==null&&n!==null&&UA(n,l[1])?l[0]:(r=r(),o.memoizedState=[r,n],r)}function x8(r,n,o){return au&21?(ho(o,n)||(o=T9(),wr.lanes|=o,ou|=o,r.baseState=!0),n):(r.baseState&&(r.baseState=!1,Ei=!0),r.memoizedState=o)}function cue(r,n){var o=zs;zs=o!==0&&4>o?o:4,r(!0);var l=zT.transition;zT.transition={};try{r(!1),n()}finally{zs=o,zT.transition=l}}function b8(){return Ia().memoizedState}function lue(r,n,o){var l=Ll(r);if(o={lane:l,action:o,hasEagerState:!1,eagerState:null,next:null},w8(r))S8(n,o);else if(o=n8(r,n,o,l),o!==null){var u=$n();uo(o,r,l,u),C8(o,n,l)}}function due(r,n,o){var l=Ll(r),u={lane:l,action:o,hasEagerState:!1,eagerState:null,next:null};if(w8(r))S8(n,u);else{var m=r.alternate;if(r.lanes===0&&(m===null||m.lanes===0)&&(m=n.lastRenderedReducer,m!==null))try{var g=n.lastRenderedState,E=m(g,o);if(u.hasEagerState=!0,u.eagerState=E,ho(E,g)){var y=n.interleaved;y===null?(u.next=u,PA(n)):(u.next=y.next,y.next=u),n.interleaved=u;return}}catch{}finally{}o=n8(r,n,u,l),o!==null&&(u=$n(),uo(o,r,l,u),C8(o,n,l))}}function w8(r){var n=r.alternate;return r===wr||n!==null&&n===wr}function S8(r,n){eg=px=!0;var o=r.pending;o===null?n.next=n:(n.next=o.next,o.next=n),r.pending=n}function C8(r,n,o){if(o&4194240){var l=n.lanes;l&=r.pendingLanes,o|=l,n.lanes=o,yA(r,o)}}var mx={readContext:Aa,useCallback:Dn,useContext:Dn,useEffect:Dn,useImperativeHandle:Dn,useInsertionEffect:Dn,useLayoutEffect:Dn,useMemo:Dn,useReducer:Dn,useRef:Dn,useState:Dn,useDebugValue:Dn,useDeferredValue:Dn,useTransition:Dn,useMutableSource:Dn,useSyncExternalStore:Dn,useId:Dn,unstable_isNewReconciler:!1},uue={readContext:Aa,useCallback:function(r,n){return Fo().memoizedState=[r,n===void 0?null:n],r},useContext:Aa,useEffect:W3,useImperativeHandle:function(r,n,o){return o=o!=null?o.concat([r]):null,Fy(4194308,4,_8.bind(null,n,r),o)},useLayoutEffect:function(r,n){return Fy(4194308,4,r,n)},useInsertionEffect:function(r,n){return Fy(4,2,r,n)},useMemo:function(r,n){var o=Fo();return n=n===void 0?null:n,r=r(),o.memoizedState=[r,n],r},useReducer:function(r,n,o){var l=Fo();return n=o!==void 0?o(n):n,l.memoizedState=l.baseState=n,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:n},l.queue=r,r=r.dispatch=lue.bind(null,wr,r),[l.memoizedState,r]},useRef:function(r){var n=Fo();return r={current:r},n.memoizedState=r},useState:B3,useDebugValue:GA,useDeferredValue:function(r){return Fo().memoizedState=r},useTransition:function(){var r=B3(!1),n=r[0];return r=cue.bind(null,r[1]),Fo().memoizedState=r,[n,r]},useMutableSource:function(){},useSyncExternalStore:function(r,n,o){var l=wr,u=Fo();if(pr){if(o===void 0)throw Error(ot(407));o=o()}else{if(o=n(),hn===null)throw Error(ot(349));au&30||l8(l,n,o)}u.memoizedState=o;var m={value:o,getSnapshot:n};return u.queue=m,W3(u8.bind(null,l,m,r),[r]),l.flags|=2048,Ng(9,d8.bind(null,l,m,o,n),void 0,null),o},useId:function(){var r=Fo(),n=hn.identifierPrefix;if(pr){var o=yc,l=Ec;o=(l&~(1<<32-lo(l)-1)).toString(32)+o,n=":"+n+"R"+o,o=Cg++,0<o&&(n+="H"+o.toString(32)),n+=":"}else o=oue++,n=":"+n+"r"+o.toString(32)+":";return r.memoizedState=n},unstable_isNewReconciler:!1},hue={readContext:Aa,useCallback:E8,useContext:Aa,useEffect:WA,useImperativeHandle:v8,useInsertionEffect:f8,useLayoutEffect:g8,useMemo:y8,useReducer:KT,useRef:m8,useState:function(){return KT(Tg)},useDebugValue:GA,useDeferredValue:function(r){var n=Ia();return x8(n,tn.memoizedState,r)},useTransition:function(){var r=KT(Tg)[0],n=Ia().memoizedState;return[r,n]},useMutableSource:o8,useSyncExternalStore:c8,useId:b8,unstable_isNewReconciler:!1},pue={readContext:Aa,useCallback:E8,useContext:Aa,useEffect:WA,useImperativeHandle:v8,useInsertionEffect:f8,useLayoutEffect:g8,useMemo:y8,useReducer:qT,useRef:m8,useState:function(){return qT(Tg)},useDebugValue:GA,useDeferredValue:function(r){var n=Ia();return tn===null?n.memoizedState=r:x8(n,tn.memoizedState,r)},useTransition:function(){var r=qT(Tg)[0],n=Ia().memoizedState;return[r,n]},useMutableSource:o8,useSyncExternalStore:c8,useId:b8,unstable_isNewReconciler:!1};function to(r,n){if(r&&r.defaultProps){n=Cr({},n),r=r.defaultProps;for(var o in r)n[o]===void 0&&(n[o]=r[o]);return n}return n}function lR(r,n,o,l){n=r.memoizedState,o=o(l,n),o=o==null?n:Cr({},n,o),r.memoizedState=o,r.lanes===0&&(r.updateQueue.baseState=o)}var Bx={isMounted:function(r){return(r=r._reactInternals)?uu(r)===r:!1},enqueueSetState:function(r,n,o){r=r._reactInternals;var l=$n(),u=Ll(r),m=xc(l,u);m.payload=n,o!=null&&(m.callback=o),n=Pl(r,m,u),n!==null&&(uo(n,r,u,l),Ly(n,r,u))},enqueueReplaceState:function(r,n,o){r=r._reactInternals;var l=$n(),u=Ll(r),m=xc(l,u);m.tag=1,m.payload=n,o!=null&&(m.callback=o),n=Pl(r,m,u),n!==null&&(uo(n,r,u,l),Ly(n,r,u))},enqueueForceUpdate:function(r,n){r=r._reactInternals;var o=$n(),l=Ll(r),u=xc(o,l);u.tag=2,n!=null&&(u.callback=n),n=Pl(r,u,l),n!==null&&(uo(n,r,l,o),Ly(n,r,l))}};function G3(r,n,o,l,u,m,g){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(l,m,g):n.prototype&&n.prototype.isPureReactComponent?!Eg(o,l)||!Eg(u,m):!0}function T8(r,n,o){var l=!1,u=Vl,m=n.contextType;return typeof m=="object"&&m!==null?m=Aa(m):(u=wi(n)?nu:Fn.current,l=n.contextTypes,m=(l=l!=null)?Tp(r,u):Vl),n=new n(o,m),r.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Bx,r.stateNode=n,n._reactInternals=r,l&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=u,r.__reactInternalMemoizedMaskedChildContext=m),n}function H3(r,n,o,l){r=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,l),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,l),n.state!==r&&Bx.enqueueReplaceState(n,n.state,null)}function dR(r,n,o,l){var u=r.stateNode;u.props=o,u.state=r.memoizedState,u.refs={},kA(r);var m=n.contextType;typeof m=="object"&&m!==null?u.context=Aa(m):(m=wi(n)?nu:Fn.current,u.context=Tp(r,m)),u.state=r.memoizedState,m=n.getDerivedStateFromProps,typeof m=="function"&&(lR(r,n,m,o),u.state=r.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(n=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),n!==u.state&&Bx.enqueueReplaceState(u,u.state,null),ux(r,o,u,l),u.state=r.memoizedState),typeof u.componentDidMount=="function"&&(r.flags|=4194308)}function Ip(r,n){try{var o="",l=n;do o+=Ble(l),l=l.return;while(l);var u=o}catch(m){u=`
Error generating stack: `+m.message+`
`+m.stack}return{value:r,source:n,stack:u,digest:null}}function YT(r,n,o){return{value:r,source:null,stack:o??null,digest:n??null}}function uR(r,n){try{console.error(n.value)}catch(o){setTimeout(function(){throw o})}}var mue=typeof WeakMap=="function"?WeakMap:Map;function N8(r,n,o){o=xc(-1,o),o.tag=3,o.payload={element:null};var l=n.value;return o.callback=function(){gx||(gx=!0,xR=l),uR(r,n)},o}function R8(r,n,o){o=xc(-1,o),o.tag=3;var l=r.type.getDerivedStateFromError;if(typeof l=="function"){var u=n.value;o.payload=function(){return l(u)},o.callback=function(){uR(r,n)}}var m=r.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(o.callback=function(){uR(r,n),typeof l!="function"&&(kl===null?kl=new Set([this]):kl.add(this));var g=n.stack;this.componentDidCatch(n.value,{componentStack:g!==null?g:""})}),o}function z3(r,n,o){var l=r.pingCache;if(l===null){l=r.pingCache=new mue;var u=new Set;l.set(n,u)}else u=l.get(n),u===void 0&&(u=new Set,l.set(n,u));u.has(o)||(u.add(o),r=Rue.bind(null,r,n,o),n.then(r,r))}function K3(r){do{var n;if((n=r.tag===13)&&(n=r.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return r;r=r.return}while(r!==null);return null}function q3(r,n,o,l,u){return r.mode&1?(r.flags|=65536,r.lanes=u,r):(r===n?r.flags|=65536:(r.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(n=xc(-1,1),n.tag=2,Pl(o,n,1))),o.lanes|=1),r)}var fue=Nc.ReactCurrentOwner,Ei=!1;function Kn(r,n,o,l){n.child=r===null?r8(n,null,o,l):Rp(n,r.child,o,l)}function Y3(r,n,o,l,u){o=o.render;var m=n.ref;return hp(n,u),l=VA(r,n,o,l,m,u),o=BA(),r!==null&&!Ei?(n.updateQueue=r.updateQueue,n.flags&=-2053,r.lanes&=~u,Cc(r,n,u)):(pr&&o&&RA(n),n.flags|=1,Kn(r,n,l,u),n.child)}function $3(r,n,o,l,u){if(r===null){var m=o.type;return typeof m=="function"&&!JA(m)&&m.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(n.tag=15,n.type=m,A8(r,n,m,l,u)):(r=Wy(o.type,null,l,n,n.mode,u),r.ref=n.ref,r.return=n,n.child=r)}if(m=r.child,!(r.lanes&u)){var g=m.memoizedProps;if(o=o.compare,o=o!==null?o:Eg,o(g,l)&&r.ref===n.ref)return Cc(r,n,u)}return n.flags|=1,r=Ml(m,l),r.ref=n.ref,r.return=n,n.child=r}function A8(r,n,o,l,u){if(r!==null){var m=r.memoizedProps;if(Eg(m,l)&&r.ref===n.ref)if(Ei=!1,n.pendingProps=l=m,(r.lanes&u)!==0)r.flags&131072&&(Ei=!0);else return n.lanes=r.lanes,Cc(r,n,u)}return hR(r,n,o,l,u)}function I8(r,n,o){var l=n.pendingProps,u=l.children,m=r!==null?r.memoizedState:null;if(l.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},rr(Zh,Gi),Gi|=o;else{if(!(o&1073741824))return r=m!==null?m.baseLanes|o:o,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:r,cachePool:null,transitions:null},n.updateQueue=null,rr(Zh,Gi),Gi|=r,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=m!==null?m.baseLanes:o,rr(Zh,Gi),Gi|=l}else m!==null?(l=m.baseLanes|o,n.memoizedState=null):l=o,rr(Zh,Gi),Gi|=l;return Kn(r,n,u,o),n.child}function D8(r,n){var o=n.ref;(r===null&&o!==null||r!==null&&r.ref!==o)&&(n.flags|=512,n.flags|=2097152)}function hR(r,n,o,l,u){var m=wi(o)?nu:Fn.current;return m=Tp(n,m),hp(n,u),o=VA(r,n,o,l,m,u),l=BA(),r!==null&&!Ei?(n.updateQueue=r.updateQueue,n.flags&=-2053,r.lanes&=~u,Cc(r,n,u)):(pr&&l&&RA(n),n.flags|=1,Kn(r,n,o,u),n.child)}function X3(r,n,o,l,u){if(wi(o)){var m=!0;ax(n)}else m=!1;if(hp(n,u),n.stateNode===null)Uy(r,n),T8(n,o,l),dR(n,o,l,u),l=!0;else if(r===null){var g=n.stateNode,E=n.memoizedProps;g.props=E;var y=g.context,x=o.contextType;typeof x=="object"&&x!==null?x=Aa(x):(x=wi(o)?nu:Fn.current,x=Tp(n,x));var S=o.getDerivedStateFromProps,C=typeof S=="function"||typeof g.getSnapshotBeforeUpdate=="function";C||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(E!==l||y!==x)&&H3(n,g,l,x),_l=!1;var R=n.memoizedState;g.state=R,ux(n,l,g,u),y=n.memoizedState,E!==l||R!==y||bi.current||_l?(typeof S=="function"&&(lR(n,o,S,l),y=n.memoizedState),(E=_l||G3(n,o,E,l,R,y,x))?(C||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(n.flags|=4194308)):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=l,n.memoizedState=y),g.props=l,g.state=y,g.context=x,l=E):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),l=!1)}else{g=n.stateNode,i8(r,n),E=n.memoizedProps,x=n.type===n.elementType?E:to(n.type,E),g.props=x,C=n.pendingProps,R=g.context,y=o.contextType,typeof y=="object"&&y!==null?y=Aa(y):(y=wi(o)?nu:Fn.current,y=Tp(n,y));var M=o.getDerivedStateFromProps;(S=typeof M=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(E!==C||R!==y)&&H3(n,g,l,y),_l=!1,R=n.memoizedState,g.state=R,ux(n,l,g,u);var G=n.memoizedState;E!==C||R!==G||bi.current||_l?(typeof M=="function"&&(lR(n,o,M,l),G=n.memoizedState),(x=_l||G3(n,o,x,l,R,G,y)||!1)?(S||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(l,G,y),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(l,G,y)),typeof g.componentDidUpdate=="function"&&(n.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof g.componentDidUpdate!="function"||E===r.memoizedProps&&R===r.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&R===r.memoizedState||(n.flags|=1024),n.memoizedProps=l,n.memoizedState=G),g.props=l,g.state=G,g.context=y,l=x):(typeof g.componentDidUpdate!="function"||E===r.memoizedProps&&R===r.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&R===r.memoizedState||(n.flags|=1024),l=!1)}return pR(r,n,o,l,m,u)}function pR(r,n,o,l,u,m){D8(r,n);var g=(n.flags&128)!==0;if(!l&&!g)return u&&k3(n,o,!1),Cc(r,n,m);l=n.stateNode,fue.current=n;var E=g&&typeof o.getDerivedStateFromError!="function"?null:l.render();return n.flags|=1,r!==null&&g?(n.child=Rp(n,r.child,null,m),n.child=Rp(n,null,E,m)):Kn(r,n,E,m),n.memoizedState=l.state,u&&k3(n,o,!0),n.child}function O8(r){var n=r.stateNode;n.pendingContext?P3(r,n.pendingContext,n.pendingContext!==n.context):n.context&&P3(r,n.context,!1),LA(r,n.containerInfo)}function J3(r,n,o,l,u){return Np(),IA(u),n.flags|=256,Kn(r,n,o,l),n.child}var mR={dehydrated:null,treeContext:null,retryLane:0};function fR(r){return{baseLanes:r,cachePool:null,transitions:null}}function j8(r,n,o){var l=n.pendingProps,u=xr.current,m=!1,g=(n.flags&128)!==0,E;if((E=g)||(E=r!==null&&r.memoizedState===null?!1:(u&2)!==0),E?(m=!0,n.flags&=-129):(r===null||r.memoizedState!==null)&&(u|=1),rr(xr,u&1),r===null)return oR(n),r=n.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(n.mode&1?r.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(g=l.children,r=l.fallback,m?(l=n.mode,m=n.child,g={mode:"hidden",children:g},!(l&1)&&m!==null?(m.childLanes=0,m.pendingProps=g):m=Hx(g,l,0,null),r=tu(r,l,o,null),m.return=n,r.return=n,m.sibling=r,n.child=m,n.child.memoizedState=fR(o),n.memoizedState=mR,r):HA(n,g));if(u=r.memoizedState,u!==null&&(E=u.dehydrated,E!==null))return gue(r,n,g,l,E,u,o);if(m){m=l.fallback,g=n.mode,u=r.child,E=u.sibling;var y={mode:"hidden",children:l.children};return!(g&1)&&n.child!==u?(l=n.child,l.childLanes=0,l.pendingProps=y,n.deletions=null):(l=Ml(u,y),l.subtreeFlags=u.subtreeFlags&14680064),E!==null?m=Ml(E,m):(m=tu(m,g,o,null),m.flags|=2),m.return=n,l.return=n,l.sibling=m,n.child=l,l=m,m=n.child,g=r.child.memoizedState,g=g===null?fR(o):{baseLanes:g.baseLanes|o,cachePool:null,transitions:g.transitions},m.memoizedState=g,m.childLanes=r.childLanes&~o,n.memoizedState=mR,l}return m=r.child,r=m.sibling,l=Ml(m,{mode:"visible",children:l.children}),!(n.mode&1)&&(l.lanes=o),l.return=n,l.sibling=null,r!==null&&(o=n.deletions,o===null?(n.deletions=[r],n.flags|=16):o.push(r)),n.child=l,n.memoizedState=null,l}function HA(r,n){return n=Hx({mode:"visible",children:n},r.mode,0,null),n.return=r,r.child=n}function fy(r,n,o,l){return l!==null&&IA(l),Rp(n,r.child,null,o),r=HA(n,n.pendingProps.children),r.flags|=2,n.memoizedState=null,r}function gue(r,n,o,l,u,m,g){if(o)return n.flags&256?(n.flags&=-257,l=YT(Error(ot(422))),fy(r,n,g,l)):n.memoizedState!==null?(n.child=r.child,n.flags|=128,null):(m=l.fallback,u=n.mode,l=Hx({mode:"visible",children:l.children},u,0,null),m=tu(m,u,g,null),m.flags|=2,l.return=n,m.return=n,l.sibling=m,n.child=l,n.mode&1&&Rp(n,r.child,null,g),n.child.memoizedState=fR(g),n.memoizedState=mR,m);if(!(n.mode&1))return fy(r,n,g,null);if(u.data==="$!"){if(l=u.nextSibling&&u.nextSibling.dataset,l)var E=l.dgst;return l=E,m=Error(ot(419)),l=YT(m,l,void 0),fy(r,n,g,l)}if(E=(g&r.childLanes)!==0,Ei||E){if(l=hn,l!==null){switch(g&-g){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(l.suspendedLanes|g)?0:u,u!==0&&u!==m.retryLane&&(m.retryLane=u,Sc(r,u),uo(l,r,u,-1))}return XA(),l=YT(Error(ot(421))),fy(r,n,g,l)}return u.data==="$?"?(n.flags|=128,n.child=r.child,n=Aue.bind(null,r),u._reactRetry=n,null):(r=m.treeContext,Hi=jl(u.nextSibling),zi=n,pr=!0,ao=null,r!==null&&(ba[wa++]=Ec,ba[wa++]=yc,ba[wa++]=iu,Ec=r.id,yc=r.overflow,iu=n),n=HA(n,l.children),n.flags|=4096,n)}function Q3(r,n,o){r.lanes|=n;var l=r.alternate;l!==null&&(l.lanes|=n),cR(r.return,n,o)}function $T(r,n,o,l,u){var m=r.memoizedState;m===null?r.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:l,tail:o,tailMode:u}:(m.isBackwards=n,m.rendering=null,m.renderingStartTime=0,m.last=l,m.tail=o,m.tailMode=u)}function P8(r,n,o){var l=n.pendingProps,u=l.revealOrder,m=l.tail;if(Kn(r,n,l.children,o),l=xr.current,l&2)l=l&1|2,n.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=n.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Q3(r,o,n);else if(r.tag===19)Q3(r,o,n);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break e;for(;r.sibling===null;){if(r.return===null||r.return===n)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}l&=1}if(rr(xr,l),!(n.mode&1))n.memoizedState=null;else switch(u){case"forwards":for(o=n.child,u=null;o!==null;)r=o.alternate,r!==null&&hx(r)===null&&(u=o),o=o.sibling;o=u,o===null?(u=n.child,n.child=null):(u=o.sibling,o.sibling=null),$T(n,!1,u,o,m);break;case"backwards":for(o=null,u=n.child,n.child=null;u!==null;){if(r=u.alternate,r!==null&&hx(r)===null){n.child=u;break}r=u.sibling,u.sibling=o,o=u,u=r}$T(n,!0,o,null,m);break;case"together":$T(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Uy(r,n){!(n.mode&1)&&r!==null&&(r.alternate=null,n.alternate=null,n.flags|=2)}function Cc(r,n,o){if(r!==null&&(n.dependencies=r.dependencies),ou|=n.lanes,!(o&n.childLanes))return null;if(r!==null&&n.child!==r.child)throw Error(ot(153));if(n.child!==null){for(r=n.child,o=Ml(r,r.pendingProps),n.child=o,o.return=n;r.sibling!==null;)r=r.sibling,o=o.sibling=Ml(r,r.pendingProps),o.return=n;o.sibling=null}return n.child}function _ue(r,n,o){switch(n.tag){case 3:O8(n),Np();break;case 5:a8(n);break;case 1:wi(n.type)&&ax(n);break;case 4:LA(n,n.stateNode.containerInfo);break;case 10:var l=n.type._context,u=n.memoizedProps.value;rr(lx,l._currentValue),l._currentValue=u;break;case 13:if(l=n.memoizedState,l!==null)return l.dehydrated!==null?(rr(xr,xr.current&1),n.flags|=128,null):o&n.child.childLanes?j8(r,n,o):(rr(xr,xr.current&1),r=Cc(r,n,o),r!==null?r.sibling:null);rr(xr,xr.current&1);break;case 19:if(l=(o&n.childLanes)!==0,r.flags&128){if(l)return P8(r,n,o);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),rr(xr,xr.current),l)break;return null;case 22:case 23:return n.lanes=0,I8(r,n,o)}return Cc(r,n,o)}var k8,gR,L8,M8;k8=function(r,n){for(var o=n.child;o!==null;){if(o.tag===5||o.tag===6)r.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};gR=function(){};L8=function(r,n,o,l){var u=r.memoizedProps;if(u!==l){r=n.stateNode,qd(Ho.current);var m=null;switch(o){case"input":u=FN(r,u),l=FN(r,l),m=[];break;case"select":u=Cr({},u,{value:void 0}),l=Cr({},l,{value:void 0}),m=[];break;case"textarea":u=BN(r,u),l=BN(r,l),m=[];break;default:typeof u.onClick!="function"&&typeof l.onClick=="function"&&(r.onclick=nx)}GN(o,l);var g;o=null;for(x in u)if(!l.hasOwnProperty(x)&&u.hasOwnProperty(x)&&u[x]!=null)if(x==="style"){var E=u[x];for(g in E)E.hasOwnProperty(g)&&(o||(o={}),o[g]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(hg.hasOwnProperty(x)?m||(m=[]):(m=m||[]).push(x,null));for(x in l){var y=l[x];if(E=u!=null?u[x]:void 0,l.hasOwnProperty(x)&&y!==E&&(y!=null||E!=null))if(x==="style")if(E){for(g in E)!E.hasOwnProperty(g)||y&&y.hasOwnProperty(g)||(o||(o={}),o[g]="");for(g in y)y.hasOwnProperty(g)&&E[g]!==y[g]&&(o||(o={}),o[g]=y[g])}else o||(m||(m=[]),m.push(x,o)),o=y;else x==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,E=E?E.__html:void 0,y!=null&&E!==y&&(m=m||[]).push(x,y)):x==="children"?typeof y!="string"&&typeof y!="number"||(m=m||[]).push(x,""+y):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(hg.hasOwnProperty(x)?(y!=null&&x==="onScroll"&&cr("scroll",r),m||E===y||(m=[])):(m=m||[]).push(x,y))}o&&(m=m||[]).push("style",o);var x=m;(n.updateQueue=x)&&(n.flags|=4)}};M8=function(r,n,o,l){o!==l&&(n.flags|=4)};function jf(r,n){if(!pr)switch(r.tailMode){case"hidden":n=r.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?r.tail=null:o.sibling=null;break;case"collapsed":o=r.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?n||r.tail===null?r.tail=null:r.tail.sibling=null:l.sibling=null}}function On(r){var n=r.alternate!==null&&r.alternate.child===r.child,o=0,l=0;if(n)for(var u=r.child;u!==null;)o|=u.lanes|u.childLanes,l|=u.subtreeFlags&14680064,l|=u.flags&14680064,u.return=r,u=u.sibling;else for(u=r.child;u!==null;)o|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=r,u=u.sibling;return r.subtreeFlags|=l,r.childLanes=o,n}function vue(r,n,o){var l=n.pendingProps;switch(AA(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return On(n),null;case 1:return wi(n.type)&&ix(),On(n),null;case 3:return l=n.stateNode,Ap(),lr(bi),lr(Fn),FA(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(r===null||r.child===null)&&(py(n)?n.flags|=4:r===null||r.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,ao!==null&&(SR(ao),ao=null))),gR(r,n),On(n),null;case 5:MA(n);var u=qd(Sg.current);if(o=n.type,r!==null&&n.stateNode!=null)L8(r,n,o,l,u),r.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!l){if(n.stateNode===null)throw Error(ot(166));return On(n),null}if(r=qd(Ho.current),py(n)){l=n.stateNode,o=n.type;var m=n.memoizedProps;switch(l[Wo]=n,l[bg]=m,r=(n.mode&1)!==0,o){case"dialog":cr("cancel",l),cr("close",l);break;case"iframe":case"object":case"embed":cr("load",l);break;case"video":case"audio":for(u=0;u<zf.length;u++)cr(zf[u],l);break;case"source":cr("error",l);break;case"img":case"image":case"link":cr("error",l),cr("load",l);break;case"details":cr("toggle",l);break;case"input":o3(l,m),cr("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!m.multiple},cr("invalid",l);break;case"textarea":l3(l,m),cr("invalid",l)}GN(o,m),u=null;for(var g in m)if(m.hasOwnProperty(g)){var E=m[g];g==="children"?typeof E=="string"?l.textContent!==E&&(m.suppressHydrationWarning!==!0&&hy(l.textContent,E,r),u=["children",E]):typeof E=="number"&&l.textContent!==""+E&&(m.suppressHydrationWarning!==!0&&hy(l.textContent,E,r),u=["children",""+E]):hg.hasOwnProperty(g)&&E!=null&&g==="onScroll"&&cr("scroll",l)}switch(o){case"input":ny(l),c3(l,m,!0);break;case"textarea":ny(l),d3(l);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(l.onclick=nx)}l=u,n.updateQueue=l,l!==null&&(n.flags|=4)}else{g=u.nodeType===9?u:u.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=u9(o)),r==="http://www.w3.org/1999/xhtml"?o==="script"?(r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof l.is=="string"?r=g.createElement(o,{is:l.is}):(r=g.createElement(o),o==="select"&&(g=r,l.multiple?g.multiple=!0:l.size&&(g.size=l.size))):r=g.createElementNS(r,o),r[Wo]=n,r[bg]=l,k8(r,n,!1,!1),n.stateNode=r;e:{switch(g=HN(o,l),o){case"dialog":cr("cancel",r),cr("close",r),u=l;break;case"iframe":case"object":case"embed":cr("load",r),u=l;break;case"video":case"audio":for(u=0;u<zf.length;u++)cr(zf[u],r);u=l;break;case"source":cr("error",r),u=l;break;case"img":case"image":case"link":cr("error",r),cr("load",r),u=l;break;case"details":cr("toggle",r),u=l;break;case"input":o3(r,l),u=FN(r,l),cr("invalid",r);break;case"option":u=l;break;case"select":r._wrapperState={wasMultiple:!!l.multiple},u=Cr({},l,{value:void 0}),cr("invalid",r);break;case"textarea":l3(r,l),u=BN(r,l),cr("invalid",r);break;default:u=l}GN(o,u),E=u;for(m in E)if(E.hasOwnProperty(m)){var y=E[m];m==="style"?m9(r,y):m==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&h9(r,y)):m==="children"?typeof y=="string"?(o!=="textarea"||y!=="")&&pg(r,y):typeof y=="number"&&pg(r,""+y):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(hg.hasOwnProperty(m)?y!=null&&m==="onScroll"&&cr("scroll",r):y!=null&&mA(r,m,y,g))}switch(o){case"input":ny(r),c3(r,l,!1);break;case"textarea":ny(r),d3(r);break;case"option":l.value!=null&&r.setAttribute("value",""+Ul(l.value));break;case"select":r.multiple=!!l.multiple,m=l.value,m!=null?cp(r,!!l.multiple,m,!1):l.defaultValue!=null&&cp(r,!!l.multiple,l.defaultValue,!0);break;default:typeof u.onClick=="function"&&(r.onclick=nx)}switch(o){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return On(n),null;case 6:if(r&&n.stateNode!=null)M8(r,n,r.memoizedProps,l);else{if(typeof l!="string"&&n.stateNode===null)throw Error(ot(166));if(o=qd(Sg.current),qd(Ho.current),py(n)){if(l=n.stateNode,o=n.memoizedProps,l[Wo]=n,(m=l.nodeValue!==o)&&(r=zi,r!==null))switch(r.tag){case 3:hy(l.nodeValue,o,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&hy(l.nodeValue,o,(r.mode&1)!==0)}m&&(n.flags|=4)}else l=(o.nodeType===9?o:o.ownerDocument).createTextNode(l),l[Wo]=n,n.stateNode=l}return On(n),null;case 13:if(lr(xr),l=n.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(pr&&Hi!==null&&n.mode&1&&!(n.flags&128))t8(),Np(),n.flags|=98560,m=!1;else if(m=py(n),l!==null&&l.dehydrated!==null){if(r===null){if(!m)throw Error(ot(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(ot(317));m[Wo]=n}else Np(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;On(n),m=!1}else ao!==null&&(SR(ao),ao=null),m=!0;if(!m)return n.flags&65536?n:null}return n.flags&128?(n.lanes=o,n):(l=l!==null,l!==(r!==null&&r.memoizedState!==null)&&l&&(n.child.flags|=8192,n.mode&1&&(r===null||xr.current&1?sn===0&&(sn=3):XA())),n.updateQueue!==null&&(n.flags|=4),On(n),null);case 4:return Ap(),gR(r,n),r===null&&yg(n.stateNode.containerInfo),On(n),null;case 10:return jA(n.type._context),On(n),null;case 17:return wi(n.type)&&ix(),On(n),null;case 19:if(lr(xr),m=n.memoizedState,m===null)return On(n),null;if(l=(n.flags&128)!==0,g=m.rendering,g===null)if(l)jf(m,!1);else{if(sn!==0||r!==null&&r.flags&128)for(r=n.child;r!==null;){if(g=hx(r),g!==null){for(n.flags|=128,jf(m,!1),l=g.updateQueue,l!==null&&(n.updateQueue=l,n.flags|=4),n.subtreeFlags=0,l=o,o=n.child;o!==null;)m=o,r=l,m.flags&=14680066,g=m.alternate,g===null?(m.childLanes=0,m.lanes=r,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=g.childLanes,m.lanes=g.lanes,m.child=g.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=g.memoizedProps,m.memoizedState=g.memoizedState,m.updateQueue=g.updateQueue,m.type=g.type,r=g.dependencies,m.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),o=o.sibling;return rr(xr,xr.current&1|2),n.child}r=r.sibling}m.tail!==null&&Br()>Dp&&(n.flags|=128,l=!0,jf(m,!1),n.lanes=4194304)}else{if(!l)if(r=hx(g),r!==null){if(n.flags|=128,l=!0,o=r.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),jf(m,!0),m.tail===null&&m.tailMode==="hidden"&&!g.alternate&&!pr)return On(n),null}else 2*Br()-m.renderingStartTime>Dp&&o!==1073741824&&(n.flags|=128,l=!0,jf(m,!1),n.lanes=4194304);m.isBackwards?(g.sibling=n.child,n.child=g):(o=m.last,o!==null?o.sibling=g:n.child=g,m.last=g)}return m.tail!==null?(n=m.tail,m.rendering=n,m.tail=n.sibling,m.renderingStartTime=Br(),n.sibling=null,o=xr.current,rr(xr,l?o&1|2:o&1),n):(On(n),null);case 22:case 23:return $A(),l=n.memoizedState!==null,r!==null&&r.memoizedState!==null!==l&&(n.flags|=8192),l&&n.mode&1?Gi&1073741824&&(On(n),n.subtreeFlags&6&&(n.flags|=8192)):On(n),null;case 24:return null;case 25:return null}throw Error(ot(156,n.tag))}function Eue(r,n){switch(AA(n),n.tag){case 1:return wi(n.type)&&ix(),r=n.flags,r&65536?(n.flags=r&-65537|128,n):null;case 3:return Ap(),lr(bi),lr(Fn),FA(),r=n.flags,r&65536&&!(r&128)?(n.flags=r&-65537|128,n):null;case 5:return MA(n),null;case 13:if(lr(xr),r=n.memoizedState,r!==null&&r.dehydrated!==null){if(n.alternate===null)throw Error(ot(340));Np()}return r=n.flags,r&65536?(n.flags=r&-65537|128,n):null;case 19:return lr(xr),null;case 4:return Ap(),null;case 10:return jA(n.type._context),null;case 22:case 23:return $A(),null;case 24:return null;default:return null}}var gy=!1,kn=!1,yue=typeof WeakSet=="function"?WeakSet:Set,St=null;function Qh(r,n){var o=r.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(l){jr(r,n,l)}else o.current=null}function _R(r,n,o){try{o()}catch(l){jr(r,n,l)}}var Z3=!1;function xue(r,n){if(eR=tx,r=W9(),NA(r)){if("selectionStart"in r)var o={start:r.selectionStart,end:r.selectionEnd};else e:{o=(o=r.ownerDocument)&&o.defaultView||window;var l=o.getSelection&&o.getSelection();if(l&&l.rangeCount!==0){o=l.anchorNode;var u=l.anchorOffset,m=l.focusNode;l=l.focusOffset;try{o.nodeType,m.nodeType}catch{o=null;break e}var g=0,E=-1,y=-1,x=0,S=0,C=r,R=null;t:for(;;){for(var M;C!==o||u!==0&&C.nodeType!==3||(E=g+u),C!==m||l!==0&&C.nodeType!==3||(y=g+l),C.nodeType===3&&(g+=C.nodeValue.length),(M=C.firstChild)!==null;)R=C,C=M;for(;;){if(C===r)break t;if(R===o&&++x===u&&(E=g),R===m&&++S===l&&(y=g),(M=C.nextSibling)!==null)break;C=R,R=C.parentNode}C=M}o=E===-1||y===-1?null:{start:E,end:y}}else o=null}o=o||{start:0,end:0}}else o=null;for(tR={focusedElem:r,selectionRange:o},tx=!1,St=n;St!==null;)if(n=St,r=n.child,(n.subtreeFlags&1028)!==0&&r!==null)r.return=n,St=r;else for(;St!==null;){n=St;try{var G=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var I=G.memoizedProps,j=G.memoizedState,L=n.stateNode,N=L.getSnapshotBeforeUpdate(n.elementType===n.type?I:to(n.type,I),j);L.__reactInternalSnapshotBeforeUpdate=N}break;case 3:var D=n.stateNode.containerInfo;D.nodeType===1?D.textContent="":D.nodeType===9&&D.documentElement&&D.removeChild(D.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ot(163))}}catch(V){jr(n,n.return,V)}if(r=n.sibling,r!==null){r.return=n.return,St=r;break}St=n.return}return G=Z3,Z3=!1,G}function tg(r,n,o){var l=n.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var u=l=l.next;do{if((u.tag&r)===r){var m=u.destroy;u.destroy=void 0,m!==void 0&&_R(n,o,m)}u=u.next}while(u!==l)}}function Wx(r,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&r)===r){var l=o.create;o.destroy=l()}o=o.next}while(o!==n)}}function vR(r){var n=r.ref;if(n!==null){var o=r.stateNode;switch(r.tag){case 5:r=o;break;default:r=o}typeof n=="function"?n(r):n.current=r}}function F8(r){var n=r.alternate;n!==null&&(r.alternate=null,F8(n)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(n=r.stateNode,n!==null&&(delete n[Wo],delete n[bg],delete n[nR],delete n[rue],delete n[nue])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function U8(r){return r.tag===5||r.tag===3||r.tag===4}function eB(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||U8(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function ER(r,n,o){var l=r.tag;if(l===5||l===6)r=r.stateNode,n?o.nodeType===8?o.parentNode.insertBefore(r,n):o.insertBefore(r,n):(o.nodeType===8?(n=o.parentNode,n.insertBefore(r,o)):(n=o,n.appendChild(r)),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=nx));else if(l!==4&&(r=r.child,r!==null))for(ER(r,n,o),r=r.sibling;r!==null;)ER(r,n,o),r=r.sibling}function yR(r,n,o){var l=r.tag;if(l===5||l===6)r=r.stateNode,n?o.insertBefore(r,n):o.appendChild(r);else if(l!==4&&(r=r.child,r!==null))for(yR(r,n,o),r=r.sibling;r!==null;)yR(r,n,o),r=r.sibling}var vn=null,no=!1;function ll(r,n,o){for(o=o.child;o!==null;)V8(r,n,o),o=o.sibling}function V8(r,n,o){if(Go&&typeof Go.onCommitFiberUnmount=="function")try{Go.onCommitFiberUnmount(Px,o)}catch{}switch(o.tag){case 5:kn||Qh(o,n);case 6:var l=vn,u=no;vn=null,ll(r,n,o),vn=l,no=u,vn!==null&&(no?(r=vn,o=o.stateNode,r.nodeType===8?r.parentNode.removeChild(o):r.removeChild(o)):vn.removeChild(o.stateNode));break;case 18:vn!==null&&(no?(r=vn,o=o.stateNode,r.nodeType===8?WT(r.parentNode,o):r.nodeType===1&&WT(r,o),_g(r)):WT(vn,o.stateNode));break;case 4:l=vn,u=no,vn=o.stateNode.containerInfo,no=!0,ll(r,n,o),vn=l,no=u;break;case 0:case 11:case 14:case 15:if(!kn&&(l=o.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){u=l=l.next;do{var m=u,g=m.destroy;m=m.tag,g!==void 0&&(m&2||m&4)&&_R(o,n,g),u=u.next}while(u!==l)}ll(r,n,o);break;case 1:if(!kn&&(Qh(o,n),l=o.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=o.memoizedProps,l.state=o.memoizedState,l.componentWillUnmount()}catch(E){jr(o,n,E)}ll(r,n,o);break;case 21:ll(r,n,o);break;case 22:o.mode&1?(kn=(l=kn)||o.memoizedState!==null,ll(r,n,o),kn=l):ll(r,n,o);break;default:ll(r,n,o)}}function tB(r){var n=r.updateQueue;if(n!==null){r.updateQueue=null;var o=r.stateNode;o===null&&(o=r.stateNode=new yue),n.forEach(function(l){var u=Iue.bind(null,r,l);o.has(l)||(o.add(l),l.then(u,u))})}}function Qa(r,n){var o=n.deletions;if(o!==null)for(var l=0;l<o.length;l++){var u=o[l];try{var m=r,g=n,E=g;e:for(;E!==null;){switch(E.tag){case 5:vn=E.stateNode,no=!1;break e;case 3:vn=E.stateNode.containerInfo,no=!0;break e;case 4:vn=E.stateNode.containerInfo,no=!0;break e}E=E.return}if(vn===null)throw Error(ot(160));V8(m,g,u),vn=null,no=!1;var y=u.alternate;y!==null&&(y.return=null),u.return=null}catch(x){jr(u,n,x)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)B8(n,r),n=n.sibling}function B8(r,n){var o=r.alternate,l=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Qa(n,r),Lo(r),l&4){try{tg(3,r,r.return),Wx(3,r)}catch(I){jr(r,r.return,I)}try{tg(5,r,r.return)}catch(I){jr(r,r.return,I)}}break;case 1:Qa(n,r),Lo(r),l&512&&o!==null&&Qh(o,o.return);break;case 5:if(Qa(n,r),Lo(r),l&512&&o!==null&&Qh(o,o.return),r.flags&32){var u=r.stateNode;try{pg(u,"")}catch(I){jr(r,r.return,I)}}if(l&4&&(u=r.stateNode,u!=null)){var m=r.memoizedProps,g=o!==null?o.memoizedProps:m,E=r.type,y=r.updateQueue;if(r.updateQueue=null,y!==null)try{E==="input"&&m.type==="radio"&&m.name!=null&&l9(u,m),HN(E,g);var x=HN(E,m);for(g=0;g<y.length;g+=2){var S=y[g],C=y[g+1];S==="style"?m9(u,C):S==="dangerouslySetInnerHTML"?h9(u,C):S==="children"?pg(u,C):mA(u,S,C,x)}switch(E){case"input":UN(u,m);break;case"textarea":d9(u,m);break;case"select":var R=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!m.multiple;var M=m.value;M!=null?cp(u,!!m.multiple,M,!1):R!==!!m.multiple&&(m.defaultValue!=null?cp(u,!!m.multiple,m.defaultValue,!0):cp(u,!!m.multiple,m.multiple?[]:"",!1))}u[bg]=m}catch(I){jr(r,r.return,I)}}break;case 6:if(Qa(n,r),Lo(r),l&4){if(r.stateNode===null)throw Error(ot(162));u=r.stateNode,m=r.memoizedProps;try{u.nodeValue=m}catch(I){jr(r,r.return,I)}}break;case 3:if(Qa(n,r),Lo(r),l&4&&o!==null&&o.memoizedState.isDehydrated)try{_g(n.containerInfo)}catch(I){jr(r,r.return,I)}break;case 4:Qa(n,r),Lo(r);break;case 13:Qa(n,r),Lo(r),u=r.child,u.flags&8192&&(m=u.memoizedState!==null,u.stateNode.isHidden=m,!m||u.alternate!==null&&u.alternate.memoizedState!==null||(qA=Br())),l&4&&tB(r);break;case 22:if(S=o!==null&&o.memoizedState!==null,r.mode&1?(kn=(x=kn)||S,Qa(n,r),kn=x):Qa(n,r),Lo(r),l&8192){if(x=r.memoizedState!==null,(r.stateNode.isHidden=x)&&!S&&r.mode&1)for(St=r,S=r.child;S!==null;){for(C=St=S;St!==null;){switch(R=St,M=R.child,R.tag){case 0:case 11:case 14:case 15:tg(4,R,R.return);break;case 1:Qh(R,R.return);var G=R.stateNode;if(typeof G.componentWillUnmount=="function"){l=R,o=R.return;try{n=l,G.props=n.memoizedProps,G.state=n.memoizedState,G.componentWillUnmount()}catch(I){jr(l,o,I)}}break;case 5:Qh(R,R.return);break;case 22:if(R.memoizedState!==null){rB(C);continue}}M!==null?(M.return=R,St=M):rB(C)}S=S.sibling}e:for(S=null,C=r;;){if(C.tag===5){if(S===null){S=C;try{u=C.stateNode,x?(m=u.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(E=C.stateNode,y=C.memoizedProps.style,g=y!=null&&y.hasOwnProperty("display")?y.display:null,E.style.display=p9("display",g))}catch(I){jr(r,r.return,I)}}}else if(C.tag===6){if(S===null)try{C.stateNode.nodeValue=x?"":C.memoizedProps}catch(I){jr(r,r.return,I)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===r)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===r)break e;for(;C.sibling===null;){if(C.return===null||C.return===r)break e;S===C&&(S=null),C=C.return}S===C&&(S=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Qa(n,r),Lo(r),l&4&&tB(r);break;case 21:break;default:Qa(n,r),Lo(r)}}function Lo(r){var n=r.flags;if(n&2){try{e:{for(var o=r.return;o!==null;){if(U8(o)){var l=o;break e}o=o.return}throw Error(ot(160))}switch(l.tag){case 5:var u=l.stateNode;l.flags&32&&(pg(u,""),l.flags&=-33);var m=eB(r);yR(r,m,u);break;case 3:case 4:var g=l.stateNode.containerInfo,E=eB(r);ER(r,E,g);break;default:throw Error(ot(161))}}catch(y){jr(r,r.return,y)}r.flags&=-3}n&4096&&(r.flags&=-4097)}function bue(r,n,o){St=r,W8(r)}function W8(r,n,o){for(var l=(r.mode&1)!==0;St!==null;){var u=St,m=u.child;if(u.tag===22&&l){var g=u.memoizedState!==null||gy;if(!g){var E=u.alternate,y=E!==null&&E.memoizedState!==null||kn;E=gy;var x=kn;if(gy=g,(kn=y)&&!x)for(St=u;St!==null;)g=St,y=g.child,g.tag===22&&g.memoizedState!==null?nB(u):y!==null?(y.return=g,St=y):nB(u);for(;m!==null;)St=m,W8(m),m=m.sibling;St=u,gy=E,kn=x}sB(r)}else u.subtreeFlags&8772&&m!==null?(m.return=u,St=m):sB(r)}}function sB(r){for(;St!==null;){var n=St;if(n.flags&8772){var o=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:kn||Wx(5,n);break;case 1:var l=n.stateNode;if(n.flags&4&&!kn)if(o===null)l.componentDidMount();else{var u=n.elementType===n.type?o.memoizedProps:to(n.type,o.memoizedProps);l.componentDidUpdate(u,o.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var m=n.updateQueue;m!==null&&V3(n,m,l);break;case 3:var g=n.updateQueue;if(g!==null){if(o=null,n.child!==null)switch(n.child.tag){case 5:o=n.child.stateNode;break;case 1:o=n.child.stateNode}V3(n,g,o)}break;case 5:var E=n.stateNode;if(o===null&&n.flags&4){o=E;var y=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&o.focus();break;case"img":y.src&&(o.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var x=n.alternate;if(x!==null){var S=x.memoizedState;if(S!==null){var C=S.dehydrated;C!==null&&_g(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ot(163))}kn||n.flags&512&&vR(n)}catch(R){jr(n,n.return,R)}}if(n===r){St=null;break}if(o=n.sibling,o!==null){o.return=n.return,St=o;break}St=n.return}}function rB(r){for(;St!==null;){var n=St;if(n===r){St=null;break}var o=n.sibling;if(o!==null){o.return=n.return,St=o;break}St=n.return}}function nB(r){for(;St!==null;){var n=St;try{switch(n.tag){case 0:case 11:case 15:var o=n.return;try{Wx(4,n)}catch(y){jr(n,o,y)}break;case 1:var l=n.stateNode;if(typeof l.componentDidMount=="function"){var u=n.return;try{l.componentDidMount()}catch(y){jr(n,u,y)}}var m=n.return;try{vR(n)}catch(y){jr(n,m,y)}break;case 5:var g=n.return;try{vR(n)}catch(y){jr(n,g,y)}}}catch(y){jr(n,n.return,y)}if(n===r){St=null;break}var E=n.sibling;if(E!==null){E.return=n.return,St=E;break}St=n.return}}var wue=Math.ceil,fx=Nc.ReactCurrentDispatcher,zA=Nc.ReactCurrentOwner,Na=Nc.ReactCurrentBatchConfig,Ds=0,hn=null,Yr=null,En=0,Gi=0,Zh=Hl(0),sn=0,Rg=null,ou=0,Gx=0,KA=0,sg=null,vi=null,qA=0,Dp=1/0,gc=null,gx=!1,xR=null,kl=null,_y=!1,Rl=null,_x=0,rg=0,bR=null,Vy=-1,By=0;function $n(){return Ds&6?Br():Vy!==-1?Vy:Vy=Br()}function Ll(r){return r.mode&1?Ds&2&&En!==0?En&-En:aue.transition!==null?(By===0&&(By=T9()),By):(r=zs,r!==0||(r=window.event,r=r===void 0?16:j9(r.type)),r):1}function uo(r,n,o,l){if(50<rg)throw rg=0,bR=null,Error(ot(185));Hg(r,o,l),(!(Ds&2)||r!==hn)&&(r===hn&&(!(Ds&2)&&(Gx|=o),sn===4&&yl(r,En)),Si(r,l),o===1&&Ds===0&&!(n.mode&1)&&(Dp=Br()+500,Ux&&zl()))}function Si(r,n){var o=r.callbackNode;ade(r,n);var l=ex(r,r===hn?En:0);if(l===0)o!==null&&p3(o),r.callbackNode=null,r.callbackPriority=0;else if(n=l&-l,r.callbackPriority!==n){if(o!=null&&p3(o),n===1)r.tag===0?iue(iB.bind(null,r)):Q9(iB.bind(null,r)),tue(function(){!(Ds&6)&&zl()}),o=null;else{switch(N9(l)){case 1:o=EA;break;case 4:o=S9;break;case 16:o=Zy;break;case 536870912:o=C9;break;default:o=Zy}o=X8(o,G8.bind(null,r))}r.callbackPriority=n,r.callbackNode=o}}function G8(r,n){if(Vy=-1,By=0,Ds&6)throw Error(ot(327));var o=r.callbackNode;if(pp()&&r.callbackNode!==o)return null;var l=ex(r,r===hn?En:0);if(l===0)return null;if(l&30||l&r.expiredLanes||n)n=vx(r,l);else{n=l;var u=Ds;Ds|=2;var m=z8();(hn!==r||En!==n)&&(gc=null,Dp=Br()+500,eu(r,n));do try{Tue();break}catch(E){H8(r,E)}while(!0);OA(),fx.current=m,Ds=u,Yr!==null?n=0:(hn=null,En=0,n=sn)}if(n!==0){if(n===2&&(u=$N(r),u!==0&&(l=u,n=wR(r,u))),n===1)throw o=Rg,eu(r,0),yl(r,l),Si(r,Br()),o;if(n===6)yl(r,l);else{if(u=r.current.alternate,!(l&30)&&!Sue(u)&&(n=vx(r,l),n===2&&(m=$N(r),m!==0&&(l=m,n=wR(r,m))),n===1))throw o=Rg,eu(r,0),yl(r,l),Si(r,Br()),o;switch(r.finishedWork=u,r.finishedLanes=l,n){case 0:case 1:throw Error(ot(345));case 2:Ud(r,vi,gc);break;case 3:if(yl(r,l),(l&130023424)===l&&(n=qA+500-Br(),10<n)){if(ex(r,0)!==0)break;if(u=r.suspendedLanes,(u&l)!==l){$n(),r.pingedLanes|=r.suspendedLanes&u;break}r.timeoutHandle=rR(Ud.bind(null,r,vi,gc),n);break}Ud(r,vi,gc);break;case 4:if(yl(r,l),(l&4194240)===l)break;for(n=r.eventTimes,u=-1;0<l;){var g=31-lo(l);m=1<<g,g=n[g],g>u&&(u=g),l&=~m}if(l=u,l=Br()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*wue(l/1960))-l,10<l){r.timeoutHandle=rR(Ud.bind(null,r,vi,gc),l);break}Ud(r,vi,gc);break;case 5:Ud(r,vi,gc);break;default:throw Error(ot(329))}}}return Si(r,Br()),r.callbackNode===o?G8.bind(null,r):null}function wR(r,n){var o=sg;return r.current.memoizedState.isDehydrated&&(eu(r,n).flags|=256),r=vx(r,n),r!==2&&(n=vi,vi=o,n!==null&&SR(n)),r}function SR(r){vi===null?vi=r:vi.push.apply(vi,r)}function Sue(r){for(var n=r;;){if(n.flags&16384){var o=n.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var l=0;l<o.length;l++){var u=o[l],m=u.getSnapshot;u=u.value;try{if(!ho(m(),u))return!1}catch{return!1}}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===r)break;for(;n.sibling===null;){if(n.return===null||n.return===r)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function yl(r,n){for(n&=~KA,n&=~Gx,r.suspendedLanes|=n,r.pingedLanes&=~n,r=r.expirationTimes;0<n;){var o=31-lo(n),l=1<<o;r[o]=-1,n&=~l}}function iB(r){if(Ds&6)throw Error(ot(327));pp();var n=ex(r,0);if(!(n&1))return Si(r,Br()),null;var o=vx(r,n);if(r.tag!==0&&o===2){var l=$N(r);l!==0&&(n=l,o=wR(r,l))}if(o===1)throw o=Rg,eu(r,0),yl(r,n),Si(r,Br()),o;if(o===6)throw Error(ot(345));return r.finishedWork=r.current.alternate,r.finishedLanes=n,Ud(r,vi,gc),Si(r,Br()),null}function YA(r,n){var o=Ds;Ds|=1;try{return r(n)}finally{Ds=o,Ds===0&&(Dp=Br()+500,Ux&&zl())}}function cu(r){Rl!==null&&Rl.tag===0&&!(Ds&6)&&pp();var n=Ds;Ds|=1;var o=Na.transition,l=zs;try{if(Na.transition=null,zs=1,r)return r()}finally{zs=l,Na.transition=o,Ds=n,!(Ds&6)&&zl()}}function $A(){Gi=Zh.current,lr(Zh)}function eu(r,n){r.finishedWork=null,r.finishedLanes=0;var o=r.timeoutHandle;if(o!==-1&&(r.timeoutHandle=-1,eue(o)),Yr!==null)for(o=Yr.return;o!==null;){var l=o;switch(AA(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&ix();break;case 3:Ap(),lr(bi),lr(Fn),FA();break;case 5:MA(l);break;case 4:Ap();break;case 13:lr(xr);break;case 19:lr(xr);break;case 10:jA(l.type._context);break;case 22:case 23:$A()}o=o.return}if(hn=r,Yr=r=Ml(r.current,null),En=Gi=n,sn=0,Rg=null,KA=Gx=ou=0,vi=sg=null,Kd!==null){for(n=0;n<Kd.length;n++)if(o=Kd[n],l=o.interleaved,l!==null){o.interleaved=null;var u=l.next,m=o.pending;if(m!==null){var g=m.next;m.next=u,l.next=g}o.pending=l}Kd=null}return r}function H8(r,n){do{var o=Yr;try{if(OA(),My.current=mx,px){for(var l=wr.memoizedState;l!==null;){var u=l.queue;u!==null&&(u.pending=null),l=l.next}px=!1}if(au=0,un=tn=wr=null,eg=!1,Cg=0,zA.current=null,o===null||o.return===null){sn=1,Rg=n,Yr=null;break}e:{var m=r,g=o.return,E=o,y=n;if(n=En,E.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var x=y,S=E,C=S.tag;if(!(S.mode&1)&&(C===0||C===11||C===15)){var R=S.alternate;R?(S.updateQueue=R.updateQueue,S.memoizedState=R.memoizedState,S.lanes=R.lanes):(S.updateQueue=null,S.memoizedState=null)}var M=K3(g);if(M!==null){M.flags&=-257,q3(M,g,E,m,n),M.mode&1&&z3(m,x,n),n=M,y=x;var G=n.updateQueue;if(G===null){var I=new Set;I.add(y),n.updateQueue=I}else G.add(y);break e}else{if(!(n&1)){z3(m,x,n),XA();break e}y=Error(ot(426))}}else if(pr&&E.mode&1){var j=K3(g);if(j!==null){!(j.flags&65536)&&(j.flags|=256),q3(j,g,E,m,n),IA(Ip(y,E));break e}}m=y=Ip(y,E),sn!==4&&(sn=2),sg===null?sg=[m]:sg.push(m),m=g;do{switch(m.tag){case 3:m.flags|=65536,n&=-n,m.lanes|=n;var L=N8(m,y,n);U3(m,L);break e;case 1:E=y;var N=m.type,D=m.stateNode;if(!(m.flags&128)&&(typeof N.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(kl===null||!kl.has(D)))){m.flags|=65536,n&=-n,m.lanes|=n;var V=R8(m,E,n);U3(m,V);break e}}m=m.return}while(m!==null)}q8(o)}catch(B){n=B,Yr===o&&o!==null&&(Yr=o=o.return);continue}break}while(!0)}function z8(){var r=fx.current;return fx.current=mx,r===null?mx:r}function XA(){(sn===0||sn===3||sn===2)&&(sn=4),hn===null||!(ou&268435455)&&!(Gx&268435455)||yl(hn,En)}function vx(r,n){var o=Ds;Ds|=2;var l=z8();(hn!==r||En!==n)&&(gc=null,eu(r,n));do try{Cue();break}catch(u){H8(r,u)}while(!0);if(OA(),Ds=o,fx.current=l,Yr!==null)throw Error(ot(261));return hn=null,En=0,sn}function Cue(){for(;Yr!==null;)K8(Yr)}function Tue(){for(;Yr!==null&&!Jle();)K8(Yr)}function K8(r){var n=$8(r.alternate,r,Gi);r.memoizedProps=r.pendingProps,n===null?q8(r):Yr=n,zA.current=null}function q8(r){var n=r;do{var o=n.alternate;if(r=n.return,n.flags&32768){if(o=Eue(o,n),o!==null){o.flags&=32767,Yr=o;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{sn=6,Yr=null;return}}else if(o=vue(o,n,Gi),o!==null){Yr=o;return}if(n=n.sibling,n!==null){Yr=n;return}Yr=n=r}while(n!==null);sn===0&&(sn=5)}function Ud(r,n,o){var l=zs,u=Na.transition;try{Na.transition=null,zs=1,Nue(r,n,o,l)}finally{Na.transition=u,zs=l}return null}function Nue(r,n,o,l){do pp();while(Rl!==null);if(Ds&6)throw Error(ot(327));o=r.finishedWork;var u=r.finishedLanes;if(o===null)return null;if(r.finishedWork=null,r.finishedLanes=0,o===r.current)throw Error(ot(177));r.callbackNode=null,r.callbackPriority=0;var m=o.lanes|o.childLanes;if(ode(r,m),r===hn&&(Yr=hn=null,En=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||_y||(_y=!0,X8(Zy,function(){return pp(),null})),m=(o.flags&15990)!==0,o.subtreeFlags&15990||m){m=Na.transition,Na.transition=null;var g=zs;zs=1;var E=Ds;Ds|=4,zA.current=null,xue(r,o),B8(o,r),qde(tR),tx=!!eR,tR=eR=null,r.current=o,bue(o),Qle(),Ds=E,zs=g,Na.transition=m}else r.current=o;if(_y&&(_y=!1,Rl=r,_x=u),m=r.pendingLanes,m===0&&(kl=null),tde(o.stateNode),Si(r,Br()),n!==null)for(l=r.onRecoverableError,o=0;o<n.length;o++)u=n[o],l(u.value,{componentStack:u.stack,digest:u.digest});if(gx)throw gx=!1,r=xR,xR=null,r;return _x&1&&r.tag!==0&&pp(),m=r.pendingLanes,m&1?r===bR?rg++:(rg=0,bR=r):rg=0,zl(),null}function pp(){if(Rl!==null){var r=N9(_x),n=Na.transition,o=zs;try{if(Na.transition=null,zs=16>r?16:r,Rl===null)var l=!1;else{if(r=Rl,Rl=null,_x=0,Ds&6)throw Error(ot(331));var u=Ds;for(Ds|=4,St=r.current;St!==null;){var m=St,g=m.child;if(St.flags&16){var E=m.deletions;if(E!==null){for(var y=0;y<E.length;y++){var x=E[y];for(St=x;St!==null;){var S=St;switch(S.tag){case 0:case 11:case 15:tg(8,S,m)}var C=S.child;if(C!==null)C.return=S,St=C;else for(;St!==null;){S=St;var R=S.sibling,M=S.return;if(F8(S),S===x){St=null;break}if(R!==null){R.return=M,St=R;break}St=M}}}var G=m.alternate;if(G!==null){var I=G.child;if(I!==null){G.child=null;do{var j=I.sibling;I.sibling=null,I=j}while(I!==null)}}St=m}}if(m.subtreeFlags&2064&&g!==null)g.return=m,St=g;else e:for(;St!==null;){if(m=St,m.flags&2048)switch(m.tag){case 0:case 11:case 15:tg(9,m,m.return)}var L=m.sibling;if(L!==null){L.return=m.return,St=L;break e}St=m.return}}var N=r.current;for(St=N;St!==null;){g=St;var D=g.child;if(g.subtreeFlags&2064&&D!==null)D.return=g,St=D;else e:for(g=N;St!==null;){if(E=St,E.flags&2048)try{switch(E.tag){case 0:case 11:case 15:Wx(9,E)}}catch(B){jr(E,E.return,B)}if(E===g){St=null;break e}var V=E.sibling;if(V!==null){V.return=E.return,St=V;break e}St=E.return}}if(Ds=u,zl(),Go&&typeof Go.onPostCommitFiberRoot=="function")try{Go.onPostCommitFiberRoot(Px,r)}catch{}l=!0}return l}finally{zs=o,Na.transition=n}}return!1}function aB(r,n,o){n=Ip(o,n),n=N8(r,n,1),r=Pl(r,n,1),n=$n(),r!==null&&(Hg(r,1,n),Si(r,n))}function jr(r,n,o){if(r.tag===3)aB(r,r,o);else for(;n!==null;){if(n.tag===3){aB(n,r,o);break}else if(n.tag===1){var l=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(kl===null||!kl.has(l))){r=Ip(o,r),r=R8(n,r,1),n=Pl(n,r,1),r=$n(),n!==null&&(Hg(n,1,r),Si(n,r));break}}n=n.return}}function Rue(r,n,o){var l=r.pingCache;l!==null&&l.delete(n),n=$n(),r.pingedLanes|=r.suspendedLanes&o,hn===r&&(En&o)===o&&(sn===4||sn===3&&(En&130023424)===En&&500>Br()-qA?eu(r,0):KA|=o),Si(r,n)}function Y8(r,n){n===0&&(r.mode&1?(n=oy,oy<<=1,!(oy&130023424)&&(oy=4194304)):n=1);var o=$n();r=Sc(r,n),r!==null&&(Hg(r,n,o),Si(r,o))}function Aue(r){var n=r.memoizedState,o=0;n!==null&&(o=n.retryLane),Y8(r,o)}function Iue(r,n){var o=0;switch(r.tag){case 13:var l=r.stateNode,u=r.memoizedState;u!==null&&(o=u.retryLane);break;case 19:l=r.stateNode;break;default:throw Error(ot(314))}l!==null&&l.delete(n),Y8(r,o)}var $8;$8=function(r,n,o){if(r!==null)if(r.memoizedProps!==n.pendingProps||bi.current)Ei=!0;else{if(!(r.lanes&o)&&!(n.flags&128))return Ei=!1,_ue(r,n,o);Ei=!!(r.flags&131072)}else Ei=!1,pr&&n.flags&1048576&&Z9(n,cx,n.index);switch(n.lanes=0,n.tag){case 2:var l=n.type;Uy(r,n),r=n.pendingProps;var u=Tp(n,Fn.current);hp(n,o),u=VA(null,n,l,r,u,o);var m=BA();return n.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,wi(l)?(m=!0,ax(n)):m=!1,n.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,kA(n),u.updater=Bx,n.stateNode=u,u._reactInternals=n,dR(n,l,r,o),n=pR(null,n,l,!0,m,o)):(n.tag=0,pr&&m&&RA(n),Kn(null,n,u,o),n=n.child),n;case 16:l=n.elementType;e:{switch(Uy(r,n),r=n.pendingProps,u=l._init,l=u(l._payload),n.type=l,u=n.tag=Oue(l),r=to(l,r),u){case 0:n=hR(null,n,l,r,o);break e;case 1:n=X3(null,n,l,r,o);break e;case 11:n=Y3(null,n,l,r,o);break e;case 14:n=$3(null,n,l,to(l.type,r),o);break e}throw Error(ot(306,l,""))}return n;case 0:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:to(l,u),hR(r,n,l,u,o);case 1:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:to(l,u),X3(r,n,l,u,o);case 3:e:{if(O8(n),r===null)throw Error(ot(387));l=n.pendingProps,m=n.memoizedState,u=m.element,i8(r,n),ux(n,l,null,o);var g=n.memoizedState;if(l=g.element,m.isDehydrated)if(m={element:l,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},n.updateQueue.baseState=m,n.memoizedState=m,n.flags&256){u=Ip(Error(ot(423)),n),n=J3(r,n,l,o,u);break e}else if(l!==u){u=Ip(Error(ot(424)),n),n=J3(r,n,l,o,u);break e}else for(Hi=jl(n.stateNode.containerInfo.firstChild),zi=n,pr=!0,ao=null,o=r8(n,null,l,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Np(),l===u){n=Cc(r,n,o);break e}Kn(r,n,l,o)}n=n.child}return n;case 5:return a8(n),r===null&&oR(n),l=n.type,u=n.pendingProps,m=r!==null?r.memoizedProps:null,g=u.children,sR(l,u)?g=null:m!==null&&sR(l,m)&&(n.flags|=32),D8(r,n),Kn(r,n,g,o),n.child;case 6:return r===null&&oR(n),null;case 13:return j8(r,n,o);case 4:return LA(n,n.stateNode.containerInfo),l=n.pendingProps,r===null?n.child=Rp(n,null,l,o):Kn(r,n,l,o),n.child;case 11:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:to(l,u),Y3(r,n,l,u,o);case 7:return Kn(r,n,n.pendingProps,o),n.child;case 8:return Kn(r,n,n.pendingProps.children,o),n.child;case 12:return Kn(r,n,n.pendingProps.children,o),n.child;case 10:e:{if(l=n.type._context,u=n.pendingProps,m=n.memoizedProps,g=u.value,rr(lx,l._currentValue),l._currentValue=g,m!==null)if(ho(m.value,g)){if(m.children===u.children&&!bi.current){n=Cc(r,n,o);break e}}else for(m=n.child,m!==null&&(m.return=n);m!==null;){var E=m.dependencies;if(E!==null){g=m.child;for(var y=E.firstContext;y!==null;){if(y.context===l){if(m.tag===1){y=xc(-1,o&-o),y.tag=2;var x=m.updateQueue;if(x!==null){x=x.shared;var S=x.pending;S===null?y.next=y:(y.next=S.next,S.next=y),x.pending=y}}m.lanes|=o,y=m.alternate,y!==null&&(y.lanes|=o),cR(m.return,o,n),E.lanes|=o;break}y=y.next}}else if(m.tag===10)g=m.type===n.type?null:m.child;else if(m.tag===18){if(g=m.return,g===null)throw Error(ot(341));g.lanes|=o,E=g.alternate,E!==null&&(E.lanes|=o),cR(g,o,n),g=m.sibling}else g=m.child;if(g!==null)g.return=m;else for(g=m;g!==null;){if(g===n){g=null;break}if(m=g.sibling,m!==null){m.return=g.return,g=m;break}g=g.return}m=g}Kn(r,n,u.children,o),n=n.child}return n;case 9:return u=n.type,l=n.pendingProps.children,hp(n,o),u=Aa(u),l=l(u),n.flags|=1,Kn(r,n,l,o),n.child;case 14:return l=n.type,u=to(l,n.pendingProps),u=to(l.type,u),$3(r,n,l,u,o);case 15:return A8(r,n,n.type,n.pendingProps,o);case 17:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:to(l,u),Uy(r,n),n.tag=1,wi(l)?(r=!0,ax(n)):r=!1,hp(n,o),T8(n,l,u),dR(n,l,u,o),pR(null,n,l,!0,r,o);case 19:return P8(r,n,o);case 22:return I8(r,n,o)}throw Error(ot(156,n.tag))};function X8(r,n){return w9(r,n)}function Due(r,n,o,l){this.tag=r,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ca(r,n,o,l){return new Due(r,n,o,l)}function JA(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Oue(r){if(typeof r=="function")return JA(r)?1:0;if(r!=null){if(r=r.$$typeof,r===gA)return 11;if(r===_A)return 14}return 2}function Ml(r,n){var o=r.alternate;return o===null?(o=Ca(r.tag,n,r.key,r.mode),o.elementType=r.elementType,o.type=r.type,o.stateNode=r.stateNode,o.alternate=r,r.alternate=o):(o.pendingProps=n,o.type=r.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=r.flags&14680064,o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,n=r.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=r.sibling,o.index=r.index,o.ref=r.ref,o}function Wy(r,n,o,l,u,m){var g=2;if(l=r,typeof r=="function")JA(r)&&(g=1);else if(typeof r=="string")g=5;else e:switch(r){case Gh:return tu(o.children,u,m,n);case fA:g=8,u|=8;break;case PN:return r=Ca(12,o,n,u|2),r.elementType=PN,r.lanes=m,r;case kN:return r=Ca(13,o,n,u),r.elementType=kN,r.lanes=m,r;case LN:return r=Ca(19,o,n,u),r.elementType=LN,r.lanes=m,r;case a9:return Hx(o,u,m,n);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case n9:g=10;break e;case i9:g=9;break e;case gA:g=11;break e;case _A:g=14;break e;case gl:g=16,l=null;break e}throw Error(ot(130,r==null?r:typeof r,""))}return n=Ca(g,o,n,u),n.elementType=r,n.type=l,n.lanes=m,n}function tu(r,n,o,l){return r=Ca(7,r,l,n),r.lanes=o,r}function Hx(r,n,o,l){return r=Ca(22,r,l,n),r.elementType=a9,r.lanes=o,r.stateNode={isHidden:!1},r}function XT(r,n,o){return r=Ca(6,r,null,n),r.lanes=o,r}function JT(r,n,o){return n=Ca(4,r.children!==null?r.children:[],r.key,n),n.lanes=o,n.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},n}function jue(r,n,o,l,u){this.tag=n,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=DT(0),this.expirationTimes=DT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=DT(0),this.identifierPrefix=l,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function QA(r,n,o,l,u,m,g,E,y){return r=new jue(r,n,o,E,y),n===1?(n=1,m===!0&&(n|=8)):n=0,m=Ca(3,null,null,n),r.current=m,m.stateNode=r,m.memoizedState={element:l,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},kA(m),r}function Pue(r,n,o){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Wh,key:l==null?null:""+l,children:r,containerInfo:n,implementation:o}}function J8(r){if(!r)return Vl;r=r._reactInternals;e:{if(uu(r)!==r||r.tag!==1)throw Error(ot(170));var n=r;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(wi(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(ot(171))}if(r.tag===1){var o=r.type;if(wi(o))return J9(r,o,n)}return n}function Q8(r,n,o,l,u,m,g,E,y){return r=QA(o,l,!0,r,u,m,g,E,y),r.context=J8(null),o=r.current,l=$n(),u=Ll(o),m=xc(l,u),m.callback=n??null,Pl(o,m,u),r.current.lanes=u,Hg(r,u,l),Si(r,l),r}function zx(r,n,o,l){var u=n.current,m=$n(),g=Ll(u);return o=J8(o),n.context===null?n.context=o:n.pendingContext=o,n=xc(m,g),n.payload={element:r},l=l===void 0?null:l,l!==null&&(n.callback=l),r=Pl(u,n,g),r!==null&&(uo(r,u,g,m),Ly(r,u,g)),g}function Ex(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function oB(r,n){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var o=r.retryLane;r.retryLane=o!==0&&o<n?o:n}}function ZA(r,n){oB(r,n),(r=r.alternate)&&oB(r,n)}function kue(){return null}var Z8=typeof reportError=="function"?reportError:function(r){console.error(r)};function eI(r){this._internalRoot=r}Kx.prototype.render=eI.prototype.render=function(r){var n=this._internalRoot;if(n===null)throw Error(ot(409));zx(r,n,null,null)};Kx.prototype.unmount=eI.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var n=r.containerInfo;cu(function(){zx(null,r,null,null)}),n[wc]=null}};function Kx(r){this._internalRoot=r}Kx.prototype.unstable_scheduleHydration=function(r){if(r){var n=I9();r={blockedOn:null,target:r,priority:n};for(var o=0;o<El.length&&n!==0&&n<El[o].priority;o++);El.splice(o,0,r),o===0&&O9(r)}};function tI(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function qx(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function cB(){}function Lue(r,n,o,l,u){if(u){if(typeof l=="function"){var m=l;l=function(){var x=Ex(g);m.call(x)}}var g=Q8(n,l,r,0,null,!1,!1,"",cB);return r._reactRootContainer=g,r[wc]=g.current,yg(r.nodeType===8?r.parentNode:r),cu(),g}for(;u=r.lastChild;)r.removeChild(u);if(typeof l=="function"){var E=l;l=function(){var x=Ex(y);E.call(x)}}var y=QA(r,0,!1,null,null,!1,!1,"",cB);return r._reactRootContainer=y,r[wc]=y.current,yg(r.nodeType===8?r.parentNode:r),cu(function(){zx(n,y,o,l)}),y}function Yx(r,n,o,l,u){var m=o._reactRootContainer;if(m){var g=m;if(typeof u=="function"){var E=u;u=function(){var y=Ex(g);E.call(y)}}zx(n,g,r,u)}else g=Lue(o,n,r,u,l);return Ex(g)}R9=function(r){switch(r.tag){case 3:var n=r.stateNode;if(n.current.memoizedState.isDehydrated){var o=Hf(n.pendingLanes);o!==0&&(yA(n,o|1),Si(n,Br()),!(Ds&6)&&(Dp=Br()+500,zl()))}break;case 13:cu(function(){var l=Sc(r,1);if(l!==null){var u=$n();uo(l,r,1,u)}}),ZA(r,1)}};xA=function(r){if(r.tag===13){var n=Sc(r,134217728);if(n!==null){var o=$n();uo(n,r,134217728,o)}ZA(r,134217728)}};A9=function(r){if(r.tag===13){var n=Ll(r),o=Sc(r,n);if(o!==null){var l=$n();uo(o,r,n,l)}ZA(r,n)}};I9=function(){return zs};D9=function(r,n){var o=zs;try{return zs=r,n()}finally{zs=o}};KN=function(r,n,o){switch(n){case"input":if(UN(r,o),n=o.name,o.type==="radio"&&n!=null){for(o=r;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<o.length;n++){var l=o[n];if(l!==r&&l.form===r.form){var u=Fx(l);if(!u)throw Error(ot(90));c9(l),UN(l,u)}}}break;case"textarea":d9(r,o);break;case"select":n=o.value,n!=null&&cp(r,!!o.multiple,n,!1)}};_9=YA;v9=cu;var Mue={usingClientEntryPoint:!1,Events:[Kg,qh,Fx,f9,g9,YA]},Pf={findFiberByHostInstance:zd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Fue={bundleType:Pf.bundleType,version:Pf.version,rendererPackageName:Pf.rendererPackageName,rendererConfig:Pf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Nc.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=x9(r),r===null?null:r.stateNode},findFiberByHostInstance:Pf.findFiberByHostInstance||kue,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vy.isDisabled&&vy.supportsFiber)try{Px=vy.inject(Fue),Go=vy}catch{}}qi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mue;qi.createPortal=function(r,n){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tI(n))throw Error(ot(200));return Pue(r,n,null,o)};qi.createRoot=function(r,n){if(!tI(r))throw Error(ot(299));var o=!1,l="",u=Z8;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onRecoverableError!==void 0&&(u=n.onRecoverableError)),n=QA(r,1,!1,null,null,o,!1,l,u),r[wc]=n.current,yg(r.nodeType===8?r.parentNode:r),new eI(n)};qi.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var n=r._reactInternals;if(n===void 0)throw typeof r.render=="function"?Error(ot(188)):(r=Object.keys(r).join(","),Error(ot(268,r)));return r=x9(n),r=r===null?null:r.stateNode,r};qi.flushSync=function(r){return cu(r)};qi.hydrate=function(r,n,o){if(!qx(n))throw Error(ot(200));return Yx(null,r,n,!0,o)};qi.hydrateRoot=function(r,n,o){if(!tI(r))throw Error(ot(405));var l=o!=null&&o.hydratedSources||null,u=!1,m="",g=Z8;if(o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(g=o.onRecoverableError)),n=Q8(n,null,r,1,o??null,u,!1,m,g),r[wc]=n.current,yg(r),l)for(r=0;r<l.length;r++)o=l[r],u=o._getVersion,u=u(o._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[o,u]:n.mutableSourceEagerHydrationData.push(o,u);return new Kx(n)};qi.render=function(r,n,o){if(!qx(n))throw Error(ot(200));return Yx(null,r,n,!1,o)};qi.unmountComponentAtNode=function(r){if(!qx(r))throw Error(ot(40));return r._reactRootContainer?(cu(function(){Yx(null,null,r,!1,function(){r._reactRootContainer=null,r[wc]=null})}),!0):!1};qi.unstable_batchedUpdates=YA;qi.unstable_renderSubtreeIntoContainer=function(r,n,o,l){if(!qx(o))throw Error(ot(200));if(r==null||r._reactInternals===void 0)throw Error(ot(38));return Yx(r,n,o,!1,l)};qi.version="18.3.1-next-f1338f8080-20240426";function eW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(eW)}catch(r){console.error(r)}}eW(),e9.exports=qi;var Uue=e9.exports,lB=Uue;ON.createRoot=lB.createRoot,ON.hydrateRoot=lB.hydrateRoot;var $x=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Xx=typeof window>"u"||"Deno"in globalThis;function so(){}function Vue(r,n){return typeof r=="function"?r(n):r}function Bue(r){return typeof r=="number"&&r>=0&&r!==1/0}function Wue(r,n){return Math.max(r+(n||0)-Date.now(),0)}function dB(r,n){return typeof r=="function"?r(n):r}function Gue(r,n){return typeof r=="function"?r(n):r}function uB(r,n){const{type:o="all",exact:l,fetchStatus:u,predicate:m,queryKey:g,stale:E}=r;if(g){if(l){if(n.queryHash!==sI(g,n.options))return!1}else if(!Ig(n.queryKey,g))return!1}if(o!=="all"){const y=n.isActive();if(o==="active"&&!y||o==="inactive"&&y)return!1}return!(typeof E=="boolean"&&n.isStale()!==E||u&&u!==n.state.fetchStatus||m&&!m(n))}function hB(r,n){const{exact:o,status:l,predicate:u,mutationKey:m}=r;if(m){if(!n.options.mutationKey)return!1;if(o){if(Ag(n.options.mutationKey)!==Ag(m))return!1}else if(!Ig(n.options.mutationKey,m))return!1}return!(l&&n.state.status!==l||u&&!u(n))}function sI(r,n){return((n==null?void 0:n.queryKeyHashFn)||Ag)(r)}function Ag(r){return JSON.stringify(r,(n,o)=>CR(o)?Object.keys(o).sort().reduce((l,u)=>(l[u]=o[u],l),{}):o)}function Ig(r,n){return r===n?!0:typeof r!=typeof n?!1:r&&n&&typeof r=="object"&&typeof n=="object"?!Object.keys(n).some(o=>!Ig(r[o],n[o])):!1}function tW(r,n){if(r===n)return r;const o=pB(r)&&pB(n);if(o||CR(r)&&CR(n)){const l=o?r:Object.keys(r),u=l.length,m=o?n:Object.keys(n),g=m.length,E=o?[]:{};let y=0;for(let x=0;x<g;x++){const S=o?x:m[x];(!o&&l.includes(S)||o)&&r[S]===void 0&&n[S]===void 0?(E[S]=void 0,y++):(E[S]=tW(r[S],n[S]),E[S]===r[S]&&r[S]!==void 0&&y++)}return u===g&&y===u?r:E}return n}function pB(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function CR(r){if(!mB(r))return!1;const n=r.constructor;if(n===void 0)return!0;const o=n.prototype;return!(!mB(o)||!o.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function mB(r){return Object.prototype.toString.call(r)==="[object Object]"}function Hue(r){return new Promise(n=>{setTimeout(n,r)})}function zue(r,n,o){return typeof o.structuralSharing=="function"?o.structuralSharing(r,n):o.structuralSharing!==!1?tW(r,n):n}function Kue(r,n,o=0){const l=[...r,n];return o&&l.length>o?l.slice(1):l}function que(r,n,o=0){const l=[n,...r];return o&&l.length>o?l.slice(0,-1):l}var sW=Symbol(),rW=(r,n)=>!r.queryFn&&(n!=null&&n.initialPromise)?()=>n.initialPromise:!r.queryFn||r.queryFn===sW?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn,Xd,bl,gp,P7,Yue=(P7=class extends $x{constructor(){super();Us(this,Xd);Us(this,bl);Us(this,gp);ls(this,gp,n=>{if(!Xx&&window.addEventListener){const o=()=>n();return window.addEventListener("visibilitychange",o,!1),()=>{window.removeEventListener("visibilitychange",o)}}})}onSubscribe(){et(this,bl)||this.setEventListener(et(this,gp))}onUnsubscribe(){var n;this.hasListeners()||((n=et(this,bl))==null||n.call(this),ls(this,bl,void 0))}setEventListener(n){var o;ls(this,gp,n),(o=et(this,bl))==null||o.call(this),ls(this,bl,n(l=>{typeof l=="boolean"?this.setFocused(l):this.onFocus()}))}setFocused(n){et(this,Xd)!==n&&(ls(this,Xd,n),this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(o=>{o(n)})}isFocused(){var n;return typeof et(this,Xd)=="boolean"?et(this,Xd):((n=globalThis.document)==null?void 0:n.visibilityState)!=="hidden"}},Xd=new WeakMap,bl=new WeakMap,gp=new WeakMap,P7),nW=new Yue,_p,wl,vp,k7,$ue=(k7=class extends $x{constructor(){super();Us(this,_p,!0);Us(this,wl);Us(this,vp);ls(this,vp,n=>{if(!Xx&&window.addEventListener){const o=()=>n(!0),l=()=>n(!1);return window.addEventListener("online",o,!1),window.addEventListener("offline",l,!1),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",l)}}})}onSubscribe(){et(this,wl)||this.setEventListener(et(this,vp))}onUnsubscribe(){var n;this.hasListeners()||((n=et(this,wl))==null||n.call(this),ls(this,wl,void 0))}setEventListener(n){var o;ls(this,vp,n),(o=et(this,wl))==null||o.call(this),ls(this,wl,n(this.setOnline.bind(this)))}setOnline(n){et(this,_p)!==n&&(ls(this,_p,n),this.listeners.forEach(l=>{l(n)}))}isOnline(){return et(this,_p)}},_p=new WeakMap,wl=new WeakMap,vp=new WeakMap,k7),yx=new $ue;function Xue(r){return Math.min(1e3*2**r,3e4)}function iW(r){return(r??"online")==="online"?yx.isOnline():!0}var aW=class{constructor(r){this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function QT(r){return r instanceof aW}function oW(r){let n=!1,o=0,l=!1,u,m,g;const E=new Promise((L,N)=>{m=L,g=N}),y=L=>{var N;l||(G(new aW(L)),(N=r.abort)==null||N.call(r))},x=()=>{n=!0},S=()=>{n=!1},C=()=>nW.isFocused()&&(r.networkMode==="always"||yx.isOnline())&&r.canRun(),R=()=>iW(r.networkMode)&&r.canRun(),M=L=>{var N;l||(l=!0,(N=r.onSuccess)==null||N.call(r,L),u==null||u(),m(L))},G=L=>{var N;l||(l=!0,(N=r.onError)==null||N.call(r,L),u==null||u(),g(L))},I=()=>new Promise(L=>{var N;u=D=>{(l||C())&&L(D)},(N=r.onPause)==null||N.call(r)}).then(()=>{var L;u=void 0,l||(L=r.onContinue)==null||L.call(r)}),j=()=>{if(l)return;let L;const N=o===0?r.initialPromise:void 0;try{L=N??r.fn()}catch(D){L=Promise.reject(D)}Promise.resolve(L).then(M).catch(D=>{var J;if(l)return;const V=r.retry??(Xx?0:3),B=r.retryDelay??Xue,z=typeof B=="function"?B(o,D):B,H=V===!0||typeof V=="number"&&o<V||typeof V=="function"&&V(o,D);if(n||!H){G(D);return}o++,(J=r.onFail)==null||J.call(r,o,D),Hue(z).then(()=>C()?void 0:I()).then(()=>{n?G(D):j()})})};return{promise:E,cancel:y,continue:()=>(u==null||u(),E),cancelRetry:x,continueRetry:S,canStart:R,start:()=>(R()?j():I().then(j),E)}}function Jue(){let r=[],n=0,o=R=>{R()},l=R=>{R()},u=R=>setTimeout(R,0);const m=R=>{u=R},g=R=>{let M;n++;try{M=R()}finally{n--,n||x()}return M},E=R=>{n?r.push(R):u(()=>{o(R)})},y=R=>(...M)=>{E(()=>{R(...M)})},x=()=>{const R=r;r=[],R.length&&u(()=>{l(()=>{R.forEach(M=>{o(M)})})})};return{batch:g,batchCalls:y,schedule:E,setNotifyFunction:R=>{o=R},setBatchNotifyFunction:R=>{l=R},setScheduler:m}}var qn=Jue(),Jd,L7,cW=(L7=class{constructor(){Us(this,Jd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Bue(this.gcTime)&&ls(this,Jd,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(Xx?1/0:5*60*1e3))}clearGcTimeout(){et(this,Jd)&&(clearTimeout(et(this,Jd)),ls(this,Jd,void 0))}},Jd=new WeakMap,L7),Ep,yp,xa,jn,Bg,Qd,ro,fc,M7,Que=(M7=class extends cW{constructor(n){super();Us(this,ro);Us(this,Ep);Us(this,yp);Us(this,xa);Us(this,jn);Us(this,Bg);Us(this,Qd);ls(this,Qd,!1),ls(this,Bg,n.defaultOptions),this.setOptions(n.options),this.observers=[],ls(this,xa,n.cache),this.queryKey=n.queryKey,this.queryHash=n.queryHash,ls(this,Ep,n.state||ehe(this.options)),this.state=et(this,Ep),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var n;return(n=et(this,jn))==null?void 0:n.promise}setOptions(n){this.options={...et(this,Bg),...n},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&et(this,xa).remove(this)}setData(n,o){const l=zue(this.state.data,n,this.options);return In(this,ro,fc).call(this,{data:l,type:"success",dataUpdatedAt:o==null?void 0:o.updatedAt,manual:o==null?void 0:o.manual}),l}setState(n,o){In(this,ro,fc).call(this,{type:"setState",state:n,setStateOptions:o})}cancel(n){var l,u;const o=(l=et(this,jn))==null?void 0:l.promise;return(u=et(this,jn))==null||u.cancel(n),o?o.then(so).catch(so):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(et(this,Ep))}isActive(){return this.observers.some(n=>Gue(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(n=0){return this.state.isInvalidated||this.state.data===void 0||!Wue(this.state.dataUpdatedAt,n)}onFocus(){var o;const n=this.observers.find(l=>l.shouldFetchOnWindowFocus());n==null||n.refetch({cancelRefetch:!1}),(o=et(this,jn))==null||o.continue()}onOnline(){var o;const n=this.observers.find(l=>l.shouldFetchOnReconnect());n==null||n.refetch({cancelRefetch:!1}),(o=et(this,jn))==null||o.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),et(this,xa).notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(o=>o!==n),this.observers.length||(et(this,jn)&&(et(this,Qd)?et(this,jn).cancel({revert:!0}):et(this,jn).cancelRetry()),this.scheduleGc()),et(this,xa).notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||In(this,ro,fc).call(this,{type:"invalidate"})}fetch(n,o){var y,x,S;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(o!=null&&o.cancelRefetch))this.cancel({silent:!0});else if(et(this,jn))return et(this,jn).continueRetry(),et(this,jn).promise}if(n&&this.setOptions(n),!this.options.queryFn){const C=this.observers.find(R=>R.options.queryFn);C&&this.setOptions(C.options)}const l=new AbortController,u=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(ls(this,Qd,!0),l.signal)})},m=()=>{const C=rW(this.options,o),R={queryKey:this.queryKey,meta:this.meta};return u(R),ls(this,Qd,!1),this.options.persister?this.options.persister(C,R,this):C(R)},g={fetchOptions:o,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:m};u(g),(y=this.options.behavior)==null||y.onFetch(g,this),ls(this,yp,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((x=g.fetchOptions)==null?void 0:x.meta))&&In(this,ro,fc).call(this,{type:"fetch",meta:(S=g.fetchOptions)==null?void 0:S.meta});const E=C=>{var R,M,G,I;QT(C)&&C.silent||In(this,ro,fc).call(this,{type:"error",error:C}),QT(C)||((M=(R=et(this,xa).config).onError)==null||M.call(R,C,this),(I=(G=et(this,xa).config).onSettled)==null||I.call(G,this.state.data,C,this)),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return ls(this,jn,oW({initialPromise:o==null?void 0:o.initialPromise,fn:g.fetchFn,abort:l.abort.bind(l),onSuccess:C=>{var R,M,G,I;if(C===void 0){E(new Error(`${this.queryHash} data is undefined`));return}this.setData(C),(M=(R=et(this,xa).config).onSuccess)==null||M.call(R,C,this),(I=(G=et(this,xa).config).onSettled)==null||I.call(G,C,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:E,onFail:(C,R)=>{In(this,ro,fc).call(this,{type:"failed",failureCount:C,error:R})},onPause:()=>{In(this,ro,fc).call(this,{type:"pause"})},onContinue:()=>{In(this,ro,fc).call(this,{type:"continue"})},retry:g.options.retry,retryDelay:g.options.retryDelay,networkMode:g.options.networkMode,canRun:()=>!0})),et(this,jn).start()}},Ep=new WeakMap,yp=new WeakMap,xa=new WeakMap,jn=new WeakMap,Bg=new WeakMap,Qd=new WeakMap,ro=new WeakSet,fc=function(n){const o=l=>{switch(n.type){case"failed":return{...l,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...l,fetchStatus:"paused"};case"continue":return{...l,fetchStatus:"fetching"};case"fetch":return{...l,...Zue(l.data,this.options),fetchMeta:n.meta??null};case"success":return{...l,data:n.data,dataUpdateCount:l.dataUpdateCount+1,dataUpdatedAt:n.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const u=n.error;return QT(u)&&u.revert&&et(this,yp)?{...et(this,yp),fetchStatus:"idle"}:{...l,error:u,errorUpdateCount:l.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:l.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...l,isInvalidated:!0};case"setState":return{...l,...n.state}}};this.state=o(this.state),qn.batch(()=>{this.observers.forEach(l=>{l.onQueryUpdate()}),et(this,xa).notify({query:this,type:"updated",action:n})})},M7);function Zue(r,n){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:iW(n.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function ehe(r){const n=typeof r.initialData=="function"?r.initialData():r.initialData,o=n!==void 0,l=o?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:n,dataUpdateCount:0,dataUpdatedAt:o?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:o?"success":"pending",fetchStatus:"idle"}}var Uo,F7,the=(F7=class extends $x{constructor(n={}){super();Us(this,Uo);this.config=n,ls(this,Uo,new Map)}build(n,o,l){const u=o.queryKey,m=o.queryHash??sI(u,o);let g=this.get(m);return g||(g=new Que({cache:this,queryKey:u,queryHash:m,options:n.defaultQueryOptions(o),state:l,defaultOptions:n.getQueryDefaults(u)}),this.add(g)),g}add(n){et(this,Uo).has(n.queryHash)||(et(this,Uo).set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const o=et(this,Uo).get(n.queryHash);o&&(n.destroy(),o===n&&et(this,Uo).delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){qn.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return et(this,Uo).get(n)}getAll(){return[...et(this,Uo).values()]}find(n){const o={exact:!0,...n};return this.getAll().find(l=>uB(o,l))}findAll(n={}){const o=this.getAll();return Object.keys(n).length>0?o.filter(l=>uB(n,l)):o}notify(n){qn.batch(()=>{this.listeners.forEach(o=>{o(n)})})}onFocus(){qn.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){qn.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},Uo=new WeakMap,F7),Vo,zn,Zd,Bo,ul,U7,she=(U7=class extends cW{constructor(n){super();Us(this,Bo);Us(this,Vo);Us(this,zn);Us(this,Zd);this.mutationId=n.mutationId,ls(this,zn,n.mutationCache),ls(this,Vo,[]),this.state=n.state||rhe(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){et(this,Vo).includes(n)||(et(this,Vo).push(n),this.clearGcTimeout(),et(this,zn).notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){ls(this,Vo,et(this,Vo).filter(o=>o!==n)),this.scheduleGc(),et(this,zn).notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){et(this,Vo).length||(this.state.status==="pending"?this.scheduleGc():et(this,zn).remove(this))}continue(){var n;return((n=et(this,Zd))==null?void 0:n.continue())??this.execute(this.state.variables)}async execute(n){var u,m,g,E,y,x,S,C,R,M,G,I,j,L,N,D,V,B,z,H;ls(this,Zd,oW({fn:()=>this.options.mutationFn?this.options.mutationFn(n):Promise.reject(new Error("No mutationFn found")),onFail:(J,ee)=>{In(this,Bo,ul).call(this,{type:"failed",failureCount:J,error:ee})},onPause:()=>{In(this,Bo,ul).call(this,{type:"pause"})},onContinue:()=>{In(this,Bo,ul).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>et(this,zn).canRun(this)}));const o=this.state.status==="pending",l=!et(this,Zd).canStart();try{if(!o){In(this,Bo,ul).call(this,{type:"pending",variables:n,isPaused:l}),await((m=(u=et(this,zn).config).onMutate)==null?void 0:m.call(u,n,this));const ee=await((E=(g=this.options).onMutate)==null?void 0:E.call(g,n));ee!==this.state.context&&In(this,Bo,ul).call(this,{type:"pending",context:ee,variables:n,isPaused:l})}const J=await et(this,Zd).start();return await((x=(y=et(this,zn).config).onSuccess)==null?void 0:x.call(y,J,n,this.state.context,this)),await((C=(S=this.options).onSuccess)==null?void 0:C.call(S,J,n,this.state.context)),await((M=(R=et(this,zn).config).onSettled)==null?void 0:M.call(R,J,null,this.state.variables,this.state.context,this)),await((I=(G=this.options).onSettled)==null?void 0:I.call(G,J,null,n,this.state.context)),In(this,Bo,ul).call(this,{type:"success",data:J}),J}catch(J){try{throw await((L=(j=et(this,zn).config).onError)==null?void 0:L.call(j,J,n,this.state.context,this)),await((D=(N=this.options).onError)==null?void 0:D.call(N,J,n,this.state.context)),await((B=(V=et(this,zn).config).onSettled)==null?void 0:B.call(V,void 0,J,this.state.variables,this.state.context,this)),await((H=(z=this.options).onSettled)==null?void 0:H.call(z,void 0,J,n,this.state.context)),J}finally{In(this,Bo,ul).call(this,{type:"error",error:J})}}finally{et(this,zn).runNext(this)}}},Vo=new WeakMap,zn=new WeakMap,Zd=new WeakMap,Bo=new WeakSet,ul=function(n){const o=l=>{switch(n.type){case"failed":return{...l,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...l,isPaused:!0};case"continue":return{...l,isPaused:!1};case"pending":return{...l,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...l,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...l,data:void 0,error:n.error,failureCount:l.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=o(this.state),qn.batch(()=>{et(this,Vo).forEach(l=>{l.onMutationUpdate(n)}),et(this,zn).notify({mutation:this,type:"updated",action:n})})},U7);function rhe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Wi,Wg,V7,nhe=(V7=class extends $x{constructor(n={}){super();Us(this,Wi);Us(this,Wg);this.config=n,ls(this,Wi,new Map),ls(this,Wg,Date.now())}build(n,o,l){const u=new she({mutationCache:this,mutationId:++ty(this,Wg)._,options:n.defaultMutationOptions(o),state:l});return this.add(u),u}add(n){const o=Ey(n),l=et(this,Wi).get(o)??[];l.push(n),et(this,Wi).set(o,l),this.notify({type:"added",mutation:n})}remove(n){var l;const o=Ey(n);if(et(this,Wi).has(o)){const u=(l=et(this,Wi).get(o))==null?void 0:l.filter(m=>m!==n);u&&(u.length===0?et(this,Wi).delete(o):et(this,Wi).set(o,u))}this.notify({type:"removed",mutation:n})}canRun(n){var l;const o=(l=et(this,Wi).get(Ey(n)))==null?void 0:l.find(u=>u.state.status==="pending");return!o||o===n}runNext(n){var l;const o=(l=et(this,Wi).get(Ey(n)))==null?void 0:l.find(u=>u!==n&&u.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}clear(){qn.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}getAll(){return[...et(this,Wi).values()].flat()}find(n){const o={exact:!0,...n};return this.getAll().find(l=>hB(o,l))}findAll(n={}){return this.getAll().filter(o=>hB(n,o))}notify(n){qn.batch(()=>{this.listeners.forEach(o=>{o(n)})})}resumePausedMutations(){const n=this.getAll().filter(o=>o.state.isPaused);return qn.batch(()=>Promise.all(n.map(o=>o.continue().catch(so))))}},Wi=new WeakMap,Wg=new WeakMap,V7);function Ey(r){var n;return((n=r.options.scope)==null?void 0:n.id)??String(r.mutationId)}function ihe(r){return{onFetch:(n,o)=>{const l=async()=>{var G,I,j,L,N;const u=n.options,m=(j=(I=(G=n.fetchOptions)==null?void 0:G.meta)==null?void 0:I.fetchMore)==null?void 0:j.direction,g=((L=n.state.data)==null?void 0:L.pages)||[],E=((N=n.state.data)==null?void 0:N.pageParams)||[],y={pages:[],pageParams:[]};let x=!1;const S=D=>{Object.defineProperty(D,"signal",{enumerable:!0,get:()=>(n.signal.aborted?x=!0:n.signal.addEventListener("abort",()=>{x=!0}),n.signal)})},C=rW(n.options,n.fetchOptions),R=async(D,V,B)=>{if(x)return Promise.reject();if(V==null&&D.pages.length)return Promise.resolve(D);const z={queryKey:n.queryKey,pageParam:V,direction:B?"backward":"forward",meta:n.options.meta};S(z);const H=await C(z),{maxPages:J}=n.options,ee=B?que:Kue;return{pages:ee(D.pages,H,J),pageParams:ee(D.pageParams,V,J)}};let M;if(m&&g.length){const D=m==="backward",V=D?ahe:fB,B={pages:g,pageParams:E},z=V(u,B);M=await R(B,z,D)}else{M=await R(y,E[0]??u.initialPageParam);const D=r??g.length;for(let V=1;V<D;V++){const B=fB(u,M);M=await R(M,B)}}return M};n.options.persister?n.fetchFn=()=>{var u,m;return(m=(u=n.options).persister)==null?void 0:m.call(u,l,{queryKey:n.queryKey,meta:n.options.meta,signal:n.signal},o)}:n.fetchFn=l}}}function fB(r,{pages:n,pageParams:o}){const l=n.length-1;return r.getNextPageParam(n[l],n,o[l],o)}function ahe(r,{pages:n,pageParams:o}){var l;return(l=r.getPreviousPageParam)==null?void 0:l.call(r,n[0],n,o[0],o)}var Dr,Sl,Cl,xp,bp,Tl,wp,Sp,B7,ohe=(B7=class{constructor(r={}){Us(this,Dr);Us(this,Sl);Us(this,Cl);Us(this,xp);Us(this,bp);Us(this,Tl);Us(this,wp);Us(this,Sp);ls(this,Dr,r.queryCache||new the),ls(this,Sl,r.mutationCache||new nhe),ls(this,Cl,r.defaultOptions||{}),ls(this,xp,new Map),ls(this,bp,new Map),ls(this,Tl,0)}mount(){ty(this,Tl)._++,et(this,Tl)===1&&(ls(this,wp,nW.subscribe(async r=>{r&&(await this.resumePausedMutations(),et(this,Dr).onFocus())})),ls(this,Sp,yx.subscribe(async r=>{r&&(await this.resumePausedMutations(),et(this,Dr).onOnline())})))}unmount(){var r,n;ty(this,Tl)._--,et(this,Tl)===0&&((r=et(this,wp))==null||r.call(this),ls(this,wp,void 0),(n=et(this,Sp))==null||n.call(this),ls(this,Sp,void 0))}isFetching(r){return et(this,Dr).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return et(this,Sl).findAll({...r,status:"pending"}).length}getQueryData(r){var o;const n=this.defaultQueryOptions({queryKey:r});return(o=et(this,Dr).get(n.queryHash))==null?void 0:o.state.data}ensureQueryData(r){const n=this.getQueryData(r.queryKey);if(n===void 0)return this.fetchQuery(r);{const o=this.defaultQueryOptions(r),l=et(this,Dr).build(this,o);return r.revalidateIfStale&&l.isStaleByTime(dB(o.staleTime,l))&&this.prefetchQuery(o),Promise.resolve(n)}}getQueriesData(r){return et(this,Dr).findAll(r).map(({queryKey:n,state:o})=>{const l=o.data;return[n,l]})}setQueryData(r,n,o){const l=this.defaultQueryOptions({queryKey:r}),u=et(this,Dr).get(l.queryHash),m=u==null?void 0:u.state.data,g=Vue(n,m);if(g!==void 0)return et(this,Dr).build(this,l).setData(g,{...o,manual:!0})}setQueriesData(r,n,o){return qn.batch(()=>et(this,Dr).findAll(r).map(({queryKey:l})=>[l,this.setQueryData(l,n,o)]))}getQueryState(r){var o;const n=this.defaultQueryOptions({queryKey:r});return(o=et(this,Dr).get(n.queryHash))==null?void 0:o.state}removeQueries(r){const n=et(this,Dr);qn.batch(()=>{n.findAll(r).forEach(o=>{n.remove(o)})})}resetQueries(r,n){const o=et(this,Dr),l={type:"active",...r};return qn.batch(()=>(o.findAll(r).forEach(u=>{u.reset()}),this.refetchQueries(l,n)))}cancelQueries(r={},n={}){const o={revert:!0,...n},l=qn.batch(()=>et(this,Dr).findAll(r).map(u=>u.cancel(o)));return Promise.all(l).then(so).catch(so)}invalidateQueries(r={},n={}){return qn.batch(()=>{if(et(this,Dr).findAll(r).forEach(l=>{l.invalidate()}),r.refetchType==="none")return Promise.resolve();const o={...r,type:r.refetchType??r.type??"active"};return this.refetchQueries(o,n)})}refetchQueries(r={},n){const o={...n,cancelRefetch:(n==null?void 0:n.cancelRefetch)??!0},l=qn.batch(()=>et(this,Dr).findAll(r).filter(u=>!u.isDisabled()).map(u=>{let m=u.fetch(void 0,o);return o.throwOnError||(m=m.catch(so)),u.state.fetchStatus==="paused"?Promise.resolve():m}));return Promise.all(l).then(so)}fetchQuery(r){const n=this.defaultQueryOptions(r);n.retry===void 0&&(n.retry=!1);const o=et(this,Dr).build(this,n);return o.isStaleByTime(dB(n.staleTime,o))?o.fetch(n):Promise.resolve(o.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(so).catch(so)}fetchInfiniteQuery(r){return r.behavior=ihe(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(so).catch(so)}resumePausedMutations(){return yx.isOnline()?et(this,Sl).resumePausedMutations():Promise.resolve()}getQueryCache(){return et(this,Dr)}getMutationCache(){return et(this,Sl)}getDefaultOptions(){return et(this,Cl)}setDefaultOptions(r){ls(this,Cl,r)}setQueryDefaults(r,n){et(this,xp).set(Ag(r),{queryKey:r,defaultOptions:n})}getQueryDefaults(r){const n=[...et(this,xp).values()];let o={};return n.forEach(l=>{Ig(r,l.queryKey)&&(o={...o,...l.defaultOptions})}),o}setMutationDefaults(r,n){et(this,bp).set(Ag(r),{mutationKey:r,defaultOptions:n})}getMutationDefaults(r){const n=[...et(this,bp).values()];let o={};return n.forEach(l=>{Ig(r,l.mutationKey)&&(o={...o,...l.defaultOptions})}),o}defaultQueryOptions(r){if(r._defaulted)return r;const n={...et(this,Cl).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return n.queryHash||(n.queryHash=sI(n.queryKey,n)),n.refetchOnReconnect===void 0&&(n.refetchOnReconnect=n.networkMode!=="always"),n.throwOnError===void 0&&(n.throwOnError=!!n.suspense),!n.networkMode&&n.persister&&(n.networkMode="offlineFirst"),n.enabled!==!0&&n.queryFn===sW&&(n.enabled=!1),n}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...et(this,Cl).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){et(this,Dr).clear(),et(this,Sl).clear()}},Dr=new WeakMap,Sl=new WeakMap,Cl=new WeakMap,xp=new WeakMap,bp=new WeakMap,Tl=new WeakMap,wp=new WeakMap,Sp=new WeakMap,B7),che=O.createContext(void 0),lhe=({client:r,children:n})=>(O.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),i.jsx(che.Provider,{value:r,children:n}));/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dg(){return Dg=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(r[l]=o[l])}return r},Dg.apply(this,arguments)}var Al;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Al||(Al={}));const gB="popstate";function dhe(r){r===void 0&&(r={});function n(l,u){let{pathname:m,search:g,hash:E}=l.location;return TR("",{pathname:m,search:g,hash:E},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function o(l,u){return typeof u=="string"?u:xx(u)}return hhe(n,o,null,r)}function Sr(r,n){if(r===!1||r===null||typeof r>"u")throw new Error(n)}function lW(r,n){if(!r){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function uhe(){return Math.random().toString(36).substr(2,8)}function _B(r,n){return{usr:r.state,key:r.key,idx:n}}function TR(r,n,o,l){return o===void 0&&(o=null),Dg({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof n=="string"?Bp(n):n,{state:o,key:n&&n.key||l||uhe()})}function xx(r){let{pathname:n="/",search:o="",hash:l=""}=r;return o&&o!=="?"&&(n+=o.charAt(0)==="?"?o:"?"+o),l&&l!=="#"&&(n+=l.charAt(0)==="#"?l:"#"+l),n}function Bp(r){let n={};if(r){let o=r.indexOf("#");o>=0&&(n.hash=r.substr(o),r=r.substr(0,o));let l=r.indexOf("?");l>=0&&(n.search=r.substr(l),r=r.substr(0,l)),r&&(n.pathname=r)}return n}function hhe(r,n,o,l){l===void 0&&(l={});let{window:u=document.defaultView,v5Compat:m=!1}=l,g=u.history,E=Al.Pop,y=null,x=S();x==null&&(x=0,g.replaceState(Dg({},g.state,{idx:x}),""));function S(){return(g.state||{idx:null}).idx}function C(){E=Al.Pop;let j=S(),L=j==null?null:j-x;x=j,y&&y({action:E,location:I.location,delta:L})}function R(j,L){E=Al.Push;let N=TR(I.location,j,L);x=S()+1;let D=_B(N,x),V=I.createHref(N);try{g.pushState(D,"",V)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;u.location.assign(V)}m&&y&&y({action:E,location:I.location,delta:1})}function M(j,L){E=Al.Replace;let N=TR(I.location,j,L);x=S();let D=_B(N,x),V=I.createHref(N);g.replaceState(D,"",V),m&&y&&y({action:E,location:I.location,delta:0})}function G(j){let L=u.location.origin!=="null"?u.location.origin:u.location.href,N=typeof j=="string"?j:xx(j);return N=N.replace(/ $/,"%20"),Sr(L,"No window.location.(origin|href) available to create URL for href: "+N),new URL(N,L)}let I={get action(){return E},get location(){return r(u,g)},listen(j){if(y)throw new Error("A history only accepts one active listener");return u.addEventListener(gB,C),y=j,()=>{u.removeEventListener(gB,C),y=null}},createHref(j){return n(u,j)},createURL:G,encodeLocation(j){let L=G(j);return{pathname:L.pathname,search:L.search,hash:L.hash}},push:R,replace:M,go(j){return g.go(j)}};return I}var vB;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(vB||(vB={}));function phe(r,n,o){return o===void 0&&(o="/"),mhe(r,n,o)}function mhe(r,n,o,l){let u=typeof n=="string"?Bp(n):n,m=Op(u.pathname||"/",o);if(m==null)return null;let g=dW(r);fhe(g);let E=null;for(let y=0;E==null&&y<g.length;++y){let x=The(m);E=She(g[y],x)}return E}function dW(r,n,o,l){n===void 0&&(n=[]),o===void 0&&(o=[]),l===void 0&&(l="");let u=(m,g,E)=>{let y={relativePath:E===void 0?m.path||"":E,caseSensitive:m.caseSensitive===!0,childrenIndex:g,route:m};y.relativePath.startsWith("/")&&(Sr(y.relativePath.startsWith(l),'Absolute route path "'+y.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),y.relativePath=y.relativePath.slice(l.length));let x=Fl([l,y.relativePath]),S=o.concat(y);m.children&&m.children.length>0&&(Sr(m.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),dW(m.children,n,S,x)),!(m.path==null&&!m.index)&&n.push({path:x,score:bhe(x,m.index),routesMeta:S})};return r.forEach((m,g)=>{var E;if(m.path===""||!((E=m.path)!=null&&E.includes("?")))u(m,g);else for(let y of uW(m.path))u(m,g,y)}),n}function uW(r){let n=r.split("/");if(n.length===0)return[];let[o,...l]=n,u=o.endsWith("?"),m=o.replace(/\?$/,"");if(l.length===0)return u?[m,""]:[m];let g=uW(l.join("/")),E=[];return E.push(...g.map(y=>y===""?m:[m,y].join("/"))),u&&E.push(...g),E.map(y=>r.startsWith("/")&&y===""?"/":y)}function fhe(r){r.sort((n,o)=>n.score!==o.score?o.score-n.score:whe(n.routesMeta.map(l=>l.childrenIndex),o.routesMeta.map(l=>l.childrenIndex)))}const ghe=/^:[\w-]+$/,_he=3,vhe=2,Ehe=1,yhe=10,xhe=-2,EB=r=>r==="*";function bhe(r,n){let o=r.split("/"),l=o.length;return o.some(EB)&&(l+=xhe),n&&(l+=vhe),o.filter(u=>!EB(u)).reduce((u,m)=>u+(ghe.test(m)?_he:m===""?Ehe:yhe),l)}function whe(r,n){return r.length===n.length&&r.slice(0,-1).every((l,u)=>l===n[u])?r[r.length-1]-n[n.length-1]:0}function She(r,n,o){let{routesMeta:l}=r,u={},m="/",g=[];for(let E=0;E<l.length;++E){let y=l[E],x=E===l.length-1,S=m==="/"?n:n.slice(m.length)||"/",C=NR({path:y.relativePath,caseSensitive:y.caseSensitive,end:x},S),R=y.route;if(!C)return null;Object.assign(u,C.params),g.push({params:u,pathname:Fl([m,C.pathname]),pathnameBase:Ihe(Fl([m,C.pathnameBase])),route:R}),C.pathnameBase!=="/"&&(m=Fl([m,C.pathnameBase]))}return g}function NR(r,n){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[o,l]=Che(r.path,r.caseSensitive,r.end),u=n.match(o);if(!u)return null;let m=u[0],g=m.replace(/(.)\/+$/,"$1"),E=u.slice(1);return{params:l.reduce((x,S,C)=>{let{paramName:R,isOptional:M}=S;if(R==="*"){let I=E[C]||"";g=m.slice(0,m.length-I.length).replace(/(.)\/+$/,"$1")}const G=E[C];return M&&!G?x[R]=void 0:x[R]=(G||"").replace(/%2F/g,"/"),x},{}),pathname:m,pathnameBase:g,pattern:r}}function Che(r,n,o){n===void 0&&(n=!1),o===void 0&&(o=!0),lW(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let l=[],u="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,E,y)=>(l.push({paramName:E,isOptional:y!=null}),y?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(l.push({paramName:"*"}),u+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?u+="\\/*$":r!==""&&r!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,n?void 0:"i"),l]}function The(r){try{return r.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return lW(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),r}}function Op(r,n){if(n==="/")return r;if(!r.toLowerCase().startsWith(n.toLowerCase()))return null;let o=n.endsWith("/")?n.length-1:n.length,l=r.charAt(o);return l&&l!=="/"?null:r.slice(o)||"/"}function Nhe(r,n){n===void 0&&(n="/");let{pathname:o,search:l="",hash:u=""}=typeof r=="string"?Bp(r):r;return{pathname:o?o.startsWith("/")?o:Rhe(o,n):n,search:Dhe(l),hash:Ohe(u)}}function Rhe(r,n){let o=n.replace(/\/+$/,"").split("/");return r.split("/").forEach(u=>{u===".."?o.length>1&&o.pop():u!=="."&&o.push(u)}),o.length>1?o.join("/"):"/"}function ZT(r,n,o,l){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ahe(r){return r.filter((n,o)=>o===0||n.route.path&&n.route.path.length>0)}function rI(r,n){let o=Ahe(r);return n?o.map((l,u)=>u===o.length-1?l.pathname:l.pathnameBase):o.map(l=>l.pathnameBase)}function nI(r,n,o,l){l===void 0&&(l=!1);let u;typeof r=="string"?u=Bp(r):(u=Dg({},r),Sr(!u.pathname||!u.pathname.includes("?"),ZT("?","pathname","search",u)),Sr(!u.pathname||!u.pathname.includes("#"),ZT("#","pathname","hash",u)),Sr(!u.search||!u.search.includes("#"),ZT("#","search","hash",u)));let m=r===""||u.pathname==="",g=m?"/":u.pathname,E;if(g==null)E=o;else{let C=n.length-1;if(!l&&g.startsWith("..")){let R=g.split("/");for(;R[0]==="..";)R.shift(),C-=1;u.pathname=R.join("/")}E=C>=0?n[C]:"/"}let y=Nhe(u,E),x=g&&g!=="/"&&g.endsWith("/"),S=(m||g===".")&&o.endsWith("/");return!y.pathname.endsWith("/")&&(x||S)&&(y.pathname+="/"),y}const Fl=r=>r.join("/").replace(/\/\/+/g,"/"),Ihe=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Dhe=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Ohe=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function jhe(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const hW=["post","put","patch","delete"];new Set(hW);const Phe=["get",...hW];new Set(Phe);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Og(){return Og=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(r[l]=o[l])}return r},Og.apply(this,arguments)}const Jx=O.createContext(null),pW=O.createContext(null),Rc=O.createContext(null),Qx=O.createContext(null),Yo=O.createContext({outlet:null,matches:[],isDataRoute:!1}),mW=O.createContext(null);function khe(r,n){let{relative:o}=n===void 0?{}:n;Wp()||Sr(!1);let{basename:l,navigator:u}=O.useContext(Rc),{hash:m,pathname:g,search:E}=Zx(r,{relative:o}),y=g;return l!=="/"&&(y=g==="/"?l:Fl([l,g])),u.createHref({pathname:y,search:E,hash:m})}function Wp(){return O.useContext(Qx)!=null}function Ac(){return Wp()||Sr(!1),O.useContext(Qx).location}function fW(r){O.useContext(Rc).static||O.useLayoutEffect(r)}function Ns(){let{isDataRoute:r}=O.useContext(Yo);return r?Xhe():Lhe()}function Lhe(){Wp()||Sr(!1);let r=O.useContext(Jx),{basename:n,future:o,navigator:l}=O.useContext(Rc),{matches:u}=O.useContext(Yo),{pathname:m}=Ac(),g=JSON.stringify(rI(u,o.v7_relativeSplatPath)),E=O.useRef(!1);return fW(()=>{E.current=!0}),O.useCallback(function(x,S){if(S===void 0&&(S={}),!E.current)return;if(typeof x=="number"){l.go(x);return}let C=nI(x,JSON.parse(g),m,S.relative==="path");r==null&&n!=="/"&&(C.pathname=C.pathname==="/"?n:Fl([n,C.pathname])),(S.replace?l.replace:l.push)(C,S.state,S)},[n,l,g,m,r])}const Mhe=O.createContext(null);function Fhe(r){let n=O.useContext(Yo).outlet;return n&&O.createElement(Mhe.Provider,{value:r},n)}function iI(){let{matches:r}=O.useContext(Yo),n=r[r.length-1];return n?n.params:{}}function Zx(r,n){let{relative:o}=n===void 0?{}:n,{future:l}=O.useContext(Rc),{matches:u}=O.useContext(Yo),{pathname:m}=Ac(),g=JSON.stringify(rI(u,l.v7_relativeSplatPath));return O.useMemo(()=>nI(r,JSON.parse(g),m,o==="path"),[r,g,m,o])}function Uhe(r,n){return Vhe(r,n)}function Vhe(r,n,o,l){Wp()||Sr(!1);let{navigator:u}=O.useContext(Rc),{matches:m}=O.useContext(Yo),g=m[m.length-1],E=g?g.params:{};g&&g.pathname;let y=g?g.pathnameBase:"/";g&&g.route;let x=Ac(),S;if(n){var C;let j=typeof n=="string"?Bp(n):n;y==="/"||(C=j.pathname)!=null&&C.startsWith(y)||Sr(!1),S=j}else S=x;let R=S.pathname||"/",M=R;if(y!=="/"){let j=y.replace(/^\//,"").split("/");M="/"+R.replace(/^\//,"").split("/").slice(j.length).join("/")}let G=phe(r,{pathname:M}),I=zhe(G&&G.map(j=>Object.assign({},j,{params:Object.assign({},E,j.params),pathname:Fl([y,u.encodeLocation?u.encodeLocation(j.pathname).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?y:Fl([y,u.encodeLocation?u.encodeLocation(j.pathnameBase).pathname:j.pathnameBase])})),m,o,l);return n&&I?O.createElement(Qx.Provider,{value:{location:Og({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:Al.Pop}},I):I}function Bhe(){let r=$he(),n=jhe(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),o=r instanceof Error?r.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return O.createElement(O.Fragment,null,O.createElement("h2",null,"Unexpected Application Error!"),O.createElement("h3",{style:{fontStyle:"italic"}},n),o?O.createElement("pre",{style:u},o):null,null)}const Whe=O.createElement(Bhe,null);class Ghe extends O.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,o){return o.location!==n.location||o.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:o.error,location:o.location,revalidation:n.revalidation||o.revalidation}}componentDidCatch(n,o){console.error("React Router caught the following error during render",n,o)}render(){return this.state.error!==void 0?O.createElement(Yo.Provider,{value:this.props.routeContext},O.createElement(mW.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Hhe(r){let{routeContext:n,match:o,children:l}=r,u=O.useContext(Jx);return u&&u.static&&u.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=o.route.id),O.createElement(Yo.Provider,{value:n},l)}function zhe(r,n,o,l){var u;if(n===void 0&&(n=[]),o===void 0&&(o=null),l===void 0&&(l=null),r==null){var m;if(!o)return null;if(o.errors)r=o.matches;else if((m=l)!=null&&m.v7_partialHydration&&n.length===0&&!o.initialized&&o.matches.length>0)r=o.matches;else return null}let g=r,E=(u=o)==null?void 0:u.errors;if(E!=null){let S=g.findIndex(C=>C.route.id&&(E==null?void 0:E[C.route.id])!==void 0);S>=0||Sr(!1),g=g.slice(0,Math.min(g.length,S+1))}let y=!1,x=-1;if(o&&l&&l.v7_partialHydration)for(let S=0;S<g.length;S++){let C=g[S];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(x=S),C.route.id){let{loaderData:R,errors:M}=o,G=C.route.loader&&R[C.route.id]===void 0&&(!M||M[C.route.id]===void 0);if(C.route.lazy||G){y=!0,x>=0?g=g.slice(0,x+1):g=[g[0]];break}}}return g.reduceRight((S,C,R)=>{let M,G=!1,I=null,j=null;o&&(M=E&&C.route.id?E[C.route.id]:void 0,I=C.route.errorElement||Whe,y&&(x<0&&R===0?(Jhe("route-fallback"),G=!0,j=null):x===R&&(G=!0,j=C.route.hydrateFallbackElement||null)));let L=n.concat(g.slice(0,R+1)),N=()=>{let D;return M?D=I:G?D=j:C.route.Component?D=O.createElement(C.route.Component,null):C.route.element?D=C.route.element:D=S,O.createElement(Hhe,{match:C,routeContext:{outlet:S,matches:L,isDataRoute:o!=null},children:D})};return o&&(C.route.ErrorBoundary||C.route.errorElement||R===0)?O.createElement(Ghe,{location:o.location,revalidation:o.revalidation,component:I,error:M,children:N(),routeContext:{outlet:null,matches:L,isDataRoute:!0}}):N()},null)}var gW=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(gW||{}),_W=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(_W||{});function Khe(r){let n=O.useContext(Jx);return n||Sr(!1),n}function qhe(r){let n=O.useContext(pW);return n||Sr(!1),n}function Yhe(r){let n=O.useContext(Yo);return n||Sr(!1),n}function vW(r){let n=Yhe(),o=n.matches[n.matches.length-1];return o.route.id||Sr(!1),o.route.id}function $he(){var r;let n=O.useContext(mW),o=qhe(),l=vW();return n!==void 0?n:(r=o.errors)==null?void 0:r[l]}function Xhe(){let{router:r}=Khe(gW.UseNavigateStable),n=vW(_W.UseNavigateStable),o=O.useRef(!1);return fW(()=>{o.current=!0}),O.useCallback(function(u,m){m===void 0&&(m={}),o.current&&(typeof u=="number"?r.navigate(u):r.navigate(u,Og({fromRouteId:n},m)))},[r,n])}const yB={};function Jhe(r,n,o){yB[r]||(yB[r]=!0)}function ep(r){let{to:n,replace:o,state:l,relative:u}=r;Wp()||Sr(!1);let{future:m,static:g}=O.useContext(Rc),{matches:E}=O.useContext(Yo),{pathname:y}=Ac(),x=Ns(),S=nI(n,rI(E,m.v7_relativeSplatPath),y,u==="path"),C=JSON.stringify(S);return O.useEffect(()=>x(JSON.parse(C),{replace:o,state:l,relative:u}),[x,C,u,o,l]),null}function EW(r){return Fhe(r.context)}function at(r){Sr(!1)}function Qhe(r){let{basename:n="/",children:o=null,location:l,navigationType:u=Al.Pop,navigator:m,static:g=!1,future:E}=r;Wp()&&Sr(!1);let y=n.replace(/^\/*/,"/"),x=O.useMemo(()=>({basename:y,navigator:m,static:g,future:Og({v7_relativeSplatPath:!1},E)}),[y,E,m,g]);typeof l=="string"&&(l=Bp(l));let{pathname:S="/",search:C="",hash:R="",state:M=null,key:G="default"}=l,I=O.useMemo(()=>{let j=Op(S,y);return j==null?null:{location:{pathname:j,search:C,hash:R,state:M,key:G},navigationType:u}},[y,S,C,R,M,G,u]);return I==null?null:O.createElement(Rc.Provider,{value:x},O.createElement(Qx.Provider,{children:o,value:I}))}function Zhe(r){let{children:n,location:o}=r;return Uhe(RR(n),o)}new Promise(()=>{});function RR(r,n){n===void 0&&(n=[]);let o=[];return O.Children.forEach(r,(l,u)=>{if(!O.isValidElement(l))return;let m=[...n,u];if(l.type===O.Fragment){o.push.apply(o,RR(l.props.children,m));return}l.type!==at&&Sr(!1),!l.props.index||!l.props.children||Sr(!1);let g={id:l.props.id||m.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(g.children=RR(l.props.children,m)),o.push(g)}),o}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bx(){return bx=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(r[l]=o[l])}return r},bx.apply(this,arguments)}function yW(r,n){if(r==null)return{};var o={},l=Object.keys(r),u,m;for(m=0;m<l.length;m++)u=l[m],!(n.indexOf(u)>=0)&&(o[u]=r[u]);return o}function epe(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function tpe(r,n){return r.button===0&&(!n||n==="_self")&&!epe(r)}function AR(r){return r===void 0&&(r=""),new URLSearchParams(typeof r=="string"||Array.isArray(r)||r instanceof URLSearchParams?r:Object.keys(r).reduce((n,o)=>{let l=r[o];return n.concat(Array.isArray(l)?l.map(u=>[o,u]):[[o,l]])},[]))}function spe(r,n){let o=AR(r);return n&&n.forEach((l,u)=>{o.has(u)||n.getAll(u).forEach(m=>{o.append(u,m)})}),o}const rpe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],npe=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],ipe="6";try{window.__reactRouterVersion=ipe}catch{}const ape=O.createContext({isTransitioning:!1}),ope="startTransition",xB=Rle[ope];function cpe(r){let{basename:n,children:o,future:l,window:u}=r,m=O.useRef();m.current==null&&(m.current=dhe({window:u,v5Compat:!0}));let g=m.current,[E,y]=O.useState({action:g.action,location:g.location}),{v7_startTransition:x}=l||{},S=O.useCallback(C=>{x&&xB?xB(()=>y(C)):y(C)},[y,x]);return O.useLayoutEffect(()=>g.listen(S),[g,S]),O.createElement(Qhe,{basename:n,children:o,location:E.location,navigationType:E.action,navigator:g,future:l})}const lpe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",dpe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,oo=O.forwardRef(function(n,o){let{onClick:l,relative:u,reloadDocument:m,replace:g,state:E,target:y,to:x,preventScrollReset:S,unstable_viewTransition:C}=n,R=yW(n,rpe),{basename:M}=O.useContext(Rc),G,I=!1;if(typeof x=="string"&&dpe.test(x)&&(G=x,lpe))try{let D=new URL(window.location.href),V=x.startsWith("//")?new URL(D.protocol+x):new URL(x),B=Op(V.pathname,M);V.origin===D.origin&&B!=null?x=B+V.search+V.hash:I=!0}catch{}let j=khe(x,{relative:u}),L=hpe(x,{replace:g,state:E,target:y,preventScrollReset:S,relative:u,unstable_viewTransition:C});function N(D){l&&l(D),D.defaultPrevented||L(D)}return O.createElement("a",bx({},R,{href:G||j,onClick:I||m?l:N,ref:o,target:y}))}),hl=O.forwardRef(function(n,o){let{"aria-current":l="page",caseSensitive:u=!1,className:m="",end:g=!1,style:E,to:y,unstable_viewTransition:x,children:S}=n,C=yW(n,npe),R=Zx(y,{relative:C.relative}),M=Ac(),G=O.useContext(pW),{navigator:I,basename:j}=O.useContext(Rc),L=G!=null&&ppe(R)&&x===!0,N=I.encodeLocation?I.encodeLocation(R).pathname:R.pathname,D=M.pathname,V=G&&G.navigation&&G.navigation.location?G.navigation.location.pathname:null;u||(D=D.toLowerCase(),V=V?V.toLowerCase():null,N=N.toLowerCase()),V&&j&&(V=Op(V,j)||V);const B=N!=="/"&&N.endsWith("/")?N.length-1:N.length;let z=D===N||!g&&D.startsWith(N)&&D.charAt(B)==="/",H=V!=null&&(V===N||!g&&V.startsWith(N)&&V.charAt(N.length)==="/"),J={isActive:z,isPending:H,isTransitioning:L},ee=z?l:void 0,ne;typeof m=="function"?ne=m(J):ne=[m,z?"active":null,H?"pending":null,L?"transitioning":null].filter(Boolean).join(" ");let he=typeof E=="function"?E(J):E;return O.createElement(oo,bx({},C,{"aria-current":ee,className:ne,ref:o,style:he,to:y,unstable_viewTransition:x}),typeof S=="function"?S(J):S)});var IR;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(IR||(IR={}));var bB;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(bB||(bB={}));function upe(r){let n=O.useContext(Jx);return n||Sr(!1),n}function hpe(r,n){let{target:o,replace:l,state:u,preventScrollReset:m,relative:g,unstable_viewTransition:E}=n===void 0?{}:n,y=Ns(),x=Ac(),S=Zx(r,{relative:g});return O.useCallback(C=>{if(tpe(C,o)){C.preventDefault();let R=l!==void 0?l:xx(x)===xx(S);y(r,{replace:R,state:u,preventScrollReset:m,relative:g,unstable_viewTransition:E})}},[x,y,S,l,u,o,r,m,g,E])}function Gp(r){let n=O.useRef(AR(r)),o=O.useRef(!1),l=Ac(),u=O.useMemo(()=>spe(l.search,o.current?null:n.current),[l.search]),m=Ns(),g=O.useCallback((E,y)=>{const x=AR(typeof E=="function"?E(u):E);o.current=!0,m("?"+x,y)},[m,u]);return[u,g]}function ppe(r,n){n===void 0&&(n={});let o=O.useContext(ape);o==null&&Sr(!1);let{basename:l}=upe(IR.useViewTransitionState),u=Zx(r,{relative:n.relative});if(!o.isTransitioning)return!1;let m=Op(o.currentLocation.pathname,l)||o.currentLocation.pathname,g=Op(o.nextLocation.pathname,l)||o.nextLocation.pathname;return NR(u.pathname,g)!=null||NR(u.pathname,m)!=null}function xW(r){var n,o,l="";if(typeof r=="string"||typeof r=="number")l+=r;else if(typeof r=="object")if(Array.isArray(r)){var u=r.length;for(n=0;n<u;n++)r[n]&&(o=xW(r[n]))&&(l&&(l+=" "),l+=o)}else for(o in r)r[o]&&(l&&(l+=" "),l+=o);return l}function Kl(){for(var r,n,o=0,l="",u=arguments.length;o<u;o++)(r=arguments[o])&&(n=xW(r))&&(l&&(l+=" "),l+=n);return l}const mpe="inline-flex items-center justify-center rounded-[12px] font-semibold transition-transform duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:cursor-not-allowed",fpe={primary:"bg-[#050014] text-white shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)] hover:-translate-y-[1px] hover:bg-[#140423] active:brightness-110 disabled:bg-[#E9ECEF] disabled:text-[#6C757D]",secondary:"bg-white text-[#C045FF] border-2 border-[#C045FF] hover:bg-[#F4E6FF] hover:text-[#8B3FFF] active:bg-[#8B3FFF] active:text-white disabled:text-[#6C757D] disabled:border-[#E9ECEF] disabled:bg-transparent",ghost:"bg-transparent text-[#C045FF] hover:bg-[#F4E6FF] hover:text-[#8B3FFF] active:bg-[#8B3FFF] active:text-white disabled:text-[#6C757D]",danger:"bg-[#DC3545] text-white hover:bg-[#C82333] shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)] disabled:bg-[#E9ECEF] disabled:text-[#6C757D]"},gpe={md:"h-12 px-6 text-base",sm:"h-10 px-4 text-sm rounded-[8px]",lg:"h-14 px-8 text-lg",icon:"h-12 w-12 rounded-full"},oe=O.forwardRef(({variant:r="primary",size:n="md",leftIcon:o,rightIcon:l,className:u,children:m,...g},E)=>i.jsxs("button",{ref:E,className:Kl(mpe,fpe[r],gpe[n],u),...g,children:[o&&i.jsx("span",{className:"mr-2 flex items-center text-lg",children:o}),m,l&&i.jsx("span",{className:"ml-2 flex items-center text-lg",children:l})]}));oe.displayName="Button";const bW="mb-2 block text-sm font-semibold text-[#212529]",wW="mt-1 text-sm text-[#6C757D]",SW="mt-1 text-sm text-[#E63946]",CW="w-full rounded-[8px] border-2 border-[#E9ECEF] bg-white px-4 py-3 text-base transition-colors focus:border-[#FF6B35] focus:shadow-[0_0_0_3px_rgba(255,107,53,0.1)] focus:outline-none disabled:cursor-not-allowed disabled:bg-[#F8F9FA]",tt=O.forwardRef(({label:r,helperText:n,error:o,requiredIndicator:l=!0,className:u,id:m,...g},E)=>{const y=m??g.name;return i.jsxs("div",{className:"flex w-full flex-col",children:[r&&i.jsxs("label",{className:bW,htmlFor:y,children:[r,g.required&&l?i.jsx("span",{className:"ml-1 text-[#E63946]",children:"*"}):null]}),i.jsx("input",{ref:E,id:y,className:Kl(CW,o&&"border-[#E63946] focus:shadow-none",u),...g}),o?i.jsx("span",{className:SW,children:o}):n?i.jsx("span",{className:wW,children:n}):null]})});tt.displayName="TextInput";const nr=O.forwardRef(({label:r,helperText:n,error:o,requiredIndicator:l=!0,className:u,id:m,rows:g=4,...E},y)=>{const x=m??E.name;return i.jsxs("div",{className:"flex w-full flex-col",children:[r&&i.jsxs("label",{className:bW,htmlFor:x,children:[r,E.required&&l?i.jsx("span",{className:"ml-1 text-[#E63946]",children:"*"}):null]}),i.jsx("textarea",{ref:y,id:x,rows:g,className:Kl(CW,"resize-y",o&&"border-[#E63946] focus:shadow-none",u),...E}),o?i.jsx("span",{className:SW,children:o}):n?i.jsx("span",{className:wW,children:n}):null]})});nr.displayName="TextArea";const fe=({elevated:r=!1,className:n,...o})=>i.jsx("div",{className:Kl("rounded-[16px] border border-[#E9ECEF] bg-white p-6 transition-shadow",r?"shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)]":"shadow-[var(--shadow-sm)]",n),...o}),Te=({title:r,subtitle:n,className:o,children:l,...u})=>i.jsxs("div",{className:Kl("mb-4 flex flex-col gap-1",o),...u,children:[r?i.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:r}):null,n?i.jsx("p",{className:"text-sm text-[#6C757D]",children:n}):null,l]}),Ee=({className:r,...n})=>i.jsx("div",{className:Kl("flex flex-col gap-4",r),...n}),_pe={default:"bg-[#F8F9FA] text-[#6C757D]",primary:"bg-[#F4E6FF] text-[#C045FF]",success:"bg-[#D4EDDA] text-[#155724]",danger:"bg-[#F8D7DA] text-[#721C24]",warning:"bg-[#FFF3CD] text-[#856404]",live:"bg-[#DC3545] text-white animate-pulse"},Xe=({variant:r="default",pill:n=!0,className:o,...l})=>i.jsx("span",{className:Kl("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-wide",n?"rounded-full":"rounded-[6px]",_pe[r],o),...l});O.createContext(void 0);const vpe={sm:"h-8 w-8 text-xs",md:"h-12 w-12 text-sm",lg:"h-16 w-16 text-base",xl:"h-20 w-20 text-lg"},yi=({src:r,alt:n,initials:o,size:l="md",className:u,badgeColor:m,...g})=>i.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[i.jsx("div",{className:Kl("flex items-center justify-center overflow-hidden rounded-full border-4 border-white bg-[#C045FF] font-semibold uppercase text-white shadow-[var(--shadow-sm)]",vpe[l],u),...g,children:r?i.jsx("img",{className:"h-full w-full object-cover",src:r,alt:n}):o??""}),m&&i.jsx("span",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white",style:{backgroundColor:m}})]}),Epe="modulepreload",ype=function(r){return"/"+r},wB={},jp=function(n,o,l){let u=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),E=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));u=Promise.allSettled(o.map(y=>{if(y=ype(y),y in wB)return;wB[y]=!0;const x=y.endsWith(".css"),S=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${S}`))return;const C=document.createElement("link");if(C.rel=x?"stylesheet":Epe,x||(C.as="script"),C.crossOrigin="",C.href=y,E&&C.setAttribute("nonce",E),document.head.appendChild(C),x)return new Promise((R,M)=>{C.addEventListener("load",R),C.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${y}`)))})}))}function m(g){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=g,window.dispatchEvent(E),!E.defaultPrevented)throw g}return u.then(g=>{for(const E of g||[])E.status==="rejected"&&m(E.reason);return n().catch(m)})},xpe=r=>{let n;return r?n=r:typeof fetch>"u"?n=(...o)=>jp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...o)):n=fetch,(...o)=>n(...o)};class aI extends Error{constructor(n,o="FunctionsError",l){super(n),this.name=o,this.context=l}}class bpe extends aI{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}}class wpe extends aI{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}}class Spe extends aI{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}}var DR;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(DR||(DR={}));var Cpe=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};class Tpe{constructor(n,{headers:o={},customFetch:l,region:u=DR.Any}={}){this.url=n,this.headers=o,this.region=u,this.fetch=xpe(l)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,o={}){var l;return Cpe(this,void 0,void 0,function*(){try{const{headers:u,method:m,body:g}=o;let E={},{region:y}=o;y||(y=this.region),y&&y!=="any"&&(E["x-region"]=y);let x;g&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)&&(typeof Blob<"u"&&g instanceof Blob||g instanceof ArrayBuffer?(E["Content-Type"]="application/octet-stream",x=g):typeof g=="string"?(E["Content-Type"]="text/plain",x=g):typeof FormData<"u"&&g instanceof FormData?x=g:(E["Content-Type"]="application/json",x=JSON.stringify(g)));const S=yield this.fetch(`${this.url}/${n}`,{method:m||"POST",headers:Object.assign(Object.assign(Object.assign({},E),this.headers),u),body:x}).catch(G=>{throw new bpe(G)}),C=S.headers.get("x-relay-error");if(C&&C==="true")throw new wpe(S);if(!S.ok)throw new Spe(S);let R=((l=S.headers.get("Content-Type"))!==null&&l!==void 0?l:"text/plain").split(";")[0].trim(),M;return R==="application/json"?M=yield S.json():R==="application/octet-stream"?M=yield S.blob():R==="text/event-stream"?M=S:R==="multipart/form-data"?M=yield S.formData():M=yield S.text(),{data:M,error:null}}catch(u){return{data:null,error:u}}})}}var Sa={},oI={},eb={},Yg={},tb={},sb={},Npe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Pp=Npe();const Rpe=Pp.fetch,TW=Pp.fetch.bind(Pp),NW=Pp.Headers,Ape=Pp.Request,Ipe=Pp.Response,Hp=Object.freeze(Object.defineProperty({__proto__:null,Headers:NW,Request:Ape,Response:Ipe,default:TW,fetch:Rpe},Symbol.toStringTag,{value:"Module"})),Dpe=hle(Hp);var cI={};Object.defineProperty(cI,"__esModule",{value:!0});class Ope extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}cI.default=Ope;var RW=Ra&&Ra.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(sb,"__esModule",{value:!0});const jpe=RW(Dpe),Ppe=RW(cI);let kpe=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=jpe.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(n,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const l=this.fetch;let u=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var g,E,y;let x=null,S=null,C=null,R=m.status,M=m.statusText;if(m.ok){if(this.method!=="HEAD"){const L=await m.text();L===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?S=L:S=JSON.parse(L))}const I=(g=this.headers.Prefer)===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),j=(E=m.headers.get("content-range"))===null||E===void 0?void 0:E.split("/");I&&j&&j.length>1&&(C=parseInt(j[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(S)&&(S.length>1?(x={code:"PGRST116",details:`Results contain ${S.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},S=null,C=null,R=406,M="Not Acceptable"):S.length===1?S=S[0]:S=null)}else{const I=await m.text();try{x=JSON.parse(I),Array.isArray(x)&&m.status===404&&(S=[],x=null,R=200,M="OK")}catch{m.status===404&&I===""?(R=204,M="No Content"):x={message:I}}if(x&&this.isMaybeSingle&&(!((y=x==null?void 0:x.details)===null||y===void 0)&&y.includes("0 rows"))&&(x=null,R=200,M="OK"),x&&this.shouldThrowOnError)throw new Ppe.default(x)}return{error:x,data:S,count:C,status:R,statusText:M}});return this.shouldThrowOnError||(u=u.catch(m=>{var g,E,y;return{error:{message:`${(g=m==null?void 0:m.name)!==null&&g!==void 0?g:"FetchError"}: ${m==null?void 0:m.message}`,details:`${(E=m==null?void 0:m.stack)!==null&&E!==void 0?E:""}`,hint:"",code:`${(y=m==null?void 0:m.code)!==null&&y!==void 0?y:""}`},data:null,count:null,status:0,statusText:""}})),u.then(n,o)}};sb.default=kpe;var Lpe=Ra&&Ra.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(tb,"__esModule",{value:!0});const Mpe=Lpe(sb);let Fpe=class extends Mpe.default{select(n){let o=!1;const l=(n??"*").split("").map(u=>/\s/.test(u)&&!o?"":(u==='"'&&(o=!o),u)).join("");return this.url.searchParams.set("select",l),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:o=!0,nullsFirst:l,foreignTable:u,referencedTable:m=u}={}){const g=m?`${m}.order`:"order",E=this.url.searchParams.get(g);return this.url.searchParams.set(g,`${E?`${E},`:""}${n}.${o?"asc":"desc"}${l===void 0?"":l?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:o,referencedTable:l=o}={}){const u=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(u,`${n}`),this}range(n,o,{foreignTable:l,referencedTable:u=l}={}){const m=typeof u>"u"?"offset":`${u}.offset`,g=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(m,`${n}`),this.url.searchParams.set(g,`${o-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:o=!1,settings:l=!1,buffers:u=!1,wal:m=!1,format:g="text"}={}){var E;const y=[n?"analyze":null,o?"verbose":null,l?"settings":null,u?"buffers":null,m?"wal":null].filter(Boolean).join("|"),x=(E=this.headers.Accept)!==null&&E!==void 0?E:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${g}; for="${x}"; options=${y};`,g==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};tb.default=Fpe;var Upe=Ra&&Ra.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Yg,"__esModule",{value:!0});const Vpe=Upe(tb);let Bpe=class extends Vpe.default{eq(n,o){return this.url.searchParams.append(n,`eq.${o}`),this}neq(n,o){return this.url.searchParams.append(n,`neq.${o}`),this}gt(n,o){return this.url.searchParams.append(n,`gt.${o}`),this}gte(n,o){return this.url.searchParams.append(n,`gte.${o}`),this}lt(n,o){return this.url.searchParams.append(n,`lt.${o}`),this}lte(n,o){return this.url.searchParams.append(n,`lte.${o}`),this}like(n,o){return this.url.searchParams.append(n,`like.${o}`),this}likeAllOf(n,o){return this.url.searchParams.append(n,`like(all).{${o.join(",")}}`),this}likeAnyOf(n,o){return this.url.searchParams.append(n,`like(any).{${o.join(",")}}`),this}ilike(n,o){return this.url.searchParams.append(n,`ilike.${o}`),this}ilikeAllOf(n,o){return this.url.searchParams.append(n,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(n,o){return this.url.searchParams.append(n,`ilike(any).{${o.join(",")}}`),this}is(n,o){return this.url.searchParams.append(n,`is.${o}`),this}in(n,o){const l=Array.from(new Set(o)).map(u=>typeof u=="string"&&new RegExp("[,()]").test(u)?`"${u}"`:`${u}`).join(",");return this.url.searchParams.append(n,`in.(${l})`),this}contains(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cs.{${o.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(o)}`),this}containedBy(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cd.{${o.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(o)}`),this}rangeGt(n,o){return this.url.searchParams.append(n,`sr.${o}`),this}rangeGte(n,o){return this.url.searchParams.append(n,`nxl.${o}`),this}rangeLt(n,o){return this.url.searchParams.append(n,`sl.${o}`),this}rangeLte(n,o){return this.url.searchParams.append(n,`nxr.${o}`),this}rangeAdjacent(n,o){return this.url.searchParams.append(n,`adj.${o}`),this}overlaps(n,o){return typeof o=="string"?this.url.searchParams.append(n,`ov.${o}`):this.url.searchParams.append(n,`ov.{${o.join(",")}}`),this}textSearch(n,o,{config:l,type:u}={}){let m="";u==="plain"?m="pl":u==="phrase"?m="ph":u==="websearch"&&(m="w");const g=l===void 0?"":`(${l})`;return this.url.searchParams.append(n,`${m}fts${g}.${o}`),this}match(n){return Object.entries(n).forEach(([o,l])=>{this.url.searchParams.append(o,`eq.${l}`)}),this}not(n,o,l){return this.url.searchParams.append(n,`not.${o}.${l}`),this}or(n,{foreignTable:o,referencedTable:l=o}={}){const u=l?`${l}.or`:"or";return this.url.searchParams.append(u,`(${n})`),this}filter(n,o,l){return this.url.searchParams.append(n,`${o}.${l}`),this}};Yg.default=Bpe;var Wpe=Ra&&Ra.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(eb,"__esModule",{value:!0});const kf=Wpe(Yg);let Gpe=class{constructor(n,{headers:o={},schema:l,fetch:u}){this.url=n,this.headers=o,this.schema=l,this.fetch=u}select(n,{head:o=!1,count:l}={}){const u=o?"HEAD":"GET";let m=!1;const g=(n??"*").split("").map(E=>/\s/.test(E)&&!m?"":(E==='"'&&(m=!m),E)).join("");return this.url.searchParams.set("select",g),l&&(this.headers.Prefer=`count=${l}`),new kf.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:o,defaultToNull:l=!0}={}){const u="POST",m=[];if(this.headers.Prefer&&m.push(this.headers.Prefer),o&&m.push(`count=${o}`),l||m.push("missing=default"),this.headers.Prefer=m.join(","),Array.isArray(n)){const g=n.reduce((E,y)=>E.concat(Object.keys(y)),[]);if(g.length>0){const E=[...new Set(g)].map(y=>`"${y}"`);this.url.searchParams.set("columns",E.join(","))}}return new kf.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:o,ignoreDuplicates:l=!1,count:u,defaultToNull:m=!0}={}){const g="POST",E=[`resolution=${l?"ignore":"merge"}-duplicates`];if(o!==void 0&&this.url.searchParams.set("on_conflict",o),this.headers.Prefer&&E.push(this.headers.Prefer),u&&E.push(`count=${u}`),m||E.push("missing=default"),this.headers.Prefer=E.join(","),Array.isArray(n)){const y=n.reduce((x,S)=>x.concat(Object.keys(S)),[]);if(y.length>0){const x=[...new Set(y)].map(S=>`"${S}"`);this.url.searchParams.set("columns",x.join(","))}}return new kf.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:o}={}){const l="PATCH",u=[];return this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),this.headers.Prefer=u.join(","),new kf.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const o="DELETE",l=[];return n&&l.push(`count=${n}`),this.headers.Prefer&&l.unshift(this.headers.Prefer),this.headers.Prefer=l.join(","),new kf.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};eb.default=Gpe;var rb={},nb={};Object.defineProperty(nb,"__esModule",{value:!0});nb.version=void 0;nb.version="0.0.0-automated";Object.defineProperty(rb,"__esModule",{value:!0});rb.DEFAULT_HEADERS=void 0;const Hpe=nb;rb.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Hpe.version}`};var AW=Ra&&Ra.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(oI,"__esModule",{value:!0});const zpe=AW(eb),Kpe=AW(Yg),qpe=rb;let Ype=class IW{constructor(n,{headers:o={},schema:l,fetch:u}={}){this.url=n,this.headers=Object.assign(Object.assign({},qpe.DEFAULT_HEADERS),o),this.schemaName=l,this.fetch=u}from(n){const o=new URL(`${this.url}/${n}`);return new zpe.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new IW(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,o={},{head:l=!1,get:u=!1,count:m}={}){let g;const E=new URL(`${this.url}/rpc/${n}`);let y;l||u?(g=l?"HEAD":"GET",Object.entries(o).filter(([S,C])=>C!==void 0).map(([S,C])=>[S,Array.isArray(C)?`{${C.join(",")}}`:`${C}`]).forEach(([S,C])=>{E.searchParams.append(S,C)})):(g="POST",y=o);const x=Object.assign({},this.headers);return m&&(x.Prefer=`count=${m}`),new Kpe.default({method:g,url:E,headers:x,schema:this.schemaName,body:y,fetch:this.fetch,allowEmpty:!1})}};oI.default=Ype;var $g=Ra&&Ra.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Sa,"__esModule",{value:!0});Sa.PostgrestBuilder=Sa.PostgrestTransformBuilder=Sa.PostgrestFilterBuilder=Sa.PostgrestQueryBuilder=Sa.PostgrestClient=void 0;const DW=$g(oI);Sa.PostgrestClient=DW.default;const OW=$g(eb);Sa.PostgrestQueryBuilder=OW.default;const jW=$g(Yg);Sa.PostgrestFilterBuilder=jW.default;const PW=$g(tb);Sa.PostgrestTransformBuilder=PW.default;const kW=$g(sb);Sa.PostgrestBuilder=kW.default;var $pe=Sa.default={PostgrestClient:DW.default,PostgrestQueryBuilder:OW.default,PostgrestFilterBuilder:jW.default,PostgrestTransformBuilder:PW.default,PostgrestBuilder:kW.default};const{PostgrestClient:Xpe,PostgrestQueryBuilder:$Ce,PostgrestFilterBuilder:XCe,PostgrestTransformBuilder:JCe,PostgrestBuilder:QCe}=$pe,Jpe="2.10.2",Qpe={"X-Client-Info":`realtime-js/${Jpe}`},Zpe="1.0.0",LW=1e4,eme=1e3;var mp;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(mp||(mp={}));var Bi;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Bi||(Bi={}));var io;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(io||(io={}));var OR;(function(r){r.websocket="websocket"})(OR||(OR={}));var Hd;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Hd||(Hd={}));class tme{constructor(){this.HEADER_LENGTH=1}decode(n,o){return n.constructor===ArrayBuffer?o(this._binaryDecode(n)):o(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){const o=new DataView(n),l=new TextDecoder;return this._decodeBroadcast(n,o,l)}_decodeBroadcast(n,o,l){const u=o.getUint8(1),m=o.getUint8(2);let g=this.HEADER_LENGTH+2;const E=l.decode(n.slice(g,g+u));g=g+u;const y=l.decode(n.slice(g,g+m));g=g+m;const x=JSON.parse(l.decode(n.slice(g,n.byteLength)));return{ref:null,topic:E,event:y,payload:x}}}class MW{constructor(n,o){this.callback=n,this.timerCalc=o,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=o}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var sr;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(sr||(sr={}));const SB=(r,n,o={})=>{var l;const u=(l=o.skipTypes)!==null&&l!==void 0?l:[];return Object.keys(n).reduce((m,g)=>(m[g]=sme(g,r,n,u),m),{})},sme=(r,n,o,l)=>{const u=n.find(E=>E.name===r),m=u==null?void 0:u.type,g=o[r];return m&&!l.includes(m)?FW(m,g):jR(g)},FW=(r,n)=>{if(r.charAt(0)==="_"){const o=r.slice(1,r.length);return ame(n,o)}switch(r){case sr.bool:return rme(n);case sr.float4:case sr.float8:case sr.int2:case sr.int4:case sr.int8:case sr.numeric:case sr.oid:return nme(n);case sr.json:case sr.jsonb:return ime(n);case sr.timestamp:return ome(n);case sr.abstime:case sr.date:case sr.daterange:case sr.int4range:case sr.int8range:case sr.money:case sr.reltime:case sr.text:case sr.time:case sr.timestamptz:case sr.timetz:case sr.tsrange:case sr.tstzrange:return jR(n);default:return jR(n)}},jR=r=>r,rme=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},nme=r=>{if(typeof r=="string"){const n=parseFloat(r);if(!Number.isNaN(n))return n}return r},ime=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(n){return console.log(`JSON parse error: ${n}`),r}return r},ame=(r,n)=>{if(typeof r!="string")return r;const o=r.length-1,l=r[o];if(r[0]==="{"&&l==="}"){let m;const g=r.slice(1,o);try{m=JSON.parse("["+g+"]")}catch{m=g?g.split(","):[]}return m.map(E=>FW(n,E))}return r},ome=r=>typeof r=="string"?r.replace(" ","T"):r,UW=r=>{let n=r;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};class eN{constructor(n,o,l={},u=LW){this.channel=n,this.event=o,this.payload=l,this.timeout=u,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,o){var l;return this._hasReceived(n)&&o((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:n,callback:o}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const n=o=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=o,this._matchReceive(o)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,o){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:o})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:o}){this.recHooks.filter(l=>l.status===n).forEach(l=>l.callback(o))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}}var CB;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(CB||(CB={}));class ng{constructor(n,o){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=(o==null?void 0:o.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},u=>{const{onJoin:m,onLeave:g,onSync:E}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ng.syncState(this.state,u,m,g),this.pendingDiffs.forEach(y=>{this.state=ng.syncDiff(this.state,y,m,g)}),this.pendingDiffs=[],E()}),this.channel._on(l.diff,{},u=>{const{onJoin:m,onLeave:g,onSync:E}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(u):(this.state=ng.syncDiff(this.state,u,m,g),E())}),this.onJoin((u,m,g)=>{this.channel._trigger("presence",{event:"join",key:u,currentPresences:m,newPresences:g})}),this.onLeave((u,m,g)=>{this.channel._trigger("presence",{event:"leave",key:u,currentPresences:m,leftPresences:g})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,o,l,u){const m=this.cloneDeep(n),g=this.transformState(o),E={},y={};return this.map(m,(x,S)=>{g[x]||(y[x]=S)}),this.map(g,(x,S)=>{const C=m[x];if(C){const R=S.map(j=>j.presence_ref),M=C.map(j=>j.presence_ref),G=S.filter(j=>M.indexOf(j.presence_ref)<0),I=C.filter(j=>R.indexOf(j.presence_ref)<0);G.length>0&&(E[x]=G),I.length>0&&(y[x]=I)}else E[x]=S}),this.syncDiff(m,{joins:E,leaves:y},l,u)}static syncDiff(n,o,l,u){const{joins:m,leaves:g}={joins:this.transformState(o.joins),leaves:this.transformState(o.leaves)};return l||(l=()=>{}),u||(u=()=>{}),this.map(m,(E,y)=>{var x;const S=(x=n[E])!==null&&x!==void 0?x:[];if(n[E]=this.cloneDeep(y),S.length>0){const C=n[E].map(M=>M.presence_ref),R=S.filter(M=>C.indexOf(M.presence_ref)<0);n[E].unshift(...R)}l(E,S,y)}),this.map(g,(E,y)=>{let x=n[E];if(!x)return;const S=y.map(C=>C.presence_ref);x=x.filter(C=>S.indexOf(C.presence_ref)<0),n[E]=x,u(E,x,y),x.length===0&&delete n[E]}),n}static map(n,o){return Object.getOwnPropertyNames(n).map(l=>o(l,n[l]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((o,l)=>{const u=n[l];return"metas"in u?o[l]=u.metas.map(m=>(m.presence_ref=m.phx_ref,delete m.phx_ref,delete m.phx_ref_prev,m)):o[l]=u,o},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var TB;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(TB||(TB={}));var NB;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes"})(NB||(NB={}));var RB;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(RB||(RB={}));class lI{constructor(n,o={config:{}},l){this.topic=n,this.params=o,this.socket=l,this.bindings={},this.state=Bi.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},o.config),this.timeout=this.socket.timeout,this.joinPush=new eN(this,io.join,this.params,this.timeout),this.rejoinTimer=new MW(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bi.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(u=>u.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Bi.closed,this.socket._remove(this)}),this._onError(u=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,u),this.state=Bi.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bi.errored,this.rejoinTimer.scheduleTimeout())}),this._on(io.reply,{},(u,m)=>{this._trigger(this._replyEventName(m),u)}),this.presence=new ng(this),this.broadcastEndpointURL=UW(this.socket.endPoint)+"/api/broadcast"}subscribe(n,o=this.timeout){var l,u;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:m,presence:g,private:E}}=this.params;this._onError(S=>n&&n("CHANNEL_ERROR",S)),this._onClose(()=>n&&n("CLOSED"));const y={},x={broadcast:m,presence:g,postgres_changes:(u=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(S=>S.filter))!==null&&u!==void 0?u:[],private:E};this.socket.accessToken&&(y.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:x},y)),this.joinedOnce=!0,this._rejoin(o),this.joinPush.receive("ok",({postgres_changes:S})=>{var C;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),S===void 0){n&&n("SUBSCRIBED");return}else{const R=this.bindings.postgres_changes,M=(C=R==null?void 0:R.length)!==null&&C!==void 0?C:0,G=[];for(let I=0;I<M;I++){const j=R[I],{filter:{event:L,schema:N,table:D,filter:V}}=j,B=S&&S[I];if(B&&B.event===L&&B.schema===N&&B.table===D&&B.filter===V)G.push(Object.assign(Object.assign({},j),{id:B.id}));else{this.unsubscribe(),n&&n("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=G,n&&n("SUBSCRIBED");return}}).receive("error",S=>{n&&n("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{n&&n("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(n,o={}){return await this.send({type:"presence",event:"track",payload:n},o.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,o,l){return this._on(n,o,l)}async send(n,o={}){var l,u;if(!this._canPush()&&n.type==="broadcast"){const{event:m,payload:g}=n,E={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:m,payload:g}]})};try{const y=await this._fetchWithTimeout(this.broadcastEndpointURL,E,(l=o.timeout)!==null&&l!==void 0?l:this.timeout);return await((u=y.body)===null||u===void 0?void 0:u.cancel()),y.ok?"ok":"error"}catch(y){return y.name==="AbortError"?"timed out":"error"}}else return new Promise(m=>{var g,E,y;const x=this._push(n.type,n,o.timeout||this.timeout);n.type==="broadcast"&&!(!((y=(E=(g=this.params)===null||g===void 0?void 0:g.config)===null||E===void 0?void 0:E.broadcast)===null||y===void 0)&&y.ack)&&m("ok"),x.receive("ok",()=>m("ok")),x.receive("error",()=>m("error")),x.receive("timeout",()=>m("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=Bi.leaving;const o=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(io.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(l=>{const u=new eN(this,io.leave,{},n);u.receive("ok",()=>{o(),l("ok")}).receive("timeout",()=>{o(),l("timed out")}).receive("error",()=>{l("error")}),u.send(),this._canPush()||u.trigger("ok",{})})}async _fetchWithTimeout(n,o,l){const u=new AbortController,m=setTimeout(()=>u.abort(),l),g=await this.socket.fetch(n,Object.assign(Object.assign({},o),{signal:u.signal}));return clearTimeout(m),g}_push(n,o,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let u=new eN(this,n,o,l);return this._canPush()?u.send():(u.startTimeout(),this.pushBuffer.push(u)),u}_onMessage(n,o,l){return o}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,o,l){var u,m;const g=n.toLocaleLowerCase(),{close:E,error:y,leave:x,join:S}=io;if(l&&[E,y,x,S].indexOf(g)>=0&&l!==this._joinRef())return;let R=this._onMessage(g,o,l);if(o&&!R)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(g)?(u=this.bindings.postgres_changes)===null||u===void 0||u.filter(M=>{var G,I,j;return((G=M.filter)===null||G===void 0?void 0:G.event)==="*"||((j=(I=M.filter)===null||I===void 0?void 0:I.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===g}).map(M=>M.callback(R,l)):(m=this.bindings[g])===null||m===void 0||m.filter(M=>{var G,I,j,L,N,D;if(["broadcast","presence","postgres_changes"].includes(g))if("id"in M){const V=M.id,B=(G=M.filter)===null||G===void 0?void 0:G.event;return V&&((I=o.ids)===null||I===void 0?void 0:I.includes(V))&&(B==="*"||(B==null?void 0:B.toLocaleLowerCase())===((j=o.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const V=(N=(L=M==null?void 0:M.filter)===null||L===void 0?void 0:L.event)===null||N===void 0?void 0:N.toLocaleLowerCase();return V==="*"||V===((D=o==null?void 0:o.event)===null||D===void 0?void 0:D.toLocaleLowerCase())}else return M.type.toLocaleLowerCase()===g}).map(M=>{if(typeof R=="object"&&"ids"in R){const G=R.data,{schema:I,table:j,commit_timestamp:L,type:N,errors:D}=G;R=Object.assign(Object.assign({},{schema:I,table:j,commit_timestamp:L,eventType:N,new:{},old:{},errors:D}),this._getPayloadRecords(G))}M.callback(R,l)})}_isClosed(){return this.state===Bi.closed}_isJoined(){return this.state===Bi.joined}_isJoining(){return this.state===Bi.joining}_isLeaving(){return this.state===Bi.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,o,l){const u=n.toLocaleLowerCase(),m={type:u,filter:o,callback:l};return this.bindings[u]?this.bindings[u].push(m):this.bindings[u]=[m],this}_off(n,o){const l=n.toLocaleLowerCase();return this.bindings[l]=this.bindings[l].filter(u=>{var m;return!(((m=u.type)===null||m===void 0?void 0:m.toLocaleLowerCase())===l&&lI.isEqual(u.filter,o))}),this}static isEqual(n,o){if(Object.keys(n).length!==Object.keys(o).length)return!1;for(const l in n)if(n[l]!==o[l])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(io.close,{},n)}_onError(n){this._on(io.error,{},o=>n(o))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Bi.joining,this.joinPush.resend(n))}_getPayloadRecords(n){const o={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(o.new=SB(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(o.old=SB(n.columns,n.old_record)),o}}const cme=()=>{},lme=typeof WebSocket<"u";class dme{constructor(n,o){var l;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Qpe,this.params={},this.timeout=LW,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=cme,this.conn=null,this.sendBuffer=[],this.serializer=new tme,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=m=>{let g;return m?g=m:typeof fetch>"u"?g=(...E)=>jp(async()=>{const{default:y}=await Promise.resolve().then(()=>Hp);return{default:y}},void 0).then(({default:y})=>y(...E)):g=fetch,(...E)=>g(...E)},this.endPoint=`${n}/${OR.websocket}`,this.httpEndpoint=UW(n),o!=null&&o.transport?this.transport=o.transport:this.transport=null,o!=null&&o.params&&(this.params=o.params),o!=null&&o.headers&&(this.headers=Object.assign(Object.assign({},this.headers),o.headers)),o!=null&&o.timeout&&(this.timeout=o.timeout),o!=null&&o.logger&&(this.logger=o.logger),o!=null&&o.heartbeatIntervalMs&&(this.heartbeatIntervalMs=o.heartbeatIntervalMs);const u=(l=o==null?void 0:o.params)===null||l===void 0?void 0:l.apikey;u&&(this.accessToken=u,this.apiKey=u),this.reconnectAfterMs=o!=null&&o.reconnectAfterMs?o.reconnectAfterMs:m=>[1e3,2e3,5e3,1e4][m-1]||1e4,this.encode=o!=null&&o.encode?o.encode:(m,g)=>g(JSON.stringify(m)),this.decode=o!=null&&o.decode?o.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new MW(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(o==null?void 0:o.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(lme){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new ume(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),jp(async()=>{const{default:n}=await import("./browser-C4kW1nbT.js").then(o=>o.b);return{default:n}},[]).then(({default:n})=>{this.conn=new n(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(n,o){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,o??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){const o=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),o}async removeAllChannels(){const n=await Promise.all(this.channels.map(o=>o.unsubscribe()));return this.disconnect(),n}log(n,o,l){this.logger(n,o,l)}connectionState(){switch(this.conn&&this.conn.readyState){case mp.connecting:return Hd.Connecting;case mp.open:return Hd.Open;case mp.closing:return Hd.Closing;default:return Hd.Closed}}isConnected(){return this.connectionState()===Hd.Open}channel(n,o={config:{}}){const l=new lI(`realtime:${n}`,o,this);return this.channels.push(l),l}push(n){const{topic:o,event:l,payload:u,ref:m}=n,g=()=>{this.encode(n,E=>{var y;(y=this.conn)===null||y===void 0||y.send(E)})};this.log("push",`${o} ${l} (${m})`,u),this.isConnected()?g():this.sendBuffer.push(g)}setAuth(n){this.accessToken=n,this.channels.forEach(o=>{n&&o.updateJoinPayload({access_token:n}),o.joinedOnce&&o._isJoined()&&o._push(io.access_token,{access_token:n})})}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let o=this.channels.find(l=>l.topic===n&&(l._isJoined()||l._isJoining()));o&&(this.log("transport",`leaving duplicate topic "${n}"`),o.unsubscribe())}_remove(n){this.channels=this.channels.filter(o=>o._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Zpe}))}_onConnMessage(n){this.decode(n.data,o=>{let{topic:l,event:u,payload:m,ref:g}=o;(g&&g===this.pendingHeartbeatRef||u===(m==null?void 0:m.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${m.status||""} ${l} ${u} ${g&&"("+g+")"||""}`,m),this.channels.filter(E=>E._isMember(l)).forEach(E=>E._trigger(u,m,g)),this.stateChangeCallbacks.message.forEach(E=>E(o))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(o=>o(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(o=>o(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(io.error))}_appendParams(n,o){if(Object.keys(o).length===0)return n;const l=n.match(/\?/)?"&":"?",u=new URLSearchParams(o);return`${n}${l}${u}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(eme,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class ume{constructor(n,o,l){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=mp.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=l.close}}class dI extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}}function Pn(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class hme extends dI{constructor(n,o){super(n),this.name="StorageApiError",this.status=o}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class AB extends dI{constructor(n,o){super(n),this.name="StorageUnknownError",this.originalError=o}}var pme=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};const VW=r=>{let n;return r?n=r:typeof fetch>"u"?n=(...o)=>jp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...o)):n=fetch,(...o)=>n(...o)},mme=()=>pme(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield jp(()=>Promise.resolve().then(()=>Hp),void 0)).Response:Response});var zp=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};const tN=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),fme=(r,n)=>zp(void 0,void 0,void 0,function*(){const o=yield mme();r instanceof o?r.json().then(l=>{n(new hme(tN(l),r.status||500))}).catch(l=>{n(new AB(tN(l),l))}):n(new AB(tN(r),r))}),gme=(r,n,o,l)=>{const u={method:r,headers:(n==null?void 0:n.headers)||{}};return r==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json"},n==null?void 0:n.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),o))};function ib(r,n,o,l,u,m){return zp(this,void 0,void 0,function*(){return new Promise((g,E)=>{r(o,gme(n,l,u,m)).then(y=>{if(!y.ok)throw y;return l!=null&&l.noResolveJson?y:y.json()}).then(y=>g(y)).catch(y=>fme(y,E))})})}function PR(r,n,o,l){return zp(this,void 0,void 0,function*(){return ib(r,"GET",n,o,l)})}function vl(r,n,o,l,u){return zp(this,void 0,void 0,function*(){return ib(r,"POST",n,l,u,o)})}function _me(r,n,o,l,u){return zp(this,void 0,void 0,function*(){return ib(r,"PUT",n,l,u,o)})}function BW(r,n,o,l,u){return zp(this,void 0,void 0,function*(){return ib(r,"DELETE",n,l,u,o)})}var va=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};const vme={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},IB={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Eme{constructor(n,o={},l,u){this.url=n,this.headers=o,this.bucketId=l,this.fetch=VW(u)}uploadOrUpdate(n,o,l,u){return va(this,void 0,void 0,function*(){try{let m;const g=Object.assign(Object.assign({},IB),u),E=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(g.upsert)});typeof Blob<"u"&&l instanceof Blob?(m=new FormData,m.append("cacheControl",g.cacheControl),m.append("",l)):typeof FormData<"u"&&l instanceof FormData?(m=l,m.append("cacheControl",g.cacheControl)):(m=l,E["cache-control"]=`max-age=${g.cacheControl}`,E["content-type"]=g.contentType);const y=this._removeEmptyFolders(o),x=this._getFinalPath(y),S=yield this.fetch(`${this.url}/object/${x}`,Object.assign({method:n,body:m,headers:E},g!=null&&g.duplex?{duplex:g.duplex}:{})),C=yield S.json();return S.ok?{data:{path:y,id:C.Id,fullPath:C.Key},error:null}:{data:null,error:C}}catch(m){if(Pn(m))return{data:null,error:m};throw m}})}upload(n,o,l){return va(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,o,l)})}uploadToSignedUrl(n,o,l,u){return va(this,void 0,void 0,function*(){const m=this._removeEmptyFolders(n),g=this._getFinalPath(m),E=new URL(this.url+`/object/upload/sign/${g}`);E.searchParams.set("token",o);try{let y;const x=Object.assign({upsert:IB.upsert},u),S=Object.assign(Object.assign({},this.headers),{"x-upsert":String(x.upsert)});typeof Blob<"u"&&l instanceof Blob?(y=new FormData,y.append("cacheControl",x.cacheControl),y.append("",l)):typeof FormData<"u"&&l instanceof FormData?(y=l,y.append("cacheControl",x.cacheControl)):(y=l,S["cache-control"]=`max-age=${x.cacheControl}`,S["content-type"]=x.contentType);const C=yield this.fetch(E.toString(),{method:"PUT",body:y,headers:S}),R=yield C.json();return C.ok?{data:{path:m,fullPath:R.Key},error:null}:{data:null,error:R}}catch(y){if(Pn(y))return{data:null,error:y};throw y}})}createSignedUploadUrl(n,o){return va(this,void 0,void 0,function*(){try{let l=this._getFinalPath(n);const u=Object.assign({},this.headers);o!=null&&o.upsert&&(u["x-upsert"]="true");const m=yield vl(this.fetch,`${this.url}/object/upload/sign/${l}`,{},{headers:u}),g=new URL(this.url+m.url),E=g.searchParams.get("token");if(!E)throw new dI("No token returned by API");return{data:{signedUrl:g.toString(),path:n,token:E},error:null}}catch(l){if(Pn(l))return{data:null,error:l};throw l}})}update(n,o,l){return va(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,o,l)})}move(n,o,l){return va(this,void 0,void 0,function*(){try{return{data:yield vl(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:o,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers}),error:null}}catch(u){if(Pn(u))return{data:null,error:u};throw u}})}copy(n,o,l){return va(this,void 0,void 0,function*(){try{return{data:{path:(yield vl(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:o,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers})).Key},error:null}}catch(u){if(Pn(u))return{data:null,error:u};throw u}})}createSignedUrl(n,o,l){return va(this,void 0,void 0,function*(){try{let u=this._getFinalPath(n),m=yield vl(this.fetch,`${this.url}/object/sign/${u}`,Object.assign({expiresIn:o},l!=null&&l.transform?{transform:l.transform}:{}),{headers:this.headers});const g=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return m={signedUrl:encodeURI(`${this.url}${m.signedURL}${g}`)},{data:m,error:null}}catch(u){if(Pn(u))return{data:null,error:u};throw u}})}createSignedUrls(n,o,l){return va(this,void 0,void 0,function*(){try{const u=yield vl(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:o,paths:n},{headers:this.headers}),m=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return{data:u.map(g=>Object.assign(Object.assign({},g),{signedUrl:g.signedURL?encodeURI(`${this.url}${g.signedURL}${m}`):null})),error:null}}catch(u){if(Pn(u))return{data:null,error:u};throw u}})}download(n,o){return va(this,void 0,void 0,function*(){const u=typeof(o==null?void 0:o.transform)<"u"?"render/image/authenticated":"object",m=this.transformOptsToQueryString((o==null?void 0:o.transform)||{}),g=m?`?${m}`:"";try{const E=this._getFinalPath(n);return{data:yield(yield PR(this.fetch,`${this.url}/${u}/${E}${g}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(E){if(Pn(E))return{data:null,error:E};throw E}})}getPublicUrl(n,o){const l=this._getFinalPath(n),u=[],m=o!=null&&o.download?`download=${o.download===!0?"":o.download}`:"";m!==""&&u.push(m);const E=typeof(o==null?void 0:o.transform)<"u"?"render/image":"object",y=this.transformOptsToQueryString((o==null?void 0:o.transform)||{});y!==""&&u.push(y);let x=u.join("&");return x!==""&&(x=`?${x}`),{data:{publicUrl:encodeURI(`${this.url}/${E}/public/${l}${x}`)}}}remove(n){return va(this,void 0,void 0,function*(){try{return{data:yield BW(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(o){if(Pn(o))return{data:null,error:o};throw o}})}list(n,o,l){return va(this,void 0,void 0,function*(){try{const u=Object.assign(Object.assign(Object.assign({},vme),o),{prefix:n||""});return{data:yield vl(this.fetch,`${this.url}/object/list/${this.bucketId}`,u,{headers:this.headers},l),error:null}}catch(u){if(Pn(u))return{data:null,error:u};throw u}})}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const o=[];return n.width&&o.push(`width=${n.width}`),n.height&&o.push(`height=${n.height}`),n.resize&&o.push(`resize=${n.resize}`),n.format&&o.push(`format=${n.format}`),n.quality&&o.push(`quality=${n.quality}`),o.join("&")}}const yme="2.6.0",xme={"X-Client-Info":`storage-js/${yme}`};var Lh=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};class bme{constructor(n,o={},l){this.url=n,this.headers=Object.assign(Object.assign({},xme),o),this.fetch=VW(l)}listBuckets(){return Lh(this,void 0,void 0,function*(){try{return{data:yield PR(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(Pn(n))return{data:null,error:n};throw n}})}getBucket(n){return Lh(this,void 0,void 0,function*(){try{return{data:yield PR(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(o){if(Pn(o))return{data:null,error:o};throw o}})}createBucket(n,o={public:!1}){return Lh(this,void 0,void 0,function*(){try{return{data:yield vl(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(Pn(l))return{data:null,error:l};throw l}})}updateBucket(n,o){return Lh(this,void 0,void 0,function*(){try{return{data:yield _me(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(Pn(l))return{data:null,error:l};throw l}})}emptyBucket(n){return Lh(this,void 0,void 0,function*(){try{return{data:yield vl(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(o){if(Pn(o))return{data:null,error:o};throw o}})}deleteBucket(n){return Lh(this,void 0,void 0,function*(){try{return{data:yield BW(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(o){if(Pn(o))return{data:null,error:o};throw o}})}}class wme extends bme{constructor(n,o={},l){super(n,o,l)}from(n){return new Eme(this.url,this.headers,n,this.fetch)}}const Sme="2.45.1";let Kf="";typeof Deno<"u"?Kf="deno":typeof document<"u"?Kf="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Kf="react-native":Kf="node";const Cme={"X-Client-Info":`supabase-js-${Kf}/${Sme}`},Tme={headers:Cme},Nme={schema:"public"},Rme={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ame={};var Ime=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};const Dme=r=>{let n;return r?n=r:typeof fetch>"u"?n=TW:n=fetch,(...o)=>n(...o)},Ome=()=>typeof Headers>"u"?NW:Headers,jme=(r,n,o)=>{const l=Dme(o),u=Ome();return(m,g)=>Ime(void 0,void 0,void 0,function*(){var E;const y=(E=yield n())!==null&&E!==void 0?E:r;let x=new u(g==null?void 0:g.headers);return x.has("apikey")||x.set("apikey",r),x.has("Authorization")||x.set("Authorization",`Bearer ${y}`),l(m,Object.assign(Object.assign({},g),{headers:x}))})};var Pme=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};function kme(r){return r.replace(/\/$/,"")}function Lme(r,n){const{db:o,auth:l,realtime:u,global:m}=r,{db:g,auth:E,realtime:y,global:x}=n,S={db:Object.assign(Object.assign({},g),o),auth:Object.assign(Object.assign({},E),l),realtime:Object.assign(Object.assign({},y),u),global:Object.assign(Object.assign({},x),m),accessToken:()=>Pme(this,void 0,void 0,function*(){return""})};return r.accessToken?S.accessToken=r.accessToken:delete S.accessToken,S}const WW="2.64.4",Mme="http://localhost:9999",Fme="supabase.auth.token",Ume={"X-Client-Info":`gotrue-js/${WW}`},DB=10,kR="X-Supabase-Api-Version",GW={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Vme(r){return Math.round(Date.now()/1e3)+r}function Bme(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const n=Math.random()*16|0;return(r=="x"?n:n&3|8).toString(16)})}const Za=()=>typeof document<"u",jd={tested:!1,writable:!1},ig=()=>{if(!Za())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(jd.tested)return jd.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),jd.tested=!0,jd.writable=!0}catch{jd.tested=!0,jd.writable=!1}return jd.writable};function sN(r){const n={},o=new URL(r);if(o.hash&&o.hash[0]==="#")try{new URLSearchParams(o.hash.substring(1)).forEach((u,m)=>{n[m]=u})}catch{}return o.searchParams.forEach((l,u)=>{n[u]=l}),n}const HW=r=>{let n;return r?n=r:typeof fetch>"u"?n=(...o)=>jp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...o)):n=fetch,(...o)=>n(...o)},Wme=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",zW=async(r,n,o)=>{await r.setItem(n,JSON.stringify(o))},yy=async(r,n)=>{const o=await r.getItem(n);if(!o)return null;try{return JSON.parse(o)}catch{return o}},rN=async(r,n)=>{await r.removeItem(n)};function Gme(r){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let o="",l,u,m,g,E,y,x,S=0;for(r=r.replace("-","+").replace("_","/");S<r.length;)g=n.indexOf(r.charAt(S++)),E=n.indexOf(r.charAt(S++)),y=n.indexOf(r.charAt(S++)),x=n.indexOf(r.charAt(S++)),l=g<<2|E>>4,u=(E&15)<<4|y>>2,m=(y&3)<<6|x,o=o+String.fromCharCode(l),y!=64&&u!=0&&(o=o+String.fromCharCode(u)),x!=64&&m!=0&&(o=o+String.fromCharCode(m));return o}class ab{constructor(){this.promise=new ab.promiseConstructor((n,o)=>{this.resolve=n,this.reject=o})}}ab.promiseConstructor=Promise;function OB(r){const n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,o=r.split(".");if(o.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!n.test(o[1]))throw new Error("JWT is not valid: payload is not in base64url format");const l=o[1];return JSON.parse(Gme(l))}async function Hme(r){return await new Promise(n=>{setTimeout(()=>n(null),r)})}function zme(r,n){return new Promise((l,u)=>{(async()=>{for(let m=0;m<1/0;m++)try{const g=await r(m);if(!n(m,null,g)){l(g);return}}catch(g){if(!n(m,g)){u(g);return}}})()})}function Kme(r){return("0"+r.toString(16)).substr(-2)}function qme(){const n=new Uint32Array(56);if(typeof crypto>"u"){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=o.length;let u="";for(let m=0;m<56;m++)u+=o.charAt(Math.floor(Math.random()*l));return u}return crypto.getRandomValues(n),Array.from(n,Kme).join("")}async function Yme(r){const o=new TextEncoder().encode(r),l=await crypto.subtle.digest("SHA-256",o),u=new Uint8Array(l);return Array.from(u).map(m=>String.fromCharCode(m)).join("")}function $me(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Xme(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const o=await Yme(r);return $me(o)}async function Mh(r,n,o=!1){const l=qme();let u=l;o&&(u+="/PASSWORD_RECOVERY"),await zW(r,`${n}-code-verifier`,u);const m=await Xme(l);return[m,l===m?"plain":"s256"]}const Jme=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Qme(r){const n=r.headers.get(kR);if(!n||!n.match(Jme))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}class uI extends Error{constructor(n,o,l){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=o,this.code=l}}function gs(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Zme extends uI{constructor(n,o,l){super(n,o,l),this.name="AuthApiError",this.status=o,this.code=l}}function efe(r){return gs(r)&&r.name==="AuthApiError"}class KW extends uI{constructor(n,o){super(n),this.name="AuthUnknownError",this.originalError=o}}class hu extends uI{constructor(n,o,l,u){super(n,l,u),this.name=o,this.status=l}}class Pd extends hu{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class nN extends hu{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class xy extends hu{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}}class by extends hu{constructor(n,o=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jB extends hu{constructor(n,o=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class LR extends hu{constructor(n,o){super(n,"AuthRetryableFetchError",o,void 0)}}function iN(r){return gs(r)&&r.name==="AuthRetryableFetchError"}class PB extends hu{constructor(n,o,l){super(n,"AuthWeakPasswordError",o,"weak_password"),this.reasons=l}}var tfe=function(r,n){var o={};for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&n.indexOf(l)<0&&(o[l]=r[l]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(r);u<l.length;u++)n.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(r,l[u])&&(o[l[u]]=r[l[u]]);return o};const Vd=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),sfe=[502,503,504];async function kB(r){var n;if(!Wme(r))throw new LR(Vd(r),0);if(sfe.includes(r.status))throw new LR(Vd(r),r.status);let o;try{o=await r.json()}catch(m){throw new KW(Vd(m),m)}let l;const u=Qme(r);if(u&&u.getTime()>=GW["2024-01-01"].timestamp&&typeof o=="object"&&o&&typeof o.code=="string"?l=o.code:typeof o=="object"&&o&&typeof o.error_code=="string"&&(l=o.error_code),l){if(l==="weak_password")throw new PB(Vd(o),r.status,((n=o.weak_password)===null||n===void 0?void 0:n.reasons)||[])}else if(typeof o=="object"&&o&&typeof o.weak_password=="object"&&o.weak_password&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.reasons.reduce((m,g)=>m&&typeof g=="string",!0))throw new PB(Vd(o),r.status,o.weak_password.reasons);throw new Zme(Vd(o),r.status||500,l)}const rfe=(r,n,o,l)=>{const u={method:r,headers:(n==null?void 0:n.headers)||{}};return r==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n==null?void 0:n.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),o))};async function Ss(r,n,o,l){var u;const m=Object.assign({},l==null?void 0:l.headers);m[kR]||(m[kR]=GW["2024-01-01"].name),l!=null&&l.jwt&&(m.Authorization=`Bearer ${l.jwt}`);const g=(u=l==null?void 0:l.query)!==null&&u!==void 0?u:{};l!=null&&l.redirectTo&&(g.redirect_to=l.redirectTo);const E=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",y=await nfe(r,n,o+E,{headers:m,noResolveJson:l==null?void 0:l.noResolveJson},{},l==null?void 0:l.body);return l!=null&&l.xform?l==null?void 0:l.xform(y):{data:Object.assign({},y),error:null}}async function nfe(r,n,o,l,u,m){const g=rfe(n,l,u,m);let E;try{E=await r(o,Object.assign({},g))}catch(y){throw console.error(y),new LR(Vd(y),0)}if(E.ok||await kB(E),l!=null&&l.noResolveJson)return E;try{return await E.json()}catch(y){await kB(y)}}function pl(r){var n;let o=null;cfe(r)&&(o=Object.assign({},r),r.expires_at||(o.expires_at=Vme(r.expires_in)));const l=(n=r.user)!==null&&n!==void 0?n:r;return{data:{session:o,user:l},error:null}}function LB(r){const n=pl(r);return!n.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((o,l)=>o&&typeof l=="string",!0)&&(n.data.weak_password=r.weak_password),n}function xl(r){var n;return{data:{user:(n=r.user)!==null&&n!==void 0?n:r},error:null}}function ife(r){return{data:r,error:null}}function afe(r){const{action_link:n,email_otp:o,hashed_token:l,redirect_to:u,verification_type:m}=r,g=tfe(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),E={action_link:n,email_otp:o,hashed_token:l,redirect_to:u,verification_type:m},y=Object.assign({},g);return{data:{properties:E,user:y},error:null}}function ofe(r){return r}function cfe(r){return r.access_token&&r.refresh_token&&r.expires_in}var lfe=function(r,n){var o={};for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&n.indexOf(l)<0&&(o[l]=r[l]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(r);u<l.length;u++)n.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(r,l[u])&&(o[l[u]]=r[l[u]]);return o};class dfe{constructor({url:n="",headers:o={},fetch:l}){this.url=n,this.headers=o,this.fetch=HW(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,o="global"){try{return await Ss(this.fetch,"POST",`${this.url}/logout?scope=${o}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(l){if(gs(l))return{data:null,error:l};throw l}}async inviteUserByEmail(n,o={}){try{return await Ss(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:o.data},headers:this.headers,redirectTo:o.redirectTo,xform:xl})}catch(l){if(gs(l))return{data:{user:null},error:l};throw l}}async generateLink(n){try{const{options:o}=n,l=lfe(n,["options"]),u=Object.assign(Object.assign({},l),o);return"newEmail"in l&&(u.new_email=l==null?void 0:l.newEmail,delete u.newEmail),await Ss(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:u,headers:this.headers,xform:afe,redirectTo:o==null?void 0:o.redirectTo})}catch(o){if(gs(o))return{data:{properties:null,user:null},error:o};throw o}}async createUser(n){try{return await Ss(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:xl})}catch(o){if(gs(o))return{data:{user:null},error:o};throw o}}async listUsers(n){var o,l,u,m,g,E,y;try{const x={nextPage:null,lastPage:0,total:0},S=await Ss(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(o=n==null?void 0:n.page)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:"",per_page:(m=(u=n==null?void 0:n.perPage)===null||u===void 0?void 0:u.toString())!==null&&m!==void 0?m:""},xform:ofe});if(S.error)throw S.error;const C=await S.json(),R=(g=S.headers.get("x-total-count"))!==null&&g!==void 0?g:0,M=(y=(E=S.headers.get("link"))===null||E===void 0?void 0:E.split(","))!==null&&y!==void 0?y:[];return M.length>0&&(M.forEach(G=>{const I=parseInt(G.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(G.split(";")[1].split("=")[1]);x[`${j}Page`]=I}),x.total=parseInt(R)),{data:Object.assign(Object.assign({},C),x),error:null}}catch(x){if(gs(x))return{data:{users:[]},error:x};throw x}}async getUserById(n){try{return await Ss(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:xl})}catch(o){if(gs(o))return{data:{user:null},error:o};throw o}}async updateUserById(n,o){try{return await Ss(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:o,headers:this.headers,xform:xl})}catch(l){if(gs(l))return{data:{user:null},error:l};throw l}}async deleteUser(n,o=!1){try{return await Ss(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:o},xform:xl})}catch(l){if(gs(l))return{data:{user:null},error:l};throw l}}async _listFactors(n){try{const{data:o,error:l}=await Ss(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:u=>({data:{factors:u},error:null})});return{data:o,error:l}}catch(o){if(gs(o))return{data:null,error:o};throw o}}async _deleteFactor(n){try{return{data:await Ss(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(o){if(gs(o))return{data:null,error:o};throw o}}}const ufe={getItem:r=>ig()?globalThis.localStorage.getItem(r):null,setItem:(r,n)=>{ig()&&globalThis.localStorage.setItem(r,n)},removeItem:r=>{ig()&&globalThis.localStorage.removeItem(r)}};function MB(r={}){return{getItem:n=>r[n]||null,setItem:(n,o)=>{r[n]=o},removeItem:n=>{delete r[n]}}}function hfe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Fh={debug:!!(globalThis&&ig()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class qW extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}}class pfe extends qW{}async function mfe(r,n,o){Fh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,n);const l=new globalThis.AbortController;return n>0&&setTimeout(()=>{l.abort(),Fh.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},n),await globalThis.navigator.locks.request(r,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async u=>{if(u){Fh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,u.name);try{return await o()}finally{Fh.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,u.name)}}else{if(n===0)throw Fh.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new pfe(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Fh.debug)try{const m=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(m,null,"  "))}catch(m){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",m)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await o()}})}hfe();const ffe={url:Mme,storageKey:Fme,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ume,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Lf=30*1e3,FB=3;async function UB(r,n,o){return await o()}class jg{constructor(n){var o,l;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=jg.nextInstanceID,jg.nextInstanceID+=1,this.instanceID>0&&Za()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const u=Object.assign(Object.assign({},ffe),n);if(this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.persistSession=u.persistSession,this.storageKey=u.storageKey,this.autoRefreshToken=u.autoRefreshToken,this.admin=new dfe({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=HW(u.fetch),this.lock=u.lock||UB,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,u.lock?this.lock=u.lock:Za()&&(!((o=globalThis==null?void 0:globalThis.navigator)===null||o===void 0)&&o.locks)?this.lock=mfe:this.lock=UB,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?u.storage?this.storage=u.storage:ig()?this.storage=ufe:(this.memoryStorage={},this.storage=MB(this.memoryStorage)):(this.memoryStorage={},this.storage=MB(this.memoryStorage)),Za()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(m){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",m)}(l=this.broadcastChannel)===null||l===void 0||l.addEventListener("message",async m=>{this._debug("received broadcast notification from other tab or client",m),await this._notifyAllSubscribers(m.data.event,m.data.session,!1)})}this.initialize()}_debug(...n){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${WW}) ${new Date().toISOString()}`,...n),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const n=Za()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",n),n||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:o,error:l}=await this._getSessionFromURL(n);if(l)return this._debug("#_initialize()","error detecting session from URL",l),(l==null?void 0:l.message)==="Identity is already linked"||(l==null?void 0:l.message)==="Identity is already linked to another user"?{error:l}:(await this._removeSession(),{error:l});const{session:u,redirectType:m}=o;return this._debug("#_initialize()","detected session in URL",u,"redirect type",m),await this._saveSession(u),setTimeout(async()=>{m==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return gs(n)?{error:n}:{error:new KW("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(n){var o,l,u;try{const m=await Ss(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(o=n==null?void 0:n.options)===null||o===void 0?void 0:o.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(u=n==null?void 0:n.options)===null||u===void 0?void 0:u.captchaToken}},xform:pl}),{data:g,error:E}=m;if(E||!g)return{data:{user:null,session:null},error:E};const y=g.session,x=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(m){if(gs(m))return{data:{user:null,session:null},error:m};throw m}}async signUp(n){var o,l,u;try{let m;if("email"in n){const{email:S,password:C,options:R}=n;let M=null,G=null;this.flowType==="pkce"&&([M,G]=await Mh(this.storage,this.storageKey)),m=await Ss(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:R==null?void 0:R.emailRedirectTo,body:{email:S,password:C,data:(o=R==null?void 0:R.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken},code_challenge:M,code_challenge_method:G},xform:pl})}else if("phone"in n){const{phone:S,password:C,options:R}=n;m=await Ss(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:S,password:C,data:(l=R==null?void 0:R.data)!==null&&l!==void 0?l:{},channel:(u=R==null?void 0:R.channel)!==null&&u!==void 0?u:"sms",gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken}},xform:pl})}else throw new xy("You must provide either an email or phone number and a password");const{data:g,error:E}=m;if(E||!g)return{data:{user:null,session:null},error:E};const y=g.session,x=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(m){if(gs(m))return{data:{user:null,session:null},error:m};throw m}}async signInWithPassword(n){try{let o;if("email"in n){const{email:m,password:g,options:E}=n;o=await Ss(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:m,password:g,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken}},xform:LB})}else if("phone"in n){const{phone:m,password:g,options:E}=n;o=await Ss(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:m,password:g,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken}},xform:LB})}else throw new xy("You must provide either an email or phone number and a password");const{data:l,error:u}=o;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new nN}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:u})}catch(o){if(gs(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithOAuth(n){var o,l,u,m;return await this._handleProviderSignIn(n.provider,{redirectTo:(o=n.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=n.options)===null||l===void 0?void 0:l.scopes,queryParams:(u=n.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:(m=n.options)===null||m===void 0?void 0:m.skipBrowserRedirect})}async exchangeCodeForSession(n){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(n))}async _exchangeCodeForSession(n){const o=await yy(this.storage,`${this.storageKey}-code-verifier`),[l,u]=(o??"").split("/"),{data:m,error:g}=await Ss(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:n,code_verifier:l},xform:pl});return await rN(this.storage,`${this.storageKey}-code-verifier`),g?{data:{user:null,session:null,redirectType:null},error:g}:!m||!m.session||!m.user?{data:{user:null,session:null,redirectType:null},error:new nN}:(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),{data:Object.assign(Object.assign({},m),{redirectType:u??null}),error:g})}async signInWithIdToken(n){try{const{options:o,provider:l,token:u,access_token:m,nonce:g}=n,E=await Ss(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:u,access_token:m,nonce:g,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:pl}),{data:y,error:x}=E;return x?{data:{user:null,session:null},error:x}:!y||!y.session||!y.user?{data:{user:null,session:null},error:new nN}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:y,error:x})}catch(o){if(gs(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithOtp(n){var o,l,u,m,g;try{if("email"in n){const{email:E,options:y}=n;let x=null,S=null;this.flowType==="pkce"&&([x,S]=await Mh(this.storage,this.storageKey));const{error:C}=await Ss(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:E,data:(o=y==null?void 0:y.data)!==null&&o!==void 0?o:{},create_user:(l=y==null?void 0:y.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken},code_challenge:x,code_challenge_method:S},redirectTo:y==null?void 0:y.emailRedirectTo});return{data:{user:null,session:null},error:C}}if("phone"in n){const{phone:E,options:y}=n,{data:x,error:S}=await Ss(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:E,data:(u=y==null?void 0:y.data)!==null&&u!==void 0?u:{},create_user:(m=y==null?void 0:y.shouldCreateUser)!==null&&m!==void 0?m:!0,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken},channel:(g=y==null?void 0:y.channel)!==null&&g!==void 0?g:"sms"}});return{data:{user:null,session:null,messageId:x==null?void 0:x.message_id},error:S}}throw new xy("You must provide either an email or phone number.")}catch(E){if(gs(E))return{data:{user:null,session:null},error:E};throw E}}async verifyOtp(n){var o,l;try{let u,m;"options"in n&&(u=(o=n.options)===null||o===void 0?void 0:o.redirectTo,m=(l=n.options)===null||l===void 0?void 0:l.captchaToken);const{data:g,error:E}=await Ss(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},n),{gotrue_meta_security:{captcha_token:m}}),redirectTo:u,xform:pl});if(E)throw E;if(!g)throw new Error("An error occurred on token verification.");const y=g.session,x=g.user;return y!=null&&y.access_token&&(await this._saveSession(y),await this._notifyAllSubscribers(n.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(u){if(gs(u))return{data:{user:null,session:null},error:u};throw u}}async signInWithSSO(n){var o,l,u;try{let m=null,g=null;return this.flowType==="pkce"&&([m,g]=await Mh(this.storage,this.storageKey)),await Ss(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in n?{provider_id:n.providerId}:null),"domain"in n?{domain:n.domain}:null),{redirect_to:(l=(o=n.options)===null||o===void 0?void 0:o.redirectTo)!==null&&l!==void 0?l:void 0}),!((u=n==null?void 0:n.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:n.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:m,code_challenge_method:g}),headers:this.headers,xform:ife})}catch(m){if(gs(m))return{data:null,error:m};throw m}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async n=>{const{data:{session:o},error:l}=n;if(l)throw l;if(!o)throw new Pd;const{error:u}=await Ss(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:o.access_token});return{data:{user:null,session:null},error:u}})}catch(n){if(gs(n))return{data:{user:null,session:null},error:n};throw n}}async resend(n){try{const o=`${this.url}/resend`;if("email"in n){const{email:l,type:u,options:m}=n,{error:g}=await Ss(this.fetch,"POST",o,{headers:this.headers,body:{email:l,type:u,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},redirectTo:m==null?void 0:m.emailRedirectTo});return{data:{user:null,session:null},error:g}}else if("phone"in n){const{phone:l,type:u,options:m}=n,{data:g,error:E}=await Ss(this.fetch,"POST",o,{headers:this.headers,body:{phone:l,type:u,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}}});return{data:{user:null,session:null,messageId:g==null?void 0:g.message_id},error:E}}throw new xy("You must provide either an email or phone number and a type")}catch(o){if(gs(o))return{data:{user:null,session:null},error:o};throw o}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async o=>o))}async _acquireLock(n,o){this._debug("#_acquireLock","begin",n);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),u=(async()=>(await l,await o()))();return this.pendingInLock.push((async()=>{try{await u}catch{}})()),u}return await this.lock(`lock:${this.storageKey}`,n,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=o();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const u=[...this.pendingInLock];await Promise.all(u),this.pendingInLock.splice(0,u.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(n){this._debug("#_useSession","begin");try{const o=await this.__loadSession();return await n(o)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let n=null;const o=await yy(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",o),o!==null&&(this._isValidSession(o)?n=o:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!n)return{data:{session:null},error:null};const l=n.expires_at?n.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",n.expires_at),!l){if(this.storage.isServer){let g=this.suppressGetSessionWarning;n=new Proxy(n,{get:(y,x,S)=>(!g&&x==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),g=!0,this.suppressGetSessionWarning=!0),Reflect.get(y,x,S))})}return{data:{session:n},error:null}}const{session:u,error:m}=await this._callRefreshToken(n.refresh_token);return m?{data:{session:null},error:m}:{data:{session:u},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(n){return n?await this._getUser(n):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(n){try{return n?await Ss(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:n,xform:xl}):await this._useSession(async o=>{var l,u,m;const{data:g,error:E}=o;if(E)throw E;return!(!((l=g.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Pd}:await Ss(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(m=(u=g.session)===null||u===void 0?void 0:u.access_token)!==null&&m!==void 0?m:void 0,xform:xl})})}catch(o){if(gs(o))return{data:{user:null},error:o};throw o}}async updateUser(n,o={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(n,o))}async _updateUser(n,o={}){try{return await this._useSession(async l=>{const{data:u,error:m}=l;if(m)throw m;if(!u.session)throw new Pd;const g=u.session;let E=null,y=null;this.flowType==="pkce"&&n.email!=null&&([E,y]=await Mh(this.storage,this.storageKey));const{data:x,error:S}=await Ss(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:o==null?void 0:o.emailRedirectTo,body:Object.assign(Object.assign({},n),{code_challenge:E,code_challenge_method:y}),jwt:g.access_token,xform:xl});if(S)throw S;return g.user=x.user,await this._saveSession(g),await this._notifyAllSubscribers("USER_UPDATED",g),{data:{user:g.user},error:null}})}catch(l){if(gs(l))return{data:{user:null},error:l};throw l}}_decodeJWT(n){return OB(n)}async setSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(n))}async _setSession(n){try{if(!n.access_token||!n.refresh_token)throw new Pd;const o=Date.now()/1e3;let l=o,u=!0,m=null;const g=OB(n.access_token);if(g.exp&&(l=g.exp,u=l<=o),u){const{session:E,error:y}=await this._callRefreshToken(n.refresh_token);if(y)return{data:{user:null,session:null},error:y};if(!E)return{data:{user:null,session:null},error:null};m=E}else{const{data:E,error:y}=await this._getUser(n.access_token);if(y)throw y;m={access_token:n.access_token,refresh_token:n.refresh_token,user:E.user,token_type:"bearer",expires_in:l-o,expires_at:l},await this._saveSession(m),await this._notifyAllSubscribers("SIGNED_IN",m)}return{data:{user:m.user,session:m},error:null}}catch(o){if(gs(o))return{data:{session:null,user:null},error:o};throw o}}async refreshSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(n))}async _refreshSession(n){try{return await this._useSession(async o=>{var l;if(!n){const{data:g,error:E}=o;if(E)throw E;n=(l=g.session)!==null&&l!==void 0?l:void 0}if(!(n!=null&&n.refresh_token))throw new Pd;const{session:u,error:m}=await this._callRefreshToken(n.refresh_token);return m?{data:{user:null,session:null},error:m}:u?{data:{user:u.user,session:u},error:null}:{data:{user:null,session:null},error:null}})}catch(o){if(gs(o))return{data:{user:null,session:null},error:o};throw o}}async _getSessionFromURL(n){try{if(!Za())throw new by("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new by("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!n)throw new jB("Not a valid PKCE flow url.");const o=sN(window.location.href);if(n){if(!o.code)throw new jB("No code detected.");const{data:N,error:D}=await this._exchangeCodeForSession(o.code);if(D)throw D;const V=new URL(window.location.href);return V.searchParams.delete("code"),window.history.replaceState(window.history.state,"",V.toString()),{data:{session:N.session,redirectType:null},error:null}}if(o.error||o.error_description||o.error_code)throw new by(o.error_description||"Error in URL with unspecified error_description",{error:o.error||"unspecified_error",code:o.error_code||"unspecified_code"});const{provider_token:l,provider_refresh_token:u,access_token:m,refresh_token:g,expires_in:E,expires_at:y,token_type:x}=o;if(!m||!E||!g||!x)throw new by("No session defined in URL");const S=Math.round(Date.now()/1e3),C=parseInt(E);let R=S+C;y&&(R=parseInt(y));const M=R-S;M*1e3<=Lf&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${M}s, should have been closer to ${C}s`);const G=R-C;S-G>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",G,R,S):S-G<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",G,R,S);const{data:I,error:j}=await this._getUser(m);if(j)throw j;const L={provider_token:l,provider_refresh_token:u,access_token:m,expires_in:C,expires_at:R,refresh_token:g,token_type:x,user:I.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:L,redirectType:o.type},error:null}}catch(o){if(gs(o))return{data:{session:null,redirectType:null},error:o};throw o}}_isImplicitGrantFlow(){const n=sN(window.location.href);return!!(Za()&&(n.access_token||n.error_description))}async _isPKCEFlow(){const n=sN(window.location.href),o=await yy(this.storage,`${this.storageKey}-code-verifier`);return!!(n.code&&o)}async signOut(n={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(n))}async _signOut({scope:n}={scope:"global"}){return await this._useSession(async o=>{var l;const{data:u,error:m}=o;if(m)return{error:m};const g=(l=u.session)===null||l===void 0?void 0:l.access_token;if(g){const{error:E}=await this.admin.signOut(g,n);if(E&&!(efe(E)&&(E.status===404||E.status===401||E.status===403)))return{error:E}}return n!=="others"&&(await this._removeSession(),await rN(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(n){const o=Bme(),l={id:o,callback:n,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",o),this.stateChangeEmitters.delete(o)}};return this._debug("#onAuthStateChange()","registered callback with id",o),this.stateChangeEmitters.set(o,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(o)})))(),{data:{subscription:l}}}async _emitInitialSession(n){return await this._useSession(async o=>{var l,u;try{const{data:{session:m},error:g}=o;if(g)throw g;await((l=this.stateChangeEmitters.get(n))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",m)),this._debug("INITIAL_SESSION","callback id",n,"session",m)}catch(m){await((u=this.stateChangeEmitters.get(n))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",n,"error",m),console.error(m)}})}async resetPasswordForEmail(n,o={}){let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Mh(this.storage,this.storageKey,!0));try{return await Ss(this.fetch,"POST",`${this.url}/recover`,{body:{email:n,code_challenge:l,code_challenge_method:u,gotrue_meta_security:{captcha_token:o.captchaToken}},headers:this.headers,redirectTo:o.redirectTo})}catch(m){if(gs(m))return{data:null,error:m};throw m}}async getUserIdentities(){var n;try{const{data:o,error:l}=await this.getUser();if(l)throw l;return{data:{identities:(n=o.user.identities)!==null&&n!==void 0?n:[]},error:null}}catch(o){if(gs(o))return{data:null,error:o};throw o}}async linkIdentity(n){var o;try{const{data:l,error:u}=await this._useSession(async m=>{var g,E,y,x,S;const{data:C,error:R}=m;if(R)throw R;const M=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,n.provider,{redirectTo:(g=n.options)===null||g===void 0?void 0:g.redirectTo,scopes:(E=n.options)===null||E===void 0?void 0:E.scopes,queryParams:(y=n.options)===null||y===void 0?void 0:y.queryParams,skipBrowserRedirect:!0});return await Ss(this.fetch,"GET",M,{headers:this.headers,jwt:(S=(x=C.session)===null||x===void 0?void 0:x.access_token)!==null&&S!==void 0?S:void 0})});if(u)throw u;return Za()&&!(!((o=n.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(l==null?void 0:l.url),{data:{provider:n.provider,url:l==null?void 0:l.url},error:null}}catch(l){if(gs(l))return{data:{provider:n.provider,url:null},error:l};throw l}}async unlinkIdentity(n){try{return await this._useSession(async o=>{var l,u;const{data:m,error:g}=o;if(g)throw g;return await Ss(this.fetch,"DELETE",`${this.url}/user/identities/${n.identity_id}`,{headers:this.headers,jwt:(u=(l=m.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})})}catch(o){if(gs(o))return{data:null,error:o};throw o}}async _refreshAccessToken(n){const o=`#_refreshAccessToken(${n.substring(0,5)}...)`;this._debug(o,"begin");try{const l=Date.now();return await zme(async u=>(u>0&&await Hme(200*Math.pow(2,u-1)),this._debug(o,"refreshing attempt",u),await Ss(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:n},headers:this.headers,xform:pl})),(u,m)=>{const g=200*Math.pow(2,u);return m&&iN(m)&&Date.now()+g-l<Lf})}catch(l){if(this._debug(o,"error",l),gs(l))return{data:{session:null,user:null},error:l};throw l}finally{this._debug(o,"end")}}_isValidSession(n){return typeof n=="object"&&n!==null&&"access_token"in n&&"refresh_token"in n&&"expires_at"in n}async _handleProviderSignIn(n,o){const l=await this._getUrlForProvider(`${this.url}/authorize`,n,{redirectTo:o.redirectTo,scopes:o.scopes,queryParams:o.queryParams});return this._debug("#_handleProviderSignIn()","provider",n,"options",o,"url",l),Za()&&!o.skipBrowserRedirect&&window.location.assign(l),{data:{provider:n,url:l},error:null}}async _recoverAndRefresh(){var n;const o="#_recoverAndRefresh()";this._debug(o,"begin");try{const l=await yy(this.storage,this.storageKey);if(this._debug(o,"session from storage",l),!this._isValidSession(l)){this._debug(o,"session is not valid"),l!==null&&await this._removeSession();return}const u=Math.round(Date.now()/1e3),m=((n=l.expires_at)!==null&&n!==void 0?n:1/0)<u+DB;if(this._debug(o,`session has${m?"":" not"} expired with margin of ${DB}s`),m){if(this.autoRefreshToken&&l.refresh_token){const{error:g}=await this._callRefreshToken(l.refresh_token);g&&(console.error(g),iN(g)||(this._debug(o,"refresh failed with a non-retryable error, removing the session",g),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",l)}catch(l){this._debug(o,"error",l),console.error(l);return}finally{this._debug(o,"end")}}async _callRefreshToken(n){var o,l;if(!n)throw new Pd;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const u=`#_callRefreshToken(${n.substring(0,5)}...)`;this._debug(u,"begin");try{this.refreshingDeferred=new ab;const{data:m,error:g}=await this._refreshAccessToken(n);if(g)throw g;if(!m.session)throw new Pd;await this._saveSession(m.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",m.session);const E={session:m.session,error:null};return this.refreshingDeferred.resolve(E),E}catch(m){if(this._debug(u,"error",m),gs(m)){const g={session:null,error:m};return iN(m)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(o=this.refreshingDeferred)===null||o===void 0||o.resolve(g),g}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(m),m}finally{this.refreshingDeferred=null,this._debug(u,"end")}}async _notifyAllSubscribers(n,o,l=!0){const u=`#_notifyAllSubscribers(${n})`;this._debug(u,"begin",o,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:n,session:o});const m=[],g=Array.from(this.stateChangeEmitters.values()).map(async E=>{try{await E.callback(n,o)}catch(y){m.push(y)}});if(await Promise.all(g),m.length>0){for(let E=0;E<m.length;E+=1)console.error(m[E]);throw m[0]}}finally{this._debug(u,"end")}}async _saveSession(n){this._debug("#_saveSession()",n),this.suppressGetSessionWarning=!0,await zW(this.storage,this.storageKey,n)}async _removeSession(){this._debug("#_removeSession()"),await rN(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const n=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{n&&Za()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",n)}catch(o){console.error("removing visibilitychange callback failed",o)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const n=setInterval(()=>this._autoRefreshTokenTick(),Lf);this.autoRefreshTicker=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const n=this.autoRefreshTicker;this.autoRefreshTicker=null,n&&clearInterval(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const n=Date.now();try{return await this._useSession(async o=>{const{data:{session:l}}=o;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const u=Math.floor((l.expires_at*1e3-n)/Lf);this._debug("#_autoRefreshTokenTick()",`access token expires in ${u} ticks, a tick lasts ${Lf}ms, refresh threshold is ${FB} ticks`),u<=FB&&await this._callRefreshToken(l.refresh_token)})}catch(o){console.error("Auto refresh tick failed with error. This is likely a transient error.",o)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(n){if(n.isAcquireTimeout||n instanceof qW)this._debug("auto refresh token tick lock not available");else throw n}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Za()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(n){console.error("_handleVisibilityChange",n)}}async _onVisibilityChanged(n){const o=`#_onVisibilityChanged(${n})`;this._debug(o,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),n||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(o,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(n,o,l){const u=[`provider=${encodeURIComponent(o)}`];if(l!=null&&l.redirectTo&&u.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l!=null&&l.scopes&&u.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[m,g]=await Mh(this.storage,this.storageKey),E=new URLSearchParams({code_challenge:`${encodeURIComponent(m)}`,code_challenge_method:`${encodeURIComponent(g)}`});u.push(E.toString())}if(l!=null&&l.queryParams){const m=new URLSearchParams(l.queryParams);u.push(m.toString())}return l!=null&&l.skipBrowserRedirect&&u.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${n}?${u.join("&")}`}async _unenroll(n){try{return await this._useSession(async o=>{var l;const{data:u,error:m}=o;return m?{data:null,error:m}:await Ss(this.fetch,"DELETE",`${this.url}/factors/${n.factorId}`,{headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token})})}catch(o){if(gs(o))return{data:null,error:o};throw o}}async _enroll(n){try{return await this._useSession(async o=>{var l,u;const{data:m,error:g}=o;if(g)return{data:null,error:g};const{data:E,error:y}=await Ss(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:n.friendlyName,factor_type:n.factorType,issuer:n.issuer},headers:this.headers,jwt:(l=m==null?void 0:m.session)===null||l===void 0?void 0:l.access_token});return y?{data:null,error:y}:(!((u=E==null?void 0:E.totp)===null||u===void 0)&&u.qr_code&&(E.totp.qr_code=`data:image/svg+xml;utf-8,${E.totp.qr_code}`),{data:E,error:null})})}catch(o){if(gs(o))return{data:null,error:o};throw o}}async _verify(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async o=>{var l;const{data:u,error:m}=o;if(m)return{data:null,error:m};const{data:g,error:E}=await Ss(this.fetch,"POST",`${this.url}/factors/${n.factorId}/verify`,{body:{code:n.code,challenge_id:n.challengeId},headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token});return E?{data:null,error:E}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+g.expires_in},g)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",g),{data:g,error:E})})}catch(o){if(gs(o))return{data:null,error:o};throw o}})}async _challenge(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async o=>{var l;const{data:u,error:m}=o;return m?{data:null,error:m}:await Ss(this.fetch,"POST",`${this.url}/factors/${n.factorId}/challenge`,{headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token})})}catch(o){if(gs(o))return{data:null,error:o};throw o}})}async _challengeAndVerify(n){const{data:o,error:l}=await this._challenge({factorId:n.factorId});return l?{data:null,error:l}:await this._verify({factorId:n.factorId,challengeId:o.id,code:n.code})}async _listFactors(){const{data:{user:n},error:o}=await this.getUser();if(o)return{data:null,error:o};const l=(n==null?void 0:n.factors)||[],u=l.filter(m=>m.factor_type==="totp"&&m.status==="verified");return{data:{all:l,totp:u},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async n=>{var o,l;const{data:{session:u},error:m}=n;if(m)return{data:null,error:m};if(!u)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const g=this._decodeJWT(u.access_token);let E=null;g.aal&&(E=g.aal);let y=E;((l=(o=u.user.factors)===null||o===void 0?void 0:o.filter(C=>C.status==="verified"))!==null&&l!==void 0?l:[]).length>0&&(y="aal2");const S=g.amr||[];return{data:{currentLevel:E,nextLevel:y,currentAuthenticationMethods:S},error:null}}))}}jg.nextInstanceID=0;const gfe=jg;class _fe extends gfe{constructor(n){super(n)}}var vfe=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};class Efe{constructor(n,o,l){var u,m,g;if(this.supabaseUrl=n,this.supabaseKey=o,!n)throw new Error("supabaseUrl is required.");if(!o)throw new Error("supabaseKey is required.");const E=kme(n);this.realtimeUrl=`${E}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${E}/auth/v1`,this.storageUrl=`${E}/storage/v1`,this.functionsUrl=`${E}/functions/v1`;const y=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,x={db:Nme,realtime:Ame,auth:Object.assign(Object.assign({},Rme),{storageKey:y}),global:Tme},S=Lme(l??{},x);this.storageKey=(u=S.auth.storageKey)!==null&&u!==void 0?u:"",this.headers=(m=S.global.headers)!==null&&m!==void 0?m:{},S.accessToken?(this.accessToken=S.accessToken,this.auth=new Proxy({},{get:(C,R)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(R)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((g=S.auth)!==null&&g!==void 0?g:{},this.headers,S.global.fetch),this.fetch=jme(o,this._getAccessToken.bind(this),S.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},S.realtime)),this.rest=new Xpe(`${E}/rest/v1`,{headers:this.headers,schema:S.db.schema,fetch:this.fetch}),S.accessToken||this._listenForAuthEvents()}get functions(){return new Tpe(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new wme(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,o={},l={}){return this.rest.rpc(n,o,l)}channel(n,o={config:{}}){return this.realtime.channel(n,o)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,o;return vfe(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:l}=yield this.auth.getSession();return(o=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:o,detectSessionInUrl:l,storage:u,storageKey:m,flowType:g,lock:E,debug:y},x,S){var C;const R={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new _fe({url:this.authUrl,headers:Object.assign(Object.assign({},R),x),storageKey:m,autoRefreshToken:n,persistSession:o,detectSessionInUrl:l,storage:u,flowType:g,lock:E,debug:y,fetch:S,hasCustomAuthorizationHeader:(C="Authorization"in this.headers)!==null&&C!==void 0?C:!1})}_initRealtimeClient(n){return new dme(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((o,l)=>{this._handleTokenChanged(o,"CLIENT",l==null?void 0:l.access_token)})}_handleTokenChanged(n,o,l){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==l?(this.realtime.setAuth(l??null),this.changedAccessToken=l):n==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),o=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const yfe=(r,n,o)=>new Efe(r,n,o),YW=typeof import.meta<"u"&&"https://iktldcrkyphkvxjwmxyb.supabase.co"||"",$W=typeof import.meta<"u"&&"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlrdGxkY3JreXBoa3Z4andteHliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTM4NTUsImV4cCI6MjA3ODYyOTg1NX0.ToXGJWTGBj0xaKp6EEHJY0H3hrqW122CE486oju4opI"||"";(!YW||!$W)&&console.warn("Supabase URL or anon key is not set. Auth will not work correctly until these env vars are configured.");const ie=yfe(YW,$W),XW=O.createContext(void 0),hI=r=>(r.split("@")[0]||"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()||"user",xfe=({redirectTo:r,role:n}={})=>{if(typeof window>"u")return;const o=new URL("/auth/callback",window.location.origin);return r&&r.startsWith("/")&&o.searchParams.set("redirect",r),n&&o.searchParams.set("role",n),o.toString()},JW=(r,n)=>({id:r.id,email:r.email,role:r.role,username:(n==null?void 0:n.username)||hI(r.email),user_metadata:void 0,creatorProfileStatus:(n==null?void 0:n.creator_profile_status)||r.creator_profile_status}),bfe=r=>new Promise(n=>setTimeout(n,r)),wfe=new Set([429,503]),VB=3,Sfe=4e3,Cfe=async(r,n)=>{var y,x;const{data:o,error:l}=await ie.from("users").select("id,email,role,creator_profile_status").eq("id",r.id).maybeSingle();if(l&&l.code!=="PGRST116")throw l;if(o)return o;const u=((y=r.user_metadata)==null?void 0:y.role)??n??"fan",m=r.email??((x=r.user_metadata)==null?void 0:x.email)??"unknown@fanmeet.app",{data:g,error:E}=await ie.from("users").insert({id:r.id,email:m,role:u}).select("id,email,role,creator_profile_status").single();if(E||!g)throw E??new Error("Could not create user record.");return g},Tfe=async(r,n)=>{const{data:o,error:l}=await ie.from("profiles").select("username, creator_profile_status").eq("user_id",n.id).maybeSingle();if(!l&&o)return o;const u=hI(r.email??n.email),m=u.charAt(0).toUpperCase()+u.slice(1),{data:g,error:E}=await ie.from("profiles").insert({user_id:n.id,username:u,display_name:m,creator_profile_status:n.role==="creator"?"pending":void 0}).select("username, creator_profile_status").single();return E?(console.error("Failed to create profile row:",E),null):g},aN=async(r,n)=>{const o=await Cfe(r,n),l=await Tfe(r,o);return JW(o,l)},Nfe=({children:r})=>{const[n,o]=O.useState(null),[l,u]=O.useState(!0);O.useEffect(()=>{(async()=>{try{const{data:{user:I}}=await ie.auth.getUser();if(!I)return;const j=await aN(I);o(j)}catch(I){console.error("Failed to load user:",I)}finally{u(!1)}})()},[]);const m=async({email:G,password:I})=>{const{data:j,error:L}=await ie.auth.signInWithPassword({email:G,password:I});if(L||!j.user)throw new Error("Invalid email or password.");if(!j.user.email_confirmed_at)throw await ie.auth.signOut(),new Error("Please verify your email before logging in.");const N=await aN(j.user);return o(N),N},g=async({email:G,password:I,role:j})=>{const L=typeof window<"u"?`${window.location.origin}/auth/callback`:void 0;let N=null,D=null;for(let H=1;H<=VB;H+=1){const{data:J,error:ee}=await ie.auth.signUp({email:G,password:I,options:{emailRedirectTo:L,data:{role:j}}});if(!ee&&J.user){N=J.user;break}D=ee;const ne=(ee==null?void 0:ee.status)??0;if(!wfe.has(ne)||H===VB)break;const he=Sfe*H;console.warn(`Signup rate limited (attempt ${H}). Retrying in ${he}ms.`),await bfe(he)}if(!N)throw(D==null?void 0:D.status)===429?new Error("Too many signup attempts in a short time. Please wait ~30 seconds and try again."):new Error((D==null?void 0:D.message)??"Could not create account.");const B={username:hI(G),creator_profile_status:j==="creator"?"pending":void 0},z=JW({id:N.id,email:N.email??G,role:j},B);if(!N.email_confirmed_at)return z;try{const H=await aN(N,j);return o(H),H}catch(H){return console.error("Failed to finalize signup profile:",H),o(z),z}},E=async G=>{const I=xfe(G),{error:j}=await ie.auth.signInWithOAuth({provider:"google",options:{redirectTo:I,queryParams:{access_type:"offline",prompt:"consent"}}});if(j)throw new Error(j.message||"Could not start Google sign-in.")},y=async({email:G,redirectTo:I})=>{const j=I??(typeof window<"u"?`${window.location.origin}/auth/update-password`:void 0),{error:L}=await ie.auth.resetPasswordForEmail(G,{redirectTo:j});if(L)throw new Error(L.message||"Could not send password reset email.")},x=async({email:G,redirectTo:I})=>{const j=I??(typeof window<"u"?`${window.location.origin}/auth/callback`:void 0),L=ie.auth,{error:N}=await L.resend({type:"signup",email:G,options:{emailRedirectTo:j}});if(N)throw new Error(N.message||"Could not resend verification email.")},S=async()=>{try{await ie.auth.signOut()}finally{o(null)}},[C,R]=O.useState(new Set);O.useEffect(()=>{if(!n)return;const G=ie.channel("online-users");return G.on("presence",{event:"sync"},()=>{const I=G.presenceState(),j=new Set;Object.values(I).forEach(L=>{L.forEach(N=>{N.user_id&&j.add(N.user_id)})}),R(j)}).subscribe(async I=>{I==="SUBSCRIBED"&&await G.track({user_id:n.id,online_at:new Date().toISOString()})}),()=>{G.unsubscribe()}},[n]);const M=O.useMemo(()=>({user:n,isAuthenticated:!!n,isLoading:l,login:m,signup:g,loginWithGoogle:E,sendPasswordResetEmail:y,resendVerificationEmail:x,logout:S,onlineUsers:C}),[l,n,C]);return i.jsx(XW.Provider,{value:M,children:r})},vs=()=>{const r=O.useContext(XW);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},Rfe=[{title:"For Fans",links:[{label:"Browse Events",to:"/browse-events"},{label:"How It Works",to:"/how-it-works"},{label:"Pricing",to:"/pricing"},{label:"FAQs",to:"/faq"},{label:"Free Events",to:"/free-events"}]},{title:"For Creators",links:[{label:"Apply Now",to:"/apply"},{label:"Creator Guide",to:"/creator-guide"},{label:"Earnings Calculator",to:"/earnings-calculator"},{label:"Success Stories",to:"/success-stories"},{label:"Creator FAQs",to:"/faq"}]},{title:"Company",links:[{label:"About Us",to:"/about"},{label:"Our Team",to:"/team"},{label:"Press & Media",to:"/press"},{label:"Careers (We're Hiring!)",to:"/careers"},{label:"Blog",to:"/blog"}]},{title:"Support",links:[{label:"Help Center",to:"/help-center"},{label:"Contact Us",to:"/contact"},{label:"Terms of Service",to:"/terms-of-service"},{label:"Privacy Policy",to:"/privacy-policy"},{label:"Refund Policy",to:"/refund-policy"},{label:"Cancellation Policy",to:"/cancellation-policy"}]}];function Afe(){return i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-14 text-white md:px-12",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"grid gap-10 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,3fr)]",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"text-2xl font-bold text-[#C045FF]",children:"FanMeet"}),i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Connecting fans and creators, one call at a time."}),i.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-[#ADB5BD]",children:[i.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:"Razorpay"}),i.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:"UPI"}),i.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:"Visa"}),i.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:"Mastercard"})]})]}),i.jsx("div",{className:"grid gap-8 sm:grid-cols-2 lg:grid-cols-4",children:Rfe.map(r=>i.jsxs("div",{children:[i.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:r.title}),i.jsx("ul",{className:"mt-3 space-y-2 text-sm text-[#ADB5BD]",children:r.links.map(n=>i.jsx("li",{children:i.jsx(oo,{className:"hover:text-white",to:n.to,children:n.label})},n.label))})]},r.title))})]}),i.jsxs("div",{className:"mt-10 border-t border-[#343A40] pt-6 text-center text-xs text-[#6C757D]",children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})]})})}const Uh=({isActive:r})=>`text-base font-medium transition-colors ${r?"text-[#C045FF]":"text-[#6C757D] hover:text-[#C045FF]"}`,Ife=()=>{const r=Ns(),n=Ac(),[o,l]=O.useState(!1),{isAuthenticated:u,user:m}=vs(),g=n.pathname==="/",E=()=>{(m==null?void 0:m.role)==="fan"?r("/fan"):(m==null?void 0:m.role)==="creator"?r("/creator"):(m==null?void 0:m.role)==="admin"&&r("/admin")};return i.jsxs("div",{className:"min-h-screen bg-[#FFFFFF]",children:[!g&&i.jsxs(i.Fragment,{children:[i.jsxs("header",{className:"sticky top-0 z-50 flex h-[70px] items-center justify-between border-b border-[#E9ECEF] bg-white px-6 md:px-12",children:[i.jsxs("div",{className:"flex items-center gap-6 md:gap-10",children:[i.jsx(hl,{to:"/",className:"flex items-center gap-2 text-2xl font-bold text-[#C045FF]",children:"FanMeet"}),i.jsxs("nav",{className:"hidden gap-6 md:flex",children:[i.jsx(hl,{to:"/browse-events",className:Uh,children:"Browse Events"}),i.jsx(hl,{to:"/how-it-works",className:Uh,children:"How It Works"}),i.jsx(hl,{to:"/for-creators",className:Uh,children:"For Creators"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"hidden items-center gap-3 md:flex",children:u?i.jsx(oe,{size:"sm",onClick:E,children:(m==null?void 0:m.role)==="fan"?" Fan Dashboard":(m==null?void 0:m.role)==="creator"?" Creator Dashboard":"Dashboard"}):i.jsxs(i.Fragment,{children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r("/auth"),children:"Login"}),i.jsx(oe,{size:"sm",onClick:()=>r("/auth"),children:"Get Started"})]})}),i.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-md border border-[#E9ECEF] p-2 text-[#343A40] md:hidden",onClick:()=>l(y=>!y),children:[i.jsx("span",{className:"sr-only",children:"Toggle navigation"}),i.jsxs("div",{className:"flex flex-col gap-[3px]",children:[i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"})]})]})]})]}),o&&i.jsx("div",{className:"border-b border-[#E9ECEF] bg-white px-6 py-3 md:hidden",children:i.jsxs("nav",{className:"flex flex-col gap-3",children:[i.jsx(hl,{to:"/browse-events",className:Uh,onClick:()=>l(!1),children:"Browse Events"}),i.jsx(hl,{to:"/how-it-works",className:Uh,onClick:()=>l(!1),children:"How It Works"}),i.jsx(hl,{to:"/for-creators",className:Uh,onClick:()=>l(!1),children:"For Creators"}),i.jsx("div",{className:"mt-2 flex flex-col gap-2",children:u?i.jsx(oe,{size:"sm",className:"w-full",onClick:()=>{l(!1),E()},children:(m==null?void 0:m.role)==="fan"?" Fan Dashboard":(m==null?void 0:m.role)==="creator"?" Creator Dashboard":"Dashboard"}):i.jsxs(i.Fragment,{children:[i.jsx(oe,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{l(!1),r("/auth")},children:"Login"}),i.jsx(oe,{size:"sm",className:"w-full",onClick:()=>{l(!1),r("/auth")},children:"Get Started"})]})})]})})]}),i.jsx("main",{className:"bg-gradient-to-b from-white to-[#FFE5D9]",children:i.jsx(EW,{})}),i.jsx(Afe,{})]})},We=(r,n="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:n}).format(r),Gt=r=>new Intl.DateTimeFormat("en-IN",{dateStyle:"medium",timeStyle:"short"}).format(typeof r=="string"?new Date(r):r),tp=(...r)=>r.filter(Boolean).join(" "),QW=O.createContext(void 0),Dfe=({children:r})=>{const[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(!0),{user:E}=vs(),y=O.useMemo(()=>n.filter(D=>!D.read).length,[n]),x=O.useMemo(()=>l.filter(D=>!D.read&&D.receiver_id===(E==null?void 0:E.id)).length,[l,E]),S=async()=>{if(!E){o([]);return}const{data:D,error:V}=await ie.from("notifications").select("*").eq("user_id",E.id).order("created_at",{ascending:!1}).limit(50);V?console.error("Error fetching notifications:",V):o(D||[])},C=async()=>{if(!E){u([]);return}const{data:D,error:V}=await ie.from("messages").select("*").or(`sender_id.eq.${E.id},receiver_id.eq.${E.id}`).order("created_at",{ascending:!0});if(V){console.error("Error fetching messages:",V);return}if(D&&D.length>0){const B=[...new Set([...D.map(ee=>ee.sender_id),...D.map(ee=>ee.receiver_id)])],{data:z}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",B),H=new Map((z==null?void 0:z.map(ee=>[ee.user_id,ee]))||[]),J=D.map(ee=>{var ne,he,ve,ye;return{...ee,sender_username:(ne=H.get(ee.sender_id))==null?void 0:ne.username,sender_display_name:(he=H.get(ee.sender_id))==null?void 0:he.display_name,receiver_username:(ve=H.get(ee.receiver_id))==null?void 0:ve.username,receiver_display_name:(ye=H.get(ee.receiver_id))==null?void 0:ye.display_name}});u(J)}else u([])};O.useEffect(()=>{(async()=>{g(!0),await Promise.all([S(),C()]),g(!1)})()},[E]);const R=async D=>{const{error:V}=await ie.from("notifications").update({read:!0}).eq("id",D);V?console.error("Error marking notification as read:",V):o(B=>B.map(z=>z.id===D?{...z,read:!0}:z))},M=async()=>{if(!E)return;const{error:D}=await ie.from("notifications").update({read:!0}).eq("user_id",E.id).eq("read",!1);D?console.error("Error marking all notifications as read:",D):o(V=>V.map(B=>({...B,read:!0})))},G=async D=>{const{error:V}=await ie.from("messages").update({read:!0}).eq("id",D);V?console.error("Error marking message as read:",V):u(B=>B.map(z=>z.id===D?{...z,read:!0}:z))},I=async(D,V,B)=>{if(!E)throw new Error("User not logged in");const{error:z}=await ie.from("messages").insert({sender_id:E.id,receiver_id:D,message:V,meet_id:B||null});if(z)throw console.error("Error sending message:",z),z;await C()},j=async()=>{await S()},L=async()=>{await C()},N=O.useMemo(()=>({notifications:n,messages:l,unreadNotificationsCount:y,unreadMessagesCount:x,isLoading:m,markNotificationAsRead:R,markAllNotificationsAsRead:M,markMessageAsRead:G,sendMessage:I,refreshNotifications:j,refreshMessages:L}),[n,l,y,x,m]);return i.jsx(QW.Provider,{value:N,children:r})},Xg=()=>{const r=O.useContext(QW);if(!r)throw new Error("useNotifications must be used within a NotificationsProvider");return r};function wx(r){"@babel/helpers - typeof";return wx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wx(r)}function lu(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}function Zn(r,n){if(n.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+n.length+" present")}function $o(r){Zn(1,arguments);var n=Object.prototype.toString.call(r);return r instanceof Date||wx(r)==="object"&&n==="[object Date]"?new Date(r.getTime()):typeof r=="number"||n==="[object Number]"?new Date(r):((typeof r=="string"||n==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Ofe(r,n){Zn(2,arguments);var o=$o(r).getTime(),l=lu(n);return new Date(o+l)}var jfe={};function ob(){return jfe}function Pfe(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}function kfe(r){return Zn(1,arguments),r instanceof Date||wx(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function Lfe(r){if(Zn(1,arguments),!kfe(r)&&typeof r!="number")return!1;var n=$o(r);return!isNaN(Number(n))}function Mfe(r,n){Zn(2,arguments);var o=lu(n);return Ofe(r,-o)}var Ffe=864e5;function Ufe(r){Zn(1,arguments);var n=$o(r),o=n.getTime();n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0);var l=n.getTime(),u=o-l;return Math.floor(u/Ffe)+1}function Sx(r){Zn(1,arguments);var n=1,o=$o(r),l=o.getUTCDay(),u=(l<n?7:0)+l-n;return o.setUTCDate(o.getUTCDate()-u),o.setUTCHours(0,0,0,0),o}function ZW(r){Zn(1,arguments);var n=$o(r),o=n.getUTCFullYear(),l=new Date(0);l.setUTCFullYear(o+1,0,4),l.setUTCHours(0,0,0,0);var u=Sx(l),m=new Date(0);m.setUTCFullYear(o,0,4),m.setUTCHours(0,0,0,0);var g=Sx(m);return n.getTime()>=u.getTime()?o+1:n.getTime()>=g.getTime()?o:o-1}function Vfe(r){Zn(1,arguments);var n=ZW(r),o=new Date(0);o.setUTCFullYear(n,0,4),o.setUTCHours(0,0,0,0);var l=Sx(o);return l}var Bfe=6048e5;function Wfe(r){Zn(1,arguments);var n=$o(r),o=Sx(n).getTime()-Vfe(n).getTime();return Math.round(o/Bfe)+1}function Cx(r,n){var o,l,u,m,g,E,y,x;Zn(1,arguments);var S=ob(),C=lu((o=(l=(u=(m=n==null?void 0:n.weekStartsOn)!==null&&m!==void 0?m:n==null||(g=n.locale)===null||g===void 0||(E=g.options)===null||E===void 0?void 0:E.weekStartsOn)!==null&&u!==void 0?u:S.weekStartsOn)!==null&&l!==void 0?l:(y=S.locale)===null||y===void 0||(x=y.options)===null||x===void 0?void 0:x.weekStartsOn)!==null&&o!==void 0?o:0);if(!(C>=0&&C<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var R=$o(r),M=R.getUTCDay(),G=(M<C?7:0)+M-C;return R.setUTCDate(R.getUTCDate()-G),R.setUTCHours(0,0,0,0),R}function eG(r,n){var o,l,u,m,g,E,y,x;Zn(1,arguments);var S=$o(r),C=S.getUTCFullYear(),R=ob(),M=lu((o=(l=(u=(m=n==null?void 0:n.firstWeekContainsDate)!==null&&m!==void 0?m:n==null||(g=n.locale)===null||g===void 0||(E=g.options)===null||E===void 0?void 0:E.firstWeekContainsDate)!==null&&u!==void 0?u:R.firstWeekContainsDate)!==null&&l!==void 0?l:(y=R.locale)===null||y===void 0||(x=y.options)===null||x===void 0?void 0:x.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(M>=1&&M<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var G=new Date(0);G.setUTCFullYear(C+1,0,M),G.setUTCHours(0,0,0,0);var I=Cx(G,n),j=new Date(0);j.setUTCFullYear(C,0,M),j.setUTCHours(0,0,0,0);var L=Cx(j,n);return S.getTime()>=I.getTime()?C+1:S.getTime()>=L.getTime()?C:C-1}function Gfe(r,n){var o,l,u,m,g,E,y,x;Zn(1,arguments);var S=ob(),C=lu((o=(l=(u=(m=n==null?void 0:n.firstWeekContainsDate)!==null&&m!==void 0?m:n==null||(g=n.locale)===null||g===void 0||(E=g.options)===null||E===void 0?void 0:E.firstWeekContainsDate)!==null&&u!==void 0?u:S.firstWeekContainsDate)!==null&&l!==void 0?l:(y=S.locale)===null||y===void 0||(x=y.options)===null||x===void 0?void 0:x.firstWeekContainsDate)!==null&&o!==void 0?o:1),R=eG(r,n),M=new Date(0);M.setUTCFullYear(R,0,C),M.setUTCHours(0,0,0,0);var G=Cx(M,n);return G}var Hfe=6048e5;function zfe(r,n){Zn(1,arguments);var o=$o(r),l=Cx(o,n).getTime()-Gfe(o,n).getTime();return Math.round(l/Hfe)+1}function Gs(r,n){for(var o=r<0?"-":"",l=Math.abs(r).toString();l.length<n;)l="0"+l;return o+l}var dl={y:function(n,o){var l=n.getUTCFullYear(),u=l>0?l:1-l;return Gs(o==="yy"?u%100:u,o.length)},M:function(n,o){var l=n.getUTCMonth();return o==="M"?String(l+1):Gs(l+1,2)},d:function(n,o){return Gs(n.getUTCDate(),o.length)},a:function(n,o){var l=n.getUTCHours()/12>=1?"pm":"am";switch(o){case"a":case"aa":return l.toUpperCase();case"aaa":return l;case"aaaaa":return l[0];case"aaaa":default:return l==="am"?"a.m.":"p.m."}},h:function(n,o){return Gs(n.getUTCHours()%12||12,o.length)},H:function(n,o){return Gs(n.getUTCHours(),o.length)},m:function(n,o){return Gs(n.getUTCMinutes(),o.length)},s:function(n,o){return Gs(n.getUTCSeconds(),o.length)},S:function(n,o){var l=o.length,u=n.getUTCMilliseconds(),m=Math.floor(u*Math.pow(10,l-3));return Gs(m,o.length)}},Vh={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Kfe={G:function(n,o,l){var u=n.getUTCFullYear()>0?1:0;switch(o){case"G":case"GG":case"GGG":return l.era(u,{width:"abbreviated"});case"GGGGG":return l.era(u,{width:"narrow"});case"GGGG":default:return l.era(u,{width:"wide"})}},y:function(n,o,l){if(o==="yo"){var u=n.getUTCFullYear(),m=u>0?u:1-u;return l.ordinalNumber(m,{unit:"year"})}return dl.y(n,o)},Y:function(n,o,l,u){var m=eG(n,u),g=m>0?m:1-m;if(o==="YY"){var E=g%100;return Gs(E,2)}return o==="Yo"?l.ordinalNumber(g,{unit:"year"}):Gs(g,o.length)},R:function(n,o){var l=ZW(n);return Gs(l,o.length)},u:function(n,o){var l=n.getUTCFullYear();return Gs(l,o.length)},Q:function(n,o,l){var u=Math.ceil((n.getUTCMonth()+1)/3);switch(o){case"Q":return String(u);case"QQ":return Gs(u,2);case"Qo":return l.ordinalNumber(u,{unit:"quarter"});case"QQQ":return l.quarter(u,{width:"abbreviated",context:"formatting"});case"QQQQQ":return l.quarter(u,{width:"narrow",context:"formatting"});case"QQQQ":default:return l.quarter(u,{width:"wide",context:"formatting"})}},q:function(n,o,l){var u=Math.ceil((n.getUTCMonth()+1)/3);switch(o){case"q":return String(u);case"qq":return Gs(u,2);case"qo":return l.ordinalNumber(u,{unit:"quarter"});case"qqq":return l.quarter(u,{width:"abbreviated",context:"standalone"});case"qqqqq":return l.quarter(u,{width:"narrow",context:"standalone"});case"qqqq":default:return l.quarter(u,{width:"wide",context:"standalone"})}},M:function(n,o,l){var u=n.getUTCMonth();switch(o){case"M":case"MM":return dl.M(n,o);case"Mo":return l.ordinalNumber(u+1,{unit:"month"});case"MMM":return l.month(u,{width:"abbreviated",context:"formatting"});case"MMMMM":return l.month(u,{width:"narrow",context:"formatting"});case"MMMM":default:return l.month(u,{width:"wide",context:"formatting"})}},L:function(n,o,l){var u=n.getUTCMonth();switch(o){case"L":return String(u+1);case"LL":return Gs(u+1,2);case"Lo":return l.ordinalNumber(u+1,{unit:"month"});case"LLL":return l.month(u,{width:"abbreviated",context:"standalone"});case"LLLLL":return l.month(u,{width:"narrow",context:"standalone"});case"LLLL":default:return l.month(u,{width:"wide",context:"standalone"})}},w:function(n,o,l,u){var m=zfe(n,u);return o==="wo"?l.ordinalNumber(m,{unit:"week"}):Gs(m,o.length)},I:function(n,o,l){var u=Wfe(n);return o==="Io"?l.ordinalNumber(u,{unit:"week"}):Gs(u,o.length)},d:function(n,o,l){return o==="do"?l.ordinalNumber(n.getUTCDate(),{unit:"date"}):dl.d(n,o)},D:function(n,o,l){var u=Ufe(n);return o==="Do"?l.ordinalNumber(u,{unit:"dayOfYear"}):Gs(u,o.length)},E:function(n,o,l){var u=n.getUTCDay();switch(o){case"E":case"EE":case"EEE":return l.day(u,{width:"abbreviated",context:"formatting"});case"EEEEE":return l.day(u,{width:"narrow",context:"formatting"});case"EEEEEE":return l.day(u,{width:"short",context:"formatting"});case"EEEE":default:return l.day(u,{width:"wide",context:"formatting"})}},e:function(n,o,l,u){var m=n.getUTCDay(),g=(m-u.weekStartsOn+8)%7||7;switch(o){case"e":return String(g);case"ee":return Gs(g,2);case"eo":return l.ordinalNumber(g,{unit:"day"});case"eee":return l.day(m,{width:"abbreviated",context:"formatting"});case"eeeee":return l.day(m,{width:"narrow",context:"formatting"});case"eeeeee":return l.day(m,{width:"short",context:"formatting"});case"eeee":default:return l.day(m,{width:"wide",context:"formatting"})}},c:function(n,o,l,u){var m=n.getUTCDay(),g=(m-u.weekStartsOn+8)%7||7;switch(o){case"c":return String(g);case"cc":return Gs(g,o.length);case"co":return l.ordinalNumber(g,{unit:"day"});case"ccc":return l.day(m,{width:"abbreviated",context:"standalone"});case"ccccc":return l.day(m,{width:"narrow",context:"standalone"});case"cccccc":return l.day(m,{width:"short",context:"standalone"});case"cccc":default:return l.day(m,{width:"wide",context:"standalone"})}},i:function(n,o,l){var u=n.getUTCDay(),m=u===0?7:u;switch(o){case"i":return String(m);case"ii":return Gs(m,o.length);case"io":return l.ordinalNumber(m,{unit:"day"});case"iii":return l.day(u,{width:"abbreviated",context:"formatting"});case"iiiii":return l.day(u,{width:"narrow",context:"formatting"});case"iiiiii":return l.day(u,{width:"short",context:"formatting"});case"iiii":default:return l.day(u,{width:"wide",context:"formatting"})}},a:function(n,o,l){var u=n.getUTCHours(),m=u/12>=1?"pm":"am";switch(o){case"a":case"aa":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"});case"aaa":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return l.dayPeriod(m,{width:"narrow",context:"formatting"});case"aaaa":default:return l.dayPeriod(m,{width:"wide",context:"formatting"})}},b:function(n,o,l){var u=n.getUTCHours(),m;switch(u===12?m=Vh.noon:u===0?m=Vh.midnight:m=u/12>=1?"pm":"am",o){case"b":case"bb":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"});case"bbb":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return l.dayPeriod(m,{width:"narrow",context:"formatting"});case"bbbb":default:return l.dayPeriod(m,{width:"wide",context:"formatting"})}},B:function(n,o,l){var u=n.getUTCHours(),m;switch(u>=17?m=Vh.evening:u>=12?m=Vh.afternoon:u>=4?m=Vh.morning:m=Vh.night,o){case"B":case"BB":case"BBB":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"});case"BBBBB":return l.dayPeriod(m,{width:"narrow",context:"formatting"});case"BBBB":default:return l.dayPeriod(m,{width:"wide",context:"formatting"})}},h:function(n,o,l){if(o==="ho"){var u=n.getUTCHours()%12;return u===0&&(u=12),l.ordinalNumber(u,{unit:"hour"})}return dl.h(n,o)},H:function(n,o,l){return o==="Ho"?l.ordinalNumber(n.getUTCHours(),{unit:"hour"}):dl.H(n,o)},K:function(n,o,l){var u=n.getUTCHours()%12;return o==="Ko"?l.ordinalNumber(u,{unit:"hour"}):Gs(u,o.length)},k:function(n,o,l){var u=n.getUTCHours();return u===0&&(u=24),o==="ko"?l.ordinalNumber(u,{unit:"hour"}):Gs(u,o.length)},m:function(n,o,l){return o==="mo"?l.ordinalNumber(n.getUTCMinutes(),{unit:"minute"}):dl.m(n,o)},s:function(n,o,l){return o==="so"?l.ordinalNumber(n.getUTCSeconds(),{unit:"second"}):dl.s(n,o)},S:function(n,o){return dl.S(n,o)},X:function(n,o,l,u){var m=u._originalDate||n,g=m.getTimezoneOffset();if(g===0)return"Z";switch(o){case"X":return WB(g);case"XXXX":case"XX":return Bd(g);case"XXXXX":case"XXX":default:return Bd(g,":")}},x:function(n,o,l,u){var m=u._originalDate||n,g=m.getTimezoneOffset();switch(o){case"x":return WB(g);case"xxxx":case"xx":return Bd(g);case"xxxxx":case"xxx":default:return Bd(g,":")}},O:function(n,o,l,u){var m=u._originalDate||n,g=m.getTimezoneOffset();switch(o){case"O":case"OO":case"OOO":return"GMT"+BB(g,":");case"OOOO":default:return"GMT"+Bd(g,":")}},z:function(n,o,l,u){var m=u._originalDate||n,g=m.getTimezoneOffset();switch(o){case"z":case"zz":case"zzz":return"GMT"+BB(g,":");case"zzzz":default:return"GMT"+Bd(g,":")}},t:function(n,o,l,u){var m=u._originalDate||n,g=Math.floor(m.getTime()/1e3);return Gs(g,o.length)},T:function(n,o,l,u){var m=u._originalDate||n,g=m.getTime();return Gs(g,o.length)}};function BB(r,n){var o=r>0?"-":"+",l=Math.abs(r),u=Math.floor(l/60),m=l%60;if(m===0)return o+String(u);var g=n;return o+String(u)+g+Gs(m,2)}function WB(r,n){if(r%60===0){var o=r>0?"-":"+";return o+Gs(Math.abs(r)/60,2)}return Bd(r,n)}function Bd(r,n){var o=n||"",l=r>0?"-":"+",u=Math.abs(r),m=Gs(Math.floor(u/60),2),g=Gs(u%60,2);return l+m+o+g}var GB=function(n,o){switch(n){case"P":return o.date({width:"short"});case"PP":return o.date({width:"medium"});case"PPP":return o.date({width:"long"});case"PPPP":default:return o.date({width:"full"})}},tG=function(n,o){switch(n){case"p":return o.time({width:"short"});case"pp":return o.time({width:"medium"});case"ppp":return o.time({width:"long"});case"pppp":default:return o.time({width:"full"})}},qfe=function(n,o){var l=n.match(/(P+)(p+)?/)||[],u=l[1],m=l[2];if(!m)return GB(n,o);var g;switch(u){case"P":g=o.dateTime({width:"short"});break;case"PP":g=o.dateTime({width:"medium"});break;case"PPP":g=o.dateTime({width:"long"});break;case"PPPP":default:g=o.dateTime({width:"full"});break}return g.replace("{{date}}",GB(u,o)).replace("{{time}}",tG(m,o))},Yfe={p:tG,P:qfe},$fe=["D","DD"],Xfe=["YY","YYYY"];function Jfe(r){return $fe.indexOf(r)!==-1}function Qfe(r){return Xfe.indexOf(r)!==-1}function HB(r,n,o){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(n,"`) for formatting years to the input `").concat(o,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(n,"`) for formatting years to the input `").concat(o,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(n,"`) for formatting days of the month to the input `").concat(o,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(n,"`) for formatting days of the month to the input `").concat(o,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Zfe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},ege=function(n,o,l){var u,m=Zfe[n];return typeof m=="string"?u=m:o===1?u=m.one:u=m.other.replace("{{count}}",o.toString()),l!=null&&l.addSuffix?l.comparison&&l.comparison>0?"in "+u:u+" ago":u};function oN(r){return function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=n.width?String(n.width):r.defaultWidth,l=r.formats[o]||r.formats[r.defaultWidth];return l}}var tge={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},sge={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},rge={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},nge={date:oN({formats:tge,defaultWidth:"full"}),time:oN({formats:sge,defaultWidth:"full"}),dateTime:oN({formats:rge,defaultWidth:"full"})},ige={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},age=function(n,o,l,u){return ige[n]};function Mf(r){return function(n,o){var l=o!=null&&o.context?String(o.context):"standalone",u;if(l==="formatting"&&r.formattingValues){var m=r.defaultFormattingWidth||r.defaultWidth,g=o!=null&&o.width?String(o.width):m;u=r.formattingValues[g]||r.formattingValues[m]}else{var E=r.defaultWidth,y=o!=null&&o.width?String(o.width):r.defaultWidth;u=r.values[y]||r.values[E]}var x=r.argumentCallback?r.argumentCallback(n):n;return u[x]}}var oge={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},cge={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},lge={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dge={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},uge={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},hge={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pge=function(n,o){var l=Number(n),u=l%100;if(u>20||u<10)switch(u%10){case 1:return l+"st";case 2:return l+"nd";case 3:return l+"rd"}return l+"th"},mge={ordinalNumber:pge,era:Mf({values:oge,defaultWidth:"wide"}),quarter:Mf({values:cge,defaultWidth:"wide",argumentCallback:function(n){return n-1}}),month:Mf({values:lge,defaultWidth:"wide"}),day:Mf({values:dge,defaultWidth:"wide"}),dayPeriod:Mf({values:uge,defaultWidth:"wide",formattingValues:hge,defaultFormattingWidth:"wide"})};function Ff(r){return function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=o.width,u=l&&r.matchPatterns[l]||r.matchPatterns[r.defaultMatchWidth],m=n.match(u);if(!m)return null;var g=m[0],E=l&&r.parsePatterns[l]||r.parsePatterns[r.defaultParseWidth],y=Array.isArray(E)?gge(E,function(C){return C.test(g)}):fge(E,function(C){return C.test(g)}),x;x=r.valueCallback?r.valueCallback(y):y,x=o.valueCallback?o.valueCallback(x):x;var S=n.slice(g.length);return{value:x,rest:S}}}function fge(r,n){for(var o in r)if(r.hasOwnProperty(o)&&n(r[o]))return o}function gge(r,n){for(var o=0;o<r.length;o++)if(n(r[o]))return o}function _ge(r){return function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=n.match(r.matchPattern);if(!l)return null;var u=l[0],m=n.match(r.parsePattern);if(!m)return null;var g=r.valueCallback?r.valueCallback(m[0]):m[0];g=o.valueCallback?o.valueCallback(g):g;var E=n.slice(u.length);return{value:g,rest:E}}}var vge=/^(\d+)(th|st|nd|rd)?/i,Ege=/\d+/i,yge={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},xge={any:[/^b/i,/^(a|c)/i]},bge={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},wge={any:[/1/i,/2/i,/3/i,/4/i]},Sge={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Cge={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Tge={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Nge={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Rge={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Age={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ige={ordinalNumber:_ge({matchPattern:vge,parsePattern:Ege,valueCallback:function(n){return parseInt(n,10)}}),era:Ff({matchPatterns:yge,defaultMatchWidth:"wide",parsePatterns:xge,defaultParseWidth:"any"}),quarter:Ff({matchPatterns:bge,defaultMatchWidth:"wide",parsePatterns:wge,defaultParseWidth:"any",valueCallback:function(n){return n+1}}),month:Ff({matchPatterns:Sge,defaultMatchWidth:"wide",parsePatterns:Cge,defaultParseWidth:"any"}),day:Ff({matchPatterns:Tge,defaultMatchWidth:"wide",parsePatterns:Nge,defaultParseWidth:"any"}),dayPeriod:Ff({matchPatterns:Rge,defaultMatchWidth:"any",parsePatterns:Age,defaultParseWidth:"any"})},Dge={code:"en-US",formatDistance:ege,formatLong:nge,formatRelative:age,localize:mge,match:Ige,options:{weekStartsOn:0,firstWeekContainsDate:1}},Oge=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,jge=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Pge=/^'([^]*?)'?$/,kge=/''/g,Lge=/[a-zA-Z]/;function Bl(r,n,o){var l,u,m,g,E,y,x,S,C,R,M,G,I,j;Zn(2,arguments);var L=String(n),N=ob(),D=(l=(u=void 0)!==null&&u!==void 0?u:N.locale)!==null&&l!==void 0?l:Dge,V=lu((m=(g=(E=(y=void 0)!==null&&y!==void 0?y:void 0)!==null&&E!==void 0?E:N.firstWeekContainsDate)!==null&&g!==void 0?g:(x=N.locale)===null||x===void 0||(S=x.options)===null||S===void 0?void 0:S.firstWeekContainsDate)!==null&&m!==void 0?m:1);if(!(V>=1&&V<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var B=lu((C=(R=(M=(G=void 0)!==null&&G!==void 0?G:void 0)!==null&&M!==void 0?M:N.weekStartsOn)!==null&&R!==void 0?R:(I=N.locale)===null||I===void 0||(j=I.options)===null||j===void 0?void 0:j.weekStartsOn)!==null&&C!==void 0?C:0);if(!(B>=0&&B<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!D.localize)throw new RangeError("locale must contain localize property");if(!D.formatLong)throw new RangeError("locale must contain formatLong property");var z=$o(r);if(!Lfe(z))throw new RangeError("Invalid time value");var H=Pfe(z),J=Mfe(z,H),ee={firstWeekContainsDate:V,weekStartsOn:B,locale:D,_originalDate:z},ne=L.match(jge).map(function(he){var ve=he[0];if(ve==="p"||ve==="P"){var ye=Yfe[ve];return ye(he,D.formatLong)}return he}).join("").match(Oge).map(function(he){if(he==="''")return"'";var ve=he[0];if(ve==="'")return Mge(he);var ye=Kfe[ve];if(ye)return Qfe(he)&&HB(he,n,String(r)),Jfe(he)&&HB(he,n,String(r)),ye(J,he,D.localize,ee);if(ve.match(Lge))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ve+"`");return he}).join("");return ne}function Mge(r){var n=r.match(Pge);return n?n[1].replace(kge,"'"):r}const Fge={fan:{title:"Fan Dashboard",menu:[{type:"link",to:"/fan",label:"Browse Events",icon:""},{type:"link",to:"/fan/following",label:"Following",icon:""},{type:"link",to:"/fan/bids",label:"My Bids",icon:""},{type:"link",to:"/fan/meets",label:"Upcoming Meets",icon:""},{type:"link",to:"/fan/history",label:"History",icon:""},{type:"link",to:"/fan/wallet",label:"Payment History",icon:""},{type:"link",to:"/fan/messages",label:"Messages",icon:""},{type:"link",to:"/fan/notifications",label:"Notifications",icon:""},{type:"link",to:"/fan/settings",label:"Settings",icon:""},{type:"link",to:"/fan/support",label:"Help & Support",icon:""}]},creator:{title:"Creator Control Room",menu:[{type:"link",to:"/creator",label:"Overview",icon:""},{type:"link",to:"/creator/events",label:"My Events",icon:""},{type:"link",to:"/creator/events/new",label:"Create Event",icon:""},{type:"link",to:"/creator/profile-setup",label:"Profile Setup",icon:""},{type:"link",to:"/creator/followers",label:"Followers",icon:""},{type:"link",to:"/creator/earnings",label:"Earnings",icon:""},{type:"link",to:"/creator/withdrawals",label:"Withdrawals",icon:""},{type:"link",to:"/creator/meets",label:"Upcoming Meets",icon:""},{type:"link",to:"/creator/messages",label:"Messages",icon:""},{type:"link",to:"/creator/notifications",label:"Notifications",icon:""},{type:"link",to:"/creator/settings",label:"Settings",icon:""},{type:"link",to:"/creator/support",label:"Help & Support",icon:""}]},admin:{title:"Admin Command Center",menu:[{type:"link",to:"/admin",label:"Dashboard",icon:""},{type:"section",label:"USER MANAGEMENT"},{type:"link",to:"/admin/users",label:"All Users",icon:""},{type:"link",to:"/admin/creators",label:"Creators Management",icon:""},{type:"link",to:"/admin/fans",label:"Fans Management",icon:""},{type:"section",label:"CONTENT MANAGEMENT"},{type:"link",to:"/admin/events",label:"Events Management",icon:""},{type:"link",to:"/admin/featured",label:"Featured Creators",icon:""},{type:"link",to:"/admin/announcements",label:"Announcements",icon:""},{type:"section",label:"FINANCIAL"},{type:"link",to:"/admin/payments",label:"Payments & Transactions",icon:""},{type:"link",to:"/admin/withdrawals",label:"Withdrawal Requests",icon:""},{type:"link",to:"/admin/refunds",label:"Refunds Management",icon:""},{type:"link",to:"/admin/revenue-analytics",label:"Revenue Analytics",icon:""},{type:"link",to:"/admin/platform-commission",label:"Platform Commission",icon:""},{type:"section",label:"REPORTS & ANALYTICS"},{type:"link",to:"/admin/business-analytics",label:"Business Analytics",icon:""},{type:"link",to:"/admin/user-analytics",label:"User Analytics",icon:""},{type:"link",to:"/admin/revenue-reports",label:"Revenue Reports",icon:""},{type:"link",to:"/admin/event-analytics",label:"Event Analytics",icon:""},{type:"link",to:"/admin/audit-logs",label:"Audit Logs",icon:""},{type:"section",label:"SUPPORT & MODERATION"},{type:"link",to:"/admin/support-tickets",label:"Support Tickets",icon:""},{type:"link",to:"/admin/reports-flags",label:"Reports & Flags",icon:""},{type:"link",to:"/admin/disputes",label:"Dispute Management",icon:""},{type:"section",label:"PLATFORM SETTINGS"},{type:"link",to:"/admin/settings/general",label:"General Settings",icon:""},{type:"link",to:"/admin/settings/pricing",label:"Pricing & Commission",icon:""},{type:"link",to:"/admin/settings/email-templates",label:"Email Templates",icon:""},{type:"link",to:"/admin/settings/notifications",label:"Notification Settings",icon:""},{type:"link",to:"/admin/settings/security",label:"Security & Access",icon:""},{type:"section",label:"SYSTEM"},{type:"link",to:"/admin/system/logs",label:"System Logs",icon:""},{type:"link",to:"/admin/system/bulk-actions",label:"Bulk Actions",icon:""},{type:"link",to:"/admin/system/backup",label:"Database Backup",icon:""},{type:"section",label:"ACCOUNT"},{type:"link",to:"/admin/profile",label:"My Profile",icon:""}]}},cN=({role:r})=>{var ir,Ni;const n=Fge[r],o=Ns(),{logout:l,user:u}=vs(),{notifications:m,unreadNotificationsCount:g,unreadMessagesCount:E,markAllNotificationsAsRead:y}=Xg(),x=r==="creator"&&u&&u.creatorProfileStatus!=="approved",S=(u==null?void 0:u.creatorProfileStatus)==="pending";u==null||u.creatorProfileStatus;const C=u!=null&&u.username?u.username.substring(0,2).toUpperCase():((ir=u==null?void 0:u.email)==null?void 0:ir.substring(0,2).toUpperCase())||"U",R=u!=null&&u.username?u.username.charAt(0).toUpperCase()+u.username.slice(1):((Ni=u==null?void 0:u.email)==null?void 0:Ni.split("@")[0])||"User",M=O.useMemo(()=>`/${r}`,[r]),[G,I]=O.useState(!1),[j,L]=O.useState(!1),[N,D]=O.useState(320),[V,B]=O.useState(!1),[z,H]=O.useState("none"),[J,ee]=O.useState(""),[ne,he]=O.useState(!1),[ve,ye]=O.useState(!1),[me,ue]=O.useState(!1),[Fe,be]=O.useState(!0),[ae,ge]=O.useState({bank_account_name:"",bank_account_number:"",confirm_bank_account_number:"",bank_ifsc:"",upi_id:""}),[Se,it]=O.useState(!1),[Ue,ht]=O.useState(""),[qe,Me]=O.useState(""),[st,De]=O.useState([]),[Ae,Qe]=O.useState(!1),[pe,Re]=O.useState(!1),[Ge,xt]=O.useState(!1),[jt,Pt]=O.useState(!1),[rt,Dt]=O.useState({display_name:"",bio:"",category:"",primary_language:"",instagram_url:"",youtube_url:"",twitter_url:"",linkedin_url:"",website_url:"",profile_photo_url:"",cover_photo_url:""});O.useEffect(()=>{if(!x||r!=="creator"||!u)return;(async()=>{var Tt,Ht;const{data:$e}=await ie.from("profiles").select("display_name, bio, category, primary_language, instagram_url, youtube_url, twitter_url, linkedin_url, website_url, profile_photo_url, cover_photo_url").eq("user_id",u.id).maybeSingle();Dt({display_name:($e==null?void 0:$e.display_name)||(u.username?u.username:((Ht=(Tt=u.email)==null?void 0:Tt.split("@"))==null?void 0:Ht[0])||""),bio:($e==null?void 0:$e.bio)||"Tell fans who you are, what you create, and what kind of micro-meets or AMAs they can expect.",category:($e==null?void 0:$e.category)||"",primary_language:($e==null?void 0:$e.primary_language)||"",instagram_url:($e==null?void 0:$e.instagram_url)||"",youtube_url:($e==null?void 0:$e.youtube_url)||"",twitter_url:($e==null?void 0:$e.twitter_url)||"",linkedin_url:($e==null?void 0:$e.linkedin_url)||"",website_url:($e==null?void 0:$e.website_url)||"",profile_photo_url:($e==null?void 0:$e.profile_photo_url)||"",cover_photo_url:($e==null?void 0:$e.cover_photo_url)||""})})()},[r,x,u]),O.useEffect(()=>{if(!Se||!u){Se||(ht(""),Me(""));return}(async()=>{Qe(!0);try{const{data:$e,error:Tt}=await ie.from("support_tickets").select("id, subject, status, created_at").eq("user_id",u.id).order("created_at",{ascending:!1}).limit(3);!Tt&&$e&&De($e.map(Ht=>({id:Ht.id,subject:Ht.subject,status:Ht.status,createdAt:Ht.created_at})))}finally{Qe(!1)}})()},[Se,u]),O.useEffect(()=>{x||(it(!1),xt(!1))},[x]),O.useEffect(()=>{if(r!=="creator"||!u)return;(async()=>{ye(!0);try{const{data:$e}=await ie.from("profiles").select("bank_account_name, bank_account_number, bank_ifsc, upi_id, razorpay_fund_account_id").eq("user_id",u.id).maybeSingle(),Tt=!!($e!=null&&$e.razorpay_fund_account_id||$e!=null&&$e.bank_account_number||$e!=null&&$e.upi_id);be(Tt),$e&&ge({bank_account_name:$e.bank_account_name||"",bank_account_number:$e.bank_account_number||"",confirm_bank_account_number:$e.bank_account_number||"",bank_ifsc:$e.bank_ifsc||"",upi_id:$e.upi_id||""})}finally{ye(!1)}})()},[r,u]);const kt=async()=>{if(!u){alert("Please log in to contact support.");return}if(!Ue.trim()||!qe.trim()){alert("Please provide a subject and description.");return}Re(!0);try{const{data:ct,error:$e}=await ie.from("support_tickets").insert({user_id:u.id,subject:Ue.trim(),description:qe.trim(),status:"open"}).select("id, subject, status, created_at").single();if($e||!ct){alert("Could not submit support request. Please try again.");return}De(Tt=>[{id:ct.id,subject:ct.subject,status:ct.status,createdAt:ct.created_at},...Tt]),ht(""),Me(""),alert("Support request sent! Our team will reply shortly.")}finally{Re(!1)}},Os=async()=>{if(u){if(!rt.display_name.trim()||!rt.bio.trim()){alert("Please fill in at least Display name and Bio.");return}Pt(!0);try{const{error:ct}=await ie.from("profiles").upsert({user_id:u.id,display_name:rt.display_name.trim(),bio:rt.bio.trim(),category:rt.category.trim(),primary_language:rt.primary_language.trim(),instagram_url:rt.instagram_url.trim(),youtube_url:rt.youtube_url.trim(),twitter_url:rt.twitter_url.trim(),linkedin_url:rt.linkedin_url.trim(),website_url:rt.website_url.trim(),profile_photo_url:rt.profile_photo_url.trim(),cover_photo_url:rt.cover_photo_url.trim(),updated_at:new Date().toISOString()});if(ct){console.error("Error updating profile:",ct),alert("Failed to update profile.");return}await ie.from("users").update({display_name:rt.display_name.trim()}).eq("id",u.id),alert("Profile saved! Our team can now review your details.")}finally{Pt(!1)}}},bn=async()=>{if(!u)return;const ct=!!ae.upi_id,$e=!!ae.bank_account_number;if(!ct&&!$e){alert("Please provide either Bank Account details or a UPI ID.");return}if($e){if(!ae.bank_account_name){alert("Please enter the Account Holder Name.");return}if(!ae.bank_ifsc||ae.bank_ifsc.length!==11){alert("Please enter a valid 11-character IFSC code.");return}if(ae.bank_account_number!==ae.confirm_bank_account_number){alert("Account numbers do not match. Please re-enter.");return}}ue(!0);try{const Tt={name:ae.bank_account_name,ifsc:ae.bank_ifsc,account_number:ae.bank_account_number,upi_id:ae.upi_id},{data:Ht,error:mr}=await ie.functions.invoke("create-razorpay-fund-account",{body:Tt});if(mr){console.error("Edge function error:",mr),alert(`Verification failed: ${mr.message||"Unknown error"}`),ue(!1);return}const{confirm_bank_account_number:Jt,...$r}=ae,Jo={...$r};Ht!=null&&Ht.fund_account_id&&(Jo.razorpay_fund_account_id=Ht.fund_account_id);const{error:ti}=await ie.from("profiles").update(Jo).eq("user_id",u.id);if(ti)throw ti;be(!0),he(!1),alert("Payout details saved successfully!")}catch(Tt){console.error("Error updating payout details:",Tt),alert("Failed to update payout details.")}finally{ue(!1)}},ei=()=>{l(),o("/auth")};O.useEffect(()=>{if(!V)return;const ct=Tt=>{const Jt=Math.min(420,Math.max(220,Tt.clientX));D(Jt)},$e=()=>{B(!1)};return window.addEventListener("mousemove",ct),window.addEventListener("mouseup",$e),()=>{window.removeEventListener("mousemove",ct),window.removeEventListener("mouseup",$e)}},[V]);const Ti=ct=>n.menu.map($e=>{if("type"in $e&&$e.type==="section")return i.jsx("div",{className:"mt-4 mb-1 text-xs font-semibold uppercase tracking-[0.2em] text-white/60",children:$e.label},$e.label);const Tt=$e,Ht=!!Tt.disabled,mr=Tt.to===M;let Jt=0;return Tt.label==="Notifications"?Jt=g:Tt.label==="Messages"&&(Jt=E),i.jsxs(hl,{to:Tt.to,end:mr,onClick:$r=>{if(Ht){$r.preventDefault(),$r.stopPropagation();return}ct!=null&&ct.closeOnSelect&&I(!1)},className:({isActive:$r})=>tp("flex items-center gap-3 rounded-[12px] border border-transparent px-5 py-3 text-base transition-all",Ht?"cursor-not-allowed text-white/40 opacity-60":$r?"bg-white/10 text-white font-semibold shadow-[0_18px_45px_rgba(0,0,0,0.65)]":"text-white/75 hover:bg-white/5 hover:text-white"),children:[i.jsx("span",{className:tp("flex-1",r==="admin"?"font-semibold tracking-wide":"",j?"hidden":""),children:Tt.label}),!Ht&&Jt>0?i.jsx(Xe,{variant:"danger",children:Jt}):null]},Tt.to)}),Wr=()=>z==="notifications"?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between border-b border-[#E9ECEF] px-5 py-4",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Notifications"}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Latest updates on your bids and meets."})]}),i.jsx(oe,{variant:"secondary",size:"sm",className:"border-none bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>y(),children:"Mark all read"})]}),i.jsx("div",{className:"flex-1 space-y-3 overflow-y-auto px-5 py-4",children:m.length===0?i.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No notifications yet."}):m.slice(0,5).map(ct=>i.jsxs("div",{className:"rounded-[12px] bg-white/90 p-3 shadow-sm",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:ct.title}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:ct.message}),i.jsx("div",{className:"mt-1 text-[10px] text-[#ADB5BD]",children:Bl(new Date(ct.created_at),"MMM d, h:mm a")})]},ct.id))}),i.jsx("div",{className:"border-t border-[#E9ECEF] p-4",children:i.jsx(oe,{variant:"secondary",size:"sm",className:"w-full border-none bg-white text-[#050014] hover:bg-[#F8F9FA]",onClick:()=>o(`/${r}/notifications`),children:"View all notifications"})})]}):z==="profile"?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-3 border-b border-[#E9ECEF] px-5 py-4",children:[i.jsx(yi,{initials:C,size:"md"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:R}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:[r.charAt(0).toUpperCase()+r.slice(1)," account  Premium"]})]})]}),i.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4",children:[i.jsxs("div",{className:"rounded-[12px] bg-white/90 p-3 shadow-sm",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:"Payment Info"}),i.jsx("div",{className:"mt-1 text-sm font-semibold text-[#212529]",children:"Auto-refund enabled"}),i.jsx("div",{className:"mt-1 text-xs text-[#6C757D]",children:"90% refund for unsuccessful bids"})]}),i.jsxs("div",{className:"grid gap-2 text-sm text-[#343A40]",children:[i.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>o(`/${r}/wallet`),children:[i.jsx("span",{children:"Payment history"}),i.jsx("span",{children:""})]}),i.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>o(`/${r}/meets`),children:[i.jsx("span",{children:"Upcoming meets"}),i.jsx("span",{children:""})]}),i.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>o(`/${r}/settings`),children:[i.jsx("span",{children:"Profile & settings"}),i.jsx("span",{children:""})]})]})]}),i.jsx("div",{className:"border-t border-[#E9ECEF] p-4",children:i.jsx(oe,{variant:"secondary",size:"sm",className:"w-full border-none bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>{ei()},children:"Switch account"})})]}):null;return i.jsxs("div",{className:"flex min-h-screen bg-[#F8F9FA]",children:[ne&&i.jsx("div",{className:"fixed inset-0 z-[110] flex items-start justify-center overflow-y-auto bg-black/70 px-4 py-6 backdrop-blur-sm md:items-center",children:i.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white p-4 shadow-2xl sm:p-6 md:max-h-[92vh] md:overflow-y-auto",children:[i.jsxs("div",{className:"flex items-start justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:"Add payout method"}),i.jsx("div",{className:"mt-1 text-sm text-[#6C757D]",children:"Add bank account OR UPI to enable withdrawals. Your details will be verified."})]}),i.jsx("button",{type:"button",className:"rounded-md border border-[#E9ECEF] px-3 py-1 text-sm text-[#343A40] hover:bg-[#F8F9FA]",onClick:()=>he(!1),disabled:me,children:""})]}),i.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] p-4",children:[i.jsx("div",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Bank Transfer (NEFT/IMPS)"}),i.jsx(tt,{label:"Beneficiary Name",placeholder:"Name as per bank records",value:ae.bank_account_name,onChange:ct=>ge($e=>({...$e,bank_account_name:ct.target.value}))}),i.jsxs("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[i.jsx(tt,{label:"Account Number",placeholder:"e.g. 1234567890",type:"password",value:ae.bank_account_number,onChange:ct=>ge($e=>({...$e,bank_account_number:ct.target.value}))}),i.jsx(tt,{label:"Confirm Account Number",placeholder:"Re-enter account number",value:ae.confirm_bank_account_number,onChange:ct=>ge($e=>({...$e,confirm_bank_account_number:ct.target.value}))})]}),i.jsx("div",{className:"mt-3",children:i.jsx(tt,{label:"IFSC Code",placeholder:"e.g. HDFC0001234",value:ae.bank_ifsc,maxLength:11,onChange:ct=>ge($e=>({...$e,bank_ifsc:ct.target.value.toUpperCase()}))})})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"}),i.jsx("span",{className:"text-sm font-medium text-[#6C757D]",children:"OR"}),i.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] p-4",children:[i.jsx("div",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"UPI ID (VPA)"}),i.jsx(tt,{label:"UPI ID",placeholder:"e.g. username@oksbi",value:ae.upi_id,onChange:ct=>ge($e=>({...$e,upi_id:ct.target.value}))})]}),i.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:[i.jsx(oe,{variant:"secondary",size:"lg",className:"w-full border-none bg-white text-[#050014] hover:bg-[#F8F9FA]",onClick:()=>he(!1),disabled:me,children:"Cancel"}),i.jsx(oe,{size:"lg",className:"w-full",onClick:bn,disabled:me,children:me?"Verifying & Saving...":"Save payout method"})]})]})]})}),x&&i.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsxs("div",{className:"mx-4 max-h-[90vh] w-full max-w-md overflow-y-auto rounded-2xl bg-white p-8 text-center shadow-2xl",children:[i.jsx("div",{className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-gradient-to-br from-[#F4E6FF] to-[#E9D5FF]",children:i.jsx("span",{className:"text-4xl",children:S?"":""})}),i.jsx("h2",{className:"mb-2 text-2xl font-bold text-[#212529]",children:S?"Account Pending Verification":"Account Not Approved"}),i.jsx("p",{className:"mb-6 text-[#6C757D]",children:S?"Your creator account is currently under review. Our team will verify your profile within 24-48 hours. You will receive a notification once approved.":"Unfortunately, your creator application was not approved. Please contact our support team for more information or to reapply."}),i.jsxs("div",{className:"flex flex-col gap-3",children:[S&&i.jsxs("div",{className:"rounded-xl bg-[#F4E6FF]/60 p-4 text-left",children:[i.jsx("p",{className:"text-sm font-medium text-[#7B2CBF]",children:"While you wait:"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-[#6C757D]",children:[i.jsx("li",{children:" Complete your profile setup"}),i.jsx("li",{children:" Add your bank details for payouts"}),i.jsx("li",{children:" Link your social media accounts"})]})]}),i.jsx(oe,{onClick:()=>xt(ct=>!ct),className:"w-full",children:Ge?"Hide Profile Form":"Complete Profile (in this popup)"}),Ge?i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-left",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Profile details"}),i.jsxs("div",{className:"mt-3 space-y-3",children:[i.jsx(tt,{label:"Display name",placeholder:"Your public display name",value:rt.display_name,onChange:ct=>Dt($e=>({...$e,display_name:ct.target.value}))}),i.jsx(nr,{label:"Bio",rows:4,placeholder:"Short description that appears on your public profile.",value:rt.bio,onChange:ct=>Dt($e=>({...$e,bio:ct.target.value}))}),i.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[i.jsx(tt,{label:"Category",placeholder:"e.g. Fitness, Music, Comedy",value:rt.category,onChange:ct=>Dt($e=>({...$e,category:ct.target.value}))}),i.jsx(tt,{label:"Primary language",placeholder:"e.g. English, Hindi",value:rt.primary_language,onChange:ct=>Dt($e=>({...$e,primary_language:ct.target.value}))})]}),i.jsx(tt,{label:"Profile photo URL",placeholder:"https://...",value:rt.profile_photo_url,onChange:ct=>Dt($e=>({...$e,profile_photo_url:ct.target.value}))}),i.jsx(tt,{label:"Cover photo URL",placeholder:"https://...",value:rt.cover_photo_url,onChange:ct=>Dt($e=>({...$e,cover_photo_url:ct.target.value}))}),i.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[i.jsx(tt,{label:"Instagram",placeholder:"https://instagram.com/yourhandle",value:rt.instagram_url,onChange:ct=>Dt($e=>({...$e,instagram_url:ct.target.value}))}),i.jsx(tt,{label:"YouTube",placeholder:"https://youtube.com/@yourhandle",value:rt.youtube_url,onChange:ct=>Dt($e=>({...$e,youtube_url:ct.target.value}))}),i.jsx(tt,{label:"Twitter / X",placeholder:"https://twitter.com/yourhandle",value:rt.twitter_url,onChange:ct=>Dt($e=>({...$e,twitter_url:ct.target.value}))}),i.jsx(tt,{label:"LinkedIn",placeholder:"https://linkedin.com/in/yourprofile",value:rt.linkedin_url,onChange:ct=>Dt($e=>({...$e,linkedin_url:ct.target.value}))})]}),i.jsx(tt,{label:"Website",placeholder:"https://yourwebsite.com",value:rt.website_url,onChange:ct=>Dt($e=>({...$e,website_url:ct.target.value}))}),i.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[i.jsx(oe,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>o("/creator/profile-setup"),children:"Open full editor"}),i.jsx(oe,{size:"sm",className:"w-full",onClick:Os,disabled:jt,children:jt?"Saving":"Save profile"})]})]})]}):null,i.jsx(oe,{variant:"secondary",onClick:()=>it(ct=>!ct),className:"w-full",children:"Contact Support"}),Se?i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-left",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Help & Support"}),i.jsxs("div",{className:"mt-3 space-y-3",children:[i.jsx(tt,{label:"Subject",placeholder:"Briefly describe your issue",value:Ue,onChange:ct=>ht(ct.target.value)}),i.jsx(nr,{label:"Details",rows:4,placeholder:"Share details (payout, verification, events, etc.)",value:qe,onChange:ct=>Me(ct.target.value)}),i.jsx(oe,{size:"sm",className:"w-full",onClick:kt,disabled:pe,children:pe?"Sending":"Send to support"}),i.jsxs("div",{className:"pt-2",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:"Recent requests"}),i.jsx("div",{className:"mt-2 space-y-2",children:Ae?i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Loading"}):st.length===0?i.jsx("div",{className:"text-xs text-[#6C757D]",children:"No tickets yet."}):st.map(ct=>i.jsxs("div",{className:"rounded-[10px] border border-[#E9ECEF] bg-white p-3",children:[i.jsxs("div",{className:"flex items-center justify-between gap-3",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529] line-clamp-1",children:ct.subject}),i.jsx(Xe,{variant:"primary",className:"shrink-0",children:ct.status})]}),i.jsx("div",{className:"mt-1 text-xs text-[#6C757D]",children:Bl(new Date(ct.createdAt),"dd MMM, yyyy")})]},ct.id))})]})]})]}):null,i.jsx("button",{type:"button",onClick:ei,className:"mt-2 text-sm text-[#6C757D] underline hover:text-[#212529]",children:"Logout and switch account"})]})]})}),i.jsxs("aside",{className:"sticky top-0 hidden h-screen max-h-screen flex-shrink-0 border-r border-[#1F2933] bg-gradient-to-b from-[#050014] via-[#050014] to-[#140423] text-white md:flex md:flex-col relative",style:{width:j?80:N},children:[i.jsxs("div",{className:tp("flex flex-1 flex-col overflow-y-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden py-8",j?"px-3":"px-6"),children:[i.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[i.jsx(yi,{initials:C,size:"lg"}),i.jsxs("div",{className:tp("text-lg font-semibold text-white",j?"hidden":""),children:["Hey, ",R,"!"]}),j?null:i.jsx(Xe,{variant:"primary",children:"Premium"})]}),i.jsx("nav",{className:"mt-8 flex flex-1 flex-col gap-1",children:Ti()})]}),i.jsx("button",{type:"button",onClick:()=>L(ct=>!ct),className:"absolute -right-3 top-24 hidden h-7 w-7 items-center justify-center rounded-full border border-white/30 bg-[#050014] text-xs text-white shadow-md transition hover:bg-white hover:text-[#050014] md:flex",children:j?"":""}),i.jsx("div",{className:"absolute right-0 top-0 hidden h-full w-1 cursor-col-resize md:block",onMouseDown:()=>B(!0)}),i.jsx("div",{className:"px-6 pb-6",children:i.jsx("button",{type:"button",className:"inline-flex h-10 w-full items-center justify-start rounded-[8px] bg-black px-4 text-sm font-semibold text-white transition-colors hover:bg-black/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:ei,children:"Logout"})})]}),G&&i.jsxs("div",{className:"fixed inset-0 z-40 flex md:hidden",children:[i.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:()=>I(!1)}),i.jsxs("div",{className:"relative z-10 flex h-full w-[260px] flex-col border-r border-[#1F2933] bg-gradient-to-b from-[#050014] via-[#050014] to-[#140423] text-white",children:[i.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 px-4 py-3",children:[i.jsx("span",{className:"text-sm font-semibold text-white",children:n.title}),i.jsx("button",{type:"button",className:"rounded-md border border-white/30 p-1 text-white",onClick:()=>I(!1),children:""})]}),i.jsxs("div",{className:"flex flex-1 flex-col overflow-y-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden px-4 py-4",children:[i.jsx("nav",{className:"flex flex-1 flex-col gap-1",children:Ti({closeOnSelect:!0})}),i.jsx("div",{className:"mt-4",children:i.jsx("button",{type:"button",className:"inline-flex h-10 w-full items-center justify-start rounded-[8px] bg-black px-4 text-sm font-semibold text-white transition-colors hover:bg-black/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:ei,children:"Logout"})})]})]})]}),z!=="none"&&i.jsx("div",{className:"fixed inset-y-0 right-0 z-30 hidden w-80 flex-col border-l border-[#E9ECEF] bg-gradient-to-b from-[#FFF7FF] via-[#F4E6FF] to-[#F5F0FF] shadow-[0_0_45px_rgba(15,23,42,0.25)] backdrop-blur-xl md:flex",onMouseLeave:()=>H("none"),children:Wr()}),i.jsxs("div",{className:"flex w-full flex-col",children:[i.jsxs("header",{className:"sticky top-0 z-40 flex h-[70px] items-center justify-between border-b border-[#E9ECEF] bg-white px-6 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-md border border-[#E9ECEF] p-2 text-[#343A40] md:hidden",onClick:()=>I(ct=>!ct),children:[i.jsx("span",{className:"sr-only",children:"Open sidebar"}),i.jsxs("div",{className:"flex flex-col gap-[3px]",children:[i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"})]})]}),i.jsx("div",{className:"text-xl font-semibold text-[#212529]",children:n.title})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[r==="creator"&&!ve&&!Fe&&i.jsxs(i.Fragment,{children:[i.jsx(oe,{size:"lg",className:"hidden bg-[#050014] text-white hover:bg-[#140423] md:inline-flex",onClick:()=>{o("/creator/settings#payouts"),setTimeout(()=>{const ct=document.querySelector("#payouts");ct==null||ct.scrollIntoView({behavior:"smooth",block:"start"})},50)},children:"Add bank account"}),i.jsx(oe,{variant:"secondary",size:"icon",className:"border border-[#E9ECEF] text-[#050014] hover:bg-[#F8F9FA] md:hidden","aria-label":"Add bank account",onClick:()=>he(!0),children:""})]}),i.jsxs("div",{className:"relative hidden md:block",children:[i.jsx("input",{className:"h-11 rounded-[12px] border-2 border-[#E9ECEF] px-4 pr-10 text-sm focus:border-[#FF6B35] focus:shadow-[0_0_0_3px_rgba(255,107,53,0.1)]",placeholder:"Search events, creators",value:J,onChange:ct=>ee(ct.target.value),onKeyDown:ct=>{ct.key==="Enter"&&o(`${r==="fan"?"/fan":"/browse-events"}?q=${encodeURIComponent(J)}`)}}),i.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-lg text-[#6C757D]",children:""})]}),i.jsx("div",{className:"hidden md:block",onMouseEnter:()=>H("notifications"),children:i.jsxs(oe,{variant:"secondary",size:"icon",className:"bg-black text-white border-none hover:bg-black/90 relative",children:["",g>0&&i.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white",children:g})]})}),i.jsx("div",{className:"hidden md:block",onMouseEnter:()=>H("profile"),children:i.jsx(yi,{initials:C,size:"sm"})}),i.jsxs("div",{className:"flex items-center gap-2 md:hidden",children:[i.jsxs(oe,{variant:"secondary",size:"icon",className:"bg-black text-white border-none hover:bg-black/90 relative",onClick:()=>H(z==="notifications"?"none":"notifications"),children:["",g>0&&i.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white",children:g})]}),i.jsx(yi,{initials:C,size:"sm"})]})]})]}),i.jsx("main",{className:"flex-1 overflow-x-hidden px-4 py-6 md:px-12 md:py-10",children:i.jsx(EW,{})})]})]})},pI=O.createContext({});function Kp(r){const n=O.useRef(null);return n.current===null&&(n.current=r()),n.current}const mI=typeof window<"u",cb=mI?O.useLayoutEffect:O.useEffect,lb=O.createContext(null);function fI(r,n){r.indexOf(n)===-1&&r.push(n)}function gI(r,n){const o=r.indexOf(n);o>-1&&r.splice(o,1)}const qo=(r,n,o)=>o>n?n:o<r?r:o;let Pg=()=>{};const Tc={},sG=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function rG(r){return typeof r=="object"&&r!==null}const nG=r=>/^0[^.\s]+$/u.test(r);function _I(r){let n;return()=>(n===void 0&&(n=r()),n)}const Ci=r=>r,Uge=(r,n)=>o=>n(r(o)),Jg=(...r)=>r.reduce(Uge),kp=(r,n,o)=>{const l=n-r;return l===0?1:(o-r)/l};class vI{constructor(){this.subscriptions=[]}add(n){return fI(this.subscriptions,n),()=>gI(this.subscriptions,n)}notify(n,o,l){const u=this.subscriptions.length;if(u)if(u===1)this.subscriptions[0](n,o,l);else for(let m=0;m<u;m++){const g=this.subscriptions[m];g&&g(n,o,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const zo=r=>r*1e3,Ta=r=>r/1e3;function EI(r,n){return n?r*(1e3/n):0}const iG=(r,n,o)=>(((1-3*o+3*n)*r+(3*o-6*n))*r+3*n)*r,Vge=1e-7,Bge=12;function Wge(r,n,o,l,u){let m,g,E=0;do g=n+(o-n)/2,m=iG(g,l,u)-r,m>0?o=g:n=g;while(Math.abs(m)>Vge&&++E<Bge);return g}function Qg(r,n,o,l){if(r===n&&o===l)return Ci;const u=m=>Wge(m,0,1,r,o);return m=>m===0||m===1?m:iG(u(m),n,l)}const aG=r=>n=>n<=.5?r(2*n)/2:(2-r(2*(1-n)))/2,oG=r=>n=>1-r(1-n),cG=Qg(.33,1.53,.69,.99),yI=oG(cG),lG=aG(yI),dG=r=>(r*=2)<1?.5*yI(r):.5*(2-Math.pow(2,-10*(r-1))),xI=r=>1-Math.sin(Math.acos(r)),uG=oG(xI),hG=aG(xI),Gge=Qg(.42,0,1,1),Hge=Qg(0,0,.58,1),pG=Qg(.42,0,.58,1),zge=r=>Array.isArray(r)&&typeof r[0]!="number",mG=r=>Array.isArray(r)&&typeof r[0]=="number",Kge={linear:Ci,easeIn:Gge,easeInOut:pG,easeOut:Hge,circIn:xI,circInOut:hG,circOut:uG,backIn:yI,backInOut:lG,backOut:cG,anticipate:dG},qge=r=>typeof r=="string",zB=r=>{if(mG(r)){Pg(r.length===4);const[n,o,l,u]=r;return Qg(n,o,l,u)}else if(qge(r))return Kge[r];return r},wy=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Yge(r,n){let o=new Set,l=new Set,u=!1,m=!1;const g=new WeakSet;let E={delta:0,timestamp:0,isProcessing:!1};function y(S){g.has(S)&&(x.schedule(S),r()),S(E)}const x={schedule:(S,C=!1,R=!1)=>{const G=R&&u?o:l;return C&&g.add(S),G.has(S)||G.add(S),S},cancel:S=>{l.delete(S),g.delete(S)},process:S=>{if(E=S,u){m=!0;return}u=!0,[o,l]=[l,o],o.forEach(y),o.clear(),u=!1,m&&(m=!1,x.process(S))}};return x}const $ge=40;function fG(r,n){let o=!1,l=!0;const u={delta:0,timestamp:0,isProcessing:!1},m=()=>o=!0,g=wy.reduce((D,V)=>(D[V]=Yge(m),D),{}),{setup:E,read:y,resolveKeyframes:x,preUpdate:S,update:C,preRender:R,render:M,postRender:G}=g,I=()=>{const D=Tc.useManualTiming?u.timestamp:performance.now();o=!1,Tc.useManualTiming||(u.delta=l?1e3/60:Math.max(Math.min(D-u.timestamp,$ge),1)),u.timestamp=D,u.isProcessing=!0,E.process(u),y.process(u),x.process(u),S.process(u),C.process(u),R.process(u),M.process(u),G.process(u),u.isProcessing=!1,o&&n&&(l=!1,r(I))},j=()=>{o=!0,l=!0,u.isProcessing||r(I)};return{schedule:wy.reduce((D,V)=>{const B=g[V];return D[V]=(z,H=!1,J=!1)=>(o||j(),B.schedule(z,H,J)),D},{}),cancel:D=>{for(let V=0;V<wy.length;V++)g[wy[V]].cancel(D)},state:u,steps:g}}const{schedule:Hs,cancel:po,state:dn,steps:lN}=fG(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ci,!0);let Gy;function Xge(){Gy=void 0}const xi={now:()=>(Gy===void 0&&xi.set(dn.isProcessing||Tc.useManualTiming?dn.timestamp:performance.now()),Gy),set:r=>{Gy=r,queueMicrotask(Xge)}},gG=r=>n=>typeof n=="string"&&n.startsWith(r),bI=gG("--"),Jge=gG("var(--"),wI=r=>Jge(r)?Qge.test(r.split("/*")[0].trim()):!1,Qge=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,qp={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},kg={...qp,transform:r=>qo(0,1,r)},Sy={...qp,default:1},ag=r=>Math.round(r*1e5)/1e5,SI=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Zge(r){return r==null}const e_e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,CI=(r,n)=>o=>!!(typeof o=="string"&&e_e.test(o)&&o.startsWith(r)||n&&!Zge(o)&&Object.prototype.hasOwnProperty.call(o,n)),_G=(r,n,o)=>l=>{if(typeof l!="string")return l;const[u,m,g,E]=l.match(SI);return{[r]:parseFloat(u),[n]:parseFloat(m),[o]:parseFloat(g),alpha:E!==void 0?parseFloat(E):1}},t_e=r=>qo(0,255,r),dN={...qp,transform:r=>Math.round(t_e(r))},Yd={test:CI("rgb","red"),parse:_G("red","green","blue"),transform:({red:r,green:n,blue:o,alpha:l=1})=>"rgba("+dN.transform(r)+", "+dN.transform(n)+", "+dN.transform(o)+", "+ag(kg.transform(l))+")"};function s_e(r){let n="",o="",l="",u="";return r.length>5?(n=r.substring(1,3),o=r.substring(3,5),l=r.substring(5,7),u=r.substring(7,9)):(n=r.substring(1,2),o=r.substring(2,3),l=r.substring(3,4),u=r.substring(4,5),n+=n,o+=o,l+=l,u+=u),{red:parseInt(n,16),green:parseInt(o,16),blue:parseInt(l,16),alpha:u?parseInt(u,16)/255:1}}const MR={test:CI("#"),parse:s_e,transform:Yd.transform},Zg=r=>({test:n=>typeof n=="string"&&n.endsWith(r)&&n.split(" ").length===1,parse:parseFloat,transform:n=>`${n}${r}`}),ml=Zg("deg"),Ko=Zg("%"),qt=Zg("px"),r_e=Zg("vh"),n_e=Zg("vw"),KB={...Ko,parse:r=>Ko.parse(r)/100,transform:r=>Ko.transform(r*100)},sp={test:CI("hsl","hue"),parse:_G("hue","saturation","lightness"),transform:({hue:r,saturation:n,lightness:o,alpha:l=1})=>"hsla("+Math.round(r)+", "+Ko.transform(ag(n))+", "+Ko.transform(ag(o))+", "+ag(kg.transform(l))+")"},qr={test:r=>Yd.test(r)||MR.test(r)||sp.test(r),parse:r=>Yd.test(r)?Yd.parse(r):sp.test(r)?sp.parse(r):MR.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?Yd.transform(r):sp.transform(r),getAnimatableNone:r=>{const n=qr.parse(r);return n.alpha=0,qr.transform(n)}},i_e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function a_e(r){var n,o;return isNaN(r)&&typeof r=="string"&&(((n=r.match(SI))==null?void 0:n.length)||0)+(((o=r.match(i_e))==null?void 0:o.length)||0)>0}const vG="number",EG="color",o_e="var",c_e="var(",qB="${}",l_e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Lg(r){const n=r.toString(),o=[],l={color:[],number:[],var:[]},u=[];let m=0;const E=n.replace(l_e,y=>(qr.test(y)?(l.color.push(m),u.push(EG),o.push(qr.parse(y))):y.startsWith(c_e)?(l.var.push(m),u.push(o_e),o.push(y)):(l.number.push(m),u.push(vG),o.push(parseFloat(y))),++m,qB)).split(qB);return{values:o,split:E,indexes:l,types:u}}function yG(r){return Lg(r).values}function xG(r){const{split:n,types:o}=Lg(r),l=n.length;return u=>{let m="";for(let g=0;g<l;g++)if(m+=n[g],u[g]!==void 0){const E=o[g];E===vG?m+=ag(u[g]):E===EG?m+=qr.transform(u[g]):m+=u[g]}return m}}const d_e=r=>typeof r=="number"?0:qr.test(r)?qr.getAnimatableNone(r):r;function u_e(r){const n=yG(r);return xG(r)(n.map(d_e))}const Wl={test:a_e,parse:yG,createTransformer:xG,getAnimatableNone:u_e};function uN(r,n,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?r+(n-r)*6*o:o<1/2?n:o<2/3?r+(n-r)*(2/3-o)*6:r}function h_e({hue:r,saturation:n,lightness:o,alpha:l}){r/=360,n/=100,o/=100;let u=0,m=0,g=0;if(!n)u=m=g=o;else{const E=o<.5?o*(1+n):o+n-o*n,y=2*o-E;u=uN(y,E,r+1/3),m=uN(y,E,r),g=uN(y,E,r-1/3)}return{red:Math.round(u*255),green:Math.round(m*255),blue:Math.round(g*255),alpha:l}}function Tx(r,n){return o=>o>0?n:r}const br=(r,n,o)=>r+(n-r)*o,hN=(r,n,o)=>{const l=r*r,u=o*(n*n-l)+l;return u<0?0:Math.sqrt(u)},p_e=[MR,Yd,sp],m_e=r=>p_e.find(n=>n.test(r));function YB(r){const n=m_e(r);if(!n)return!1;let o=n.parse(r);return n===sp&&(o=h_e(o)),o}const $B=(r,n)=>{const o=YB(r),l=YB(n);if(!o||!l)return Tx(r,n);const u={...o};return m=>(u.red=hN(o.red,l.red,m),u.green=hN(o.green,l.green,m),u.blue=hN(o.blue,l.blue,m),u.alpha=br(o.alpha,l.alpha,m),Yd.transform(u))},FR=new Set(["none","hidden"]);function f_e(r,n){return FR.has(r)?o=>o<=0?r:n:o=>o>=1?n:r}function g_e(r,n){return o=>br(r,n,o)}function TI(r){return typeof r=="number"?g_e:typeof r=="string"?wI(r)?Tx:qr.test(r)?$B:E_e:Array.isArray(r)?bG:typeof r=="object"?qr.test(r)?$B:__e:Tx}function bG(r,n){const o=[...r],l=o.length,u=r.map((m,g)=>TI(m)(m,n[g]));return m=>{for(let g=0;g<l;g++)o[g]=u[g](m);return o}}function __e(r,n){const o={...r,...n},l={};for(const u in o)r[u]!==void 0&&n[u]!==void 0&&(l[u]=TI(r[u])(r[u],n[u]));return u=>{for(const m in l)o[m]=l[m](u);return o}}function v_e(r,n){const o=[],l={color:0,var:0,number:0};for(let u=0;u<n.values.length;u++){const m=n.types[u],g=r.indexes[m][l[m]],E=r.values[g]??0;o[u]=E,l[m]++}return o}const E_e=(r,n)=>{const o=Wl.createTransformer(n),l=Lg(r),u=Lg(n);return l.indexes.var.length===u.indexes.var.length&&l.indexes.color.length===u.indexes.color.length&&l.indexes.number.length>=u.indexes.number.length?FR.has(r)&&!u.values.length||FR.has(n)&&!l.values.length?f_e(r,n):Jg(bG(v_e(l,u),u.values),o):Tx(r,n)};function wG(r,n,o){return typeof r=="number"&&typeof n=="number"&&typeof o=="number"?br(r,n,o):TI(r)(r,n)}const y_e=r=>{const n=({timestamp:o})=>r(o);return{start:(o=!0)=>Hs.update(n,o),stop:()=>po(n),now:()=>dn.isProcessing?dn.timestamp:xi.now()}},SG=(r,n,o=10)=>{let l="";const u=Math.max(Math.round(n/o),2);for(let m=0;m<u;m++)l+=Math.round(r(m/(u-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},Nx=2e4;function NI(r){let n=0;const o=50;let l=r.next(n);for(;!l.done&&n<Nx;)n+=o,l=r.next(n);return n>=Nx?1/0:n}function x_e(r,n=100,o){const l=o({...r,keyframes:[0,n]}),u=Math.min(NI(l),Nx);return{type:"keyframes",ease:m=>l.next(u*m).value/n,duration:Ta(u)}}const b_e=5;function CG(r,n,o){const l=Math.max(n-b_e,0);return EI(o-r(l),n-l)}const Or={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},pN=.001;function w_e({duration:r=Or.duration,bounce:n=Or.bounce,velocity:o=Or.velocity,mass:l=Or.mass}){let u,m,g=1-n;g=qo(Or.minDamping,Or.maxDamping,g),r=qo(Or.minDuration,Or.maxDuration,Ta(r)),g<1?(u=x=>{const S=x*g,C=S*r,R=S-o,M=UR(x,g),G=Math.exp(-C);return pN-R/M*G},m=x=>{const C=x*g*r,R=C*o+o,M=Math.pow(g,2)*Math.pow(x,2)*r,G=Math.exp(-C),I=UR(Math.pow(x,2),g);return(-u(x)+pN>0?-1:1)*((R-M)*G)/I}):(u=x=>{const S=Math.exp(-x*r),C=(x-o)*r+1;return-pN+S*C},m=x=>{const S=Math.exp(-x*r),C=(o-x)*(r*r);return S*C});const E=5/r,y=C_e(u,m,E);if(r=zo(r),isNaN(y))return{stiffness:Or.stiffness,damping:Or.damping,duration:r};{const x=Math.pow(y,2)*l;return{stiffness:x,damping:g*2*Math.sqrt(l*x),duration:r}}}const S_e=12;function C_e(r,n,o){let l=o;for(let u=1;u<S_e;u++)l=l-r(l)/n(l);return l}function UR(r,n){return r*Math.sqrt(1-n*n)}const T_e=["duration","bounce"],N_e=["stiffness","damping","mass"];function XB(r,n){return n.some(o=>r[o]!==void 0)}function R_e(r){let n={velocity:Or.velocity,stiffness:Or.stiffness,damping:Or.damping,mass:Or.mass,isResolvedFromDuration:!1,...r};if(!XB(r,N_e)&&XB(r,T_e))if(r.visualDuration){const o=r.visualDuration,l=2*Math.PI/(o*1.2),u=l*l,m=2*qo(.05,1,1-(r.bounce||0))*Math.sqrt(u);n={...n,mass:Or.mass,stiffness:u,damping:m}}else{const o=w_e(r);n={...n,...o,mass:Or.mass},n.isResolvedFromDuration=!0}return n}function Rx(r=Or.visualDuration,n=Or.bounce){const o=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:n}:r;let{restSpeed:l,restDelta:u}=o;const m=o.keyframes[0],g=o.keyframes[o.keyframes.length-1],E={done:!1,value:m},{stiffness:y,damping:x,mass:S,duration:C,velocity:R,isResolvedFromDuration:M}=R_e({...o,velocity:-Ta(o.velocity||0)}),G=R||0,I=x/(2*Math.sqrt(y*S)),j=g-m,L=Ta(Math.sqrt(y/S)),N=Math.abs(j)<5;l||(l=N?Or.restSpeed.granular:Or.restSpeed.default),u||(u=N?Or.restDelta.granular:Or.restDelta.default);let D;if(I<1){const B=UR(L,I);D=z=>{const H=Math.exp(-I*L*z);return g-H*((G+I*L*j)/B*Math.sin(B*z)+j*Math.cos(B*z))}}else if(I===1)D=B=>g-Math.exp(-L*B)*(j+(G+L*j)*B);else{const B=L*Math.sqrt(I*I-1);D=z=>{const H=Math.exp(-I*L*z),J=Math.min(B*z,300);return g-H*((G+I*L*j)*Math.sinh(J)+B*j*Math.cosh(J))/B}}const V={calculatedDuration:M&&C||null,next:B=>{const z=D(B);if(M)E.done=B>=C;else{let H=B===0?G:0;I<1&&(H=B===0?zo(G):CG(D,B,z));const J=Math.abs(H)<=l,ee=Math.abs(g-z)<=u;E.done=J&&ee}return E.value=E.done?g:z,E},toString:()=>{const B=Math.min(NI(V),Nx),z=SG(H=>V.next(B*H).value,B,30);return B+"ms "+z},toTransition:()=>{}};return V}Rx.applyToOptions=r=>{const n=x_e(r,100,Rx);return r.ease=n.ease,r.duration=zo(n.duration),r.type="keyframes",r};function VR({keyframes:r,velocity:n=0,power:o=.8,timeConstant:l=325,bounceDamping:u=10,bounceStiffness:m=500,modifyTarget:g,min:E,max:y,restDelta:x=.5,restSpeed:S}){const C=r[0],R={done:!1,value:C},M=J=>E!==void 0&&J<E||y!==void 0&&J>y,G=J=>E===void 0?y:y===void 0||Math.abs(E-J)<Math.abs(y-J)?E:y;let I=o*n;const j=C+I,L=g===void 0?j:g(j);L!==j&&(I=L-C);const N=J=>-I*Math.exp(-J/l),D=J=>L+N(J),V=J=>{const ee=N(J),ne=D(J);R.done=Math.abs(ee)<=x,R.value=R.done?L:ne};let B,z;const H=J=>{M(R.value)&&(B=J,z=Rx({keyframes:[R.value,G(R.value)],velocity:CG(D,J,R.value),damping:u,stiffness:m,restDelta:x,restSpeed:S}))};return H(0),{calculatedDuration:null,next:J=>{let ee=!1;return!z&&B===void 0&&(ee=!0,V(J),H(J)),B!==void 0&&J>=B?z.next(J-B):(!ee&&V(J),R)}}}function A_e(r,n,o){const l=[],u=o||Tc.mix||wG,m=r.length-1;for(let g=0;g<m;g++){let E=u(r[g],r[g+1]);if(n){const y=Array.isArray(n)?n[g]||Ci:n;E=Jg(y,E)}l.push(E)}return l}function RI(r,n,{clamp:o=!0,ease:l,mixer:u}={}){const m=r.length;if(Pg(m===n.length),m===1)return()=>n[0];if(m===2&&n[0]===n[1])return()=>n[1];const g=r[0]===r[1];r[0]>r[m-1]&&(r=[...r].reverse(),n=[...n].reverse());const E=A_e(n,l,u),y=E.length,x=S=>{if(g&&S<r[0])return n[0];let C=0;if(y>1)for(;C<r.length-2&&!(S<r[C+1]);C++);const R=kp(r[C],r[C+1],S);return E[C](R)};return o?S=>x(qo(r[0],r[m-1],S)):x}function I_e(r,n){const o=r[r.length-1];for(let l=1;l<=n;l++){const u=kp(0,n,l);r.push(br(o,1,u))}}function TG(r){const n=[0];return I_e(n,r.length-1),n}function D_e(r,n){return r.map(o=>o*n)}function O_e(r,n){return r.map(()=>n||pG).splice(0,r.length-1)}function og({duration:r=300,keyframes:n,times:o,ease:l="easeInOut"}){const u=zge(l)?l.map(zB):zB(l),m={done:!1,value:n[0]},g=D_e(o&&o.length===n.length?o:TG(n),r),E=RI(g,n,{ease:Array.isArray(u)?u:O_e(n,u)});return{calculatedDuration:r,next:y=>(m.value=E(y),m.done=y>=r,m)}}const j_e=r=>r!==null;function AI(r,{repeat:n,repeatType:o="loop"},l,u=1){const m=r.filter(j_e),E=u<0||n&&o!=="loop"&&n%2===1?0:m.length-1;return!E||l===void 0?m[E]:l}const P_e={decay:VR,inertia:VR,tween:og,keyframes:og,spring:Rx};function NG(r){typeof r.type=="string"&&(r.type=P_e[r.type])}class II{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(n=>{this.resolve=n})}notifyFinished(){this.resolve()}then(n,o){return this.finished.then(n,o)}}const k_e=r=>r/100;class DI extends II{constructor(n){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var l,u;const{motionValue:o}=this.options;o&&o.updatedAt!==xi.now()&&this.tick(xi.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(u=(l=this.options).onStop)==null||u.call(l))},this.options=n,this.initAnimation(),this.play(),n.autoplay===!1&&this.pause()}initAnimation(){const{options:n}=this;NG(n);const{type:o=og,repeat:l=0,repeatDelay:u=0,repeatType:m,velocity:g=0}=n;let{keyframes:E}=n;const y=o||og;y!==og&&typeof E[0]!="number"&&(this.mixKeyframes=Jg(k_e,wG(E[0],E[1])),E=[0,100]);const x=y({...n,keyframes:E});m==="mirror"&&(this.mirroredGenerator=y({...n,keyframes:[...E].reverse(),velocity:-g})),x.calculatedDuration===null&&(x.calculatedDuration=NI(x));const{calculatedDuration:S}=x;this.calculatedDuration=S,this.resolvedDuration=S+u,this.totalDuration=this.resolvedDuration*(l+1)-u,this.generator=x}updateTime(n){const o=Math.round(n-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=o}tick(n,o=!1){const{generator:l,totalDuration:u,mixKeyframes:m,mirroredGenerator:g,resolvedDuration:E,calculatedDuration:y}=this;if(this.startTime===null)return l.next(0);const{delay:x=0,keyframes:S,repeat:C,repeatType:R,repeatDelay:M,type:G,onUpdate:I,finalKeyframe:j}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,n):this.speed<0&&(this.startTime=Math.min(n-u/this.speed,this.startTime)),o?this.currentTime=n:this.updateTime(n);const L=this.currentTime-x*(this.playbackSpeed>=0?1:-1),N=this.playbackSpeed>=0?L<0:L>u;this.currentTime=Math.max(L,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let D=this.currentTime,V=l;if(C){const J=Math.min(this.currentTime,u)/E;let ee=Math.floor(J),ne=J%1;!ne&&J>=1&&(ne=1),ne===1&&ee--,ee=Math.min(ee,C+1),!!(ee%2)&&(R==="reverse"?(ne=1-ne,M&&(ne-=M/E)):R==="mirror"&&(V=g)),D=qo(0,1,ne)*E}const B=N?{done:!1,value:S[0]}:V.next(D);m&&(B.value=m(B.value));let{done:z}=B;!N&&y!==null&&(z=this.playbackSpeed>=0?this.currentTime>=u:this.currentTime<=0);const H=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&z);return H&&G!==VR&&(B.value=AI(S,this.options,j,this.speed)),I&&I(B.value),H&&this.finish(),B}then(n,o){return this.finished.then(n,o)}get duration(){return Ta(this.calculatedDuration)}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+Ta(n)}get time(){return Ta(this.currentTime)}set time(n){var o;n=zo(n),this.currentTime=n,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=n:this.driver&&(this.startTime=this.driver.now()-n/this.playbackSpeed),(o=this.driver)==null||o.start(!1)}get speed(){return this.playbackSpeed}set speed(n){this.updateTime(xi.now());const o=this.playbackSpeed!==n;this.playbackSpeed=n,o&&(this.time=Ta(this.currentTime))}play(){var u,m;if(this.isStopped)return;const{driver:n=y_e,startTime:o}=this.options;this.driver||(this.driver=n(g=>this.tick(g))),(m=(u=this.options).onPlay)==null||m.call(u);const l=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=l):this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime||(this.startTime=o??l),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(xi.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var n,o;this.notifyFinished(),this.teardown(),this.state="finished",(o=(n=this.options).onComplete)==null||o.call(n)}cancel(){var n,o;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(o=(n=this.options).onCancel)==null||o.call(n)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(n){return this.startTime=0,this.tick(n,!0)}attachTimeline(n){var o;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(o=this.driver)==null||o.stop(),n.observe(this)}}function L_e(r){for(let n=1;n<r.length;n++)r[n]??(r[n]=r[n-1])}const $d=r=>r*180/Math.PI,BR=r=>{const n=$d(Math.atan2(r[1],r[0]));return WR(n)},M_e={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:BR,rotateZ:BR,skewX:r=>$d(Math.atan(r[1])),skewY:r=>$d(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},WR=r=>(r=r%360,r<0&&(r+=360),r),JB=BR,QB=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),ZB=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),F_e={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:QB,scaleY:ZB,scale:r=>(QB(r)+ZB(r))/2,rotateX:r=>WR($d(Math.atan2(r[6],r[5]))),rotateY:r=>WR($d(Math.atan2(-r[2],r[0]))),rotateZ:JB,rotate:JB,skewX:r=>$d(Math.atan(r[4])),skewY:r=>$d(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function GR(r){return r.includes("scale")?1:0}function HR(r,n){if(!r||r==="none")return GR(n);const o=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,u;if(o)l=F_e,u=o;else{const E=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=M_e,u=E}if(!u)return GR(n);const m=l[n],g=u[1].split(",").map(V_e);return typeof m=="function"?m(g):g[m]}const U_e=(r,n)=>{const{transform:o="none"}=getComputedStyle(r);return HR(o,n)};function V_e(r){return parseFloat(r.trim())}const Yp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],$p=new Set(Yp),e6=r=>r===qp||r===qt,B_e=new Set(["x","y","z"]),W_e=Yp.filter(r=>!B_e.has(r));function G_e(r){const n=[];return W_e.forEach(o=>{const l=r.getValue(o);l!==void 0&&(n.push([o,l.get()]),l.set(o.startsWith("scale")?1:0))}),n}const su={width:({x:r},{paddingLeft:n="0",paddingRight:o="0"})=>r.max-r.min-parseFloat(n)-parseFloat(o),height:({y:r},{paddingTop:n="0",paddingBottom:o="0"})=>r.max-r.min-parseFloat(n)-parseFloat(o),top:(r,{top:n})=>parseFloat(n),left:(r,{left:n})=>parseFloat(n),bottom:({y:r},{top:n})=>parseFloat(n)+(r.max-r.min),right:({x:r},{left:n})=>parseFloat(n)+(r.max-r.min),x:(r,{transform:n})=>HR(n,"x"),y:(r,{transform:n})=>HR(n,"y")};su.translateX=su.x;su.translateY=su.y;const ru=new Set;let zR=!1,KR=!1,qR=!1;function RG(){if(KR){const r=Array.from(ru).filter(l=>l.needsMeasurement),n=new Set(r.map(l=>l.element)),o=new Map;n.forEach(l=>{const u=G_e(l);u.length&&(o.set(l,u),l.render())}),r.forEach(l=>l.measureInitialState()),n.forEach(l=>{l.render();const u=o.get(l);u&&u.forEach(([m,g])=>{var E;(E=l.getValue(m))==null||E.set(g)})}),r.forEach(l=>l.measureEndState()),r.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}KR=!1,zR=!1,ru.forEach(r=>r.complete(qR)),ru.clear()}function AG(){ru.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(KR=!0)})}function H_e(){qR=!0,AG(),RG(),qR=!1}class OI{constructor(n,o,l,u,m,g=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...n],this.onComplete=o,this.name=l,this.motionValue=u,this.element=m,this.isAsync=g}scheduleResolve(){this.state="scheduled",this.isAsync?(ru.add(this),zR||(zR=!0,Hs.read(AG),Hs.resolveKeyframes(RG))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:n,name:o,element:l,motionValue:u}=this;if(n[0]===null){const m=u==null?void 0:u.get(),g=n[n.length-1];if(m!==void 0)n[0]=m;else if(l&&o){const E=l.readValue(o,g);E!=null&&(n[0]=E)}n[0]===void 0&&(n[0]=g),u&&m===void 0&&u.set(n[0])}L_e(n)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(n=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,n),ru.delete(this)}cancel(){this.state==="scheduled"&&(ru.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const z_e=r=>r.startsWith("--");function K_e(r,n,o){z_e(n)?r.style.setProperty(n,o):r.style[n]=o}const IG=_I(()=>window.ScrollTimeline!==void 0),q_e={};function Y_e(r,n){const o=_I(r);return()=>q_e[n]??o()}const DG=Y_e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),qf=([r,n,o,l])=>`cubic-bezier(${r}, ${n}, ${o}, ${l})`,t6={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:qf([0,.65,.55,1]),circOut:qf([.55,0,1,.45]),backIn:qf([.31,.01,.66,-.59]),backOut:qf([.33,1.53,.69,.99])};function OG(r,n){if(r)return typeof r=="function"?DG()?SG(r,n):"ease-out":mG(r)?qf(r):Array.isArray(r)?r.map(o=>OG(o,n)||t6.easeOut):t6[r]}function $_e(r,n,o,{delay:l=0,duration:u=300,repeat:m=0,repeatType:g="loop",ease:E="easeOut",times:y}={},x=void 0){const S={[n]:o};y&&(S.offset=y);const C=OG(E,u);Array.isArray(C)&&(S.easing=C);const R={delay:l,duration:u,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:m+1,direction:g==="reverse"?"alternate":"normal"};return x&&(R.pseudoElement=x),r.animate(S,R)}function jG(r){return typeof r=="function"&&"applyToOptions"in r}function X_e({type:r,...n}){return jG(r)&&DG()?r.applyToOptions(n):(n.duration??(n.duration=300),n.ease??(n.ease="easeOut"),n)}class J_e extends II{constructor(n){if(super(),this.finishedTime=null,this.isStopped=!1,!n)return;const{element:o,name:l,keyframes:u,pseudoElement:m,allowFlatten:g=!1,finalKeyframe:E,onComplete:y}=n;this.isPseudoElement=!!m,this.allowFlatten=g,this.options=n,Pg(typeof n.type!="string");const x=X_e(n);this.animation=$_e(o,l,u,x,m),x.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!m){const S=AI(u,this.options,E,this.speed);this.updateMotionValue?this.updateMotionValue(S):K_e(o,l,S),this.animation.cancel()}y==null||y(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var n,o;(o=(n=this.animation).finish)==null||o.call(n)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:n}=this;n==="idle"||n==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,o;this.isPseudoElement||(o=(n=this.animation).commitStyles)==null||o.call(n)}get duration(){var o,l;const n=((l=(o=this.animation.effect)==null?void 0:o.getComputedTiming)==null?void 0:l.call(o).duration)||0;return Ta(Number(n))}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+Ta(n)}get time(){return Ta(Number(this.animation.currentTime)||0)}set time(n){this.finishedTime=null,this.animation.currentTime=zo(n)}get speed(){return this.animation.playbackRate}set speed(n){n<0&&(this.finishedTime=null),this.animation.playbackRate=n}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(n){this.animation.startTime=n}attachTimeline({timeline:n,observe:o}){var l;return this.allowFlatten&&((l=this.animation.effect)==null||l.updateTiming({easing:"linear"})),this.animation.onfinish=null,n&&IG()?(this.animation.timeline=n,Ci):o(this)}}const PG={anticipate:dG,backInOut:lG,circInOut:hG};function Q_e(r){return r in PG}function Z_e(r){typeof r.ease=="string"&&Q_e(r.ease)&&(r.ease=PG[r.ease])}const s6=10;class eve extends J_e{constructor(n){Z_e(n),NG(n),super(n),n.startTime&&(this.startTime=n.startTime),this.options=n}updateMotionValue(n){const{motionValue:o,onUpdate:l,onComplete:u,element:m,...g}=this.options;if(!o)return;if(n!==void 0){o.set(n);return}const E=new DI({...g,autoplay:!1}),y=zo(this.finishedTime??this.time);o.setWithVelocity(E.sample(y-s6).value,E.sample(y).value,s6),E.stop()}}const r6=(r,n)=>n==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(Wl.test(r)||r==="0")&&!r.startsWith("url("));function tve(r){const n=r[0];if(r.length===1)return!0;for(let o=0;o<r.length;o++)if(r[o]!==n)return!0}function sve(r,n,o,l){const u=r[0];if(u===null)return!1;if(n==="display"||n==="visibility")return!0;const m=r[r.length-1],g=r6(u,n),E=r6(m,n);return!g||!E?!1:tve(r)||(o==="spring"||jG(o))&&l}function YR(r){r.duration=0,r.type="keyframes"}const rve=new Set(["opacity","clipPath","filter","transform"]),nve=_I(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function ive(r){var S;const{motionValue:n,name:o,repeatDelay:l,repeatType:u,damping:m,type:g}=r;if(!(((S=n==null?void 0:n.owner)==null?void 0:S.current)instanceof HTMLElement))return!1;const{onUpdate:y,transformTemplate:x}=n.owner.getProps();return nve()&&o&&rve.has(o)&&(o!=="transform"||!x)&&!y&&!l&&u!=="mirror"&&m!==0&&g!=="inertia"}const ave=40;class ove extends II{constructor({autoplay:n=!0,delay:o=0,type:l="keyframes",repeat:u=0,repeatDelay:m=0,repeatType:g="loop",keyframes:E,name:y,motionValue:x,element:S,...C}){var G;super(),this.stop=()=>{var I,j;this._animation&&(this._animation.stop(),(I=this.stopTimeline)==null||I.call(this)),(j=this.keyframeResolver)==null||j.cancel()},this.createdAt=xi.now();const R={autoplay:n,delay:o,type:l,repeat:u,repeatDelay:m,repeatType:g,name:y,motionValue:x,element:S,...C},M=(S==null?void 0:S.KeyframeResolver)||OI;this.keyframeResolver=new M(E,(I,j,L)=>this.onKeyframesResolved(I,j,R,!L),y,x,S),(G=this.keyframeResolver)==null||G.scheduleResolve()}onKeyframesResolved(n,o,l,u){this.keyframeResolver=void 0;const{name:m,type:g,velocity:E,delay:y,isHandoff:x,onUpdate:S}=l;this.resolvedAt=xi.now(),sve(n,m,g,E)||((Tc.instantAnimations||!y)&&(S==null||S(AI(n,l,o))),n[0]=n[n.length-1],YR(l),l.repeat=0);const R={startTime:u?this.resolvedAt?this.resolvedAt-this.createdAt>ave?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:o,...l,keyframes:n},M=!x&&ive(R)?new eve({...R,element:R.motionValue.owner.current}):new DI(R);M.finished.then(()=>this.notifyFinished()).catch(Ci),this.pendingTimeline&&(this.stopTimeline=M.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=M}get finished(){return this._animation?this.animation.finished:this._finished}then(n,o){return this.finished.finally(n).then(()=>{})}get animation(){var n;return this._animation||((n=this.keyframeResolver)==null||n.resume(),H_e()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(n){this.animation.time=n}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(n){this.animation.speed=n}get startTime(){return this.animation.startTime}attachTimeline(n){return this._animation?this.stopTimeline=this.animation.attachTimeline(n):this.pendingTimeline=n,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var n;this._animation&&this.animation.cancel(),(n=this.keyframeResolver)==null||n.cancel()}}const cve=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function lve(r){const n=cve.exec(r);if(!n)return[,];const[,o,l,u]=n;return[`--${o??l}`,u]}function kG(r,n,o=1){const[l,u]=lve(r);if(!l)return;const m=window.getComputedStyle(n).getPropertyValue(l);if(m){const g=m.trim();return sG(g)?parseFloat(g):g}return wI(u)?kG(u,n,o+1):u}function jI(r,n){return(r==null?void 0:r[n])??(r==null?void 0:r.default)??r}const LG=new Set(["width","height","top","left","right","bottom",...Yp]),dve={test:r=>r==="auto",parse:r=>r},MG=r=>n=>n.test(r),FG=[qp,qt,Ko,ml,n_e,r_e,dve],n6=r=>FG.find(MG(r));function uve(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||nG(r):!0}const hve=new Set(["brightness","contrast","saturate","opacity"]);function pve(r){const[n,o]=r.slice(0,-1).split("(");if(n==="drop-shadow")return r;const[l]=o.match(SI)||[];if(!l)return r;const u=o.replace(l,"");let m=hve.has(n)?1:0;return l!==o&&(m*=100),n+"("+m+u+")"}const mve=/\b([a-z-]*)\(.*?\)/gu,$R={...Wl,getAnimatableNone:r=>{const n=r.match(mve);return n?n.map(pve).join(" "):r}},i6={...qp,transform:Math.round},fve={rotate:ml,rotateX:ml,rotateY:ml,rotateZ:ml,scale:Sy,scaleX:Sy,scaleY:Sy,scaleZ:Sy,skew:ml,skewX:ml,skewY:ml,distance:qt,translateX:qt,translateY:qt,translateZ:qt,x:qt,y:qt,z:qt,perspective:qt,transformPerspective:qt,opacity:kg,originX:KB,originY:KB,originZ:qt},PI={borderWidth:qt,borderTopWidth:qt,borderRightWidth:qt,borderBottomWidth:qt,borderLeftWidth:qt,borderRadius:qt,radius:qt,borderTopLeftRadius:qt,borderTopRightRadius:qt,borderBottomRightRadius:qt,borderBottomLeftRadius:qt,width:qt,maxWidth:qt,height:qt,maxHeight:qt,top:qt,right:qt,bottom:qt,left:qt,padding:qt,paddingTop:qt,paddingRight:qt,paddingBottom:qt,paddingLeft:qt,margin:qt,marginTop:qt,marginRight:qt,marginBottom:qt,marginLeft:qt,backgroundPositionX:qt,backgroundPositionY:qt,...fve,zIndex:i6,fillOpacity:kg,strokeOpacity:kg,numOctaves:i6},gve={...PI,color:qr,backgroundColor:qr,outlineColor:qr,fill:qr,stroke:qr,borderColor:qr,borderTopColor:qr,borderRightColor:qr,borderBottomColor:qr,borderLeftColor:qr,filter:$R,WebkitFilter:$R},UG=r=>gve[r];function VG(r,n){let o=UG(r);return o!==$R&&(o=Wl),o.getAnimatableNone?o.getAnimatableNone(n):void 0}const _ve=new Set(["auto","none","0"]);function vve(r,n,o){let l=0,u;for(;l<r.length&&!u;){const m=r[l];typeof m=="string"&&!_ve.has(m)&&Lg(m).values.length&&(u=r[l]),l++}if(u&&o)for(const m of n)r[m]=VG(o,u)}class Eve extends OI{constructor(n,o,l,u,m){super(n,o,l,u,m,!0)}readKeyframes(){const{unresolvedKeyframes:n,element:o,name:l}=this;if(!o||!o.current)return;super.readKeyframes();for(let y=0;y<n.length;y++){let x=n[y];if(typeof x=="string"&&(x=x.trim(),wI(x))){const S=kG(x,o.current);S!==void 0&&(n[y]=S),y===n.length-1&&(this.finalKeyframe=x)}}if(this.resolveNoneKeyframes(),!LG.has(l)||n.length!==2)return;const[u,m]=n,g=n6(u),E=n6(m);if(g!==E)if(e6(g)&&e6(E))for(let y=0;y<n.length;y++){const x=n[y];typeof x=="string"&&(n[y]=parseFloat(x))}else su[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:n,name:o}=this,l=[];for(let u=0;u<n.length;u++)(n[u]===null||uve(n[u]))&&l.push(u);l.length&&vve(n,l,o)}measureInitialState(){const{element:n,unresolvedKeyframes:o,name:l}=this;if(!n||!n.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=su[l](n.measureViewportBox(),window.getComputedStyle(n.current)),o[0]=this.measuredOrigin;const u=o[o.length-1];u!==void 0&&n.getValue(l,u).jump(u,!1)}measureEndState(){var E;const{element:n,name:o,unresolvedKeyframes:l}=this;if(!n||!n.current)return;const u=n.getValue(o);u&&u.jump(this.measuredOrigin,!1);const m=l.length-1,g=l[m];l[m]=su[o](n.measureViewportBox(),window.getComputedStyle(n.current)),g!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=g),(E=this.removedTransforms)!=null&&E.length&&this.removedTransforms.forEach(([y,x])=>{n.getValue(y).set(x)}),this.resolveNoneKeyframes()}}function BG(r,n,o){if(r instanceof EventTarget)return[r];if(typeof r=="string"){const u=document.querySelectorAll(r);return u?Array.from(u):[]}return Array.from(r)}const WG=(r,n)=>n&&typeof r=="number"?n.transform(r):r;function kI(r){return rG(r)&&"offsetHeight"in r}const a6=30,yve=r=>!isNaN(parseFloat(r)),cg={current:void 0};class xve{constructor(n,o={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{var m;const u=xi.now();if(this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&((m=this.events.change)==null||m.notify(this.current),this.dependents))for(const g of this.dependents)g.dirty()},this.hasAnimated=!1,this.setCurrent(n),this.owner=o.owner}setCurrent(n){this.current=n,this.updatedAt=xi.now(),this.canTrackVelocity===null&&n!==void 0&&(this.canTrackVelocity=yve(this.current))}setPrevFrameValue(n=this.current){this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt}onChange(n){return this.on("change",n)}on(n,o){this.events[n]||(this.events[n]=new vI);const l=this.events[n].add(o);return n==="change"?()=>{l(),Hs.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const n in this.events)this.events[n].clear()}attach(n,o){this.passiveEffect=n,this.stopPassiveEffect=o}set(n){this.passiveEffect?this.passiveEffect(n,this.updateAndNotify):this.updateAndNotify(n)}setWithVelocity(n,o,l){this.set(o),this.prev=void 0,this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt-l}jump(n,o=!0){this.updateAndNotify(n),this.prev=n,this.prevUpdatedAt=this.prevFrameValue=void 0,o&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var n;(n=this.events.change)==null||n.notify(this.current)}addDependent(n){this.dependents||(this.dependents=new Set),this.dependents.add(n)}removeDependent(n){this.dependents&&this.dependents.delete(n)}get(){return cg.current&&cg.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const n=xi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||n-this.updatedAt>a6)return 0;const o=Math.min(this.updatedAt-this.prevUpdatedAt,a6);return EI(parseFloat(this.current)-parseFloat(this.prevFrameValue),o)}start(n){return this.stop(),new Promise(o=>{this.hasAnimated=!0,this.animation=n(o),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var n,o;(n=this.dependents)==null||n.clear(),(o=this.events.destroy)==null||o.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function co(r,n){return new xve(r,n)}const{schedule:LI}=fG(queueMicrotask,!1),eo={x:!1,y:!1};function GG(){return eo.x||eo.y}function bve(r){return r==="x"||r==="y"?eo[r]?null:(eo[r]=!0,()=>{eo[r]=!1}):eo.x||eo.y?null:(eo.x=eo.y=!0,()=>{eo.x=eo.y=!1})}function HG(r,n){const o=BG(r),l=new AbortController,u={passive:!0,...n,signal:l.signal};return[o,u,()=>l.abort()]}function o6(r){return!(r.pointerType==="touch"||GG())}function wve(r,n,o={}){const[l,u,m]=HG(r,o),g=E=>{if(!o6(E))return;const{target:y}=E,x=n(y,E);if(typeof x!="function"||!y)return;const S=C=>{o6(C)&&(x(C),y.removeEventListener("pointerleave",S))};y.addEventListener("pointerleave",S,u)};return l.forEach(E=>{E.addEventListener("pointerenter",g,u)}),m}const zG=(r,n)=>n?r===n?!0:zG(r,n.parentElement):!1,MI=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,Sve=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Cve(r){return Sve.has(r.tagName)||r.tabIndex!==-1}const Hy=new WeakSet;function c6(r){return n=>{n.key==="Enter"&&r(n)}}function mN(r,n){r.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}const Tve=(r,n)=>{const o=r.currentTarget;if(!o)return;const l=c6(()=>{if(Hy.has(o))return;mN(o,"down");const u=c6(()=>{mN(o,"up")}),m=()=>mN(o,"cancel");o.addEventListener("keyup",u,n),o.addEventListener("blur",m,n)});o.addEventListener("keydown",l,n),o.addEventListener("blur",()=>o.removeEventListener("keydown",l),n)};function l6(r){return MI(r)&&!GG()}function Nve(r,n,o={}){const[l,u,m]=HG(r,o),g=E=>{const y=E.currentTarget;if(!l6(E))return;Hy.add(y);const x=n(y,E),S=(M,G)=>{window.removeEventListener("pointerup",C),window.removeEventListener("pointercancel",R),Hy.has(y)&&Hy.delete(y),l6(M)&&typeof x=="function"&&x(M,{success:G})},C=M=>{S(M,y===window||y===document||o.useGlobalTarget||zG(y,M.target))},R=M=>{S(M,!1)};window.addEventListener("pointerup",C,u),window.addEventListener("pointercancel",R,u)};return l.forEach(E=>{(o.useGlobalTarget?window:E).addEventListener("pointerdown",g,u),kI(E)&&(E.addEventListener("focus",x=>Tve(x,u)),!Cve(E)&&!E.hasAttribute("tabindex")&&(E.tabIndex=0))}),m}function FI(r){return rG(r)&&"ownerSVGElement"in r}const zy=new WeakMap;let fl;const KG=(r,n,o)=>(l,u)=>u&&u[0]?u[0][r+"Size"]:FI(l)&&"getBBox"in l?l.getBBox()[n]:l[o],Rve=KG("inline","width","offsetWidth"),Ave=KG("block","height","offsetHeight");function Ive({target:r,borderBoxSize:n}){var o;(o=zy.get(r))==null||o.forEach(l=>{l(r,{get width(){return Rve(r,n)},get height(){return Ave(r,n)}})})}function Dve(r){r.forEach(Ive)}function Ove(){typeof ResizeObserver>"u"||(fl=new ResizeObserver(Dve))}function jve(r,n){fl||Ove();const o=BG(r);return o.forEach(l=>{let u=zy.get(l);u||(u=new Set,zy.set(l,u)),u.add(n),fl==null||fl.observe(l)}),()=>{o.forEach(l=>{const u=zy.get(l);u==null||u.delete(n),u!=null&&u.size||fl==null||fl.unobserve(l)})}}const Ky=new Set;let rp;function Pve(){rp=()=>{const r={get width(){return window.innerWidth},get height(){return window.innerHeight}};Ky.forEach(n=>n(r))},window.addEventListener("resize",rp)}function kve(r){return Ky.add(r),rp||Pve(),()=>{Ky.delete(r),!Ky.size&&typeof rp=="function"&&(window.removeEventListener("resize",rp),rp=void 0)}}function Lve(r,n){return typeof r=="function"?kve(r):jve(r,n)}function qG(r,n){let o;const l=()=>{const{currentTime:u}=n,g=(u===null?0:u.value)/100;o!==g&&r(g),o=g};return Hs.preUpdate(l,!0),()=>po(l)}function Mve(r){return FI(r)&&r.tagName==="svg"}function Fve(...r){const n=!Array.isArray(r[0]),o=n?0:-1,l=r[0+o],u=r[1+o],m=r[2+o],g=r[3+o],E=RI(u,m,g);return n?E(l):E}const Ln=r=>!!(r&&r.getVelocity),Uve=[...FG,qr,Wl],Vve=r=>Uve.find(MG(r)),db=O.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function d6(r,n){if(typeof r=="function")return r(n);r!=null&&(r.current=n)}function Bve(...r){return n=>{let o=!1;const l=r.map(u=>{const m=d6(u,n);return!o&&typeof m=="function"&&(o=!0),m});if(o)return()=>{for(let u=0;u<l.length;u++){const m=l[u];typeof m=="function"?m():d6(r[u],null)}}}}function Wve(...r){return O.useCallback(Bve(...r),r)}class Gve extends O.Component{getSnapshotBeforeUpdate(n){const o=this.props.childRef.current;if(o&&n.isPresent&&!this.props.isPresent){const l=o.offsetParent,u=kI(l)&&l.offsetWidth||0,m=this.props.sizeRef.current;m.height=o.offsetHeight||0,m.width=o.offsetWidth||0,m.top=o.offsetTop,m.left=o.offsetLeft,m.right=u-m.width-m.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Hve({children:r,isPresent:n,anchorX:o,root:l}){const u=O.useId(),m=O.useRef(null),g=O.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:E}=O.useContext(db),y=Wve(m,r==null?void 0:r.ref);return O.useInsertionEffect(()=>{const{width:x,height:S,top:C,left:R,right:M}=g.current;if(n||!m.current||!x||!S)return;const G=o==="left"?`left: ${R}`:`right: ${M}`;m.current.dataset.motionPopId=u;const I=document.createElement("style");E&&(I.nonce=E);const j=l??document.head;return j.appendChild(I),I.sheet&&I.sheet.insertRule(`
          [data-motion-pop-id="${u}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${S}px !important;
            ${G}px !important;
            top: ${C}px !important;
          }
        `),()=>{j.contains(I)&&j.removeChild(I)}},[n]),i.jsx(Gve,{isPresent:n,childRef:m,sizeRef:g,children:O.cloneElement(r,{ref:y})})}const zve=({children:r,initial:n,isPresent:o,onExitComplete:l,custom:u,presenceAffectsLayout:m,mode:g,anchorX:E,root:y})=>{const x=Kp(Kve),S=O.useId();let C=!0,R=O.useMemo(()=>(C=!1,{id:S,initial:n,isPresent:o,custom:u,onExitComplete:M=>{x.set(M,!0);for(const G of x.values())if(!G)return;l&&l()},register:M=>(x.set(M,!1),()=>x.delete(M))}),[o,x,l]);return m&&C&&(R={...R}),O.useMemo(()=>{x.forEach((M,G)=>x.set(G,!1))},[o]),O.useEffect(()=>{!o&&!x.size&&l&&l()},[o]),g==="popLayout"&&(r=i.jsx(Hve,{isPresent:o,anchorX:E,root:y,children:r})),i.jsx(lb.Provider,{value:R,children:r})};function Kve(){return new Map}function YG(r=!0){const n=O.useContext(lb);if(n===null)return[!0,null];const{isPresent:o,onExitComplete:l,register:u}=n,m=O.useId();O.useEffect(()=>{if(r)return u(m)},[r]);const g=O.useCallback(()=>r&&l&&l(m),[m,l,r]);return!o&&l?[!1,g]:[!0]}const Cy=r=>r.key||"";function u6(r){const n=[];return O.Children.forEach(r,o=>{O.isValidElement(o)&&n.push(o)}),n}const h6=({children:r,custom:n,initial:o=!0,onExitComplete:l,presenceAffectsLayout:u=!0,mode:m="sync",propagate:g=!1,anchorX:E="left",root:y})=>{const[x,S]=YG(g),C=O.useMemo(()=>u6(r),[r]),R=g&&!x?[]:C.map(Cy),M=O.useRef(!0),G=O.useRef(C),I=Kp(()=>new Map),[j,L]=O.useState(C),[N,D]=O.useState(C);cb(()=>{M.current=!1,G.current=C;for(let z=0;z<N.length;z++){const H=Cy(N[z]);R.includes(H)?I.delete(H):I.get(H)!==!0&&I.set(H,!1)}},[N,R.length,R.join("-")]);const V=[];if(C!==j){let z=[...C];for(let H=0;H<N.length;H++){const J=N[H],ee=Cy(J);R.includes(ee)||(z.splice(H,0,J),V.push(J))}return m==="wait"&&V.length&&(z=V),D(u6(z)),L(C),null}const{forceRender:B}=O.useContext(pI);return i.jsx(i.Fragment,{children:N.map(z=>{const H=Cy(z),J=g&&!x?!1:C===N||R.includes(H),ee=()=>{if(I.has(H))I.set(H,!0);else return;let ne=!0;I.forEach(he=>{he||(ne=!1)}),ne&&(B==null||B(),D(G.current),g&&(S==null||S()),l&&l())};return i.jsx(zve,{isPresent:J,initial:!M.current||o?void 0:!1,custom:n,presenceAffectsLayout:u,mode:m,root:y,onExitComplete:J?void 0:ee,anchorX:E,children:z},H)})})},$G=O.createContext({strict:!1}),p6={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Lp={};for(const r in p6)Lp[r]={isEnabled:n=>p6[r].some(o=>!!n[o])};function qve(r){for(const n in r)Lp[n]={...Lp[n],...r[n]}}const Yve=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ax(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||Yve.has(r)}let XG=r=>!Ax(r);function $ve(r){typeof r=="function"&&(XG=n=>n.startsWith("on")?!Ax(n):r(n))}try{$ve(require("@emotion/is-prop-valid").default)}catch{}function Xve(r,n,o){const l={};for(const u in r)u==="values"&&typeof r.values=="object"||(XG(u)||o===!0&&Ax(u)||!n&&!Ax(u)||r.draggable&&u.startsWith("onDrag"))&&(l[u]=r[u]);return l}const ub=O.createContext({});function hb(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function Mg(r){return typeof r=="string"||Array.isArray(r)}const UI=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],VI=["initial",...UI];function pb(r){return hb(r.animate)||VI.some(n=>Mg(r[n]))}function JG(r){return!!(pb(r)||r.variants)}function Jve(r,n){if(pb(r)){const{initial:o,animate:l}=r;return{initial:o===!1||Mg(o)?o:void 0,animate:Mg(l)?l:void 0}}return r.inherit!==!1?n:{}}function Qve(r){const{initial:n,animate:o}=Jve(r,O.useContext(ub));return O.useMemo(()=>({initial:n,animate:o}),[m6(n),m6(o)])}function m6(r){return Array.isArray(r)?r.join(" "):r}const Fg={};function Zve(r){for(const n in r)Fg[n]=r[n],bI(n)&&(Fg[n].isCSSVariable=!0)}function QG(r,{layout:n,layoutId:o}){return $p.has(r)||r.startsWith("origin")||(n||o!==void 0)&&(!!Fg[r]||r==="opacity")}const eEe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},tEe=Yp.length;function sEe(r,n,o){let l="",u=!0;for(let m=0;m<tEe;m++){const g=Yp[m],E=r[g];if(E===void 0)continue;let y=!0;if(typeof E=="number"?y=E===(g.startsWith("scale")?1:0):y=parseFloat(E)===0,!y||o){const x=WG(E,PI[g]);if(!y){u=!1;const S=eEe[g]||g;l+=`${S}(${x}) `}o&&(n[g]=x)}}return l=l.trim(),o?l=o(n,u?"":l):u&&(l="none"),l}function BI(r,n,o){const{style:l,vars:u,transformOrigin:m}=r;let g=!1,E=!1;for(const y in n){const x=n[y];if($p.has(y)){g=!0;continue}else if(bI(y)){u[y]=x;continue}else{const S=WG(x,PI[y]);y.startsWith("origin")?(E=!0,m[y]=S):l[y]=S}}if(n.transform||(g||o?l.transform=sEe(n,r.transform,o):l.transform&&(l.transform="none")),E){const{originX:y="50%",originY:x="50%",originZ:S=0}=m;l.transformOrigin=`${y} ${x} ${S}`}}const WI=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ZG(r,n,o){for(const l in n)!Ln(n[l])&&!QG(l,o)&&(r[l]=n[l])}function rEe({transformTemplate:r},n){return O.useMemo(()=>{const o=WI();return BI(o,n,r),Object.assign({},o.vars,o.style)},[n])}function nEe(r,n){const o=r.style||{},l={};return ZG(l,o,r),Object.assign(l,rEe(r,n)),l}function iEe(r,n){const o={},l=nEe(r,n);return r.drag&&r.dragListener!==!1&&(o.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(o.tabIndex=0),o.style=l,o}const aEe={offset:"stroke-dashoffset",array:"stroke-dasharray"},oEe={offset:"strokeDashoffset",array:"strokeDasharray"};function cEe(r,n,o=1,l=0,u=!0){r.pathLength=1;const m=u?aEe:oEe;r[m.offset]=qt.transform(-l);const g=qt.transform(n),E=qt.transform(o);r[m.array]=`${g} ${E}`}function eH(r,{attrX:n,attrY:o,attrScale:l,pathLength:u,pathSpacing:m=1,pathOffset:g=0,...E},y,x,S){if(BI(r,E,x),y){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:C,style:R}=r;C.transform&&(R.transform=C.transform,delete C.transform),(R.transform||C.transformOrigin)&&(R.transformOrigin=C.transformOrigin??"50% 50%",delete C.transformOrigin),R.transform&&(R.transformBox=(S==null?void 0:S.transformBox)??"fill-box",delete C.transformBox),n!==void 0&&(C.x=n),o!==void 0&&(C.y=o),l!==void 0&&(C.scale=l),u!==void 0&&cEe(C,u,m,g,!1)}const tH=()=>({...WI(),attrs:{}}),sH=r=>typeof r=="string"&&r.toLowerCase()==="svg";function lEe(r,n,o,l){const u=O.useMemo(()=>{const m=tH();return eH(m,n,sH(l),r.transformTemplate,r.style),{...m.attrs,style:{...m.style}}},[n]);if(r.style){const m={};ZG(m,r.style,r),u.style={...m,...u.style}}return u}const dEe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function GI(r){return typeof r!="string"||r.includes("-")?!1:!!(dEe.indexOf(r)>-1||/[A-Z]/u.test(r))}function uEe(r,n,o,{latestValues:l},u,m=!1){const E=(GI(r)?lEe:iEe)(n,l,u,r),y=Xve(n,typeof r=="string",m),x=r!==O.Fragment?{...y,...E,ref:o}:{},{children:S}=n,C=O.useMemo(()=>Ln(S)?S.get():S,[S]);return O.createElement(r,{...x,children:C})}function f6(r){const n=[{},{}];return r==null||r.values.forEach((o,l)=>{n[0][l]=o.get(),n[1][l]=o.getVelocity()}),n}function HI(r,n,o,l){if(typeof n=="function"){const[u,m]=f6(l);n=n(o!==void 0?o:r.custom,u,m)}if(typeof n=="string"&&(n=r.variants&&r.variants[n]),typeof n=="function"){const[u,m]=f6(l);n=n(o!==void 0?o:r.custom,u,m)}return n}function qy(r){return Ln(r)?r.get():r}function hEe({scrapeMotionValuesFromProps:r,createRenderState:n},o,l,u){return{latestValues:pEe(o,l,u,r),renderState:n()}}function pEe(r,n,o,l){const u={},m=l(r,{});for(const R in m)u[R]=qy(m[R]);let{initial:g,animate:E}=r;const y=pb(r),x=JG(r);n&&x&&!y&&r.inherit!==!1&&(g===void 0&&(g=n.initial),E===void 0&&(E=n.animate));let S=o?o.initial===!1:!1;S=S||g===!1;const C=S?E:g;if(C&&typeof C!="boolean"&&!hb(C)){const R=Array.isArray(C)?C:[C];for(let M=0;M<R.length;M++){const G=HI(r,R[M]);if(G){const{transitionEnd:I,transition:j,...L}=G;for(const N in L){let D=L[N];if(Array.isArray(D)){const V=S?D.length-1:0;D=D[V]}D!==null&&(u[N]=D)}for(const N in I)u[N]=I[N]}}}return u}const rH=r=>(n,o)=>{const l=O.useContext(ub),u=O.useContext(lb),m=()=>hEe(r,n,l,u);return o?m():Kp(m)};function zI(r,n,o){var m;const{style:l}=r,u={};for(const g in l)(Ln(l[g])||n.style&&Ln(n.style[g])||QG(g,r)||((m=o==null?void 0:o.getValue(g))==null?void 0:m.liveStyle)!==void 0)&&(u[g]=l[g]);return u}const mEe=rH({scrapeMotionValuesFromProps:zI,createRenderState:WI});function nH(r,n,o){const l=zI(r,n,o);for(const u in r)if(Ln(r[u])||Ln(n[u])){const m=Yp.indexOf(u)!==-1?"attr"+u.charAt(0).toUpperCase()+u.substring(1):u;l[m]=r[u]}return l}const fEe=rH({scrapeMotionValuesFromProps:nH,createRenderState:tH}),gEe=Symbol.for("motionComponentSymbol");function np(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function _Ee(r,n,o){return O.useCallback(l=>{l&&r.onMount&&r.onMount(l),n&&(l?n.mount(l):n.unmount()),o&&(typeof o=="function"?o(l):np(o)&&(o.current=l))},[n])}const KI=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),vEe="framerAppearId",iH="data-"+KI(vEe),aH=O.createContext({});function EEe(r,n,o,l,u){var I,j;const{visualElement:m}=O.useContext(ub),g=O.useContext($G),E=O.useContext(lb),y=O.useContext(db).reducedMotion,x=O.useRef(null);l=l||g.renderer,!x.current&&l&&(x.current=l(r,{visualState:n,parent:m,props:o,presenceContext:E,blockInitialAnimation:E?E.initial===!1:!1,reducedMotionConfig:y}));const S=x.current,C=O.useContext(aH);S&&!S.projection&&u&&(S.type==="html"||S.type==="svg")&&yEe(x.current,o,u,C);const R=O.useRef(!1);O.useInsertionEffect(()=>{S&&R.current&&S.update(o,E)});const M=o[iH],G=O.useRef(!!M&&!((I=window.MotionHandoffIsComplete)!=null&&I.call(window,M))&&((j=window.MotionHasOptimisedAnimation)==null?void 0:j.call(window,M)));return cb(()=>{S&&(R.current=!0,window.MotionIsMounted=!0,S.updateFeatures(),S.scheduleRenderMicrotask(),G.current&&S.animationState&&S.animationState.animateChanges())}),O.useEffect(()=>{S&&(!G.current&&S.animationState&&S.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{var L;(L=window.MotionHandoffMarkAsComplete)==null||L.call(window,M)}),G.current=!1),S.enteringChildren=void 0)}),S}function yEe(r,n,o,l){const{layoutId:u,layout:m,drag:g,dragConstraints:E,layoutScroll:y,layoutRoot:x,layoutCrossfade:S}=n;r.projection=new o(r.latestValues,n["data-framer-portal-id"]?void 0:oH(r.parent)),r.projection.setOptions({layoutId:u,layout:m,alwaysMeasureLayout:!!g||E&&np(E),visualElement:r,animationType:typeof m=="string"?m:"both",initialPromotionConfig:l,crossfade:S,layoutScroll:y,layoutRoot:x})}function oH(r){if(r)return r.options.allowProjection!==!1?r.projection:oH(r.parent)}function fN(r,{forwardMotionProps:n=!1}={},o,l){o&&qve(o);const u=GI(r)?fEe:mEe;function m(E,y){let x;const S={...O.useContext(db),...E,layoutId:xEe(E)},{isStatic:C}=S,R=Qve(E),M=u(E,C);if(!C&&mI){bEe();const G=wEe(S);x=G.MeasureLayout,R.visualElement=EEe(r,M,S,l,G.ProjectionNode)}return i.jsxs(ub.Provider,{value:R,children:[x&&R.visualElement?i.jsx(x,{visualElement:R.visualElement,...S}):null,uEe(r,E,_Ee(M,R.visualElement,y),M,C,n)]})}m.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const g=O.forwardRef(m);return g[gEe]=r,g}function xEe({layoutId:r}){const n=O.useContext(pI).id;return n&&r!==void 0?n+"-"+r:r}function bEe(r,n){O.useContext($G).strict}function wEe(r){const{drag:n,layout:o}=Lp;if(!n&&!o)return{};const l={...n,...o};return{MeasureLayout:n!=null&&n.isEnabled(r)||o!=null&&o.isEnabled(r)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function SEe(r,n){if(typeof Proxy>"u")return fN;const o=new Map,l=(m,g)=>fN(m,g,r,n),u=(m,g)=>l(m,g);return new Proxy(u,{get:(m,g)=>g==="create"?l:(o.has(g)||o.set(g,fN(g,void 0,r,n)),o.get(g))})}function cH({top:r,left:n,right:o,bottom:l}){return{x:{min:n,max:o},y:{min:r,max:l}}}function CEe({x:r,y:n}){return{top:n.min,right:r.max,bottom:n.max,left:r.min}}function TEe(r,n){if(!n)return r;const o=n({x:r.left,y:r.top}),l=n({x:r.right,y:r.bottom});return{top:o.y,left:o.x,bottom:l.y,right:l.x}}function gN(r){return r===void 0||r===1}function XR({scale:r,scaleX:n,scaleY:o}){return!gN(r)||!gN(n)||!gN(o)}function Wd(r){return XR(r)||lH(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function lH(r){return g6(r.x)||g6(r.y)}function g6(r){return r&&r!=="0%"}function Ix(r,n,o){const l=r-o,u=n*l;return o+u}function _6(r,n,o,l,u){return u!==void 0&&(r=Ix(r,u,l)),Ix(r,o,l)+n}function JR(r,n=0,o=1,l,u){r.min=_6(r.min,n,o,l,u),r.max=_6(r.max,n,o,l,u)}function dH(r,{x:n,y:o}){JR(r.x,n.translate,n.scale,n.originPoint),JR(r.y,o.translate,o.scale,o.originPoint)}const v6=.999999999999,E6=1.0000000000001;function NEe(r,n,o,l=!1){const u=o.length;if(!u)return;n.x=n.y=1;let m,g;for(let E=0;E<u;E++){m=o[E],g=m.projectionDelta;const{visualElement:y}=m.options;y&&y.props.style&&y.props.style.display==="contents"||(l&&m.options.layoutScroll&&m.scroll&&m!==m.root&&ap(r,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),g&&(n.x*=g.x.scale,n.y*=g.y.scale,dH(r,g)),l&&Wd(m.latestValues)&&ap(r,m.latestValues))}n.x<E6&&n.x>v6&&(n.x=1),n.y<E6&&n.y>v6&&(n.y=1)}function ip(r,n){r.min=r.min+n,r.max=r.max+n}function y6(r,n,o,l,u=.5){const m=br(r.min,r.max,u);JR(r,n,o,m,l)}function ap(r,n){y6(r.x,n.x,n.scaleX,n.scale,n.originX),y6(r.y,n.y,n.scaleY,n.scale,n.originY)}function uH(r,n){return cH(TEe(r.getBoundingClientRect(),n))}function REe(r,n,o){const l=uH(r,o),{scroll:u}=n;return u&&(ip(l.x,u.offset.x),ip(l.y,u.offset.y)),l}const x6=()=>({translate:0,scale:1,origin:0,originPoint:0}),op=()=>({x:x6(),y:x6()}),b6=()=>({min:0,max:0}),Vr=()=>({x:b6(),y:b6()}),QR={current:null},hH={current:!1};function AEe(){if(hH.current=!0,!!mI)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),n=()=>QR.current=r.matches;r.addEventListener("change",n),n()}else QR.current=!1}const IEe=new WeakMap;function DEe(r,n,o){for(const l in n){const u=n[l],m=o[l];if(Ln(u))r.addValue(l,u);else if(Ln(m))r.addValue(l,co(u,{owner:r}));else if(m!==u)if(r.hasValue(l)){const g=r.getValue(l);g.liveStyle===!0?g.jump(u):g.hasAnimated||g.set(u)}else{const g=r.getStaticValue(l);r.addValue(l,co(g!==void 0?g:u,{owner:r}))}}for(const l in o)n[l]===void 0&&r.removeValue(l);return n}const w6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class OEe{scrapeMotionValuesFromProps(n,o,l){return{}}constructor({parent:n,props:o,presenceContext:l,reducedMotionConfig:u,blockInitialAnimation:m,visualState:g},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=OI,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const R=xi.now();this.renderScheduledAt<R&&(this.renderScheduledAt=R,Hs.render(this.render,!1,!0))};const{latestValues:y,renderState:x}=g;this.latestValues=y,this.baseTarget={...y},this.initialValues=o.initial?{...y}:{},this.renderState=x,this.parent=n,this.props=o,this.presenceContext=l,this.depth=n?n.depth+1:0,this.reducedMotionConfig=u,this.options=E,this.blockInitialAnimation=!!m,this.isControllingVariants=pb(o),this.isVariantNode=JG(o),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(n&&n.current);const{willChange:S,...C}=this.scrapeMotionValuesFromProps(o,{},this);for(const R in C){const M=C[R];y[R]!==void 0&&Ln(M)&&M.set(y[R])}}mount(n){var o;this.current=n,IEe.set(n,this),this.projection&&!this.projection.instance&&this.projection.mount(n),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((l,u)=>this.bindToMotionValue(u,l)),hH.current||AEe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:QR.current,(o=this.parent)==null||o.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var n;this.projection&&this.projection.unmount(),po(this.notifyUpdate),po(this.render),this.valueSubscriptions.forEach(o=>o()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(n=this.parent)==null||n.removeChild(this);for(const o in this.events)this.events[o].clear();for(const o in this.features){const l=this.features[o];l&&(l.unmount(),l.isMounted=!1)}this.current=null}addChild(n){this.children.add(n),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(n)}removeChild(n){this.children.delete(n),this.enteringChildren&&this.enteringChildren.delete(n)}bindToMotionValue(n,o){this.valueSubscriptions.has(n)&&this.valueSubscriptions.get(n)();const l=$p.has(n);l&&this.onBindTransform&&this.onBindTransform();const u=o.on("change",g=>{this.latestValues[n]=g,this.props.onUpdate&&Hs.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let m;window.MotionCheckAppearSync&&(m=window.MotionCheckAppearSync(this,n,o)),this.valueSubscriptions.set(n,()=>{u(),m&&m(),o.owner&&o.stop()})}sortNodePosition(n){return!this.current||!this.sortInstanceNodePosition||this.type!==n.type?0:this.sortInstanceNodePosition(this.current,n.current)}updateFeatures(){let n="animation";for(n in Lp){const o=Lp[n];if(!o)continue;const{isEnabled:l,Feature:u}=o;if(!this.features[n]&&u&&l(this.props)&&(this.features[n]=new u(this)),this.features[n]){const m=this.features[n];m.isMounted?m.update():(m.mount(),m.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Vr()}getStaticValue(n){return this.latestValues[n]}setStaticValue(n,o){this.latestValues[n]=o}update(n,o){(n.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=n,this.prevPresenceContext=this.presenceContext,this.presenceContext=o;for(let l=0;l<w6.length;l++){const u=w6[l];this.propEventSubscriptions[u]&&(this.propEventSubscriptions[u](),delete this.propEventSubscriptions[u]);const m="on"+u,g=n[m];g&&(this.propEventSubscriptions[u]=this.on(u,g))}this.prevMotionValues=DEe(this,this.scrapeMotionValuesFromProps(n,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(n){return this.props.variants?this.props.variants[n]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(n){const o=this.getClosestVariantNode();if(o)return o.variantChildren&&o.variantChildren.add(n),()=>o.variantChildren.delete(n)}addValue(n,o){const l=this.values.get(n);o!==l&&(l&&this.removeValue(n),this.bindToMotionValue(n,o),this.values.set(n,o),this.latestValues[n]=o.get())}removeValue(n){this.values.delete(n);const o=this.valueSubscriptions.get(n);o&&(o(),this.valueSubscriptions.delete(n)),delete this.latestValues[n],this.removeValueFromRenderState(n,this.renderState)}hasValue(n){return this.values.has(n)}getValue(n,o){if(this.props.values&&this.props.values[n])return this.props.values[n];let l=this.values.get(n);return l===void 0&&o!==void 0&&(l=co(o===null?void 0:o,{owner:this}),this.addValue(n,l)),l}readValue(n,o){let l=this.latestValues[n]!==void 0||!this.current?this.latestValues[n]:this.getBaseTargetFromProps(this.props,n)??this.readValueFromInstance(this.current,n,this.options);return l!=null&&(typeof l=="string"&&(sG(l)||nG(l))?l=parseFloat(l):!Vve(l)&&Wl.test(o)&&(l=VG(n,o)),this.setBaseTarget(n,Ln(l)?l.get():l)),Ln(l)?l.get():l}setBaseTarget(n,o){this.baseTarget[n]=o}getBaseTarget(n){var m;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const g=HI(this.props,o,(m=this.presenceContext)==null?void 0:m.custom);g&&(l=g[n])}if(o&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,n);return u!==void 0&&!Ln(u)?u:this.initialValues[n]!==void 0&&l===void 0?void 0:this.baseTarget[n]}on(n,o){return this.events[n]||(this.events[n]=new vI),this.events[n].add(o)}notify(n,...o){this.events[n]&&this.events[n].notify(...o)}scheduleRenderMicrotask(){LI.render(this.render)}}class pH extends OEe{constructor(){super(...arguments),this.KeyframeResolver=Eve}sortInstanceNodePosition(n,o){return n.compareDocumentPosition(o)&2?1:-1}getBaseTargetFromProps(n,o){return n.style?n.style[o]:void 0}removeValueFromRenderState(n,{vars:o,style:l}){delete o[n],delete l[n]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:n}=this.props;Ln(n)&&(this.childSubscription=n.on("change",o=>{this.current&&(this.current.textContent=`${o}`)}))}}function mH(r,{style:n,vars:o},l,u){const m=r.style;let g;for(g in n)m[g]=n[g];u==null||u.applyProjectionStyles(m,l);for(g in o)m.setProperty(g,o[g])}function jEe(r){return window.getComputedStyle(r)}class PEe extends pH{constructor(){super(...arguments),this.type="html",this.renderInstance=mH}readValueFromInstance(n,o){var l;if($p.has(o))return(l=this.projection)!=null&&l.isProjecting?GR(o):U_e(n,o);{const u=jEe(n),m=(bI(o)?u.getPropertyValue(o):u[o])||0;return typeof m=="string"?m.trim():m}}measureInstanceViewportBox(n,{transformPagePoint:o}){return uH(n,o)}build(n,o,l){BI(n,o,l.transformTemplate)}scrapeMotionValuesFromProps(n,o,l){return zI(n,o,l)}}const fH=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function kEe(r,n,o,l){mH(r,n,void 0,l);for(const u in n.attrs)r.setAttribute(fH.has(u)?u:KI(u),n.attrs[u])}class LEe extends pH{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Vr}getBaseTargetFromProps(n,o){return n[o]}readValueFromInstance(n,o){if($p.has(o)){const l=UG(o);return l&&l.default||0}return o=fH.has(o)?o:KI(o),n.getAttribute(o)}scrapeMotionValuesFromProps(n,o,l){return nH(n,o,l)}build(n,o,l){eH(n,o,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(n,o,l,u){kEe(n,o,l,u)}mount(n){this.isSVGTag=sH(n.tagName),super.mount(n)}}const MEe=(r,n)=>GI(r)?new LEe(n):new PEe(n,{allowProjection:r!==O.Fragment});function fp(r,n,o){const l=r.getProps();return HI(l,n,o!==void 0?o:l.custom,r)}const ZR=r=>Array.isArray(r);function FEe(r,n,o){r.hasValue(n)?r.getValue(n).set(o):r.addValue(n,co(o))}function UEe(r){return ZR(r)?r[r.length-1]||0:r}function VEe(r,n){const o=fp(r,n);let{transitionEnd:l={},transition:u={},...m}=o||{};m={...m,...l};for(const g in m){const E=UEe(m[g]);FEe(r,g,E)}}function BEe(r){return!!(Ln(r)&&r.add)}function eA(r,n){const o=r.getValue("willChange");if(BEe(o))return o.add(n);if(!o&&Tc.WillChange){const l=new Tc.WillChange("auto");r.addValue("willChange",l),l.add(n)}}function gH(r){return r.props[iH]}const WEe=r=>r!==null;function GEe(r,{repeat:n,repeatType:o="loop"},l){const u=r.filter(WEe),m=n&&o!=="loop"&&n%2===1?0:u.length-1;return u[m]}const HEe={type:"spring",stiffness:500,damping:25,restSpeed:10},zEe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),KEe={type:"keyframes",duration:.8},qEe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},YEe=(r,{keyframes:n})=>n.length>2?KEe:$p.has(r)?r.startsWith("scale")?zEe(n[1]):HEe:qEe;function $Ee({when:r,delay:n,delayChildren:o,staggerChildren:l,staggerDirection:u,repeat:m,repeatType:g,repeatDelay:E,from:y,elapsed:x,...S}){return!!Object.keys(S).length}const qI=(r,n,o,l={},u,m)=>g=>{const E=jI(l,r)||{},y=E.delay||l.delay||0;let{elapsed:x=0}=l;x=x-zo(y);const S={keyframes:Array.isArray(o)?o:[null,o],ease:"easeOut",velocity:n.getVelocity(),...E,delay:-x,onUpdate:R=>{n.set(R),E.onUpdate&&E.onUpdate(R)},onComplete:()=>{g(),E.onComplete&&E.onComplete()},name:r,motionValue:n,element:m?void 0:u};$Ee(E)||Object.assign(S,YEe(r,S)),S.duration&&(S.duration=zo(S.duration)),S.repeatDelay&&(S.repeatDelay=zo(S.repeatDelay)),S.from!==void 0&&(S.keyframes[0]=S.from);let C=!1;if((S.type===!1||S.duration===0&&!S.repeatDelay)&&(YR(S),S.delay===0&&(C=!0)),(Tc.instantAnimations||Tc.skipAnimations)&&(C=!0,YR(S),S.delay=0),S.allowFlatten=!E.type&&!E.ease,C&&!m&&n.get()!==void 0){const R=GEe(S.keyframes,E);if(R!==void 0){Hs.update(()=>{S.onUpdate(R),S.onComplete()});return}}return E.isSync?new DI(S):new ove(S)};function XEe({protectedKeys:r,needsAnimating:n},o){const l=r.hasOwnProperty(o)&&n[o]!==!0;return n[o]=!1,l}function _H(r,n,{delay:o=0,transitionOverride:l,type:u}={}){let{transition:m=r.getDefaultTransition(),transitionEnd:g,...E}=n;l&&(m=l);const y=[],x=u&&r.animationState&&r.animationState.getState()[u];for(const S in E){const C=r.getValue(S,r.latestValues[S]??null),R=E[S];if(R===void 0||x&&XEe(x,S))continue;const M={delay:o,...jI(m||{},S)},G=C.get();if(G!==void 0&&!C.isAnimating&&!Array.isArray(R)&&R===G&&!M.velocity)continue;let I=!1;if(window.MotionHandoffAnimation){const L=gH(r);if(L){const N=window.MotionHandoffAnimation(L,S,Hs);N!==null&&(M.startTime=N,I=!0)}}eA(r,S),C.start(qI(S,C,R,r.shouldReduceMotion&&LG.has(S)?{type:!1}:M,r,I));const j=C.animation;j&&y.push(j)}return g&&Promise.all(y).then(()=>{Hs.update(()=>{g&&VEe(r,g)})}),y}function vH(r,n,o,l=0,u=1){const m=Array.from(r).sort((x,S)=>x.sortNodePosition(S)).indexOf(n),g=r.size,E=(g-1)*l;return typeof o=="function"?o(m,g):u===1?m*l:E-m*l}function tA(r,n,o={}){var y;const l=fp(r,n,o.type==="exit"?(y=r.presenceContext)==null?void 0:y.custom:void 0);let{transition:u=r.getDefaultTransition()||{}}=l||{};o.transitionOverride&&(u=o.transitionOverride);const m=l?()=>Promise.all(_H(r,l,o)):()=>Promise.resolve(),g=r.variantChildren&&r.variantChildren.size?(x=0)=>{const{delayChildren:S=0,staggerChildren:C,staggerDirection:R}=u;return JEe(r,n,x,S,C,R,o)}:()=>Promise.resolve(),{when:E}=u;if(E){const[x,S]=E==="beforeChildren"?[m,g]:[g,m];return x().then(()=>S())}else return Promise.all([m(),g(o.delay)])}function JEe(r,n,o=0,l=0,u=0,m=1,g){const E=[];for(const y of r.variantChildren)y.notify("AnimationStart",n),E.push(tA(y,n,{...g,delay:o+(typeof l=="function"?0:l)+vH(r.variantChildren,y,l,u,m)}).then(()=>y.notify("AnimationComplete",n)));return Promise.all(E)}function QEe(r,n,o={}){r.notify("AnimationStart",n);let l;if(Array.isArray(n)){const u=n.map(m=>tA(r,m,o));l=Promise.all(u)}else if(typeof n=="string")l=tA(r,n,o);else{const u=typeof n=="function"?fp(r,n,o.custom):n;l=Promise.all(_H(r,u,o))}return l.then(()=>{r.notify("AnimationComplete",n)})}function EH(r,n){if(!Array.isArray(n))return!1;const o=n.length;if(o!==r.length)return!1;for(let l=0;l<o;l++)if(n[l]!==r[l])return!1;return!0}const ZEe=VI.length;function yH(r){if(!r)return;if(!r.isControllingVariants){const o=r.parent?yH(r.parent)||{}:{};return r.props.initial!==void 0&&(o.initial=r.props.initial),o}const n={};for(let o=0;o<ZEe;o++){const l=VI[o],u=r.props[l];(Mg(u)||u===!1)&&(n[l]=u)}return n}const eye=[...UI].reverse(),tye=UI.length;function sye(r){return n=>Promise.all(n.map(({animation:o,options:l})=>QEe(r,o,l)))}function rye(r){let n=sye(r),o=S6(),l=!0;const u=y=>(x,S)=>{var R;const C=fp(r,S,y==="exit"?(R=r.presenceContext)==null?void 0:R.custom:void 0);if(C){const{transition:M,transitionEnd:G,...I}=C;x={...x,...I,...G}}return x};function m(y){n=y(r)}function g(y){const{props:x}=r,S=yH(r.parent)||{},C=[],R=new Set;let M={},G=1/0;for(let j=0;j<tye;j++){const L=eye[j],N=o[L],D=x[L]!==void 0?x[L]:S[L],V=Mg(D),B=L===y?N.isActive:null;B===!1&&(G=j);let z=D===S[L]&&D!==x[L]&&V;if(z&&l&&r.manuallyAnimateOnMount&&(z=!1),N.protectedKeys={...M},!N.isActive&&B===null||!D&&!N.prevProp||hb(D)||typeof D=="boolean")continue;const H=nye(N.prevProp,D);let J=H||L===y&&N.isActive&&!z&&V||j>G&&V,ee=!1;const ne=Array.isArray(D)?D:[D];let he=ne.reduce(u(L),{});B===!1&&(he={});const{prevResolvedValues:ve={}}=N,ye={...ve,...he},me=be=>{J=!0,R.has(be)&&(ee=!0,R.delete(be)),N.needsAnimating[be]=!0;const ae=r.getValue(be);ae&&(ae.liveStyle=!1)};for(const be in ye){const ae=he[be],ge=ve[be];if(M.hasOwnProperty(be))continue;let Se=!1;ZR(ae)&&ZR(ge)?Se=!EH(ae,ge):Se=ae!==ge,Se?ae!=null?me(be):R.add(be):ae!==void 0&&R.has(be)?me(be):N.protectedKeys[be]=!0}N.prevProp=D,N.prevResolvedValues=he,N.isActive&&(M={...M,...he}),l&&r.blockInitialAnimation&&(J=!1);const ue=z&&H;J&&(!ue||ee)&&C.push(...ne.map(be=>{const ae={type:L};if(typeof be=="string"&&l&&!ue&&r.manuallyAnimateOnMount&&r.parent){const{parent:ge}=r,Se=fp(ge,be);if(ge.enteringChildren&&Se){const{delayChildren:it}=Se.transition||{};ae.delay=vH(ge.enteringChildren,r,it)}}return{animation:be,options:ae}}))}if(R.size){const j={};if(typeof x.initial!="boolean"){const L=fp(r,Array.isArray(x.initial)?x.initial[0]:x.initial);L&&L.transition&&(j.transition=L.transition)}R.forEach(L=>{const N=r.getBaseTarget(L),D=r.getValue(L);D&&(D.liveStyle=!0),j[L]=N??null}),C.push({animation:j})}let I=!!C.length;return l&&(x.initial===!1||x.initial===x.animate)&&!r.manuallyAnimateOnMount&&(I=!1),l=!1,I?n(C):Promise.resolve()}function E(y,x){var C;if(o[y].isActive===x)return Promise.resolve();(C=r.variantChildren)==null||C.forEach(R=>{var M;return(M=R.animationState)==null?void 0:M.setActive(y,x)}),o[y].isActive=x;const S=g(y);for(const R in o)o[R].protectedKeys={};return S}return{animateChanges:g,setActive:E,setAnimateFunction:m,getState:()=>o,reset:()=>{o=S6()}}}function nye(r,n){return typeof n=="string"?n!==r:Array.isArray(n)?!EH(n,r):!1}function kd(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function S6(){return{animate:kd(!0),whileInView:kd(),whileHover:kd(),whileTap:kd(),whileDrag:kd(),whileFocus:kd(),exit:kd()}}class ql{constructor(n){this.isMounted=!1,this.node=n}update(){}}class iye extends ql{constructor(n){super(n),n.animationState||(n.animationState=rye(n))}updateAnimationControlsSubscription(){const{animate:n}=this.node.getProps();hb(n)&&(this.unmountControls=n.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:n}=this.node.getProps(),{animate:o}=this.node.prevProps||{};n!==o&&this.updateAnimationControlsSubscription()}unmount(){var n;this.node.animationState.reset(),(n=this.unmountControls)==null||n.call(this)}}let aye=0;class oye extends ql{constructor(){super(...arguments),this.id=aye++}update(){if(!this.node.presenceContext)return;const{isPresent:n,onExitComplete:o}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||n===l)return;const u=this.node.animationState.setActive("exit",!n);o&&!n&&u.then(()=>{o(this.id)})}mount(){const{register:n,onExitComplete:o}=this.node.presenceContext||{};o&&o(this.id),n&&(this.unmount=n(this.id))}unmount(){}}const cye={animation:{Feature:iye},exit:{Feature:oye}};function Ug(r,n,o,l={passive:!0}){return r.addEventListener(n,o,l),()=>r.removeEventListener(n,o)}function e_(r){return{point:{x:r.pageX,y:r.pageY}}}const lye=r=>n=>MI(n)&&r(n,e_(n));function lg(r,n,o,l){return Ug(r,n,lye(o),l)}const xH=1e-4,dye=1-xH,uye=1+xH,bH=.01,hye=0-bH,pye=0+bH;function Yn(r){return r.max-r.min}function mye(r,n,o){return Math.abs(r-n)<=o}function C6(r,n,o,l=.5){r.origin=l,r.originPoint=br(n.min,n.max,r.origin),r.scale=Yn(o)/Yn(n),r.translate=br(o.min,o.max,r.origin)-r.originPoint,(r.scale>=dye&&r.scale<=uye||isNaN(r.scale))&&(r.scale=1),(r.translate>=hye&&r.translate<=pye||isNaN(r.translate))&&(r.translate=0)}function dg(r,n,o,l){C6(r.x,n.x,o.x,l?l.originX:void 0),C6(r.y,n.y,o.y,l?l.originY:void 0)}function T6(r,n,o){r.min=o.min+n.min,r.max=r.min+Yn(n)}function fye(r,n,o){T6(r.x,n.x,o.x),T6(r.y,n.y,o.y)}function N6(r,n,o){r.min=n.min-o.min,r.max=r.min+Yn(n)}function ug(r,n,o){N6(r.x,n.x,o.x),N6(r.y,n.y,o.y)}function ya(r){return[r("x"),r("y")]}const wH=({current:r})=>r?r.ownerDocument.defaultView:null,R6=(r,n)=>Math.abs(r-n);function gye(r,n){const o=R6(r.x,n.x),l=R6(r.y,n.y);return Math.sqrt(o**2+l**2)}class SH{constructor(n,o,{transformPagePoint:l,contextWindow:u=window,dragSnapToOrigin:m=!1,distanceThreshold:g=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const R=vN(this.lastMoveEventInfo,this.history),M=this.startEvent!==null,G=gye(R.offset,{x:0,y:0})>=this.distanceThreshold;if(!M&&!G)return;const{point:I}=R,{timestamp:j}=dn;this.history.push({...I,timestamp:j});const{onStart:L,onMove:N}=this.handlers;M||(L&&L(this.lastMoveEvent,R),this.startEvent=this.lastMoveEvent),N&&N(this.lastMoveEvent,R)},this.handlePointerMove=(R,M)=>{this.lastMoveEvent=R,this.lastMoveEventInfo=_N(M,this.transformPagePoint),Hs.update(this.updatePoint,!0)},this.handlePointerUp=(R,M)=>{this.end();const{onEnd:G,onSessionEnd:I,resumeAnimation:j}=this.handlers;if(this.dragSnapToOrigin&&j&&j(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=vN(R.type==="pointercancel"?this.lastMoveEventInfo:_N(M,this.transformPagePoint),this.history);this.startEvent&&G&&G(R,L),I&&I(R,L)},!MI(n))return;this.dragSnapToOrigin=m,this.handlers=o,this.transformPagePoint=l,this.distanceThreshold=g,this.contextWindow=u||window;const E=e_(n),y=_N(E,this.transformPagePoint),{point:x}=y,{timestamp:S}=dn;this.history=[{...x,timestamp:S}];const{onSessionStart:C}=o;C&&C(n,vN(y,this.history)),this.removeListeners=Jg(lg(this.contextWindow,"pointermove",this.handlePointerMove),lg(this.contextWindow,"pointerup",this.handlePointerUp),lg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(n){this.handlers=n}end(){this.removeListeners&&this.removeListeners(),po(this.updatePoint)}}function _N(r,n){return n?{point:n(r.point)}:r}function A6(r,n){return{x:r.x-n.x,y:r.y-n.y}}function vN({point:r},n){return{point:r,delta:A6(r,CH(n)),offset:A6(r,_ye(n)),velocity:vye(n,.1)}}function _ye(r){return r[0]}function CH(r){return r[r.length-1]}function vye(r,n){if(r.length<2)return{x:0,y:0};let o=r.length-1,l=null;const u=CH(r);for(;o>=0&&(l=r[o],!(u.timestamp-l.timestamp>zo(n)));)o--;if(!l)return{x:0,y:0};const m=Ta(u.timestamp-l.timestamp);if(m===0)return{x:0,y:0};const g={x:(u.x-l.x)/m,y:(u.y-l.y)/m};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}function Eye(r,{min:n,max:o},l){return n!==void 0&&r<n?r=l?br(n,r,l.min):Math.max(r,n):o!==void 0&&r>o&&(r=l?br(o,r,l.max):Math.min(r,o)),r}function I6(r,n,o){return{min:n!==void 0?r.min+n:void 0,max:o!==void 0?r.max+o-(r.max-r.min):void 0}}function yye(r,{top:n,left:o,bottom:l,right:u}){return{x:I6(r.x,o,u),y:I6(r.y,n,l)}}function D6(r,n){let o=n.min-r.min,l=n.max-r.max;return n.max-n.min<r.max-r.min&&([o,l]=[l,o]),{min:o,max:l}}function xye(r,n){return{x:D6(r.x,n.x),y:D6(r.y,n.y)}}function bye(r,n){let o=.5;const l=Yn(r),u=Yn(n);return u>l?o=kp(n.min,n.max-l,r.min):l>u&&(o=kp(r.min,r.max-u,n.min)),qo(0,1,o)}function wye(r,n){const o={};return n.min!==void 0&&(o.min=n.min-r.min),n.max!==void 0&&(o.max=n.max-r.min),o}const sA=.35;function Sye(r=sA){return r===!1?r=0:r===!0&&(r=sA),{x:O6(r,"left","right"),y:O6(r,"top","bottom")}}function O6(r,n,o){return{min:j6(r,n),max:j6(r,o)}}function j6(r,n){return typeof r=="number"?r:r[n]||0}const Cye=new WeakMap;class Tye{constructor(n){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Vr(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=n}start(n,{snapToCursor:o=!1,distanceThreshold:l}={}){const{presenceContext:u}=this.visualElement;if(u&&u.isPresent===!1)return;const m=C=>{const{dragSnapToOrigin:R}=this.getProps();R?this.pauseAnimation():this.stopAnimation(),o&&this.snapToCursor(e_(C).point)},g=(C,R)=>{const{drag:M,dragPropagation:G,onDragStart:I}=this.getProps();if(M&&!G&&(this.openDragLock&&this.openDragLock(),this.openDragLock=bve(M),!this.openDragLock))return;this.latestPointerEvent=C,this.latestPanInfo=R,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ya(L=>{let N=this.getAxisMotionValue(L).get()||0;if(Ko.test(N)){const{projection:D}=this.visualElement;if(D&&D.layout){const V=D.layout.layoutBox[L];V&&(N=Yn(V)*(parseFloat(N)/100))}}this.originPoint[L]=N}),I&&Hs.postRender(()=>I(C,R)),eA(this.visualElement,"transform");const{animationState:j}=this.visualElement;j&&j.setActive("whileDrag",!0)},E=(C,R)=>{this.latestPointerEvent=C,this.latestPanInfo=R;const{dragPropagation:M,dragDirectionLock:G,onDirectionLock:I,onDrag:j}=this.getProps();if(!M&&!this.openDragLock)return;const{offset:L}=R;if(G&&this.currentDirection===null){this.currentDirection=Nye(L),this.currentDirection!==null&&I&&I(this.currentDirection);return}this.updateAxis("x",R.point,L),this.updateAxis("y",R.point,L),this.visualElement.render(),j&&j(C,R)},y=(C,R)=>{this.latestPointerEvent=C,this.latestPanInfo=R,this.stop(C,R),this.latestPointerEvent=null,this.latestPanInfo=null},x=()=>ya(C=>{var R;return this.getAnimationState(C)==="paused"&&((R=this.getAxisMotionValue(C).animation)==null?void 0:R.play())}),{dragSnapToOrigin:S}=this.getProps();this.panSession=new SH(n,{onSessionStart:m,onStart:g,onMove:E,onSessionEnd:y,resumeAnimation:x},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:S,distanceThreshold:l,contextWindow:wH(this.visualElement)})}stop(n,o){const l=n||this.latestPointerEvent,u=o||this.latestPanInfo,m=this.isDragging;if(this.cancel(),!m||!u||!l)return;const{velocity:g}=u;this.startAnimation(g);const{onDragEnd:E}=this.getProps();E&&Hs.postRender(()=>E(l,u))}cancel(){this.isDragging=!1;const{projection:n,animationState:o}=this.visualElement;n&&(n.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:l}=this.getProps();!l&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),o&&o.setActive("whileDrag",!1)}updateAxis(n,o,l){const{drag:u}=this.getProps();if(!l||!Ty(n,u,this.currentDirection))return;const m=this.getAxisMotionValue(n);let g=this.originPoint[n]+l[n];this.constraints&&this.constraints[n]&&(g=Eye(g,this.constraints[n],this.elastic[n])),m.set(g)}resolveConstraints(){var m;const{dragConstraints:n,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(m=this.visualElement.projection)==null?void 0:m.layout,u=this.constraints;n&&np(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&l?this.constraints=yye(l.layoutBox,n):this.constraints=!1,this.elastic=Sye(o),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&ya(g=>{this.constraints!==!1&&this.getAxisMotionValue(g)&&(this.constraints[g]=wye(l.layoutBox[g],this.constraints[g]))})}resolveRefConstraints(){const{dragConstraints:n,onMeasureDragConstraints:o}=this.getProps();if(!n||!np(n))return!1;const l=n.current,{projection:u}=this.visualElement;if(!u||!u.layout)return!1;const m=REe(l,u.root,this.visualElement.getTransformPagePoint());let g=xye(u.layout.layoutBox,m);if(o){const E=o(CEe(g));this.hasMutatedConstraints=!!E,E&&(g=cH(E))}return g}startAnimation(n){const{drag:o,dragMomentum:l,dragElastic:u,dragTransition:m,dragSnapToOrigin:g,onDragTransitionEnd:E}=this.getProps(),y=this.constraints||{},x=ya(S=>{if(!Ty(S,o,this.currentDirection))return;let C=y&&y[S]||{};g&&(C={min:0,max:0});const R=u?200:1e6,M=u?40:1e7,G={type:"inertia",velocity:l?n[S]:0,bounceStiffness:R,bounceDamping:M,timeConstant:750,restDelta:1,restSpeed:10,...m,...C};return this.startAxisValueAnimation(S,G)});return Promise.all(x).then(E)}startAxisValueAnimation(n,o){const l=this.getAxisMotionValue(n);return eA(this.visualElement,n),l.start(qI(n,l,0,o,this.visualElement,!1))}stopAnimation(){ya(n=>this.getAxisMotionValue(n).stop())}pauseAnimation(){ya(n=>{var o;return(o=this.getAxisMotionValue(n).animation)==null?void 0:o.pause()})}getAnimationState(n){var o;return(o=this.getAxisMotionValue(n).animation)==null?void 0:o.state}getAxisMotionValue(n){const o=`_drag${n.toUpperCase()}`,l=this.visualElement.getProps(),u=l[o];return u||this.visualElement.getValue(n,(l.initial?l.initial[n]:void 0)||0)}snapToCursor(n){ya(o=>{const{drag:l}=this.getProps();if(!Ty(o,l,this.currentDirection))return;const{projection:u}=this.visualElement,m=this.getAxisMotionValue(o);if(u&&u.layout){const{min:g,max:E}=u.layout.layoutBox[o];m.set(n[o]-br(g,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:n,dragConstraints:o}=this.getProps(),{projection:l}=this.visualElement;if(!np(o)||!l||!this.constraints)return;this.stopAnimation();const u={x:0,y:0};ya(g=>{const E=this.getAxisMotionValue(g);if(E&&this.constraints!==!1){const y=E.get();u[g]=bye({min:y,max:y},this.constraints[g])}});const{transformTemplate:m}=this.visualElement.getProps();this.visualElement.current.style.transform=m?m({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),ya(g=>{if(!Ty(g,n,null))return;const E=this.getAxisMotionValue(g),{min:y,max:x}=this.constraints[g];E.set(br(y,x,u[g]))})}addListeners(){if(!this.visualElement.current)return;Cye.set(this.visualElement,this);const n=this.visualElement.current,o=lg(n,"pointerdown",y=>{const{drag:x,dragListener:S=!0}=this.getProps();x&&S&&this.start(y)}),l=()=>{const{dragConstraints:y}=this.getProps();np(y)&&y.current&&(this.constraints=this.resolveRefConstraints())},{projection:u}=this.visualElement,m=u.addEventListener("measure",l);u&&!u.layout&&(u.root&&u.root.updateScroll(),u.updateLayout()),Hs.read(l);const g=Ug(window,"resize",()=>this.scalePositionWithinConstraints()),E=u.addEventListener("didUpdate",({delta:y,hasLayoutChanged:x})=>{this.isDragging&&x&&(ya(S=>{const C=this.getAxisMotionValue(S);C&&(this.originPoint[S]+=y[S].translate,C.set(C.get()+y[S].translate))}),this.visualElement.render())});return()=>{g(),o(),m(),E&&E()}}getProps(){const n=this.visualElement.getProps(),{drag:o=!1,dragDirectionLock:l=!1,dragPropagation:u=!1,dragConstraints:m=!1,dragElastic:g=sA,dragMomentum:E=!0}=n;return{...n,drag:o,dragDirectionLock:l,dragPropagation:u,dragConstraints:m,dragElastic:g,dragMomentum:E}}}function Ty(r,n,o){return(n===!0||n===r)&&(o===null||o===r)}function Nye(r,n=10){let o=null;return Math.abs(r.y)>n?o="y":Math.abs(r.x)>n&&(o="x"),o}class Rye extends ql{constructor(n){super(n),this.removeGroupControls=Ci,this.removeListeners=Ci,this.controls=new Tye(n)}mount(){const{dragControls:n}=this.node.getProps();n&&(this.removeGroupControls=n.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ci}unmount(){this.removeGroupControls(),this.removeListeners()}}const P6=r=>(n,o)=>{r&&Hs.postRender(()=>r(n,o))};class Aye extends ql{constructor(){super(...arguments),this.removePointerDownListener=Ci}onPointerDown(n){this.session=new SH(n,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:wH(this.node)})}createPanHandlers(){const{onPanSessionStart:n,onPanStart:o,onPan:l,onPanEnd:u}=this.node.getProps();return{onSessionStart:P6(n),onStart:P6(o),onMove:l,onEnd:(m,g)=>{delete this.session,u&&Hs.postRender(()=>u(m,g))}}}mount(){this.removePointerDownListener=lg(this.node.current,"pointerdown",n=>this.onPointerDown(n))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Yy={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function k6(r,n){return n.max===n.min?0:r/(n.max-n.min)*100}const Uf={correct:(r,n)=>{if(!n.target)return r;if(typeof r=="string")if(qt.test(r))r=parseFloat(r);else return r;const o=k6(r,n.target.x),l=k6(r,n.target.y);return`${o}% ${l}%`}},Iye={correct:(r,{treeScale:n,projectionDelta:o})=>{const l=r,u=Wl.parse(r);if(u.length>5)return l;const m=Wl.createTransformer(r),g=typeof u[0]!="number"?1:0,E=o.x.scale*n.x,y=o.y.scale*n.y;u[0+g]/=E,u[1+g]/=y;const x=br(E,y,.5);return typeof u[2+g]=="number"&&(u[2+g]/=x),typeof u[3+g]=="number"&&(u[3+g]/=x),m(u)}};let EN=!1;class Dye extends O.Component{componentDidMount(){const{visualElement:n,layoutGroup:o,switchLayoutGroup:l,layoutId:u}=this.props,{projection:m}=n;Zve(Oye),m&&(o.group&&o.group.add(m),l&&l.register&&u&&l.register(m),EN&&m.root.didUpdate(),m.addEventListener("animationComplete",()=>{this.safeToRemove()}),m.setOptions({...m.options,onExitComplete:()=>this.safeToRemove()})),Yy.hasEverUpdated=!0}getSnapshotBeforeUpdate(n){const{layoutDependency:o,visualElement:l,drag:u,isPresent:m}=this.props,{projection:g}=l;return g&&(g.isPresent=m,EN=!0,u||n.layoutDependency!==o||o===void 0||n.isPresent!==m?g.willUpdate():this.safeToRemove(),n.isPresent!==m&&(m?g.promote():g.relegate()||Hs.postRender(()=>{const E=g.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:n}=this.props.visualElement;n&&(n.root.didUpdate(),LI.postRender(()=>{!n.currentAnimation&&n.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:n,layoutGroup:o,switchLayoutGroup:l}=this.props,{projection:u}=n;EN=!0,u&&(u.scheduleCheckAfterUnmount(),o&&o.group&&o.group.remove(u),l&&l.deregister&&l.deregister(u))}safeToRemove(){const{safeToRemove:n}=this.props;n&&n()}render(){return null}}function TH(r){const[n,o]=YG(),l=O.useContext(pI);return i.jsx(Dye,{...r,layoutGroup:l,switchLayoutGroup:O.useContext(aH),isPresent:n,safeToRemove:o})}const Oye={borderRadius:{...Uf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Uf,borderTopRightRadius:Uf,borderBottomLeftRadius:Uf,borderBottomRightRadius:Uf,boxShadow:Iye};function jye(r,n,o){const l=Ln(r)?r:co(r);return l.start(qI("",l,n,o)),l.animation}const Pye=(r,n)=>r.depth-n.depth;class kye{constructor(){this.children=[],this.isDirty=!1}add(n){fI(this.children,n),this.isDirty=!0}remove(n){gI(this.children,n),this.isDirty=!0}forEach(n){this.isDirty&&this.children.sort(Pye),this.isDirty=!1,this.children.forEach(n)}}function Lye(r,n){const o=xi.now(),l=({timestamp:u})=>{const m=u-o;m>=n&&(po(l),r(m-n))};return Hs.setup(l,!0),()=>po(l)}const NH=["TopLeft","TopRight","BottomLeft","BottomRight"],Mye=NH.length,L6=r=>typeof r=="string"?parseFloat(r):r,M6=r=>typeof r=="number"||qt.test(r);function Fye(r,n,o,l,u,m){u?(r.opacity=br(0,o.opacity??1,Uye(l)),r.opacityExit=br(n.opacity??1,0,Vye(l))):m&&(r.opacity=br(n.opacity??1,o.opacity??1,l));for(let g=0;g<Mye;g++){const E=`border${NH[g]}Radius`;let y=F6(n,E),x=F6(o,E);if(y===void 0&&x===void 0)continue;y||(y=0),x||(x=0),y===0||x===0||M6(y)===M6(x)?(r[E]=Math.max(br(L6(y),L6(x),l),0),(Ko.test(x)||Ko.test(y))&&(r[E]+="%")):r[E]=x}(n.rotate||o.rotate)&&(r.rotate=br(n.rotate||0,o.rotate||0,l))}function F6(r,n){return r[n]!==void 0?r[n]:r.borderRadius}const Uye=RH(0,.5,uG),Vye=RH(.5,.95,Ci);function RH(r,n,o){return l=>l<r?0:l>n?1:o(kp(r,n,l))}function U6(r,n){r.min=n.min,r.max=n.max}function Ea(r,n){U6(r.x,n.x),U6(r.y,n.y)}function V6(r,n){r.translate=n.translate,r.scale=n.scale,r.originPoint=n.originPoint,r.origin=n.origin}function B6(r,n,o,l,u){return r-=n,r=Ix(r,1/o,l),u!==void 0&&(r=Ix(r,1/u,l)),r}function Bye(r,n=0,o=1,l=.5,u,m=r,g=r){if(Ko.test(n)&&(n=parseFloat(n),n=br(g.min,g.max,n/100)-g.min),typeof n!="number")return;let E=br(m.min,m.max,l);r===m&&(E-=n),r.min=B6(r.min,n,o,E,u),r.max=B6(r.max,n,o,E,u)}function W6(r,n,[o,l,u],m,g){Bye(r,n[o],n[l],n[u],n.scale,m,g)}const Wye=["x","scaleX","originX"],Gye=["y","scaleY","originY"];function G6(r,n,o,l){W6(r.x,n,Wye,o?o.x:void 0,l?l.x:void 0),W6(r.y,n,Gye,o?o.y:void 0,l?l.y:void 0)}function H6(r){return r.translate===0&&r.scale===1}function AH(r){return H6(r.x)&&H6(r.y)}function z6(r,n){return r.min===n.min&&r.max===n.max}function Hye(r,n){return z6(r.x,n.x)&&z6(r.y,n.y)}function K6(r,n){return Math.round(r.min)===Math.round(n.min)&&Math.round(r.max)===Math.round(n.max)}function IH(r,n){return K6(r.x,n.x)&&K6(r.y,n.y)}function q6(r){return Yn(r.x)/Yn(r.y)}function Y6(r,n){return r.translate===n.translate&&r.scale===n.scale&&r.originPoint===n.originPoint}class zye{constructor(){this.members=[]}add(n){fI(this.members,n),n.scheduleRender()}remove(n){if(gI(this.members,n),n===this.prevLead&&(this.prevLead=void 0),n===this.lead){const o=this.members[this.members.length-1];o&&this.promote(o)}}relegate(n){const o=this.members.findIndex(u=>n===u);if(o===0)return!1;let l;for(let u=o;u>=0;u--){const m=this.members[u];if(m.isPresent!==!1){l=m;break}}return l?(this.promote(l),!0):!1}promote(n,o){const l=this.lead;if(n!==l&&(this.prevLead=l,this.lead=n,n.show(),l)){l.instance&&l.scheduleRender(),n.scheduleRender(),n.resumeFrom=l,o&&(n.resumeFrom.preserveOpacity=!0),l.snapshot&&(n.snapshot=l.snapshot,n.snapshot.latestValues=l.animationValues||l.latestValues),n.root&&n.root.isUpdating&&(n.isLayoutDirty=!0);const{crossfade:u}=n.options;u===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(n=>{const{options:o,resumingFrom:l}=n;o.onExitComplete&&o.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(n=>{n.instance&&n.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Kye(r,n,o){let l="";const u=r.x.translate/n.x,m=r.y.translate/n.y,g=(o==null?void 0:o.z)||0;if((u||m||g)&&(l=`translate3d(${u}px, ${m}px, ${g}px) `),(n.x!==1||n.y!==1)&&(l+=`scale(${1/n.x}, ${1/n.y}) `),o){const{transformPerspective:x,rotate:S,rotateX:C,rotateY:R,skewX:M,skewY:G}=o;x&&(l=`perspective(${x}px) ${l}`),S&&(l+=`rotate(${S}deg) `),C&&(l+=`rotateX(${C}deg) `),R&&(l+=`rotateY(${R}deg) `),M&&(l+=`skewX(${M}deg) `),G&&(l+=`skewY(${G}deg) `)}const E=r.x.scale*n.x,y=r.y.scale*n.y;return(E!==1||y!==1)&&(l+=`scale(${E}, ${y})`),l||"none"}const yN=["","X","Y","Z"],qye=1e3;let Yye=0;function xN(r,n,o,l){const{latestValues:u}=n;u[r]&&(o[r]=u[r],n.setStaticValue(r,0),l&&(l[r]=0))}function DH(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:n}=r.options;if(!n)return;const o=gH(n);if(window.MotionHasOptimisedAnimation(o,"transform")){const{layout:u,layoutId:m}=r.options;window.MotionCancelOptimisedAnimation(o,"transform",Hs,!(u||m))}const{parent:l}=r;l&&!l.hasCheckedOptimisedAppear&&DH(l)}function OH({attachResizeListener:r,defaultParent:n,measureScroll:o,checkIsScrollRoot:l,resetTransform:u}){return class{constructor(g={},E=n==null?void 0:n()){this.id=Yye++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Jye),this.nodes.forEach(txe),this.nodes.forEach(sxe),this.nodes.forEach(Qye)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=g,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let y=0;y<this.path.length;y++)this.path[y].shouldResetTransform=!0;this.root===this&&(this.nodes=new kye)}addEventListener(g,E){return this.eventHandlers.has(g)||this.eventHandlers.set(g,new vI),this.eventHandlers.get(g).add(E)}notifyListeners(g,...E){const y=this.eventHandlers.get(g);y&&y.notify(...E)}hasListeners(g){return this.eventHandlers.has(g)}mount(g){if(this.instance)return;this.isSVG=FI(g)&&!Mve(g),this.instance=g;const{layoutId:E,layout:y,visualElement:x}=this.options;if(x&&!x.current&&x.mount(g),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(y||E)&&(this.isLayoutDirty=!0),r){let S,C=0;const R=()=>this.root.updateBlockedByResize=!1;Hs.read(()=>{C=window.innerWidth}),r(g,()=>{const M=window.innerWidth;M!==C&&(C=M,this.root.updateBlockedByResize=!0,S&&S(),S=Lye(R,250),Yy.hasAnimatedSinceResize&&(Yy.hasAnimatedSinceResize=!1,this.nodes.forEach(J6)))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&x&&(E||y)&&this.addEventListener("didUpdate",({delta:S,hasLayoutChanged:C,hasRelativeLayoutChanged:R,layout:M})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||x.getDefaultTransition()||oxe,{onLayoutAnimationStart:I,onLayoutAnimationComplete:j}=x.getProps(),L=!this.targetLayout||!IH(this.targetLayout,M),N=!C&&R;if(this.options.layoutRoot||this.resumeFrom||N||C&&(L||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const D={...jI(G,"layout"),onPlay:I,onComplete:j};(x.shouldReduceMotion||this.options.layoutRoot)&&(D.delay=0,D.type=!1),this.startAnimation(D),this.setAnimationOrigin(S,N)}else C||J6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=M})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const g=this.getStack();g&&g.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),po(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(rxe),this.animationId++)}getTransformTemplate(){const{visualElement:g}=this.options;return g&&g.getProps().transformTemplate}willUpdate(g=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&DH(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let S=0;S<this.path.length;S++){const C=this.path[S];C.shouldResetTransform=!0,C.updateScroll("snapshot"),C.options.layoutRoot&&C.willUpdate(!1)}const{layoutId:E,layout:y}=this.options;if(E===void 0&&!y)return;const x=this.getTransformTemplate();this.prevTransformTemplateValue=x?x(this.latestValues,""):void 0,this.updateSnapshot(),g&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach($6);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(X6);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(exe),this.nodes.forEach($ye),this.nodes.forEach(Xye)):this.nodes.forEach(X6),this.clearAllSnapshots();const E=xi.now();dn.delta=qo(0,1e3/60,E-dn.timestamp),dn.timestamp=E,dn.isProcessing=!0,lN.update.process(dn),lN.preRender.process(dn),lN.render.process(dn),dn.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,LI.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Zye),this.sharedNodes.forEach(nxe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Hs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Hs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Yn(this.snapshot.measuredBox.x)&&!Yn(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let y=0;y<this.path.length;y++)this.path[y].updateScroll();const g=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Vr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,g?g.layoutBox:void 0)}updateScroll(g="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===g&&(E=!1),E&&this.instance){const y=l(this.instance);this.scroll={animationId:this.root.animationId,phase:g,isRoot:y,offset:o(this.instance),wasRoot:this.scroll?this.scroll.isRoot:y}}}resetTransform(){if(!u)return;const g=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!AH(this.projectionDelta),y=this.getTransformTemplate(),x=y?y(this.latestValues,""):void 0,S=x!==this.prevTransformTemplateValue;g&&this.instance&&(E||Wd(this.latestValues)||S)&&(u(this.instance,x),this.shouldResetTransform=!1,this.scheduleRender())}measure(g=!0){const E=this.measurePageBox();let y=this.removeElementScroll(E);return g&&(y=this.removeTransform(y)),cxe(y),{animationId:this.root.animationId,measuredBox:E,layoutBox:y,latestValues:{},source:this.id}}measurePageBox(){var x;const{visualElement:g}=this.options;if(!g)return Vr();const E=g.measureViewportBox();if(!(((x=this.scroll)==null?void 0:x.wasRoot)||this.path.some(lxe))){const{scroll:S}=this.root;S&&(ip(E.x,S.offset.x),ip(E.y,S.offset.y))}return E}removeElementScroll(g){var y;const E=Vr();if(Ea(E,g),(y=this.scroll)!=null&&y.wasRoot)return E;for(let x=0;x<this.path.length;x++){const S=this.path[x],{scroll:C,options:R}=S;S!==this.root&&C&&R.layoutScroll&&(C.wasRoot&&Ea(E,g),ip(E.x,C.offset.x),ip(E.y,C.offset.y))}return E}applyTransform(g,E=!1){const y=Vr();Ea(y,g);for(let x=0;x<this.path.length;x++){const S=this.path[x];!E&&S.options.layoutScroll&&S.scroll&&S!==S.root&&ap(y,{x:-S.scroll.offset.x,y:-S.scroll.offset.y}),Wd(S.latestValues)&&ap(y,S.latestValues)}return Wd(this.latestValues)&&ap(y,this.latestValues),y}removeTransform(g){const E=Vr();Ea(E,g);for(let y=0;y<this.path.length;y++){const x=this.path[y];if(!x.instance||!Wd(x.latestValues))continue;XR(x.latestValues)&&x.updateSnapshot();const S=Vr(),C=x.measurePageBox();Ea(S,C),G6(E,x.latestValues,x.snapshot?x.snapshot.layoutBox:void 0,S)}return Wd(this.latestValues)&&G6(E,this.latestValues),E}setTargetDelta(g){this.targetDelta=g,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(g){this.options={...this.options,...g,crossfade:g.crossfade!==void 0?g.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==dn.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(g=!1){var R;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const y=!!this.resumingFrom||this!==E;if(!(g||y&&this.isSharedProjectionDirty||this.isProjectionDirty||(R=this.parent)!=null&&R.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:S,layoutId:C}=this.options;if(!(!this.layout||!(S||C))){if(this.resolvedRelativeTargetAt=dn.timestamp,!this.targetDelta&&!this.relativeTarget){const M=this.getClosestProjectingParent();M&&M.layout&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Vr(),this.relativeTargetOrigin=Vr(),ug(this.relativeTargetOrigin,this.layout.layoutBox,M.layout.layoutBox),Ea(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Vr(),this.targetWithTransforms=Vr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),fye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ea(this.target,this.layout.layoutBox),dH(this.target,this.targetDelta)):Ea(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const M=this.getClosestProjectingParent();M&&!!M.resumingFrom==!!this.resumingFrom&&!M.options.layoutScroll&&M.target&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Vr(),this.relativeTargetOrigin=Vr(),ug(this.relativeTargetOrigin,this.target,M.target),Ea(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||XR(this.parent.latestValues)||lH(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var G;const g=this.getLead(),E=!!this.resumingFrom||this!==g;let y=!0;if((this.isProjectionDirty||(G=this.parent)!=null&&G.isProjectionDirty)&&(y=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(y=!1),this.resolvedRelativeTargetAt===dn.timestamp&&(y=!1),y)return;const{layout:x,layoutId:S}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(x||S))return;Ea(this.layoutCorrected,this.layout.layoutBox);const C=this.treeScale.x,R=this.treeScale.y;NEe(this.layoutCorrected,this.treeScale,this.path,E),g.layout&&!g.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(g.target=g.layout.layoutBox,g.targetWithTransforms=Vr());const{target:M}=g;if(!M){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(V6(this.prevProjectionDelta.x,this.projectionDelta.x),V6(this.prevProjectionDelta.y,this.projectionDelta.y)),dg(this.projectionDelta,this.layoutCorrected,M,this.latestValues),(this.treeScale.x!==C||this.treeScale.y!==R||!Y6(this.projectionDelta.x,this.prevProjectionDelta.x)||!Y6(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",M))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(g=!0){var E;if((E=this.options.visualElement)==null||E.scheduleRender(),g){const y=this.getStack();y&&y.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=op(),this.projectionDelta=op(),this.projectionDeltaWithTransform=op()}setAnimationOrigin(g,E=!1){const y=this.snapshot,x=y?y.latestValues:{},S={...this.latestValues},C=op();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const R=Vr(),M=y?y.source:void 0,G=this.layout?this.layout.source:void 0,I=M!==G,j=this.getStack(),L=!j||j.members.length<=1,N=!!(I&&!L&&this.options.crossfade===!0&&!this.path.some(axe));this.animationProgress=0;let D;this.mixTargetDelta=V=>{const B=V/1e3;Q6(C.x,g.x,B),Q6(C.y,g.y,B),this.setTargetDelta(C),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ug(R,this.layout.layoutBox,this.relativeParent.layout.layoutBox),ixe(this.relativeTarget,this.relativeTargetOrigin,R,B),D&&Hye(this.relativeTarget,D)&&(this.isProjectionDirty=!1),D||(D=Vr()),Ea(D,this.relativeTarget)),I&&(this.animationValues=S,Fye(S,x,this.latestValues,B,N,L)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=B},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(g){var E,y,x;this.notifyListeners("animationStart"),(E=this.currentAnimation)==null||E.stop(),(x=(y=this.resumingFrom)==null?void 0:y.currentAnimation)==null||x.stop(),this.pendingAnimation&&(po(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Hs.update(()=>{Yy.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=co(0)),this.currentAnimation=jye(this.motionValue,[0,1e3],{...g,velocity:0,isSync:!0,onUpdate:S=>{this.mixTargetDelta(S),g.onUpdate&&g.onUpdate(S)},onStop:()=>{},onComplete:()=>{g.onComplete&&g.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const g=this.getStack();g&&g.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(qye),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const g=this.getLead();let{targetWithTransforms:E,target:y,layout:x,latestValues:S}=g;if(!(!E||!y||!x)){if(this!==g&&this.layout&&x&&jH(this.options.animationType,this.layout.layoutBox,x.layoutBox)){y=this.target||Vr();const C=Yn(this.layout.layoutBox.x);y.x.min=g.target.x.min,y.x.max=y.x.min+C;const R=Yn(this.layout.layoutBox.y);y.y.min=g.target.y.min,y.y.max=y.y.min+R}Ea(E,y),ap(E,S),dg(this.projectionDeltaWithTransform,this.layoutCorrected,E,S)}}registerSharedNode(g,E){this.sharedNodes.has(g)||this.sharedNodes.set(g,new zye),this.sharedNodes.get(g).add(E);const x=E.options.initialPromotionConfig;E.promote({transition:x?x.transition:void 0,preserveFollowOpacity:x&&x.shouldPreserveFollowOpacity?x.shouldPreserveFollowOpacity(E):void 0})}isLead(){const g=this.getStack();return g?g.lead===this:!0}getLead(){var E;const{layoutId:g}=this.options;return g?((E=this.getStack())==null?void 0:E.lead)||this:this}getPrevLead(){var E;const{layoutId:g}=this.options;return g?(E=this.getStack())==null?void 0:E.prevLead:void 0}getStack(){const{layoutId:g}=this.options;if(g)return this.root.sharedNodes.get(g)}promote({needsReset:g,transition:E,preserveFollowOpacity:y}={}){const x=this.getStack();x&&x.promote(this,y),g&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const g=this.getStack();return g?g.relegate(this):!1}resetSkewAndRotation(){const{visualElement:g}=this.options;if(!g)return;let E=!1;const{latestValues:y}=g;if((y.z||y.rotate||y.rotateX||y.rotateY||y.rotateZ||y.skewX||y.skewY)&&(E=!0),!E)return;const x={};y.z&&xN("z",g,x,this.animationValues);for(let S=0;S<yN.length;S++)xN(`rotate${yN[S]}`,g,x,this.animationValues),xN(`skew${yN[S]}`,g,x,this.animationValues);g.render();for(const S in x)g.setStaticValue(S,x[S]),this.animationValues&&(this.animationValues[S]=x[S]);g.scheduleRender()}applyProjectionStyles(g,E){if(!this.instance||this.isSVG)return;if(!this.isVisible){g.visibility="hidden";return}const y=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,g.visibility="",g.opacity="",g.pointerEvents=qy(E==null?void 0:E.pointerEvents)||"",g.transform=y?y(this.latestValues,""):"none";return}const x=this.getLead();if(!this.projectionDelta||!this.layout||!x.target){this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=qy(E==null?void 0:E.pointerEvents)||""),this.hasProjected&&!Wd(this.latestValues)&&(g.transform=y?y({},""):"none",this.hasProjected=!1);return}g.visibility="";const S=x.animationValues||x.latestValues;this.applyTransformsToTarget();let C=Kye(this.projectionDeltaWithTransform,this.treeScale,S);y&&(C=y(S,C)),g.transform=C;const{x:R,y:M}=this.projectionDelta;g.transformOrigin=`${R.origin*100}% ${M.origin*100}% 0`,x.animationValues?g.opacity=x===this?S.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:S.opacityExit:g.opacity=x===this?S.opacity!==void 0?S.opacity:"":S.opacityExit!==void 0?S.opacityExit:0;for(const G in Fg){if(S[G]===void 0)continue;const{correct:I,applyTo:j,isCSSVariable:L}=Fg[G],N=C==="none"?S[G]:I(S[G],x);if(j){const D=j.length;for(let V=0;V<D;V++)g[j[V]]=N}else L?this.options.visualElement.renderState.vars[G]=N:g[G]=N}this.options.layoutId&&(g.pointerEvents=x===this?qy(E==null?void 0:E.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(g=>{var E;return(E=g.currentAnimation)==null?void 0:E.stop()}),this.root.nodes.forEach($6),this.root.sharedNodes.clear()}}}function $ye(r){r.updateLayout()}function Xye(r){var o;const n=((o=r.resumeFrom)==null?void 0:o.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&n&&r.hasListeners("didUpdate")){const{layoutBox:l,measuredBox:u}=r.layout,{animationType:m}=r.options,g=n.source!==r.layout.source;m==="size"?ya(C=>{const R=g?n.measuredBox[C]:n.layoutBox[C],M=Yn(R);R.min=l[C].min,R.max=R.min+M}):jH(m,n.layoutBox,l)&&ya(C=>{const R=g?n.measuredBox[C]:n.layoutBox[C],M=Yn(l[C]);R.max=R.min+M,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[C].max=r.relativeTarget[C].min+M)});const E=op();dg(E,l,n.layoutBox);const y=op();g?dg(y,r.applyTransform(u,!0),n.measuredBox):dg(y,l,n.layoutBox);const x=!AH(E);let S=!1;if(!r.resumeFrom){const C=r.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:R,layout:M}=C;if(R&&M){const G=Vr();ug(G,n.layoutBox,R.layoutBox);const I=Vr();ug(I,l,M.layoutBox),IH(G,I)||(S=!0),C.options.layoutRoot&&(r.relativeTarget=I,r.relativeTargetOrigin=G,r.relativeParent=C)}}}r.notifyListeners("didUpdate",{layout:l,snapshot:n,delta:y,layoutDelta:E,hasLayoutChanged:x,hasRelativeLayoutChanged:S})}else if(r.isLead()){const{onExitComplete:l}=r.options;l&&l()}r.options.transition=void 0}function Jye(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function Qye(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function Zye(r){r.clearSnapshot()}function $6(r){r.clearMeasurements()}function X6(r){r.isLayoutDirty=!1}function exe(r){const{visualElement:n}=r.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),r.resetTransform()}function J6(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function txe(r){r.resolveTargetDelta()}function sxe(r){r.calcProjection()}function rxe(r){r.resetSkewAndRotation()}function nxe(r){r.removeLeadSnapshot()}function Q6(r,n,o){r.translate=br(n.translate,0,o),r.scale=br(n.scale,1,o),r.origin=n.origin,r.originPoint=n.originPoint}function Z6(r,n,o,l){r.min=br(n.min,o.min,l),r.max=br(n.max,o.max,l)}function ixe(r,n,o,l){Z6(r.x,n.x,o.x,l),Z6(r.y,n.y,o.y,l)}function axe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const oxe={duration:.45,ease:[.4,0,.1,1]},e7=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),t7=e7("applewebkit/")&&!e7("chrome/")?Math.round:Ci;function s7(r){r.min=t7(r.min),r.max=t7(r.max)}function cxe(r){s7(r.x),s7(r.y)}function jH(r,n,o){return r==="position"||r==="preserve-aspect"&&!mye(q6(n),q6(o),.2)}function lxe(r){var n;return r!==r.root&&((n=r.scroll)==null?void 0:n.wasRoot)}const dxe=OH({attachResizeListener:(r,n)=>Ug(r,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),bN={current:void 0},PH=OH({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!bN.current){const r=new dxe({});r.mount(window),r.setOptions({layoutScroll:!0}),bN.current=r}return bN.current},resetTransform:(r,n)=>{r.style.transform=n!==void 0?n:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),uxe={pan:{Feature:Aye},drag:{Feature:Rye,ProjectionNode:PH,MeasureLayout:TH}};function r7(r,n,o){const{props:l}=r;r.animationState&&l.whileHover&&r.animationState.setActive("whileHover",o==="Start");const u="onHover"+o,m=l[u];m&&Hs.postRender(()=>m(n,e_(n)))}class hxe extends ql{mount(){const{current:n}=this.node;n&&(this.unmount=wve(n,(o,l)=>(r7(this.node,l,"Start"),u=>r7(this.node,u,"End"))))}unmount(){}}class pxe extends ql{constructor(){super(...arguments),this.isActive=!1}onFocus(){let n=!1;try{n=this.node.current.matches(":focus-visible")}catch{n=!0}!n||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Jg(Ug(this.node.current,"focus",()=>this.onFocus()),Ug(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function n7(r,n,o){const{props:l}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&l.whileTap&&r.animationState.setActive("whileTap",o==="Start");const u="onTap"+(o==="End"?"":o),m=l[u];m&&Hs.postRender(()=>m(n,e_(n)))}class mxe extends ql{mount(){const{current:n}=this.node;n&&(this.unmount=Nve(n,(o,l)=>(n7(this.node,l,"Start"),(u,{success:m})=>n7(this.node,u,m?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const rA=new WeakMap,wN=new WeakMap,fxe=r=>{const n=rA.get(r.target);n&&n(r)},gxe=r=>{r.forEach(fxe)};function _xe({root:r,...n}){const o=r||document;wN.has(o)||wN.set(o,{});const l=wN.get(o),u=JSON.stringify(n);return l[u]||(l[u]=new IntersectionObserver(gxe,{root:r,...n})),l[u]}function vxe(r,n,o){const l=_xe(n);return rA.set(r,o),l.observe(r),()=>{rA.delete(r),l.unobserve(r)}}const Exe={some:0,all:1};class yxe extends ql{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:n={}}=this.node.getProps(),{root:o,margin:l,amount:u="some",once:m}=n,g={root:o?o.current:void 0,rootMargin:l,threshold:typeof u=="number"?u:Exe[u]},E=y=>{const{isIntersecting:x}=y;if(this.isInView===x||(this.isInView=x,m&&!x&&this.hasEnteredView))return;x&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",x);const{onViewportEnter:S,onViewportLeave:C}=this.node.getProps(),R=x?S:C;R&&R(y)};return vxe(this.node.current,g,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:n,prevProps:o}=this.node;["amount","margin","root"].some(xxe(n,o))&&this.startObserver()}unmount(){}}function xxe({viewport:r={}},{viewport:n={}}={}){return o=>r[o]!==n[o]}const bxe={inView:{Feature:yxe},tap:{Feature:mxe},focus:{Feature:pxe},hover:{Feature:hxe}},wxe={layout:{ProjectionNode:PH,MeasureLayout:TH}},Sxe={...cye,...bxe,...uxe,...wxe},vc=SEe(Sxe,MEe),Cxe=50,i7=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Txe=()=>({time:0,x:i7(),y:i7()}),Nxe={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function a7(r,n,o,l){const u=o[n],{length:m,position:g}=Nxe[n],E=u.current,y=o.time;u.current=r[`scroll${g}`],u.scrollLength=r[`scroll${m}`]-r[`client${m}`],u.offset.length=0,u.offset[0]=0,u.offset[1]=u.scrollLength,u.progress=kp(0,u.scrollLength,u.current);const x=l-y;u.velocity=x>Cxe?0:EI(u.current-E,x)}function Rxe(r,n,o){a7(r,"x",n,o),a7(r,"y",n,o),n.time=o}function Axe(r,n){const o={x:0,y:0};let l=r;for(;l&&l!==n;)if(kI(l))o.x+=l.offsetLeft,o.y+=l.offsetTop,l=l.offsetParent;else if(l.tagName==="svg"){const u=l.getBoundingClientRect();l=l.parentElement;const m=l.getBoundingClientRect();o.x+=u.left-m.left,o.y+=u.top-m.top}else if(l instanceof SVGGraphicsElement){const{x:u,y:m}=l.getBBox();o.x+=u,o.y+=m;let g=null,E=l.parentNode;for(;!g;)E.tagName==="svg"&&(g=E),E=l.parentNode;l=g}else break;return o}const nA={start:0,center:.5,end:1};function o7(r,n,o=0){let l=0;if(r in nA&&(r=nA[r]),typeof r=="string"){const u=parseFloat(r);r.endsWith("px")?l=u:r.endsWith("%")?r=u/100:r.endsWith("vw")?l=u/100*document.documentElement.clientWidth:r.endsWith("vh")?l=u/100*document.documentElement.clientHeight:r=u}return typeof r=="number"&&(l=n*r),o+l}const Ixe=[0,0];function Dxe(r,n,o,l){let u=Array.isArray(r)?r:Ixe,m=0,g=0;return typeof r=="number"?u=[r,r]:typeof r=="string"&&(r=r.trim(),r.includes(" ")?u=r.split(" "):u=[r,nA[r]?r:"0"]),m=o7(u[0],o,l),g=o7(u[1],n),m-g}const Oxe={All:[[0,0],[1,1]]},jxe={x:0,y:0};function Pxe(r){return"getBBox"in r&&r.tagName!=="svg"?r.getBBox():{width:r.clientWidth,height:r.clientHeight}}function kxe(r,n,o){const{offset:l=Oxe.All}=o,{target:u=r,axis:m="y"}=o,g=m==="y"?"height":"width",E=u!==r?Axe(u,r):jxe,y=u===r?{width:r.scrollWidth,height:r.scrollHeight}:Pxe(u),x={width:r.clientWidth,height:r.clientHeight};n[m].offset.length=0;let S=!n[m].interpolate;const C=l.length;for(let R=0;R<C;R++){const M=Dxe(l[R],x[g],y[g],E[m]);!S&&M!==n[m].interpolatorOffsets[R]&&(S=!0),n[m].offset[R]=M}S&&(n[m].interpolate=RI(n[m].offset,TG(l),{clamp:!1}),n[m].interpolatorOffsets=[...n[m].offset]),n[m].progress=qo(0,1,n[m].interpolate(n[m].current))}function Lxe(r,n=r,o){if(o.x.targetOffset=0,o.y.targetOffset=0,n!==r){let l=n;for(;l&&l!==r;)o.x.targetOffset+=l.offsetLeft,o.y.targetOffset+=l.offsetTop,l=l.offsetParent}o.x.targetLength=n===r?n.scrollWidth:n.clientWidth,o.y.targetLength=n===r?n.scrollHeight:n.clientHeight,o.x.containerLength=r.clientWidth,o.y.containerLength=r.clientHeight}function Mxe(r,n,o,l={}){return{measure:u=>{Lxe(r,l.target,o),Rxe(r,o,u),(l.offset||l.target)&&kxe(r,o,l)},notify:()=>n(o)}}const Vf=new WeakMap,c7=new WeakMap,SN=new WeakMap,l7=r=>r===document.scrollingElement?window:r;function kH(r,{container:n=document.scrollingElement,...o}={}){if(!n)return Ci;let l=SN.get(n);l||(l=new Set,SN.set(n,l));const u=Txe(),m=Mxe(n,r,u,o);if(l.add(m),!Vf.has(n)){const E=()=>{for(const C of l)C.measure(dn.timestamp);Hs.preUpdate(y)},y=()=>{for(const C of l)C.notify()},x=()=>Hs.read(E);Vf.set(n,x);const S=l7(n);window.addEventListener("resize",x,{passive:!0}),n!==document.documentElement&&c7.set(n,Lve(n,x)),S.addEventListener("scroll",x,{passive:!0}),x()}const g=Vf.get(n);return Hs.read(g,!1,!0),()=>{var x;po(g);const E=SN.get(n);if(!E||(E.delete(m),E.size))return;const y=Vf.get(n);Vf.delete(n),y&&(l7(n).removeEventListener("scroll",y),(x=c7.get(n))==null||x(),window.removeEventListener("resize",y))}}const d7=new Map;function Fxe(r){const n={value:0},o=kH(l=>{n.value=l[r.axis].progress*100},r);return{currentTime:n,cancel:o}}function LH({source:r,container:n,...o}){const{axis:l}=o;r&&(n=r);const u=d7.get(n)??new Map;d7.set(n,u);const m=o.target??"self",g=u.get(m)??{},E=l+(o.offset??[]).join(",");return g[E]||(g[E]=!o.target&&IG()?new ScrollTimeline({source:n,axis:l}):Fxe({container:n,...o})),g[E]}function Uxe(r,n){const o=LH(n);return r.attachTimeline({timeline:n.target?void 0:o,observe:l=>(l.pause(),qG(u=>{l.time=l.iterationDuration*u},o))})}function Vxe(r){return r.length===2}function Bxe(r,n){return Vxe(r)?kH(o=>{r(o[n.axis].progress,o)},n):qG(r,LH(n))}function Wxe(r,{axis:n="y",container:o=document.scrollingElement,...l}={}){if(!o)return Ci;const u={axis:n,container:o,...l};return typeof r=="function"?Bxe(r,u):Uxe(r,u)}const Gxe=()=>({scrollX:co(0),scrollY:co(0),scrollXProgress:co(0),scrollYProgress:co(0)}),Ny=r=>r?!r.current:!1;function Hxe({container:r,target:n,...o}={}){const l=Kp(Gxe),u=O.useRef(null),m=O.useRef(!1),g=O.useCallback(()=>(u.current=Wxe((E,{x:y,y:x})=>{l.scrollX.set(y.current),l.scrollXProgress.set(y.progress),l.scrollY.set(x.current),l.scrollYProgress.set(x.progress)},{...o,container:(r==null?void 0:r.current)||void 0,target:(n==null?void 0:n.current)||void 0}),()=>{var E;(E=u.current)==null||E.call(u)}),[r,n,JSON.stringify(o.offset)]);return cb(()=>{if(m.current=!1,Ny(r)||Ny(n)){m.current=!0;return}else return g()},[g]),O.useEffect(()=>{if(m.current)return Pg(!Ny(r)),Pg(!Ny(n)),g()},[g]),l}function zxe(r){const n=Kp(()=>co(r)),{isStatic:o}=O.useContext(db);if(o){const[,l]=O.useState(r);O.useEffect(()=>n.on("change",l),[])}return n}function MH(r,n){const o=zxe(n()),l=()=>o.set(n());return l(),cb(()=>{const u=()=>Hs.preRender(l,!1,!0),m=r.map(g=>g.on("change",u));return()=>{m.forEach(g=>g()),po(l)}}),o}function Kxe(r){cg.current=[],r();const n=MH(cg.current,r);return cg.current=void 0,n}function CN(r,n,o,l){if(typeof r=="function")return Kxe(r);const u=typeof n=="function"?n:Fve(n,o,l);return Array.isArray(r)?u7(r,u):u7([r],([m])=>u(m))}function u7(r,n){const o=Kp(()=>[]);return MH(r,()=>{o.length=0;const l=r.length;for(let u=0;u<l;u++)o[u]=r[u].get();return n(o)})}const Mo={degreesToRadians:r=>r*(Math.PI/180),radiansToDegrees:r=>r*(180/Math.PI),sphericalToCartesian:(r,n,o)=>({x:r*Math.sin(o)*Math.cos(n),y:r*Math.cos(o),z:r*Math.sin(o)*Math.sin(n)}),calculateDistance:(r,n={x:0,y:0,z:0})=>{const o=r.x-n.x,l=r.y-n.y,u=r.z-n.z;return Math.sqrt(o*o+l*l+u*u)},normalizeAngle:r=>{for(;r>180;)r-=360;for(;r<-180;)r+=360;return r}},qxe=({images:r=[],containerSize:n=400,sphereRadius:o=200,dragSensitivity:l=.5,momentumDecay:u=.95,maxRotationSpeed:m=5,baseImageScale:g=.12,hoverScale:E=1.2,perspective:y=1e3,autoRotate:x=!1,autoRotateSpeed:S=.3,className:C=""})=>{const[R,M]=O.useState(!1),[G,I]=O.useState({x:15,y:15,z:0}),[j,L]=O.useState({x:0,y:0}),[N,D]=O.useState(!1),[V,B]=O.useState(null),[z,H]=O.useState([]),[J,ee]=O.useState(null),ne=O.useRef(null),he=O.useRef({x:0,y:0}),ve=O.useRef(null),ye=o||n*.5,me=n*g,ue=O.useCallback(()=>{const Ae=[],Qe=r.length,pe=(1+Math.sqrt(5))/2,Re=2*Math.PI/pe;for(let Ge=0;Ge<Qe;Ge++){const xt=Ge/Qe,jt=Math.acos(1-2*xt),Pt=Re*Ge;let rt=jt*180/Math.PI,Dt=Pt*180/Math.PI%360;const kt=Math.pow(Math.abs(rt-90)/90,.6)*35;rt<90?rt=Math.max(5,rt-kt):rt=Math.min(175,rt+kt),rt=15+rt/180*150;const Os=(Math.random()-.5)*20;Dt=(Dt+Os)%360,rt=Math.max(0,Math.min(180,rt+(Math.random()-.5)*10)),Ae.push({theta:Dt,phi:rt,radius:ye})}return Ae},[r.length,ye]),Fe=O.useCallback(()=>{const Qe=[...z.map((pe,Re)=>{const Ge=Mo.degreesToRadians(pe.theta),xt=Mo.degreesToRadians(pe.phi),jt=Mo.degreesToRadians(G.x),Pt=Mo.degreesToRadians(G.y);let rt=pe.radius*Math.sin(xt)*Math.cos(Ge),Dt=pe.radius*Math.cos(xt),kt=pe.radius*Math.sin(xt)*Math.sin(Ge);const Os=rt*Math.cos(Pt)+kt*Math.sin(Pt),bn=-rt*Math.sin(Pt)+kt*Math.cos(Pt);rt=Os,kt=bn;const ei=Dt*Math.cos(jt)-kt*Math.sin(jt),Ti=Dt*Math.sin(jt)+kt*Math.cos(jt);Dt=ei,kt=Ti;const Wr={x:rt,y:Dt,z:kt},ir=-10,Ni=-30,ct=Wr.z>Ni;let $e=1;Wr.z<=ir&&($e=Math.max(0,(Wr.z-Ni)/(ir-Ni)));const Tt=pe.phi<30||pe.phi>150,Ht=Math.sqrt(Wr.x*Wr.x+Wr.y*Wr.y),Jt=Math.min(Ht/ye,1),Jo=Math.max(.3,1-Jt*(Tt?.4:.7)),ti=(Wr.z+ye)/(2*ye),_u=Jo*Math.max(.5,.8+ti*.3);return{...Wr,scale:_u,zIndex:Math.round(1e3+Wr.z),isVisible:ct,fadeOpacity:$e,originalIndex:Re}})];for(let pe=0;pe<Qe.length;pe++){const Re=Qe[pe];if(!Re.isVisible)continue;let Ge=Re.scale;const xt=me*Ge;for(let jt=0;jt<Qe.length;jt++){if(pe===jt)continue;const Pt=Qe[jt];if(!Pt.isVisible)continue;const rt=me*Pt.scale,Dt=Re.x-Pt.x,kt=Re.y-Pt.y,Os=Math.sqrt(Dt*Dt+kt*kt),bn=(xt+rt)/2+25;if(Os<bn&&Os>0){const ei=bn-Os,Ti=Math.max(.4,1-ei/bn*.6);Ge=Math.min(Ge,Ge*Ti)}}Qe[pe]={...Re,scale:Math.max(.25,Ge)}}return Qe},[z,G,ye,me]),be=O.useCallback(Ae=>Math.max(-m,Math.min(m,Ae)),[m]),ae=O.useCallback(()=>{N||(L(Ae=>{const Qe={x:Ae.x*u,y:Ae.y*u};return!x&&Math.abs(Qe.x)<.01&&Math.abs(Qe.y)<.01?{x:0,y:0}:Qe}),I(Ae=>{let Qe=Ae.y;return x&&(Qe+=S),Qe+=be(j.y),{x:Mo.normalizeAngle(Ae.x+be(j.x)),y:Mo.normalizeAngle(Qe),z:Ae.z}}))},[N,u,j,be,x,S]),ge=O.useCallback(Ae=>{Ae.preventDefault(),D(!0),L({x:0,y:0}),he.current={x:Ae.clientX,y:Ae.clientY}},[]),Se=O.useCallback(Ae=>{if(!N)return;const Qe=Ae.clientX-he.current.x,Re={x:-(Ae.clientY-he.current.y)*l,y:Qe*l};I(Ge=>({x:Mo.normalizeAngle(Ge.x+be(Re.x)),y:Mo.normalizeAngle(Ge.y+be(Re.y)),z:Ge.z})),L({x:be(Re.x),y:be(Re.y)}),he.current={x:Ae.clientX,y:Ae.clientY}},[N,l,be]),it=O.useCallback(()=>{D(!1)},[]),Ue=O.useCallback(Ae=>{Ae.preventDefault();const Qe=Ae.touches[0];D(!0),L({x:0,y:0}),he.current={x:Qe.clientX,y:Qe.clientY}},[]),ht=O.useCallback(Ae=>{if(!N)return;Ae.preventDefault();const Qe=Ae.touches[0],pe=Qe.clientX-he.current.x,Ge={x:-(Qe.clientY-he.current.y)*l,y:pe*l};I(xt=>({x:Mo.normalizeAngle(xt.x+be(Ge.x)),y:Mo.normalizeAngle(xt.y+be(Ge.y)),z:xt.z})),L({x:be(Ge.x),y:be(Ge.y)}),he.current={x:Qe.clientX,y:Qe.clientY}},[N,l,be]),qe=O.useCallback(()=>{D(!1)},[]);O.useEffect(()=>{M(!0)},[]),O.useEffect(()=>{H(ue())},[ue]),O.useEffect(()=>{const Ae=()=>{ae(),ve.current=requestAnimationFrame(Ae)};return R&&(ve.current=requestAnimationFrame(Ae)),()=>{ve.current&&cancelAnimationFrame(ve.current)}},[R,ae]),O.useEffect(()=>{if(!(!R||!ne.current))return document.addEventListener("mousemove",Se),document.addEventListener("mouseup",it),document.addEventListener("touchmove",ht,{passive:!1}),document.addEventListener("touchend",qe),()=>{document.removeEventListener("mousemove",Se),document.removeEventListener("mouseup",it),document.removeEventListener("touchmove",ht),document.removeEventListener("touchend",qe)}},[R,Se,it,ht,qe]);const Me=Fe(),st=O.useCallback((Ae,Qe)=>{const pe=Me[Qe];if(!pe||!pe.isVisible)return null;me*pe.scale;const Ge=J===Qe?Math.min(E,E/pe.scale):1;return i.jsx("div",{className:"absolute cursor-pointer select-none transition-transform duration-200 ease-out",style:{width:`${me/n*100}%`,height:`${me/n*100}%`,left:`${50+pe.x/n*100}%`,top:`${50+pe.y/n*100}%`,opacity:pe.fadeOpacity,transform:`translate(-50%, -50%) scale(${Ge})`,zIndex:pe.zIndex},onMouseEnter:()=>ee(Qe),onMouseLeave:()=>ee(null),onClick:()=>B(Ae),children:i.jsx("div",{className:"relative w-full h-full rounded-full overflow-hidden shadow-lg border-2 border-white/20",children:i.jsx("img",{src:Ae.src,alt:Ae.alt,className:"w-full h-full object-cover",draggable:!1,loading:Qe<3?"eager":"lazy"})})},Ae.id)},[Me,me,n,J,E]),De=()=>V?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/30",onClick:()=>B(null),style:{animation:"fadeIn 0.3s ease-out"},children:i.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full overflow-hidden",onClick:Ae=>Ae.stopPropagation(),style:{animation:"scaleIn 0.3s ease-out"},children:[i.jsxs("div",{className:"relative aspect-square",children:[i.jsx("img",{src:V.src,alt:V.alt,className:"w-full h-full object-cover"}),i.jsx("button",{onClick:()=>B(null),className:"absolute top-2 right-2 w-8 h-8 bg-black bg-opacity-50 rounded-full text-white flex items-center justify-center hover:bg-opacity-70 transition-all cursor-pointer",children:i.jsx("span",{className:"text-sm leading-none",children:""})})]}),(V.title||V.description)&&i.jsxs("div",{className:"p-6",children:[V.title&&i.jsx("h3",{className:"text-xl font-bold mb-2",children:V.title}),V.description&&i.jsx("p",{className:"text-gray-600",children:V.description})]})]})}):null;return R?r.length?i.jsxs(i.Fragment,{children:[i.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes scaleIn {
          from { transform: scale(0.8); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
      `}),i.jsx("div",{ref:ne,className:`relative select-none cursor-grab active:cursor-grabbing w-full h-full max-w-[250px] max-h-[250px] md:max-w-[420px] md:max-h-[420px] ${C}`,style:{perspective:`${y}px`},onMouseDown:ge,onTouchStart:Ue,children:i.jsx("div",{className:"relative w-full h-full",style:{zIndex:10},children:r.map((Ae,Qe)=>st(Ae,Qe))})}),De()]}):i.jsx("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center",style:{width:n,height:n},children:i.jsxs("div",{className:"text-gray-400 text-center",children:[i.jsx("p",{children:"No images provided"}),i.jsx("p",{className:"text-sm",children:"Add images to the images prop"})]})}):i.jsx("div",{className:"bg-gray-100 rounded-lg animate-pulse flex items-center justify-center",style:{width:n,height:n},children:i.jsx("div",{className:"text-gray-400",children:"Loading..."})})},Yxe="/assets/Ready-to-Share%20Social%20Media%20Posts%20to%20Amplify%20Your%20Brand%20on%20Pinterest-DaRwwLah.jpeg";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $xe=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),FH=(...r)=>r.filter((n,o,l)=>!!n&&n.trim()!==""&&l.indexOf(n)===o).join(" ").trim();/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xxe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jxe=O.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:u="",children:m,iconNode:g,...E},y)=>O.createElement("svg",{ref:y,...Xxe,width:n,height:n,stroke:r,strokeWidth:l?Number(o)*24/Number(n):o,className:FH("lucide",u),...E},[...g.map(([x,S])=>O.createElement(x,S)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=(r,n)=>{const o=O.forwardRef(({className:l,...u},m)=>O.createElement(Jxe,{ref:m,iconNode:n,className:FH(`lucide-${$xe(r)}`,l),...u}));return o.displayName=`${r}`,o};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qxe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],UH=xn("Bell",Qxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zxe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],VH=xn("Check",Zxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ebe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],tbe=xn("ChevronLeft",ebe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sbe=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],rbe=xn("ChevronRight",sbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nbe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],BH=xn("Copy",nbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ibe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],WH=xn("EllipsisVertical",ibe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const abe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],GH=xn("Ellipsis",abe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const obe=[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]],HH=xn("Flag",obe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cbe=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],lbe=xn("MicOff",cbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dbe=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],ube=xn("Mic",dbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hbe=[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]],pbe=xn("PhoneOff",hbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mbe=[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]],zH=xn("Reply",mbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fbe=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],KH=xn("Settings",fbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gbe=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],qH=xn("Trash2",gbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _be=[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 19h-6",key:"vcuq98"}]],YH=xn("UserRoundMinus",_be);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vbe=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ebe=xn("VideoOff",vbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ybe=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],xbe=xn("Video",ybe),bbe=({testimonials:r,autoplay:n=!1,className:o=""})=>{const[l,u]=O.useState(0),m=()=>{u(S=>(S+1)%r.length)},g=()=>{u(S=>(S-1+r.length)%r.length)};O.useEffect(()=>{if(!n)return;const S=setInterval(m,5e3);return()=>clearInterval(S)},[n]);const E=S=>S===l,y=()=>Math.floor(Math.random()*21)-10,x=r[l];return i.jsx("div",{className:`max-w-sm md:max-w-4xl mx-auto px-4 md:px-8 lg:px-12 py-12 md:py-20 ${o}`,children:i.jsxs("div",{className:"relative grid grid-cols-1 gap-12 md:grid-cols-2 md:gap-20",children:[i.jsx("div",{children:i.jsx("div",{className:"relative h-72 w-full md:h-80",children:i.jsx(h6,{children:r.map((S,C)=>i.jsx(vc.div,{initial:{opacity:0,scale:.9,z:-100,rotate:y()},animate:{opacity:E(C)?1:.7,scale:E(C)?1:.95,z:E(C)?0:-100,rotate:E(C)?0:y(),zIndex:E(C)?999:r.length+2-C,y:E(C)?[0,-40,0]:0},exit:{opacity:0,scale:.9,z:100,rotate:y()},transition:{duration:.4,ease:"easeInOut"},className:"absolute inset-0 origin-bottom overflow-hidden rounded-3xl border border-[#E9ECEF] bg-white shadow-[var(--shadow-lg)]",children:i.jsx("img",{src:S.src,alt:S.name,draggable:!1,className:"h-full w-full object-cover object-center"})},S.src))})})}),i.jsxs("div",{className:"flex flex-col justify-between py-2",children:[i.jsx(h6,{mode:"wait",children:i.jsxs(vc.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:-20,opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[i.jsx("h3",{className:"text-2xl font-bold text-[#212529]",children:x.name}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:x.designation}),i.jsx("p",{className:"mt-6 text-base text-[#343A40] md:text-lg",children:x.quote})]},l)}),i.jsxs("div",{className:"mt-8 flex gap-4 md:mt-12",children:[i.jsx("button",{type:"button",onClick:g,className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#F1F3F5] text-[#212529] shadow-sm transition-transform duration-300 hover:-translate-x-0.5",children:i.jsx(tbe,{className:"h-4 w-4"})}),i.jsx("button",{type:"button",onClick:m,className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#F1F3F5] text-[#212529] shadow-sm transition-transform duration-300 hover:translate-x-0.5",children:i.jsx(rbe,{className:"h-4 w-4"})})]})]})]})})},Dx=[{name:"Priya Sharma",category:" Gamer",followers:"52K followers",priceRange:"120-360",avatar:"PS",highlight:"Speedruns & strategy coaching"},{name:"Rohan Gupta",category:" Chef",followers:"68K followers",priceRange:"90-280",avatar:"RG",highlight:"Teaches restaurant-style recipes"},{name:"Amit Singh",category:" Artist",followers:"74K followers",priceRange:"150-400",avatar:"AS",highlight:"Live sketching + portfolio reviews"},{name:"Neha Kapoor",category:" Life Coach",followers:"38K followers",priceRange:"200-420",avatar:"NK",highlight:"Career clarity & confidence boosts"},{name:"Arjun Mehta",category:" Musician",followers:"81K followers",priceRange:"110-300",avatar:"AM",highlight:"Song breakdowns + songwriting tips"},{name:"Sana Rao",category:" Fitness",followers:"46K followers",priceRange:"95-260",avatar:"SR",highlight:"At-home workouts & accountability"}],h7=["https://api.dicebear.com/7.x/personas/svg?seed=Priya%20Sharma&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Rohan%20Gupta&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Amit%20Singh&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Neha%20Kapoor&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Arjun%20Mehta&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Sana%20Rao&backgroundColor=f4e6ff"],wbe=Array.from({length:32}).map((r,n)=>{const o=Dx[n%Dx.length],l=h7[n%h7.length];return{id:`featured-${n}`,src:l,alt:o.name,title:o.name,description:`${o.category}  ${o.highlight}`}}),Sbe=[{icon:"",title:"Pick Your Creator",description:"Find someone you want to meet. Could be a YouTuber, chef, gamer, or anyone awesome!",step:"1"},{icon:"",title:"Bid (It's Like an Auction)",description:"Place a bid to win a video call. The highest bid wins! Don't worry - if you lose, you get most of your money back!",step:"2"},{icon:"",title:"Meet Them on Video Call",description:"If you win, you get 5-10 minutes to chat one-on-one. How cool is that?!",step:"3"}],Cbe=[{value:"1,247",label:"Happy Fans Joined"},{value:"200",label:"Video Meets Completed"},{value:"95%",label:"Success Rate (Fans Win)"}],Tbe=[{value:"89",label:"Creators Active Now"},{value:"4.5L",label:"Total Money Creators Earned"},{value:"10",label:"Minutes Average Meeting Time"},{value:"2-10",label:"Minutes Call Length Options"}],Nbe=[{name:"Priya Sharma  Content Creator  52K followers",quote:"I've done brand deals, sponsorships, everything. But FanMeet is different. I actually get to TALK to my supporters. I earned 45,000 last month and it helps fund new content!",duration:"60 sec clip"},{name:"Rohan Verma  Gaming Streamer  48K followers",quote:"My fans are the reason I do this. FanMeet lets me give back. These 10-minute calls remind me why I started. Plus, the extra income upgrades my setup. Win-win!",duration:"75 sec clip"}],p7=[{id:"photo-1",quote:"Dreams come true! ",context:"Got cooking tips from Chef Amit!"},{id:"photo-2",quote:"Best birthday surprise ever ",context:"He sang my favourite song live!"},{id:"photo-3",quote:"She remembered my username!! ",context:"Finally spoke to my art icon"},{id:"photo-4",quote:"Career clarity in 10 minutes",context:"Life coach gave me a plan"},{id:"photo-5",quote:"We geeked out over anime ",context:"Felt like chatting with a friend"},{id:"photo-6",quote:"He reviewed my vlog setup ",context:"Got technical tips + motivation"}],m7=["https://api.dicebear.com/7.x/initials/svg?seed=Priya%20%7C%20Mumbai&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Rahul%20%7C%20Delhi&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Sneha%20%7C%20Bangalore&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Pooja%20%7C%20Pune&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Harsh%20%7C%20Ahmedabad&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Neeraj%20%7C%20India&backgroundColor=050014&textColor=f4e6ff"],f7=[{quote:"I've been following Chef Amit for 2 years on YouTube and never thought I'd get to talk to him personally. FanMeet made it possible! He gave me tips on starting my own food blog and even shared his secret recipe. Best 350 I ever spent. Thank you FanMeet! ",name:"Neha Kapoor, 26  Food Blogger  Mumbai",met:"Met: Chef Amit Gupta"},{quote:"As an introvert, I was scared to bid. But I really wanted career advice from Aditi. I won at 280. The call was so comfortable! She answered all my questions and even followed up with resources via email. Worth every rupee.",name:"Anonymous Fan, 23  Software Engineer",met:"Met: Aditi Sharma (Career Coach)"},{quote:"Booked a FanMeet for my little brother with his favourite tech creator. They both nerded out about gadgets for 10 minutes. He's still smiling a week later. 300 very well spent!",name:"Pooja Malhotra, 27  Pune",met:"Met: Tech with Raj"},{quote:"I used FanMeet to get feedback on my indie game from a gaming creator I admire. He gave me 3 actionable tips and shared my demo with his Discord server. Instant confidence boost!",name:"Harsh Patel, 21  Game Developer  Ahmedabad",met:"Met: Rohan Live"}],Rbe=[{icon:"",title:"Secure Payments",bullets:["All payments encrypted via Razorpay","Your card details never touch our servers","Same security as Amazon & Flipkart"],badge:"Razorpay Partner"},{icon:"",title:"Safe Refunds",bullets:["Get 90% back if you do not win","Instant & automatic  no forms to fill","1.2 lakh refunded with 98.5% success rate"],badge:"90% Refund Guarantee"},{icon:"",title:"Verified Creators",bullets:["Every creator manually approved by our team","Identity + social media checks","No fake accounts allowed"],badge:"Human Verified"},{icon:"",title:"24/7 Support",bullets:["Real humans reply within 2.3 hours","Email, chat, or call anytime","We stay with you till the call ends"],badge:"Always On"}],Abe=[{title:"Paid Events (Bidding)",description:"Highest bid wins a 5-10 minute one-on-one call.",highlights:["Starting bids at 50 or 100","If you lose, 90% is refunded automatically","Average winning bid 250-400"],story:"I bid 250 for a 10-minute call with my favourite YouTuber. I won! The other 22 bidders got 225 back. Losing would cost only 25  cheaper than a coffee!  Rahul, College Student, Delhi",cta:"Browse Paid Events"},{title:"Free Events (Lucky Draw)",description:"Zero cost entries for surprise video calls.",highlights:["0 entry  completely free","Random winner chosen, no risk at all","Calls last 5-10 minutes just like paid events"],story:"I joined a free draw for Chef Amit and actually got picked! No money spent, just pure luck.  Priya, Food Blogger, Mumbai",cta:"Join Free Draws"}],Ibe=[{name:"Arjun Singh",role:"Founder",bio:"I once drove 8 hours to meet my favourite musician. Worth it. Now I help others meet their heroes from the couch!",funFact:"Biggest fan of Samay Raina"},{name:"Priya Mehta",role:"Co-Founder",bio:"Former food blogger (15K followers). I know both sides of the fan-creator equation. We built this for YOU.",funFact:"Made 47 prototypes before the final design"},{name:"Rahul Verma",role:"Tech Lead",bio:"I make sure calls never lag and payments stay secure. Boring? Yes. Important? Also yes.",funFact:"Fixed a bug at 3 AM while eating Maggi"},{name:"Neha Kapoor",role:"Customer Support",bio:"I reply to every email personally. Got a question? I am on it!",funFact:"Fastest typer in the team (110 WPM)"},{name:"Amit Gupta",role:"Marketing",bio:"I find awesome creators, make memes, and keep the community buzzing.",funFact:"Binged 200 YouTube channels for research"},{name:"Sneha Sharma",role:"Operations",bio:"I approve creator applications and keep every event running smooth.",funFact:"Interviewed 89 creators personally"}],g7=["https://api.dicebear.com/7.x/personas/svg?seed=Arjun%20Singh&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Priya%20Mehta&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Rahul%20Verma&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Neha%20Kapoor%20Support&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Amit%20Gupta%20Marketing&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Sneha%20Sharma%20Ops&backgroundColor=f4e6ff"],Dbe=Ibe.map((r,n)=>({quote:r.bio,name:r.name,designation:r.role,src:g7[n%g7.length]})),Obe=[{category:"Fans",question:"What if I don't win the bid?",answer:"You automatically get 90% of your money back within 5-7 business days. If you bid 200, you only risk 20  less than a movie ticket!"},{category:"Fans",question:"How do I know creators are real?",answer:"Every creator is manually verified by our team. We check social media, identity, and test their video setup. No fake accounts allowed."},{category:"Fans",question:"What can I talk about in the call?",answer:"Anything! Ask questions, get advice, request shoutouts, share your story. It's your 10 minutes. Just be kind and respectful."},{category:"Fans",question:"What if my internet is bad?",answer:"Our video software works on 3G/4G. If there is a technical issue on our end, you get 100% refund or a reschedule  your choice."},{category:"Creators",question:"How do payouts work?",answer:"You keep 90% of the winning bid. Withdraw anytime via UPI or bank transfer. We process payouts within 2-3 business days."},{category:"Creators",question:"What if a fan is rude?",answer:"End the call immediately. We ban that user and you still keep your earnings. Your safety comes first."},{category:"Creators",question:"Do I need lots of followers?",answer:"If you have 1,000+ followers or a unique skill people want to learn, you are good to go. Smaller creators often get more bids!"},{category:"General",question:"Is FanMeet available outside India?",answer:"Right now we are India-only, but the waitlist is open. Drop your email and we will notify you when we expand."},{category:"General",question:"How is this different from Cameo?",answer:"Cameo is pre-recorded videos. FanMeet is live, two-way conversations. Ask follow-ups, share screens, and build a real connection."}],jbe=[{type:"press",name:"YourStory",quote:"FanMeet is building Indias most intimate creator-fan marketplace.",url:"#"},{type:"press",name:"Inc42",quote:"A refreshing take on live interactions. Fans are bidding for moments, not merch.",url:"#"},{type:"social",name:"@creatorsneha",quote:"Just wrapped my third FanMeet. Tears, laughs, and a fan who wants to start creating again. ",url:"#"},{type:"social",name:"@chefamit",quote:"FanMeet calls feel like cooking with friends. 25 bids last night!",url:"#"}],Pbe=[{feature:"Real-time interaction",fanmeet:" Yes",social:" One-way comments",cameo:" Pre-recorded"},{feature:"Two-way conversation",fanmeet:" Talk & listen",social:" No",cameo:" No"},{feature:"Length of experience",fanmeet:"5-10 minutes",social:"Few seconds",cameo:"30-60 seconds"},{feature:"Ask follow-up questions",fanmeet:" Unlimited",social:" Maybe answered",cameo:" No"},{feature:"Typical price",fanmeet:"50-400",social:"Free (ignored)",cameo:"500-5000"},{feature:"Refund if you do not win",fanmeet:" 90-100%",social:"N/A",cameo:" No"}],kbe=[{title:"From Fan to Friend",before:"Rahul followed gaming creator Rohan for 3 years without a single reply.",during:"He won a 320 bid and spent 10 minutes discussing streaming tips.",after:"Rohan now recognizes Rahul in chat and they exchange DMs about upcoming games. Confidence boosted x100."},{title:"Career-Changing Advice",before:"Priya was torn between UX design and product management.",during:"She paid 400 to chat with a career coach creator who mapped a 90-day plan.",after:"Priya launched her own service studio within two months. Her first paying client came from that creators recommendation."},{title:"Gift That Made Her Cry",before:"Amit wanted a meaningful birthday surprise for his partner, an art lover.",during:"He booked a FanMeet with her favourite illustrator who live-sketched her while they talked.",after:"She cried happy tears and the sketch now hangs in their living room."}],Lbe=({titleComponent:r,children:n})=>{const o=O.useRef(null),{scrollYProgress:l}=Hxe({target:o}),[u,m]=O.useState(!1);O.useEffect(()=>{const S=()=>{typeof window<"u"&&m(window.innerWidth<=768)};return S(),window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}},[]);const g=u?[.9,1]:[1.05,1],E=CN(l,[0,1],[20,0]),y=CN(l,[0,1],g),x=CN(l,[0,1],[0,-80]);return i.jsx("div",{className:"h-[38rem] md:h-[49rem] flex justify-center relative px-2 md:px-16",ref:o,children:i.jsxs("div",{className:"py-5 md:py-8 w-full relative",style:{perspective:"1000px"},children:[i.jsx(Mbe,{translate:x,titleComponent:r}),i.jsx(Fbe,{rotate:E,scale:y,children:n})]})})},Mbe=({translate:r,titleComponent:n})=>i.jsx(vc.div,{style:{translateY:r},className:"max-w-5xl mx-auto text-center mb-6 md:mb-8",children:n}),Fbe=({rotate:r,scale:n,children:o})=>i.jsx(vc.div,{style:{rotateX:r,scale:n,boxShadow:"0 0 #0000004d, 0 9px 20px #0000004a, 0 37px 37px #00000042, 0 84px 50px #00000026, 0 149px 60px #0000000a, 0 233px 65px #00000003"},className:"max-w-5xl mx-auto h-[28rem] md:h-[38rem] w-full border-4 border-[#6C6C6C] p-3 md:p-6 bg-[#222222] rounded-[30px] shadow-2xl",children:i.jsx("div",{className:"h-full w-full overflow-hidden rounded-2xl bg-gray-100 dark:bg-zinc-900 flex",children:o})});function Ube(){const r=Ns(),[n,o]=O.useState("All"),[l,u]=O.useState(!1),[m,g]=O.useState(!1),E=n==="All"?Dx:Dx.filter(y=>y.category.toLowerCase().includes(n.toLowerCase()));return i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("section",{className:"relative overflow-hidden bg-[#050014] text-white",children:[i.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(0,213,255,0.32)_0,_transparent_55%),radial-gradient(circle_at_bottom,_rgba(236,72,153,0.32)_0,_transparent_55%)]"}),i.jsxs("div",{className:"relative z-10 mx-auto flex max-w-none flex-col px-2 pb-4 pt-6 md:max-w-7xl md:px-8 md:pb-6 md:pt-8",children:[i.jsxs("div",{className:"flex items-center justify-between text-white",children:[i.jsxs("div",{className:"flex items-center gap-6 md:gap-10",children:[i.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold md:text-xl",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] shadow-[0_0_25px_rgba(192,69,255,0.6)]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsxs("nav",{className:"hidden items-center gap-6 text-sm font-medium text-white/80 md:flex",children:[i.jsx("button",{type:"button",onClick:()=>r("/browse-events"),className:"transition-colors hover:text-white",children:"Browse Events"}),i.jsx("button",{type:"button",onClick:()=>r("/how-it-works"),className:"transition-colors hover:text-white",children:"How It Works"}),i.jsx("button",{type:"button",onClick:()=>r("/for-creators"),className:"transition-colors hover:text-white",children:"For Creators"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{type:"button",className:"hidden rounded-full border border-white/30 bg-black/40 px-4 py-1.5 text-xs font-medium text-white shadow-lg backdrop-blur-xl transition-all hover:-translate-y-0.5 hover:border-white hover:bg-black/60 hover:shadow-[0_0_25px_rgba(255,255,255,0.6)] md:inline-flex",onClick:()=>r("/auth"),children:"Log in"}),i.jsx("button",{type:"button",className:"hidden rounded-full border-2 border-transparent bg-gradient-to-r from-[#A78BFA] via-[#C084FC] to-[#E0E7FF] bg-clip-border px-4 py-1.5 text-xs font-semibold text-[#050014] shadow-lg transition-all hover:-translate-y-0.5 hover:shadow-[0_0_35px_rgba(167,139,250,0.5)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#E6FF00] md:inline-flex",style:{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"},onClick:()=>r("/auth"),children:"Sign up"}),i.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-full border border-white/40 bg-black/40 p-2 text-white shadow-md backdrop-blur-xl transition-colors md:hidden",onClick:()=>g(y=>!y),children:[i.jsx("span",{className:"sr-only",children:"Toggle navigation"}),i.jsxs("div",{className:"flex flex-col gap-[3px]",children:[i.jsx("span",{className:"h-[2px] w-4 bg-white"}),i.jsx("span",{className:"h-[2px] w-4 bg-white"}),i.jsx("span",{className:"h-[2px] w-4 bg-white"})]})]})]})]}),m&&i.jsxs("div",{className:"mt-3 flex flex-col gap-2 rounded-2xl border border-white/20 bg-black/70 p-4 text-sm md:hidden",children:[i.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),r("/browse-events")},children:"Browse Events"}),i.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),r("/how-it-works")},children:"How It Works"}),i.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),r("/for-creators")},children:"For Creators"}),i.jsxs("div",{className:"mt-1 flex flex-col gap-2",children:[i.jsx("button",{type:"button",className:"w-full rounded-full border border-white/40 bg-black/60 px-4 py-2 text-center text-xs font-medium text-white hover:bg-black/80",onClick:()=>{g(!1),r("/auth")},children:"Log in"}),i.jsx("button",{type:"button",className:"w-full rounded-full border-2 border-transparent px-4 py-2 text-center text-xs font-semibold text-[#050014] shadow-md hover:shadow-[0_0_25px_rgba(167,139,250,0.5)]",style:{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"},onClick:()=>{g(!1),r("/auth")},children:"Sign up"})]})]}),i.jsxs(vc.div,{className:"mt-6 flex flex-col gap-8 md:mt-12 md:flex-row md:items-stretch",initial:{opacity:0,y:32},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[i.jsxs("div",{className:"flex w-full flex-col md:w-1/2 lg:w-3/5",children:[i.jsxs("div",{className:"max-w-xl space-y-6",children:[i.jsx("p",{className:"inline-block text-xl font-normal text-white/90 drop-shadow-[0_8px_30px_rgba(0,0,0,0.8)] sm:text-2xl",style:{fontFamily:"cursive"},children:"meet your favourite creators on fanmet"}),i.jsxs("h1",{className:"text-4xl font-extrabold leading-tight sm:text-5xl lg:text-6xl",children:["Live 1:1 video calls",i.jsx("span",{className:"block text-[#FACC15]",children:"with the people you actually care about."})]}),i.jsx("div",{className:"h-1 w-24 rounded-full bg-gradient-to-r from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("p",{className:"max-w-lg text-sm text-white/80 sm:text-base",children:"Bid in tiny live auctions to win 510 minute video hangs with creators, gamers, chefs, coaches and other internet favourites. If you don't win, you get most of your money back."}),i.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[i.jsx("button",{type:"button",onClick:()=>r("/fan"),className:"inline-flex items-center justify-center rounded-full border-2 border-transparent px-7 py-3 text-sm font-semibold text-[#050014] shadow-[0_18px_50px_rgba(0,0,0,0.7)] transition-transform duration-200 hover:-translate-y-1 hover:shadow-[0_24px_70px_rgba(167,139,250,0.6)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#E6FF00] focus-visible:ring-offset-2",style:{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"},children:"Explore live meets"}),i.jsxs("button",{type:"button",onClick:()=>{const y=document.getElementById("how-it-works");y&&y.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center justify-center rounded-full border border-white/40 bg-black/40 px-5 py-2.5 text-sm font-medium text-white shadow-md backdrop-blur-xl transition-transform duration-200 hover:-translate-y-0.5 hover:bg-black/70",children:[i.jsx("span",{className:"mr-2 text-base",children:""}),"How FanMeet works"]})]})]}),i.jsxs("div",{className:"mt-4 grid gap-4 text-xs text-white/80 sm:grid-cols-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#22C55E]/20 text-sm",children:""}),i.jsx("span",{children:"90% refund if you don't win the bid."})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#00D5FF]/20 text-sm",children:""}),i.jsx("span",{children:"Verified creators, safe payments, no fake profiles."})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#EC4899]/20 text-sm",children:""}),i.jsx("span",{children:"Built in India for Indian fans & creators."})]})]})]}),i.jsx(vc.div,{className:"hidden w-full h-[280px] md:block md:h-[440px] md:w-1/2 lg:h-[530px] lg:w-2/5",initial:{clipPath:"polygon(100% 0, 100% 0, 100% 100%, 100% 100%)"},animate:{clipPath:"polygon(25% 0, 100% 0, 100% 100%, 0% 100%)"},transition:{duration:1.2,ease:"circOut"},children:i.jsxs("div",{className:"h-full w-full overflow-hidden rounded-[32px] shadow-[0_28px_80px_rgba(0,0,0,0.85)]",children:[i.jsx("img",{src:Yxe,alt:"FanMeet colourful hero",className:"h-full w-full object-cover"}),i.jsx("div",{className:"hidden h-full w-full rounded-[32px] bg-gradient-to-t from-black/60 via-black/10 to-transparent md:block"})]})})]})]})]}),i.jsx("section",{id:"how-it-works",className:"bg-white px-6 py-16 md:px-16 md:py-24",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#140423]",children:"Scroll through how FanMeet works"}),i.jsx("p",{className:"mt-2 text-base text-[#4A3B78]",children:"Cards stack as you scroll, revealing every piece of the fan-meet journey  from bidding to posting your own events."})]}),i.jsxs("div",{className:"mt-8 grid gap-6 md:grid-cols-3",children:[i.jsx(vc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#FF6B9D] via-[#FFC46B] to-[#E6FF00] p-[1px] shadow-[0_18px_45px_rgba(255,107,157,0.55)]",whileHover:{y:-12,rotateX:3,rotateY:-3},transition:{type:"spring",stiffness:220,damping:20},children:i.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#C045FF]",children:"Step 1"}),i.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"How it works"}),i.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Browse upcoming events, pick your creator, and place a bid to win a live 1:1 video call."}),i.jsx("ul",{className:"mt-4 space-y-2 text-sm text-[#4A3B78]",children:Sbe.map(y=>i.jsxs("li",{className:"flex gap-2",children:[i.jsx("span",{className:"mt-0.5 text-base",children:y.icon}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-[#140423]",children:y.title}),i.jsx("p",{className:"text-xs text-[#6C5A9C]",children:y.description})]})]},y.step))})]})}),i.jsx(vc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#FFE66B] via-[#E6FF00] to-[#00F0FF] p-[1px] shadow-[0_18px_45px_rgba(0,240,255,0.45)]",whileHover:{y:-12,rotateX:3,rotateY:3},transition:{type:"spring",stiffness:220,damping:20},children:i.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#00A3FF]",children:"Step 2"}),i.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"Featured creators"}),i.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Discover creators across categories. Tap a chip to filter the grid."}),i.jsx("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:["All","Beauty","Cosplay","Fitness","Music","Sports","Gaming"].map(y=>i.jsx("button",{type:"button",onClick:()=>o(y),className:"rounded-full px-3 py-1 font-medium transition-colors "+(n===y?"bg-[#140423] text-white":"bg-white/80 text-[#4A3B78] hover:bg-white"),children:y},y))}),i.jsx("div",{className:"mt-4 grid gap-3 text-xs text-[#4A3B78] md:grid-cols-2",children:E.slice(0,4).map(y=>i.jsxs("div",{className:"flex items-center gap-2 rounded-2xl bg-[#F8F5FF] px-3 py-2",children:[i.jsx(yi,{initials:y.avatar,size:"sm"}),i.jsxs("div",{className:"min-w-0",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[i.jsx("p",{className:"text-xs font-semibold text-[#140423]",children:y.name}),i.jsx(Xe,{variant:"primary",className:"px-2 py-0.5 text-[9px] leading-tight",children:"Verified"})]}),i.jsxs("p",{className:"text-[11px] text-[#6C5A9C]",children:[y.category,"  ",y.followers]}),i.jsxs("p",{className:"text-[11px] text-[#C045FF]",children:["From ",y.priceRange]})]})]},y.name))})]})}),i.jsx(vc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#00F0FF] via-[#6B6BFF] to-[#C045FF] p-[1px] shadow-[0_18px_45px_rgba(107,107,255,0.55)]",whileHover:{y:-12,rotateX:-3,rotateY:3},transition:{type:"spring",stiffness:220,damping:20},children:i.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#C045FF]",children:"Step 3"}),i.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"Get verified as a creator"}),i.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Apply once, get verified, and start hosting paid or free fan meets from anywhere."}),i.jsxs("ul",{className:"mt-4 space-y-2 text-sm text-[#4A3B78]",children:[i.jsx("li",{children:" 1K+ followers or a unique skill people want to learn"}),i.jsx("li",{children:" Simple KYC & social verification by our team"}),i.jsx("li",{children:" 90% payout on every winning bid  no hidden fees"})]}),i.jsx("button",{type:"button",onClick:()=>r("/creator"),className:"mt-4 inline-flex items-center justify-center rounded-full bg-white px-4 py-2 text-xs font-semibold text-[#140423] shadow-md transition-transform hover:-translate-y-0.5",children:"Apply to get verified"})]})})]})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"featured",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl flex-col items-center gap-10",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Who Can You Meet on FanMeet?"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"We have creators from every field!"})]}),i.jsx("div",{className:"flex w-full flex-col items-center justify-center",children:i.jsx("div",{className:"w-[250px] h-[250px] md:w-[420px] md:h-[420px] flex items-center justify-center",children:i.jsx(qxe,{images:wbe,containerSize:280,sphereRadius:130,autoRotate:!0,autoRotateSpeed:.35,dragSensitivity:.7,className:"mx-auto"})})})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#00D5FF_0,_#050014_50%),radial-gradient(circle_at_bottom,_#F97316_0,_#050014_55%)] px-6 py-16 md:px-16",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-12 text-center",children:[i.jsx("h2",{className:"mb-4 text-3xl font-bold text-white",children:"Join Thousands of Happy Fans! "}),i.jsx("p",{className:"text-lg text-[#ADB5BD]",children:"Real numbers from real people having real conversations"})]}),i.jsx("div",{className:"grid gap-8 md:grid-cols-2 lg:grid-cols-4",children:Cbe.map(y=>i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"mb-2 text-4xl font-bold text-[#FACC15]",children:y.value}),i.jsx("div",{className:"text-sm text-[#ADB5BD]",children:y.label})]},y.label))}),i.jsx("div",{className:"mt-8 grid gap-8 md:grid-cols-2 lg:grid-cols-4",children:Tbe.map(y=>i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"mb-2 text-4xl font-bold text-[#22C55E]",children:y.value}),i.jsx("div",{className:"text-sm text-[#ADB5BD]",children:y.label})]},y.label))})]})}),i.jsxs("section",{className:"relative overflow-hidden bg-[#050014] px-6 py-16 text-white md:px-16 md:py-24",children:[i.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(0,213,255,0.32)_0,_transparent_55%),radial-gradient(circle_at_bottom,_rgba(236,72,153,0.32)_0,_transparent_55%)]"}),i.jsxs("div",{className:"relative z-10 mx-auto flex max-w-6xl flex-col gap-10 md:grid md:grid-cols-[minmax(0,1.1fr)_minmax(0,1.1fr)] md:items-center",children:[i.jsxs("div",{className:"space-y-4 text-left text-white",children:[i.jsx("p",{className:"inline-flex items-center rounded-full bg-white/10 px-3 py-1 text-xs font-medium uppercase tracking-[0.16em] text-[#E6FF00] backdrop-blur-md",children:"LIVE DEMO"}),i.jsx("h2",{className:"text-3xl font-extrabold leading-tight sm:text-4xl lg:text-[2.6rem]",children:"See how a real FanMeet feels in under 2 minutes"}),i.jsx("p",{className:"max-w-xl text-sm text-white/80 sm:text-base",children:"Watch a real fan bid, win, and jump into a live video call with their favourite creator. No scripts, no actors  just genuine reactions."}),i.jsxs("ul",{className:"mt-4 space-y-2 text-sm text-white/80",children:[i.jsx("li",{children:" What the bidding screen looks like in action"}),i.jsx("li",{children:" How we keep calls safe, timed, and high-quality"}),i.jsx("li",{children:" The moment a fan realises their call is actually happening"})]})]}),i.jsx("div",{className:"relative mx-auto w-full max-w-3xl",children:i.jsx("div",{className:"relative overflow-hidden rounded-[28px] bg-black/40 p-[2px] shadow-[0_20px_60px_rgba(5,0,20,0.7)]",children:i.jsx("div",{className:"relative aspect-video w-full overflow-hidden rounded-[24px] bg-black",children:l?i.jsx("iframe",{className:"h-full w-full",src:"https://www.youtube.com/embed/S5IQtZlgNC8?autoplay=1&rel=0&modestbranding=1",title:"FanMeet overview video",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):i.jsxs("button",{type:"button",onClick:()=>u(!0),className:"group relative h-full w-full",children:[i.jsx("img",{src:"https://cdn.prod.website-files.com/62c48d78ef34931f8a604ef5/67630876396363c467036ede_video-poster.webp",alt:"FanMeet overview video preview",className:"h-full w-full object-cover opacity-90 transition-opacity group-hover:opacity-100"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"}),i.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 text-center text-white",children:[i.jsxs("div",{className:"inline-flex items-center gap-3 rounded-full bg-white/10 px-4 py-2 text-xs font-medium backdrop-blur-md",children:[i.jsx("span",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-white text-sm font-semibold text-[#C045FF] shadow-lg",children:""}),i.jsx("span",{className:"text-xs sm:text-sm",children:"Play 2 min overview"})]}),i.jsx("p",{className:"max-w-md text-xs text-white/80 sm:text-sm",children:'"This feels like a private show with your favourite creator. I forgot we were on camera."  real fan'})]})]})})})})]})]}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",children:i.jsxs("div",{className:"mx-auto max-w-5xl",children:[i.jsxs("div",{className:"mb-12 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Creators Love FanMeet Too"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Hear how meaningful conversations boost their community and income"})]}),i.jsx("div",{className:"grid gap-8 md:grid-cols-2",children:Nbe.map(y=>i.jsxs(fe,{elevated:!0,className:"overflow-hidden border border-[#E9ECEF]",children:[i.jsx("div",{className:"relative aspect-[16/9] bg-gradient-to-br from-[#212529] via-[#343A40] to-[#212529]",children:i.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i.jsxs("span",{className:"rounded-full bg-white px-4 py-2 text-sm font-semibold text-[#C045FF] shadow",children:[" ",y.duration]})})}),i.jsxs(Ee,{className:"flex flex-col gap-4 p-6",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:y.name}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["",y.quote,""]})]})]},y.name))})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-16 md:px-16",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Real FanMeets"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Real moments and reactions captured from live FanMeet calls."})]}),i.jsx("div",{className:"flex flex-col gap-6 md:gap-8",children:Array.from({length:6}).map((y,x)=>{const S=p7[x%p7.length],C=f7[x%f7.length],R=m7[x%m7.length];return i.jsx(Lbe,{titleComponent:i.jsxs("div",{className:"mt-6 md:mt-0",children:[i.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:["Real FanMeet #",x+1]}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:S.context})]}),children:i.jsx("div",{className:"flex h-full",children:i.jsxs("div",{className:"flex h-full flex-col md:flex-row gap-4 rounded-2xl bg-white p-3 md:p-4 shadow-md border border-[#F1F3F5] w-full",children:[i.jsx("div",{className:"w-full md:w-1/2",children:i.jsx("div",{className:"h-full w-full overflow-hidden rounded-xl",children:i.jsx("img",{src:R,alt:S.context,className:"h-full w-full object-cover"})})}),i.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:"Full Review"}),i.jsxs("p",{className:"mt-2 text-sm font-semibold text-[#212529]",children:["",C.quote,""]})]}),i.jsxs("div",{className:"mt-3 flex flex-col gap-1 text-xs text-[#6C757D]",children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:C.name}),i.jsx("span",{children:C.met}),i.jsxs("span",{className:"text-[11px] text-[#868E96]",children:["Moment: ",S.context]}),i.jsx("span",{className:"flex items-center gap-1 text-[#C045FF]",children:"".split("").map((M,G)=>i.jsx("span",{children:M},`${S.id}-star-${G}`))})]})]})]})})},`${S.id}-scroll-${x}`)})})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"trust",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Trust Comes First"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"We built FanMeet to be safe, secure, and fan-friendly from day one."})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-4",children:Rbe.map(y=>i.jsx(fe,{elevated:!0,className:"h-full border border-[#F1F3F5]",children:i.jsxs(Ee,{className:"flex h-full flex-col gap-4 p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 text-[#C045FF]",children:[i.jsx("span",{className:"text-2xl",children:y.icon}),i.jsx("span",{className:"text-sm font-semibold uppercase tracking-wide text-[#6C757D]",children:y.badge})]}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.title}),i.jsx("ul",{className:"space-y-2 text-sm text-[#6C757D]",children:y.bullets.map(x=>i.jsxs("li",{className:"flex gap-2",children:[i.jsx("span",{className:"text-[#C045FF]",children:""}),i.jsx("span",{children:x})]},x))})]})},y.title))})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#ECFEFF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"pricing",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-12 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Two Ways to Meet Your Heroes"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Whether you want to bid or try your luck, FanMeet keeps it fair and transparent."})]}),i.jsx("div",{className:"grid gap-8 md:grid-cols-2",children:Abe.map(y=>i.jsxs(fe,{elevated:!0,className:"border border-[#E9ECEF] bg-white",children:[i.jsx(Te,{title:y.title,subtitle:y.description,className:"border-b border-[#F1F3F5]"}),i.jsxs(Ee,{className:"flex flex-col gap-4 p-6",children:[i.jsx("ul",{className:"space-y-3 text-sm text-[#212529]",children:y.highlights.map(x=>i.jsxs("li",{className:"flex gap-2",children:[i.jsx("span",{className:"text-[#C045FF]",children:""}),i.jsx("span",{children:x})]},x))}),i.jsx("p",{className:"rounded-[14px] bg-[#FFF3ED] p-4 text-sm text-[#6C757D]",children:y.story}),i.jsx(oe,{className:"mt-2 w-full",variant:"secondary",children:y.cta})]})]},y.title))})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"team",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsx("div",{className:"mb-8 text-center",children:i.jsx("h2",{className:"text-3xl font-bold tracking-[0.25em] text-[#212529]",children:"ABOUT US"})}),i.jsx(bbe,{testimonials:Dbe,autoplay:!0})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"faq",children:i.jsxs("div",{className:"mx-auto max-w-5xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Questions? We Already Answered Them."}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Everything fans and creators ask before hitting that Bid or Apply button."})]}),i.jsx("div",{className:"flex flex-col gap-4",children:Obe.map(y=>i.jsxs("details",{className:"group rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between gap-4 text-left text-sm font-semibold text-[#212529]",children:[i.jsxs("span",{className:"text-[#C045FF]",children:["[",y.category,"]"]}),i.jsx("span",{className:"flex-1 text-[#212529]",children:y.question}),i.jsx("span",{className:"text-[#ADB5BD] transition-transform group-open:rotate-45",children:"+"})]}),i.jsx("p",{className:"mt-3 text-sm text-[#6C757D]",children:y.answer})]},`${y.category}-${y.question}`))})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#00D5FF_0,_#050014_50%),radial-gradient(circle_at_bottom,_#EC4899_0,_#050014_55%)] px-6 py-20 text-white md:px-16",id:"press",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold",children:"People Are Talking About FanMeet"}),i.jsx("p",{className:"mt-2 text-base text-[#CED4DA]",children:"Press features, creator shoutouts, and community buzz."})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:jbe.map(y=>i.jsx(fe,{className:"border border-[#343A40] bg-[#2C3036]",children:i.jsxs(Ee,{className:"flex flex-col gap-3 p-6",children:[i.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:y.type==="press"?"As Seen In":"From the Community"}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.name}),i.jsx("p",{className:"text-sm text-[#212529]",children:y.quote}),i.jsx(oe,{variant:"ghost",className:"self-start px-0 text-sm text-[#C045FF]",children:"Read more "})]})},`${y.type}-${y.name}`))})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#ECFEFF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"comparison",children:i.jsxs("div",{className:"mx-auto max-w-5xl",children:[i.jsxs("div",{className:"mb-8 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Why FanMeet Beats DMs and Cameo"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"The only place for real, two-way conversations with creators you admire."})]}),i.jsx("div",{className:"overflow-x-auto rounded-[18px] border border-[#E9ECEF]",children:i.jsxs("table",{className:"min-w-full divide-y divide-[#E9ECEF]",children:[i.jsx("thead",{className:"bg-[#F8F9FA] text-sm uppercase tracking-wide text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-4 py-3 text-left",children:"Feature"}),i.jsx("th",{className:"px-4 py-3 text-left text-[#C045FF]",children:"FanMeet"}),i.jsx("th",{className:"px-4 py-3 text-left",children:"Commenting"}),i.jsx("th",{className:"px-4 py-3 text-left",children:"Paid Shoutouts"})]})}),i.jsx("tbody",{className:"divide-y divide-[#F1F3F5] text-sm text-[#212529]",children:Pbe.map(y=>i.jsxs("tr",{className:"bg-white",children:[i.jsx("td",{className:"px-4 py-3 font-medium text-[#212529]",children:y.feature}),i.jsx("td",{className:"px-4 py-3 text-[#20C997]",children:y.fanmeet}),i.jsx("td",{className:"px-4 py-3 text-[#6C757D]",children:y.social}),i.jsx("td",{className:"px-4 py-3 text-[#6C757D]",children:y.cameo})]},y.feature))})]})}),i.jsx("p",{className:"mt-6 text-center text-sm text-[#6C757D]",children:"FanMeet is the only place to have a REAL conversation with creators you admire."})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#FFF7ED_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"success-stories",children:i.jsxs("div",{className:"mx-auto max-w-5xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Three Stories You Will Brag About Later"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Real transformations from fans who hit Bid and never looked back."})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:kbe.map(y=>i.jsx(fe,{elevated:!0,className:"border border-[#E9ECEF]",children:i.jsxs(Ee,{className:"flex h-full flex-col gap-3 p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.title}),i.jsxs("div",{className:"space-y-2 text-sm text-[#6C757D]",children:[i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"Before:"})," ",y.before]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"During:"})," ",y.during]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"After:"})," ",y.after]})]})]})},y.title))})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",children:i.jsxs("div",{className:"mx-auto max-w-4xl rounded-[24px] border border-[#F1F3F5] bg-[radial-gradient(circle_at_top,_#FDF2EC_0,_#FFFFFF_70%)] p-10 text-center shadow-[var(--shadow-lg)]",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Ready to Meet Your Hero?"}),i.jsx("p",{className:"mt-3 text-base text-[#6C757D]",children:"Join 1,247 people who already had life-changing conversations."}),i.jsxs("div",{className:"mt-6 flex flex-wrap justify-center gap-4",children:[i.jsx(oe,{size:"lg",className:"px-8 text-base",children:"Browse Events & Start Bidding "}),i.jsx(oe,{size:"lg",variant:"secondary",className:"px-8 text-base",children:"Apply to Become a Creator "})]}),i.jsxs("div",{className:"mt-6 grid gap-3 md:grid-cols-2",children:[i.jsx("div",{className:"rounded-[16px] bg-white p-4 text-sm text-[#6C757D]",children:"I bid 280, won the call, and my creator remembered me on stream a week later.  Neeraj, Pune"}),i.jsx("div",{className:"rounded-[16px] bg-white p-4 text-sm text-[#6C757D]",children:"Applications took 2 minutes. I now run weekly coaching calls and finally understand my fans.  Ananya, Creator"})]}),i.jsxs("div",{className:"mt-6 flex flex-wrap justify-center gap-4 text-xs text-[#6C757D]",children:[i.jsx("span",{children:" 90% Refund Guarantee"}),i.jsx("span",{children:" Verified Creators Only"}),i.jsx("span",{children:" Secure Payments"}),i.jsx("span",{children:" 24/7 Support"})]})]})})]})}const Vbe=[{title:"300+ creators onboarded",description:"Host exclusive AMA sessions, workshops, and meet & greets."},{title:"10k+ fan requests",description:"Fans are lining up for authentic, small-group interactions."}];function Bbe(){const[r,n]=O.useState("login"),[o,l]=O.useState(""),[u,m]=O.useState(""),[g,E]=O.useState(""),[y,x]=O.useState(""),[S,C]=O.useState(!1),[R,M]=O.useState(!1),[G,I]=O.useState(!1),[j,L]=O.useState(!1),[N,D]=O.useState({email:"",password:"",confirmPassword:""}),[V,B]=O.useState({email:"",password:"",confirmPassword:"",bio:""}),[z,H]=O.useState(null),[J,ee]=O.useState(null),[ne,he]=O.useState(!1),[ve,ye]=O.useState(!1),me=Ns(),[ue]=Gp(),{login:Fe,signup:be,resendVerificationEmail:ae,loginWithGoogle:ge,isAuthenticated:Se,user:it}=vs(),[Ue,ht]=O.useState(!1),[qe,Me]=O.useState("");O.useEffect(()=>{Se&&it&&me({fan:"/fan",creator:"/creator",admin:"/admin"}[it.role],{replace:!0})},[Se,it,me]);const st=async pe=>{if(pe.preventDefault(),!o.trim()||!u.trim()){E("Please enter both email and password.");return}E(""),x(""),C(!0);try{const Re={fan:"/fan",creator:"/creator",admin:"/admin"},Ge=await Fe({email:o,password:u}),xt=ue.get("redirect"),jt=Re[Ge.role],Pt=xt&&xt.trim().length>0?xt:jt;me(Pt,{replace:!0})}catch(Re){let Ge="Something went wrong. Please try again.";Re instanceof Error&&(Ge=Re.message,(/already\s+(registered|exists)/i.test(Ge)||/user\s+already/i.test(Ge))&&M(!0)),E(Ge)}finally{C(!1)}},De=async()=>{if(!Ue){Me(""),ht(!0);try{const pe=ue.get("redirect");await ge({redirectTo:pe&&pe.startsWith("/")?pe:void 0})}catch(pe){const Re=pe instanceof Error?pe.message:"Could not start Google sign-in. Please try again.";Me(Re),ht(!1)}}},Ae=async()=>{if(E(""),x(""),!o.trim()){E("Enter your email first, then click resend.");return}C(!0);try{await ae({email:o.trim()}),x("Verification email sent. Please check your inbox.")}catch(pe){E(pe instanceof Error?pe.message:"Could not resend verification email.")}finally{C(!1)}},Qe=async(pe,Re,Ge,xt,jt,Pt)=>{if(!Re.email.trim()||!Re.password.trim()||!Re.confirmPassword.trim()){xt({type:"error",message:"All fields are required."});return}if(Re.password!==Re.confirmPassword){xt({type:"error",message:"Passwords do not match."});return}xt(null),Pt(!0);try{await be({email:Re.email.trim(),password:Re.password,role:pe}),xt({type:"success",message:"Account created! Please verify your email to continue."}),Ge({...Re,password:"",confirmPassword:""})}catch(rt){let Dt="Could not complete signup.";rt instanceof Error&&(Dt=rt.message,(/already\s+(registered|exists)/i.test(Dt)||/user\s+already/i.test(Dt))&&(M(!0),jt(!1))),xt({type:"error",message:Dt})}finally{Pt(!1)}};return i.jsxs(i.Fragment,{children:[R&&i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4 py-10",children:i.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-6 text-center shadow-2xl",children:[i.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-[#F4E6FF] text-3xl",children:""}),i.jsx("h3",{className:"text-xl font-semibold text-[#050014]",children:"Account already exists"}),i.jsxs("p",{className:"mt-2 text-sm text-[#6C757D]",children:["Looks like ",o||"this email"," is already registered. Try logging in, or use another email to create a new account."]}),i.jsxs("div",{className:"mt-5 flex flex-col gap-2",children:[i.jsx(oe,{onClick:()=>{n("login"),M(!1)},children:"Go to login"}),i.jsx(oe,{variant:"secondary",onClick:()=>M(!1),children:"Use a different email"})]})]})}),i.jsxs("div",{className:"grid min-h-[calc(100vh-70px)] grid-cols-1 bg-gradient-to-b from-white to-[#F8F0FF] md:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]",children:[i.jsxs("section",{className:"relative hidden h-full w-full items-start justify-start bg-gradient-to-br from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] px-10 py-9 text-[#050014] md:flex",children:[i.jsxs("div",{className:"relative z-10 mx-auto flex max-w-xl flex-col gap-6",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-4 py-1 text-sm font-medium tracking-wide text-[#C045FF]",children:[i.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"})," LIVE MOMENTS  REAL CONNECTIONS"]}),i.jsx("h1",{className:"text-2xl font-bold leading-tight text-[#050014] md:text-3xl lg:text-4xl",children:"Bring creators and fans together through premium digital meetups"}),i.jsx("p",{className:"text-xs text-[#4B445F] md:text-sm lg:text-base",children:"Secure bidding, curated events, and rich creator tooling packaged in one vibrant platform."})]}),i.jsxs("div",{className:"hidden xl:flex xl:flex-col xl:gap-4",children:[i.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:Vbe.map(pe=>i.jsx(fe,{className:"bg-white/10 backdrop-blur-md transition hover:bg-white/20",elevated:!0,children:i.jsxs("div",{className:"flex flex-col gap-2 p-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-[#050014]",children:pe.title}),i.jsx("p",{className:"text-sm text-[#4B445F]",children:pe.description})]})},pe.title))}),i.jsxs("div",{className:"relative mt-2",children:[i.jsx("img",{src:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=1200&q=80",alt:"Creators collaborating",className:"h-36 w-full rounded-3xl object-cover shadow-2xl shadow-[#C045FF]/40"}),i.jsx("div",{className:"absolute bottom-2 left-1/2 w-[85%] -translate-x-1/2 rounded-2xl bg-white/95 p-3 shadow-xl shadow-[#C045FF]/15",children:i.jsxs("div",{className:"flex items-center gap-2.5",children:[i.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-[#C045FF]/10 text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:"Creator Spotlight"}),i.jsx("p",{className:"text-sm text-[#212529]",children:"My fans love our micro-meet sessionsit feels personal and seamless."})]})]})})]})]})]}),i.jsx("div",{className:"absolute right-0 top-0 h-full w-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"})]}),i.jsx("section",{className:"flex items-start justify-center px-4 py-4 md:px-6 md:py-4",children:i.jsxs("div",{className:"flex w-full max-w-md flex-col gap-4 md:gap-3.5",children:[i.jsxs("div",{className:"flex flex-col gap-1.5 text-center md:text-left",children:[i.jsx(oo,{to:"/",className:"text-sm font-semibold text-[#C045FF]",children:" Back to home"}),i.jsx("h2",{className:"text-2xl font-bold text-[#212529] md:text-3xl",children:"Welcome back"}),i.jsx("p",{className:"hidden text-sm text-[#6C757D] lg:block",children:"Sign in to manage your events, track bids, and stay close to your community."})]}),i.jsxs("form",{className:"flex flex-col gap-3",onSubmit:st,children:[i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx(tt,{label:"Email",placeholder:"you@example.com",type:"email",required:!0,value:o,onChange:pe=>l(pe.target.value)}),i.jsx(tt,{label:"Password",placeholder:"Enter your password",type:"password",required:!0,value:u,onChange:pe=>m(pe.target.value)}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("label",{className:"flex items-center gap-2 text-[#6C757D]",children:[i.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Remember me"]}),i.jsx(oo,{to:"/auth/forgot-password",className:"font-medium text-[#C045FF] hover:text-[#8B3FFF]",children:"Forgot password?"})]})]}),g?i.jsx("p",{className:"text-[11px] font-medium text-[#DC3545]",children:g}):null,y?i.jsx("p",{className:"text-[11px] font-medium text-[#198754]",children:y}):null,i.jsx(oe,{type:"submit",size:"md",className:"h-9 text-[13px]",disabled:S,children:"Continue with email"}),r==="login"?i.jsx("button",{type:"button",className:"text-left text-[12px] font-medium text-[#C045FF] hover:text-[#8B3FFF]",onClick:Ae,disabled:S,children:"Resend verification email"}):null,i.jsxs("div",{className:"flex items-center gap-2.5",children:[i.jsx("span",{className:"h-px flex-1 bg-[#E9ECEF]"}),i.jsx("span",{className:"text-sm font-medium text-[#6C757D]",children:"or"}),i.jsx("span",{className:"h-px flex-1 bg-[#E9ECEF]"})]}),i.jsxs("div",{className:"grid gap-2",children:[i.jsx(oe,{variant:"secondary",size:"md",className:"h-9 text-[13px]",onClick:De,disabled:S||Ue,children:Ue?"Connecting to Google":"Continue with Google"}),i.jsx(oe,{variant:"ghost",size:"md",className:"h-9 text-[13px]",children:"Continue with Apple"})]}),qe?i.jsx("p",{className:"text-[11px] font-medium text-[#DC3545]",children:qe}):null]}),i.jsxs("div",{className:"rounded-2xl border border-dashed border-[#E9ECEF] bg-white/60 p-4",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:"New here?"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Choose your path to create a FanMeet account."}),i.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>I(!0),children:"Sign up as Fan"}),i.jsx(oe,{onClick:()=>L(!0),children:"Sign up as Creator"})]})]}),i.jsxs("p",{className:"hidden text-xs text-[#ADB5BD] lg:block",children:["By continuing, you agree to our"," ",i.jsx(oo,{to:"#",className:"font-medium text-[#C045FF]",children:"Terms of Service"})," ","and"," ",i.jsx(oo,{to:"#",className:"font-medium text-[#C045FF]",children:"Privacy Policy"}),"."]})]})})]}),G?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4 py-6",children:i.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl",children:[i.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold text-[#050014]",children:"Join as a Fan"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Bid on events, join virtual meets, and build connections."})]}),i.jsx("button",{type:"button",className:"rounded-md border border-[#E9ECEF] px-3 py-1 text-sm text-[#343A40] hover:bg-[#F8F9FA]",onClick:()=>{I(!1),H(null)},children:""})]}),i.jsxs("form",{className:"flex flex-col gap-3",onSubmit:pe=>{pe.preventDefault(),Qe("fan",N,D,H,I,he)},children:[i.jsx(tt,{label:"Email",placeholder:"you@example.com",type:"email",required:!0,value:N.email,onChange:pe=>D(Re=>({...Re,email:pe.target.value}))}),i.jsx(tt,{label:"Password",type:"password",required:!0,value:N.password,onChange:pe=>D(Re=>({...Re,password:pe.target.value}))}),i.jsx(tt,{label:"Confirm Password",type:"password",required:!0,value:N.confirmPassword,onChange:pe=>D(Re=>({...Re,confirmPassword:pe.target.value}))}),z?i.jsx("p",{className:tp("text-[11px] font-medium",z.type==="success"?"text-[#198754]":"text-[#DC3545]"),children:z.message}):null,i.jsx(oe,{type:"submit",disabled:ne,children:ne?"Creating account":"Create fan account"})]})]})}):null,j?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4 py-6",children:i.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl",children:[i.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold text-[#050014]",children:"Join as a Creator"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Host intimate sessions, monetize meets, and access creator tooling."})]}),i.jsx("button",{type:"button",className:"rounded-md border border-[#E9ECEF] px-3 py-1 text-sm text-[#343A40] hover:bg-[#F8F9FA]",onClick:()=>{L(!1),ee(null)},children:""})]}),i.jsxs("form",{className:"flex flex-col gap-3",onSubmit:pe=>{pe.preventDefault(),Qe("creator",V,B,ee,L,ye)},children:[i.jsx(tt,{label:"Creator email",placeholder:"studio@you.com",type:"email",required:!0,value:V.email,onChange:pe=>B(Re=>({...Re,email:pe.target.value}))}),i.jsx(tt,{label:"Password",type:"password",required:!0,value:V.password,onChange:pe=>B(Re=>({...Re,password:pe.target.value}))}),i.jsx(tt,{label:"Confirm Password",type:"password",required:!0,value:V.confirmPassword,onChange:pe=>B(Re=>({...Re,confirmPassword:pe.target.value}))}),i.jsx(tt,{label:"Tell us about your audience",placeholder:"Optional - e.g. 250k IG, podcast host, etc.",value:V.bio,onChange:pe=>B(Re=>({...Re,bio:pe.target.value}))}),J?i.jsx("p",{className:tp("text-[11px] font-medium",J.type==="success"?"text-[#198754]":"text-[#DC3545]"),children:J.message}):null,i.jsx(oe,{type:"submit",disabled:ve,children:ve?"Creating creator profile":"Apply as creator"}),i.jsx("p",{className:"text-[11px] text-[#6C757D]",children:"Creators undergo a quick review before gaining full access. Well email you within 24 hours."})]})]})}):null]})}function Wbe(){const r=Ns(),[n,o]=O.useState(""),[l,u]=O.useState("idle"),[m,g]=O.useState(""),E=O.useMemo(()=>typeof window>"u"?"":`${window.location.origin}/auth/update-password`,[]),y=async x=>{if(x.preventDefault(),g(""),!n.trim()){g("Please enter your email.");return}u("sending");const{error:S}=await ie.auth.resetPasswordForEmail(n.trim(),{redirectTo:E});if(S){g(S.message||"Could not send reset email."),u("idle");return}u("sent")};return i.jsxs("div",{className:"mx-auto flex max-w-md flex-col gap-4 px-4 py-10",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(oo,{to:"/auth",className:"text-sm font-semibold text-[#C045FF]",children:" Back to login"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r("/"),children:"Home"})]}),i.jsxs(fe,{elevated:!0,className:"p-5",children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Reset your password"}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"Enter your email and well send you a link to set a new password."}),i.jsxs("form",{className:"mt-4 flex flex-col gap-3",onSubmit:y,children:[i.jsx(tt,{label:"Email",type:"email",placeholder:"you@example.com",value:n,onChange:x=>o(x.target.value),required:!0}),m?i.jsx("p",{className:"text-xs font-medium text-[#DC3545]",children:m}):null,l==="sent"?i.jsx("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-3 text-sm text-[#6C757D]",children:"Reset link sent. Please check your inbox (and spam folder)."}):null,i.jsx(oe,{type:"submit",disabled:l==="sending",children:l==="sending"?"Sending":"Send reset link"})]})]})]})}function Gbe(){const r=Ns(),[n,o]=O.useState(""),[l,u]=O.useState(""),[m,g]=O.useState(""),[E,y]=O.useState("checking");O.useEffect(()=>{(async()=>{const{data:C}=await ie.auth.getSession();if(!C.session){y("idle"),g("This reset link is invalid or expired. Please request a new one.");return}y("ready")})()},[]);const x=async S=>{if(S.preventDefault(),g(""),!n.trim()||n.length<8){g("Password must be at least 8 characters.");return}if(n!==l){g("Passwords do not match.");return}y("saving");const{error:C}=await ie.auth.updateUser({password:n});if(C){g(C.message||"Could not update password."),y("ready");return}y("saved"),setTimeout(()=>r("/auth",{replace:!0}),800)};return i.jsxs("div",{className:"mx-auto flex max-w-md flex-col gap-4 px-4 py-10",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(oo,{to:"/auth",className:"text-sm font-semibold text-[#C045FF]",children:" Back to login"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r("/"),children:"Home"})]}),i.jsxs(fe,{elevated:!0,className:"p-5",children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Set a new password"}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"Choose a strong password you havent used before."}),m?i.jsx("p",{className:"mt-3 text-xs font-medium text-[#DC3545]",children:m}):null,E==="idle"?i.jsx("div",{className:"mt-4",children:i.jsx(oe,{onClick:()=>r("/auth/forgot-password"),children:"Request new reset link"})}):i.jsxs("form",{className:"mt-4 flex flex-col gap-3",onSubmit:x,children:[i.jsx(tt,{label:"New password",type:"password",value:n,onChange:S=>o(S.target.value),placeholder:"At least 8 characters",required:!0}),i.jsx(tt,{label:"Confirm password",type:"password",value:l,onChange:S=>u(S.target.value),required:!0}),i.jsx(oe,{type:"submit",disabled:E!=="ready",children:E==="saving"?"Saving":E==="saved"?"Saved":"Update password"})]})]})]})}function Hbe(){const r=Ns(),[n]=Gp(),[o,l]=O.useState("loading"),[u,m]=O.useState("Finishing sign-in");return O.useEffect(()=>{(async()=>{var E;try{const y=n.get("code");if(y){const{error:M}=await ie.auth.exchangeCodeForSession(y);if(M){l("error"),m(M.message||"Could not complete authentication.");return}}const{data:x}=await ie.auth.getSession();if(!x.session){l("error"),m("No session found. Please try logging in again.");return}const S={fan:"/fan",creator:"/creator",admin:"/admin"};let C=null;const R=n.get("redirect");if(R&&R.startsWith("/")&&(C=R),!C){const{data:{user:M}}=await ie.auth.getUser();if(!M){l("error"),m("Unable to load your account. Please sign in again.");return}const{data:G}=await ie.from("users").select("role").eq("id",M.id).maybeSingle(),I=(G==null?void 0:G.role)||((E=M.user_metadata)==null?void 0:E.role)||"fan";C=S[I]??"/fan"}l("success"),m("Success! Redirecting"),setTimeout(()=>r(C??"/auth",{replace:!0}),600)}catch{l("error"),m("Could not complete authentication.")}})()},[r,n]),i.jsx("div",{className:"mx-auto flex max-w-md flex-col gap-4 px-4 py-10",children:i.jsxs(fe,{elevated:!0,className:"p-5",children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Auth Callback"}),i.jsx("p",{className:"mt-2 text-sm text-[#6C757D]",children:u}),o==="error"?i.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[i.jsx(oe,{onClick:()=>r("/auth",{replace:!0}),children:"Go to login"}),i.jsx(oe,{variant:"secondary",onClick:()=>r("/",{replace:!0}),children:"Home"})]}):null]})})}function zbe(){const{login:r,isAuthenticated:n,user:o,logout:l}=vs(),[u,m]=O.useState(""),[g,E]=O.useState(""),[y,x]=O.useState(""),[S,C]=O.useState(!1),R=Ns();O.useEffect(()=>{n&&(o==null?void 0:o.role)==="admin"&&R("/admin",{replace:!0})},[n,o,R]);const M=async G=>{if(G.preventDefault(),!u.trim()||!g.trim()){x("Please enter both email and password.");return}x(""),C(!0);try{if((await r({email:u,password:g})).role!=="admin"){x("This account is not an admin."),await l();return}R("/admin",{replace:!0})}catch(I){I instanceof Error?x(I.message):x("Something went wrong. Please try again.")}finally{C(!1)}};return i.jsxs("div",{className:"grid min-h-[calc(100vh-70px)] grid-cols-1 bg-gradient-to-b from-white to-[#F8F0FF] md:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]",children:[i.jsxs("section",{className:"relative hidden h-full w-full items-start justify-start bg-gradient-to-br from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] px-10 py-9 text-[#050014] md:flex",children:[i.jsx("div",{className:"relative z-10 mx-auto flex max-w-xl flex-col gap-6",children:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-4 py-1 text-sm font-medium tracking-wide text-[#C045FF]",children:[i.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"})," ADMIN ACCESS"]}),i.jsx("h1",{className:"text-2xl font-bold leading-tight text-[#050014] md:text-3xl lg:text-4xl",children:"Sign in to your FanMeet admin console"}),i.jsx("p",{className:"text-xs text-[#4B445F] md:text-sm lg:text-base",children:"Manage creators, fans, events, payouts, and platform settings from a single secure dashboard."})]})}),i.jsx("div",{className:"absolute right-0 top-0 h-full w-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"})]}),i.jsx("section",{className:"flex items-start justify-center px-4 py-4 md:px-6 md:py-4",children:i.jsxs("div",{className:"flex w-full max-w-md flex-col gap-4 md:gap-3.5",children:[i.jsxs("div",{className:"flex flex-col gap-1.5 text-center md:text-left",children:[i.jsx(oo,{to:"/",className:"text-sm font-semibold text-[#C045FF]",children:" Back to home"}),i.jsx("h2",{className:"text-2xl font-bold text-[#212529] md:text-3xl",children:"Admin sign in"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Use your admin credentials to access the platform controls."})]}),i.jsxs("form",{className:"flex flex-col gap-3",onSubmit:M,children:[i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx(tt,{label:"Admin email",placeholder:"you@company.com",type:"email",required:!0,value:u,onChange:G=>m(G.target.value)}),i.jsx(tt,{label:"Password",placeholder:"Enter your password",type:"password",required:!0,value:g,onChange:G=>E(G.target.value)})]}),y?i.jsx("p",{className:"text-[11px] font-medium text-[#DC3545]",children:y}):null,i.jsx(oe,{type:"submit",size:"md",className:"h-9 text-[13px]",disabled:S,children:S?"Signing in":"Sign in as admin"}),i.jsx(fe,{className:"mt-2 border-[#FFE5D9] bg-[#FFF8F3] p-3 text-xs text-[#6C757D]",children:"Admin access is restricted. If you believe you should have access, contact the platform owner."})]})]})})]})}const $H=O.createContext(void 0);function Kbe(r,n){return!r&&!n?"":r?n?`${r}   ${n}`:r:n}const qbe=({children:r})=>{const[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState([]),[E,y]=O.useState([]),[x,S]=O.useState(!0),{user:C}=vs();O.useEffect(()=>{(async()=>{const{data:J,error:ee}=await ie.from("events").select("*");if(ee){console.error("Error fetching events:",ee);return}if(!J)return;const{data:ne}=await ie.from("bids").select("*"),he=J.map(ue=>ue.creator_id),{data:ve}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",he),ye=new Map((ve==null?void 0:ve.map(ue=>[ue.user_id,ue]))||[]),me=J.map(ue=>{const Fe=(ne==null?void 0:ne.filter(Qe=>Qe.event_id===ue.id))||[],be=Fe.length>0?Math.max(...Fe.map(Qe=>Qe.amount)):0,ae=new Set(Fe.map(Qe=>Qe.fan_id)).size,ge=new Date(ue.starts_at),Se=new Date,Ue=(ue.bidding_closes_at?new Date(ue.bidding_closes_at):ge).getTime()-Se.getTime();let ht="Bidding Closed";if(Ue>0){const Qe=Math.floor(Ue/36e5);Qe>24?ht=`${Math.floor(Qe/24)} days left to bid`:Qe>0?ht=`${Qe} hours left to bid`:ht=`${Math.floor(Ue/6e4)} minutes left to bid`}const qe=ge.toLocaleDateString(),Me=ge.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),st=ye.get(ue.creator_id),De=((st==null?void 0:st.username)||`user${ue.creator_id.substring(0,8)}`).toLowerCase();let Ae;return ue.status==="completed"||ue.status==="cancelled"?Ae="Completed":ue.bidding_closes_at&&new Date(ue.bidding_closes_at)>Se?Ae="Accepting Bids":ue.status==="live"?Ae="LIVE":Ae="Upcoming",{id:ue.id,creatorUsername:De,creatorDisplayName:(st==null?void 0:st.display_name)||"Unknown",title:ue.title,description:ue.description,category:ue.category||"general",status:Ae,date:`${qe} @ ${Me}`,duration:`${ue.duration_minutes} minutes`,basePrice:ue.base_price,currentBid:be,participants:ae,endsIn:ht,startsAt:ue.starts_at}});o(me),S(!1)})()},[]),O.useEffect(()=>{if(!C){u([]),g([]);return}(async()=>{const{data:J,error:ee}=await ie.from("bids").select("*").eq("fan_id",C.id);if(!ee&&J){const ve=J.map(ae=>ae.event_id),{data:ye}=await ie.from("events").select("id, title, creator_id").in("id",ve),me=new Map((ye==null?void 0:ye.map(ae=>[ae.id,ae]))||[]),ue=Array.from(new Set((ye??[]).map(ae=>ae.creator_id).filter(Boolean))),{data:Fe}=ue.length?await ie.from("profiles").select("user_id, username").in("user_id",ue):{data:null},be=new Map((Fe??[]).map(ae=>[ae.user_id,ae.username]));u(J.map(ae=>{const ge=me.get(ae.event_id),Se=ge?be.get(ge.creator_id):void 0;return{id:ae.id,eventId:ae.event_id,amount:ae.amount,status:ae.status,createdAt:ae.created_at,eventTitle:ge==null?void 0:ge.title,creatorUsername:Se}}))}else ee&&console.error("Error fetching bids:",ee);const{data:ne,error:he}=await ie.from("meets").select("*").eq("fan_id",C.id).in("status",["scheduled","live","completed"]);if(!he&&ne){const ve=ne.map(ue=>ue.creator_id),{data:ye}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",ve),me=new Map((ye==null?void 0:ye.map(ue=>[ue.user_id,ue]))||[]);g(ne.map(ue=>{const Fe=me.get(ue.creator_id);return{id:ue.id,eventId:ue.event_id,creatorId:ue.creator_id,creatorUsername:(Fe==null?void 0:Fe.username)||"unknown",creatorDisplayName:(Fe==null?void 0:Fe.display_name)||"Unknown",scheduledAt:ue.scheduled_at,durationMinutes:ue.duration_minutes,meetingLink:ue.meeting_link,status:ue.status}}))}else he&&console.error("Error fetching meets:",he)})()},[C]);const R=async H=>{if(!C)throw new Error("User not logged in");const J=new Date(`${H.date}T${H.time}`).toISOString(),ee=new Date(`${H.biddingDeadlineDate}T${H.biddingDeadlineTime}`).toISOString(),ne=parseInt(H.duration.replace(/\D/g,""),10)||15,{data:he,error:ve}=await ie.from("events").insert({creator_id:C.id,title:H.title,description:H.description,status:"upcoming",starts_at:J,bidding_closes_at:ee,duration_minutes:ne,base_price:H.basePrice,is_paid:H.basePrice>0,meeting_link:H.meetingLink}).select().single();if(ve)throw console.error("Error creating event:",ve),ve;const ye={id:he.id,creatorUsername:C.username.toLowerCase(),creatorDisplayName:H.creatorDisplayName,title:he.title,description:he.description,status:"Upcoming",date:Kbe(H.date,H.time),duration:H.duration,basePrice:he.base_price,currentBid:0,participants:0,endsIn:"Bid ding open",startsAt:J};return o(me=>[...me,ye]),ye},M=H=>{const J=H.trim().replace(/^@/,"").toLowerCase();return n.filter(ee=>ee.creatorUsername===J)},G=H=>{if(!C)return 0;const J=l.filter(ee=>ee.eventId===H&&ee.status==="active");return J.length===0?0:Math.max(...J.map(ee=>ee.amount))},I=async H=>{const{data:J,error:ee}=await ie.from("bids").select("id, fan_id, amount, created_at").eq("event_id",H).order("created_at",{ascending:!1}).limit(5);if(ee||!J)return console.error("Error fetching bid history:",ee),[];const ne=J.map(ue=>ue.fan_id),{data:he}=await ie.from("profiles").select("user_id, username").in("user_id",ne),ve=new Map((he==null?void 0:he.map(ue=>[ue.user_id,ue.username]))||[]),ye=J.length>0?Math.max(...J.map(ue=>ue.amount)):0,me=J.map(ue=>({id:ue.id,fanId:ue.fan_id,fanUsername:ve.get(ue.fan_id)||"Anonymous",amount:ue.amount,createdAt:ue.created_at,isCurrentLeader:ue.amount===ye}));return y(me),me},j=async(H,J)=>{if(!J||Number.isNaN(J))return;if(!C)throw console.error("User must be logged in to bid"),new Error("Please log in to place a bid");const ee=50;if(J%ee!==0)throw new Error(`Bids must be in multiples of ${ee}.`);const{data:ne,error:he}=await ie.from("events").select("id, base_price").eq("id",H).maybeSingle();if(he||!ne)throw new Error("Could not load event for bidding.");const{data:ve,error:ye}=await ie.from("bids").select("amount").eq("event_id",H).order("amount",{ascending:!1}).limit(1).maybeSingle();if(ye)throw new Error("Could not validate current bid.");const me=(ve==null?void 0:ve.amount)??0;if(me===0){if(J!==ne.base_price)throw new Error(`The first bid must be exactly ${ne.base_price}.`)}else if(J<me)throw new Error(`Your bid must be at least ${me}.`);const{error:ue}=await ie.from("bids").insert({event_id:H,fan_id:C.id,amount:J,status:"active"});if(ue)throw console.error("Error placing bid:",ue),new Error("Failed to place bid. Please try again.");o(Fe=>Fe.map(be=>{if(be.id!==H)return be;const ae=J>be.currentBid?J:be.currentBid;return{...be,currentBid:ae,participants:be.participants+1}})),await N(),await I(H)},L=async(H,J,ee)=>{if(!(!J||Number.isNaN(J)))throw C?new Error(`PAYMENT_REQUIRED:${J}:${H}`):new Error("Please log in to place a bid")},N=async()=>{if(!C)return;const{data:H}=await ie.from("bids").select("*").eq("fan_id",C.id);if(H){const J=H.map(me=>me.event_id),{data:ee}=await ie.from("events").select("id, title, creator_id").in("id",J),ne=new Map((ee==null?void 0:ee.map(me=>[me.id,me]))||[]),he=Array.from(new Set((ee??[]).map(me=>me.creator_id).filter(Boolean))),{data:ve}=he.length?await ie.from("profiles").select("user_id, username").in("user_id",he):{data:null},ye=new Map((ve??[]).map(me=>[me.user_id,me.username]));u(H.map(me=>{const ue=ne.get(me.event_id),Fe=ue?ye.get(ue.creator_id):void 0;return{id:me.id,eventId:me.event_id,amount:me.amount,status:me.status,createdAt:me.created_at,eventTitle:ue==null?void 0:ue.title,creatorUsername:Fe}}))}},D=async(H,J)=>{const{error:ee}=await ie.from("meets").update({status:J}).eq("id",H);if(ee)throw console.error("Error updating meet status:",ee),ee;await V()},V=async()=>{if(!C)return;const{data:H,error:J}=await ie.from("meets").select("*").eq("fan_id",C.id).in("status",["scheduled","live","completed"]);if(!J&&H){const ee=H.map(ve=>ve.creator_id),{data:ne}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",ee),he=new Map((ne==null?void 0:ne.map(ve=>[ve.user_id,ve]))||[]);g(H.map(ve=>{const ye=he.get(ve.creator_id);return{id:ve.id,eventId:ve.event_id,creatorId:ve.creator_id,creatorUsername:(ye==null?void 0:ye.username)||"unknown",creatorDisplayName:(ye==null?void 0:ye.display_name)||"Unknown",scheduledAt:ve.scheduled_at,durationMinutes:ve.duration_minutes,meetingLink:ve.meeting_link,status:ve.status,creatorStartedAt:ve.creator_started_at,creatorJoinedAt:ve.creator_joined_at,fanJoinedAt:ve.fan_joined_at,recordingStartedAt:ve.recording_started_at,recordingStoppedAt:ve.recording_stopped_at}}))}};O.useEffect(()=>{if(!C||C.role!=="fan")return;const H=ie.channel(`fan-meets-${C.id}`).on("postgres_changes",{event:"*",schema:"public",table:"meets",filter:`fan_id=eq.${C.id}`},J=>{console.log(" Realtime meets update for fan:",J),V()}).subscribe();return()=>{ie.removeChannel(H)}},[C]);const B=async H=>{if(!C)return;const{data:J,error:ee}=await ie.from("events").select("*").eq("id",H).single();if(ee||!J)throw console.error("Error fetching event to finalize:",ee),new Error("Event not found");const{data:ne,error:he}=await ie.from("bids").select("*").eq("event_id",H).eq("status","active").order("amount",{ascending:!1}).limit(1);if(he)throw console.error("Error fetching winning bid:",he),new Error("Could not determine winner");const ve=ne&&ne.length>0?ne[0]:null;if(!ve&&J.is_paid&&console.log("No bids for event, closing without meet."),ve){const{error:me}=await ie.from("meets").insert({event_id:H,creator_id:C.id,fan_id:ve.fan_id,scheduled_at:J.starts_at,duration_minutes:J.duration_minutes,meeting_link:J.meeting_link,status:"scheduled"});if(me)throw console.error("Error creating meet:",me),new Error("Failed to create meet")}const{error:ye}=await ie.from("events").update({status:"completed"}).eq("id",H);ye&&console.error("Error updating event status:",ye),await V()},z=O.useMemo(()=>({events:n,myBids:l,myMeets:m,bidHistory:E,isLoading:x,createEvent:R,getEventsForCreator:M,placeBid:j,placeBidWithPayment:L,updateMeetStatus:D,refreshMeets:V,getBidHistory:I,getUserCurrentBidForEvent:G,finalizeEvent:B}),[n,l,m,E,x]);return O.useEffect(()=>{if(!C||C.role!=="creator")return;const H=async()=>{const{data:ee}=await ie.from("events").select("id, title").eq("creator_id",C.id).in("status",["upcoming","live"]).lt("bidding_closes_at",new Date().toISOString());if(ee&&ee.length>0){console.log(" Auto-finalizing expired events:",ee);for(const ne of ee)try{await B(ne.id),console.log(` Auto-finalized event: ${ne.title}`)}catch(he){console.error(` Failed to auto-finalize event ${ne.id}:`,he)}}},J=setInterval(H,3e4);return H(),()=>clearInterval(J)},[C]),O.useEffect(()=>{if(!C)return;const H=async()=>{const{data:ee,error:ne}=await ie.from("meets").select("id, scheduled_at, duration_minutes").eq("status","live");if(ne||!ee)return;const he=new Date,ve=ee.filter(ye=>{const me=new Date(new Date(ye.scheduled_at).getTime()+ye.duration_minutes*60*1e3);return he>me});if(ve.length>0){console.log(" Auto-completing expired meetings:",ve.length);for(const ye of ve)await ie.from("meets").update({status:"completed"}).eq("id",ye.id);V()}},J=setInterval(H,3e4);return H(),()=>clearInterval(J)},[C]),i.jsx($H.Provider,{value:z,children:r})},Xo=()=>{const r=O.useContext($H);if(!r)throw new Error("useEvents must be used within an EventProvider");return r},Ry=20;function Ybe(){const r=Ns(),[n,o]=Gp(),{events:l,isLoading:u}=Xo(),m=n.get("q")||"",[g,E]=O.useState(parseInt(n.get("page")||"1",10)),y=O.useMemo(()=>{if(!m)return l;const I=m.toLowerCase();return l.filter(j=>{var L,N;return j.creatorDisplayName.toLowerCase().includes(I)||j.title.toLowerCase().includes(I)||((L=j.category)==null?void 0:L.toLowerCase().includes(I))||((N=j.description)==null?void 0:N.toLowerCase().includes(I))})},[l,m]),x=Math.ceil(y.length/Ry),S=(g-1)*Ry,C=y.slice(S,S+Ry),R=y.length>Ry,M=I=>{E(I);const j=new URLSearchParams(n);I>1?j.set("page",String(I)):j.delete("page"),o(j,{replace:!0}),window.scrollTo({top:0,behavior:"smooth"})},G=I=>{const j=new URLSearchParams;I&&j.set("q",I),o(j,{replace:!0}),E(1)};return u?i.jsx("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("p",{className:"text-[#6C757D]",children:"Loading events..."})]})}):i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-4",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Browse Events"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Explore live and upcoming FanMeet events."}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"This is a public browse page so fans can get a feel for the experience before creating an account. When you are ready to bid or join, you can sign up in a single step."})]}),i.jsx("section",{children:i.jsxs("div",{className:"relative max-w-md",children:[i.jsx("input",{type:"text",placeholder:"Search events or creators...",value:m,onChange:I=>G(I.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),i.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]})}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("p",{className:"text-sm text-[#6C757D]",children:[y.length," ",y.length===1?"event":"events"," found",R&&` (showing ${C.length} on page ${g})`]}),m&&i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>G(""),children:"Clear Search"})]}),i.jsx("section",{className:"grid gap-6 md:grid-cols-2",children:C.length>0?C.map(I=>i.jsxs(fe,{elevated:!0,className:"flex h-full flex-col overflow-hidden p-0 cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>r(`/events/${I.id}`),children:[i.jsx("div",{className:"relative h-36 w-full flex-shrink-0 bg-gradient-to-br from-[#FCE7FF] via-white to-[#E5DEFF]"}),i.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-6 pb-6 pt-5",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{children:[I.status==="Accepting Bids"?i.jsx("div",{className:"mb-1 inline-block rounded-[8px] bg-[#1E4620] px-2 py-1",children:i.jsx("span",{className:"text-[11px] font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx(Xe,{variant:I.status==="LIVE"?"danger":"primary",className:"mb-1 text-[11px] uppercase tracking-wide",children:I.status==="LIVE"?" Live Now":I.status}),i.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:I.creatorDisplayName}),i.jsx("div",{className:"text-sm text-[#495057]",children:I.title}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:I.category||"General"})]}),i.jsxs("div",{className:"text-right text-xs text-[#6C757D]",children:[i.jsx("div",{children:I.duration}),i.jsxs("div",{className:"mt-1",children:["Base: ",We(I.basePrice)]})]})]}),i.jsxs("div",{className:"rounded-[14px] border border-[#F4E6FF] bg-[#F8F9FA] p-4 text-sm text-[#343A40]",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Current highest bid"}),i.jsx("span",{className:"text-base font-semibold text-[#C045FF]",children:We(I.currentBid)})]}),i.jsxs("div",{className:"mt-1 text-xs text-[#6C757D]",children:[I.participants," fans bidding"]})]}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:[" ",I.date,"   ",I.endsIn]}),i.jsx(oe,{className:"mt-auto w-full bg-[#050014] text-white hover:bg-[#140423]",size:"sm",children:"View event details "})]})]},I.id)):i.jsxs("div",{className:"col-span-full text-center py-12 text-[#6C757D]",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),m?i.jsxs("p",{children:['No events found matching "',m,'"']}):i.jsx("p",{children:"No events available at the moment. Check back soon!"})]})}),x>1&&i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>M(g-1),disabled:g===1,children:" Previous"}),i.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:x},(I,j)=>j+1).map(I=>{const j=I===1||I===x||Math.abs(I-g)<=1,L=I===2&&g>3||I===x-1&&g<x-2;return!j&&!L?null:L&&!j?i.jsx("span",{className:"px-2 text-[#6C757D]",children:"..."},I):i.jsx("button",{onClick:()=>M(I),className:`min-w-[36px] rounded-lg px-3 py-2 text-sm font-medium transition-all ${g===I?"bg-[#C045FF] text-white":"bg-[#F8F9FA] text-[#6C757D] hover:bg-[#E9ECEF]"}`,children:I},I)})}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>M(g+1),disabled:g===x,children:"Next "})]}),i.jsx("section",{children:i.jsxs(fe,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx(Te,{title:"Ready to bid or join a free event?",subtitle:"Create a fan account in less than 30 seconds and keep track of all your bids and meetings."}),i.jsxs(Ee,{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Login or sign up from the top-right corner when you are ready. You can browse this page without an account."}),i.jsx(oe,{size:"sm",onClick:()=>r("/auth"),children:"Go to login / sign up"})]})]})})]})}function $be(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-4",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"How It Works"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Simple 3-step flow for fans and creators."}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"This page gives a high-level explanation of FanMeet without requiring login. Use it from marketing, ads, or the header navigation to explain the product."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"1. Pick a creator",subtitle:"Browse public events and choose the creator you want to meet."}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:"Filter by category, price, and availability. Each event clearly shows duration, base price, and current winning bid."})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"2. Bid or join",subtitle:"Place a bid for paid events or join free lucky-draw sessions."}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:"Highest bid wins the call. If you do not win, you receive up to 90% of your money back automatically."})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"3. Meet on video",subtitle:"Enjoy a live 1:1 video call from your laptop or phone."}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:"Join directly from your FanMeet dashboard at the scheduled time. No extra apps needed."})]})]}),i.jsx("section",{children:i.jsxs(fe,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx(Te,{title:"For fans and creators",subtitle:"Fans get intimate access. Creators get a new revenue stream and deeper community."}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2 text-sm text-[#6C757D]",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Fans"}),i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Bid safely with transparent pricing and refund rules."}),i.jsx("li",{children:"Win 510 minute live calls with creators you truly care about."}),i.jsx("li",{children:"Ask questions, get advice, or just share a moment."})]})]}),i.jsxs("div",{children:[i.jsx("h2",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Creators"}),i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Host live micro-meets with your most engaged supporters."}),i.jsx("li",{children:"Set your own prices and schedule, we handle payments and refunds."}),i.jsx("li",{children:"Turn superfans into long-term community members."})]})]})]})]})})]})}const Xbe=[{label:"Typical monthly earnings",value:"30k50k",note:"for active mid-sized creators"},{label:"Refund handled by FanMeet",value:"90%",note:"we manage all payment flows"},{label:"Average call length",value:"510 min",note:"short, meaningful conversations"}];function Jbe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"For Creators"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Turn your audience into premium, live 1:1 experiences."}),i.jsx("p",{className:"max-w-xl text-sm text-[#6C757D] md:text-base",children:"This is a public overview page about the creator side of FanMeet. Share it with potential creators before they sign up."})]}),i.jsx(Xe,{variant:"primary",className:"self-start md:self-auto",children:"Early creator program open"})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:Xbe.map(r=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:r.label}),i.jsxs(Ee,{className:"space-y-1 text-sm text-[#6C757D]",children:[i.jsx("div",{className:"text-xl font-semibold text-[#050014]",children:r.value}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:r.note})]})]},r.label))}),i.jsx("section",{children:i.jsxs(fe,{elevated:!0,className:"bg-[#050014] text-white",children:[i.jsx(Te,{title:"Why creators love FanMeet",subtitle:"You focus on the conversation. We handle everything else."}),i.jsxs(Ee,{className:"grid gap-4 text-sm md:grid-cols-2",children:[i.jsxs("ul",{className:"space-y-1 list-disc pl-5 text-white/80",children:[i.jsx("li",{children:"Host paid or free events for superfans."}),i.jsx("li",{children:"Flexible schedule that fits around your content calendar."}),i.jsx("li",{children:"Dashboard to track bids, winners, and upcoming calls."})]}),i.jsxs("ul",{className:"space-y-1 list-disc pl-5 text-white/80",children:[i.jsx("li",{children:"Secure payments, refunds, and payouts managed by FanMeet."}),i.jsx("li",{children:"Human review of fans and clear safety controls for calls."}),i.jsx("li",{children:"Dedicated support team for you and your community."})]})]})]})}),i.jsx("section",{children:i.jsxs(fe,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx(Te,{title:"Interested in hosting events?",subtitle:"Start by creating a creator account. You can explore the dashboard before running your first event."}),i.jsxs(Ee,{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Use the login / sign up button in the header when you are ready. Once you are in, switch to the creator panel from the role selector."}),i.jsx(oe,{size:"sm",children:"Login / Sign up"})]})]})})]})}function Qbe(){const r=Ns();return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Pricing"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Transparent pricing, low-risk bidding."}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"FanMeet uses a bidding model for paid events and a lucky draw model for free events. If you do not win a paid event, you receive an automatic refund as per our refund policy."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Paid Events (Bidding)",subtitle:"Highest bid wins a 1:1 video call."}),i.jsxs(Ee,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Base prices typically start at 50 / 100."}),i.jsx("li",{children:"Winning bid gets the scheduled call."}),i.jsx("li",{children:"Non-winning bids get an automatic refund (typically 90%)."})]}),i.jsx(oe,{size:"sm",onClick:()=>r("/browse-events"),children:"Browse Paid Events"})]})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Free Events (Lucky Draw)",subtitle:"Join for 0 and get selected randomly."}),i.jsxs(Ee,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"No payment required to participate."}),i.jsx("li",{children:"Winners are selected fairly after entry closes."}),i.jsx("li",{children:"Same 1:1 call experience as paid events."})]}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>r("/free-events"),children:"Explore Free Events"})]})]})]}),i.jsx("section",{children:i.jsxs(fe,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx(Te,{title:"Refunds",subtitle:"Built-in safety for fans."}),i.jsxs(Ee,{className:"text-sm text-[#6C757D]",children:["Read the full policy at ",i.jsx("a",{className:"underline",href:"/refund-policy",children:"/refund-policy"}),"."]})]})})]})}const Zbe=[{category:"Fans",q:"What if I don't win the bid?",a:"You automatically receive a refund as per our Refund Policy. Typically non-winning bids receive 90% back."},{category:"Fans",q:"How do I join a call?",a:"If you win, you can join directly from your dashboard at the scheduled time. No extra apps needed."},{category:"Creators",q:"How do payouts work?",a:"Creators keep 90% of winning bids (platform fee 10%). Payouts are available after clearance and processed via bank/UPI."},{category:"Creators",q:"How do I get approved as a creator?",a:"Apply through the creator program. Our team verifies identity and social presence before approval."}];function ewe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-6 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"FAQs"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Frequently asked questions"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Answers for fans and creators. If your question isnt listed, visit Help Center or Contact Us."})]}),i.jsx("section",{className:"grid gap-4",children:Zbe.map(r=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:r.q,subtitle:r.category}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:r.a})]},`${r.category}-${r.q}`))})]})}function twe(){const r=Ns();return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Free Events"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"0 lucky draw events"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Join free creator events with zero payment. Winners are chosen randomly after entries close."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"How it works",subtitle:"Fair selection, simple participation."}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Select a free event and join the draw."}),i.jsx("li",{children:"Wait for entries to close."}),i.jsx("li",{children:"A winner is selected randomly and notified."}),i.jsx("li",{children:"If selected, you join the call at the scheduled time."})]})})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Want more chances?",subtitle:"Paid events are bidding-based."}),i.jsxs(Ee,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsx("p",{children:"Paid events let you bid to increase your chance of winning."}),i.jsx(oe,{size:"sm",onClick:()=>r("/browse-events"),children:"Browse Events"})]})]})]})]})}function swe(){const r=Ns();return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Apply Now"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Become a verified creator on FanMeet"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Submit your creator profile, complete verification, and start hosting paid or free events."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Eligibility",subtitle:"Who can apply?"}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Creators with a real audience (recommended 1,000+ followers) or a valuable skill."}),i.jsx("li",{children:"Valid identity verification (KYC) and a payout method (bank/UPI)."}),i.jsx("li",{children:"Willingness to follow safety and community guidelines."})]})})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"How to apply",subtitle:"It takes a few minutes."}),i.jsxs(Ee,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsxs("ol",{className:"list-decimal space-y-1 pl-5",children:[i.jsx("li",{children:"Create an account."}),i.jsx("li",{children:"Select role: Creator."}),i.jsx("li",{children:"Complete profile setup and submit for approval."}),i.jsx("li",{children:"Wait for verification status."})]}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{size:"sm",onClick:()=>r("/auth"),children:"Sign up / Login"}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>r("/for-creators"),children:"Learn more"})]})]})]})]})]})}function rwe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Creator Guide"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"How to run great FanMeet sessions"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"A simple guide to help creators deliver high-quality, safe, and consistent fan experiences."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Before your event"}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Ensure stable internet and a quiet environment."}),i.jsx("li",{children:"Confirm your event title, duration, and time."}),i.jsx("li",{children:"Set expectations in the description (topics, rules)."})]})})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"During the call"}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Start on time and keep the conversation friendly."}),i.jsx("li",{children:"Do not share personal contact details."}),i.jsx("li",{children:"End the call immediately if the fan is abusive."})]})})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"After the call"}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Mark the meet status correctly in the dashboard."}),i.jsx("li",{children:"Withdraw earnings after clearance (as applicable)."}),i.jsx("li",{children:"Report issues via Support."})]})})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Payout readiness"}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Complete profile approval (verified status)."}),i.jsx("li",{children:"Add bank/UPI details in Settings."}),i.jsx("li",{children:"Keep KYC details accurate to avoid payout delays."})]})})]})]})]})}function nwe(){const[r,n]=O.useState("500"),[o]=O.useState(10),{gross:l,fee:u,net:m}=O.useMemo(()=>{const g=Math.max(parseInt(r||"0",10)||0,0),E=Math.floor(g*o/100),y=Math.max(g-E,0);return{gross:g,fee:E,net:y}},[o,r]);return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Earnings Calculator"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Estimate your creator earnings"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Estimate net earnings after the platform fee. This is a simple estimate and may not include payment gateway fees or taxes."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Calculator",subtitle:"Try different winning bid amounts."}),i.jsxs(Ee,{className:"space-y-4",children:[i.jsx(tt,{label:"Winning bid amount ()",type:"number",min:0,value:r,onChange:g=>n(g.target.value)}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs(Xe,{variant:"primary",children:["Platform fee: ",o,"%"]}),i.jsxs(Xe,{variant:"success",children:["Net: ",m]})]}),i.jsxs("div",{className:"text-sm text-[#6C757D]",children:["Gross ",l,"  Fee ",u,"  Net ",m]})]})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Payout notes",subtitle:"When can creators withdraw?"}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Creators must be approved (verified) to withdraw."}),i.jsx("li",{children:"Add bank/UPI details in Settings before withdrawal."}),i.jsx("li",{children:"Earnings may be released after meet completion and clearance window."})]})})]})]})]})}const iwe=[{title:"From Fan to Friend",body:"A fan won a call, got streaming tips, and became a familiar face in the creators community."},{title:"Career-Changing Advice",body:"A short 10-minute call helped a fan gain clarity and take action with confidence."},{title:"A Gift That Made Her Cry",body:"A meaningful birthday call turned into a memory that lasted far longer than any material gift."}];function awe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Success Stories"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Stories from fans and creators"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Real outcomes from short conversations."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:iwe.map(r=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:r.title}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:r.body})]},r.title))})]})}function owe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"About"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"About FanMeet"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"FanMeet is an India-first platform for live 1:1 video calls between fans and verified creators. We make it simple, safe, and transparent through auctions (paid events) and lucky draws (free events)."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Our mission"}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:"Help fans build real connections with creators they admire, while helping creators earn fairly and grow stronger communities."})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Trust & safety"}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:"Creators are human-verified. Payments are secure via Razorpay. Refunds are automatic based on policy."})]})]})]})}const cwe=[{name:"Arjun Singh",role:"Founder",initials:"AS"},{name:"Priya Mehta",role:"Co-Founder",initials:"PM"},{name:"Rahul Verma",role:"Tech Lead",initials:"RV"},{name:"Neha Kapoor",role:"Customer Support",initials:"NK"},{name:"Amit Gupta",role:"Marketing",initials:"AG"},{name:"Sneha Sharma",role:"Operations",initials:"SS"}];function lwe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Team"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Our Team"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Were a small team based in India building reliable creator-fan experiences."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:cwe.map(r=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:r.name,subtitle:r.role}),i.jsxs(Ee,{className:"flex items-center gap-3",children:[i.jsx(yi,{initials:r.initials,size:"md"}),i.jsx("div",{className:"text-sm text-[#6C757D]",children:"Building FanMeet"})]})]},r.name))})]})}const dwe=[{title:"Press kit",desc:"Logos, screenshots, and basic product info.",href:"#"},{title:"Media inquiries",desc:"Write to press@fanmeet.live",href:"mailto:press@fanmeet.live"}];function uwe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Press & Media"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Press & Media"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"For press inquiries and brand assets."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-2",children:dwe.map(r=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:r.title,subtitle:r.desc}),i.jsx(Ee,{children:i.jsx("a",{className:"inline-flex h-9 items-center justify-center rounded-[10px] border border-[#E9ECEF] bg-white px-4 text-sm font-semibold text-[#050014] hover:bg-[#F8F9FA]",href:r.href,children:"Open"})})]},r.title))})]})}const hwe=[{title:"Full-stack Engineer",location:"Remote / India",type:"Full-time"},{title:"Creator Partnerships",location:"Bangalore / Hybrid",type:"Full-time"},{title:"Support Associate",location:"Remote / India",type:"Part-time"}];function pwe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Careers"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Were hiring"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Join the team building Indias most trusted creator-fan marketplace."})]}),i.jsx("section",{className:"grid gap-4",children:hwe.map(r=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:r.title,subtitle:r.location}),i.jsxs(Ee,{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsx(Xe,{variant:"primary",children:r.type}),i.jsx("a",{className:"inline-flex h-9 items-center justify-center rounded-[10px] bg-[#C045FF] px-4 text-sm font-semibold text-white hover:opacity-90",href:"mailto:careers@fanmeet.live?subject=Job%20Application",children:"Apply via Email"})]})]},r.title))})]})}const mwe=[{title:"Why live 1:1 beats DMs",date:"Dec 2024",excerpt:"Real conversations, real community."},{title:"Creator safety on FanMeet",date:"Dec 2024",excerpt:"How we review creators and protect fans."},{title:"Understanding our refund rules",date:"Dec 2024",excerpt:"Transparent refunds that keep bidding low-risk."}];function fwe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Blog"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"FanMeet Blog"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Updates, guides, and product stories."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-2",children:mwe.map(r=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:r.title,subtitle:r.date}),i.jsx(Ee,{className:"text-sm text-[#6C757D]",children:r.excerpt})]},r.title))})]})}const gwe=[{title:"Payments & bids",desc:"How bidding works, charges, and refunds.",to:"/pricing"},{title:"Creator approval",desc:"Verification process and common issues.",to:"/apply"},{title:"Refund policy",desc:"Read the complete refund policy.",to:"/refund-policy"},{title:"Contact support",desc:"Reach us for unresolved issues.",to:"/contact"}];function _we(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Help Center"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Help Center"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Quick answers and support resources."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-2",children:gwe.map(r=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:r.title,subtitle:r.desc}),i.jsx(Ee,{children:i.jsx("a",{className:"inline-flex h-9 items-center justify-center rounded-[10px] border border-[#E9ECEF] bg-white px-4 text-sm font-semibold text-[#050014] hover:bg-[#F8F9FA]",href:r.to,children:"Open"})})]},r.title))})]})}const vwe=[{value:"all",label:"All Events",emoji:""},{value:"entertainment",label:"Entertainment",emoji:""},{value:"music",label:"Music",emoji:""},{value:"education",label:"Education",emoji:""},{value:"fitness",label:"Fitness",emoji:""},{value:"gaming",label:"Gaming",emoji:""},{value:"lifestyle",label:"Lifestyle",emoji:""},{value:"general",label:"General",emoji:""}],Ewe=[{value:"popular",label:"Most Popular"},{value:"ending-soon",label:"Ending Soon"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"},{value:"newest",label:"Newly Added"}];function ywe(){const r=Ns(),[n]=Gp(),{events:o,myBids:l}=Xo(),[u,m]=O.useState("all"),[g,E]=O.useState("popular"),[y,x]=O.useState(n.get("q")||"");O.useEffect(()=>{const I=n.get("q");I!==null&&I!==y&&x(I)},[n]);const S=O.useMemo(()=>[...o.filter(L=>{var N;if(u!=="all"&&L.category!==u)return!1;if(y){const D=y.toLowerCase();return L.title.toLowerCase().includes(D)||L.creatorDisplayName.toLowerCase().includes(D)||((N=L.description)==null?void 0:N.toLowerCase().includes(D))}return!0})].sort((L,N)=>{switch(g){case"popular":return N.participants-L.participants;case"price-low":return L.basePrice-N.basePrice;case"price-high":return N.basePrice-L.basePrice;case"newest":return N.id.localeCompare(L.id);case"ending-soon":const D=V=>V.includes("Closed")?999999:V.includes("days")?parseInt(V)*24*60:V.includes("hours")?parseInt(V)*60:V.includes("minutes")?parseInt(V):0;return D(L.endsIn)-D(N.endsIn);default:return 0}}),[o,u,g,y]),C=20,R=S.length>C,M=S.slice(0,C),G=O.useMemo(()=>{const I=l.length,j=l.filter(D=>D.status==="won").length,L=I>0?Math.round(j/I*100):0,N=l.filter(D=>D.status==="lost").reduce((D,V)=>D+Math.floor(V.amount*.9),0);return[{id:"stat-1",label:"Bids placed",value:String(I),hint:`${l.filter(D=>D.status==="active"||D.status==="outbid").length} active`},{id:"stat-2",label:"Win rate",value:`${L}%`,hint:`${j} wins out of ${I}`},{id:"stat-3",label:"Refunds received",value:We(N),hint:"90% back on lost bids"},{id:"stat-4",label:"Meets completed",value:String(j),hint:`Across ${new Set(l.filter(D=>D.status==="won").map(D=>D.creatorUsername)).size} creators`}]},[l]);return i.jsxs("div",{className:"flex flex-col gap-8 overflow-x-hidden",children:[i.jsx(fe,{elevated:!0,className:"overflow-hidden border-none bg-gradient-to-r from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] shadow-[0_24px_60px_rgba(160,64,255,0.18)]",children:i.jsxs("div",{className:"relative flex flex-col gap-6 px-4 py-6 md:flex-row md:items-center md:px-8 md:py-8",children:[i.jsxs("div",{className:"max-w-xl space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Browse Events"}),i.jsx("h1",{className:"text-xl font-semibold text-[#050014] md:text-3xl",children:"Find a live FanMeet that matches your vibe."}),i.jsx("p",{className:"text-sm text-[#4B445F]",children:"Browse, bid, and secure your spot with your favorite creators in small, exclusive meetups."})]}),i.jsx("div",{className:"flex-shrink-0 text-5xl md:text-7xl",children:""})]})}),i.jsx(fe,{children:i.jsxs(Ee,{className:"gap-6",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Search events or creators...",value:y,onChange:I=>x(I.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),i.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]}),i.jsxs("div",{className:"overflow-x-hidden",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Categories"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:vwe.map(I=>i.jsxs("button",{onClick:()=>m(I.value),className:`flex-shrink-0 rounded-full border-2 px-3 py-1.5 text-xs font-medium transition-all md:px-4 md:py-2 md:text-sm ${u===I.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:[i.jsx("span",{className:"mr-1",children:I.emoji}),I.label]},I.value))})]}),i.jsxs("div",{className:"overflow-x-hidden",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Sort By"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:Ewe.map(I=>i.jsx("button",{onClick:()=>E(I.value),className:`flex-shrink-0 whitespace-nowrap rounded-full border-2 px-3 py-1.5 text-xs font-medium transition-all md:px-4 md:py-2 md:text-sm ${g===I.value?"border-[#C045FF] bg-[#C045FF] text-white":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:I.label},I.value))})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[i.jsxs("h2",{className:"text-xl font-semibold text-[#212529]",children:[S.length," ",S.length===1?"Event":"Events"," Found",R&&i.jsxs("span",{className:"ml-2 text-sm font-normal text-[#6C757D]",children:["(showing ",M.length,")"]})]}),R&&i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r("/fan/all-events"),children:"View All Events "})]}),M.length===0?i.jsx(fe,{children:i.jsxs(Ee,{className:"py-12 text-center",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),i.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Try adjusting your filters or search query"}),i.jsx(oe,{onClick:()=>{m("all"),x("")},children:"Clear Filters"})]})}):i.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:M.map(I=>i.jsx(fe,{className:"group cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>r(`/events/${I.id}`),children:i.jsxs(Ee,{className:"gap-4",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"mb-1 text-xs text-[#6C757D]",children:I.creatorDisplayName}),i.jsx("h3",{className:"text-base font-semibold text-[#212529] group-hover:text-[#C045FF]",children:I.title})]}),I.status==="Accepting Bids"?i.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:i.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx(Xe,{variant:I.status==="LIVE"?"danger":"primary",children:I.status})]}),I.description&&i.jsx("p",{className:"line-clamp-2 text-sm text-[#6C757D]",children:I.description}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Current Bid"}),i.jsx("div",{className:"font-semibold text-[#C045FF]",children:We(I.currentBid)})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Base Price"}),i.jsx("div",{className:"font-semibold text-[#212529]",children:We(I.basePrice)})]})]}),i.jsxs("div",{className:"flex items-center justify-between border-t border-[#E9ECEF] pt-3 text-xs text-[#6C757D]",children:[i.jsxs("span",{children:[" ",I.participants," bidding"]}),i.jsxs("span",{children:[" ",I.endsIn]})]}),i.jsx(oe,{className:"w-full",size:"sm",children:"View & Bid "})]})},I.id))}),R&&M.length>0&&i.jsx(fe,{className:"mt-6 border-dashed border-2 border-[#C045FF]/30 bg-gradient-to-r from-[#FCE7FF]/50 via-white to-[#E5DEFF]/50",children:i.jsxs(Ee,{className:"py-8 text-center",children:[i.jsx("div",{className:"text-4xl mb-3",children:""}),i.jsxs("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:[S.length-M.length," more events available"]}),i.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Explore all events to find the perfect creator meet for you"}),i.jsx(oe,{onClick:()=>r("/fan/all-events"),children:"Browse All Events "})]})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Your Activity",subtitle:"Track your bidding performance"}),i.jsx(Ee,{children:i.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:G.map(I=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-gradient-to-br from-[#F8F9FA] to-white p-4",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:I.label}),i.jsx("div",{className:"mt-1 text-2xl font-bold text-[#212529]",children:I.value}),i.jsx("div",{className:"mt-1 text-xs text-[#6C757D]",children:I.hint})]},I.id))})})]})]})}function xwe(){const{myBids:r,events:n}=Xo(),o=Ns(),l=r.filter(g=>g.status==="active"||g.status==="outbid"),u=r.filter(g=>g.status==="won"||g.status==="lost"||g.status==="cancelled"),m=g=>n.find(E=>E.id===g);return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Bids"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track your bidding activity and results."})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Active Bids",subtitle:"Stay on top of the events you are currently bidding on"}),i.jsx(Ee,{className:"gap-6",children:l.length===0?i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-8 text-center",children:[i.jsx("p",{className:"text-sm text-[#6C757D]",children:"You don't have any active bids."}),i.jsx(oe,{className:"mt-4",onClick:()=>o("/fan"),children:"Browse Events"})]}):l.map(g=>{const E=m(g.eventId),y=g.status==="outbid";return i.jsxs("div",{className:`grid gap-3 rounded-[16px] border p-4 md:grid-cols-[1.5fr_1fr_auto] md:items-center ${y?"border-[#FFC107] bg-[#FFF9E6]":"border-[#E9ECEF] bg-[#F8F9FA]"}`,children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-[#6C757D]",children:(E==null?void 0:E.creatorDisplayName)||"Unknown Creator"}),i.jsx("div",{className:"text-base font-semibold text-[#212529]",children:g.eventTitle||"Event"}),y&&i.jsx(Xe,{variant:"danger",className:"mt-1",children:" You've been outbid!"}),(E==null?void 0:E.status)==="Accepting Bids"&&!y&&i.jsx("div",{className:"mt-1 inline-flex rounded-[8px] bg-[#1E4620] px-2 py-0.5",children:i.jsx("span",{className:"text-[10px] font-semibold text-[#4ADE80]",children:" Accepting Bids"})})]}),i.jsxs("div",{className:"grid gap-1 text-sm text-[#6C757D] md:justify-items-end",children:[i.jsxs("span",{children:["Your Bid: ",i.jsx("strong",{className:"text-[#212529]",children:We(g.amount)})]}),E&&i.jsxs(i.Fragment,{children:[i.jsxs("span",{children:["Current: ",i.jsx("strong",{className:"text-[#C045FF]",children:We(E.currentBid)})]}),i.jsxs("span",{children:[" ",E.endsIn]})]})]}),i.jsxs("div",{className:"flex gap-2 md:justify-end",children:[i.jsx(oe,{size:"sm",variant:y?"primary":"secondary",onClick:()=>o(`/events/${g.eventId}`),children:y?"Increase Bid Now":"Increase Bid"}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>o(`/events/${g.eventId}`),children:"Details "})]})]},g.id)})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Bid Results"}),i.jsx(Ee,{className:"overflow-x-auto",children:u.length===0?i.jsx("div",{className:"py-8 text-center text-sm text-[#6C757D]",children:"No past bid results yet."}):i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Your Bid"}),i.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Result"})]})}),i.jsx("tbody",{className:"text-[#212529]",children:u.map(g=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:g.creatorUsername||"Unknown"}),i.jsx("td",{className:"py-3",children:g.eventTitle||"Event"}),i.jsx("td",{className:"py-3",children:We(g.amount)}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:g.status==="won"?"success":"danger",children:g.status==="won"?" Won":g.status==="lost"?" Lost":"Cancelled"})})]},g.id))})]})})]})]})}function bwe(r){const n=new Date(r),o=new Date,l=n.getTime()-o.getTime();if(l<=0)return"Starting soon";const u=Math.floor(l/(1e3*60)),m=Math.floor(u/60),g=Math.floor(m/24),E=u%60;if(g>0){const y=m%24;return`${g} day${g>1?"s":""}${y>0?` ${y} hr${y>1?"s":""}`:""}`}return m>0?`${m} hr${m>1?"s":""}${E>0?` ${E} min`:""}`:`${E} min`}function wwe(){const{myMeets:r}=Xo(),n=Ns(),[o,l]=O.useState([]),[u,m]=O.useState(!0),g=r.filter(x=>x.status==="scheduled"||x.status==="live"||x.status==="completed"||x.status==="cancelled"||x.status==="cancelled_no_show_creator").sort((x,S)=>{if(x.status==="live"&&S.status!=="live")return-1;if(S.status==="live"&&x.status!=="live")return 1;const C=new Date,R=new Date(x.scheduledAt),M=new Date(S.scheduledAt),G=x.status==="scheduled"&&R.getTime()-C.getTime()<=24*60*60*1e3&&R>C,I=S.status==="scheduled"&&M.getTime()-C.getTime()<=24*60*60*1e3&&M>C;if(G&&!I)return-1;if(I&&!G)return 1;const j={live:0,scheduled:1,completed:2,cancelled:3,cancelled_no_show_creator:3},L=(j[x.status]||4)-(j[S.status]||4);return L!==0?L:R.getTime()-M.getTime()});g.filter(x=>x.status==="live"),g.filter(x=>x.status==="scheduled"),g.filter(x=>x.status==="completed"),O.useEffect(()=>{(async()=>{try{const{data:S,error:C}=await ie.from("events").select("id, title, status, starts_at, base_price, description").in("status",["upcoming","live","completed"]).order("starts_at",{ascending:!0});if(C){console.error("Error fetching events:",C),m(!1);return}if(S){const R=S.map(j=>j.id),{data:M}=await ie.from("bids").select("event_id").in("event_id",R),G=new Map;M==null||M.forEach(j=>G.set(j.event_id,!0));const I=S.filter(j=>!G.has(j.id));l(I)}}catch(S){console.error("Error fetching events with no bids:",S)}finally{m(!1)}})()},[]);const E=x=>{x&&navigator!=null&&navigator.clipboard&&navigator.clipboard.writeText(x)},y=x=>{x&&window.open(x,"_blank","noopener,noreferrer")};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Upcoming Meets"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Access your confirmed sessions and join on time."})]}),g.length===0?i.jsx(fe,{elevated:!0,className:"grid min-h-[320px] place-items-center text-center",children:i.jsxs("div",{className:"flex flex-col items-center gap-3",children:[i.jsx("span",{className:"text-5xl",children:""}),i.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:"No meets yet"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Win an event to see your meeting details right here."}),i.jsx(oe,{children:"Browse Events "})]})}):i.jsxs(fe,{elevated:!0,className:"border-l-4 border-[#28A745]",children:[i.jsx(Te,{title:" You Won!",subtitle:"Get ready for your upcoming 1-on-1 session",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(Ee,{className:"gap-6",children:g.map(x=>{const S=new Date,C=new Date(x.scheduledAt),R=x.status==="scheduled"&&C.getTime()-S.getTime()<=24*60*60*1e3&&C>S;return i.jsxs("div",{className:`grid gap-4 md:grid-cols-[auto_1fr] md:gap-6 ${R?"rounded-lg border-2 border-[#FF6B35] bg-[#FFF5F0] p-4 -mx-4":""}`,children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(Xe,{variant:x.status==="live"?"success":x.status==="completed"?"default":x.status==="cancelled"||x.status==="cancelled_no_show_creator"?"danger":"primary",className:`w-fit px-4 py-2 text-sm ${x.status==="live"?"animate-pulse":""}`,children:x.status==="live"?" LIVE - Creator is waiting!":x.status==="completed"?" Completed":x.status==="cancelled_no_show_creator"?" Creator No-Show":x.status==="cancelled"?" Cancelled":"Scheduled"}),R&&i.jsx(Xe,{variant:"danger",className:"w-fit px-3 py-1 text-xs animate-pulse",children:" Starting Soon!"})]}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsxs("div",{children:[i.jsxs("h3",{className:"text-xl font-semibold text-[#212529]",children:["Meeting with ",x.creatorDisplayName||x.creatorUsername]}),i.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:[i.jsxs("div",{className:`flex items-center gap-2 rounded-lg px-3 py-2 ${R?"bg-[#FF6B35] text-white":"bg-[#F4E6FF] text-[#C045FF]"}`,children:[i.jsx("span",{className:"text-lg",children:""}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xs font-medium opacity-90",children:"Date & Time"}),i.jsx("span",{className:"text-sm font-bold",children:Gt(x.scheduledAt)})]})]}),i.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-[#E5DEFF] px-3 py-2 text-[#7B2CBF]",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xs font-medium opacity-90",children:"Duration"}),i.jsxs("span",{className:"text-sm font-bold",children:[x.durationMinutes," minutes"]})]})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{className:"flex flex-col gap-2 rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Meeting Link"}),i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx("span",{className:"break-all text-sm text-[#212529]",children:x.meetingLink||"Link not available yet"}),x.meetingLink&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>E(x.meetingLink),children:"Copy"})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[x.status!=="completed"&&x.status!=="cancelled"&&x.status!=="cancelled_no_show_creator"&&i.jsx(oe,{variant:"secondary",children:"Add to Calendar"}),i.jsx("button",{disabled:!x.meetingLink||x.status==="completed"||x.status==="cancelled"||x.status==="cancelled_no_show_creator",onClick:()=>y(x.meetingLink),className:`
                          relative rounded-full px-8 py-3 text-base font-semibold transition-all
                          ${!x.meetingLink||x.status==="completed"||x.status==="cancelled"||x.status==="cancelled_no_show_creator"?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white text-[#050014] shadow-lg hover:shadow-xl transform hover:scale-105"}
                        `,style:x.meetingLink&&x.status!=="completed"&&x.status!=="cancelled"&&x.status!=="cancelled_no_show_creator"?{background:"linear-gradient(white, white) padding-box, linear-gradient(135deg, #A78BFA, #C084FC, #E0E7FF) border-box",border:"2px solid transparent"}:void 0,children:x.status==="completed"?"Meeting Ended":x.status==="cancelled_no_show_creator"?"Creator No-Show":x.status==="cancelled"?"Meeting Cancelled":"Join Meeting "})]}),x.status!=="completed"&&x.status!=="cancelled"&&x.status!=="cancelled_no_show_creator"?i.jsxs("span",{className:`text-sm font-medium ${R?"text-[#FF6B35]":"text-[#6C757D]"}`,children:[" Starts in:"," ",i.jsx("strong",{className:R?"text-[#FF6B35]":"text-[#C045FF]",children:bwe(x.scheduledAt)})]}):x.status==="completed"?i.jsx("span",{className:"text-sm text-[#6C757D]",children:" This meeting has been completed"}):i.jsx("span",{className:"text-sm text-[#6C757D]",children:x.status==="cancelled_no_show_creator"?" Creator didn't show up - Full refund issued to your wallet":" This meeting was cancelled"})]})]})]},x.id)})})]}),u?i.jsx(fe,{children:i.jsx(Ee,{className:"py-8 text-center",children:i.jsx("div",{className:"text-sm text-[#6C757D]",children:"Loading events..."})})}):o.length>0?i.jsxs(fe,{children:[i.jsx(Te,{title:"Events with No Bids",subtitle:"Events that ended without any bids placed.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(Ee,{className:"gap-4",children:[o.slice(0,10).map(x=>i.jsxs("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[#E9ECEF] bg-white p-4 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>x.status!=="completed"&&n(`/events/${x.id}`),children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:x.status==="completed"?"default":"primary",children:x.status==="completed"?" Completed - No Bids":" No Bids Yet"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[x.status==="completed"?"Ended":"Starts"," ",Gt(x.starts_at)]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:x.title}),x.description&&i.jsx("p",{className:"text-sm text-[#6C757D] mt-1 line-clamp-2",children:x.description})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Base Price"}),i.jsx("div",{className:"font-semibold text-[#C045FF]",children:We(x.base_price)})]}),i.jsx(oe,{size:"sm",disabled:x.status==="completed",children:x.status==="completed"?"Event Ended":"View & Bid "})]})]},x.id)),o.length>10&&i.jsx("div",{className:"text-center",children:i.jsx(oe,{variant:"secondary",onClick:()=>n("/fan"),children:"View More Events "})})]})]}):null]})}function Swe(){const{user:r}=vs(),[n,o]=O.useState(!0),[l,u]=O.useState([]),[m,g]=O.useState({totalPaid:0,totalRefunded:0});O.useEffect(()=>{(async()=>{if(!r){u([]),o(!1);return}o(!0);try{const{data:x,error:S}=await ie.from("payments").select("id, amount, status, type, description, created_at").eq("user_id",r.id).order("created_at",{ascending:!1}).limit(50);S&&console.error("Error fetching payments:",S);const{data:C}=await ie.from("bids").select("id, amount, status, created_at, event_id").eq("fan_id",r.id).order("created_at",{ascending:!1}).limit(50),R=(C==null?void 0:C.map(N=>N.event_id))||[],{data:M}=R.length>0?await ie.from("events").select("id, title").in("id",R):{data:[]},G=new Map((M==null?void 0:M.map(N=>[N.id,N.title]))||[]),I=[];if(x)for(const N of x)I.push({id:N.id,date:new Date(N.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:N.description||(N.type==="refund"?"Refund":"Payment"),amount:N.amount,type:N.type==="refund"?"credit":"debit",status:N.status});if(C)for(const N of C){const D=G.get(N.event_id)||"Event",V=N.status==="refunded"||N.status==="lost";I.push({id:`bid-${N.id}`,date:new Date(N.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:`Bid on "${D}"`,amount:N.amount,type:"debit",status:N.status==="won"?"completed":N.status==="active"?"pending":"completed"}),V&&I.push({id:`refund-${N.id}`,date:new Date(N.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:`Refund for "${D}" (Auto-refund)`,amount:Math.floor(N.amount*.9),type:"credit",status:"refunded"})}I.sort((N,D)=>new Date(D.date).getTime()-new Date(N.date).getTime());const j=I.filter(N=>N.type==="debit"&&N.status!=="failed").reduce((N,D)=>N+D.amount,0),L=I.filter(N=>N.type==="credit").reduce((N,D)=>N+D.amount,0);u(I),g({totalPaid:j,totalRefunded:L})}finally{o(!1)}})()},[r]);const E=(y,x)=>{if(x==="credit")return i.jsx(Xe,{variant:"success",children:"Refunded"});switch(y){case"completed":return i.jsx(Xe,{variant:"success",children:"Completed"});case"pending":return i.jsx(Xe,{variant:"warning",children:"Pending"});case"failed":return i.jsx(Xe,{variant:"danger",children:"Failed"});default:return i.jsx(Xe,{variant:"primary",children:y})}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Payment History"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"View all your payments and refunds. Auto-refunds are processed for unsuccessful bids."})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 max-w-2xl",children:[i.jsx(fe,{elevated:!0,children:i.jsxs(Ee,{className:"p-4",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Paid"}),i.jsx("div",{className:"mt-1 text-2xl font-bold text-[#212529]",children:n?"...":We(m.totalPaid)}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:"All-time bid payments"})]})}),i.jsx(fe,{elevated:!0,children:i.jsxs(Ee,{className:"p-4",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunded"}),i.jsx("div",{className:"mt-1 text-2xl font-bold text-green-600",children:n?"...":We(m.totalRefunded)}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Auto-refunds (90% of bid amount)"})]})})]}),i.jsx(fe,{className:"max-w-2xl bg-[#F0FDF4] border-green-200",children:i.jsx(Ee,{className:"p-4",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-xl",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-semibold text-green-800",children:"Auto-Refund System Active"}),i.jsx("div",{className:"text-sm text-green-700",children:"If you don't win an event, 90% of your bid amount is automatically refunded to your original payment method within 5-7 business days."})]})]})})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Transaction History",subtitle:"All payments and refunds"}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Date"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Description"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Type"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Status"})]})}),i.jsx("tbody",{className:"text-[#212529]",children:n?i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-sm text-[#6C757D]",children:"Loading payment history..."})}):l.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-sm text-[#6C757D]",children:"No payments yet. Place a bid on an event to get started!"})}):l.map(y=>i.jsxs("tr",{className:"border-b border-[#E9ECEF] hover:bg-[#F8F9FA]",children:[i.jsx("td",{className:"py-3 px-2 whitespace-nowrap",children:y.date}),i.jsx("td",{className:"py-3 px-2",children:y.description}),i.jsx("td",{className:"py-3 px-2",children:i.jsxs("span",{className:y.type==="credit"?"text-green-600 font-semibold":"text-[#212529]",children:[y.type==="credit"?"+":"-",We(y.amount)]})}),i.jsx("td",{className:"py-3 px-2",children:i.jsx(Xe,{variant:y.type==="credit"?"success":"primary",children:y.type==="credit"?"Credit":"Debit"})}),i.jsx("td",{className:"py-3 px-2",children:E(y.status,y.type)})]},y.id))})]})})]})]})}function Cwe(){const{user:r}=vs(),n=Ns(),[o,l]=O.useState([]),[u,m]=O.useState(!0);return O.useEffect(()=>{async function g(){if(r)try{const{data:E,error:y}=await ie.from("creator_follows").select("creator_id").eq("fan_id",r.id);if(y)throw y;if(E&&E.length>0){const x=E.map(R=>R.creator_id),{data:S,error:C}=await ie.from("profiles").select("*").in("user_id",x);if(C)throw C;S&&l(S)}else l([])}catch(E){console.error("Error fetching following:",E)}finally{m(!1)}}g()},[r]),u?i.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading..."}):i.jsxs("div",{className:"mx-auto flex max-w-4xl flex-col gap-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Following"}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"Creators you follow. Join their upcoming events faster from here."})]}),i.jsxs("div",{className:"space-y-4",children:[o.map(g=>{var E,y;return i.jsx(fe,{elevated:!0,className:"border-none bg-white/95",children:i.jsxs(Ee,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[i.jsx("div",{className:"flex flex-col gap-1",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(yi,{src:g.avatar_url,initials:((E=g.display_name)==null?void 0:E.charAt(0))||((y=g.username)==null?void 0:y.charAt(0)),size:"md"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:g.display_name||g.username}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",g.username]})]})]})}),i.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[i.jsx(Xe,{variant:"primary",children:"Following"}),i.jsx("div",{className:"flex gap-2",children:i.jsx(oe,{size:"sm",className:"rounded-full",onClick:()=>n(`/${g.username}`),children:"View profile"})})]})]})},g.user_id)}),o.length===0&&i.jsx(fe,{children:i.jsx(Ee,{children:i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Youre not following any creators yet. Start by placing a bid or hitting follow on a creator profile."})})})]})]})}const Twe={active:"primary",lost:"danger",won:"success"};function Nwe(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(!0);return O.useEffect(()=>{(async()=>{if(r)try{const{data:y,error:x}=await ie.from("meets").select(`
            id,
            scheduled_at,
            status,
            event_id,
            creator_id
          `).eq("fan_id",r.id).eq("status","completed").order("scheduled_at",{ascending:!1});if(x)throw x;const S=await Promise.all((y||[]).map(async G=>{const{data:I}=await ie.from("events").select("title").eq("id",G.event_id).single(),{data:j}=await ie.from("profiles").select("display_name").eq("user_id",G.creator_id).single(),{data:L}=await ie.from("bids").select("amount").eq("event_id",G.event_id).eq("bidder_id",r.id).eq("status","won").single();return{id:G.id,creator_name:(j==null?void 0:j.display_name)||"Unknown Creator",event_title:(I==null?void 0:I.title)||"Unknown Event",scheduled_at:G.scheduled_at,amount:(L==null?void 0:L.amount)||0,status:G.status}}));o(S);const{data:C,error:R}=await ie.from("bids").select(`
            id,
            amount,
            status,
            created_at,
            event_id
          `).eq("bidder_id",r.id).eq("status","active").order("created_at",{ascending:!1});if(R)throw R;const M=await Promise.all((C||[]).map(async G=>{const{data:I}=await ie.from("events").select("title, creator_id").eq("id",G.event_id).single();let j="Unknown Creator";if(I!=null&&I.creator_id){const{data:L}=await ie.from("profiles").select("display_name").eq("user_id",I.creator_id).single();j=(L==null?void 0:L.display_name)||"Unknown Creator"}return{id:G.id,creator_name:j,event_title:(I==null?void 0:I.title)||"Unknown Event",created_at:G.created_at,amount:G.amount,status:G.status}}));u(M)}catch(y){console.error("Error fetching history:",y)}finally{g(!1)}})()},[r]),m?i.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading history..."}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"History"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Catch up on your past sessions and keep tabs on upcoming requests."})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Past Experiences",subtitle:"Rate your meets and revisit standout memories.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(Ee,{className:"gap-6",children:n.length===0?i.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No past meets yet."}):n.map(E=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:"primary",children:E.creator_name}),i.jsx("span",{className:"text-sm text-[#6C757D]",children:Gt(new Date(E.scheduled_at))})]}),i.jsx("h3",{className:"mt-2 text-lg font-semibold text-[#212529]",children:E.event_title})]}),i.jsxs("div",{className:"flex flex-col items-end gap-2",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Winning Bid"}),i.jsx("span",{className:"text-xl font-semibold text-[#212529]",children:We(E.amount)})]})]},E.id))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Pending Requests",subtitle:"Stay updated on events waiting for confirmation.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(Ee,{className:"gap-4",children:[l.length===0?i.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No pending requests."}):l.map(E=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Requested on ",Gt(new Date(E.created_at))]}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:E.event_title}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",E.creator_name]})]}),i.jsxs("div",{className:"flex flex-col items-end gap-2",children:[i.jsx(Xe,{variant:Twe[E.status]??"default",children:E.status}),i.jsxs("span",{className:"text-sm font-medium text-[#212529]",children:["Bid: ",We(E.amount)]})]})]},E.id)),i.jsx(oe,{variant:"ghost",className:"self-start",children:"View all requests "})]})]})]})}function Rwe(){const{notifications:r,markNotificationAsRead:n,markAllNotificationsAsRead:o}=Xg();return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-[#111827]",children:"Notifications"}),i.jsx("p",{className:"text-[#6C757D]",children:"Manage your alerts and preferences"})]}),i.jsxs("button",{onClick:()=>o(),className:"flex items-center gap-2 text-sm font-medium text-[#FF6B35] hover:text-[#E85D2E]",children:[i.jsx(VH,{className:"h-4 w-4"}),"Mark all as read"]})]}),i.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[i.jsx("div",{className:"lg:col-span-2 space-y-4",children:i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[i.jsx("h2",{className:"mb-4 text-lg font-semibold text-[#111827]",children:"Latest alerts"}),i.jsx("div",{className:"space-y-4",children:r.length===0?i.jsx("div",{className:"text-center py-8 text-[#6C757D]",children:"No notifications yet"}):r.map(l=>i.jsxs("div",{className:`flex gap-4 rounded-lg border p-4 transition-colors cursor-pointer ${l.read?"border-transparent bg-white":"border-[#FFE5D9] bg-[#FFF5F2]"}`,onClick:()=>!l.read&&n(l.id),children:[i.jsx("div",{className:`mt-1 flex h-8 w-8 flex-none items-center justify-center rounded-full ${l.read?"bg-[#F8F9FA] text-[#6C757D]":"bg-[#FFE5D9] text-[#FF6B35]"}`,children:i.jsx(UH,{className:"h-4 w-4"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsx("h3",{className:`font-medium ${l.read?"text-[#111827]":"text-[#FF6B35]"}`,children:l.title}),i.jsx("span",{className:"whitespace-nowrap text-xs text-[#6C757D]",children:Bl(new Date(l.created_at),"MMM d, h:mm a")})]}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:l.message})]}),!l.read&&i.jsx("div",{className:"mt-2 h-2 w-2 rounded-full bg-[#FF6B35]"})]},l.id))})]})}),i.jsx("div",{className:"space-y-6",children:i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[i.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[i.jsx(KH,{className:"h-5 w-5 text-[#6C757D]"}),i.jsx("h2",{className:"text-lg font-semibold text-[#111827]",children:"Preferences"})]}),i.jsx("div",{className:"space-y-4",children:["Email notifications","Push notifications","SMS alerts"].map(l=>i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm text-[#111827]",children:l}),i.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[i.jsx("input",{type:"checkbox",className:"peer sr-only",defaultChecked:!0}),i.jsx("div",{className:"peer h-6 w-11 rounded-full bg-[#E9ECEF] after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-[#FF6B35] peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#FFE5D9]"})]})]},l))})]})})]})]})}function Awe(){const{user:r}=vs(),[n,o]=O.useState(!1),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState(""),[C,R]=O.useState(""),[M,G]=O.useState(""),[I,j]=O.useState([]);O.useEffect(()=>{if(!r)return;(async()=>{o(!0);try{const{data:D,error:V}=await ie.from("profiles").select("display_name, username, bio, primary_language, timezone").eq("user_id",r.id).single();V?console.error("Error fetching profile:",V):D&&(g(D.display_name||""),y(D.username||""),S(D.bio||""),R(D.primary_language||""),G(D.timezone||""));const{data:B,error:z}=await ie.from("security_logs").select("*").eq("user_id",r.id).order("created_at",{ascending:!1}).limit(5);z?console.error("Error fetching security logs:",z):B&&j(B)}catch(D){console.error("Unexpected error fetching data:",D)}finally{o(!1)}})()},[r]);const L=async()=>{if(r){u(!0);try{if(E){const{data:D,error:V}=await ie.from("profiles").select("user_id").eq("username",E).neq("user_id",r.id).maybeSingle();if(V){console.error("Error checking username:",V),alert("Error checking username availability."),u(!1);return}if(D){alert("Username already taken. Please choose another one."),u(!1);return}}const{error:N}=await ie.from("profiles").update({display_name:m,username:E,bio:x,primary_language:C,timezone:M,updated_at:new Date().toISOString()}).eq("user_id",r.id);alert(N?"Error updating profile: "+N.message:"Profile updated successfully!")}catch(N){console.error("Error saving profile:",N),alert("Failed to save profile.")}finally{u(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Settings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Update your profile details, preferences, and review recent security activity."})]}),i.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,0.8fr)]",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Profile",subtitle:"Let creators know who theyre meeting."}),i.jsxs(Ee,{className:"gap-5",children:[i.jsx(tt,{label:"Full name",placeholder:"Your Name",value:m,onChange:N=>g(N.target.value),disabled:n}),i.jsx(tt,{label:"Public username",placeholder:"@username",value:E,onChange:N=>y(N.target.value),disabled:n}),i.jsx(nr,{label:"About you",placeholder:"Share your interests, favorite creators, and background.",value:x,onChange:N=>S(N.target.value),rows:4,disabled:n}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Preferred language",placeholder:"English",value:C,onChange:N=>R(N.target.value),disabled:n}),i.jsx(tt,{label:"Timezone",placeholder:"IST",value:M,onChange:N=>G(N.target.value),disabled:n})]}),i.jsx(oe,{size:"lg",onClick:L,disabled:n||l,children:l?"Saving...":"Save profile"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Communication",subtitle:"Choose how we keep you informed."}),i.jsxs(Ee,{className:"gap-4 text-sm text-[#212529]",children:[i.jsxs("label",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",defaultChecked:!0,className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Email me when Im outbid on an event"]}),i.jsxs("label",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",defaultChecked:!0,className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Remind me 24 hours before a meet"]}),i.jsxs("label",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Send me creator spotlights and platform updates"]}),i.jsx(oe,{variant:"secondary",className:"self-start",children:"Save preferences"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Security activity",subtitle:"Recent actions that impact your account safety.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(Ee,{className:"gap-4",children:[I.length===0?i.jsx("div",{className:"text-sm text-[#6C757D]",children:"No recent security activity found."}):I.map(N=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-semibold text-[#212529]",children:N.event_type}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:[new Date(N.created_at).toLocaleString(),"  ",N.location||"Unknown Location"]})]}),i.jsx(Xe,{variant:"default",children:"Logged"})]},N.id)),i.jsx(oe,{variant:"ghost",className:"self-start",children:"Review all security events "})]})]})]})}const Iwe={online:"#22c55e",dnd:"#ef4444",offline:"#9ca3af"};function Dwe({status:r}){return i.jsx("span",{"aria-label":r,className:"inline-block h-2.5 w-2.5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:Iwe[r]}})}function Owe(){const[r,n]=O.useState(""),[o,l]=O.useState(null),{messages:u,sendMessage:m,markMessageAsRead:g}=Xg(),{user:E}=vs(),y=O.useMemo(()=>{if(!E||!u)return[];const R=new Map;return u.forEach(M=>{const G=M.sender_id===E.id?M.receiver_id:M.sender_id,I=M.sender_id===E.id?M.receiver_display_name:M.sender_display_name,j=M.sender_id===E.id?M.receiver_username:M.sender_username,L=R.get(G),N=!M.read&&M.receiver_id===E.id;L?(new Date(M.created_at)>new Date(L.lastTime)&&(L.lastMessage=M.message,L.lastTime=M.created_at),N&&(L.unread+=1)):R.set(G,{id:G,participant:{id:G,name:I||"Unknown User",username:j||"unknown",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${I||"User"}`,status:"offline"},lastMessage:M.message,lastTime:M.created_at,unread:N?1:0})}),Array.from(R.values()).sort((M,G)=>new Date(G.lastTime).getTime()-new Date(M.lastTime).getTime())},[u,E]),x=O.useMemo(()=>y.find(R=>R.id===o)||null,[y,o]),S=O.useMemo(()=>u.filter(R=>R.sender_id===(E==null?void 0:E.id)&&R.receiver_id===o||R.sender_id===o&&R.receiver_id===(E==null?void 0:E.id)),[u,E,o]);O.useEffect(()=>{o&&E&&S.filter(M=>!M.read&&M.receiver_id===E.id).forEach(M=>g(M.id))},[o,S,E,g]);const C=async R=>{if(R.preventDefault(),!(!r.trim()||!o))try{await m(o,r),n("")}catch(M){console.error("Failed to send message:",M)}};return i.jsxs("div",{className:"flex h-[calc(100vh-140px)] flex-col gap-4 md:flex-row",children:[i.jsxs("div",{className:`flex w-full flex-col gap-3 md:w-80 ${x?"hidden md:flex":"flex"}`,children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Messages"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Chat with creators after your meets."})]}),i.jsxs(fe,{className:"flex h-full min-h-[260px] flex-col overflow-hidden",children:[i.jsx(Te,{className:"flex flex-row items-center justify-between gap-2 border-b border-[#E9ECEF] pb-3",children:i.jsxs("div",{children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Conversations"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Tap a creator to open your chat."})]})}),i.jsx(Ee,{className:"min-h-0 flex-1 gap-2 p-0",children:i.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[y.map(R=>{const M=R.id===o;return i.jsxs("button",{type:"button",onClick:()=>l(R.id),className:`mb-2 flex w-full items-center gap-3 rounded-[12px] border px-3 py-2 text-left text-sm transition-colors ${M?"border-[#C045FF] bg-[#F4E6FF] text-[#140423]":"border-[#E9ECEF] bg-white text-[#212529] hover:border-[#C045FF]/50 hover:bg-[#F8F5FF]"}`,children:[i.jsx(yi,{src:R.participant.avatar,alt:R.participant.name,initials:R.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsx("span",{className:"truncate text-[13px] font-semibold",children:R.participant.name}),i.jsx("span",{className:"whitespace-nowrap text-[11px] text-[#6C757D]",children:Bl(new Date(R.lastTime),"h:mm a")})]}),i.jsx("span",{className:"mt-0.5 line-clamp-1 text-[12px] text-[#6C757D]",children:R.lastMessage})]}),R.unread>0&&i.jsx("span",{className:"ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-[#C045FF] px-1 text-[11px] font-semibold text-white",children:R.unread})]},R.id)}),y.length===0&&i.jsx("p",{className:"pt-4 text-center text-xs text-[#6C757D]",children:"No conversations yet. Join a FanMeet to start chatting with creators."})]})})]})]}),i.jsx(fe,{elevated:!0,className:`flex h-full w-full flex-1 flex-col overflow-hidden ${x?"flex":"hidden md:flex"}`,children:x?i.jsxs(i.Fragment,{children:[i.jsxs(Te,{className:"flex flex-row items-center justify-between gap-3 border-b border-[#E9ECEF] bg-white/80 py-3 backdrop-blur",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{type:"button",className:"flex h-8 w-8 items-center justify-center rounded-full border border-[#E9ECEF] bg-white text-sm text-[#343A40] md:hidden",onClick:()=>l(null),children:""}),i.jsx(yi,{src:x.participant.avatar,alt:x.participant.name,initials:x.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:x.participant.name}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#6C757D]",children:[x.participant.status&&i.jsx(Dwe,{status:x.participant.status}),i.jsx("span",{children:x.participant.status==="online"?"Online now":"Offline"})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(oe,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:i.jsx(YH,{className:"h-4 w-4","aria-hidden":"true"})}),i.jsx(oe,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:i.jsx(WH,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),i.jsxs(Ee,{className:"flex min-h-0 flex-1 flex-col p-0",children:[i.jsx("div",{className:"flex-1 space-y-4 overflow-y-auto bg-[#F8F9FA] p-4",children:S.map(R=>{var G;const M=R.sender_id===(E==null?void 0:E.id);return i.jsx("div",{className:`group my-2 flex gap-2 ${M?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`flex max-w-[80%] items-start gap-2 ${M?"flex-row-reverse":"flex-row"}`,children:[i.jsx(yi,{src:M?`https://api.dicebear.com/9.x/initials/svg?seed=${((G=E==null?void 0:E.user_metadata)==null?void 0:G.full_name)||"Me"}`:x.participant.avatar,alt:M?"Me":x.participant.name,initials:M?"Me":x.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{children:[i.jsx("div",{className:`rounded-2xl px-3 py-2 text-sm ${M?"border-2 border-transparent text-[#050014] shadow-[0_10px_30px_rgba(0,0,0,0.25)]":"border border-[#E9ECEF] bg-white text-[#212529]"}`,style:M?{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"}:void 0,children:R.message}),i.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-[#6C757D]",children:[i.jsx("time",{dateTime:R.created_at,children:Bl(new Date(R.created_at),"h:mm a")}),i.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(zH,{className:"h-3 w-3","aria-hidden":"true"})}),i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(BH,{className:"h-3 w-3","aria-hidden":"true"})}),!M&&i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:i.jsx(HH,{className:"h-3 w-3","aria-hidden":"true"})}),M&&i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:i.jsx(qH,{className:"h-3 w-3","aria-hidden":"true"})}),i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(GH,{className:"h-3 w-3","aria-hidden":"true"})})]})]})]})]})},R.id)})}),i.jsx("div",{className:"border-t border-[#E9ECEF] bg-white p-3",children:i.jsxs("form",{onSubmit:C,className:"flex items-center gap-3",children:[i.jsx("input",{type:"text",value:r,onChange:R=>n(R.target.value),placeholder:"Type your message...",className:"h-11 flex-1 rounded-[12px] border-2 border-[#E9ECEF] bg-white px-4 text-sm text-[#212529] placeholder:text-[#ADB5BD] focus:border-[#C045FF] focus:shadow-[0_0_0_3px_rgba(192,69,255,0.18)] focus:outline-none"}),i.jsx(oe,{type:"submit",size:"md",disabled:!r.trim(),className:"px-5 text-sm",children:"Send"})]})})]})]}):i.jsx("div",{className:"flex h-full flex-1 items-center justify-center bg-[#F8F9FA] p-6 text-center text-sm text-[#6C757D]",children:i.jsx("p",{className:"max-w-xs",children:"Select a conversation to start messaging a creator. After your next FanMeet, their chat will appear here."})})})]})}const jwe={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"};function Pwe(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState(!1),[C,R]=O.useState(!0),[M,G]=O.useState(null),[I,j]=O.useState(""),[L,N]=O.useState(!1);O.useEffect(()=>{(async()=>{if(!r){R(!1);return}const{data:z,error:H}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at").eq("user_id",r.id).order("created_at",{ascending:!1});if(H||!z){console.error("Error fetching support tickets:",H),o([]),R(!1);return}o(z.map(J=>({id:J.id,subject:J.subject,description:J.description,status:J.status,createdAt:J.created_at,updatedAt:J.updated_at}))),R(!1)})()},[r]),O.useEffect(()=>{(async()=>{if(!M){u([]);return}const{data:z,error:H}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at").eq("ticket_id",M).order("created_at",{ascending:!0});if(H||!z){console.error("Error fetching replies:",H),u([]);return}u(z.map(J=>({id:J.id,message:J.message,isAdminReply:J.is_admin_reply,createdAt:J.created_at})))})()},[M]);const D=async()=>{if(!r||!M||!I.trim()){alert("Please enter a message.");return}N(!0);try{const{error:B}=await ie.from("ticket_replies").insert({ticket_id:M,user_id:r.id,message:I.trim(),is_admin_reply:!1});if(B){console.error("Error sending reply:",B),alert("Failed to send reply.");return}u(z=>[...z,{id:`temp-${Date.now()}`,message:I.trim(),isAdminReply:!1,createdAt:new Date().toISOString()}]),j(""),alert("Reply sent! Our support team will respond soon.")}finally{N(!1)}};n.find(B=>B.id===M);const V=async()=>{if(!r){alert("Please log in to raise a support ticket.");return}if(!m.trim()||!E.trim()){alert("Please enter a subject and description.");return}S(!0);try{const{data:B,error:z}=await ie.from("support_tickets").insert({user_id:r.id,subject:m.trim(),description:E.trim(),status:"open"}).select("id, subject, description, status, created_at, updated_at").single();if(z||!B){console.error("Error creating support ticket:",z),alert("Failed to create support ticket.");return}o(H=>[{id:B.id,subject:B.subject,description:B.description,status:B.status,createdAt:B.created_at,updatedAt:B.updated_at},...H]),g(""),y(""),alert("Support ticket created successfully. Our team will get back to you.")}finally{S(!1)}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs(fe,{children:[i.jsx(Te,{title:"Help & Support",subtitle:"Raise a ticket if you face issues with payments, meets, or your account."}),i.jsxs(Ee,{className:"gap-4",children:[i.jsx(nr,{label:"Subject",rows:2,placeholder:"Briefly describe your issue",value:m,onChange:B=>g(B.target.value)}),i.jsx(nr,{label:"Details",rows:5,placeholder:"Share as many details as possible, including event names, creators, dates, and screenshots where relevant.",value:E,onChange:B=>y(B.target.value)}),i.jsx(oe,{onClick:V,disabled:x,children:x?"Submitting":"Submit Ticket"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Your Tickets",subtitle:"Click a ticket to view the conversation and reply."}),i.jsx(Ee,{className:"flex flex-col gap-3",children:C?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading tickets"}):n.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"You have not raised any tickets yet."}):n.map(B=>i.jsxs("div",{children:[i.jsxs("button",{type:"button",onClick:()=>G(M===B.id?null:B.id),className:`w-full text-left rounded-[12px] border p-4 text-sm text-[#212529] transition-all ${M===B.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-white hover:border-[#C045FF]/50"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-semibold",children:B.subject}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Gt(B.createdAt)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Xe,{variant:jwe[B.status],children:B.status.replace("_"," ")}),i.jsx("span",{className:"text-[#6C757D]",children:M===B.id?"":""})]})]}),i.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-[#6C757D] whitespace-pre-line",children:B.description})]}),M===B.id&&i.jsxs("div",{className:"mt-2 ml-4 border-l-2 border-[#C045FF] pl-4 space-y-4",children:[i.jsx("div",{className:"space-y-3",children:l.length===0?i.jsx("p",{className:"text-sm text-[#6C757D] py-2",children:"No replies yet. Our support team will respond soon."}):l.map(z=>i.jsxs("div",{className:`rounded-[10px] p-3 text-sm ${z.isAdminReply?"bg-[#F4E6FF] border-l-4 border-[#C045FF]":"bg-[#F8F9FA]"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[i.jsx("span",{className:`font-semibold ${z.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:z.isAdminReply?" Support Team":"You"}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Gt(z.createdAt)})]}),i.jsx("p",{className:"text-[#212529] whitespace-pre-line",children:z.message})]},z.id))}),B.status!=="closed"&&B.status!=="resolved"&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(nr,{label:"Reply to this ticket",rows:3,placeholder:"Type your message...",value:I,onChange:z=>j(z.target.value)}),i.jsx(oe,{size:"sm",onClick:D,disabled:L||!I.trim(),children:L?"Sending...":"Send Reply"})]}),(B.status==="closed"||B.status==="resolved")&&i.jsxs("p",{className:"text-sm text-[#6C757D] italic",children:["This ticket is ",B.status,". Create a new ticket if you need further assistance."]})]})]},B.id))})]})]})}const kwe=[{value:"all",label:"All Events",emoji:""},{value:"entertainment",label:"Entertainment",emoji:""},{value:"music",label:"Music",emoji:""},{value:"education",label:"Education",emoji:""},{value:"fitness",label:"Fitness",emoji:""},{value:"gaming",label:"Gaming",emoji:""},{value:"lifestyle",label:"Lifestyle",emoji:""},{value:"general",label:"General",emoji:""}],Lwe=[{value:"popular",label:"Most Popular"},{value:"ending-soon",label:"Ending Soon"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"},{value:"newest",label:"Newly Added"}],Ay=20;function Mwe(){const r=Ns(),[n,o]=Gp(),{events:l}=Xo(),[u,m]=O.useState(n.get("category")||"all"),[g,E]=O.useState(n.get("sort")||"popular"),[y,x]=O.useState(n.get("q")||""),[S,C]=O.useState(parseInt(n.get("page")||"1",10));O.useEffect(()=>{const L=new URLSearchParams;u!=="all"&&L.set("category",u),g!=="popular"&&L.set("sort",g),y&&L.set("q",y),S>1&&L.set("page",String(S)),o(L,{replace:!0})},[u,g,y,S]);const R=O.useMemo(()=>[...l.filter(D=>{var V;if(u!=="all"&&D.category!==u)return!1;if(y){const B=y.toLowerCase();return D.title.toLowerCase().includes(B)||D.creatorDisplayName.toLowerCase().includes(B)||((V=D.description)==null?void 0:V.toLowerCase().includes(B))}return!0})].sort((D,V)=>{switch(g){case"popular":return V.participants-D.participants;case"price-low":return D.basePrice-V.basePrice;case"price-high":return V.basePrice-D.basePrice;case"newest":return V.id.localeCompare(D.id);case"ending-soon":const B=z=>z.includes("Closed")?999999:z.includes("days")?parseInt(z)*24*60:z.includes("hours")?parseInt(z)*60:z.includes("minutes")?parseInt(z):0;return B(D.endsIn)-B(V.endsIn);default:return 0}}),[l,u,g,y]),M=Math.ceil(R.length/Ay),G=(S-1)*Ay,I=R.slice(G,G+Ay);O.useEffect(()=>{C(1)},[u,g,y]);const j=L=>{C(L),window.scrollTo({top:0,behavior:"smooth"})};return i.jsxs("div",{className:"flex flex-col gap-8 overflow-x-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"All Events"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Browse through all ",R.length," available events"]})]}),i.jsx(oe,{variant:"secondary",onClick:()=>r("/fan"),children:" Back to Dashboard"})]}),i.jsx(fe,{children:i.jsxs(Ee,{className:"gap-6",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Search events or creators...",value:y,onChange:L=>x(L.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),i.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]}),i.jsxs("div",{className:"overflow-x-hidden",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Categories"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:kwe.map(L=>i.jsxs("button",{onClick:()=>m(L.value),className:`flex-shrink-0 rounded-full border-2 px-3 py-1.5 text-xs font-medium transition-all md:px-4 md:py-2 md:text-sm ${u===L.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:[i.jsx("span",{className:"mr-1",children:L.emoji}),L.label]},L.value))})]}),i.jsxs("div",{className:"overflow-x-hidden",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Sort By"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:Lwe.map(L=>i.jsx("button",{onClick:()=>E(L.value),className:`flex-shrink-0 whitespace-nowrap rounded-full border-2 px-3 py-1.5 text-xs font-medium transition-all md:px-4 md:py-2 md:text-sm ${g===L.value?"border-[#C045FF] bg-[#C045FF] text-white":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:L.label},L.value))})]})]})}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("h2",{className:"text-lg font-semibold text-[#212529]",children:[R.length," ",R.length===1?"Event":"Events",R.length>Ay&&i.jsxs("span",{className:"ml-2 text-sm font-normal text-[#6C757D]",children:["(Page ",S," of ",M,")"]})]}),(u!=="all"||y)&&i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>{m("all"),x("")},children:"Clear Filters"})]}),I.length===0?i.jsx(fe,{children:i.jsxs(Ee,{className:"py-12 text-center",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),i.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Try adjusting your filters or search query"}),i.jsx(oe,{onClick:()=>{m("all"),x("")},children:"Clear Filters"})]})}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:I.map(L=>i.jsx(fe,{className:"group cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>r(`/events/${L.id}`),children:i.jsxs(Ee,{className:"gap-4",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"mb-1 text-xs text-[#6C757D]",children:L.creatorDisplayName}),i.jsx("h3",{className:"text-base font-semibold text-[#212529] group-hover:text-[#C045FF]",children:L.title})]}),L.status==="Accepting Bids"?i.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:i.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx(Xe,{variant:L.status==="LIVE"?"danger":"primary",children:L.status})]}),L.description&&i.jsx("p",{className:"line-clamp-2 text-sm text-[#6C757D]",children:L.description}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Current Bid"}),i.jsx("div",{className:"font-semibold text-[#C045FF]",children:We(L.currentBid)})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Base Price"}),i.jsx("div",{className:"font-semibold text-[#212529]",children:We(L.basePrice)})]})]}),i.jsxs("div",{className:"flex items-center justify-between border-t border-[#E9ECEF] pt-3 text-xs text-[#6C757D]",children:[i.jsxs("span",{children:[" ",L.participants," bidding"]}),i.jsxs("span",{children:[" ",L.endsIn]})]}),i.jsx(oe,{className:"w-full",size:"sm",children:"View & Bid "})]})},L.id))}),M>1&&i.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>j(S-1),disabled:S===1,children:" Previous"}),i.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:M},(L,N)=>N+1).map(L=>{const N=L===1||L===M||Math.abs(L-S)<=1,D=L===2&&S>3||L===M-1&&S<M-2;return!N&&!D?null:D&&!N?i.jsx("span",{className:"px-2 text-[#6C757D]",children:"..."},L):i.jsx("button",{onClick:()=>j(L),className:`min-w-[36px] rounded-lg px-3 py-2 text-sm font-medium transition-all ${S===L?"bg-[#C045FF] text-white":"bg-[#F8F9FA] text-[#6C757D] hover:bg-[#E9ECEF]"}`,children:L},L)})}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>j(S+1),disabled:S===M,children:"Next "})]})]})]})}const _7="dvtdzotx2",v7="ml_default";function Fwe(r){const n=typeof r=="string"?new Date(r):r,o=Date.now()-n.getTime(),l=Math.floor(o/1e3);if(l<60)return"Just now";const u=Math.floor(l/60);if(u<60)return`${u} min${u===1?"":"s"} ago`;const m=Math.floor(u/60);if(m<24)return`${m} hour${m===1?"":"s"} ago`;const g=Math.floor(m/24);if(g<7)return`${g} day${g===1?"":"s"} ago`;const E=Math.floor(g/7);return`${E} week${E===1?"":"s"} ago`}function Uwe(r){const n=r.trim();if(!n)return"";const o=n.split(/\s+/);return o.length===1?o[0].slice(0,2).toUpperCase():`${o[0][0]}${o[1][0]}`.toUpperCase()}function Vwe(){var ue,Fe,be;const r=Ns(),{user:n}=vs(),{events:o}=Xo(),[l,u]=O.useState([]),[m,g]=O.useState(!1),[E,y]=O.useState(0),[x,S]=O.useState(0),[C,R]=O.useState(0),[M,G]=O.useState(void 0),[I,j]=O.useState([]),[L,N]=O.useState(!1),[D,V]=O.useState(null),[B,z]=O.useState(""),[H,J]=O.useState(!1),ee=O.useRef(null);O.useEffect(()=>{(async()=>{if(!n)return;const{data:ge}=await ie.from("profiles").select("profile_photo_url, display_name").eq("user_id",n.id).single();ge&&(V(ge.profile_photo_url||null),z(ge.display_name||""))})()},[n]);const ne=async ae=>{var Se,it;const ge=(Se=ae.target.files)==null?void 0:Se[0];if(!(!ge||!n)){if(!ge.type.startsWith("image/")){alert("Please select an image file.");return}if(ge.size>5*1024*1024){alert("Image must be less than 5MB.");return}J(!0);try{const Ue=new FormData;Ue.append("file",ge),Ue.append("upload_preset",v7),Ue.append("folder","fanmeet/profiles"),console.log(" Uploading to Cloudinary..."),console.log("Cloud Name:",_7),console.log("Upload Preset:",v7),console.log("File:",ge.name,ge.type,ge.size);const ht=await fetch(`https://api.cloudinary.com/v1_1/${_7}/image/upload`,{method:"POST",body:Ue});console.log("Response status:",ht.status);const qe=await ht.text();if(console.log("Response body:",qe),!ht.ok){let st="Upload failed";try{const De=JSON.parse(qe);st=((it=De.error)==null?void 0:it.message)||JSON.stringify(De),console.error(" Cloudinary error:",De)}catch{console.error(" Response text:",qe)}throw new Error(st)}const Me=JSON.parse(qe);console.log(" Upload successful:",Me.secure_url),await ie.from("profiles").update({profile_photo_url:Me.secure_url}).eq("user_id",n.id),V(Me.secure_url),alert("Profile photo updated!")}catch(Ue){console.error("Upload error:",Ue),alert(`Failed to upload photo: ${Ue instanceof Error?Ue.message:"Unknown error"}`)}finally{J(!1),ee.current&&(ee.current.value="")}}},he=async()=>{if(!(!n||!confirm("Remove your profile photo?"))){J(!0);try{await ie.from("profiles").update({profile_photo_url:null}).eq("user_id",n.id),V(null),alert("Profile photo removed.")}catch{alert("Failed to remove photo.")}finally{J(!1)}}};O.useEffect(()=>{(async()=>{g(!0);try{const ge=new Date,Se=new Date(ge.getFullYear(),ge.getMonth(),1),it=new Date(ge.getFullYear(),ge.getMonth()+1,1),{data:Ue,error:ht}=await ie.from("bids").select("event_id, amount, status, created_at").eq("status","won").gte("created_at",Se.toISOString()).lt("created_at",it.toISOString());if(ht||!Ue||Ue.length===0){u([]);return}const qe=Array.from(new Set(Ue.map(jt=>jt.event_id)));if(qe.length===0){u([]);return}const{data:Me,error:st}=await ie.from("events").select("id, creator_id").in("id",qe);if(st||!Me||Me.length===0){u([]);return}const De=new Map(Me.map(jt=>[jt.id,jt.creator_id])),Ae=new Map;for(const jt of Ue){const Pt=De.get(jt.event_id);if(!Pt)continue;const rt=Ae.get(Pt)??0;Ae.set(Pt,rt+(jt.amount??0))}if(Ae.size===0){u([]);return}const Qe=Array.from(Ae.entries()).sort((jt,Pt)=>Pt[1]-jt[1]).slice(0,3),pe=Qe.map(([jt])=>jt),{data:Re}=await ie.from("profiles").select("user_id, display_name, username, category").in("user_id",pe),Ge=new Map((Re??[]).map(jt=>[jt.user_id,jt])),xt=Qe.map(([jt,Pt])=>{const rt=Ge.get(jt),Dt=(rt==null?void 0:rt.display_name)||(rt==null?void 0:rt.username)||"Creator",kt=rt!=null&&rt.username?`@${rt.username}`:"@creator",Os=(rt==null?void 0:rt.category)||"general";return{id:jt,displayName:Dt,handle:kt,category:Os,earnings:Pt,initials:Uwe(Dt)}});u(xt)}finally{g(!1)}})()},[]),O.useEffect(()=>{(async()=>{if(!n){y(0),S(0),R(0),j([]),G(void 0);return}N(!0);try{let ge=0,Se=0,it;const{count:Ue}=await ie.from("meets").select("id",{count:"exact",head:!0}).eq("creator_id",n.id).eq("status","completed");R(typeof Ue=="number"?Ue:0);const{data:ht}=await ie.from("events").select("id, title").eq("creator_id",n.id),qe=new Map((ht??[]).map(pe=>[pe.id,pe.title])),Me=Array.from(qe.keys()),st=[];if(Me.length>0){const{data:pe}=await ie.from("bids").select("id, event_id, amount, status, created_at").in("event_id",Me).order("created_at",{ascending:!1}),Re=(pe??[]).filter(Ge=>Ge.status==="won");if(Re.length>0){const Ge=new Date;ge=Re.reduce((Dt,kt)=>Dt+(kt.amount??0),0);const xt=new Date(Ge.getFullYear(),Ge.getMonth(),1),jt=new Date(Ge.getFullYear(),Ge.getMonth()-1,1),Pt=Re.filter(Dt=>new Date(Dt.created_at)>=xt).reduce((Dt,kt)=>Dt+(kt.amount??0),0),rt=Re.filter(Dt=>{const kt=new Date(Dt.created_at);return kt>=jt&&kt<xt}).reduce((Dt,kt)=>Dt+(kt.amount??0),0);if(rt>0){const Dt=(Pt-rt)/rt*100,kt=Math.round(Dt);it=`${kt>=0?"+":""}${kt}% vs last month`}else Pt>0?it="New this month":it=void 0}(pe??[]).forEach(Ge=>{const xt=qe.get(Ge.event_id)??"Event";st.push({id:`bid-${Ge.id}`,description:`New bid of ${We(Ge.amount)} on ${xt}`,createdAt:Ge.created_at})})}const{data:De}=await ie.from("withdrawal_requests").select("id, amount, status, requested_at").eq("creator_id",n.id).order("requested_at",{ascending:!1}).limit(10);let Ae=0;(De??[]).forEach(pe=>{pe.status==="completed"&&(Ae+=pe.amount??0),st.push({id:`wd-${pe.id}`,description:`Withdrawal request of ${We(pe.amount)} (${pe.status})`,createdAt:pe.requested_at})}),Se=Math.max(ge-Ae,0),y(ge),S(Se),G(it),st.sort((pe,Re)=>new Date(Re.createdAt).getTime()-new Date(pe.createdAt).getTime());const Qe=st.slice(0,10).map(pe=>({id:pe.id,description:pe.description,time:Fwe(pe.createdAt)}));j(Qe)}finally{N(!1)}})()},[n]);const ye=(n?o.filter(ae=>ae.creatorUsername===n.username):[]).filter(ae=>ae.status==="LIVE"||ae.status==="Upcoming").length,me=[{id:"stat-1",icon:"",title:"Total Earnings",value:E,change:M},{id:"stat-2",icon:"",title:"Active Events",value:ye.toString(),caption:`${ye} upcoming or live`},{id:"stat-3",icon:"",title:"Pending Balance",value:x,action:"Withdraw ",actionLink:"/creator/withdrawals"},{id:"meets",icon:"",title:"Completed Meets",value:C.toString(),caption:"Happy fans across sessions"}];return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx(fe,{elevated:!0,className:"border-none",children:i.jsx(Ee,{className:"gap-4",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"relative",children:D?i.jsx("img",{src:D,alt:"Profile",className:"h-20 w-20 rounded-full object-cover ring-2 ring-[#C045FF]/30"}):i.jsx("div",{className:"h-20 w-20 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-2xl ring-2 ring-[#C045FF]/30",children:((ue=B==null?void 0:B.charAt(0))==null?void 0:ue.toUpperCase())||((be=(Fe=n==null?void 0:n.email)==null?void 0:Fe.charAt(0))==null?void 0:be.toUpperCase())||"?"})}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:B||"Creator"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:n==null?void 0:n.email})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{ref:ee,type:"file",accept:"image/*",onChange:ne,className:"hidden"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>{var ae;return(ae=ee.current)==null?void 0:ae.click()},disabled:H,children:H?"Uploading...":D?"Change Photo":"Add Photo"}),D&&i.jsx(oe,{variant:"ghost",size:"sm",onClick:he,disabled:H,className:"text-red-500 hover:text-red-600",children:"Remove"})]})]})]})})}),i.jsx(fe,{elevated:!0,className:"overflow-hidden border-none bg-gradient-to-r from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] shadow-[0_24px_60px_rgba(160,64,255,0.18)]",children:i.jsxs("div",{className:"relative flex flex-col gap-6 px-6 py-6 md:flex-row md:items-center md:px-8 md:py-8",children:[i.jsxs("div",{className:"max-w-xl space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Creator earnings"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"See how top creators earn with FanMeet."}),i.jsx("p",{className:"text-sm text-[#6C757D] md:text-base",children:"Track your revenue, learn from other creators, and turn every 1:1 meet into predictable income."}),i.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:i.jsx("span",{className:"text-xs text-[#6C757D]",children:"Your personal earnings, events, and activity summary are updated live from your FanMeet account."})})]}),i.jsxs("div",{className:"mt-4 w-full max-w-md rounded-[20px] bg-white/90 p-4 shadow-[0_18px_45px_rgba(15,23,42,0.18)] md:ml-auto md:mt-0",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:"Top creators this month"})}),i.jsx("div",{className:"mt-3 space-y-3",children:m?i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Loading top creators"}):l.length===0?i.jsx("div",{className:"text-xs text-[#6C757D]",children:"No earnings data yet this month."}):l.map(ae=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] bg-[#F8F9FA] px-3 py-2 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] text-xs font-semibold text-white",children:ae.initials}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:ae.displayName}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[ae.handle,"  ",ae.category]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-sm font-bold text-[#050014]",children:We(ae.earnings)}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:"This month"})]})]},ae.id))})]})]})}),i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-semibold text-[#212529]",children:"Overview"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"High-level snapshot of your performance."})]}),i.jsx(oe,{variant:"primary",className:"bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/creator/events/new"),children:"Create Event "})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-4",children:me.map(ae=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:ae.icon}),i.jsx("span",{children:ae.title})]})}),i.jsxs(Ee,{className:"gap-2",children:[i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:typeof ae.value=="number"?We(ae.value):ae.value}),ae.change?i.jsx(Xe,{variant:"success",className:"w-fit",children:ae.change}):null,ae.caption?i.jsx("p",{className:"text-sm text-[#6C757D]",children:ae.caption}):null,ae.action?i.jsx(oe,{variant:"primary",size:"sm",className:"mt-2 w-fit bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>ae.actionLink?r(ae.actionLink):void 0,children:ae.action}):null]})]},ae.id))}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Recent Activity",subtitle:"Latest updates from your events and fans"}),i.jsx(Ee,{className:"gap-4",children:L&&I.length===0?i.jsx("div",{className:"text-sm text-[#6C757D]",children:"Loading activity"}):I.length===0?i.jsx("div",{className:"text-sm text-[#6C757D]",children:"No recent activity yet."}):I.map(ae=>i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[i.jsx("div",{children:ae.description}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:ae.time})]},ae.id))})]})]})}function Bwe(){const r=Ns(),{user:n}=vs(),{events:o,finalizeEvent:l}=Xo(),u=(n==null?void 0:n.role)==="creator"?n.username:null,m=u?o.filter(E=>E.creatorUsername===u).sort((E,y)=>new Date(y.startsAt).getTime()-new Date(E.startsAt).getTime()):[],g=E=>{const y=`${window.location.origin}/events/${E}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(y).then(()=>{window.alert("Share link copied to clipboard. Send it to your fans to start receiving bids.")},()=>{window.prompt("Share this link with your fans:",y)}):window.prompt("Share this link with your fans:",y)};return(n==null?void 0:n.creatorProfileStatus)==="pending"?i.jsx("div",{className:"flex flex-col gap-8",children:i.jsxs("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 text-yellow-800",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Pending Approval"}),i.jsx("p",{children:"Your creator account is currently pending approval. Please wait for approval from an admin."})]})}):(n==null?void 0:n.creatorProfileStatus)==="rejected"?i.jsx("div",{className:"flex flex-col gap-8",children:i.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-red-800",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Application Rejected"}),i.jsx("p",{children:"Your creator account application was rejected by an admin."})]})}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Events"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage and monitor all of your scheduled sessions."})]}),i.jsx("div",{className:"flex gap-2",children:["All","Upcoming","Live","Completed"].map(E=>i.jsx(oe,{size:"sm",variant:E==="All"?"primary":"secondary",className:"rounded-full px-4",children:E},E))})]}),i.jsx("div",{className:"flex flex-col gap-6",children:u&&m.length>0?m.map(E=>i.jsxs(fe,{elevated:!0,className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"flex-1 space-y-3",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:E.status==="LIVE"?"danger":"primary",children:E.status==="LIVE"?" LIVE":E.status}),i.jsx("span",{className:"text-sm text-[#6C757D]",children:E.date})]}),i.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:E.title}),i.jsxs("div",{className:"text-sm text-[#6C757D]",children:["Duration: ",E.duration,"  Base Price: ",We(E.basePrice)]}),i.jsxs("div",{className:"grid gap-2 rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm",children:[i.jsxs("span",{children:[" Current Bid:"," ",i.jsx("strong",{className:"text-[#212529]",children:We(E.currentBid)})]}),i.jsxs("span",{children:[" ",E.participants," participants"]}),i.jsxs("span",{children:[" ",E.endsIn]})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(oe,{variant:"secondary",children:"Edit"}),i.jsx(oe,{variant:"danger",children:"Delete"}),i.jsx(oe,{onClick:()=>g(E.id),children:"Copy Link"}),(E.status==="Accepting Bids"||E.status==="Upcoming")&&i.jsx(oe,{variant:"primary",className:"bg-green-600 hover:bg-green-700 text-white border-none",onClick:async()=>{if(window.confirm("Close bidding and generate meeting link for the highest bidder?"))try{await l(E.id),window.alert('Success! Meeting created. Check "My Meets" tab.')}catch{window.alert("Error finalizing event. Please try again.")}},children:"End Bidding & Create Meet"}),i.jsx(oe,{variant:"ghost",onClick:()=>r(`/events/${E.id}`),children:"View Details "})]})]},E.id)):i.jsx(fe,{elevated:!0,className:"grid min-h-[220px] place-items-center text-center",children:i.jsxs(Ee,{className:"flex flex-col items-center gap-3",children:[i.jsx("span",{className:"text-4xl",children:""}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:"No events yet"}),i.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Create your first FanMeet event to start receiving bids. Once created, youll see it listed here and can share your public link with fans."})]})})})]})}const Wwe=["50","100","150"],Gwe=["5 minutes","10 minutes","15 minutes"];function Hwe(){const r=Ns(),{user:n}=vs(),{createEvent:o}=Xo(),[l,u]=O.useState(""),[m,g]=O.useState(""),[E,y]=O.useState(null),[x,S]=O.useState(""),[C,R]=O.useState(""),[M,G]=O.useState(""),[I,j]=O.useState(""),[L,N]=O.useState(""),[D,V]=O.useState(""),B=async()=>{if(!n||n.role!=="creator"){window.alert("Please login as a creator to create events."),r("/auth?redirect=/creator/events/new");return}if(n.creatorProfileStatus!=="approved"){const ne=n.creatorProfileStatus==="pending"?"Your creator profile is pending approval. Please wait for admin approval before creating events.":"Your creator profile has been rejected. Please contact support for more information.";window.alert(` ${ne}`);return}if(!l.trim()||E===null||!x||!C||!M||!I||!L){V("Please fill in all required fields before creating the event.");return}const J=50;if(E%J!==0){V(`Base price must be in multiples of ${J}.`);return}V("");const ee=n.email.split("@")[0]||n.username;try{const ne=await o({creatorUsername:n.username,creatorDisplayName:ee,title:l.trim(),description:m.trim()||void 0,basePrice:E,duration:x,date:C,time:M,biddingDeadlineDate:I,biddingDeadlineTime:L,meetingLink:`${window.location.origin}/meet/${crypto.randomUUID()}`}),he=`${window.location.origin}/events/${ne.id}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(he).then(()=>{window.alert("Event created! Share link copied to your clipboard.")},()=>{window.prompt("Event created! Share this link with your fans:",he)}):window.prompt("Event created! Share this link with your fans:",he),r("/creator/events")}catch(ne){console.error("Failed to create event:",ne),V("Failed to create event. Please try again.")}},z=(n==null?void 0:n.creatorProfileStatus)==="approved",H=(n==null?void 0:n.creatorProfileStatus)==="pending";return i.jsxs("div",{className:"flex flex-col gap-8",children:[n&&n.role==="creator"&&!z&&i.jsx("div",{className:`rounded-[12px] p-4 ${H?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:H?"":""}),i.jsxs("div",{children:[i.jsx("h3",{className:`font-semibold ${H?"text-yellow-800":"text-red-800"}`,children:H?"Profile Pending Approval":"Profile Not Approved"}),i.jsx("p",{className:`text-sm ${H?"text-yellow-700":"text-red-700"}`,children:H?"Your creator profile is being reviewed by our team. You cannot create events until approved.":"Your creator profile was not approved. Please contact support for more information."})]})]})}),i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Create New Event"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Set up a new live experience for your fans."})]}),i.jsx(Xe,{variant:"primary",className:"px-4 py-2 text-sm",children:"Preview updates in real time"})]}),i.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsxs(fe,{elevated:!0,className:"p-0",children:[i.jsx(Te,{title:"Event Details",subtitle:"Provide the basics so fans know what to expect",className:"border-b border-[#E9ECEF] px-8 py-6"}),i.jsxs(Ee,{className:"gap-6 px-8 py-6",children:[i.jsx(tt,{label:"Event Title *",placeholder:"Give your event an exciting headline",required:!0,value:l,onChange:J=>u(J.target.value)}),i.jsx(nr,{label:"Description",placeholder:"Describe the experience, topics, or value fans will get.",rows:5,value:m,onChange:J=>g(J.target.value)}),i.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Base Price *"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"All creator events must be paid. Select a starting bid."}),i.jsx("div",{className:"flex flex-wrap gap-3",children:Wwe.map(J=>{const ee=parseInt(J.replace(/[^0-9]/g,""),10)||0,ne=E===ee;return i.jsx(oe,{variant:ne?"primary":"secondary",size:"sm",className:"rounded-[8px]",onClick:()=>y(ee),children:J},J)})})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Duration *"}),i.jsx("div",{className:"flex flex-wrap gap-3",children:Gwe.map(J=>i.jsx(oe,{variant:x===J?"primary":"secondary",size:"sm",className:"rounded-[8px]",onClick:()=>S(J),children:J},J))})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{type:"date",label:"Event Date *",required:!0,value:C,onChange:J=>R(J.target.value)}),i.jsx(tt,{type:"time",label:"Event Time *",required:!0,value:M,onChange:J=>G(J.target.value)})]}),i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"mb-3 text-sm font-semibold text-[#212529]",children:" Bidding Window *"}),i.jsx("p",{className:"mb-4 text-xs text-[#6C757D]",children:"Set when bidding closes. Fans can bid until this time, and the highest bidder wins."}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{type:"date",label:"Bidding Closes Date *",required:!0,value:I,onChange:J=>j(J.target.value)}),i.jsx(tt,{type:"time",label:"Bidding Closes Time *",required:!0,value:L,onChange:J=>N(J.target.value)})]})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Cover Image (optional)"}),i.jsxs("div",{className:"flex h-44 flex-col items-center justify-center gap-3 rounded-[16px] border-2 border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("span",{className:"text-sm font-medium text-[#212529]",children:"Drag & Drop or click to upload"}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:"JPG, PNG, or WEBP up to 5MB"}),i.jsx(oe,{size:"sm",variant:"secondary",children:"Browse Files"})]})]}),D?i.jsx("p",{className:"text-sm font-medium text-[#DC3545]",children:D}):null]}),i.jsxs("div",{className:"flex justify-end gap-3 border-t border-[#E9ECEF] px-8 py-6",children:[i.jsx(oe,{variant:"secondary",children:"Cancel"}),i.jsx(oe,{onClick:B,children:"Create Event "})]})]}),i.jsxs(fe,{className:"h-fit",children:[i.jsx(Te,{title:"Preview",subtitle:"Fans will see this layout before bidding"}),i.jsxs(Ee,{className:"gap-4",children:[i.jsx("div",{className:"h-32 rounded-[16px] bg-gradient-to-br from-[#FFE5D9] to-white"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:"Meet & Greet - Q&A Session"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Jan 15  4:00 PM IST  10 minutes"})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:"danger",children:" LIVE SOON"}),i.jsx(Xe,{variant:"primary",children:"Base Price: 100"})]}),i.jsx("div",{className:"rounded-[12px] bg-[#F8F9FA] p-4 text-sm text-[#6C757D]",children:"Fans can view event info, schedule, and place their bids here."})]})]})]})]})}const XH=O.createContext(void 0),zwe=()=>`${Date.now()}-${Math.random().toString(16).slice(2)}`,Kwe=({children:r})=>{const[n,o]=O.useState([]),[l,u]=O.useState([]),{user:m}=vs(),[g,E]=O.useState([]);O.useEffect(()=>{(async()=>{const{data:N,error:D}=await ie.from("profiles").select("username, display_name, bio, profile_photo_url, cover_photo_url");if(D){console.error("Error fetching profiles:",D);return}N&&o(N.map(V=>({username:V.username,displayName:V.display_name||"",bio:V.bio||"",profilePhotoUrl:V.profile_photo_url||void 0,cover_photo_url:V.cover_photo_url||void 0})))})()},[]),O.useEffect(()=>{if(!m){E([]);return}(async()=>{const{data:N,error:D}=await ie.from("creator_follows").select("creator_id").eq("fan_id",m.id);if(D){console.error("Error fetching following:",D);return}if(N&&N.length>0){const V=N.map(H=>H.creator_id),{data:B}=await ie.from("profiles").select("username").in("user_id",V),z=(B==null?void 0:B.map(H=>H.username).filter(Boolean))||[];E(z)}})()},[m]);const y=L=>n.find(N=>N.username===L),x=async({username:L,displayName:N,bio:D})=>{const V=n.find(z=>z.username===L),B={username:L,displayName:N,bio:D};if(o(V?z=>z.map(H=>H.username===L?B:H):z=>[...z,B]),m){const{error:z}=await ie.from("profiles").upsert({user_id:m.id,username:L,display_name:N,bio:D,updated_at:new Date().toISOString()});z&&console.error("Error updating profile:",z)}return B},S=async L=>{if(!m)return;E(V=>[...V,L]);const{data:N}=await ie.from("profiles").select("user_id").eq("username",L).single();if(!N)return;const{error:D}=await ie.from("creator_follows").insert({fan_id:m.id,creator_id:N.user_id});D&&(console.error("Error following creator:",D),E(V=>V.filter(B=>B!==L)))},C=async L=>{if(!m)return;E(V=>V.filter(B=>B!==L));const{data:N}=await ie.from("profiles").select("user_id").eq("username",L).single();if(!N)return;const{error:D}=await ie.from("creator_follows").delete().eq("fan_id",m.id).eq("creator_id",N.user_id);D&&(console.error("Error unfollowing creator:",D),E(V=>[...V,L]))},R=L=>l.filter(N=>N.username===L).sort((N,D)=>N.id<D.id?1:-1),M=({username:L,text:N})=>{const D=N.trim();if(!D)throw new Error("Post text cannot be empty");const V={id:zwe(),username:L,text:D,createdAtLabel:"Just now"};return u(B=>[V,...B]),V},G=(L,N)=>{u(D=>D.map(V=>V.id===L?{...V,text:N.trim()}:V))},I=L=>{u(N=>N.filter(D=>D.id!==L))},j=O.useMemo(()=>({profiles:n,posts:l,following:g,getProfile:y,upsertProfile:x,followCreator:S,unfollowCreator:C,getPostsForCreator:R,addPost:M,updatePost:G,deletePost:I}),[n,l,g]);return i.jsx(XH.Provider,{value:j,children:r})},YI=()=>{const r=O.useContext(XH);if(!r)throw new Error("useCreatorProfiles must be used within a CreatorProfileProvider");return r};function qwe(){const{user:r}=vs(),{getProfile:n,upsertProfile:o}=YI();if(!r||r.role!=="creator")return i.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Creator profile setup"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Please sign in as a creator to edit your public profile."})]});const l=n(r.username),u=(l==null?void 0:l.displayName)||r.email.split("@")[0]||r.username,m=(l==null?void 0:l.bio)||"Tell fans who you are, what you create, and what kind of micro-meets or AMAs they can expect.",[g,E]=O.useState(u),[y,x]=O.useState(m),[S,C]=O.useState(!1),R=async()=>{await o({username:r.username,displayName:g.trim(),bio:y.trim()}),C(!0),window.setTimeout(()=>C(!1),2e3)},M=()=>{const G=`${window.location.origin}/${r.username}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(G).then(()=>{window.alert("Profile link copied. Share it with your fans.")},()=>{window.prompt("Share this profile link with your fans:",G)}):window.prompt("Share this profile link with your fans:",G)};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Public profile setup"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Update what fans see on your public page."})]}),i.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.3fr)_minmax(0,0.7fr)]",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Profile details",subtitle:"These details are shown at the top of your public page."}),i.jsxs(Ee,{className:"gap-5",children:[i.jsx(tt,{label:"Display name",placeholder:"Your public display name",value:g,onChange:G=>E(G.target.value)}),i.jsx(tt,{label:"Public username",value:`@${r.username}`,disabled:!0,helperText:"Your profile link uses this username."}),i.jsx(nr,{label:"Bio",rows:4,value:y,onChange:G=>x(G.target.value),placeholder:"Short description that appears on your public profile."}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(oe,{onClick:R,children:"Save profile"}),S&&i.jsx("span",{className:"text-xs font-medium text-[#28A745]",children:"Saved. Your public page is updated."})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Public page preview",subtitle:"Fans visiting your profile will see something like this."}),i.jsxs(Ee,{className:"gap-4",children:[i.jsxs("div",{className:"rounded-[16px] bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] p-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"h-10 w-10 rounded-full bg-[#050014] text-center text-sm font-semibold leading-10 text-white",children:g.charAt(0).toUpperCase()}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:g}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",r.username]})]})]}),i.jsx("p",{className:"mt-3 text-xs text-[#6C757D]",children:y})]}),i.jsxs("div",{className:"flex items-center justify-between gap-3 text-xs text-[#6C757D]",children:[i.jsxs("p",{children:["Visit ",i.jsxs("span",{className:"font-mono font-semibold",children:["/",r.username]})," to see your public page in a new tab."]}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:M,children:"Share profile"})]})]})]})]})]})}const Ywe=10,$we=r=>Math.floor(r*(100-Ywe)/100);function Xwe(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(0),[E,y]=O.useState(0),[x,S]=O.useState(0),[C,R]=O.useState(!1);O.useEffect(()=>{(async()=>{if(!r){o([]),u([]),g(0),y(0),S(0);return}R(!0);try{const{data:N,error:D}=await ie.from("events").select("id, title, status, starts_at").eq("creator_id",r.id);if(D||!N||N.length===0){o([]),u([]),g(0),y(0),S(0);return}const V=N.map(Ue=>Ue.id),{data:B}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at").in("event_id",V),{data:z}=await ie.from("meets").select("event_id, status").in("event_id",V),H=Array.from(new Set((B??[]).map(Ue=>Ue.fan_id).filter(Boolean)));let J=null;if(H.length>0){const{data:Ue}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",H);J=Ue??[]}const ee=new Map((J??[]).map(Ue=>[Ue.user_id,Ue])),ne=new Map;for(const Ue of B??[]){const ht=ne.get(Ue.event_id)??[];ht.push(Ue),ne.set(Ue.event_id,ht)}const he=new Map;for(const Ue of z??[]){const ht=he.get(Ue.event_id)??[];ht.push(Ue),he.set(Ue.event_id,ht)}const ve=new Date,ye=new Date(ve.getFullYear(),ve.getMonth(),1),me=new Date(ve);me.setDate(ve.getDate()-29);let ue=0,Fe=0;const be=new Map,ae=[];for(const Ue of N){const ht=ne.get(Ue.id)??[],qe=ht.length,Me=ht.filter(Pt=>Pt.status==="won"),st=Me.length>0?Me.reduce((Pt,rt)=>rt.amount>Pt.amount?rt:Pt,Me[0]):null,De=(st==null?void 0:st.amount)??0,Ae=$we(De);let Qe="-",pe=null;if(st){const Pt=ee.get(st.fan_id);Qe=(Pt==null?void 0:Pt.display_name)||(Pt==null?void 0:Pt.username)||"Winner",pe=new Date(st.created_at)}else Ue.starts_at&&(pe=new Date(Ue.starts_at));if(Ae>0&&pe&&(ue+=Ae,pe>=ye&&(Fe+=Ae),pe>=me)){const Pt=pe.toISOString().slice(0,10),rt=be.get(Pt)??0;be.set(Pt,rt+Ae)}const xt=(he.get(Ue.id)??[]).some(Pt=>Pt.status==="completed")?"Cleared":"Upcoming",jt=pe?pe.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}):"-";ae.push({id:Ue.id,date:jt,event:Ue.title,bids:qe,winner:Qe,grossAmount:De,earned:Ae,status:xt})}const ge=ae.filter(Ue=>Ue.earned>0).length,Se=ge>0?ue/ge:0,it=[];for(let Ue=0;Ue<30;Ue+=1){const ht=new Date(me);ht.setDate(me.getDate()+Ue);const qe=ht.toISOString().slice(0,10),Me=be.get(qe)??0;it.push({dateKey:qe,label:ht.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}),total:Me})}ae.sort((Ue,ht)=>Ue.date<ht.date?1:-1),o(ae),u(it),g(ue),y(Fe),S(Se)}finally{R(!1)}})()},[r]);const M=()=>{if(!n.length){alert("No earnings to export yet.");return}const D=[["Date","Event","Bids","Winner","Earned","Status"].join(","),...n.map(H=>{const J=ee=>`"${ee.replace(/"/g,'""')}"`;return[J(H.date),J(H.event),H.bids.toString(),J(H.winner),H.earned.toString(),J(H.status)].join(",")})].join(`
`),V=new Blob([D],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(V),z=document.createElement("a");z.href=B,z.setAttribute("download","earnings.csv"),document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(B)},G=[{id:"sum-1",title:"Total Earned",value:m},{id:"sum-2",title:"This Month",value:E},{id:"sum-3",title:"Average/Event",value:x}],I=l.reduce((L,N)=>N.total>L?N.total:L,0),j={Cleared:"success",Upcoming:"primary"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Earnings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track revenue trends and payment history."})]}),i.jsx(oe,{variant:"secondary",onClick:M,children:"Export CSV"})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:G.map(L=>i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:L.title}),i.jsx(Ee,{children:i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:C?"":We(L.value)})})]},L.id))}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Revenue (Last 30 days)",subtitle:"Visualize how your earnings have changed over time"}),i.jsx(Ee,{children:i.jsx("div",{className:"flex h-64 items-end gap-1 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] px-4 py-4",children:l.every(L=>L.total===0)?i.jsx("div",{className:"m-auto text-sm text-[#6C757D]",children:"No earnings in the last 30 days."}):i.jsx("div",{className:"flex h-full w-full items-end gap-1",children:l.map(L=>i.jsxs("div",{className:"flex flex-1 flex-col items-center gap-1",children:[i.jsx("div",{className:"flex h-full w-full items-end",children:i.jsx("div",{className:"w-full rounded-t-md bg-[#FF6B35]",style:{height:I>0?`${Math.max(6,L.total/I*100)}%`:"6px"}})}),i.jsx("div",{className:"text-[10px] text-[#6C757D]",children:L.label})]},L.dateKey))})})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Earnings Breakdown"}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Winner"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Net Earnings"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),i.jsx("tbody",{className:"text-[#212529]",children:C&&n.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading earnings"})}):n.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#6C757D]",children:"No earnings yet."})}):n.map(L=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:L.date}),i.jsx("td",{className:"py-3",children:L.event}),i.jsx("td",{className:"py-3",children:L.bids}),i.jsx("td",{className:"py-3",children:L.winner}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-medium text-green-600",children:We(L.earned)}),L.grossAmount>0&&i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["(Bid: ",We(L.grossAmount)," - 10% fee)"]})]})}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:j[L.status]??"primary",children:L.status})})]},L.id))})]})})]})]})}const Jwe={completed:"success",in_review:"warning",pending:"primary",failed:"danger"},Qwe={completed:"Completed",in_review:"In review",pending:"Pending",failed:"Failed"},Zwe=10,eSe=r=>Math.floor(r*(100-Zwe)/100);function tSe(){const{user:r}=vs(),n=Ns(),[o,l]=O.useState(0),[u,m]=O.useState(null),[g,E]=O.useState(0),[y,x]=O.useState(null),[S,C]=O.useState([]),[R,M]=O.useState(!1),[G,I]=O.useState(!1),[j,L]=O.useState(""),[N,D]=O.useState(""),[V,B]=O.useState(!1),[z,H]=O.useState("");O.useEffect(()=>{(async()=>{if(!r){l(0),E(0),x(null),C([]);return}M(!0);try{const{data:ne,error:he}=await ie.from("users").select("role, account_status, creator_profile_status").eq("id",r.id).maybeSingle();if(he||!ne){B(!0),H("We could not load your creator profile. Please contact support."),M(!1);return}if(ne.role!=="creator"){B(!0),H("Withdrawals are only available for creator accounts."),M(!1);return}if(ne.account_status&&ne.account_status!=="active"){B(!0),H("Your creator account is not active. Please contact support."),M(!1);return}if(ne.creator_profile_status&&ne.creator_profile_status!=="approved"){B(!0),H("Your creator profile is not approved yet. Once an admin approves you, withdrawals will be enabled."),M(!1);return}const{data:ve}=await ie.from("profiles").select("bank_account_number, bank_ifsc, upi_id, razorpay_fund_account_id").eq("user_id",r.id).single();if(ve){const qe=!!(ve.razorpay_fund_account_id||ve.bank_account_number||ve.upi_id);m(qe);const Me=ve.razorpay_fund_account_id?"Linked Payout Account":ve.bank_account_number?`Bank Account ending in ${ve.bank_account_number.slice(-4)}`:ve.upi_id?`UPI: ${ve.upi_id}`:"";Me&&D(Me)}else m(!1);const{data:ye}=await ie.from("events").select("id").eq("creator_id",r.id),me=(ye??[]).map(qe=>qe.id);let ue=0,Fe=0;if(me.length>0){const{data:qe}=await ie.from("bids").select("event_id, amount, status, created_at").in("event_id",me).eq("status","won"),{data:Me}=await ie.from("meets").select("event_id, status, updated_at").in("event_id",me),st=new Map;for(const Qe of Me??[]){const pe=st.get(Qe.event_id)??[];pe.push(Qe),st.set(Qe.event_id,pe)}const De=new Date,Ae=48*60*60*1e3;for(const Qe of qe??[]){const pe=eSe(Qe.amount??0);ue+=pe;const Ge=(st.get(Qe.event_id)??[]).find(jt=>jt.status==="completed");Ge&&Ge.updated_at&&De.getTime()-new Date(Ge.updated_at).getTime()>Ae||(Fe+=pe)}}const{data:be}=await ie.from("withdrawal_requests").select("*").eq("creator_id",r.id).order("requested_at",{ascending:!1});let ae=0,ge=0,Se=null;const it=[];for(const qe of be??[])qe.status==="completed"?(ae+=qe.amount??0,!Se&&qe.processed_at&&(Se={amount:qe.amount,processedAt:new Date(qe.processed_at)})):(qe.status==="pending"||qe.status==="in_review")&&(ge+=qe.amount??0),it.push({id:qe.id,amount:qe.amount,status:qe.status,destination:qe.destination||"Not specified",requestedAt:new Date(qe.requested_at),processedAt:qe.processed_at?new Date(qe.processed_at):null});const Ue=ue-Fe,ht=Math.max(Ue-ae-ge,0);l(ht),E(Fe),x(Se),C(it)}finally{M(!1)}})()},[r]);const J=async()=>{if(!r){alert("Please log in to request a withdrawal.");return}if(V){alert(z||"Withdrawals are currently unavailable for your account. Please contact support.");return}const ee=parseInt(j,10);if(isNaN(ee)||ee<=0){alert("Please enter a valid amount.");return}if(ee<500){alert("Minimum withdrawal amount is 500.");return}if(ee>o){alert(`You can only withdraw up to ${We(o)}.`);return}if(!N.trim()){alert("Please enter a destination account.");return}I(!0);try{const{data:ne,error:he}=await ie.from("withdrawal_requests").insert({creator_id:r.id,amount:ee,destination:N.trim(),status:"pending",requested_at:new Date().toISOString(),created_at:new Date().toISOString()}).select().single();if(he||!ne){console.error("Error submitting withdrawal:",he),alert("Failed to submit withdrawal request. Please try again.");return}ie.functions.invoke("trigger-payout",{body:{withdrawal_request_id:ne.id}}).then(({error:ve})=>{ve&&console.error("Auto-payout trigger failed:",ve)}),alert(`Withdrawal request of ${We(ee)} submitted successfully!`),L(""),D(""),l(ve=>ve-ee),C(ve=>[{id:`temp-${Date.now()}`,amount:ee,status:"pending",destination:N.trim(),requestedAt:new Date,processedAt:null},...ve])}finally{I(!1)}};return u===!1&&!R?i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Withdrawals"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track your payout requests, bank destinations, and release timelines."})]}),i.jsx(fe,{elevated:!0,className:"max-w-2xl",children:i.jsx(Ee,{className:"gap-6 py-12",children:i.jsxs("div",{className:"flex flex-col items-center text-center",children:[i.jsx("div",{className:"mb-4 flex h-24 w-24 items-center justify-center rounded-full bg-gradient-to-br from-[#F4E6FF] to-[#E9D5FF]",children:i.jsx("span",{className:"text-5xl",children:""})}),i.jsx("h2",{className:"mb-2 text-2xl font-bold text-[#212529]",children:"Add Your Bank Account"}),i.jsx("p",{className:"mb-6 max-w-md text-[#6C757D]",children:"Before you can withdraw your earnings, you need to link a bank account or UPI ID. This ensures your payouts are processed securely and quickly."}),i.jsxs("div",{className:"mb-6 w-full max-w-sm rounded-xl bg-[#F4E6FF]/60 p-4 text-left",children:[i.jsx("p",{className:"mb-2 text-sm font-semibold text-[#7B2CBF]",children:"Why add bank details?"}),i.jsxs("ul",{className:"space-y-2 text-sm text-[#6C757D]",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"Receive payouts directly to your account"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"Earnings available 48 hours after event completion"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"Secure & verified payout processing"})]})]})]}),i.jsx(oe,{size:"lg",onClick:()=>n("/creator/settings#payouts"),className:"w-full max-w-sm",children:" Add Bank Account / UPI"}),i.jsx("p",{className:"mt-3 text-xs text-[#6C757D]",children:"You'll be redirected to Settings to add your payout details."})]})})}),i.jsxs(fe,{className:"max-w-2xl",children:[i.jsx(Te,{title:"Your Earnings",subtitle:"Here's what you've earned so far."}),i.jsx(Ee,{className:"gap-4",children:i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Available to withdraw"}),i.jsx("p",{className:"text-xl font-semibold text-[#C045FF]",children:We(o)})]}),i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Pending clearance"}),i.jsx("p",{className:"text-xl font-semibold text-[#212529]",children:We(g)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Available after 48 hours"})]})]})})]})]}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Withdrawals"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track your payout requests, bank destinations, and release timelines."})]}),i.jsxs("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Available Balance",subtitle:"Withdraw to your linked account any time."}),i.jsxs(Ee,{className:"gap-6",children:[i.jsxs("div",{className:"rounded-[16px] bg-[#F4E6FF]/60 p-6",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Ready to withdraw"}),i.jsx("p",{className:"text-4xl font-bold text-[#C045FF]",children:R?"":We(o)})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Pending clearance"}),i.jsx("p",{className:"text-xl font-semibold text-[#212529]",children:R?"":We(g)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Net earnings (90%) after 10% platform fee. Available after 48 hours."})]}),i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Last payout"}),i.jsx("p",{className:"text-xl font-semibold text-[#212529]",children:R?"":y?We(y.amount):""}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:y?`Processed ${Gt(y.processedAt)}`:"No payouts yet"})]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Request Withdrawal",subtitle:"Transfers typically arrive in 2-3 business days."}),i.jsxs(Ee,{className:"gap-5",children:[V&&i.jsx("div",{className:"rounded-[12px] border border-[#FECACA] bg-[#FFF5F5] p-3 text-xs text-[#B91C1C]",children:z}),i.jsxs("div",{className:"grid gap-4",children:[i.jsx(tt,{label:"Amount",placeholder:"5,000",type:"number",min:500,step:100,value:j,onChange:ee=>L(ee.target.value)}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx(tt,{label:"Destination account",placeholder:"No linked account",value:N,disabled:!0,onChange:()=>{}}),!N&&i.jsxs("p",{className:"text-xs text-red-500",children:["Please ",i.jsx(oo,{to:"/creator/settings",className:"underline",children:"add your bank details"})," in settings to withdraw."]}),N&&i.jsxs("p",{className:"text-xs text-[#6C757D]",children:["To change this, go to ",i.jsx(oo,{to:"/creator/settings",className:"underline",children:"Settings"}),"."]})]})]}),i.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-4 text-sm text-[#6C757D]",children:["Note: We process withdrawals above 500. Ensure your KYC details are up to date for smoother payouts.",o>0&&i.jsxs("span",{className:"mt-1 block font-medium text-[#212529]",children:["Maximum available: ",We(o)]})]}),i.jsx(oe,{size:"lg",onClick:J,disabled:G||o<500||V,children:G?"Submitting":"Submit request"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Payout History",subtitle:"A log of all recent withdrawal activity.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(Ee,{className:"gap-4",children:R&&S.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading payout history"}):S.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No withdrawal requests yet."}):S.map(ee=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:Jwe[ee.status]??"default",children:Qwe[ee.status]??ee.status}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Requested ",Gt(ee.requestedAt)]})]}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Destination: ",ee.destination]})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Amount"}),i.jsx("span",{className:"text-xl font-semibold text-[#212529]",children:We(ee.amount)}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:ee.processedAt?`Processed ${Gt(ee.processedAt)}`:"Awaiting processing"})]})]},ee.id))})]})]})}const sSe=["Review fan questions in advance to personalize the session.","Test your audio/video setup 15 minutes before the meet.","Keep exclusive content ready to reward high bidders.","Use the built-in timer to stay on schedule."],rSe={scheduled:"success",live:"primary",completed:"primary",cancelled:"danger",cancelled_no_show_creator:"danger",no_show:"warning"};function nSe(){const{user:r,onlineUsers:n}=vs(),o=Ns(),[l,u]=O.useState([]),[m,g]=O.useState([]),[E,y]=O.useState(!0),x=async()=>{if(!r)return;const{data:j,error:L}=await ie.from("meets").select(`
        *,
        events:event_id (title, base_price)
      `).eq("creator_id",r.id).order("scheduled_at",{ascending:!0});if(L){console.error("Error fetching meets:",L),y(!1);return}if(console.log(" Fetched meets for creator:",r.id),console.log(" Meets data:",j),console.log(" Number of meets:",(j==null?void 0:j.length)||0),j&&j.length>0){const V=[...new Set(j.map(ne=>ne.fan_id))],{data:B}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",V),z=new Map((B==null?void 0:B.map(ne=>[ne.user_id,ne]))||[]),H=[...new Set(j.map(ne=>ne.event_id))],{data:J}=await ie.from("bids").select("event_id, amount").in("event_id",H),ee=j.map(ne=>({...ne,fan_profile:z.get(ne.fan_id),bids:(J==null?void 0:J.filter(he=>he.event_id===ne.event_id))||[]}));u(ee)}else u(j||[]);const{data:N,error:D}=await ie.from("events").select("id, title, starts_at, base_price, status").eq("creator_id",r.id).order("starts_at",{ascending:!1});if(!D&&N){const V=new Set((j??[]).map(z=>z.event_id)),B=N.filter(z=>!V.has(z.id));g(B)}else D&&(console.error("Error fetching creator events:",D),g([]));y(!1)};O.useEffect(()=>{x()},[r]);const S=j=>{var L,N;return(L=j==null?void 0:j.bids)!=null&&L.length?Math.max(...j.bids.map(D=>D.amount||0)):((N=j==null?void 0:j.events)==null?void 0:N.base_price)||0},C=l.filter(j=>j.status==="scheduled"||j.status==="live"),R=l.filter(j=>j.status==="completed"),M=l.filter(j=>j.status==="cancelled"||j.status==="cancelled_no_show_creator"),G=l.filter(j=>j.status==="cancelled_no_show_creator"),I=G.reduce((j,L)=>j+S(L),0);return console.log(" Upcoming meets (scheduled):",C.length,C),console.log(" Completed meets:",R.length,R),console.log(" All meets:",l.length,l),E?i.jsx("div",{className:"p-8 text-center",children:"Loading meets..."}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Meets"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage your scheduled sessions and turn every meet into a wow moment."})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Session Prep Center",subtitle:"Best practices to deliver memorable fan experiences.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(Ee,{className:"gap-3",children:sSe.map(j=>i.jsxs("div",{className:"flex items-start gap-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"mt-1 text-lg",children:""}),i.jsx("p",{className:"text-sm text-[#212529]",children:j})]},j))})]}),i.jsx("div",{className:"rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 p-4",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-blue-800",children:"Automatic Meeting System"}),i.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[i.jsx("strong",{children:"Important:"})," You must start your call ",i.jsx("strong",{children:"before"})," the scheduled time. If you don't join before the scheduled time, the meeting will be auto-cancelled and the fan will receive a full refund. Meetings automatically complete at the scheduled end time and your earnings (90%) will be credited to your wallet."]})]})]})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Upcoming Sessions",subtitle:"Start your call before the scheduled time to avoid no-show cancellation.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(Ee,{className:"gap-4",children:[C.map(j=>{var N,D,V;const L=S(j);return i.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[#E9ECEF] bg-white p-4",children:i.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[i.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:rSe[j.status]??"default",children:j.status}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Gt(j.scheduled_at),"  ",j.duration_minutes," mins"]}),i.jsxs("span",{className:"text-xs font-semibold text-[#28A745]",children:["Amount: ",We(L)]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((N=j.events)==null?void 0:N.title)||"Untitled Event"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((D=j.fan_profile)==null?void 0:D.display_name)||((V=j.fan_profile)==null?void 0:V.username)||"Unknown Fan"]})]}),i.jsxs("div",{className:"text-sm text-[#6C757D]",children:[i.jsx("span",{className:"font-medium",children:"Meeting Link: "}),i.jsx("span",{className:"break-all",children:j.meeting_link||"No link yet"})]})]}),i.jsx("div",{className:"flex flex-col gap-2",children:j.meeting_link&&i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>navigator.clipboard.writeText(j.meeting_link),children:"Copy Link"}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>o(`/messages?chatWith=${j.fan_id}`),children:"Message Fan"})]}),(()=>{const B=new Date,z=new Date(j.scheduled_at),H=new Date(z.getTime()+j.duration_minutes*60*1e3),J=B>=new Date(z.getTime()-3e4),ee=B>=H||j.status==="completed"||j.status==="cancelled"||j.status==="cancelled_no_show_creator",ne=j.status==="live";return i.jsx(oe,{size:"sm",disabled:ee||!ne&&!n.has(j.fan_id)||!ne&&!J,variant:ee?"secondary":"primary",title:ee?"This meeting has ended":ne?"Rejoin your live call":n.has(j.fan_id)?J?"Start the call":`Call starts at ${Gt(j.scheduled_at)} (30s early buffer available)`:"Fan is offline. You cannot start the call.",onClick:()=>window.open(j.meeting_link,"_blank","noopener,noreferrer"),children:ee?" Completed":ne?"Rejoin Call":"Start Call"})})(),!n.has(j.fan_id)&&i.jsx("span",{className:"text-[10px] text-red-500",children:"Fan is offline"})]})})]})},j.id)}),C.length===0&&m.length===0&&i.jsx("p",{className:"text-sm text-[#6C757D]",children:"No upcoming meets scheduled."}),m.length>0&&i.jsxs("div",{className:"mt-6 flex flex-col gap-4 rounded-[14px] border border-dashed border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-semibold text-[#212529]",children:"Events without a scheduled meet"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"These events didn't generate a meeting yet. If no bid was placed, you can relaunch or share the event again."})]}),i.jsx("div",{className:"flex flex-col gap-3",children:m.slice(0,5).map(j=>i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-3",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-[#6C757D]",children:[i.jsx("span",{className:"rounded-full bg-[#E9ECEF] px-2 py-0.5 uppercase tracking-wide",children:j.status.replace(/_/g," ")}),i.jsx("span",{children:Gt(j.starts_at)})]}),i.jsxs("div",{className:"mt-1 flex flex-wrap items-center justify-between gap-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:j.title}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:["Base price: ",We(j.base_price??0)]})]}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>{var L;return(L=navigator.clipboard)==null?void 0:L.writeText(`${window.location.origin}/events/${j.id}`)},children:"Copy Event Link"})]}),i.jsx("p",{className:"mt-2 text-xs text-[#C045FF]",children:j.status==="completed"?"No winning bid was placed before bidding closed.":"Waiting for bids  share the link to secure a fan."})]},j.id))})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Completed Sessions",subtitle:"Your past meets and earnings.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(Ee,{className:"gap-4",children:[R.map(j=>{var N,D,V;const L=S(j);return i.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[#28A745] bg-gradient-to-r from-green-50 to-white p-4",children:i.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:i.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:"success",children:" Completed"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Gt(j.scheduled_at),"  ",j.duration_minutes," mins"]}),i.jsx("div",{className:"flex items-center gap-2 rounded-full bg-[#28A745] px-3 py-1",children:i.jsxs("span",{className:"text-xs font-bold text-white",children:[" ",We(L)]})})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((N=j.events)==null?void 0:N.title)||"Untitled Event"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((D=j.fan_profile)==null?void 0:D.display_name)||((V=j.fan_profile)==null?void 0:V.username)||"Unknown Fan"]})]})]})})},j.id)}),R.length===0&&i.jsx("p",{className:"text-sm text-[#6C757D]",children:"No completed meets yet."})]})]}),M.length>0&&i.jsxs(fe,{children:[i.jsx(Te,{title:"Cancelled Sessions",subtitle:"Meetings that were cancelled due to no-show.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(Ee,{className:"gap-4",children:M.map(j=>{var L,N,D;return i.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-red-200 bg-gradient-to-r from-red-50 to-white p-4",children:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:"danger",children:j.status==="cancelled_no_show_creator"?" No-Show":" Cancelled"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Gt(j.scheduled_at),"  ",j.duration_minutes," mins"]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((L=j.events)==null?void 0:L.title)||"Untitled Event"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((N=j.fan_profile)==null?void 0:N.display_name)||((D=j.fan_profile)==null?void 0:D.username)||"Unknown Fan"]})]}),j.status==="cancelled_no_show_creator"&&i.jsx("p",{className:"text-xs text-red-600",children:" You did not start the call before the scheduled time. Fan received a full refund."})]})},j.id)})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Cancelled / No-Show Impact",subtitle:"These meetings were auto-cancelled because you didnt go live in time.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(Ee,{className:"gap-4",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-[14px] border border-red-200 bg-red-50 p-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs uppercase tracking-wide text-red-600 font-semibold",children:"Total amount refunded"}),i.jsx("p",{className:"text-2xl font-bold text-red-700",children:We(I)}),i.jsx("p",{className:"text-xs text-red-500",children:"100% of the winning bid is refunded to the fan when you miss the call."})]}),i.jsxs("div",{className:"ml-auto text-center",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"No-show instances"}),i.jsx("p",{className:"text-3xl font-bold text-red-600",children:G.length})]})]}),G.length===0?i.jsx("p",{className:"text-sm text-[#28A745]",children:"Great job! You havent missed any meets."}):G.map(j=>{var N,D,V;const L=S(j);return i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-red-200 bg-gradient-to-r from-red-50 to-white p-4",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx(Xe,{variant:"danger",children:" Creator No-Show"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Gt(j.scheduled_at),"  ",j.duration_minutes," mins"]}),i.jsxs("span",{className:"text-xs font-semibold text-red-600",children:["Lost: ",We(L)]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((N=j.events)==null?void 0:N.title)||"Untitled Event"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Fan: ",((D=j.fan_profile)==null?void 0:D.display_name)||((V=j.fan_profile)==null?void 0:V.username)||"Unknown Fan"]})]}),i.jsx("p",{className:"text-xs text-red-600",children:" Call never started. Fan was auto-refunded and the slot was marked as missed."})]},j.id)})]})]})]})}function iSe(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState(!0);return O.useEffect(()=>{async function m(){if(r)try{const{data:g,error:E}=await ie.from("creator_follows").select("fan_id").eq("creator_id",r.id);if(E)throw E;if(g&&g.length>0){const y=g.map(C=>C.fan_id),{data:x,error:S}=await ie.from("profiles").select("*").in("user_id",y);if(S)throw S;x&&o(x)}else o([])}catch(g){console.error("Error fetching followers:",g)}finally{u(!1)}}m()},[r]),l?i.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading..."}):i.jsxs("div",{className:"mx-auto flex max-w-4xl flex-col gap-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Followers"}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"People who follow you on FanMeet. Use this list to understand who shows up for your events most often."})]}),i.jsxs("div",{className:"space-y-4",children:[n.map(m=>{var g,E;return i.jsx(fe,{elevated:!0,className:"border-none bg-white/95",children:i.jsxs(Ee,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[i.jsx("div",{className:"flex flex-col gap-1",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(yi,{src:m.avatar_url,initials:((g=m.display_name)==null?void 0:g.charAt(0))||((E=m.username)==null?void 0:E.charAt(0)),size:"md"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:m.display_name||m.username}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",m.username]})]})]})}),i.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[i.jsx(Xe,{variant:"primary",children:"Follower"}),i.jsx("div",{className:"flex gap-2",children:i.jsx(oe,{size:"sm",variant:"secondary",className:"rounded-full",children:"Message"})})]})]})},m.user_id)}),n.length===0&&i.jsx(fe,{children:i.jsx(Ee,{children:i.jsx("p",{className:"text-sm text-[#6C757D]",children:"You dont have any followers yet. Share your profile link and host a few events to start building your fan list."})})})]})]})}function aSe(){const{notifications:r,markNotificationAsRead:n,markAllNotificationsAsRead:o}=Xg();return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-[#111827]",children:"Notifications"}),i.jsx("p",{className:"text-[#6C757D]",children:"Manage your alerts and preferences"})]}),i.jsxs("button",{onClick:()=>o(),className:"flex items-center gap-2 text-sm font-medium text-[#FF6B35] hover:text-[#E85D2E]",children:[i.jsx(VH,{className:"h-4 w-4"}),"Mark all as read"]})]}),i.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[i.jsx("div",{className:"lg:col-span-2 space-y-4",children:i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[i.jsx("h2",{className:"mb-4 text-lg font-semibold text-[#111827]",children:"Latest alerts"}),i.jsx("div",{className:"space-y-4",children:r.length===0?i.jsx("div",{className:"text-center py-8 text-[#6C757D]",children:"No notifications yet"}):r.map(l=>i.jsxs("div",{className:`flex gap-4 rounded-lg border p-4 transition-colors cursor-pointer ${l.read?"border-transparent bg-white":"border-[#FFE5D9] bg-[#FFF5F2]"}`,onClick:()=>!l.read&&n(l.id),children:[i.jsx("div",{className:`mt-1 flex h-8 w-8 flex-none items-center justify-center rounded-full ${l.read?"bg-[#F8F9FA] text-[#6C757D]":"bg-[#FFE5D9] text-[#FF6B35]"}`,children:i.jsx(UH,{className:"h-4 w-4"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsx("h3",{className:`font-medium ${l.read?"text-[#111827]":"text-[#FF6B35]"}`,children:l.title}),i.jsx("span",{className:"whitespace-nowrap text-xs text-[#6C757D]",children:Bl(new Date(l.created_at),"MMM d, h:mm a")})]}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:l.message})]}),!l.read&&i.jsx("div",{className:"mt-2 h-2 w-2 rounded-full bg-[#FF6B35]"})]},l.id))})]})}),i.jsx("div",{className:"space-y-6",children:i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[i.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[i.jsx(KH,{className:"h-5 w-5 text-[#6C757D]"}),i.jsx("h2",{className:"text-lg font-semibold text-[#111827]",children:"Preferences"})]}),i.jsx("div",{className:"space-y-4",children:["Email notifications","Push notifications","SMS alerts"].map(l=>i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm text-[#111827]",children:l}),i.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[i.jsx("input",{type:"checkbox",className:"peer sr-only",defaultChecked:!0}),i.jsx("div",{className:"peer h-6 w-11 rounded-full bg-[#E9ECEF] after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-[#FF6B35] peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#FFE5D9]"})]})]},l))})]})})]})]})}const E7="dvtdzotx2",y7="ml_default",oSe={Connected:"success","Reconnect required":"warning"};function cSe(){var ht,qe;const{user:r}=vs(),[n,o]=O.useState(!0),[l,u]=O.useState(!1),[m,g]=O.useState(!1),[E,y]=O.useState(!1),[x,S]=O.useState(!1),[C,R]=O.useState(!1),[M,G]=O.useState(null),[I,j]=O.useState(null),[L,N]=O.useState(!1),D=O.useRef(null),V=O.useRef(null),[B,z]=O.useState({display_name:"",username:"",bio:"",category:"",primary_language:""}),[H,J]=O.useState({bank_account_number:"",confirm_bank_account_number:"",bank_ifsc:"",bank_account_name:"",upi_id:""}),[ee,ne]=O.useState({contact_email:"",phone_number:"",sms_alerts:!1,share_calendar:!1}),[he,ve]=O.useState([]),[ye,me]=O.useState({instagram:"",youtube:"",twitter:"",linkedin:"",website:""});O.useEffect(()=>{async function Me(){if(r)try{const{data:st}=await ie.from("profiles").select("*").eq("user_id",r.id).single();st&&(z({display_name:st.display_name||"",username:st.username||"",bio:st.bio||"",category:st.category||"",primary_language:st.primary_language||""}),G(st.profile_photo_url||null),j(st.cover_photo_url||null),me({instagram:st.instagram_url||"",youtube:st.youtube_url||"",twitter:st.twitter_url||"",linkedin:st.linkedin_url||"",website:st.website_url||""}),J({bank_account_number:st.bank_account_number||"",confirm_bank_account_number:st.bank_account_number||"",bank_ifsc:st.bank_ifsc||"",bank_account_name:st.bank_account_name||"",upi_id:st.upi_id||""}));const{data:De}=await ie.from("creator_settings").select("*").eq("user_id",r.id).maybeSingle();De&&ne({contact_email:De.contact_email||"",phone_number:De.phone_number||"",sms_alerts:De.sms_alerts||!1,share_calendar:De.share_calendar||!1});const{data:Ae}=await ie.from("linked_channels").select("*").eq("user_id",r.id);Ae&&ve(Ae)}catch(st){console.error("Error fetching settings:",st)}finally{o(!1)}}Me()},[r]);const ue=async()=>{if(r){u(!0);try{const{error:Me}=await ie.from("profiles").update(B).eq("user_id",r.id);if(Me)throw Me;alert("Profile updated successfully!")}catch(Me){console.error("Error updating profile:",Me),alert("Failed to update profile.")}finally{u(!1)}}},Fe=async Me=>{var De;const st=(De=Me.target.files)==null?void 0:De[0];if(!(!st||!r)){if(!st.type.startsWith("image/")){alert("Please select an image file.");return}if(st.size>5*1024*1024){alert("Image must be less than 5MB.");return}R(!0);try{const Ae=new FormData;Ae.append("file",st),Ae.append("upload_preset",y7),Ae.append("folder","fanmeet/profiles");const Qe=await fetch(`https://api.cloudinary.com/v1_1/${E7}/image/upload`,{method:"POST",body:Ae});if(!Qe.ok)throw new Error("Failed to upload image");const Re=(await Qe.json()).secure_url,{error:Ge}=await ie.from("profiles").update({profile_photo_url:Re}).eq("user_id",r.id);if(Ge)throw Ge;G(Re),alert("Profile photo updated successfully!")}catch(Ae){console.error("Error uploading photo:",Ae),alert("Failed to upload photo. Please try again.")}finally{R(!1),D.current&&(D.current.value="")}}},be=async()=>{if(r&&confirm("Are you sure you want to remove your profile photo?")){R(!0);try{const{error:Me}=await ie.from("profiles").update({profile_photo_url:null}).eq("user_id",r.id);if(Me)throw Me;G(null),alert("Profile photo removed.")}catch(Me){console.error("Error removing photo:",Me),alert("Failed to remove photo.")}finally{R(!1)}}},ae=async Me=>{var De;const st=(De=Me.target.files)==null?void 0:De[0];if(!(!st||!r)){if(!st.type.startsWith("image/")){alert("Please select an image file.");return}if(st.size>5*1024*1024){alert("Image must be less than 5MB.");return}N(!0);try{const Ae=new FormData;Ae.append("file",st),Ae.append("upload_preset",y7),Ae.append("folder","fanmeet/covers");const Qe=await fetch(`https://api.cloudinary.com/v1_1/${E7}/image/upload`,{method:"POST",body:Ae});if(!Qe.ok)throw new Error("Upload failed");const pe=await Qe.json();await ie.from("profiles").update({cover_photo_url:pe.secure_url}).eq("user_id",r.id),j(pe.secure_url),alert("Cover photo updated!")}catch(Ae){console.error("Upload error:",Ae),alert("Failed to upload cover photo.")}finally{N(!1),V.current&&(V.current.value="")}}},ge=async()=>{if(!(!r||!confirm("Remove your cover photo?"))){N(!0);try{await ie.from("profiles").update({cover_photo_url:null}).eq("user_id",r.id),j(null),alert("Cover photo removed.")}catch{alert("Failed to remove cover photo.")}finally{N(!1)}}},Se=async()=>{if(r){S(!0);try{const{error:Me}=await ie.from("profiles").update({instagram_url:ye.instagram||null,youtube_url:ye.youtube||null,twitter_url:ye.twitter||null,linkedin_url:ye.linkedin||null,website_url:ye.website||null}).eq("user_id",r.id);if(Me)throw Me;alert("Social links updated successfully!")}catch(Me){console.error("Error updating social links:",Me),alert("Failed to update social links.")}finally{S(!1)}}},it=async()=>{if(r){g(!0);try{const{data:Me}=await ie.from("creator_settings").select("user_id").eq("user_id",r.id).single();let st;if(Me){const{error:De}=await ie.from("creator_settings").update(ee).eq("user_id",r.id);st=De}else{const{error:De}=await ie.from("creator_settings").insert({...ee,user_id:r.id});st=De}if(st)throw st;alert("Contact settings updated successfully!")}catch(Me){console.error("Error updating contact settings:",Me),alert("Failed to update contact settings.")}finally{g(!1)}}},Ue=async()=>{if(!r)return;const Me=!!H.upi_id,st=!!H.bank_account_number;if(!Me&&!st){alert("Please provide either Bank Account details or a UPI ID.");return}if(st){if(!H.bank_account_name){alert("Please enter the Account Holder Name.");return}if(!H.bank_ifsc||H.bank_ifsc.length!==11){alert("Please enter a valid 11-character IFSC code.");return}if(H.bank_account_number!==H.confirm_bank_account_number){alert("Account numbers do not match. Please re-enter.");return}}y(!0);try{const De={name:H.bank_account_name,ifsc:H.bank_ifsc,account_number:H.bank_account_number,upi_id:H.upi_id},{data:Ae,error:Qe}=await ie.functions.invoke("create-razorpay-fund-account",{body:De});if(Qe){console.error("Edge function error:",Qe),alert(`Verification failed: ${Qe.message||"Unknown error"}`),y(!1);return}const{confirm_bank_account_number:pe,...Re}=H,Ge={...Re};Ae!=null&&Ae.fund_account_id&&(Ge.razorpay_fund_account_id=Ae.fund_account_id);const{error:xt}=await ie.from("profiles").update(Ge).eq("user_id",r.id);if(xt)throw xt;alert("Bank details updated successfully! Your earnings will be available for withdrawal 48 hours after event completion.")}catch(De){console.error("Error updating bank details:",De),alert("Failed to update bank details.")}finally{y(!1)}};return n?i.jsx("div",{className:"p-8 text-center",children:"Loading settings..."}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Settings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Fine-tune your public profile, contact preferences, and streaming setup."})]}),i.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,0.8fr)]",children:[i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Profile information",subtitle:"Fans see these details before bidding."}),i.jsxs(Ee,{className:"gap-5",children:[i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("label",{className:"text-sm font-medium text-[#212529]",children:"Profile Photo"}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"relative",children:M?i.jsx("img",{src:M,alt:"Profile",className:"h-24 w-24 rounded-full object-cover ring-2 ring-[#C045FF]/20"}):i.jsx("div",{className:"h-24 w-24 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-2xl ring-2 ring-[#C045FF]/20",children:((qe=(ht=B.display_name)==null?void 0:ht.charAt(0))==null?void 0:qe.toUpperCase())||"?"})}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("input",{ref:D,type:"file",accept:"image/*",onChange:Fe,className:"hidden",id:"profile-photo-upload"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>{var Me;return(Me=D.current)==null?void 0:Me.click()},disabled:C,children:C?"Uploading...":M?"Change Photo":"Upload Photo"}),M&&i.jsx(oe,{variant:"ghost",size:"sm",onClick:be,disabled:C,className:"text-red-500 hover:text-red-600",children:"Remove Photo"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"JPG, PNG, GIF. Max 5MB."})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("label",{className:"text-sm font-medium text-[#212529]",children:"Cover Photo"}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsx("div",{className:"relative h-32 w-full overflow-hidden rounded-lg border-2 border-dashed border-[#E9ECEF]",children:I?i.jsx("img",{src:I,alt:"Cover",className:"h-full w-full object-cover"}):i.jsx("div",{className:"h-full w-full bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] flex items-center justify-center",children:i.jsx("span",{className:"text-sm text-[#6C757D]",children:"No cover photo"})})}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[i.jsx("input",{ref:V,type:"file",accept:"image/*",onChange:ae,className:"hidden",id:"cover-photo-upload"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>{var Me;return(Me=V.current)==null?void 0:Me.click()},disabled:L,children:L?"Uploading...":I?"Change Cover":"Upload Cover"}),I&&i.jsx(oe,{variant:"ghost",size:"sm",onClick:ge,disabled:L,className:"text-red-500 hover:text-red-600",children:"Remove Cover"}),i.jsx("p",{className:"w-full text-xs text-[#6C757D]",children:"Recommended: 1200x300px. JPG, PNG, GIF. Max 5MB."})]})]})]}),i.jsx(tt,{label:"Display name",placeholder:"Your Name",value:B.display_name,onChange:Me=>z({...B,display_name:Me.target.value})}),i.jsx(tt,{label:"Public username",placeholder:"@username",value:B.username,onChange:Me=>z({...B,username:Me.target.value})}),i.jsx(nr,{label:"Bio",placeholder:"Tell your fans what to expect...",value:B.bio,onChange:Me=>z({...B,bio:Me.target.value}),rows:4}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Category",placeholder:"e.g. Music, Tech",value:B.category,onChange:Me=>z({...B,category:Me.target.value})}),i.jsx(tt,{label:"Primary language",placeholder:"e.g. English",value:B.primary_language,onChange:Me=>z({...B,primary_language:Me.target.value})})]}),i.jsx(oe,{size:"lg",onClick:ue,disabled:l,children:l?"Saving...":"Save profile"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Contact settings",subtitle:"Well use this for payouts and urgent reminders."}),i.jsxs(Ee,{className:"gap-4",children:[i.jsx(tt,{label:"Contact email",placeholder:"email@example.com",value:ee.contact_email,onChange:Me=>ne({...ee,contact_email:Me.target.value})}),i.jsx(tt,{label:"Phone number",placeholder:"+1 234 567 8900",value:ee.phone_number,onChange:Me=>ne({...ee,phone_number:Me.target.value})}),i.jsxs("label",{className:"flex items-center gap-3 text-sm text-[#212529]",children:[i.jsx("input",{type:"checkbox",checked:ee.sms_alerts,onChange:Me=>ne({...ee,sms_alerts:Me.target.checked}),className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Send SMS alerts for high-value bids"]}),i.jsxs("label",{className:"flex items-center gap-3 text-sm text-[#212529]",children:[i.jsx("input",{type:"checkbox",checked:ee.share_calendar,onChange:Me=>ne({...ee,share_calendar:Me.target.checked}),className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Share calendar availability with FanMeet team"]}),i.jsx(oe,{variant:"secondary",className:"self-start",onClick:it,disabled:m,children:m?"Updating...":"Update contact info"})]})]})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Social Media Links",subtitle:"Add your social media profiles so fans can find and follow you."}),i.jsxs(Ee,{className:"gap-5",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Instagram",placeholder:"https://instagram.com/yourhandle",value:ye.instagram,onChange:Me=>me({...ye,instagram:Me.target.value})}),i.jsx(tt,{label:"YouTube",placeholder:"https://youtube.com/@yourhandle",value:ye.youtube,onChange:Me=>me({...ye,youtube:Me.target.value})})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Twitter / X",placeholder:"https://twitter.com/yourhandle",value:ye.twitter,onChange:Me=>me({...ye,twitter:Me.target.value})}),i.jsx(tt,{label:"LinkedIn",placeholder:"https://linkedin.com/in/yourprofile",value:ye.linkedin,onChange:Me=>me({...ye,linkedin:Me.target.value})})]}),i.jsx(tt,{label:"Website",placeholder:"https://yourwebsite.com",value:ye.website,onChange:Me=>me({...ye,website:Me.target.value})}),i.jsx(oe,{size:"lg",onClick:Se,disabled:x,children:x?"Saving...":"Save Social Links"})]})]}),i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Bank & Payout Details",subtitle:"Add your bank account or UPI for automatic withdrawals. Earnings are available 48 hours after event completion."}),i.jsxs(Ee,{className:"gap-5",children:[i.jsx("div",{className:"rounded-[12px] bg-[#F4E6FF]/60 p-4",children:i.jsxs("p",{className:"text-sm text-[#6C757D]",children:[" ",i.jsx("strong",{children:"Auto-withdrawal:"})," Your earnings (90% after platform fee) become available for withdrawal 48 hours after each event ends. Add either bank account OR UPI details below."]})}),i.jsxs("div",{className:"flex flex-col gap-4 rounded-xl border border-[#E9ECEF] p-4",children:[i.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[i.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#E9ECEF] text-sm font-bold text-[#495057]",children:"1"}),i.jsx("h3",{className:"font-semibold text-[#212529]",children:"Bank Transfer (NEFT/IMPS)"})]}),i.jsx(tt,{label:"Beneficiary Name",placeholder:"Name as per bank records",value:H.bank_account_name,onChange:Me=>J({...H,bank_account_name:Me.target.value})}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Account Number",placeholder:"e.g. 1234567890",type:"password",value:H.bank_account_number,onChange:Me=>J({...H,bank_account_number:Me.target.value})}),i.jsx(tt,{label:"Confirm Account Number",placeholder:"Re-enter account number",value:H.confirm_bank_account_number,onChange:Me=>J({...H,confirm_bank_account_number:Me.target.value})})]}),i.jsx(tt,{label:"IFSC Code",placeholder:"e.g. HDFC0001234",value:H.bank_ifsc,onChange:Me=>J({...H,bank_ifsc:Me.target.value.toUpperCase()}),maxLength:11})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"}),i.jsx("span",{className:"text-sm font-medium text-[#6C757D]",children:"OR USE UPI"}),i.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"})]}),i.jsxs("div",{className:"flex flex-col gap-4 rounded-xl border border-[#E9ECEF] p-4",children:[i.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[i.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#E9ECEF] text-sm font-bold text-[#495057]",children:"2"}),i.jsx("h3",{className:"font-semibold text-[#212529]",children:"UPI ID (VPA)"})]}),i.jsx(tt,{label:"UPI ID",placeholder:"e.g. username@oksbi",value:H.upi_id,onChange:Me=>J({...H,upi_id:Me.target.value})})]}),i.jsx(oe,{size:"lg",onClick:Ue,disabled:E,children:E?"Verifying & Saving...":"Save Payout Details"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Streaming & channel integrations",subtitle:"Connect tools to streamline your live experiences.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(Ee,{className:"gap-4",children:[he.map(Me=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:Me.platform}),i.jsx("span",{className:"text-sm text-[#6C757D]",children:Me.handle})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Xe,{variant:oSe[Me.status]??"default",children:Me.status}),i.jsx(oe,{variant:"ghost",size:"sm",children:"Manage"})]})]},Me.id)),he.length===0&&i.jsx("p",{className:"text-sm text-[#6C757D]",children:"No channels connected yet."}),i.jsx(oe,{variant:"ghost",className:"self-start",children:"+ Connect new channel"})]})]})]})}const lSe={},x7=r=>{let n;const o=new Set,l=(S,C)=>{const R=typeof S=="function"?S(n):S;if(!Object.is(R,n)){const M=n;n=C??(typeof R!="object"||R===null)?R:Object.assign({},n,R),o.forEach(G=>G(n,M))}},u=()=>n,y={setState:l,getState:u,getInitialState:()=>x,subscribe:S=>(o.add(S),()=>o.delete(S)),destroy:()=>{(lSe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},x=n=r(l,u,y);return y},dSe=r=>r?x7(r):x7;var JH={exports:{}},QH={},ZH={exports:{}},ez={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mp=O;function uSe(r,n){return r===n&&(r!==0||1/r===1/n)||r!==r&&n!==n}var hSe=typeof Object.is=="function"?Object.is:uSe,pSe=Mp.useState,mSe=Mp.useEffect,fSe=Mp.useLayoutEffect,gSe=Mp.useDebugValue;function _Se(r,n){var o=n(),l=pSe({inst:{value:o,getSnapshot:n}}),u=l[0].inst,m=l[1];return fSe(function(){u.value=o,u.getSnapshot=n,TN(u)&&m({inst:u})},[r,o,n]),mSe(function(){return TN(u)&&m({inst:u}),r(function(){TN(u)&&m({inst:u})})},[r]),gSe(o),o}function TN(r){var n=r.getSnapshot;r=r.value;try{var o=n();return!hSe(r,o)}catch{return!0}}function vSe(r,n){return n()}var ESe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?vSe:_Se;ez.useSyncExternalStore=Mp.useSyncExternalStore!==void 0?Mp.useSyncExternalStore:ESe;ZH.exports=ez;var ySe=ZH.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mb=O,xSe=ySe;function bSe(r,n){return r===n&&(r!==0||1/r===1/n)||r!==r&&n!==n}var wSe=typeof Object.is=="function"?Object.is:bSe,SSe=xSe.useSyncExternalStore,CSe=mb.useRef,TSe=mb.useEffect,NSe=mb.useMemo,RSe=mb.useDebugValue;QH.useSyncExternalStoreWithSelector=function(r,n,o,l,u){var m=CSe(null);if(m.current===null){var g={hasValue:!1,value:null};m.current=g}else g=m.current;m=NSe(function(){function y(M){if(!x){if(x=!0,S=M,M=l(M),u!==void 0&&g.hasValue){var G=g.value;if(u(G,M))return C=G}return C=M}if(G=C,wSe(S,M))return G;var I=l(M);return u!==void 0&&u(G,I)?G:(S=M,C=I)}var x=!1,S,C,R=o===void 0?null:o;return[function(){return y(n())},R===null?void 0:function(){return y(R())}]},[n,o,l,u]);var E=SSe(r,m[0],m[1]);return TSe(function(){g.hasValue=!0,g.value=E},[E]),RSe(E),E};JH.exports=QH;var ASe=JH.exports;const ISe=W7(ASe),tz={},{useDebugValue:DSe}=uA,{useSyncExternalStoreWithSelector:OSe}=ISe;let b7=!1;const jSe=r=>r;function PSe(r,n=jSe,o){(tz?"production":void 0)!=="production"&&o&&!b7&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),b7=!0);const l=OSe(r.subscribe,r.getState,r.getServerState||r.getInitialState,n,o);return DSe(l),l}const w7=r=>{(tz?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof r=="function"?dSe(r):r,o=(l,u)=>PSe(n,l,u);return Object.assign(o,n),o},kSe=r=>r?w7(r):w7,sz="fanmeet-demo-creator-dm-open",LSe=()=>typeof window>"u"?"open":window.localStorage.getItem(sz)==="closed"?"closed":"open",MSe=kSe(r=>({creatorDmStatus:LSe(),setCreatorDmStatus:n=>{typeof window<"u"&&window.localStorage.setItem(sz,n),r({creatorDmStatus:n})}}));function FSe(){const[r,n]=O.useState(""),{creatorDmStatus:o,setCreatorDmStatus:l}=MSe(),[u,m]=O.useState(null),{messages:g,sendMessage:E,markMessageAsRead:y}=Xg(),{user:x}=vs(),S=o==="open",C=O.useMemo(()=>{if(!x||!g)return[];const D=new Map;return g.forEach(V=>{const B=V.sender_id===x.id?V.receiver_id:V.sender_id,z=V.sender_id===x.id?V.receiver_display_name:V.sender_display_name,H=V.sender_id===x.id?V.receiver_username:V.sender_username,J=D.get(B),ee=!V.read&&V.receiver_id===x.id;J?(new Date(V.created_at)>new Date(J.lastTime)&&(J.lastMessage=V.message,J.lastTime=V.created_at),ee&&(J.unread+=1)):D.set(B,{id:B,participant:{id:B,name:z||"Unknown User",username:H||"unknown",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${z||"User"}`,status:"offline"},lastMessage:V.message,lastTime:V.created_at,unread:ee?1:0})}),Array.from(D.values()).sort((V,B)=>new Date(B.lastTime).getTime()-new Date(V.lastTime).getTime())},[g,x]),R=O.useMemo(()=>g.filter(D=>D.sender_id===(x==null?void 0:x.id)&&D.receiver_id===u||D.sender_id===u&&D.receiver_id===(x==null?void 0:x.id)),[g,x,u]);O.useEffect(()=>{u&&x&&R.filter(V=>!V.read&&V.receiver_id===x.id).forEach(V=>y(V.id))},[u,R,x,y]);const[M]=Gp(),[G,I]=O.useState(null);O.useEffect(()=>{const D=M.get("chatWith");D&&m(D)},[M]),O.useEffect(()=>{const D=C.some(V=>V.id===u);u&&!D&&(async()=>{if((G==null?void 0:G.id)===u)return;const{data:B}=await ie.from("profiles").select("user_id, display_name, username").eq("user_id",u).single();B&&I({id:B.user_id,participant:{id:B.user_id,name:B.display_name||B.username||"User",username:B.username||"user",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${B.display_name||B.username||"User"}`,status:"offline"},lastMessage:"",lastTime:new Date().toISOString(),unread:0})})()},[u,C,G]);const j=O.useMemo(()=>C.find(D=>D.id===u)||G,[C,u,G]),L=async D=>{if(D.preventDefault(),!(!r.trim()||!S||!u))try{await E(u,r),n("")}catch(V){console.error("Failed to send message:",V)}},N=()=>{l(S?"closed":"open")};return i.jsxs("div",{className:"flex h-[calc(100vh-140px)] flex-col gap-4 md:flex-row",children:[i.jsxs("div",{className:`flex w-full flex-col gap-3 md:w-80 ${j?"hidden md:flex":"flex"}`,children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Messages"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Chat with fans who have joined your FanMeets."})]}),i.jsxs(fe,{className:"flex h-full min-h-[260px] flex-col overflow-hidden",children:[i.jsxs(Te,{className:"flex flex-row items-center justify-between gap-2 border-b border-[#E9ECEF] pb-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Conversations"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Select a fan to view your chat."})]}),i.jsx(oe,{type:"button",size:"sm",variant:"secondary",className:"rounded-full px-3 text-[11px]",onClick:N,children:S?"Turn off DMs":"Turn on DMs"})]}),i.jsx(Ee,{className:"min-h-0 flex-1 gap-2 p-0",children:i.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[C.map(D=>{const V=D.id===u;return i.jsxs("button",{type:"button",onClick:()=>m(D.id),className:`mb-2 flex w-full items-center gap-3 rounded-[12px] border px-3 py-2 text-left text-sm transition-colors ${V?"border-[#C045FF] bg-[#F4E6FF] text-[#140423]":"border-[#E9ECEF] bg-white text-[#212529] hover:border-[#C045FF]/50 hover:bg-[#F8F5FF]"}`,children:[i.jsx(yi,{src:D.participant.avatar,alt:D.participant.name,initials:D.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsx("span",{className:"truncate text-[13px] font-semibold",children:D.participant.name}),i.jsx("span",{className:"whitespace-nowrap text-[11px] text-[#6C757D]",children:Bl(new Date(D.lastTime),"h:mm a")})]}),i.jsx("span",{className:"mt-0.5 line-clamp-1 text-[12px] text-[#6C757D]",children:D.lastMessage})]}),D.unread>0&&i.jsx("span",{className:"ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-[#C045FF] px-1 text-[11px] font-semibold text-white",children:D.unread})]},D.id)}),C.length===0&&i.jsx("p",{className:"pt-4 text-center text-xs text-[#6C757D]",children:"No fan conversations yet. Once a fan wins your FanMeet, their chat will appear here."})]})})]})]}),i.jsx(fe,{elevated:!0,className:`flex h-full w-full flex-1 flex-col overflow-hidden ${j?"flex":"hidden md:flex"}`,children:j?i.jsxs(i.Fragment,{children:[i.jsxs(Te,{className:"flex flex-row items-center justify-between gap-3 border-b border-[#E9ECEF] bg-white/80 py-3 backdrop-blur",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{type:"button",className:"flex h-8 w-8 items-center justify-center rounded-full border border-[#E9ECEF] bg-white text-sm text-[#343A40] md:hidden",onClick:()=>m(null),children:""}),i.jsx(yi,{src:j.participant.avatar,alt:j.participant.name,initials:j.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:j.participant.name}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#6C757D]",children:[i.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"}),i.jsx("span",{children:"Fan"})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(oe,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:i.jsx(YH,{className:"h-4 w-4","aria-hidden":"true"})}),i.jsx(oe,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:i.jsx(WH,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),i.jsxs(Ee,{className:"flex min-h-0 flex-1 flex-col p-0",children:[i.jsx("div",{className:"flex-1 space-y-4 overflow-y-auto bg-[#F8F9FA] p-4",children:R.map(D=>{var B;const V=D.sender_id===(x==null?void 0:x.id);return i.jsx("div",{className:`group my-2 flex gap-2 ${V?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`flex max-w-[80%] items-start gap-2 ${V?"flex-row-reverse":"flex-row"}`,children:[i.jsx(yi,{src:V?`https://api.dicebear.com/9.x/initials/svg?seed=${((B=x==null?void 0:x.user_metadata)==null?void 0:B.full_name)||"Me"}`:j.participant.avatar,alt:V?"Me":j.participant.name,initials:V?"Me":j.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{children:[i.jsx("div",{className:`rounded-2xl px-3 py-2 text-sm ${V?"border-2 border-transparent text-[#050014] shadow-[0_10px_30px_rgba(0,0,0,0.25)]":"border border-[#E9ECEF] bg-white text-[#212529]"}`,style:V?{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"}:void 0,children:D.message}),i.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-[#6C757D]",children:[i.jsx("time",{dateTime:D.created_at,children:Bl(new Date(D.created_at),"h:mm a")}),i.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(zH,{className:"h-3 w-3","aria-hidden":"true"})}),i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(BH,{className:"h-3 w-3","aria-hidden":"true"})}),!V&&i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:i.jsx(HH,{className:"h-3 w-3","aria-hidden":"true"})}),V&&i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:i.jsx(qH,{className:"h-3 w-3","aria-hidden":"true"})}),i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(GH,{className:"h-3 w-3","aria-hidden":"true"})})]})]})]})]})},D.id)})}),i.jsxs("div",{className:"border-t border-[#E9ECEF] bg-white p-3",children:[!S&&i.jsx("p",{className:"mb-2 text-xs font-medium text-[#E63946]",children:"You have turned off direct messages. Fans can still see past messages but cannot send you new DMs."}),i.jsxs("form",{onSubmit:L,className:"flex items-center gap-3",children:[i.jsx("input",{type:"text",value:r,onChange:D=>n(D.target.value),placeholder:S?"Type your message to this fan...":"DMs are currently turned off",disabled:!S,className:"h-11 flex-1 rounded-[12px] border-2 border-[#E9ECEF] bg-white px-4 text-sm text-[#212529] placeholder:text-[#ADB5BD] focus:border-[#C045FF] focus:shadow-[0_0_0_3px_rgba(192,69,255,0.18)] focus:outline-none disabled:cursor-not-allowed disabled:bg-[#F8F9FA]"}),i.jsx(oe,{type:"submit",size:"md",disabled:!S||!r.trim(),className:"px-5 text-sm",children:"Send"})]})]})]})]}):i.jsx("div",{className:"flex h-full flex-1 items-center justify-center bg-[#F8F9FA] p-6 text-center text-sm text-[#6C757D]",children:i.jsx("p",{className:"max-w-xs",children:"Select a fan conversation to start messaging. After your next FanMeet, their chat will appear here."})})})]})}const USe={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"};function VSe(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState(!1),[C,R]=O.useState(!0),[M,G]=O.useState(null),[I,j]=O.useState(""),[L,N]=O.useState(!1);O.useEffect(()=>{(async()=>{if(!r){R(!1);return}const{data:z,error:H}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at").eq("user_id",r.id).order("created_at",{ascending:!1});if(H||!z){console.error("Error fetching support tickets:",H),o([]),R(!1);return}o(z.map(J=>({id:J.id,subject:J.subject,description:J.description,status:J.status,createdAt:J.created_at,updatedAt:J.updated_at}))),R(!1)})()},[r]),O.useEffect(()=>{(async()=>{if(!M){u([]);return}const{data:z,error:H}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at").eq("ticket_id",M).order("created_at",{ascending:!0});if(H||!z){console.error("Error fetching replies:",H),u([]);return}u(z.map(J=>({id:J.id,message:J.message,isAdminReply:J.is_admin_reply,createdAt:J.created_at})))})()},[M]);const D=async()=>{if(!r||!M||!I.trim()){alert("Please enter a message.");return}N(!0);try{const{error:B}=await ie.from("ticket_replies").insert({ticket_id:M,user_id:r.id,message:I.trim(),is_admin_reply:!1});if(B){console.error("Error sending reply:",B),alert("Failed to send reply.");return}u(z=>[...z,{id:`temp-${Date.now()}`,message:I.trim(),isAdminReply:!1,createdAt:new Date().toISOString()}]),j(""),alert("Reply sent! Our support team will respond soon.")}finally{N(!1)}},V=async()=>{if(!r){alert("Please log in to raise a support ticket.");return}if(!m.trim()||!E.trim()){alert("Please enter a subject and description.");return}S(!0);try{const{data:B,error:z}=await ie.from("support_tickets").insert({user_id:r.id,subject:m.trim(),description:E.trim(),status:"open"}).select("id, subject, description, status, created_at, updated_at").single();if(z||!B){console.error("Error creating support ticket:",z),alert("Failed to create support ticket.");return}o(H=>[{id:B.id,subject:B.subject,description:B.description,status:B.status,createdAt:B.created_at,updatedAt:B.updated_at},...H]),g(""),y(""),alert("Support ticket created successfully. Our team will get back to you.")}finally{S(!1)}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs(fe,{children:[i.jsx(Te,{title:"Creator Support",subtitle:"Raise a ticket for payout issues, events, or other account questions."}),i.jsxs(Ee,{className:"gap-4",children:[i.jsx(nr,{label:"Subject",rows:2,placeholder:"Briefly describe your issue",value:m,onChange:B=>g(B.target.value)}),i.jsx(nr,{label:"Details",rows:5,placeholder:"Share as many details as possible, including event names, fans, dates, and screenshots where relevant.",value:E,onChange:B=>y(B.target.value)}),i.jsx(oe,{onClick:V,disabled:x,children:x?"Submitting":"Submit Ticket"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Your Tickets",subtitle:"Click a ticket to view the conversation and reply."}),i.jsx(Ee,{className:"flex flex-col gap-3",children:C?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading tickets"}):n.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"You have not raised any tickets yet."}):n.map(B=>i.jsxs("div",{children:[i.jsxs("button",{type:"button",onClick:()=>G(M===B.id?null:B.id),className:`w-full text-left rounded-[12px] border p-4 text-sm text-[#212529] transition-all ${M===B.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-white hover:border-[#C045FF]/50"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-semibold",children:B.subject}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Gt(B.createdAt)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Xe,{variant:USe[B.status],children:B.status.replace("_"," ")}),i.jsx("span",{className:"text-[#6C757D]",children:M===B.id?"":""})]})]}),i.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-[#6C757D] whitespace-pre-line",children:B.description})]}),M===B.id&&i.jsxs("div",{className:"mt-2 ml-4 border-l-2 border-[#C045FF] pl-4 space-y-4",children:[i.jsx("div",{className:"space-y-3",children:l.length===0?i.jsx("p",{className:"text-sm text-[#6C757D] py-2",children:"No replies yet. Our support team will respond soon."}):l.map(z=>i.jsxs("div",{className:`rounded-[10px] p-3 text-sm ${z.isAdminReply?"bg-[#F4E6FF] border-l-4 border-[#C045FF]":"bg-[#F8F9FA]"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[i.jsx("span",{className:`font-semibold ${z.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:z.isAdminReply?" Support Team":"You"}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Gt(z.createdAt)})]}),i.jsx("p",{className:"text-[#212529] whitespace-pre-line",children:z.message})]},z.id))}),B.status!=="closed"&&B.status!=="resolved"&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(nr,{label:"Reply to this ticket",rows:3,placeholder:"Type your message...",value:I,onChange:z=>j(z.target.value)}),i.jsx(oe,{size:"sm",onClick:D,disabled:L||!I.trim(),children:L?"Sending...":"Send Reply"})]}),(B.status==="closed"||B.status==="resolved")&&i.jsxs("p",{className:"text-sm text-[#6C757D] italic",children:["This ticket is ",B.status,". Create a new ticket if you need further assistance."]})]})]},B.id))})]})]})}function Iy(r){const n=new Date,o=new Date(r),l=n.getTime()-o.getTime(),u=Math.floor(l/6e4),m=Math.floor(u/60),g=Math.floor(m/24);return u<1?"just now":u<60?`${u} min${u>1?"s":""} ago`:m<24?`${m} hour${m>1?"s":""} ago`:`${g} day${g>1?"s":""} ago`}function BSe(){var D,V;const r=Ns(),[n,o]=O.useState(!0),[l,u]=O.useState(new Date),[m,g]=O.useState({totalUsers:0,activeEvents:0,liveNow:0,revenueThisMonth:0,commission:0,creators:0,fans:0,pendingWithdrawals:0,pendingWithdrawalsAmount:0,totalBids:0,bidsToday:0,refundsThisMonth:0}),[E,y]=O.useState({newFansToday:0,newCreatorsToday:0,activeMeetsNow:0,eventsEndingToday:0}),[x,S]=O.useState([]),[C,R]=O.useState([]),[M,G]=O.useState([]),[I,j]=O.useState([]),L=O.useCallback(async()=>{var B;o(!0);try{const z=new Date,H=new Date(z.getFullYear(),z.getMonth(),z.getDate()),J=new Date(z.getFullYear(),z.getMonth(),1),ee=new Date(z.getTime()+60*60*1e3),ne=new Date(z.getTime()-29*24*60*60*1e3),{count:he}=await ie.from("users").select("*",{count:"exact",head:!0}),{count:ve}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","creator"),{count:ye}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","fan"),{count:me}=await ie.from("events").select("*",{count:"exact",head:!0}).in("status",["live","upcoming"]),{count:ue}=await ie.from("events").select("*",{count:"exact",head:!0}).eq("status","live"),{data:Fe}=await ie.from("bids").select("amount, status, created_at").gte("created_at",J.toISOString()),be=(Fe??[]).filter(Tt=>Tt.status==="won"),ae=(Fe??[]).filter(Tt=>Tt.status==="lost"),ge=be.reduce((Tt,Ht)=>Tt+(Ht.amount??0),0),Se=[...be,...ae].reduce((Tt,Ht)=>Tt+(Ht.amount??0),0),it=Math.round(Se*.1),{data:Ue}=await ie.from("withdrawal_requests").select("amount").in("status",["pending","in_review"]),ht=(Ue==null?void 0:Ue.length)??0,qe=(Ue??[]).reduce((Tt,Ht)=>Tt+(Ht.amount??0),0),{count:Me}=await ie.from("bids").select("*",{count:"exact",head:!0}),{count:st}=await ie.from("bids").select("*",{count:"exact",head:!0}).gte("created_at",H.toISOString()),{data:De}=await ie.from("wallet_transactions").select("amount").eq("type","bid_refund").gte("created_at",J.toISOString()),Ae=(De??[]).reduce((Tt,Ht)=>Tt+(Ht.amount??0),0);g({totalUsers:he??0,activeEvents:me??0,liveNow:ue??0,revenueThisMonth:ge,commission:it,creators:ve??0,fans:ye??0,pendingWithdrawals:ht,pendingWithdrawalsAmount:qe,totalBids:Me??0,bidsToday:st??0,refundsThisMonth:Ae});const{count:Qe}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","fan").gte("created_at",H.toISOString()),{count:pe}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","creator").gte("created_at",H.toISOString()),Re=new Date(z.getTime()-30*60*1e3),Ge=new Date(z.getTime()+60*60*1e3),{count:xt}=await ie.from("meets").select("*",{count:"exact",head:!0}).eq("status","scheduled").gte("scheduled_at",Re.toISOString()).lte("scheduled_at",Ge.toISOString()),jt=new Date(H.getTime()+24*60*60*1e3),{count:Pt}=await ie.from("events").select("*",{count:"exact",head:!0}).gte("starts_at",H.toISOString()).lt("starts_at",jt.toISOString());y({newFansToday:Qe??0,newCreatorsToday:pe??0,activeMeetsNow:xt??0,eventsEndingToday:Pt??0});const rt=[],{count:Dt}=await ie.from("events").select("*",{count:"exact",head:!0}).gte("starts_at",z.toISOString()).lte("starts_at",ee.toISOString());(Dt??0)>0&&rt.push({id:"events-soon",emoji:"",text:`${Dt} event${Dt===1?"":"s"} starting in the next hour`,count:Dt??0}),ht>0&&rt.push({id:"pending-wd",emoji:"",text:`${ht} withdrawal request${ht===1?"":"s"} awaiting review`,count:ht});const{count:kt}=await ie.from("meets").select("*",{count:"exact",head:!0}).eq("status","completed").gte("updated_at",new Date(z.getTime()-24*60*60*1e3).toISOString());(kt??0)>0&&rt.push({id:"completed-meets",emoji:"",text:`${kt} meet${kt===1?"":"s"} completed in last 24h`,count:kt??0}),S(rt);const Os=[],{data:bn}=await ie.from("events").select("id, title, created_at, creator_id").order("created_at",{ascending:!1}).limit(3);if(bn&&bn.length>0){const Tt=bn.map(Jt=>Jt.creator_id),{data:Ht}=await ie.from("profiles").select("user_id, username").in("user_id",Tt),mr=new Map((Ht??[]).map(Jt=>[Jt.user_id,Jt.username]));for(const Jt of bn){const $r=mr.get(Jt.creator_id)||"creator";Os.push({id:`event-${Jt.id}`,emoji:"",text:`New event "${Jt.title}" by @${$r}`,time:Iy(Jt.created_at)})}}const{data:ei}=await ie.from("users").select("id, email, role, created_at").order("created_at",{ascending:!1}).limit(3);for(const Tt of ei??[]){const Ht=((B=Tt.email)==null?void 0:B.split("@")[0])||"User";Os.push({id:`user-${Tt.id}`,emoji:"",text:`New ${Tt.role} signup: ${Ht}`,time:Iy(Tt.created_at)})}const{data:Ti}=await ie.from("withdrawal_requests").select("id, amount, requested_at, creator_id").order("requested_at",{ascending:!1}).limit(3);if(Ti&&Ti.length>0){const Tt=Ti.map(Jt=>Jt.creator_id),{data:Ht}=await ie.from("profiles").select("user_id, username").in("user_id",Tt),mr=new Map((Ht??[]).map(Jt=>[Jt.user_id,Jt.username]));for(const Jt of Ti){const $r=mr.get(Jt.creator_id)||"creator";Os.push({id:`wd-${Jt.id}`,emoji:"",text:`Withdrawal request: ${We(Jt.amount)} by @${$r}`,time:Iy(Jt.requested_at)})}}const{data:Wr}=await ie.from("meets").select("id, event_id, updated_at").eq("status","completed").order("updated_at",{ascending:!1}).limit(2);if(Wr&&Wr.length>0){const Tt=Wr.map(Jt=>Jt.event_id),{data:Ht}=await ie.from("events").select("id, title").in("id",Tt),mr=new Map((Ht??[]).map(Jt=>[Jt.id,Jt.title]));for(const Jt of Wr){const $r=mr.get(Jt.event_id)||"Event";Os.push({id:`meet-${Jt.id}`,emoji:"",text:`Meet completed: "${$r}"`,time:Iy(Jt.updated_at)})}}Os.sort((Tt,Ht)=>0),R(Os.slice(0,8));const{data:ir}=await ie.from("bids").select("amount, created_at").eq("status","won").gte("created_at",ne.toISOString()),Ni=new Map;for(const Tt of ir??[]){const Ht=new Date(Tt.created_at).toISOString().slice(0,10),mr=Ni.get(Ht)??0;Ni.set(Ht,mr+(Tt.amount??0))}const ct=[];for(let Tt=0;Tt<30;Tt++){const Ht=new Date(ne);Ht.setDate(ne.getDate()+Tt);const mr=Ht.toISOString().slice(0,10);ct.push({date:mr,label:Ht.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}),value:Ni.get(mr)??0})}G(ct);const{data:$e}=await ie.from("bids").select("event_id, amount").eq("status","won").gte("created_at",J.toISOString());if($e&&$e.length>0){const Tt=[...new Set($e.map(Xr=>Xr.event_id))],{data:Ht}=await ie.from("events").select("id, creator_id").in("id",Tt),mr=new Map((Ht??[]).map(Xr=>[Xr.id,Xr.creator_id])),Jt=new Map;for(const Xr of $e){const si=mr.get(Xr.event_id);if(!si)continue;const Da=Jt.get(si)??0;Jt.set(si,Da+(Xr.amount??0))}const $r=Array.from(Jt.entries()).sort((Xr,si)=>si[1]-Xr[1]).slice(0,10),Jo=$r.map(([Xr])=>Xr),{data:ti}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",Jo),_u=new Map((ti??[]).map(Xr=>[Xr.user_id,Xr])),Eb=$r.map(([Xr,si])=>{const Da=_u.get(Xr);return{id:Xr,name:(Da==null?void 0:Da.display_name)||(Da==null?void 0:Da.username)||"Creator",earnings:si}});j(Eb)}else j([]);u(new Date)}finally{o(!1)}},[]);O.useEffect(()=>{L();const B=setInterval(L,6e4);return()=>clearInterval(B)},[L]);const N=Math.max(...M.map(B=>B.value),1);return i.jsxs("div",{className:"flex flex-col gap-10",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx(Xe,{variant:"primary",pill:!1,className:"mb-2 w-fit",children:" Admin Control Center"}),i.jsx("h1",{className:"text-3xl font-semibold text-[#1B1C1F]",children:"Platform Overview"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Real-time glance at health, revenue, and moderation signals across FanMeet."})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1",children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:L,disabled:n,children:n?" Refreshing":" Refresh"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Last updated: ",l.toLocaleTimeString()]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Total Users"}),className:"pb-2"}),i.jsxs(Ee,{className:"gap-2",children:[i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.totalUsers.toLocaleString()}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[m.fans," fans  ",m.creators," creators"]})]})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Active Events"}),className:"pb-2"}),i.jsxs(Ee,{className:"gap-2",children:[i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.activeEvents}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[m.liveNow," Live Now"]})]})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Winning Bid Volume (This Month)"}),className:"pb-2"}),i.jsx(Ee,{className:"gap-2",children:i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":We(m.revenueThisMonth)})})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Commission (10%)"}),className:"pb-2"}),i.jsx(Ee,{className:"gap-2",children:i.jsx("span",{className:"text-3xl font-bold text-[#28A745]",children:n?"":We(m.commission)})})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Creators"}),className:"pb-2"}),i.jsx(Ee,{className:"gap-2",children:i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.creators})})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Pending Withdrawals"}),className:"pb-2"}),i.jsxs(Ee,{className:"gap-2",children:[i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.pendingWithdrawals}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:We(m.pendingWithdrawalsAmount)})]})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Total Bids"}),className:"pb-2"}),i.jsxs(Ee,{className:"gap-2",children:[i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.totalBids.toLocaleString()}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Today: ",m.bidsToday]})]})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Refunds (This Month)"}),className:"pb-2"}),i.jsx(Ee,{className:"gap-2",children:i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":We(m.refundsThisMonth)})})]})]})]}),i.jsxs("section",{className:"grid gap-4 lg:grid-cols-2",children:[i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:"Quick Stats",subtitle:"Operational health snapshots"}),i.jsxs(Ee,{className:"gap-3",children:[i.jsxs("ul",{className:"flex flex-col gap-2 text-sm text-[#212529]",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),i.jsxs("span",{children:["New signups today: ",E.newFansToday," fans, ",E.newCreatorsToday," creators"]})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),i.jsxs("span",{children:["Active meets right now: ",E.activeMeetsNow]})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),i.jsxs("span",{children:["Events starting today: ",E.eventsEndingToday]})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),i.jsxs("span",{children:["Pending withdrawals: ",m.pendingWithdrawals]})]})]}),i.jsx(oe,{variant:"primary",className:"self-start bg-[#050014] text-white hover:bg-[#140423]",size:"sm",onClick:()=>r("/admin/business-analytics"),children:"View detailed reports "})]})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:"Alerts & Notifications",subtitle:"Attention-required items"}),i.jsxs(Ee,{className:"gap-3",children:[i.jsx("div",{className:"flex flex-col gap-3",children:x.length===0?i.jsx("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] px-4 py-3 text-sm text-[#6C757D]",children:" No urgent alerts at this time"}):x.map(B=>i.jsxs("div",{className:"rounded-[12px] border border-[#F4E6FF] bg-[#F4E6FF]/60 px-4 py-3 text-sm text-[#C045FF]",children:[B.emoji," ",B.text]},B.id))}),i.jsx(oe,{variant:"primary",size:"sm",className:"self-start bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/withdrawals"),children:"Review withdrawals"})]})]})]}),i.jsxs("section",{className:"grid gap-4 xl:grid-cols-2",children:[i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:"Revenue Trend",subtitle:"Total Revenue  Last 30 days"}),i.jsxs(Ee,{children:[i.jsx("div",{className:"flex h-48 items-end gap-1",children:M.map(B=>i.jsx("div",{className:"group relative flex-1",title:`${B.label}: ${We(B.value)}`,children:i.jsx("div",{className:"w-full rounded-t bg-[#C045FF] transition-all hover:bg-[#A030DD]",style:{height:`${Math.max(B.value/N*100,2)}%`,minHeight:B.value>0?"4px":"2px"}})},B.date))}),i.jsxs("div",{className:"mt-2 flex justify-between text-xs text-[#6C757D]",children:[i.jsx("span",{children:(D=M[0])==null?void 0:D.label}),i.jsx("span",{children:(V=M[M.length-1])==null?void 0:V.label})]})]})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:"Top Creators by Revenue",subtitle:"Top 10 creators this month"}),i.jsx(Ee,{children:I.length===0?i.jsx("div",{className:"flex h-48 items-center justify-center text-sm text-[#6C757D]",children:"No creator earnings this month yet"}):i.jsx("div",{className:"flex flex-col gap-2",children:I.map((B,z)=>i.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-[#E9ECEF] bg-white px-3 py-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-[#F4E6FF] text-xs font-bold text-[#C045FF]",children:z+1}),i.jsx("span",{className:"text-sm font-medium text-[#212529]",children:B.name})]}),i.jsx("span",{className:"text-sm font-semibold text-[#28A745]",children:We(B.earnings)})]},B.id))})})]})]}),i.jsxs("section",{className:"grid gap-4 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:"Recent Activity",subtitle:"Latest admin, user, and system events"}),i.jsx(Ee,{className:"divide-y divide-[#F0F1F3]",children:C.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No recent activity"}):C.map(B=>i.jsx("div",{className:"flex items-center justify-between py-3 text-sm text-[#212529]",children:i.jsxs("span",{children:[B.emoji," ",B.text,i.jsxs("span",{className:"ml-2 text-xs text-[#6C757D]",children:["(",B.time,")"]})]})},B.id))})]}),i.jsxs(fe,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Te,{title:"Quick Actions",subtitle:"Jump to critical modules"}),i.jsxs(Ee,{className:"gap-3",children:[i.jsx(oe,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/audit-logs"),children:" Review audit logs"}),i.jsx(oe,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/support-tickets"),children:" Open support queue"}),i.jsx(oe,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/withdrawals"),children:" Review withdrawals"}),i.jsx(oe,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/revenue-reports"),children:" Export revenue summary"})]})]})]})]})}function rz({currentPage:r,totalItems:n,itemsPerPage:o,onPageChange:l,onItemsPerPageChange:u}){const m=Math.ceil(n/o),g=(r-1)*o+1,E=Math.min(r*o,n),y=S=>{S>=1&&S<=m&&l(S)},x=()=>{const S=[];if(m<=5)for(let R=1;R<=m;R++)S.push(R);else if(r<=3){for(let R=1;R<=4;R++)S.push(R);S.push("..."),S.push(m)}else if(r>=m-2){S.push(1),S.push("...");for(let R=m-3;R<=m;R++)S.push(R)}else{S.push(1),S.push("...");for(let R=r-1;R<=r+1;R++)S.push(R);S.push("..."),S.push(m)}return S};return n===0?null:i.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between border-t border-[#E9ECEF] pt-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm text-[#6C757D]",children:[i.jsxs("span",{children:["Showing ",g," to ",E," of ",n," results"]}),i.jsx("span",{className:"mx-2",children:""}),i.jsxs("label",{htmlFor:"itemsPerPage",className:"flex items-center gap-2",children:[i.jsx("span",{children:"Show:"}),i.jsxs("select",{id:"itemsPerPage",value:o,onChange:S=>{u(Number(S.target.value)),l(1)},className:"rounded-[8px] border border-[#CED4DA] bg-white px-3 py-1.5 text-sm text-[#212529] focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",children:[i.jsx("option",{value:10,children:"10"}),i.jsx("option",{value:20,children:"20"}),i.jsx("option",{value:30,children:"30"}),i.jsx("option",{value:50,children:"50"})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>y(r-1),disabled:r===1,children:"Previous"}),i.jsx("div",{className:"flex items-center gap-1",children:x().map((S,C)=>typeof S=="number"?i.jsx("button",{onClick:()=>y(S),className:`h-8 min-w-[32px] rounded-[8px] px-2 text-sm font-medium transition-colors ${r===S?"bg-[#C045FF] text-white":"bg-white text-[#212529] hover:bg-[#F8F9FA] border border-[#E9ECEF]"}`,children:S},C):i.jsx("span",{className:"px-2 text-[#6C757D]",children:S},C))}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>y(r+1),disabled:r===m,children:"Next"})]})]})}const WSe=[{label:"All",value:"all"},{label:"Fans",value:"fan"},{label:"Creators",value:"creator"},{label:"Admins",value:"admin"}],GSe=[{label:"All",value:"all"},{label:"Active",value:"active"},{label:"Suspended",value:"suspended"},{label:"Banned",value:"banned"}];function HSe(){const[r,n]=O.useState([]),[o,l]=O.useState(!1),[u,m]=O.useState(""),[g,E]=O.useState("all"),[y,x]=O.useState("all"),[S,C]=O.useState(null),R=O.useRef(null),[M,G]=O.useState(1),[I,j]=O.useState(10),[L,N]=O.useState(""),[D,V]=O.useState(""),[B,z]=O.useState(""),[H,J]=O.useState(""),[ee,ne]=O.useState("all");O.useEffect(()=>{(async()=>{l(!0);try{const{data:Fe,error:be}=await ie.from("users").select("id, email, display_name, role, account_status, created_at, updated_at");if(be||!Fe){console.error("Error fetching users:",be),n([]);return}const{data:ae}=await ie.from("bids").select("event_id, fan_id, amount, status").eq("status","won"),ge=new Map;for(const qe of ae??[]){const Me=ge.get(qe.fan_id)??0;ge.set(qe.fan_id,Me+(qe.amount??0))}const{data:Se}=await ie.from("events").select("id, creator_id"),it=new Map((Se??[]).map(qe=>[qe.id,qe.creator_id])),Ue=new Map;for(const qe of ae??[]){const Me=it.get(qe.event_id);if(!Me)continue;const st=Ue.get(Me)??0;Ue.set(Me,st+(qe.amount??0))}const ht=Fe.map(qe=>{const Me=qe.display_name||(qe.email?qe.email.split("@")[0]:"User"),st=qe.role,De=qe.account_status??"active",Ae=ge.get(qe.id)??0,Qe=Ue.get(qe.id)??0;return{id:qe.id,email:qe.email,displayName:Me,role:st,accountStatus:De,joinedAt:qe.created_at,lastActiveAt:qe.updated_at,totalAmount:st==="fan"?Ae:st==="creator"?Qe:0}});n(ht),ht.length>0&&!S&&C(ht[0].id)}finally{l(!1)}})()},[S]);const he=O.useMemo(()=>{const ue=u.trim().toLowerCase();return r.filter(Fe=>{if(g!=="all"&&Fe.role!==g||y!=="all"&&Fe.accountStatus!==y)return!1;if(L){const be=new Date(Fe.joinedAt),ae=new Date(L);if(be<ae)return!1}if(D){const be=new Date(Fe.joinedAt),ae=new Date(D);if(ae.setHours(23,59,59,999),be>ae)return!1}if(B&&Fe.lastActiveAt){const be=new Date(Fe.lastActiveAt),ae=new Date(B);if(be<ae)return!1}if(H&&Fe.lastActiveAt){const be=new Date(Fe.lastActiveAt),ae=new Date(H);if(ae.setHours(23,59,59,999),be>ae)return!1}return ee==="verified"&&!Fe.lastActiveAt||ee==="unverified"&&Fe.lastActiveAt?!1:ue?Fe.displayName.toLowerCase().includes(ue)||Fe.email.toLowerCase().includes(ue)||Fe.id.toLowerCase().includes(ue):!0})},[r,u,g,y,L,D,B,H,ee]),ve=O.useMemo(()=>{const ue=(M-1)*I,Fe=ue+I;return he.slice(ue,Fe)},[he,M,I]),ye=O.useMemo(()=>r.find(ue=>ue.id===S)??null,[r,S]),me=async(ue,Fe)=>{const be={active:"Activate",suspended:"Suspend",banned:"Ban"};if(window.confirm(`${be[Fe]} ${ue.displayName}? This will update their account status.`)){l(!0);try{const{error:ge}=await ie.from("users").update({account_status:Fe}).eq("id",ue.id);if(ge){console.error("Error updating account status:",ge),alert("Failed to update account status.");return}n(Se=>Se.map(it=>it.id===ue.id?{...it,accountStatus:Fe}:it))}finally{l(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"All Users"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Search, filter, and take bulk actions across the entire user base."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",disabled:!0,children:"Export CSV"}),i.jsx(oe,{disabled:!0,children:"Send Notification"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Filters",subtitle:"Refine the user list by role, status, or activity."}),i.jsxs(Ee,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Search",placeholder:"Name, email, or ID",value:u,onChange:ue=>m(ue.target.value)}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{className:"text-xs font-semibold text-[#6C757D]",children:"Registration Date Range"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"date",value:L,onChange:ue=>N(ue.target.value),className:"flex-1 rounded-[12px] border border-[#CED4DA] px-3 py-2 text-sm focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",placeholder:"From"}),i.jsx("input",{type:"date",value:D,onChange:ue=>V(ue.target.value),className:"flex-1 rounded-[12px] border border-[#CED4DA] px-3 py-2 text-sm focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",placeholder:"To"})]})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{className:"text-xs font-semibold text-[#6C757D]",children:"Last Active Range"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"date",value:B,onChange:ue=>z(ue.target.value),className:"flex-1 rounded-[12px] border border-[#CED4DA] px-3 py-2 text-sm focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",placeholder:"From"}),i.jsx("input",{type:"date",value:H,onChange:ue=>J(ue.target.value),className:"flex-1 rounded-[12px] border border-[#CED4DA] px-3 py-2 text-sm focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",placeholder:"To"})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Roles"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:WSe.map(ue=>i.jsx("button",{className:`rounded-full border px-3 py-1 text-xs font-medium ${g===ue.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,type:"button",onClick:()=>E(ue.value),children:ue.label},ue.value))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:GSe.map(ue=>i.jsx("button",{className:`rounded-full border px-3 py-1 text-xs font-medium ${y===ue.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,type:"button",onClick:()=>x(ue.value),children:ue.label},ue.value))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Verification"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:[{label:"All",value:"all"},{label:"Verified",value:"verified"},{label:"Unverified",value:"unverified"}].map(ue=>i.jsx("button",{className:`rounded-full border px-3 py-1 text-xs font-medium ${ee===ue.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,type:"button",onClick:()=>ne(ue.value),children:ue.label},ue.value))})]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Users",subtitle:"Bulk manage accounts and view key metrics."}),i.jsxs(Ee,{className:"overflow-x-auto",children:[i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Select"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Name"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Email"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Role"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Joined"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Last Active"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent / Earned"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[ve.map(ue=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:i.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-[#CED4DA]"})}),i.jsx("td",{className:"py-3 text-[#212529]",children:ue.displayName}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:ue.email}),i.jsx("td",{className:"py-3 text-[#212529]",children:ue.role}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:ue.accountStatus==="active"?"success":ue.accountStatus==="suspended"?"warning":"danger",children:ue.accountStatus==="active"?"Active":ue.accountStatus==="suspended"?"Suspended":"Banned"})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:Gt(ue.joinedAt)}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:ue.lastActiveAt?Gt(ue.lastActiveAt):""}),i.jsx("td",{className:"py-3 text-[#212529]",children:ue.totalAmount>0?We(ue.totalAmount):""}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>{C(ue.id),setTimeout(()=>{var Fe;(Fe=R.current)==null||Fe.scrollIntoView({behavior:"smooth",block:"start"})},100)},children:"View"}),ue.accountStatus!=="banned"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>me(ue,ue.accountStatus==="suspended"?"active":"suspended"),children:ue.accountStatus==="suspended"?"Unsuspend":"Suspend"}),ue.accountStatus==="banned"?i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>me(ue,"active"),children:"Unban"}):i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>me(ue,"banned"),children:"Ban"})]})})]},ue.id)),he.length===0&&!o&&i.jsx("tr",{children:i.jsx("td",{colSpan:9,className:"py-6 text-center text-sm text-[#6C757D]",children:"No users match your filters."})})]})]}),i.jsx(rz,{currentPage:M,totalItems:he.length,itemsPerPage:I,onPageChange:G,onItemsPerPageChange:j})]})]}),i.jsx("div",{ref:R,children:i.jsxs(fe,{children:[i.jsx(Te,{title:ye?`User Detail  ${ye.displayName}`:"User Detail",subtitle:"Full profile view for context and actions."}),i.jsx(Ee,{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:ye?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsxs("div",{className:"grid gap-2 text-sm text-[#212529] md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Email"}),i.jsx("p",{children:ye.email})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Role"}),i.jsx(Xe,{variant:"primary",children:ye.role})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),i.jsx("p",{children:Gt(ye.joinedAt)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Last Active"}),i.jsx("p",{children:ye.lastActiveAt?Gt(ye.lastActiveAt):""})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Status"}),i.jsx(Xe,{variant:ye.accountStatus==="active"?"success":ye.accountStatus==="suspended"?"warning":"danger",children:ye.accountStatus==="active"?"Active":ye.accountStatus==="suspended"?"Suspended":"Banned"})]})]}),i.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:i.jsxs("div",{className:"rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:ye.role==="fan"?"Total Spent":ye.role==="creator"?"Total Earned":"Total Volume"}),i.jsx("p",{className:"text-xl font-semibold",children:ye.totalAmount>0?We(ye.totalAmount):""})]})})]}),i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Admin Actions"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>me(ye,ye.accountStatus==="active"?"suspended":"active"),children:ye.accountStatus==="suspended"?"Unsuspend Account":"Suspend Account"}),i.jsx(oe,{variant:"danger",onClick:()=>me(ye,"banned"),children:"Ban Account"}),i.jsx(oe,{variant:"primary",className:"mt-2 bg-purple-600 hover:bg-purple-700",onClick:async()=>{if(confirm(`Are you sure you want to log in as ${ye.displayName}? You will be logged out of your admin account.`))try{l(!0);const{data:ue,error:Fe}=await ie.functions.invoke("admin-impersonate-user",{body:{targetUserId:ye.id}});if(Fe)throw Fe;if(ue!=null&&ue.actionLink)window.location.href=ue.actionLink;else throw new Error("No login link returned")}catch(ue){console.error("Impersonation failed:",ue),alert("Failed to login as user: "+(ue.message||"Unknown error"))}finally{l(!1)}},children:"Login as User"})]})]})]}):i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Select a user from the table above to view details."})})]})})]})}const zSe=[{label:"All",value:"all"},{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"}],S7={pending:"primary",approved:"success",rejected:"danger"},C7={pending:"Pending",approved:"Approved",rejected:"Rejected"};function KSe(){const[r,n]=O.useState([]),[o,l]=O.useState(!1),[u,m]=O.useState(""),[g,E]=O.useState("all"),[y,x]=O.useState(null),[S,C]=O.useState(1),[R,M]=O.useState(10),G=async()=>{l(!0);try{const{data:z,error:H}=await ie.from("users").select("id, email, display_name, role, creator_profile_status, created_at").eq("role","creator");if(H||!z||z.length===0){H&&console.error("Error fetching creators:",H),n([]);return}const J=z.map(ge=>ge.id);let ee=[];if(J.length>0){const{data:ge}=await ie.from("profiles").select("user_id, username, display_name, bio, category, primary_language, profile_photo_url, cover_photo_url, instagram_url, youtube_url, twitter_url, linkedin_url, website_url").in("user_id",J);ee=ge??[]}const ne=new Map(ee.map(ge=>[ge.user_id,ge]));let he=[];if(J.length>0){const{data:ge}=await ie.from("creator_settings").select("user_id, phone_number").in("user_id",J);he=ge??[]}const ve=new Map(he.map(ge=>[ge.user_id,ge]));let ye=[];if(J.length>0){const{data:ge}=await ie.from("linked_channels").select("user_id, platform, handle").in("user_id",J);ye=ge??[]}const me=new Map;for(const ge of ye){const Se=me.get(ge.user_id)??{};ge.platform==="instagram"?Se.instagram=ge.handle:ge.platform==="youtube"?Se.youtube=ge.handle:ge.platform==="twitter"||ge.platform==="x"?Se.twitter=ge.handle:ge.platform==="linkedin"?Se.linkedin=ge.handle:ge.platform==="website"&&(Se.website=ge.handle),me.set(ge.user_id,Se)}const ue=new Map;for(const ge of ye){const Se=ue.get(ge.user_id)??[];Se.push({platform:ge.platform,handle:ge.handle}),ue.set(ge.user_id,Se)}let Fe=[];if(J.length>0){const{data:ge}=await ie.from("events").select("id, creator_id").in("creator_id",J);Fe=ge??[]}const be=new Map;for(const ge of Fe){const Se=ge.creator_id;be.set(Se,(be.get(Se)??0)+1)}const ae=z.map(ge=>{const Se=ne.get(ge.id),it=ve.get(ge.id),Ue=me.get(ge.id)??{},ht=(Se==null?void 0:Se.display_name)||ge.display_name||(ge.email?ge.email.split("@")[0]:"Creator"),qe=Se!=null&&Se.username?`@${Se.username}`:"@creator",Me=ge.creator_profile_status??"pending";return{id:ge.id,name:ht,username:qe,email:ge.email,joinedAt:ge.created_at,status:Me,phone:(it==null?void 0:it.phone_number)??null,bio:(Se==null?void 0:Se.bio)??null,instagram:(Se==null?void 0:Se.instagram_url)??Ue.instagram??null,youtube:(Se==null?void 0:Se.youtube_url)??Ue.youtube??null,twitter:(Se==null?void 0:Se.twitter_url)??Ue.twitter??null,linkedin:(Se==null?void 0:Se.linkedin_url)??Ue.linkedin??null,website:(Se==null?void 0:Se.website_url)??Ue.website??null,profilePhotoUrl:(Se==null?void 0:Se.profile_photo_url)??null,coverPhotoUrl:(Se==null?void 0:Se.cover_photo_url)??null,category:(Se==null?void 0:Se.category)??null,primaryLanguage:(Se==null?void 0:Se.primary_language)??null,channels:ue.get(ge.id)??[],totalEvents:be.get(ge.id)??0}});n(ae),x(ge=>{var Se;return ge??((Se=ae[0])==null?void 0:Se.id)??null})}finally{l(!1)}};O.useEffect(()=>{G()},[]);const I=O.useMemo(()=>{const z=u.trim().toLowerCase();return r.filter(H=>g!=="all"&&H.status!==g?!1:z?H.name.toLowerCase().includes(z)||H.email.toLowerCase().includes(z)||H.username.toLowerCase().includes(z):!0)},[r,u,g]),j=O.useMemo(()=>I.filter(z=>z.status==="pending"),[I]),L=O.useMemo(()=>I.filter(z=>z.status==="approved"),[I]),N=O.useMemo(()=>{const z=(S-1)*R,H=z+R;return L.slice(z,H)},[L,S,R]),D=O.useMemo(()=>I.find(z=>z.id===y)??null,[I,y]),V=async(z,H)=>{if(window.confirm(`${H==="approved"?"Approve":"Reject"} ${z.name}?`)){l(!0);try{const{error:ee}=await ie.from("users").update({creator_profile_status:H}).eq("id",z.id);if(ee){console.error("Error updating creator status:",ee),alert("Failed to update creator status.");return}const{error:ne}=await ie.from("profiles").update({creator_profile_status:H}).eq("user_id",z.id);ne&&console.error("Error updating creator status on profile:",ne),n(he=>he.map(ve=>ve.id===z.id?{...ve,status:H}:ve))}finally{l(!1)}}},B=z=>{try{return new Date(z).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"})}catch{return z}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Creator Approvals"}),i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Review new applications and manage existing creators."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",disabled:o,children:"Export"}),i.jsx(oe,{disabled:o,children:"Invite Creator"})]})]}),i.jsxs(fe,{className:"bg-[#2C2F33] text-white",children:[i.jsx(Te,{title:"Filters",subtitle:"Search and filter creators by status.",className:"border-b border-[#3A3D42]"}),i.jsxs(Ee,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:i.jsx(tt,{label:"Search",placeholder:"Name, username, or email",value:u,onChange:z=>m(z.target.value)})}),i.jsx("div",{className:"flex flex-col gap-3",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#ADB5BD]",children:"Status"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:zSe.map(z=>i.jsx("button",{type:"button",onClick:()=>E(z.value),className:`rounded-full border px-3 py-1 font-medium ${g===z.value?"border-[#C045FF] bg-[#3A1B4D] text-[#F7E9FF]":"border-[#3A3D42] bg-[#1F2124] text-[#ADB5BD] hover:border-[#C045FF]/60"}`,children:z.label},z.value))})]})})]})]}),i.jsxs(fe,{className:"bg-[#2C2F33] text-white",children:[i.jsx(Te,{title:"Pending Approval",subtitle:"Creators awaiting manual review before onboarding",className:"border-b border-[#3A3D42]"}),i.jsx(Ee,{className:"gap-6",children:o&&j.length===0?i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Loading pending creators"}):j.length===0?i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"No creators pending approval."}):j.map(z=>i.jsxs("div",{className:"rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-lg font-semibold",children:z.name}),i.jsx("div",{className:"text-sm text-[#ADB5BD]",children:z.username})]}),i.jsxs(Xe,{variant:"primary",children:["Joined ",B(z.joinedAt)]})]}),i.jsxs("div",{className:"mt-4 grid gap-3 text-sm text-[#ADB5BD] md:grid-cols-2",children:[i.jsxs("div",{children:["Email: ",z.email]}),i.jsxs("div",{children:["Phone: ",z.phone??"Not provided"]}),i.jsxs("div",{className:"md:col-span-2",children:["Bio: ",z.bio??"Not provided"]}),i.jsxs("div",{children:[" Instagram: ",z.instagram??"Not linked"]}),i.jsxs("div",{children:[" YouTube: ",z.youtube??"Not linked"]})]}),i.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[i.jsx(oe,{variant:"danger",onClick:()=>V(z,"rejected"),disabled:o,children:" Reject"}),i.jsx(oe,{onClick:()=>V(z,"approved"),disabled:o,children:" Approve"}),i.jsx(oe,{variant:"secondary",onClick:()=>x(z.id),disabled:o,children:"View details"})]})]},z.id))})]}),i.jsxs(fe,{className:"bg-[#2C2F33] text-white",children:[i.jsx(Te,{title:"Approved Creators"}),i.jsxs(Ee,{className:"overflow-x-auto",children:[i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#ADB5BD]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Username"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Joined"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[N.map(z=>i.jsxs("tr",{className:"border-b border-[#3A3D42]",children:[i.jsx("td",{className:"py-3 text-white",children:z.name}),i.jsx("td",{className:"py-3 text-[#ADB5BD]",children:z.username}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:S7[z.status],children:C7[z.status]})}),i.jsx("td",{className:"py-3 text-white",children:z.totalEvents}),i.jsx("td",{className:"py-3 text-[#ADB5BD]",children:B(z.joinedAt)}),i.jsx("td",{className:"py-3",children:i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>x(z.id),disabled:o,children:"View"})})]},z.id)),L.length===0&&!o&&i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#ADB5BD]",children:"No approved creators yet."})})]})]}),i.jsx(rz,{currentPage:S,totalItems:L.length,itemsPerPage:R,onPageChange:C,onItemsPerPageChange:M})]})]}),i.jsxs(fe,{className:"bg-[#2C2F33] text-white",children:[i.jsx(Te,{title:D?`Creator Detail  ${D.name}`:"Creator Detail",subtitle:"Full profile view and admin actions for this creator.",className:"border-b border-[#3A3D42]"}),i.jsx(Ee,{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:D?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid gap-4 rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6",children:[D.profilePhotoUrl||D.coverPhotoUrl?i.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Profile photo"}),D.profilePhotoUrl?i.jsx("img",{src:D.profilePhotoUrl,alt:"Profile",className:"mt-2 h-28 w-28 rounded-full object-cover ring-2 ring-white/10"}):i.jsx("p",{className:"mt-2 text-sm text-[#ADB5BD]",children:"Not provided"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Cover photo"}),D.coverPhotoUrl?i.jsx("img",{src:D.coverPhotoUrl,alt:"Cover",className:"mt-2 h-28 w-full rounded-[14px] object-cover ring-2 ring-white/10"}):i.jsx("p",{className:"mt-2 text-sm text-[#ADB5BD]",children:"Not provided"})]})]}):null,i.jsxs("div",{className:"grid gap-3 text-sm text-[#ADB5BD] md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Email"}),i.jsx("p",{className:"text-white",children:D.email})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Username"}),i.jsx("p",{className:"text-white",children:D.username})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Status"}),i.jsx(Xe,{variant:S7[D.status],children:C7[D.status]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),i.jsx("p",{className:"text-white",children:B(D.joinedAt)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Total Events"}),i.jsx("p",{className:"text-white",children:D.totalEvents})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Category"}),i.jsx("p",{className:"text-white",children:D.category??"Not provided"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Primary language"}),i.jsx("p",{className:"text-white",children:D.primaryLanguage??"Not provided"})]})]}),i.jsxs("div",{className:"grid gap-3 text-sm text-[#ADB5BD]",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Phone"}),i.jsx("p",{className:"text-white",children:D.phone??"Not provided"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Instagram"}),i.jsx("p",{className:"text-white",children:D.instagram??"Not linked"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"YouTube"}),i.jsx("p",{className:"text-white",children:D.youtube??"Not linked"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Twitter / X"}),i.jsx("p",{className:"text-white",children:D.twitter??"Not linked"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"LinkedIn"}),i.jsx("p",{className:"text-white",children:D.linkedin??"Not linked"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Website"}),i.jsx("p",{className:"text-white",children:D.website??"Not linked"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Bio"}),i.jsx("p",{className:"text-white",children:D.bio??"Not provided"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Linked channels"}),D.channels&&D.channels.length>0?i.jsx("div",{className:"mt-1 flex flex-col gap-1",children:D.channels.map((z,H)=>i.jsxs("div",{className:"text-white",children:[z.platform,": ",z.handle]},`${z.platform}-${H}`))}):i.jsx("p",{className:"text-white",children:"No channels linked"})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6 text-sm text-white",children:[i.jsx("p",{className:"text-[#ADB5BD]",children:"Admin Actions"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[D.status!=="approved"&&i.jsx(oe,{onClick:()=>V(D,"approved"),disabled:o,children:"Approve Creator"}),D.status!=="rejected"&&i.jsx(oe,{variant:"danger",onClick:()=>V(D,"rejected"),disabled:o,children:"Reject Creator"}),i.jsx(oe,{variant:"primary",className:"mt-2 bg-purple-600 hover:bg-purple-700",onClick:async()=>{if(confirm(`Are you sure you want to log in as ${D.name}? You will be logged out of your admin account.`))try{l(!0);const{data:z,error:H}=await ie.functions.invoke("admin-impersonate-user",{body:{targetUserId:D.id}});if(H)throw H;if(z!=null&&z.actionLink)window.location.href=z.actionLink;else throw new Error("No login link returned")}catch(z){console.error("Impersonation failed:",z),alert("Failed to login as user: "+(z.message||"Unknown error"))}finally{l(!1)}},children:"Login as Creator"})]})]})]}):i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Select a creator from the list above to view details."})})]})]})}const T7={segments:["High Spenders","Active Bidders","Inactive","Multiple Wins","Never Won","Refund Issues"],sortOptions:["Total Spent","Number of Bids","Wins Count","Join Date","Last Activity"]};function qSe(r){if(!r)return"No bids yet";const n=new Date(r),l=new Date().getTime()-n.getTime(),u=Math.floor(l/(1e3*60));if(u<1)return"Just now";if(u<60)return`${u} min ago`;const m=Math.floor(u/60);return m<24?`${m} h ago`:`${Math.floor(m/24)} d ago`}function N7(r,n,o,l){const u=n.find(j=>j.id===r);if(!u)return null;const m=o.filter(j=>j.fanId===r),g=m.length,E=m.reduce((j,L)=>j+(L.amount??0),0),y=m.reduce((j,L)=>Math.max(j,L.amount??0),0),x=m.filter(j=>j.status==="won").length,S=g>0?Math.round(x/g*100):0,C=m.filter(j=>j.status==="lost").reduce((j,L)=>j+Math.floor((L.amount??0)*.9),0),R=new Map;for(const j of m){const L=l[j.eventId],N=(L==null?void 0:L.category)||"General";R.set(N,(R.get(N)??0)+1)}const M=Array.from(R.entries()).sort((j,L)=>L[1]-j[1]).slice(0,3).map(([j])=>j),G=M.length>0?M.join(", "):"No data yet",I=m.slice().sort((j,L)=>new Date(L.createdAt).getTime()-new Date(j.createdAt).getTime()).slice(0,5).map(j=>{const L=l[j.eventId],D=new Date(j.createdAt).toLocaleDateString("en-IN",{month:"short",day:"2-digit"});let V;return j.status==="won"?V=" Won":j.status==="lost"?V=" Lost":j.status==="cancelled"?V="Cancelled":V=j.status,{date:D,event:(L==null?void 0:L.title)??"Event",amountLabel:We(j.amount??0),resultLabel:V}});return{profile:{id:u.id,code:u.code,name:u.name,email:u.email,phone:null,joinDate:Gt(u.joinedAt),preferredEvents:G,status:u.status,isVip:u.isVip,isFlagged:u.isFlagged},spending:{averageBid:g>0?E/g:0,highestBid:y,winRate:S,refundsTotal:C},bidHistory:I}}function YSe(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState({}),[g,E]=O.useState(null),[y,x]=O.useState(null),[S,C]=O.useState(!1),[R,M]=O.useState("");O.useEffect(()=>{(async()=>{var B;C(!0);try{const{data:z,error:H}=await ie.from("users").select("id, email, display_name, account_status, created_at, updated_at, is_vip, is_flagged_for_review").eq("role","fan");if(H||!z){console.error("Error fetching fans:",H),n([]),l([]),m({}),E(null),x(null);return}const{data:J}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at"),ee=(J??[]).map(ae=>({id:ae.id,fanId:ae.fan_id,eventId:ae.event_id,amount:ae.amount??0,status:ae.status,createdAt:ae.created_at})),ne=Array.from(new Set(ee.map(ae=>ae.eventId).filter(Boolean))),{data:he}=ne.length?await ie.from("events").select("id, title, category").in("id",ne):{data:null},ve={};for(const ae of he??[])ve[ae.id]={id:ae.id,title:ae.title,category:ae.category};const ye=new Map;for(const ae of ee){const ge=ye.get(ae.fanId)??[];ge.push(ae),ye.set(ae.fanId,ge)}const me=new Date,ue=z.map(ae=>{const ge=ye.get(ae.id)??[],Se=ge.filter(Ae=>Ae.status==="won").reduce((Ae,Qe)=>Ae+(Qe.amount??0),0),it=ge.length,Ue=ge.filter(Ae=>Ae.status==="won").length,ht=ge.reduce((Ae,Qe)=>Ae?new Date(Qe.createdAt)>new Date(Ae.createdAt)?Qe:Ae:Qe,null),qe=ht?ht.createdAt:null;let Me="Inactive";if(!qe)Me="Inactive";else{const Ae=(me.getTime()-new Date(qe).getTime())/864e5;Ae<=7?Me="Active":Ae<=30?Me="At risk":Me="Inactive"}const st=`#F-${String(ae.id).slice(0,4).toUpperCase()}`,De=ae.display_name||(ae.email?ae.email.split("@")[0]:"Fan");return{id:ae.id,code:st,name:De,email:ae.email,totalSpent:Se,bids:it,wins:Ue,lastBidAt:qe,status:Me,joinedAt:ae.created_at,isVip:ae.is_vip??!1,isFlagged:ae.is_flagged_for_review??!1}});ue.sort((ae,ge)=>ge.totalSpent-ae.totalSpent);const Fe=((B=ue[0])==null?void 0:B.id)??null,be=Fe?N7(Fe,ue,ee,ve):null;n(ue),l(ee),m(ve),E(Fe),x(be)}finally{C(!1)}})()},[]);const G=O.useMemo(()=>{const V=R.trim().toLowerCase();let B=[...r];return V&&(B=B.filter(z=>z.name.toLowerCase().includes(V)||z.email.toLowerCase().includes(V)||z.code.toLowerCase().includes(V))),B.sort((z,H)=>H.totalSpent-z.totalSpent),B},[r,R]),I=V=>{E(V);const B=N7(V,r,o,u);x(B)},j=async(V,B)=>{const z=window.prompt(`Enter offer amount () to send to ${B}:`,"100");if(!z)return;const H=parseInt(z,10);if(isNaN(H)||H<=0){alert("Please enter a valid amount.");return}C(!0);try{const{error:J}=await ie.from("fan_offers").insert({fan_id:V,offer_type:"discount",offer_details:`${H} discount offer`,status:"pending",expires_at:new Date(Date.now()+6048e5).toISOString()});if(J){console.error("Error creating offer:",J),alert("Failed to send offer.");return}alert(`Offer of ${H} sent to ${B}!`)}finally{C(!1)}},L=async()=>{if(!g||!y)return;const V=window.prompt(`Enter loyalty reward amount () to add to ${y.profile.name}'s wallet:`,"500");if(!V)return;const B=parseInt(V,10);if(isNaN(B)||B<=0){alert("Please enter a valid amount.");return}C(!0);try{const{error:z}=await ie.from("loyalty_rewards").insert({fan_id:g,reward_type:"credits",amount:B,description:`Loyalty reward of ${B}`});if(z){console.error("Error creating loyalty reward:",z),alert("Failed to create loyalty reward record.");return}const{data:H}=await ie.from("wallets").select("id, balance").eq("user_id",g).maybeSingle();H?await ie.from("wallets").update({balance:(H.balance??0)+B}).eq("id",H.id):await ie.from("wallets").insert({user_id:g,balance:B}),alert(`Loyalty reward of ${B} added to ${y.profile.name}'s wallet!`)}finally{C(!1)}},N=async()=>{if(!g||!y)return;const V=y.profile.isVip,B=V?"remove VIP status from":"grant VIP status to";if(window.confirm(`${B} ${y.profile.name}?`)){C(!0);try{const{error:H}=await ie.from("users").update({is_vip:!V}).eq("id",g);if(H){console.error("Error updating VIP status:",H),alert("Failed to update VIP status.");return}n(J=>J.map(ee=>ee.id===g?{...ee,isVip:!V}:ee)),x(J=>J?{...J,profile:{...J.profile,isVip:!V}}:null),alert(`${y.profile.name} ${V?"removed from":"marked as"} VIP!`)}finally{C(!1)}}},D=async()=>{if(!g||!y)return;const V=y.profile.isFlagged;let B=null;if(V){if(!window.confirm(`Remove flag from ${y.profile.name}?`))return}else if(B=window.prompt("Enter reason for flagging this fan for review:"),B===null)return;C(!0);try{const{error:z}=await ie.from("users").update({is_flagged_for_review:!V,flagged_reason:V?null:B}).eq("id",g);if(z){console.error("Error updating flag status:",z),alert("Failed to update flag status.");return}n(H=>H.map(J=>J.id===g?{...J,isFlagged:!V}:J)),x(H=>H?{...H,profile:{...H.profile,isFlagged:!V}}:null),alert(`${y.profile.name} ${V?"unflagged":"flagged for review"}!`)}finally{C(!1)}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Fans Management"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Surface high-value fans, address churn risk, and track spending patterns."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",children:"Create Segment"}),i.jsx(oe,{children:"Send Campaign"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Filters",subtitle:"Mix and match segments to focus on specific fan cohorts."}),i.jsxs(Ee,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Search Fans",placeholder:"Name, email, or ID",value:R,onChange:V=>M(V.target.value)}),i.jsx(tt,{label:"Date Range",placeholder:"Last activity"}),i.jsx(tt,{label:"Total Spent",placeholder:"> 5,000"}),i.jsx(tt,{label:"Win Rate",placeholder:"> 20%"})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Segments"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:T7.segments.map(V=>i.jsx(Xe,{variant:"primary",children:V},V))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Sort By"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:T7.sortOptions.map(V=>i.jsx(Xe,{variant:"warning",children:V},V))})]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Fan Leaderboard",subtitle:"Compare engagement, wins, and spend at a glance."}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Fan"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Email"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Wins"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Last Bid"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsx("tbody",{children:G.map(V=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("span",{className:"font-medium",children:[V.name,V.isVip&&i.jsx("span",{className:"ml-1 text-xs text-[#FFD700]",children:" VIP"}),V.isFlagged&&i.jsx("span",{className:"ml-1 text-xs text-[#DC3545]",children:""})]}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:V.code})]})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:V.email}),i.jsx("td",{className:"py-3 text-[#212529]",children:We(V.totalSpent)}),i.jsx("td",{className:"py-3 text-[#212529]",children:V.bids}),i.jsx("td",{className:"py-3 text-[#212529]",children:V.wins}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:qSe(V.lastBidAt)}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:V.status==="Active"?"success":V.status==="At risk"?"warning":"danger",children:V.status})}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>I(V.id),children:"View Profile"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>j(V.id,V.name),disabled:S,children:"Send Offer"})]})})]},V.id))})]})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Fan Detail",subtitle:"Deep dive into engagement and outcomes for a specific fan."}),i.jsx(Ee,{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]",children:y?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Name / ID"}),i.jsx("p",{children:y.profile.name}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:y.profile.code})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Email"}),i.jsx("p",{children:y.profile.email})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Phone"}),i.jsx("p",{children:y.profile.phone??"Not provided"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),i.jsx("p",{children:y.profile.joinDate})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Status"}),i.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.jsx(Xe,{variant:y.profile.status==="Active"?"success":y.profile.status==="At risk"?"warning":"danger",children:y.profile.status}),y.profile.isVip&&i.jsx(Xe,{variant:"warning",children:" VIP"}),y.profile.isFlagged&&i.jsx(Xe,{variant:"danger",children:" Flagged"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Preferences"}),i.jsx("p",{children:y.profile.preferredEvents})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Spending Pattern"}),i.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Average Bid"}),i.jsx("p",{className:"text-lg font-semibold",children:We(y.spending.averageBid)})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Highest Bid"}),i.jsx("p",{className:"text-lg font-semibold",children:We(y.spending.highestBid)})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Win Rate"}),i.jsxs("p",{className:"text-lg font-semibold",children:[y.spending.winRate,"%"]})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Refunds"}),i.jsx("p",{className:"text-lg font-semibold",children:We(y.spending.refundsTotal)})]})]})]})]}),i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Recent Bid History"}),i.jsx("ul",{className:"mt-2 space-y-2",children:y.bidHistory.map(V=>i.jsxs("li",{className:"flex items-center justify-between rounded-[10px] bg-[#F8F9FA] px-3 py-2",children:[i.jsxs("span",{children:[i.jsx("strong",{children:V.date}),"  ",V.event]}),i.jsxs("span",{children:[V.amountLabel," ",V.resultLabel]})]},`${V.date}-${V.event}-${V.amountLabel}`))})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:L,disabled:S,children:" Send Loyalty Reward"}),i.jsx(oe,{variant:y.profile.isVip?"ghost":"primary",onClick:N,disabled:S,children:y.profile.isVip?" Remove VIP":" Mark as VIP"}),i.jsx(oe,{variant:y.profile.isFlagged?"secondary":"danger",onClick:D,disabled:S,children:y.profile.isFlagged?" Unflag":" Flag for Review"})]})]})]}):i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Select a fan from the leaderboard above to view detailed stats."})})]})]})}const $Se={live:{label:" LIVE",variant:"danger"},upcoming:{label:" Upcoming",variant:"primary"},completed:{label:" Completed",variant:"success"},cancelled:{label:" Cancelled",variant:"danger"},draft:{label:" Draft",variant:"warning"}};function XSe(){const[r,n]=O.useState([]),[o,l]=O.useState(null),[u,m]=O.useState(!1),[g,E]=O.useState(""),[y,x]=O.useState("all"),S=async()=>{m(!0);try{const{data:j,error:L}=await ie.from("events").select("id, creator_id, title, description, status, base_price, starts_at, duration_minutes, category, meeting_link").order("created_at",{ascending:!1});if(L||!j){console.error("Error fetching events:",L),n([]);return}const N=Array.from(new Set(j.map(J=>J.creator_id))),{data:D}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",N),V=new Map;for(const J of D??[])V.set(J.user_id,{displayName:J.display_name||J.username||"Creator",username:J.username||"creator"});const{data:B}=await ie.from("bids").select("event_id, amount"),z=new Map;for(const J of B??[]){const ee=z.get(J.event_id)??{count:0,highest:0};z.set(J.event_id,{count:ee.count+1,highest:Math.max(ee.highest,J.amount??0)})}const H=j.map(J=>{const ee=V.get(J.creator_id),ne=z.get(J.id)??{count:0,highest:0};return{id:J.id,code:`#E-${J.id.slice(0,4).toUpperCase()}`,creatorId:J.creator_id,creatorName:(ee==null?void 0:ee.displayName)??"Unknown",title:J.title,status:J.status,bidsCount:ne.count,highestBid:ne.highest,basePrice:J.base_price??0,startsAt:J.starts_at,category:J.category??"general"}});n(H)}finally{m(!1)}};O.useEffect(()=>{S()},[]);const C=O.useMemo(()=>{let j=[...r];y!=="all"&&(j=j.filter(N=>N.status===y));const L=g.trim().toLowerCase();return L&&(j=j.filter(N=>N.title.toLowerCase().includes(L)||N.creatorName.toLowerCase().includes(L)||N.code.toLowerCase().includes(L))),j},[r,y,g]),R=async j=>{const L=r.find(V=>V.id===j);if(!L)return;const{data:N}=await ie.from("events").select("*").eq("id",j).single(),{data:D}=await ie.from("users").select("email").eq("id",L.creatorId).single();N&&l({id:N.id,code:`#E-${N.id.slice(0,4).toUpperCase()}`,title:N.title,description:N.description,creatorName:L.creatorName,creatorEmail:(D==null?void 0:D.email)??"N/A",status:N.status,category:N.category??"general",basePrice:N.base_price??0,highestBid:L.highestBid,bidsCount:L.bidsCount,startsAt:N.starts_at,durationMinutes:N.duration_minutes,meetingLink:N.meeting_link})},M=async j=>{if(window.confirm("Are you sure you want to cancel this event?")){m(!0);try{const{error:N}=await ie.from("events").update({status:"cancelled"}).eq("id",j);if(N){console.error("Error cancelling event:",N),alert("Failed to cancel event.");return}await S(),l(null),alert("Event cancelled successfully.")}finally{m(!1)}}},G=async j=>{if(window.confirm("Are you sure you want to DELETE this event? This cannot be undone.")){m(!0);try{await ie.from("bids").delete().eq("event_id",j);const{error:N}=await ie.from("events").delete().eq("id",j);if(N){console.error("Error deleting event:",N),alert("Failed to delete event.");return}await S(),l(null),alert("Event deleted successfully.")}finally{m(!1)}}},I=j=>$Se[j]??{label:j,variant:"secondary"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Events Management"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track live, upcoming, and completed events."})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:["all","live","upcoming","completed","cancelled"].map(j=>i.jsx(oe,{variant:y===j?"secondary":"ghost",size:"sm",onClick:()=>x(j),children:j==="all"?"All":j.charAt(0).toUpperCase()+j.slice(1)},j))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Events",subtitle:`${C.length} events found`}),i.jsxs(Ee,{children:[i.jsx("div",{className:"mb-4",children:i.jsx(tt,{label:"Search Events",placeholder:"Search by title, creator, or ID...",value:g,onChange:j=>E(j.target.value)})}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event Title"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Highest Bid"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Starts At"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[C.map(j=>{const L=I(j.status);return i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:j.code}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:j.creatorName}),i.jsx("td",{className:"py-3 text-[#212529]",children:j.title}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:L.variant,children:L.label})}),i.jsx("td",{className:"py-3 text-[#212529]",children:j.bidsCount}),i.jsx("td",{className:"py-3 text-[#212529]",children:j.highestBid>0?We(j.highestBid):We(j.basePrice)}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:Gt(j.startsAt)}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>R(j.id),disabled:u,children:"View"}),j.status!=="cancelled"&&j.status!=="completed"&&i.jsx(oe,{variant:"danger",size:"sm",onClick:()=>M(j.id),disabled:u,children:"Cancel"})]})})]},j.id)}),C.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:8,className:"py-8 text-center text-[#6C757D]",children:u?"Loading events...":"No events found"})})]})]})})]})]}),o&&i.jsxs(fe,{children:[i.jsx(Te,{title:"Event Details",subtitle:o.code}),i.jsx(Ee,{children:i.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:o.title}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:o.description||"No description"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Creator"}),i.jsx("p",{className:"font-medium",children:o.creatorName}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:o.creatorEmail})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Category"}),i.jsx("p",{className:"font-medium capitalize",children:o.category})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Base Price"}),i.jsx("p",{className:"font-medium",children:We(o.basePrice)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Highest Bid"}),i.jsx("p",{className:"font-medium",children:We(o.highestBid)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Total Bids"}),i.jsx("p",{className:"font-medium",children:o.bidsCount})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Duration"}),i.jsxs("p",{className:"font-medium",children:[o.durationMinutes," min"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Status"}),i.jsx(Xe,{variant:I(o.status).variant,children:I(o.status).label})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Starts At"}),i.jsx("p",{className:"font-medium",children:Gt(o.startsAt)})]})]}),o.meetingLink&&i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Meeting Link"}),i.jsx("a",{href:o.meetingLink,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 underline",children:o.meetingLink})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"font-semibold text-[#212529]",children:"Admin Actions"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[o.status!=="cancelled"&&o.status!=="completed"&&i.jsx(oe,{variant:"danger",onClick:()=>M(o.id),disabled:u,children:" Cancel Event"}),i.jsx(oe,{variant:"ghost",onClick:()=>G(o.id),disabled:u,children:" Delete Event Permanently"}),i.jsx(oe,{variant:"secondary",onClick:()=>l(null),children:"Close Details"})]})]})]})})]})]})}function JSe(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState(!1),g=async()=>{m(!0);try{const{data:C}=await ie.from("featured_creators").select("id, creator_id, display_order, featured_since, is_active").eq("is_active",!0).order("display_order",{ascending:!0}),R=(C??[]).map(ne=>ne.creator_id),{data:M}=await ie.from("users").select("id, email, display_name").eq("role","creator"),G=(M??[]).map(ne=>ne.id),{data:I}=await ie.from("profiles").select("user_id, display_name, username, category").in("user_id",G),j=new Map;for(const ne of I??[])j.set(ne.user_id,ne);const{data:L}=await ie.from("events").select("id, creator_id"),N=new Map;for(const ne of L??[])N.set(ne.creator_id,(N.get(ne.creator_id)??0)+1);const{data:D}=await ie.from("meets").select("creator_id, status").eq("status","completed"),V=new Map;for(const ne of D??[])V.set(ne.creator_id,(V.get(ne.creator_id)??0)+1);const{data:B}=await ie.from("bids").select("event_id, amount, status").eq("status","won"),z=new Map;for(const ne of L??[])z.set(ne.id,ne.creator_id);const H=new Map;for(const ne of B??[]){const he=z.get(ne.event_id);he&&H.set(he,(H.get(he)??0)+(ne.amount??0))}const J=(C??[]).map(ne=>{const he=j.get(ne.creator_id);return{id:ne.id,creatorId:ne.creator_id,name:(he==null?void 0:he.display_name)||(he==null?void 0:he.username)||"Creator",username:he!=null&&he.username?`@${he.username}`:"@creator",category:(he==null?void 0:he.category)||"general",totalEarnings:H.get(ne.creator_id)??0,eventsCount:N.get(ne.creator_id)??0,featuredSince:ne.featured_since,displayOrder:ne.display_order}}),ee=(M??[]).filter(ne=>!R.includes(ne.id)).map(ne=>{const he=j.get(ne.id);return{id:ne.id,name:(he==null?void 0:he.display_name)||(he==null?void 0:he.username)||ne.display_name||"Creator",username:he!=null&&he.username?`@${he.username}`:"@creator",category:(he==null?void 0:he.category)||"general",eventsCount:N.get(ne.id)??0,completedMeets:V.get(ne.id)??0,totalEarnings:H.get(ne.id)??0}}).sort((ne,he)=>he.totalEarnings-ne.totalEarnings);n(J),l(ee)}finally{m(!1)}};O.useEffect(()=>{g()},[]);const E=async(C,R)=>{if(window.confirm(`Add ${R} to featured creators?`)){m(!0);try{const G=r.reduce((j,L)=>Math.max(j,L.displayOrder),0),{error:I}=await ie.from("featured_creators").insert({creator_id:C,display_order:G+1,is_active:!0});if(I){console.error("Error featuring creator:",I),alert("Failed to feature creator.");return}await g(),alert(`${R} is now featured!`)}finally{m(!1)}}},y=async(C,R)=>{if(window.confirm(`Remove ${R} from featured creators?`)){m(!0);try{const{error:G}=await ie.from("featured_creators").update({is_active:!1}).eq("id",C);if(G){console.error("Error removing featured creator:",G),alert("Failed to remove featured creator.");return}await g(),alert(`${R} removed from featured.`)}finally{m(!1)}}},x=async(C,R)=>{if(!(R<=1)){m(!0);try{const M=r.find(G=>G.displayOrder===R-1);M&&await ie.from("featured_creators").update({display_order:R}).eq("id",M.id),await ie.from("featured_creators").update({display_order:R-1}).eq("id",C),await g()}finally{m(!1)}}},S=async(C,R)=>{const M=r.reduce((G,I)=>Math.max(G,I.displayOrder),0);if(!(R>=M)){m(!0);try{const G=r.find(I=>I.displayOrder===R+1);G&&await ie.from("featured_creators").update({display_order:R}).eq("id",G.id),await ie.from("featured_creators").update({display_order:R+1}).eq("id",C),await g()}finally{m(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Featured Creators"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control homepage placement, scheduling, and promotion of spotlighted creators."})]})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Featured Creators",subtitle:`${r.length} creators featured  Priority influences homepage carousel`}),i.jsxs(Ee,{className:"space-y-4",children:[r.length===0&&!u&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No featured creators yet. Add creators from the candidate pool below."}),r.map((C,R)=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>x(C.id,C.displayOrder),disabled:u||R===0,children:""}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>S(C.id,C.displayOrder),disabled:u||R===r.length-1,children:""})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"text-sm text-[#6C757D]",children:["#",R+1]}),i.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:C.name}),i.jsx("div",{className:"text-sm text-[#6C757D]",children:C.username})]})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-[#6C757D]",children:[i.jsxs("div",{children:["Category ",i.jsx("span",{className:"font-semibold capitalize text-[#212529]",children:C.category})]}),i.jsxs("div",{children:["Events ",i.jsx("span",{className:"font-semibold text-[#212529]",children:C.eventsCount})]}),i.jsxs("div",{children:["Earned ",i.jsx("span",{className:"font-semibold text-[#212529]",children:We(C.totalEarnings)})]}),i.jsxs(Xe,{variant:"primary",children:["Featured since ",new Date(C.featuredSince).toLocaleDateString("en-IN",{month:"short",day:"numeric",year:"numeric"})]})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:i.jsx(oe,{size:"sm",variant:"danger",onClick:()=>y(C.id,C.name),disabled:u,children:"Remove"})})]},C.id))]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Candidate Pool",subtitle:"High-performing creators eligible for featuring."}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Category"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Completed Meets"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Earnings"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[o.map(C=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-medium text-[#212529]",children:C.name}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:C.username})]})}),i.jsx("td",{className:"py-3 capitalize text-[#212529]",children:C.category}),i.jsx("td",{className:"py-3 text-[#212529]",children:C.eventsCount}),i.jsx("td",{className:"py-3 text-[#212529]",children:C.completedMeets}),i.jsx("td",{className:"py-3 text-[#212529]",children:We(C.totalEarnings)}),i.jsx("td",{className:"py-3",children:i.jsx("div",{className:"flex gap-2 text-xs",children:i.jsx(oe,{size:"sm",variant:"primary",onClick:()=>E(C.id,C.name),disabled:u,children:" Feature"})})})]},C.id)),o.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-8 text-center text-[#6C757D]",children:u?"Loading creators...":"No candidates available"})})]})]})})]})]})}const Bf={all:"All Users",fans:"Fans Only",creators:"Creators Only"},QSe={notification:"In-App Notification",banner:"Banner",modal:"Modal",email:"Email"},R7={draft:"warning",active:"success",expired:"danger",cancelled:"danger"};function ZSe(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState("all"),[C,R]=O.useState("notification"),[M,G]=O.useState(""),I=async()=>{u(!0);try{const{data:ee,error:ne}=await ie.from("admin_announcements").select("*").order("created_at",{ascending:!1});if(ne){console.error("Error fetching announcements:",ne),o([]);return}const he=(ee??[]).map(ve=>({id:ve.id,title:ve.title,message:ve.message,targetAudience:ve.target_audience,displayType:ve.display_type,status:ve.status,scheduledAt:ve.scheduled_at,expiresAt:ve.expires_at,viewsCount:ve.views_count??0,clicksCount:ve.clicks_count??0,createdAt:ve.created_at}));o(he)}finally{u(!1)}};O.useEffect(()=>{I()},[]);const j=()=>{g(""),y(""),S("all"),R("notification"),G("")},L=async()=>{if(!m.trim()||!E.trim()){alert("Please enter a title and message.");return}u(!0);try{const{error:ee}=await ie.from("admin_announcements").insert({title:m.trim(),message:E.trim(),target_audience:x,display_type:C,status:"draft",expires_at:M?new Date(M).toISOString():null,created_by:r==null?void 0:r.id});if(ee){console.error("Error saving draft:",ee),alert("Failed to save draft.");return}j(),await I(),alert("Draft saved successfully!")}finally{u(!1)}},N=async()=>{if(!m.trim()||!E.trim()){alert("Please enter a title and message.");return}const ee=Bf[x];if(window.confirm(`Publish announcement to ${ee}?

This will send notifications to all ${x==="all"?"users":x}.`)){u(!0);try{const{data:he,error:ve}=await ie.from("admin_announcements").insert({title:m.trim(),message:E.trim(),target_audience:x,display_type:C,status:"active",expires_at:M?new Date(M).toISOString():null,created_by:r==null?void 0:r.id}).select().single();if(ve||!he){console.error("Error creating announcement:",ve),alert("Failed to create announcement.");return}let ye=ie.from("users").select("id");x==="fans"?ye=ye.eq("role","fan"):x==="creators"?ye=ye.eq("role","creator"):ye=ye.in("role",["fan","creator"]);const{data:me,error:ue}=await ye;if(ue&&console.error("Error fetching users:",ue),me&&me.length>0){const Fe=me.map(be=>({user_id:be.id,type:"announcement",title:m.trim(),message:E.trim(),announcement_id:he.id,read:!1}));for(let be=0;be<Fe.length;be+=100){const ae=Fe.slice(be,be+100);await ie.from("notifications").insert(ae)}}j(),await I(),alert(`Announcement published! Notifications sent to ${(me==null?void 0:me.length)??0} users.`)}finally{u(!1)}}},D=async ee=>{const ne=n.find(ye=>ye.id===ee);if(!ne)return;const he=Bf[ne.targetAudience];if(window.confirm(`Publish "${ne.title}" to ${he}?

This will send notifications to all ${ne.targetAudience==="all"?"users":ne.targetAudience}.`)){u(!0);try{await ie.from("admin_announcements").update({status:"active"}).eq("id",ee);let ye=ie.from("users").select("id");ne.targetAudience==="fans"?ye=ye.eq("role","fan"):ne.targetAudience==="creators"?ye=ye.eq("role","creator"):ye=ye.in("role",["fan","creator"]);const{data:me}=await ye;if(me&&me.length>0){const ue=me.map(Fe=>({user_id:Fe.id,type:"announcement",title:ne.title,message:ne.message,announcement_id:ee,read:!1}));for(let Fe=0;Fe<ue.length;Fe+=100){const be=ue.slice(Fe,Fe+100);await ie.from("notifications").insert(be)}}await I(),alert(`Announcement published! Notifications sent to ${(me==null?void 0:me.length)??0} users.`)}finally{u(!1)}}},V=async ee=>{if(window.confirm("Deactivate this announcement?")){u(!0);try{await ie.from("admin_announcements").update({status:"cancelled"}).eq("id",ee),await I(),alert("Announcement deactivated.")}finally{u(!1)}}},B=async ee=>{if(window.confirm("Delete this announcement permanently?")){u(!0);try{await ie.from("notifications").delete().eq("announcement_id",ee),await ie.from("admin_announcements").delete().eq("id",ee),await I(),alert("Announcement deleted.")}finally{u(!1)}}},z=n.filter(ee=>ee.status==="active"),H=n.filter(ee=>ee.status==="draft"),J=n.filter(ee=>ee.status==="expired"||ee.status==="cancelled");return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Announcements"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Publish platform-wide communications and send notifications to users."})]})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Composer",subtitle:"Create a new announcement with targeting options."}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Title",placeholder:"Announcement headline",value:m,onChange:ee=>g(ee.target.value)}),i.jsxs("div",{children:[i.jsx("label",{className:"mb-1 block text-sm font-medium text-[#212529]",children:"Target Audience"}),i.jsxs("select",{className:"w-full rounded-lg border border-[#E9ECEF] bg-white px-3 py-2 text-sm",value:x,onChange:ee=>S(ee.target.value),children:[i.jsx("option",{value:"all",children:" All Users (Fans + Creators)"}),i.jsx("option",{value:"fans",children:" Fans Only"}),i.jsx("option",{value:"creators",children:" Creators Only"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"mb-1 block text-sm font-medium text-[#212529]",children:"Display Type"}),i.jsxs("select",{className:"w-full rounded-lg border border-[#E9ECEF] bg-white px-3 py-2 text-sm",value:C,onChange:ee=>R(ee.target.value),children:[i.jsx("option",{value:"notification",children:" In-App Notification"}),i.jsx("option",{value:"banner",children:" Banner"}),i.jsx("option",{value:"modal",children:" Modal Popup"}),i.jsx("option",{value:"email",children:" Email"})]})]}),i.jsx(tt,{label:"Expiry Date (Optional)",type:"datetime-local",value:M,onChange:ee=>G(ee.target.value)}),i.jsx("div",{className:"md:col-span-2",children:i.jsx(nr,{label:"Message",rows:4,placeholder:"Write the announcement message here...",value:E,onChange:ee=>y(ee.target.value)})}),i.jsxs("div",{className:"flex flex-wrap gap-2 md:col-span-2",children:[i.jsx(oe,{variant:"secondary",onClick:L,disabled:l,children:" Save as Draft"}),i.jsx(oe,{onClick:N,disabled:l,children:" Publish & Send Notifications"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Active Announcements",subtitle:`${z.length} live announcements`}),i.jsxs(Ee,{className:"space-y-4",children:[z.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No active announcements"}),z.map(ee=>i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:ee.title}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Target: ",Bf[ee.targetAudience],"  Type: ",QSe[ee.displayType]]})]}),i.jsx(Xe,{variant:R7[ee.status],children:ee.status.charAt(0).toUpperCase()+ee.status.slice(1)})]}),i.jsx("p",{className:"text-sm text-[#212529]",children:ee.message}),i.jsxs("div",{className:"flex flex-wrap gap-6 text-sm text-[#6C757D]",children:[i.jsxs("span",{children:["Created: ",Gt(ee.createdAt)]}),ee.expiresAt&&i.jsxs("span",{children:["Expires: ",Gt(ee.expiresAt)]}),i.jsxs("span",{children:["Views: ",ee.viewsCount.toLocaleString()]})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:i.jsx(oe,{size:"sm",variant:"danger",onClick:()=>V(ee.id),disabled:l,children:"Deactivate"})})]},ee.id))]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Drafts",subtitle:`${H.length} drafts awaiting publish`}),i.jsxs(Ee,{className:"space-y-3",children:[H.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No drafts"}),H.map(ee=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:ee.title}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:["Target: ",Bf[ee.targetAudience],"  Created: ",Gt(ee.createdAt)]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{size:"sm",variant:"primary",onClick:()=>D(ee.id),disabled:l,children:" Publish Now"}),i.jsx(oe,{size:"sm",variant:"danger",onClick:()=>B(ee.id),disabled:l,children:"Delete"})]})]},ee.id))]})]}),J.length>0&&i.jsxs(fe,{children:[i.jsx(Te,{title:"Past Announcements",subtitle:"Expired or cancelled announcements"}),i.jsx(Ee,{className:"space-y-3",children:J.map(ee=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:ee.title}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:[Bf[ee.targetAudience],"  ",Gt(ee.createdAt)]})]}),i.jsx(Xe,{variant:R7[ee.status],children:ee.status.charAt(0).toUpperCase()+ee.status.slice(1)}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>B(ee.id),disabled:l,children:" Delete"})]},ee.id))})]})]})}const e0e={bid_authorization:"Bid",bid_refund:"Refund",bid_capture:"Capture",creator_earning:"Earning",creator_payout:"Payout",manual_adjustment:"Adjustment"};function t0e(){const[r,n]=O.useState([]),[o,l]=O.useState({totalProcessed:0,totalRefunded:0,pendingPayouts:0,totalCommission:0}),[u,m]=O.useState(!1),[g,E]=O.useState("all");O.useEffect(()=>{(async()=>{var S;m(!0);try{const{data:C}=await ie.from("wallet_transactions").select("id, wallet_id, type, direction, amount, reference_table, reference_id, description, created_at").order("created_at",{ascending:!1}).limit(100),R=Array.from(new Set((C??[]).map(me=>me.wallet_id))),{data:M}=R.length?await ie.from("wallets").select("id, user_id").in("id",R):{data:[]},G=new Map;for(const me of M??[])G.set(me.id,me.user_id);const I=Array.from(new Set(Array.from(G.values()))),{data:j}=I.length?await ie.from("users").select("id, display_name, email").in("id",I):{data:[]},L=new Map;for(const me of j??[])L.set(me.id,me.display_name||((S=me.email)==null?void 0:S.split("@")[0])||"User");const N=(C??[]).filter(me=>me.reference_table==="events"||me.reference_table==="bids").map(me=>me.reference_id).filter(Boolean),{data:D}=N.length?await ie.from("events").select("id, title").in("id",N):{data:[]},V=new Map;for(const me of D??[])V.set(me.id,me.title);const B=(C??[]).map(me=>{const ue=G.get(me.wallet_id)??"",Fe=new Date(me.created_at);return{id:me.id,date:Fe.toLocaleDateString("en-IN",{month:"short",day:"numeric"}),time:Fe.toLocaleTimeString("en-IN",{hour:"numeric",minute:"2-digit"}),userId:ue,userName:L.get(ue)??"Unknown",eventId:me.reference_id,eventTitle:V.get(me.reference_id)??me.description??"-",amount:me.amount??0,type:me.type,direction:me.direction,status:"Processed"}});n(B);const{data:z}=await ie.from("bids").select("amount, status"),H=(z??[]).filter(me=>me.status==="won"),J=(z??[]).filter(me=>me.status==="lost"),ee=H.reduce((me,ue)=>me+(ue.amount??0),0),ne=J.reduce((me,ue)=>me+Math.floor((ue.amount??0)*.9),0),he=H.reduce((me,ue)=>me+Math.floor((ue.amount??0)*.1),0)+J.reduce((me,ue)=>me+Math.floor((ue.amount??0)*.1),0),{data:ve}=await ie.from("withdrawal_requests").select("amount").eq("status","pending"),ye=(ve??[]).reduce((me,ue)=>me+(ue.amount??0),0);l({totalProcessed:ee,totalRefunded:ne,pendingPayouts:ye,totalCommission:he})}finally{m(!1)}})()},[]);const y=r.filter(x=>g==="all"?!0:g==="bids"?x.type==="bid_authorization"||x.type==="bid_capture":g==="refunds"?x.type==="bid_refund":g==="payouts"?x.type==="creator_payout"||x.type==="creator_earning":!0);return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Payments"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Review platform transactions, refunds, and commissions."})]}),i.jsx("div",{className:"flex gap-2",children:["all","bids","refunds","payouts"].map(x=>i.jsx(oe,{size:"sm",variant:g===x?"secondary":"ghost",onClick:()=>E(x),children:x.charAt(0).toUpperCase()+x.slice(1)},x))})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs(fe,{children:[i.jsx(Te,{title:"Total Processed"}),i.jsxs(Ee,{children:[i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:We(o.totalProcessed)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"From winning bids"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Amount Returned to Fans"}),i.jsxs(Ee,{children:[i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:We(o.totalRefunded)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"90% of lost bids (non-winners)"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Pending Payouts"}),i.jsxs(Ee,{children:[i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:We(o.pendingPayouts)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Awaiting approval"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Platform Commission"}),i.jsxs(Ee,{children:[i.jsx("div",{className:"text-3xl font-bold text-[#28A745]",children:We(o.totalCommission)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"10% from all bids"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Transactions",subtitle:`${y.length} transactions`}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Time"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Description"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Type"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Direction"})]})}),i.jsxs("tbody",{children:[y.map(x=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:x.date}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:x.time}),i.jsx("td",{className:"py-3 text-[#212529]",children:x.userName}),i.jsx("td",{className:"py-3 text-[#212529]",children:x.eventTitle}),i.jsx("td",{className:"py-3 text-[#212529]",children:We(x.amount)}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:"primary",children:e0e[x.type]??x.type})}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:x.direction==="credit"?"success":"danger",children:x.direction==="credit"?" Credit":" Debit"})})]},x.id)),y.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:7,className:"py-8 text-center text-[#6C757D]",children:u?"Loading transactions...":"No transactions found"})})]})]})})]})]})}function s0e(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState(!1),[g,E]=O.useState({}),[y,x]=O.useState({}),S=async()=>{m(!0);try{const{data:I}=await ie.from("withdrawal_requests").select("*").order("requested_at",{ascending:!1}),j=Array.from(new Set((I??[]).map(he=>he.creator_id))),{data:L}=j.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",j):{data:[]},N=new Map;for(const he of L??[])N.set(he.user_id,{displayName:he.display_name||he.username||"Creator",username:he.username?`@${he.username}`:"@creator"});const{data:D}=await ie.from("bids").select("event_id, amount, status").eq("status","won"),{data:V}=await ie.from("events").select("id, creator_id"),B=new Map;for(const he of V??[])B.set(he.id,he.creator_id);const z=new Map;for(const he of D??[]){const ve=B.get(he.event_id);if(ve){const ye=Math.floor((he.amount??0)*.9);z.set(ve,(z.get(ve)??0)+ye)}}const H=new Map;for(const he of I??[])he.status==="completed"&&H.set(he.creator_id,(H.get(he.creator_id)??0)+(he.amount??0));const J=(I??[]).map(he=>{const ve=N.get(he.creator_id),ye=z.get(he.creator_id)??0,me=H.get(he.creator_id)??0;return{id:he.id,code:`#WR-${he.id.slice(0,4).toUpperCase()}`,creatorId:he.creator_id,creatorName:(ve==null?void 0:ve.displayName)??"Unknown",creatorUsername:(ve==null?void 0:ve.username)??"@creator",amount:he.amount??0,destination:he.destination,status:he.status,requestedAt:he.requested_at,processedAt:he.processed_at,adminNotes:he.admin_notes,gatewayReference:he.gateway_reference,rejectionReason:he.rejection_reason,earnings:{total:ye,withdrawn:me,pending:ye-me}}}),ee=J.filter(he=>he.status==="pending"||he.status==="in_review"),ne=J.filter(he=>he.status==="completed"||he.status==="failed");n(ee),l(ne)}finally{m(!1)}};O.useEffect(()=>{S()},[]);const C=async I=>{const j=g[I]??{gatewayReference:"",adminNotes:""};if(!j.gatewayReference.trim()){alert("Please enter the gateway reference ID.");return}if(window.confirm("Confirm this payment has been processed?")){m(!0);try{const{error:N}=await ie.from("withdrawal_requests").update({status:"completed",processed_at:new Date().toISOString(),gateway_reference:j.gatewayReference.trim(),admin_notes:j.adminNotes.trim()||null}).eq("id",I);if(N){console.error("Error approving withdrawal:",N),alert("Failed to approve withdrawal.");return}await S(),E(D=>{const V={...D};return delete V[I],V}),alert("Withdrawal approved and marked as completed!")}finally{m(!1)}}},R=async I=>{const j=y[I]??{reason:"",message:""};if(!j.reason.trim()){alert("Please enter a rejection reason.");return}if(window.confirm("Reject this withdrawal request?")){m(!0);try{const{error:N}=await ie.from("withdrawal_requests").update({status:"failed",processed_at:new Date().toISOString(),rejection_reason:j.reason.trim(),admin_notes:j.message.trim()||null}).eq("id",I);if(N){console.error("Error rejecting withdrawal:",N),alert("Failed to reject withdrawal.");return}await S(),x(D=>{const V={...D};return delete V[I],V}),alert("Withdrawal request rejected.")}finally{m(!1)}}},M=I=>{const j=new Date(I),N=new Date().getTime()-j.getTime(),D=Math.floor(N/(1e3*60*60));return D<1?"Just now":D<24?`${D} hours ago`:`${Math.floor(D/24)} days ago`},G={pending:"warning",in_review:"primary",completed:"success",failed:"danger"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Withdrawal Requests"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Verify payouts, capture references, and keep the audit trail healthy."})]}),i.jsxs(Xe,{variant:"warning",children:[r.length," pending"]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Pending",subtitle:"Requests needing manual review or payment confirmation."}),i.jsxs(Ee,{className:"space-y-4",children:[r.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:u?"Loading...":"No pending withdrawal requests"}),r.map(I=>{const j=g[I.id]??{gatewayReference:"",adminNotes:""},L=y[I.id]??{reason:"",message:""};return i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:I.creatorName}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:[I.creatorUsername,"  Requested ",M(I.requestedAt)]})]}),i.jsx(Xe,{variant:G[I.status]??"warning",children:I.status==="pending"?"Awaiting payout":I.status})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-2 text-sm text-[#212529]",children:[i.jsxs("p",{children:["Request ID: ",i.jsx("strong",{children:I.code})]}),i.jsxs("p",{children:["Amount: ",i.jsx("strong",{className:"text-lg",children:We(I.amount)})]}),i.jsxs("p",{children:["Method: ",I.destination||"Not specified"]}),i.jsxs("p",{children:["Requested On: ",Gt(I.requestedAt)]})]}),i.jsxs("div",{className:"space-y-2 rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Creator Earnings Breakdown"}),i.jsxs("p",{children:["Total Earnings: ",i.jsx("strong",{children:We(I.earnings.total)})]}),i.jsxs("p",{children:["Withdrawn: ",i.jsx("strong",{children:We(I.earnings.withdrawn)})]}),i.jsxs("p",{children:["Available Balance: ",i.jsx("strong",{className:"text-[#28A745]",children:We(I.earnings.pending)})]})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:" Mark as Paid"}),i.jsx(tt,{label:"Gateway Reference ID",placeholder:"pay_xyz123",value:j.gatewayReference,onChange:N=>E(D=>({...D,[I.id]:{...j,gatewayReference:N.target.value}}))}),i.jsx(nr,{label:"Admin Notes",rows:2,placeholder:"Optional note for audit log",value:j.adminNotes,onChange:N=>E(D=>({...D,[I.id]:{...j,adminNotes:N.target.value}}))}),i.jsx(oe,{size:"sm",onClick:()=>C(I.id),disabled:u,children:"Confirm Payment"})]}),i.jsxs("div",{className:"space-y-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:" Reject Request"}),i.jsx(tt,{label:"Reason",placeholder:"Insufficient balance / pending dispute / ...",value:L.reason,onChange:N=>x(D=>({...D,[I.id]:{...L,reason:N.target.value}}))}),i.jsx(nr,{label:"Message to creator",rows:2,placeholder:"Explain next steps",value:L.message,onChange:N=>x(D=>({...D,[I.id]:{...L,message:N.target.value}}))}),i.jsx(oe,{size:"sm",variant:"danger",onClick:()=>R(I.id),disabled:u,children:"Reject Request"})]})]})]},I.id)})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"History",subtitle:"Resolved withdrawal requests across the platform."}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Method"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Processed"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Reference"})]})}),i.jsxs("tbody",{children:[o.map(I=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#6C757D]",children:I.code}),i.jsx("td",{className:"py-3 text-[#212529]",children:I.creatorName}),i.jsx("td",{className:"py-3 text-[#212529]",children:We(I.amount)}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:I.destination||"-"}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:G[I.status]??"primary",children:I.status==="completed"?"Paid":"Rejected"})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:I.processedAt?Gt(I.processedAt):"-"}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:I.gatewayReference||I.rejectionReason||"-"})]},I.id)),o.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:7,className:"py-8 text-center text-[#6C757D]",children:u?"Loading...":"No withdrawal history"})})]})]})})]})]})}const r0e=[{id:"#RF-789",user:"Rahul Kumar",email:"rahul@email.com",event:"#342  Meet & Greet with Priya",amount:"270",type:"Auto 90%",status:"Processed",processedOn:"Jan 12, 2025"},{id:"#RF-788",user:"Priya Singh",email:"priya@email.com",event:"#341  Cooking Demo",amount:"180",type:"Auto 90%",status:"Processed",processedOn:"Jan 12, 2025"},{id:"#RF-787",user:"Amit Gupta",email:"amit@email.com",event:"#340  Productivity Masterclass",amount:"450",type:"Manual",status:"Pending Retry",processedOn:"Jan 11, 2025"},{id:"#RF-786",user:"Neha Kapoor",email:"neha@email.com",event:"#339  Cooking with Chef Rohan",amount:"320",type:"Auto 90%",status:"Failed",processedOn:"Jan 11, 2025"}],Ld={id:"#RF-786",reason:"Payment method expired / Bank account closed",gatewayError:"BAD_REQUEST_ERROR  Invalid account details",attempts:3,amount:"288 (90%)",originalBid:"320",user:"Neha Kumar (neha@email.com)"};function n0e(){return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Refunds Management"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track automatic and manual refunds, investigate failures, and trigger overrides."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",children:"Export Report"}),i.jsx(oe,{children:"Process Manual Refund"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Overview",subtitle:"Quick insight into refund volume and outcomes."}),i.jsx(Ee,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[{label:"Refunds Today",value:"23,450  89 refunds"},{label:"This Week",value:"1,45,200  456 refunds"},{label:"This Month",value:"4,52,300  1,234 refunds"},{label:"Failed Pending",value:"12  3,400"}].map(r=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:r.label}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:r.value})]},r.label))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Refunds",subtitle:"Filter by status, type, or amount to focus investigation."}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Type"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Processed"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsx("tbody",{children:r0e.map(r=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#6C757D]",children:r.id}),i.jsx("td",{className:"py-3 text-[#212529]",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-medium",children:r.user}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:r.email})]})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:r.event}),i.jsx("td",{className:"py-3 text-[#212529]",children:r.amount}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:r.type}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:r.status==="Processed"?"success":r.status==="Pending Retry"?"warning":"danger",children:r.status})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:r.processedOn}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[i.jsx(oe,{size:"sm",variant:"secondary",children:"View Details"}),i.jsx(oe,{size:"sm",variant:"ghost",children:"Retry"})]})})]},r.id))})]})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Failed Refunds Requiring Action",subtitle:"Resolve gateway failures with manual interventions."}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("p",{className:"font-semibold",children:["Refund ",Ld.id]}),i.jsx("p",{className:"mt-1 text-[#6C757D]",children:Ld.user}),i.jsxs("p",{className:"mt-4",children:["Original Bid: ",Ld.originalBid]}),i.jsxs("p",{children:["Refund Amount: ",Ld.amount]}),i.jsxs("p",{children:["Attempts: ",Ld.attempts]}),i.jsxs("p",{className:"mt-3 text-[#D9480F]",children:["Failure Reason: ",Ld.reason]}),i.jsxs("p",{className:"text-[#6C757D]",children:["Gateway Error: ",Ld.gatewayError]})]}),i.jsxs("div",{className:"space-y-3 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx(tt,{label:"Next Step",placeholder:"Retry via gateway / Manual transfer"}),i.jsx(nr,{label:"Notes",rows:3,placeholder:"Add context for audit trail"}),i.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[i.jsx(oe,{variant:"secondary",children:"Retry Refund"}),i.jsx(oe,{variant:"ghost",children:"Contact User"})]}),i.jsx(oe,{variant:"danger",children:"Mark as Resolved"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Manual Refund",subtitle:"Issue full or partial refunds outside the automatic flow."}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"User",placeholder:"Search by email / phone / ID"}),i.jsx(tt,{label:"Event (optional)",placeholder:"Search event"}),i.jsx(tt,{label:"Refund Amount",placeholder:""}),i.jsx(tt,{label:"Reason",placeholder:"Event cancelled / Technical issue / Gesture"}),i.jsx(nr,{label:"Additional Notes",rows:3,placeholder:"Context for support team"}),i.jsx("div",{className:"md:col-span-2",children:i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{variant:"secondary",children:"Preview Email"}),i.jsx(oe,{children:"Process Refund"})]})})]})]})]})}function i0e(){const[r,n]=O.useState("month"),[o,l]=O.useState({grossRevenue:0,netRevenue:0,platformCommission:0,creatorPayouts:0,avgEventRevenue:0,paidEventsCount:0,freeEventsCount:0,totalRefunds:0}),[u,m]=O.useState([]),[g,E]=O.useState([]),[y,x]=O.useState([]),[S,C]=O.useState([]),[R,M]=O.useState(!1),G=N=>{const D=new Date,V=new Date(D);let B=new Date(D);switch(N){case"today":B.setHours(0,0,0,0);break;case"7days":B.setDate(B.getDate()-7);break;case"30days":B.setDate(B.getDate()-30);break;case"month":B=new Date(D.getFullYear(),D.getMonth(),1);break;case"all":B=new Date(2020,0,1);break}return{start:B,end:V}};O.useEffect(()=>{(async()=>{M(!0);try{const{start:D,end:V}=G(r),{data:B}=await ie.from("bids").select("id, event_id, amount, status, created_at").gte("created_at",D.toISOString()).lte("created_at",V.toISOString()),z=Array.from(new Set((B??[]).map(Re=>Re.event_id))),{data:H}=z.length?await ie.from("events").select("id, creator_id, base_price, duration_minutes, is_paid, created_at").in("id",z):{data:[]},J=new Map;for(const Re of H??[])J.set(Re.id,Re);const{data:ee}=await ie.from("events").select("id, is_paid, created_at").gte("created_at",D.toISOString()).lte("created_at",V.toISOString()),ne=(ee??[]).filter(Re=>Re.is_paid!==!1).length,he=(ee??[]).filter(Re=>Re.is_paid===!1).length,ve=Array.from(new Set((H??[]).map(Re=>Re.creator_id))),{data:ye}=ve.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",ve):{data:[]},me=new Map;for(const Re of ye??[])me.set(Re.user_id,Re.display_name||Re.username||"Creator");const ue=(B??[]).filter(Re=>Re.status==="won"),Fe=(B??[]).filter(Re=>Re.status==="lost"),be=[...ue,...Fe].reduce((Re,Ge)=>Re+(Ge.amount??0),0),ae=Math.floor(be*.1),ge=Fe.reduce((Re,Ge)=>Re+Math.floor((Ge.amount??0)*.9),0),Se=ue.reduce((Re,Ge)=>Re+Math.floor((Ge.amount??0)*.9),0),it=be,Ue=ae,ht=z.length>0?it/z.length:0;l({grossRevenue:it,netRevenue:Ue,platformCommission:ae,creatorPayouts:Se,avgEventRevenue:ht,paidEventsCount:ne,freeEventsCount:he,totalRefunds:ge});const qe=new Map;for(const Re of B??[]){const Ge=new Date(Re.created_at).toLocaleDateString("en-IN",{month:"short",day:"numeric"}),xt=qe.get(Ge)??{date:Ge,eventsCount:0,bidsCount:0,revenue:0,commission:0,refunds:0};xt.bidsCount++,Re.status==="won"?(xt.revenue+=Re.amount??0,xt.commission+=Math.floor((Re.amount??0)*.1)):Re.status==="lost"&&(xt.refunds+=Math.floor((Re.amount??0)*.9),xt.commission+=Math.floor((Re.amount??0)*.1)),qe.set(Ge,xt)}for(const Re of ee??[]){const Ge=new Date(Re.created_at).toLocaleDateString("en-IN",{month:"short",day:"numeric"}),xt=qe.get(Ge);xt&&xt.eventsCount++}m(Array.from(qe.values()).slice(0,10));const Me=new Map;for(const Re of ue){const Ge=J.get(Re.event_id);if(!Ge)continue;const xt=Me.get(Ge.creator_id)??0;Me.set(Ge.creator_id,xt+(Re.amount??0))}const st=Array.from(Me.entries()).map(([Re,Ge])=>({creatorId:Re,name:me.get(Re)??"Unknown",revenue:Ge})).sort((Re,Ge)=>Ge.revenue-Re.revenue).slice(0,5);E(st);const De=new Map;for(const Re of ue){const Ge=J.get(Re.event_id);if(!Ge)continue;const xt=(Ge.base_price??0)<=50?"Paid Events  50 Base":(Ge.base_price??0)<=100?"Paid Events  100 Base":"Paid Events  100+ Base";De.set(xt,(De.get(xt)??0)+(Re.amount??0))}const Ae=Array.from(De.entries()).map(([Re,Ge])=>({type:Re,revenue:Ge,percent:it>0?Ge/it*100:0})).sort((Re,Ge)=>Ge.revenue-Re.revenue);x(Ae);const Qe=new Map;for(const Re of ue){const Ge=J.get(Re.event_id);if(!Ge)continue;const xt=(Ge.duration_minutes??5)<=5?"5-minute events":(Ge.duration_minutes??5)<=10?"10-minute events":"15+ minute events";Qe.set(xt,(Qe.get(xt)??0)+(Re.amount??0))}const pe=Array.from(Qe.entries()).map(([Re,Ge])=>({duration:Re,revenue:Ge,percent:it>0?Ge/it*100:0})).sort((Re,Ge)=>Ge.revenue-Re.revenue);C(pe)}finally{M(!1)}})()},[r]);const I=o.paidEventsCount+o.freeEventsCount,j=I>0?Math.round(o.paidEventsCount/I*100):0,L=I>0?Math.round(o.freeEventsCount/I*100):0;return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Revenue Analytics"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Monitor revenue flows, commission, and payouts with configurable time ranges."})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"today",label:"Today"},{key:"7days",label:"Last 7 Days"},{key:"30days",label:"Last 30 Days"},{key:"month",label:"This Month"},{key:"all",label:"All Time"}].map(N=>i.jsx(oe,{size:"sm",variant:r===N.key?"secondary":"ghost",onClick:()=>n(N.key),children:N.label},N.key))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Summary",subtitle:"Key financial metrics for the selected range."}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Gross Revenue"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:We(o.grossRevenue)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Net Revenue"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:We(o.netRevenue)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Platform Commission"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#28A745]",children:We(o.platformCommission)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Creator Payouts"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:We(o.creatorPayouts)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Avg Event Revenue"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:We(o.avgEventRevenue)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Paid Events"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:[o.paidEventsCount," (",j,"%)"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Free Events"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:[o.freeEventsCount," (",L,"%)"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunds"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#DC3545]",children:We(o.totalRefunds)})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Revenue Breakdown",subtitle:"Analyze by event type, duration, and top creators."}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Revenue by Event Type"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[y.length===0&&i.jsx("li",{children:"No data"}),y.map(N=>i.jsxs("li",{children:[N.type,"  ",N.percent.toFixed(0),"% (",We(N.revenue),")"]},N.type))]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Top Revenue Creators"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[g.length===0&&i.jsx("li",{children:"No data"}),g.map(N=>i.jsxs("li",{children:[N.name,"  ",We(N.revenue)]},N.creatorId))]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Revenue by Duration"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[S.length===0&&i.jsx("li",{children:"No data"}),S.map(N=>i.jsxs("li",{children:[N.duration,"  ",N.percent.toFixed(0),"% (",We(N.revenue),")"]},N.duration))]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Revenue by Date",subtitle:"Daily breakdown for reporting."}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Revenue"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Commission"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Refunds"})]})}),i.jsxs("tbody",{children:[u.map(N=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:N.date}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:N.eventsCount}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:N.bidsCount}),i.jsx("td",{className:"py-3 text-[#212529]",children:We(N.revenue)}),i.jsx("td",{className:"py-3 text-[#28A745]",children:We(N.commission)}),i.jsx("td",{className:"py-3 text-[#DC3545]",children:We(N.refunds)})]},N.date)),u.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-8 text-center text-[#6C757D]",children:R?"Loading...":"No revenue data available"})})]})]})})]})]})}function a0e(){const[r,n]=O.useState({total:0,fromWinners:0,fromNonWinners:0,eventsProcessed:0,avgPerEvent:0,yearlyProjection:0}),[o,l]=O.useState([]),[u,m]=O.useState([]),[g,E]=O.useState(!1);O.useEffect(()=>{(async()=>{E(!0);try{const{data:C}=await ie.from("bids").select("id, event_id, amount, status, created_at"),R=Array.from(new Set((C??[]).map(ge=>ge.event_id))),{data:M}=R.length?await ie.from("events").select("id, creator_id, base_price, status").in("id",R):{data:[]},G=new Map;for(const ge of M??[])G.set(ge.id,{creatorId:ge.creator_id,basePrice:ge.base_price??0});const I=Array.from(new Set((M??[]).map(ge=>ge.creator_id))),{data:j}=I.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",I):{data:[]},L=new Map;for(const ge of j??[])L.set(ge.user_id,ge.display_name||ge.username||"Creator");const N=(C??[]).filter(ge=>ge.status==="won"),D=(C??[]).filter(ge=>ge.status==="lost"),V=N.reduce((ge,Se)=>ge+Math.floor((Se.amount??0)*.1),0),B=D.reduce((ge,Se)=>ge+Math.floor((Se.amount??0)*.1),0),z=V+B,J=(M??[]).filter(ge=>ge.status==="completed").length||R.length,ee=J>0?z/J:0,ne=new Date,he=new Date(ne.getFullYear(),ne.getMonth()+1,0).getDate(),ve=ne.getDate(),me=(ve>0?z/ve*he:z)*12;n({total:z,fromWinners:V,fromNonWinners:B,eventsProcessed:J,avgPerEvent:ee,yearlyProjection:me});const ue=new Map;for(const ge of C??[]){const Se=G.get(ge.event_id);if(!Se)continue;const{creatorId:it}=Se,Ue=ue.get(it)??{events:new Set,revenue:0,commission:0};Ue.events.add(ge.event_id),ge.status==="won"?(Ue.revenue+=ge.amount??0,Ue.commission+=Math.floor((ge.amount??0)*.1)):ge.status==="lost"&&(Ue.commission+=Math.floor((ge.amount??0)*.1)),ue.set(it,Ue)}const Fe=Array.from(ue.entries()).map(([ge,Se])=>({creatorId:ge,creatorName:L.get(ge)??"Unknown",eventsCount:Se.events.size,totalRevenue:Se.revenue,commission:Se.commission,sharePercent:z>0?Se.commission/z*100:0})).sort((ge,Se)=>Se.commission-ge.commission).slice(0,10);l(Fe);const be=new Map;for(const ge of C??[]){if(ge.status!=="won"&&ge.status!=="lost")continue;const Se=G.get(ge.event_id);if(!Se)continue;const it=Se.basePrice<=50?"50 Base":Se.basePrice<=100?"100 Base":"100+ Base",Ue=be.get(it)??{commission:0};Ue.commission+=Math.floor((ge.amount??0)*.1),be.set(it,Ue)}const ae=Array.from(be.entries()).map(([ge,Se])=>({basePrice:ge,commission:Se.commission,sharePercent:z>0?Se.commission/z*100:0})).sort((ge,Se)=>Se.commission-ge.commission);m(ae)}finally{E(!1)}})()},[]);const y=r.total>0?Math.round(r.fromWinners/r.total*100):0,x=r.total>0?Math.round(r.fromNonWinners/r.total*100):0;return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Platform Commission"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Breakdown of commission collected across winners and non-winners plus projection insights."})]})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Summary",subtitle:"Current overview"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Commission"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#28A745]",children:We(r.total)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"All event revenue combined"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"From Winners"}),i.jsxs("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:[We(r.fromWinners)," (",y,"%)"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"10% cut from winning bids"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"From Non-winners"}),i.jsxs("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:[We(r.fromNonWinners)," (",x,"%)"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Retained from 90% refunds"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Processed"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:r.eventsProcessed}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:["Average per event ",We(r.avgPerEvent)]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Yearly Projection"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:We(r.yearlyProjection)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Based on current run rate"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Event Type Breakdown",subtitle:"Commission by pricing tier"}),i.jsxs(Ee,{className:"space-y-3",children:[u.length===0&&!g&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No data available"}),u.map(S=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[i.jsx("span",{children:S.basePrice}),i.jsxs("span",{className:"text-[#6C757D]",children:[S.sharePercent.toFixed(1),"%"]}),i.jsx("span",{className:"font-semibold",children:We(S.commission)})]},S.basePrice))]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Commission by Creator",subtitle:"Top contributors to platform revenue"}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Revenue"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Commission"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Share"})]})}),i.jsxs("tbody",{children:[o.map(S=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:S.creatorName}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:S.eventsCount}),i.jsx("td",{className:"py-3 text-[#212529]",children:We(S.totalRevenue)}),i.jsx("td",{className:"py-3 font-semibold text-[#28A745]",children:We(S.commission)}),i.jsxs("td",{className:"py-3 text-[#6C757D]",children:[S.sharePercent.toFixed(1),"%"]})]},S.creatorId)),o.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:g?"Loading...":"No commission data available"})})]})]})})]})]})}function o0e(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState([]),[g,E]=O.useState([]),[y,x]=O.useState(!1);return O.useEffect(()=>{(async()=>{x(!0);try{const{data:C}=await ie.from("users").select("id, role, created_at"),R=(C==null?void 0:C.length)??0,M=(C??[]).filter(pe=>pe.role==="fan").length,G=(C??[]).filter(pe=>pe.role==="creator").length,{data:I}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at"),j=(I==null?void 0:I.length)??0,L=(I??[]).filter(pe=>pe.status==="won"),N=new Set((I??[]).map(pe=>pe.fan_id)).size,D=j>0?(I??[]).reduce((pe,Re)=>pe+(Re.amount??0),0)/j:0,V=j>0?L.length/j*100:0,{data:B}=await ie.from("events").select("id, creator_id, status, base_price, is_paid, created_at"),z=(B==null?void 0:B.length)??0,H=(B??[]).filter(pe=>pe.status==="completed").length,J=z>0?H/z*100:0,{data:ee}=await ie.from("meets").select("id, status"),ne=(ee??[]).filter(pe=>pe.status==="completed").length,he=L.reduce((pe,Re)=>pe+(Re.amount??0),0),ve=M>0?he/M:0,ye=R>0?N/R*100:0,me=new Date,ue=new Date(me.getFullYear(),me.getMonth(),1),Fe=new Date(me.getFullYear(),me.getMonth()-1,1),be=new Date(me.getFullYear(),me.getMonth(),0),ae=(C??[]).filter(pe=>new Date(pe.created_at)>=ue).length,ge=(C??[]).filter(pe=>{const Re=new Date(pe.created_at);return Re>=Fe&&Re<=be}).length,Se=ge>0?(ae-ge)/ge*100:0;n([{label:"Monthly Growth Rate",value:`${Se>=0?"+":""}${Se.toFixed(1)}%`,variant:Se>=0?"success":"danger"},{label:"Conversion Rate",value:`${ye.toFixed(1)}%`,variant:ye>10?"success":"warning"},{label:"Avg Bid Amount",value:We(D)},{label:"Win Rate",value:`${V.toFixed(1)}%`},{label:"Event Completion",value:`${J.toFixed(1)}%`,variant:J>90?"success":"warning"},{label:"ARPU",value:We(ve)},{label:"Total Revenue",value:We(he),variant:"success"},{label:"Active Creators",value:G.toString()}]),l([{stage:"Total Users",value:R,percentage:"100%"},{stage:"Fans (Potential Bidders)",value:M,percentage:R>0?`${(M/R*100).toFixed(1)}%`:"0%"},{stage:"Placed a Bid",value:N,percentage:R>0?`${(N/R*100).toFixed(1)}%`:"0%"},{stage:"Won an Event",value:L.length,percentage:R>0?`${(L.length/R*100).toFixed(1)}%`:"0%"},{stage:"Completed Meet",value:ne,percentage:R>0?`${(ne/R*100).toFixed(1)}%`:"0%"}]);const it=(B??[]).filter(pe=>(pe.base_price??0)<=50&&pe.is_paid!==!1),Ue=(B??[]).filter(pe=>(pe.base_price??0)>50&&(pe.base_price??0)<=100),ht=(B??[]).filter(pe=>pe.is_paid===!1),qe=(pe,Re)=>{const Ge=pe.map(rt=>rt.id),xt=(I??[]).filter(rt=>Ge.includes(rt.event_id)),jt=xt.filter(rt=>rt.status==="won"),Pt=pe.filter(rt=>rt.status==="completed").length;return{label:Re,totalCreated:pe.length,avgParticipants:pe.length>0?xt.length/pe.length:0,avgFinalBid:jt.length>0?jt.reduce((rt,Dt)=>rt+(Dt.amount??0),0)/jt.length:0,completionRate:pe.length>0?Pt/pe.length*100:0,avgCreatorRevenue:jt.length>0?jt.reduce((rt,Dt)=>rt+(Dt.amount??0),0)*.9/jt.length:0}};m([qe(it,"Paid Events (50 Base)"),qe(Ue,"Paid Events (100 Base)"),qe(ht,"Free Events")]);const{data:Me}=await ie.from("profiles").select("user_id, display_name, username"),st=new Map;for(const pe of Me??[])st.set(pe.user_id,pe.display_name||pe.username||"Creator");const De=new Map;for(const pe of B??[])De.set(pe.id,pe.creator_id);const Ae=new Map;for(const pe of L){const Re=De.get(pe.event_id);if(!Re)continue;const Ge=Ae.get(Re)??{events:new Set,revenue:0};Ge.events.add(pe.event_id),Ge.revenue+=(pe.amount??0)*.9,Ae.set(Re,Ge)}const Qe=Array.from(Ae.entries()).map(([pe,Re])=>({creatorId:pe,name:st.get(pe)??"Unknown",eventsCount:Re.events.size,revenue:Re.revenue})).sort((pe,Re)=>Re.revenue-pe.revenue).slice(0,5);E(Qe)}finally{x(!1)}})()},[]),i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Business Analytics"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"High-level KPIs, funnel health, and performance metrics."})]})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Key Performance Indicators",subtitle:"Current metrics overview"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[r.map(S=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:S.label}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:S.value}),S.variant&&i.jsx(Xe,{variant:S.variant,children:"Current"})]},S.label)),r.length===0&&y&&i.jsx("p",{className:"col-span-4 py-4 text-center text-sm text-[#6C757D]",children:"Loading..."})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Conversion Funnel",subtitle:"User journey from signup to completed meet"}),i.jsxs(Ee,{className:"space-y-3",children:[o.map((S,C)=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-[#6C757D] text-xs text-white",children:C+1}),S.stage]}),i.jsx("span",{className:"text-[#6C757D]",children:S.percentage}),i.jsx("span",{className:"font-semibold",children:S.value.toLocaleString()})]},S.stage)),o.length===0&&!y&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No data available"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Event Performance",subtitle:"Compare paid vs free categories"}),i.jsx(Ee,{className:"grid gap-4 md:grid-cols-3",children:u.map(S=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("h2",{className:"font-semibold",children:S.label}),i.jsxs("ul",{className:"mt-3 space-y-2 text-[#6C757D]",children:[i.jsxs("li",{children:["Total Created: ",i.jsx("strong",{children:S.totalCreated})]}),i.jsxs("li",{children:["Avg Participants: ",i.jsx("strong",{children:S.avgParticipants.toFixed(1)})]}),i.jsxs("li",{children:["Avg Final Bid: ",i.jsx("strong",{children:We(S.avgFinalBid)})]}),i.jsxs("li",{children:["Completion: ",i.jsxs("strong",{children:[S.completionRate.toFixed(0),"%"]})]}),i.jsxs("li",{children:["Avg Creator Revenue: ",i.jsx("strong",{children:We(S.avgCreatorRevenue)})]})]})]},S.label))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Top Creators by Revenue",subtitle:"Highest earning creators"}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rank"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Revenue"})]})}),i.jsxs("tbody",{children:[g.map((S,C)=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:i.jsxs(Xe,{variant:C===0?"success":C===1?"primary":"warning",children:["#",C+1]})}),i.jsx("td",{className:"py-3 text-[#212529]",children:S.name}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:S.eventsCount}),i.jsx("td",{className:"py-3 font-semibold text-[#28A745]",children:We(S.revenue)})]},S.creatorId)),g.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:4,className:"py-8 text-center text-[#6C757D]",children:y?"Loading...":"No creator data available"})})]})]})})]})]})}function c0e(){const[r,n]=O.useState({totalUsers:0,totalFans:0,totalCreators:0,activeLast24h:0,activeLast7d:0,activeLast30d:0,newUsersToday:0,newUsersThisWeek:0,newUsersThisMonth:0}),[o,l]=O.useState([]),[u,m]=O.useState({inactiveUsers:0,inactiveRate:"0%",usersNeverBid:0,usersNeverWon:0}),[g,E]=O.useState([]),[y,x]=O.useState(!1);O.useEffect(()=>{(async()=>{x(!0);try{const M=new Date,G=new Date(M.getFullYear(),M.getMonth(),M.getDate()),I=new Date(M.getTime()-7*24*60*60*1e3),j=new Date(M.getTime()-30*24*60*60*1e3),L=new Date(M.getFullYear(),M.getMonth(),1),{data:N}=await ie.from("users").select("id, role, created_at, account_status"),D=(N==null?void 0:N.length)??0,V=(N??[]).filter(pe=>pe.role==="fan").length,B=(N??[]).filter(pe=>pe.role==="creator").length,z=(N??[]).filter(pe=>new Date(pe.created_at)>=G).length,H=(N??[]).filter(pe=>new Date(pe.created_at)>=I).length,J=(N??[]).filter(pe=>new Date(pe.created_at)>=L).length,{data:ee}=await ie.from("bids").select("id, fan_id, amount, status, created_at"),ne=(ee??[]).filter(pe=>new Date(pe.created_at)>=G),he=(ee??[]).filter(pe=>new Date(pe.created_at)>=I),ve=(ee??[]).filter(pe=>new Date(pe.created_at)>=j),ye=new Set(ne.map(pe=>pe.fan_id)).size,me=new Set(he.map(pe=>pe.fan_id)).size,ue=new Set(ve.map(pe=>pe.fan_id)).size;n({totalUsers:D,totalFans:V,totalCreators:B,activeLast24h:ye,activeLast7d:me,activeLast30d:ue,newUsersToday:z,newUsersThisWeek:H,newUsersThisMonth:J});const Fe=new Map;for(const pe of ee??[]){const Re=Fe.get(pe.fan_id)??{count:0,total:0,wins:0};Re.count++,Re.total+=pe.amount??0,pe.status==="won"&&Re.wins++,Fe.set(pe.fan_id,Re)}const be=(N??[]).filter(pe=>pe.role==="fan").map(pe=>pe.id),ae=be.filter(pe=>Fe.has(pe)),ge=be.length-ae.length,Se=ae.filter(pe=>{var Re;return(((Re=Fe.get(pe))==null?void 0:Re.count)??0)>=5}),it=ae.filter(pe=>{var Ge;const Re=((Ge=Fe.get(pe))==null?void 0:Ge.count)??0;return Re>=2&&Re<5}),Ue=ae.filter(pe=>{var Ge;return(((Ge=Fe.get(pe))==null?void 0:Ge.count)??0)===1}),ht=ae.filter(pe=>{var Re;return(((Re=Fe.get(pe))==null?void 0:Re.wins)??0)===0}).length,qe=new Set(ve.map(pe=>pe.fan_id)),Me=be.filter(pe=>!qe.has(pe)),st=be.length>0?Me.length/be.length*100:0;l([{name:"High Value Users",count:Se.length,share:V>0?`${(Se.length/V*100).toFixed(1)}%`:"0%",description:`5+ bids  Avg spend ${We(Se.reduce((pe,Re)=>{var Ge;return pe+(((Ge=Fe.get(Re))==null?void 0:Ge.total)??0)},0)/Math.max(Se.length,1))}`,variant:"success"},{name:"Regular Users",count:it.length,share:V>0?`${(it.length/V*100).toFixed(1)}%`:"0%",description:`2-4 bids  Avg spend ${We(it.reduce((pe,Re)=>{var Ge;return pe+(((Ge=Fe.get(Re))==null?void 0:Ge.total)??0)},0)/Math.max(it.length,1))}`,variant:"primary"},{name:"Occasional Users",count:Ue.length,share:V>0?`${(Ue.length/V*100).toFixed(1)}%`:"0%",description:`1 bid  Avg spend ${We(Ue.reduce((pe,Re)=>{var Ge;return pe+(((Ge=Fe.get(Re))==null?void 0:Ge.total)??0)},0)/Math.max(Ue.length,1))}`,variant:"warning"},{name:"Inactive Users",count:Me.length,share:V>0?`${(Me.length/V*100).toFixed(1)}%`:"0%",description:"No activity in 30+ days  at-risk",variant:"danger"}]),m({inactiveUsers:Me.length,inactiveRate:`${st.toFixed(1)}%`,usersNeverBid:ge,usersNeverWon:ht});const{data:De}=await ie.from("profiles").select("user_id, display_name, username"),Ae=new Map;for(const pe of De??[])Ae.set(pe.user_id,pe.display_name||pe.username||"Fan");const Qe=Array.from(Fe.entries()).map(([pe,Re])=>({fanId:pe,name:Ae.get(pe)??"Unknown",bidsCount:Re.count,totalSpent:Re.total,winsCount:Re.wins})).sort((pe,Re)=>Re.totalSpent-pe.totalSpent).slice(0,5);E(Qe)}finally{x(!1)}})()},[]);const S=r.activeLast30d>0?(r.activeLast24h/r.activeLast30d*100).toFixed(1):"0",C=r.activeLast30d>0?(r.activeLast7d/r.activeLast30d*100).toFixed(1):"0";return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"User Analytics"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Understand who your users are and how they behave across the platform."})]})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"User Overview",subtitle:"Total user counts by role"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Users"}),i.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:r.totalUsers.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Fans"}),i.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:r.totalFans.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Creators"}),i.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:r.totalCreators.toLocaleString()})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Activity Metrics",subtitle:"User engagement over different time periods"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Active Last 24h (DAU)"}),i.jsx("p",{className:"mt-2 text-lg font-semibold",children:r.activeLast24h.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Active Last 7 Days (WAU)"}),i.jsx("p",{className:"mt-2 text-lg font-semibold",children:r.activeLast7d.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Active Last 30 Days (MAU)"}),i.jsx("p",{className:"mt-2 text-lg font-semibold",children:r.activeLast30d.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"DAU/MAU Ratio"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold",children:[S,"%"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"WAU/MAU Ratio"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold",children:[C,"%"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"New Users This Month"}),i.jsx("p",{className:"mt-2 text-lg font-semibold",children:r.newUsersThisMonth.toLocaleString()})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"User Segments",subtitle:"Behavior-based clusters"}),i.jsx(Ee,{className:"grid gap-4 md:grid-cols-2",children:o.map(R=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{className:"font-semibold",children:R.name}),i.jsxs(Xe,{variant:R.variant,children:[R.count," users (",R.share,")"]})]}),i.jsx("p",{className:"mt-3 text-[#6C757D]",children:R.description})]},R.name))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Churn & Risk Analysis",subtitle:"Keep an eye on at-risk users"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Inactive Rate (30+ days)"}),i.jsx("p",{className:"text-3xl font-semibold text-[#DC3545]",children:u.inactiveRate}),i.jsxs("p",{className:"mt-3",children:["Inactive Users: ",i.jsx("strong",{children:u.inactiveUsers})]}),i.jsxs("p",{children:["Users Never Bid: ",i.jsx("strong",{children:u.usersNeverBid})]}),i.jsxs("p",{children:["Users Never Won: ",i.jsx("strong",{children:u.usersNeverWon})]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"New User Growth"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-[#6C757D]",children:[i.jsxs("li",{className:"flex justify-between",children:[i.jsx("span",{children:"Today"}),i.jsxs(Xe,{variant:"success",children:["+",r.newUsersToday]})]}),i.jsxs("li",{className:"flex justify-between",children:[i.jsx("span",{children:"This Week"}),i.jsxs(Xe,{variant:"primary",children:["+",r.newUsersThisWeek]})]}),i.jsxs("li",{className:"flex justify-between",children:[i.jsx("span",{children:"This Month"}),i.jsxs(Xe,{variant:"warning",children:["+",r.newUsersThisMonth]})]})]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Top Fans by Spending",subtitle:"Most engaged users"}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rank"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Fan"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Wins"})]})}),i.jsxs("tbody",{children:[g.map((R,M)=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:i.jsxs(Xe,{variant:M===0?"success":M===1?"primary":"warning",children:["#",M+1]})}),i.jsx("td",{className:"py-3 text-[#212529]",children:R.name}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:R.bidsCount}),i.jsx("td",{className:"py-3 font-semibold text-[#212529]",children:We(R.totalSpent)}),i.jsx("td",{className:"py-3",children:i.jsxs(Xe,{variant:R.winsCount>0?"success":"warning",children:[R.winsCount," wins"]})})]},R.fanId)),g.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:y?"Loading...":"No fan data available"})})]})]})})]})]})}function l0e(){var G;const[r,n]=O.useState("revenue"),[o,l]=O.useState("month"),[u,m]=O.useState({totalRevenue:0,totalCommission:0,totalRefunds:0,eventsCount:0,bidsCount:0,creatorsCount:0,withdrawalsCount:0}),[g,E]=O.useState(!1),[y,x]=O.useState(!1),S=I=>{const j=new Date,L=new Date(j);let N=new Date(j);switch(I){case"7days":N.setDate(N.getDate()-7);break;case"30days":N.setDate(N.getDate()-30);break;case"month":N=new Date(j.getFullYear(),j.getMonth(),1);break;case"all":N=new Date(2020,0,1);break}return{start:N,end:L}};O.useEffect(()=>{(async()=>{E(!0);try{const{start:j,end:L}=S(o),{data:N}=await ie.from("bids").select("amount, status, created_at").gte("created_at",j.toISOString()).lte("created_at",L.toISOString()),D=(N??[]).filter(ve=>ve.status==="won"),V=(N??[]).filter(ve=>ve.status==="lost"),B=[...D,...V].reduce((ve,ye)=>ve+(ye.amount??0),0),z=Math.floor(B*.1),H=z,J=V.reduce((ve,ye)=>ve+Math.floor((ye.amount??0)*.9),0),{data:ee}=await ie.from("events").select("id").gte("created_at",j.toISOString()).lte("created_at",L.toISOString()),{data:ne}=await ie.from("users").select("id").eq("role","creator"),{data:he}=await ie.from("withdrawal_requests").select("id").gte("requested_at",j.toISOString()).lte("requested_at",L.toISOString());m({totalRevenue:H,totalCommission:z,totalRefunds:J,eventsCount:(ee==null?void 0:ee.length)??0,bidsCount:(N==null?void 0:N.length)??0,creatorsCount:(ne==null?void 0:ne.length)??0,withdrawalsCount:(he==null?void 0:he.length)??0})}finally{E(!1)}})()},[o]);const C=async()=>{x(!0);try{const{start:I,end:j}=S(o);let L="",N="";if(r==="revenue"||r==="bids"){const{data:z}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at").gte("created_at",I.toISOString()).lte("created_at",j.toISOString()).order("created_at",{ascending:!1});L=`ID,Event ID,Fan ID,Amount,Status,Date
`;for(const H of z??[])L+=`${H.id},${H.event_id},${H.fan_id},${H.amount},${H.status},"${Gt(H.created_at)}"
`;N=`bids_report_${o}.csv`}else if(r==="events"){const{data:z}=await ie.from("events").select("id, creator_id, title, status, base_price, starts_at, created_at").gte("created_at",I.toISOString()).lte("created_at",j.toISOString()).order("created_at",{ascending:!1});L=`ID,Creator ID,Title,Status,Base Price,Starts At,Created At
`;for(const H of z??[])L+=`${H.id},${H.creator_id},"${H.title}",${H.status},${H.base_price},"${Gt(H.starts_at)}","${Gt(H.created_at)}"
`;N=`events_report_${o}.csv`}else if(r==="creators"){const{data:z}=await ie.from("profiles").select("user_id, display_name, username, category, created_at"),{data:H}=await ie.from("users").select("id, email").eq("role","creator"),J=new Map;for(const ee of H??[])J.set(ee.id,ee.email);L=`User ID,Display Name,Username,Email,Category,Created At
`;for(const ee of z??[]){const ne=J.get(ee.user_id)??"";ne&&(L+=`${ee.user_id},"${ee.display_name??""}",${ee.username??""},${ne},${ee.category??""},"${Gt(ee.created_at)}"
`)}N="creators_report.csv"}else if(r==="withdrawals"){const{data:z}=await ie.from("withdrawal_requests").select("id, creator_id, amount, destination, status, requested_at, processed_at").gte("requested_at",I.toISOString()).lte("requested_at",j.toISOString()).order("requested_at",{ascending:!1});L=`ID,Creator ID,Amount,Destination,Status,Requested At,Processed At
`;for(const H of z??[])L+=`${H.id},${H.creator_id},${H.amount},"${H.destination??""}",${H.status},"${Gt(H.requested_at)}","${H.processed_at?Gt(H.processed_at):""}"
`;N=`withdrawals_report_${o}.csv`}const D=new Blob([L],{type:"text/csv;charset=utf-8;"}),V=URL.createObjectURL(D),B=document.createElement("a");B.setAttribute("href",V),B.setAttribute("download",N),B.style.visibility="hidden",document.body.appendChild(B),B.click(),document.body.removeChild(B),alert(`Report exported: ${N}`)}finally{x(!1)}},R=[{key:"revenue",label:"Revenue Summary",icon:""},{key:"bids",label:"Bids Report",icon:""},{key:"events",label:"Events Report",icon:""},{key:"creators",label:"Creators Report",icon:""},{key:"withdrawals",label:"Withdrawals Report",icon:""}],M={"7days":"Last 7 Days","30days":"Last 30 Days",month:"This Month",all:"All Time"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Revenue Reports"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Generate and export financial reports from your platform data."})]})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Quick Stats",subtitle:`Overview for ${M[o]}`}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Revenue"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:We(u.totalRevenue)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Platform Commission"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#28A745]",children:We(u.totalCommission)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunds"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#DC3545]",children:We(u.totalRefunds)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Totals"}),i.jsxs("p",{className:"mt-2 text-sm text-[#212529]",children:[u.eventsCount," events  ",u.bidsCount," bids  ",u.creatorsCount," creators"]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Generate Report",subtitle:"Select report type and date range to export."}),i.jsxs(Ee,{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("p",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Report Type"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(I=>i.jsxs(oe,{size:"sm",variant:r===I.key?"secondary":"ghost",onClick:()=>n(I.key),children:[I.icon," ",I.label]},I.key))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Date Range"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:["7days","30days","month","all"].map(I=>i.jsx(oe,{size:"sm",variant:o===I?"secondary":"ghost",onClick:()=>l(I),children:M[I]},I))})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Report Configuration"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[i.jsxs("li",{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Report Type"}),i.jsx("span",{className:"font-medium text-[#212529]",children:(G=R.find(I=>I.key===r))==null?void 0:G.label})]}),i.jsxs("li",{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Date Range"}),i.jsx("span",{className:"font-medium text-[#212529]",children:M[o]})]}),i.jsxs("li",{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Format"}),i.jsx("span",{className:"font-medium text-[#212529]",children:"CSV"})]})]})]}),i.jsx(oe,{onClick:C,disabled:y||g,children:y?" Generating...":" Export CSV Report"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Available Reports",subtitle:"Quick export options for common reports."}),i.jsx(Ee,{className:"space-y-3",children:R.map(I=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium text-[#212529]",children:[I.icon," ",I.label]}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:["Export ",I.key==="creators"?"all creators":`${M[o].toLowerCase()}`," data"]})]}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>{n(I.key),C()},disabled:y,children:"Export"})]},I.key))})]})]})}function d0e(){const[r,n]=O.useState({liveNow:0,eventsToday:0,eventsThisWeek:0,eventsThisMonth:0,completionRate:0,avgBidAmount:0,avgBidsPerEvent:0,totalRevenue:0}),[o,l]=O.useState([]),[u,m]=O.useState([]),[g,E]=O.useState([]),[y,x]=O.useState([]),[S,C]=O.useState(!1);O.useEffect(()=>{(async()=>{C(!0);try{const G=new Date,I=new Date(G.getFullYear(),G.getMonth(),G.getDate()),j=new Date(G.getTime()-7*24*60*60*1e3),L=new Date(G.getFullYear(),G.getMonth(),1),{data:N}=await ie.from("events").select("id, creator_id, title, status, category, base_price, starts_at, created_at"),D=(N==null?void 0:N.length)??0,V=(N??[]).filter(De=>De.status==="live").length,B=(N??[]).filter(De=>new Date(De.created_at)>=I).length,z=(N??[]).filter(De=>new Date(De.created_at)>=j).length,H=(N??[]).filter(De=>new Date(De.created_at)>=L).length,J=(N??[]).filter(De=>De.status==="completed").length,ee=D>0?J/D*100:0,{data:ne}=await ie.from("bids").select("id, event_id, amount, status"),he=(ne==null?void 0:ne.length)??0,ve=he>0?(ne??[]).reduce((De,Ae)=>De+(Ae.amount??0),0)/he:0,ye=D>0?he/D:0,me=(ne??[]).filter(De=>De.status==="won"),ue=me.reduce((De,Ae)=>De+(Ae.amount??0),0);n({liveNow:V,eventsToday:B,eventsThisWeek:z,eventsThisMonth:H,completionRate:ee,avgBidAmount:ve,avgBidsPerEvent:ye,totalRevenue:ue});const Fe=new Map;for(const De of N??[])Fe.set(De.status,(Fe.get(De.status)??0)+1);const be=Array.from(Fe.entries()).map(([De,Ae])=>({status:De,count:Ae,percentage:D>0?Ae/D*100:0})).sort((De,Ae)=>Ae.count-De.count);l(be);const ae=new Map;for(const De of N??[]){const Ae=De.category||"general",Qe=ae.get(Ae)??{count:0,eventIds:[]};Qe.count++,Qe.eventIds.push(De.id),ae.set(Ae,Qe)}const ge=Array.from(ae.entries()).map(([De,Ae])=>{const pe=me.filter(Re=>Ae.eventIds.includes(Re.event_id)).reduce((Re,Ge)=>Re+(Ge.amount??0),0);return{category:De,count:Ae.count,revenue:pe}}).sort((De,Ae)=>Ae.count-De.count);m(ge);const Se=Array.from(new Set((N??[]).map(De=>De.creator_id))),{data:it}=Se.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Se):{data:[]},Ue=new Map;for(const De of it??[])Ue.set(De.user_id,De.display_name||De.username||"Creator");const ht=new Map;for(const De of ne??[]){const Ae=ht.get(De.event_id)??{count:0,highest:0};Ae.count++,Ae.highest=Math.max(Ae.highest,De.amount??0),ht.set(De.event_id,Ae)}const qe=(N??[]).map(De=>{var Ae,Qe;return{id:De.id,title:De.title,creatorName:Ue.get(De.creator_id)??"Unknown",bidsCount:((Ae=ht.get(De.id))==null?void 0:Ae.count)??0,highestBid:((Qe=ht.get(De.id))==null?void 0:Qe.highest)??0,status:De.status}}),Me=[...qe].sort((De,Ae)=>Ae.bidsCount-De.bidsCount).slice(0,5);E(Me);const st=[...qe].sort((De,Ae)=>{const Qe=(N??[]).find(Re=>Re.id===De.id),pe=(N??[]).find(Re=>Re.id===Ae.id);return new Date((pe==null?void 0:pe.created_at)??0).getTime()-new Date((Qe==null?void 0:Qe.created_at)??0).getTime()}).slice(0,5);x(st)}finally{C(!1)}})()},[]);const R={live:"danger",upcoming:"primary",completed:"success",cancelled:"warning",draft:"warning"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Event Analytics"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Deep dive into event performance and engagement metrics."})]})}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Key Metrics",subtitle:"Real-time event snapshot"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Live Now"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#DC3545]",children:r.liveNow}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Currently active"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Today"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:r.eventsToday}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[r.eventsThisWeek," this week"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Completion Rate"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#28A745]",children:[r.completionRate.toFixed(1),"%"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Events successfully completed"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Avg Bid Amount"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:We(r.avgBidAmount)}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[r.avgBidsPerEvent.toFixed(1)," bids/event avg"]})]})]})]}),i.jsxs("div",{className:"grid gap-8 lg:grid-cols-2",children:[i.jsxs(fe,{children:[i.jsx(Te,{title:"Events by Status",subtitle:"Distribution across statuses"}),i.jsxs(Ee,{className:"space-y-3",children:[o.map(M=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",children:[i.jsx("div",{className:"flex items-center gap-2",children:i.jsx(Xe,{variant:R[M.status]??"primary",children:M.status.charAt(0).toUpperCase()+M.status.slice(1)})}),i.jsxs("span",{className:"text-[#6C757D]",children:[M.percentage.toFixed(1),"%"]}),i.jsx("span",{className:"font-semibold text-[#212529]",children:M.count})]},M.status)),o.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:S?"Loading...":"No events data"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Events by Category",subtitle:"Revenue and count per category"}),i.jsxs(Ee,{className:"space-y-3",children:[u.map(M=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",children:[i.jsx("span",{className:"text-[#212529] capitalize",children:M.category}),i.jsxs("span",{className:"text-[#6C757D]",children:[M.count," events"]}),i.jsx("span",{className:"font-semibold text-[#28A745]",children:We(M.revenue)})]},M.category)),u.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:S?"Loading...":"No category data"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Top Events by Bids",subtitle:"Most popular events"}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Highest Bid"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),i.jsxs("tbody",{children:[g.map(M=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:M.title}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:M.creatorName}),i.jsx("td",{className:"py-3 font-semibold text-[#212529]",children:M.bidsCount}),i.jsx("td",{className:"py-3 text-[#28A745]",children:We(M.highestBid)}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:R[M.status]??"primary",children:M.status})})]},M.id)),g.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:S?"Loading...":"No event data available"})})]})]})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Recent Events",subtitle:"Latest created events"}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),i.jsx("tbody",{children:y.map(M=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:M.title}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:M.creatorName}),i.jsx("td",{className:"py-3 text-[#212529]",children:M.bidsCount}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:R[M.status]??"primary",children:M.status})})]},M.id))})]})})]})]})}const A7={login:"Login",logout:"Logout",signup:"Signup",event_created:"Event Created",event_updated:"Event Updated",event_cancelled:"Event Cancelled",event_completed:"Event Completed",bid_placed:"Bid Placed",bid_won:"Bid Won",bid_refunded:"Bid Refunded",withdrawal_requested:"Withdrawal Requested",withdrawal_approved:"Withdrawal Approved",withdrawal_rejected:"Withdrawal Rejected",user_suspended:"User Suspended",user_banned:"User Banned",user_unbanned:"User Unbanned",creator_approved:"Creator Approved",creator_rejected:"Creator Rejected",settings_updated:"Settings Updated",announcement_published:"Announcement Published",meet_scheduled:"Meet Scheduled",meet_completed:"Meet Completed",payment_processed:"Payment Processed",refund_processed:"Refund Processed",other:"Other"},u0e={system:"primary",admin:"danger",creator:"success",fan:"warning"};function h0e(){const[r,n]=O.useState([]),[o,l]=O.useState(!1),[u,m]=O.useState(""),[g,E]=O.useState(null),[y,x]=O.useState(null),S=async()=>{l(!0);try{let I=ie.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(100);g&&(I=I.eq("action_type",g)),y&&(I=I.eq("actor_type",y));const{data:j,error:L}=await I;if(L){console.error("Error fetching audit logs:",L),n([]);return}const N=(j??[]).map(D=>({id:D.id,actorId:D.actor_id,actorType:D.actor_type,actorName:D.actor_name,action:D.action,actionType:D.action_type,resourceType:D.resource_type,resourceId:D.resource_id,details:D.details,status:D.status,createdAt:D.created_at}));n(N)}finally{l(!1)}};O.useEffect(()=>{S()},[g,y]);const C=r.filter(I=>{var L;if(!u)return!0;const j=u.toLowerCase();return I.action.toLowerCase().includes(j)||I.id.toLowerCase().includes(j)||(((L=I.actorName)==null?void 0:L.toLowerCase().includes(j))??!1)}),R=["system","admin","creator","fan"],M={success:"success",warning:"warning",error:"danger"},G=()=>{const I=`ID,Time,Actor,Action,Type,Status
`+C.map(D=>`${D.id},"${Gt(D.createdAt)}","${D.actorName||D.actorType}","${D.action}",${D.actionType},${D.status}`).join(`
`),j=new Blob([I],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(j),N=document.createElement("a");N.setAttribute("href",L),N.setAttribute("download",`audit_logs_${new Date().toISOString().split("T")[0]}.csv`),N.style.visibility="hidden",document.body.appendChild(N),N.click(),document.body.removeChild(N)};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Audit Logs"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Immutable record of every critical action across the platform."})]}),i.jsx(oe,{variant:"secondary",onClick:G,children:" Export CSV"})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Filters",subtitle:"Filter logs by actor type and action type"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsx(tt,{label:"Search",placeholder:"ID, actor, action...",value:u,onChange:I=>m(I.target.value)}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Actor Type"}),i.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[i.jsx(oe,{size:"sm",variant:y===null?"secondary":"ghost",onClick:()=>x(null),children:"All"}),R.map(I=>i.jsx(oe,{size:"sm",variant:y===I?"secondary":"ghost",onClick:()=>x(I),children:I.charAt(0).toUpperCase()+I.slice(1)},I))]})]}),i.jsxs("div",{className:"md:col-span-2",children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Action Type"}),i.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[i.jsx(oe,{size:"sm",variant:g===null?"secondary":"ghost",onClick:()=>E(null),children:"All"}),["login","bid_placed","bid_won","bid_refunded","withdrawal_approved","event_created"].map(I=>i.jsx(oe,{size:"sm",variant:g===I?"secondary":"ghost",onClick:()=>E(I),children:A7[I]},I))]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Log Stream",subtitle:`${C.length} entries  Newest first`}),i.jsxs(Ee,{className:"space-y-4",children:[C.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:o?"Loading logs...":"No audit logs found. Actions will appear here as they occur."}),C.map(I=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[i.jsx("div",{className:"font-semibold",children:I.action}),i.jsx(Xe,{variant:M[I.status]??"primary",children:I.status.charAt(0).toUpperCase()+I.status.slice(1)})]}),i.jsxs("p",{className:"mt-2 text-[#6C757D]",children:[Gt(I.createdAt)," "," ",i.jsx(Xe,{variant:u0e[I.actorType]??"primary",children:I.actorType}),I.actorName&&`  ${I.actorName}`]}),I.details&&Object.keys(I.details).length>0&&i.jsxs("p",{className:"mt-2 text-xs text-[#6C757D]",children:[JSON.stringify(I.details).slice(0,200),JSON.stringify(I.details).length>200&&"..."]}),i.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:[i.jsx(Xe,{variant:"primary",children:A7[I.actionType]??I.actionType}),I.resourceType&&i.jsx(Xe,{variant:"warning",children:I.resourceType})]})]},I.id))]})]})]})}const p0e=[{label:"All",value:"all"},{label:" Overdue",value:"overdue"},{label:"Open",value:"open"},{label:"In Progress",value:"in_progress"},{label:"Resolved",value:"resolved"},{label:"Closed",value:"closed"}],I7={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"},m0e=(r,n,o)=>{if(o==="resolved"||o==="closed"||n)return!1;const l=new Date(r);return(new Date().getTime()-l.getTime())/(1e3*60*60)>=24};function f0e(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(!1),[E,y]=O.useState(""),[x,S]=O.useState("all"),[C,R]=O.useState(null),[M,G]=O.useState(""),[I,j]=O.useState(!1);O.useEffect(()=>{(async()=>{g(!0);try{const{data:z,error:H}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at, first_response_at, users:user_id (email, role, display_name)").order("created_at",{ascending:!0});if(H||!z){console.error("Error fetching support tickets:",H),o([]);return}const J=z.map(ee=>{const ne=ee.users,he=(ne==null?void 0:ne.display_name)||(ne!=null&&ne.email?ne.email.split("@")[0]:"User"),ve=m0e(ee.created_at,ee.first_response_at,ee.status);return{id:ee.id,subject:ee.subject,description:ee.description,status:ee.status,createdAt:ee.created_at,updatedAt:ee.updated_at,firstResponseAt:ee.first_response_at,userName:he,userEmail:(ne==null?void 0:ne.email)??"",userRole:(ne==null?void 0:ne.role)??"",isOverdue:ve}});J.sort((ee,ne)=>ee.isOverdue&&!ne.isOverdue?-1:!ee.isOverdue&&ne.isOverdue?1:new Date(ee.createdAt).getTime()-new Date(ne.createdAt).getTime()),o(J),J.length>0&&!C&&R(J[0].id)}finally{g(!1)}})()},[]),O.useEffect(()=>{(async()=>{if(!C){u([]);return}const{data:z,error:H}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at, user_id").eq("ticket_id",C).order("created_at",{ascending:!0});if(H||!z){console.error("Error fetching replies:",H),u([]);return}const J=[...new Set(z.map(ne=>ne.user_id).filter(Boolean))];let ee={};if(J.length>0){const{data:ne}=await ie.from("users").select("id, display_name, email").in("id",J);ne&&(ee=Object.fromEntries(ne.map(he=>{var ve;return[he.id,he.display_name||((ve=he.email)==null?void 0:ve.split("@")[0])||"User"]})))}u(z.map(ne=>({id:ne.id,message:ne.message,isAdminReply:ne.is_admin_reply,createdAt:ne.created_at,userName:ne.is_admin_reply?"Support Team":ee[ne.user_id]||"User"})))})()},[C]);const L=O.useMemo(()=>{const B=E.trim().toLowerCase();return n.filter(z=>{if(x==="overdue"){if(!z.isOverdue)return!1}else if(x!=="all"&&z.status!==x)return!1;return B?z.subject.toLowerCase().includes(B)||z.userName.toLowerCase().includes(B)||z.userEmail.toLowerCase().includes(B)||z.id.toLowerCase().includes(B):!0})},[n,E,x]),N=async()=>{if(!r||!C||!M.trim()){alert("Please enter a reply message.");return}j(!0);try{const{error:B}=await ie.from("ticket_replies").insert({ticket_id:C,user_id:r.id,message:M.trim(),is_admin_reply:!0});if(B){console.error("Error sending reply:",B),alert("Failed to send reply.");return}const z=n.find(H=>H.id===C);z&&!z.firstResponseAt&&(await ie.from("support_tickets").update({first_response_at:new Date().toISOString(),status:z.status==="open"?"in_progress":z.status}).eq("id",C),o(H=>H.map(J=>J.id===C?{...J,firstResponseAt:new Date().toISOString(),isOverdue:!1,status:J.status==="open"?"in_progress":J.status}:J))),u(H=>[...H,{id:`temp-${Date.now()}`,message:M.trim(),isAdminReply:!0,createdAt:new Date().toISOString(),userName:"Support Team"}]),G(""),alert("Reply sent successfully!")}finally{j(!1)}},D=O.useMemo(()=>n.find(B=>B.id===C)??null,[n,C]),V=async(B,z)=>{if(window.confirm(`Change status of ticket "${B.subject}" to ${z.replace("_"," ")}?`)){g(!0);try{const{error:J}=await ie.from("support_tickets").update({status:z}).eq("id",B.id);if(J){console.error("Error updating ticket:",J),alert("Failed to update ticket status.");return}o(ee=>ee.map(ne=>ne.id===B.id?{...ne,status:z}:ne))}finally{g(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Support Tickets"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track customer issues, update their status, and maintain SLAs."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",disabled:!0,children:"View SLA Dashboard"}),i.jsx(oe,{disabled:!0,children:"Assign to Me"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Filters",subtitle:"Focus on critical tickets or specific owners."}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsx(tt,{label:"Search",placeholder:"Ticket ID, subject, user",value:E,onChange:B=>y(B.target.value)}),i.jsx(tt,{label:"Date Range",placeholder:"(coming soon)",disabled:!0}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:p0e.map(B=>i.jsx("button",{type:"button",className:`rounded-full border px-3 py-1 text-xs font-medium ${x===B.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,onClick:()=>S(B.value),children:B.label},B.value))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Priority"}),i.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:[i.jsx(Xe,{variant:"danger",children:"Critical (coming soon)"}),i.jsx(Xe,{variant:"warning",children:"High (coming soon)"})]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Tickets",subtitle:"Oldest tickets shown first. Overdue tickets (24h+ no response) highlighted in red."}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Ticket"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Created"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"SLA"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[L.map(B=>i.jsxs("tr",{className:`border-b border-[#E9ECEF] ${B.isOverdue?"bg-red-50 hover:bg-red-100":C===B.id?"bg-[#F8F9FA]":""}`,children:[i.jsx("td",{className:"py-3 text-[#212529]",children:i.jsxs("button",{type:"button",className:"flex flex-col text-left",onClick:()=>R(B.id),children:[i.jsxs("div",{className:"flex items-center gap-2",children:[B.isOverdue&&i.jsx("span",{className:"text-red-500",children:""}),i.jsx("span",{className:"font-semibold",children:B.subject})]}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[B.id.slice(0,8),"..."]})]})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{children:B.userName}),i.jsx("span",{className:"text-xs",children:B.userEmail})]})}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:I7[B.status],children:B.status.replace("_"," ")})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:Gt(B.createdAt)}),i.jsx("td",{className:"py-3",children:B.isOverdue?i.jsx("span",{className:"font-semibold text-red-600",children:" OVERDUE"}):B.firstResponseAt?i.jsx("span",{className:"text-green-600",children:" Responded"}):i.jsx("span",{className:"text-yellow-600",children:"Awaiting"})}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[B.status!=="resolved"&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>V(B,"resolved"),children:"Mark Resolved"}),B.status!=="in_progress"&&B.status!=="resolved"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>V(B,"in_progress"),children:"In Progress"}),B.status!=="closed"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>V(B,"closed"),children:"Close"})]})})]},B.id)),L.length===0&&!m&&i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-6 text-center text-sm text-[#6C757D]",children:"No tickets match your filters."})})]})]})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Ticket Detail & Conversation",subtitle:"View ticket details and reply to the user."}),i.jsx(Ee,{className:"flex flex-col gap-4",children:D?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[D.isOverdue&&i.jsx("span",{className:"text-red-500 text-lg",children:""}),i.jsx("h2",{className:"text-lg font-semibold",children:D.subject})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[D.isOverdue&&i.jsx(Xe,{variant:"danger",children:"OVERDUE 24h+"}),i.jsx(Xe,{variant:I7[D.status],children:D.status.replace("_"," ")})]})]}),i.jsxs("div",{className:"grid gap-2 text-[#6C757D] md:grid-cols-3",children:[i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"From:"})," ",D.userName," (",D.userEmail,")"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"Created:"})," ",Gt(D.createdAt)]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"Role:"})," ",D.userRole||"User"]})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Original Message"}),i.jsx("p",{className:"mt-2 whitespace-pre-line",children:D.description})]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6",children:[i.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-4",children:["Conversation (",l.length," ",l.length===1?"reply":"replies",")"]}),i.jsx("div",{className:"flex flex-col gap-3 max-h-[400px] overflow-y-auto",children:l.length===0?i.jsx("p",{className:"text-sm text-[#6C757D] text-center py-4",children:"No replies yet. Be the first to respond!"}):l.map(B=>i.jsxs("div",{className:`rounded-[12px] p-4 ${B.isAdminReply?"bg-[#F4E6FF] ml-8":"bg-[#F8F9FA] mr-8"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[i.jsxs("span",{className:`text-sm font-semibold ${B.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:[B.userName,B.isAdminReply&&" (Admin)"]}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Gt(B.createdAt)})]}),i.jsx("p",{className:"text-sm text-[#212529] whitespace-pre-line",children:B.message})]},B.id))})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-3",children:"Send Reply"}),i.jsx(nr,{label:"",rows:4,placeholder:"Type your reply to the user...",value:M,onChange:B=>G(B.target.value)}),i.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[i.jsx(oe,{onClick:N,disabled:I||!M.trim(),children:I?"Sending...":"Send Reply"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>D&&V(D,"resolved"),children:"Mark Resolved"}),i.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>D&&V(D,"in_progress"),children:"In Progress"}),i.jsx(oe,{variant:"danger",size:"sm",onClick:()=>D&&V(D,"closed"),children:"Close"})]})]})]}):i.jsx("p",{className:"text-sm text-[#6C757D] text-center py-8",children:"Select a ticket from the table above to view details and reply."})})]})]})}const g0e=["new","investigating","resolved","escalated","dismissed"];function _0e(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(null),[x,S]=O.useState(null),[C,R]=O.useState(""),M=async()=>{u(!0);try{const{data:N,error:D}=await ie.from("reports").select("*").order("created_at",{ascending:!1});if(D){console.error("Error fetching reports:",D);return}const V=new Set;for(const J of N??[])J.reporter_id&&V.add(J.reporter_id),J.reported_user_id&&V.add(J.reported_user_id);const{data:B}=V.size?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Array.from(V)):{data:[]},z=new Map;for(const J of B??[])z.set(J.user_id,J.display_name||J.username||"User");const H=(N??[]).map(J=>({id:J.id,reporterId:J.reporter_id,reporterName:z.get(J.reporter_id)??"System",reportedUserId:J.reported_user_id,reportedUserName:J.reported_user_id?z.get(J.reported_user_id)??"Unknown":null,reportedEventId:J.reported_event_id,reportType:J.report_type,resourceType:J.resource_type,title:J.title,description:J.description,severity:J.severity,status:J.status,createdAt:J.created_at}));o(H)}finally{u(!1)}};O.useEffect(()=>{M()},[]);const G=async(N,D)=>{if(window.confirm(`Update report status to "${D}"?`)){u(!0);try{const B={status:D,updated_at:new Date().toISOString()};(D==="resolved"||D==="dismissed")&&(B.resolved_at=new Date().toISOString(),B.resolved_by=r==null?void 0:r.id,C.trim()&&(B.resolution_notes=C.trim()));const{error:z}=await ie.from("reports").update(B).eq("id",N);if(z){console.error("Error updating report:",z),alert("Failed to update report");return}await M(),R(""),alert("Report updated successfully")}finally{u(!1)}}},I=n.filter(N=>{var D;if(E&&N.status!==E)return!1;if(m){const V=m.toLowerCase();return N.title.toLowerCase().includes(V)||N.reporterName.toLowerCase().includes(V)||(((D=N.reportedUserName)==null?void 0:D.toLowerCase().includes(V))??!1)||N.id.toLowerCase().includes(V)}return!0}),j={new:"primary",investigating:"warning",resolved:"success",escalated:"danger",dismissed:"warning"},L={low:"primary",medium:"warning",high:"warning",critical:"danger"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Reports & Flags"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Investigate community reports and moderate platform safety."})]}),i.jsxs(Xe,{variant:n.filter(N=>N.status==="new").length>0?"danger":"success",children:[n.filter(N=>N.status==="new").length," new reports"]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Filters",subtitle:"Narrow down by status or search"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Search",placeholder:"Report ID, title, reporter...",value:m,onChange:N=>g(N.target.value)}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{size:"sm",variant:E===null?"secondary":"ghost",onClick:()=>y(null),children:"All"}),g0e.map(N=>i.jsx(oe,{size:"sm",variant:E===N?"secondary":"ghost",onClick:()=>y(N),children:N.charAt(0).toUpperCase()+N.slice(1).replace("_"," ")},N))]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Flagged Items",subtitle:`${I.length} reports`}),i.jsxs(Ee,{className:"space-y-4",children:[I.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No reports found"}),I.map(N=>i.jsxs("div",{className:`flex flex-col gap-4 rounded-[16px] border p-5 text-sm text-[#212529] ${(x==null?void 0:x.id)===N.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-[#F8F9FA]"}`,onClick:()=>S(N),children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold",children:N.title}),i.jsxs("p",{className:"text-[#6C757D]",children:[N.resourceType,"  ",N.reportType]})]}),i.jsx(Xe,{variant:j[N.status]??"primary",children:N.status.replace("_"," ")})]}),i.jsxs("div",{className:"grid gap-3 md:grid-cols-3 text-[#6C757D]",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Reporter"}),i.jsx("p",{children:N.reporterName})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Reported"}),i.jsx("p",{children:N.reportedUserName||"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Submitted"}),i.jsx("p",{children:Gt(N.createdAt)})]})]}),N.description&&i.jsx("p",{className:"text-[#6C757D]",children:N.description}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(Xe,{variant:L[N.severity]??"primary",children:N.severity}),N.status==="new"&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>G(N.id,"investigating"),children:"Investigate"}),N.status==="investigating"&&i.jsxs(i.Fragment,{children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>G(N.id,"escalated"),children:"Escalate"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>G(N.id,"resolved"),children:"Resolve"})]}),N.status!=="resolved"&&N.status!=="dismissed"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>G(N.id,"dismissed"),children:"Dismiss"})]})]},N.id))]})]}),x&&i.jsxs(fe,{children:[i.jsx(Te,{title:"Resolution Notes",subtitle:`For report: ${x.title}`}),i.jsxs(Ee,{className:"space-y-4",children:[i.jsx(nr,{label:"Resolution Summary",rows:3,placeholder:"Explain action taken, evidence reviewed, outcome...",value:C,onChange:N=>R(N.target.value)}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>G(x.id,"resolved"),disabled:l,children:"Mark Resolved"}),i.jsx(oe,{variant:"ghost",onClick:()=>G(x.id,"escalated"),disabled:l,children:"Escalate"})]})]})]})]})}const v0e=["new","under_review","escalated","resolved","closed"];function E0e(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(null),[x,S]=O.useState(null),[C,R]=O.useState(""),M=async()=>{u(!0);try{const{data:N,error:D}=await ie.from("disputes").select("*").order("created_at",{ascending:!1});if(D){console.error("Error fetching disputes:",D);return}const V=new Set;for(const ne of N??[])V.add(ne.complainant_id),V.add(ne.respondent_id);const{data:B}=V.size?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Array.from(V)):{data:[]},{data:z}=V.size?await ie.from("users").select("id, role").in("id",Array.from(V)):{data:[]},H=new Map,J=new Map;for(const ne of B??[])H.set(ne.user_id,ne.display_name||ne.username||"User");for(const ne of z??[])J.set(ne.id,ne.role);const ee=(N??[]).map(ne=>({id:ne.id,complainantId:ne.complainant_id,complainantName:`${J.get(ne.complainant_id)==="creator"?"Creator":"Fan"}  ${H.get(ne.complainant_id)??"Unknown"}`,respondentId:ne.respondent_id,respondentName:`${J.get(ne.respondent_id)==="creator"?"Creator":"Fan"}  ${H.get(ne.respondent_id)??"Unknown"}`,eventId:ne.event_id,disputeType:ne.dispute_type,title:ne.title,description:ne.description,amount:ne.amount??0,priority:ne.priority,status:ne.status,resolution:ne.resolution,createdAt:ne.created_at}));o(ee)}finally{u(!1)}};O.useEffect(()=>{M()},[]);const G=async(N,D)=>{if(window.confirm(`Update dispute status to "${D.replace("_"," ")}"?`)){u(!0);try{const B={status:D,updated_at:new Date().toISOString()};(D==="resolved"||D==="closed")&&(B.resolved_at=new Date().toISOString(),B.resolved_by=r==null?void 0:r.id,C.trim()&&(B.resolution=C.trim()));const{error:z}=await ie.from("disputes").update(B).eq("id",N);if(z){console.error("Error updating dispute:",z),alert("Failed to update dispute");return}await M(),R(""),alert("Dispute updated successfully")}finally{u(!1)}}},I=n.filter(N=>{if(E&&N.status!==E)return!1;if(m){const D=m.toLowerCase();return N.title.toLowerCase().includes(D)||N.complainantName.toLowerCase().includes(D)||N.respondentName.toLowerCase().includes(D)||N.id.toLowerCase().includes(D)}return!0}),j={new:"primary",under_review:"warning",escalated:"danger",resolved:"success",closed:"success"},L={low:"primary",medium:"warning",high:"warning",critical:"danger"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Dispute Management"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Resolve conflicts between fans and creators fairly."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Xe,{variant:"warning",children:[n.filter(N=>N.status==="new"||N.status==="under_review").length," active"]}),i.jsxs(Xe,{variant:"danger",children:[n.filter(N=>N.status==="escalated").length," escalated"]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Filters",subtitle:"Identify disputes based on status"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Search",placeholder:"Dispute ID, title, names...",value:m,onChange:N=>g(N.target.value)}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{size:"sm",variant:E===null?"secondary":"ghost",onClick:()=>y(null),children:"All"}),v0e.map(N=>i.jsx(oe,{size:"sm",variant:E===N?"secondary":"ghost",onClick:()=>y(N),children:N.replace("_"," ")},N))]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Active Disputes",subtitle:`${I.length} disputes`}),i.jsx(Ee,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Dispute"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Complainant"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Respondent"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Priority"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Created"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[I.map(N=>i.jsxs("tr",{className:`border-b border-[#E9ECEF] cursor-pointer hover:bg-[#F8F9FA] ${(x==null?void 0:x.id)===N.id?"bg-[#F4E6FF]/30":""}`,onClick:()=>S(N),children:[i.jsx("td",{className:"py-3 text-[#212529]",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-semibold",children:N.title}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:N.disputeType})]})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:N.complainantName}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:N.respondentName}),i.jsx("td",{className:"py-3 text-[#212529]",children:We(N.amount)}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:j[N.status]??"primary",children:N.status.replace("_"," ")})}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:L[N.priority]??"primary",children:N.priority})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:Gt(N.createdAt)}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[N.status==="new"&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:D=>{D.stopPropagation(),G(N.id,"under_review")},children:"Review"}),N.status==="under_review"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:D=>{D.stopPropagation(),G(N.id,"escalated")},children:"Escalate"}),N.status!=="resolved"&&N.status!=="closed"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:D=>{D.stopPropagation(),G(N.id,"resolved")},children:"Resolve"})]})})]},N.id)),I.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:8,className:"py-8 text-center text-[#6C757D]",children:l?"Loading...":"No disputes found"})})]})]})})]}),x&&i.jsxs(fe,{children:[i.jsx(Te,{title:"Dispute Detail",subtitle:x.title}),i.jsxs(Ee,{className:"grid gap-4 lg:grid-cols-2",children:[i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[i.jsx(Xe,{variant:j[x.status]??"primary",children:x.status.replace("_"," ")}),i.jsx(Xe,{variant:L[x.priority]??"primary",children:x.priority}),i.jsx(Xe,{variant:"primary",children:x.disputeType})]}),i.jsxs("div",{className:"space-y-2 text-[#6C757D]",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Complainant:"})," ",x.complainantName]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Respondent:"})," ",x.respondentName]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Amount:"})," ",We(x.amount)]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Created:"})," ",Gt(x.createdAt)]})]}),x.description&&i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold",children:"Description"}),i.jsx("p",{className:"text-[#6C757D]",children:x.description})]}),x.resolution&&i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"font-semibold text-[#28A745]",children:"Resolution"}),i.jsx("p",{className:"text-[#6C757D]",children:x.resolution})]})]}),i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Resolution"}),i.jsx(nr,{label:"Decision & Outcome",rows:4,placeholder:"Describe resolution, compensation, actions taken...",value:C,onChange:N=>R(N.target.value)}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>G(x.id,"resolved"),disabled:l,children:"Mark Resolved"}),x.status!=="escalated"&&i.jsx(oe,{variant:"ghost",onClick:()=>G(x.id,"escalated"),disabled:l,children:"Escalate"}),i.jsx(oe,{variant:"ghost",onClick:()=>G(x.id,"closed"),disabled:l,children:"Close"})]})]})]})]})]})}function y0e(){const{user:r}=vs(),[n,o]=O.useState({platform_name:"FanMeet Five",support_email:"support@fanmeet.com",support_phone:"+91 98765 43210",default_timezone:"Asia/Kolkata",maintenance_mode:!1,welcome_message:"",default_commission:10,cancellation_window:12,auto_refund_percentage:90}),[l,u]=O.useState(!1),[m,g]=O.useState(!1);O.useEffect(()=>{(async()=>{u(!0);try{const{data:S,error:C}=await ie.from("platform_settings").select("key, value").in("key",["platform_name","support_email","support_phone","default_timezone","maintenance_mode","welcome_message","default_commission","cancellation_window","auto_refund_percentage"]);if(C){console.error("Error fetching settings:",C);return}const R={...n};for(const M of S??[])try{R[M.key]=JSON.parse(M.value)}catch{R[M.key]=M.value}o(R)}finally{u(!1)}})()},[]);const E=async()=>{g(!0);try{const x=Object.entries(n).map(([S,C])=>({key:S,value:JSON.stringify(C),updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}));for(const S of x){const{error:C}=await ie.from("platform_settings").update({value:S.value,updated_by:S.updated_by,updated_at:S.updated_at}).eq("key",S.key);C&&console.error("Error updating setting:",S.key,C)}alert("Settings saved successfully!")}finally{g(!1)}},y=async()=>{const x=!n.maintenance_mode;if(!window.confirm(`Are you sure you want to ${x?"enable":"disable"} maintenance mode?`))return;o({...n,maintenance_mode:x});const{error:C}=await ie.from("platform_settings").update({value:JSON.stringify(x),updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}).eq("key","maintenance_mode");C&&(console.error("Error toggling maintenance mode:",C),o({...n,maintenance_mode:!x}),alert("Failed to update maintenance mode"))};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"General Settings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Configure platform basics, support contacts, and global defaults."})]}),i.jsx(oe,{onClick:E,disabled:m,children:m?"Saving...":"Save Changes"})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Platform Info",subtitle:"Branding and contact details"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Platform Name",value:n.platform_name,onChange:x=>o({...n,platform_name:x.target.value})}),i.jsx(tt,{label:"Support Email",value:n.support_email,onChange:x=>o({...n,support_email:x.target.value})}),i.jsx(tt,{label:"Support Phone",value:n.support_phone,onChange:x=>o({...n,support_phone:x.target.value})}),i.jsx(tt,{label:"Default Timezone",value:n.default_timezone,onChange:x=>o({...n,default_timezone:x.target.value})}),i.jsx("div",{className:"md:col-span-2",children:i.jsx(nr,{label:"Welcome Message",rows:3,placeholder:"Displayed to new users",value:n.welcome_message,onChange:x=>o({...n,welcome_message:x.target.value})})})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Sessions & Commission",subtitle:"Monetization and scheduling settings"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Cancellation Window (hours)",type:"number",value:n.cancellation_window.toString(),onChange:x=>o({...n,cancellation_window:parseInt(x.target.value)||0})}),i.jsx(tt,{label:"Default Commission (%)",type:"number",value:n.default_commission.toString(),onChange:x=>o({...n,default_commission:parseInt(x.target.value)||0})}),i.jsx(tt,{label:"Auto Refund Percentage",type:"number",value:n.auto_refund_percentage.toString(),onChange:x=>o({...n,auto_refund_percentage:parseInt(x.target.value)||0})}),i.jsxs("div",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm font-semibold text-[#212529]",children:["Auto Refunds: ",n.auto_refund_percentage,"%"]}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:["Retain ",100-n.auto_refund_percentage,"% commission from non-winning bids"]})]}),i.jsx(Xe,{variant:"success",children:"Active"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Maintenance Mode",subtitle:"Temporarily pause user access during updates"}),i.jsxs(Ee,{className:`flex flex-wrap items-center justify-between gap-4 rounded-[16px] border p-5 ${n.maintenance_mode?"border-[#DC3545] bg-[#DC3545]/10":"border-[#28A745] bg-[#28A745]/10"}`,children:[i.jsxs("div",{children:[i.jsxs("p",{className:`text-sm font-semibold ${n.maintenance_mode?"text-[#DC3545]":"text-[#28A745]"}`,children:["Maintenance mode is currently ",n.maintenance_mode?"ON":"OFF"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:n.maintenance_mode?"Users cannot access the platform. Disable to restore access.":"Platform is operational. Enable to block user access."})]}),i.jsx(oe,{variant:n.maintenance_mode?"secondary":"danger",onClick:y,children:n.maintenance_mode?"Disable Maintenance":"Enable Maintenance"})]})]})]})}function x0e(){const{user:r}=vs(),[n,o]=O.useState({default_commission:10,min_bid_increment:20,fast_payout_fee:20,auto_refund_percentage:90}),[l,u]=O.useState(!1),[m,g]=O.useState(!1),E=[{basePrice:50,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage},{basePrice:100,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage},{basePrice:200,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage}].map(x=>({...x,creatorShare:x.basePrice*(1-x.commission/100)}));O.useEffect(()=>{(async()=>{u(!0);try{const{data:S,error:C}=await ie.from("platform_settings").select("key, value").in("key",["default_commission","min_bid_increment","fast_payout_fee","auto_refund_percentage"]);if(C){console.error("Error fetching settings:",C);return}const R={...n};for(const M of S??[])try{R[M.key]=JSON.parse(M.value)}catch{R[M.key]=M.value}o(R)}finally{u(!1)}})()},[]);const y=async()=>{g(!0);try{const x=Object.entries(n).map(([S,C])=>({key:S,value:JSON.stringify(C),updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}));for(const S of x){const{error:C}=await ie.from("platform_settings").update({value:S.value,updated_by:S.updated_by,updated_at:S.updated_at}).eq("key",S.key);C&&console.error("Error updating setting:",S.key,C)}alert("Pricing settings saved successfully!")}finally{g(!1)}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Pricing & Commission"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control base pricing, creator revenue share, and commission rates."})]}),i.jsx(oe,{onClick:y,disabled:m,children:m?"Saving...":"Save Changes"})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Commission Settings",subtitle:"Configure platform commission and fees"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Default Commission (%)",type:"number",value:n.default_commission.toString(),onChange:x=>o({...n,default_commission:parseInt(x.target.value)||0})}),i.jsx(tt,{label:"Auto Refund (%)",type:"number",value:n.auto_refund_percentage.toString(),onChange:x=>o({...n,auto_refund_percentage:parseInt(x.target.value)||0})}),i.jsx(tt,{label:"Minimum Bid Increment ()",type:"number",value:n.min_bid_increment.toString(),onChange:x=>o({...n,min_bid_increment:parseInt(x.target.value)||0})}),i.jsx(tt,{label:"Fast Payout Fee ()",type:"number",value:n.fast_payout_fee.toString(),onChange:x=>o({...n,fast_payout_fee:parseInt(x.target.value)||0})})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Revenue Split Preview",subtitle:"How revenue is divided based on current settings"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#C045FF]/30 bg-[#C045FF]/10 p-5 text-center",children:[i.jsxs("p",{className:"text-3xl font-bold text-[#C045FF]",children:[n.default_commission,"%"]}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Platform Commission"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-center",children:[i.jsxs("p",{className:"text-3xl font-bold text-[#28A745]",children:[100-n.default_commission,"%"]}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Creator Earnings"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#FFC107]/30 bg-[#FFC107]/10 p-5 text-center",children:[i.jsxs("p",{className:"text-3xl font-bold text-[#FFC107]",children:[n.auto_refund_percentage,"%"]}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Non-Winner Refund"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Pricing Tiers",subtitle:"Example pricing calculations based on current settings"}),i.jsx(Ee,{className:"space-y-4",children:E.map(x=>i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-lg font-semibold",children:[We(x.basePrice)," Base Price"]}),i.jsx("p",{className:"text-[#6C757D]",children:"Entry-level pricing tier"})]}),i.jsxs(Xe,{variant:"primary",children:[x.commission,"% commission"]})]}),i.jsxs("div",{className:"grid gap-3 md:grid-cols-3 text-[#6C757D]",children:[i.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[i.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Creator Receives"}),i.jsx("p",{className:"text-lg font-semibold text-[#28A745]",children:We(x.creatorShare)})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[i.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Platform Gets"}),i.jsx("p",{className:"text-lg font-semibold text-[#C045FF]",children:We(x.basePrice-x.creatorShare)})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[i.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Non-Winner Refund"}),i.jsx("p",{className:"text-lg font-semibold text-[#FFC107]",children:We(x.basePrice*x.autoRefund/100)})]})]})]},x.basePrice))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Fee Structure",subtitle:"Current platform fees"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("p",{className:"font-semibold text-[#212529]",children:"Minimum Bid Increment"}),i.jsx("p",{className:"text-2xl font-bold text-[#C045FF]",children:We(n.min_bid_increment)}),i.jsx("p",{className:"mt-2 text-xs text-[#6C757D]",children:"Minimum amount fans must increase their bids by"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("p",{className:"font-semibold text-[#212529]",children:"Fast Payout Fee"}),i.jsx("p",{className:"text-2xl font-bold text-[#C045FF]",children:We(n.fast_payout_fee)}),i.jsx("p",{className:"mt-2 text-xs text-[#6C757D]",children:"Fee for instant withdrawal processing"})]})]})]})]})}const b0e=[{name:"{{fan_name}}",description:"Fan's first name"},{name:"{{creator_name}}",description:"Creator display name"},{name:"{{event_title}}",description:"Event name"},{name:"{{cta_link}}",description:"Primary button URL"},{name:"{{amount}}",description:"Currency amount"}];function w0e(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(null),[E,y]=O.useState(""),[x,S]=O.useState(""),[C,R]=O.useState(""),[M,G]=O.useState(""),[I,j]=O.useState(!1),L=async()=>{u(!0);try{const{data:z,error:H}=await ie.from("email_templates").select("*").order("created_at",{ascending:!1});if(H){console.error("Error fetching templates:",H);return}const J=(z??[]).map(ee=>({id:ee.id,name:ee.name,subject:ee.subject,body:ee.body,audience:ee.audience,status:ee.status,createdAt:ee.created_at,updatedAt:ee.updated_at}));o(J)}finally{u(!1)}};O.useEffect(()=>{L()},[]);const N=z=>{g(z),y(z.name),S(z.subject),R(z.body),G(z.audience),j(!1)},D=()=>{g(null),y(""),S(""),R(""),G("all"),j(!0)},V=async z=>{if(!E.trim()||!x.trim()){alert("Name and subject are required");return}u(!0);try{if(I){const{error:H}=await ie.from("email_templates").insert({name:E.trim(),subject:x.trim(),body:C.trim(),audience:M.trim()||"all",status:z,created_by:r==null?void 0:r.id,updated_by:r==null?void 0:r.id});if(H){console.error("Error creating template:",H),alert("Failed to create template");return}}else if(m){const{error:H}=await ie.from("email_templates").update({name:E.trim(),subject:x.trim(),body:C.trim(),audience:M.trim()||"all",status:z,updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}).eq("id",m.id);if(H){console.error("Error updating template:",H),alert("Failed to update template");return}}await L(),alert(`Template ${I?"created":"updated"} successfully!`),j(!1)}finally{u(!1)}},B=async z=>{if(!window.confirm("Are you sure you want to delete this template?"))return;const{error:J}=await ie.from("email_templates").delete().eq("id",z);if(J){console.error("Error deleting template:",J),alert("Failed to delete template");return}await L(),(m==null?void 0:m.id)===z&&g(null)};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Email Templates"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage transactional and lifecycle emails sent by FanMeet."})]}),i.jsx(oe,{onClick:D,children:"Create New Template"})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Templates",subtitle:`${n.length} templates`}),i.jsxs(Ee,{className:"space-y-4",children:[n.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No templates yet. Create your first template."}),n.map(z=>i.jsxs("div",{className:`flex flex-col gap-4 rounded-[16px] border p-5 text-sm text-[#212529] cursor-pointer ${(m==null?void 0:m.id)===z.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-[#F8F9FA]"}`,onClick:()=>N(z),children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold",children:z.name}),i.jsxs("p",{className:"text-[#6C757D]",children:["Subject: ",z.subject]}),i.jsxs("p",{className:"text-xs text-[#ADB5BD]",children:["Audience: ",z.audience]})]}),i.jsx(Xe,{variant:z.status==="active"?"success":"warning",children:z.status})]}),i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-[#6C757D]",children:[i.jsxs("span",{children:["Last updated: ",Gt(z.updatedAt)]}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:H=>{H.stopPropagation(),B(z.id)},children:"Delete"})]})]},z.id))]})]}),(m||I)&&i.jsxs(fe,{children:[i.jsx(Te,{title:I?"New Template":"Edit Template",subtitle:I?"Create a new email template":m==null?void 0:m.name}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx(tt,{label:"Template Name",value:E,onChange:z=>y(z.target.value),placeholder:"e.g., Welcome Email"}),i.jsx(tt,{label:"Email Subject",value:x,onChange:z=>S(z.target.value),placeholder:"e.g., Welcome to FanMeet Five!"}),i.jsx(tt,{label:"Audience",value:M,onChange:z=>G(z.target.value),placeholder:"e.g., New fans, Creators"}),i.jsx(nr,{label:"Body",rows:10,value:C,onChange:z=>R(z.target.value),placeholder:`Hi {{fan_name}},

Thanks for joining...`}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>V("draft"),disabled:l,children:"Save Draft"}),i.jsx(oe,{onClick:()=>V("active"),disabled:l,children:"Publish"})]})]}),i.jsxs("div",{className:"space-y-3 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx("h2",{className:"text-sm font-semibold",children:"Available Snippets"}),i.jsx("ul",{className:"space-y-2 text-[#6C757D]",children:b0e.map(z=>i.jsxs("li",{className:"flex items-center justify-between",children:[i.jsx("code",{className:"bg-[#F8F9FA] px-2 py-1 rounded text-xs",children:z.name}),i.jsx("span",{className:"text-xs",children:z.description})]},z.name))}),i.jsxs("div",{className:"mt-4 rounded-[12px] bg-[#F8F9FA] p-4",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Preview"}),i.jsx("p",{className:"mt-2 whitespace-pre-line text-sm",children:C.replace("{{fan_name}}","Neha").replace("{{creator_name}}","Priya").replace("{{event_title}}","Live Chat Session").replace("{{cta_link}}","https://fanmeet.app").replace("{{amount}}","500")})]})]})]})]})]})}const S0e=[{id:"email",label:"Email",description:"Transactional and marketing emails",enabled:!0},{id:"push",label:"Push Notifications",description:"Mobile push via FanMeet app",enabled:!0},{id:"sms",label:"SMS",description:"Critical alerts and OTP delivery",enabled:!1},{id:"whatsapp",label:"WhatsApp",description:"High priority creator alerts",enabled:!1}],C0e=["bid_placed","bid_won","bid_refunded","event_created","event_cancelled","withdrawal_approved","withdrawal_rejected","meet_scheduled","meet_completed","support_ticket_update","dispute_escalated","creator_approved"];function T0e(){const[r,n]=O.useState([]),[o,l]=O.useState(S0e),[u,m]=O.useState(!1),[g,E]=O.useState(""),[y,x]=O.useState(["email"]),S=async()=>{m(!0);try{const{data:j,error:L}=await ie.from("notification_rules").select("*").order("trigger_event",{ascending:!0});if(L){console.error("Error fetching notification rules:",L);return}const N=(j??[]).map(D=>({id:D.id,triggerEvent:D.trigger_event,channels:D.channels??[],templateId:D.template_id,status:D.status}));n(N)}finally{m(!1)}};O.useEffect(()=>{S()},[]);const C=j=>{l(L=>L.map(N=>N.id===j?{...N,enabled:!N.enabled}:N))},R=async()=>{if(!g){alert("Select a trigger event");return}m(!0);try{const{error:j}=await ie.from("notification_rules").insert({trigger_event:g,channels:y,status:"active"});if(j){console.error("Error creating rule:",j),alert("Failed to create rule. It may already exist.");return}await S(),E(""),alert("Rule created successfully!")}finally{m(!1)}},M=async j=>{const L=j.status==="active"?"disabled":"active",{error:N}=await ie.from("notification_rules").update({status:L,updated_at:new Date().toISOString()}).eq("id",j.id);if(N){console.error("Error updating rule:",N),alert("Failed to update rule");return}await S()},G=async j=>{if(!window.confirm("Delete this notification rule?"))return;const{error:N}=await ie.from("notification_rules").delete().eq("id",j);if(N){console.error("Error deleting rule:",N),alert("Failed to delete rule");return}await S()},I=j=>j.split("_").map(L=>L.charAt(0).toUpperCase()+L.slice(1)).join(" ");return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Notification Settings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control channels, templates, and delivery rules for platform alerts."})]}),i.jsxs(Xe,{variant:"primary",children:[r.length," rules configured"]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Channels",subtitle:"Enable or disable notification channels"}),i.jsx(Ee,{className:"space-y-3",children:o.map(j=>i.jsxs("label",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529] cursor-pointer",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold",children:j.label}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:j.description})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Xe,{variant:j.enabled?"success":"warning",children:j.enabled?"Enabled":"Disabled"}),i.jsx("input",{type:"checkbox",checked:j.enabled,onChange:()=>C(j.id),className:"h-5 w-5 rounded border-[#CED4DA]"})]})]},j.id))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Automated Rules",subtitle:"Template and channel mapping per trigger"}),i.jsx(Ee,{className:"overflow-x-auto text-sm",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Trigger"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Channel(s)"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[r.map(j=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529] font-medium",children:I(j.triggerEvent)}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:j.channels.length>0?j.channels.join(", "):"-"}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:j.status==="active"?"success":"warning",children:j.status})}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>M(j),children:j.status==="active"?"Disable":"Enable"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>G(j.id),children:"Delete"})]})})]},j.id)),r.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:4,className:"py-8 text-center text-[#6C757D]",children:u?"Loading...":"No notification rules configured"})})]})]})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Add New Rule",subtitle:"Configure a new notification trigger"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Trigger Event"}),i.jsxs("select",{className:"w-full rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",value:g,onChange:j=>E(j.target.value),children:[i.jsx("option",{value:"",children:"Select trigger..."}),C0e.map(j=>i.jsx("option",{value:j,children:I(j)},j))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Channels"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:["email","push","sms"].map(j=>i.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[i.jsx("input",{type:"checkbox",checked:y.includes(j),onChange:L=>{L.target.checked?x([...y,j]):x(y.filter(N=>N!==j))}}),j.toUpperCase()]},j))})]}),i.jsx("div",{className:"md:col-span-2",children:i.jsx(oe,{onClick:R,disabled:u||!g,children:"Create Rule"})})]})]})]})}function N0e(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState({require_2fa:!0,session_timeout:45,password_min_length:12}),[m,g]=O.useState(!1),[E,y]=O.useState(!1);O.useEffect(()=>{(async()=>{g(!0);try{const{data:M}=await ie.from("users").select("id, email, role, created_at, account_status").eq("role","admin");if(M){const{data:I}=await ie.from("profiles").select("user_id, display_name").in("user_id",M.map(N=>N.id)),j=new Map;for(const N of I??[])j.set(N.user_id,N.display_name||"Admin");const L=M.map(N=>({id:N.id,email:N.email,displayName:j.get(N.id)??N.email.split("@")[0],createdAt:N.created_at,accountStatus:N.account_status??"active"}));o(L)}const{data:G}=await ie.from("platform_settings").select("key, value").in("key",["require_2fa","session_timeout","password_min_length"]);if(G){const I={...l};for(const j of G)try{I[j.key]=JSON.parse(j.value)}catch{I[j.key]=j.value}u(I)}}finally{g(!1)}})()},[]);const x=async()=>{y(!0);try{const R=[{key:"require_2fa",value:JSON.stringify(l.require_2fa)},{key:"session_timeout",value:JSON.stringify(l.session_timeout)},{key:"password_min_length",value:JSON.stringify(l.password_min_length)}];for(const M of R)await ie.from("platform_settings").update({value:M.value,updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}).eq("key",M.key);alert("Security settings saved!")}finally{y(!1)}},S=async R=>{if(R===(r==null?void 0:r.id)){alert("You cannot suspend yourself");return}if(!window.confirm("Suspend this admin account?"))return;const{error:G}=await ie.from("users").update({account_status:"suspended"}).eq("id",R);if(G){console.error("Error suspending admin:",G),alert("Failed to suspend admin");return}o(I=>I.map(j=>j.id===R?{...j,accountStatus:"suspended"}:j))},C=async R=>{const{error:M}=await ie.from("users").update({account_status:"active"}).eq("id",R);if(M){console.error("Error reactivating admin:",M),alert("Failed to reactivate admin");return}o(G=>G.map(I=>I.id===R?{...I,accountStatus:"active"}:I))};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Security & Access"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control admin access and authentication policies."})]}),i.jsx(oe,{onClick:x,disabled:E,children:E?"Saving...":"Save Changes"})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Access Policies",subtitle:"Security requirements for admin accounts"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Session Timeout (minutes)",type:"number",value:l.session_timeout.toString(),onChange:R=>u({...l,session_timeout:parseInt(R.target.value)||0})}),i.jsx(tt,{label:"Minimum Password Length",type:"number",value:l.password_min_length.toString(),onChange:R=>u({...l,password_min_length:parseInt(R.target.value)||8})}),i.jsxs("label",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 md:col-span-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:"Require 2FA for all admins"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Mandatory via authenticator app or SMS backup."})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Xe,{variant:l.require_2fa?"success":"warning",children:l.require_2fa?"Enabled":"Disabled"}),i.jsx("input",{type:"checkbox",checked:l.require_2fa,onChange:R=>u({...l,require_2fa:R.target.checked}),className:"h-5 w-5 rounded border-[#CED4DA]"})]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Admin Users",subtitle:`${n.length} admin accounts`}),i.jsxs(Ee,{className:"space-y-4",children:[n.map(R=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold",children:R.displayName}),i.jsx("p",{className:"text-[#6C757D]",children:R.email})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Xe,{variant:R.accountStatus==="active"?"success":"danger",children:R.accountStatus}),R.id!==(r==null?void 0:r.id)&&(R.accountStatus==="active"?i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>S(R.id),children:"Suspend"}):i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>C(R.id),children:"Reactivate"})),R.id===(r==null?void 0:r.id)&&i.jsx(Xe,{variant:"primary",children:"You"})]})]},R.id)),n.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:m?"Loading...":"No admin users found"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Security Overview",subtitle:"Current security status"}),i.jsxs(Ee,{className:"grid gap-3 md:grid-cols-3",children:[i.jsxs("div",{className:`rounded-[16px] border p-4 text-sm ${l.require_2fa?"border-[#28A745]/30 bg-[#28A745]/10 text-[#28A745]":"border-[#DC3545]/30 bg-[#DC3545]/10 text-[#DC3545]"}`,children:[i.jsx("p",{className:"font-semibold",children:"2FA Status"}),i.jsx("p",{className:"text-xs",children:l.require_2fa?"Required for all admins":"Not required - Enable for better security"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"font-semibold",children:"Session Timeout"}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[l.session_timeout," minutes"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"font-semibold",children:"Active Admins"}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[n.filter(R=>R.accountStatus==="active").length," of ",n.length]})]})]})]})]})}function R0e(){const[r,n]=O.useState([]),[o,l]=O.useState(!1),[u,m]=O.useState(""),[g,E]=O.useState(null),y=async()=>{l(!0);try{let I=ie.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(100);g&&(I=I.eq("status",g));const{data:j,error:L}=await I;if(L){console.error("Error fetching logs:",L);return}const N=(j??[]).map(D=>({id:D.id,actorType:D.actor_type,actorName:D.actor_name,action:D.action,actionType:D.action_type,status:D.status,resourceType:D.resource_type,details:D.details,createdAt:D.created_at}));n(N)}finally{l(!1)}};O.useEffect(()=>{y()},[g]);const x=r.filter(I=>{var L;if(!u)return!0;const j=u.toLowerCase();return I.action.toLowerCase().includes(j)||I.actionType.toLowerCase().includes(j)||(((L=I.actorName)==null?void 0:L.toLowerCase().includes(j))??!1)}),S={success:"success",warning:"warning",error:"danger"},C=()=>{const I=`ID,Time,Actor,Action,Type,Status
`+x.map(D=>`${D.id},"${Gt(D.createdAt)}","${D.actorName||D.actorType}","${D.action}",${D.actionType},${D.status}`).join(`
`),j=new Blob([I],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(j),N=document.createElement("a");N.setAttribute("href",L),N.setAttribute("download",`system_logs_${new Date().toISOString().split("T")[0]}.csv`),N.style.visibility="hidden",document.body.appendChild(N),N.click(),document.body.removeChild(N)},R=r.filter(I=>I.status==="error").length,M=r.filter(I=>I.status==="warning").length,G=r.filter(I=>I.status==="success").length;return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"System Logs"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Monitor platform activity and system health."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:C,children:"Download Logs"}),i.jsx(oe,{onClick:y,disabled:o,children:o?"Loading...":"Refresh"})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#212529]",children:r.length}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Total Logs"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#28A745]",children:G}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Success"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#FFC107]/30 bg-[#FFC107]/10 p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#FFC107]",children:M}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Warnings"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#DC3545]/30 bg-[#DC3545]/10 p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#DC3545]",children:R}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Errors"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Filters",subtitle:"Search and filter logs"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Search",placeholder:"Action, type, actor...",value:u,onChange:I=>m(I.target.value)}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{size:"sm",variant:g===null?"secondary":"ghost",onClick:()=>E(null),children:"All"}),i.jsx(oe,{size:"sm",variant:g==="success"?"secondary":"ghost",onClick:()=>E("success"),children:"Success"}),i.jsx(oe,{size:"sm",variant:g==="warning"?"secondary":"ghost",onClick:()=>E("warning"),children:"Warning"}),i.jsx(oe,{size:"sm",variant:g==="error"?"secondary":"ghost",onClick:()=>E("error"),children:"Error"})]})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Log Stream",subtitle:`${x.length} entries  Newest first`}),i.jsxs(Ee,{className:"space-y-4",children:[x.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:o?"Loading logs...":"No logs found"}),x.map(I=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[i.jsx("div",{className:"font-semibold",children:I.action}),i.jsx(Xe,{variant:S[I.status]??"primary",children:I.status})]}),i.jsxs("p",{className:"mt-2 text-[#6C757D]",children:[Gt(I.createdAt),"  ",I.actorType,I.actorName&&`  ${I.actorName}`]}),I.details&&Object.keys(I.details).length>0&&i.jsxs("details",{className:"mt-2",children:[i.jsx("summary",{className:"cursor-pointer text-xs text-[#6C757D]",children:"View Details"}),i.jsx("pre",{className:"mt-2 overflow-x-auto rounded bg-white p-2 text-xs",children:JSON.stringify(I.details,null,2)})]}),i.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:[i.jsx(Xe,{variant:"primary",children:I.actionType}),I.resourceType&&i.jsx(Xe,{variant:"warning",children:I.resourceType})]})]},I.id))]})]})]})}const A0e=["suspend_users","ban_users","approve_withdrawals","send_notifications","update_status","delete_records","export_data","other"];function I0e(){const{user:r}=vs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState("other"),[C,R]=O.useState(""),M=async()=>{u(!0);try{const{data:D,error:V}=await ie.from("bulk_actions").select("*").order("created_at",{ascending:!1});if(V){console.error("Error fetching bulk actions:",V);return}const B=new Set;for(const ee of D??[])ee.created_by&&B.add(ee.created_by);const{data:z}=B.size?await ie.from("profiles").select("user_id, display_name").in("user_id",Array.from(B)):{data:[]},H=new Map;for(const ee of z??[])H.set(ee.user_id,ee.display_name||"Admin");const J=(D??[]).map(ee=>({id:ee.id,title:ee.title,description:ee.description,actionType:ee.action_type,targetCriteria:ee.target_criteria,affectedCount:ee.affected_count??0,status:ee.status,notes:ee.notes,createdBy:ee.created_by,createdByName:H.get(ee.created_by)??"System",createdAt:ee.created_at}));o(J)}finally{u(!1)}};O.useEffect(()=>{M()},[]);const G=async D=>{if(!m.trim()){alert("Title is required");return}u(!0);try{let V=null;if(C.trim())try{V=JSON.parse(C)}catch{V={description:C}}const{error:B}=await ie.from("bulk_actions").insert({title:m.trim(),description:E.trim()||null,action_type:x,target_criteria:V,status:D,created_by:r==null?void 0:r.id});if(B){console.error("Error creating bulk action:",B),alert("Failed to create bulk action");return}await M(),g(""),y(""),R(""),alert(`Bulk action ${D==="pending"?"saved as draft":"submitted for approval"}!`)}finally{u(!1)}},I=async(D,V)=>{if(!window.confirm(`Update action status to "${V}"?`))return;const z={status:V,updated_at:new Date().toISOString()};V==="approved"&&(z.approved_by=r==null?void 0:r.id),V==="completed"&&(z.executed_at=new Date().toISOString());const{error:H}=await ie.from("bulk_actions").update(z).eq("id",D);if(H){console.error("Error updating bulk action:",H),alert("Failed to update action");return}await M()},j=async D=>{if(!window.confirm("Delete this bulk action?"))return;const{error:B}=await ie.from("bulk_actions").delete().eq("id",D);if(B){console.error("Error deleting bulk action:",B),alert("Failed to delete action");return}await M()},L={pending:"warning",approved:"primary",completed:"success",rejected:"danger",failed:"danger"},N=D=>D.split("_").map(V=>V.charAt(0).toUpperCase()+V.slice(1)).join(" ");return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Bulk Actions"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Execute large-scale updates safely with approval trails."})]}),i.jsxs(Xe,{variant:"primary",children:[n.filter(D=>D.status==="pending").length," pending"]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Active Actions",subtitle:`${n.length} bulk actions`}),i.jsxs(Ee,{className:"space-y-4",children:[n.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No bulk actions created yet"}),n.map(D=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold",children:D.title}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[D.createdByName,"  ",Gt(D.createdAt)]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Xe,{variant:"primary",children:N(D.actionType)}),i.jsx(Xe,{variant:L[D.status]??"primary",children:D.status})]})]}),D.description&&i.jsx("p",{className:"mt-3 text-[#6C757D]",children:D.description}),D.notes&&i.jsxs("p",{className:"mt-2 text-xs text-[#ADB5BD]",children:["Notes: ",D.notes]}),i.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[D.status==="pending"&&i.jsxs(i.Fragment,{children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>I(D.id,"approved"),children:"Approve"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>I(D.id,"rejected"),children:"Reject"})]}),D.status==="approved"&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>I(D.id,"completed"),children:"Mark Completed"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>j(D.id),children:"Delete"})]})]},D.id))]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"New Bulk Action",subtitle:"Design and schedule batch operations"}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Action Title",placeholder:"e.g. Suspend flagged accounts",value:m,onChange:D=>g(D.target.value)}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Action Type"}),i.jsx("select",{className:"w-full rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",value:x,onChange:D=>S(D.target.value),children:A0e.map(D=>i.jsx("option",{value:D,children:N(D)},D))})]}),i.jsx(nr,{label:"Description",rows:3,placeholder:"Describe what this action will do...",value:E,onChange:D=>y(D.target.value)}),i.jsx(nr,{label:"Target Criteria (JSON or text)",rows:3,placeholder:'{"user_status": "flagged"} or plain text description',value:C,onChange:D=>R(D.target.value)}),i.jsxs("div",{className:"md:col-span-2 flex flex-wrap gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>G("pending"),disabled:l,children:"Save Draft"}),i.jsx(oe,{onClick:()=>G("approved"),disabled:l,children:"Submit for Approval"})]})]})]})]})}function D0e(){const[r,n]=O.useState([]),[o,l]=O.useState({totalTables:0,totalRows:0,projectId:"iktldcrkyphkvxjwmxyb",region:"ap-south-1"}),[u,m]=O.useState(!1),[g,E]=O.useState(null),y=async()=>{m(!0);try{const C=["users","events","bids","meets","profiles","notifications","support_tickets","withdrawal_requests","wallet_transactions","reports","disputes","audit_logs","bulk_actions"],R=[];let M=0;for(const G of C){const{count:I,error:j}=await ie.from(G).select("*",{count:"exact",head:!0});if(!j){const L=I??0;M+=L,R.push({name:G,rowCount:L,size:`~${Math.max(1,Math.round(L*.5))} KB`})}}R.sort((G,I)=>I.rowCount-G.rowCount),n(R),l({totalTables:R.length,totalRows:M,projectId:"iktldcrkyphkvxjwmxyb",region:"ap-south-1"}),E(new Date)}finally{m(!1)}};O.useEffect(()=>{y()},[]);const x=async C=>{m(!0);try{const{data:R,error:M}=await ie.from(C).select("*").limit(1e3);if(M){alert(`Failed to export ${C}: ${M.message}`);return}const G=JSON.stringify(R,null,2),I=new Blob([G],{type:"application/json"}),j=URL.createObjectURL(I),L=document.createElement("a");L.setAttribute("href",j),L.setAttribute("download",`${C}_export_${new Date().toISOString().split("T")[0]}.json`),L.style.visibility="hidden",document.body.appendChild(L),L.click(),document.body.removeChild(L)}finally{m(!1)}},S=async()=>{if(window.confirm("Export all tables? This may take a moment.")){m(!0);try{const R={};for(const L of r){const{data:N}=await ie.from(L.name).select("*").limit(1e3);N&&(R[L.name]=N)}const M=JSON.stringify(R,null,2),G=new Blob([M],{type:"application/json"}),I=URL.createObjectURL(G),j=document.createElement("a");j.setAttribute("href",I),j.setAttribute("download",`full_database_export_${new Date().toISOString().split("T")[0]}.json`),j.style.visibility="hidden",document.body.appendChild(j),j.click(),document.body.removeChild(j),alert("Full database export completed!")}finally{m(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Database Backup"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["View database statistics and export data.",g&&` Last refreshed: ${Gt(g.toISOString())}`]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:S,disabled:u,children:"Export All Tables"}),i.jsx(oe,{onClick:y,disabled:u,children:u?"Loading...":"Refresh Stats"})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#212529]",children:o.totalTables}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Tables"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#C045FF]",children:o.totalRows.toLocaleString()}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Total Rows"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsxs("p",{className:"text-lg font-bold text-[#212529]",children:[o.projectId.slice(0,8),"..."]}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Project ID"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsx("p",{className:"text-lg font-bold text-[#212529]",children:o.region}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Region"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Supabase Managed Backups",subtitle:"Automatic daily backups handled by Supabase"}),i.jsxs(Ee,{className:"grid gap-3 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-sm",children:[i.jsx("p",{className:"font-semibold text-[#28A745]",children:"Daily Backups"}),i.jsx("p",{className:"mt-2 text-[#6C757D]",children:"Automatic daily point-in-time recovery enabled"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"font-semibold",children:"Retention"}),i.jsx("p",{className:"mt-2 text-[#6C757D]",children:"7 days (Free tier) / 30 days (Pro)"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"font-semibold",children:"PITR"}),i.jsx("p",{className:"mt-2 text-[#6C757D]",children:"Point-in-time recovery available"})]})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Table Statistics",subtitle:`${r.length} tables  Export individual tables`}),i.jsx(Ee,{className:"overflow-x-auto text-sm",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Table"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rows"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Est. Size"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[r.map(C=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529] font-medium",children:C.name}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:C.rowCount.toLocaleString()}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:C.size}),i.jsx("td",{className:"py-3",children:i.jsx(Xe,{variant:"success",children:"Active"})}),i.jsx("td",{className:"py-3",children:i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>x(C.name),disabled:u,children:"Export JSON"})})]},C.name)),r.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:u?"Loading table statistics...":"No tables found"})})]})]})})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Backup Notes",subtitle:"Important information about data protection"}),i.jsxs(Ee,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsxs("p",{children:[i.jsx("strong",{className:"text-[#212529]",children:"Automatic Backups:"})," Supabase automatically handles daily backups and point-in-time recovery. No manual intervention is needed for standard backup operations."]}),i.jsxs("p",{children:[i.jsx("strong",{className:"text-[#212529]",children:"Manual Exports:"})," Use the export buttons above to download JSON snapshots of individual tables or the entire database for local backups or data analysis."]}),i.jsxs("p",{children:[i.jsx("strong",{className:"text-[#212529]",children:"Restore:"})," To restore from a backup, contact Supabase support or use the Supabase Dashboard to access point-in-time recovery options."]})]})]})]})}const Md={name:"Megha Sharma",title:"Head of Operations",email:"megha@fanmeet.com",phone:"+91 98765 43210",role:"Super Admin",lastLogin:"Jan 12, 2025  10:15 AM IST",timezone:"Asia/Kolkata"},O0e=[{team:"Support Desk",scope:"Tickets, Reports",status:"Active",expires:"Feb 01, 2025"},{team:"Finance Ops",scope:"Withdrawals, Refunds",status:"Active",expires:"Mar 15, 2025"}],j0e=["Jan 12  Approved withdrawal batch WR-BATCH-24","Jan 12  Updated pricing tier 100 Base","Jan 11  Resolved dispute DSP-311","Jan 10  Published announcement ANN-210"];function P0e(){return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"My Profile"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage your contact info, access, and delegated permissions."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",children:"Download Activity Log"}),i.jsx(oe,{children:"Update Security"})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Personal Information",subtitle:"Visible to other admins."}),i.jsxs(Ee,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(tt,{label:"Full Name",defaultValue:Md.name}),i.jsx(tt,{label:"Title",defaultValue:Md.title}),i.jsx(tt,{label:"Email",defaultValue:Md.email}),i.jsx(tt,{label:"Phone",defaultValue:Md.phone}),i.jsx(tt,{label:"Timezone",defaultValue:Md.timezone}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Role"}),i.jsx(Xe,{variant:"primary",className:"mt-3 w-fit",children:Md.role}),i.jsxs("p",{className:"mt-3 text-xs text-[#6C757D]",children:["Last login: ",Md.lastLogin]})]}),i.jsx("div",{className:"md:col-span-2",children:i.jsx(nr,{label:"Out of Office Message",rows:3,placeholder:"Optional note for delegating responsibilities."})})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Delegated Access",subtitle:"Teams that can act on your behalf."}),i.jsx(Ee,{className:"grid gap-4 md:grid-cols-2",children:O0e.map(r=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-lg font-semibold",children:r.team}),i.jsxs("p",{className:"mt-2 text-[#6C757D]",children:["Scope: ",r.scope]}),i.jsxs("p",{className:"text-xs text-[#ADB5BD]",children:["Expires: ",r.expires]}),i.jsx(Xe,{variant:"success",className:"mt-3 w-fit",children:r.status}),i.jsxs("div",{className:"mt-4 flex gap-2",children:[i.jsx(oe,{size:"sm",variant:"secondary",children:"Modify"}),i.jsx(oe,{size:"sm",variant:"ghost",children:"Revoke"})]})]},r.team))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Recent Activity",subtitle:"Latest actions performed under this account."}),i.jsx(Ee,{children:i.jsx("ul",{className:"space-y-2 text-sm text-[#212529]",children:j0e.map(r=>i.jsxs("li",{className:"flex items-center gap-2 rounded-[12px] bg-[#F8F9FA] px-4 py-3",children:[i.jsx("span",{className:"text-[#C045FF]",children:""}),i.jsx("span",{children:r})]},r))})})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(oe,{variant:"secondary",children:"Save Changes"}),i.jsx(oe,{variant:"ghost",children:"Cancel"}),i.jsx(oe,{variant:"danger",children:"Deactivate Account"})]})]})}function k0e(){const[r,n]=O.useState([]),[o,l]=O.useState(new Map),[u,m]=O.useState(!0),g=async()=>{m(!0);const{data:x,error:S}=await ie.from("meets").select("*").order("created_at",{ascending:!1});if(S)console.error("Error fetching meets:",S);else{n(x||[]);const C=[...new Set((x==null?void 0:x.map(G=>G.creator_id))||[])],R=[...new Set((x==null?void 0:x.map(G=>G.fan_id))||[])],M=[...new Set([...C,...R])];if(M.length>0){const{data:G}=await ie.from("profiles").select("*").in("user_id",M),I=new Map((G==null?void 0:G.map(j=>[j.user_id,j]))||[]);l(I)}}m(!1)};O.useEffect(()=>{g()},[]);const E=async x=>{const{error:S}=await ie.from("meets").update({meeting_link:"https://meet.google.com/abc-defg-hij"}).eq("id",x);S?(console.error("Error updating meeting link:",S),alert("Failed to update meeting link")):(alert("Meeting link updated successfully!"),g())},y=async(x,S)=>{const{error:C}=await ie.from("meets").update({status:S}).eq("id",x);C?(console.error("Error updating status:",C),alert("Failed to update status")):(alert("Status updated successfully!"),g())};return u?i.jsx("div",{className:"p-8 text-center",children:"Loading..."}):i.jsxs("div",{className:"flex flex-col gap-8 p-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Admin: Meets Debug"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"View and manage all meetings in the database"})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:`All Meets (${r.length})`}),i.jsx(Ee,{className:"gap-4",children:r.length===0?i.jsx("p",{className:"text-sm text-[#6C757D]",children:"No meets found in database"}):i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-sm",children:[i.jsx("thead",{className:"border-b border-[#E9ECEF]",children:i.jsxs("tr",{className:"text-left",children:[i.jsx("th",{className:"pb-2",children:"ID"}),i.jsx("th",{className:"pb-2",children:"Creator"}),i.jsx("th",{className:"pb-2",children:"Fan"}),i.jsx("th",{className:"pb-2",children:"Scheduled"}),i.jsx("th",{className:"pb-2",children:"Duration"}),i.jsx("th",{className:"pb-2",children:"Status"}),i.jsx("th",{className:"pb-2",children:"Meeting Link"}),i.jsx("th",{className:"pb-2",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(x=>{const S=o.get(x.creator_id),C=o.get(x.fan_id);return i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsxs("td",{className:"py-3 text-xs",children:[x.id.substring(0,8),"..."]}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"text-xs",children:[i.jsx("div",{children:(S==null?void 0:S.display_name)||"Unknown"}),i.jsxs("div",{className:"text-[#6C757D]",children:["@",(S==null?void 0:S.username)||"unknown"]})]})}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"text-xs",children:[i.jsx("div",{children:(C==null?void 0:C.display_name)||"Unknown"}),i.jsxs("div",{className:"text-[#6C757D]",children:["@",(C==null?void 0:C.username)||"unknown"]})]})}),i.jsx("td",{className:"py-3 text-xs",children:Gt(x.scheduled_at)}),i.jsxs("td",{className:"py-3 text-xs",children:[x.duration_minutes," min"]}),i.jsx("td",{className:"py-3",children:i.jsxs("select",{value:x.status,onChange:R=>y(x.id,R.target.value),className:"text-xs rounded border border-[#E9ECEF] px-2 py-1",children:[i.jsx("option",{value:"scheduled",children:"scheduled"}),i.jsx("option",{value:"completed",children:"completed"}),i.jsx("option",{value:"cancelled",children:"cancelled"}),i.jsx("option",{value:"no_show",children:"no_show"})]})}),i.jsx("td",{className:"py-3",children:i.jsx("div",{className:"text-xs break-all max-w-xs",children:x.meeting_link||i.jsx("span",{className:"text-red-500",children:"No link"})})}),i.jsx("td",{className:"py-3",children:!x.meeting_link&&i.jsx(oe,{size:"sm",onClick:()=>E(x.id),children:"Add Link"})})]},x.id)})})]})})})]}),i.jsx(oe,{onClick:g,children:"Refresh Data"})]})}const NN={CREATOR_STREAM_STARTED:"bg-emerald-100 text-emerald-800",CREATOR_JOINED:"bg-blue-100 text-blue-800",FAN_JOINED:"bg-violet-100 text-violet-800",FAN_WAITING_ROOM:"bg-amber-100 text-amber-800",RECORDING_STARTED:"bg-rose-100 text-rose-800",RECORDING_STOPPED:"bg-slate-100 text-slate-800",MEETING_CANCELLED_NO_SHOW_CREATOR:"bg-red-100 text-red-800",REFUND_ISSUED:"bg-orange-100 text-orange-800",MEETING_COMPLETED:"bg-green-100 text-green-800",FAN_JOIN_STATUS_AT_S:"bg-indigo-100 text-indigo-800"},D7={scheduled:{color:"text-blue-600",bg:"bg-blue-500",icon:""},live:{color:"text-green-600",bg:"bg-green-500",icon:""},completed:{color:"text-gray-600",bg:"bg-gray-500",icon:""},cancelled:{color:"text-red-600",bg:"bg-red-500",icon:""},cancelled_no_show_creator:{color:"text-red-600",bg:"bg-red-600",icon:""}};function L0e(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState([]),[g,E]=O.useState(!0),[y,x]=O.useState(null),[S,C]=O.useState("all"),[R,M]=O.useState("overview"),[G,I]=O.useState({total:0,scheduled:0,live:0,completed:0,cancelled:0,totalRefunds:0,totalRefundAmount:0});O.useEffect(()=>{j()},[]);const j=async()=>{E(!0),await Promise.all([L(),N(),D()]),E(!1)},L=async()=>{const{data:H,error:J}=await ie.from("meets").select("*").order("scheduled_at",{ascending:!1}).limit(100);if(J){console.error("Error fetching meets:",J);return}const ee=[...new Set((H||[]).map(be=>be.creator_id))],ne=[...new Set((H||[]).map(be=>be.fan_id))],he=[...new Set((H||[]).map(be=>be.event_id))],[ve,ye]=await Promise.all([ie.from("profiles").select("user_id, username, display_name").in("user_id",[...ee,...ne]),ie.from("events").select("id, title").in("id",he)]),me=new Map((ve.data||[]).map(be=>[be.user_id,be])),ue=new Map((ye.data||[]).map(be=>[be.id,be])),Fe=[];for(const be of H||[]){const{data:ae}=await ie.from("meeting_event_logs").select("*").eq("meet_id",be.id).order("timestamp",{ascending:!0});Fe.push({...be,logs:ae||[],creator_profile:me.get(be.creator_id),fan_profile:me.get(be.fan_id),event:ue.get(be.event_id)})}n(Fe),I(be=>({...be,total:Fe.length,scheduled:Fe.filter(ae=>ae.status==="scheduled").length,live:Fe.filter(ae=>ae.status==="live").length,completed:Fe.filter(ae=>ae.status==="completed").length,cancelled:Fe.filter(ae=>ae.status==="cancelled_no_show_creator"||ae.status==="cancelled").length}))},N=async()=>{const{data:H,error:J}=await ie.from("bids").select("*").eq("refund_status","refunded").order("refunded_at",{ascending:!1}).limit(50);if(J){console.error("Error fetching refunds:",J);return}const ee=[...new Set((H||[]).map(be=>be.fan_id))],ne=[...new Set((H||[]).map(be=>be.event_id))],[he,ve]=await Promise.all([ie.from("profiles").select("user_id, username, display_name").in("user_id",ee),ie.from("events").select("id, title").in("id",ne)]),ye=new Map((he.data||[]).map(be=>[be.user_id,be])),me=new Map((ve.data||[]).map(be=>[be.id,be])),ue=(H||[]).map(be=>({...be,fan_profile:ye.get(be.fan_id),event:me.get(be.event_id)})),Fe=ue.reduce((be,ae)=>be+(ae.refund_amount||ae.amount),0);l(ue),I(be=>({...be,totalRefunds:ue.length,totalRefundAmount:Fe}))},D=async()=>{const{data:H,error:J}=await ie.from("meeting_event_logs").select("*").order("timestamp",{ascending:!1}).limit(200);J||m(H||[])},V=H=>new Date(H).toLocaleString(),B=H=>new Date(H).toLocaleDateString(),z=S==="all"?r:r.filter(H=>H.status===S);return g?i.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-[#C045FF] border-t-transparent rounded-full mx-auto mb-4"}),i.jsx("p",{className:"text-gray-500",children:"Loading dashboard..."})]})}):i.jsxs("div",{className:"flex flex-col gap-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-[#212529]",children:"Meeting Lifecycle"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Automated meeting management with auto-refunds"})]}),i.jsx(oe,{onClick:j,variant:"secondary",size:"sm",children:" Refresh"})]}),i.jsx("div",{className:"flex gap-1 p-1 bg-gray-100 rounded-lg w-fit",children:["overview","meetings","refunds","logs"].map(H=>i.jsxs("button",{onClick:()=>M(H),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${R===H?"bg-white text-[#C045FF] shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[H==="overview"&&"Overview",H==="meetings"&&`Meetings (${G.total})`,H==="refunds"&&`Refunds (${G.totalRefunds})`,H==="logs"&&`Logs (${u.length})`]},H))}),R==="overview"&&i.jsxs("div",{className:"grid gap-6",children:[i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[i.jsx(fe,{className:"p-5 hover:shadow-md transition-shadow",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:G.total}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total"})]})]})}),i.jsx(fe,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-blue-500",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-blue-600",children:G.scheduled}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Scheduled"})]})]})}),i.jsx(fe,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-green-500",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-50 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-green-600",children:G.live}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Live"})]})]})}),i.jsx(fe,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-gray-400",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-gray-600",children:G.completed}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Completed"})]})]})}),i.jsx(fe,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-red-500",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-50 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-red-600",children:G.cancelled}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Cancelled"})]})]})})]}),i.jsx(fe,{className:"p-6 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"w-14 h-14 rounded-2xl bg-green-500 flex items-center justify-center text-white text-2xl flex-shrink-0",children:""}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-bold text-green-800 text-lg mb-2",children:"Automatic Payment System Active"}),i.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-600 mt-0.5",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-800",children:"Creator No-Show"}),i.jsx("p",{className:"text-green-600",children:"100% auto-refund to fan's wallet"})]})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-600 mt-0.5",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-800",children:"Meeting Completed"}),i.jsx("p",{className:"text-green-600",children:"90% auto-credited to creator (10% platform fee)"})]})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-600 mt-0.5",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-800",children:"Fan No-Show"}),i.jsx("p",{className:"text-green-600",children:"No refund - creator still gets paid on completion"})]})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-600 mt-0.5",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-800",children:"Cron Running"}),i.jsx("p",{className:"text-green-600",children:"Checks every minute for no-shows & completions"})]})]})]})]})]})}),G.totalRefunds>0&&i.jsx(fe,{className:"p-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-orange-100 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsxs("p",{className:"font-semibold text-gray-800",children:[G.totalRefunds," Auto-Refunds Processed"]}),i.jsxs("p",{className:"text-sm text-gray-500",children:["Total: ",We(G.totalRefundAmount)]})]})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>M("refunds"),children:"View All "})]})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Recent Activity"}),i.jsx("div",{className:"space-y-2",children:u.slice(0,5).map(H=>i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg border hover:bg-gray-50 transition-colors",children:[i.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${NN[H.event_type]||"bg-gray-100"}`,children:H.event_type.replace(/_/g," ")}),i.jsxs("span",{className:"text-sm text-gray-600 flex-1",children:[H.meet_id.slice(0,8),"..."]}),i.jsx("span",{className:"text-xs text-gray-400",children:V(H.timestamp)})]},H.id))})]})]}),R==="meetings"&&i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"flex flex-wrap gap-2",children:["all","scheduled","live","completed","cancelled_no_show_creator"].map(H=>i.jsx("button",{onClick:()=>C(H),className:`px-4 py-2 text-sm rounded-lg transition-all ${S===H?"bg-[#C045FF] text-white shadow-sm":"bg-white text-gray-600 border hover:border-[#C045FF] hover:text-[#C045FF]"}`,children:H==="all"?"All":H==="cancelled_no_show_creator"?"No-Show":H.charAt(0).toUpperCase()+H.slice(1)},H))}),i.jsxs("div",{className:"space-y-3",children:[z.map(H=>{var J,ee,ne,he,ve;return i.jsxs(fe,{className:"overflow-hidden hover:shadow-md transition-shadow",children:[i.jsx("div",{className:"p-4 cursor-pointer",onClick:()=>x(y===H.id?null:H.id),children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-10 h-10 rounded-full ${((J=D7[H.status])==null?void 0:J.bg)||"bg-gray-400"} flex items-center justify-center text-white text-lg`,children:((ee=D7[H.status])==null?void 0:ee.icon)||"?"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-900",children:((ne=H.event)==null?void 0:ne.title)||"Untitled"}),i.jsxs("p",{className:"text-sm text-gray-500",children:[((he=H.creator_profile)==null?void 0:he.display_name)||"Creator","  ",((ve=H.fan_profile)==null?void 0:ve.display_name)||"Fan"]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx(Xe,{variant:H.status==="live"?"success":H.status==="completed"?"primary":H.status.includes("cancelled")?"danger":"default",children:H.status.replace(/_/g," ")}),i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:B(H.scheduled_at)})]})]})}),y===H.id&&i.jsxs(Ee,{className:"bg-gray-50 border-t",children:[i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[i.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Creator Started"}),i.jsx("p",{className:"font-medium text-sm mt-1",children:H.creator_started_at?V(H.creator_started_at):i.jsx("span",{className:"text-red-500",children:"Not started"})})]}),i.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fan Joined"}),i.jsx("p",{className:"font-medium text-sm mt-1",children:H.fan_joined_at?V(H.fan_joined_at):i.jsx("span",{className:"text-red-500",children:"Not joined"})})]}),i.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Recording"}),i.jsx("p",{className:"font-medium text-sm mt-1",children:H.recording_started_at?i.jsx("span",{className:"text-green-600",children:" Recorded"}):i.jsx("span",{className:"text-gray-400",children:"None"})})]}),i.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Duration"}),i.jsxs("p",{className:"font-medium text-sm mt-1",children:[H.duration_minutes," min"]})]})]}),H.cancellation_reason&&i.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[i.jsxs("p",{className:"text-sm font-medium text-red-800",children:["Cancellation: ",H.cancellation_reason]}),H.refund_id&&i.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Refund ID: ",H.refund_id]})]}),i.jsxs("div",{children:[i.jsxs("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:["Event Timeline (",H.logs.length,")"]}),H.logs.length===0?i.jsx("p",{className:"text-sm text-gray-400",children:"No events yet"}):i.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:H.logs.map(ye=>i.jsxs("div",{className:"flex items-start gap-3 p-2 bg-white rounded border text-sm",children:[i.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${NN[ye.event_type]||"bg-gray-100"}`,children:ye.event_type.replace(/_/g," ")}),i.jsx("span",{className:"text-xs text-gray-400",children:V(ye.timestamp)})]},ye.id))})]})]})]},H.id)}),z.length===0&&i.jsxs(fe,{className:"p-12 text-center",children:[i.jsx("p",{className:"text-4xl mb-2",children:""}),i.jsx("p",{className:"text-gray-500",children:"No meetings found"})]})]})]}),R==="refunds"&&i.jsxs("div",{className:"space-y-4",children:[i.jsx(fe,{className:"p-5 bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-500 flex items-center justify-center text-white text-xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-bold text-green-800",children:"Auto-Refund Active"}),i.jsx("p",{className:"text-sm text-green-600",children:"Creator no-shows trigger 100% instant wallet refund to fans"})]})]})}),G.totalRefunds>0&&i.jsxs("div",{className:"flex gap-4",children:[i.jsxs(fe,{className:"flex-1 p-4",children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Total Refunds"}),i.jsx("p",{className:"text-2xl font-bold text-gray-800",children:G.totalRefunds})]}),i.jsxs(fe,{className:"flex-1 p-4",children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Total Amount"}),i.jsx("p",{className:"text-2xl font-bold text-green-600",children:We(G.totalRefundAmount)})]})]}),o.length===0?i.jsxs(fe,{className:"p-12 text-center",children:[i.jsx("p",{className:"text-4xl mb-2",children:""}),i.jsx("p",{className:"text-gray-500",children:"No refunds processed yet"}),i.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Refunds appear here when creators miss meetings"})]}):i.jsx("div",{className:"space-y-3",children:o.map(H=>{var J,ee,ne;return i.jsx(fe,{className:"p-4 hover:shadow-md transition-shadow",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 text-lg",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-900",children:((J=H.event)==null?void 0:J.title)||"Unknown Event"}),i.jsxs("p",{className:"text-sm text-gray-500",children:["To: ",((ee=H.fan_profile)==null?void 0:ee.display_name)||((ne=H.fan_profile)==null?void 0:ne.username)||"Fan"]}),i.jsx("p",{className:"text-xs text-gray-400",children:V(H.refunded_at)})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-xl font-bold text-green-600",children:We(H.refund_amount||H.amount)}),i.jsx(Xe,{variant:"success",children:"Auto-Refunded"})]})]})},H.id)})})]}),R==="logs"&&i.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:u.length===0?i.jsxs(fe,{className:"p-12 text-center",children:[i.jsx("p",{className:"text-4xl mb-2",children:""}),i.jsx("p",{className:"text-gray-500",children:"No logs yet"})]}):u.map(H=>i.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border hover:shadow-sm transition-shadow",children:[i.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${NN[H.event_type]||"bg-gray-100"}`,children:H.event_type.replace(/_/g," ")}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[i.jsxs("span",{className:"text-gray-600",children:["Meet: ",i.jsx("code",{className:"bg-gray-100 px-1 rounded",children:H.meet_id.slice(0,8)})]}),i.jsx("span",{className:"text-gray-400",children:V(H.timestamp)})]}),Object.keys(H.metadata||{}).length>0&&i.jsxs("details",{className:"mt-2",children:[i.jsx("summary",{className:"text-xs text-gray-400 cursor-pointer hover:text-gray-600",children:"View metadata"}),i.jsx("pre",{className:"text-xs text-gray-600 mt-1 p-2 bg-gray-50 rounded overflow-x-auto",children:JSON.stringify(H.metadata,null,2)})]})]})]},H.id))})]})}function M0e(){var ye;const{username:r}=iI(),n=Ns(),{getEventsForCreator:o}=Xo(),{getProfile:l,followCreator:u,unfollowCreator:m,following:g}=YI(),{isAuthenticated:E,user:y}=vs(),[x,S]=O.useState(!1),[C,R]=O.useState(0),[M,G]=O.useState(0),I=(r??"").replace(/^@/,"").toLowerCase(),j=I?l(I):void 0;O.useEffect(()=>{I&&S(g.includes(I))},[I,g]),O.useEffect(()=>{(async()=>{if(I)try{const{data:ue}=await ie.from("profiles").select("user_id").eq("username",I).single();if(!ue)return;const{count:Fe}=await ie.from("creator_follows").select("*",{count:"exact",head:!0}).eq("creator_id",ue.user_id);R(Fe||0);const{count:be}=await ie.from("meets").select("*",{count:"exact",head:!0}).eq("creator_id",ue.user_id).eq("status","completed");G(be||0)}catch(ue){console.error("Error fetching stats:",ue)}})()},[I]);const L=I?o(I):[],N=!L.length&&I?Array.from({length:5}).map((me,ue)=>{const Fe=I.split(/[-_]/).filter(Boolean).map(Se=>Se.charAt(0).toUpperCase()+Se.slice(1)).join(" ")||"Creator",be=100+ue*25,ae=ue%2===0?be+120:0,ge=ue%2===0?5+ue*2:0;return{id:`synthetic-${I}-${ue}`,creatorUsername:I,creatorDisplayName:Fe,title:ue===0?"Meet & Greet  1:1 Fan Session":ue===1?"Premium AMA  Ask Me Anything":ue===2?"Deep Dive  Strategy Session":ue===3?"Behind the Scenes Chat":"Quick Catch-up Call",description:"A quick 1:1 session to say hi, ask a couple of questions, and take a virtual selfie together.",status:ue===0?"LIVE":"Upcoming",date:ue===0?"Today  8:00 PM IST":"This week  8:00 PM IST",duration:ue%2===0?"10 minutes":"5 minutes",basePrice:be,currentBid:ae,participants:ge,endsIn:ue===0?"00:35:12 left":"Starts soon"}}):void 0,V=[...L.length>0?L:N??[]].reverse(),B=V[0],z=(j==null?void 0:j.displayName)||(B==null?void 0:B.creatorDisplayName)||"Creator",H=`@${I||"creator"}`,J=(j==null?void 0:j.bio)||(B==null?void 0:B.description)||"Host of intimate FanMeet sessions. Expect honest stories, practical advice, and space for your questions.",ee=me=>{const ue=`${window.location.origin}/events/${me}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(ue).then(()=>{window.alert("Event link copied. Share it with your fans to start receiving bids.")},()=>{window.prompt("Share this event link with your fans:",ue)}):window.prompt("Share this event link with your fans:",ue)},ne=!!B,he=()=>{if(!I)return;const me=`${window.location.origin}/${I}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(me).then(()=>{window.alert("Profile link copied. Share it with your fans.")},()=>{window.prompt("Share this profile link with your fans:",me)}):window.prompt("Share this profile link with your fans:",me)},ve=async()=>{if(!E){window.confirm(`Please log in to follow creators.

Click OK to go to login page.`)&&n(`/auth?redirect=/${I}`);return}if((y==null?void 0:y.role)!=="fan"){window.alert(`Only fans can follow creators.

Please log in with a fan account.`);return}try{x?(await m(I),S(!1),window.alert(`Unfollowed ${(j==null?void 0:j.displayName)||I} successfully!`)):(await u(I),S(!0),window.alert(`Now following ${(j==null?void 0:j.displayName)||I}! 

You'll see their events in your feed.`))}catch(me){console.error("Error toggling follow:",me),window.alert("Something went wrong. Please try again.")}};return i.jsxs("div",{className:"flex min-h-[calc(100vh-70px)] flex-col bg-white md:bg-gradient-to-b md:from-[#FDEBFF] md:via-[#FFF] md:to-[#F0F2F5]",children:[i.jsxs("div",{className:"relative md:mx-auto md:w-full md:max-w-5xl",children:[i.jsx("div",{className:"h-40 w-full md:h-48 md:rounded-b-lg overflow-hidden",children:j!=null&&j.cover_photo_url?i.jsx("img",{src:j.cover_photo_url,alt:"Cover",className:"h-full w-full object-cover"}):i.jsx("div",{className:"h-full w-full bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF]"})}),i.jsxs("div",{className:"absolute inset-x-0 top-0 flex items-center justify-between bg-gradient-to-b from-black/40 to-transparent px-4 py-3 text-xs font-medium text-white md:rounded-t-lg",children:[i.jsx("button",{type:"button",className:"rounded-full bg-black/30 px-3 py-1",onClick:()=>n(-1),children:" Back"}),i.jsxs("div",{className:"flex items-center gap-3 text-[11px]",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[" ",i.jsx("span",{children:C.toLocaleString()})]}),i.jsxs("span",{className:"flex items-center gap-1",children:[" ",i.jsx("span",{children:M})]})]})]}),i.jsx("div",{className:"absolute -bottom-9 left-4 flex items-end gap-3",children:i.jsx("div",{className:"h-20 w-20 overflow-hidden rounded-full border-4 border-white bg-[#050014]",children:j!=null&&j.profilePhotoUrl?i.jsx("img",{src:j.profilePhotoUrl,alt:z,className:"h-full w-full object-cover"}):i.jsx("div",{className:"h-full w-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-2xl",children:((ye=z==null?void 0:z.charAt(0))==null?void 0:ye.toUpperCase())||"?"})})})]}),i.jsx("div",{className:"px-4 pt-12 pb-3 md:mx-auto md:w-full md:max-w-5xl md:bg-white md:shadow-sm",children:i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("h1",{className:"text-lg font-semibold text-[#212529]",children:z}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[H,"  Seen 9 minutes ago"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:J}),ne?i.jsxs("span",{className:"mt-1 text-[11px] font-medium uppercase tracking-wide text-[#C045FF]",children:[V.length," active events"]}):null]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",size:"sm",className:"rounded-full px-3 py-1 text-xs",onClick:he,children:"Share profile"}),i.jsx(oe,{size:"sm",className:"rounded-full px-3 py-1 text-xs",variant:x?"primary":"secondary",onClick:ve,children:x?" Following":"Follow"})]})]})}),i.jsx("div",{className:"flex-1 px-4 py-4 md:mx-auto md:w-full md:max-w-5xl md:bg-[#F6EBFF]/70 md:rounded-b-xl",children:i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-[#6C757D]",children:"Upcoming events"}),V.map(me=>i.jsx(fe,{elevated:!0,className:"border-none",children:i.jsxs(Ee,{className:"gap-3",children:[i.jsxs("div",{className:"flex items-center justify-between text-[11px] text-[#6C757D]",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[me.status==="Accepting Bids"?i.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:i.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx(Xe,{variant:me.status==="LIVE"?"danger":"primary",children:me.status==="LIVE"?" LIVE":me.status}),i.jsx("span",{children:me.date}),i.jsxs("span",{children:[" ",me.duration]})]}),i.jsx("button",{type:"button",className:"rounded-full bg-[#F8F9FA] px-3 py-1 font-medium text-[#C045FF]",onClick:()=>ee(me.id),children:"Share"})]}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:me.title}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:me.description})]}),i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-[11px] text-[#6C757D]",children:[i.jsxs("span",{children:["Base ",We(me.basePrice)]}),i.jsxs("span",{children:["Highest bid"," ",me.currentBid?We(me.currentBid):"No bids yet"]}),i.jsxs("span",{children:[" ",me.participants," participants"]})]}),i.jsx("div",{className:"mt-2 flex gap-2",children:i.jsx(oe,{size:"sm",className:"flex-1 rounded-full",onClick:()=>n(`/events/${me.id}`),disabled:String(me.status).toLowerCase()==="completed"||String(me.status).toLowerCase()==="cancelled",children:String(me.status).toLowerCase()==="completed"?"Event Ended":String(me.status).toLowerCase()==="cancelled"?"Event Cancelled":"View & bid"})})]})},me.id)),V.length===0&&i.jsx(fe,{children:i.jsx(Ee,{children:i.jsx("p",{className:"text-sm text-[#6C757D]",children:"This creator has not set up any bidding events yet. Check back soon for upcoming sessions."})})})]})})})]})}const nz="https://iktldcrkyphkvxjwmxyb.supabase.co",F0e=()=>new Promise(r=>{if(window.Razorpay){r(!0);return}const n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>r(!0),n.onerror=()=>r(!1),document.body.appendChild(n)}),U0e=async r=>{const{data:{session:n}}=await ie.auth.getSession();if(!n)throw new Error("Please log in to continue.");const o=await fetch(`${nz}/functions/v1/razorpay-create-order`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({amount:r.amount})});if(!o.ok){const l=await o.json();throw new Error(l.error||"Failed to create order.")}return await o.json()},V0e=async r=>{const{data:{session:n}}=await ie.auth.getSession();if(!n)throw new Error("Please log in to continue.");const o=await fetch(`${nz}/functions/v1/razorpay-verify-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify(r)});if(!o.ok){const l=await o.json();throw new Error(l.error||"Payment verification failed.")}return await o.json()},B0e=r=>{const n={key:r.keyId,amount:r.amount*100,currency:"INR",name:"FanMeet",description:r.description||"Payment",order_id:r.orderId,handler:r.onSuccess,prefill:{email:r.userEmail||""},theme:{color:"#C045FF"},modal:{ondismiss:r.onDismiss||(()=>{})}};new window.Razorpay(n).open()};function W0e(){const{eventId:r}=iI(),n=Ns(),{isAuthenticated:o,user:l}=vs(),{events:u,placeBid:m,isLoading:g,getBidHistory:E,bidHistory:y,getUserCurrentBidForEvent:x}=Xo(),{getProfile:S}=YI();let C=u.find(ye=>ye.id===r);if(!C&&r&&r.startsWith("synthetic-")){const ye=r.replace(/^synthetic-/,""),me=ye.lastIndexOf("-");if(me>0){const ue=ye.slice(0,me),Fe=ye.slice(me+1),be=Number(Fe);if(ue&&Number.isFinite(be)){const ae=ue.split(/[-_]/).filter(Boolean).map(Ue=>Ue.charAt(0).toUpperCase()+Ue.slice(1)).join(" ")||"Creator",ge=100+be*25,Se=be%2===0?ge+120:0,it=be%2===0?5+be*2:0;C={id:r,creatorUsername:ue,creatorDisplayName:ae,title:be===0?"Meet & Greet  1:1 Fan Session":be===1?"Premium AMA  Ask Me Anything":be===2?"Deep Dive  Strategy Session":be===3?"Behind the Scenes Chat":"Quick Catch-up Call",description:"A quick 1:1 session to say hi, ask a couple of questions, and take a virtual selfie together.",status:be===0?"LIVE":"Upcoming",date:be===0?"Today  8:00 PM IST":"This week  8:00 PM IST",duration:be%2===0?"10 minutes":"5 minutes",basePrice:ge,currentBid:Se,participants:it,endsIn:be===0?"00:35:12 left":"Starts soon"}}}}const[R,M]=O.useState(""),[G,I]=O.useState(!1),[j,L]=O.useState(!1),N=C?S(C.creatorUsername):void 0,D=C?x(C.id):0,V=Number(R)||0,B=D+V,z=50,H=!!(C&&C.currentBid===0),J=!!(C&&String(C.status).toLowerCase()==="completed"),ee=C?C.currentBid>0?C.currentBid:C.basePrice:0,ne=C?H?C.basePrice:ee+z:0;if(O.useEffect(()=>{C&&H&&M(String(C.basePrice))},[C==null?void 0:C.id,C==null?void 0:C.currentBid,C==null?void 0:C.basePrice]),O.useEffect(()=>{C!=null&&C.id&&!C.id.startsWith("synthetic-")&&E(C.id)},[C==null?void 0:C.id]),g)return i.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-4 px-4 py-8",children:i.jsx(fe,{elevated:!0,children:i.jsxs(Ee,{className:"gap-4 p-8 text-center",children:[i.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:"Loading event..."}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Please wait while we fetch the event details."})]})})});if(!C)return i.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-4 px-4 py-8",children:i.jsxs(fe,{elevated:!0,children:[i.jsx(Te,{title:"Event not found",subtitle:"This event may have expired or been removed."}),i.jsxs(Ee,{className:"gap-4",children:[i.jsx("p",{className:"text-sm text-[#6C757D]",children:"If you followed an older link, ask the creator for their latest event or visit their profile for current sessions."}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(oe,{variant:"secondary",onClick:()=>n(-1),children:"Go back"}),i.jsx(oe,{onClick:()=>n("/"),children:"Go to homepage"})]})]})]})});const he=()=>{const ye=`${window.location.origin}/events/${C.id}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(ye).then(()=>{window.alert("Event link copied. Share it with your fans to start receiving bids.")},()=>{window.prompt("Share this event link with your fans:",ye)}):window.prompt("Share this event link with your fans:",ye)},ve=async()=>{if(J){window.alert("This event has been completed. Bidding is closed.");return}const ye=Number(R),me=D>0?B:ye;if(D>0){if(ye%z!==0){window.alert(`Bid increments must be in multiples of ${z}.`);return}}else if(ye!==C.basePrice){window.alert(`The first bid must be exactly ${C.basePrice}.`);return}if(!me||Number.isNaN(me)){window.alert("Enter a valid bid amount to continue.");return}if(me<C.currentBid){window.alert(`Your bid must be at least the current bid of ${We(C.currentBid)}.`);return}if(!o||(l==null?void 0:l.role)!=="fan"){I(!0);return}L(!0);try{if(!await F0e())throw new Error("Failed to load payment gateway");const{orderId:Fe,keyId:be}=await U0e({amount:me,userId:l.id,userEmail:l.email});B0e({amount:me,orderId:Fe,keyId:be,userEmail:l.email,description:`Bid of ${We(me)} for ${C.title}`,onSuccess:async ae=>{try{await V0e(ae),await m(C.id,me),window.alert(` Payment successful! Bid of ${We(me)} placed!

You'll be notified if someone outbids you.

 If you don't win, 90% will be auto-refunded.`),M("")}catch(ge){console.error("Error after payment:",ge),window.alert("Payment received but bid placement failed. Please contact support.")}finally{L(!1)}},onDismiss:()=>{L(!1)}})}catch(ue){console.error("Bid error:",ue),window.alert("Failed to initiate payment. Please try again."),L(!1)}};return i.jsxs("div",{className:"mx-auto flex min-h-[calc(100vh-70px)] max-w-3xl flex-col bg-white pb-6",children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"h-40 w-full bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] md:h-48"}),i.jsxs("div",{className:"absolute inset-x-0 top-0 flex items-center justify-between bg-gradient-to-b from-black/40 to-transparent px-4 py-3 text-xs font-medium text-white",children:[i.jsx("button",{type:"button",className:"rounded-full bg-black/30 px-3 py-1",onClick:()=>n(-1),children:" Back"}),i.jsxs("div",{className:"flex flex-col items-end gap-1 text-right",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-wide text-white/80",children:"Bidding event"}),i.jsx("span",{className:"text-sm font-semibold",children:C.title})]})]})]}),i.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-4 pt-4",children:[i.jsx(fe,{elevated:!0,className:"border-none",children:i.jsxs(Ee,{className:"gap-4",children:[i.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group",onClick:()=>n(`/${C.creatorUsername}`),children:[i.jsx("div",{className:"relative flex-shrink-0",children:N!=null&&N.profilePhotoUrl?i.jsx("img",{src:N.profilePhotoUrl,alt:C.creatorDisplayName,className:"h-16 w-16 rounded-full object-cover ring-2 ring-[#C045FF]/20 group-hover:ring-[#C045FF]/40 transition-all"}):i.jsx("div",{className:"h-16 w-16 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-xl ring-2 ring-[#C045FF]/20 group-hover:ring-[#C045FF]/40 transition-all",children:C.creatorDisplayName.charAt(0).toUpperCase()})}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Hosted by"}),i.jsx("span",{className:"text-sm font-semibold text-[#212529] group-hover:text-[#C045FF] transition-colors",children:C.creatorDisplayName}),i.jsxs("span",{className:"text-xs text-[#C045FF] underline decoration-dotted group-hover:decoration-solid transition-all",children:["@",C.creatorUsername]}),i.jsx("span",{className:"text-[10px] text-[#6C757D] mt-0.5 group-hover:text-[#C045FF] transition-colors",children:" Click to view profile"})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-[#6C757D]",children:[i.jsxs("span",{className:"rounded-full bg-[#F8F9FA] px-3 py-1",children:[" ",C.participants," participants"]}),i.jsxs("span",{className:"rounded-full bg-[#F8F9FA] px-3 py-1",children:[" ",C.duration]})]})]}),i.jsxs("div",{className:"grid gap-3 text-xs text-[#6C757D] md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-3",children:[i.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide",children:"Schedule"}),i.jsx("div",{className:"mt-1 text-sm text-[#212529]",children:C.date})]}),i.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-3",children:[i.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide",children:"Status"}),i.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-[#212529]",children:[C.status==="Accepting Bids"?i.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-3 py-1.5",children:i.jsx("span",{className:"text-sm font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx(Xe,{variant:C.status==="LIVE"?"danger":"primary",children:C.status==="LIVE"?" LIVE":C.status}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:C.endsIn})]})]})]})]})}),C.description?i.jsxs(fe,{children:[i.jsx(Te,{title:"About this event"}),i.jsxs(Ee,{className:"gap-3",children:[i.jsx("p",{className:"text-sm text-[#495057]",children:C.description}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"This is a demo environment. In a real product, this section would outline the exact flow of the experience, how long the interaction lasts, and any preparation required before joining."})]})]}):null,y.length>0&&i.jsxs(fe,{children:[i.jsx(Te,{title:"Recent Bids",subtitle:"Live bidding activity"}),i.jsx(Ee,{className:"gap-3",children:y.map(ye=>i.jsxs("div",{className:`flex items-center justify-between p-3 rounded-[12px] ${ye.isCurrentLeader?"bg-[#C045FF]/10 border border-[#C045FF]/30":"bg-[#F8F9FA]"}`,children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("span",{className:"text-sm font-semibold text-[#212529]",children:["@",ye.fanUsername]}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:new Date(ye.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1",children:[i.jsx("span",{className:"text-lg font-semibold text-[#C045FF]",children:We(ye.amount)}),ye.isCurrentLeader&&i.jsx("span",{className:"text-[10px] font-semibold text-[#C045FF] bg-white px-2 py-0.5 rounded-full",children:" Leading"})]})]},ye.id))})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"What you'll get"}),i.jsxs(Ee,{className:"gap-3 text-sm text-[#495057]",children:[i.jsxs("ul",{className:"space-y-1 text-xs text-[#495057]",children:[i.jsx("li",{children:" A 1:1 micro-meet with the creator with room for your questions."}),i.jsx("li",{children:" Optional screenshot / selfie moment at the end of the call."}),i.jsx("li",{children:" Priority chat placement during the live session."})]}),i.jsx("p",{className:"text-[11px] text-[#6C757D]",children:"Exact perks are for demo only and can be customised per creator event."})]})]}),i.jsxs(fe,{children:[i.jsx(Te,{title:"Small print"}),i.jsxs(Ee,{className:"gap-2 text-[11px] text-[#6C757D]",children:[i.jsx("p",{children:"Bids placed in this sandbox are not real payments. In production, only the top bidders would be charged after the auction window ends."}),i.jsx("p",{children:"By placing a bid you agree to follow community guidelines and respect the creator's time and boundaries."})]})]}),i.jsx(fe,{elevated:!0,className:"sticky bottom-0 border-none shadow-[0_-8px_24px_rgba(15,23,42,0.12)] md:static md:shadow-none",children:i.jsxs(Ee,{className:"gap-4",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-[#6C757D]",children:"Current highest bid"}),i.jsx("span",{className:"text-xl font-semibold text-[#C045FF]",children:We(ee||C.basePrice)}),i.jsxs("span",{className:"text-[11px] text-[#6C757D]",children:["Base price ",We(C.basePrice),"  ",C.participants," participants"]}),i.jsxs("span",{className:"mt-1 text-[11px] text-[#6C757D]",children:["Next bid: ",i.jsx("strong",{className:"text-[#212529]",children:We(ne)})," (step ",We(z),")"]})]}),i.jsx(oe,{variant:"secondary",size:"sm",className:"rounded-full text-xs",onClick:he,children:"Share event link"})]}),i.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(tt,{type:"number",label:D>0?"Add to your bid":"Your bid amount",placeholder:String(C.basePrice),value:R,onChange:ye=>M(ye.target.value),disabled:H||J}),H&&i.jsx("div",{className:"mt-2 text-[11px] text-[#6C757D]",children:"First bid is fixed to the creator's base price."}),J&&i.jsx("div",{className:"mt-2 text-[11px] text-[#DC3545]",children:"This event is completed. Bidding is no longer available."}),V>0&&i.jsx("div",{className:"mt-2 text-sm",children:D>0?i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("span",{className:"text-[#6C757D]",children:["Your current bid: ",i.jsx("strong",{className:"text-[#212529]",children:We(D)})]}),i.jsxs("span",{className:"text-[#C045FF] font-semibold",children:["Adding ",We(V),"  New total: ",We(B)]})]}):i.jsxs("span",{className:"text-[#C045FF] font-semibold",children:["Your bid: ",We(V)]})})]}),i.jsx(oe,{className:"md:w-40",onClick:ve,disabled:j||J,children:J?"Event Completed":j?"Processing...":"Place Bid "})]})]})})]}),G&&i.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4",children:i.jsxs("div",{className:"max-w-sm flex-1 rounded-2xl bg-white p-6 shadow-2xl",children:[i.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:"Login to place your bid"}),i.jsx("p",{className:"mt-2 text-sm text-[#6C757D]",children:"You'll need a fan account to place bids and join this meet. We'll take you to the login page and bring you back here after you're done."}),i.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[i.jsx(oe,{onClick:()=>n(`/auth?redirect=/events/${C.id}`),className:"w-full",children:"Continue to login / signup"}),i.jsx(oe,{variant:"secondary",className:"w-full",onClick:()=>I(!1),children:"Cancel"})]})]})})]})}/**
 * @license agora-rtc-react
 * @version 2.5.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var G0e=Object.create,$I=Object.defineProperty,H0e=Object.getOwnPropertyDescriptor,z0e=Object.getOwnPropertyNames,K0e=Object.getPrototypeOf,q0e=Object.prototype.hasOwnProperty,Y0e=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),$0e=(r,n)=>{for(var o in n)$I(r,o,{get:n[o],enumerable:!0})},iz=(r,n,o,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of z0e(n))!q0e.call(r,u)&&u!==o&&$I(r,u,{get:()=>n[u],enumerable:!(l=H0e(n,u))||l.enumerable});return r},X0e=(r,n,o)=>(iz(r,n,"default"),o),pu=(r,n,o)=>(o=r!=null?G0e(K0e(r)):{},iz(!r||!r.__esModule?$I(o,"default",{value:r,enumerable:!0}):o,r)),mu=Y0e((r,n)=>{(function(o,l){typeof r=="object"&&typeof n<"u"?n.exports=l():typeof define=="function"&&define.amd?define(l):(o=typeof globalThis<"u"?globalThis:o||self).AgoraRTC=l()})(r,function(){function o(e,t){return t.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in e)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(e,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var m=function(e){try{return!!e()}catch{return!0}},g=!m(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=g,y=Function.prototype,x=y.call,S=E&&y.bind.bind(x,x),C=E?S:function(e){return function(){return x.apply(e,arguments)}},R=C({}.isPrototypeOf),M=function(e){return e&&e.Math===Math&&e},G=M(typeof globalThis=="object"&&globalThis)||M(typeof window=="object"&&window)||M(typeof self=="object"&&self)||M(typeof l=="object"&&l)||M(typeof l=="object"&&l)||function(){return this}()||Function("return this")(),I=g,j=Function.prototype,L=j.apply,N=j.call,D=typeof Reflect=="object"&&Reflect.apply||(I?N.bind(L):function(){return N.apply(L,arguments)}),V=C,B=V({}.toString),z=V("".slice),H=function(e){return z(B(e),8,-1)},J=H,ee=C,ne=function(e){if(J(e)==="Function")return ee(e)},he=typeof document=="object"&&document.all,ve=he===void 0&&he!==void 0?function(e){return typeof e=="function"||e===he}:function(e){return typeof e=="function"},ye={},me=!m(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ue=g,Fe=Function.prototype.call,be=ue?Fe.bind(Fe):function(){return Fe.apply(Fe,arguments)},ae={},ge={}.propertyIsEnumerable,Se=Object.getOwnPropertyDescriptor,it=Se&&!ge.call({1:2},1);ae.f=it?function(e){var t=Se(this,e);return!!t&&t.enumerable}:ge;var Ue,ht,qe=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Me=m,st=H,De=Object,Ae=C("".split),Qe=Me(function(){return!De("z").propertyIsEnumerable(0)})?function(e){return st(e)==="String"?Ae(e,""):De(e)}:De,pe=function(e){return e==null},Re=pe,Ge=TypeError,xt=function(e){if(Re(e))throw new Ge("Can't call method on "+e);return e},jt=Qe,Pt=xt,rt=function(e){return jt(Pt(e))},Dt=ve,kt=function(e){return typeof e=="object"?e!==null:Dt(e)},Os={},bn=Os,ei=G,Ti=ve,Wr=function(e){return Ti(e)?e:void 0},ir=function(e,t){return arguments.length<2?Wr(bn[e])||Wr(ei[e]):bn[e]&&bn[e][t]||ei[e]&&ei[e][t]},Ni=G.navigator,ct=Ni&&Ni.userAgent,$e=ct?String(ct):"",Tt=G,Ht=$e,mr=Tt.process,Jt=Tt.Deno,$r=mr&&mr.versions||Jt&&Jt.version,Jo=$r&&$r.v8;Jo&&(ht=(Ue=Jo.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!ht&&Ht&&(!(Ue=Ht.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Ht.match(/Chrome\/(\d+)/))&&(ht=+Ue[1]);var ti=ht,_u=ti,Eb=m,Xr=G.String,si=!!Object.getOwnPropertySymbols&&!Eb(function(){var e=Symbol("symbol detection");return!Xr(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&_u&&_u<41}),Da=si&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Az=ir,Iz=ve,Dz=R,Oz=Object,Jp=Da?function(e){return typeof e=="symbol"}:function(e){var t=Az("Symbol");return Iz(t)&&Dz(t.prototype,Oz(e))},jz=String,vu=function(e){try{return jz(e)}catch{return"Object"}},Pz=ve,kz=vu,Lz=TypeError,ri=function(e){if(Pz(e))return e;throw new Lz(kz(e)+" is not a function")},Mz=ri,Fz=pe,t_=function(e,t){var s=e[t];return Fz(s)?void 0:Mz(s)},sD=be,rD=ve,nD=kt,Uz=TypeError,iD={exports:{}},aD=G,Vz=Object.defineProperty,Bz=G,Wz=function(e,t){try{Vz(aD,e,{value:t,configurable:!0,writable:!0})}catch{aD[e]=t}return t},oD="__core-js_shared__",cD=iD.exports=Bz[oD]||Wz(oD,{});(cD.versions||(cD.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var yb=iD.exports,lD=yb,Eu=function(e,t){return lD[e]||(lD[e]=t||{})},Gz=xt,Hz=Object,fo=function(e){return Hz(Gz(e))},zz=fo,Kz=C({}.hasOwnProperty),Gr=Object.hasOwn||function(e,t){return Kz(zz(e),t)},qz=C,Yz=0,$z=Math.random(),Xz=qz(1 .toString),xb=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Xz(++Yz+$z,36)},Jz=Eu,dD=Gr,Qz=xb,Zz=si,eK=Da,yu=G.Symbol,bb=Jz("wks"),tK=eK?yu.for||yu:yu&&yu.withoutSetter||Qz,$s=function(e){return dD(bb,e)||(bb[e]=Zz&&dD(yu,e)?yu[e]:tK("Symbol."+e)),bb[e]},sK=be,uD=kt,hD=Jp,rK=t_,nK=function(e,t){var s,a;if(rD(s=e.toString)&&!nD(a=sD(s,e))||rD(s=e.valueOf)&&!nD(a=sD(s,e))||t!=="string")return a;throw new Uz("Can't convert object to primitive value")},iK=TypeError,aK=$s("toPrimitive"),oK=function(e,t){if(!uD(e)||hD(e))return e;var s,a=rK(e,aK);if(a){if(s=sK(a,e,t),!uD(s)||hD(s))return s;throw new iK("Can't convert object to primitive value")}return nK(e,t)},cK=Jp,wb=function(e){var t=oK(e,"string");return cK(t)?t:t+""},pD=kt,Sb=G.document,lK=pD(Sb)&&pD(Sb.createElement),Cb=function(e){return lK?Sb.createElement(e):{}},dK=Cb,mD=!me&&!m(function(){return Object.defineProperty(dK("div"),"a",{get:function(){return 7}}).a!==7}),uK=me,hK=be,pK=ae,mK=qe,fK=rt,gK=wb,_K=Gr,vK=mD,fD=Object.getOwnPropertyDescriptor;ye.f=uK?fD:function(e,t){if(e=fK(e),t=gK(t),vK)try{return fD(e,t)}catch{}if(_K(e,t))return mK(!hK(pK.f,e,t),e[t])};var EK=m,yK=ve,xK=/#|\.prototype\./,Qp=function(e,t){var s=wK[bK(e)];return s===CK||s!==SK&&(yK(t)?EK(t):!!t)},bK=Qp.normalize=function(e){return String(e).replace(xK,".").toLowerCase()},wK=Qp.data={},SK=Qp.NATIVE="N",CK=Qp.POLYFILL="P",gD=Qp,TK=ri,NK=g,RK=ne(ne.bind),Ic=function(e,t){return TK(e),t===void 0?e:NK?RK(e,t):function(){return e.apply(t,arguments)}},$i={},_D=me&&m(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),AK=kt,IK=String,DK=TypeError,Un=function(e){if(AK(e))return e;throw new DK(IK(e)+" is not an object")},OK=me,jK=mD,PK=_D,s_=Un,vD=wb,kK=TypeError,Tb=Object.defineProperty,LK=Object.getOwnPropertyDescriptor,Nb="enumerable",Rb="configurable",Ab="writable";$i.f=OK?PK?function(e,t,s){if(s_(e),t=vD(t),s_(s),typeof e=="function"&&t==="prototype"&&"value"in s&&Ab in s&&!s[Ab]){var a=LK(e,t);a&&a[Ab]&&(e[t]=s.value,s={configurable:Rb in s?s[Rb]:a[Rb],enumerable:Nb in s?s[Nb]:a[Nb],writable:!1})}return Tb(e,t,s)}:Tb:function(e,t,s){if(s_(e),t=vD(t),s_(s),jK)try{return Tb(e,t,s)}catch{}if("get"in s||"set"in s)throw new kK("Accessors not supported");return"value"in s&&(e[t]=s.value),e};var MK=$i,FK=qe,$l=me?function(e,t,s){return MK.f(e,t,FK(1,s))}:function(e,t,s){return e[t]=s,e},Zp=G,UK=D,VK=ne,BK=ve,WK=ye.f,GK=gD,xu=Os,HK=Ic,bu=$l,ED=Gr,zK=function(e){var t=function(s,a,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(s);case 2:return new e(s,a)}return new e(s,a,c)}return UK(e,this,arguments)};return t.prototype=e.prototype,t},Zt=function(e,t){var s,a,c,d,h,p,f,_,v,b=e.target,w=e.global,T=e.stat,U=e.proto,k=w?Zp:T?Zp[b]:Zp[b]&&Zp[b].prototype,F=w?xu:xu[b]||bu(xu,b,{})[b],K=F.prototype;for(d in t)a=!(s=GK(w?d:b+(T?".":"#")+d,e.forced))&&k&&ED(k,d),p=F[d],a&&(f=e.dontCallGetSet?(v=WK(k,d))&&v.value:k[d]),h=a&&f?f:t[d],(s||U||typeof p!=typeof h)&&(_=e.bind&&a?HK(h,Zp):e.wrap&&a?zK(h):U&&BK(h)?VK(h):h,(e.sham||h&&h.sham||p&&p.sham)&&bu(_,"sham",!0),bu(F,d,_),U&&(ED(xu,c=b+"Prototype")||bu(xu,c,{}),bu(xu[c],d,h),e.real&&K&&(s||!K[d])&&bu(K,d,h)))},KK=Math.ceil,qK=Math.floor,YK=Math.trunc||function(e){var t=+e;return(t>0?qK:KK)(t)},$K=YK,Ib=function(e){var t=+e;return t!=t||t===0?0:$K(t)},XK=Ib,JK=Math.max,QK=Math.min,Db=function(e,t){var s=XK(e);return s<0?JK(s+t,0):QK(s,t)},ZK=Ib,eq=Math.min,yD=function(e){var t=ZK(e);return t>0?eq(t,9007199254740991):0},tq=yD,Dc=function(e){return tq(e.length)},sq=rt,rq=Db,nq=Dc,xD=function(e){return function(t,s,a){var c=sq(t),d=nq(c);if(d===0)return!e&&-1;var h,p=rq(a,d);if(e&&s!=s){for(;d>p;)if((h=c[p++])!=h)return!0}else for(;d>p;p++)if((e||p in c)&&c[p]===s)return e||p||0;return!e&&-1}},Ob={includes:xD(!0),indexOf:xD(!1)},iq=Ob.includes;Zt({target:"Array",proto:!0,forced:m(function(){return!Array(1).includes()})},{includes:function(e){return iq(this,e,arguments.length>1?arguments[1]:void 0)}});var aq=G,oq=Os,Xi=function(e,t){var s=oq[e+"Prototype"],a=s&&s[t];if(a)return a;var c=aq[e],d=c&&c.prototype;return d&&d[t]},cq=Xi("Array","includes"),lq=kt,dq=H,uq=$s("match"),bD=function(e){var t;return lq(e)&&((t=e[uq])!==void 0?!!t:dq(e)==="RegExp")},hq=bD,pq=TypeError,wD={};wD[$s("toStringTag")]="z";var jb=String(wD)==="[object z]",mq=jb,fq=ve,r_=H,gq=$s("toStringTag"),_q=Object,vq=r_(function(){return arguments}())==="Arguments",Oc=mq?r_:function(e){var t,s,a;return e===void 0?"Undefined":e===null?"Null":typeof(s=function(c,d){try{return c[d]}catch{}}(t=_q(e),gq))=="string"?s:vq?r_(t):(a=r_(t))==="Object"&&fq(t.callee)?"Arguments":a},Eq=Oc,yq=String,ni=function(e){if(Eq(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return yq(e)},xq=$s("match"),bq=Zt,wq=function(e){if(hq(e))throw new pq("The method doesn't accept regular expressions");return e},Sq=xt,SD=ni,Cq=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[xq]=!1,"/./"[e](t)}catch{}}return!1},Tq=C("".indexOf);bq({target:"String",proto:!0,forced:!Cq("includes")},{includes:function(e){return!!~Tq(SD(Sq(this)),SD(wq(e)),arguments.length>1?arguments[1]:void 0)}});var Nq=Xi("String","includes"),CD=R,Rq=cq,Aq=Nq,Pb=Array.prototype,kb=String.prototype,Iq=function(e){var t=e.includes;return e===Pb||CD(Pb,e)&&t===Pb.includes?Rq:typeof e=="string"||e===kb||CD(kb,e)&&t===kb.includes?Aq:t},ke=u(Iq),Dq=ri,Oq=fo,jq=Qe,Pq=Dc,TD=TypeError,ND="Reduce of empty array with no initial value",kq=function(e){return function(t,s,a,c){var d=Oq(t),h=jq(d),p=Pq(d);if(Dq(s),p===0&&a<2)throw new TD(ND);var f=0,_=1;if(a<2)for(;;){if(f in h){c=h[f],f+=_;break}if(f+=_,p<=f)throw new TD(ND)}for(;p>f;f+=_)f in h&&(c=s(c,h[f],f,d));return c}},Lq={left:kq()},Mq=m,n_=function(e,t){var s=[][e];return!!s&&Mq(function(){s.call(null,t||function(){return 1},1)})},em=G,Fq=$e,Uq=H,i_=function(e){return Fq.slice(0,e.length)===e},Lb=i_("Bun/")?"BUN":i_("Cloudflare-Workers")?"CLOUDFLARE":i_("Deno/")?"DENO":i_("Node.js/")?"NODE":em.Bun&&typeof Bun.version=="string"?"BUN":em.Deno&&typeof Deno.version=="object"?"DENO":Uq(em.process)==="process"?"NODE":em.window&&em.document?"BROWSER":"REST",a_=Lb==="NODE",Vq=Lq.left;Zt({target:"Array",proto:!0,forced:!a_&&ti>79&&ti<83||!n_("reduce")},{reduce:function(e){var t=arguments.length;return Vq(this,e,t,t>1?arguments[1]:void 0)}});var Bq=Xi("Array","reduce"),Wq=R,Gq=Bq,Mb=Array.prototype,Hq=function(e){var t=e.reduce;return e===Mb||Wq(Mb,e)&&t===Mb.reduce?Gq:t},RD=Hq,Ji=u(RD),zq=H,tm=Array.isArray||function(e){return zq(e)==="Array"},Kq=Zt,qq=tm,Yq=C([].reverse),AD=[1,2];Kq({target:"Array",proto:!0,forced:String(AD)===String(AD.reverse())},{reverse:function(){return qq(this)&&(this.length=this.length),Yq(this)}});var $q=Xi("Array","reverse"),Xq=R,Jq=$q,Fb=Array.prototype,Qq=function(e){var t=e.reverse;return e===Fb||Xq(Fb,e)&&t===Fb.reverse?Jq:t},ID=Qq,DD=u(ID),Zq=xb,OD=Eu("keys"),o_=function(e){return OD[e]||(OD[e]=Zq(e))},eY=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),tY=Gr,sY=ve,rY=fo,nY=eY,jD=o_("IE_PROTO"),Ub=Object,iY=Ub.prototype,Vb=nY?Ub.getPrototypeOf:function(e){var t=rY(e);if(tY(t,jD))return t[jD];var s=t.constructor;return sY(s)&&t instanceof s?s.prototype:t instanceof Ub?iY:null},aY=C,oY=ri,cY=kt,lY=function(e){return cY(e)||e===null},dY=String,uY=TypeError,hY=function(e,t,s){try{return aY(oY(Object.getOwnPropertyDescriptor(e,t)[s]))}catch{}},pY=kt,mY=xt,fY=function(e){if(lY(e))return e;throw new uY("Can't set "+dY(e)+" as a prototype")},gY=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,s={};try{(e=hY(Object.prototype,"__proto__","set"))(s,[]),t=s instanceof Array}catch{}return function(a,c){return mY(a),fY(c),pY(a)&&(t?e(a,c):a.__proto__=c),a}}():void 0),c_={},l_={},Bb=Gr,_Y=rt,vY=Ob.indexOf,EY=l_,PD=C([].push),kD=function(e,t){var s,a=_Y(e),c=0,d=[];for(s in a)!Bb(EY,s)&&Bb(a,s)&&PD(d,s);for(;t.length>c;)Bb(a,s=t[c++])&&(~vY(d,s)||PD(d,s));return d},Wb=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],yY=kD,xY=Wb.concat("length","prototype");c_.f=Object.getOwnPropertyNames||function(e){return yY(e,xY)};var sm={};sm.f=Object.getOwnPropertySymbols;var bY=ir,wY=c_,SY=sm,CY=Un,TY=C([].concat),NY=bY("Reflect","ownKeys")||function(e){var t=wY.f(CY(e)),s=SY.f;return s?TY(t,s(e)):t},LD=Gr,RY=NY,AY=ye,IY=$i,Gb={},DY=kD,OY=Wb,d_=Object.keys||function(e){return DY(e,OY)},jY=me,PY=_D,kY=$i,LY=Un,MY=rt,FY=d_;Gb.f=jY&&!PY?Object.defineProperties:function(e,t){LY(e);for(var s,a=MY(t),c=FY(t),d=c.length,h=0;d>h;)kY.f(e,s=c[h++],a[s]);return e};var u_,MD=ir("document","documentElement"),UY=Un,VY=Gb,FD=Wb,BY=l_,WY=MD,GY=Cb,Hb="prototype",zb="script",UD=o_("IE_PROTO"),Kb=function(){},VD=function(e){return"<"+zb+">"+e+"</"+zb+">"},BD=function(e){e.write(VD("")),e.close();var t=e.parentWindow.Object;return e=null,t},h_=function(){try{u_=new ActiveXObject("htmlfile")}catch{}var e,t,s;h_=typeof document<"u"?document.domain&&u_?BD(u_):(t=GY("iframe"),s="java"+zb+":",t.style.display="none",WY.appendChild(t),t.src=String(s),(e=t.contentWindow.document).open(),e.write(VD("document.F=Object")),e.close(),e.F):BD(u_);for(var a=FD.length;a--;)delete h_[Hb][FD[a]];return h_()};BY[UD]=!0;var rm=Object.create||function(e,t){var s;return e!==null?(Kb[Hb]=UY(e),s=new Kb,Kb[Hb]=null,s[UD]=e):s=h_(),t===void 0?s:VY.f(s,t)},HY=kt,zY=$l,WD=Error,KY=C("".replace),qY=String(new WD("zxcasd").stack),GD=/\n\s*at [^:]*:[^\n]*/,YY=GD.test(qY),$Y=qe,XY=!m(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",$Y(1,7)),e.stack!==7)}),JY=$l,QY=function(e,t){if(YY&&typeof e=="string"&&!WD.prepareStackTrace)for(;t--;)e=KY(e,GD,"");return e},ZY=XY,HD=Error.captureStackTrace,wu={},e$=wu,t$=$s("iterator"),s$=Array.prototype,zD=function(e){return e!==void 0&&(e$.Array===e||s$[t$]===e)},r$=Oc,KD=t_,n$=pe,i$=wu,a$=$s("iterator"),p_=function(e){if(!n$(e))return KD(e,a$)||KD(e,"@@iterator")||i$[r$(e)]},o$=be,c$=ri,l$=Un,d$=vu,u$=p_,h$=TypeError,qb=function(e,t){var s=arguments.length<2?u$(e):t;if(c$(s))return l$(o$(s,e));throw new h$(d$(e)+" is not iterable")},p$=be,qD=Un,m$=t_,YD=function(e,t,s){var a,c;qD(e);try{if(!(a=m$(e,"return"))){if(t==="throw")throw s;return s}a=p$(a,e)}catch(d){c=!0,a=d}if(t==="throw")throw s;if(c)throw a;return qD(a),s},f$=Ic,g$=be,_$=Un,v$=vu,E$=zD,y$=Dc,$D=R,x$=qb,b$=p_,XD=YD,w$=TypeError,m_=function(e,t){this.stopped=e,this.result=t},JD=m_.prototype,nm=function(e,t,s){var a,c,d,h,p,f,_,v=s&&s.that,b=!(!s||!s.AS_ENTRIES),w=!(!s||!s.IS_RECORD),T=!(!s||!s.IS_ITERATOR),U=!(!s||!s.INTERRUPTED),k=f$(t,v),F=function(Y){return a&&XD(a,"normal",Y),new m_(!0,Y)},K=function(Y){return b?(_$(Y),U?k(Y[0],Y[1],F):k(Y[0],Y[1])):U?k(Y,F):k(Y)};if(w)a=e.iterator;else if(T)a=e;else{if(!(c=b$(e)))throw new w$(v$(e)+" is not iterable");if(E$(c)){for(d=0,h=y$(e);h>d;d++)if((p=K(e[d]))&&$D(JD,p))return p;return new m_(!1)}a=x$(e,c)}for(f=w?e.next:a.next;!(_=g$(f,a)).done;){try{p=K(_.value)}catch(Y){XD(a,"throw",Y)}if(typeof p=="object"&&p&&$D(JD,p))return p}return new m_(!1)},S$=ni,C$=Zt,T$=R,N$=Vb,f_=gY,R$=function(e,t,s){for(var a=RY(t),c=IY.f,d=AY.f,h=0;h<a.length;h++){var p=a[h];LD(e,p)||s&&LD(s,p)||c(e,p,d(t,p))}},QD=rm,Yb=$l,$b=qe,A$=function(e,t){HY(t)&&"cause"in t&&zY(e,"cause",t.cause)},I$=function(e,t,s,a){ZY&&(HD?HD(e,t):JY(e,"stack",QY(s,a)))},D$=nm,O$=function(e,t){return e===void 0?arguments.length<2?"":t:S$(e)},j$=$s("toStringTag"),g_=Error,P$=[].push,Su=function(e,t){var s,a=T$(Xb,this);f_?s=f_(new g_,a?N$(this):Xb):(s=a?this:QD(Xb),Yb(s,j$,"Error")),t!==void 0&&Yb(s,"message",O$(t)),I$(s,Su,s.stack,1),arguments.length>2&&A$(s,arguments[2]);var c=[];return D$(e,P$,{that:c}),Yb(s,"errors",c),s};f_?f_(Su,g_):R$(Su,g_,{name:!0});var Xb=Su.prototype=QD(g_.prototype,{constructor:$b(1,Su),message:$b(1,""),name:$b(1,"AggregateError")});C$({global:!0},{AggregateError:Su});var __,im,v_,k$=ve,ZD=G.WeakMap,L$=k$(ZD)&&/native code/.test(String(ZD)),eO=G,M$=kt,F$=$l,Jb=Gr,Qb=yb,U$=o_,V$=l_,tO="Object already initialized",Zb=eO.TypeError,B$=eO.WeakMap;if(L$||Qb.state){var go=Qb.state||(Qb.state=new B$);go.get=go.get,go.has=go.has,go.set=go.set,__=function(e,t){if(go.has(e))throw new Zb(tO);return t.facade=e,go.set(e,t),t},im=function(e){return go.get(e)||{}},v_=function(e){return go.has(e)}}else{var Cu=U$("state");V$[Cu]=!0,__=function(e,t){if(Jb(e,Cu))throw new Zb(tO);return t.facade=e,F$(e,Cu,t),t},im=function(e){return Jb(e,Cu)?e[Cu]:{}},v_=function(e){return Jb(e,Cu)}}var Xl,sO,rO,Jl={set:__,get:im,has:v_,enforce:function(e){return v_(e)?im(e):__(e,{})},getterFor:function(e){return function(t){var s;if(!M$(t)||(s=im(t)).type!==e)throw new Zb("Incompatible receiver, "+e+" required");return s}}},ew=me,W$=Gr,nO=Function.prototype,G$=ew&&Object.getOwnPropertyDescriptor,iO=W$(nO,"name"),aO={PROPER:iO&&(function(){}).name==="something",CONFIGURABLE:iO&&(!ew||ew&&G$(nO,"name").configurable)},H$=$l,jc=function(e,t,s,a){return a&&a.enumerable?e[t]=s:H$(e,t,s),e},z$=m,K$=ve,q$=kt,Y$=rm,oO=Vb,$$=jc,tw=$s("iterator"),cO=!1;[].keys&&("next"in(rO=[].keys())?(sO=oO(oO(rO)))!==Object.prototype&&(Xl=sO):cO=!0);var X$=!q$(Xl)||z$(function(){var e={};return Xl[tw].call(e)!==e});K$((Xl=X$?{}:Y$(Xl))[tw])||$$(Xl,tw,function(){return this});var lO={IteratorPrototype:Xl,BUGGY_SAFARI_ITERATORS:cO},J$=Oc,Q$=jb?{}.toString:function(){return"[object "+J$(this)+"]"},Z$=jb,eX=$i.f,tX=$l,sX=Gr,rX=Q$,dO=$s("toStringTag"),Qo=function(e,t,s,a){var c=s?e:e&&e.prototype;c&&(sX(c,dO)||eX(c,dO,{configurable:!0,value:t}),a&&!Z$&&tX(c,"toString",rX))},nX=lO.IteratorPrototype,iX=rm,aX=qe,oX=Qo,cX=wu,lX=function(){return this},sw=function(e,t,s,a){var c=t+" Iterator";return e.prototype=iX(nX,{next:aX(+!a,s)}),oX(e,c,!1,!0),cX[c]=lX,e},dX=Zt,uX=be,hX=aO,pX=sw,mX=Vb,fX=Qo,uO=jc,hO=wu,gX=lO,_X=hX.PROPER,E_=gX.BUGGY_SAFARI_ITERATORS,rw=$s("iterator"),pO="keys",y_="values",mO="entries",vX=function(){return this},fO=function(e,t,s,a,c,d,h){pX(s,t,a);var p,f,_,v=function(K){if(K===c&&k)return k;if(!E_&&K&&K in T)return T[K];switch(K){case pO:case y_:case mO:return function(){return new s(this,K)}}return function(){return new s(this)}},b=t+" Iterator",w=!1,T=e.prototype,U=T[rw]||T["@@iterator"]||c&&T[c],k=!E_&&U||v(c),F=t==="Array"&&T.entries||U;if(F&&(p=mX(F.call(new e)))!==Object.prototype&&p.next&&(fX(p,b,!0,!0),hO[b]=vX),_X&&c===y_&&U&&U.name!==y_&&(w=!0,k=function(){return uX(U,this)}),c)if(f={values:v(y_),keys:d?k:v(pO),entries:v(mO)},h)for(_ in f)(E_||w||!(_ in T))&&uO(T,_,f[_]);else dX({target:t,proto:!0,forced:E_||w},f);return h&&T[rw]!==k&&uO(T,rw,k,{}),hO[t]=k,f},x_=function(e,t){return{value:e,done:t}},EX=rt,gO=wu,_O=Jl;$i.f;var yX=fO,b_=x_,vO="Array Iterator",xX=_O.set,bX=_O.getterFor(vO);yX(Array,"Array",function(e,t){xX(this,{type:vO,target:EX(e),index:0,kind:t})},function(){var e=bX(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,b_(void 0,!0);switch(e.kind){case"keys":return b_(s,!1);case"values":return b_(t[s],!1)}return b_([s,t[s]],!1)},"values"),gO.Arguments=gO.Array;var wX=$i,w_=function(e,t,s){return wX.f(e,t,s)},SX=ir,CX=w_,TX=me,EO=$s("species"),NX=R,RX=TypeError,nw=function(e,t){if(NX(t,e))return e;throw new RX("Incorrect invocation")},AX=ve,iw=yb,IX=C(Function.toString);AX(iw.inspectSource)||(iw.inspectSource=function(e){return IX(e)});var yO=iw.inspectSource,DX=C,OX=m,xO=ve,jX=Oc,PX=yO,bO=function(){},wO=ir("Reflect","construct"),aw=/^\s*(?:class|function)\b/,kX=DX(aw.exec),LX=!aw.test(bO),am=function(e){if(!xO(e))return!1;try{return wO(bO,[],e),!0}catch{return!1}},SO=function(e){if(!xO(e))return!1;switch(jX(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return LX||!!kX(aw,PX(e))}catch{return!0}};SO.sham=!0;var om,Tu,CO,ow,S_=!wO||OX(function(){var e;return am(am.call)||!am(Object)||!am(function(){e=!0})||e})?SO:am,MX=S_,FX=vu,UX=TypeError,TO=Un,VX=function(e){if(MX(e))return e;throw new UX(FX(e)+" is not a constructor")},BX=pe,WX=$s("species"),cw=function(e,t){var s,a=TO(e).constructor;return a===void 0||BX(s=TO(a)[WX])?t:VX(s)},Pc=C([].slice),GX=TypeError,Ql=function(e,t){if(e<t)throw new GX("Not enough arguments");return e},NO=/(?:ipad|iphone|ipod).*applewebkit/i.test($e),Ri=G,HX=D,zX=Ic,RO=ve,KX=Gr,AO=m,IO=MD,qX=Pc,DO=Cb,YX=Ql,$X=NO,XX=a_,lw=Ri.setImmediate,dw=Ri.clearImmediate,JX=Ri.process,uw=Ri.Dispatch,QX=Ri.Function,OO=Ri.MessageChannel,ZX=Ri.String,hw=0,cm={},jO="onreadystatechange";AO(function(){om=Ri.location});var pw=function(e){if(KX(cm,e)){var t=cm[e];delete cm[e],t()}},mw=function(e){return function(){pw(e)}},PO=function(e){pw(e.data)},kO=function(e){Ri.postMessage(ZX(e),om.protocol+"//"+om.host)};lw&&dw||(lw=function(e){YX(arguments.length,1);var t=RO(e)?e:QX(e),s=qX(arguments,1);return cm[++hw]=function(){HX(t,void 0,s)},Tu(hw),hw},dw=function(e){delete cm[e]},XX?Tu=function(e){JX.nextTick(mw(e))}:uw&&uw.now?Tu=function(e){uw.now(mw(e))}:OO&&!$X?(ow=(CO=new OO).port2,CO.port1.onmessage=PO,Tu=zX(ow.postMessage,ow)):Ri.addEventListener&&RO(Ri.postMessage)&&!Ri.importScripts&&om&&om.protocol!=="file:"&&!AO(kO)?(Tu=kO,Ri.addEventListener("message",PO,!1)):Tu=jO in DO("script")?function(e){IO.appendChild(DO("script"))[jO]=function(){IO.removeChild(this),pw(e)}}:function(e){setTimeout(mw(e),0)});var C_={set:lw,clear:dw},LO=G,eJ=me,tJ=Object.getOwnPropertyDescriptor,MO=function(e){if(!eJ)return LO[e];var t=tJ(LO,e);return t&&t.value},FO=function(){this.head=null,this.tail=null};FO.prototype={add:function(e){var t={item:e,next:null},s=this.tail;s?s.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Nu,fw,gw,_w,UO,VO=FO,sJ=/ipad|iphone|ipod/i.test($e)&&typeof Pebble<"u",rJ=/web0s(?!.*chrome)/i.test($e),Ru=G,nJ=MO,BO=Ic,vw=C_.set,iJ=VO,aJ=NO,oJ=sJ,cJ=rJ,Ew=a_,WO=Ru.MutationObserver||Ru.WebKitMutationObserver,GO=Ru.document,HO=Ru.process,T_=Ru.Promise,yw=nJ("queueMicrotask");if(!yw){var N_=new iJ,R_=function(){var e,t;for(Ew&&(e=HO.domain)&&e.exit();t=N_.get();)try{t()}catch(s){throw N_.head&&Nu(),s}e&&e.enter()};aJ||Ew||cJ||!WO||!GO?!oJ&&T_&&T_.resolve?((_w=T_.resolve(void 0)).constructor=T_,UO=BO(_w.then,_w),Nu=function(){UO(R_)}):Ew?Nu=function(){HO.nextTick(R_)}:(vw=BO(vw,Ru),Nu=function(){vw(R_)}):(fw=!0,gw=GO.createTextNode(""),new WO(R_).observe(gw,{characterData:!0}),Nu=function(){gw.data=fw=!fw}),yw=function(e){N_.head||Nu(),N_.add(e)}}var zO=yw,Au=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Zl=G.Promise,lJ=G,lm=Zl,dJ=ve,uJ=gD,hJ=yO,pJ=$s,KO=Lb,xw=ti,qO=lm&&lm.prototype,mJ=pJ("species"),YO=dJ(lJ.PromiseRejectionEvent),fJ=uJ("Promise",function(){var e=hJ(lm),t=e!==String(lm);if(!t&&xw===66||!qO.catch||!qO.finally)return!0;if(!xw||xw<51||!/native code/.test(e)){var s=new lm(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((s.constructor={})[mJ]=a,!(s.then(function(){})instanceof a))return!0}return!(t||KO!=="BROWSER"&&KO!=="DENO"||YO)}),dm={CONSTRUCTOR:fJ,REJECTION_EVENT:YO},_o={},$O=ri,gJ=TypeError,_J=function(e){var t,s;this.promise=new e(function(a,c){if(t!==void 0||s!==void 0)throw new gJ("Bad Promise constructor");t=a,s=c}),this.resolve=$O(t),this.reject=$O(s)};_o.f=function(e){return new _J(e)};var bw,XO,vJ=Zt,A_=a_,kc=G,um=be,EJ=jc,yJ=Qo,xJ=function(e){var t=SX(e);TX&&t&&!t[EO]&&CX(t,EO,{configurable:!0,get:function(){return this}})},bJ=ri,ww=ve,wJ=kt,SJ=nw,CJ=cw,JO=C_.set,Sw=zO,TJ=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},NJ=Au,RJ=VO,QO=Jl,Cw=Zl,ZO=dm,ej=_o,I_="Promise",tj=ZO.CONSTRUCTOR,AJ=ZO.REJECTION_EVENT,Tw=QO.getterFor(I_),IJ=QO.set,DJ=Cw&&Cw.prototype,hm=Cw,Nw=DJ,sj=kc.TypeError,Rw=kc.document,Aw=kc.process,Iw=ej.f,OJ=Iw,jJ=!!(Rw&&Rw.createEvent&&kc.dispatchEvent),rj="unhandledrejection",nj=function(e){var t;return!(!wJ(e)||!ww(t=e.then))&&t},ij=function(e,t){var s,a,c,d=t.value,h=t.state===1,p=h?e.ok:e.fail,f=e.resolve,_=e.reject,v=e.domain;try{p?(h||(t.rejection===2&&kJ(t),t.rejection=1),p===!0?s=d:(v&&v.enter(),s=p(d),v&&(v.exit(),c=!0)),s===e.promise?_(new sj("Promise-chain cycle")):(a=nj(s))?um(a,s,f,_):f(s)):_(d)}catch(b){v&&!c&&v.exit(),_(b)}},aj=function(e,t){e.notified||(e.notified=!0,Sw(function(){for(var s,a=e.reactions;s=a.get();)ij(s,e);e.notified=!1,t&&!e.rejection&&PJ(e)}))},oj=function(e,t,s){var a,c;jJ?((a=Rw.createEvent("Event")).promise=t,a.reason=s,a.initEvent(e,!1,!0),kc.dispatchEvent(a)):a={promise:t,reason:s},!AJ&&(c=kc["on"+e])?c(a):e===rj&&TJ("Unhandled promise rejection",s)},PJ=function(e){um(JO,kc,function(){var t,s=e.facade,a=e.value;if(cj(e)&&(t=NJ(function(){A_?Aw.emit("unhandledRejection",a,s):oj(rj,s,a)}),e.rejection=A_||cj(e)?2:1,t.error))throw t.value})},cj=function(e){return e.rejection!==1&&!e.parent},kJ=function(e){um(JO,kc,function(){var t=e.facade;A_?Aw.emit("rejectionHandled",t):oj("rejectionhandled",t,e.value)})},Iu=function(e,t,s){return function(a){e(t,a,s)}},Du=function(e,t,s){e.done||(e.done=!0,s&&(e=s),e.value=t,e.state=2,aj(e,!0))},Dw=function(e,t,s){if(!e.done){e.done=!0,s&&(e=s);try{if(e.facade===t)throw new sj("Promise can't be resolved itself");var a=nj(t);a?Sw(function(){var c={done:!1};try{um(a,t,Iu(Dw,c,e),Iu(Du,c,e))}catch(d){Du(c,d,e)}}):(e.value=t,e.state=1,aj(e,!1))}catch(c){Du({done:!1},c,e)}}};tj&&(Nw=(hm=function(e){SJ(this,Nw),bJ(e),um(bw,this);var t=Tw(this);try{e(Iu(Dw,t),Iu(Du,t))}catch(s){Du(t,s)}}).prototype,(bw=function(e){IJ(this,{type:I_,done:!1,notified:!1,parent:!1,reactions:new RJ,rejection:!1,state:0,value:null})}).prototype=EJ(Nw,"then",function(e,t){var s=Tw(this),a=Iw(CJ(this,hm));return s.parent=!0,a.ok=!ww(e)||e,a.fail=ww(t)&&t,a.domain=A_?Aw.domain:void 0,s.state===0?s.reactions.add(a):Sw(function(){ij(a,s)}),a.promise}),XO=function(){var e=new bw,t=Tw(e);this.promise=e,this.resolve=Iu(Dw,t),this.reject=Iu(Du,t)},ej.f=Iw=function(e){return e===hm||e===void 0?new XO(e):OJ(e)}),vJ({global:!0,wrap:!0,forced:tj},{Promise:hm}),yJ(hm,I_,!1,!0),xJ(I_);var lj=$s("iterator"),dj=!1;try{var LJ=0,uj={next:function(){return{done:!!LJ++}},return:function(){dj=!0}};uj[lj]=function(){return this},Array.from(uj,function(){throw 2})}catch{}var MJ=Zl,FJ=function(e,t){try{if(!t&&!dj)return!1}catch{return!1}var s=!1;try{var a={};a[lj]=function(){return{next:function(){return{done:s=!0}}}},e(a)}catch{}return s},D_=dm.CONSTRUCTOR||!FJ(function(e){MJ.all(e).then(void 0,function(){})}),UJ=be,VJ=ri,BJ=_o,WJ=Au,GJ=nm;Zt({target:"Promise",stat:!0,forced:D_},{all:function(e){var t=this,s=BJ.f(t),a=s.resolve,c=s.reject,d=WJ(function(){var h=VJ(t.resolve),p=[],f=0,_=1;GJ(e,function(v){var b=f++,w=!1;_++,UJ(h,t,v).then(function(T){w||(w=!0,p[b]=T,--_||a(p))},c)}),--_||a(p)});return d.error&&c(d.value),s.promise}});var HJ=Zt,zJ=dm.CONSTRUCTOR;Zl&&Zl.prototype,HJ({target:"Promise",proto:!0,forced:zJ,real:!0},{catch:function(e){return this.then(void 0,e)}});var KJ=be,qJ=ri,YJ=_o,$J=Au,XJ=nm;Zt({target:"Promise",stat:!0,forced:D_},{race:function(e){var t=this,s=YJ.f(t),a=s.reject,c=$J(function(){var d=qJ(t.resolve);XJ(e,function(h){KJ(d,t,h).then(s.resolve,a)})});return c.error&&a(c.value),s.promise}});var JJ=_o;Zt({target:"Promise",stat:!0,forced:dm.CONSTRUCTOR},{reject:function(e){var t=JJ.f(this);return(0,t.reject)(e),t.promise}});var QJ=Un,ZJ=kt,eQ=_o,hj=function(e,t){if(QJ(e),ZJ(t)&&t.constructor===e)return t;var s=eQ.f(e);return(0,s.resolve)(t),s.promise},tQ=Zt,sQ=Zl,rQ=dm.CONSTRUCTOR,nQ=hj,iQ=ir("Promise"),aQ=!rQ;tQ({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return nQ(aQ&&this===iQ?sQ:this,e)}});var oQ=be,cQ=ri,lQ=_o,dQ=Au,uQ=nm;Zt({target:"Promise",stat:!0,forced:D_},{allSettled:function(e){var t=this,s=lQ.f(t),a=s.resolve,c=s.reject,d=dQ(function(){var h=cQ(t.resolve),p=[],f=0,_=1;uQ(e,function(v){var b=f++,w=!1;_++,oQ(h,t,v).then(function(T){w||(w=!0,p[b]={status:"fulfilled",value:T},--_||a(p))},function(T){w||(w=!0,p[b]={status:"rejected",reason:T},--_||a(p))})}),--_||a(p)});return d.error&&c(d.value),s.promise}});var hQ=be,pQ=ri,mQ=ir,fQ=_o,gQ=Au,_Q=nm,pj="No one promise resolved";Zt({target:"Promise",stat:!0,forced:D_},{any:function(e){var t=this,s=mQ("AggregateError"),a=fQ.f(t),c=a.resolve,d=a.reject,h=gQ(function(){var p=pQ(t.resolve),f=[],_=0,v=1,b=!1;_Q(e,function(w){var T=_++,U=!1;v++,hQ(p,t,w).then(function(k){U||b||(b=!0,c(k))},function(k){U||b||(U=!0,f[T]=k,--v||d(new s(f,pj)))})}),--v||d(new s(f,pj))});return h.error&&d(h.value),a.promise}});var vQ=Zt,EQ=D,yQ=Pc,xQ=_o,bQ=ri,mj=Au,Ow=G.Promise,fj=!1;vQ({target:"Promise",stat:!0,forced:!Ow||!Ow.try||mj(function(){Ow.try(function(e){fj=e===8},8)}).error||!fj},{try:function(e){var t=arguments.length>1?yQ(arguments,1):[],s=xQ.f(this),a=mj(function(){return EQ(bQ(e),void 0,t)});return(a.error?s.reject:s.resolve)(a.value),s.promise}});var wQ=_o;Zt({target:"Promise",stat:!0},{withResolvers:function(){var e=wQ.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var SQ=Zt,jw=Zl,CQ=m,TQ=ir,NQ=ve,RQ=cw,gj=hj,AQ=jw&&jw.prototype;SQ({target:"Promise",proto:!0,real:!0,forced:!!jw&&CQ(function(){AQ.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=RQ(this,TQ("Promise")),s=NQ(e);return this.then(s?function(a){return gj(t,e()).then(function(){return a})}:e,s?function(a){return gj(t,e()).then(function(){throw a})}:e)}});var Pw=C,IQ=Ib,DQ=ni,OQ=xt,jQ=Pw("".charAt),_j=Pw("".charCodeAt),PQ=Pw("".slice),vj=function(e){return function(t,s){var a,c,d=DQ(OQ(t)),h=IQ(s),p=d.length;return h<0||h>=p?e?"":void 0:(a=_j(d,h))<55296||a>56319||h+1===p||(c=_j(d,h+1))<56320||c>57343?e?jQ(d,h):a:e?PQ(d,h,h+2):c-56320+(a-55296<<10)+65536}},kw={codeAt:vj(!1),charAt:vj(!0)},kQ=kw.charAt,LQ=ni,Ej=Jl,MQ=fO,yj=x_,xj="String Iterator",FQ=Ej.set,UQ=Ej.getterFor(xj);MQ(String,"String",function(e){FQ(this,{type:xj,string:LQ(e),index:0})},function(){var e,t=UQ(this),s=t.string,a=t.index;return a>=s.length?yj(void 0,!0):(e=kQ(s,a),t.index+=e.length,yj(e,!1))});var VQ=Os.Promise,BQ={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},WQ=G,GQ=Qo,bj=wu;for(var Lw in BQ)GQ(WQ[Lw],Lw),bj[Lw]=bj.Array;var wj=VQ,Be=u(wj),HQ=Xi("Array","values"),zQ=Oc,KQ=Gr,qQ=R,YQ=HQ,Mw=Array.prototype,$Q={DOMTokenList:!0,NodeList:!0},XQ=function(e){var t=e.values;return e===Mw||qQ(Mw,e)&&t===Mw.values||KQ($Q,zQ(e))?YQ:t},Vn=u(XQ),Sj=vu,JQ=TypeError,Cj=Pc,QQ=Math.floor,Fw=function(e,t){var s=e.length;if(s<8)for(var a,c,d=1;d<s;){for(c=d,a=e[d];c&&t(e[c-1],a)>0;)e[c]=e[--c];c!==d++&&(e[c]=a)}else for(var h=QQ(s/2),p=Fw(Cj(e,0,h),t),f=Fw(Cj(e,h),t),_=p.length,v=f.length,b=0,w=0;b<_||w<v;)e[b+w]=b<_&&w<v?t(p[b],f[w])<=0?p[b++]:f[w++]:b<_?p[b++]:f[w++];return e},Tj=Fw,Nj=$e.match(/firefox\/(\d+)/i),ZQ=!!Nj&&+Nj[1],eZ=/MSIE|Trident/.test($e),Rj=$e.match(/AppleWebKit\/(\d+)\./),tZ=!!Rj&&+Rj[1],sZ=Zt,Aj=C,rZ=ri,nZ=fo,Ij=Dc,iZ=function(e,t){if(!delete e[t])throw new JQ("Cannot delete property "+Sj(t)+" of "+Sj(e))},Dj=ni,Uw=m,aZ=Tj,oZ=n_,Oj=ZQ,cZ=eZ,jj=ti,Pj=tZ,Lc=[],kj=Aj(Lc.sort),lZ=Aj(Lc.push),dZ=Uw(function(){Lc.sort(void 0)}),uZ=Uw(function(){Lc.sort(null)}),hZ=oZ("sort"),Lj=!Uw(function(){if(jj)return jj<70;if(!(Oj&&Oj>3)){if(cZ)return!0;if(Pj)return Pj<603;var e,t,s,a,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)Lc.push({k:t+a,v:s})}for(Lc.sort(function(d,h){return h.v-d.v}),a=0;a<Lc.length;a++)t=Lc[a].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}});sZ({target:"Array",proto:!0,forced:dZ||!uZ||!hZ||!Lj},{sort:function(e){e!==void 0&&rZ(e);var t=nZ(this);if(Lj)return e===void 0?kj(t):kj(t,e);var s,a,c=[],d=Ij(t);for(a=0;a<d;a++)a in t&&lZ(c,t[a]);for(aZ(c,function(h){return function(p,f){return f===void 0?-1:p===void 0?1:h!==void 0?+h(p,f)||0:Dj(p)>Dj(f)?1:-1}}(e)),s=Ij(c),a=0;a<s;)t[a]=c[a++];for(;a<d;)iZ(t,a++);return t}});var pZ=Xi("Array","sort"),mZ=R,fZ=pZ,Vw=Array.prototype,gZ=function(e){var t=e.sort;return e===Vw||mZ(Vw,e)&&t===Vw.sort?fZ:t},ed=u(gZ),_Z=Zt,vZ=C,EZ=Db,yZ=RangeError,Mj=String.fromCharCode,Fj=String.fromCodePoint,xZ=vZ([].join);_Z({target:"String",stat:!0,forced:!!Fj&&Fj.length!==1},{fromCodePoint:function(e){for(var t,s=[],a=arguments.length,c=0;a>c;){if(t=+arguments[c++],EZ(t,1114111)!==t)throw new yZ(t+" is not a valid code point");s[c]=t<65536?Mj(t):Mj(55296+((t-=65536)>>10),t%1024+56320)}return xZ(s,"")}});var bZ=m,wZ=$s("iterator"),O_=!bZ(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),a="";return e.pathname="c%20d",t.forEach(function(c,d){t.delete("b"),a+=d+c}),s.delete("a",2),s.delete("b",void 0),!e.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[wZ]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"}),SZ=jc,Bw=Zt,Uj=G,Ww=MO,CZ=ir,j_=be,Oa=C,pm=me,Vj=O_,Bj=jc,TZ=w_,NZ=function(e,t,s){for(var a in t)s&&s.unsafe&&e[a]?e[a]=t[a]:SZ(e,a,t[a],s);return e},RZ=Qo,AZ=sw,Gw=Jl,Wj=nw,Hw=ve,IZ=Gr,DZ=Ic,OZ=Oc,jZ=Un,Gj=kt,Bn=ni,PZ=rm,Hj=qe,zj=qb,kZ=p_,P_=x_,Ou=Ql,LZ=Tj,MZ=$s("iterator"),ju="URLSearchParams",Kj=ju+"Iterator",qj=Gw.set,Qi=Gw.getterFor(ju),FZ=Gw.getterFor(Kj),Yj=Ww("fetch"),k_=Ww("Request"),mm=Ww("Headers"),zw=k_&&k_.prototype,$j=mm&&mm.prototype,UZ=Uj.TypeError,VZ=Uj.encodeURIComponent,BZ=String.fromCharCode,WZ=CZ("String","fromCodePoint"),GZ=parseInt,L_=Oa("".charAt),Xj=Oa([].join),Mc=Oa([].push),Jj=Oa("".replace),HZ=Oa([].shift),Qj=Oa([].splice),Zj=Oa("".split),eP=Oa("".slice),zZ=Oa(/./.exec),KZ=/\+/g,qZ=/^[0-9a-f]+$/i,tP=function(e,t){var s=eP(e,t,t+2);return zZ(qZ,s)?GZ(s,16):NaN},YZ=function(e){for(var t=0,s=128;s>0&&e&s;s>>=1)t++;return t},$Z=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},sP=function(e){for(var t=(e=Jj(e,KZ," ")).length,s="",a=0;a<t;){var c=L_(e,a);if(c==="%"){if(L_(e,a+1)==="%"||a+3>t){s+="%",a++;continue}var d=tP(e,a+1);if(d!=d){s+=c,a++;continue}a+=2;var h=YZ(d);if(h===0)c=BZ(d);else{if(h===1||h>4){s+="",a++;continue}for(var p=[d],f=1;f<h&&!(++a+3>t||L_(e,a)!=="%");){var _=tP(e,a+1);if(_!=_){a+=3;break}if(_>191||_<128)break;Mc(p,_),a+=2,f++}if(p.length!==h){s+="";continue}var v=$Z(p);v===null?s+="":c=WZ(v)}}s+=c,a++}return s},XZ=/[!'()~]|%20/g,JZ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},QZ=function(e){return JZ[e]},rP=function(e){return Jj(VZ(e),XZ,QZ)},Kw=AZ(function(e,t){qj(this,{type:Kj,target:Qi(e).entries,index:0,kind:t})},ju,function(){var e=FZ(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,P_(void 0,!0);var a=t[s];switch(e.kind){case"keys":return P_(a.key,!1);case"values":return P_(a.value,!1)}return P_([a.key,a.value],!1)},!0),nP=function(e){this.entries=[],this.url=null,e!==void 0&&(Gj(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?L_(e,0)==="?"?eP(e,1):e:Bn(e)))};nP.prototype={type:ju,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,s,a,c,d,h,p,f=this.entries,_=kZ(e);if(_)for(s=(t=zj(e,_)).next;!(a=j_(s,t)).done;){if(d=(c=zj(jZ(a.value))).next,(h=j_(d,c)).done||(p=j_(d,c)).done||!j_(d,c).done)throw new UZ("Expected sequence with length 2");Mc(f,{key:Bn(h.value),value:Bn(p.value)})}else for(var v in e)IZ(e,v)&&Mc(f,{key:v,value:Bn(e[v])})},parseQuery:function(e){if(e)for(var t,s,a=this.entries,c=Zj(e,"&"),d=0;d<c.length;)(t=c[d++]).length&&(s=Zj(t,"="),Mc(a,{key:sP(HZ(s)),value:sP(Xj(s,"="))}))},serialize:function(){for(var e,t=this.entries,s=[],a=0;a<t.length;)e=t[a++],Mc(s,rP(e.key)+"="+rP(e.value));return Xj(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var M_=function(){Wj(this,Pu);var e=qj(this,new nP(arguments.length>0?arguments[0]:void 0));pm||(this.size=e.entries.length)},Pu=M_.prototype;if(NZ(Pu,{append:function(e,t){var s=Qi(this);Ou(arguments.length,2),Mc(s.entries,{key:Bn(e),value:Bn(t)}),pm||this.length++,s.updateURL()},delete:function(e){for(var t=Qi(this),s=Ou(arguments.length,1),a=t.entries,c=Bn(e),d=s<2?void 0:arguments[1],h=d===void 0?d:Bn(d),p=0;p<a.length;){var f=a[p];if(f.key!==c||h!==void 0&&f.value!==h)p++;else if(Qj(a,p,1),h!==void 0)break}pm||(this.size=a.length),t.updateURL()},get:function(e){var t=Qi(this).entries;Ou(arguments.length,1);for(var s=Bn(e),a=0;a<t.length;a++)if(t[a].key===s)return t[a].value;return null},getAll:function(e){var t=Qi(this).entries;Ou(arguments.length,1);for(var s=Bn(e),a=[],c=0;c<t.length;c++)t[c].key===s&&Mc(a,t[c].value);return a},has:function(e){for(var t=Qi(this).entries,s=Ou(arguments.length,1),a=Bn(e),c=s<2?void 0:arguments[1],d=c===void 0?c:Bn(c),h=0;h<t.length;){var p=t[h++];if(p.key===a&&(d===void 0||p.value===d))return!0}return!1},set:function(e,t){var s=Qi(this);Ou(arguments.length,1);for(var a,c=s.entries,d=!1,h=Bn(e),p=Bn(t),f=0;f<c.length;f++)(a=c[f]).key===h&&(d?Qj(c,f--,1):(d=!0,a.value=p));d||Mc(c,{key:h,value:p}),pm||(this.size=c.length),s.updateURL()},sort:function(){var e=Qi(this);LZ(e.entries,function(t,s){return t.key>s.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,s=Qi(this).entries,a=DZ(e,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((t=s[c++]).value,t.key,this)},keys:function(){return new Kw(this,"keys")},values:function(){return new Kw(this,"values")},entries:function(){return new Kw(this,"entries")}},{enumerable:!0}),Bj(Pu,MZ,Pu.entries,{}),Bj(Pu,"toString",function(){return Qi(this).serialize()},{enumerable:!0}),pm&&TZ(Pu,"size",{get:function(){return Qi(this).entries.length},configurable:!0,enumerable:!0}),RZ(M_,ju),Bw({global:!0,forced:!Vj},{URLSearchParams:M_}),!Vj&&Hw(mm)){var ZZ=Oa($j.has),eee=Oa($j.set),iP=function(e){if(Gj(e)){var t,s=e.body;if(OZ(s)===ju)return t=e.headers?new mm(e.headers):new mm,ZZ(t,"content-type")||eee(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),PZ(e,{body:Hj(0,Bn(s)),headers:Hj(0,t)})}return e};if(Hw(Yj)&&Bw({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Yj(e,arguments.length>1?iP(arguments[1]):{})}}),Hw(k_)){var qw=function(e){return Wj(this,zw),new k_(e,arguments.length>1?iP(arguments[1]):{})};zw.constructor=qw,qw.prototype=zw,Bw({global:!0,dontCallGetSet:!0,forced:!0},{Request:qw})}}var Zi,tee={URLSearchParams:M_,getState:Qi},see=Os.URLSearchParams,aP=me,ree=C,nee=be,iee=m,Yw=d_,aee=sm,oee=ae,cee=fo,lee=Qe,ku=Object.assign,oP=Object.defineProperty,dee=ree([].concat),uee=!ku||iee(function(){if(aP&&ku({b:1},ku(oP({},"a",{enumerable:!0,get:function(){oP(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},s=Symbol("assign detection"),a="abcdefghijklmnopqrst";return e[s]=7,a.split("").forEach(function(c){t[c]=c}),ku({},e)[s]!==7||Yw(ku({},t)).join("")!==a})?function(e,t){for(var s=cee(e),a=arguments.length,c=1,d=aee.f,h=oee.f;a>c;)for(var p,f=lee(arguments[c++]),_=d?dee(Yw(f),d(f)):Yw(f),v=_.length,b=0;v>b;)p=_[b++],aP&&!nee(h,f,p)||(s[p]=f[p]);return s}:ku,hee=Un,pee=YD,mee=me,fee=$i,gee=qe,$w=function(e,t,s){mee?fee.f(e,t,gee(0,s)):e[t]=s},_ee=Ic,vee=be,Eee=fo,yee=function(e,t,s,a){try{return a?t(hee(s)[0],s[1]):t(s)}catch(c){pee(e,"throw",c)}},xee=zD,bee=S_,wee=Dc,cP=$w,See=qb,Cee=p_,lP=Array,td=C,Xw=2147483647,Tee=/[^\0-\u007E]/,dP=/[.\u3002\uFF0E\uFF61]/g,uP="Overflow: input needs wider integers to process",hP=RangeError,Nee=td(dP.exec),Lu=Math.floor,Jw=String.fromCharCode,pP=td("".charCodeAt),mP=td([].join),Fc=td([].push),Ree=td("".replace),Aee=td("".split),Iee=td("".toLowerCase),fP=function(e){return e+22+75*(e<26)},Dee=function(e,t,s){var a=0;for(e=s?Lu(e/700):e>>1,e+=Lu(e/t);e>455;)e=Lu(e/35),a+=36;return Lu(a+36*e/(e+38))},Oee=function(e){var t=[];e=function(K){for(var Y=[],X=0,re=K.length;X<re;){var te=pP(K,X++);if(te>=55296&&te<=56319&&X<re){var Z=pP(K,X++);(64512&Z)==56320?Fc(Y,((1023&te)<<10)+(1023&Z)+65536):(Fc(Y,te),X--)}else Fc(Y,te)}return Y}(e);var s,a,c=e.length,d=128,h=0,p=72;for(s=0;s<e.length;s++)(a=e[s])<128&&Fc(t,Jw(a));var f=t.length,_=f;for(f&&Fc(t,"-");_<c;){var v=Xw;for(s=0;s<e.length;s++)(a=e[s])>=d&&a<v&&(v=a);var b=_+1;if(v-d>Lu((Xw-h)/b))throw new hP(uP);for(h+=(v-d)*b,d=v,s=0;s<e.length;s++){if((a=e[s])<d&&++h>Xw)throw new hP(uP);if(a===d){for(var w=h,T=36;;){var U=T<=p?1:T>=p+26?26:T-p;if(w<U)break;var k=w-U,F=36-U;Fc(t,Jw(fP(U+k%F))),w=Lu(k/F),T+=36}Fc(t,Jw(fP(w))),p=Dee(h,b,_===f),h=0,_++}}h++,d++}return mP(t,"")},jee=Zt,Qw=me,Pee=O_,Zw=G,gP=Ic,ea=C,F_=jc,ta=w_,kee=nw,eS=Gr,tS=uee,Mu=function(e){var t=Eee(e),s=bee(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=_ee(c,a>2?arguments[2]:void 0));var h,p,f,_,v,b,w=Cee(t),T=0;if(!w||this===lP&&xee(w))for(h=wee(t),p=s?new this(h):lP(h);h>T;T++)b=d?c(t[T],T):t[T],cP(p,T,b);else for(p=s?new this:[],v=(_=See(t,w)).next;!(f=vee(v,_)).done;T++)b=d?yee(_,c,[f.value,T],!0):f.value,cP(p,T,b);return p.length=T,p},ja=Pc,Lee=kw.codeAt,Mee=function(e){var t,s,a=[],c=Aee(Ree(Iee(e),dP,"."),".");for(t=0;t<c.length;t++)s=c[t],Fc(a,Nee(Tee,s)?"xn--"+Oee(s):s);return mP(a,".")},Zo=ni,Fee=Qo,Uee=Ql,_P=tee,vP=Jl,Vee=vP.set,U_=vP.getterFor("URL"),Bee=_P.URLSearchParams,Wee=_P.getState,fm=Zw.URL,sS=Zw.TypeError,V_=Zw.parseInt,Gee=Math.floor,EP=Math.pow,sa=ea("".charAt),Pa=ea(/./.exec),gm=ea([].join),Hee=ea(1 .toString),zee=ea([].pop),Fu=ea([].push),rS=ea("".replace),Kee=ea([].shift),qee=ea("".split),_m=ea("".slice),B_=ea("".toLowerCase),Yee=ea([].unshift),nS="Invalid scheme",vm="Invalid host",yP="Invalid port",xP=/[a-z]/i,$ee=/[\d+-.a-z]/i,iS=/\d/,Xee=/^0x/i,Jee=/^[0-7]+$/,Qee=/^\d+$/,bP=/^[\da-f]+$/i,Zee=/[\0\t\n\r #%/:<>?@[\\\]^|]/,ete=/[\0\t\n\r #/:<>?@[\\\]^|]/,tte=/^[\u0000-\u0020]+/,ste=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,rte=/[\t\n\r]/g,Em=function(e){var t,s,a,c;if(typeof e=="number"){for(t=[],s=0;s<4;s++)Yee(t,e%256),e=Gee(e/256);return gm(t,".")}if(typeof e=="object"){for(t="",a=function(d){for(var h=null,p=1,f=null,_=0,v=0;v<8;v++)d[v]!==0?(_>p&&(h=f,p=_),f=null,_=0):(f===null&&(f=v),++_);return _>p?f:h}(e),s=0;s<8;s++)c&&e[s]===0||(c&&(c=!1),a===s?(t+=s?":":"::",c=!0):(t+=Hee(e[s],16),s<7&&(t+=":")));return"["+t+"]"}return e},W_={},wP=tS({},W_,{" ":1,'"':1,"<":1,">":1,"`":1}),SP=tS({},wP,{"#":1,"?":1,"{":1,"}":1}),aS=tS({},SP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Uc=function(e,t){var s=Lee(e,0);return s>32&&s<127&&!eS(t,e)?e:encodeURIComponent(e)},G_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ym=function(e,t){var s;return e.length===2&&Pa(xP,sa(e,0))&&((s=sa(e,1))===":"||!t&&s==="|")},CP=function(e){var t;return e.length>1&&ym(_m(e,0,2))&&(e.length===2||(t=sa(e,2))==="/"||t==="\\"||t==="?"||t==="#")},nte=function(e){return e==="."||B_(e)==="%2e"},oS={},TP={},cS={},NP={},RP={},lS={},AP={},IP={},H_={},z_={},dS={},uS={},hS={},pS={},DP={},mS={},Uu={},vo={},OP={},sd={},ec={},fS=function(e,t,s){var a,c,d,h=Zo(e);if(t){if(c=this.parse(h))throw new sS(c);this.searchParams=null}else{if(s!==void 0&&(a=new fS(s,!0)),c=this.parse(h,null,a))throw new sS(c);(d=Wee(new Bee)).bindURL(this),this.searchParams=d}};fS.prototype={type:"URL",parse:function(e,t,s){var a,c,d,h,p,f=this,_=t||oS,v=0,b="",w=!1,T=!1,U=!1;for(e=Zo(e),t||(f.scheme="",f.username="",f.password="",f.host=null,f.port=null,f.path=[],f.query=null,f.fragment=null,f.cannotBeABaseURL=!1,e=rS(e,tte,""),e=rS(e,ste,"$1")),e=rS(e,rte,""),a=Mu(e);v<=a.length;){switch(c=a[v],_){case oS:if(!c||!Pa(xP,c)){if(t)return nS;_=cS;continue}b+=B_(c),_=TP;break;case TP:if(c&&(Pa($ee,c)||c==="+"||c==="-"||c==="."))b+=B_(c);else{if(c!==":"){if(t)return nS;b="",_=cS,v=0;continue}if(t&&(f.isSpecial()!==eS(G_,b)||b==="file"&&(f.includesCredentials()||f.port!==null)||f.scheme==="file"&&!f.host))return;if(f.scheme=b,t)return void(f.isSpecial()&&G_[f.scheme]===f.port&&(f.port=null));b="",f.scheme==="file"?_=pS:f.isSpecial()&&s&&s.scheme===f.scheme?_=NP:f.isSpecial()?_=IP:a[v+1]==="/"?(_=RP,v++):(f.cannotBeABaseURL=!0,Fu(f.path,""),_=OP)}break;case cS:if(!s||s.cannotBeABaseURL&&c!=="#")return nS;if(s.cannotBeABaseURL&&c==="#"){f.scheme=s.scheme,f.path=ja(s.path),f.query=s.query,f.fragment="",f.cannotBeABaseURL=!0,_=ec;break}_=s.scheme==="file"?pS:lS;continue;case NP:if(c!=="/"||a[v+1]!=="/"){_=lS;continue}_=H_,v++;break;case RP:if(c==="/"){_=z_;break}_=vo;continue;case lS:if(f.scheme=s.scheme,c===Zi)f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,f.path=ja(s.path),f.query=s.query;else if(c==="/"||c==="\\"&&f.isSpecial())_=AP;else if(c==="?")f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,f.path=ja(s.path),f.query="",_=sd;else{if(c!=="#"){f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,f.path=ja(s.path),f.path.length--,_=vo;continue}f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,f.path=ja(s.path),f.query=s.query,f.fragment="",_=ec}break;case AP:if(!f.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,_=vo;continue}_=z_}else _=H_;break;case IP:if(_=H_,c!=="/"||sa(b,v+1)!=="/")continue;v++;break;case H_:if(c!=="/"&&c!=="\\"){_=z_;continue}break;case z_:if(c==="@"){w&&(b="%40"+b),w=!0,d=Mu(b);for(var k=0;k<d.length;k++){var F=d[k];if(F!==":"||U){var K=Uc(F,aS);U?f.password+=K:f.username+=K}else U=!0}b=""}else if(c===Zi||c==="/"||c==="?"||c==="#"||c==="\\"&&f.isSpecial()){if(w&&b==="")return"Invalid authority";v-=Mu(b).length+1,b="",_=dS}else b+=c;break;case dS:case uS:if(t&&f.scheme==="file"){_=mS;continue}if(c!==":"||T){if(c===Zi||c==="/"||c==="?"||c==="#"||c==="\\"&&f.isSpecial()){if(f.isSpecial()&&b==="")return vm;if(t&&b===""&&(f.includesCredentials()||f.port!==null))return;if(h=f.parseHost(b))return h;if(b="",_=Uu,t)return;continue}c==="["?T=!0:c==="]"&&(T=!1),b+=c}else{if(b==="")return vm;if(h=f.parseHost(b))return h;if(b="",_=hS,t===uS)return}break;case hS:if(!Pa(iS,c)){if(c===Zi||c==="/"||c==="?"||c==="#"||c==="\\"&&f.isSpecial()||t){if(b!==""){var Y=V_(b,10);if(Y>65535)return yP;f.port=f.isSpecial()&&Y===G_[f.scheme]?null:Y,b=""}if(t)return;_=Uu;continue}return yP}b+=c;break;case pS:if(f.scheme="file",c==="/"||c==="\\")_=DP;else{if(!s||s.scheme!=="file"){_=vo;continue}switch(c){case Zi:f.host=s.host,f.path=ja(s.path),f.query=s.query;break;case"?":f.host=s.host,f.path=ja(s.path),f.query="",_=sd;break;case"#":f.host=s.host,f.path=ja(s.path),f.query=s.query,f.fragment="",_=ec;break;default:CP(gm(ja(a,v),""))||(f.host=s.host,f.path=ja(s.path),f.shortenPath()),_=vo;continue}}break;case DP:if(c==="/"||c==="\\"){_=mS;break}s&&s.scheme==="file"&&!CP(gm(ja(a,v),""))&&(ym(s.path[0],!0)?Fu(f.path,s.path[0]):f.host=s.host),_=vo;continue;case mS:if(c===Zi||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&ym(b))_=vo;else if(b===""){if(f.host="",t)return;_=Uu}else{if(h=f.parseHost(b))return h;if(f.host==="localhost"&&(f.host=""),t)return;b="",_=Uu}continue}b+=c;break;case Uu:if(f.isSpecial()){if(_=vo,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==Zi&&(_=vo,c!=="/"))continue}else f.fragment="",_=ec;else f.query="",_=sd;break;case vo:if(c===Zi||c==="/"||c==="\\"&&f.isSpecial()||!t&&(c==="?"||c==="#")){if((p=B_(p=b))===".."||p==="%2e."||p===".%2e"||p==="%2e%2e"?(f.shortenPath(),c==="/"||c==="\\"&&f.isSpecial()||Fu(f.path,"")):nte(b)?c==="/"||c==="\\"&&f.isSpecial()||Fu(f.path,""):(f.scheme==="file"&&!f.path.length&&ym(b)&&(f.host&&(f.host=""),b=sa(b,0)+":"),Fu(f.path,b)),b="",f.scheme==="file"&&(c===Zi||c==="?"||c==="#"))for(;f.path.length>1&&f.path[0]==="";)Kee(f.path);c==="?"?(f.query="",_=sd):c==="#"&&(f.fragment="",_=ec)}else b+=Uc(c,SP);break;case OP:c==="?"?(f.query="",_=sd):c==="#"?(f.fragment="",_=ec):c!==Zi&&(f.path[0]+=Uc(c,W_));break;case sd:t||c!=="#"?c!==Zi&&(c==="'"&&f.isSpecial()?f.query+="%27":f.query+=c==="#"?"%23":Uc(c,W_)):(f.fragment="",_=ec);break;case ec:c!==Zi&&(f.fragment+=Uc(c,wP))}v++}},parseHost:function(e){var t,s,a;if(sa(e,0)==="["){if(sa(e,e.length-1)!=="]"||(t=function(c){var d,h,p,f,_,v,b,w=[0,0,0,0,0,0,0,0],T=0,U=null,k=0,F=function(){return sa(c,k)};if(F()===":"){if(sa(c,1)!==":")return;k+=2,U=++T}for(;F();){if(T===8)return;if(F()!==":"){for(d=h=0;h<4&&Pa(bP,F());)d=16*d+V_(F(),16),k++,h++;if(F()==="."){if(h===0||(k-=h,T>6))return;for(p=0;F();){if(f=null,p>0){if(!(F()==="."&&p<4))return;k++}if(!Pa(iS,F()))return;for(;Pa(iS,F());){if(_=V_(F(),10),f===null)f=_;else{if(f===0)return;f=10*f+_}if(f>255)return;k++}w[T]=256*w[T]+f,++p!=2&&p!==4||T++}if(p!==4)return;break}if(F()===":"){if(k++,!F())return}else if(F())return;w[T++]=d}else{if(U!==null)return;k++,U=++T}}if(U!==null)for(v=T-U,T=7;T!==0&&v>0;)b=w[T],w[T--]=w[U+v-1],w[U+--v]=b;else if(T!==8)return;return w}(_m(e,1,-1)),!t))return vm;this.host=t}else if(this.isSpecial()){if(e=Mee(e),Pa(Zee,e)||(t=function(c){var d,h,p,f,_,v,b,w=qee(c,".");if(w.length&&w[w.length-1]===""&&w.length--,(d=w.length)>4)return c;for(h=[],p=0;p<d;p++){if((f=w[p])==="")return c;if(_=10,f.length>1&&sa(f,0)==="0"&&(_=Pa(Xee,f)?16:8,f=_m(f,_===8?1:2)),f==="")v=0;else{if(!Pa(_===10?Qee:_===8?Jee:bP,f))return c;v=V_(f,_)}Fu(h,v)}for(p=0;p<d;p++)if(v=h[p],p===d-1){if(v>=EP(256,5-d))return null}else if(v>255)return null;for(b=zee(h),p=0;p<h.length;p++)b+=h[p]*EP(256,3-p);return b}(e),t===null))return vm;this.host=t}else{if(Pa(ete,e))return vm;for(t="",s=Mu(e),a=0;a<s.length;a++)t+=Uc(s[a],W_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return eS(G_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&ym(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,s=e.username,a=e.password,c=e.host,d=e.port,h=e.path,p=e.query,f=e.fragment,_=t+":";return c!==null?(_+="//",e.includesCredentials()&&(_+=s+(a?":"+a:"")+"@"),_+=Em(c),d!==null&&(_+=":"+d)):t==="file"&&(_+="//"),_+=e.cannotBeABaseURL?h[0]:h.length?"/"+gm(h,"/"):"",p!==null&&(_+="?"+p),f!==null&&(_+="#"+f),_},setHref:function(e){var t=this.parse(e);if(t)throw new sS(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Vu(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Em(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Zo(e)+":",oS)},getUsername:function(){return this.username},setUsername:function(e){var t=Mu(Zo(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<t.length;s++)this.username+=Uc(t[s],aS)}},getPassword:function(){return this.password},setPassword:function(e){var t=Mu(Zo(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<t.length;s++)this.password+=Uc(t[s],aS)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Em(e):Em(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,dS)},getHostname:function(){var e=this.host;return e===null?"":Em(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,uS)},getPort:function(){var e=this.port;return e===null?"":Zo(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Zo(e))===""?this.port=null:this.parse(e,hS))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+gm(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Uu))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Zo(e))===""?this.query=null:(sa(e,0)==="?"&&(e=_m(e,1)),this.query="",this.parse(e,sd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Zo(e))!==""?(sa(e,0)==="#"&&(e=_m(e,1)),this.fragment="",this.parse(e,ec)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Vu=function(e){var t=kee(this,Wn),s=Uee(arguments.length,1)>1?arguments[1]:void 0,a=Vee(t,new fS(e,!1,s));Qw||(t.href=a.serialize(),t.origin=a.getOrigin(),t.protocol=a.getProtocol(),t.username=a.getUsername(),t.password=a.getPassword(),t.host=a.getHost(),t.hostname=a.getHostname(),t.port=a.getPort(),t.pathname=a.getPathname(),t.search=a.getSearch(),t.searchParams=a.getSearchParams(),t.hash=a.getHash())},Wn=Vu.prototype,ra=function(e,t){return{get:function(){return U_(this)[e]()},set:t&&function(s){return U_(this)[t](s)},configurable:!0,enumerable:!0}};if(Qw&&(ta(Wn,"href",ra("serialize","setHref")),ta(Wn,"origin",ra("getOrigin")),ta(Wn,"protocol",ra("getProtocol","setProtocol")),ta(Wn,"username",ra("getUsername","setUsername")),ta(Wn,"password",ra("getPassword","setPassword")),ta(Wn,"host",ra("getHost","setHost")),ta(Wn,"hostname",ra("getHostname","setHostname")),ta(Wn,"port",ra("getPort","setPort")),ta(Wn,"pathname",ra("getPathname","setPathname")),ta(Wn,"search",ra("getSearch","setSearch")),ta(Wn,"searchParams",ra("getSearchParams")),ta(Wn,"hash",ra("getHash","setHash"))),F_(Wn,"toJSON",function(){return U_(this).serialize()},{enumerable:!0}),F_(Wn,"toString",function(){return U_(this).serialize()},{enumerable:!0}),fm){var jP=fm.createObjectURL,PP=fm.revokeObjectURL;jP&&F_(Vu,"createObjectURL",gP(jP,fm)),PP&&F_(Vu,"revokeObjectURL",gP(PP,fm))}Fee(Vu,"URL"),jee({global:!0,forced:!Pee,sham:!Qw},{URL:Vu});var ite=Zt,kP=m,ate=Ql,LP=ni,ote=O_,gS=ir("URL"),cte=ote&&kP(function(){gS.canParse()}),lte=kP(function(){return gS.canParse.length!==1});ite({target:"URL",stat:!0,forced:!cte||lte},{canParse:function(e){var t=ate(arguments.length,1),s=LP(e),a=t<2||arguments[1]===void 0?void 0:LP(arguments[1]);try{return!!new gS(s,a)}catch{return!1}}});var dte=Zt,ute=Ql,MP=ni,hte=O_,pte=ir("URL");dte({target:"URL",stat:!0,forced:!hte},{parse:function(e){var t=ute(arguments.length,1),s=MP(e),a=t<2||arguments[1]===void 0?void 0:MP(arguments[1]);try{return new pte(s,a)}catch{return null}}});var K_=u(Os.URL);let FP=!0,UP=!0;function q_(e,t,s){let a=e.match(t);return a&&a.length>=s&&parseInt(a[s],10)}function rd(e,t,s){if(!e.RTCPeerConnection)return;let a=e.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,p){if(h!==t)return c.apply(this,arguments);let f=_=>{let v=s(_);v&&(p.handleEvent?p.handleEvent(v):p(v))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(p,f),c.apply(this,[h,f])};let d=a.removeEventListener;a.removeEventListener=function(h,p){if(h!==t||!this._eventMap||!this._eventMap[t])return d.apply(this,arguments);if(!this._eventMap[t].has(p))return d.apply(this,arguments);let f=this._eventMap[t].get(p);return this._eventMap[t].delete(p),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,f])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function mte(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(FP=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function fte(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(UP=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function VP(){if(typeof window=="object"){if(FP)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _S(e,t){UP&&console.warn(e+" is deprecated, please use "+t+" instead.")}function BP(e){return Object.prototype.toString.call(e)==="[object Object]"}function WP(e){var t;return BP(e)?Ji(t=Object.keys(e)).call(t,function(s,a){let c=BP(e[a]),d=c?WP(e[a]):e[a],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})},{}):e}function vS(e,t,s){t&&!s.has(t.id)&&(s.set(t.id,t),Object.keys(t).forEach(a=>{a.endsWith("Id")?vS(e,e.get(t[a]),s):a.endsWith("Ids")&&t[a].forEach(c=>{vS(e,e.get(c),s)})}))}function GP(e,t,s){let a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;let d=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&d.push(h)}),d.forEach(h=>{e.forEach(p=>{p.type===a&&p.trackId===h.id&&vS(e,p,c)})}),c}let HP=VP;function zP(e,t){let s=e&&e.navigator;if(!s.mediaDevices)return;let a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;let p={};return Object.keys(h).forEach(f=>{if(f==="require"||f==="advanced"||f==="mediaSource")return;let _=typeof h[f]=="object"?h[f]:{ideal:h[f]};_.exact!==void 0&&typeof _.exact=="number"&&(_.min=_.max=_.exact);let v=function(b,w){return b?b+w.charAt(0).toUpperCase()+w.slice(1):w==="deviceId"?"sourceId":w};if(_.ideal!==void 0){p.optional=p.optional||[];let b={};typeof _.ideal=="number"?(b[v("min",f)]=_.ideal,p.optional.push(b),b={},b[v("max",f)]=_.ideal,p.optional.push(b)):(b[v("",f)]=_.ideal,p.optional.push(b))}_.exact!==void 0&&typeof _.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[v("",f)]=_.exact):["min","max"].forEach(b=>{_[b]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[v(b,f)]=_[b])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},c=function(h,p){if(t.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){let f=function(_,v,b){v in _&&!(b in _)&&(_[b]=_[v],delete _[v])};f((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),f(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let f=h.video.facingMode;f=f&&(typeof f=="object"?f:{ideal:f});let _=t.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||_)){let v;if(delete h.video.facingMode,f.exact==="environment"||f.ideal==="environment"?v=["back","rear"]:f.exact!=="user"&&f.ideal!=="user"||(v=["front"]),v)return s.mediaDevices.enumerateDevices().then(b=>{b=b.filter(T=>T.kind==="videoinput");let w=b.find(T=>v.some(U=>{var k;return ke(k=T.label.toLowerCase()).call(k,U)}));return!w&&b.length&&ke(v).call(v,"back")&&(w=b[b.length-1]),w&&(h.video.deviceId=f.exact?{exact:w.deviceId}:{ideal:w.deviceId}),h.video=a(h.video),HP("chrome: "+JSON.stringify(h)),p(h)})}h.video=a(h.video)}return HP("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,p,f){c(h,_=>{s.webkitGetUserMedia(_,p,v=>{f&&f(d(v))})})}).bind(s),s.mediaDevices.getUserMedia){let h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(p){return c(p,f=>h(f).then(_=>{if(f.audio&&!_.getAudioTracks().length||f.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return _},_=>Be.reject(d(_))))}}}function KP(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function qP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};let d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(a=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};let d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else rd(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function YP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,p){let f=c.apply(this,arguments);return f||(f=t(this,h),this._senders.push(f)),f};let d=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);let p=this._senders.indexOf(h);p!==-1&&this._senders.splice(p,1)}}let s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(t(this,d))})};let a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(d=>{let h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let s=t.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function $P(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof s!="function"))return t.apply(this,[]);let d=function(p){let f={};return p.result().forEach(_=>{let v={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(b=>{v[b]=_.stat(b)}),f[v.id]=v}),f},h=function(p){return new Map(Object.keys(p).map(f=>[f,p[f]]))};if(arguments.length>=2){let p=function(f){a(h(d(f)))};return t.apply(this,[p,s])}return new Be((p,f)=>{t.apply(this,[function(_){p(h(d(_)))},f])}).then(a,c)}}function XP(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){let c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c});let a=e.RTCPeerConnection.prototype.addTrack;a&&(e.RTCPeerConnection.prototype.addTrack=function(){let c=a.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){let c=this;return this._pc.getStats().then(d=>GP(d,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){let a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a}),rd(e,"track",a=>(a.receiver._pc=a.srcElement,a)),e.RTCRtpReceiver.prototype.getStats=function(){let a=this;return this._pc.getStats().then(c=>GP(c,a.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let s=arguments[0],a,c,d;return this.getSenders().forEach(h=>{h.track===s&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?d=!0:c=h),h.track===s)),d||a&&c?Be.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():Be.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function JP(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let p=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(p)===-1&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};let s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(f=>{if(this.getSenders().find(_=>_.track===f))throw new DOMException("Track already exists.","InvalidAccessError")});let h=this.getSenders();s.apply(this,arguments);let p=this.getSenders().filter(f=>h.indexOf(f)===-1);this._shimmedLocalStreams[d.id]=[d].concat(p)};let a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};let c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{let p=this._shimmedLocalStreams[h].indexOf(d);p!==-1&&this._shimmedLocalStreams[h].splice(p,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function QP(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return JP(e);let s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let f=s.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(_=>this._reverseStreams[_.id])};let a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(_=>{if(this.getSenders().find(v=>v.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){let _=new e.MediaStream(f.getTracks());this._streams[f.id]=_,this._reverseStreams[_.id]=f,f=_}a.apply(this,[f])};let c=e.RTCPeerConnection.prototype.removeStream;function d(f,_){let v=_.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{let w=f._reverseStreams[b],T=f._streams[w.id];v=v.replace(new RegExp(T.id,"g"),w.id)}),new RTCSessionDescription({type:_.type,sdp:v})}e.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},e.RTCPeerConnection.prototype.addTrack=function(f,_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(w=>w===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let b=this._streams[_.id];if(b)b.addTrack(f),Be.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let w=new e.MediaStream([f]);this._streams[_.id]=w,this._reverseStreams[w.id]=_,this.addStream(w)}return this.getSenders().find(w=>w.track===f)},["createOffer","createAnswer"].forEach(function(f){let _=e.RTCPeerConnection.prototype[f],v={[f](){let b=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[w=>{let T=d(this,w);b[0].apply(null,[T])},w=>{b[1]&&b[1].apply(null,w)},arguments[2]]):_.apply(this,arguments).then(w=>d(this,w))}};e.RTCPeerConnection.prototype[f]=v[f]});let h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(f,_){let v=_.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{let w=f._reverseStreams[b],T=f._streams[w.id];v=v.replace(new RegExp(w.id,"g"),T.id)}),new RTCSessionDescription({type:_.type,sdp:v})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};let p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let f=p.get.apply(this);return f.type===""?f:d(this,f)}}),e.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(f._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(b=>f.track===b)&&(_=this._streams[v])}),_&&(_.getTracks().length===1?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ES(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){let a=e.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=c[s]})}function ZP(e,t){rd(e,"negotiationneeded",s=>{let a=s.target;if(!(t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var ek=Object.freeze({__proto__:null,fixNegotiationNeeded:ZP,shimAddTrackRemoveTrack:QP,shimAddTrackRemoveTrackWithNative:JP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(s){return t(s).then(a=>{let c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),e.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:YP,shimGetStats:$P,shimGetUserMedia:zP,shimMediaStream:KP,shimOnTrack:qP,shimPeerConnection:ES,shimSenderReceiverGetStats:XP});function tk(e,t){let s=e&&e.navigator,a=e&&e.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){_S("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(t.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){let c=function(h,p,f){p in h&&!(f in h)&&(h[f]=h[p],delete h[p])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){let h=a.prototype.getSettings;a.prototype.getSettings=function(){let p=h.apply(this,arguments);return c(p,"mozAutoGainControl","autoGainControl"),c(p,"mozNoiseSuppression","noiseSuppression"),p}}if(a&&a.prototype.applyConstraints){let h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),c(p,"autoGainControl","mozAutoGainControl"),c(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function sk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yS(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){let d=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});let s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[c,d,h]=arguments;return a.apply(this,[c||null]).then(p=>{if(t.version<53&&!d)try{p.forEach(f=>{f.type=s[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;p.forEach((_,v)=>{p.set(v,Object.assign({},_,{type:s[_.type]||_.type}))})}return p}).then(d,h)}}function rk(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let a=t.apply(this,[]);return a.forEach(c=>c._pc=this),a});let s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){let a=s.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Be.resolve(new Map)}}function nk(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let s=t.apply(this,[]);return s.forEach(a=>a._pc=this),s}),rd(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ik(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){_S("removeStream","removeTrack"),this.getSenders().forEach(s=>{var a;s.track&&ke(a=t.getTracks()).call(a,s.track)&&this.removeTrack(s)})})}function ak(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ok(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];let a=s.length>0;a&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let c=t.apply(this,arguments);if(a){let{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function ck(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let s=t.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function lk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Be.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function dk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Be.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var uk=Object.freeze({__proto__:null,shimAddTransceiver:ok,shimCreateAnswer:dk,shimCreateOffer:lk,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){let a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Be.reject(a)}return s.video===!0?s.video={mediaSource:t}:s.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:ck,shimGetUserMedia:tk,shimOnTrack:sk,shimPeerConnection:yS,shimRTCDataChannel:ak,shimReceiverGetStats:nk,shimRemoveStream:ik,shimSenderGetStats:rk});function hk(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),ke(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>t.call(this,c,s)),s.getVideoTracks().forEach(c=>t.call(this,c,s))},e.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var p;this._localStreams?ke(p=this._localStreams).call(p,h)||this._localStreams.push(h):this._localStreams=[h]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let s=this._localStreams.indexOf(t);if(s===-1)return;this._localStreams.splice(s,1);let a=t.getTracks();this.getSenders().forEach(c=>{ke(a).call(a,c.track)&&this.removeTrack(c)})})}}function pk(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),ke(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);let h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);let d=new Event("addstream");d.stream=c,s.dispatchEvent(d)})}),t.apply(s,arguments)}}}function mk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,s=t.createOffer,a=t.createAnswer,c=t.setLocalDescription,d=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(f,_){let v=arguments.length>=2?arguments[2]:arguments[0],b=s.apply(this,[v]);return _?(b.then(f,_),Be.resolve()):b},t.createAnswer=function(f,_){let v=arguments.length>=2?arguments[2]:arguments[0],b=a.apply(this,[v]);return _?(b.then(f,_),Be.resolve()):b};let p=function(f,_,v){let b=c.apply(this,[f]);return v?(b.then(_,v),Be.resolve()):b};t.setLocalDescription=p,p=function(f,_,v){let b=d.apply(this,[f]);return v?(b.then(_,v),Be.resolve()):b},t.setRemoteDescription=p,p=function(f,_,v){let b=h.apply(this,[f]);return v?(b.then(_,v),Be.resolve()):b},t.addIceCandidate=p}function fk(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let s=t.mediaDevices,a=s.getUserMedia.bind(s);t.mediaDevices.getUserMedia=c=>a(gk(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(s,a,c){t.mediaDevices.getUserMedia(s).then(a,c)}).bind(t))}function gk(e){return e&&e.video!==void 0?Object.assign({},e,{video:WP(e.video)}):e}function _k(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(s,a){if(s&&s.iceServers){let c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(_S("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new t(s,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function vk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ek(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);let a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);let c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function yk(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var xk=Object.freeze({__proto__:null,shimAudioContext:yk,shimCallbacksAPI:mk,shimConstraints:gk,shimCreateOfferLegacy:Ek,shimGetUserMedia:fk,shimLocalStreamsAPI:hk,shimRTCIceServerUrls:_k,shimRemoteStreamsAPI:pk,shimTrackEventTransceiver:vk}),bk=`	
\v\f\r \u2028\u2029\uFEFF`,gte=xt,_te=ni,xS=bk,wk=C("".replace),vte=RegExp("^["+xS+"]+"),Ete=RegExp("(^|[^"+xS+"])["+xS+"]+$"),yte=function(e){return function(t){var s=_te(gte(t));return s=wk(s,vte,""),s=wk(s,Ete,"$1"),s}},xte={trim:yte()},bte=aO.PROPER,wte=m,Sk=bk,Ste=xte.trim;Zt({target:"String",proto:!0,forced:function(e){return wte(function(){return!!Sk[e]()||""[e]()!==""||bte&&Sk[e].name!==e})}("trim")},{trim:function(){return Ste(this)}});var Cte=Xi("String","trim"),Tte=R,Nte=Cte,bS=String.prototype,Rte=function(e){var t=e.trim;return typeof e=="string"||e===bS||Tte(bS,e)&&t===bS.trim?Nte:t},Jr=u(Rte),Ck={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(s){return s.trim().split(`
`).map(a=>a.trim())},t.splitSections=function(s){return s.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},t.getDescription=function(s){let a=t.splitSections(s);return a&&a[0]},t.getMediaSections=function(s){let a=t.splitSections(s);return a.shift(),a},t.matchPrefix=function(s,a){return t.splitLines(s).filter(c=>c.indexOf(a)===0)},t.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");let c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},t.writeCandidate=function(s){let a=[];a.push(s.foundation);let c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);let d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(s){return s.substring(14).split(" ")},t.parseRtpMap=function(s){let a=s.substring(9).split(" "),c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);let c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(s){let a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},t.parseFmtp=function(s){let a={},c,d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},t.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){let d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},t.parseRtcpFb=function(s){let a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},t.parseSsrcMedia=function(s){let a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},d=s.indexOf(":",a);return d>-1?(c.attribute=s.substring(a+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(a+1),c},t.parseSsrcGroup=function(s){let a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},t.getMid=function(s){let a=t.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(s){let a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:t.matchPrefix(s+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},t.parseCryptoLine=function(s){let a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?t.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;let a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},t.getCryptoParameters=function(s,a){return t.matchPrefix(s+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(s,a){let c=t.matchPrefix(s+a,"a=ice-ufrag:")[0],d=t.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},t.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(s){let a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){let p=c[h],f=t.matchPrefix(s,"a=rtpmap:"+p+" ")[0];if(f){let _=t.parseRtpMap(f),v=t.matchPrefix(s,"a=fmtp:"+p+" ");switch(_.parameters=v.length?t.parseFmtp(v[0]):{},_.rtcpFeedback=t.matchPrefix(s,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),a.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(_.name.toUpperCase())}}}t.matchPrefix(s,"a=extmap:").forEach(h=>{a.headerExtensions.push(t.parseExtmap(h))});let d=t.matchPrefix(s,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(f=>f.type===p.type&&f.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),a},t.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=t.writeRtpMap(h),c+=t.writeFmtp(h),c+=t.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=t.writeExtmap(h)}),c},t.parseRtpEncodingParameters=function(s){let a=[],c=t.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,p=t.matchPrefix(s,"a=ssrc:").map(w=>t.parseSsrcMedia(w)).filter(w=>w.attribute==="cname"),f=p.length>0&&p[0].ssrc,_,v=t.matchPrefix(s,"a=ssrc-group:FID").map(w=>w.substring(17).split(" ").map(T=>parseInt(T,10)));v.length>0&&v[0].length>1&&v[0][0]===f&&(_=v[0][1]),c.codecs.forEach(w=>{if(w.name.toUpperCase()==="RTX"&&w.parameters.apt){let T={ssrc:f,codecPayloadType:parseInt(w.parameters.apt,10)};f&&_&&(T.rtx={ssrc:_}),a.push(T),d&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:f,mechanism:h?"red+ulpfec":"red"},a.push(T))}}),a.length===0&&f&&a.push({ssrc:f});let b=t.matchPrefix(s,"b=");return b.length&&(b=b[0].indexOf("b=TIAS:")===0?parseInt(b[0].substring(7),10):b[0].indexOf("b=AS:")===0?1e3*parseInt(b[0].substring(5),10)*.95-16e3:void 0,a.forEach(w=>{w.maxBitrate=b})),a},t.parseRtcpParameters=function(s){let a={},c=t.matchPrefix(s,"a=ssrc:").map(p=>t.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);let d=t.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;let h=t.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},t.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},t.parseMsid=function(s){let a,c=t.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};let d=t.matchPrefix(s,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},t.parseSctpDescription=function(s){let a=t.parseMLine(s),c=t.matchPrefix(s,"a=max-message-size:"),d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);let h=t.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};let p=t.matchPrefix(s,"a=sctpmap:");if(p.length>0){let f=p[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:d}}},t.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(s,a,c){let d,h=a!==void 0?a:2;return d=s||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(s,a){let c=t.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(s){return t.splitLines(s)[0].split(" ")[0].substring(2)},t.isRejected=function(s){return s.split(" ",2)[1]==="0"},t.parseMLine=function(s){let a=t.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},t.parseOLine=function(s){let a=t.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},t.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;let a=t.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(Ck);var Tk=Ck.exports,Bu=u(Tk),Ate=o({__proto__:null,default:Bu},[Tk]);function Y_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){let a=new t(s),c=Bu.parseCandidate(s.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new t(s)},e.RTCIceCandidate.prototype=t.prototype,rd(e,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new e.RTCIceCandidate(s.candidate),writable:"false"}),s))}function wS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||rd(e,"icecandidate",t=>{if(t.candidate){let s=Bu.parseCandidate(t.candidate.candidate);s.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return t})}function $_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let s=function(p){if(!p||!p.sdp)return!1;let f=Bu.splitSections(p.sdp);return f.shift(),f.some(_=>{let v=Bu.parseMLine(_);return v&&v.kind==="application"&&v.protocol.indexOf("SCTP")!==-1})},a=function(p){let f=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;let _=parseInt(f[1],10);return _!=_?-1:_},c=function(p){let f=65536;return t.browser==="firefox"&&(f=t.version<57?p===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),f},d=function(p,f){let _=65536;t.browser==="firefox"&&t.version===57&&(_=65535);let v=Bu.matchPrefix(p.sdp,"a=max-message-size:");return v.length>0?_=parseInt(v[0].substr(19),10):t.browser==="firefox"&&f!==-1&&(_=2147483637),_},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){let p=a(arguments[0]),f=c(p),_=d(arguments[0],p),v;v=f===0&&_===0?Number.POSITIVE_INFINITY:f===0||_===0?Math.max(f,_):Math.min(f,_);let b={};Object.defineProperty(b,"maxMessageSize",{get:()=>v}),this._sctp=b}return h.apply(this,arguments)}}function X_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(a,c){let d=a.send;a.send=function(){let h=arguments[0],p=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&p>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}let s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let a=s.apply(this,arguments);return t(a,this),a},rd(e,"datachannel",a=>(t(a.channel,a.target),a))}function SS(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{let a=t[s];t[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{let d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;let h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function CS(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let c=a.sdp.split(`
`).filter(d=>Jr(d).call(d)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&a instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function J_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let s=e.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Be.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Be.resolve())})}function Q_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let s=e.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var Ite=Object.freeze({__proto__:null,removeExtmapAllowMixed:CS,shimAddIceCandidateNullOrEmpty:J_,shimConnectionState:SS,shimMaxMessageSize:$_,shimParameterlessSetLocalDescription:Q_,shimRTCIceCandidate:Y_,shimRTCIceCandidateRelayProtocol:wS,shimSendThrowTypeError:X_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},s=VP,a=function(d){let h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;let{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=q_(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=q_(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=q_(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:a,commonShim:Ite,extractVersion:q_,disableLog:mte,disableWarnings:fte,sdp:Ate};switch(a.browser){case"chrome":if(!ek||!ES||!t.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=ek,J_(e,a),Q_(e),zP(e,a),KP(e),ES(e,a),qP(e),QP(e,a),YP(e),$P(e),XP(e),ZP(e,a),Y_(e),wS(e),SS(e),$_(e,a),X_(e),CS(e,a);break;case"firefox":if(!uk||!yS||!t.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=uk,J_(e,a),Q_(e),tk(e,a),yS(e,a),sk(e),ik(e),rk(e),nk(e),ak(e),ok(e),ck(e),lk(e),dk(e),Y_(e),SS(e),$_(e,a),X_(e);break;case"safari":if(!xk||!t.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=xk,J_(e,a),Q_(e),_k(e),Ek(e),mk(e),hk(e),pk(e),vk(e),fk(e),yk(e),Y_(e),wS(e),$_(e,a),X_(e),CS(e,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var TS=G;Zt({global:!0,forced:TS.globalThis!==TS},{globalThis:TS});var Nk=u(G),NS={exports:{}};(function(e,t){(function(s,a){var c="function",d="undefined",h="object",p="string",f="major",_="model",v="name",b="type",w="vendor",T="version",U="architecture",k="console",F="mobile",K="tablet",Y="smarttv",X="wearable",re="embedded",te="Amazon",Z="Apple",le="ASUS",xe="BlackBerry",Ce="Browser",je="Chrome",wt="Firefox",Ct="Google",mt="Huawei",Yt="LG",zt="Microsoft",Ur="Motorola",we="Opera",Le="Samsung",Ke="Sharp",Ne="Sony",P="Xiaomi",Q="Zebra",se="Facebook",Pe="Chromium OS",Et="Mac OS",ms=" Browser",Qs=function(Ys){for(var Zs={},fs=0;fs<Ys.length;fs++)Zs[Ys[fs].toUpperCase()]=Ys[fs];return Zs},Ui=function(Ys,Zs){return typeof Ys===p&&_a(Zs).indexOf(_a(Ys))!==-1},_a=function(Ys){return Ys.toLowerCase()},Cf=function(Ys,Zs){if(typeof Ys===p)return Ys=Ys.replace(/^\s\s*/,""),typeof Zs===d?Ys:Ys.substring(0,500)},Dd=function(Ys,Zs){for(var fs,An,Xa,Fs,mc,Ft,Ja=0;Ja<Zs.length&&!mc;){var Od=Zs[Ja],ko=Zs[Ja+1];for(fs=An=0;fs<Od.length&&!mc&&Od[fs];)if(mc=Od[fs++].exec(Ys))for(Xa=0;Xa<ko.length;Xa++)Ft=mc[++An],typeof(Fs=ko[Xa])===h&&Fs.length>0?Fs.length===2?typeof Fs[1]==c?this[Fs[0]]=Fs[1].call(this,Ft):this[Fs[0]]=Fs[1]:Fs.length===3?typeof Fs[1]!==c||Fs[1].exec&&Fs[1].test?this[Fs[0]]=Ft?Ft.replace(Fs[1],Fs[2]):a:this[Fs[0]]=Ft?Fs[1].call(this,Ft,Fs[2]):a:Fs.length===4&&(this[Fs[0]]=Ft?Fs[3].call(this,Ft.replace(Fs[1],Fs[2])):a):this[Fs]=Ft||a;Ja+=2}},Ph=function(Ys,Zs){for(var fs in Zs)if(typeof Zs[fs]===h&&Zs[fs].length>0){for(var An=0;An<Zs[fs].length;An++)if(Ui(Zs[fs][An],Ys))return fs==="?"?a:fs}else if(Ui(Zs[fs],Ys))return fs==="?"?a:fs;return Zs.hasOwnProperty("*")?Zs["*"]:Ys},QE={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ZE={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,T],[/opios[\/ ]+([\w\.]+)/i],[T,[v,we+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[T,[v,we+" GX"]],[/\bopr\/([\w\.]+)/i],[T,[v,we]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[T,[v,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[T,[v,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[v,T],[/quark(?:pc)?\/([-\w\.]+)/i],[T,[v,"Quark"]],[/\bddg\/([\w\.]+)/i],[T,[v,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[v,"UC"+Ce]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[T,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[v,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[T,[v,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[T,[v,"Smart Lenovo "+Ce]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+Ce],T],[/\bfocus\/([\w\.]+)/i],[T,[v,wt+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[v,we+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[v,we+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[v,"MIUI"+ms]],[/fxios\/([\w\.-]+)/i],[T,[v,wt]],[/\bqihoobrowser\/?([\w\.]*)/i],[T,[v,"360"]],[/\b(qq)\/([\w\.]+)/i],[[v,/(.+)/,"$1Browser"],T],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1"+ms],T],[/samsungbrowser\/([\w\.]+)/i],[T,[v,Le+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[T,[v,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[v,"Sogou Mobile"],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[v,T],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[v],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[T,v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,se],T],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[v,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[v,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[T,[v,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[v,je+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,je+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[v,"Android "+Ce]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[T,Ph,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],T],[/(wolvic|librewolf)\/([\w\.]+)/i],[v,T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[v,wt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[v,[T,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[v,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[U,"amd64"]],[/(ia32(?=;))/i],[[U,_a]],[/((?:i[346]|x)86)[;\)]/i],[[U,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[U,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[U,"armhf"]],[/windows (ce|mobile); ppc;/i],[[U,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[U,/ower/,"",_a]],[/(sun4\w)[;\)]/i],[[U,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[U,_a]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[w,Le],[b,K]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[_,[w,Le],[b,F]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[_,[w,Z],[b,F]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[w,Z],[b,K]],[/(macintosh);/i],[_,[w,Z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[w,Ke],[b,F]],[/(?:honor)([-\w ]+)[;\)]/i],[_,[w,"Honor"],[b,F]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[w,mt],[b,K]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[w,mt],[b,F]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[_,/_/g," "],[w,P],[b,F]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[w,P],[b,K]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[w,"OPPO"],[b,F]],[/\b(opd2\d{3}a?) bui/i],[_,[w,"OPPO"],[b,K]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[w,"Vivo"],[b,F]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[_,[w,"Realme"],[b,F]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[w,Ur],[b,F]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[w,Ur],[b,K]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[w,Yt],[b,K]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[w,Yt],[b,F]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[w,"Lenovo"],[b,K]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[w,"Nokia"],[b,F]],[/(pixel c)\b/i],[_,[w,Ct],[b,K]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[w,Ct],[b,F]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[w,Ne],[b,F]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[w,Ne],[b,K]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[w,"OnePlus"],[b,F]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[w,te],[b,K]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[w,te],[b,F]],[/(playbook);[-\w\),; ]+(rim)/i],[_,w,[b,K]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[w,xe],[b,F]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[w,le],[b,K]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[w,le],[b,F]],[/(nexus 9)/i],[_,[w,"HTC"],[b,K]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[w,[_,/_/g," "],[b,F]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[_,[w,"TCL"],[b,K]],[/(itel) ((\w+))/i],[[w,_a],_,[b,Ph,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[w,"Acer"],[b,K]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[w,"Meizu"],[b,F]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[_,[w,"Ulefone"],[b,F]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[_,[w,"Energizer"],[b,F]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[_,[w,"Cat"],[b,F]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[_,[w,"Smartfren"],[b,F]],[/droid.+; (a(?:015|06[35]|142p?))/i],[_,[w,"Nothing"],[b,F]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[w,_,[b,F]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[w,_,[b,K]],[/(surface duo)/i],[_,[w,zt],[b,K]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[w,"Fairphone"],[b,F]],[/(u304aa)/i],[_,[w,"AT&T"],[b,F]],[/\bsie-(\w*)/i],[_,[w,"Siemens"],[b,F]],[/\b(rct\w+) b/i],[_,[w,"RCA"],[b,K]],[/\b(venue[\d ]{2,7}) b/i],[_,[w,"Dell"],[b,K]],[/\b(q(?:mv|ta)\w+) b/i],[_,[w,"Verizon"],[b,K]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[w,"Barnes & Noble"],[b,K]],[/\b(tm\d{3}\w+) b/i],[_,[w,"NuVision"],[b,K]],[/\b(k88) b/i],[_,[w,"ZTE"],[b,K]],[/\b(nx\d{3}j) b/i],[_,[w,"ZTE"],[b,F]],[/\b(gen\d{3}) b.+49h/i],[_,[w,"Swiss"],[b,F]],[/\b(zur\d{3}) b/i],[_,[w,"Swiss"],[b,K]],[/\b((zeki)?tb.*\b) b/i],[_,[w,"Zeki"],[b,K]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[w,"Dragon Touch"],_,[b,K]],[/\b(ns-?\w{0,9}) b/i],[_,[w,"Insignia"],[b,K]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[w,"NextBook"],[b,K]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[w,"Voice"],_,[b,F]],[/\b(lvtel\-)?(v1[12]) b/i],[[w,"LvTel"],_,[b,F]],[/\b(ph-1) /i],[_,[w,"Essential"],[b,F]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[w,"Envizen"],[b,K]],[/\b(trio[-\w\. ]+) b/i],[_,[w,"MachSpeed"],[b,K]],[/\btu_(1491) b/i],[_,[w,"Rotor"],[b,K]],[/(shield[\w ]+) b/i],[_,[w,"Nvidia"],[b,K]],[/(sprint) (\w+)/i],[w,_,[b,F]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[w,zt],[b,F]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[w,Q],[b,K]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[w,Q],[b,F]],[/smart-tv.+(samsung)/i],[w,[b,Y]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[w,Le],[b,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[w,Yt],[b,Y]],[/(apple) ?tv/i],[w,[_,Z+" TV"],[b,Y]],[/crkey/i],[[_,je+"cast"],[w,Ct],[b,Y]],[/droid.+aft(\w+)( bui|\))/i],[_,[w,te],[b,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[w,Ke],[b,Y]],[/(bravia[\w ]+)( bui|\))/i],[_,[w,Ne],[b,Y]],[/(mitv-\w{5}) bui/i],[_,[w,P],[b,Y]],[/Hbbtv.*(technisat) (.*);/i],[w,_,[b,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[w,Cf],[_,Cf],[b,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[w,_,[b,k]],[/droid.+; (shield) bui/i],[_,[w,"Nvidia"],[b,k]],[/(playstation [345portablevi]+)/i],[_,[w,Ne],[b,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[w,zt],[b,k]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[_,[w,Le],[b,X]],[/((pebble))app/i],[w,_,[b,X]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[w,Z],[b,X]],[/droid.+; (glass) \d/i],[_,[w,Ct],[b,X]],[/droid.+; (wt63?0{2,3})\)/i],[_,[w,Q],[b,X]],[/droid.+; (glass) \d/i],[_,[w,Ct],[b,X]],[/(pico) (4|neo3(?: link|pro)?)/i],[w,_,[b,X]],[/; (quest( \d| pro)?)/i],[_,[w,se],[b,X]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[w,[b,re]],[/(aeobc)\b/i],[_,[w,te],[b,re]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[_,[b,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[b,K]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,K]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,F]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[w,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[v,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[v,T],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[v,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,T],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[v,[T,Ph,QE]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,Ph,QE],[v,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,Et],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,T],[/\(bb(10);/i],[T,[v,xe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[v,wt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[v,je+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,Pe],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,T],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[v,T]]},Vi=function(Ys,Zs){if(typeof Ys===h&&(Zs=Ys,Ys=a),!(this instanceof Vi))return new Vi(Ys,Zs).getResult();var fs=typeof s!==d&&s.navigator?s.navigator:a,An=Ys||(fs&&fs.userAgent?fs.userAgent:""),Xa=fs&&fs.userAgentData?fs.userAgentData:a,Fs=Zs?function(Ft,Ja){var Od={};for(var ko in Ft)Ja[ko]&&Ja[ko].length%2==0?Od[ko]=Ja[ko].concat(Ft[ko]):Od[ko]=Ft[ko];return Od}(ZE,Zs):ZE,mc=fs&&fs.userAgent==An;return this.getBrowser=function(){var Ft={};return Ft[v]=a,Ft[T]=a,Dd.call(Ft,An,Fs.browser),Ft[f]=function(Ja){return typeof Ja===p?Ja.replace(/[^\d\.]/g,"").split(".")[0]:a}(Ft[T]),mc&&fs&&fs.brave&&typeof fs.brave.isBrave==c&&(Ft[v]="Brave"),Ft},this.getCPU=function(){var Ft={};return Ft[U]=a,Dd.call(Ft,An,Fs.cpu),Ft},this.getDevice=function(){var Ft={};return Ft[w]=a,Ft[_]=a,Ft[b]=a,Dd.call(Ft,An,Fs.device),mc&&!Ft[b]&&Xa&&Xa.mobile&&(Ft[b]=F),mc&&Ft[_]=="Macintosh"&&fs&&typeof fs.standalone!==d&&fs.maxTouchPoints&&fs.maxTouchPoints>2&&(Ft[_]="iPad",Ft[b]=K),Ft},this.getEngine=function(){var Ft={};return Ft[v]=a,Ft[T]=a,Dd.call(Ft,An,Fs.engine),Ft},this.getOS=function(){var Ft={};return Ft[v]=a,Ft[T]=a,Dd.call(Ft,An,Fs.os),mc&&!Ft[v]&&Xa&&Xa.platform&&Xa.platform!="Unknown"&&(Ft[v]=Xa.platform.replace(/chrome os/i,Pe).replace(/macos/i,Et)),Ft},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return An},this.setUA=function(Ft){return An=typeof Ft===p&&Ft.length>500?Cf(Ft,500):Ft,this},this.setUA(An),this};Vi.VERSION="0.7.40",Vi.BROWSER=Qs([v,T,f]),Vi.CPU=Qs([U]),Vi.DEVICE=Qs([_,w,b,k,F,Y,K,X,re]),Vi.ENGINE=Vi.OS=Qs([v,T]),e.exports&&(t=e.exports=Vi),t.UAParser=Vi;var pc=typeof s!==d&&(s.jQuery||s.Zepto);if(pc&&!pc.ua){var ey=new Vi;pc.ua=ey.getResult(),pc.ua.get=function(){return ey.getUA()},pc.ua.set=function(Ys){ey.setUA(Ys);var Zs=ey.getResult();for(var fs in Zs)pc.ua[fs]=Zs[fs]}}})(typeof window=="object"?window:l)})(NS,NS.exports);var Dte=u(NS.exports),Rk=C_.clear;Zt({global:!0,bind:!0,forced:G.clearImmediate!==Rk},{clearImmediate:Rk});var Ak=G,Ote=D,jte=ve,Pte=Lb,kte=$e,Lte=Pc,Mte=Ql,Fte=Ak.Function,Ute=/MSIE .\./.test(kte)||Pte==="BUN"&&function(){var e=Ak.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Vte=Zt,Ik=G,Dk=C_.set,Bte=function(e,t){var s=1;return Ute?function(a,c){var d=Mte(arguments.length,1)>s,h=jte(a)?a:Fte(a),p=d?Lte(arguments,s):[],f=d?function(){Ote(h,this,p)}:h;return e(f)}:e},Ok=Ik.setImmediate?Bte(Dk):Dk;Vte({global:!0,bind:!0,forced:Ik.setImmediate!==Ok},{setImmediate:Ok});var jk=u(Os.setImmediate),Wte=G,Gte=zO,Hte=ri,zte=Ql,Kte=me;Zt({global:!0,dontCallGetSet:!0,forced:m(function(){return Kte&&Object.getOwnPropertyDescriptor(Wte,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){zte(arguments.length,1),Gte(Hte(e))}});var Pk=u(Os.queueMicrotask);function kk(e,t){return function(){return e.apply(t,arguments)}}let{toString:qte}=Object.prototype,{getPrototypeOf:RS}=Object,{iterator:Z_,toStringTag:Lk}=Symbol,ev=(AS=Object.create(null),e=>{let t=qte.call(e);return AS[t]||(AS[t]=t.slice(8,-1).toLowerCase())});var AS;let ka=e=>(e=e.toLowerCase(),t=>ev(t)===e),tv=e=>t=>typeof t===e,{isArray:Wu}=Array,xm=tv("undefined"),Mk=ka("ArrayBuffer"),Yte=tv("string"),ii=tv("function"),Fk=tv("number"),sv=e=>e!==null&&typeof e=="object",rv=e=>{if(ev(e)!=="object")return!1;let t=RS(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Lk in e||Z_ in e)},$te=ka("Date"),Xte=ka("File"),Jte=ka("Blob"),Qte=ka("FileList"),Zte=ka("URLSearchParams"),[ese,tse,sse,rse]=["ReadableStream","Request","Response","Headers"].map(ka);function bm(e,t){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Wu(e))for(s=0,a=e.length;s<a;s++)t.call(null,e[s],s,e);else{let d=c?Object.getOwnPropertyNames(e):Object.keys(e),h=d.length,p;for(s=0;s<h;s++)p=d[s],t.call(null,e[p],p,e)}}function Uk(e,t){t=t.toLowerCase();let s=Object.keys(e),a,c=s.length;for(;c-- >0;)if(a=s[c],t===a.toLowerCase())return a;return null}let nd=Nk!==void 0?Nk:typeof self<"u"?self:typeof window<"u"?window:global,Vk=e=>!xm(e)&&e!==nd,nse=(IS=typeof Uint8Array<"u"&&RS(Uint8Array),e=>IS&&e instanceof IS);var IS;let ise=ka("HTMLFormElement"),Bk=(e=>{let{hasOwnProperty:t}=e;return(s,a)=>t.call(s,a)})(Object.prototype),ase=ka("RegExp"),Wk=(e,t)=>{let s=Object.getOwnPropertyDescriptors(e),a={};bm(s,(c,d)=>{let h;(h=t(c,d,e))!==!1&&(a[d]=h||c)}),Object.defineProperties(e,a)},ose=ka("AsyncFunction"),Gk=(Hk=typeof jk=="function",zk=ii(nd.postMessage),Hk?jk:zk?(DS="axios@".concat(Math.random()),nv=[],nd.addEventListener("message",e=>{let{source:t,data:s}=e;t===nd&&s===DS&&nv.length&&nv.shift()()},!1),e=>{nv.push(e),nd.postMessage(DS,"*")}):e=>setTimeout(e));var Hk,zk,DS,nv;let cse=Pk!==void 0?Pk.bind(nd):typeof process<"u"&&process.nextTick||Gk;var Ve={isArray:Wu,isArrayBuffer:Mk,isBuffer:function(e){return e!==null&&!xm(e)&&e.constructor!==null&&!xm(e.constructor)&&ii(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ii(e.append)&&((t=ev(e))==="formdata"||t==="object"&&ii(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Mk(e.buffer),t},isString:Yte,isNumber:Fk,isBoolean:e=>e===!0||e===!1,isObject:sv,isPlainObject:rv,isReadableStream:ese,isRequest:tse,isResponse:sse,isHeaders:rse,isUndefined:xm,isDate:$te,isFile:Xte,isBlob:Jte,isRegExp:ase,isFunction:ii,isStream:e=>sv(e)&&ii(e.pipe),isURLSearchParams:Zte,isTypedArray:nse,isFileList:Qte,forEach:bm,merge:function e(){let{caseless:t}=Vk(this)&&this||{},s={},a=(c,d)=>{let h=t&&Uk(s,d)||d;rv(s[h])&&rv(c)?s[h]=e(s[h],c):rv(c)?s[h]=e({},c):Wu(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&bm(arguments[c],a);return s},extend:function(e,t,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return bm(t,(c,d)=>{s&&ii(c)?e[d]=kk(c,s):e[d]=c},{allOwnKeys:a}),e},trim:e=>Jr(e)?Jr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,s,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,a)=>{let c,d,h,p={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),d=c.length;d-- >0;)h=c[d],a&&!a(h,e,t)||p[h]||(t[h]=e[h],p[h]=!0);e=s!==!1&&RS(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:ev,kindOfTest:ka,endsWith:(e,t,s)=>{e=String(e),(s===void 0||s>e.length)&&(s=e.length),s-=t.length;let a=e.indexOf(t,s);return a!==-1&&a===s},toArray:e=>{if(!e)return null;if(Wu(e))return e;let t=e.length;if(!Fk(t))return null;let s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{let s=(e&&e[Z_]).call(e),a;for(;(a=s.next())&&!a.done;){let c=a.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let s,a=[];for(;(s=e.exec(t))!==null;)a.push(s);return a},isHTMLForm:ise,hasOwnProperty:Bk,hasOwnProp:Bk,reduceDescriptors:Wk,freezeMethods:e=>{Wk(e,(t,s)=>{if(ii(e)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;let a=e[s];ii(a)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{let s={},a=c=>{c.forEach(d=>{s[d]=!0})};return Wu(e)?a(e):a(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,a){return s.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:Uk,global:nd,isContextDefined:Vk,isSpecCompliantForm:function(e){return!!(e&&ii(e.append)&&e[Lk]==="FormData"&&e[Z_])},toJSONObject:e=>{let t=new Array(10),s=(a,c)=>{if(sv(a)){if(t.indexOf(a)>=0)return;if(!("toJSON"in a)){t[c]=a;let d=Wu(a)?[]:{};return bm(a,(h,p)=>{let f=s(h,c+1);!xm(f)&&(d[p]=f)}),t[c]=void 0,d}}return a};return s(e,0)},isAsyncFn:ose,isThenable:e=>e&&(sv(e)||ii(e))&&ii(e.then)&&ii(e.catch),setImmediate:Gk,asap:cse,isIterable:e=>e!=null&&ii(e[Z_])};function rs(e,t,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}Ve.inherits(rs,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ve.toJSONObject(this.config),code:this.code,status:this.status}}});let Kk=rs.prototype,qk={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{qk[e]={value:e}}),Object.defineProperties(rs,qk),Object.defineProperty(Kk,"isAxiosError",{value:!0}),rs.from=(e,t,s,a,c,d)=>{let h=Object.create(Kk);return Ve.toFlatObject(e,h,function(p){return p!==Error.prototype},p=>p!=="isAxiosError"),rs.call(h,e.message,t,s,a,c),h.cause=e,h.name=e.name,d&&Object.assign(h,d),h};function OS(e){return Ve.isPlainObject(e)||Ve.isArray(e)}function Yk(e){return Ve.endsWith(e,"[]")?e.slice(0,-2):e}function $k(e,t,s){return e?e.concat(t).map(function(a,c){return a=Yk(a),!s&&c?"["+a+"]":a}).join(s?".":""):t}let lse=Ve.toFlatObject(Ve,{},null,function(e){return/^is[A-Z]/.test(e)});function iv(e,t,s){if(!Ve.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let a=(s=Ve.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,T){return!Ve.isUndefined(T[w])})).metaTokens,c=s.visitor||_,d=s.dots,h=s.indexes,p=(s.Blob||typeof Blob<"u"&&Blob)&&Ve.isSpecCompliantForm(t);if(!Ve.isFunction(c))throw new TypeError("visitor must be a function");function f(w){if(w===null)return"";if(Ve.isDate(w))return w.toISOString();if(!p&&Ve.isBlob(w))throw new rs("Blob is not supported. Use a Buffer instead.");return Ve.isArrayBuffer(w)||Ve.isTypedArray(w)?p&&typeof Blob=="function"?new Blob([w]):Buffer.from(w):w}function _(w,T,U){let k=w;if(w&&!U&&typeof w=="object"){if(Ve.endsWith(T,"{}"))T=a?T:T.slice(0,-2),w=JSON.stringify(w);else if(Ve.isArray(w)&&function(F){return Ve.isArray(F)&&!F.some(OS)}(w)||(Ve.isFileList(w)||Ve.endsWith(T,"[]"))&&(k=Ve.toArray(w)))return T=Yk(T),k.forEach(function(F,K){!Ve.isUndefined(F)&&F!==null&&t.append(h===!0?$k([T],K,d):h===null?T:T+"[]",f(F))}),!1}return!!OS(w)||(t.append($k(U,T,d),f(w)),!1)}let v=[],b=Object.assign(lse,{defaultVisitor:_,convertValue:f,isVisitable:OS});if(!Ve.isObject(e))throw new TypeError("data must be an object");return function w(T,U){if(!Ve.isUndefined(T)){if(v.indexOf(T)!==-1)throw Error("Circular reference detected in "+U.join("."));v.push(T),Ve.forEach(T,function(k,F){(!(Ve.isUndefined(k)||k===null)&&c.call(t,k,Ve.isString(F)?Jr(F).call(F):F,U,b))===!0&&w(k,U?U.concat(F):[F])}),v.pop()}}(e),t}function Xk(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function jS(e,t){this._pairs=[],e&&iv(e,this,t)}let Jk=jS.prototype;function dse(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Qk(e,t,s){if(!t)return e;let a=s&&s.encode||dse;Ve.isFunction(s)&&(s={serialize:s});let c=s&&s.serialize,d;if(d=c?c(t,s):Ve.isURLSearchParams(t)?t.toString():new jS(t,s).toString(a),d){let h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+d}return e}Jk.append=function(e,t){this._pairs.push([e,t])},Jk.toString=function(e){let t=e?function(s){return e.call(this,s,Xk)}:Xk;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};var Zk=class{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ve.forEach(this.handlers,function(t){t!==null&&e(t)})}},e1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},t1={exports:{}},use=Zt,hse=me,s1=$i.f;use({target:"Object",stat:!0,forced:Object.defineProperty!==s1,sham:!hse},{defineProperty:s1});var r1=Os.Object,pse=t1.exports=function(e,t,s){return r1.defineProperty(e,t,s)};r1.defineProperty.sham&&(pse.sham=!0);var n1=u(t1.exports),mse=TypeError,i1=tm,fse=S_,gse=kt,_se=$s("species"),a1=Array,vse=function(e){var t;return i1(e)&&(t=e.constructor,(fse(t)&&(t===a1||i1(t.prototype))||gse(t)&&(t=t[_se])===null)&&(t=void 0)),t===void 0?a1:t},o1=function(e,t){return new(vse(e))(t===0?0:t)},Ese=m,yse=ti,xse=$s("species"),c1=function(e){return yse>=51||!Ese(function(){var t=[];return(t.constructor={})[xse]=function(){return{foo:1}},t[e](Boolean).foo!==1})},bse=Zt,wse=m,Sse=tm,Cse=kt,Tse=fo,Nse=Dc,l1=function(e){if(e>9007199254740991)throw mse("Maximum allowed index exceeded");return e},d1=$w,Rse=o1,Ase=c1,Ise=ti,u1=$s("isConcatSpreadable"),Dse=Ise>=51||!wse(function(){var e=[];return e[u1]=!1,e.concat()[0]!==e}),Ose=function(e){if(!Cse(e))return!1;var t=e[u1];return t!==void 0?!!t:Sse(e)};bse({target:"Array",proto:!0,forced:!Dse||!Ase("concat")},{concat:function(e){var t,s,a,c,d,h=Tse(this),p=Rse(h,0),f=0;for(t=-1,a=arguments.length;t<a;t++)if(Ose(d=t===-1?h:arguments[t]))for(c=Nse(d),l1(f+c),s=0;s<c;s++,f++)s in d&&d1(p,f,d[s]);else l1(f+1),d1(p,f++,d);return p.length=f,p}});var h1={},jse=H,Pse=rt,p1=c_.f,kse=Pc,m1=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];h1.f=function(e){return m1&&jse(e)==="Window"?function(t){try{return p1(t)}catch{return kse(m1)}}(e):p1(Pse(e))};var Gu={},Lse=$s;Gu.f=Lse;var f1=Os,Mse=Gr,Fse=Gu,Use=$i.f,fr=function(e){var t=f1.Symbol||(f1.Symbol={});Mse(t,e)||Use(t,e,{value:Fse.f(e)})},Vse=be,Bse=ir,Wse=$s,Gse=jc,g1=function(){var e=Bse("Symbol"),t=e&&e.prototype,s=t&&t.valueOf,a=Wse("toPrimitive");t&&!t[a]&&Gse(t,a,function(c){return Vse(s,this)},{})},Hse=Ic,zse=Qe,Kse=fo,qse=Dc,Yse=o1;C([].push);var $se=function(e){return function(t,s,a,c){for(var d,h,p=Kse(t),f=zse(p),_=qse(f),v=Hse(s,a),b=0,w=c||Yse,T=void 0;_>b;b++)b in f&&(h=v(d=f[b],b,p));return T}},_1={forEach:$se(0)},av=Zt,wm=G,PS=be,Xse=C,Hu=me,zu=si,Jse=m,rn=Gr,Qse=R,kS=Un,ov=rt,LS=wb,Zse=ni,MS=qe,Ku=rm,v1=d_,ere=c_,E1=h1,tre=sm,y1=ye,x1=$i,sre=Gb,b1=ae,w1=jc,rre=w_,FS=Eu,S1=l_,C1=xb,nre=$s,ire=Gu,are=fr,ore=g1,cre=Qo,T1=Jl,cv=_1.forEach,ai=o_("hidden"),lv="Symbol",Sm="prototype",lre=T1.set,N1=T1.getterFor(lv),La=Object[Sm],id=wm.Symbol,dv=id&&id[Sm],dre=wm.RangeError,ure=wm.TypeError,US=wm.QObject,R1=y1.f,ad=x1.f,A1=E1.f,hre=b1.f,I1=Xse([].push),tc=FS("symbols"),Cm=FS("op-symbols"),pre=FS("wks"),VS=!US||!US[Sm]||!US[Sm].findChild,D1=function(e,t,s){var a=R1(La,t);a&&delete La[t],ad(e,t,s),a&&e!==La&&ad(La,t,a)},BS=Hu&&Jse(function(){return Ku(ad({},"a",{get:function(){return ad(this,"a",{value:7}).a}})).a!==7})?D1:ad,WS=function(e,t){var s=tc[e]=Ku(dv);return lre(s,{type:lv,tag:e,description:t}),Hu||(s.description=t),s},uv=function(e,t,s){e===La&&uv(Cm,t,s),kS(e);var a=LS(t);return kS(s),rn(tc,a)?(s.enumerable?(rn(e,ai)&&e[ai][a]&&(e[ai][a]=!1),s=Ku(s,{enumerable:MS(0,!1)})):(rn(e,ai)||ad(e,ai,MS(1,Ku(null))),e[ai][a]=!0),BS(e,a,s)):ad(e,a,s)},GS=function(e,t){kS(e);var s=ov(t),a=v1(s).concat(k1(s));return cv(a,function(c){Hu&&!PS(O1,s,c)||uv(e,c,s[c])}),e},O1=function(e){var t=LS(e),s=PS(hre,this,t);return!(this===La&&rn(tc,t)&&!rn(Cm,t))&&(!(s||!rn(this,t)||!rn(tc,t)||rn(this,ai)&&this[ai][t])||s)},j1=function(e,t){var s=ov(e),a=LS(t);if(s!==La||!rn(tc,a)||rn(Cm,a)){var c=R1(s,a);return!c||!rn(tc,a)||rn(s,ai)&&s[ai][a]||(c.enumerable=!0),c}},P1=function(e){var t=A1(ov(e)),s=[];return cv(t,function(a){rn(tc,a)||rn(S1,a)||I1(s,a)}),s},k1=function(e){var t=e===La,s=A1(t?Cm:ov(e)),a=[];return cv(s,function(c){!rn(tc,c)||t&&!rn(La,c)||I1(a,tc[c])}),a};zu||(id=function(){if(Qse(dv,this))throw new ure("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Zse(arguments[0]):void 0,t=C1(e),s=function(a){var c=this===void 0?wm:this;c===La&&PS(s,Cm,a),rn(c,ai)&&rn(c[ai],t)&&(c[ai][t]=!1);var d=MS(1,a);try{BS(c,t,d)}catch(h){if(!(h instanceof dre))throw h;D1(c,t,d)}};return Hu&&VS&&BS(La,t,{configurable:!0,set:s}),WS(t,e)},w1(dv=id[Sm],"toString",function(){return N1(this).tag}),w1(id,"withoutSetter",function(e){return WS(C1(e),e)}),b1.f=O1,x1.f=uv,sre.f=GS,y1.f=j1,ere.f=E1.f=P1,tre.f=k1,ire.f=function(e){return WS(nre(e),e)},Hu&&rre(dv,"description",{configurable:!0,get:function(){return N1(this).description}})),av({global:!0,wrap:!0,forced:!zu,sham:!zu},{Symbol:id}),cv(v1(pre),function(e){are(e)}),av({target:lv,stat:!0,forced:!zu},{useSetter:function(){VS=!0},useSimple:function(){VS=!1}}),av({target:"Object",stat:!0,forced:!zu,sham:!Hu},{create:function(e,t){return t===void 0?Ku(e):GS(Ku(e),t)},defineProperty:uv,defineProperties:GS,getOwnPropertyDescriptor:j1}),av({target:"Object",stat:!0,forced:!zu},{getOwnPropertyNames:P1}),ore(),cre(id,lv),S1[ai]=!0;var L1=si&&!!Symbol.for&&!!Symbol.keyFor,mre=Zt,fre=ir,gre=Gr,_re=ni,M1=Eu,vre=L1,HS=M1("string-to-symbol-registry"),Ere=M1("symbol-to-string-registry");mre({target:"Symbol",stat:!0,forced:!vre},{for:function(e){var t=_re(e);if(gre(HS,t))return HS[t];var s=fre("Symbol")(t);return HS[t]=s,Ere[s]=t,s}});var yre=Zt,xre=Gr,bre=Jp,wre=vu,Sre=L1,F1=Eu("symbol-to-string-registry");yre({target:"Symbol",stat:!0,forced:!Sre},{keyFor:function(e){if(!bre(e))throw new TypeError(wre(e)+" is not a symbol");if(xre(F1,e))return F1[e]}});var U1=tm,Cre=ve,V1=H,Tre=ni,B1=C([].push),Nre=Zt,W1=ir,G1=D,Rre=be,Tm=C,H1=m,z1=ve,K1=Jp,q1=Pc,Are=function(e){if(Cre(e))return e;if(U1(e)){for(var t=e.length,s=[],a=0;a<t;a++){var c=e[a];typeof c=="string"?B1(s,c):typeof c!="number"&&V1(c)!=="Number"&&V1(c)!=="String"||B1(s,Tre(c))}var d=s.length,h=!0;return function(p,f){if(h)return h=!1,f;if(U1(this))return f;for(var _=0;_<d;_++)if(s[_]===p)return f}}},Ire=si,Dre=String,Vc=W1("JSON","stringify"),hv=Tm(/./.exec),Y1=Tm("".charAt),Ore=Tm("".charCodeAt),jre=Tm("".replace),Pre=Tm(1 .toString),kre=/[\uD800-\uDFFF]/g,$1=/^[\uD800-\uDBFF]$/,X1=/^[\uDC00-\uDFFF]$/,J1=!Ire||H1(function(){var e=W1("Symbol")("stringify detection");return Vc([e])!=="[null]"||Vc({a:e})!=="{}"||Vc(Object(e))!=="{}"}),Q1=H1(function(){return Vc("\uDF06\uD834")!=='"\\udf06\\ud834"'||Vc("\uDEAD")!=='"\\udead"'}),Lre=function(e,t){var s=q1(arguments),a=Are(t);if(z1(a)||e!==void 0&&!K1(e))return s[1]=function(c,d){if(z1(a)&&(d=Rre(a,this,Dre(c),d)),!K1(d))return d},G1(Vc,null,s)},Mre=function(e,t,s){var a=Y1(s,t-1),c=Y1(s,t+1);return hv($1,e)&&!hv(X1,c)||hv(X1,e)&&!hv($1,a)?"\\u"+Pre(Ore(e,0),16):e};Vc&&Nre({target:"JSON",stat:!0,forced:J1||Q1},{stringify:function(e,t,s){var a=q1(arguments),c=G1(J1?Lre:Vc,null,a);return Q1&&typeof c=="string"?jre(c,kre,Mre):c}});var Z1=sm,Fre=fo;Zt({target:"Object",stat:!0,forced:!si||m(function(){Z1.f(1)})},{getOwnPropertySymbols:function(e){var t=Z1.f;return t?t(Fre(e)):[]}}),fr("asyncIterator"),fr("hasInstance"),fr("isConcatSpreadable"),fr("iterator"),fr("match"),fr("matchAll"),fr("replace"),fr("search"),fr("species"),fr("split");var Ure=g1;fr("toPrimitive"),Ure();var Vre=ir,Bre=Qo;fr("toStringTag"),Bre(Vre("Symbol"),"Symbol"),fr("unscopables"),Qo(G.JSON,"JSON",!0);var Wre=Os.Symbol,Gre=$s,Hre=$i.f,e2=Gre("metadata"),t2=Function.prototype;t2[e2]===void 0&&Hre(t2,e2,{value:null}),fr("asyncDispose"),fr("dispose"),fr("metadata");var zre=Wre,Kre=C,zS=ir("Symbol"),qre=zS.keyFor,Yre=Kre(zS.prototype.valueOf),s2=zS.isRegisteredSymbol||function(e){try{return qre(Yre(e))!==void 0}catch{return!1}};Zt({target:"Symbol",stat:!0},{isRegisteredSymbol:s2});for(var $re=Eu,r2=ir,Xre=C,Jre=Jp,Qre=$s,pv=r2("Symbol"),n2=pv.isWellKnownSymbol,i2=r2("Object","getOwnPropertyNames"),Zre=Xre(pv.prototype.valueOf),a2=$re("wks"),KS=0,o2=i2(pv),ene=o2.length;KS<ene;KS++)try{var c2=o2[KS];Jre(pv[c2])&&Qre(c2)}catch{}var l2=function(e){if(n2&&n2(e))return!0;try{for(var t=Zre(e),s=0,a=i2(a2),c=a.length;s<c;s++)if(a2[a[s]]==t)return!0}catch{}return!1};Zt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:l2}),fr("customMatcher"),fr("observable"),Zt({target:"Symbol",stat:!0},{isRegistered:s2}),Zt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:l2}),fr("matcher"),fr("metadataKey"),fr("patternMatch"),fr("replaceAll");var qu=u(zre),d2=u(Gu.f("iterator"));function Nm(e){return Nm=typeof qu=="function"&&typeof d2=="symbol"?function(t){return typeof t}:function(t){return t&&typeof qu=="function"&&t.constructor===qu&&t!==qu.prototype?"symbol":typeof t},Nm(e)}var tne=u(Gu.f("toPrimitive"));function sne(e){var t=function(s,a){if(Nm(s)!="object"||!s)return s;var c=s[tne];if(c!==void 0){var d=c.call(s,a);if(Nm(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}(e,"string");return Nm(t)=="symbol"?t:t+""}function W(e,t,s){return(t=sne(t))in e?n1(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var u2=u(see),rne={isBrowser:!0,classes:{URLSearchParams:u2!==void 0?u2:jS,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let qS=typeof window<"u"&&typeof document<"u",YS=typeof navigator=="object"&&navigator||void 0,nne=qS&&(!YS||["ReactNative","NativeScript","NS"].indexOf(YS.product)<0),ine=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ane=qS&&window.location.href||"http://localhost";function h2(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function p2(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?h2(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):h2(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}var wn=p2(p2({},Object.freeze({__proto__:null,hasBrowserEnv:qS,hasStandardBrowserEnv:nne,hasStandardBrowserWebWorkerEnv:ine,navigator:YS,origin:ane})),rne),one=Un,cne=be,lne=Gr,dne=R,une=function(){var e=one(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},m2=RegExp.prototype,f2=function(e){var t=e.flags;return t!==void 0||"flags"in m2||lne(e,"flags")||!dne(m2,e)?t:cne(une,e)},hne=kw.charAt,g2=be,pne=Un,mne=ve,fne=H,gne=/./.exec,_ne=TypeError,vne=Zt,_2=be,v2=ne,Ene=sw,mv=x_,E2=xt,y2=yD,Rm=ni,yne=Un,xne=kt,bne=H,wne=bD,x2=f2,Sne=t_,Cne=m,Tne=cw,Nne=function(e,t,s){return t+(s?hne(e,t).length:1)},Rne=function(e,t){var s=e.exec;if(mne(s)){var a=g2(s,e,t);return a!==null&&pne(a),a}if(fne(e)==="RegExp")return g2(gne,e,t);throw new _ne("RegExp#exec called on incompatible receiver")},b2=Jl,Ane=$s("matchAll"),w2="RegExp String",S2=w2+" Iterator",Ine=b2.set,Dne=b2.getterFor(S2),One=TypeError,$S=v2("".indexOf),fv=v2("".matchAll),XS=!!fv&&!Cne(function(){fv("a",/./)}),jne=Ene(function(e,t,s,a){Ine(this,{type:S2,regexp:e,string:t,global:s,unicode:a,done:!1})},w2,function(){var e=Dne(this);if(e.done)return mv(void 0,!0);var t=e.regexp,s=e.string,a=Rne(t,s);return a===null?(e.done=!0,mv(void 0,!0)):e.global?(Rm(a[0])===""&&(t.lastIndex=Nne(s,y2(t.lastIndex),e.unicode)),mv(a,!1)):(e.done=!0,mv(a,!1))}),C2=function(e){var t,s,a,c=yne(this),d=Rm(e),h=Tne(c,RegExp),p=Rm(x2(c));return t=new h(h===RegExp?c.source:c,p),s=!!~$S(p,"g"),a=!!~$S(p,"u"),t.lastIndex=y2(c.lastIndex),new jne(t,d,s,a)};vne({target:"String",proto:!0,forced:XS},{matchAll:function(e){var t,s,a,c,d=E2(this);if(xne(e)){if(wne(e)&&(t=Rm(E2(x2(e))),!~$S(t,"g")))throw new One("`.matchAll` does not allow non-global regexes");if(XS)return fv(d,e);if((a=Sne(e,Ane))===void 0&&bne(e)==="RegExp"&&(a=C2),a)return _2(a,e,d)}else if(XS)return fv(d,e);return s=Rm(d),c=new RegExp(e,"g"),_2(C2,c,s)}});var Pne=Xi("String","matchAll"),kne=R,Lne=Pne,JS=String.prototype,Mne=function(e){var t=e.matchAll;return typeof e=="string"||e===JS||kne(JS,e)&&t===JS.matchAll?Lne:t},Fne=u(Mne);function T2(e){function t(s,a,c,d){let h=s[d++];if(h==="__proto__")return!0;let p=Number.isFinite(+h),f=d>=s.length;return h=!h&&Ve.isArray(c)?c.length:h,f?(Ve.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!p):(c[h]&&Ve.isObject(c[h])||(c[h]=[]),t(s,a,c[h],d)&&Ve.isArray(c[h])&&(c[h]=function(_){let v={},b=Object.keys(_),w,T=b.length,U;for(w=0;w<T;w++)U=b[w],v[U]=_[U];return v}(c[h])),!p)}if(Ve.isFormData(e)&&Ve.isFunction(e.entries)){let s={};return Ve.forEachEntry(e,(a,c)=>{t(function(d){return Fne(Ve).call(Ve,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,s,0)}),s}return null}let QS={transitional:e1,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let s=t.getContentType()||"",a=s.indexOf("application/json")>-1,c=Ve.isObject(e);if(c&&Ve.isHTMLForm(e)&&(e=new FormData(e)),Ve.isFormData(e))return a?JSON.stringify(T2(e)):e;if(Ve.isArrayBuffer(e)||Ve.isBuffer(e)||Ve.isStream(e)||Ve.isFile(e)||Ve.isBlob(e)||Ve.isReadableStream(e))return e;if(Ve.isArrayBufferView(e))return e.buffer;if(Ve.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,p){return iv(h,new wn.classes.URLSearchParams,Object.assign({visitor:function(f,_,v,b){return wn.isNode&&Ve.isBuffer(f)?(this.append(_,f.toString("base64")),!1):b.defaultVisitor.apply(this,arguments)}},p))}(e,this.formSerializer).toString();if((d=Ve.isFileList(e))||s.indexOf("multipart/form-data")>-1){let h=this.env&&this.env.FormData;return iv(d?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||a?(t.setContentType("application/json",!1),function(h,p,f){if(Ve.isString(h))try{return(p||JSON.parse)(h),Jr(Ve).call(Ve,h)}catch(_){if(_.name!=="SyntaxError")throw _}return(f||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){let t=this.transitional||QS.transitional,s=t&&t.forcedJSONParsing,a=this.responseType==="json";if(Ve.isResponse(e)||Ve.isReadableStream(e))return e;if(e&&Ve.isString(e)&&(s&&!this.responseType||a)){let c=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(d){if(c)throw d.name==="SyntaxError"?rs.from(d,rs.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:wn.classes.FormData,Blob:wn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ve.forEach(["delete","get","head","post","put","patch"],e=>{QS.headers[e]={}});var ZS=QS;let Une=Ve.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),N2=Symbol("internals");function Am(e){var t;return e&&Jr(t=String(e)).call(t).toLowerCase()}function gv(e){return e===!1||e==null?e:Ve.isArray(e)?e.map(gv):String(e)}function e0(e,t,s,a,c){return Ve.isFunction(a)?a.call(this,t,s):(c&&(t=s),Ve.isString(t)?Ve.isString(a)?t.indexOf(a)!==-1:Ve.isRegExp(a)?a.test(t):void 0:void 0)}class _v{constructor(t){t&&this.set(t)}set(t,s,a){let c=this;function d(f,_,v){let b=Am(_);if(!b)throw new Error("header name must be a non-empty string");let w=Ve.findKey(c,b);(!w||c[w]===void 0||v===!0||v===void 0&&c[w]!==!1)&&(c[w||_]=gv(f))}let h=(f,_)=>Ve.forEach(f,(v,b)=>d(v,b,_));if(Ve.isPlainObject(t)||t instanceof this.constructor)h(t,s);else if(Ve.isString(t)&&(t=Jr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Jr(p=t).call(p)))h((f=>{let _={},v,b,w;return f&&f.split(`
`).forEach(function(T){var U,k;w=T.indexOf(":"),v=Jr(U=T.substring(0,w)).call(U).toLowerCase(),b=Jr(k=T.substring(w+1)).call(k),!v||_[v]&&Une[v]||(v==="set-cookie"?_[v]?_[v].push(b):_[v]=[b]:_[v]=_[v]?_[v]+", "+b:b)}),_})(t),s);else if(Ve.isObject(t)&&Ve.isIterable(t)){let f,_,v={};for(let b of t){if(!Ve.isArray(b))throw TypeError("Object iterator must return a key-value pair");v[_=b[0]]=(f=v[_])?Ve.isArray(f)?[...f,b[1]]:[f,b[1]]:b[1]}h(v,s)}else t!=null&&d(s,t,a);var p;return this}get(t,s){if(t=Am(t)){let a=Ve.findKey(this,t);if(a){let c=this[a];if(!s)return c;if(s===!0)return function(d){let h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,f;for(;f=p.exec(d);)h[f[1]]=f[2];return h}(c);if(Ve.isFunction(s))return s.call(this,c,a);if(Ve.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,s){if(t=Am(t)){let a=Ve.findKey(this,t);return!(!a||this[a]===void 0||s&&!e0(0,this[a],a,s))}return!1}delete(t,s){let a=this,c=!1;function d(h){if(h=Am(h)){let p=Ve.findKey(a,h);!p||s&&!e0(0,a[p],p,s)||(delete a[p],c=!0)}}return Ve.isArray(t)?t.forEach(d):d(t),c}clear(t){let s=Object.keys(this),a=s.length,c=!1;for(;a--;){let d=s[a];t&&!e0(0,this[d],d,t,!0)||(delete this[d],c=!0)}return c}normalize(t){let s=this,a={};return Ve.forEach(this,(c,d)=>{var h;let p=Ve.findKey(a,d);if(p)return s[p]=gv(c),void delete s[d];let f=t?function(_){return Jr(_).call(_).toLowerCase().replace(/([a-z\d])(\w*)/g,(v,b,w)=>b.toUpperCase()+w)}(d):Jr(h=String(d)).call(h);f!==d&&delete s[d],s[f]=gv(c),a[f]=!0}),this}concat(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(t){let s=Object.create(null);return Ve.forEach(this,(a,c)=>{a!=null&&a!==!1&&(s[c]=t&&Ve.isArray(a)?a.join(", "):a)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[s,a]=t;return s+": "+a}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let s=new this(t);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach(h=>s.set(h)),s}static accessor(t){let s=(this[N2]=this[N2]={accessors:{}}).accessors,a=this.prototype;function c(d){let h=Am(d);s[h]||(function(p,f){let _=Ve.toCamelCase(" "+f);["get","set","has"].forEach(v=>{Object.defineProperty(p,v+_,{value:function(b,w,T){return this[v].call(this,f,b,w,T)},configurable:!0})})}(a,d),s[h]=!0)}return Ve.isArray(t)?t.forEach(c):c(t),this}}_v.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ve.reduceDescriptors(_v.prototype,(e,t)=>{let{value:s}=e,a=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(c){this[a]=c}}}),Ve.freezeMethods(_v);var Ma=_v;function t0(e,t){let s=this||ZS,a=t||s,c=Ma.from(a.headers),d=a.data;return Ve.forEach(e,function(h){d=h.call(s,d,c.normalize(),t?t.status:void 0)}),c.normalize(),d}function R2(e){return!(!e||!e.__CANCEL__)}function Yu(e,t,s){rs.call(this,e??"canceled",rs.ERR_CANCELED,t,s),this.name="CanceledError"}function A2(e,t,s){let a=s.config.validateStatus;s.status&&a&&!a(s.status)?t(new rs("Request failed with status code "+s.status,[rs.ERR_BAD_REQUEST,rs.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}Ve.inherits(Yu,rs,{__CANCEL__:!0});let vv=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0,c=function(d,h){d=d||10;let p=new Array(d),f=new Array(d),_,v=0,b=0;return h=h!==void 0?h:1e3,function(w){let T=Date.now(),U=f[b];_||(_=T),p[v]=w,f[v]=T;let k=b,F=0;for(;k!==v;)F+=p[k++],k%=d;if(v=(v+1)%d,v===b&&(b=(b+1)%d),T-_<h)return;let K=U&&T-U;return K?Math.round(1e3*F/K):void 0}}(50,250);return function(d,h){let p,f,_=0,v=1e3/h,b=function(w){_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),p=null,f&&(clearTimeout(f),f=null),d.apply(null,w)};return[function(){let w=Date.now(),T=w-_;for(var U=arguments.length,k=new Array(U),F=0;F<U;F++)k[F]=arguments[F];T>=v?b(k,w):(p=k,f||(f=setTimeout(()=>{f=null,b(p)},v-T)))},()=>p&&b(p)]}(d=>{let h=d.loaded,p=d.lengthComputable?d.total:void 0,f=h-a,_=c(f);a=h,e({loaded:h,total:p,progress:p?h/p:void 0,bytes:f,rate:_||void 0,estimated:_&&p&&h<=p?(p-h)/_:void 0,event:d,lengthComputable:p!=null,[t?"download":"upload"]:!0})},s)},I2=(e,t)=>{let s=e!=null;return[a=>t[0]({lengthComputable:s,total:e,loaded:a}),t[1]]},D2=e=>function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return Ve.asap(()=>e(...s))};var Vne=wn.hasStandardBrowserEnv?((e,t)=>s=>(s=new K_(s,wn.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new K_(wn.origin),wn.navigator&&/(msie|trident)/i.test(wn.navigator.userAgent)):()=>!0,Bne=wn.hasStandardBrowserEnv?{write(e,t,s,a,c,d){let h=[e+"="+encodeURIComponent(t)];Ve.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),Ve.isString(a)&&h.push("path="+a),Ve.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function O2(e,t,s){let a=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(t);return e&&(a||s==0)?function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}(e,t):t}function j2(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}let P2=e=>e instanceof Ma?function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?j2(Object(a),!0).forEach(function(c){W(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):j2(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}({},e):e;function od(e,t){t=t||{};let s={};function a(_,v,b,w){return Ve.isPlainObject(_)&&Ve.isPlainObject(v)?Ve.merge.call({caseless:w},_,v):Ve.isPlainObject(v)?Ve.merge({},v):Ve.isArray(v)?v.slice():v}function c(_,v,b,w){return Ve.isUndefined(v)?Ve.isUndefined(_)?void 0:a(void 0,_,0,w):a(_,v,0,w)}function d(_,v){if(!Ve.isUndefined(v))return a(void 0,v)}function h(_,v){return Ve.isUndefined(v)?Ve.isUndefined(_)?void 0:a(void 0,_):a(void 0,v)}function p(_,v,b){return b in t?a(_,v):b in e?a(void 0,_):void 0}let f={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p,headers:(_,v,b)=>c(P2(_),P2(v),0,!0)};return Ve.forEach(Object.keys(Object.assign({},e,t)),function(_){let v=f[_]||c,b=v(e[_],t[_],_);Ve.isUndefined(b)&&v!==p||(s[_]=b)}),s}var k2=e=>{let t=od({},e),s,{data:a,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:p,auth:f}=t;if(t.headers=p=Ma.from(p),t.url=Qk(O2(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),f&&p.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):""))),Ve.isFormData(a)){if(wn.hasStandardBrowserEnv||wn.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if((s=p.getContentType())!==!1){let[_,...v]=s?s.split(";").map(b=>Jr(b).call(b)).filter(Boolean):[];p.setContentType([_||"multipart/form-data",...v].join("; "))}}if(wn.hasStandardBrowserEnv&&(c&&Ve.isFunction(c)&&(c=c(t)),c||c!==!1&&Vne(t.url))){let _=d&&h&&Bne.read(h);_&&p.set(d,_)}return t},Wne=typeof XMLHttpRequest<"u"&&function(e){return new Be(function(t,s){let a=k2(e),c=a.data,d=Ma.from(a.headers).normalize(),h,p,f,_,v,{responseType:b,onUploadProgress:w,onDownloadProgress:T}=a;function U(){_&&_(),v&&v(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let k=new XMLHttpRequest;function F(){if(!k)return;let Y=Ma.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders());A2(function(X){t(X),U()},function(X){s(X),U()},{data:b&&b!=="text"&&b!=="json"?k.response:k.responseText,status:k.status,statusText:k.statusText,headers:Y,config:e,request:k}),k=null}k.open(a.method.toUpperCase(),a.url,!0),k.timeout=a.timeout,"onloadend"in k?k.onloadend=F:k.onreadystatechange=function(){k&&k.readyState===4&&(k.status!==0||k.responseURL&&k.responseURL.indexOf("file:")===0)&&setTimeout(F)},k.onabort=function(){k&&(s(new rs("Request aborted",rs.ECONNABORTED,e,k)),k=null)},k.onerror=function(){s(new rs("Network Error",rs.ERR_NETWORK,e,k)),k=null},k.ontimeout=function(){let Y=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded",X=a.transitional||e1;a.timeoutErrorMessage&&(Y=a.timeoutErrorMessage),s(new rs(Y,X.clarifyTimeoutError?rs.ETIMEDOUT:rs.ECONNABORTED,e,k)),k=null},c===void 0&&d.setContentType(null),"setRequestHeader"in k&&Ve.forEach(d.toJSON(),function(Y,X){k.setRequestHeader(X,Y)}),Ve.isUndefined(a.withCredentials)||(k.withCredentials=!!a.withCredentials),b&&b!=="json"&&(k.responseType=a.responseType),T&&([f,v]=vv(T,!0),k.addEventListener("progress",f)),w&&k.upload&&([p,_]=vv(w),k.upload.addEventListener("progress",p),k.upload.addEventListener("loadend",_)),(a.cancelToken||a.signal)&&(h=Y=>{k&&(s(!Y||Y.type?new Yu(null,e,k):Y),k.abort(),k=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));let K=function(Y){let X=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return X&&X[1]||""}(a.url);K&&wn.protocols.indexOf(K)===-1?s(new rs("Unsupported protocol "+K+":",rs.ERR_BAD_REQUEST,e)):k.send(c||null)})},Gne=(e,t)=>{let{length:s}=e=e?e.filter(Boolean):[];if(t||s){let a,c=new AbortController,d=function(_){if(!a){a=!0,p();let v=_ instanceof Error?_:this.reason;c.abort(v instanceof rs?v:new Yu(v instanceof Error?v.message:v))}},h=t&&setTimeout(()=>{h=null,d(new rs("timeout ".concat(t," of ms exceeded"),rs.ETIMEDOUT))},t),p=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(_=>{_.unsubscribe?_.unsubscribe(d):_.removeEventListener("abort",d)}),e=null)};e.forEach(_=>_.addEventListener("abort",d));let{signal:f}=c;return f.unsubscribe=()=>Ve.asap(p),f}},s0=u(wj),L2=Gu.f("asyncIterator"),Hne=u(L2);function r0(e,t){this.v=e,this.k=t}function Ai(e){return function(){return new Im(e.apply(this,arguments))}}function Im(e){var t,s;function a(d,h){try{var p=e[d](h),f=p.value,_=f instanceof r0;s0.resolve(_?f.v:f).then(function(v){if(_){var b=d==="return"?"return":"next";if(!f.k||v.done)return a(b,v);v=e[b](v).value}c(p.done?"return":"normal",v)},function(v){a("throw",v)})}catch(v){c("throw",v)}}function c(d,h){switch(d){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?a(t.key,t.arg):s=null}this._invoke=function(d,h){return new s0(function(p,f){var _={key:d,arg:h,resolve:p,reject:f,next:null};s?s=s.next=_:(t=s=_,a(d,h))})},typeof e.return!="function"&&(this.return=void 0)}function Ut(e){return new r0(e,0)}function Ev(e){var t={},s=!1;function a(c,d){return s=!0,d=new s0(function(h){h(e[c](d))}),{done:!1,value:new r0(d,1)}}return t[qu!==void 0&&d2||"@@iterator"]=function(){return this},t.next=function(c){return s?(s=!1,c):a("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return s?(s=!1,c):a("return",c)}),t}Im.prototype[typeof qu=="function"&&Hne||"@@asyncIterator"]=function(){return this},Im.prototype.next=function(e){return this._invoke("next",e)},Im.prototype.throw=function(e){return this._invoke("throw",e)},Im.prototype.return=function(e){return this._invoke("return",e)};var n0=u(L2);function i0(e){var t,s,a,c=2;for(typeof Symbol<"u"&&(s=n0,a=Symbol.iterator);c--;){if(s&&(t=e[s])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new yv(t.call(e));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function yv(e){function t(s){if(Object(s)!==s)return Be.reject(new TypeError(s+" is not an object."));var a=s.done;return Be.resolve(s.value).then(function(c){return{value:c,done:a}})}return yv=function(s){this.s=s,this.n=s.next},yv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?Be.resolve({value:s,done:!0}):t(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?Be.reject(s):t(a.apply(this.s,arguments))}},new yv(e)}let zne=function*(e,t){let s=e.byteLength;if(!t||s<t)return void(yield e);let a,c=0;for(;c<s;)a=c+t,yield e.slice(c,a),c=a},Kne=function(){var e=Ai(function*(t,s){var a,c=!1,d=!1;try{for(var h,p=i0(qne(t));c=!(h=yield Ut(p.next())).done;c=!1){let f=h.value;yield*Ev(i0(zne(f,s)))}}catch(f){d=!0,a=f}finally{try{c&&p.return!=null&&(yield Ut(p.return()))}finally{if(d)throw a}}});return function(t,s){return e.apply(this,arguments)}}(),qne=function(){var e=Ai(function*(t){if(t[n0])return void(yield*Ev(i0(t)));let s=t.getReader();try{for(;;){let{done:a,value:c}=yield Ut(s.read());if(a)break;yield c}}finally{yield Ut(s.cancel())}});return function(t){return e.apply(this,arguments)}}(),M2=(e,t,s,a)=>{let c=Kne(e,t),d,h=0,p=f=>{d||(d=!0,a&&a(f))};return new ReadableStream({async pull(f){try{let{done:_,value:v}=await c.next();if(_)return p(),void f.close();let b=v.byteLength;if(s){let w=h+=b;s(w)}f.enqueue(new Uint8Array(v))}catch(_){throw p(_),_}},cancel:f=>(p(f),c.return())},{highWaterMark:2})};function F2(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function U2(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?F2(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):F2(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let xv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",V2=xv&&typeof ReadableStream=="function",Yne=xv&&(typeof TextEncoder=="function"?(B2=new TextEncoder,e=>B2.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var B2;let W2=function(e){try{for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return!!e(...s)}catch{return!1}},$ne=V2&&W2(()=>{let e=!1,t=new Request(wn.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),a0=V2&&W2(()=>Ve.isReadableStream(new Response("").body)),bv={stream:a0&&(e=>e.body)};var G2;xv&&(G2=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!bv[e]&&(bv[e]=Ve.isFunction(G2[e])?t=>t[e]():(t,s)=>{throw new rs("Response type '".concat(e,"' is not supported"),rs.ERR_NOT_SUPPORT,s)})}));let Xne=async(e,t)=>Ve.toFiniteNumber(e.getContentLength())??(async a=>a==null?0:Ve.isBlob(a)?a.size:Ve.isSpecCompliantForm(a)?(await new Request(wn.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:Ve.isArrayBufferView(a)||Ve.isArrayBuffer(a)?a.byteLength:(Ve.isURLSearchParams(a)&&(a+=""),Ve.isString(a)?(await Yne(a)).byteLength:void 0))(t);var Jne=xv&&(async e=>{let{url:t,method:s,data:a,signal:c,cancelToken:d,timeout:h,onDownloadProgress:p,onUploadProgress:f,responseType:_,headers:v,withCredentials:b="same-origin",fetchOptions:w}=k2(e);_=_?(_+"").toLowerCase():"text";let T,U=Gne([c,d&&d.toAbortSignal()],h),k=U&&U.unsubscribe&&(()=>{U.unsubscribe()}),F;try{if(f&&$ne&&s!=="get"&&s!=="head"&&(F=await Xne(v,a))!==0){let te,Z=new Request(t,{method:"POST",body:a,duplex:"half"});if(Ve.isFormData(a)&&(te=Z.headers.get("content-type"))&&v.setContentType(te),Z.body){let[le,xe]=I2(F,vv(D2(f)));a=M2(Z.body,65536,le,xe)}}Ve.isString(b)||(b=b?"include":"omit");let K="credentials"in Request.prototype;T=new Request(t,U2(U2({},w),{},{signal:U,method:s.toUpperCase(),headers:v.normalize().toJSON(),body:a,duplex:"half",credentials:K?b:void 0}));let Y=await fetch(T),X=a0&&(_==="stream"||_==="response");if(a0&&(p||X&&k)){let te={};["status","statusText","headers"].forEach(Ce=>{te[Ce]=Y[Ce]});let Z=Ve.toFiniteNumber(Y.headers.get("content-length")),[le,xe]=p&&I2(Z,vv(D2(p),!0))||[];Y=new Response(M2(Y.body,65536,le,()=>{xe&&xe(),k&&k()}),te)}_=_||"text";let re=await bv[Ve.findKey(bv,_)||"text"](Y,e);return!X&&k&&k(),await new Be((te,Z)=>{A2(te,Z,{data:re,headers:Ma.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:T})})}catch(K){throw k&&k(),K&&K.name==="TypeError"&&/Load failed|fetch/i.test(K.message)?Object.assign(new rs("Network Error",rs.ERR_NETWORK,e,T),{cause:K.cause||K}):rs.from(K,K&&K.code,e,T)}});let o0={http:null,xhr:Wne,fetch:Jne};Ve.forEach(o0,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let H2=e=>"- ".concat(e),Qne=e=>Ve.isFunction(e)||e===null||e===!1;var z2={getAdapter:e=>{e=Ve.isArray(e)?e:[e];let{length:t}=e,s,a,c={};for(let d=0;d<t;d++){let h;if(s=e[d],a=s,!Qne(s)&&(a=o0[(h=String(s)).toLowerCase()],a===void 0))throw new rs("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+d]=a}if(!a){let d=Object.entries(c).map(h=>{let[p,f]=h;return"adapter ".concat(p," ")+(f===!1?"is not supported by the environment":"is not available in the build")});throw new rs("There is no suitable adapter to dispatch the request "+(t?d.length>1?`since :
`+d.map(H2).join(`
`):" "+H2(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:o0};function c0(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Yu(null,e)}function K2(e){return c0(e),e.headers=Ma.from(e.headers),e.data=t0.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),z2.getAdapter(e.adapter||ZS.adapter)(e).then(function(t){return c0(e),t.data=t0.call(e,e.transformResponse,t),t.headers=Ma.from(t.headers),t},function(t){return R2(t)||(c0(e),t&&t.response&&(t.response.data=t0.call(e,e.transformResponse,t.response),t.response.headers=Ma.from(t.response.headers))),Be.reject(t)})}let q2="1.9.0",wv={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{wv[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});let Y2={};wv.transitional=function(e,t,s){function a(c,d){return"[Axios v"+q2+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(e===!1)throw new rs(a(d," has been removed"+(t?" in "+t:"")),rs.ERR_DEPRECATED);return t&&!Y2[d]&&(Y2[d]=!0,console.warn(a(d," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,d,h)}},wv.spelling=function(e){return(t,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};var Sv={assertOptions:function(e,t,s){if(typeof e!="object")throw new rs("options must be an object",rs.ERR_BAD_OPTION_VALUE);let a=Object.keys(e),c=a.length;for(;c-- >0;){let d=a[c],h=t[d];if(h){let p=e[d],f=p===void 0||h(p,d,e);if(f!==!0)throw new rs("option "+d+" must be "+f,rs.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new rs("Unknown option "+d,rs.ERR_BAD_OPTION)}},validators:wv};let Eo=Sv.validators,Cv=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Zk,response:new Zk}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;let c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=od(this.defaults,t);let{transitional:s,paramsSerializer:a,headers:c}=t;s!==void 0&&Sv.assertOptions(s,{silentJSONParsing:Eo.transitional(Eo.boolean),forcedJSONParsing:Eo.transitional(Eo.boolean),clarifyTimeoutError:Eo.transitional(Eo.boolean)},!1),a!=null&&(Ve.isFunction(a)?t.paramsSerializer={serialize:a}:Sv.assertOptions(a,{encode:Eo.function,serialize:Eo.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Sv.assertOptions(t,{baseUrl:Eo.spelling("baseURL"),withXsrfToken:Eo.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let d=c&&Ve.merge(c.common,c[t.method]);c&&Ve.forEach(["delete","get","head","post","put","patch","common"],T=>{delete c[T]}),t.headers=Ma.concat(d,c);let h=[],p=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(p=p&&T.synchronous,h.unshift(T.fulfilled,T.rejected))});let f=[],_;this.interceptors.response.forEach(function(T){f.push(T.fulfilled,T.rejected)});let v,b=0;if(!p){let T=[K2.bind(this),void 0];for(T.unshift.apply(T,h),T.push.apply(T,f),v=T.length,_=Be.resolve(t);b<v;)_=_.then(T[b++],T[b++]);return _}v=h.length;let w=t;for(b=0;b<v;){let T=h[b++],U=h[b++];try{w=T(w)}catch(k){U.call(this,k);break}}try{_=K2.call(this,w)}catch(T){return Be.reject(T)}for(b=0,v=f.length;b<v;)_=_.then(f[b++],f[b++]);return _}getUri(e){return Qk(O2((e=od(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ve.forEach(["delete","get","head","options"],function(e){Cv.prototype[e]=function(t,s){return this.request(od(s||{},{method:e,url:t,data:(s||{}).data}))}}),Ve.forEach(["post","put","patch"],function(e){function t(s){return function(a,c,d){return this.request(od(d||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}Cv.prototype[e]=t(),Cv.prototype[e+"Form"]=t(!0)});var Tv=Cv;class l0{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Be(function(c){s=c});let a=this;this.promise.then(c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null}),this.promise.then=c=>{let d,h=new Be(p=>{a.subscribe(p),d=p}).then(c);return h.cancel=function(){a.unsubscribe(d)},h},t(function(c,d,h){a.reason||(a.reason=new Yu(c,d,h),s(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let s=this._listeners.indexOf(t);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){let t=new AbortController,s=a=>{t.abort(a)};return this.subscribe(s),t.signal.unsubscribe=()=>this.unsubscribe(s),t.signal}static source(){let t;return{token:new l0(function(s){t=s}),cancel:t}}}var Zne=l0;let d0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(d0).forEach(e=>{let[t,s]=e;d0[s]=t});var eie=d0;let Hr=function e(t){let s=new Tv(t),a=kk(Tv.prototype.request,s);return Ve.extend(a,Tv.prototype,s,{allOwnKeys:!0}),Ve.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return e(od(t,c))},a}(ZS);Hr.Axios=Tv,Hr.CanceledError=Yu,Hr.CancelToken=Zne,Hr.isCancel=R2,Hr.VERSION=q2,Hr.toFormData=iv,Hr.AxiosError=rs,Hr.Cancel=Hr.CanceledError,Hr.all=function(e){return Be.all(e)},Hr.spread=function(e){return function(t){return e.apply(null,t)}},Hr.isAxiosError=function(e){return Ve.isObject(e)&&e.isAxiosError===!0},Hr.mergeConfig=od,Hr.AxiosHeaders=Ma,Hr.formToJSON=e=>T2(Ve.isHTMLForm(e)?new FormData(e):e),Hr.getAdapter=z2.getAdapter,Hr.HttpStatusCode=eie,Hr.default=Hr;var pn=Hr;let tie=()=>{};function Dm(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:tie};return e.promise=new Be((t,s)=>{e.resolve=a=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(a),e.value=a)},e.reject=a=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,s(a))}}),e}let Nv=new Map,Rv=new Map,yo=new Map,ar=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Wt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),$2=new Dte,Fa=$2.getResult(),u0=null;function Lt(e){if(!u0){Fa=$2.getResult();let t=function(p){if(p.engine.name==="Blink"&&p.browser.name!=="WeChat")return Wt.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Wt.CHROME;case"Safari":case"Mobile Safari":return Wt.SAFARI;case"Edge":return Wt.EDGE;case"Firefox":return Wt.FIREFOX;case"QQ":case"QQBrowser":return Wt.QQ;case"Opera":return Wt.OPERA;case"WeChat":return Wt.WECHAT;default:return p.browser.name||""}}(Fa),s=X2(Fa),a=function(p){return p.os.name==="Windows"?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||""}(Fa),c=Fa.os.version,d=X2(Fa,!1),h=Fa.device.type;if(!(t&&s&&a&&c))return{name:t,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h};u0={name:t,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h}}return u0}function X2(e){let t,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",s?t.split(".")[0]:t}function Av(){return Lt().os}function J2(){let e=Lt();return"".concat(e.os," ").concat(e.osVersion)}function Iv(){let e=Lt();return!!(Fa.engine.name==="WebKit"&&e.os===ar.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Wt.SAFARI||zr()&&e.name!==Wt.SAFARI)}function sc(){return Lt().name===Wt.CHROME}function Tr(){return Lt().name===Wt.SAFARI}function Q2(){let e=Lt();if(e.name!==Wt.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function Z2(){return Lt().name===Wt.EDGE}function Rs(){return Lt().name===Wt.FIREFOX}function zr(){return Lt().os===ar.IOS}function $u(e){let t=Lt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)>=e}function eL(e){let t=Lt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)<e}function h0(e,t,s){let a=Lt();return!(a.name!==e||!a.osVersion)&&(s?Number(a.version)>=t&&Number(a.version)<=s:Number(a.version)===t)}function p0(e){let t=Lt();return!(t.name!==Wt.EDGE||!t.osVersion)&&Number(t.version)>=e}function m0(e){let t=Lt();return!(t.name!==Wt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function tL(e){let t=Lt();return!(t.name!==Wt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function sL(e,t,s){let a=Lt();if(a.os!==ar.IOS||!a.osVersion)return!1;let c=a.osVersion.split(".");return s?t&&Number(c[0])===e&&Number(c[1])>t||Number(c[0])>e:t?Number(c[0])===e&&Number(c[1])>=t||Number(c[0])>e:Number(c[0])>=e}function rL(e,t,s){let a=Lt();if(a.os!==ar.IOS||!a.osVersion)return!1;let c=a.osVersion.split(".");return t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e}function f0(e,t,s){let a=Lt();if(a.name!==Wt.SAFARI||!a.osVersion||!a.browserVersion)return!1;let c=a.browserVersion.split(".");return s?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function g0(e){let t=Lt();return!(t.name!==Wt.OPERA||!t.osVersion)&&Number(t.version)>=e}function nL(){let e=Lt();if(e.os!==ar.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Xu(){let e=Lt();if(e.os!==ar.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function _0(){let e=Lt();if(e.os!==ar.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function iL(){let e=Lt();if(e.os!==ar.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function na(){return Tr()&&navigator.maxTouchPoints>0}function aL(){return Lt().name===Wt.WECHAT}function oL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function v0(){let e=Av();return function(){let{deviceType:t}=Lt();return t==="mobile"||t==="tablet"}()||e===ar.ANDROID||e===ar.IOS||e===ar.HARMONY_OS}function rc(){let e=Lt();return e.name!==Wt.EDGE&&e.name!==Wt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Dv(){return Av()===ar.ANDROID}function Om(){let e=Lt();return Dv()&&(e.name===Wt.CHROME||e.name===Wt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function gt(e,t,s){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var f=p.call(d,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function cL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Oe(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?cL(Object(s),!0).forEach(function(a){gt(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):cL(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let q=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),_e=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(t),gt(this,"code",void 0),gt(this,"message",void 0),gt(this,"data",void 0),gt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Ua(e,t){if(typeof e!="boolean")throw new _e(q.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function er(e,t,s){if(!ke(s).call(s,e))throw new _e(q.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(s)))}function ns(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<s||e>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new _e(q.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function E0(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new _e(q.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&ns(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&ns(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&ns(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&ns(e.ideal,"".concat(t,".ideal"),1,1/0)}else ns(e,t,1,1/0)}function gr(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new _e(q.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!lL(e,s,a,c))throw new _e(q.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function nc(e,t){if(!Array.isArray(e))throw new _e(q.INVALID_PARAMS,"".concat(t," should be an array"))}function As(e){return e==null}function lL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=s&&e.length>=t&&(!a||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){let h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(e))}var jm=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(jm||{}),y0=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(y0||{});let dL=new class{constructor(){gt(this,"_clientSize",null),gt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),gt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),gt(this,"getStyle",e=>window.getComputedStyle(e,null)),gt(this,"checkCssVisibleProperty",e=>{var t;let s=!0,a=this.getStyle(e),{display:c,visibility:d,opacity:h,filter:p}=a;return(c==="none"||ke(t=["hidden","collapse"]).call(t,d)||Number(h)<.1)&&(s=!1),!!s&&(p&&p.split(" ").filter(f=>{var _;let v=f.split("(")[0];return ke(_=["brightness","blur","opacity"]).call(_,v)}).map(f=>{let[_,v]=f.split(/\(|\)/);return[_,Number(v.match(/^[0-9\.]+/))]}).forEach(f=>{let[_,v]=f;switch(_){case"brightness":(v<.1||v>3)&&(s=!1);break;case"blur":v>3&&(s=!1);break;case"opacity":v<.1&&(s=!1)}}),s)}),gt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let s=!0,a=!0,c=h=>t(h),d=e;for(;d&&a;)c(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s}),gt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),gt(this,"getSizeAboutClient",e=>{let{width:t,height:s,left:a,right:c,top:d,bottom:h}=e.getBoundingClientRect(),p=this.getClientWidth(),f=this.getClientHeight();return{width:t,height:s,left:a,right:c,top:d,bottom:h,clientWidth:p,clientHeight:f,clientMin:Math.min(p,f)}}),gt(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(e,t,s)}),gt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),gt(this,"checkCoverForAPoint",(e,t,s)=>{let a=this.elementFromPoint(e,t);return a!==null&&a!==s}),gt(this,"getPointPositionList",()=>{let{width:e,height:t,left:s,top:a}=this._clientSize,c=e/6,d=t/6,h=[],p=10**6;for(let f=0;f<5;f++)for(let _=0;_<5;_++){let v=(s*p+(f===0?.1:f===4?(c*f*p-1e5)/p:c*f)*p)/p,b=(a*p+(_===0?.1:_===4?(d*_*p-1e5)/p:d*_)*p)/p;h.push({x:v,y:b})}return[...h]}),gt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),gt(this,"checkSizeIsVisible",(e,t,s)=>(e>50||s/e<=10)&&(t>50||s/t<=10)),gt(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:s,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize,p,f,_,v;if(e<0)p=0;else{if(!(e<d))return!1;p=e}if(t<0)return!1;if(f=t<d?t:d,s<0)_=0;else{if(!(s<c))return!1;_=s}if(a<0)return!1;v=a<c?a:c;let b=f-p,w=v-_;return this.checkSizeIsVisible(b,w,h)}),gt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),gt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(jm.COVERED);{let t=this.checkActualSize(),s=this.checkSizeOfPartInClient();return t&&!s?this.returnHiddenResult(jm.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(jm.SIZE)}}return this.returnHiddenResult(jm.STYLE)}return this.returnHiddenResult(y0.UNMOUNTED)}return this.returnHiddenResult(y0.INVALID_HTML_ELEMENT)}),gt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function x0(e){return new TextEncoder().encode(e)}let uL=function(e,t){let s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s},b0=async e=>function(t,s){let a="";return new Uint8Array(t).forEach(c=>{a+=c.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",x0(e)),16);class Cs{constructor(){gt(this,"_events",{}),gt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(s=>s.listener):[]}on(t,s){this._events[t]||(this._events[t]=[]);let a=this._events[t];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!1})}once(t,s){this._events[t]||(this._events[t]=[]);let a=this._events[t];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!0})}off(t,s){if(!this._events[t])return;let a=this._events[t],c=this._indexOfListener(a,s);c!==-1&&a.splice(c,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);let s=this._events[t].map(h=>h);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];for(let h=0;h<s.length;h+=1){let p=s[h];p.once&&this.off(t,p.listener),p.listener.apply(this,c||[])}}safeEmit(t){for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];[...this._events[t]||[]].forEach(d=>{d.once&&this.off(t,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(t," error ").concat(h==null?void 0:h.toString()))}})}_indexOfListener(t,s){let a=t.length;for(;a--;)if(t[a].listener===s)return a;return-1}}let Pm=null;function hL(){if(Pm)return Pm;if(window.electron)return Pm=window.electron;if(!window.require)return null;try{return Pm=window.require("electron"),Pm}catch{return null}}let ks=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),xs=function(e){return e.TRACER="tracer",e}({});function pL(e){return ns(e.timeout,"config.timeout",0,1e5),ns(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ns(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ns(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let sie=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),$t=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function km(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function mL(e){return gr(e.turnServerURL,"turnServerURL"),gr(e.username,"username"),gr(e.password,"password"),e.udpport&&ns(e.udpport,"udpport",1,99999,!0),e.forceturn&&Ua(e.forceturn,"forceturn"),e.security&&Ua(e.security,"security"),e.tcpport&&ns(e.tcpport,"tcpport",1,99999,!0),!0}function w0(e){return e.level!==void 0&&er(e.level,"level",[1,2,3]),e.delay!==void 0&&ns(e.delay,"delay",0,3e3,!0),!0}let At=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Nr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Gn=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Ju=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Rr(e,t){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return e.getListeners(t).length===0?Be.reject(new _e(q.UNEXPECTED_ERROR,"can not emit promise")):new Be((d,h)=>{e.emit(t,...a,d,h)})}function as(e,t){if(e.getListeners(t).length===0)return Be.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Rr(e,t,...a)}function oi(e,t){if(e.getListeners(t).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Lm(e,t,...a)}function Lm(e,t){let s=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(e.emit(t,...d,p=>{s=p},p=>{a=p}),a!==null)throw a;if(s===null)throw new _e(q.UNEXPECTED_ERROR,"handler is not sync");return s}let Vs=new class extends Cs{set networkState(e){this.emit(Ju.NETWORK_STATE_CHANGE,e,this._networkState),e===Gn.ONLINE?this.emit(Ju.ONLINE):e===Gn.OFFLINE&&(this.onlineWaiter=new Be(t=>{this.once(Ju.ONLINE,()=>{this.onlineWaiter=void 0,t(Gn.ONLINE)})}),this.emit(Ju.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Gn.ONLINE}constructor(){super(),gt(this,"_moduleName","network-indicator"),gt(this,"_networkState",Gn.ONLINE),gt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Gn.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Gn.OFFLINE})}};function Ov(e,t){let s=e.indexOf(t);s!==-1&&e.splice(s,1)}function Qu(e){let t=[];return e.forEach(s=>{t.indexOf(s)===-1&&t.push(s)}),t}function jv(e){Be!==void 0?Be.resolve().then(e):setTimeout(e,0)}function bs(e){return JSON.parse(JSON.stringify(e))}function cd(e){try{return bs(e)}catch{return e}}let fL={};function Bc(e,t){fL[t]||(fL[t]=!0,e())}function ld(e){let t=window.atob(e),s=new Uint8Array(new ArrayBuffer(t.length));for(let a=0;a<t.length;a+=1)s[a]=t.charCodeAt(a);return s}function Wc(e){let t="";for(let s=0;s<e.length;s+=1)t+=String.fromCharCode(e[s]);return window.btoa(t)}function gL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(e);if(s.length>t)s=s.slice(0,t);else if(s.length<t){let a=new Uint8Array(t);a.set(s),s=a}return s}function _L(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=Ji(t).call(t,(h,p)=>h+p.length,0),c=new Uint8Array(new ArrayBuffer(a)),d=0;return t.forEach(h=>{c.set(h,d),d+=h.length}),c}function xo(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function vL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(s=>{t+=typeof s=="string"?xo(s):s.size}),t+138}function rie(e){let t=new _e(q.TIMEOUT,"timeout");return new Be((s,a)=>{window.setTimeout(()=>a(t),e)})}function _r(e){return new Be(t=>{window.setTimeout(t,e)})}function os(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,s=Math.random().toString(16).substr(2,e).toLowerCase();return s.length===e?"".concat(t).concat(s):"".concat(t).concat(s)+os(e-s.length,"")}function dd(){return os(32,"").toUpperCase()}let Pv=()=>{},EL=new class{constructor(){gt(this,"fnMap",new Map)}throttleByKey(e,t,s,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(t)){let p=this.fnMap.get(t);if(p.threshold!==s){p.fn(...p.args),clearTimeout(p.timer);let f=window.setTimeout(()=>{let _=this.fnMap.get(t);_&&_.fn(..._.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:f,args:d,skipFn:a})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(t,Oe(Oe({},p),{},{fn:e,args:d,skipFn:a}))}else{let p=window.setTimeout(()=>{let f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:p,args:d,skipFn:a})}}},yL=EL.throttleByKey.bind(EL);function xL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function S0(e,t){if(!xL(e)||!xL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let s=[...e];for(let a=0;a<t.length;a++)s[a]=S0(e[a],t[a]);return s}{let s=Oe({},e);for(let a in t)Object.prototype.hasOwnProperty.call(t,a)&&(Object.prototype.hasOwnProperty.call(e,a)?s[a]=S0(e[a],t[a]):s[a]=t[a]);return s}}function bL(e,t){let s=[0];if(s=new Array(t).fill(0),e===0)return s;let a=0;for(;e>0&&(s[a]=255&e,e>>=8,a++,a!==t););return s}function Zu(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function C0(e){return Ji(e).call(e,(t,s)=>t+s,0)}function wL(e){let t="0123456789abcdef";function s(X){let re,te="";for(re=0;re<=3;re++)te+=t.charAt(X>>8*re+4&15)+t.charAt(X>>8*re&15);return te}function a(X,re){let te=(65535&X)+(65535&re);return(X>>16)+(re>>16)+(te>>16)<<16|65535&te}function c(X,re,te,Z,le,xe){return a(function(Ce,je){return Ce<<je|Ce>>>32-je}(a(a(re,X),a(Z,xe)),le),te)}function d(X,re,te,Z,le,xe,Ce){return c(re&te|~re&Z,X,re,le,xe,Ce)}function h(X,re,te,Z,le,xe,Ce){return c(re&Z|te&~Z,X,re,le,xe,Ce)}function p(X,re,te,Z,le,xe,Ce){return c(re^te^Z,X,re,le,xe,Ce)}function f(X,re,te,Z,le,xe,Ce){return c(te^(re|~Z),X,re,le,xe,Ce)}let _=function(X){let re,te=1+(X.length+8>>6),Z=new Array(16*te);for(re=0;re<16*te;re++)Z[re]=0;for(re=0;re<X.length;re++)Z[re>>2]|=X.charCodeAt(re)<<re%4*8;return Z[re>>2]|=128<<re%4*8,Z[16*te-2]=8*X.length,Z}(e),v,b,w,T,U,k=1732584193,F=-271733879,K=-1732584194,Y=271733878;for(v=0;v<_.length;v+=16)b=k,w=F,T=K,U=Y,k=d(k,F,K,Y,_[v+0],7,-680876936),Y=d(Y,k,F,K,_[v+1],12,-389564586),K=d(K,Y,k,F,_[v+2],17,606105819),F=d(F,K,Y,k,_[v+3],22,-1044525330),k=d(k,F,K,Y,_[v+4],7,-176418897),Y=d(Y,k,F,K,_[v+5],12,1200080426),K=d(K,Y,k,F,_[v+6],17,-1473231341),F=d(F,K,Y,k,_[v+7],22,-45705983),k=d(k,F,K,Y,_[v+8],7,1770035416),Y=d(Y,k,F,K,_[v+9],12,-1958414417),K=d(K,Y,k,F,_[v+10],17,-42063),F=d(F,K,Y,k,_[v+11],22,-1990404162),k=d(k,F,K,Y,_[v+12],7,1804603682),Y=d(Y,k,F,K,_[v+13],12,-40341101),K=d(K,Y,k,F,_[v+14],17,-1502002290),F=d(F,K,Y,k,_[v+15],22,1236535329),k=h(k,F,K,Y,_[v+1],5,-165796510),Y=h(Y,k,F,K,_[v+6],9,-1069501632),K=h(K,Y,k,F,_[v+11],14,643717713),F=h(F,K,Y,k,_[v+0],20,-373897302),k=h(k,F,K,Y,_[v+5],5,-701558691),Y=h(Y,k,F,K,_[v+10],9,38016083),K=h(K,Y,k,F,_[v+15],14,-660478335),F=h(F,K,Y,k,_[v+4],20,-405537848),k=h(k,F,K,Y,_[v+9],5,568446438),Y=h(Y,k,F,K,_[v+14],9,-1019803690),K=h(K,Y,k,F,_[v+3],14,-187363961),F=h(F,K,Y,k,_[v+8],20,1163531501),k=h(k,F,K,Y,_[v+13],5,-1444681467),Y=h(Y,k,F,K,_[v+2],9,-51403784),K=h(K,Y,k,F,_[v+7],14,1735328473),F=h(F,K,Y,k,_[v+12],20,-1926607734),k=p(k,F,K,Y,_[v+5],4,-378558),Y=p(Y,k,F,K,_[v+8],11,-2022574463),K=p(K,Y,k,F,_[v+11],16,1839030562),F=p(F,K,Y,k,_[v+14],23,-35309556),k=p(k,F,K,Y,_[v+1],4,-1530992060),Y=p(Y,k,F,K,_[v+4],11,1272893353),K=p(K,Y,k,F,_[v+7],16,-155497632),F=p(F,K,Y,k,_[v+10],23,-1094730640),k=p(k,F,K,Y,_[v+13],4,681279174),Y=p(Y,k,F,K,_[v+0],11,-358537222),K=p(K,Y,k,F,_[v+3],16,-722521979),F=p(F,K,Y,k,_[v+6],23,76029189),k=p(k,F,K,Y,_[v+9],4,-640364487),Y=p(Y,k,F,K,_[v+12],11,-421815835),K=p(K,Y,k,F,_[v+15],16,530742520),F=p(F,K,Y,k,_[v+2],23,-995338651),k=f(k,F,K,Y,_[v+0],6,-198630844),Y=f(Y,k,F,K,_[v+7],10,1126891415),K=f(K,Y,k,F,_[v+14],15,-1416354905),F=f(F,K,Y,k,_[v+5],21,-57434055),k=f(k,F,K,Y,_[v+12],6,1700485571),Y=f(Y,k,F,K,_[v+3],10,-1894986606),K=f(K,Y,k,F,_[v+10],15,-1051523),F=f(F,K,Y,k,_[v+1],21,-2054922799),k=f(k,F,K,Y,_[v+8],6,1873313359),Y=f(Y,k,F,K,_[v+15],10,-30611744),K=f(K,Y,k,F,_[v+6],15,-1560198380),F=f(F,K,Y,k,_[v+13],21,1309151649),k=f(k,F,K,Y,_[v+4],6,-145523070),Y=f(Y,k,F,K,_[v+11],10,-1120210379),K=f(K,Y,k,F,_[v+2],15,718787259),F=f(F,K,Y,k,_[v+9],21,-343485551),k=a(k,b),F=a(F,w),K=a(K,T),Y=a(Y,U);return s(k)+s(F)+s(K)+s(Y)}let nie=1,SL=console,Pr=class{static setLogger(e){SL=e}constructor(e,t){gt(this,"id",void 0),gt(this,"lockingPromise",Be.resolve()),gt(this,"locks",0),gt(this,"name",""),gt(this,"lockId",void 0),this.lockId=nie++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");SL.debug("".concat(s," ").concat(a))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let s=new Be(c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),a=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>s),a}};function eh(e,t){return function(s,a,c){let d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){let h=this[t];if(!h)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let p=await h.lock("From ".concat(e,".").concat(a));try{for(var f=arguments.length,_=new Array(f),v=0;v<f;v++)_[v]=arguments[v];return await d.apply(this,_)}finally{p()}},c}}let Ks={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function T0(e,t){let s=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,s)}function Va(e,t,s,a){let c=Object.assign({},Ks,a),d=c.timeout,h=async()=>{await function(_){return new Be(v=>{window.setTimeout(v,_)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)},p=!1,f=new Be(async(_,v)=>{t=t||(()=>!1),s=s||(()=>!0);for(let b=0;b<c.maxRetryCount;b+=1){if(p)return v(new _e(q.OPERATION_ABORTED));try{let w=await e();if(!t(w,b)||b+1===c.maxRetryCount)return _(w);await h()}catch(w){if(!s(w,b)||b+1===c.maxRetryCount)return v(w);await h()}}});return f.cancel=()=>p=!0,f}let kv,CL=class{constructor(e){gt(this,"input",[]),gt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ji(e=this.input).call(e,(t,s)=>t+s)/this.input.length}},Lv=0,N0=0;function R0(e,t,s,a){return new Be((c,d)=>{t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),Lv+=xo(t.data)):s&&(t.data.size?Lv+=t.data.size:t.data instanceof FormData?Lv+=vL(t.data):Lv+=xo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,pn.request(t).then(h=>{typeof h.data=="string"?N0+=xo(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?N0+=h.data.byteLength:N0+=xo(JSON.stringify(h.data)),c(h.data)}).catch(h=>{pn.isCancel(h)?d(new _e(q.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new _e(q.NETWORK_TIMEOUT,h.message)):h.response?d(new _e(q.NETWORK_RESPONSE_ERROR,h.response.status)):d(new _e(q.NETWORK_ERROR,h.message))})})}async function iie(e,t){let s=new Blob([t.data],{type:"buffer"});return await R0(e,Oe(Oe({},t),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}let TL=()=>window.isSecureContext!==void 0;function ia(e){if(Array.isArray(e))return e.map(s=>s);if(!NL(e))return e;let t={};for(let s in e){let a=e[s];NL(a)||Array.isArray(a)?t[s]=ia(a):t[s]=a}return t}function NL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let A0=class{constructor(e){gt(this,"input",[]),gt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},bo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Mm={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:bo,remoteCandidate:bo},updateInterval:0},RL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},AL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},IL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},DL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},I0=class{constructor(e,t){gt(this,"onFirstVideoReceived",void 0),gt(this,"onFirstVideoDecoded",void 0),gt(this,"onFirstAudioReceived",void 0),gt(this,"onFirstVideoDecodedTimeout",void 0),gt(this,"onFirstAudioDecoded",void 0),gt(this,"onSelectedLocalCandidateChanged",void 0),gt(this,"onSelectedRemoteCandidateChanged",void 0),gt(this,"videoIsReady",!1),gt(this,"videoIsReady2",{}),gt(this,"pc",void 0),gt(this,"options",void 0),gt(this,"intervalTimer",void 0),gt(this,"stats",ia(Mm)),gt(this,"isFirstVideoReceived",{}),gt(this,"isFirstVideoDecoded",{}),gt(this,"isFirstAudioReceived",{}),gt(this,"isFirstAudioDecoded",{}),gt(this,"isFirstVideoDecodedTimeout",{}),gt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Be(e=>{e({local:Oe({},bo),remote:Oe({},bo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"],a=0,c=0,d=0,h=0;for(let p of s)e[p].forEach((f,_)=>{if(!this.lossRateWindowStats[t-1][p][_]||!this.lossRateWindowStats[0][p][_])return;let v=this.lossRateWindowStats[t-1][p][_].packets-this.lossRateWindowStats[0][p][_].packets,b=this.lossRateWindowStats[t-1][p][_].packetsLost-this.lossRateWindowStats[0][p][_].packetsLost;p==="videoSend"||p==="audioSend"?(a+=v,d+=b):(c+=v,h+=b),Number.isNaN(v)||Number.isNaN(v)?f.packetLostRate=0:f.packetLostRate=v<=0||b<=0?0:b/(v+b)});e.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},aie=class extends I0{constructor(){super(...arguments),gt(this,"_stats",Mm),gt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=ia(Mm);let s=t.filter(c=>c.type==="ssrc");this.processSSRCStats(s);let a=t.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var s;let a=ke(s=t.id).call(s,"send");switch("".concat(t.mediaType,"_").concat(a?"send":"recv")){case"video_send":{let c=ia(AL);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{let c=ia(RL),d=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){let h=d.stats,p=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=p,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Oe({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{let c=ia(DL);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{let c=ia(IL);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new Be((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(s=>{let a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{a[c]=s.stat(c)}),t.push(a)}),t}},Fm=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Mv=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),D0=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),ci=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var th=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(th||{});function Um(e,t,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:th.kNone;if(!t)return;let d=Number(t[s]);if(typeof d!="number")return;let h=Number(t[a]);if(typeof h!="number")return;if(!e)return h?d/h*c:void 0;let p=Number(e[s]);if(typeof p!="number")return;let f=Number(e[a]);if(typeof f!="number")return;let _=h-f;return _?(d-p)/_*c:void 0}let OL=class extends I0{constructor(){super(...arguments),gt(this,"_stats",Mm),gt(this,"report",void 0),gt(this,"lastDecodeVideoReceiverStats",new Map),gt(this,"lastVideoFramesRecv",new Map),gt(this,"lastVideoFramesSent",new Map),gt(this,"lastVideoFramesDecode",new Map),gt(this,"lastVideoFramesOutput",new Map),gt(this,"lastVideoJBDelay",new Map),gt(this,"lastAudioJBDelay",new Map),gt(this,"mediaBytesSent",new Map),gt(this,"mediaBytesRetransmit",new Map),gt(this,"mediaBytesTargetEncode",new Map),gt(this,"lastDecodeAudioReceiverStats",new Map),gt(this,"lastAudioConcealment",new Map),gt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ia(Mm),this.report.forEach(e=>{switch(e.type){case ci.OUTBOUND:case ci.INBOUND:{let t=e.mediaType||e.kind,s=!t&&"frameWidth"in e,a=!t&&!("frameWidth"in e);e.type===ci.OUTBOUND?t==="audio"||a?this.processAudioOutboundStats(e):(t==="video"||s)&&this.processVideoOutboundStats(e):e.type===ci.INBOUND&&(t==="audio"||a?this.processAudioInboundStats(e):(t==="video"||s)&&this.processVideoInboundStats(e));break}case ci.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case ci.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:Oe({},bo),remote:Oe({},bo)};return e.forEach(s=>{let a;if(s.type===ci.TRANSPORT&&(a=e.get(s.selectedCandidatePairId)),s.type===ci.CANDIDATE_PAIR&&s.selected&&(a=s),a){let c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){let d=e.get(a.localCandidateId);d&&c(t.local,d)}if(a.remoteCandidateId){let d=e.get(a.remoteCandidateId);d&&c(t.remote,d)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===ci.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ci.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ci.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Oe({},t),Oe({},this.stats.selectedCandidatePair.localCandidate)),e.type===ci.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Oe({},t),Oe({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(a=>a.ssrc===e.ssrc);t||(t=ia(DL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let s=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Um(s,t,"totalProcessingDelay","jitterBufferEmittedCount",th.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,s,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Oe({},t))}calculateAudioFreeze(e,t,s){let a=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&a!=null){let c=a.lts,d=s.timestamp,h=d-c;if(h<=0)return;let p=e.concealedSamples-t.concealedSamples-0,f=a.nonSilent+p,_=e.totalSamplesReceived-t.totalSamplesReceived;if(_<=0)return;let v=80*_/h,b=200*_/h,w=h/_,T=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,f>v&&(a.plc80>0?(e.freezeSamples80+=p,e.freezeMs80+=Math.round(p*w)):(e.freezeSamples80+=f,e.freezeMs80+=Math.round(f*w)),T=a.plc80+1);let U=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,f>b&&(a.plc200>0?(e.freezeSamples200+=p,e.freezeMs200+=Math.round(p*w)):(e.freezeSamples200+=f,e.freezeMs200+=Math.round(f*w)),U=a.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:p,lts:d,plc80:T,plc200:U})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);t||(t=ia(RL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let s=this.lastDecodeVideoReceiverStats.get(t.ssrc),a=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),d=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let h=t.decodedFrame?t.decodedFrame.width:0,p=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,h,p),this.isFirstVideoDecoded[t.ssrc]=!0}if(s){let h=s.stats,p=d-s.lts;t.framesDecodeFreezeTime=h.framesDecodeFreezeTime,t.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(s.lts=Date.now(),t.framesDecodeInterval=p,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<h.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(s.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-s.qpSum)/(e.framesDecoded-s.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Um(s==null?void 0:s.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Um(s==null?void 0:s.stats,t,"totalProcessingDelay","framesDecodeCount",th.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Um(s==null?void 0:s.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",th.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Um(s==null?void 0:s.stats,t,"totalInterFrameDelay","framesDecodeCount",th.kMillisecondsFromSeconds),a&&d-a.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:t.decodeFrameRate})):a?t.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&d-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Oe({},t),lts:s?s.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(a=>a.ssrc===e.ssrc);t||(t=ia(AL),this._stats.videoSend.push(t));let s=this.mediaBytesSent.get(e.ssrc);if(s)s.add(e.bytesSent);else{let a=new A0(10);a.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,a)}if(e.retransmittedBytesSent!==void 0){let a=this.mediaBytesRetransmit.get(e.ssrc);if(a)a.add(e.retransmittedBytesSent);else{let c=new A0(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){let a=this.mediaBytesTargetEncode.get(e.ssrc);if(a)a.add(e.totalEncodedBytesTarget);else{let c=new A0(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){let a=this.lastEncoderMs.get(e.ssrc);if(!a||a.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let c=e.framesEncoded-a.lastFrameCount,d=e.totalEncodeTime-a.lastEncoderTime;t.avgEncodeMs=1e3*d/c}}if(e.framesEncoded&&e.qpSum){let a=this.lastEncoderMs.get(e.ssrc);!a||a.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-a.lastQpSum)/(e.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let a=this.findRemoteStatsId(e.ssrc,ci.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(s=>s.ssrc===e.ssrc);if(t||(t=ia(IL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let s=this.findRemoteStatsId(e.ssrc,ci.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}findRemoteStatsId(e,t){var s;let a=Array.from(Vn(s=this.report).call(s)).find(c=>c.type===t&&c.ssrc===e);return a?a.id:null}processVideoMediaSource(e,t){let s=this.report.get(e);s&&s.width&&s.height&&s.framesPerSecond&&(t.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(e,t){let s=this.report.get(e);s&&(t.inputLevel=s.audioLevel)}processVideoTrackSenderStats(e,t,s){var a,c,d,h;let p=t?this.report.get(t):void 0,f=(a=p==null?void 0:p.framesSent)!==null&&a!==void 0?a:e.framesSent;if(typeof f!="number")return;let _=(c=p==null?void 0:p.frameWidth)!==null&&c!==void 0?c:e.frameWidth,v=(d=p==null?void 0:p.frameHeight)!==null&&d!==void 0?d:e.frameHeight,b=(h=p==null?void 0:p.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof _=="number"&&typeof v=="number"||(_=0,v=0),b==null){let w=Date.now(),T=this.lastVideoFramesSent.get(s.ssrc);T&&w-T.lts>=800?(b=Math.round((f-T.count)/((w-T.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:f,lts:w,rate:b})):T?b=T.rate:this.lastVideoFramesSent.set(s.ssrc,{count:f,lts:w,rate:0})}s.sentFrame={width:_,height:v,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(e,t,s){var a,c,d,h,p;let f=t?this.report.get(t):void 0,_=(a=f==null?void 0:f.framesReceived)!==null&&a!==void 0?a:e.framesReceived,v=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:e.frameWidth,b=(d=f==null?void 0:f.frameHeight)!==null&&d!==void 0?d:e.frameHeight,w=(h=f==null?void 0:f.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,T=(p=f==null?void 0:f.jitterBufferEmittedCount)!==null&&p!==void 0?p:e.jitterBufferEmittedCount;if(typeof _=="number"){let U=this.lastVideoFramesRecv.get(s.ssrc),k=Date.now();s.framesReceivedCount=_;let F=0;U&&k-U.lts>=800?(F=Math.round((_-U.count)/((k-U.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:_,lts:k,rate:F})):U?F=U.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:_,lts:k,rate:0}),s.receivedFrame={width:v||0,height:b||0,frameRate:F||0},s.decodedFrame={width:v||0,height:b||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:v||0,height:b||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(w&&T){let U=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},k=U.jitterBufferMs,F=T-U.jitterBufferEmittedCount;F>0&&(k=1e3*(w-U.jitterBufferDelay)/F),s.jitterBufferMs=k,s.currentDelayMs=Math.round(k),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:T,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(e,t,s){var a,c,d,h;let p=t?this.report.get(t):void 0,f=(a=(c=p==null?void 0:p.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&a!==void 0?a:0,_=(d=(h=p==null?void 0:p.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=f,s.aecReturnLossEnhancement=_}processAudioTrackReceiverStats(e,t,s){var a,c,d,h,p,f,_,v,b;let w=t?this.report.get(t):void 0,T=(a=w==null?void 0:w.removedSamplesForAcceleration)!==null&&a!==void 0?a:e.removedSamplesForAcceleration,U=(c=w==null?void 0:w.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(d=w==null?void 0:w.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,F=(h=w==null?void 0:w.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,K=(p=w==null?void 0:w.audioLevel)!==null&&p!==void 0?p:e==null?void 0:e.audioLevel,Y=(f=w==null?void 0:w.totalSamplesDuration)!==null&&f!==void 0?f:e==null?void 0:e.totalSamplesDuration,X=(_=w==null?void 0:w.concealedSamples)!==null&&_!==void 0?_:e.concealedSamples,re=(v=w==null?void 0:w.silentConcealedSamples)!==null&&v!==void 0?v:e.silentConcealedSamples,te=(b=w==null?void 0:w.concealmentEvents)!==null&&b!==void 0?b:e.concealmentEvents;if(typeof U=="number"&&(s.totalSamplesReceived=U),typeof re=="number"&&(s.silentConcealedSamples=re),typeof te=="number"&&(s.concealmentEvents=te),typeof X=="number"&&(s.concealedSamples=X),T&&U&&(s.accelerateRate=T/U),k&&F){let le=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},xe=le.jitterBufferMs,Ce=F-le.jitterBufferEmittedCount;Ce>0&&(xe=1e3*(k-le.jitterBufferDelay)/Ce),s.jitterBufferMs=Math.round(xe),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:F,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=K;let Z=1920;Y&&U&&(Z=U/Y/50,s.receivedFrames=Math.round(U/Z)),X&&(s.droppedFrames=Math.round(X/Z))}processRemoteInboundStats(e,t){let s=this.report.get(e);s&&(t.packetsLost=s.packetsLost,s.roundTripTime&&(t.rttMs=1e3*s.roundTripTime),s.jitter&&(t.jitterMs=1e3*s.jitter),s.timestamp&&(t.timestamp=s.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let s=t.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let e=0,t=null,s=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{t=t===null?c.diffMean():t+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});let a=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},oie=class extends I0{updateStats(){return Be.resolve()}};function O0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,d=function(){let h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new aie(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new OL(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;let p=h.getStats();return!!(p instanceof Be||function(f){return!!f&&(typeof f=="object"||typeof f=="function")&&typeof f.then=="function"}(p))}(e)?new OL(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new oie(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}let jL="websdk_ng_install_id";function j0(){try{if($("INSTALL_ID"))return $("INSTALL_ID");let e=window.localStorage.getItem(jL);return e||(e=dd(),window.localStorage.setItem(jL,e)),ts("INSTALL_ID",e),e}catch{return}}let Ii=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let s=t[1],a=t[2];return"".concat(s,".").concat(a)}return"4.0.0.999"}("4.24.0"),P0=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),ud=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),Ar=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");let a=s.join(""),c=[];for(let p=0;p<6;p++)c.push("1");let d=c.join(""),h={};return h[e]=a,h[t]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ar;let Fv={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},k0={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},L0="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",M0={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Es=Oe(Oe(Oe(Oe({},M0),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:k0,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Fv),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function ts(e,t,s){var a,c,d;ke(a=Object.keys(Es)).call(a,e)&&(!s&&ke(c=Object.keys(Ba)).call(c,e)||(Es[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Es.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(d=!!t,Es.USE_NEW_NETWORK_CONFIG=d,d&&(Es.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Es.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Es.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Es.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Es.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Es.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Es.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Es.ENABLE_INSTANT_VIDEO=!0,Es.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Es.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Es.NEW_TURN_MODE||(Es.NEW_TURN_MODE=4))))}function $(e){return Es[e]}P0||(Es.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Es.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Es.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Es.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Es.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Es.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Es.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Es.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Es.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Es.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Es.AREAS=["NORTH_AMERICA","OVERSEA"]);let PL=function(e){return e[e.REALTIME=1]="REALTIME",e}({}),Ba={};var _t=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(_t||{});let Vm=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let kL=128,cie=96,LL=1e3,sh=10,lie=0;var ML=(()=>{var e={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>Ce,Printer:()=>Yt,parse:()=>Le,print:()=>Ke});let h=`
`,p="".concat("\r").concat(h),f=" ",_;function v(Ne){return Ne>="0"&&Ne<="9"}function b(Ne){return Ne>="!"&&Ne<="~"}function w(Ne){return b(Ne)||Ne>=""&&Ne<=""}function T(Ne){return Ne==="!"||Ne>="#"&&Ne<="'"||Ne>="*"&&Ne<="+"||Ne>="-"&&Ne<="."||Ne>="0"&&Ne<="9"||Ne>="A"&&Ne<="Z"||Ne>="^"&&Ne<="~"}function U(Ne){return Ne>="1"&&Ne<="9"}function k(Ne){return Ne>="A"&&Ne<="Z"||Ne>="a"&&Ne<="z"}function F(Ne){return Ne==="d"||Ne==="h"||Ne==="m"||Ne==="s"}function K(Ne){return Ne>""&&Ne<"	"||Ne>"\v"&&Ne<"\f"||Ne>""&&Ne<""}function Y(Ne){return k(Ne)||v(Ne)||Ne==="+"||Ne==="/"}function X(Ne){return v(Ne)||k(Ne)||Ne==="+"||Ne==="/"||Ne==="-"||Ne==="_"}function re(Ne){return k(Ne)||v(Ne)||Ne==="+"||Ne==="/"}function te(Ne,P){var Q=Object.keys(Ne);if(Object.getOwnPropertySymbols){var se=Object.getOwnPropertySymbols(Ne);P&&(se=se.filter(function(Pe){return Object.getOwnPropertyDescriptor(Ne,Pe).enumerable})),Q.push.apply(Q,se)}return Q}function Z(Ne){for(var P=1;P<arguments.length;P++){var Q=arguments[P]!=null?arguments[P]:{};P%2?te(Object(Q),!0).forEach(function(se){le(Ne,se,Q[se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ne,Object.getOwnPropertyDescriptors(Q)):te(Object(Q)).forEach(function(se){Object.defineProperty(Ne,se,Object.getOwnPropertyDescriptor(Q,se))})}return Ne}function le(Ne,P,Q){return P in Ne?Object.defineProperty(Ne,P,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Ne[P]=Q,Ne}(function(Ne){Ne.VERSION="v",Ne.ORIGIN="o",Ne.SESSION_NAME="s",Ne.INFORMATION="i",Ne.URI="u",Ne.EMAIL="e",Ne.PHONE="p",Ne.CONNECTION="c",Ne.BANDWIDTH="b",Ne.TIME="t",Ne.REPEAT="r",Ne.ZONE_ADJUSTMENTS="z",Ne.KEY="k",Ne.ATTRIBUTE="a",Ne.MEDIA="m"})(_||(_={}));class xe{consumeText(P,Q){let se=Q;for(;se<P.length;){let Pe=P[se];if(Pe==="\0"||Pe==="\r"||Pe===h)break;se+=1}if(se-Q==0)throw new Error("Invalid text, at ".concat(P));return se}consumeUnicastAddress(P,Q,se){return this.consumeTill(P,Q,f)}consumeOneOrMore(P,Q,se){let Pe=Q;for(;se(P[Pe]);)Pe++;if(Pe-Q==0)throw new Error("Invalid rule at ".concat(Q,"."));return Pe}consumeSpace(P,Q){if(P[Q]===f)return Q+1;throw new Error("Invalid space at ".concat(Q,"."))}consumeIP4Address(P,Q){let se=Q;for(let Pe=0;Pe<4;Pe++)if(se=this.consumeDecimalUChar(P,se),Pe!==3){if(P[se]!==".")throw new Error("Invalid IP4 address.");se++}return se}consumeDecimalUChar(P,Q){let se=Q;for(let Et=0;Et<3&&v(P[se]);Et++,se++);if(se-Q==0)throw new Error("Invalid decimal uchar.");let Pe=parseInt(P.slice(Q,se));if(Pe>=0&&Pe<=255)return se;throw new Error("Invalid decimal uchar")}consumeIP6Address(P,Q){let se=this.consumeHexpart(P,Q);return P[se]===":"&&(se+=1,se=this.consumeIP4Address(P,se)),se}consumeHexpart(P,Q){let se=Q;if(P[se]===":"&&P[se+1]===":"){se+=2;try{se=this.consumeHexseq(P,se)}catch{}return se}if(se=this.consumeHexseq(P,se),P[se]===":"&&P[se+1]===":"){se+=2;try{se=this.consumeHexseq(P,se)}catch{}return se}return se}consumeHexseq(P,Q){let se=Q;for(;se=this.consumeHex4(P,se),P[se]===":"&&P[se+1]!==":";)se+=1;return se}consumeHex4(P,Q){let se=0;for(;se<4;se++)if(!((Pe=P[Q+se])>="0"&&Pe<="9"||Pe>="a"&&Pe<="f"||Pe>="A"&&Pe<="F")){if(se===0)throw new Error("Invalid hex 4");break}var Pe;return Q+se}consumeFQDN(P,Q){let se=Q;for(;v(P[se])||k(P[se])||P[se]==="-"||P[se]===".";)se+=1;if(se-Q<4)throw new Error("Invalid FQDN");return se}consumeExtnAddr(P,Q){return this.consumeOneOrMore(P,Q,w)}consumeMulticastAddress(P,Q,se){switch(se){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(P,Q);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(P,Q);default:try{return this.consumeFQDN(P,Q)}catch{return this.consumeExtnAddr(P,Q)}}}consumeIP6MulticastAddress(P,Q){let se=this.consumeHexpart(P,Q);return P[se]==="/"?this.consumeInteger(P,se+1):se}consumeIP4MulticastAddress(P,Q){let se=Q+3,Pe=P.slice(Q,se),Et=parseInt(Pe);if(Et<224||Et>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ms=0;ms<3;ms++){if(P[se]!==".")throw new Error("Invalid IP4 multicast address.");se+=1,se=this.consumeDecimalUChar(P,se)}return P[se]==="/"&&(se+=1),se=this.consumeTTL(P,se),P[se]==="/"&&(se=this.consumeInteger(P,se)),se}consumeInteger(P,Q){if(!U(P[Q]))throw new Error("Invalid integer.");for(Q+=1;v(P[Q]);)Q+=1;return Q}consumeTTL(P,Q){if(P[Q]==="0")return Q+1;if(!U(P[Q]))throw new Error("Invalid TTL.");Q+=1;for(let se=0;se<2&&v(P[Q]);se++)Q+=1;return Q}consumeToken(P,Q){return this.consumeOneOrMore(P,Q,T)}consumeTime(P,Q){let se=Q;if(P[se]==="0")return se+1;for(U(P[se])&&(se+=1);v(P[se]);)se++;if(se-Q<10)throw new Error("Invalid time");return se}consumeAddress(P,Q){return this.consumeTill(P,Q,f)}consumeTypedTime(P,Q){let se=Q;return se=this.consumeOneOrMore(P,se,v),F(P[se])?se+1:se}consumeRepeatInterval(P,Q){if(!U(P[Q]))throw new Error("Invalid repeat interval");for(Q+=1;v(P[Q]);)Q+=1;return F(P[Q])&&(Q+=1),Q}consumePort(P,Q){return this.consumeOneOrMore(P,Q,v)}consume(P,Q,se){for(let Pe=0;Pe<se.length;Pe++){if(Q+Pe>=P.length)throw new Error("consume exceeding value length");if(P[Q+Pe]!==se[Pe])throw new Error("consume ".concat(se," failed at ").concat(Pe))}return Q+se.length}consumeTill(P,Q,se){let Pe=Q;for(;Pe<P.length&&(typeof se!="string"||P[Pe]!==se)&&(typeof se!="function"||!se(P[Pe]));)Pe++;return Pe}}class Ce extends xe{constructor(){super(),le(this,"records",[]),le(this,"currentLine",0)}parse(P){let Q=this.probeEOL(P);this.records=P.split(Q).filter(pc=>!!Jr(pc).call(pc)).map(this.parseLine),this.currentLine=0;let se=this.parseVersion(),Pe=this.parseOrigin(),Et=this.parseSessionName(),ms=this.parseInformation(),Qs=this.parseUri(),Ui=this.parseEmail(),_a=this.parsePhone(),Cf=this.parseConnection(),Dd=this.parseBandWidth(),Ph=this.parseTimeFields(),QE=this.parseKey(),ZE=this.parseSessionAttribute(),Vi=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:se,origin:Pe,sessionName:Et,information:ms,uri:Qs,emails:Ui,phones:_a,connection:Cf,bandwidths:Dd,timeFields:Ph,key:QE,attributes:ZE,mediaDescriptions:Vi}}getCurrentRecord(){let P=this.records[this.currentLine];if(!P)throw new Error("Record doesn't exit.");return P}probeEOL(P){for(let Q=0;Q<P.length;Q++)if(P[Q]===h)return P[Q-1]==="\r"?p:h;throw new Error("Invalid newline character.")}parseLine(P,Q){if(P.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let se=P[0];if(P[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:se,value:P.slice(2),line:Q,cur:0}}parseSessionAttribute(){let P=new wt;for(;this.currentLine<this.records.length;){let Q=this.getCurrentRecord();if(Q.type!==_.ATTRIBUTE)break;let se={attField:this.extractOneOrMore(Q,Pe=>T(Pe)&&Pe!==":"),_cur:0};Q.value[Q.cur]===":"&&(Q.cur+=1,se.attValue=this.extractOneOrMore(Q,K)),P.parse(se),this.currentLine++}return P.digest()}parseMediaAttributes(P){let Q=new Ct(P);for(;this.currentLine<this.records.length;){let se=this.getCurrentRecord();if(se.type!==_.ATTRIBUTE)break;let Pe={attField:this.extractOneOrMore(se,Et=>T(Et)&&Et!==":"),_cur:0};se.value[se.cur]===":"&&(se.cur+=1,Pe.attValue=this.extractOneOrMore(se,K)),Q.parse(Pe),this.currentLine++}return Q.digest()}parseKey(){let P=this.getCurrentRecord();if(P.type===_.KEY){if(P.value==="prompt"||P.value==="clear:"||P.value==="base64:"||P.value==="uri:")return P.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let P=this.getCurrentRecord();if(P.type===_.ZONE_ADJUSTMENTS){let Q=[];for(;;)try{let se=this.extract(P,this.consumeTime);this.consumeSpaceForRecord(P);let Pe=!1;P.value[P.cur]==="-"&&(Pe=!0,P.cur+=1);let Et=this.extract(P,this.consumeTypedTime);Q.push({time:se,typedTime:Et,back:Pe})}catch{break}if(Q.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,Q}return[]}parseRepeat(){let P=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.REPEAT)break;{let se=this.extract(Q,this.consumeRepeatInterval),Pe=this.parseTypedTime(Q);P.push({repeatInterval:se,typedTimes:Pe}),this.currentLine++}}return P}parseTypedTime(P){let Q=[];for(;;)try{this.consumeSpaceForRecord(P),Q.push(this.extract(P,this.consumeTypedTime))}catch{break}if(Q.length===0)throw new Error("Invalid typed time.");return Q}parseTime(){let P=this.getCurrentRecord(),Q=this.extract(P,this.consumeTime);this.consumeSpaceForRecord(P);let se=this.extract(P,this.consumeTime);return this.currentLine++,{startTime:Q,stopTime:se}}parseBandWidth(){let P=[];for(;this.currentLine<this.records.length;){let Q=this.getCurrentRecord();if(Q.type!==_.BANDWIDTH)break;{let se=this.extractOneOrMore(Q,T);if(Q.value[Q.cur]!==":")throw new Error("Invalid bandwidth field.");Q.cur++;let Pe=this.extractOneOrMore(Q,v);P.push({bwtype:se,bandwidth:Pe}),this.currentLine++}}return P}parseVersion(){let P=this.getCurrentRecord();if(P.type!==_.VERSION)throw new Error("first sdp record must be version");let Q=P.value.slice(0,this.consumeOneOrMore(P.value,0,v));if(Q.length!==P.value.length)throw new Error('invalid proto version, "v='.concat(P.value,'"'));return this.currentLine++,Q}parseOrigin(){let P=this.getCurrentRecord();if(P.type!==_.ORIGIN)throw new Error("second line of sdp must be origin");let Q=this.extractOneOrMore(P,w);this.consumeSpaceForRecord(P);let se=this.extractOneOrMore(P,v);this.consumeSpaceForRecord(P);let Pe=this.extractOneOrMore(P,v);this.consumeSpaceForRecord(P);let Et=this.extractOneOrMore(P,T);this.consumeSpaceForRecord(P);let ms=this.extractOneOrMore(P,T);this.consumeSpaceForRecord(P);let Qs=this.extract(P,this.consumeUnicastAddress);return this.currentLine++,{username:Q,sessId:se,sessVersion:Pe,nettype:Et,addrtype:ms,unicastAddress:Qs}}parseSessionName(){let P=this.getCurrentRecord();if(P.type===_.SESSION_NAME){let Q=this.extract(P,this.consumeText);return this.currentLine++,Q}}parseInformation(){let P=this.getCurrentRecord();if(P.type!==_.INFORMATION)return;let Q=this.extract(P,this.consumeText);return this.currentLine++,Q}parseUri(){let P=this.getCurrentRecord();if(P.type===_.URI)return this.currentLine++,P.value}parseEmail(){let P=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.EMAIL)break;P.push(Q.value),this.currentLine++}return P}parsePhone(){let P=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.PHONE)break;P.push(Q.value),this.currentLine++}return P}parseConnection(){let P=this.getCurrentRecord();if(P.type===_.CONNECTION){let Q=this.extractOneOrMore(P,T);this.consumeSpaceForRecord(P);let se=this.extractOneOrMore(P,T);this.consumeSpaceForRecord(P);let Pe=this.extract(P,this.consumeAddress);return this.currentLine++,{nettype:Q,addrtype:se,address:Pe}}}parseMedia(){let P=this.getCurrentRecord(),Q=this.extract(P,this.consumeToken);this.consumeSpaceForRecord(P);let se=this.extract(P,this.consumePort);P.value[P.cur]==="/"&&(P.cur+=1,se+=this.extract(P,this.consumeInteger)),this.consumeSpaceForRecord(P);let Pe=[];for(Pe.push(this.extract(P,this.consumeToken));P.value[P.cur]==="/";)P.cur+=1,Pe.push(this.extract(P,this.consumeToken));if(Pe.length===0)throw new Error("Invalid proto");let Et=this.parseFmt(P);return this.currentLine++,{mediaType:Q,port:se,protos:Pe,fmts:Et}}parseTimeFields(){let P=[];for(;this.getCurrentRecord().type===_.TIME;){let Q=this.parseTime(),se=this.parseRepeat(),Pe=this.parseZone();P.push({time:Q,repeats:se,zones:Pe})}return P}parseMediaDescription(){let P=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.MEDIA;){let Q=this.parseMedia(),se=this.parseInformation(),Pe=this.parseConnections(),Et=this.parseBandWidth(),ms=this.parseKey(),Qs=this.parseMediaAttributes(Q);P.push({media:Q,information:se,connections:Pe,bandwidths:Et,key:ms,attributes:Qs})}return P}parseConnections(){let P=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.CONNECTION;)P.push(this.parseConnection());return P}parseFmt(P){let Q=[];for(;;)try{this.consumeSpaceForRecord(P),Q.push(this.extract(P,this.consumeToken))}catch{break}if(Q.length===0)throw new Error("Invalid fmts");return Q}extract(P,Q){for(var se=arguments.length,Pe=new Array(se>2?se-2:0),Et=2;Et<se;Et++)Pe[Et-2]=arguments[Et];let ms=Q.call(this,P.value,P.cur,...Pe),Qs=P.value.slice(P.cur,ms);return P.cur=ms,Qs}extractOneOrMore(P,Q){let se=this.consumeOneOrMore(P.value,P.cur,Q),Pe=P.value.slice(P.cur,se);return P.cur=se,Pe}consumeSpaceForRecord(P){if(P.value[P.cur]!==f)throw new Error("Invalid space at ".concat(P.cur,"."));P.cur+=1}}class je extends xe{constructor(){super(...arguments),le(this,"attributes",void 0),le(this,"digested",!1)}extractOneOrMore(P,Q,se){let Pe=this.consumeOneOrMore(P.attValue,P._cur,Q),Et=P.attValue.slice(P._cur,Pe),[ms,Qs]=se||[];if(typeof ms=="number"&&Et.length<ms)throw new Error("error in length, should be more or equal than ".concat(ms," characters."));if(typeof Qs=="number"&&Et.length>Qs)throw new Error("error in length, should be less or equal than ".concat(Qs," characters."));return P._cur=Pe,Et}consumeAttributeSpace(P){if(P.attValue[P._cur]!==f)throw new Error("Invalid space at ".concat(P._cur,"."));P._cur+=1}extract(P,Q){if(!P.attValue)throw new Error("Nothing to extract from attValue.");for(var se=arguments.length,Pe=new Array(se>2?se-2:0),Et=2;Et<se;Et++)Pe[Et-2]=arguments[Et];let ms=Q.call(this,P.attValue,P._cur,...Pe),Qs=P.attValue.slice(P._cur,ms);return P._cur=ms,Qs}atEnd(P){if(!P.attValue)throw new Error;return P._cur>=P.attValue.length}peekChar(P){if(!P.attValue)throw new Error;return P.attValue[P._cur]}peek(P,Q){if(!P.attValue)throw new Error;for(let se=0;se<Q.length;se++)if(Q[se]!==P.attValue[P._cur+se])return!1;return!0}parseIceUfrag(P){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(P,Y,[4,256])}parseIcePwd(P){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(P,Y,[22,256])}parseIceOptions(P){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let Q=[];for(;!this.atEnd(P);){Q.push(this.extractOneOrMore(P,Y));try{this.consumeAttributeSpace(P)}catch(se){if(this.atEnd(P))break;throw se}}this.attributes.iceOptions=Q}parseFingerprint(P){let Q=this.extract(P,this.consumeToken);this.consumeAttributeSpace(P);let se=this.extract(P,this.consumeTill);this.attributes.fingerprints.push({hashFunction:Q,fingerprint:se})}parseExtmap(P){let Q=this.extractOneOrMore(P,v),se;this.peekChar(P)==="/"&&(this.extract(P,this.consume,"/"),se=this.extract(P,this.consumeToken)),this.consumeAttributeSpace(P);let Pe=this.extract(P,this.consumeTill,f),Et=Z(Z({entry:parseInt(Q,10)},se&&{direction:se}),{},{extensionName:Pe});this.peekChar(P)===f&&(this.consumeAttributeSpace(P),Et.extensionAttributes=this.extract(P,this.consumeTill)),this.attributes.extmaps.push(Et)}parseSetup(P){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let Q=this.extract(P,this.consumeTill);if(Q!=="active"&&Q!=="passive"&&Q!=="actpass"&&Q!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=Q}}class wt extends je{constructor(){super(...arguments),le(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(P){if(this.digested)throw new Error("already digested");try{switch(P.attField){case"group":this.parseGroup(P);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(P);break;case"ice-pwd":this.parseIcePwd(P);break;case"ice-options":this.parseIceOptions(P);break;case"fingerprint":this.parseFingerprint(P);break;case"setup":this.parseSetup(P);break;case"tls-id":this.parseTlsId(P);break;case"identity":this.parseIdentity(P);break;case"extmap":this.parseExtmap(P);break;case"msid-semantic":this.parseMsidSemantic(P);break;default:P.ignored=!0,this.attributes.unrecognized.push(P)}}catch(Q){throw console.error("parsing session attribute ".concat(P.attField,' error, "a=').concat(P.attField,":").concat(P.attValue,'"')),Q}if(!P.ignored&&P.attValue&&!this.atEnd(P))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(P){let Q=this.extract(P,this.consumeToken),se=[];for(;!this.atEnd(P)&&this.peekChar(P)===f;)this.consumeAttributeSpace(P),se.push(this.extract(P,this.consumeToken));this.attributes.groups.push({semantic:Q,identificationTag:se})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(P){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(P,X)}parseIdentity(P){let Q=this.extractOneOrMore(P,re),se=[];for(;!this.atEnd(P)&&this.peekChar(P)===f;){this.consumeAttributeSpace(P);let Pe=this.extract(P,this.consumeToken);this.extract(P,this.consume,"=");let Et=this.extractOneOrMore(P,ms=>ms!==f&&K(ms));se.push({name:Pe,value:Et})}this.attributes.identities.push({assertionValue:Q,extensions:se})}parseMsidSemantic(P){this.peekChar(P)===f&&this.consumeAttributeSpace(P);let Q={semantic:this.extract(P,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(P)}catch{break}if(this.peekChar(P)==="*"){this.extract(P,this.consume,"*"),Q.applyForAll=!0;break}{let se=this.extract(P,this.consumeTill,f);Q.identifierList.push(se)}}this.attributes.msidSemantic=Q}}class Ct extends je{constructor(P){super(),le(this,"attributes",void 0),P.protos.indexOf("RTP")!==-1||P.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(P){if(this.digested)throw new Error("already digested");try{switch(P.attField){case"extmap":this.parseExtmap(P);break;case"setup":this.parseSetup(P);break;case"ice-ufrag":this.parseIceUfrag(P);break;case"ice-pwd":this.parseIcePwd(P);break;case"ice-options":this.parseIceOptions(P);break;case"candidate":this.parseCandidate(P);break;case"remote-candidate":this.parseRemoteCandidate(P);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(P);break;case"rtpmap":this.parseRtpmap(P);break;case"ptime":this.parsePtime(P);break;case"maxptime":this.parseMaxPtime(P);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(P);break;case"ssrc":this.parseSSRC(P);break;case"fmtp":this.parseFmtp(P);break;case"rtcp-fb":this.parseRtcpFb(P);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(P);break;case"mid":this.parseMid(P);break;case"msid":this.parseMsid(P);break;case"imageattr":this.parseImageAttr(P);break;case"rid":this.parseRid(P);break;case"simulcast":this.parseSimulcast(P);break;case"sctp-port":this.parseSctpPort(P);break;case"max-message-size":this.parseMaxMessageSize(P);break;case"ssrc-group":this.parseSSRCGroup(P);break;default:P.ignored=!0,this.attributes.unrecognized.push(P)}}catch(Q){throw console.error("parsing media attribute ".concat(P.attField,' error, "a=').concat(P.attField,":").concat(P.attValue,'"')),Q}if(!P.ignored&&P.attValue&&!this.atEnd(P))throw new Error("attribute parsing error")}parseCandidate(P){let Q=this.extractOneOrMore(P,Y,[1,32]);this.consumeAttributeSpace(P);let se=this.extractOneOrMore(P,v,[1,5]);this.consumeAttributeSpace(P);let Pe=this.extract(P,this.consumeToken);this.consumeAttributeSpace(P);let Et=this.extractOneOrMore(P,v,[1,10]);this.consumeAttributeSpace(P);let ms=this.extract(P,this.consumeAddress);this.consumeAttributeSpace(P);let Qs=this.extract(P,this.consumePort);this.consumeAttributeSpace(P),this.extract(P,this.consume,"typ"),this.consumeAttributeSpace(P);let Ui={foundation:Q,componentId:se,transport:Pe,priority:Et,connectionAddress:ms,port:Qs,type:this.extract(P,this.consumeToken),extension:{}};for(this.peek(P," raddr")&&(this.extract(P,this.consume," raddr"),this.consumeAttributeSpace(P),Ui.relAddr=this.extract(P,this.consumeAddress)),this.peek(P," rport")&&(this.extract(P,this.consume," rport"),this.consumeAttributeSpace(P),Ui.relPort=this.extract(P,this.consumePort));this.peekChar(P)===f;){this.consumeAttributeSpace(P);let _a=this.extract(P,this.consumeToken);this.consumeAttributeSpace(P),Ui.extension[_a]=this.extractOneOrMore(P,b)}this.attributes.candidates.push(Ui)}parseRemoteCandidate(P){let Q=[];for(;;){let se=this.extractOneOrMore(P,v,[1,5]);this.consumeAttributeSpace(P);let Pe=this.extract(P,this.consumeAddress);this.consumeAttributeSpace(P);let Et=this.extract(P,this.consumePort);Q.push({componentId:se,connectionAddress:Pe,port:Et});try{this.consumeAttributeSpace(P)}catch{break}}this.attributes.remoteCandidatesList.push(Q)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(P){let Q=this.extract(P,this.consumeToken);this.consumeAttributeSpace(P);let se=this.extract(P,this.consumeTill,"/");this.extract(P,this.consume,"/");let Pe={encodingName:se,clockRate:this.extractOneOrMore(P,v)};this.atEnd(P)||this.peekChar(P)!=="/"||(this.extract(P,this.consume,"/"),Pe.encodingParameters=parseInt(this.extract(P,this.consumeTill),10));let Et=this.attributes.payloads.find(ms=>ms.payloadType===parseInt(Q,10));Et?Et.rtpMap=Pe:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtpMap:Pe,rtcpFeedbacks:[]})}parsePtime(P){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(P,this.consumeTill)}parseMaxPtime(P){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(P,this.consumeTill)}parseDirection(P){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=P.attField}parseSSRC(P){let Q=this.extractOneOrMore(P,v);this.consumeAttributeSpace(P);let se=this.extract(P,this.consumeTill,":"),Pe;this.peekChar(P)===":"&&(this.extract(P,this.consume,":"),Pe=this.extract(P,this.consumeTill));let Et=this.attributes.ssrcs.find(ms=>ms.ssrcId===parseInt(Q,10));Et?Et.attributes[se]=Pe:this.attributes.ssrcs.push({ssrcId:parseInt(Q,10),attributes:{[se]:Pe}})}parseFmtp(P){let Q=this.extract(P,this.consumeTill,f);this.consumeAttributeSpace(P);let se=this.extract(P,this.consumeTill),Pe={};se.split(";").forEach(ms=>{let[Qs,Ui]=ms.split("=");Qs=Jr(Qs).call(Qs);let _a=typeof Ui=="string"?Jr(Ui).call(Ui):null;typeof Qs=="string"&&Qs.length>0&&(Pe[Qs]=_a)});let Et=this.attributes.payloads.find(ms=>ms.payloadType===parseInt(Q,10));Et?Et.fmtp={parameters:Pe}:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[],fmtp:{parameters:Pe}})}parseFmtParameters(P){let Q={},se=this.extract(P,this.consumeTill,"=");P._cur++;let Pe=this.extract(P,this.consumeTill,";");for(Q[se]=Pe;P.attValue[P._cur]===";";){let Et=this.extract(P,this.consumeTill,"=");P._cur++;let ms=this.extract(P,this.consumeTill,";");Q[Et]=ms}return Q}parseRtcpFb(P){let Q="";Q=this.peekChar(P)==="*"?this.extract(P,this.consume,"*"):this.extract(P,this.consumeTill,f),this.consumeAttributeSpace(P);let se=this.extract(P,this.consumeTill,f),Pe;if(se==="trr-int")Pe={type:se,interval:this.extract(P,this.consumeTill)};else{let Et={type:se};this.peekChar(P)===f&&(this.consumeAttributeSpace(P),Et.parameter=this.extract(P,this.consumeToken),this.peekChar(P)===f&&(Et.additional=this.extract(P,this.consumeTill))),Pe=Et}if(Q==="*")this.attributes.rtcpFeedbackWildcards.push(Pe);else{let Et=this.attributes.payloads.find(ms=>ms.payloadType===parseInt(Q,10));Et?Et.rtcpFeedbacks.push(Pe):this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[Pe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(P){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let Q={port:this.extract(P,this.consumePort)};this.peekChar(P)===f&&(this.consumeAttributeSpace(P),Q.netType=this.extractOneOrMore(P,T),this.consumeAttributeSpace(P),Q.addressType=this.extractOneOrMore(P,T),this.consumeAttributeSpace(P),Q.address=this.extract(P,this.consumeAddress)),this.attributes.rtcp=Q}parseMsid(P){let Q={id:this.extractOneOrMore(P,T,[1,64])};this.peekChar(P)===f&&(this.consumeAttributeSpace(P),Q.appdata=this.extractOneOrMore(P,T,[1,64])),this.attributes.msids.push(Q)}parseImageAttr(P){this.attributes.imageattr.push(P.attValue)}parseRid(P){let Q=this.extractOneOrMore(P,Pe=>k(Pe)||v(Pe)||Pe==="_"||Pe==="-");this.consumeAttributeSpace(P);let se={id:Q,direction:this.extract(P,this.consumeToken),params:[]};if(this.peekChar(P)===f){if(this.consumeAttributeSpace(P),this.peek(P,"pt=")){this.extract(P,this.consume,"pt=");let Pe=[];for(;;){let Et=this.extract(P,this.consumeToken);Pe.push(Et);try{this.extract(P,this.consume,",")}catch{break}}se.payloads=Pe,this.peekChar(P)===f&&this.extract(P,this.consume,f)}for(;;){let Pe=this.extract(P,this.consumeToken);switch(Pe){case"depend":{let Et={type:Pe,rids:this.extract(P,this.consume,"=").split(",")};se.params.push(Et);break}default:{let Et={type:Pe};this.peekChar(P)==="="&&(this.extract(P,this.consume,"="),Et.val=this.extract(P,this.consumeTill,";")),se.params.push(Et)}}try{this.extract(P,this.consume,";")}catch{break}}}this.attributes.rids.push(se)}parseSimulcast(P){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=P.attValue,this.extract(P,this.consumeTill)}parseSctpPort(P){this.attributes.sctpPort=this.extractOneOrMore(P,v,[1,5])}parseMaxMessageSize(P){this.attributes.maxMessageSize=this.extractOneOrMore(P,v,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(P){this.attributes.mid=this.extract(P,this.consumeToken)}parseSSRCGroup(P){let Q=this.extract(P,this.consumeToken),se=[];for(;;)try{this.consumeAttributeSpace(P);let Pe=this.extract(P,this.consumeInteger);se.push(parseInt(Pe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:Q,ssrcIds:se})}}function mt(Ne,P,Q){return P in Ne?Object.defineProperty(Ne,P,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Ne[P]=Q,Ne}class Yt{constructor(){mt(this,"eol",p)}print(P,Q){let se="";return Q&&(this.eol=Q),se+=this.printVersion(P.version),se+=this.printOrigin(P.origin),se+=this.printSessionName(P.sessionName),se+=this.printInformation(P.information),se+=this.printUri(P.uri),se+=this.printEmail(P.emails),se+=this.printPhone(P.phones),se+=this.printConnection(P.connection),se+=this.printBandwidth(P.bandwidths),se+=this.printTimeFields(P.timeFields),se+=this.printKey(P.key),se+=this.printSessionAttributes(P.attributes),se+=this.printMediaDescription(P.mediaDescriptions),se}printVersion(P){return"v=".concat(P).concat(this.eol)}printOrigin(P){return"o=".concat(P.username," ").concat(P.sessId," ").concat(P.sessVersion," ").concat(P.nettype," ").concat(P.addrtype," ").concat(P.unicastAddress).concat(this.eol)}printSessionName(P){return P?"s=".concat(P).concat(this.eol):""}printInformation(P){return P?"i=".concat(P).concat(this.eol):""}printUri(P){return P?"u=".concat(P).concat(this.eol):""}printEmail(P){let Q="";for(let se of P)Q+="e=".concat(se).concat(this.eol);return Q}printPhone(P){let Q="";for(let se of P)Q+="e=".concat(se).concat(this.eol);return Q}printConnection(P){return P?"c=".concat(P.nettype," ").concat(P.addrtype," ").concat(P.address).concat(this.eol):""}printBandwidth(P){let Q="";for(let se of P)Q+="b=".concat(se.bwtype,":").concat(se.bandwidth).concat(this.eol);return Q}printTimeFields(P){let Q="";for(let se of P){Q+="t=".concat(se.time.startTime," ").concat(se.time.startTime).concat(this.eol);for(let Pe of se.repeats)Q+="r=".concat(Pe.repeatInterval," ").concat(Pe.typedTimes.join(" ")).concat(this.eol);se.zoneAdjustments&&(Q+="z=",Q+="z=".concat(se.zoneAdjustments.map(Pe=>"".concat(Pe.time," ").concat(Pe.back?"-":""," ").concat(Pe.typedTime)).join(" ")).concat(this.eol),Q+=this.eol)}return Q}printKey(P){return P?"k=".concat(P).concat(this.eol):""}printAttributes(P){let Q="";for(let se of P)Q+="a=".concat(se.attField).concat(se.attValue?":".concat(se.attValue):"").concat(this.eol);return Q}printMediaDescription(P){let Q="";for(let se of P)Q+=this.printMedia(se.media),Q+=this.printInformation(se.information),Q+=this.printConnections(se.connections),Q+=this.printBandwidth(se.bandwidths),Q+=this.printKey(se.key),Q+=this.printMediaAttributes(se);return Q}printConnections(P){let Q="";for(let se of P)Q+=this.printConnection(se);return Q}printMedia(P){return"m=".concat(P.mediaType," ").concat(P.port," ").concat(P.protos.join("/")," ").concat(P.fmts.join(" ")).concat(this.eol)}printSessionAttributes(P){return new Ur(this.eol).print(P)}printMediaAttributes(P){return new we(this.eol).print(P)}}class zt{constructor(P){mt(this,"eol",void 0),this.eol=P}printIceUfrag(P){return P===void 0?"":"a=ice-ufrag:".concat(P).concat(this.eol)}printIcePwd(P){return P===void 0?"":"a=ice-pwd:".concat(P).concat(this.eol)}printIceOptions(P){return P===void 0?"":"a=ice-options:".concat(P.join(f)).concat(this.eol)}printFingerprints(P){return P.length>0?P.map(Q=>"a=fingerprint:".concat(Q.hashFunction).concat(f).concat(Q.fingerprint)).join(this.eol)+this.eol:""}printExtmap(P){return P.map(Q=>"a=extmap:".concat(Q.entry).concat(Q.direction?"/".concat(Q.direction):"").concat(f).concat(Q.extensionName).concat(Q.extensionAttributes?"".concat(f).concat(Q.extensionAttributes):"").concat(this.eol)).join("")}printSetup(P){return P===void 0?"":"a=setup:".concat(P).concat(this.eol)}printUnrecognized(P){return P.map(Q=>"a=".concat(Q.attField).concat(Q.attValue?":".concat(Q.attValue):"").concat(this.eol)).join("")}}class Ur extends zt{print(P){let Q="";return Q+=this.printGroups(P.groups),Q+=this.printMsidSemantic(P.msidSemantic),Q+=this.printIceLite(P.iceLite),Q+=this.printIceUfrag(P.iceUfrag),Q+=this.printIcePwd(P.icePwd),Q+=this.printIceOptions(P.iceOptions),Q+=this.printFingerprints(P.fingerprints),Q+=this.printSetup(P.setup),Q+=this.printTlsId(P.tlsId),Q+=this.printIdentity(P.identities),Q+=this.printExtmap(P.extmaps),Q+=this.printUnrecognized(P.unrecognized),Q}printGroups(P){let Q="";return P.length>0&&(Q+=P.map(se=>"a=group:".concat(se.semantic).concat(se.identificationTag.map(Pe=>"".concat(f).concat(Pe)).join("")).concat(this.eol)).join("")),Q}printIceLite(P){return P===void 0?"":"a=ice-lite"+this.eol}printTlsId(P){return P?"a=tls-id:".concat(P).concat(this.eol):""}printIdentity(P){return P.length===0?"":P.map(Q=>"a=identity:".concat(Q.assertionValue).concat(Q.extensions.map(se=>"".concat(f).concat(se.name).concat(se.value?"=".concat(se.value):"")))).join(this.eol)+this.eol}printMsidSemantic(P){if(!P)return"";let Q="a=msid-semantic:".concat(P.semantic);return P.applyForAll?Q+="".concat(f,"*"):P.identifierList.length>0&&(Q+=P.identifierList.map(se=>"".concat(f).concat(se))),Q+this.eol}}class we extends zt{print(P){let Q=P.attributes,se="";return se+=this.printRTCP(Q.rtcp),se+=this.printIceUfrag(Q.iceUfrag),se+=this.printIcePwd(Q.icePwd),se+=this.printIceOptions(Q.iceOptions),se+=this.printCandidates(Q.candidates),se+=this.printRemoteCandidatesList(Q.remoteCandidatesList),se+=this.printEndOfCandidates(Q.endOfCandidates),se+=this.printFingerprints(Q.fingerprints),se+=this.printSetup(Q.setup),se+=this.printMid(Q.mid),se+=this.printExtmap(Q.extmaps),se+=this.printRTPRelated(Q),se+=this.printPtime(Q.ptime),se+=this.printMaxPtime(Q.maxPtime),se+=this.printDirection(Q.direction),se+=this.printSSRCGroups(Q.ssrcGroups),se+=this.printSSRC(Q.ssrcs),se+=this.printRTCPMux(Q.rtcpMux),se+=this.printRTCPMuxOnly(Q.rtcpMuxOnly),se+=this.printRTCPRsize(Q.rtcpRsize),se+=this.printMSId(Q.msids),se+=this.printImageattr(Q.imageattr),se+=this.printRid(Q.rids),se+=this.printSimulcast(Q.simulcast),se+=this.printSCTPPort(Q.sctpPort),se+=this.printMaxMessageSize(Q.maxMessageSize),se+=this.printUnrecognized(Q.unrecognized),se}printCandidates(P){return P.map(Q=>"a=candidate:".concat(Q.foundation).concat(f).concat(Q.componentId).concat(f).concat(Q.transport).concat(f).concat(Q.priority).concat(f).concat(Q.connectionAddress).concat(f).concat(Q.port).concat(f,"typ").concat(f).concat(Q.type).concat(Q.relAddr?"".concat(f,"raddr").concat(f).concat(Q.relAddr):"").concat(Q.relPort?"".concat(f,"rport").concat(f).concat(Q.relPort):"").concat(Object.keys(Q.extension).map(se=>"".concat(f).concat(se).concat(f).concat(Q.extension[se])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(P){return P.map(Q=>"a=remote-candidates:".concat(Q.join(f)).concat(this.eol)).join("")}printEndOfCandidates(P){return P===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(P){if(!P.payloads)return"";let Q=P.payloads,se="";se+=P.rtcpFeedbackWildcards.map(Pe=>this.printRTCPFeedback("*",Pe)).join("");for(let Pe of Q)se+=this.printRtpMap(Pe.payloadType,Pe.rtpMap),se+=this.printFmtp(Pe.payloadType,Pe.fmtp),se+=Pe.rtcpFeedbacks.map(Et=>this.printRTCPFeedback(Pe.payloadType,Et)).join("");return se}printFmtp(P,Q){if(!Q)return"";let se=Object.keys(Q.parameters);return se.length===1&&Q.parameters[se[0]]===null?"a=fmtp:".concat(P).concat(f).concat(se[0]).concat(this.eol):"a=fmtp:".concat(P).concat(f).concat(Object.keys(Q.parameters).map(Pe=>"".concat(Pe,"=").concat(Q.parameters[Pe])).join(";")).concat(this.eol)}printRtpMap(P,Q){return Q?"a=rtpmap:".concat(P).concat(f).concat(Q.encodingName,"/").concat(Q.clockRate).concat(Q.encodingParameters?"/".concat(Q.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(P,Q){let se="a=rtcp-fb:".concat(P).concat(f),Pe=Q;return Pe.type==="trr-int"?se+="ttr-int".concat(f).concat(Pe.interval):(se+="".concat(Pe.type),Pe.parameter&&(se+="".concat(f).concat(Pe.parameter),Pe.additional&&(se+="".concat(f).concat(Pe.additional)))),se+this.eol}printPtime(P){return P===void 0?"":"a=ptime:".concat(P).concat(this.eol)}printMaxPtime(P){return P===void 0?"":"a=maxptime:".concat(P).concat(this.eol)}printDirection(P){return P===void 0?"":"a=".concat(P).concat(this.eol)}printSSRC(P){return P.map(Q=>Object.keys(Q.attributes).map(se=>"a=ssrc:".concat(Q.ssrcId.toString(10)).concat(f).concat(se).concat(Q.attributes[se]?":".concat(Q.attributes[se]):"").concat(this.eol)).join("")).join("")}printRTCPMux(P){return P===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(P){return P===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(P){return P===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(P){if(P===void 0)return"";let Q="a=rtcp:".concat(P.port);return P.netType&&(Q+="".concat(f).concat(P.netType)),P.addressType&&(Q+="".concat(f).concat(P.addressType)),P.address&&(Q+="".concat(f).concat(P.address)),Q+this.eol}printMSId(P){return P.map(Q=>"a=msid:".concat(Q.id).concat(Q.appdata?"".concat(f).concat(Q.appdata):"").concat(this.eol)).join("")}printImageattr(P){return P.map(Q=>"a=imageattr:".concat(Q).concat(this.eol)).join("")}printRid(P){return P.map(Q=>{let se="a=rid:".concat(Q.id).concat(f).concat(Q.direction);return Q.payloads&&(se+="".concat(f,"pt=").concat(Q.payloads.join(","))),Q.params.length>0&&(se+="".concat(f).concat(Q.params.map(Pe=>Pe.type==="depend"?"depend=".concat(Pe.rids.join(",")):"".concat(Pe.type,"=").concat(Pe.val)).join(";"))),se+this.eol}).join("")}printSimulcast(P){return P===void 0?"":"a=simulcast:".concat(P).concat(this.eol)}printSCTPPort(P){return P===void 0?"":"a=sctp-port:".concat(P).concat(this.eol)}printMaxMessageSize(P){return P===void 0?"":"a=max-message-size:".concat(P).concat(this.eol)}printMid(P){return P===void 0?"":"a=mid:".concat(P).concat(this.eol)}printSSRCGroups(P){return P.map(Q=>"a=ssrc-group:".concat(Q.semantic).concat(Q.ssrcIds.map(se=>"".concat(f).concat(se.toString(10))).join("")).concat(this.eol)).join("")}}function Le(Ne){return new Ce().parse(Ne)}function Ke(Ne,P){return new Yt().print(Ne,P)}}},t={};function s(a){if(t[a])return t[a].exports;var c=t[a]={exports:{}};return e[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var d in c)s.o(c,d)&&!s.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function Sn(e){return ML.parse(e)}function Gc(e,t){return ML.print(e,t)}var die=Xi("Array","keys"),uie=Oc,hie=Gr,pie=R,mie=die,F0=Array.prototype,fie={DOMTokenList:!0,NodeList:!0},gie=function(e){var t=e.keys;return e===F0||pie(F0,e)&&t===F0.keys||hie(fie,uie(e))?mie:t},Cn=u(gie);function Is(e,t,s){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var f=p.call(d,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function FL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function bt(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?FL(Object(s),!0).forEach(function(a){Is(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):FL(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let UL=new class extends Cs{constructor(){super(...arguments),Is(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class _ie{constructor(t){Is(this,"logger",void 0),Is(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function U0(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function VL(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let Di={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Uv=Date.now(),Bm=e=>{for(let t in Di)if(Object.prototype.hasOwnProperty.call(Di,t)&&Di[t]===e)return t;return"DEFAULT"},A=new class{constructor(){Is(this,"proxyServerURL",void 0),Is(this,"logLevel",Di.DEBUG),Is(this,"uploadState","collecting"),Is(this,"uploadLogWaitingList",[]),Is(this,"uploadLogUploadingList",[]),Is(this,"uploadErrorCount",0),Is(this,"currentLogID",0),Is(this,"url",void 0),Is(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Di.DEBUG].concat(t);this.log.apply(this,a)}info(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Di.INFO].concat(t);this.log.apply(this,a)}warning(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Di.WARNING].concat(t);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Di.ERROR].concat(t);this.log.apply(this,a)}upload(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Di.DEBUG].concat(t);this.uploadLog.apply(this,a)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){ts("UPLOAD_LOG",!0)}disableLogUpload(){ts("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new _ie(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-Uv<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Uv);let a=Math.max(0,Math.min(4,t[0]));if(t[0]=U0()+" Agora-SDK [".concat(Bm(a),"]:"),this.appendLogToWaitingList(a,...t),a<this.logLevel)return;let c=U0()+" %cAgora-SDK [".concat(Bm(a),"]:"),d=[];if(!$("USE_NEW_LOG"))switch(a){case Di.DEBUG:d=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,d);break;case Di.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,d);break;case Di.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,d);break;case Di.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-Uv<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Uv);let a=Math.max(0,Math.min(4,t[0]));t[0]=U0()+" Agora-SDK [".concat(Bm(a),"]:"),this.appendLogToWaitingList(a,...t)}appendLogToWaitingList(e){if(!$("UPLOAD_LOG"))return;for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=VL()+" Agora-SDK [".concat(Bm(e),"]:"):s[0]=VL()+" Agora-SDK [".concat(Bm(e),"]:");let c="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Ii,process_id:$("PROCESS_ID"),payload:JSON.stringify(e)};return Va(async()=>{let s=await pn.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat($("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat($("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(s.data!=="OK"){let a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>{let a={status:-1,message:s.message,errorRange:e.map(c=>c.log_item_id)};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),UL.reportLogUploadError(a),!0},{timeout:$("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:$("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,$("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var BL;function vie(e){return gr(e.reportId,"params.reportId",0,100,!1),gr(e.category,"params.category",0,100,!1),gr(e.event,"params.event",0,100,!1),gr(e.label,"params.label",0,100,!1),ns(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(BL={}).FREE="free",BL.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let Eie={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},tr=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),ys=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let yie=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function ut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,s,a){let c=a.value;if(typeof c=="function"){let d=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);a.value=function(){for(var h,p=arguments.length,f=new Array(p),_=0;_<p;_++)f[_]=arguments[_];let v=f;if(e.argsMap)try{v=e.argsMap(this,...f)}catch(w){A.warning(w),v=[]}try{JSON.stringify(v)}catch{A.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),v=[]}let b=(e.report||Ze).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:v,tag:xs.TRACER,reportResult:e.reportResult},e.throttleTime);try{let w=c.apply(this,f);return w instanceof Be?w.then(T=>(b.onSuccess(e.reportResult&&T),T)).catch(T=>{throw b.onError(T),T}):(b.onSuccess(e.reportResult&&w),w)}catch(w){throw b.onError(w),w}}}return a}}let Ze=new class{constructor(){Is(this,"baseInfoMap",new Map),Is(this,"proxyServer",void 0),Is(this,"eventUploadTimer",void 0),Is(this,"setSessionIdTimer",void 0),Is(this,"url",void 0),Is(this,"sids",new Set),Is(this,"backupUrl",void 0),Is(this,"_appId",void 0),Is(this,"_aid",0),Is(this,"keyEventUploadPendingItems",[]),Is(this,"normalEventUploadPendingItems",[]),Is(this,"apiInvokeUploadPendingItems",[]),Is(this,"apiInvokeCount",0),Is(this,"apiInvokeLoggedCount",0),Is(this,"ltsList",[]),Is(this,"lastSendNormalEventTime",Date.now()),Is(this,"customReportCounterTimer",void 0),Is(this,"customReportCount",0),Is(this,"extApiInvoke",async e=>{for(let t of e){let s=bt(bt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:xs.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),$("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),$("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[s,a]=t;return s+a}),16)||0}reportApiInvoke(e,t,s){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let a=Date.now();this.apiInvokeCount+=1;let c=this.apiInvokeCount,d=!!$("SHOW_REPORT_INVOKER_LOG"),h=!!$("SHOW_REPORT_USER_INVOKER_LOG"),p=d||h&&t.id;p&&(this.apiInvokeLoggedCount+=1);let f=this.apiInvokeLoggedCount;function _(T,U){if(p){let k="[apiInvoke-".concat(f,"]");if(t.id&&(k+="[".concat(t.id,"]")),t.name&&(k+="[".concat(t.name,"]"),t.name===ks.JOIN))return A.info("".concat(k," ").concat(T));A.info("".concat(k," ").concat(T),T==="start"?t.options:U||"")}}let v=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:a,options:t.options,states:t.states||null});_("start");let b=!1;_r(t.timeout).then(()=>{b||(this.sendApiInvoke(bt(bt({},v()),{},{error:q.API_INVOKE_TIMEOUT,success:!1})),_("timeout"))});let w=new _e(q.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:T=>{let U=()=>{if(b)throw w;return b=!0,this.sendApiInvoke(bt(bt({},v()),{},{success:!0},t.reportResult&&{result:T})),_("onSuccess"),T};return s?yL(U,t.name+"Success",s,()=>b=!0):U()},onError:T=>{let U=()=>{if(b)throw T;b=!0,this.sendApiInvoke(bt(bt({},v()),{},{success:!1,error:T})),_("onFailure",T.toString())};return s?yL(U,t.name+"Error",s,()=>b=!0):U()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let s=Date.now(),a=this.createBaseInfo(e,s);a.cname=t.cname;let c=Object.assign({},{willUploadConsoleLog:$("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:P0?"global":"oversea",areas:$("AREAS")&&$("AREAS").join(",")},t.extend),{stringUid:d,channelProfile:h,channelMode:p,isABTestSuccess:f,lsid:_,clientRole:v}=t,b=Date.now(),w=bt(bt({},a),{},{eventType:tr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:L0,lts:b,elapse:b-s,extend:JSON.stringify(c),mode:t.mode,process:$("PROCESS_ID"),appType:$("APP_TYPE"),success:!0,version:Ii,stringUid:d,channelProfile:h,channelMode:p,isABTestSuccess:f,lsid:_,clientType:ke(T=window.navigator.userAgent).call(T,"AgoraWebView")?42:20,clientRole:v,serviceId:$("PROCESS_ID"),extensionID:$("PLUGIN_INFO").join(",")||""});var T;this.send({type:ys.SESSION,data:w},!0)}joinChooseServer(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt({},a),{},{role:t.role,eventType:tr.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-s.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:ys.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt({},a),{},{eventType:tr.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-s.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:ys.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info;t.vid&&(a.vid=t.vid),a.uid=t.uid,a.cid=t.cid;let c=Date.now(),{firstSuccess:d,addr:h,isProxy:p}=t,f=c-s.startTime,_=bt(bt({},a),{},{eventType:tr.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:f,eventElapse:c-t.lts,firstSuccess:d,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:j0(),isABTestSuccess:t.isABTestSuccess?1:0}),v=_.success?1:0;if(t.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:ys.JOIN_GATEWAY,data:_},!0);else{let b;if(h)if(p){let T=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=h.match(/p=[0-9]{1,6}/g);b={isSuccess:v,gatewayIp:T&&T.length?T[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:p?1:0}}else{let T=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=h.match(/(:|p=)[0-9]{1,6}/g);b={isSuccess:v,gatewayIp:T&&T.length?T[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:p?1:0}}else b={isSuccess:v,gatewayIp:"",port:"",isProxy:p?1:0};delete _.success,delete _.eventType,delete _.firstSuccess,_.vid=Number(_.vid);let w=Object.assign({},_,b,{eventType:tr.REJOIN_GATEWAY});this.send({type:ys.RE_JOIN_GATEWAY,data:w},!0)}}joinChannelTimeout(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=Date.now(),c=bt(bt({},s.info),{},{lts:a,timeout:t,elapse:a-s.startTime});this.send({type:ys.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt({},a),{},{eventType:tr.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-s.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:ys.PUBLISH,data:d},!0)}subscribe(e,t,s){let a=this.baseInfoMap.get(e);if(!a)return;let c=a.info,d=Date.now(),h=bt(bt({},c),{},{eventType:tr.SUBSCRIBE,lts:d,eventElapse:t.eventElapse,elapse:d-a.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?h.peerSuid=t.peerid:h.peer=t.peerid,this.send({type:ys.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var t;let s=[...Cn(t=this.baseInfoMap).call(t)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;let d=c.info,h=Date.now(),p=bt(bt({},d),{},{eventType:tr.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:ys.WS_COMPRESSOR_INIT,data:p},!0)}firstXLAPeerFirstVideoFrame(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=t.peerPubStatusMs-(s.lastJoinSuccessTime||c),h=bt(bt({},a),{},{elapse:c-s.startTime,eventType:tr.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>d?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:ys.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(e,t,s,a){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=bt(bt(bt({},d),a),{},{elapse:h-c.startTime,eventType:t,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:p},!0)}firstRemoteFrame(e,t,s,a){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=bt(bt(bt({},d),a),{},{elapse:h-c.startTime,eventType:t,lts:h});this.send({type:s,data:p},!0)}abTest(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt(bt({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:tr.AB_TEST,lts:c});this.send({type:ys.AB_TEST,data:d},!0)}pcStats(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt(bt({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:tr.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:ys.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(e,t){if(e){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt(bt({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:tr.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:ys.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(e,t,s,a){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=bt(bt(bt({},d),a),{},{eventType:t,lts:h});this.send({type:s,data:p},!0)}streamSwitch(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt({},a),{},{eventType:tr.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-s.startTime,success:t.succ});this.send({type:ys.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt({},a),{},{eventType:tr.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-s.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ys.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt({},a),{},{eventType:tr.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-s.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ys.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(e){this.proxyServer=e,e?A.debug("reportProxyServerurl: ".concat(e)):A.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt({},a),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:ys.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now();(function(d,h,p){let f=d[h];if(!f||typeof f!="string")return[d];d[h]="";let _=xo(JSON.stringify(d)),v=0,b=[],w=0;for(let T=0;T<f.length;T++)w+=f.charCodeAt(T)<=127?1:3,w<=p-_||(b[b.length]=Oe(Oe({},d),{},{[h]:f.substring(v,T)}),v=T,w=f.charCodeAt(T)<=127?1:3);return v!==f.length-1&&(b[b.length]=Oe(Oe({},d),{},{[h]:f.substring(v)})),b})(bt(bt(bt({},a),t),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:ys.WORKER_EVENT,data:d},!0))}apworkerEvent(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt(bt({},a),t),{},{elapse:c-s.startTime,lts:c});this.send({type:ys.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt(bt({},a),t),{},{elapse:c-s.startTime,lts:c,extend:t.extend||void 0});this.send({type:ys.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=bt(bt(bt({},a),t),{},{elapse:c-s.startTime,lts:c});this.send({type:ys.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>$("CUSTOM_REPORT_LIMIT"))throw new _e(q.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let s=Date.now(),a=t.map(c=>({type:ys.USER_ANALYTICS,data:bt(bt({sid:e},c),{},{lts:s})}));try{$("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw A.error("send custom report message failed",c.toString()),new _e(q.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){let t=$("NOT_REPORT_EVENT");if(e.tag&&ke(t)&&ke(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let s=this.baseInfoMap.get(e.sid);if(!s)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:a,uid:c,cid:d}=s.info,h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof _e){let{code:f,message:_}=e.error;h=f||_||e.error.toString()}else h=e.error.toString();let p={invokeId:e.invokeId,sid:e.sid,cname:a,cid:d,uid:c,lts:e.lts,success:e.success,elapse:e.lts-s.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:ys.API_INVOKE,data:p},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(s=>s!==null);t&&e.forEach(s=>{s&&(s.sid=t,this.sendApiInvoke(Object.assign({},s)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let s=[],a=[];for(;e.length;){let d=e.shift();s.length<20?s.push(d):a.push(d)}e.push(...a);for(let d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),ed(c=this.ltsList).call(c,(h,p)=>h-p))}return t||(this.lastSendNormalEventTime=Date.now()),$("ENABLE_EVENT_REPORT")&&s.length&&($("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{$("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-$("NORMAL_EVENT_QUEUE_CAPACITY")),A.warning("report: drop normal events"))))})(s)),e}async postDataToStatsCollector2(e){Vs.networkState===Gn.OFFLINE&&await Be.race([Vs.onlineWaiter,_r(2*Ks.maxRetryTimeout)]);let t=c=>{let d=new Uint8Array;return c.forEach(h=>{let p=x0(JSON.stringify(h.data)),f=new ArrayBuffer(5),_=(b=>{let w=0;return Object.entries(ys).forEach(T=>{let[U,k]=T;k===b.type&&(w=yie[U])}),w})(h),v=new DataView(f);v.setUint16(0,p.byteLength,!0),v.setUint8(2,255&_),v.setUint8(3,_>>>8&255),v.setUint8(4,_>>>16&255),d=uL(d,new Uint8Array(f)),d=uL(d,p)}),d},s="event",a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await R0(a,{timeout:1e4,data:t(e),headers:bt(bt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=(p=>{let f=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return f&&f.info.vid&&+f.info.vid||0})(e[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(p=>JSON.stringify(p)),vid:s,aid:a};Vs.networkState===Gn.OFFLINE&&await Be.race([Vs.onlineWaiter,_r(2*Ks.maxRetryTimeout)]);let d=t?"/events/proto-raws":"/events/messages",h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat($("EVENT_REPORT_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(d));for(let p=0;p<2;p+=1){p===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat($("EVENT_REPORT_BACKUP_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(d)));try{t?await iie(h,{timeout:1e4,data:c}):await R0(h,{timeout:1e4,data:c})}catch(f){if(p===1)throw f;continue}return}}createBaseInfo(e,t){let s=Object.assign({},Eie);return s.sid=e,this.baseInfoMap.set(e,{info:s,startTime:t}),s}reportResourceTiming(e,t){let s=performance.getEntriesByName(e),a=s[s.length-1];a&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:a,tag:xs.TRACER}).onSuccess()}};UL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Vs.networkState,Ze.reportApiInvoke(null,{name:"logUploadError",options:e,tag:xs.TRACER}).onSuccess("logUploadError")});class de extends _e{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Is(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,A)}throw(){super.throw(A)}}let vr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Vt(){return vr}function WL(){return"setSinkId"in HTMLAudioElement.prototype&&(!$("RESTRICTION_SET_PLAYBACK_DEVICE")||(sc()||Z2())&&!v0())}function Vv(){return!vr.supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&rc()}function V0(e){return!(Rs()||eL(87)||Vv()||!$("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB")))}function GL(e){return!!$("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB"))}let Er=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function rh(e,t,s){return{sampleRate:e,stereo:t,bitrate:s}}function Bt(e,t,s,a,c){return{width:e,height:t,frameRate:s,bitrateMin:a,bitrateMax:c}}function aa(e,t,s,a,c){return{width:{max:e},height:{max:t},frameRate:s,bitrateMin:a,bitrateMax:c}}function B0(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let xie={"90p":Bt(160,90),"90p_1":Bt(160,90),"120p":Bt(160,120,15,30,65),"120p_1":Bt(160,120,15,30,65),"120p_3":Bt(120,120,15,30,50),"120p_4":Bt(212,120),"180p":Bt(320,180,15,30,140),"180p_1":Bt(320,180,15,30,140),"180p_3":Bt(180,180,15,30,100),"180p_4":Bt(240,180,15,30,120),"240p":Bt(320,240,15,40,200),"240p_1":Bt(320,240,15,40,200),"240p_3":Bt(240,240,15,40,140),"240p_4":Bt(424,240,15,40,220),"360p":Bt(640,360,15,80,400),"360p_1":Bt(640,360,15,80,400),"360p_3":Bt(360,360,15,80,260),"360p_4":Bt(640,360,30,80,600),"360p_6":Bt(360,360,30,80,400),"360p_7":Bt(480,360,15,80,320),"360p_8":Bt(480,360,30,80,490),"360p_9":Bt(640,360,15,80,800),"360p_10":Bt(640,360,24,80,800),"360p_11":Bt(640,360,24,80,1e3),"480p":Bt(640,480,15,100,500),"480p_1":Bt(640,480,15,100,500),"480p_2":Bt(640,480,30,100,1e3),"480p_3":Bt(480,480,15,100,400),"480p_4":Bt(640,480,30,100,750),"480p_6":Bt(480,480,30,100,600),"480p_8":Bt(848,480,15,100,610),"480p_9":Bt(848,480,30,100,930),"480p_10":Bt(640,480,10,100,400),"720p":Bt(1280,720,15,120,1130),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Bt(1280,720,15,120,1130),"720p_2":Bt(1280,720,30,120,2e3),"720p_3":Bt(1280,720,30,120,1710),"720p_5":Bt(960,720,15,120,910),"720p_6":Bt(960,720,30,120,1380),"1080p":Bt(1920,1080,15,120,2080),"1080p_1":Bt(1920,1080,15,120,2080),"1080p_2":Bt(1920,1080,30,120,3e3),"1080p_3":Bt(1920,1080,30,120,3150),"1080p_5":Bt(1920,1080,60,120,4780),"1440p":Bt(2560,1440,30,120,4850),"1440p_1":Bt(2560,1440,30,120,4850),"1440p_2":Bt(2560,1440,60,120,7350),"4k":Bt(3840,2160,30,120,8910),"4k_1":Bt(3840,2160,30,120,8910),"4k_3":Bt(3840,2160,60,120,13500)},bie={"480p":aa(640,480,5),"480p_1":aa(640,480,5),"480p_2":aa(640,480,30),"480p_3":aa(640,480,15),"720p":aa(1280,720,5),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":aa(1280,720,5),"720p_2":aa(1280,720,30),"720p_3":aa(1280,720,15),"1080p":aa(1920,1080,5),"1080p_1":aa(1920,1080,5),"1080p_2":aa(1920,1080,30),"1080p_3":aa(1920,1080,15)},wie={"1SL1TL":B0(1,1),"3SL3TL":B0(3,3),"2SL3TL":B0(2,3)};function oa(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},xie[e]):e}function W0(e){return typeof e=="string"?Object.assign({},bie[e]):e}function Bv(e){return typeof e=="string"?Object.assign({},wie[e]):e}let Sie={speech_low_quality:rh(16e3,!1),speech_standard:rh(32e3,!1,18),music_standard:rh(48e3,!1),standard_stereo:rh(48e3,!0,56),high_quality:rh(48e3,!1,128),high_quality_stereo:rh(48e3,!0,192)};function Wv(e){return typeof e=="string"?Object.assign({},Sie[e]):e}let nh=[];function HL(e){return er(e,"mediaSource",["screen","window","application"]),!0}let Ye=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),is=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),ih=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Cie=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Tie=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),hd=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),ah=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Oi=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),oh=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),li=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let G0={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},H0={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},zL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Nie={uplinkNetworkQuality:0,downlinkNetworkQuality:0},KL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},nn=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),di=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Wm=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),pd=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),kr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),wo=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),z0={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},Gv=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Ot(e,t,s,a,c){var d,h,p={};return Object.keys(a).forEach(function(f){p[f]=a[f]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=Ji(d=DD(h=s.slice()).call(h)).call(d,function(f,_){return _(e,t,f)||f},p),c&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(c):void 0,p.initializer=void 0),p.initializer===void 0?(Object.defineProperty(e,t,p),null):p}function ce(e,t,s){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var f=p.call(d,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function qL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function ds(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?qL(Object(s),!0).forEach(function(a){ce(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):qL(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class YL extends Cs{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(hd.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,s){super(),ce(this,"trackMediaType",void 0),ce(this,"_ID",void 0),ce(this,"_rtpTransceiver",void 0),ce(this,"_lowRtpTransceiver",void 0),ce(this,"_hints",[]),ce(this,"_isClosed",!1),ce(this,"_originMediaStreamTrack",void 0),ce(this,"mediaStreamTrack",void 0),ce(this,"_external",{}),this._ID=s||os(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(a){ke(nh).call(nh,a)||nh.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Bc(()=>{var s;Ze.reportApiInvoke(null,{name:ks.GET_MEDIA_STREAM_TRACK,options:[],tag:xs.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===ih.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){let s=nh.indexOf(t);s!==-1&&nh.splice(s,1)}(this),this.emit(ah.CLOSED),this.removeAllListeners(hd.SEI_RECEIVED)}_updateRtpTransceiver(t,s){if(s===ih.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(hd.TRANSCEIVER_UPDATED,t,s)}}class ch extends YL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,s){super(t,s),ce(this,"_enabled",!0),ce(this,"_muted",!1),ce(this,"_isExternalTrack",!1),ce(this,"_isClosed",!1),ce(this,"_enabledMutex",void 0),ce(this,"processor",void 0),ce(this,"_processorContext",void 0),ce(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Pr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,s;return(t=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,A.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ye.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await as(this,Ye.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ah.TRACK_ENDED)}stateCheck(t,s){if(A.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(s,"]")),Ua(s,t),this._enabled&&this._muted&&t==="enabled"&&s===!1)throw new _e(q.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",A);if(!this._enabled&&!this._muted&&t==="muted"&&s===!0)throw new _e(q.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",A)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Be.resolve([])}}let $L=window.AudioContext||window.webkitAudioContext,ui=null,ss=new class extends Cs{constructor(){super(...arguments),ce(this,"prevState",void 0),ce(this,"curState",void 0),ce(this,"currentTime",void 0),ce(this,"currentTimeStuckAt",void 0),ce(this,"interruptDetectorTrack",void 0),ce(this,"onLocalAudioTrackMute",()=>{A.info("ios15-interruption-start"),this.emit(Er.IOS_15_16_INTERRUPTION_START)}),ce(this,"onLocalAudioTrackUnmute",async()=>{A.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?A.info("ios15-interruption-end-canceled"):(ui&&await ui.suspend(),this.emit(Er.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){A.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){A.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function lh(){if(!ui){if(function(){if(!$L)return void A.error("your browser is not support web audio");A.info("create audio context");let e=ds({},$("WEBAUDIO_INIT_OPTIONS"));A.debug("audio context init option:",JSON.stringify(e)),ui=new $L(e),ss.curState=ui.state,ui.onstatechange=()=>{ss.prevState=ss.curState,ss.curState=ui?ui.state:void 0;let{prevState:t,curState:s}=ss,a=s==="running",c=s==="interrupted",d=t==="running",h=t==="suspended",p=t==="interrupted",f=Lt().osVersion;(zr()||na())&&d&&c&&(A.info("ios".concat(f,"-interruption-start")),ss.emit(Er.IOS_INTERRUPTION_START)),(zr()||na())&&(h||p)&&a&&(A.info("ios".concat(f,"-interruption-end")),ss.emit(Er.IOS_INTERRUPTION_END)),t!==s&&ss.emit(Er.STATE_CHANGE,s,t)},setInterval(()=>{var t;let s=(t=ui)===null||t===void 0?void 0:t.currentTime;ss.currentTime!==s?(ss.currentTimeStuckAt&&(A.debug("AudioContext current time resume at ".concat(s)),ss.currentTimeStuckAt=void 0),ss.currentTime=s):(s!==ss.currentTimeStuckAt&&(Ze.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:xs.TRACER}).onSuccess(),A.warning("AudioContext current time stuck at ".concat(s))),ss.currentTimeStuckAt=s)},5e3),async function(t){let s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],a,c=!1,d=!1,h=!1;function p(k){t.state==="running"?f(!1):zr()||na()?t.state==="suspended"&&(f(!0),k&&t.resume().then(_,_)):t.state!=="closed"&&(f(!0),k&&t.resume().then(_,_))}function f(k){if(c!==k){c=k;for(let F=0,K=s;F<K.length;F+=1){let Y=K[F];k?window.addEventListener(Y,v,{capture:!0,passive:!0}):window.removeEventListener(Y,v,{capture:!0,passive:!0})}}}function _(){p(!1)}function v(){p(!0)}function b(k){if(!h)if(a.paused)if(k){let F;w(!1),h=!0;try{F=a.play(),F?F.then(T,T):(a.addEventListener("playing",T),a.addEventListener("abort",T),a.addEventListener("error",T))}catch{T()}}else w(!0);else w(!1)}function w(k){if(d!==k){d=k;for(let F=0,K=s;F<K.length;F++){let Y=K[F];k?window.addEventListener(Y,U,{capture:!0,passive:!0}):window.removeEventListener(Y,U,{capture:!0,passive:!0})}}}function T(){a.removeEventListener("playing",T),a.removeEventListener("abort",T),a.removeEventListener("error",T),h=!1,b(!1)}function U(){b(!0)}if(zr()){let k=t.createMediaStreamDestination(),F=document.createElement("div");F.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=F.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=k.stream,b(!0)}ss.on(Er.STATE_CHANGE,function(){p(!0)}),p(!1)}(ui)}(),!ui)throw new _e(q.NOT_SUPPORTED,"can not create audio context");return ui}return ui}function md(e){if(function(){if(K0!==null)return K0;let a=lh(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let p=!1;try{c.disconnect(d)}catch{p=!0}return c.disconnect(),K0=p,p}())return;let t=e.connect,s=e.disconnect;e.connect=(a,c,d)=>{var h;return e._inputNodes||(e._inputNodes=[]),ke(h=e._inputNodes).call(h,a)||(a instanceof AudioNode?(e._inputNodes.push(a),t.call(e,a,c,d)):t.call(e,a,c)),e},e.disconnect=(a,c,d)=>{s.call(e),a?Ov(e._inputNodes,a):e._inputNodes=[];for(let h of e._inputNodes)t.call(e,h)}}let K0=null;function q0(e,t){let s=!1,a=1/t;if($("DISABLE_WEBAUDIO")){let c=window.setInterval(()=>{s?window.clearInterval(c):e(performance.now()/1e3)},1e3*a)}else{let c=lh(),d=c.createGain();d.gain.value=0,d.connect(c.destination);let h=()=>{if(s)return void(d=null);let p=c.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(c.currentTime+a),e(c.currentTime)};h()}return()=>{s=!0}}class XL{constructor(){ce(this,"context",void 0),ce(this,"analyserNode",void 0),ce(this,"sourceNode",void 0),this.context=lh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||zr()||na()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<t.length;++c)t[c]=a[c]/128-1}let s=Ji(t).call(t,(a,c)=>a+c*c,0)/t.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,s;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{A.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class JL extends Cs{get processSourceNode(){return this.sourceNode}set processedNode(t){var s;if(!this.isDestroyed&&this._processedNode!==t){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ce(this,"outputNode",void 0),ce(this,"outputTrack",void 0),ce(this,"isPlayed",!1),ce(this,"sourceNode",void 0),ce(this,"context",void 0),ce(this,"audioBufferNode",void 0),ce(this,"destNode",void 0),ce(this,"audioOutputLevel",0),ce(this,"volumeLevelAnalyser",void 0),ce(this,"_processedNode",void 0),ce(this,"playNode",void 0),ce(this,"isDestroyed",!1),ce(this,"onNoAudioInput",void 0),ce(this,"isNoAudioInput",!1),ce(this,"_noAudioInputCount",0),this.context=lh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),md(this.outputNode),this.volumeLevelAnalyser=new XL}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(li.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){let d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Vt().webAudioMediaStreamDest)throw new _e(q.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&jv(()=>{ss.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;zr()||na()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let s=this.volumeLevelAnalyser.getAnalyserNode(),a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await _r(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,s;(t=this.processedNode)===null||t===void 0||t.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class QL extends JL{get isFreeze(){return!1}constructor(t,s,a){var c;if(super(),ce(this,"sourceNode",void 0),ce(this,"track",void 0),ce(this,"clonedTrack",void 0),ce(this,"audioElement",void 0),ce(this,"isCurrentTrackCloned",!1),ce(this,"isRemoteTrack",!1),ce(this,"originVolumeLevelAnalyser",void 0),ce(this,"rebuildWebAudio",async()=>{if(A.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void A.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>A.info("resume success")),A.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let p=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?p.stop():this.isCurrentTrackCloned=!0;let f=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(f),md(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let _=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(_,this.context.currentTime),md(this.outputNode),this.emit(li.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=f,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new _e(q.UNEXPECTED_ERROR);this.track=t;let d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),md(this.sourceNode),a){let p=a.clone();p.enabled=!0,this.clonedTrack=p,A.debug("create an unmuted track ".concat(p.id," from the original track ").concat(a.id," to get the volume"));let f=this.context.createMediaStreamSource(new MediaStream([p]));md(f),this.originVolumeLevelAnalyser=new XL,this.originVolumeLevelAnalyser.updateSource(f)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;let h=Lt();s&&h.os===ar.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(ss.on(Er.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(p=>{p||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let s=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(s),md(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(li.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),ss.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let s=t.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),A.debug("create an unmuted track ".concat(s.id," from the original track ").concat(t.id," to get the volume"));let a=this.context.createMediaStreamSource(new MediaStream([s]));md(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function ZL(e,t,s){let a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:a(t.height,1080),maxWidth:a(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Rie(e,t){let s=await eM(e.mediaSource),{sourceId:a,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Be((p,f)=>{let _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let b=document.createElement("div");b.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",b.setAttribute("style","height: 12%;");let w=document.createElement("div");w.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let U=document.createElement("button");U.innerHTML="cancel",U.setAttribute("style","width: 85px;"),U.onclick=()=>{document.body.removeChild(K);let Y=new Error("NotAllowedError");Y.name="NotAllowedError",f(Y)};let k=h,F=document.createElement("div");if(h){let Y=document.createElement("input");Y.setAttribute("type","checkbox");let X=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),X.innerText="Share audio",Y.checked=k,Y.onchange=()=>{k=Y.checked},F.appendChild(Y),F.appendChild(X)}T.appendChild(F),T.appendChild(U),v.appendChild(b),v.appendChild(w),v.appendChild(T);let K=document.createElement("div");K.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),K.appendChild(_),K.appendChild(v),document.body.appendChild(K),d.map(Y=>{if(Y.id){let X=document.createElement("div");X.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let re=Y.thumbnail;try{let{width:te}=re.getSize();te>1920&&(re=re.resize({width:1920}))}catch(te){throw te&&te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),te}X.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+re.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(te){return"&#"+te.charCodeAt(0)+";"})+"</span>",X.onclick=()=>{document.body.removeChild(K),p({sourceId:Y.id,audio:k})},w.appendChild(X)}})})}(s,t);return await ZL(a,e,c)}async function eM(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let s=hL();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new _e(q.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{a=null}a&&a.then||(a=new Be((d,h)=>{s.desktopCapturer.getSources({types:t},(p,f)=>{p?h(p):d(f)})}));try{return await a}catch(d){throw new _e(q.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}let Y0=new Pr("safari"),tM=!1,sM=!1;async function hi(e,t){let s=0,a=null;for(;s<2;)try{a=await Aie(e,t,s>0);break}catch(c){if(c instanceof _e)throw A.error("[".concat(t,"] ").concat(c.toString())),c;let d=Hv(c.name||c.code||c,c.message);if(d.code===q.MEDIA_OPTION_INVALID){A.debug("[".concat(t,"] detect media option invalid, retry")),s+=1,await _r(500);continue}throw A.error("[".concat(t,"] ").concat(d.toString())),d}if(!a)throw new _e(q.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function Aie(e,t,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new _e(q.NOT_SUPPORTED,"can not find getUserMedia");s&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let a=Vt(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return A.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(hL())e.screen.sourceId?dh(c,await ZL(e.screen.sourceId,e.screen,!!e.screenAudio)):dh(c,await Rie(e.screen,!!e.screenAudio));else if(sc()&&e.screen.extensionId&&e.screen.mandatory){if(!a.getStreamFromExtension)throw new _e(q.NOT_SUPPORTED,"This browser does not support screen sharing");A.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let w=await(h=e.screen.extensionId,p=t,new Be((T,U)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},k=>{if(!k||!k.streamId)return A.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),k),void U(new _e(q.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(k.streamId)})}catch(k){A.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),k.toString()),U(new _e(q.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=w,dh(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(a.getDisplayMedia){var d;e.screen.mediaSource&&HL(e.screen.mediaSource);let w={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(d=e.screen.displaySurface)!==null&&d!==void 0?d:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:U,systemAudio:k,preferCurrentTab:F}=e.screen,K={selfBrowserSurface:T,surfaceSwitching:U,systemAudio:k,preferCurrentTab:F};!T&&delete K.selfBrowserSurface,!U&&delete K.surfaceSwitching,!k&&delete K.systemAudio,!F&&delete K.preferCurrentTab,A.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:w,audio:e.screenAudio,controls:K})),dh(c,await navigator.mediaDevices.getDisplayMedia(ds({video:w,audio:e.screenAudio},K)))}else{if(!Rs())throw A.error("[".concat(t,"] This browser does not support screenSharing")),new _e(q.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&HL(e.screen.mediaSource);let w={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};A.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(w))),dh(c,await navigator.mediaDevices.getUserMedia(w))}}var h,p;if(!e.video&&!e.audio)return c;let f={video:e.video,audio:e.audio},_=$("MEDIA_DEVICE_CONSTRAINTS");if(_)try{typeof _=="string"&&(_=JSON.parse(_)),f=S0(f,_)}catch{}A.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(f)),Lt();let v,b=null;(Tr()||zr()||Iv())&&(b=await Y0.lock());try{v=await navigator.mediaDevices.getUserMedia(f)}catch(w){throw b&&b(),w}return f.audio&&(tM=!0),f.video&&(sM=!0),dh(c,v),b&&b(),c}function Hv(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new _e(q.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new _e(q.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new _e(q.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new _e(q.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new _e(q.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new _e(q.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return A.error("getUserMedia unexpected error",e),new _e(q.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function dh(e,t){let s=e.getVideoTracks()[0],a=e.getAudioTracks()[0],c=t.getVideoTracks()[0],d=t.getAudioTracks()[0];d&&(a&&e.removeTrack(a),e.addTrack(d)),c&&(s&&e.removeTrack(s),e.addTrack(c))}let pi=new class extends Cs{get state(){return this._state}set state(e){e!==this._state&&(this.emit(pd.STATE_CHANGE,e),this._state=e)}constructor(){super(),ce(this,"_state",Wm.IDLE),ce(this,"isAccessMicrophonePermission",!1),ce(this,"isAccessCameraPermission",!1),ce(this,"lastAccessMicrophonePermission",!1),ce(this,"lastAccessCameraPermission",!1),ce(this,"checkdeviceMatched",!1),ce(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{($("ENUMERATE_DEVICES_INTERVAL")||(Dv()||Av()===ar.HARMONY_OS)&&rc())&&this.updateDevicesInfo()},$("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>A.error(e.toString()))}async enumerateDevices(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new _e(q.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a),d=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;c.audio&&(d=!1),c.video&&(h=!1);let p=null,f=null,_=null;if(!s&&(d||h)){if(Y0.isLocked&&(A.debug("[device manager] wait GUM lock"),(await Y0.lock())(),A.debug("[device manager] GUM unlock")),tM&&(d=!1,this.isAccessMicrophonePermission=!0),sM&&(h=!1,this.isAccessCameraPermission=!0),A.debug("[device manager] check media device permissions",e,t,d,h),d&&h){try{_=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(v){let b=Hv(v.name||v.code||v,v.message);if(b.code===q.PERMISSION_DENIED)throw b;A.warning("getUserMedia failed in getDevices",b)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({audio:e})}catch(v){let b=Hv(v.name||v.code||v,v.message);if(b.code===q.PERMISSION_DENIED)throw b;A.warning("getUserMedia failed in getDevices",b)}this.isAccessMicrophonePermission=!0}else if(h){try{f=await navigator.mediaDevices.getUserMedia({video:t})}catch(v){let b=Hv(v.name||v.code||v,v.message);if(b.code===q.PERMISSION_DENIED)throw b;A.warning("getUserMedia failed in getDevices",b)}this.isAccessCameraPermission=!0}A.debug("[device manager] mic permission",e,"cam permission",t)}try{let v=await navigator.mediaDevices.enumerateDevices();return p&&p.getTracks().forEach(b=>b.stop()),f&&f.getTracks().forEach(b=>b.stop()),_&&_.getTracks().forEach(b=>b.stop()),p=null,f=null,_=null,v}catch(v){return p&&p.getTracks().forEach(b=>b.stop()),f&&f.getTracks().forEach(b=>b.stop()),_&&_.getTracks().forEach(b=>b.stop()),p=null,f=null,_=null,new _e(q.ENUMERATE_DEVICES_FAILED,v.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(s=>{s.device.label===e&&(t=s.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===e);if(!t)throw new _e(q.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Wm.INITING;try{await this.updateDevicesInfo(),this.state=Wm.INITEND}catch(e){throw A.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Wm.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new _e(q.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),s=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?A.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):A.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):A.debug("[device-check] default input or output not found")}let a=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;let d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){let h={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=t)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",s.push(c))}),this.state!==Wm.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(pd.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(pd.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(pd.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(c=>c.kind==="audioinput"),s=e.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(let c of t)if(c.label&&c.deviceId){a.audio=!0;break}for(let c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}},$0=!1,mi=new class extends Cs{constructor(){super(...arguments),ce(this,"onAutoplayFailed",void 0),ce(this,"onAudioAutoplayFailed",void 0)}};function rM(){if(Lt(),!$0){let e=t=>{t.preventDefault(),$0=!1,Om()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};$0=!0,Om()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),A.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),mi.onAutoplayFailed?mi.onAutoplayFailed():mi.onAudioAutoplayFailed?A.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):A.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),mi.emit("autoplay-failed")}}function nM(e,t,s,a){if(!e)return;let c=Ze.getBaseInfoBySessionId(e);if(!c)return;let d=c.info,h=Date.now(),p=ds(ds({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:mi.onAutoplayFailed||mi.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:t,trackId:a,extend:void 0});Ze.send({type:ys.AUTOPLAY_FAILED,data:p},!0)}let Iie=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],mn=new class{constructor(){ce(this,"onAutoplayFailed",void 0),ce(this,"elementMap",new Map),ce(this,"elementStateMap",new Map),ce(this,"elementsNeedToResume",[]),ce(this,"sinkIdMap",new Map),ce(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[s,a]=t,c=this.elementStateMap.get(s),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(A.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return a.pause(),void a.play();if(ss.curState==="running")return Xu()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),ce(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,s]=e,a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(A.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),ss.on(Er.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ss.on(Er.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ss.on(Er.STATE_CHANGE,()=>{zr()&&ss.prevState==="suspended"&&ss.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let s=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),s)try{await s.setSinkId(t)}catch(a){throw new _e(q.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(e,t,s,a){if(this.elementMap.has(t))return;let c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,kr.INIT),this.setVolume(t,s);let d=this.sinkIdMap.get(t);if(d)try{c.setSinkId(d).catch(p=>{A.warning("[".concat(t,"] set sink id failed"),p.toString())})}catch(p){A.warning("[".concat(t,"] set sink id failed"),p.toString())}let h=c.play();h&&h.then&&h.catch(p=>{a&&nM(a,"audio",p.message,t),A.warning("audio element play warning",p.toString()),this.elementMap.has(t)&&p.name==="NotAllowedError"&&(A.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),jv(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),rM()}))})}updateTrack(e,t){let s=this.elementMap.get(e);s&&(s.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let s=this.elementMap.get(e);s&&(t=Math.max(0,Math.min(100,t)),s.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let s=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(s,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Iie.forEach(s=>{t.addEventListener(s,a=>{let c=this.elementStateMap.get(e),d=a.type==="pause"?"paused":a.type;if(A.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){let h=t==null?void 0:t.error;h&&A.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,d)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(s=>{A.debug("Auto resume audio element success")}).catch(s=>{A.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new Be(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Om()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function js(){return function(e,t,s){let a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new _e(q.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",A);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];let p=a.apply(this,d);return p instanceof Be?new Be((f,_)=>{p.then(f).catch(_)}):p}),s}}class iM extends Cs{constructor(t){super(),ce(this,"name","VideoProcessorDestination"),ce(this,"ID","0"),ce(this,"_source",void 0),ce(this,"videoContext",void 0),ce(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new _e(q.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new _e(q.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(nn.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(nn.ON_TRACK,void 0)}}class aM extends Cs{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,s){super(),ce(this,"constraintsMap",new Map),ce(this,"statsRegistry",[]),ce(this,"usageRegistry",[]),ce(this,"trackId",void 0),ce(this,"direction",void 0),ce(this,"_chained",!1),this.trackId=t,this.direction=s}async getConstraints(){return await Rr(this,di.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,s){var a;return A.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(s,t),as(this,di.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vn(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var s;if(this.constraintsMap.has(t))return A.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),as(this,di.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vn(s=this.constraintsMap).call(s)))}registerStats(t,s,a){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===s)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:s,cb:a})}unregisterStats(t,s){let a=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){let t=[];for(let{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{let h=d();t.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){A.error(new _e(q.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,s){this.usageRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:s})}unregisterUsage(t){let s=this.usageRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:s}of this.usageRegistry)try{let a=s();a instanceof Be&&(a=await a),t.push(ds(ds({},a),{},{direction:this.direction}))}catch(a){A.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class oM extends Cs{constructor(t){super(),ce(this,"name","AudioProcessorDestination"),ce(this,"ID","0"),ce(this,"inputTrack",void 0),ce(this,"inputNode",void 0),ce(this,"audioProcessorContext",void 0),ce(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new _e(q.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new _e(q.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(nn.ON_TRACK,void 0),this.emit(nn.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(nn.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(nn.ON_NODE,this.inputNode))}}class cM extends Cs{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,s,a){super(),ce(this,"constraintsMap",new Map),ce(this,"statsRegistry",[]),ce(this,"audioContext",void 0),ce(this,"trackId",void 0),ce(this,"direction",void 0),ce(this,"usageRegistry",[]),ce(this,"_chained",!1),this.audioContext=t,this.trackId=s,this.direction=a}async getConstraints(){return Rr(this,di.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,s){var a;return A.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(s,t),as(this,di.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vn(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var s;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),as(this,di.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vn(s=this.constraintsMap).call(s)))}registerStats(t,s,a){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===s)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:s,cb:a})}unregisterStats(t,s){let a=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){let t=[];for(let{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{let h=d();t.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){A.error(new _e(q.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,s){this.usageRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:s})}unregisterUsage(t){let s=this.usageRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:s}of this.usageRegistry)try{let a=s();a instanceof Be&&(a=await a),t.push(ds(ds({},a),{},{direction:this.direction}))}catch(a){A.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class X0 extends Cs{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ce(this,"context",void 0),ce(this,"processSourceNode",void 0),ce(this,"outputTrack",void 0),ce(this,"processedNode",void 0),ce(this,"clonedTrack",void 0),ce(this,"outputNode",void 0),this.outputNode=new Die}setVolume(){}createOutputTrack(){throw new _e(q.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Die{disconnect(){}connect(){}}function lM(e){return new Be((t,s)=>{let a=!1,c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);let d=zr()?"canplay":"playing";c.addEventListener(d,()=>{let h=c.videoWidth,p=c.videoHeight;!h&&Rs()||(a=!0,c.srcObject=null,c.remove(),t([h,p]))}),c.srcObject=new MediaStream([e]),c.play().catch(Pv),setTimeout(()=>{a||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function zv(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let s=oa(e.encoderConfig);return s.width!=null&&(t.width=s.width),s.height!=null&&(t.height=s.height),!oL()&&s.frameRate&&(t.frameRate=s.frameRate),Z2()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Rs()&&(t.frameRate={ideal:30,max:30}),t}function dM(e){let t={};return oL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,sc()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function uM(e){let t=dM(e);if(e.encoderConfig){let s=Wv(e.encoderConfig);t.channelCount=s.stereo?2:1,t.sampleRate=s.sampleRate,t.sampleSize=s.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Dv()&&(t.sampleRate=void 0),t}let Oie=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:s,width:a,height:c}=e.getMediaStreamTrackSettings(),{frameRate:d=s,width:h=a,height:p=c}=t;if(!d||!h||!p)return;h=Zu(h),p=Zu(p),d=Zu(d);let{max:f,min:_}=function(T,U,k){let F=200*Math.pow(k/15,.6)*Math.pow(T*U/640/360,.75);return{min:Math.floor(F),max:Math.floor(4*F)}}(h,p,d),{bitrateMax:v,bitrateMin:b}=t||{};v||A.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(p,", fps: ").concat(d,"] => [brMax: ").concat(v,", brMin: ").concat(b,"]"));let{maxFramerate:w}=$("ENCODER_CONFIG_LIMIT");return w&&typeof w=="number"&&(d=Math.min(d,w)),{frameRate:d,bitrateMax:v||f,bitrateMin:b||_,scaleResolutionDownBy:1,scale:0}},hM=async(e,t,s)=>await(async(a,c,d)=>{let h=function(_){let v=[];for(let b=0;b<_.length;b+=2)v.push(parseInt(_.slice(b,b+2),16));return Uint8Array.from(v)}(wL(""+c+d)).slice(0,16),p=h.slice(0,12),f=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},f,a))})(e.buffer,t,s),J0=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new Be((s,a)=>{t.toBlob(async c=>{if(t.remove(),c){let d=await pM(c);s({buffer:d,width:t.width,height:t.height})}else a(new _e(q.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},pM=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var mM,fM,gM,_M,vM,EM,yM,xM,bM,wM,SM,CM,TM,NM,RM,AM,IM,DM,Ts,OM,jM,PM,kM,LM,MM,So,FM,UM,VM,BM,WM,GM,HM,zM,KM,qM,YM,$M,XM,Ir;let Ps=(mM=ut({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),fM=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),gM=js(),_M=eh("LocalAudioTrack","_enabledMutex"),vM=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),EM=js(),yM=eh("LocalAudioTrack","_enabledMutex"),xM=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),bM=js(),wM=js(),SM=js(),CM=ut({argsMap:e=>[e.getTrackId()]}),TM=js(),NM=ut({argsMap:e=>[e.getTrackId()]}),RM=js(),AM=ut({argsMap:e=>[e.getTrackId()]}),IM=ut({argsMap:(e,t)=>[e.getTrackId(),t.name]}),DM=ut({argsMap:e=>[e.getTrackId()]}),Ot((Ts=class extends ch{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?mn.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,s,a){super(e,s),ce(this,"trackMediaType",oh.AUDIO),ce(this,"_encoderConfig",void 0),ce(this,"_trackSource",void 0),ce(this,"metadata",[]),ce(this,"_enabled",!0),ce(this,"_volume",100),ce(this,"_useAudioElement",!0),ce(this,"_bypassWebAudio",!1),ce(this,"processor",void 0),ce(this,"_processorContext",void 0),ce(this,"_processorDestination",void 0),ce(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!a,this._trackSource=new X0,$("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),$("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Tr()&&!ui?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){ns(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&mn.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void A.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,as(this,Ye.NEED_REPLACE_TRACK,this).then(()=>{A.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{A.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!WL())throw new _e(q.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mn.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,s){return this._setEnabled(e,t,s)}async _setEnabled(e,t,s){if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await as(this,Ye.NEED_ENABLE_TRACK,this),A.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(a){throw s||(this._enabled=!1),A.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await as(this,Ye.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,A.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await as(this,Ye.NEED_MUTE_TRACK,this):await as(this,Ye.NEED_UNMUTE_TRACK,this))}getStats(){return Bc(()=>{A.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),oi(this,Ye.GET_STATS)||ds({},G0)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(li.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(li.ON_AUDIO_BUFFER),this._source.on(li.ON_AUDIO_BUFFER,s=>e(s))}play(){A.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(A.debug("[".concat(this.getTrackId(),"] start audio playback in element")),mn.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){A.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?mn.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];A.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mn.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await as(this,Ye.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Be.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new _e(q.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new _e(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(nn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await as(this,Ye.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await as(this,Ye.NEED_REPLACE_TRACK,this))}),e.on(nn.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(nn.ON_TRACK),e.removeAllListeners(nn.ON_NODE)}bindProcessorContextEvents(e){e.on(di.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(di.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof X0&&(this._trackSource=new QL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new cM(this._source.context,this.getTrackId(),"local"),t=new oM(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(li.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(mn.stop(this.getTrackId()),this._source.play()),as(this,Ye.NEED_REPLACE_MIXING_TRACK,this).then(()=>{A.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{A.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[mM],Object.getOwnPropertyDescriptor(Ts.prototype,"setVolume"),Ts.prototype),Ot(Ts.prototype,"setPlaybackDevice",[fM,gM],Object.getOwnPropertyDescriptor(Ts.prototype,"setPlaybackDevice"),Ts.prototype),Ot(Ts.prototype,"setEnabled",[_M,vM,EM],Object.getOwnPropertyDescriptor(Ts.prototype,"setEnabled"),Ts.prototype),Ot(Ts.prototype,"setMuted",[yM,xM,bM],Object.getOwnPropertyDescriptor(Ts.prototype,"setMuted"),Ts.prototype),Ot(Ts.prototype,"getStats",[wM],Object.getOwnPropertyDescriptor(Ts.prototype,"getStats"),Ts.prototype),Ot(Ts.prototype,"setAudioFrameCallback",[SM],Object.getOwnPropertyDescriptor(Ts.prototype,"setAudioFrameCallback"),Ts.prototype),Ot(Ts.prototype,"play",[CM,TM],Object.getOwnPropertyDescriptor(Ts.prototype,"play"),Ts.prototype),Ot(Ts.prototype,"stop",[NM,RM],Object.getOwnPropertyDescriptor(Ts.prototype,"stop"),Ts.prototype),Ot(Ts.prototype,"close",[AM],Object.getOwnPropertyDescriptor(Ts.prototype,"close"),Ts.prototype),Ot(Ts.prototype,"pipe",[IM],Object.getOwnPropertyDescriptor(Ts.prototype,"pipe"),Ts.prototype),Ot(Ts.prototype,"unpipe",[DM],Object.getOwnPropertyDescriptor(Ts.prototype,"unpipe"),Ts.prototype),Ts),Gm=(OM=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),jM=js(),PM=eh("MicrophoneAudioTrack","_enabledMutex"),kM=ut({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),LM=js(),MM=ut({argsMap:e=>[e.getTrackId()]}),Ot((So=class extends Ps{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,s,a){super(e,t.encoderConfig?Wv(t.encoderConfig):{},a,$("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ce(this,"_config",void 0),ce(this,"_deviceName","default"),ce(this,"_constraints",void 0),ce(this,"_originalConstraints",void 0),ce(this,"_enabled",!0),this._config=t,this._constraints=s,this._originalConstraints=s,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Xu()||_0())&&ss.bindInterruptDetectorTrack(this)}async setDevice(e){if(A.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await pi.getDeviceById(e),s={};s.audio=ds({},this._constraints),s.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let a=null;try{a=await hi(s,this.getTrackId())}catch(c){throw A.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await hi({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await pi.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}A.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,s){if(t)return A.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),e),$("AUTO_RESET_AUDIO_ROUTE")&&(zr()||na())){let h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await as(this,Ye.NEED_DISABLE_TRACK,this)}catch(h){throw A.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}let c=ds({},this._constraints),d=pi.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);let h=await hi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await as(this,Ye.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),A.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}A.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Xu()||_0())&&ss.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((zr()||na())&&this._enabled&&!this._isClosed&&ss.duringInterruption){let e=async()=>{ss.off(Er.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ss.on(Er.IOS_INTERRUPTION_END,e)}else A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ah.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,s=pi.searchDeviceIdByName(this._deviceName);if(s&&!t.deviceId&&(t.deviceId=s),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let a=await hi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(di.REQUEST_UPDATE_CONSTRAINTS,async(t,s,a)=>{try{let c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(di.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[OM,jM],Object.getOwnPropertyDescriptor(So.prototype,"setDevice"),So.prototype),Ot(So.prototype,"setEnabled",[PM,kM,LM],Object.getOwnPropertyDescriptor(So.prototype,"setEnabled"),So.prototype),Ot(So.prototype,"close",[MM],Object.getOwnPropertyDescriptor(So.prototype,"close"),So.prototype),So),jie=(FM=ut({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),UM=js(),VM=ut({argsMap:e=>[e.getTrackId()]}),BM=js(),WM=ut({argsMap:e=>[e.getTrackId()]}),GM=js(),HM=ut({argsMap:e=>[e.getTrackId()]}),zM=js(),KM=ut({argsMap:e=>[e.getTrackId()]}),qM=js(),YM=ut({argsMap:e=>[e.getTrackId()]}),$M=ut({argsMap:e=>[e.getTrackId()]}),XM=js(),Ot((Ir=class extends Ps{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,s,a){super(t.createOutputTrack(),s,a),ce(this,"source",void 0),ce(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(li.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(ah.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){ns(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[FM,UM],Object.getOwnPropertyDescriptor(Ir.prototype,"startProcessAudioBuffer"),Ir.prototype),Ot(Ir.prototype,"pauseProcessAudioBuffer",[VM,BM],Object.getOwnPropertyDescriptor(Ir.prototype,"pauseProcessAudioBuffer"),Ir.prototype),Ot(Ir.prototype,"seekAudioBuffer",[WM,GM],Object.getOwnPropertyDescriptor(Ir.prototype,"seekAudioBuffer"),Ir.prototype),Ot(Ir.prototype,"resumeProcessAudioBuffer",[HM,zM],Object.getOwnPropertyDescriptor(Ir.prototype,"resumeProcessAudioBuffer"),Ir.prototype),Ot(Ir.prototype,"stopProcessAudioBuffer",[KM,qM],Object.getOwnPropertyDescriptor(Ir.prototype,"stopProcessAudioBuffer"),Ir.prototype),Ot(Ir.prototype,"close",[YM],Object.getOwnPropertyDescriptor(Ir.prototype,"close"),Ir.prototype),Ot(Ir.prototype,"setAudioBufferPlaybackSpeed",[$M,XM],Object.getOwnPropertyDescriptor(Ir.prototype,"setAudioBufferPlaybackSpeed"),Ir.prototype),Ir);class Xs extends Ps{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=lh().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,os(8,"track-mix-")),ce(this,"trackList",void 0),ce(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(A.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):A.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){A.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Ov(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(s=>{s instanceof Xs?s.emit(hd.TRANSCEIVER_UPDATED,t):s._updateRtpTransceiver(t)}))}}class Pie extends JL{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(li.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ce(this,"audioBuffer",void 0),ce(this,"sourceNode",void 0),ce(this,"startPlayTime",0),ce(this,"startPlayOffset",0),ce(this,"pausePlayTime",0),ce(this,"options",void 0),ce(this,"currentLoopCount",0),ce(this,"currentPlaybackSpeed",100),ce(this,"_currentState","stopped"),this.audioBuffer=t,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):A.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let JM=new Map;function QM(e,t){if(e.length===0||t.length===0)return 1/0;let s=C0(e),a=C0(t);return Math.floor(a/s)}class Q0{get rendFrameRate(){let t=Math.max(1,QM(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:kr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(A.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var s;t!==this._videoState&&(this._videoState=t,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(t){ce(this,"trackId",void 0),ce(this,"config",void 0),ce(this,"onFirstVideoFrameDecoded",void 0),ce(this,"onFirstVideoFrameRender",void 0),ce(this,"onVideoStateChanged",void 0),ce(this,"freezeTimeCounterList",[]),ce(this,"renderFreezeAccTime",0),ce(this,"renderFreezeAccTime2",0),ce(this,"isKeepLastFrame",!1),ce(this,"isDestroyed",!1),ce(this,"timeUpdatedCount",0),ce(this,"freezeTime",0),ce(this,"playbackTime",0),ce(this,"lastTimeUpdatedTime",0),ce(this,"autoplayFailed",!1),ce(this,"videoTrack",void 0),ce(this,"videoElement",void 0),ce(this,"cacheVideoElement",void 0),ce(this,"internal",!1),ce(this,"_render_interframe_delays",[]),ce(this,"_render_interframe_delays_sizes",[]),ce(this,"_videoState",wo.VideoStateStopped),ce(this,"videoElementCheckInterval",void 0),ce(this,"videoElementFreezeTimeout",void 0),ce(this,"_videoElementStatus",kr.NONE),ce(this,"_isInPage",!0),ce(this,"isGettingVideoDimensions",!1),ce(this,"startGetVideoDimensions",()=>{let s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return A.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),ce(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ss.curState==="running"&&(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(J2())),iL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ce(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":s.type==="play"&&A.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=kr.PLAYING;break;case"loadeddata":if(this.videoState=wo.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=kr.CANPLAY;break;case"stalled":this.videoElementStatus=kr.STALLED;break;case"suspend":this.videoElementStatus=kr.SUSPEND;break;case"pause":this.videoElementStatus=kr.PAUSED,zr()||na()||Tr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=kr.WAITING;break;case"abort":this.videoElementStatus=kr.ABORT;break;case"ended":this.videoElementStatus=kr.ENDED;break;case"emptied":this.videoElementStatus=kr.EMPTIED;break;case"error":{let a=this.videoElement.error;a&&(this.videoElementStatus=kr.ERROR,A.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{let a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);let c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,Co.lastVisibleTime<Co.lastHiddenTime||d<Co.lastHiddenTime||d<Co.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>$("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;let h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ce(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(J2())),iL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),ss.on(Er.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ss.on(Er.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let s=this.videoElement.play();s&&s.catch&&s.catch(c=>{t&&nM(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(A.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):A.warning("[".concat(this.trackId,"] play warning: "),c)});let a=Lt();if((a.name==="Safari"&&Number(a.version)===15||Xu())&&s&&s.then){let c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let s=t.getContext("2d");if(!s)return A.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,t.width,t.height);let a=s.getImageData(0,0,t.width,t.height);return t.remove(),a}async getCurrentFrameToUint8Array(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;let c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new Be((d,h)=>{a.toBlob(async p=>{if(a.remove(),p){let f=await pM(p);d({buffer:f,width:a.width,height:a.height})}else h(new _e(q.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,s<0?.1:s>1?1:s)})):await J0(t)}destroy(){this.isDestroyed=!0,ss.off(Er.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ss.off(Er.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=wo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=kr.INIT,!this.videoElementCheckInterval&&(ZM.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(d){return d!==document.body&&document.body.contains(d)}(this.videoElement)},1e3),$("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,s;let d,h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===wo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=wo.VideoStateFrozen:document.addEventListener("visibilitychange",h))},f=(_,v)=>{if(this.videoElementStatus===kr.PLAYING){if(d){let T=v.presentationTime-d.presentationTime,U=v.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(U),this._render_interframe_delays.push(T);let k=C0(this._render_interframe_delays_sizes),F=k-this._render_interframe_delays_sizes[0];if(k>30&&F>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===wo.VideoStateStarting&&(this.videoState=wo.VideoStateDecoding),this.videoState===wo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION"))),T<$("VIDEO_FREEZE_DURATION")&&this.videoState===wo.VideoStateFrozen&&(this.videoState=wo.VideoStateDecoding),T>$("VIDEO_FREEZE_DURATION")&&Co.lastVisibleTime>=Co.lastHiddenTime&&d.timestamp>Co.lastVisibleTime&&d.timestamp>Co.lastHiddenTime){let K=Math.min(66,QM(this._render_interframe_delays_sizes,this._render_interframe_delays)),Y=Math.max(0,T-(U-1)*K);this.renderFreezeAccTime2+=Y>K?Y:0,this.renderFreezeAccTime+=T}}d=ds(ds({},v),{},{timestamp:_})}else this.isSkipCalcRenderFreezeTime()&&(d=ds(ds({},v),{},{timestamp:_}));var b,w;$("ENABLE_VIDEO_FRAME_CALLBACK")&&((b=(w=this.videoElement).requestVideoFrameCallback)===null||b===void 0||b.call(w,f))};(t=(s=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(s,f)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Dv()&&!$("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let a=Lt();a.name==="Safari"&&Number(a.version)===15||Xu()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Rs()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Rs()&&this.videoElement.load());let c=this.videoElement.play();c!==void 0&&c.catch(d=>{A.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){ZM.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=kr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===kr.DESTROYED||this.internal}handleAutoPlayFailed(){let t=s=>{s.preventDefault(),this.videoElement.play().then(()=>{A.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{A.error(a)}),this.autoplayFailed=!1,Om()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Om()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),rM()}}let ZM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Z0 extends Q0{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),ce(this,"container",void 0),ce(this,"slot",void 0),this.slot=t.element,this.internal=s,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let s=t.element;var a;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(a=this.slot)===null||a===void 0||a.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,a):await J0(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",$("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var eF,tF,sF,rF,nF,iF,aF,oF,cF,lF,dF,uF,hF,pF,mF,fF,gF,_F,vF,EF,yF,xF,bF,wF,SF,CF,TF,NF,Nt,RF,AF,IF,DF,OF,jF,PF,kF,fi;let hs=(eF=ut({argsMap:(e,t,s)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),tF=js(),sF=ut({argsMap:e=>[e.getTrackId()]}),rF=eh("LocalVideoTrack","_enabledMutex"),nF=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),iF=js(),aF=eh("LocalVideoTrack","_enabledMutex"),oF=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),cF=js(),lF=ut({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),dF=js(),uF=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),hF=js(),pF=js(),mF=ut({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),fF=js(),gF=js(),_F=js(),vF=ut({argsMap:e=>[e.getTrackId()]}),EF=js(),yF=js(),xF=js(),bF=js(),wF=js(),SF=ut({argsMap:(e,t)=>[e.getTrackId(),t.name]}),CF=ut({argsMap:e=>[e.getTrackId()]}),TF=ut({argsMap:e=>[e.getTrackId()]}),NF=ut({argsMap:(e,t,s)=>[e.getTrackId(),t.label,s]}),Nt=class az extends ch{get videoHeight(){if(Tr()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Tr()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==kr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,s,a,c,d,h){if(super(t,d),ce(this,"trackMediaType",oh.VIDEO),ce(this,"_player",void 0),ce(this,"isUseScaleResolutionDownBy",!1),ce(this,"_videoVisibleTimer",null),ce(this,"_previousVideoVisibleStatus",void 0),ce(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ce(this,"_encoderConfig",void 0),ce(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ce(this,"_optimizationMode",void 0),ce(this,"_saveEncodeBitrateRatio",1),ce(this,"_videoHeight",void 0),ce(this,"_videoWidth",void 0),ce(this,"_forceBitrateLimit",void 0),ce(this,"_enabled",!0),ce(this,"_processorDestination",void 0),ce(this,"_processorContext",void 0),Tr()){let{width:p,height:f}=t.getSettings();this._videoWidth=p,this._videoHeight=f}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],s&&this._hints.indexOf(is.CUSTOM_TRACK)!==-1?this._encoderConfig=bs(s):this._encoderConfig=s,this._hints.indexOf(is.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(h0(Wt.CHROME,115)&&Av().indexOf("Windows")!==-1){let p=function(f,_){if("VideoFrame"in window&&"TransformStream"in window&&Vt().supportWebRTCInsertableStream){let v=new MediaStreamTrackProcessor(f),b=new MediaStreamTrackGenerator({kind:"video"}),w,T,U=Date.now(),k=()=>{F&&(clearInterval(F),F=void 0),w&&(w.close(),w=void 0),f.stop(),T=void 0,b.removeEventListener("ended",k)},F=window.setInterval(()=>{if(T&&w&&Date.now()-U>1e3)try{b.readyState==="live"?T.enqueue(w.clone()):k()}catch{k()}},1e3),K=new TransformStream({transform:(Y,X)=>{b.readyState==="live"?(T=X,U=Date.now(),w===void 0?(w=Y,X.enqueue(Y.clone())):(X.enqueue(w),w=Y)):Y.close()}});return b.addEventListener("ended",k),v.readable.pipeThrough(K).pipeTo(b.writable),b}}(t);p&&(A.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}s&&this._hints.indexOf(is.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new aM(this.getTrackId(),"local"),this._processorDestination=new iM(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let c=document.getElementById(t);c?t=c:(A.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}A.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));let a=ds(ds(ds({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(a):(t instanceof HTMLVideoElement?this._player=new Q0(a):this._player=new Z0(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let c=this.getVideoElementVisibleStatus();this.safeEmit(ah.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,A.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await as(this,Ye.NEED_DISABLE_TRACK,this)}catch(a){throw A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void A.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await as(this,Ye.NEED_ENABLE_TRACK,this)}catch(a){throw A.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}A.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,A.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await as(this,Ye.NEED_MUTE_TRACK,this):await as(this,Ye.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),A.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await as(this,Ye.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(A)}}}async setEncoderConfiguration(t,s){if(!this._enabled)throw new _e(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=oa(t),$("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let a=zv({encoderConfig:t});(Tr()||zr()||na())&&(a.deviceId=void 0),A.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){let d=new _e(q.UNEXPECTED_ERROR,c.toString());throw A.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=t,this._hints.indexOf(is.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await as(this,Ye.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(A)}}getStats(){return Bc(()=>{A.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),oi(this,Ye.GET_STATS)||ds({},H0)}async setBeautyEffect(t){A.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,s):await J0(t)}async findClosestProfile(){let{width:t,height:s,frameRate:a}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},p=Zu(this._videoWidth||t||c||0),f=Zu(this._videoHeight||s||d||0),_=function(v,b,w){if(!Array.isArray($("VIDEO_ENCODER_CONFIG_LIST"))||$("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let T=Math.min(v,b);return!(T>=480)&&ds(ds({},$("VIDEO_ENCODER_CONFIG_LIST").find(U=>U.height>T)),{},{frameRate:w})}(p,f,Zu(a||h||15));if(_)return A.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(p,"x").concat(f," => ").concat(JSON.stringify(_))),this.setEncoderConfiguration(_)}async setBitrateLimit(t){A.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void A.error(q.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let s=this._optimizationMode;try{this._optimizationMode=t,await as(this,Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,A.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}A.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return A.error(q.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,A.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){lM(this._originMediaStreamTrack).then(t=>{let[s,a]=t;this._videoHeight=a,this._videoWidth=s}).catch(Pv)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new _e(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");A.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=oa(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(is.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await as(this,Ye.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(A)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!t||!s||!a)return;let{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){let{max:h,min:p}=function(f,_,v,b,w){let T=$("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:b,max:w};if(w===void 0){let U=Math.floor(200*Math.pow(v/15,.6)*Math.pow(f*_/640/360,.75));w=T==="STANDARD_BITRATE"?4*U:2*U,b=b??U}else b=b??Math.floor(w/10);return{min:b,max:w}}(t,s,a,d,c);if(this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=h,$("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){let[f,_]=function(v,b,w){let T=4*Math.floor(2e5*Math.pow(w/15,.6)*Math.pow(v*b/230400,.75)),U=v*b,k=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),F=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),K=Vn(k).call(k).next().value,Y=1;if(k.has(U))K=k.get(U);else{var X;let je=ed(X=Array.from(k.entries())).call(X,(Ct,mt)=>{let[Yt]=Ct,[zt]=mt;return Yt-zt}),wt=je.find(Ct=>{let[mt]=Ct;return mt>U});if(wt){let Ct=je.indexOf(wt);if(Ct>0){let mt=je[Ct-1],Yt=(U-mt[0])/(wt[0]-mt[0]);K=mt[1]+Yt*(wt[1]-mt[1])}else K=wt[1]}else K=je[je.length-1][1]}if(F.has(U))Y=F.get(U);else{var re;let je=ed(re=Array.from(F.entries())).call(re,(Ct,mt)=>{let[Yt]=Ct,[zt]=mt;return Yt-zt}),wt=je.find(Ct=>{let[mt]=Ct;return mt>U});if(wt){let Ct=je.indexOf(wt);if(Ct>0){let mt=je[Ct-1],Yt=(U-mt[0])/(wt[0]-mt[0]);Y=mt[1]+Yt*(wt[1]-mt[1])}else Y=wt[1]}else Y=je[je.length-1][1]}let te=$("VIDEO_NEW_BITRATE_RATIO");te&&te>0&&(K=te/100);let Z=Math.floor(T*K),le=Math.floor(65e4*Math.pow(v*b/230400,.5)*Math.pow(w/15,.69)),xe=Z,Ce=$("VIDEO_STANDARD_BITRATE_VERSION");return Ce&&Ce>0&&(Ce===1?xe=T:Ce===2?xe=Z:Ce===3&&(xe=le)),[Math.floor(xe/1e3),Y]}(t,s,a);this._encoderConfig.bitrateMax=f,this._encoderConfig.bitrateMin=p?Math.min(p,f):f,this._saveEncodeBitrateRatio=_,A.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else A.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(p,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,s;let a=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){let p=dL.checkOneElementVisible(d),f=Object.assign({},p);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;let _=Ze.reportApiInvoke(null,{tag:xs.TRACER,name:ks.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(a){throw new _e(q.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new _e(q.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=ds(ds({},a),oa(t))),a=cd(a);let c=os(8,"track-video-cloned-"),d=new az(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,cd(this._scalabilityMode),this._optimizationMode,c,cd(this._hints));return t&&a&&d.setEncoderConfiguration(a),A.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(t,s){if(!(t instanceof MediaStreamTrack))throw new _e(q.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new _e(q.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Bc(()=>{Ze.reportApiInvoke(null,{name:ks.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:xs.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!$("ENABLE_VIDEO_SEI")||!$("ENABLE_ENCODED_TRANSFORM"))return void A.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new _e(q.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let s=this.getRTCRtpTransceiver();if(!s)return void A.warning("Video track is not published, SEI can not be send");let a=s.sender.getParameters();if(a.codecs.length===0)return;let c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",t):A.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(nn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await as(this,Ye.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await as(this,Ye.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(nn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(di.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(di.REQUEST_CONSTRAINTS)}},Ot(Nt.prototype,"play",[eF,tF],Object.getOwnPropertyDescriptor(Nt.prototype,"play"),Nt.prototype),Ot(Nt.prototype,"stop",[sF],Object.getOwnPropertyDescriptor(Nt.prototype,"stop"),Nt.prototype),Ot(Nt.prototype,"setEnabled",[rF,nF,iF],Object.getOwnPropertyDescriptor(Nt.prototype,"setEnabled"),Nt.prototype),Ot(Nt.prototype,"setMuted",[aF,oF,cF],Object.getOwnPropertyDescriptor(Nt.prototype,"setMuted"),Nt.prototype),Ot(Nt.prototype,"setSaveEncodeBitrateRatio",[lF,dF],Object.getOwnPropertyDescriptor(Nt.prototype,"setSaveEncodeBitrateRatio"),Nt.prototype),Ot(Nt.prototype,"setEncoderConfiguration",[uF,hF],Object.getOwnPropertyDescriptor(Nt.prototype,"setEncoderConfiguration"),Nt.prototype),Ot(Nt.prototype,"getStats",[pF],Object.getOwnPropertyDescriptor(Nt.prototype,"getStats"),Nt.prototype),Ot(Nt.prototype,"setBeautyEffect",[mF,fF],Object.getOwnPropertyDescriptor(Nt.prototype,"setBeautyEffect"),Nt.prototype),Ot(Nt.prototype,"getCurrentFrameData",[gF],Object.getOwnPropertyDescriptor(Nt.prototype,"getCurrentFrameData"),Nt.prototype),Ot(Nt.prototype,"getCurrentFrameImage",[_F],Object.getOwnPropertyDescriptor(Nt.prototype,"getCurrentFrameImage"),Nt.prototype),Ot(Nt.prototype,"findClosestProfile",[vF,EF],Object.getOwnPropertyDescriptor(Nt.prototype,"findClosestProfile"),Nt.prototype),Ot(Nt.prototype,"setBitrateLimit",[yF],Object.getOwnPropertyDescriptor(Nt.prototype,"setBitrateLimit"),Nt.prototype),Ot(Nt.prototype,"setOptimizationMode",[xF],Object.getOwnPropertyDescriptor(Nt.prototype,"setOptimizationMode"),Nt.prototype),Ot(Nt.prototype,"setScalabiltyMode",[bF],Object.getOwnPropertyDescriptor(Nt.prototype,"setScalabiltyMode"),Nt.prototype),Ot(Nt.prototype,"updateMediaStreamTrackResolution",[wF],Object.getOwnPropertyDescriptor(Nt.prototype,"updateMediaStreamTrackResolution"),Nt.prototype),Ot(Nt.prototype,"pipe",[SF],Object.getOwnPropertyDescriptor(Nt.prototype,"pipe"),Nt.prototype),Ot(Nt.prototype,"unpipe",[CF],Object.getOwnPropertyDescriptor(Nt.prototype,"unpipe"),Nt.prototype),Ot(Nt.prototype,"close",[TF],Object.getOwnPropertyDescriptor(Nt.prototype,"close"),Nt.prototype),Ot(Nt.prototype,"replaceTrack",[NF],Object.getOwnPropertyDescriptor(Nt.prototype,"replaceTrack"),Nt.prototype),Nt),Kv=(RF=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),AF=js(),IF=eh("CameraVideoTrack","_enabledMutex"),DF=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),OF=js(),jF=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),PF=js(),kF=ut({argsMap:e=>[e.getTrackId()]}),fi=class oz extends hs{get __className__(){return"CameraVideoTrack"}constructor(t,s,a,c,d,h){super(t,oa(s.encoderConfig),c,d,h),ce(this,"_config",void 0),ce(this,"_originalConstraints",void 0),ce(this,"_constraints",void 0),ce(this,"_enabled",!0),ce(this,"_deviceName","default"),ce(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Xu()||_0())&&!function(){let p=Lt();if(p.os!==ar.IOS||!p.osVersion)return!1;let f=p.osVersion.split(".");return Number(f[0])===15&&Number(f[1])>=2}()&&aL()&&this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=t.label,this._encoderConfig=oa(this._config.encoderConfig),ss.on(Er.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ss.on(Er.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(A.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let s=await pi.getDeviceById(t),a={};a.video=ds({},this._constraints),a.video.deviceId={exact:t},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await hi(a,this.getTrackId())}catch(d){throw A.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await hi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{let s=await pi.getDeviceById(t);this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}A.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){A.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let s={video:ds(ds({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await hi(s,this.getTrackId())}catch(c){throw A.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await hi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=ds({},s.video),A.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let a=await hi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await as(this,Ye.NEED_ENABLE_TRACK,this)}catch(a){throw A.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),A.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await as(this,Ye.NEED_DISABLE_TRACK,this)}catch(a){throw A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}A.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,s){if(!this._enabled)throw new _e(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=oa(t),$("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let a=bs(this._config);a.encoderConfig=t;let c=zv(a);(Tr()||zr()||na())&&(c.deviceId=void 0),A.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){let h=new _e(q.UNEXPECTED_ERROR,d.toString());throw A.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(is.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await as(this,Ye.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(A)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((zr()||na())&&this._enabled&&!this._isClosed&&ss.duringInterruption){let t=async()=>{ss.off(Er.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ss.on(Er.IOS_INTERRUPTION_END,t)}else A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ah.TRACK_ENDED)}async renewMediaStreamTrack(t){let s=t||this._constraints,a=pi.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){let c=await hi({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ss.off(Er.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ss.off(Er.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=ds(ds({},a),oa(t))),a=cd(a);let c=os(8,"track-cam-cloned-"),d=new oz(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,cd(ds(ds({},this._config),{},{encoderConfig:a})),cd(this._constraints),cd(this._scalabilityMode),this._optimizationMode,c);return t&&a&&d.setEncoderConfiguration(a),A.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(di.REQUEST_UPDATE_CONSTRAINTS,async(t,s,a)=>{try{let c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}),this.processorContext.on(di.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Ot(fi.prototype,"setDevice",[RF,AF],Object.getOwnPropertyDescriptor(fi.prototype,"setDevice"),fi.prototype),Ot(fi.prototype,"setEnabled",[IF,DF,OF],Object.getOwnPropertyDescriptor(fi.prototype,"setEnabled"),fi.prototype),Ot(fi.prototype,"setEncoderConfiguration",[jF,PF],Object.getOwnPropertyDescriptor(fi.prototype,"setEncoderConfiguration"),fi.prototype),Ot(fi.prototype,"close",[kF],Object.getOwnPropertyDescriptor(fi.prototype,"close"),fi.prototype),fi);function eC(e,t,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=ds(ds({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(t.contentHint=s.optimizationMode,t.contentHint===s.optimizationMode?A.debug("[".concat(e,"] set content hint to"),s.optimizationMode):A.debug("[".concat(e,"] set content hint failed")))):A.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var LF,MF,FF,UF,ji,VF,BF,WF,GF,HF,zF,Qr;class KF extends YL{getUserId(){return this._userId}constructor(t,s,a,c){super(t,"track-".concat(t.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(os(5,""))),ce(this,"_userId",void 0),ce(this,"_uintId",void 0),ce(this,"_isDestroyed",!1),ce(this,"store",void 0),ce(this,"processor",void 0),ce(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,A.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let uh=(LF=ut({argsMap:(e,t,s)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),MF=ut({argsMap:e=>[e.getTrackId()]}),FF=ut({argsMap:(e,t)=>[e.getTrackId(),t.name]}),UF=ut({argsMap:e=>[e.getTrackId()]}),Ot((ji=class extends KF{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==kr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,s,a,c){super(e,t,s,a),ce(this,"_videoVisibleTimer",null),ce(this,"_previousVideoVisibleStatus",void 0),ce(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ce(this,"trackMediaType",oh.VIDEO),ce(this,"_videoWidth",void 0),ce(this,"_videoHeight",void 0),ce(this,"_player",void 0),ce(this,"_prePlayer",void 0),ce(this,"processorDestination",void 0),ce(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new aM(this.getTrackId(),"remote"),this.processorDestination=new iM(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Bc(()=>{A.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),oi(this,Ye.GET_STATS)||ds({},KL)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Oi.PLAY_START),typeof e=="string"){let a=document.getElementById(e);a?e=a:(A.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}A.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let s=ds(ds({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(s);else{let a=!1,c=!1;e instanceof HTMLVideoElement?(this._player=new Q0(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,a=this._player.videoState>0,this._player.updateConfig(s)):this._player=new Z0(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Oi.FIRST_FRAME_DECODED),c&&this.safeEmit(Oi.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Oi.VIDEO_STATE_CHANGED,d)},a&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let a=this.getVideoElementVisibleStatus();this.safeEmit(Oi.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Oi.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,A.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){lM(this._originMediaStreamTrack).then(e=>{let[t,s]=e;this._videoHeight=s,this._videoWidth=t}).catch(Pv)}_updatePlayerSource(){A.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let s=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),a={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){let h=dL.checkOneElementVisible(c),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;let f=Ze.reportApiInvoke(null,{tag:xs.TRACER,name:ks.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(s){throw new _e(q.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new _e(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(nn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(nn.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(hd.SEI_RECEIVED,e)}}).prototype,"play",[LF],Object.getOwnPropertyDescriptor(ji.prototype,"play"),ji.prototype),Ot(ji.prototype,"stop",[MF],Object.getOwnPropertyDescriptor(ji.prototype,"stop"),ji.prototype),Ot(ji.prototype,"pipe",[FF],Object.getOwnPropertyDescriptor(ji.prototype,"pipe"),ji.prototype),Ot(ji.prototype,"unpipe",[UF],Object.getOwnPropertyDescriptor(ji.prototype,"unpipe"),ji.prototype),ji),hh=(VF=ut({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),BF=ut({argsMap:(e,t)=>[e.getTrackId(),t]}),WF=ut({argsMap:e=>[e.getTrackId()]}),GF=ut({argsMap:e=>[e.getTrackId()]}),HF=ut({argsMap:(e,t)=>[e.getTrackId(),t.name]}),zF=ut({argsMap:e=>[e.getTrackId()]}),Ot((Qr=class extends KF{get isPlaying(){return this._useAudioElement?mn.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,s,a){super(e,t,s,a),ce(this,"trackMediaType",oh.AUDIO),ce(this,"_source",void 0),ce(this,"_useAudioElement",!0),ce(this,"_volume",100),ce(this,"processorContext",void 0),ce(this,"processorDestination",void 0),ce(this,"_played",!1),ce(this,"_bypassWebAudio",!1),$("DISABLE_WEBAUDIO")?(this._source=new X0,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new QL(e,!0),$("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(li.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Oi.FIRST_FRAME_DECODED)}),this.processorContext=new cM(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new oM(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(li.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(li.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(li.ON_AUDIO_BUFFER),this._source.on(li.ON_AUDIO_BUFFER,s=>e(s))}setVolume(e){this._volume=e,this._useAudioElement?mn.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!WL())throw new _e(q.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mn.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Bc(()=>{A.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),oi(this,Ye.GET_STATS)||ds({},zL)}play(){A.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(A.debug("[".concat(this.getTrackId(),"] use audio element to play")),mn.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){A.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?mn.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];A.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mn.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new _e(q.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new _e(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new _e(q.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(nn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(nn.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(nn.ON_TRACK),this.processorDestination.removeAllListeners(nn.ON_NODE)}}).prototype,"setVolume",[VF],Object.getOwnPropertyDescriptor(Qr.prototype,"setVolume"),Qr.prototype),Ot(Qr.prototype,"setPlaybackDevice",[BF],Object.getOwnPropertyDescriptor(Qr.prototype,"setPlaybackDevice"),Qr.prototype),Ot(Qr.prototype,"play",[WF],Object.getOwnPropertyDescriptor(Qr.prototype,"play"),Qr.prototype),Ot(Qr.prototype,"stop",[GF],Object.getOwnPropertyDescriptor(Qr.prototype,"stop"),Qr.prototype),Ot(Qr.prototype,"pipe",[HF],Object.getOwnPropertyDescriptor(Qr.prototype,"pipe"),Qr.prototype),Ot(Qr.prototype,"unpipe",[zF],Object.getOwnPropertyDescriptor(Qr.prototype,"unpipe"),Qr.prototype),Qr),Co=new class extends Cs{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ce(this,"_lastHiddenTime",0),ce(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),A.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class qF extends Cs{constructor(t,s){super(),ce(this,"trackMediaType",oh.DATA),ce(this,"_version",1),ce(this,"_type",3),ce(this,"_config",void 0),ce(this,"_originDataChannel",void 0),ce(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ce(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),ce(this,"_datachannelEventMap",new Map),this._config=t,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return $("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,s;return(t=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,s;return(t=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Be((t,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let a=setTimeout(()=>{var c;s(new _e(q.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new _e(q.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new _e(q.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Gv.OPEN,Gv.CLOSE,Gv.ERROR].forEach(s=>{let a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),t.addEventListener(s,a)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[a,c]=s;t.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class kie extends qF{constructor(t){super(t),ce(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void($("SHOW_DATASTREAM2_LOG")&&A.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(Gv.MESSAGE,d)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Lie extends qF{send(t){if(this._originDataChannel){let s=t;s=this._dataStreamPacketHandler.serialize(t);let a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function qv(){let e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>K_.revokeObjectURL(e),0),new Worker(K_.createObjectURL(e))}let YF=71,tC=1,sC=2,rC=1,$F=2;var Hc=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Hc||{});function nC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=e.getUint8(0);if(s!==YF)return;let a=e.getUint16(1),c=tC+sC+a,d=new Uint8Array(e.byteLength-c);d.set(new Uint8Array(e.buffer,c,e.byteLength-c));let h={m:s,tlvLen:a,tlv:[],frame:d},p=tC+sC;for(;p<c;){let f=e.getUint8(p),_=e.getUint16(p+rC),v=rC+$F;if(f===Hc.AUDIO_LEVEL){let b=e.getUint8(p+v);for(let w=1;w<_;w++)b=b<<8|e.getUint8(p+v+w);h.tlv.push({tag:f,length:_,value:t?127^b>>1:127&b})}else if(f===Hc.METADATA||f===Hc.AUDIO_64_BIT_PTS){let b=new Uint8Array(_);for(let w=0;w<_;w++)b[w]=e.getUint8(p+v+w);h.tlv.push({tag:f,length:_,value:b})}p+=v+_}return h}let Yv=new Map,$v=127,fd=1e-10,iC=139/13,Xv=new Map;function aC(e,t,s){let a="".concat(e,"-").concat(t,"-").concat(s),c=0;return Xv.has(a)?c=Xv.get(a):(c=Math.log(function(d,h){let p=d-h;h<p&&(h=p);let f=1;for(let _=d,v=1;_>h;_--,v++)f=f*_/v;return f}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(s)+s*e,Xv.set(a,c)),c<fd&&(c=fd),c}function XF(e,t,s){let a=t.length,c=e.length/a,d=!1;for(let h=0,p=0;h<a;h++){let f=0;for(let _=p+c;p<_;p++)e[p]>s&&f++;t[h]!==f&&(t[h]=f,d=!0)}return d}window.cache=Xv;let Mie=0;class JF{constructor(t){ce(this,"id",void 0),ce(this,"immediates",[]),ce(this,"lastNonSilence",-1),ce(this,"immediateSpeechActivityScore",fd),ce(this,"lastLevelChangedTime",Date.now()),ce(this,"levels",[]),ce(this,"longs",[]),ce(this,"longSpeechActivityScore",fd),ce(this,"mediums",[]),ce(this,"mediumSpeechActivityScore",fd),ce(this,"minLevel",0),ce(this,"nextMinLevel",0),ce(this,"nextMinLevelWindowLength",0),ce(this,"energyScore",0),this.id=t||"".concat(Mie++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,s=this.levels,a=this.minLevel+iC,c=!1;for(let d=0;d<t.length;++d){let h=s[d];h<a&&(h=0);let p=Math.floor(h/iC);t[d]!==p&&(t[d]=p,c=!0)}return c}computeLongs(){return XF(this.mediums,this.longs,4)}computeMediums(){return XF(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=aC(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=aC(this.longs[0],10,47),this.longSpeechActivityScore>fd&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=aC(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(DD(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=t;return t<0&&(a=0),t>$v&&(a=$v),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+iC?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>$v&&(s=$v),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Fie{constructor(t){ce(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let s=this.algorithm.runInDecisionMaker(this);s<=0?t=!0:setTimeout(this.execute.bind(this),s)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class oC{constructor(t,s,a){ce(this,"isDominant",void 0),ce(this,"energyRanking",void 0),ce(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=s,this.energyScore=a}}class Uie extends Cs{constructor(t){super(),ce(this,"dominantId",null),ce(this,"lastDecisionTime",0),ce(this,"lastLevelChangedTime",0),ce(this,"lastLevelIdleTime",0),ce(this,"relativeSpeechActivities",[]),ce(this,"speakers",new Map),ce(this,"enableSilence",!1),ce(this,"timeoutToSilenceInterval",0),ce(this,"decisionMaker",null),ce(this,"loudest",[]),ce(this,"numLoudestToTrack",3),ce(this,"energyExpireTimeMs",250),ce(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(s=>s.id===t)}levelChanged(t,s){let a=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());let d=c.levelChanged(s,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(t){t.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(t){let s=this.speakers.get(t);return s||(s=new JF(t),this.speakers.set(t,s),this.maybeStartDecisionMaker()),s}updateLoudestList(t,s,a){let c=t.id===this.dominantId;if(s<0){let f=0;for(;f<this.loudest.length&&this.loudest[f]!==t;)++f;return new oC(c,f,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new oC(c,0,t.energyScore);let d=a-this.energyExpireTimeMs,h=0;for(;h<this.loudest.length;){let f=this.loudest[h];if(f.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(f.id!==t.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let p=0;for(;p<this.loudest.length&&!(this.loudest[p].energyScore<t.energyScore);)++p;return p<this.numLoudestToTrack&&(this.loudest.splice(p,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new oC(c,p,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Fie(this),this.decisionMaker.execute())}makeDecision(t){let s=null,a=null,c=this.speakers.size,d=null;if(c===0)d=null;else if(c===1){var h;let p=Vn(h=this.speakers).call(h).next().value;this.enableSilence&&p&&(d=p.id,p.evaluateSpeechActivityScores(t),t-p.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let p=this.dominantId==null?null:this.speakers.get(this.dominantId);if(p==null){let v=this.speakers.entries().next();v.value&&(d=v.value[0],p=v.value[1])}else d=p.id;p==null||p.evaluateSpeechActivityScores(t);let f=this.relativeSpeechActivities,_=2;for(let v of this.speakers.entries()){let[b,w]=v;if(w===p)continue;w.evaluateSpeechActivityScores(t);for(let F=0;F<f.length;++F){let K=p==null?fd:p.getSpeechActivityScore(F);f[F]=Math.log(w.getSpeechActivityScore(F)/K)}let T=f[0],U=f[1],k=f[2];T>3&&U>2&&k>0&&U>_&&(_=U,d=b)}this.enableSilence&&p!=null&&d===p.id&&t-p.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){let t=Date.now(),s=300-(t-this.lastLevelIdleTime),a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):a=s;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(t){let s=[];for(let c of Vn(a=this.speakers).call(a)){var a;let d=t-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}let ph=new Map,Wa=null,Jv=null,QF=3,gd=[],Ga=new Map,Qv=new Map;class Vie{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,s){ce(this,"id",void 0),ce(this,"track",void 0),ce(this,"score",0),ce(this,"active",!0),ce(this,"muted",!1),ce(this,"timer",0),ce(this,"actives",0),ce(this,"inactives",0),this.id=t,this.track=s,this.setActive(Ga.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:s,inactives:a}=function(){let c=[],d=[];return Array.from(Vn(Ga).call(Ga)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(s.length>3){let c;s.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=function(s){let a;return Array.from(Vn(Ga).call(Ga)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=function(s){let a;return Array.from(Vn(Ga).call(Ga)).forEach(c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Zv;function ZF(e){let t=Ga.get(e);t&&(Ga.delete(e),t.clearTimer())}let eE=new Map,Bie=new Map,cC="video/h264",lC="video/h265";function eU(e,t,s){let a=new Uint8Array(e,t,s),c=[],d=0;for(;c.length<s;)d+3<s&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}function tU(e){let t=e.length,s=[],a=0;for(;a<t;)a+2<t&&e[a]===0&&e[a+1]===0&&(e[a+2]===0||e[a+2]===1||e[a+2]===2||e[a+2]===3)?(s.push(e[a],e[a+1],3,e[a+2]),a+=3):(s.push(e[a]),a++);return new Uint8Array(s)}function sU(e){if(e.length<5)return"";let t=-1;for(let c=0;c<e.length-3;c++){if(e[c]===0&&e[c+1]===0&&e[c+2]===1){t=c;break}if(c<e.length-4&&e[c]===0&&e[c+1]===0&&e[c+2]===0&&e[c+3]===1){t=c;break}}if(t===-1)return"";let s=t+(e[t+2]===0?4:3);if(s>=e.length)return"";let a=e[s];return 128&a?"":(a>>1&63)>=32||s+1<e.length&&!(248&e[s+1])?lC:(31&a)<=31?cC:""}let tE=new Map,Hm=new Map;(function(){let e=Lt();vr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),vr.getStreamFromExtension=e.name===Wt.CHROME&&Number(e.version)>34,vr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,s=!1;try{t.addTransceiver("audio"),s=!0}catch{}return t.close(),s}(),vr.supportMinBitrate=e.name===Wt.CHROME||e.name===Wt.EDGE,vr.supportSetRtpSenderParameters=function(){let t=Lt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!rc()||!(!Tr()&&!Iv())||t.name===Wt.FIREFOX&&Number(t.version)>=64)}(),e.name===Wt.SAFARI&&(Number(e.version)>=14?vr.supportDualStream=!0:vr.supportDualStream=!1),vr.webAudioMediaStreamDest=function(){let t=Lt();return!(t.name===Wt.SAFARI&&Number(t.version)<12)}(),vr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",vr.supportWebGL=typeof WebGLRenderingContext<"u",vr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,rc()||(vr.webAudioWithAEC=!0),vr.supportShareAudio=function(){let t=Lt();return(t.os===ar.WIN_10||t.os===ar.WIN_81||t.os===ar.WIN_7||t.os===ar.LINUX||t.os===ar.MAC_OS||t.os===ar.CHROMIUM_OS)&&t.name===Wt.CHROME&&Number(t.version)>=74}(),vr.supportDataChannel=!!($u(76)||m0(68)||tL(14)),vr.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!Rs()&&!!t&&t.prototype.setConfiguration instanceof Function}(),vr.supportWebRTCEncodedTransform=$u(87)||Q2()||m0(117),vr.supportWebRTCInsertableStream=function(){let t=Lt();return(t.name===Wt.CHROME||t.name===Wt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),vr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,vr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,jv(()=>{vr.supportDualStreamEncoding=function(){let t=Lt();return!!$("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&$("CHROME_DUAL_STREAM_USE_ENCODING"))}(),A.debug("browser ua: ",navigator.userAgent),A.info("browser info: ",e),A.info("browser compatibility: ",vr)})})();let Wie=["CHINA","GLOBAL"],rU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],_d=[],mh=[];function vd(e,t){return!!t&&_d.some(s=>s.uid===e&&s.channelName===t)}function dC(){return mh.length>0}var Gie=_1.forEach,nU=n_("forEach")?[].forEach:function(e){return Gie(this,e,arguments.length>1?arguments[1]:void 0)};Zt({target:"Array",proto:!0,forced:[].forEach!==nU},{forEach:nU});var Hie=Xi("Array","forEach"),zie=Oc,Kie=Gr,qie=R,Yie=Hie,uC=Array.prototype,$ie={DOMTokenList:!0,NodeList:!0},Xie=function(e){var t=e.forEach;return e===uC||qie(uC,e)&&t===uC.forEach||Kie($ie,zie(e))?Yie:t},Jie=u(Xie),Qie=fo,iU=d_;Zt({target:"Object",stat:!0,forced:m(function(){iU(1)})},{keys:function(e){return iU(Qie(e))}});var Zie=u(Os.Object.keys),eae=u(RD),tae=u(ID),sae=Zt,aU=tm,rae=S_,nae=kt,oU=Db,iae=Dc,aae=rt,oae=$w,cae=$s,lae=Pc,dae=c1("slice"),uae=cae("species"),hC=Array,hae=Math.max;sae({target:"Array",proto:!0,forced:!dae},{slice:function(e,t){var s,a,c,d=aae(this),h=iae(d),p=oU(e,h),f=oU(t===void 0?h:t,h);if(aU(d)&&(s=d.constructor,(rae(s)&&(s===hC||aU(s.prototype))||nae(s)&&(s=s[uae])===null)&&(s=void 0),s===hC||s===void 0))return lae(d,p,f);for(a=new(s===void 0?hC:s)(hae(f-p,0)),c=0;p<f;p++,c++)p in d&&oae(a,c,d[p]);return a.length=c,a}});var pae=Xi("Array","slice"),mae=R,fae=pae,pC=Array.prototype,gae=function(e){var t=e.slice;return e===pC||mae(pC,e)&&t===pC.slice?fae:t},_ae=u(gae);function Je(e,t,s,a,c){var d,h,p,f={};return Jie(d=Zie(a)).call(d,function(_){f[_]=a[_]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=eae(h=tae(p=_ae(s).call(s)).call(p)).call(h,function(_,v){return v(e,t,_)||_},f),c&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(c):void 0,f.initializer=void 0),f.initializer===void 0?(n1(e,t,f),null):f}let sE=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),mC=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ca=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),an=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),lt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),us=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ft=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),pt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),zm=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),It=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),on=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),yt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function rE(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw A.error("Invalid Channel Name ".concat(e)),new de(q.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function nE(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||lL(e,1,255)))throw new de(q.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&A.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ic=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),vae={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},fC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function gC(e,t){gr(e.url,"".concat(t,".url"),1,1e3,!1),As(e.x)||ns(e.x,"".concat(t,".x"),0,1e4),As(e.y)||ns(e.y,"".concat(t,".y"),0,1e4),As(e.width)||ns(e.width,"".concat(t,".width"),0,1e4),As(e.height)||ns(e.height,"".concat(t,".height"),0,1e4),As(e.zOrder)||ns(e.zOrder,"".concat(t,".zOrder"),0,255),As(e.alpha)||ns(e.alpha,"".concat(t,".alpha"),0,1,!1)}let Eae={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},zc=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),_C=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Js=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function cU(e){if(!e.channelName)throw new de(q.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new de(q.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&gr(e.token,"info.token",1,2047),nE(e.uid),rE(e.channelName),!0}let cn=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),ac=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Tn=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),fh=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Qt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),dr=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),iE=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),or=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Kt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),lU=[Kt.AFRICA,Kt.ASIA,Kt.CHINA,Kt.EUROPE,Kt.GLOBAL,Kt.INDIA,Kt.JAPAN,Kt.NORTH_AMERICA,Kt.OCEANIA,Kt.OVERSEA,Kt.SOUTH_AMERICA],Lr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),aE={CHINA:{},ASIA:{CODE:Lr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Lr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Lr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Lr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Lr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Lr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Lr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Lr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Lr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Lr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Lr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Lr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Lr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};P0&&(aE.CHINA={CODE:Lr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Km=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function dU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class uU extends Cs{constructor(t,s){super(),W(this,"onICEConnectionStateChange",void 0),W(this,"onConnectionStateChange",void 0),W(this,"onDTLSTransportStateChange",void 0),W(this,"onDTLSTransportError",void 0),W(this,"onICETransportStateChange",void 0),W(this,"onFirstAudioReceived",void 0),W(this,"onFirstVideoReceived",void 0),W(this,"onFirstAudioDecoded",void 0),W(this,"onFirstVideoDecoded",void 0),W(this,"onFirstVideoRender",void 0),W(this,"onFirstVideoDecodedTimeout",void 0),W(this,"onSelectedLocalCandidateChanged",void 0),W(this,"onSelectedRemoteCandidateChanged",void 0),W(this,"onICECandidateError",void 0),W(this,"getLocalVideoStats",void 0)}}class hU extends uU{constructor(t,s){super(t,s),W(this,"establishPromise",void 0)}}let ze=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Mr=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),oc=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),pU=["disconnected","failed"],Ie=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Xt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),nt=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),la=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),da=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ur=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),mU=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),To=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Pi=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ha=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),gh=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Ms=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),_h=function(e){return e.ABORT="abort",e}({}),Kc=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),yae=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),xae={[sE.ACCESS_POINT]:{[an.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[an.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[an.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[an.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[an.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[an.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[an.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[an.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[an.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[an.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[an.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[an.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[an.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[an.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[an.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[an.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[an.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[an.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[sE.UNILBS]:{[ca.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ca.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ca.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ca.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ca.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ca.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ca.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ca.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ca.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ca.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ca.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ca.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[sE.STRING_UID_ALLOCATOR]:{[mC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[mC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[mC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function vh(e){let t=xae[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let s=t[e%1e4];if(!s){if(Math.floor(e/1e4)===sE.ACCESS_POINT){let a=e%1e4;if(a.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}let bae={[lt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[lt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[lt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[lt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[lt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[lt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[lt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[lt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[lt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[lt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[lt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[lt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[lt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[lt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[lt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[lt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[lt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[lt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[lt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[lt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[lt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[lt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[lt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[lt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[lt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[lt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[lt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[lt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[lt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[lt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[lt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[lt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[lt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[lt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[lt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[lt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[lt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[lt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[lt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[lt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[lt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[lt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[lt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[lt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[lt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[lt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[lt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[lt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[lt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[lt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[lt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[lt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[lt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[lt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[lt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[lt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[lt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[lt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[lt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[lt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[lt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[lt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[lt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function qm(e){return bae[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function fU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function vC(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?fU(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):fU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function EC(e,t){if(typeof e=="string")return e;let{proxy:s,host:a,port:c}=e;if(t){let d=$("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}let wae=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Sae=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Cae=/wss:\/\/(.+):([0-9]+)\/?/,Tae=/wss:\/\/(.[^\/]+)\/?/,Nae=0;class Rae{constructor(t,s){W(this,"id",0),W(this,"store",void 0),W(this,"recordIndex",void 0),W(this,"websockets",[]),W(this,"try443PortDuration",2e3),W(this,"forceCloseWSDuration",5e3),W(this,"try443PortTimeout",null),W(this,"forceCloseTimeout",null),W(this,"isTry443PortFailed",!1),W(this,"isNormalPortFailed",!1),W(this,"useDoubleDomain",!1),W(this,"useProxy",!1),W(this,"startTime",Date.now()),this.id=++Nae,this.try443PortDuration=$("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];A.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(t,s,a){this.logger("createWebSocket:",t,{isTry443Port:s,hasTimeoutDetection:a});let c=$("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=c.find(w=>{var T;return ke(T=t.host).call(T,w)});p||(this.useDoubleDomain=!1);let f=[];if(this.useDoubleDomain)c.forEach(w=>{f.push(EC(vC(vC({},t),{},{host:t.host.replace(p,w)}),s))});else{let w=vC({},t);if(s&&p){let T=c.find(U=>U!==p);T&&(w.host=w.host.replace(p,T))}f.push(EC(w,s))}try{f.forEach(w=>{let T=new WebSocket(w);T.binaryType="arraybuffer",h.push(T),this.logger("ws is connecting:",T.url)})}catch(w){if(this.logger("ws create failed"),h.forEach(T=>T.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,s,a);if(!s&&Number(t.port)!==443)return this.createWebSocket(t,!0,a);throw new de(q.WS_ERR,"init websocket failed! Error: ".concat(w.toString()))}let _=Dm();this.store&&this.store.recordJoinChannelService({urls:h.map(w=>w.url),service:"gateway"},this.recordIndex),h.forEach(w=>{w.onopen=()=>{this.logger("onopen: ws ".concat(w.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(T=>{T!==w&&(T.onopen=null,T.onclose=null,T.onmessage=null,T.close(),this.logger("close backup websocket: ".concat(T.url)))}),this.websockets.length=0,_.resolve(w)},w.onclose=T=>{this.logger("onclose: ws ".concat(w.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(w.readyState));let U=h.every(k=>k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(U)),U&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(T.reason)),_.reject({code:T.code,reason:iE.A_ROUND_WS_FAILED})):!s&&U&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),b()),s?this.isTry443PortFailed=U:this.isNormalPortFailed=U},w.onmessage=T=>this.logger("".concat(w.url," onmessage: ").concat(T.data))}),this.websockets.push(...h);let v=()=>{this.websockets.forEach(w=>w.readyState!==WebSocket.OPEN&&w.close())},b=()=>{if(_.isResolved)return v();Lt().os===ar.MAC_OS&&Rs()&&v(),this.createWebSocket(t,!0,!0).then(w=>{_.resolve(w)}).catch(w=>{this.isNormalPortFailed&&_.reject(w),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.forceCloseTimeout=null,v()},this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,v()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",_.isResolved),this.try443PortTimeout=null,b()},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(t,s,a,c){return this.useDoubleDomain=!!s,typeof t=="string"&&(t=function(d){let h,p,f;return[,h,p,f]=d.match(wae)||[],h||([,p,f]=d.match(Sae)||[]),p&&f||([,p,f]=d.match(Cae)||[]),p&&f||([,p]=d.match(Tae)||[]),p||A.warning("un-destructible url: ",d),{proxy:h,host:p,port:f||"443"}}(t)),this.recordIndex=c,this.useProxy=!!t.proxy,a&&this.useProxy&&(A.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(t,!!a,!1).finally(()=>this.clearTimeout())}}function gU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}class _U extends Cs{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var s;ke(s=["tryNext","recover"]).call(s,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(yt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(yt.CONNECTED):this._state==="closed"?this.emit(yt.CLOSED):this._state==="failed"&&this.emit(yt.FAILED))}resetReconnectCount(t){A.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),W(this,"_websocketUrl",null),W(this,"connectionID",0),W(this,"currentURLIndex",0),W(this,"urls",[]),W(this,"_reconnectMode","tryNext"),W(this,"reconnectReason",void 0),W(this,"_initMutex",void 0),W(this,"name",void 0),W(this,"_state","closed"),W(this,"reconnectInterrupter",void 0),W(this,"websocket",void 0),W(this,"retryConfig",void 0),W(this,"reconnectCount",0),W(this,"forceCloseTimeout",5e3),W(this,"onlineReconnectListener",void 0),W(this,"useCompress",void 0),W(this,"tryDoubleDomain",!1),W(this,"use443PortOnly",!1),W(this,"wsInflateLength",0),W(this,"wsDeflateLength",0),W(this,"closeEstablishingWs",()=>{}),W(this,"store",void 0),W(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=t,this.retryConfig=function(b){for(var w=1;w<arguments.length;w++){var T=arguments[w]!=null?arguments[w]:{};w%2?gU(Object(T),!0).forEach(function(U){W(b,U,T[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(T)):gU(Object(T)).forEach(function(U){Object.defineProperty(b,U,Object.getOwnPropertyDescriptor(T,U))})}return b}({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Pr("websocket",h?h.clientId:void 0);let{timeout:p,timeoutFactor:f}=s,_=Math.max(300,Math.floor(3*p/5)),v=Math.max(1.2,Math.floor(8*f)/10);Gn.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=v),Vs.on(Ju.NETWORK_STATE_CHANGE,(b,w)=>{b!==w&&(this.resetReconnectCount("network state change: ".concat(w," -> ").concat(b)),b===Gn.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f))})}getConnection(){return this.websocket||void 0}async init(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=t,this.state="connecting";try{var c;let d=Dm(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(p){return!(Vv()||$("USE_NEW_TOKEN")||!$("ENABLE_PREALLOC_PC")&&(p==null||!p.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(mU.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(yt.CLOSED,()=>{d.reject(new _e(q.WS_DISCONNECT))}),this.once(yt.CONNECTED,d.resolve),await d.promise}catch{}finally{a()}}close(t,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,s){if(!this.websocket)return void A.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),A.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);let a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new _e(q.WS_ABORT,"websocket is not ready");try{s||(t=JSON.stringify(t)),this.websocket.send(t)}catch(a){throw new _e(q.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var s;let a=Dm();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let c=v=>{var b;(b=this.store)===null||b===void 0||b.signalChannelOpen(),A.debug("[".concat(this.name,"] websocket opened:"),v),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async v=>{var b;if(A.debug("[".concat(this.name,"] websocket close ").concat((b=this.websocket)===null||b===void 0?void 0:b.url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new _e(q.WS_DISCONNECT,"websocket close: ".concat(v.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");let w=oi(this,yt.WILL_RECONNECT,this.reconnectMode,v.reason)||this.reconnectMode,T=await this.reconnectWithAction(w);if(this.state==="closed")return void A.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return a.reject(new _e(q.WS_DISCONNECT,"websocket reconnect failed: ".concat(v.code))),this.close(!0);a.resolve()}},h=v=>{this.emit(yt.ON_MESSAGE,v)},p=v=>{A.warn("[".concat(this.connectionID,"] ws open error ").concat(v))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),$("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=$("GATEWAY_WSS_ADDRESS")),A.debug("[".concat(this.name,"] start connect, url:"),t);let f=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var _;this._websocketUrl=EC(t);let v=await this.chooseBestWebsocketConnection(t);this.websocket=v,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=p,(_=this.store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},f),this.joinGatewayRecordIndex=f}catch(v){let b=this.state==="closed",w=v instanceof _e,T=w&&v.code===q.WS_ABORT,U=w&&v.code===q.WS_ERR,k=w?v.message:v&&(v.reason||v.toString());A.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(k)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[v]},f),b||U?(a.reject(b?new _e(q.WS_DISCONNECT,"websocket is closed: ".concat(k)):new _e(q.WS_ERR,"init websocket failed: ".concat(k))),U&&A.error("[".concat(this.name,"] init websocket failed: ").concat(k))):d&&d(v)}return a.promise}async reconnectWithAction(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;A.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Vs.isOnline||!Vs.onlineWaiter||(this.onlineReconnectListener=Vs.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){let h=T0(this.reconnectCount,this.retryConfig);A.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(t)),await Be.race([_r(h),this.onlineReconnectListener||new Be(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;let c=async(h,p)=>{this.emit(yt.RECONNECT_CREATE_CONNECTION,p),await this.createWebSocketConnection(h)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);A.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(A.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Rr(this,yt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(h){var d;A.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));let p=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(p)&&ke(p).call(p,"dynamic key expired")?(this.emit(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,s)}return!0}}class yC extends _U{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,s){let a=Dm(),c=function(h,p){return new Rae(h,p)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{A.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new _e(q.WS_ABORT,"choose best websocket aborted"))};let d=$("GATEWAY_DOMAINS");return A.debug("[choose-best-ws] currentDomain: ",t,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Ym extends _U{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,s){return new Be((a,c)=>{let d=!1,h=[];this.closeEstablishingWs=()=>{A.debug("[choose-best-ws] close establishing websockets"),h.forEach(U=>{U.onclose=null,U.onopen=null,U.onmessage=null,U.close()}),c(new _e(q.WS_ABORT,"choose best websocket aborted"))};let p=$("GATEWAY_DOMAINS"),f,_=t.indexOf("?h="),v=p.find(U=>_!==-1?ke(t).call(t,U,_):ke(t).call(t,U));A.debug("[choose-best-ws] currentDomain: ",v,", domains: ",p);let b=!this.tryDoubleDomain||!v;if(!b&&v){var w;let U=Date.now();try{p.forEach(k=>{let F=_===-1?t.replace(v,k):t.substr(0,_)+t.substr(_).replace(v,k),K=new WebSocket(F);K.binaryType="arraybuffer",h.push(K),A.debug("[choose-best-ws] ws is connecting:",K.url)})}catch{for(A.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(k=>k.close());h.length;)h.pop();b=!0}(w=this.store)===null||w===void 0||w.recordJoinChannelService({urls:h.map(k=>k.url),service:"gateway"},s),h.forEach(k=>{k.onopen=()=>{if(d)return;let F=Date.now()-U;A.debug("[choose-best-ws] ws open cost ".concat(F,"ms")),h.filter(K=>K!==k).forEach(K=>{A.debug("[choose-best-ws]close backup websocket: ".concat(K.url)),K.close()}),d=!0,a(k)},k.onclose=F=>{f=F,!d&&(h.find(K=>!(K.readyState===WebSocket.CLOSED||K.readyState===WebSocket.CLOSING))||(A.debug("[choose-best-ws] all websocket is closed"),d=!0,c(f)))},k.onmessage=F=>{A.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(F.data))}}),_r(this.forceCloseTimeout).then(()=>{h.forEach(k=>{k.readyState!==WebSocket.OPEN&&k.close()})})}if(b){var T;let U;A.debug("[choose-best-ws] use single url: ",t),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[t],service:"gateway"},s);try{U=new WebSocket(t),h.push(U),U.binaryType="arraybuffer"}catch(k){let F=new _e(q.WS_ERR,"init websocket failed! Error: ".concat(k.toString()));return A.error("[".concat(this.name,"]").concat(F)),void c(F)}U.onopen=()=>{a(U)},U.onclose=k=>{c(k)},U.onmessage=k=>{A.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(k.data))},_r(this.forceCloseTimeout).then(()=>{U&&U.readyState!==WebSocket.OPEN&&U.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class Aae extends Cs{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===us.CONNECTED?this.emit(ft.WS_CONNECTED):t===us.RECONNECTING?this.emit(ft.WS_RECONNECTING,this._websocketReconnectReason):t===us.CLOSED&&this.emit(ft.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,s){super(),W(this,"_disconnectedReason",void 0),W(this,"_websocketReconnectReason",void 0),W(this,"_connectionState",us.CLOSED),W(this,"reconnectToken",void 0),W(this,"websocket",void 0),W(this,"openConnectionTime",void 0),W(this,"clientId",void 0),W(this,"lastMsgTime",Date.now()),W(this,"uploadCache",[]),W(this,"uploadCacheInterval",void 0),W(this,"rttRolling",new CL(5)),W(this,"pingpongTimer",void 0),W(this,"wsInflateDataTimer",void 0),W(this,"pingpongTimeoutCount",0),W(this,"ortc",void 0),W(this,"joinResponse",void 0),W(this,"multiIpOption",void 0),W(this,"initError",void 0),W(this,"spec",void 0),W(this,"store",void 0),W(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(ft.ON_BINARY_DATA,a.data);let c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===It.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===It.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close($t.UID_BANNED);break;case 15:this.close($t.IP_BANNED);break;case 16:this.close($t.CHANNEL_BANNED)}if(c._type===It.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case lt.ERR_LICENSE_MISSING:this.close($t.LICENSE_MISSING);break;case lt.ERR_LICENSE_EXPIRED:this.close($t.LICENSE_EXPIRED);break;case lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close($t.LICENSE_MINUTES_EXCEEDED);break;case lt.ERR_LICENSE_PERIOD_INVALID:this.close($t.LICENSE_PERIOD_INVALID);break;case lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($t.LICENSE_MULTIPLE_SDK_SERVICE);break;case lt.ERR_LICENSE_ILLEGAL:this.close($t.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new yC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===us.CONNECTED&&this.reconnect("retry",Nr.OFFLINE)})}async request(t,s,a,c){let d=os(6,""),h={_id:d,_type:t,_message:s},p=this.websocket.connectionID,f=()=>new Be((U,k)=>{if(this.connectionState===us.CONNECTED)return U();let F=()=>{this.off(ft.WS_CLOSED,K),U()},K=()=>{this.off(ft.WS_CONNECTED,F),k(new de(q.WS_ABORT))};this.once(ft.WS_CONNECTED,F),this.once(ft.WS_CLOSED,K),t!==pt.PUBLISH&&t!==pt.PUBLISH_DATASTREAM&&t!==pt.SUBSCRIBE&&t!==pt.SUBSCRIBE_DATASTREAM&&t!==pt.UNSUBSCRIBE&&t!==pt.UNSUBSCRIBE_DATASTREAM&&t!==pt.UNPUBLISH&&t!==pt.UNPUBLISH_DATASTREAM&&t!==pt.CONTROL&&t!==pt.RESTART_ICE||this.once(ft.DISCONNECT_P2P,()=>{k(new de(q.DISCONNECT_P2P))}),t!==pt.PUBLISH&&t!==pt.RESTART_ICE||this.once(ft.ABORT_P2P_EXECUTION,()=>{k(new de(q.DISCONNECT_P2P))})});if(this.connectionState!==us.CONNECTING&&this.connectionState!==us.RECONNECTING||t===pt.JOIN||t===pt.REJOIN||await f(),this.websocket.sendMessage(h,!0),c)return;let _=new Be((U,k)=>{let F=!1,K=(X,re)=>{F=!0,U({isSuccess:X==="success",message:re||{}}),this.off(ft.WS_CLOSED,Y),this.off(ft.WS_RECONNECTING,Y),this.emit(ft.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(d),K);let Y=()=>{k(new de(q.WS_ABORT,"type: ".concat(t))),this.off(ft.WS_CLOSED,Y),this.off(ft.WS_RECONNECTING,Y),this.off("res-@".concat(d),K)};this.once(ft.WS_CLOSED,Y),this.once(ft.WS_RECONNECTING,Y),_r($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||F||(A.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ft.REQUEST_TIMEOUT,t,s))})}),v=null;try{v=await _}catch(U){if(this.connectionState===us.CLOSED||t===pt.LEAVE)throw new de(q.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?U.throw():t===pt.JOIN||t===pt.REJOIN?null:(await f(),await this.request(t,s))}if(v.isSuccess)return v.message;let b=Number(v.message.error_code||v.message.code),w=qm(b),T=new de(q.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(v.message.error_str),{code:b,data:v.message,desc:w.desc});return w.action==="success"?v.message:(A.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(w.desc,", action: ").concat(w.action)),b===lt.ERR_TOO_MANY_BROADCASTERS?((t===pt.JOIN||t===pt.REJOIN)&&(this.initError=T,this.close()),T.throw()):w.action==="failed"?T.throw():w.action==="quit"?(this.initError=T,this.close(),T.throw()):(b===lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Nr.MULTI_IP)):this.reconnect(w.action,Nr.SERVER_ERROR),t===pt.JOIN||t===pt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new Be(a=>{let c=d=>{(!s||s(d))&&(this.off(t,c),a(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(zm.WRTC_STATS,s)}upload(t,s){let a={_type:t,_message:s};try{this.websocket.sendMessage(a)}catch{let c=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==us.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,s){let a={_type:t,_message:s};this.websocket.sendMessage(a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Be((s,a)=>{this.once(ft.WS_CONNECTED,()=>s(this.joinResponse)),this.once(ft.WS_CLOSED,c=>a(this.initError||new de(q.WS_ABORT,c))),this.connectionState=us.CONNECTING,this.websocket.init(t).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||$t.LEAVE,this.connectionState=us.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ft.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await Rr(this,ft.REQUEST_JOIN_INFO);this.store.joinReq();let s=await this.request(pt.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!s)return this.emit(ft.REPORT_JOIN_GATEWAY,iE.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(ft.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=us.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new de(q.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=Lm(this,ft.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let s=await this.request(pt.REJOIN,t);return!!s&&(this.connectionState=us.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(It.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(It.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(It.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(It.MUTE_AUDIO,{uid:a.uid}):this.emit(It.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(It.MUTE_VIDEO,{uid:a.uid}):this.emit(It.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(It.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(It.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(It.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(It.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(It.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){if(!this.ortc)return!1;let s={downgrade_codec:t,ortc:this.ortc};return!!await this.request(pt.DOWNGRADE_CODEC,s)}handleNotification(t){A.debug("[".concat(this.clientId,"] receive notification: "),t);let s=qm(t.code);if(t.code===28&&"detail"in t&&(A.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ft.RECOVER_NOTIFICATION,t.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($t.UID_BANNED),void this.close()):void this.reconnect(s.action,Nr.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=$("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(A.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Nr.TIMEOUT):this.request(pt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let a=Date.now()-s;this.rttRolling.add(a),$("REPORT_STATS")&&this.send(pt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:s}=this.websocket.getWsInflateData();t!==0&&s!==0&&this.upload(zm.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(yt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ft.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(yt.CLOSED,()=>{this.connectionState=us.CLOSED}),this.websocket.on(yt.FAILED,()=>{this._disconnectedReason=$t.NETWORK_ERROR,this.connectionState=us.CLOSED}),this.websocket.on(yt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===us.CONNECTED?this.connectionState=us.RECONNECTING:this.connectionState=us.CONNECTING}),this.websocket.on(yt.WILL_RECONNECT,(t,s,a)=>{let c=Lm(this,ft.IS_P2P_DISCONNECTED),d=c||t!=="retry";c&&t==="retry"&&(A.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",s=iE.P2P_DISCONNECTED),d&&(A.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ft.REPORT_JOIN_GATEWAY,s||iE.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ft.DISCONNECT_P2P)),a(t)}),this.websocket.on(yt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{A.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Nr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ft.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof de){if(t.code===q.UNEXPECTED_RESPONSE&&t.data.code===lt.ERR_NO_AUTHORIZED)return this.initError=new de(q.TOKEN_EXPIRE,"dynamic key expired"),void this.close($t.TOKEN_EXPIRE);A.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Nr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(yt.REQUEST_NEW_URLS,(t,s)=>{Rr(this,ft.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(It.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(mU.PRE_CONNECT_PC,()=>{this.emit(ft.PRE_CONNECT_PC)})}}let Iae=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Bs=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function vU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function oE(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?vU(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):vU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function qc(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat($("TURN_DOMAIN")):(A.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function cE(e){try{let t=$("GATEWAY_DOMAINS").concat($("TURN_DOMAIN")).find(s=>ke(e).call(e,s));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return A.debug("serverUrlToIp error, fallback to url",e),e}}function xC(e,t){e.addresses||(e.addresses=[]);let s=function(p,f){if($("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return p.map(b=>{let{ip:w,port:T}=b;return{address:"".concat(w,":").concat(T)}});let _=$("GATEWAY_DOMAINS"),v=_[1]&&ke(f).call(f,_[1])?1:0;return p.map(b=>{let{domain_prefix:w,port:T,ip:U}=b;if(w)return{address:"".concat(w,".").concat(_[v++%_.length],":").concat(T)};let k=/^[\.\:\d]+$/.test(U),F=k?"".concat(U.replace(/[^\d]/g,"-"),".").concat(_[v++%_.length],":").concat(T):"".concat(U,":").concat(T);return k||A.debug("Cannot recognized as ip address: ".concat(U,", use as host3")),{ip:U,port:T,address:F}})}(e.addresses,t),a=Array.isArray(e.detail)&&e.detail[18];if(a&&typeof a=="string"){let p=a.split(";");for(let f=0;f<p.length;f++){var c;let _=Jr(c=p[f]).call(c);s[f]&&_&&(s[f].ip6=_)}}let d=e.detail&&e.detail.candidate,h;if(d){let[p,f]=d.split(":");p&&f&&(h={port:Number(f),ip:p,address:"".concat(p,":").concat(f)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Hn(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function EU(e){let t=e._encoderConfig;if(!t)return{};let s={resolution:t.width&&t.height?"".concat(Hn(t.width),"x").concat(Hn(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(s.maxFrameRate=t.frameRate,s.minFrameRate=t.frameRate):t.frameRate&&(s.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,s.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),s}function yU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function $m(e,t){let s,a,c;switch(t){case Bs.CHOOSE_SERVER:a=4096,c="choose server";break;case Bs.CLOUD_PROXY:a=1048576,c="proxy";break;case Bs.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case Bs.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new de(q.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>oE(oE({},h),{},{ticket:d.buffer.cert})),server_ts:e.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:oE(oE({},d.buffer.detail),e.detail),flag:d.buffer.flag,opid:e.opid,cert:d.buffer.cert})}),!s)throw new de(q.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return s}async function xU(e,t){return await Be.all(e.addresses.map(async s=>({address:qc(s.ip),tcpport:s.port,udpport:s.port,username:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Ar.username,password:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await b0(t.toString()):Ar.password})))}function bC(e,t){let s=t.getMediaStreamTrack(!0).getSettings(),a=t.videoHeight||s.height,c=t.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(Hn(e.height),Hn(e.width)),1):(A.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Yc(e){let{candidateType:t,relayProtocol:s,type:a,address:c,port:d,protocol:h}=e,p={candidateType:t,relayProtocol:s,protocol:h};if(a!=="local-candidate"){let f=c.split(".");f.length>=4&&(f[1]="*",f[2]="*"),p.address=f.join("."),p.port=d}return p}function Ed(e){let t=e.split(":"),s=e.split(/[-.]/),a=ke(e).call(e,"-")?"-":".",c=e;return t.length>1?s.length>1?(s[1]="**",c=s[0]+a+"**:"+t[t.length-1]):c=t.length>2?t[0]+a+"**:"+t[t.length-1]:"**:"+t[t.length-1]:s.length>1&&(c=s[0]+a+"**"),c}function lE(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$("SVC_MODE");if($("ENABLE_SVC"))return function(t){return t in Mv}(e)?e:Mv.L1T3}let bU={[ze.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ze.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function dE(e,t,s){t.forEach(a=>{var c;let d=bU[e].find(p=>{var f;let{key:_}=p;return ke(f=a.extensionName).call(f,_)});if(!d)return;let h=s.find(p=>{let{extensionName:f}=p;return ke(f).call(f,d.key)});h&&ke(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function Eh(e,t){t.forEach(s=>{var a;let c=bU[e].find(d=>{var h;let{key:p}=d;return ke(h=s.extensionName).call(h,p)});ke(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function wU(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ke(e).call(e,"abs-send-time")}function uE(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ke(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function SU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function CU(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?SU(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):SU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function Xm(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:f,unsupportedVideoUplinkCodec:_,unsupportedVideoDownlinkCodec:v}=t,{useXR:b}=s,w=[],T=[],U=[],k=[],F=!1,K=!1;if(Sn(e).mediaDescriptions.forEach(X=>{a&&a!==X.attributes.direction||(X.media.mediaType!=="video"||F||(T=X.attributes.payloads,k=X.attributes.extmaps,F=!0),X.media.mediaType!=="audio"||K||(w=X.attributes.payloads,U=X.attributes.extmaps,K=!0))}),!k||T.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!U||w.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(T.forEach(X=>{var re;(re=X.rtpMap)!==null&&re!==void 0&&re.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),b&&X.rtcpFeedbacks.push({type:"rrtr"})}),w.forEach(X=>{var re;(re=X.rtpMap)!==null&&re!==void 0&&re.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),b&&X.rtcpFeedbacks.push({type:"rrtr"})}),c&&(w=w.filter(X=>{var re;return((re=X.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())!=="rtx"}),T=T.filter(X=>{var re;return((re=X.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())!=="rtx"})),d){let X=T.filter(Z=>{var le;return/(red)|(ulpfec)|(flexfec)/i.test(((le=Z.rtpMap)===null||le===void 0?void 0:le.encodingName)||"")}),re=Xc(X,T).map(Z=>Z.payloadType),te=[...X.map(Z=>Z.payloadType),...re];T=T.filter(Z=>!ke(te).call(te,Z.payloadType))}if(h&&(w=w.filter(X=>{var re;return!/(red)|(ulpfec)|(flexfec)/i.test(((re=X.rtpMap)===null||re===void 0?void 0:re.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(w=w.filter(X=>{var re;return ke(p).call(p,((re=X.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())||"")})),f&&(f==null?void 0:f.length)>0){let X=T.filter(re=>{var te;return ke(f).call(f,((te=re.rtpMap)===null||te===void 0?void 0:te.encodingName.toLowerCase())||"")});T=X.concat(c?[]:Xc(X,T))}let Y=$("UNSUPPORTED_VIDEO_CODEC");if(Y&&Y.length>0){let X=T.filter(Z=>Z.rtpMap&&ke(Y).call(Y,Z.rtpMap.encodingName.toLowerCase())),re=Xc(X,T),te=X.concat(re).map(Z=>Z.payloadType);T=T.filter(Z=>!ke(te).call(te,Z.payloadType)),A.debug("unsupportedVideoCodec: ".concat(Y,", toBeRemoved: ").concat(te))}if(_&&_.length>0&&a==="sendonly"){let X=T.filter(Z=>Z.rtpMap&&ke(_).call(_,Z.rtpMap.encodingName.toLowerCase())),re=Xc(X,T),te=X.concat(re).map(Z=>Z.payloadType);T=T.filter(Z=>!ke(te).call(te,Z.payloadType)),A.debug("unsupportedVideoUplinkCodec: ".concat(_,", toBeRemoved: ").concat(te))}if(v&&v.length>0&&a==="recvonly"){let X=T.filter(Z=>Z.rtpMap&&ke(v).call(v,Z.rtpMap.encodingName.toLowerCase())),re=Xc(X,T),te=X.concat(re).map(Z=>Z.payloadType);T=T.filter(Z=>!ke(te).call(te,Z.payloadType)),A.debug("unsupportedVideoDownlinkCodec: ".concat(v,", toBeRemoved: ").concat(te))}return{audioCodecs:w,videoCodecs:T,audioExtensions:U,videoExtensions:k}}function $c(e){let t=Sn(e),s,a;for(let c of t.mediaDescriptions){if(!s){let d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){let d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&t.attributes.fingerprints.length>0&&(a={fingerprints:t.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function TU(e,t){let s=[],a=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var p;let f=(p=a.find(_=>_.ssrcIds[0]===h))===null||p===void 0?void 0:p.ssrcIds[1];s.push({ssrcId:h,rtx:t?f:void 0})});else if(a.length>0){let h=a[0].ssrcIds[0],p=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:t?p:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function NU(e,t,s){let{cname:a}=e,c=[];t&&(c=RU(t)),c.length===0&&(c=e.iceParameters.candidates.map(v=>({foundation:v.foundation,componentId:"1",transport:v.protocol,priority:v.priority.toString(),connectionAddress:v.ip,port:v.port.toString(),type:v.type,extension:{}})),A.debug("Using candidates from gateway."));let d={fingerprints:e.dtlsParameters.fingerprints.map(v=>({hashFunction:v.algorithm,fingerprint:v.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},p;switch(e.dtlsParameters.role){case"server":p="passive";break;case"client":p="active";break;case"auto":p="actpass"}let f=pE(e.rtpCapabilities),_=[];return Array.isArray(s)&&s.length>0&&s.forEach(v=>{_.push({kind:ze.VIDEO,ssrcMsg:[{ssrcId:v.v,rtx:v.v_rtx}],mslabel:"".concat(v.v,"_").concat(v.a)},{kind:ze.AUDIO,ssrcMsg:[{ssrcId:v.a}],mslabel:"".concat(v.v,"_").concat(v.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:f,setup:p,cname:a,preSSRCs:_}}function RU(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],A.debug("Using remote candidate from AP ".concat(Ed(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),A.debug("Using IPV6 remote candidate from AP ".concat(Ed(e.ip6),":").concat(e.port)))),t}function Jm(e,t,s){let a=[],c=[];return e.forEach(d=>{let{ssrcId:h,rtx:p}=d,f=os(8,"track-"),_={ssrcId:h,attributes:CU({label:f,mslabel:s=s||os(10,""),msid:"".concat(s," ").concat(f)},t&&{cname:t})};if(a.push(_),p!==void 0){let v={ssrcId:p,attributes:CU({label:f,mslabel:s,msid:"".concat(s," ").concat(f)},t&&{cname:t})};a.push(v),c.push({semantic:"FID",ssrcIds:[h,p]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:c}}function yh(e,t){t instanceof Ps&&e.attributes.payloads.forEach(s=>{var a;let c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),c==="opus"&&typeof $("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=$("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";let d=t._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!Rs()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),t instanceof Gm&&c==="opus"&&t._config.DTX&&(s.fmtp.parameters.usedtx="1"))})}function wC(e){let t=e.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function SC(e,t){var s;if(!(t instanceof hs&&t._encoderConfig&&t._hints.indexOf(is.SCREEN_TRACK)===-1))return;let a=t._encoderConfig;Vt().supportMinBitrate&&a.bitrateMin&&e.attributes.payloads.forEach(c=>{var d,h;ke(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Vt().supportMinBitrate&&!ke(s=t._hints).call(s,is.LOW_STREAM)&&a.bitrateMax&&e.attributes.payloads.forEach(c=>{var d,h;ke(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat($("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function AU(e){if(e.media.mediaType!=="video")return;let t=Lt();if(t.name!==Wt.SAFARI&&t.os!==ar.IOS)return;let s=e.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1)}function hE(e,t,s){if(!t)return;let a,c;if(e.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),t.twcc===!0){let d=a.find(h=>uE(h.extensionName));if(d){let h=d.extensionName;e.attributes.extmaps.find(p=>uE(p.extensionName))||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(p,f){return f.filter(_=>!!p.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(b=>b.type==="transport-cc")))}(c,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(f=>f.type==="transport-cc")||p.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let d=e.attributes.extmaps.findIndex(h=>uE(h.extensionName));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach(h=>{let p=h.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}if(t.remb===!0){let d=a.find(h=>wU(h.extensionName));if(d){let h=d.extensionName;e.attributes.extmaps.find(p=>p.extensionName===h)||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(p,f){return f.filter(_=>!!p.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(b=>b.type==="goog-remb")))}(c,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(f=>f.type==="goog-remb")||p.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let d=e.attributes.extmaps.findIndex(h=>wU(h.extensionName));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach(h=>{let p=h.rtcpFeedbacks.findIndex(f=>f.type==="goog-remb");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}}function IU(e,t,s){if(Rs()||e.media.mediaType!=="video"||!(t instanceof hs)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!$("SIMULCAST")||s==="vp9"&&$("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let a=s==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],d=e.attributes.ssrcGroups.find(p=>p.semantic==="FID"&&p.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let p=1;p<a;p++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+p,attributes:bs(c.attributes)}),h.ssrcIds.push(c.ssrcId+p),d&&(e.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:bs(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+p,d.ssrcIds[1]+p]}));e.attributes.ssrcGroups.unshift(h)}async function DU(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});let a=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0,v=Xm(_,p,f,"sendonly"),b=Xm(_,p,f,"recvonly"),w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ua(v,b,"videoExtensions",w,T,U),ua(v,b,"videoCodecs",w,T,U),ua(v,b,"audioExtensions",w,T,U),ua(v,b,"audioCodecs",w,T,U),$("RAISE_H264_BASELINE_PRIORITY")){let k=[],F=[];if(U.videoCodecs.forEach((K,Y)=>{var X;if(((X=K.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"){var re,te;let Z=U.videoCodecs[Y+1],le=Z&&LU(K,Z),xe=(re=K.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"],Ce=(te=K.fmtp)===null||te===void 0?void 0:te.parameters["packetization-mode"];!xe||xe!==$("FIRST_H264_PROFILE_LEVEL_ID")||$("FIRST_PACKETIZATION_MODE")&&Ce!==$("FIRST_PACKETIZATION_MODE")?le?F.push([K,Z]):F.push([K]):le?k.push([K,Z]):k.push([K])}}),k.length>0&&F.length>0){A.debug("raising H264 baseline profile priority"),U.videoCodecs.forEach((Y,X)=>{var re;if(((re=Y.rtpMap)===null||re===void 0?void 0:re.encodingName.toLocaleLowerCase())==="h264"){let te=LU(Y,U.videoCodecs[X+1]),Z=k.shift()||F.shift()||[];Z.length>0&&(te?U.videoCodecs.splice(X,2,...Z):U.videoCodecs.splice(X,1,...Z))}});let K=T.videoCodecs.filter(Y=>{var X,re;return((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((re=Y.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"])!==$("FIRST_H264_PROFILE_LEVEL_ID")});if(K.length>0){let Y=Xc(K,T.videoCodecs).map(re=>re.payloadType),X=[...K.map(re=>re.payloadType),...Y];T.videoCodecs=T.videoCodecs.filter(re=>!ke(X).call(X,re.payloadType))}$("FILTER_SEND_H264_BASELINE")&&(w.videoCodecs=w.videoCodecs.filter(Y=>{var X,re;return!(((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((re=Y.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"])!==$("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:w,recv:T,sendrecv:U}}return{send:w,recv:T,sendrecv:U}}(e,t,a);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function OU(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Xm(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ua(e,t,"videoExtensions",s,a,c),ua(e,t,"videoCodecs",s,a,c),ua(e,t,"audioExtensions",s,a,c),ua(e,t,"audioCodecs",s,a,c),$("RAISE_H264_BASELINE_PRIORITY")){let d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){let h=c.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){A.debug("raising H264 baseline profile priority");let p=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,p)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(p=>!(p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:a,sendrecv:c}}function ua(e,t,s,a,c,d){if(s==="videoExtensions"||s==="audioExtensions"){let h=[];return e[s].forEach(p=>{t[s].some((f,_)=>{if(p.entry===f.entry&&p.extensionName===f.extensionName)return h.push(_),!0})?d[s].push(p):a[s].push(p)}),void t[s].forEach((p,f)=>{h.indexOf(f)===-1&&c[s].push(p)})}if(s==="videoCodecs"||s==="audioCodecs"){let h=[];return e[s].forEach(p=>{t[s].some((f,_)=>{if(p.payloadType===f.payloadType&&JSON.stringify(p)===JSON.stringify(f))return h.push(_),!0})?d[s].push(p):a[s].push(p)}),void t[s].forEach((p,f)=>{h.indexOf(f)===-1&&c[s].push(p)})}}function pE(e){let{send:t,recv:s,sendrecv:a}=e;if(!a){if(!t||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:s}}let c,d;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...a.audioCodecs],c.videoCodecs=[...t.videoCodecs,...a.videoCodecs],c.audioExtensions=[...t.audioExtensions,...a.audioExtensions],c.videoExtensions=[...t.videoExtensions,...a.videoExtensions]):c=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:c,recv:d}}function xh(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var s;return((s=t.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Qm(e,t,s,a){let c=[];if(e===ze.VIDEO){if($("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=t.videoCodecs.filter(d=>{var h;return ke(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===$("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[],h=[],p=[],f=[];if(s.videoCodecs.forEach(_=>{let v=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"";ke(v).call(v,a)?d.push(_):ke(v).call(v,"vp9")?h.push(_):ke(v).call(v,"vp8")?p.push(_):ke(v).call(v,"h264")&&f.push(_)}),d.length===0){let _="";h.length!==0?(d=h,_="vp9"):p.length!==0?(d=p,_="vp8"):f.length!==0&&(d=f,_="h264"),A.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(_))}d.length!==0&&(c=t.videoCodecs.filter(_=>d.some(v=>v.payloadType===_.payloadType)))}if(c.length===0&&(A.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),$("USE_PUB_RTX")||$("USE_SUB_RTX")){let d=Xc(c,t.videoCodecs);c=[...c,...d]}}else{c=t.audioCodecs.filter(h=>{var p;return ke(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,a)});let d=t.audioCodecs.filter(h=>{var p;return ke(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"red")});c.length===0&&(A.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter(h=>{var p;return ke(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"opus")})),$("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function Xc(e,t){let s=e.map(a=>a.payloadType.toString());return t.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&ke(s).call(s,a.fmtp&&a.fmtp.parameters.apt))}async function Jc(e,t,s){let a=t.toString(),c=PU(a,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:a});let d=await e.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=jU(h,s||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function jU(e,t,s){let a=Sn(e),{useXR:c}=t;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!ke(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&xh(d),c&&ke(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(p=>{p.rtcpFeedbacks.findIndex(f=>f.type==="rrtr")===-1&&p.rtcpFeedbacks.push({type:"rrtr"})})))}),Gc(a)}function PU(e,t,s,a){if($("SDP_LOGGING"))return A.upload("exchanging ".concat(s," ").concat(t," SDP during P2PConnection.").concat(a,`
`),e),t==="offer"?c=>{PU(c,"answer",s==="local"?"remote":"local",a)}:void 0}function kU(e){let t=$("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(s=>ke(e).call(e,s))}function LU(e,t){try{var s;return((s=e.fmtp)===null||s===void 0?void 0:s.parameters.apt)===t.payloadType.toString()}catch{return!1}}function MU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function gi(e,t){return typeof $(e)===t?$(e):void 0}function Dae(){try{let e=$("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?MU(Object(a),!0).forEach(function(c){W(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):MU(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}({},e)}catch(e){return A.debug("handle gateway attributes failed: ",e),{}}}let FU={};function Qc(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&A.debug("install service ".concat(e.name)),FU[e.name]=e}function cc(e){let t=FU[e];if(!t)throw new _e(q.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function UU(e,t){return cc("DataStream").create(e,t)}function mE(){return cc("InterceptFrame").create()}function VU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Kr(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?VU(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):VU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let CC=new Map;class Oae extends Cs{get state(){return this._state}set state(t){if(t===this._state)return;let s=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(dr.CONNECTION_STATE_CHANGE,t,s,this._disconnectedReason):this.emit(dr.CONNECTION_STATE_CHANGE,t,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){A.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,s){var a,c,d;super(),W(this,"store",void 0),W(this,"joinInfo",void 0),W(this,"key",void 0),W(this,"ntpOffset",0),W(this,"signal",void 0),W(this,"role",void 0),W(this,"isPreallocation",void 0),W(this,"isPreSub",void 0),W(this,"inChannelInfo",{joinAt:null,duration:0}),W(this,"spec",void 0),W(this,"_state","DISCONNECTED"),W(this,"_statsCollector",void 0),W(this,"_disconnectedReason",void 0),W(this,"isSignalRecover",!1),W(this,"hasChangeBGPAddress",!1),W(this,"trafficStatsInterval",void 0),W(this,"networkQualityInterval",void 0),W(this,"_joinGatewayStartTime",0),W(this,"_signalTimeout",!1),W(this,"_clientRoleOptions",void 0),W(this,"_isProactiveJoin",!1),this.store=t,this.spec=s,this.signal=this.store.useP2P?(a={spec:Kr(Kr({},s),{},{retryConfig:s.websocketRetryConfig}),store:t},(c=(d=cc("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):new Aae(Kr(Kr({},s),{},{retryConfig:s.websocketRetryConfig}),t),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(t,s,a){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let c=Date.now(),d=CC.get(t.cname);if(d||(d=new Map,CC.set(t.cname,d)),this._isProactiveJoin=!0,d.has(t.uid)){let _=new de(q.UID_CONFLICT);throw Ze.joinGateway(t.sid,{lts:c,succ:!1,ec:_.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),_}d.set(t.uid,!0),this.joinInfo=t,this.key=s;let h=0;this.joinGatewayStartTime=c;let p=t.proxyServer;try{A.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));let _=t.gatewayAddrs.map(v=>{let{address:b}=v,[w,T]=b.split(":"),U={host:w,port:T};return t.proxyServer&&(U.proxy=t.proxyServer),U});h=(await this.signal.init(_)).uid,A.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var f;throw A.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),Ze.joinGateway(t.sid,{lts:c,succ:!1,ec:((f=_.data)===null||f===void 0?void 0:f.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!p,signalChannel:"0",preload:t.preload}),d.delete(t.uid),this.signal.close(),_}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),A.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{A.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(dr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(dr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(dr.NETWORK_QUALITY,{uplinkNetworkQuality:yU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:yU(this._statsCollector.trafficStats.B_dnq)}):this.emit(dr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==$t.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==us.CONNECTED||await function(a,c){return c===1/0?a:Be.race([a,rie(c)])}(this.signal.request(pt.LEAVE,void 0,!0),3e3)}catch(a){A.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==$t.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:$("PUB_EXTEND"),twcc:!!$("PUBLISH_TWCC"),rtx:!!$("USE_PUB_RTX")};try{return(await this.signal.request(pt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===lt.ERR_PUBLISH_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(t,s),this.publish(t,s,!1);throw d}}async publishDataChannel(t,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(pt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===lt.ERR_PUBLISH_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(t,s),this.publishDataChannel(t,s,!1);throw h}}async unpublish(t,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(pt.UNPUBLISH,{stream_id:s,ortc:t},!0)}catch(a){A.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Be.all(t.map(s=>this.signal.request(pt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){A.warning("unpublish datachannels warning: ",s)}}async presubscribe(t,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let c={stream_id:t,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX")||void 0,extend:$("SUB_EXTEND"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(pt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===lt.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(t,s,!1);throw d}}async subscribe(t,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let c={stream_id:t,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX"),extend:$("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return(await this.signal.request(pt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===lt.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(t,s),await this.subscribe(t,s,!1);throw d}}async subscribeDataChannel(t,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let c={uid:t,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(pt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===lt.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(t,s),await this.subscribeDataChannel(t,s,!1);throw d}}async subscribeAll(t,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let a={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!$("USE_SUB_RTX"),twcc:!!$("SUBSCRIBE_TWCC"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(pt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===lt.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){let s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,p=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(p=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(p=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(p=!1)),p?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(t);if(s)return this.signal.request(pt.SET_VIDEO_PROFILE,s);A.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,s){try{await this.signal.request(pt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:s},!0)}catch(a){A.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(t,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Be.all(t.map(a=>this.signal.request(pt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0)))}catch(a){A.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(t){try{await this.signal.request(pt.UNSUBSCRIBE_STREAMS,t,!0)}catch(s){A.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(t){let{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(pt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(pt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(pt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,s){s&&(this._clientRoleOptions=Object.assign({},s)),$("CLIENT_ROLE_OPTIONS")&&(A.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify($("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},$("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),$("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},$("CLIENT_ROLE_OPTIONS")),A.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify($("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let a,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;let d=Object.assign({},s);delete d.delay,delete d.level,await this.signal.request(pt.SET_CLIENT_ROLE,Kr(Kr({role:t,level:c,delay:a},d),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,s){await this.signal.request(pt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:s})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(pt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,s){await this.signal.request(pt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:s})}async pickSVCLayer(t,s){await this.signal.request(pt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(t){await this.signal.request(pt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Kr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(pt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=CC.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Ar.username,password:Ar.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Kr(Kr({},Ar),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(pt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(s=>{let a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&jv(()=>{this.emit(dr.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var s,a;if(!this.joinInfo||!this.key)throw new de(q.UNEXPECTED_ERROR,"can not generate join message, no join info");let c=Object.assign({},this.joinInfo.apResponse),d=$("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var h;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(dr.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,ke(mh).call(mh,h)||mh.push(h);let p=V0(this.store),f=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),_=GL(this.store),v=Dae(),b=$u(87)||Q2()||m0(117),w=(function(){let U=Lt();if(U.name!==Wt.SAFARI||!U.browserVersion)return!1;let k=U.browserVersion.split(".");return Number(k[0])>18||Number(k[0])===18&&Number(k[1])>=4}()||sL(18,4,!1))&&f0(18,6,!0)&&this.spec.codec==="h264"&&$("ENABLE_ABSSENDTIME_AS_SENTTS"),T=Kr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ii,browser:navigator.userAgent,process_id:$("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:$("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:Kr(Kr({enableEncodedTransform:(!!$("ENABLE_AUDIO_METADATA")||!!$("ENABLE_AUDIO_PTS"))&&b||!!$("ENABLE_AUDIO_TOPN")&&h0(Wt.CHROME,87,116)||void 0,enableAudioMetadata:!!$("ENABLE_AUDIO_METADATA")&&b,enableAudioPts:!!$("ENABLE_AUDIO_PTS")&&b,topnSmoothLevel:$("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:$("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:$("TOPN_SWITCH_HOLD_MS"),topnAudioGain:$("TOPN_AUDIO_GAIN"),enablePublishedUserList:$("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:$("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:gi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:gi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:gi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:$("USE_PUB_RTX")===!0||$("USE_SUB_RTX")===!0||void 0,disableFEC:$("DISABLE_FEC"),enableNTPReport:!!$("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:_,enableFulllinkAvSync:!!$("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:gi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!$("FORCE_ENABLE_AUT_CC")||!Vv()&&(!!$("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!$("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:gi("USE_XR","boolean"),enableLossbasedBwe:gi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!$("FORCE_ENABLE_AUT_CC")||!Vv()&&(!!$("ENABLE_AUT_CC")||void 0),enableCCFallback:gi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:f,preSubNum:p?gi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:gi("PUBLISH_TWCC","boolean"),enableSubTWCC:gi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:gi("USE_PUB_RTX","boolean"),enableSubRTX:gi("USE_SUB_RTX","boolean"),enableSubSVC:$("ENABLE_SVC")?$("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0,enableSvcExtended:$("ENABLE_SVC")&&Array.isArray($("SVC_EXTENDED"))&&$("SVC_EXTENDED").length!==0?$("SVC_EXTENDED"):void 0},v),{},{audioDuplicate:gi("ENABLE_AUDIO_RED","boolean")?(a=gi("AUDIO_DUPLICATE_NUM","number"))!==null&&a!==void 0?a:2:void 0,senttsUsesAbsSendTime:!!w||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(T.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(T.aes_mode=this.joinInfo.aesmode,$("ENCRYPT_AES")?(T.aes_secret=this.joinInfo.aespassword,T.aes_encrypt=!0):T.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(T.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(T.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(T.default_video_stream=this.joinInfo.defaultVideoStream),T}getRejoinMessage(){if(!this.joinInfo)throw new de(q.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ft.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ft.WS_RECONNECTING,t=>{this.joinInfo&&Ze.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Nr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ze.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ft.WS_CLOSED,t=>{let s;switch(t){case $t.LEAVE:s=Nr.LEAVE;break;case $t.UID_BANNED:case $t.IP_BANNED:case $t.CHANNEL_BANNED:case $t.SERVER_ERROR:s=Nr.SERVER_ERROR;break;case $t.FALLBACK:s=Nr.FALLBACK;break;case $t.LICENSE_MISSING:case $t.LICENSE_EXPIRED:case $t.LICENSE_MINUTES_EXCEEDED:case $t.LICENSE_PERIOD_INVALID:case $t.LICENSE_MULTIPLE_SDK_SERVICE:case $t.LICENSE_ILLEGAL:case $t.TOKEN_EXPIRE:s=t;break;default:s=Nr.NETWORK_ERROR}A.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Nr.NETWORK_ERROR)),this.joinInfo&&Ze.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===$t.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=t,t!==$t.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ft.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=$("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(A.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Ze.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void A.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));ts("EVENT_REPORT_DOMAIN",t[1]),ts("EVENT_REPORT_BACKUP_DOMAIN",t[1]),ts("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(It.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ft.REQUEST_RECOVER,(t,s,a)=>{if(!this.joinInfo)return a(new de(q.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Rr(this,dr.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on(ft.REQUEST_JOIN_INFO,async(t,s,a)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let p=bs((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if($("NEW_TURN_MODE")&&p&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var f;let w=p.servers.map(k=>"turnServerURL"in k&&$("USE_TURN_IP")?Kr(Kr({},k),{},{turnServerURL:cE(k.turnServerURL)}):k),T=(f=p.serversFromGateway)===null||f===void 0?void 0:f.map(k=>$("USE_TURN_IP")?Kr(Kr({},k),{},{turnServerURL:cE(k.turnServerURL)}):k),U=this.signal.currentURLIndex;w.length>0&&(w=[w[U%w.length]],p.servers=w),Array.isArray(T)&&T.length>0&&(T=[T[0]],p.serversFromGateway=T),A.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(U))}let{iceParameters:_,dtlsParameters:v,rtpCapabilities:b}=await Rr(this,dr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:p,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:_,dtlsParameters:v,rtpCapabilities:b,version:"2"}}))}catch(w){s(w)}}),this.signal.on(ft.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ft.REPORT_JOIN_GATEWAY,(t,s)=>{if(!this.joinInfo)return;let a,c="";var d;t instanceof de?(a=((d=t.data)===null||d===void 0?void 0:d.desc)||t.code,c=t.message):a=t,Ze.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ft.IS_P2P_DISCONNECTED,t=>{t(Lm(this,dr.IS_P2P_DISCONNECTED))}),this.signal.on(ft.DISCONNECT_P2P,()=>{this.emit(dr.DISCONNECT_P2P)}),this.signal.on(ft.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ft.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ft.JOIN_RESPONSE,t=>{let s=this.getCurrentGatewayAddress();this.emit(dr.JOIN_RESPONSE,t,s)}),this.signal.on(ft.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,s;this.updateTurnConfigFromSignal();let c=this.getCurrentGatewayAddress(),d=bs((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if($("NEW_TURN_MODE")&&d&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var a;let p=d.servers.map(v=>"turnServerURL"in v&&$("USE_TURN_IP")?Kr(Kr({},v),{},{turnServerURL:cE(v.turnServerURL)}):v),f=(a=d.serversFromGateway)===null||a===void 0?void 0:a.map(v=>$("USE_TURN_IP")?Kr(Kr({},v),{},{turnServerURL:cE(v.turnServerURL)}):v),_=this.signal.currentURLIndex;p.length>0&&(p=[p[_%p.length]],d.servers=p),Array.isArray(f)&&f.length>0&&(f=[f[0]],d.serversFromGateway=f),A.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(_,",in pre pc"))}let h=$("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){let p=RU(c);this.emit(dr.PRE_CONNECT_PC,{candidates:p,fingerprint:h,turnServer:d})}}}),this.signal.on(ft.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof $("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat($("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,s){try{await this.signal.request(pt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[s]},!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(t,s){try{await this.signal.request(pt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw A.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(t,s){try{await this.signal.request(pt.UNPUBLISH,{stream_id:t,ortc:s},!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(t,s){try{await this.signal.request(pt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw A.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(t){let s={users:t.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(pt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(t,s){let a={action:t.find(c=>c.stream_type===Qt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:s};try{await this.signal.request(pt.CONTROL,a,!0,!0)}catch(c){throw A.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,s){let a={action:t.find(c=>c.stream_type===Qt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:s};try{await this.signal.request(pt.CONTROL,a,!0,!0)}catch(c){throw A.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,s){let a={action:t===ze.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(pt.CONTROL,a,!0,!0)}catch(c){throw A.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,s){let a={action:t===ze.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(pt.CONTROL,a,!0,!0)}catch(c){throw A.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,s){this.signal.upload(t,s)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(pt.RESTART_ICE,s,!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(t,s){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,s||Nr.P2P_FAILED)}getCurrentGatewayAddress(){var t,s;if(!$("GATEWAY_WSS_ADDRESS"))return $("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(A.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(pt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let fE=0,TC=0;function za(e,t,s,a){return new Be((c,d)=>{t.timeout=t.timeout||$("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),fE+=xo(t.data)):s&&(t.data.size?fE+=t.data.size:t.data instanceof FormData?fE+=vL(t.data):fE+=xo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,pn.request(t).then(h=>{typeof h.data=="string"?TC+=xo(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?TC+=h.data.byteLength:TC+=xo(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{pn.isCancel(h)?d(new de(q.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new de(q.NETWORK_TIMEOUT,h.message)):h.response?d(new de(q.NETWORK_RESPONSE_ERROR,h.response.status)):d(new de(q.NETWORK_ERROR,h.message))})})}(function(){var e;function t(we){var Le=0;return function(){return Le<we.length?{done:!1,value:we[Le++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(we,Le,Ke){return we==Array.prototype||we==Object.prototype||(we[Le]=Ke.value),we},a,c=function(we){we=[typeof globalThis=="object"&&globalThis,we,typeof window=="object"&&window,typeof self=="object"&&self,typeof l=="object"&&l];for(var Le=0;Le<we.length;++Le){var Ke=we[Le];if(Ke&&Ke.Math==Math)return Ke}throw Error("Cannot find global object")}(this);function d(we,Le){if(Le)e:{var Ke=c;we=we.split(".");for(var Ne=0;Ne<we.length-1;Ne++){var P=we[Ne];if(!(P in Ke))break e;Ke=Ke[P]}(Le=Le(Ne=Ke[we=we[we.length-1]]))!=Ne&&Le!=null&&s(Ke,we,{configurable:!0,writable:!0,value:Le})}}function h(we){return(we={next:we})[Symbol.iterator]=function(){return this},we}function p(we){var Le=typeof Symbol<"u"&&Symbol.iterator&&we[Symbol.iterator];return Le?Le.call(we):{next:t(we)}}if(d("Symbol",function(we){function Le(P,Q){this.A=P,s(this,"description",{configurable:!0,writable:!0,value:Q})}if(we)return we;Le.prototype.toString=function(){return this.A};var Ke="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ne=0;return function P(Q){if(this instanceof P)throw new TypeError("Symbol is not a constructor");return new Le(Ke+(Q||"")+"_"+Ne++,Q)}}),d("Symbol.iterator",function(we){if(we)return we;we=Symbol("Symbol.iterator");for(var Le="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ke=0;Ke<Le.length;Ke++){var Ne=c[Le[Ke]];typeof Ne=="function"&&typeof Ne.prototype[we]!="function"&&s(Ne.prototype,we,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return we}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var f;e:{var _={};try{_.__proto__={a:!0},f=_.a;break e}catch{}f=!1}a=f?function(we,Le){if(we.__proto__=Le,we.__proto__!==Le)throw new TypeError(we+" is not extensible");return we}:null}var v=a;function b(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function w(we){if(we.m)throw new TypeError("Generator is already running");we.m=!0}function T(we,Le){return we.h=3,{value:Le}}function U(we){this.g=new b,this.G=we}function k(we,Le,Ke,Ne){try{var P=Le.call(we.g.j,Ke);if(!(P instanceof Object))throw new TypeError("Iterator result "+P+" is not an object");if(!P.done)return we.g.m=!1,P;var Q=P.value}catch(se){return we.g.j=null,we.g.s(se),F(we)}return we.g.j=null,Ne.call(we.g,Q),F(we)}function F(we){for(;we.g.h;)try{var Le=we.G(we.g);if(Le)return we.g.m=!1,{value:Le.value,done:!1}}catch(Ke){we.g.v=void 0,we.g.s(Ke)}if(we.g.m=!1,we.g.l){if(Le=we.g.l,we.g.l=null,Le.F)throw Le.D;return{value:Le.return,done:!0}}return{value:void 0,done:!0}}function K(we){this.next=function(Le){return we.o(Le)},this.throw=function(Le){return we.s(Le)},this.return=function(Le){return function(Ke,Ne){w(Ke.g);var P=Ke.g.j;return P?k(Ke,"return"in P?P.return:function(Q){return{value:Q,done:!0}},Ne,Ke.g.return):(Ke.g.return(Ne),F(Ke))}(we,Le)},this[Symbol.iterator]=function(){return this}}function Y(we,Le){return Le=new K(new U(Le)),v&&we.prototype&&v(Le,we.prototype),Le}if(b.prototype.o=function(we){this.v=we},b.prototype.s=function(we){this.l={D:we,F:!0},this.h=this.C||this.u},b.prototype.return=function(we){this.l={return:we},this.h=this.u},U.prototype.o=function(we){return w(this.g),this.g.j?k(this,this.g.j.next,we,this.g.o):(this.g.o(we),F(this))},U.prototype.s=function(we){return w(this.g),this.g.j?k(this,this.g.j.throw,we,this.g.o):(this.g.s(we),F(this))},d("Array.prototype.entries",function(we){return we||function(){return function(Le,Ke){Le instanceof String&&(Le+="");var Ne=0,P=!1,Q={next:function(){if(!P&&Ne<Le.length){var se=Ne++;return{value:Ke(se,Le[se]),done:!1}}return P=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q}(this,function(Le,Ke){return[Le,Ke]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var X=function(we,Le){for(var Ke=0;Ke<we.length;Ke++)Le(we[Ke])},re=function(we){return we.replace(/\r?\n|\r/g,`\r
`)},te=function(we,Le,Ke){return Le instanceof Blob?(Ke=Ke!==void 0?Ke+"":typeof Le.name=="string"?Le.name:"blob",Le.name===Ke&&Object.prototype.toString.call(Le)!=="[object Blob]"||(Le=new File([Le],Ke)),[String(we),Le]):[String(we),String(Le)]},Z=function(we,Le){if(we.length<Le)throw new TypeError(Le+" argument required, but only "+we.length+" present.")},le=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,xe=le.FormData,Ce=le.XMLHttpRequest&&le.XMLHttpRequest.prototype.send,je=le.Request&&le.fetch,wt=le.navigator&&le.navigator.sendBeacon,Ct=le.Element&&le.Element.prototype,mt=le.Symbol&&Symbol.toStringTag;mt&&(Blob.prototype[mt]||(Blob.prototype[mt]="Blob"),"File"in le&&!File.prototype[mt]&&(File.prototype[mt]="File"));try{new File([],"")}catch{le.File=function(we,Le,Ke){return we=new Blob(we,Ke||{}),Object.defineProperties(we,{name:{value:Le},lastModified:{value:+(Ke&&Ke.lastModified!==void 0?new Date(Ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),mt&&Object.defineProperty(we,mt,{value:"File"}),we}}var Yt=function(we){return we.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},zt=function(we){this.i=[];var Le=this;we&&X(we.elements,function(Ke){if(Ke.name&&!Ke.disabled&&Ke.type!=="submit"&&Ke.type!=="button"&&!Ke.matches("form fieldset[disabled] *"))if(Ke.type==="file"){var Ne=Ke.files&&Ke.files.length?Ke.files:[new File([],"",{type:"application/octet-stream"})];X(Ne,function(P){Le.append(Ke.name,P)})}else Ke.type==="select-multiple"||Ke.type==="select-one"?X(Ke.options,function(P){!P.disabled&&P.selected&&Le.append(Ke.name,P.value)}):Ke.type==="checkbox"||Ke.type==="radio"?Ke.checked&&Le.append(Ke.name,Ke.value):(Ne=Ke.type==="textarea"?re(Ke.value):Ke.value,Le.append(Ke.name,Ne))})};if((e=zt.prototype).append=function(we,Le,Ke){Z(arguments,2),this.i.push(te(we,Le,Ke))},e.delete=function(we){Z(arguments,1);var Le=[];we=String(we),X(this.i,function(Ke){Ke[0]!==we&&Le.push(Ke)}),this.i=Le},e.entries=function we(){var Le,Ke=this;return Y(we,function(Ne){if(Ne.h==1&&(Le=0),Ne.h!=3)return Le<Ke.i.length?Ne=T(Ne,Ke.i[Le]):(Ne.h=0,Ne=void 0),Ne;Le++,Ne.h=2})},e.forEach=function(we,Le){Z(arguments,1);for(var Ke=p(this),Ne=Ke.next();!Ne.done;Ne=Ke.next()){var P=p(Ne.value);Ne=P.next().value,P=P.next().value,we.call(Le,P,Ne,this)}},e.get=function(we){Z(arguments,1);var Le=this.i;we=String(we);for(var Ke=0;Ke<Le.length;Ke++)if(Le[Ke][0]===we)return Le[Ke][1];return null},e.getAll=function(we){Z(arguments,1);var Le=[];return we=String(we),X(this.i,function(Ke){Ke[0]===we&&Le.push(Ke[1])}),Le},e.has=function(we){Z(arguments,1),we=String(we);for(var Le=0;Le<this.i.length;Le++)if(this.i[Le][0]===we)return!0;return!1},e.keys=function we(){var Le,Ke,Ne,P,Q=this;return Y(we,function(se){if(se.h==1&&(Le=p(Q),Ke=Le.next()),se.h!=3)return Ke.done?void(se.h=0):(Ne=Ke.value,P=p(Ne),T(se,P.next().value));Ke=Le.next(),se.h=2})},e.set=function(we,Le,Ke){Z(arguments,2),we=String(we);var Ne=[],P=te(we,Le,Ke),Q=!0;X(this.i,function(se){se[0]===we?Q&&(Q=!Ne.push(P)):Ne.push(se)}),Q&&Ne.push(P),this.i=Ne},e.values=function we(){var Le,Ke,Ne,P,Q=this;return Y(we,function(se){if(se.h==1&&(Le=p(Q),Ke=Le.next()),se.h!=3)return Ke.done?void(se.h=0):(Ne=Ke.value,(P=p(Ne)).next(),T(se,P.next().value));Ke=Le.next(),se.h=2})},zt.prototype._asNative=function(){for(var we=new xe,Le=p(this),Ke=Le.next();!Ke.done;Ke=Le.next()){var Ne=p(Ke.value);Ke=Ne.next().value,Ne=Ne.next().value,we.append(Ke,Ne)}return we},zt.prototype._blob=function(){var we="----formdata-polyfill-"+Math.random(),Le=[],Ke="--"+we+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ne,P){return typeof Ne=="string"?Le.push(Ke+Yt(re(P))+`"\r
\r
`+re(Ne)+`\r
`):Le.push(Ke+Yt(re(P))+'"; filename="'+Yt(Ne.name)+`"\r
Content-Type: `+(Ne.type||"application/octet-stream")+`\r
\r
`,Ne,`\r
`)}),Le.push("--"+we+"--"),new Blob(Le,{type:"multipart/form-data; boundary="+we})},zt.prototype[Symbol.iterator]=function(){return this.entries()},zt.prototype.toString=function(){return"[object FormData]"},Ct&&!Ct.matches&&(Ct.matches=Ct.matchesSelector||Ct.mozMatchesSelector||Ct.msMatchesSelector||Ct.oMatchesSelector||Ct.webkitMatchesSelector||function(we){for(var Le=(we=(this.document||this.ownerDocument).querySelectorAll(we)).length;0<=--Le&&we.item(Le)!==this;);return-1<Le}),mt&&(zt.prototype[mt]="FormData"),Ce){var Ur=le.XMLHttpRequest.prototype.setRequestHeader;le.XMLHttpRequest.prototype.setRequestHeader=function(we,Le){Ur.call(this,we,Le),we.toLowerCase()==="content-type"&&(this.B=!0)},le.XMLHttpRequest.prototype.send=function(we){we instanceof zt?(we=we._blob(),this.B||this.setRequestHeader("Content-Type",we.type),Ce.call(this,we)):Ce.call(this,we)}}je&&(le.fetch=function(we,Le){return Le&&Le.body&&Le.body instanceof zt&&(Le.body=Le.body._blob()),je.call(this,we,Le)}),wt&&(le.navigator.sendBeacon=function(we,Le){return Le instanceof zt&&(Le=Le._asNative()),wt.call(this,we,Le)}),le.FormData=zt}})();let Zm=()=>{let e=$("AREAS");return e.length===0&&e.push(Kt.GLOBAL),Ji(e).call(e,(t,s,a)=>{let c=BU(s);return c?a===0?c:"".concat(t,",").concat(c):t},"")},BU=e=>e===Kt.OVERSEA?"".concat(Lr.ASIA,",").concat(Lr.EUROPE,",").concat(Lr.AFRICA,",").concat(Lr.NORTH_AMERICA,",").concat(Lr.SOUTH_AMERICA,",").concat(Lr.OCEANIA):Lr[e],jae=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(s=>{let a=aE[s],c=Object.keys(a);c&&c.map(d=>{d!=="CODE"&&(t[d]=t[d].concat(a[d]))})}),t},gE={GLOBAL:{ASIA:[Kt.CHINA,Kt.JAPAN,Kt.INDIA,Kt.KOREA,Kt.HKMC],EUROPE:[],NORTH_AMERICA:[Kt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},_E=Object.keys(gE[Kt.GLOBAL]),NC=[Kt.CHINA,Kt.NORTH_AMERICA,Kt.EUROPE,Kt.ASIA,Kt.JAPAN,Kt.INDIA,Kt.OCEANIA,Kt.SOUTH_AMERICA,Kt.AFRICA,Kt.KOREA,Kt.HKMC,Kt.US],Pae=function(e,t){let s=[];if(ke(e).call(e,Kt.GLOBAL)){let d=[Kt.GLOBAL,Kt.OVERSEA],h=Object.keys(aE);if(t===Kt.GLOBAL)throw new de(q.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Kt.CHINA)s=[Kt.OVERSEA];else if(c=t,ke(_E).call(_E,c)){let p=(a=t,gE[Kt.GLOBAL][a]||[]),f=[...d,t,...p];s=h.filter(_=>!ke(f).call(f,_))}else if(function(p){let f=!1;return _E.forEach(_=>{var v;ke(v=gE[Kt.GLOBAL][_]).call(v,p)&&(f=!0)}),f}(t)){let p=function(_){let v;return _E.forEach(b=>{var w;ke(w=gE[Kt.GLOBAL][b]).call(w,_)&&(v=b)}),v}(t),f=[...d,p,t];s=h.filter(_=>!ke(f).call(f,_))}else s=e;s=function(p){let f=[];return NC.forEach(_=>{ke(p).call(p,_)&&f.push(_)}),f.concat(p.filter(_=>!ke(NC).call(NC,_)))}(s)}else s=e;var a,c;return s};function WU(e){var t,s;if(!e&&ke(t=$("AREAS")).call(t,Kt.EXTENSIONS))return A.debug("update area from ap : reset"),void RC(Wie,!0);if(!ke(s=$("AREAS")).call(s,Kt.GLOBAL)||!e)return;let a=aE.EXTENSIONS;a&&(a={CODE:BU(Kt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},A.debug("update area from ap success: ".concat(e,",config is "),a),ts("AREAS",[Kt.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?ts(c,a[c][0]):ts(c,a[c])}))}function RC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=Ze.reportApiInvoke(null,{name:ks.SET_AREA,options:e,tag:xs.TRACER});try{let a=[];if(typeof e=="string"&&(a=[e]),Array.isArray(e)&&(e.forEach(d=>{if(!ke(lU).call(lU,d))throw new de(q.INVALID_PARAMS,"invalid area code")}),a=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:d,excludedArea:h}=e;if(!d)throw new de(q.INVALID_PARAMS,"area code is needed");let p=d;typeof d=="string"&&(p=[d]),a=h?Pae(p,h):p}if(!t){if(Ba.AREAS){let d=new de(q.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void A.warning("setArea is prohibited because of config-distribute")}if(ke(a).call(a,Kt.GLOBAL)&&$("AREAS")===Kt.EXTENSIONS){let d=new de(q.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void A.warning("setArea is prohibited because of ap extensions")}}ts("AREAS",a,t);let c=jae(a);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?ts(d,c[d][0]):ts(d,c[d])}),A.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function GU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function No(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?GU(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):GU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let AC=1;function kae(e,t,s,a,c){AC+=1;let d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:AC,requestId:AC,version:Ii,cname:s.cname},h={service_name:t,json_body:JSON.stringify(d)},p,f,_=e[0];return Va(async()=>{p=Date.now();let v=await za(_,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(f=Date.now()-p,v.code!==0){let T=new de(q.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:f});throw A.error(T.toString()),T}let b=JSON.parse(v.json_body);if(b.code!==200){let T=new de(q.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(b.code,", reason: ").concat(b.reason),{code:b.code,responseTime:f});throw A.error(T.toString()),T}if(!b.servers||b.servers.length===0){let T=new de(q.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:b.code,responseTime:f});throw A.error(T.toString()),T}let w=function(T,U){return{addressList:T.servers.map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(k.wss,"?serviceName=").concat(encodeURIComponent(U))),workerToken:T.workerToken,vid:T.vid}}(b,t);return $("LIVE_STREAMING_ADDRESS")&&(w.addressList=$("LIVE_STREAMING_ADDRESS")instanceof Array?$("LIVE_STREAMING_ADDRESS"):[$("LIVE_STREAMING_ADDRESS")]),No(No({},w),{},{responseTime:f})},(v,b)=>(Ze.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(v.addressList),firstSuccess:b===0,responseTime:f,serverIp:e[b%e.length]}),!1),(v,b)=>(Ze.apworkerEvent(s.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:t,responseTime:f,serverIp:e[b%e.length]}),!!(v.code!==q.OPERATION_ABORTED&&v.code!==q.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(_=e[(b+1)%e.length],!0)),c)}let IC=1;function HU(e,t,s,a){let{url:c,areaCode:d}=e,{clientId:h,sid:p}=t,f=Date.now(),_,v=t.role,[b,w]=OC(t,d,[Bs.CHOOSE_SERVER]),T=Vs.networkState;return Va(async()=>{T&&Vs.networkState===Gn.OFFLINE&&Vs.onlineWaiter&&await Be.race([Vs.onlineWaiter,_r(a&&a.maxRetryTimeout||Ks.maxRetryTimeout)]),T=Vs.networkState;let{data:U,headers:k}=await za(c,{data:b,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=k.http3==="1"?1:-1,Ze.reportResourceTiming(c,p),KU(U,c,t,f,[Bs.CHOOSE_SERVER],_);let F=$m(U,Bs.CHOOSE_SERVER);return DC(F),xC(F,c)},U=>(U&&Ze.joinChooseServer(p,{role:v,lts:f,succ:!0,csAddr:c,opid:w,serverList:U.gatewayAddrs.map(k=>k.address),ec:null,cid:U.cid.toString(),uid:U.uid.toString(),csIp:U.csIp,unilbsServerIds:[Bs.CHOOSE_SERVER].toString(),isHttp3:_,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:U.res.detail&&U.res.detail[38]}),!1),U=>U.code!==q.OPERATION_ABORTED&&(U.code===q.CAN_NOT_GET_GATEWAY_SERVER?U.data.retry:(Ze.joinChooseServer(p,{role:v,lts:f,succ:!1,csAddr:c,serverList:null,opid:w,ec:U.code,csIp:U.data&&U.data.csIp,unilbsServerIds:[Bs.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:T}),isHttp3:_,corssRegionTagReq:t.apRequestDetail}),A.warning("[".concat(h||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),U),!0)),a)}function zU(e,t,s,a){let c,{url:d,areaCode:h,serviceIds:p}=e,f=Date.now(),_=t.role,[v,b]=OC(t,h,p),w;return Va(async()=>{w&&Vs.networkState===Gn.OFFLINE&&Vs.onlineWaiter&&await Be.race([Vs.onlineWaiter,_r(a&&a.maxRetryTimeout||Ks.maxRetryTimeout)]),w=Vs.networkState;let{data:T,headers:U}=await za(d,{data:v,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=U.http3==="1"?1:-1,Ze.reportResourceTiming(d,t.sid),KU(T,d,t,f,p,c);let k=$m(T,Bs.CHOOSE_SERVER),F=$m(T,t.cloudProxyServer==="proxy5"?Bs.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Bs.CLOUD_PROXY:Bs.CLOUD_PROXY_FALLBACK),K=performance.getEntriesByName(d),Y=K[K.length-1],X;return Y&&(X={name:Y.name,protocol:"nextHopProtocol"in Y?Y.nextHopProtocol:"",dnscost:"domainLookupEnd"in Y&&"domainLookupStart"in Y&&typeof Y.domainLookupEnd=="number"&&typeof Y.domainLookupStart=="number"?Y.domainLookupEnd-Y.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Y&&"connectStart"in Y&&typeof Y.connectEnd=="number"&&typeof Y.connectStart=="number"?Y.connectEnd-Y.connectStart:-1,reqCost:"requestStart"in Y&&typeof Y.requestStart=="number"&&"responseEnd"in Y&&typeof Y.responseEnd=="number"?Y.responseEnd-Y.requestStart:-1,handleCost:"leave_ts"in T&&"enter_ts"in T&&typeof T.leave_ts=="number"&&typeof T.enter_ts=="number"?T.leave_ts-T.enter_ts:-1}),DC(k),{gatewayInfo:xC(k,d),proxyInfo:F,url:d,resourceTimingInfo:X}},T=>(T.gatewayInfo&&Ze.joinChooseServer(t.sid,{role:_,lts:f,succ:!0,csAddr:d,serverList:T.gatewayInfo.gatewayAddrs.map(U=>U.address),ec:null,opid:b,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:T.gatewayInfo.res.detail&&T.gatewayInfo.res.detail[38],resourceTimingInfo:T.resourceTimingInfo?JSON.stringify(T.resourceTimingInfo):void 0}),T.proxyInfo&&Ze.joinWebProxyAP(t.sid,{lts:f,sucess:1,apServerAddr:d,turnServerAddrList:T.proxyInfo.addresses.map(U=>U.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:p.toString()}),!1),T=>T.code!==q.OPERATION_ABORTED&&(T.code===q.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(Ze.joinWebProxyAP(t.sid,{lts:f,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:T.code,eventType:t.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:w})}),A.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),T),!0)),a)}let KU=(e,t,s,a,c,d)=>{let{sid:h,clientId:p,cloudProxyServer:f}=s,_=[],v=b=>{b.flag===4096?Ze.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:b.error.message,csIp:b.error.data&&b.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):b.flag!==1048576&&b.flag!==4194304&&b.flag!==4194310||Ze.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:b.error.code,eventType:f,unilbsServerIds:c.toString()})};if(e.response_body.forEach(b=>{let w=b.buffer.code;if(b.uri===23&&w===0&&!b.buffer.edges_services)if(b.buffer.flag===4194310)A.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),b.buffer.edges_services=[];else{let T={error:new de(q.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:b.buffer.flag};_.push(T),v(T)}if(w!==0){let T=vh(w),U={error:new de(q.CAN_NOT_GET_GATEWAY_SERVER,T.desc,{desc:T.desc,retry:T.retry,csIp:e.detail[502]}),flag:b.buffer.flag};b.buffer.flag===4194310?A.warning(U.error.toString()):_.push(U),v(U)}}),_.length)throw A.warning("[".concat(p||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(_.map(b=>"flag: ".concat(b.flag,", message: ").concat(b.error.message,", retry: ").concat(b.error.data.retry)).join(" | "))),new de(q.CAN_NOT_GET_GATEWAY_SERVER,_.map(b=>"flag: ".concat(b.flag,", message: ").concat(b.error.message)).join(" | "),{retry:!!_.find(b=>b.error.data.retry),csIp:e.detail[502],desc:[...new Set(_.map(b=>{var w;return b==null||(w=b.error)===null||w===void 0||(w=w.data)===null||w===void 0?void 0:w.desc}).filter(b=>!!b))]})},DC=e=>{var t,s,a,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new de(q.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if($("AP_AREA")&&((a=e.detail)!==null&&a!==void 0&&a[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?WU(e.detail[23].toLowerCase()):WU()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((s=e.detail)===null||s===void 0?void 0:s[19])=="string"){let h=e.detail[19],p=h==null?void 0:h.split(";");for(let f=0;f<p.length;f++){var d;let _=Jr(d=p[f]).call(d);e.addresses[f]&&p&&(e.addresses[f].fingerprint=_)}}if($("GATEWAY_ADDRESS")&&$("GATEWAY_ADDRESS").length>0){A.debug("assign gateway address to",$("GATEWAY_ADDRESS"));let h=$("GATEWAY_ADDRESS").map(p=>{var f,_;let v=(f=(_=e.addresses.find(b=>b.ip===p.ip&&b.port===p.port))===null||_===void 0?void 0:_.fingerprint)!==null&&f!==void 0?f:"";return{ip:p.ip,port:p.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:v}});e.addresses=h}},Lae=(e,t)=>{if(e.response_body&&e.response_body.length){let s=e.response_body[0];if(s.buffer.code!==0){let a=vh(s.buffer.code);throw new de(q.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw A.debug("update ticket request received ap response without response body:",t),new de(q.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},OC=(e,t,s)=>{let a=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,d={appid:e.appId,client_ts:Date.now(),opid:a,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:No(No(No({6:e.stringUid,11:t,12:$("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:s,uid:e.uid||0}}]};d.request_bodies.forEach(p=>{e.multiIP&&e.multiIP.gateway_ip&&(p.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},Mae=(e,t)=>{let s=Math.floor(Math.random()*1e12),a={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]},bh=0;function wh(e){return Be.all(e.map(t=>t.then(s=>{throw s},s=>s))).then(t=>{throw t},t=>t)}let ef=async e=>{let{fragementLength:t,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=e,h=0,p=t,f,_=0,v=async()=>{let b=(()=>{let w=h*p,T=w+p;return s.slice(w,T).map(a)})();d&&d.push(...b);try{f=await wh(b)}catch(w){if(_+=p,h++,!(_>=s.length))return void await v();c(w)}b.forEach(w=>w.cancel())};return await v(),f},qU=async e=>{let{referenceList:t,asyncMapHandler:s,closeFn:a}=e,c=t.length,d=0,h=async()=>{let p=s(t.shift());try{return await p}catch(f){if(d++,d>=c||a!=null&&a(f))throw f;return h()}};return h()};async function Fae(){if(typeof VideoDecoder>"u")return!0;let e,t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],a=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Be((p,f)=>{let _;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:b=>{b.close(),clearTimeout(_),p(!0)},error:b=>{clearTimeout(_),p(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();let v=[t,s,a,c,d,h];for(let b=0;b<v.length;b++){let w=new EncodedVideoChunk({type:b==0?"key":"delta",timestamp:33333*b,duration:33333,data:new Uint8Array(v[b])});try{await e.decode(w)}catch{return void p(!1)}}})(),_=setTimeout(()=>{p(!1)},5e3)})}async function jC(e,t,s,a){return{gatewayInfo:await async function(c,d,h,p){let f=null,_=[],v=async()=>{let w=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(k=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Zm()})),T=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(k=>k.url)}),U=await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:k=>(A.debug("[".concat(c.clientId,"] Connect to choose_server:"),k.url),HU(k,c,d,h)),allFailedhandler:k=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},T),k[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},T),U},b=async()=>{if(await _r(1e3),f!==null)return f;let w=$("WEBCS_DOMAIN_BACKUP_LIST").map(k=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Zm()})),T=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(k=>k.url)}),U=await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:k=>(A.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),k.url),HU(k,c,d,h)),allFailedhandler:k=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},T),k[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},T),U};try{return f=await wh([v(),b()]),_.length&&_.forEach(w=>w.cancel&&typeof w.cancel=="function"&&w.cancel()),f}catch(w){throw w[0]}}(e,t,s,a)}}async function YU(e,t,s,a,c){let d=e.cloudProxyServer;if(d==="disabled"){if(e.useLocalAccessPoint)return await jC(e,t,s,c);if($("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:w,proxyInfo:T}=await JU(e,t,s,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:w};let U=T.map(k=>({turnServerURL:k.address,tcpport:k.tcpport||Ar.tcpport,udpport:k.udpport||Ar.udpport,username:k.username||Ar.username,password:k.password||Ar.password,forceturn:!1,security:!0}));if(c.useP2P){var h;let k=(h=e.uid)!==null&&h!==void 0?h:w.uid,F="glb:".concat(k.toString()),K=await b0(F),Y=T.map(X=>({turnServerURL:X.address,tcpport:X.tcpport||Ar.tcpport,udpport:X.udpport||Ar.udpport,username:F,password:K,forceturn:!1,security:!0}));U.push(...Y)}return e.turnServer={mode:"manual",servers:U},{gatewayInfo:w}}return await jC(e,t,s,c)}let{proxyInfo:p,gatewayInfo:f}=await JU(e,t,s,c),_={gatewayInfo:f},v=p.map(w=>({turnServerURL:w.address,tcpport:d==="proxy3"?void 0:w.tcpport?w.tcpport:Ar.tcpport,udpport:d==="proxy4"?void 0:w.udpport?w.udpport:Ar.udpport,username:w.username||Ar.username,password:w.password||Ar.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var b;let w=(b=e.uid)!==null&&b!==void 0?b:f.uid,T="glb:".concat(w.toString()),U=await b0(T),k=p.map(F=>({turnServerURL:F.address,tcpport:d==="proxy3"?void 0:F.tcpport||Ar.tcpport,udpport:d==="proxy4"?void 0:F.udpport||Ar.udpport,username:T,password:U,forceturn:d!=="proxy4",security:d==="proxy5"}));v.push(...k)}return e.turnServer={mode:"manual",servers:v},A.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(d)),_}async function $U(e,t,s,a,c){let d=$("ACCOUNT_REGISTER").slice(0,$("AJAX_REQUEST_CONCURRENT")),h=[];h=t.proxyServer?d.map(f=>"https://".concat(t.proxyServer,"/ap/?url=").concat(f+"/api/v1")):d.map(f=>"https://".concat(f,"/api/v1"));let p=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{let f=await async function(_,v,b,w,T){let U=Date.now(),k={sid:b.sid,opid:10,appid:b.appId,string_uid:v},F=_[0],K=await Va(()=>za(F+"".concat(F.indexOf("?")===-1?"?":"&","action=stringuid"),{data:k,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,X)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw A.error("Invalid Uint Uid ".concat(v," => ").concat(Y.uid),Y),Ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:F,stringUid:k.string_uid,uid:Y.uid,errorCode:q.INVALID_UINT_UID_FROM_STRING_UID,extend:k}),new de(q.INVALID_UINT_UID_FROM_STRING_UID);return Ze.reqUserAccount(k.sid,{lts:U,success:!0,serverAddr:F,stringUid:k.string_uid,uid:Y.uid,errorCode:null,extend:k}),!1}let re=vh(Y.code);return re.retry&&(F=_[(X+1)%_.length]),Ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:F,stringUid:k.string_uid,uid:Y.uid,errorCode:re.desc,extend:k}),re.retry},(Y,X)=>Y.code!==q.OPERATION_ABORTED&&(Ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:F,stringUid:k.string_uid,uid:null,errorCode:Y.code,extend:k}),F=_[(X+1)%_.length],!0),T);if(K.code!==0){let Y=vh(K.code);throw new de(q.UNEXPECTED_RESPONSE,Y.desc)}return K}(h,e,t,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},p),f.uid}catch(f){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[f]},p),f}}async function Uae(e,t,s){let a=$("ACCOUNT_REGISTER"),c=[];c=t.proxyServer?a.map(d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));try{return await qU({referenceList:c,asyncMapHandler:d=>async function(h,p,f,_){let v=Date.now(),b={sid:f.sid,opid:10,appid:f.appId,string_uid:p};try{let w=await za(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:b,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(w.code!==0){let T=vh(w.code);throw new de(q.UNEXPECTED_RESPONSE,"preload sua error:".concat(T.desc),T)}if(w.uid<=0||w.uid>=Math.pow(2,32))throw new de(q.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:v,url:h,req:b,uid:w.uid,elapse:Date.now()-v}}catch(w){throw w}}(d,e,t,s),closeFn:d=>d.code===q.OPERATION_ABORTED||d.code===q.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(d){throw d}}async function Vae(e,t,s){let a=$("CDS_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(f=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")),c=a.map(f=>function(_,v,b,w){let T=Lt(),U={flag:64,cipher_method:0,features:No(No(No(No(No({install_id:j0(),device:T.name,system:T.os,system_general:navigator.userAgent,vendor:v.appId,version:Ii,cname:v.cname,session_id:v.sid,proxyServer:v.proxyServer,sdk_type:Iae.WEB_RTC,browser_name:T.name,browser_version:T.version,user_agent:navigator.userAgent,channel_name:v.cname},v.stringUid&&{string_uid:v.stringUid}),v.uid&&{uid:v.uid+""}),T.os&&{os_name:T.os}),T.osVersion&&{os_version:T.osVersion}),{},{detail:""})};return Va(()=>za(_,{data:U,timeout:1e3,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,k=>k.code!==q.OPERATION_ABORTED,w)}(f,e,t,s)),d=null,h=null,p={};try{d=await wh(c)}catch(f){if(f.code===q.OPERATION_ABORTED)throw f;h=f}if(c.forEach(f=>f.cancel()),Ze.reportApiInvoke(e.sid,{name:ks.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{p=function(f){if(!f.test_tags)return{};let _=f.test_tags,v=Object.keys(_),b={};return v.forEach(w=>{var T;let U=Jr(T=w.slice(4)).call(T),k=JSON.parse(_[w]),F=k[1];b[U]={tag:k[0]||"",value:F}}),b}(d)}catch{}return p}async function XU(e,t){let s=$("WEBCS_DOMAIN").concat($("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:Zm(),serviceIds:[Bs.CHOOSE_SERVER,Bs.CLOUD_PROXY_FALLBACK]}));try{return await qU({referenceList:s,asyncMapHandler:a=>async function(c,d,h){let p,{url:f,areaCode:_,serviceIds:v}=c,b=Date.now(),[w,T]=OC(d,_,v),U=Vs.networkState;try{U&&Vs.networkState===Gn.OFFLINE&&Vs.onlineWaiter&&await Be.race([Vs.onlineWaiter,_r(Ks.maxRetryTimeout)]),U=Vs.networkState;let{data:k,headers:F}=await za(f,{data:w,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=F.http3==="1"?1:-1,(X=>{let re=[];if(X.response_body.forEach(te=>{let Z=te.buffer.code;if(te.uri===23&&Z===0&&!te.buffer.edges_services)if(te.buffer.flag===4194310)te.buffer.edges_services=[];else{let le={error:new de(q.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:X.detail[502]}),flag:te.buffer.flag};re.push(le)}if(Z!==0){let le=vh(Z),xe={error:new de(q.CAN_NOT_GET_GATEWAY_SERVER,le.desc,{desc:le.desc,retry:le.retry,csIp:X.detail[502]}),flag:te.buffer.flag};te.buffer.flag===4194310?A.warning(xe.error.toString()):re.push(xe)}}),re.length)throw new de(q.CAN_NOT_GET_GATEWAY_SERVER,re.map(te=>"flag: ".concat(te.flag,", message: ").concat(te.error.message)).join(" | "),{retry:!!re.find(te=>te.error.data.retry),csIp:X.detail[502],desc:[...new Set(re.map(te=>{var Z;return te==null||(Z=te.error)===null||Z===void 0||(Z=Z.data)===null||Z===void 0?void 0:Z.desc}).filter(te=>!!te))]})})(k);let K=$m(k,Bs.CHOOSE_SERVER),Y=$m(k,Bs.CLOUD_PROXY_FALLBACK);return DC(K),{gatewayInfo:xC(K,f),proxyInfo:Y,opid:T,requestTime:b,url:f,isHttp3:p,elapse:Date.now()-b}}catch(k){throw k}}(a,e,t),closeFn:a=>a.code===q.OPERATION_ABORTED||a.code===q.CAN_NOT_GET_GATEWAY_SERVER&&!a.data.retry})}catch(a){throw a}}async function JU(e,t,s,a){let c=$("PROXY_SERVER_TYPE3"),d=(T,U,k)=>{let F=k||c;return Array.isArray(F)&&(F=U%2==0&&c[1]||c[0]),"https://".concat(F,"/ap/?url=").concat(T)},h=null,p=[],f=async()=>{let T=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map((F,K)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(F,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(F,"/api/v2/transpond/webrtc?v=2"):d("".concat(F,"/api/v2/transpond/webrtc?v=2"),K),{url:Y,areaCode:Zm(),serviceIds:[Bs.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Bs.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Bs.CLOUD_PROXY:Bs.CLOUD_PROXY_FALLBACK]}}),U=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(F=>F.url)}),k=await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:F=>(A.debug("[".concat(e.clientId,"] Connect to choose_server:"),F.url),zU(F,e,t,s)),allFailedhandler:F=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},U),F[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},_=async()=>{if(await _r(1e3),h!==null)return h;let T=$("WEBCS_DOMAIN_BACKUP_LIST").map((F,K)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(F,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(F,"/api/v2/transpond/webrtc?v=2"):d("".concat(F,"/api/v2/transpond/webrtc?v=2"),K),{url:Y,areaCode:Zm(),serviceIds:[Bs.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Bs.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Bs.CLOUD_PROXY:Bs.CLOUD_PROXY_FALLBACK]}}),U=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(F=>F.url)}),k=await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:F=>(A.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),F.url),zU(F,e,t,s)),allFailedhandler:F=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},U),F[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},v,b,w;try{({gatewayInfo:v,proxyInfo:b,url:w}=await wh([f(),_()]))}catch(T){throw T[0]}if(p.length&&p.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!v||!b)throw new de(q.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=w,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&w){let T=/^https?:\/\/(.+?)(\/.*)?$/.exec(w)[1];ke(c).call(c,T)&&(e.proxyServer=T,A.setProxyServer(T),Ze.setProxyServer(T))}return h={gatewayInfo:v,proxyInfo:await xU(b,v.uid)},h}async function Bae(e,t,s){let a=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=a.map(d=>function(h,p,f,_){let v={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:Ii,cname:p.cname,uid:p.uid.toString(),requestId:IC,seq:IC};IC+=1;let b={service_name:"tele_channel",json_body:JSON.stringify(v)};return Va(async()=>{let w=await za(h,{data:b,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(w.code!==0){let U=new de(q.UNEXPECTED_RESPONSE,"cross channel ap error, code"+w.code,{retry:!0});throw A.error(U.toString()),U}let T=JSON.parse(w.json_body);if(T.code!==200){let U=new de(q.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw A.error(U.toString()),U}if(!T.servers||T.servers.length===0){let U=new de(q.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw A.error(U.toString()),U}return{vid:T.vid,workerToken:T.workerToken,addressList:($("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(U.wss))}},void 0,w=>!!(w.code!==q.OPERATION_ABORTED&&w.code!==q.UNEXPECTED_RESPONSE||w.data&&w.data.retry),_)}(d,e,t,s));try{let d=await wh(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function Wae(e,t,s){let a=null,c=[],d=async h=>{let p=$(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(f=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(f+"/api/v2/transpond/webrtc?v=2"):"https://".concat(f,"/api/v2/transpond/webrtc?v=2"));return h&&(await _r(1e3),a!==null)?a:await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:f=>(A.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),f),function(_,v,b,w){let[T]=Mae(v,[Bs.CHOOSE_SERVER]),U=Vs.networkState;return Va(async()=>{U&&Vs.networkState===Gn.OFFLINE&&Vs.onlineWaiter&&await Be.race([Vs.onlineWaiter,_r(w&&w.maxRetryTimeout||Ks.maxRetryTimeout)]),U=Vs.networkState;let k=await za(_,{data:T,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return Lae(k,_)},()=>!1,k=>k.code!==q.OPERATION_ABORTED&&(k.code===q.UPDATE_TICKET_FAILED?k.data.retry:(A.warning("[".concat(v.clientId,"] update ticket network error, retry"),k),!0)),w)}(f,e,t,s)),allFailedhandler:f=>{throw f[0]},promisesCollector:c})};try{return a=await wh([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function QU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function PC(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?QU(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):QU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class Gae extends Cs{get isSuccess(){return!!this.configs}constructor(t,s){super(),W(this,"configs",void 0),W(this,"store",void 0),W(this,"joinInfo",void 0),W(this,"cancelToken",void 0),W(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),W(this,"interval",void 0),W(this,"mutex",void 0),W(this,"mutableParamsRead",!1),W(this,"configCache",{}),W(this,"limit_bitrate",void 0),this.mutex=new Pr("config-distribute",t),this.store=s}startGetConfigDistribute(t,s){this.joinInfo=t,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),$("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},$("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ze.reportApiInvoke(null,{options:void 0,name:ks.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:xs.TRACER}).onSuccess(JSON.stringify(Ba))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void A.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,s=await this.mutex.lock();try{t=await Vae(this.joinInfo,this.cancelToken,this.retryConfig),A.debug("[config-distribute] get config distribute",JSON.stringify(t));let a=function(c){var d;let h=ed(d=Object.keys(c).filter(_=>/^webrtc_ng_global_parameter/.test(_))).call(d);for(let _=0;_<h.length;_++)for(let v=h.length-1;v>_;v--){let b=h[v],w=c[b].value;if(typeof w.__priority=="number"){let T=w.__priority,U=h[v-1],k=c[U].value;if(typeof k.__priority=="number"){if(!(T>k.__priority))continue;{let F=b;h[v]=h[v-1],h[v-1]=F}}else{let F=b;h[v]=h[v-1],h[v-1]=F}}}let p=Date.now(),f={};return h.forEach(_=>{let v=c[_].value.__expires;v&&v<=p||(f[_]=c[_])}),f}(t);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){let c=new de(q.NETWORK_RESPONSE_ERROR,a);A.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){dU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Km.UPDATE_BITRATE_LIMIT,t):this.emit(Km.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&PC({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let s={},a=Object.keys(t),c=[];a.forEach(d=>{let h=t[d].value;s[d]=h;let p=h.__id;if(p&&this.configCache[d]&&this.configCache[d].__id===p)return;let f=h.__type,_=t[d].value,v=t[d].tag,b=0;f?f===PL.REALTIME&&(b=1):Object.keys(_).some(w=>Object.prototype.hasOwnProperty.call(M0,w)||!dC()&&Object.prototype.hasOwnProperty.call(Fv,w)?(b=1,!0):void 0),c.push({tag:v,isApplied:b,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:p,params:f,isApplied:_}=d;this.store.sessionId&&Ze.abTest(this.store.sessionId,{intSucc:1,isApplied:_,tag:h,feature:p,params:f,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){A.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(t){let s=function(c){let d={};return Object.keys(c).forEach(h=>{let p=c[h].value,f=p.__expires,_=p.__type;Object.keys(p).forEach(v=>{v==="__id"||v==="__type"||v==="__priority"||v==="__expires"||Object.prototype.hasOwnProperty.call(d,v)||(d[v]=PC(PC({value:p[v]},f&&{expires:f}),_&&{type:_}))})}),d}(t);try{var a;let c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&dU(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(t),function(p){try{let f=Date.now();Object.keys(p).forEach(_=>{let{value:v,type:b,expires:w}=p[_];w&&w<=f||((b===PL.REALTIME||Object.prototype.hasOwnProperty.call(M0,_))&&(Ba[_]=v,Es[_]=v,A.debug("Update realtime parameters from config distribute",_,v)),b||dC()||!Object.prototype.hasOwnProperty.call(Fv,_)||(Ba[_]=v,Es[_]=v,A.debug("Update gateway parameters from config distribute",_,v)))})}catch(f){A.error("Error update config immediately: ".concat(p),f.message)}}(s);let d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),A.debug("Caching global parameters ".concat(d))}catch(c){A.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{let s=Date.now();Object.keys(t).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Es,a)){let{value:c,expires:d}=t[a];if(d&&d<=s)return;(function(h,p){try{return typeof h=="object"&&typeof p=="object"&&JSON.stringify(h)===JSON.stringify(p)}catch{return!1}})(Es[a],c)||(Ba[a]=c,Es[a]=c,this.emit(Km.UPDATE_CLIENT_ROLE_OPTIONS,c),A.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){A.error("Error handling global parameter config:",s.message)}}}class Hae extends Cs{constructor(){super(...arguments),W(this,"resultStorage",new Map)}setLocalAudioStats(t,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(t,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(a)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(a))}setRemoteAudioStats(t,s){let a=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(t,s){let a=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(t,s,a){if($("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let c=this.resultStorage.get(t);if(!c)return;c.result.push(a);let d=t==="VIDEO_ENCODE_FAILED"?$("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;let p=ke(h=c.result).call(h,!0);c.isPrevNormal&&!p&&this.emit("exception",kC[t],t,s),!c.isPrevNormal&&p&&this.emit("exception",kC[t]+2e3,t+"_RECOVER",s),c.isPrevNormal=p,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,s){return s instanceof Xs&&!s.isActive||!!s.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=Hn(s._encoderConfig.frameRate));let c=t.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var s;return!(!t.codecType||ke(s=$("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,s){return!!s.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,s){return s instanceof Xs&&!s.isActive||!!s.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let kC={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Fr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(s.length>0){let a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(e,t){let s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(s.length>0){let a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function ZU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function yd(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?ZU(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ZU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class tf{constructor(t){W(this,"store",void 0),W(this,"onStatsException",void 0),W(this,"onUploadPublishDuration",void 0),W(this,"onStatsChanged",void 0),W(this,"onVideoCodecChanged",void 0),W(this,"localStats",new Map),W(this,"remoteStats",new Map),W(this,"updateStatsInterval",void 0),W(this,"trafficStats",void 0),W(this,"trafficStatsPeerList",[]),W(this,"uplinkStats",void 0),W(this,"exceptionMonitor",void 0),W(this,"p2pChannel",void 0),W(this,"scalabilityMode",Mv.L1T1),W(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Hae,this.exceptionMonitor.on("exception",(s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ie.LocalAudioTrack)||yd({},G0)}getLocalVideoTrackStats(){return this.localStats.get(Ie.LocalVideoTrack)||yd({},H0)}getRemoteAudioTrackStats(t){let s=(d,h)=>{if(!this.trafficStats)return h;let p=this.trafficStats.peer_delay.find(f=>f.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(t){var c;let d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;d&&(a[t]=s(t,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(a[h]=s(h,p))});return a}getRemoteNetworkQualityStats(t){let s={};if(t){var a;let c=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.networkStats;c&&(s[t]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(t){let s=(d,h)=>{if(!this.trafficStats)return h;let p=this.trafficStats.peer_delay.find(f=>f.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(t){var c;let d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;d&&(a[t]=s(t,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(a[h]=s(h,p))});return a}getRTCStats(){let t=0,s=0,a=0,c=0,d=this.localStats.get(Ie.LocalAudioTrack);d&&(t+=d.sendBytes,s+=d.sendBitrate);let h=this.localStats.get(Ie.LocalVideoTrack);h&&(t+=h.sendBytes,s+=h.sendBitrate);let p=this.localStats.get(Ie.LocalVideoLowTrack);p&&(t+=p.sendBytes,s+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:v,videoStats:b}=_;v&&(a+=v.receiveBytes,c+=v.receiveBitrate),b&&(a+=b.receiveBytes,c+=b.receiveBitrate)});let f=1;return this.trafficStats&&(f+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:f,SendBitrate:s,SendBytes:t,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),t.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;let c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?Fr.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Fr.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&A.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,s,a){if(!t)return!1;let c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(s=>{let[a,c]=s;switch(a){case Ie.LocalVideoTrack:case Ie.LocalVideoLowTrack:{let p=c,f=yd({},H0),_=t.getStats(),v=t.getLocalMedia(a);if(_){let b=_.videoSend.find(w=>w.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(b){let w=t.getLocalVideoSize(),T=t.getEncoderConfig(Ie.LocalVideoTrack);var d;(b.codec==="H264"||b.codec==="H265"||b.codec==="VP8"||b.codec==="VP9"||b.codec==="AV1X"||b.codec==="AV1")&&(f.codecType=b.codec,(p==null?void 0:p.codecType)!==b.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,b.codec.toLocaleLowerCase()))),f.sendBytes=b.bytes,f.sendBitrate=p?8*Math.max(0,f.sendBytes-p.sendBytes):0,b.inputFrame?(f.captureFrameRate=b.inputFrame.frameRate,f.captureResolutionHeight=b.inputFrame.height,f.captureResolutionWidth=b.inputFrame.width):w&&(f.captureResolutionWidth=w.width,f.captureResolutionHeight=w.height),b.sentFrame?(f.sendFrameRate=b.sentFrame.frameRate,f.sendResolutionHeight=b.sentFrame.height,f.sendResolutionWidth=b.sentFrame.width):w&&(f.sendResolutionWidth=w.width,f.sendResolutionHeight=w.height),b.avgEncodeMs&&(f.encodeDelay=b.avgEncodeMs),T&&T.bitrateMax?f.targetSendBitrate=1e3*T.bitrateMax:b.targetBitrate&&(f.targetSendBitrate=b.targetBitrate),f.sendPackets=b.packets,f.sendPacketsLost=b.packetsLost,f.sendJitterMs=b.jitterMs,f.sendRttMs=b.rttMs,f.totalDuration=p?p.totalDuration+1:1,f.totalFreezeTime=p?p.totalFreezeTime:0,this.isLocalVideoFreeze(b)&&(f.totalFreezeTime+=1),b.scalabilityMode&&this.scalabilityMode!==b.scalabilityMode&&(A.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(b.scalabilityMode)),this.scalabilityMode=b.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(a,f),((p==null?void 0:p.sendResolutionWidth)!==f.sendResolutionWidth||(p==null?void 0:p.sendResolutionHeight)!==f.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,f);break}case Ie.LocalAudioTrack:{let p=c,f=yd({},G0),_=t.getStats(),v=t.getLocalMedia(a);if(_){let b=_.audioSend.find(w=>w.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(b){if(b.codec!=="opus"&&b.codec!=="aac"&&b.codec!=="PCMU"&&b.codec!=="PCMA"&&b.codec!=="G722"||(f.codecType=b.codec),b.inputLevel)f.sendVolumeLevel=Math.round(32767*b.inputLevel);else{let w=t.getLocalAudioVolume();w&&(f.sendVolumeLevel=Math.round(32767*w))}f.sendBytes=b.bytes,f.sendPackets=b.packets,f.sendPacketsLost=b.packetsLost,f.sendJitterMs=b.jitterMs,f.sendRttMs=b.rttMs,f.sendBitrate=p?8*Math.max(0,f.sendBytes-p.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ie.LocalAudioTrack,f),f&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,f);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(s=>{var a,c;let[d,{videoStats:h,audioStats:p,videoPcStats:f}]=s,_=p,v=h,b=f,w=yd({},zL),T=yd({},KL),U=yd({},Nie),{audioTrack:k,videoTrack:F,audioSSRC:K,videoSSRC:Y}=t.getRemoteMedia(d),X;X=this.store.useP2P?t.getStats(!0):t.getStats();let re=(a=X)===null||a===void 0?void 0:a.audioRecv.find(xe=>xe.ssrc===K),te=(c=X)===null||c===void 0?void 0:c.videoRecv.find(xe=>xe.ssrc===Y),Z=this.trafficStats&&this.trafficStats.peer_delay.find(xe=>xe.peer_uid===d);if(re&&(re.codec!=="opus"&&re.codec!=="aac"&&re.codec!=="PCMU"&&re.codec!=="PCMA"&&re.codec!=="G722"||(w.codecType=re.codec),re.outputLevel?w.receiveLevel=Math.round(32767*re.outputLevel):k&&(w.receiveLevel=Math.round(32767*k.getVolumeLevel())),w.receiveBytes=re.bytes,w.receivePackets=re.packets,w.receivePacketsLost=re.packetsLost,w.receivePacketsDiscarded=re.packetsDiscarded,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost),w.receiveBitrate=_?8*Math.max(0,w.receiveBytes-_.receiveBytes):0,w.totalDuration=_?_.totalDuration+1:1,w.totalFreezeTime=_?_.totalFreezeTime:0,w.freezeRate=w.totalFreezeTime/w.totalDuration,w.receiveDelay=re.jitterBufferMs,w.totalDuration>10&&tf.isRemoteAudioFreeze(k)&&(w.totalFreezeTime+=1)),te){var le;te.codec!=="H264"&&te.codec!=="H265"&&te.codec!=="VP8"&&te.codec!=="VP9"&&te.codec!=="AV1X"&&te.codec!=="AV1"||(T.codecType=te.codec),T.receiveBytes=te.bytes,T.receiveBitrate=v?8*Math.max(0,T.receiveBytes-v.receiveBytes):0,T.decodeFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,T.renderFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,te.outputFrame&&(T.renderFrameRate=te.outputFrame.frameRate),te.receivedFrame?(T.receiveFrameRate=te.receivedFrame.frameRate,T.receiveResolutionHeight=te.receivedFrame.height,T.receiveResolutionWidth=te.receivedFrame.width):F&&(T.receiveResolutionHeight=F._videoHeight||0,T.receiveResolutionWidth=F._videoWidth||0),te.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(te.framesRateFirefox)),T.receivePackets=te.packets,T.receivePacketsLost=te.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost);let xe=v?v.totalFreezeTime:0,Ce=v?v.totalDuration:0;T.totalDuration=v?v.totalDuration+1:1,T.totalFreezeTime=(le=te.totalFreezesDuration)!==null&&le!==void 0?le:xe||0,T.receiveDelay=te.jitterBufferMs||0;let je=!!Y&&t.getRemoteVideoIsReady(Y);te.totalFreezesDuration===void 0&&F&&je&&tf.isRemoteVideoFreeze(F,te,b)&&(T.totalFreezeTime+=1),T.freezeRate=Math.max(0,Math.min((T.totalFreezeTime-xe)/(T.totalDuration-Ce),1))}Z&&(w.end2EndDelay=Z.B_ad,T.end2EndDelay=Z.B_vd,w.transportDelay=Z.B_ed,T.transportDelay=Z.B_ed,w.currentPacketLossRate=Z.B_ealr4/100,T.currentPacketLossRate=Z.B_evlr4/100,U.uplinkNetworkQuality=Z.B_punq?Z.B_punq:0,U.downlinkNetworkQuality=Z.B_pdnq?Z.B_pdnq:0),this.remoteStats.set(d,{audioStats:w,videoStats:T,videoPcStats:te,networkStats:U}),k&&this.exceptionMonitor.setRemoteAudioStats(k,w),F&&this.exceptionMonitor.setRemoteVideoStats(F,T)})}}class e5{constructor(){W(this,"destChannelMediaInfos",new Map),W(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){cU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){cU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){rE(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function t5(e){if(!(e instanceof e5))return new de(q.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),s=e.getDestChannelMediaInfo();if(!t)return new de(q.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new de(q.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Zc{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,s){W(this,"uid",void 0),W(this,"_uintid",void 0),W(this,"_trust_in_room_",!0),W(this,"_trust_audio_enabled_state_",!0),W(this,"_trust_video_enabled_state_",!0),W(this,"_trust_audio_mute_state_",!0),W(this,"_trust_video_mute_state_",!0),W(this,"_audio_muted_",!1),W(this,"_video_muted_",!1),W(this,"_audio_enabled_",!0),W(this,"_video_enabled_",!0),W(this,"_audio_added_",!1),W(this,"_video_added_",!1),W(this,"_is_pre_created",!1),W(this,"_video_pre_subscribed",!1),W(this,"_audio_pre_subscribed",!1),W(this,"_trust_video_stream_added_state_",!0),W(this,"_trust_audio_stream_added_state_",!0),W(this,"_audioTrack",void 0),W(this,"_videoTrack",void 0),W(this,"_dataChannels",[]),W(this,"_audioSSRC",void 0),W(this,"_videoSSRC",void 0),W(this,"_audioOrtc",void 0),W(this,"_videoOrtc",void 0),W(this,"_cname",void 0),W(this,"_rtxSsrcId",void 0),W(this,"_videoMid",void 0),W(this,"_audioMid",void 0),this.uid=t,this._uintid=s}}function s5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function LC(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?s5(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):s5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let vE="9",MC=2e4,EE=4e4;function r5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function lc(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?r5(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}var Sh=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Sh||{});let yE=new Map;function n5(e,t,s,a){let{scale:c}=e;if(c===0&&a===Sh.UP||c>=t.length-1&&a===Sh.DOWN)return e;let d=lc(lc({},e),{},{scale:a===Sh.DOWN?++c:--c});switch(s){case"maintain-framerate":d=lc(lc({},d),t[c].motion);break;case"maintain-resolution":d=lc(lc({},d),t[c].detail);break;case"balanced":d=lc(lc({},d),t[c].balanced)}return d}function i5(e,t){if(t){let s={overUse:0,underUse:0,adaptationList:a5(t)};yE.set(e,s)}else yE.delete(e)}function a5(e){let t=lc({},e),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=t,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:f,BITRATE_MIN_THRESHOLD:_,BITRATE_MAX_THRESHOLD:v,BWE_SCALE_UP_THRESHOLD:b,BWE_SCALE_DOWN_THRESHOLD:w,PERF_SCALE_DOWN_THRESHOLD:T,PERF_SCALE_UP_THRESHOLD:U,BALANCE_BITRATE_FACTOR:k,BALANCE_FRAMERATE_FACTOR:F,BALANCE_RESOLUTION_FACTOR:K,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:X,DETAIL_FRAMERATE_FACTOR:re,DETAIL_BITRATE_FACTOR:te}=k0,Z=Math.min(t.frameRate,p),le=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(w,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(T,1)*Z),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d}}];for(let xe=1;xe<=f;xe++){let Ce={bwe_up:Math.round(Math.pow(b,xe)*s),bwe_down:Math.round(Math.pow(w,xe+1)*s),fps_up:Math.round(Math.pow(U,xe)*Z),fps_down:Math.round(Math.pow(T,xe+1)*Z)},je={scaleResolutionDownBy:c/Math.pow(K,xe),frameRate:Math.max(Math.round(Math.pow(F,xe)*a),h),bitrateMax:Math.max(Math.round(Math.pow(k,xe)*s),v),bitrateMin:Math.max(Math.round(Math.pow(k,xe)*d),_)},wt={scaleResolutionDownBy:c/Math.pow(Y,xe),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(X,xe)*s),v),bitrateMin:Math.max(Math.round(Math.pow(X,xe)*d),_)},Ct={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(re,xe)*a),h),bitrateMax:Math.max(Math.round(Math.pow(te,xe)*s),v),bitrateMin:Math.max(Math.round(Math.pow(te,xe)*d),_)};le.push({scale:xe,threshold:Ce,balanced:je,motion:wt,detail:Ct})}return le}function zae(e,t,s,a,c,d){let h=yE.get(e)||{overUse:0,underUse:0,adaptationList:a5(c)},{adaptationList:p}=h;yE.set(e,h);let{OVERUSE_TIMES_THRESHOLD:f,UNDERUSE_TIMES_THRESHOLD:_}=k0,{scale:v}=a,b,w;return typeof t=="number"&&t>0&&function(T,U,k,F){if(U>=k.length)return!1;let{threshold:{fps_down:K}}=k[U];return $("FORCE_AG_HIGH_FRAMERATE")&&F==="maintain-framerate"&&(K=k[0].threshold.fps_down),T<K}(t,v,p,d)&&(h.overUse++,w=Fm.CPU,h.overUse>f)||typeof s=="number"&&s>0&&function(T,U,k){if(U>=k.length)return!1;let{threshold:{bwe_down:F}}=k[U];return T<F}(s,v,p)&&(h.overUse++,w=Fm.BANDWIDTH,h.overUse>f)?(h.overUse=0,h.underUse=0,b=n5(a,p,d,Sh.DOWN),[b,w]):(typeof t=="number"&&t>0&&typeof s=="number"&&s>0&&function(T,U,k,F){if(U===0)return;let{threshold:{fps_up:K}}=k[U];return $("FORCE_AG_HIGH_FRAMERATE")&&F==="maintain-framerate"&&(K=k[1].threshold.fps_up),T>K}(t,v,p,d)&&function(T,U,k){if(U===0)return;let{threshold:{bwe_up:F}}=k[U];return T>F}(s,v,p)&&(h.underUse++,h.underUse>_&&(h.overUse=0,h.underUse=0,b=n5(a,p,d,Sh.UP),b.scale===0&&(w=Fm.NONE))),[b,w])}function o5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function FC(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?o5(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let xE=new Map;function bE(e,t){let s=xE.get(e);if(s){let{timer:a}=s;window.clearTimeout(a),xE.delete(e)}t.qualityLimitationReason=Fm.NONE,i5(e)}function Kae(e,t){var s;let a;switch(t){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=ke(s=e._hints).call(s,is.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return a}function UC(e){let t=Vt();if(e.some(s=>s._bypassWebAudio))throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function VC(e,t){UC(e);let s=new Xs;return e.forEach(a=>s.addAudioTrack(a)),s}let qae=!Vt().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&rc();function wE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return qae?(s={spec:t,store:e},cc("PlanBConnection").create(s)):new ki(t,e)}function BC(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function c5(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(km(e.turnServer.servers))return!1;if($("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Mt;function l5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Ka(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?l5(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):l5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let ki=(Mt=class Gd extends hU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return ke(s=Object.keys(Vm)).call(s,t)}))]}constructor(t,s){super(t,s),W(this,"id",os(5,"connection-")),W(this,"store",void 0),W(this,"peerConnection",void 0),W(this,"forceTurn",!1),W(this,"remoteSDP",void 0),W(this,"initialOffer",void 0),W(this,"transportEventReceiver",void 0),W(this,"statsFilter",void 0),W(this,"extension",{useXR:$("USE_XR")}),W(this,"localCapabilities",void 0),W(this,"remoteCodecs",void 0),W(this,"localCandidateCount",0),W(this,"allCandidatesReceived",!1),W(this,"isPreallocation",!1),W(this,"preMediaMap",new Map),W(this,"dataStreamChannelMap",new Map),W(this,"establishPromise",void 0),W(this,"recoveredDataChannelIds",[]),W(this,"currentDataChannelId",1),W(this,"supportAV1RtpSpec",!1),W(this,"mutex",void 0),W(this,"qualityLimitationReason",Fm.NONE),W(this,"isFirstConnected",!1),this.store=s,this.forceTurn=c5(t),this.mutex=new Pr("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Gd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=O0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Rs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,s){if(this.remoteCodecs=s,!this.remoteSDP)return void A.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(t,s,this.store.codec)){let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else A.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let c=$c(a.sdp),d=await DU({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:$("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:$("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=pE(d),this.initialOffer=a,$("ENABLE_SVC")&&this.store.codec=="av1"){let p=await async function(){try{let f=new RTCPeerConnection;f.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Mv.L1T3}]});let _=await f.createOffer();if(!_.sdp)return void f.close();let v=Sn(_.sdp).mediaDescriptions[0];if(!v)return;let b=v.attributes.extmaps.find(w=>w.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return f.close(),b}catch{return}}();var t;p&&(this.supportAV1RtpSpec=!0,(t=d.send)===null||t===void 0||t.videoExtensions.push(p))}let h;return a.sdp&&kU(a.sdp)&&(h=bs(d),(s=h).send&&(Eh(ze.VIDEO,s.send.videoExtensions),Eh(ze.AUDIO,s.send.audioExtensions)),s.recv&&(Eh(ze.VIDEO,s.recv.videoExtensions),Eh(ze.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(Eh(ze.VIDEO,s.sendrecv.videoExtensions),Eh(ze.AUDIO,s.sendrecv.audioExtensions))),Ka(Ka({},c),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new _e(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&kU(this.initialOffer.sdp)&&(s=t.rtpCapabilities,a=this.localCapabilities,s.send&&(dE(ze.VIDEO,s.send.videoExtensions,a.send.videoExtensions),dE(ze.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(dE(ze.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),dE(ze.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return bs(this._localCapabilities)}get rtpCapabilities(){return bs(this._rtpCapabilities)}get candidates(){return bs(this._candidates)}get iceParameters(){return bs(this._iceParameters)}get dtlsParameters(){return bs(this._dtlsParameters)}constructor(f){let _=arguments.length>1&&arguments[1]!==void 0&&arguments[1],v=arguments.length>2&&arguments[2]!==void 0&&arguments[2];W(this,"sessionDesc",void 0),W(this,"_localCapabilities",void 0),W(this,"_rtpCapabilities",void 0),W(this,"_candidates",void 0),W(this,"_originCandidates",void 0),W(this,"_iceParameters",void 0),W(this,"_isUseExtmapAllowMixed",void 0),W(this,"_isUseLocalCodecs",void 0),W(this,"_dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname",void 0),W(this,"useLocalCodecsMids",[]),W(this,"preloadSsrcs",[]),W(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=_,this._isUseLocalCodecs=v,f=bs(f);let{iceParameters:b,dtlsParameters:w,candidates:T,rtpCapabilities:U,setup:k,localCapabilities:F,cname:K}=f;this._rtpCapabilities=U,this._candidates=T,this._originCandidates=bs(T),this._iceParameters=b,this._dtlsParameters=w,this._localCapabilities=F,this.setup=k,this.cname=K,[this.sessionDesc]=this.updateRemoteRTPCapabilities(U),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(f){return f.length===this.preloadSsrcs.length&&f.every(_=>{var v;return ke(v=this.preloadSsrcs).call(v,_)})}preloadRemoteMedia(f){let _=0,v=[],b=[];for(;f>0;){let w=[LC({ssrcId:EE+_},$("USE_SUB_RTX")?{rtx:EE+_+1}:{})],T="".concat(EE+_,"_").concat(MC+_),{ssrcs:U,ssrcGroups:k}=Jm(w,this.cname,$("SYNC_GROUP")?T:void 0),F=this.preCreateOrRecycleSendMedia("video",U,k,void 0),K=[{ssrcId:MC+_}],Y="".concat(EE+_,"_").concat(MC+_),{ssrcs:X,ssrcGroups:re}=Jm(K,this.cname,$("SYNC_GROUP")?Y:void 0),te=this.preCreateOrRecycleSendMedia("audio",X,re,void 0);f--,_+=2,v.push(F,te),b.push(U[0].ssrcId,X[0].ssrcId)}return this.useLocalCodecsMids.push(...v),this.preloadSsrcs=b,{mids:v,preSSRCs:b,isAvailable:!0}}preCreateOrRecycleSendMedia(f,_,v,b){let w=this.rtpCapabilities.send.videoCodecs,T=this._isUseLocalCodecs||w.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;A.debug("create or recycle send media without remote rtp capabilities, ssrcs ",_[0].ssrcId);let U=f===ze.VIDEO?T.videoCodecs:T.audioCodecs,k=f===ze.VIDEO?T.videoExtensions:T.audioExtensions;this.currentMidIndex+=1;let F="".concat(this.currentMidIndex),K={media:{mediaType:f,port:vE,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(Y=>Y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:k,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(F)}};return K=this.mungSendMediaDesc(K,b),this.sessionDesc.mediaDescriptions.push(K),this.updateBundleMids(),F}toString(){return Gc(this.sessionDesc)}send(f,_,v,b){let{ssrcs:w,ssrcGroups:T}=Jm(_,this.cname,$("SYNC_GROUP")?v:void 0),U=this.findPreloadMediaDesc(w);if(U){if(Rs()&&this.firefoxSsrcMidMap.set(w[0].ssrcId,U.attributes.mid),b&&(b.twcc||b.remb)){let k=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[k]=this.mungSendMediaDesc(U,b),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{let k=this.findAvailableMediaIndex(f,w),F;return k===-1||k===1&&(Tr()||function(){let K=Lt();return!(K.name!==Wt.CHROME||!K.osVersion)&&Number(K.version)<=90}()||$("ENABLE_ENCODED_TRANSFORM")&&sc())||k===0&&!function(K){let Y=Lt();return!(Y.name!==Wt.FIREFOX||!Y.osVersion)&&Number(Y.version)===K}(138)&&$("USE_SUB_RTX")||nL()?(F=this.createOrRecycleSendMedia(f,w,T,"sendonly",b),this.updateBundleMids()):(F=bs(this.sessionDesc.mediaDescriptions[k]),F.attributes.direction="sendonly",F.attributes.ssrcs=w,F.attributes.ssrcGroups=T,this.sessionDesc.mediaDescriptions[k]=this.mungSendMediaDesc(F,b)),Rs()&&this.firefoxSsrcMidMap.set(w[0].ssrcId,F.attributes.mid),{mid:F.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:f,needExchangeSDP:_}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:f.attributes.mid,needExchangeSDP:_}}batchSend(f){let _=f.map(w=>{let{kind:T,ssrcMsg:U,mslabel:k}=w;return this.send(T,U,k)}),v=[],b=!1;return _.forEach(w=>{let{mid:T,needExchangeSDP:U}=w;U&&(b=!0),v.push(T)}),{mids:v,needExchangeSDP:b}}stopSending(f){let _=this.sessionDesc.mediaDescriptions.filter(v=>v.attributes.mid&&f.indexOf(v.attributes.mid)!==-1);if(_.length!==f.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");_.forEach(v=>{v.attributes.mid==="0"||Rs()||nL()?v.attributes.ssrcs=[]:(v.attributes.ssrcs=[],v.attributes.direction="inactive",v.media.port="0")}),this.updateBundleMids()}mute(f){let _=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===f);if(!_)throw new Error("mediaDescription not found with ".concat(f," in remote SDP when calling RemoteSDP.mute."));_.attributes.direction="inactive"}unmute(f){let _=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===f);if(!_)throw new Error("mediaDescription not found with ".concat(f," in remote SDP when calling RemoteSDP.unmute."));_.attributes.direction="sendonly"}muteRemote(f){let _=this.sessionDesc.mediaDescriptions.filter(v=>ke(f).call(f,v.attributes.mid||""));if(_.length!==f.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_.forEach(v=>{v.attributes.direction="inactive"})}unmuteRemote(f){let _=this.sessionDesc.mediaDescriptions.filter(v=>ke(f).call(f,v.attributes.mid||""));if(_.length!==f.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_.forEach(v=>{v.attributes.direction="recvonly"})}receive(f,_,v,b){f.forEach((w,T)=>{this.createOrRecycleRecvMedia(w,[],"recvonly",_,v,b[T])}),this.updateBundleMids()}stopReceiving(f){let _=this.sessionDesc.mediaDescriptions.filter(v=>f.indexOf(v.attributes.mid)!==-1);if(_.length!==f.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");_.forEach(v=>{v.media.port="0",v.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(f){let _=this.sessionDesc||Sn((v=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(v?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var v;this._rtpCapabilities=f;let b=!1,w=this.rtpCapabilities.send,T=this.localCapabilities.send,U=this.localCapabilities.recv,k=U.videoCodecs,F=U.audioCodecs,K=U.videoExtensions,Y=U.audioExtensions;for(let Z of _.mediaDescriptions){var X;if(Z.attributes.direction!=="sendonly"||typeof Z.attributes.mid!="string"||!ke(X=this.useLocalCodecsMids).call(X,Z.attributes.mid)){if(b=!0,Z.attributes.iceUfrag=this._iceParameters.iceUfrag,Z.attributes.icePwd=this._iceParameters.icePwd,Z.attributes.fingerprints=this._dtlsParameters.fingerprints,Z.attributes.candidates=this._candidates,Z.attributes.setup=this.setup,Z.media.mediaType==="application"&&(Z.attributes.sctpPort="5000"),Z.media.mediaType==="video")if(this._isUseLocalCodecs&&Z.attributes.direction==="sendonly"){var re;Z.media.fmts=k.map(xe=>xe.payloadType.toString(10)),Z.attributes.payloads=k,Z.attributes.extmaps=K;let le=Z.attributes.mid;typeof le!="string"||ke(re=this.useLocalCodecsMids).call(re,le)||this.useLocalCodecsMids.push(le)}else if(w.videoCodecs.length===0){let le=T.videoCodecs.filter(xe=>{var Ce,je;return(Ce=xe.rtpMap)===null||Ce===void 0?void 0:ke(je=Ce.encodingName.toLowerCase()).call(je,"vp8")})||[T.videoCodecs[0]];Z.media.fmts=le.map(xe=>xe.payloadType.toString(10)),Z.attributes.payloads=le,Z.attributes.extmaps=[]}else Z.media.fmts=w.videoCodecs.map(le=>le.payloadType.toString(10)),Z.attributes.payloads=w.videoCodecs,Z.attributes.extmaps=w.videoExtensions;if(Z.media.mediaType==="audio")if(this._isUseLocalCodecs&&Z.attributes.direction==="sendonly"){var te;Z.media.fmts=F.map(xe=>xe.payloadType.toString(10)),Z.attributes.payloads=F,Z.attributes.extmaps=Y;let le=Z.attributes.mid;typeof le!="string"||ke(te=this.useLocalCodecsMids).call(te,le)||this.useLocalCodecsMids.push(le)}else if(w.audioCodecs.length===0){let le=T.audioCodecs.filter(xe=>{var Ce,je;return(Ce=xe.rtpMap)===null||Ce===void 0?void 0:ke(je=Ce.encodingName.toLowerCase()).call(je,"opus")})||[T.audioCodecs[0]];Z.media.fmts=le.map(xe=>xe.payloadType.toString(10)),Z.attributes.payloads=le,Z.attributes.extmaps=[]}else Z.media.fmts=w.audioCodecs.map(le=>le.payloadType.toString(10)),Z.attributes.payloads=w.audioCodecs,Z.attributes.extmaps=w.audioExtensions,xh(Z)}}return this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1,[this.sessionDesc,b]}updateCandidates(f){let _=this._originCandidates.filter(b=>b.transport==="udp"),v=[];if(_.forEach(b=>{v.push(LC(LC({},b),{},{foundation:"tcpcandidate",priority:Number(b.priority)-1+"",transport:"tcp",port:Number(b.port)+90+""}))}),_.length!==0){switch(f){case Mr.TCP_RELAY:this._candidates=v;break;case Mr.UDP_TCP_RELAY:case Mr.RELAY:this._candidates=[..._,...v];break;default:this._candidates=_}for(let b of this.sessionDesc.mediaDescriptions)b.attributes.candidates=this.candidates}}restartICE(f){f=bs(f),this._iceParameters=f,this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.iceUfrag=f.iceUfrag,_.attributes.icePwd=f.icePwd})}predictReceivingMids(f){let _=[];for(let v=0;v<f;v++)_.push((this.currentMidIndex+v+1).toString(10));return _}findAvailableMediaIndex(f,_){return this.sessionDesc.mediaDescriptions.findIndex(v=>{let b=v.media.mediaType===f&&v.media.port!=="0"&&(v.attributes.direction==="sendonly"||v.attributes.direction==="sendrecv")&&v.attributes.ssrcs.length===0;if(Rs()){if(b){let w=this.firefoxSsrcMidMap.get(_[0].ssrcId);return!(w||v.attributes.mid!=="0"&&v.attributes.mid!=="1")||!(!w||w!==v.attributes.mid)}return!1}return b})}createOrRecycleDataChannel(){for(let v of this.sessionDesc.mediaDescriptions)if(v.media.mediaType==="application")return{mediaDesc:v,needExchangeSDP:!1};this.currentMidIndex+=1;let f="".concat(this.currentMidIndex),_={media:{mediaType:"application",port:vE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(f),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(_),{mediaDesc:_,needExchangeSDP:!0}}createOrRecycleRecvMedia(f,_,v,b,w,T){let U=f._mediaStreamTrack.kind,k=this.rtpCapabilities.recv,F=Qm(U,k,this.localCapabilities.send,U===ze.VIDEO?b:w),K=U===ze.VIDEO?k.videoExtensions:k.audioExtensions;this.currentMidIndex+=1;let Y="".concat(this.currentMidIndex),X={media:{mediaType:U,port:vE,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(te=>te.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:K,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:v,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};X=this.mungRecvMediaDsec(X,f,T);let re=this.findFirstClosedMedia(U);if(re){let te=this.sessionDesc.mediaDescriptions.indexOf(re);this.sessionDesc.mediaDescriptions[te]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}updateRemoteDtlsParameters(f){let _=new Set(this._dtlsParameters.fingerprints.map(w=>w.fingerprint)),v=new Set(f.map(w=>w.fingerprint)),b=!1;_.size!==v.size&&(b=!0);for(let w of _)v.has(w)||(b=!0);return b}updateRemoteCodec(f,_,v){let b=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(X=>X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||"").filter(X=>{var re;return ke(re=Object.keys(Vm)).call(re,X)}))],w=new Set(_);if(b.every(X=>w.has(X)))return A.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(_)),!1;let T=this._rtpCapabilities.recv.videoCodecs.filter(X=>_.some(re=>{var te;return ke(te=X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||"").call(te,re)}));if(T.length===0)return A.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(b," codecs: ").concat(_)),!1;let U=[...new Set(T.map(X=>X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||""))],k;if(A.debug("updateRemoteCodec, from ".concat(b," to ").concat(U)),f.length===0)k=this.sessionDesc.mediaDescriptions.filter(X=>X.media.mediaType==="video"&&X.attributes.direction==="recvonly");else if(k=this.sessionDesc.mediaDescriptions.filter(X=>X.attributes.mid&&X.media.mediaType==="video"&&ke(f).call(f,X.attributes.mid)&&X.attributes.direction==="recvonly"),k.length!==f.length)return A.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(f,", codecs: ").concat(_)),!1;if($("USE_PUB_RTX")||$("USE_SUB_RTX")){let X=Xc(T,this.rtpCapabilities.recv.videoCodecs);T.push(...X)}this._rtpCapabilities.recv.videoCodecs=T;let F=this.localCapabilities.send,K=this.rtpCapabilities.recv,Y=Qm(ze.VIDEO,K,F,v);return k.forEach(X=>{let re=Y.map(te=>te.payloadType.toString(10));A.debug("updateRemoteCodec mid: ".concat(X.attributes.mid,", from"),X.attributes.payloads,"to",Y),X.attributes.payloads=Y,X.media.fmts=re}),!0}createOrRecycleSendMedia(f,_,v,b,w){let T=this.rtpCapabilities.send.videoCodecs,U=this._isUseLocalCodecs||T.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,k=f===ze.VIDEO?U.videoCodecs:U.audioCodecs,F=f===ze.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;let K="".concat(this.currentMidIndex),Y={media:{mediaType:f,port:vE,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(re=>re.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};Y=this.mungSendMediaDesc(Y,w);let X=this.findFirstClosedMedia(f);if(X){let re=this.sessionDesc.mediaDescriptions.indexOf(X);this.sessionDesc.mediaDescriptions[re]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(f=>f.media.port!=="0").map(f=>f.attributes.mid)}mungRecvMediaDsec(f,_,v){let b=bs(f);return wC(b),yh(b,_),SC(b,_),AU(b),hE(b,v,this.localCapabilities.send),b}mungSendMediaDesc(f,_){let v=bs(f);return hE(v,_,this.localCapabilities.recv),xh(v),v}updateRecvMedia(f,_){let v=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===f);if(v!==-1){let b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],_);this.sessionDesc.mediaDescriptions[v]=b}}bumpMid(f){this.currentMidIndex+=f}findFirstClosedMedia(f){return this.sessionDesc.mediaDescriptions.find(_=>Rs()?_.media.port==="0"&&_.media.mediaType===f:_.media.port==="0")}findPreloadMediaDesc(f){return this.sessionDesc.mediaDescriptions.find(_=>{var v;return((v=_.attributes)===null||v===void 0||(v=v.ssrcs[0])===null||v===void 0?void 0:v.ssrcId)===f[0].ssrcId})}getSSRC(f){var _;return(_=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===f))===null||_===void 0?void 0:_.attributes.ssrcs}}(Ka(Ka({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!$("ENABLE_PRE_SUB_WITH_PRE_PC")||!$("PRE_USE_LOCAL_CODECS"))&&V0(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let c=this.remoteSDP.toString(),d=jU(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});let p=this.peerConnection.getTransceivers()[0];if(p!=null&&p.receiver&&this.tryBindTransportEvents(p.receiver),V0(this.store))if(t.preallocation&&$("ENABLE_PRE_SUB_WITH_PRE_PC")){let f=$("PRE_SUB_NUM"),{mids:_,preSSRCs:v}=this.remoteSDP.preloadRemoteMedia(f);await Jc(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(v)),this.presetMedia(_,v)}else{let{preSSRCs:f=[]}=t,_=f.map(b=>b.ssrcMsg[0].ssrcId);if(f.length===0)return;let{mids:v}=this.remoteSDP.batchSend(f.map(b=>Object.assign({},b)));await Jc(this.peerConnection,this.remoteSDP,this.extension),A.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(_)),this.presetMedia(v,_)}}catch(c){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}presetMedia(t,s){t.forEach((a,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&a===d.mid&&d.receiver.track){let h=d.receiver.track,p;h.kind==="video"&&$("ENABLE_PRE_RENDER")&&(p=new Z0({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(os(5,""))},!0),p.updateVideoTrack(h),p.onFirstVideoFrameRender=()=>{var f;let _=this.preMediaMap.get(s[c]);_&&(_.firstVideoRender=Date.now()),(f=this.onFirstVideoRender)===null||f===void 0||f.call(this,s[c])},p.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[c],{mid:a,track:h,player:p,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1,{rtpCapabilities:a}=t;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||h}let{preSSRCs:c=[]}=t,d=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){let h=[],p=[];if(Array.from(this.preMediaMap.entries()).every(f=>{let[_,{mid:v,player:b,track:w}]=f;return h.push(v),p.push(_),this.preMediaMap.delete(_),b&&b.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await Jc(this.peerConnection,this.remoteSDP,this.extension),A.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(p)),Ze.reportApiInvoke(this.store.sessionId,{name:ks.PRELOAD_MEDIA_FAILED,options:[c,p],tag:xs.TRACER}).onSuccess()),c.length>0){let{mids:f}=this.remoteSDP.batchSend(c.map(_=>Object.assign({},_)));await Jc(this.peerConnection,this.remoteSDP,this.extension),A.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(f,d)}}s?(await Jc(this.peerConnection,this.remoteSDP,this.extension),A.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):A.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(t,s,a){var c=this;return Ai(function*(){let d=yield Ut(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let h=[],p=lE();t.forEach(F=>{let K=c.peerConnection.addTransceiver(F._mediaStreamTrack,Ka({direction:"sendonly"},F.trackMediaType==="video"&&c.supportAV1RtpSpec&&p?{sendEncodings:[{scalabilityMode:p}]}:{}));h.push(K),F._updateRtpTransceiver(K)}),Rs()&&$("SIMULCAST")===!0&&(yield Ut(c.applySimulcastForFirefox(h,t)));let f=yield Ut(c.peerConnection.createOffer()),_=c.remoteSDP.predictReceivingMids(t.length),v=c.mungSendOfferSDP(f.sdp,t,_),b=Sn(v),w=_.map(F=>{let K=b.mediaDescriptions.find(Y=>Y.attributes.mid===F);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return TU(K,$("USE_PUB_RTX"))}),T;try{T=yield w}catch(F){T=[],c.remoteSDP.receive(t,s,a,T);let K=c.remoteSDP.toString();throw yield Ut(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ut(c.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield Ut(c.stopSending(_,!0)),F}c.remoteSDP.receive(t,s,a,T);let U=c.remoteSDP.toString(),k=c.logSDPExchange(v,"offer","local","send");return yield Ut(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ut(c.applySimulcastEncodings(h,t)),yield Ut(c.applySendEncodings(h,t)),k==null||k(U),yield Ut(c.peerConnection.setRemoteDescription({type:"answer",sdp:U})),h.map((F,K)=>{let Y=_[K];return{localSSRC:w[K],id:Y,transceiver:F}})}catch(h){throw h instanceof _e?h:new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(t);if(a&&a.readyState==="open")A.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,a)}s.forEach(d=>{d._updateOriginDataChannel(a)});let{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){let d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),A.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else A.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof _e?a:new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(t){try{let s=this.dataStreamChannelMap.get(t);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(t)}catch(s){throw s instanceof _e?s:new _e(q.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(t,s){let a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(f=>t.indexOf(f.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(f=>{var _;bE(this.id+f.mid,this),f.direction="inactive",(_=f.stop)===null||_===void 0||_.call(f)});let d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);let p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,s,a,c);h&&(await Jc(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let p=this.peerConnection.getTransceivers().find(f=>f.mid===d);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:d,transceiver:p}}catch(d){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(t);return a&&(await Jc(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{let d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(d=>{Array.from(this.preMediaMap.entries()).some(h=>{let[p,{mid:f,player:_}]=h;if(f===d)return this.preMediaMap.delete(p),_&&_.destroy(),!0})}),this.remoteSDP.stopSending(t);let s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let s=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let s=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,p)=>{h.direction="sendonly"});let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return Ai(function*(){let a=yield Ut(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=Vt().supportPCSetConfiguration,d=$("FORCE_TURN_TCP")||s.forceTurn;if(t===Mr.RELAY&&!c)return;if(c&&!d){let b=t===Mr.RELAY?"relay":"all",w=s.peerConnection.getConfiguration();w.iceTransportPolicy!==b&&(A.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(w.iceTransportPolicy,"] to [").concat(b,"]")),w.iceTransportPolicy=b,s.peerConnection.setConfiguration(w))}s.remoteSDP.updateCandidates(t);let h=yield Ut(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let p=$c(h.sdp),{remoteIceParameters:f}=yield p.iceParameters;s.remoteSDP.restartICE(f);let _=s.remoteSDP.toString(),v=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Ut(s.peerConnection.setLocalDescription(h)),v==null||v(_),yield Ut(s.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){A.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Mr.TCP_RELAY),await Jc(this.peerConnection,this.remoteSDP,this.extension)}catch(s){A.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(s=>{bE(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:a}=s;a&&a.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ka(Ka({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);let d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new _e(q.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,s){let a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(s)?Rs()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){let a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let s=t[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:Ka(Ka({},bo),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Ka(Ka({},bo),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var s;let a="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"",d=Ed(t.url||"");A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(d||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let s={iceServers:[]},a=t.cloudProxyServer||"disabled";return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&(km(t.turnServer.servers)?s.iceServers=t.turnServer.servers:$("NEW_TURN_MODE")&&s.iceServers&&a==="disabled"?($("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&s.iceServers.push(...Gd.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):s.iceServers.push(...Gd.newTurnServerConfigToIceServers(t.turnServer.servers)),$("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Gd.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Gd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&Vt().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(t){let s=[];return t.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(qc(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!$("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(t){let s=[];return t.forEach(a=>{let c=$("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(qc(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(qc(a.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(t){let s=t.transport;if(s){this.transportEventReceiver=t,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};let a=s.iceTransport;a&&(a.onstatechange=()=>{let c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){let{local:c,remote:d}=a.getSelectedCandidatePair()||{};if(c&&d){let h=c.address+":"+c.port,p=d.address+":"+d.port;A.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Ed(h)),", remote ").concat(JSON.stringify(Ed(p))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var a,c;if(s||(s=this.peerConnection.getSenders().find(k=>k.track===t._mediaStreamTrack)),!s)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return A.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vt().supportSetRtpSenderParameters)return A.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let d={},h={};switch(t._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}let p=function(k,F){return k.getTransceivers().find(K=>K.sender.track===F||K.receiver.track===F)}(this.peerConnection,t._mediaStreamTrack),f=Oie(t);if(function(k){var F;return!(!$("ENABLE_AG_ADAPTATION")||!(k instanceof Kv||ke(F=k._hints).call(F,is.CUSTOM_TRACK))||!$("FORCE_SUPPORT_AG_ADAPTATION")&&!(sL(14,0,!1)&&rL(17,4)||tL(14)&&f0(17,4,!0)))}(t)&&p&&s&&f&&this.getLocalVideoStats&&ke(a=["vp8","vp9"]).call(a,this.store.codec)){var _;let k=d.degradationPreference||(ke(_=t._hints).call(_,is.CUSTOM_TRACK)?$("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(F,K,Y,X,re,te){if(bE(F,Y),re(K),X!=="balanced"&&X!=="maintain-framerate"&&X!=="maintain-resolution")return;let Z=-1;i5(F,K);let le=window.setInterval(()=>{let Ce=xE.get(F);if(!$("ENABLE_AG_ADAPTATION")||!Ce)return bE(F,Y),void re(K);let je=te();if(je.sendPackets>0&&je.OutgoingAvailableBandwidth>0){if(Z===-1)return void(Z=Date.now());if(Date.now()-Z<1e3)return;let wt=je.sendFrameRate,Ct=je.OutgoingAvailableBandwidth,[mt,Yt]=zae(F,wt,Ct,Ce.adaptationConfig,K,X);Yt&&(Y.qualityLimitationReason=Yt),mt&&Ce.adaptationConfig.scale!==mt.scale&&(A.debug("[".concat(F,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(wt,", bwe ").concat(Ct,", switch from ").concat(Ce.adaptationConfig.scale," to ").concat(mt.scale," ")),Ce.adaptationConfig=FC(FC({},Ce.adaptationConfig),mt),re(mt))}},$("CHECK_LOCAL_STATS_INTERVAL")),xe=FC({},K);xE.set(F,{timer:le,adaptationConfig:xe,originConfig:K,adaptationFunc:re}),A.debug("[".concat(F,"] start adaptation, originConfig: ").concat(JSON.stringify(K),", degradationPreference: ").concat(X))})(this.id+p.mid,f,this,k,F=>{s&&this.updateAdaptation(s,F)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var v;let{bitrateMax:k,frameRate:F,scaleResolutionDownBy:K}=t._encoderConfig;k&&(h.maxBitrate=1e3*k),(ke(v=t._hints).call(v,is.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(F&&(h.maxFramerate=Hn(F)),K&&K>=1&&(h.scaleResolutionDownBy=K))}let{maxFramerate:b}=$("ENCODER_CONFIG_LIMIT");if(b&&typeof b=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,b):b),$("DSCP_TYPE")&&rc()){var w;let k=$("DSCP_TYPE");ke(w=["very-low","low","medium","high"]).call(w,k)&&(h.networkPriority=k)}let T=s.getParameters(),U=(c=T.encodings)===null||c===void 0?void 0:c[0];Rs()&&!U&&(d.encodings=[h]),U&&Object.assign(U,h),Object.assign(T,d),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(T.encodings))),await s.setParameters(T),await async function(k,F,K){try{var Y;if(!Vt().supportSetRtpSenderParameters||!function(le){return le==="vp9"||le==="av1"}(k)||!$("ENABLE_SVC"))return;let X={},re={},te=F.getParameters(),Z=(Y=te.encodings)===null||Y===void 0?void 0:Y[0];re.scalabilityMode=lE(K),Z&&Object.assign(Z,re),Object.assign(te,X),await F.setParameters(te),A.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(te.encodings)))}catch(X){A.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",X)}}(this.store.codec,s,$("SVC_MODE"))}async updateAdaptation(t,s){var a,c;if(!t)return A.debug("[updateAdaptation] no rtpSender found");if(!Vt().supportSetRtpSenderParameters)return A.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let d={},{bitrateMax:h,frameRate:p,scaleResolutionDownBy:f}=s;h&&(d.maxBitrate=1e3*h),p&&(d.maxFramerate=Hn(p)),f&&f>=1&&ke(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=f);let _=t.getParameters(),v=(c=_.encodings)===null||c===void 0?void 0:c[0];v&&Object.assign(v,d),Object.assign(_,{});try{await t.setParameters(_),A.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(_.encodings)))}catch(b){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?A.debug("[updateAdaptation] peerConnection not connected}"):A.debug("[updateAdaptation] updateRtpSenderEncodings failed",b):A.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,s){try{if(!Vt().supportSetRtpSenderParameters||t.length!==s.length)return;for(let a=0;a<t.length;a++){let c=t[a],d=s[a];d instanceof hs&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,a){let c=Sn(t);return s.forEach((d,h)=>{let p=a[h],f=c.mediaDescriptions.find(_=>_.attributes.mid===p);f&&(yh(f,d),IU(f,d,this.store.codec))}),Gc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let f=0;f<t.length;f++){var a,c,d,h,p;let _=t[f],v=s[f];if(v instanceof hs&&!ke(a=v._hints).call(a,is.LOW_STREAM)&&(c=v._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=v._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=v._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){let b={},w={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];let T=_.sender.getParameters();await _.sender.setParameters(Object.assign(T,b))}}}async applySimulcastEncodings(t,s){if(!Rs()&&t.length===s.length)for(let a=0;a<t.length;a++){let c=s[a];if(c instanceof hs&&this.isVP8Simulcast(c)){let d=t[a],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];let f=d.sender.getParameters();await d.sender.setParameters(Object.assign(f,h))}}}isVP8Simulcast(t){var s,a,c,d,h;return!!(t instanceof hs&&$("SIMULCAST")&&this.store.codec==="vp8"&&!ke(s=t._hints).call(s,is.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,s,a,c){if($("SDP_LOGGING"))return A.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),t),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let s=this.remoteSDP.getSSRC(t);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(t){if(Vt().supportPCSetConfiguration){let s=Gd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}t.isPreallocation&&(this.isPreallocation=!0)}},Je(Mt.prototype,"updateRemoteRTPCapabilities",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteRTPCapabilities"),Mt.prototype),Je(Mt.prototype,"connect",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"connect"),Mt.prototype),Je(Mt.prototype,"updateRemoteConnect",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteConnect"),Mt.prototype),Je(Mt.prototype,"createDataChannels",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"createDataChannels"),Mt.prototype),Je(Mt.prototype,"receive",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"receive"),Mt.prototype),Je(Mt.prototype,"batchReceive",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"batchReceive"),Mt.prototype),Je(Mt.prototype,"stopReceiving",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"stopReceiving"),Mt.prototype),Je(Mt.prototype,"muteRemote",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"muteRemote"),Mt.prototype),Je(Mt.prototype,"unmuteRemote",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteRemote"),Mt.prototype),Je(Mt.prototype,"muteLocal",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"muteLocal"),Mt.prototype),Je(Mt.prototype,"unmuteLocal",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteLocal"),Mt.prototype),Je(Mt.prototype,"close",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),Je(Mt.prototype,"updateEncoderConfig",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"updateEncoderConfig"),Mt.prototype),Je(Mt.prototype,"updateSendParameters",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"updateSendParameters"),Mt.prototype),Je(Mt.prototype,"replaceTrack",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"replaceTrack"),Mt.prototype),Je(Mt.prototype,"updateAdaptation",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"updateAdaptation"),Mt.prototype),Je(Mt.prototype,"getRemoteSSRC",[fn],Object.getOwnPropertyDescriptor(Mt.prototype,"getRemoteSSRC"),Mt.prototype),Mt);function fn(e,t,s){let a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},s}function WC(e,t){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=Hn(t.width),a.height=Hn(t.height);let c=Hn(t.framerate||15);document.body.append(s),document.body.append(a);let d=e._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();let h=a.getContext("2d");if(!h)throw new de(q.UNEXPECTED_ERROR,"can not get canvas context");let p=Vt(),f=a.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0];f.canvas||(f.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){let v=s.videoWidth,b=s.videoHeight/v,w=a.width*b;Math.abs(w-a.height)>=2&&(A.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(w)),a.height=w)}h.drawImage(s,0,0,a.width,a.height),f.requestFrame&&f.requestFrame(),d!==e._mediaStreamTrack&&(d=e._mediaStreamTrack,s.srcObject=new MediaStream([d]))},a.stopCapture=q0(()=>a.startCapture&&a.startCapture(),c);let _=f.stop;return f.stop=()=>{_.call(f),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),A.debug("clean low stream renderer")},f}var d5=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(d5||{}),qa=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(qa||{}),vt=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(vt||{}),yr=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(yr||{}),gn=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(gn||{}),SE=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(SE||{});let xd=1e3,CE=6,sf=3,Yae=Math.max(CE,sf,60);function dt(e,t,s){s!=null&&Number.isFinite(s)&&(e[t]=Math.round(Math.max(0,s)))}function u5(e){let t={[gn.CONN_TYPE]:0,[gn.RTT]:e.rtt,[gn.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let s=e.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(t[gn.CONN_TYPE]=1),s==="tcp"&&(t[gn.CONN_TYPE]=3),s==="tls"&&(t[gn.CONN_TYPE]=4);break}case"srflx":t[gn.CONN_TYPE]=2;break;case"unknown":t[gn.CONN_TYPE]=5;break;default:t[gn.CONN_TYPE]=0}return t}function h5(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class p5 extends Cs{constructor(t){super(),W(this,"store",void 0),W(this,"uploadWRTCStatsTimer",void 0),W(this,"uploadOutboundDenoiserStatsTimer",void 0),W(this,"uploadExtStatsTimer",void 0),W(this,"uploadExtUsageStatsTimer",void 0),W(this,"uploadInboundExtStatsTimer",void 0),W(this,"requestStats",void 0),W(this,"requestTransportStats",void 0),W(this,"requestLocalMedia",void 0),W(this,"requestRemoteMedia",void 0),W(this,"requestAllTracks",void 0),W(this,"requestVideoIsReady",void 0),W(this,"requestUploadStats",void 0),W(this,"requestUpload",void 0),W(this,"uploadOutboundStarted",!1),W(this,"uploadInboundStarted",!1),W(this,"uploadTransportStarted",!1),W(this,"uploadBaseStatsStarted",!1),W(this,"uploadExtensionUsageStarted",!1),W(this,"lastRecvStats",void 0),W(this,"lastSendStats",void 0),W(this,"lastRefRecvStats",void 0),W(this,"lastRefSendStats",void 0),W(this,"lastNormalRecvStats",void 0),W(this,"lastNormalSendStats",void 0),W(this,"lastExtendStats",{}),W(this,"needUploadStats",{}),W(this,"needUploadRenderFreezeTime",!0),W(this,"lastUploadCompensateTime",-1),W(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let s=t%sf==0,a=t%CE==0,c=t%60==0,d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var p;let f={};if(this.uploadTransportStarted&&d){let v=this.getTransportStats(d,h,s);v&&(f.misc=[v])}if(this.uploadOutboundStarted&&d){let v=this.getOutboundStats(d,a?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,c);v&&(f.outbound=[v])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(t);let v=this.getInboundStats(h,a?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);v&&(f.inbound=v)}let _=(p=this.requestTransportStats)===null||p===void 0?void 0:p.call(this).connectState;_&&(Array.isArray(f.misc)?f.misc[0]&&f.misc[0].addition&&(f.misc[0].addition[SE.RTC_PEER_CONNECTION_STATE]=D0[_]):f.misc=[{addition:{[SE.RTC_PEER_CONNECTION_STATE]:D0[_]}}]),this.needUploadStats.sendType&&(Array.isArray(f.outbound)&&f.outbound[0]&&f.outbound[0].high&&(f.outbound[0].high[d5.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(f)}this.lastRecvStats=h,this.lastSendStats=d,a&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),s&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;let c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[SE.RTC_PEER_CONNECTION_STATE]:D0[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Yae+1&&(t=1)},xd)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let s=t%sf==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;let d=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let h={};if(this.uploadInboundStarted&&d){let p=this.requestRemoteMedia()||[],f=[];p.forEach(_=>{let[v,b]=_,w={peer:v.uid};if(v._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(v._videoSSRC)&&b.has(ze.VIDEO)&&v.videoTrack){let T=function(U,k,F){if(!k.videoRecv.find(Y=>Y.ssrc===U))return;let K={};if(F&&F._player){let Y=F._player,{renderFreezeAccTime2:X,videoElementStatus:re}=Y;if(Co.visibility==="visible"&&re===kr.PLAYING&&Vt().supportRequestVideoFrameCallback){let te=Math.min(6e3,X);Y.renderFreezeAccTime2=Math.max(0,X-te),dt(K,qa.Video_Render_Freeze_Time_Render2,te),$("USE_NEW_RENDER_FREEZE_TIME")&&dt(K,qa.Video_Render_Freeze_Time_Render,te)}}return K}(v._videoSSRC,d,v.videoTrack);T&&(w.video=T)}w.video&&f.push(w)}),f.length>0&&(h.inbound=f,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,s,a){if(!this.requestStats)return;if(!a)return t.rtt==null?void 0:{addition:{[gn.RTT]:t.rtt,[gn.CONN_TYPE]:void 0,[gn.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let c=u5(t);if(this.store.useP2P){if(s){let d=u5(s);c[gn.CONN_TYPE]+=d[gn.CONN_TYPE]<<3}c[gn.CONN_TYPE]+=110}else c[gn.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(t,s,a,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;let h=this.requestLocalMedia();if(!h||h.length===0)return;let p,f,_;return h.forEach(v=>{let[b,{track:w,ssrcs:T}]=v;switch(b){case Ie.LocalVideoLowTrack:case Ie.LocalVideoTrack:if(b===Ie.LocalVideoTrack){var U;let k=function(X,re,te,Z,le,xe){let Ce=re.videoSend.find(mt=>mt.ssrc===X);if(!Ce)return;let je={},{sentFrame:wt,inputFrame:Ct}=Ce;if(Z&&(dt(je,qa.Video_Send_Qp_Sum,Ce.qpSumPerFrame),Ct&&wt)){let mt=Ct.frameRate,Yt=wt.frameRate;je[qa.Video_Send_Freeze]=function(zt,Ur){let we=!0;return we=!(zt<=5)&&(zt<=10?Ur<3:zt<=20?Ur<4:Ur<5),we}(mt,Yt)?1:0}if(le){switch(wt&&(dt(je,vt.Video_Send_Height,wt.height),dt(je,vt.Video_Send_Width,wt.width),dt(je,vt.Video_Send_Frame_Rate,wt.frameRate)),je[vt.Video_Send_Disabled]=te._originMediaStreamTrack&&!te._originMediaStreamTrack.enabled||te._mediaStreamTrack&&!te._mediaStreamTrack.enabled?1:0,Ce.adaptionChangeReason){case"none":je[vt.Video_Send_Adaptation]=0;break;case"cpu":je[vt.Video_Send_Adaptation]=1;break;case"bandwidth":je[vt.Video_Send_Adaptation]=2;break;case"other":je[vt.Video_Send_Adaptation]=3}let mt=0;Ce.adaptionChangeReason&&(mt+=h5(Ce.adaptionChangeReason)),re.qualityLimitationReason&&(mt+=h5(re.qualityLimitationReason)<<3),je[vt.Video_Send_Adaptation]=mt,je[vt.Video_Send_Player_Status]=z0[te._player?te._player.videoElementStatus:"uninit"],dt(je,vt.Video_Send_Nacks,Ce.nacksCount),dt(je,vt.Video_Send_Plis,Ce.plisCount),dt(je,vt.Video_Send_Firs,Ce.firsCount),dt(je,vt.Video_Send_Avg_Encode,Ce.avgEncodeMs),dt(je,vt.Video_Send_Huge_Frame_Sent,Ce.hugeFramesSent),dt(je,vt.Video_Send_Bytes_Retransmit,Ce.retransmittedBytesSent),dt(je,vt.Video_Send_Packages_Retransmit,Ce.retransmittedPacketsSent),dt(je,vt.Video_Send_Key_Frames_Encoded,Ce.keyFramesEncoded);let Yt=le.videoSend.find(zt=>zt.ssrc===X);if(Yt){let zt=xd*sf;Yt.timestamp&&Ce.timestamp&&(zt=Ce.timestamp-Yt.timestamp),Yt.packets!=null&&Ce.packets!=null&&dt(je,vt.Video_Send_Package_Rate,1e3*(Ce.packets-Yt.packets)/zt),Ce.packetsLost!=null&&Yt.packetsLost!=null&&dt(je,vt.Video_Send_Package_Lost,Ce.packetsLost-Yt.packetsLost),Yt.bytes!=null&&Ce.bytes!=null&&dt(je,vt.Video_Send_Bitrate,8*(Ce.bytes-Yt.bytes)/zt)}}return je}(T[0].ssrcId,t,w,s,a),F=w.__className__==="CameraVideoTrack"?3:ke(U=w._hints).call(U,is.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==F||d)&&(this.needUploadStats={sendType:F},this.lastExtendStats.sendType=F);let K=w&&function(X,re,te,Z){let le=re.videoSend.find(Ce=>Ce.ssrc===X);if(!le)return null;let xe={};if(Z){let Ce=le.inputFrame,je=Ce&&Ce.height||te.videoHeight||0,wt=Ce&&Ce.width||te.videoWidth||0,Ct=Ce&&Ce.frameRate||0;dt(xe,vt.Video_Capture_Height,je),dt(xe,vt.Video_Capture_Width,wt),dt(xe,vt.Video_Capture_Frame_Rate,Ct)}return xe}(T[0].ssrcId,t,w,!!a),Y=function(X,re){let te={};return re&&(dt(te,vt.Video_Send_Retransmit,X.bitrate.retransmit),dt(te,vt.Video_Send_Target_Encoded,X.bitrate.targetEncoded),dt(te,vt.Video_Send_Actual_Encoded,X.bitrate.actualEncoded),dt(te,vt.Video_Send_Transmit,X.bitrate.transmit),dt(te,vt.Video_Send_Bandwidth,X.sendBandwidth)),te}(t,!!a);f=Object.assign({},k,K,Y)}else _=function(k,F,K,Y,X){let re=F.videoSend.find(Z=>Z.ssrc===k);if(!re)return;let te={};if(Y){let Z=re.sentFrame;Z&&(dt(te,vt.Video_Send_Low_Height,Z.height),dt(te,vt.Video_Send_Low_Width,Z.width),dt(te,vt.Video_Send_Low_Frame_Rate,Z.frameRate));let le=Y.videoSend.find(xe=>xe.ssrc===k);if(le){let xe=xd*CE;le.timestamp&&re.timestamp&&(xe=re.timestamp-le.timestamp),le.packets!=null&&re.packets!=null&&dt(te,vt.Video_Send_Low_Package_Rate,1e3*(re.packets-le.packets)/xe),re.packetsLost!=null&&le.packetsLost!=null&&dt(te,vt.Video_Send_Low_Package_Lost,re.packetsLost-le.packetsLost),le.bytes!=null&&re.bytes!=null&&dt(te,vt.Video_Send_Low_Bitrate,8*(re.bytes-le.bytes)/xe)}}return te}(T[0].ssrcId,t,0,a);break;case Ie.LocalAudioTrack:p=w&&function(k,F,K,Y,X,re){let te=F.audioSend.find(le=>le.ssrc===k);if(!te)return;let Z={};if(X){Z[vt.Audio_Send_Disabled]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0;let le=100*K._source.getAccurateVolumeLevel(),xe=te.inputLevel;if(xe!=null){let je=Math.ceil(50*Math.log10(100*xe+1));dt(Z,vt.Audio_Send_Level,je)}dt(Z,vt.Audio_Capture_PCM_Level,le),dt(Z,vt.Audio_Send_AEC_Return_Loss,te.aecReturnLoss),dt(Z,vt.Audio_Send_AEC_Return_Loss_Enhancement,te.aecReturnLossEnhancement),dt(Z,vt.Audio_Send_Bytes_Retransmit,te.retransmittedBytesSent),dt(Z,vt.Audio_Send_Packages_Retransmit,te.retransmittedPacketsSent),Z[vt.Audio_Send_Freeze]=0;let Ce=X.audioSend.find(je=>je.ssrc===k);if(Ce){let je=xd*CE;Ce.timestamp&&te.timestamp&&(je=te.timestamp-Ce.timestamp),Ce.bytes!=null&&te.bytes!=null&&dt(Z,vt.Audio_Send_Bitrate,8*(te.bytes-Ce.bytes)/je),Ce.packets!=null&&te.packets!=null&&dt(Z,vt.Audio_Send_Package_Rate,1e3*(te.packets-Ce.packets)/je)}}return Z}(T[0].ssrcId,t,w,0,a)}}),{high:f,low:_,audio:p}}getInboundStats(t,s,a,c){if(!this.requestRemoteMedia)return;let d=this.requestRemoteMedia()||[],h=[];return d.forEach(p=>{let[f,_]=p,v={peer:f.uid};if(_.has(ze.VIDEO)&&f.videoTrack){let b=f._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(f._videoSSRC)||!1,w=f.videoTrack?function(T,U,k,F,K,Y,X,re){let te=U.videoRecv.find(mt=>mt.ssrc===T);if(!te)return;let Z={},{receivedFrame:le,outputFrame:xe,decodeFrameRate:Ce}=te;dt(Z,yr.Video_Render_Frame_Rate_Decode,Ce),te.framesRateFirefox&&dt(Z,yr.Video_Recv_Frame_Rate,te.framesRateFirefox),le&&dt(Z,yr.Video_Recv_Frame_Rate,le.frameRate),dt(Z,yr.Video_Recv_Frame_Dropped,te.framesDroppedCount),dt(Z,yr.Video_Recv_Bytes_Retransmit,te.retransmittedBytesReceived),dt(Z,yr.Video_Recv_Packages_Retransmit,te.retransmittedPacketsReceived),dt(Z,yr.Video_Recv_Packages_Discarded,te.packetsDiscarded),dt(Z,yr.Video_Recv_Avg_Decode,te.avgDecodeMs),dt(Z,yr.Video_Recv_Avg_Processing_Delay,te.avgProcessingDelayMs),dt(Z,yr.Video_Recv_Avg_Assembly_Time,te.avgFramesAssembledFromMultiplePacketsMs),dt(Z,yr.Video_Recv_Avg_Inter_Frame_Delay,te.avgInterFrameDelayMs),dt(Z,yr.Video_Recv_Key_Frames_Decoded,te.keyFramesDecoded);let je=re&&re.videoRecv.find(mt=>mt.ssrc===T);if(je){let mt=U.timestamp-re.timestamp||xd;te.packetsLost!=null&&je.packetsLost!=null&&dt(Z,yr.Video_Recv_Package_Lost,te.packetsLost-je.packetsLost),je.bytes!=null&&te.bytes!=null&&dt(Z,yr.Video_Recv_Bitrate,8*(te.bytes-je.bytes)/mt),je.packets!=null&&te.packets!=null&&dt(Z,yr.Video_Recv_Package_Rate,1e3*(te.packets-je.packets)/mt)}let wt=Y&&Y.videoRecv.find(mt=>mt.ssrc===T);if(wt&&(dt(Z,qa.Video_Recv_Qp_Sum,te.qpSumPerFrame),Z[qa.Video_Recv_Freeze]=F&&tf.isRemoteVideoFreeze(k,te,wt)?1:0),X){var Ct;let mt=X.videoRecv.find(zt=>zt.ssrc===T);le?(dt(Z,vt.Video_Recv_Height,le.height),dt(Z,vt.Video_Recv_Width,le.width)):k&&(dt(Z,vt.Video_Recv_Height,k._videoHeight||0),dt(Z,vt.Video_Recv_Width,k._videoWidth||0)),xe&&dt(Z,vt.Video_Recv_Frame_Rate_Output,xe.frameRate);let Yt=(Ct=k._player)===null||Ct===void 0?void 0:Ct.rendFrameRate.toFixed(0);if(Yt&&dt(Z,vt.Video_Render_Frame_Rate_Render,+Yt),dt(Z,vt.Video_Recv_Jitter_Buffer,te.jitterBufferMs),dt(Z,vt.Video_Recv_Current_Delay,te.currentDelayMs),dt(Z,vt.Video_Recv_Firs,te.firsCount),dt(Z,vt.Video_Recv_Nacks,te.nacksCount),dt(Z,vt.Video_Recv_Plis,te.plisCount),k){Z[vt.Video_Recv_Disabled]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1;let zt=k._player;if(zt){let{freezeTimeCounterList:Ur,renderFreezeAccTime:we,renderFreezeAccTime2:Le,videoElementStatus:Ke}=zt;if(Ur&&Ur.length>0&&dt(Z,qa.Video_Render_Freeze_Time,Ur.splice(0,1)[0]),K&&Co.visibility==="visible"&&Ke===kr.PLAYING&&Vt().supportRequestVideoFrameCallback){let Ne=Math.min(6e3,Le);zt.renderFreezeAccTime2=Math.max(0,Le-Ne),dt(Z,qa.Video_Render_Freeze_Time_Render2,Ne);let P=Math.min(6e3,we);zt.renderFreezeAccTime=Math.max(0,we-P),dt(Z,qa.Video_Render_Freeze_Time_Render,$("USE_NEW_RENDER_FREEZE_TIME")?Ne:P)}if(typeof te.totalFreezesDuration=="number"){let Ne=mt&&mt.totalFreezesDuration?te.totalFreezesDuration-mt.totalFreezesDuration:te.totalFreezesDuration;dt(Z,vt.Video_Render_Freeze_Duration,1e3*Ne)}}}if(Z[vt.Video_Recv_Player_Status]=z0[k._player?k._player.videoElementStatus:"uninit"],mt&&te.totalInterFrameDelay!==void 0&&te.totalSquaredInterFrameDelay!==void 0&&mt.totalInterFrameDelay!==void 0&&mt.totalSquaredInterFrameDelay!==void 0){let zt=te.totalInterFrameDelay-mt.totalInterFrameDelay,Ur=te.totalSquaredInterFrameDelay-mt.totalSquaredInterFrameDelay,we=te.framesDecodeCount-mt.framesDecodeCount,Le=zt/we*1e3,Ke=Math.round(1e3*Math.sqrt((Ur-Math.pow(zt,2)/we)/we));!isNaN(Ke)&&Le+Ke>Math.max(3*Le,Le+150)&&(Z[vt.Video_Recv_I_Frame_Delay]=Ke)}}return Z}(f._videoSSRC,t,f.videoTrack,b===!0,this.needUploadRenderFreezeTime,s,a,c):void 0;w&&(v.video=w)}if(_.has(ze.AUDIO)&&f.audioTrack){let b=f.audioTrack?function(w,T,U,k,F,K){let Y=T.audioRecv.find(Z=>Z.ssrc===w);if(!Y)return;let X={};dt(X,yr.Audio_Recv_Jitter,Y.jitterMs),dt(X,yr.Audio_Recv_Bytes_Retransmit,Y.retransmittedBytesReceived),dt(X,yr.Audio_Recv_Packages_Retransmit,Y.retransmittedPacketsReceived),dt(X,yr.Audio_Recv_Packages_Discarded,Y.packetsDiscarded),dt(X,yr.Audio_Recv_Avg_Processing_Delay,Y.avgProcessingDelayMs);let re=K&&K.audioRecv.find(Z=>Z.ssrc===w);if(re){let Z=xd;Y.packets!=null&&re.packets!=null&&dt(X,yr.Audio_Recv_Package_Rate,1e3*(Y.packets-re.packets)/Z),Y.packetsLost!=null&&re.packetsLost!=null&&dt(X,yr.Audio_Recv_Package_Lost,Y.packetsLost-re.packetsLost)}if(k){let{receivedFrames:Z,droppedFrames:le}=Y;Z!=null&&le!=null&&(X[qa.Audio_Recv_Freeze]=(te=Z)===0||100*le/te>20?1:0)}var te;if(F){let Z=100*U._source.getAccurateVolumeLevel(),le=Y.outputLevel;if(le!=null){let Ce=Math.ceil(50*Math.log10(100*le+1));dt(X,vt.Audio_Render_Level,Ce)}dt(X,vt.Audio_Recv_PCM_Level,Z),U&&(X[vt.Audio_Recv_Disabled]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),dt(X,vt.Audio_Recv_Jitter_Buffer,Y.jitterBufferMs),dt(X,vt.Audio_Recv_Current_Delay,Y.jitterBufferMs),X[vt.Audio_Recv_Player_Status]=z0[mn.getPlayerState(U.getTrackId())];let xe=F.audioRecv.find(Ce=>Ce.ssrc===w);if(xe){xe.bytes!=null&&Y.bytes!=null&&dt(X,vt.Audio_Recv_Bitrate,8*(Y.bytes-xe.bytes)/(xd*sf));let Ce=Y.concealedSamples-xe.concealedSamples;Ce>0&&dt(X,vt.Audio_Recv_Concealed_Samples,Ce);let je=Y.totalSamplesReceived-xe.totalSamplesReceived;je>0&&dt(X,vt.Audio_Recv_Total_Samples_Received,je);let wt=Y.freezeSamples80-xe.freezeSamples80;wt>0&&dt(X,vt.Audio_Render_Freeze_Samples_80ms,wt);let Ct=Y.freezeSamples200-xe.freezeSamples200;Ct>0&&dt(X,vt.Audio_Render_Freeze_Samples_200ms,Ct);let mt=Y.freezeMs80-xe.freezeMs80;dt(X,vt.Audio_Render_Freeze_Time_80ms,mt<0?0:mt);let Yt=Y.freezeMs200-xe.freezeMs200;dt(X,vt.Audio_Render_Freeze_Time_200ms,Yt<0?0:Yt)}}return X}(f._audioSSRC,t,f.audioTrack,s,a,c):void 0;b&&(v.audio=b)}(v.video||v.audio)&&h.push(v)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(s=>s instanceof Gm);if(t&&t._external.getDenoiserStats){let s=t._external.getDenoiserStats();s&&this.requestUpload(zm.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[s,a]=t;a.has(ze.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(ze.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let s=Date.now(),a={connectionInterval:$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s},c=[],d=this.requestAllTracks&&this.requestAllTracks()||[];for(let _ of d)!_.muted&&_.enabled&&(c=c.concat(await _.getProcessorUsage()));let h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[_,v]of h)v.has(ze.VIDEO)&&_.videoTrack&&(c=c.concat(await _.videoTrack.getProcessorUsage())),v.has(ze.AUDIO)&&_.audioTrack&&(c=c.concat(await _.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(_,v){let b={};for(let{id:k,value:F,level:K,direction:Y}of _){var w;let X=(w=v.get(k))!==null&&w!==void 0?w:0,re=F===2?X+$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:X;var T,U;v.set(k,re),b[k]?(F===2&&(b[k].value=F),K>b[k].level&&(b[k].level=K),Y==="remote"&&(b[k].remoteUidCount+=1),b[k].totalTs=(T=v.get(k))!==null&&T!==void 0?T:0):b[k]={value:F,level:K,remoteUidCount:Y==="local"?0:1,totalTs:(U=v.get(k))!==null&&U!==void 0?U:0}}return Object.keys(b).map(k=>{let{level:F,value:K,totalTs:Y}=b[k];return{id:k,level:F,value:K,totalTs:Y}})}(c,t);let p=Date.now(),f=p>s?p:s+1;this.requestUpload&&this.requestUpload(zm.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:f})},$("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let $ae=$("ICE_RESTART_INTERVAL"),TE=new Map,Ch=new Map,el=[Mr.UDP_TCP_RELAY,Mr.TCP_RELAY,Mr.RELAY],GC=$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vt().supportPCSetConfiguration;function m5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=TE.get(e.id);s&&(window.clearTimeout(s),TE.delete(e.id));let a=Ch.get(e.id);t&&a&&a.index===el.length-1&&(A.debug("[".concat(e.id,"] reset ICE restart policy")),Ch.delete(e.id))}function f5(e,t,s){if(TE.size===0&&Ch.size===0&&(Array.isArray($("RESTART_SEQUENCE"))&&$("RESTART_SEQUENCE").length>0&&!function(p,f){if(p.length!==f.length)return!1;for(let _=0;_<p.length;_+=1){let v=p[_];if(p.filter(b=>b===v).length!==f.filter(b=>b===v).length)return!1}return!0}(el,$("RESTART_SEQUENCE"))&&(el=$("RESTART_SEQUENCE").filter(p=>{var f;if(ke(f=Object.values(Mr)).call(f,p))return!0}),A.debug("use reconnection policy from config distribution, queues: ".concat(el.join(" => ")))),GC=$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vt().supportPCSetConfiguration),el.length===0)return void s();let a,{index:c=0,type:d}=Ch.get(e.id)||{};if(GC&&d===Mr.RELAY)return void s();let h=d&&c>=el.length-1;if(GC)d=Mr.RELAY;else{if(h)return void s();d?(c++,d=el[c]):(d=el[0],c=0)}A.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),t(d),Ch.set(e.id,{index:c,type:d}),a=window.setTimeout(()=>f5(e,t,s),$ae),TE.set(e.id,a)}var Rt;function g5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Ro(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?g5(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):g5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function _5(e){var t,s,a,c=2;for(typeof Symbol<"u"&&(s=n0,a=Symbol.iterator);c--;){if(s&&(t=e[s])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new NE(t.call(e));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function NE(e){function t(s){if(Object(s)!==s)return Be.reject(new TypeError(s+" is not an object."));var a=s.done;return Be.resolve(s.value).then(function(c){return{value:c,done:a}})}return NE=function(s){this.s=s,this.n=s.next},NE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?Be.resolve({value:s,done:!0}):t(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?Be.reject(s):t(a.apply(this.s,arguments))}},new NE(e)}let rf=(Rt=class extends Cs{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(nt.StateChange,t,this._state)}constructor(e,t){super(),W(this,"isPlanB",void 0),W(this,"store",void 0),W(this,"statsUploader",void 0),W(this,"connection",void 0),W(this,"localTrackMap",new Map),W(this,"remoteUserMap",new Map),W(this,"localDataChannels",[]),W(this,"remoteDataChannelMap",new Map),W(this,"pendingLocalTracks",[]),W(this,"pendingRemoteTracks",[]),W(this,"pendingLocalDataChannels",[]),W(this,"pendingRemoteDataChannels",[]),W(this,"statsCollector",void 0),W(this,"shouldForwardP2PCreation",void 0),W(this,"iceFailedCount",0),W(this,"dtlsFailedCount",0),W(this,"mutex",void 0),W(this,"_state",Xt.Disconnected),W(this,"_pcStatsUploadType",$("NEW_ICE_RESTART")?oc.FIRST_CONNECTION:oc.OLD_FIRST_CONNECTION),W(this,"_isStartRestartIce",!1),W(this,"_restartTimer",void 0),W(this,"_isTryConnecting",!1),W(this,"_iceError",null),W(this,"_forceTurn",!1),W(this,"_isWaitPcToRePub",!1),W(this,"handleMuteLocalTrack",async(s,a,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Xt.Connected)return void c(new _e(q.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();let p=h.find(_=>_[0]==="videoLowTrack");if(p){let _=p[1];this.store.enableInstantMuteRestore?(_.track._originMediaStreamTrack.enabled=!1,A.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):_.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?A.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(_=>{let[,{id:v}]=_;return v}));let f=this.createMuteMessage(h);await as(this,nt.RequestMuteLocal,f),a()}catch(h){c(h)}finally{d()}}),W(this,"handleUnmuteLocalTrack",async(s,a,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Xt.Connected)return void c(new _e(q.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();let p=h.find(_=>_[0]==="videoLowTrack");if(p){let _=p[1];if(this.store.enableInstantMuteRestore)_.track._originMediaStreamTrack.enabled=!0,A.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(_.track._originMediaStreamTrack.stop(),!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding){let v=s._mediaStreamTrack.clone();_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v}else{let v=WC(s,Lm(this,nt.RequestLowStreamParameter));_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v}await new Be((v,b)=>{this.handleReplaceTrack(_.track,v,b,!0)})}}this.store.enableInstantMuteRestore?A.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(_=>{let[,{id:v}]=_;return v}));let f=this.createUnmuteMessage(h);await as(this,nt.RequestUnmuteLocal,f),a()}catch(h){c(h)}finally{d()}}),W(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let f=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.connection||!f||f.track!==s||this.state!==Xt.Connected)return void a();let{id:_,track:v}=f;await this.connection.updateSendParameters(_,v),await this.connection.updateEncoderConfig(_,v),this.emit(nt.UpdateVideoEncoder,v),a()}catch(f){c(f)}finally{var p;(p=h)===null||p===void 0||p()}}),W(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let h=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Xt.Connected)return void a();let{id:p,track:f}=h;await this.connection.updateSendParameters(p,f),a()}catch(h){c(h)}finally{d()}}),W(this,"handleReplaceMixingTrack",async(s,a,c,d)=>{if(!this.connection||this.state!==Xt.Connected)return void a();let h=VC([s]),p;A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(p=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(_){c(_)}finally{var f;(f=p)===null||f===void 0||f()}}),W(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;A.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var p;let _=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:b}]=v;return s===b});if(!this.connection||!_||this.state!==Xt.Connected)return void a();if(await((p=this.connection)===null||p===void 0?void 0:p.replaceTrack(s,_[1].id)),this.isPlanB){let v=_[1];v.id=s._mediaStreamTrack.id,this.localTrackMap.set(_[0],v)}if(_[0]===Ie.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding){let v=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(v){let b=s._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=b,v.track._originMediaStreamTrack=b,await new Be((w,T)=>{this.handleReplaceTrack(v.track,w,T,!0)})}}a()}catch(_){c(_)}finally{var f;(f=h)===null||f===void 0||f()}}),W(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),W(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),W(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),W(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),W(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new p5(this.store),this.bindStatsUploaderEvents(),this.mutex=new Pr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Vt().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&rc(),this.shouldForwardP2PCreation=$("FORWARD_P2P_CREATION")&&Vt().supportPCSetConfiguration&&v0(),this.shouldForwardP2PCreation&&(this.connection=wE(this.store),this.emit(nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var s;this.state=Xt.New,this._forceTurn=c5(e),A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let a=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||a||t)&&((a||t)&&this.connection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=wE(this.store,e),this.emit(nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new _e(q.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=$("NEW_ICE_RESTART")?oc.FIRST_CONNECTION:oc.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new _e(q.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Xt.Connected){if(this.connection instanceof ki&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Ze.reportApiInvoke(this.store.sessionId,{name:ks.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:xs.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(nt.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Xt.Connected}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return ke(d=[Ie.LocalVideoLowTrack,Ie.LocalVideoTrack]).call(d,h)}),s=t.map(c=>{let[,{id:d}]=c;return d}),a=t.map(c=>{let[d]=c;return d});if(this.connection instanceof ki){if(Ze.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ke(e).call(e,this.store.codec)){let c=["vp9","vp8","h264"].find(d=>ke(e).call(e,d));c&&(this.store.codec=c,A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,e)}}async getEstablishParams(){var e;if(this.connection instanceof ki&&this.connection.peerConnectionState!=="closed"&&ke(e=[Xt.New,Xt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Xt.Connected){if(this.state===Xt.Disconnected)throw new _e(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(s=>{var a;ke(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(s=>{let a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(s=>{this.localDataChannels.push(s);let a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)}),e.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(e,t,s){var a=this;return Ai(function*(){let c=yield Ut(a.mutex.lock("From P2PChannel.publish"));try{var d;let h=a.connection&&ke(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==Xt.Connected||h){if(a.state===Xt.Disconnected)throw new _e(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(e);let f=e.filter(_=>a.pendingLocalTracks.indexOf(_)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(f),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,Fr.markPublishStart(a.store.clientId,a.store.pubId);let p=a.filterTobePublishedTracks(e,t,s);if(p.length===0)return void(yield Ut(a.tryToUnmuteAudio(e)));yield*Ev(_5(a.doPublish(a.connection,p)))}finally{c()}})()}doPublish(e,t){var s=this;return Ai(function*(){t.forEach(w=>{let{track:T,type:U}=w,k=Date.now();s.store.publish(T.getTrackId(),U===Ie.LocalAudioTrack?"audio":"video",k)}),s.bindLocalTrackEvents(t);let a=t.map(w=>{let{track:T}=w;return T}),c=yield Ut(e.send(a,s.store.codec,s.store.audioCodec)),d=(yield Ut(c.next())).value,h=s.createGatewayPublishMessage(t,d),p;try{p=yield h}catch(w){throw c.throw(w),(w==null?void 0:w.code)===q.WS_ABORT&&t.forEach(T=>{let{track:U}=T;s.pendingLocalTracks.indexOf(U)===-1&&s.pendingLocalTracks.push(U)}),s.unbindLocalTrackEvents(t),w}let f=s.mapPubResToRemoteConfig(h,p,a),_=(yield Ut(c.next(f))).value;if(s.state===Xt.Disconnected)throw new _e(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");$("ENABLE_VIDEO_SEI");let v=$("ENABLE_ENCODED_TRANSFORM"),b=$("ENABLE_AUDIO_METADATA");a.forEach(async w=>{let T=w.getRTCRtpTransceiver();if(!T||!v)return;let{interceptLocalVideoFrame:U,interceptLocalAudioFrame:k}=mE();w.trackMediaType===ze.VIDEO?await U(T.sender,w):w.trackMediaType===ze.AUDIO&&await k(T.sender,{metadata:b?()=>{let F=w.metadata.shift();return F&&F.value}:void 0})}),t.forEach(w=>{let{type:T}=w;s.statsCollector.addLocalStats(T)}),s.assignLocalTracks(t,_),s.statsUploader.startUploadOutboundStats(),t.forEach(w=>{let{track:T,type:U}=w,k=Date.now();s.store.publish(T.getTrackId(),U===Ie.LocalAudioTrack?"audio":"video",void 0,k)})})()}async updateVideoStreamParameter(e,t){let s=this.localTrackMap.get(t);if(!s||!this.connection)return;if(!(s.track instanceof hs))return A.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:a}=s,c=function(d,h){let p={};return d.height&&d.width&&(p.scaleResolutionDownBy=bC(d,h)),p.maxFramerate=d.framerate?Hn(d.framerate):void 0,p.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,p}(e,a);if(a._encoderConfig||(a._encoderConfig={}),t!==Ie.LocalVideoLowTrack||!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{let d=a._originMediaStreamTrack;if(!d.canvas)return A.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,p){let f=h.canvas;p.width&&(f.width=Hn(p.width)),p.height&&(f.height=Hn(p.height)),p.framerate&&(f.stopCapture&&f.stopCapture(),f.stopCapture=q0(()=>{!f.startCapture&&f.stopCapture&&f.stopCapture(),f.startCapture&&f.startCapture()},Hn(p.framerate)))})(d,e)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),A.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(e){var t=this;return Ai(function*(){if(!t.connection||t.state!==Xt.Connected)return;let s=yield Ut(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let c=t.localTrackMap.get(Ie.LocalVideoTrack);if(!c)throw new _e(q.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Ie.LocalVideoLowTrack))throw new _e(q.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let d=[{track:t.getLowVideoTrack(c.track,e),type:Ie.LocalVideoLowTrack}];if(yield*Ev(_5(t.doPublish(t.connection,d))),c.track.muted||!c.track.enabled){var a;let h=(a=t.localTrackMap.get(Ie.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield Ut(t.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(A.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Rr(this,nt.RequestRePublish,this.pendingLocalTracks),this.emit(nt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(A.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Rr(this,nt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:s,kind:a}=this.pendingRemoteTracks[t];(a!==ze.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==ze.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Rr(this,nt.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:s}of this.pendingRemoteTracks)await this.subscribe(t,s,s===ze.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:s}=t;this.emit(nt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Xt.Connected)return void e.forEach(a=>{let c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let s=t.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Xt.Connected)return void e.forEach(s=>{let a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(s=>{let a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Xt.Connected)return;let e=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[Ie.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let s=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[c,{track:d}]=a;return{type:c,track:d}})),t.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Xt.Connected)throw new _e(q.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let s=t.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(a.id))});if(s.length!==0)return await this.connection.createDataChannels(e.uid,s),s.forEach(a=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(e,new Map([[a.id,a]]));let d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:p,id:f}=h;return p.uid===e.uid&&f===a.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),s.map(a=>a.id)}async subscribe(e,t,s,a,c){var d;if(!this.connection||this.state!==Xt.Connected)throw new _e(q.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(e))!==null&&d!==void 0&&d.has(t))return;let h,p,f,_,v=this.connection.getPreMedia(s);if(v)A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),f=v.transceiver,h=v.track,p=v.mid,_=v.player,v.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:v.firstVideoRender});else if(c){let T=c.find(k=>{let{stream_type:F}=k;return F===t});if(!T)throw new _e(q.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let U=await this.connection.receive(t,T.ssrcs,String(e._uintid),T.attributes);this.connection instanceof ki&&(f=U.transceiver),h=U.track,p=U.id}else{let T=await this.connection.receive(t,[{ssrcId:s,rtx:a}],String(e._uintid),void 0);this.connection instanceof ki&&(f=T.transceiver),h=T.track,p=T.id}if(t===ze.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new hh(h,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new uh(h,e.uid,e._uintid,this.store,_),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Oi.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Oi.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),_?e._videoTrack.once(Oi.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Oi.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack)),f&&$("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:T,interceptRemoteAudioFrame:U}=mE();t==ze.VIDEO?await T(f.receiver,{onSei:$("ENABLE_VIDEO_SEI")&&(k=>{var F;return(F=e._videoTrack)===null||F===void 0?void 0:F._onSei(k)})}):t==ze.AUDIO&&await U(f.receiver,{enableTopn:!!$("ENABLE_AUDIO_TOPN"),enableMetadata:!!$("ENABLE_AUDIO_METADATA"),enablePts:!!$("ENABLE_AUDIO_PTS"),onMetadata:k=>{this.safeEmit(nt.AudioMetadata,k)},onPts:k=>{this.safeEmit(nt.AudioPts,k)}})}let b=this.remoteUserMap.get(e);b?b.set(t,p):this.remoteUserMap.set(e,new Map([[t,p]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let w=this.pendingRemoteTracks.findIndex(T=>{let{user:U,kind:k}=T;return U.uid===e.uid&&t===k});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(nt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Xt.Connected)throw new _e(q.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var d;let{user:h,mediaType:p}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(p))});let t=[],s=new Map;e.forEach(c=>{if(!this.connection)return;let d=this.connection.getPreMedia(c.ssrcId);if(d){let{track:h,mid:p,transceiver:f,player:_}=d;s.set(c.ssrcId,{track:h,id:p,transceiver:f,player:_})}else t.push(c)});let a=await this.connection.batchReceive(t.map(c=>{let{user:d,mediaType:h,ssrcId:p,rtxSsrcId:f}=c;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:f}],mslabel:String(d._uintid)}}));t.forEach((c,d)=>{s.set(c.ssrcId,a[d])});for(let{user:c,mediaType:d,ssrcId:h}of e){let p=s.get(h);if(!p)return void A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));let{track:f,id:_,transceiver:v,player:b}=p;if(v&&$("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:k}=mE();d==ze.VIDEO?await U(v.receiver,{onSei:$("ENABLE_VIDEO_SEI")&&(F=>{var K;return(K=c._videoTrack)===null||K===void 0?void 0:K._onSei(F)})}):d==ze.AUDIO&&await k(v.receiver,{enableTopn:!!$("ENABLE_AUDIO_TOPN"),enableMetadata:!!$("ENABLE_AUDIO_METADATA"),enablePts:!!$("ENABLE_AUDIO_PTS"),onMetadata:F=>{this.safeEmit(nt.AudioMetadata,F)},onPts:F=>{this.safeEmit(nt.AudioPts,F)}})}if(d===ze.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(f):(c._audioTrack=new hh(f,c.uid,c._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),v&&c._audioTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(f):(c._videoTrack=new uh(f,c.uid,c._uintid,this.store,b),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),v&&c._videoTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(c,c._videoTrack)),$("ENABLE_VIDEO_SEI")&&v){let{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:k}=mE();d==ze.VIDEO?await U(v.receiver,{onSei:F=>{var K;(K=c._videoTrack)===null||K===void 0||K._onSei(F)}}):d==ze.AUDIO&&await k(v.receiver)}let w=this.remoteUserMap.get(c);w?w.set(d,_):this.remoteUserMap.set(c,new Map([[d,_]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();let T=this.pendingRemoteTracks.findIndex(U=>{let{user:k,kind:F}=U;return k.uid===c.uid&&d===F});T!==-1&&(this.pendingRemoteTracks.splice(T,1),this.emit(nt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,s){let a=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:f}=h;return t!==void 0?p.uid===e.uid&&t===f:p.uid===e.uid});if(a.forEach(h=>{let p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),this.connection&&this.state===Xt.Connected||s||a.forEach(h=>{let{kind:p}=h;var f;if(p===ze.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(p===ze.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Xt.Connected)return;let c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:p}]=h;return p}));let d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[p,{kind:f}]=h;var _,v;if(f===ze.VIDEO&&p._videoSSRC&&((_=this.connection)===null||_===void 0||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),f===ze.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),s||((v=p._videoTrack)===null||v===void 0||v._destroy(),p._videoTrack=void 0);else if(f===ze.AUDIO){var b;this.unbindRemoteTrackEvents(p._audioTrack),!s&&((b=p._audioTrack)===null||b===void 0||b._destroy(),p._audioTrack=void 0)}}),d}async unsubscribeDataChannel(e,t){if(t.forEach(c=>{let d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;let s=this.filterTobeUnSubscribedDataChannels(e,t);if(s.length===0)return;t.forEach(c=>{c._close()});let a=this.remoteDataChannelMap.get(e);return s.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),s.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:c,mediaType:d}of e){let h=this.pendingRemoteTracks.filter(p=>{let{user:f,kind:_}=p;return d!==void 0?f.uid===c.uid&&d===_:f.uid===c.uid});h.forEach(p=>{let f=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(f,1)}),t=t.concat(h)}if(!this.connection||this.state!==Xt.Connected)return void t.forEach(c=>{let{user:d,kind:h}=c;var p;if(h===ze.AUDIO)(p=d._audioTrack)===null||p===void 0||p._destroy(),d._audioTrack=void 0;else if(h===ze.VIDEO){var f;(f=d._videoTrack)===null||f===void 0||f._destroy(),d._videoTrack=void 0}});let s=Ji(e).call(e,(c,d)=>{let{user:h,mediaType:p}=d,f=this.filterTobeUnSubscribedTracks(h,p);return c.concat(f)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));let a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:h}]=c;var p,f;if(h===ze.VIDEO&&d._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===ze.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(f=d._videoTrack)===null||f===void 0||f._destroy(),d._videoTrack=void 0;else if(h===ze.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),(_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0}}),a}isPreSubScribe(e){return!this.connection||this.state!==Xt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let s=this.remoteUserMap.get(e);if(!s)return void A.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void A.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let a=t===ze.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let s=this.remoteUserMap.get(e);if(!s)return void A.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(t)||A.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(Ie.LocalAudioTrack),s=t&&t.track;s&&s.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(Ie.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Xs){let s=t.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ie.LocalAudioTrack}).filter(a=>{let[c]=a;return!(e&&c===Ie.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(e&&a===Ie.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,s,a,c){if(e){let h=this.localTrackMap.get(Ie.LocalAudioTrack),p=a?this.localTrackMap.get(Ie.LocalVideoLowTrack):this.localTrackMap.get(Ie.LocalVideoTrack);Ze.publish(this.store.sessionId,{eventElapse:Fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(is.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);let h=s.find(f=>f instanceof Ps),p=a?(d=this.localTrackMap.get(Ie.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(f=>f instanceof hs);Ze.publish(this.store.sessionId,{eventElapse:Fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(is.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,s,a){let c=a===ze.VIDEO?s._videoSSRC:s._audioSSRC;c&&Ze.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===ze.VIDEO,audio:a===ze.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Fr.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){A.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Pr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=wE(this.store),this.emit(nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Ie.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Xs){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(s=>{t.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Xt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Ie.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Ie.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof hs||t&&t.track instanceof Ps?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;let s=Array.from(Cn(t=this.remoteUserMap).call(t)).find(a=>a.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Ie.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ed(e).call(e,(s,a)=>s.level-a.level),e}async disconnectForReconnect(){this.connection&&(A.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Xt.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&((s=t._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=wE(this.store),this.emit(nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:a}]=e;switch(s){case Ie.LocalVideoTrack:ke(t=a._hints).call(t,is.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ie.LocalAudioTrack:a instanceof Xs?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ie.LocalVideoLowTrack:}}),this.emit(nt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Cn(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(t,a)}),this.emit(nt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Cn(s).call(s)).forEach(a=>{this.setPendingRemoteDataChannel(t,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),A.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let s of this.pendingRemoteDataChannels){let{user:a,id:c}=s;if((e instanceof Zc?e.uid:e)===a.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let s of this.pendingRemoteTracks){let{user:a,kind:c}=s;if((e instanceof Zc?e.uid:e)===a.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Ai(function*(){if(!t.connection||t.state!==Xt.Connected)return;let s=yield Ut(t.mutex.lock("From P2PChannel.restartICE")),a;try{a=yield Ut(t.connection.restartICE(e));let d=yield Ut(a.next());if(d.done)return;let h=d.value,p=yield h;switch(BC(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Mr.UDP_TCP_RELAY:t._pcStatsUploadType=oc.UDP_TCP_RESTART;break;case Mr.TCP_RELAY:t._pcStatsUploadType=oc.TCP_RESTART;break;case Mr.RELAY:t._pcStatsUploadType=oc.RELAY_RESTART;break;default:t._pcStatsUploadType=oc.OLD_RESTART}t._isTryConnecting=!0,a.next(p)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(Ie.LocalVideoTrack),s=this.localTrackMap.get(Ie.LocalAudioTrack),a=e.videoSend.find(T=>T.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),c=e.audioSend.find(T=>T.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!c)return 1;let d=oi(this,nt.NeedSignalRTT),h=a?a.rttMs:void 0,p=c?c.rttMs:void 0,f=h&&p?(h+p)/2:h||p,_=(f&&d?(f+d)/2:f||d)||0,v=100*e.sendPacketLossRate*.7/50+.3*_/1500,b=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,w=t==null?void 0:t.track;if(w&&w._encoderConfig&&w._hints.indexOf(is.SCREEN_TRACK)===-1){let T=w._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(T&&U){let k=(1e3*T-U)/(1e3*T);return rU[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s,c=a._audioSSRC,d=a._videoSSRC,h=e.audioRecv.find(U=>U.ssrc===c),p=e.videoRecv.find(U=>U.ssrc===d);if(!h&&!p)return void(t+=1);let f=oi(this,nt.NeedSignalRTT),_=e.rtt,v=(_&&f?(_+f)/2:_||f)||0,b=h?h.jitterMs:void 0,w=e.recvPacketLossRate,T=.7*w*100/50+.3*v/1500;b&&(T=.6*w*100/50+.2*v/1500+.2*b/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Be((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}async replaceTrack(e,t){var s;if(A.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Xt.Connected)return;let a=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return e===h});if(!a)return;let c=a[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),a[1].track=t),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(t,a[1].id)),this.isPlanB){let d=a[1];d.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Ie.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding){let d=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(d){let h=e._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new Be((p,f)=>{this.handleReplaceTrack(d.track,p,f,!0)})}}}filterTobePublishedTracks(e,t,s){let a=[],c=this.getAllTracks();e=Qu(e=e.filter(f=>c.indexOf(f)===-1));let d,h=!1,p=this.localTrackMap.get(Ie.LocalAudioTrack);for(let f of e){if(f instanceof hs&&(this.localTrackMap.has(Ie.LocalVideoTrack)||h?new _e(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:f,type:Ie.LocalVideoTrack}),h=!0),t)){let _=this.getLowVideoTrack(f,s);a.push({track:_,type:Ie.LocalVideoLowTrack})}if(f instanceof Ps)if(p){let _=p.track;if(_ instanceof Xs)UC([f]),_.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0);else{let v=VC([_,f]);A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(v.getTrackId(),"]")),this.replaceTrack(_,v)}}else d instanceof Xs?(UC([f]),d.addAudioTrack(f)):d||!f._useAudioElement&&Vt().webAudioMediaStreamDest&&!f._bypassWebAudio?d=VC(d?[f,d]:[f]):d=f}return d&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:Ie.LocalAudioTrack})),a}filterTobeUnpublishedTracks(e){let t=[],s=this.getAllTracks();e=Qu(e=e.filter(a=>s.indexOf(a)!==-1));for(let a of e){if(a instanceof Ps){let c=this.localTrackMap.get(Ie.LocalAudioTrack);if(!c)continue;c.track instanceof Xs?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(t.push([Ie.LocalAudioTrack,c]),c.track.close())):t.push([Ie.LocalAudioTrack,c])}if(a instanceof hs){let c=this.localTrackMap.get(Ie.LocalVideoTrack);if(!c)continue;t.push([Ie.LocalVideoTrack,c]);let d=this.localTrackMap.get(Ie.LocalVideoLowTrack);d&&t.push([Ie.LocalVideoLowTrack,d])}}return t}filterTobePublishedDataChannels(e){return e=(e=Qu(e)).filter(t=>this.localDataChannels.findIndex(s=>s.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Qu(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:s,type:a}=t;switch(a){case Ie.LocalVideoTrack:s.addListener(Ye.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Ye.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ye.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ie.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Xs?e.trackList.forEach(s=>{s.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ye.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ye.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ye.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[s,{track:a}]=t;return{track:a,type:s}})),e.forEach(t=>{let{track:s,type:a}=t;switch(a){case Ie.LocalVideoTrack:s.off(Ye.GET_STATS,this.handleGetLocalVideoStats),s.off(Ye.GET_RTC_STATS,this.handleGetRTCStats),s.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Ye.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ie.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Xs?e.trackList.forEach(t=>{t.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ye.GET_STATS,this.handleGetLocalAudioStats),t.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ye.GET_STATS,this.handleGetLocalAudioStats),e.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ye.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof uh&&t.addListener(Ye.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),t instanceof hh&&t.addListener(Ye.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ye.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(ze.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(ze.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((s,a)=>{var c;let d,h,{track:p,type:f}=s;switch(f){case Ie.LocalAudioTrack:d=Qt.Audio,h={dtx:p instanceof Gm&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ie.LocalVideoTrack:d=ke(c=p._hints).call(c,is.SCREEN_TRACK)?Qt.Screen:Qt.High,h=Ro(Ro({},EU(p)),{},{codec:this.store.codec,svc_mode:lE()});break;case Ie.LocalVideoLowTrack:d=Qt.Low,h=Ro(Ro({},EU(p)),{},{codec:this.store.codec,svc_mode:lE()})}return{stream_type:d,attributes:h,ssrcs:t[a]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ie.LocalVideoTrack:a=ke(s=d._hints).call(s,is.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:p}})}assignLocalTracks(e,t){e.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:t[a].id,ssrcs:t[a].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[s]=t;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(nt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof ki&&!Rs()&&$("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},$("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof ki&&m5(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=oc.DISCONNECTED_OR_FAILED,oi(this,nt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let s=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Ze.reportApiInvoke(this.store.sessionId,{name:ks.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:xs.TRACER}).onSuccess(),this.republish()}if($("NEW_ICE_RESTART")&&e instanceof ki&&!Rs()&&!this._forceTurn){if(ke(pU).call(pU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let s=c=>{BC(e)&&(A.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),oi(this,nt.QueryClientConnectionState)==="CONNECTED"&&this.emit(nt.RequestRestartICE,c))},a=()=>{BC(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),A.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(nt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{f5(e,s,a)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&$("ICE_RESTART")&&oi(this,nt.QueryClientConnectionState)==="CONNECTED"&&this.emit(nt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(nt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(nt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ze.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:xs.TRACER}).onSuccess(),this.emit(nt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var s;let a=Array.from(Cn(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===t);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Oi.FIRST_FRAME_DECODED),Ze.firstRemoteFrame(this.store.sessionId,tr.FIRST_AUDIO_DECODE,ys.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var s;let a=Array.from(Cn(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===t);a&&Ze.firstRemoteFrame(this.store.sessionId,tr.FIRST_AUDIO_RECEIVED,ys.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,s,a)=>{var c;let d=Array.from(Cn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,s,a)},e.onFirstVideoRender=t=>{var s;let a=Array.from(Cn(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===t);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(a))},e.onFirstVideoReceived=t=>{var s;let a=Array.from(Cn(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===t);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstReceived:Date.now()}),Ze.firstRemoteFrame(this.store.sessionId,tr.FIRST_VIDEO_RECEIVED,ys.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,s)=>{let a=t.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(nt.ConnectionTypeChange,a),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Yc(s))," -> ").concat(JSON.stringify(Yc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,s)=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Yc(s))," -> ").concat(JSON.stringify(Yc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Ro(Ro({},t),s)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof ki&&function(t){Ch.delete(t.id),m5(t)}(e),e.close(),this.emit(nt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let s=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof Ps&&(s==null?void 0:s.track)instanceof Xs)return s.track.isActive||t.push([Ie.LocalAudioTrack,s]),t;let a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a&&(t.push(a),a[0]===Ie.LocalVideoTrack)){let c=this.localTrackMap.get(Ie.LocalVideoLowTrack);c&&t.push([Ie.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){let t=[],s=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof Ps&&(s==null?void 0:s.track)instanceof Xs)return s.track.isActive&&t.push([Ie.LocalAudioTrack,s]),t;let a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a)if(a[0]===Ie.LocalVideoTrack){t.push(a);let c=this.localTrackMap.get(Ie.LocalVideoLowTrack);c&&t.push([Ie.LocalVideoLowTrack,c])}else t.push(a);return t}createMuteMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=ke(s=d._hints).call(s,is.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=ke(s=d._hints).call(s,is.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,t){let s=[],a=this.remoteUserMap.get(e);if(!a)return s;if(t){let c=a.get(t);if(!c)return s;s.push([e,{kind:t,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([e,{kind:d,id:h}])});return s}filterTobeUnSubscribedDataChannels(e,t){let s=[];return t.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)}),s}createUnsubscribeMessage(e){let t=[];return e.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case ze.VIDEO:return void(a._videoSSRC&&t.push({stream_type:ze.VIDEO,ssrcId:a._videoSSRC}));case ze.AUDIO:return void(a._audioSSRC&&t.push({stream_type:ze.AUDIO,ssrcId:a._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(s=>{let[a,{kind:c}]=s;if(t.has(a)){let d=t.get(a);c===ze.VIDEO?d|=or.Video:d|=or.Audio,t.set(a,d)}else c===ze.VIDEO?t.set(a,or.Video):t.set(a,or.Audio)}),{users:Array.from(t.entries()).map(s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[s,{kind:a}]=t,c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Ie.LocalVideoTrack),s=this.localTrackMap.get(Ie.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Be((a,c)=>{this.handleUpdateVideoEncoder(t.track,a,c,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Be((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof ki&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof ki&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,s){return e.map((a,c)=>{var d;let{stream_type:h}=a,p=(d=t.find(f=>{let{stream_type:_}=f;return h===_}))===null||d===void 0?void 0:d.attributes;if(p&&$("DISABLE_SCREEN_SHARE_REMB")){let f=s[c]._hints;(ke(f).call(f,is.SCREEN_TRACK)||ke(f).call(f,is.SCREEN_LOW_TRACK))&&(p.remb=!1,A.debug("disable remb for screen share, hints:",f))}return p})}async tryToUnmuteAudio(e){for(let s=0;s<e.length;s++)if(e[s]instanceof Ps){var t;let a=this.filterTobeUnmutedTracks(e[s]);if(a.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(a.map(d=>{let[,{id:h}]=d;return h})));let c=this.createUnmuteMessage(a);return void await as(this,nt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(nt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(nt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await _r(T0(this.dtlsFailedCount,Ks)),this.emit(nt.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Rr(this,nt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(nt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ie.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof hs)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof hs).length>1)throw new _e(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ps).length>1&&(e.some(t=>t instanceof Ps&&t._bypassWebAudio)||!Vt().webAudioMediaStreamDest))throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof hs&&this.pendingLocalTracks.some(s=>s instanceof hs))throw new _e(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ps&&this.pendingLocalTracks.some(s=>s instanceof Ps)&&(!Vt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Ps&&s._bypassWebAudio)))throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var s;let a=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding,c=Ro(Ro({},{width:160,height:120,framerate:15,bitrate:50}),t),d;d=a?e._mediaStreamTrack.clone():WC(e,c);let h=os(8,"track-low-"),p=new hs(d,Ro(Ro({},a&&{scaleResolutionDownBy:bC(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(hd.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,ih.LOW_STREAM)}),p._hints.push(is.LOW_STREAM),ke(s=e._hints).call(s,is.SCREEN_TRACK)&&p._hints.push(is.SCREEN_LOW_TRACK),e.on("sei-to-send",f=>{p.emit("sei-to-send",f)}),e.addListener(Ye.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof ki){var c,d,h,p;let f=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_,dtlsTransportState:v,peerConnectionState:b}=this.connection,{local:w,remote:T}=await this.connection.getSelectedCandidatePair();Ze.pcStats(this.store.sessionId,{startTime:f,eventElapse:e-f||0,iceconnectionsate:_,dtlsstate:v,connectionstate:b,intSucc:t?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=w==null?void 0:w.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=w.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(w.address,":").concat(w.port),selectedRemoteCandidateProtocol:(h=T.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(p=T.candidateType)!==null&&p!==void 0?p:"",selectedRemoteCandidateAddress:"".concat(T.address,":").concat(T.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){let t=this.store.keyMetrics,s=t.firstVideoFrameDecoded.find(v=>v.userId===e.uid);if(!s)return;let{isInternalUpload:a,isExternalUpload:c}=s;if(a&&c)return;let{subscribeEnd:d,firstPreRender:h,peerPublishDuration:p,peerPubStatusMs:f}=s,{firstRender:_=0}=s;if(d&&(_||h)&&p&&f){s.isInternalUpload=!0;let{playEnd:v}=s;v&&(s.isExternalUpload=!0);let{firstPreRender:b=0}=s;_=b||_;let w=e.videoTrack,T={peer:e._uintid,width:(w==null?void 0:w._videoWidth)||0,height:(w==null?void 0:w._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:p,peerPubStatusMs:f,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:b||0,firstRender:v?Math.max(_,v):Math.max(_,d),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:GL(this.store)};Ze.firstXLAPeerFirstVideoFrame(this.store.sessionId,T)}}reportVideoFirstFrameDecoded(e,t,s,a){var c;let d=Array.from(Cn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());let h=this.store.keyMetrics,p=h.subscribe.find(f=>f.userId===d.uid&&f.type==="video");Ze.firstRemoteVideoDecode(this.store.sessionId,tr.FIRST_VIDEO_DECODE,ys.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:s,subscribeElapse:Fr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:a?1:0,firstFrame:(p==null?void 0:p.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.connection)return!1;let a=this.remoteUserMap.get(e);if(!a)return!1;let c=a.get(t);if(!c)return!1;let d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===Ie.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ih.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Je(Rt.prototype,"startP2PConnection",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"startP2PConnection"),Rt.prototype),Je(Rt.prototype,"connect",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"connect"),Rt.prototype),Je(Rt.prototype,"updateRemoteRTPCapabilities",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"updateRemoteRTPCapabilities"),Rt.prototype),Je(Rt.prototype,"publishDataChannel",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"publishDataChannel"),Rt.prototype),Je(Rt.prototype,"unpublish",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"unpublish"),Rt.prototype),Je(Rt.prototype,"unpublishDataChannel",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"unpublishDataChannel"),Rt.prototype),Je(Rt.prototype,"unpublishLowStream",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"unpublishLowStream"),Rt.prototype),Je(Rt.prototype,"subscribeDataChannel",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"subscribeDataChannel"),Rt.prototype),Je(Rt.prototype,"subscribe",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"subscribe"),Rt.prototype),Je(Rt.prototype,"massSubscribe",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"massSubscribe"),Rt.prototype),Je(Rt.prototype,"unsubscribe",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"unsubscribe"),Rt.prototype),Je(Rt.prototype,"unsubscribeDataChannel",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"unsubscribeDataChannel"),Rt.prototype),Je(Rt.prototype,"massUnsubscribe",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"massUnsubscribe"),Rt.prototype),Je(Rt.prototype,"muteRemote",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"muteRemote"),Rt.prototype),Je(Rt.prototype,"unmuteRemote",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"unmuteRemote"),Rt.prototype),Je(Rt.prototype,"hasRemoteMediaWithLock",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"hasRemoteMediaWithLock"),Rt.prototype),Je(Rt.prototype,"disconnectForReconnect",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"disconnectForReconnect"),Rt.prototype),Je(Rt.prototype,"updateBitrateLimit",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"updateBitrateLimit"),Rt.prototype),Je(Rt.prototype,"remoteMediaSsrcChanged",[Zr],Object.getOwnPropertyDescriptor(Rt.prototype,"remoteMediaSsrcChanged"),Rt.prototype),Rt);function Zr(e,t,s){let a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let c=this.mutex,d=await c.lock("From P2PChannel.".concat(t));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},s}function v5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function E5(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?v5(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):v5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let Xae=Date.now(),Jae=20,HC=new Map,RE=new Map;async function y5(e){let t=HC.get(e),s=Array.isArray(t)&&t[t.length-1],a=RE.get(e);if(!s)return void(a.isSyncing=!1);let c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);let d=s.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let p=s.mediaDelay+h;p<=0?(t.pop(),x5(s.context,c),p=0):p=Math.min(p,Jae),setTimeout(()=>t.length&&y5(e),p)}function x5(e,t){e.safeEmit(At.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Qae(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return x5(s,{uid:e.uid,payload:e.payload});let a="".concat(s.id,"-").concat(e.uid),c=HC.get(a)||[],d=c.findIndex(_=>e.sendTs>=_.sendTs),h=E5(E5({},e),{},{context:s,mediaDelay:t,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),HC.set(a,c);let p=!1;var f;RE.has(a)?p=!((f=RE.get(a))===null||f===void 0||!f.isSyncing):RE.set(a,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||y5(a)}let Zae=Lt().name;function b5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function w5(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?b5(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):b5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let Th="websdk_ng_cache_parameter",eoe=$("MAX_PRELOAD_ASYNC_LENGTH"),toe=1e4,bd=new Map,wd=[],zC=null,KC=0,qC=0,AE=new Map,soe=function(e,t){let s=[],a=0,c=async()=>{let d=s.shift();d&&await d(),s.length>0&&a<t?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return new Be(async(f,_)=>{s.push(async()=>{try{let v=await e(...h);f(v)}catch(v){_(v)}}),a<t&&(a++,c())})}}(S5,eoe),YC=pn.CancelToken.source();async function S5(e,t,s,a,c,d){try{if(!$("ENABLE_PRELOAD"))return;if(!Vt().supportWebCrypto)return void Bc(()=>{A.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new _e(q.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&gr(s,"token",1,2047),gr(e,"appid",1,2047),rE(t),a&&nE(a);let h=dd();A.debug("preload channel ".concat(t,", uid is ").concat(a));let p={appId:e,cname:t,token:s||e,uid:typeof a!="string"?a:null,sid:h,proxyServer:c},f,_;typeof a=="string"?(p.stringUid=a,[_,f]=await Be.all([Uae(a,{sid:h,appId:e},YC.token),XU(w5(w5({},p),{},{token:s||e,uid:0}),YC.token)]),p.uid=_.uid,f.gatewayInfo.uid=p.uid,f.gatewayInfo.res.uid=p.uid):(d&&(p.stringUid=d),f=await XU(p,YC.token));let v={sid:h,appId:e,cname:t,token:s||e,uid:p.stringUid||a,intUid:p.uid||f.gatewayInfo.uid,stringUid:p.stringUid,ts:Date.now(),sua:_,ap:f};await async function(b){let w;try{b.uid&&T5({appId:b.appId,cname:b.cname,token:b.token,uid:b.uid,stringUid:b.stringUid});let T=I5(b),U=await async function(F,K){try{let Y=await window.crypto.subtle.importKey("raw",gL(K),"AES-GCM",!1,["encrypt"]),X=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,ld(window.btoa(JSON.stringify(F))));return Wc(new Uint8Array(X))}catch{return}}(b,b.token||b.appId);if(!U)return;w=A5(Th);let k=w?JSON.parse(w):[];k.push({[T]:U}),k.length>$("AP_CACHE_NUM")&&k.shift(),IE(Th,JSON.stringify(k))}catch(T){A.warn("Error caching server parameters:",T.message),IE(Th,"")}}(v),KC++}catch(h){throw qC++,function(p){zC||(zC=window.setTimeout(()=>{let _="";AE.forEach((v,b)=>{_+="".concat(b,": ").concat(v," ;")}),Ze.reportApiInvoke(null,{name:ks.PRELOAD,options:{success:KC,failed:qC,err:_}}).onError(p),KC=0,qC=0,AE.clear(),zC=null},toe));let f=AE.get(p.code)||0;AE.set(p.code,f+1)}(h),h}}async function C5(e){try{if($("AP_REQUEST_DETAIL")||$("ENABLE_ROLE_SELECT_EDGE"))return;let t=T5(e);if(!t||e.cloudProxyServer!=="disabled")return;let s=await async function(a,c){try{let d=await window.crypto.subtle.importKey("raw",gL(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,ld(a));return JSON.parse(window.atob(Wc(new Uint8Array(h))))}catch{return}}(t,e.token||e.appId);if(!s||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(s,e))return;if(s&&Date.now()-s.ts<$("AP_CACHE_LIFETIME"))return s}catch(t){A.warn("Error get preloadInfo",t.message)}}function T5(e){let t;try{if(t=A5(Th),!t)return;let s=JSON.parse(t),a=I5(e),c=function(h,p){for(let f=h.length-1;f>=0;f--)if(p(h[f]))return f;return-1}(s,h=>a in h);if(c===-1)return;let d=s.splice(c,1)[0];return IE(Th,JSON.stringify(s)),d[a]}catch(s){A.warn("Error delete preload info: ".concat(t),s.message),IE(Th,"")}}function $C(e){if(e){let t=bd.get(e);t&&(window.clearTimeout(t),t=null,bd.delete(e)),ke(wd).call(wd,e)||e.cloudProxyServer!=="disabled"||wd.push(e)}if(bd.size<$("AP_CACHE_NUM")&&wd.length>0){let t=wd.shift();bd.set(t,window.setTimeout(async()=>{let{appId:s,cname:a,token:c,stringUid:d,uid:h,proxyServer:p}=t;try{await soe(s,a,c,h,p,d),bd.has(t)&&$C(t)}catch(f){A.warn("update preload failed",f.message),N5(t)}},$("AP_UPDATE_INTERVAL")))}}function N5(e){let t=wd.indexOf(e);t!==-1&&wd.splice(t,1);let s=bd.get(e);s&&(window.clearTimeout(s),s=null,bd.delete(e),$C())}function R5(e,t){let s=e.sua,a=e.ap;t&&s&&Ze.reqUserAccount(e.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:t,uid:e.intUid,errorCode:null,extend:s.req}),Ze.reportResourceTiming(e.ap.url,e.sid),Ze.joinWebProxyAP(e.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Bs.CHOOSE_SERVER,Bs.CLOUD_PROXY_FALLBACK].toString()}),Ze.joinChooseServer(e.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[Bs.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function A5(e){return window.atob(window.localStorage.getItem(e)||"")}function IE(e,t){window.localStorage.setItem(e,window.btoa(t))}function I5(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),wL(t)}function roe(e){let t=function(){let s=aoe.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,a){let c=s.appId;c!==void 0&&(Ws(a,10),tl(a,c));let d=s.cid;d!==void 0&&(Ws(a,16),Ws(a,d));let h=s.cname;h!==void 0&&(Ws(a,26),tl(a,h));let p=s.deviceId;p!==void 0&&(Ws(a,34),tl(a,p));let f=s.elapse;f!==void 0&&(Ws(a,40),sl(a,f));let _=s.fileSize;_!==void 0&&(Ws(a,48),sl(a,Nh(_)));let v=s.height;v!==void 0&&(Ws(a,56),sl(a,Nh(v)));let b=s.jpg;b!==void 0&&(Ws(a,66),Ws(a,b.length),O5(a,b));let w=s.networkType;w!==void 0&&(Ws(a,72),sl(a,Nh(w)));let T=s.osType;T!==void 0&&(Ws(a,80),sl(a,Nh(T)));let U=s.requestId;U!==void 0&&(Ws(a,90),tl(a,U));let k=s.sdkVersion;k!==void 0&&(Ws(a,98),tl(a,k));let F=s.sequence;F!==void 0&&(Ws(a,104),sl(a,Nh(F)));let K=s.sid;K!==void 0&&(Ws(a,114),tl(a,K));let Y=s.timestamp;Y!==void 0&&(Ws(a,120),sl(a,Y));let X=s.uid;X!==void 0&&(Ws(a,128),Ws(a,X));let re=s.vid;re!==void 0&&(Ws(a,136),Ws(a,re));let te=s.width;te!==void 0&&(Ws(a,144),sl(a,Nh(te)));let Z=s.service;Z!==void 0&&(Ws(a,152),Ws(a,Z));let le=s.callbackData;le!==void 0&&(Ws(a,162),Ws(a,le.length),O5(a,le));let xe=s.ticket;xe!==void 0&&(Ws(a,170),tl(a,xe));let Ce=s.vendorConfigs;Ce!==void 0&&(Ws(a,178),tl(a,Ce))}(e,t),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(t)}function noe(e){return function(s){let a={};e:for(;!ooe(s);){let c=nf(s);switch(c>>>3){case 0:break e;case 1:a.code=nf(s);break;case 2:a.msg=j5(s,nf(s));break;case 3:a.requestId=j5(s,nf(s));break;case 4:a.timestamp=coe(s,!1);break;default:ioe(s,7&c)}}return a}({bytes:t=e,offset:0,limit:t.length});var t}function ioe(e,t){switch(t){case 0:for(;128&ha(e););break;case 2:XC(e,nf(e));break;case 5:XC(e,4);break;case 1:XC(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Nh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let aoe=[];function XC(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function ooe(e){return e.offset>=e.limit}function DE(e,t){let s=e.bytes,a=e.offset,c=e.limit,d=a+t;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),a}function D5(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function O5(e,t){let s=DE(e,t.length);e.bytes.set(t,s)}function j5(e,t){let s=D5(e,t),a=String.fromCharCode,c=e.bytes,d="",h="";for(let p=0;p<t;p++){let f,_,v,b,w=c[p+s];128&w?(224&w)==192?p+1>=t?h+=d:(f=c[p+s+1],(192&f)!=128?h+=d:(b=(31&w)<<6|63&f,b<128?h+=d:(h+=a(b),p++))):(240&w)==224?p+2>=t?h+=d:(f=c[p+s+1],_=c[p+s+2],(49344&(f|_<<8))!=32896?h+=d:(b=(15&w)<<12|(63&f)<<6|63&_,b<2048||b>=55296&&b<=57343?h+=d:(h+=a(b),p+=2))):(248&w)==240?p+3>=t?h+=d:(f=c[p+s+1],_=c[p+s+2],v=c[p+s+3],(12632256&(f|_<<8|v<<16))!=8421504?h+=d:(b=(7&w)<<18|(63&f)<<12|(63&_)<<6|63&v,b<65536||b>1114111?h+=d:(b-=65536,h+=a(55296+(b>>10),56320+(1023&b)),p+=3))):h+=d:h+=a(w)}return h}function tl(e,t){let s=t.length,a=0;for(let h=0;h<s;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<s&&(p=(p<<10)+t.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Ws(e,a);let c=DE(e,a),d=e.bytes;for(let h=0;h<s;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<s&&(p=(p<<10)+t.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function ha(e){return e.bytes[D5(e,1)]}function P5(e,t){let s=DE(e,1);e.bytes[s]=t}function nf(e){let t,s=0,a=0;do t=ha(e),s<32&&(a|=(127&t)<<s),s+=7;while(128&t);return a}function Ws(e,t){for(t>>>=0;t>=128;)P5(e,127&t|128),t>>>=7;P5(e,t)}function coe(e,t){let s,a=0,c=0,d=0;return s=ha(e),a=127&s,128&s&&(s=ha(e),a|=(127&s)<<7,128&s&&(s=ha(e),a|=(127&s)<<14,128&s&&(s=ha(e),a|=(127&s)<<21,128&s&&(s=ha(e),c=127&s,128&s&&(s=ha(e),c|=(127&s)<<7,128&s&&(s=ha(e),c|=(127&s)<<14,128&s&&(s=ha(e),c|=(127&s)<<21,128&s&&(s=ha(e),d=127&s,128&s&&(s=ha(e),d|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:t}}function sl(e,t){let s=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=DE(e,d),p=e.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=d!==9?128|c:127&c;case 8:p[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:p[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:p[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:p[h+4]=d!==5?128|a:127&a;case 4:p[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:p[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:p[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:p[h]=d!==1?128|s:127&s}}let k5={},L5={},OE=4294967296,loe=OE*OE,doe=loe/2;F5(0,!0);let M5=F5(0),uoe=af(0,-2147483648,!1),hoe=af(-1,2147483647,!1);function F5(e,t){let s,a,c;return t?(c=0<=(e>>>=0)&&e<256)&&(a=L5[e],a)?a:(s=af(e,0,!0),c&&(L5[e]=s),s):(c=-128<=(e|=0)&&e<128)&&(a=k5[e],a)?a:(s=af(e,e<0?-1:0,!1),c&&(k5[e]=s),s)}function af(e,t,s){return{low:0|e,high:0|t,unsigned:!!s}}function U5(e,t){if(isNaN(e))return M5;{if(e<=-9223372036854776e3)return uoe;if(e+1>=doe)return hoe}return e<0?M5:af(e%OE|0,e/OE|0,t)}function V5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}class JC extends Cs{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let s=this._connectionState;this._connectionState=t,this.emit(Ha.CONNECTION_STATE_CHANGE,t,s)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var s;super(),W(this,"name","AgoraRTCImageModeration"),W(this,"_connectionState",Pi.CONNECTING),W(this,"_sequence",0),W(this,"_moderationStartTime",void 0),W(this,"_workerConnection",void 0),W(this,"_workerMessageLengthLimit",void 0),W(this,"_qualityRatio",void 0),W(this,"_connectInfo",void 0),W(this,"_cancelTokenSource",pn.CancelToken.source()),W(this,"_retryConfig",void 0),W(this,"_moderationInterval",void 0),W(this,"_moderationTimer",null),W(this,"_moderationMode",1),W(this,"_quality",1),W(this,"_qualityTimer",null),W(this,"_ticket",void 0),W(this,"_moderationIntervalMinimum",void 0),W(this,"_uploadFailedNum",0),W(this,"_uploadNum",0),W(this,"_uploadTimer",null),W(this,"_extraInfo",void 0),W(this,"_vendor",""),W(this,"_encoder",new TextEncoder),W(this,"_moderationId",void 0),W(this,"inspectImage",()=>{if(this.connectionState!==Pi.CONNECTED)throw new de(q.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Pi.CONNECTED?this.requestToInspectImage():A.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=os(5,"image-moderation-"),this._workerMessageLengthLimit=$("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=$("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=t.interval)!==null&&s!==void 0?s:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=$("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ym("worker-"+this._moderationId,Ks),this.on(Ha.STATE_CHANGE,(a,c)=>{A.debug("[".concat(this._moderationId,"] Moderation operation :").concat(gh[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(t,s){this.emit(Ha.STATE_CHANGE,gh.CONNECT_AP),this._connectInfo=t;let a=this._cancelTokenSource.token;return this._retryConfig=s,new Be((c,d)=>{this.on(Ha.CONNECTION_STATE_CHANGE,(h,p)=>{h===Pi.CONNECTED&&c()}),this.requestAP(t,a,s).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(t){var s;this._moderationInterval=(s=t.interval)!==null&&s!==void 0?s:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),A.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Pi.CONNECTED&&this.inspectImage()}async requestAP(t,s,a){let c=$("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),d=await function(f,_,v,b){let{appId:w,areaCode:T,cname:U,sid:k,token:F,uid:K}=_;bh++;let Y="moderation_plugin",X={service_name:Y,json_body:JSON.stringify({appId:w,areaCode:T,cname:U,command:"allocateEdge",requestId:bh,seq:bh,sid:k,appToken:F,ts:Date.now(),uid:K+""})},re,te,Z=f[0];return Va(async()=>{re=Date.now();let le=await za(Z,{data:X,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(te=Date.now()-re,le.code!==0){let je=new de(q.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+le.code,{retry:!0,responseTime:te});throw A.error(je.toString()),je}let xe=JSON.parse(le.json_body);if(xe.code!==200){let je=new de(q.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(xe.code,", reason: ").concat(xe.reason),{code:xe.code,responseTime:te});throw A.error(je.toString()),je}if(!xe.servers||!Array.isArray(xe.servers)||xe.servers.length===0){let je=new de(q.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:xe.code,responseTime:te});throw A.error(je.toString()),je}if(!xe.servers.some(je=>!!je.wss)){let je=new de(q.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:xe.code,responseTime:te});throw A.error(je.toString()),je}let Ce=$("IMAGE_MODERATION_WORKER_HOST");return{addressList:xe.servers.map(je=>{let{address:wt,wss:Ct}=je;if(wt&&Ct)return"wss://".concat(wt.replace(/\./g,"-"),".").concat(Ce,":").concat(Ct,"/moderation")}).filter(je=>!!je),workerToken:xe.workerToken,vid:xe.vid,ticket:xe.appTicket,responseTime:te}},(le,xe)=>(Ze.apworkerEvent(k,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(le.addressList),firstSuccess:xe===0,responseTime:te,serverIp:f[xe%f.length]}),!1),(le,xe)=>(Ze.apworkerEvent(k,{success:!1,sc:le.data&&le.data.code||200,serviceName:Y,responseTime:te,serverIp:f[xe%f.length]}),!!(le.code!==q.OPERATION_ABORTED&&le.code!==q.UNEXPECTED_RESPONSE||le.data&&le.data.retry)&&(Z=f[(xe+1)%f.length],!0)),b)}(c,t,s,a);this.emit(Ha.STATE_CHANGE,gh.AP_CONNECTED);let{addressList:h,ticket:p}=d;return this._ticket=p,h}async connectWorker(t){this.emit(Ha.STATE_CHANGE,gh.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(yt.CONNECTED,async()=>{this.emit(Ha.STATE_CHANGE,gh.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Pi.CONNECTED}),this._workerConnection.on(yt.CLOSED,()=>{this.connectionState=Pi.CLOSED}),this._workerConnection.on(yt.FAILED,()=>{this.connectionState=Pi.CLOSED}),this._workerConnection.on(yt.RECONNECTING,()=>{this.connectionState=this.connectionState===Pi.CONNECTED?Pi.RECONNECTING:Pi.CONNECTING}),this._workerConnection.on(yt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let s=noe(new Uint8Array(t.data));$("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,A.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ze.reportApiInvoke(this._connectInfo.sid||null,{name:ks.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:xs.TRACER}).onError(new de(q.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},$("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else A.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(yt.WILL_RECONNECT,(t,s,a)=>{t==="recover"&&a(t),a("tryNext")}),this._workerConnection.on(yt.REQUEST_NEW_URLS,(t,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(s)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=oi(this,Ha.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("Only the track being played can be inspected"));this._sequence++;let a=await this.generateRequestData(t,s);this._workerConnection.sendMessage(a,!0,!0)}else $("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("Only the track being published can be inspected")}async generateRequestData(t,s){let{appId:a,cname:c,cid:d,vid:h,sid:p,uid:f}=s,_=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),b=await hM(v,a,c),w=this._sequence+"-"+d+"-"+f+"-"+_+"-"+os(12,""),T={appId:a,cid:d,cname:c,deviceId:"",elapse:JC.intToLong(Number(_-this._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:b,networkType:6,osType:7,requestId:w,sdkVersion:"4.24.0",sequence:this._sequence,sid:p,timestamp:U5(_),uid:f,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;let U=roe(T);if(U.byteLength<this._workerMessageLengthLimit){if($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let k=function(F){for(var K=1;K<arguments.length;K++){var Y=arguments[K]!=null?arguments[K]:{};K%2?V5(Object(Y),!0).forEach(function(X){W(F,X,Y[X])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(Y)):V5(Object(Y)).forEach(function(X){Object.defineProperty(F,X,Object.getOwnPropertyDescriptor(Y,X))})}return F}({},T);delete k.jpg,A.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(k))}return U}{let k=this.quality*this._qualityRatio;return this.quality=k,await this.generateRequestData(t,{appId:a,cname:c,cid:d,vid:h,sid:p,uid:f})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=pn.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Pi.CLOSED,this.emit(Ha.STATE_CHANGE,gh.CLOSED)}}function B5(e){if(ns(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new de(q.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new de(q.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let poe={name:"ImageModeration",create:function(e){let{config:t}=e;return B5(t),new JC(t)}};var W5,G5,H5,z5,K5,q5,Y5,$5,X5,J5,Q5,Z5,eV,tV,sV,rV,nV,iV,aV,oV,cV,lV,dV,uV,hV,pV,mV,fV,gV,_V,vV,EV,yV,xV,bV,wV,SV,CV,TV,NV,RV,He;function AV(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function pa(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?AV(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):AV(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}Pr.setLogger(A);let moe=(W5=ut(),G5=ut({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof ch))return[t];t=[t]}return t.map(s=>s?Object(s).toString():"null")}}),H5=ut({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==oh.DATA?(Array.isArray(t)||(t=[t]),t.map(s=>s.getTrackId())):[t.getChannelId()])}),z5=ut({argsMap:(e,t,s,a)=>[typeof t=="object"?t.uid:t,s,a]}),K5=ut({argsMap:(e,t,s)=>[t,s]}),q5=ut({argsMap:(e,t)=>t.map(s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]})}),Y5=ut({argsMap:(e,t,s,a)=>[typeof t=="object"?t.uid:t,s,a]}),$5=ut({argsMap:(e,t)=>t.map(s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}})}),X5=ut(),J5=ut(),Q5=ut(),Z5=ut(),eV=ut(),tV=ut(),sV=ut(),rV=ut(),nV=ut(),iV=ut(),aV=ut(),oV=ut(),cV=ut(),lV=ut(),dV=ut(),uV=ut({argsMap:(e,t)=>[t]}),hV=ut(),pV=ut(),mV=ut(),fV=ut(),gV=ut(),_V=ut(),vV=ut(),EV=ut(),yV=ut({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),xV=ut(),bV=ut(),wV=ut(),SV=ut(),CV=ut(),TV=ut(),NV=ut({reportResult:!0}),RV=ut(),He=class extends Cs{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let s;if(super(),W(this,"store",void 0),W(this,"_uid",void 0),W(this,"_channelName",void 0),W(this,"_uintUid",void 0),W(this,"_users",[]),W(this,"_config",void 0),W(this,"_clientId",void 0),W(this,"_appId",void 0),W(this,"_sessionId",null),W(this,"_key",void 0),W(this,"_rtmConfig",{}),W(this,"_joinInfo",void 0),W(this,"_gateway",void 0),W(this,"_statsCollector",void 0),W(this,"_configDistribute",void 0),W(this,"_leaveMutex",void 0),W(this,"_publishMutex",void 0),W(this,"_renewTokenMutex",void 0),W(this,"_subscribeMutex",void 0),W(this,"_encryptionMode","none"),W(this,"_encryptionSecret",null),W(this,"_encryptionSalt",null),W(this,"_encryptDataStream",!1),W(this,"_encryptDataStreamKey",null),W(this,"_encryptDataStreamIv",null),W(this,"_proxyServer",void 0),W(this,"_turnServer",{servers:[],mode:"auto"}),W(this,"_cloudProxyServerMode","disabled"),W(this,"_isDualStreamEnabled",!1),W(this,"_defaultStreamFallbackType",void 0),W(this,"_lowStreamParameter",void 0),W(this,"_streamFallbackTypeCacheMap",new Map),W(this,"_remoteStreamTypeCacheMap",new Map),W(this,"_axiosCancelSource",pn.CancelToken.source()),W(this,"_audioVolumeIndicationInterval",void 0),W(this,"_networkQualityInterval",void 0),W(this,"_userOfflineTimeout",void 0),W(this,"_streamRemovedTimeout",void 0),W(this,"_liveTranscodeStreamingClient",void 0),W(this,"_liveRawStreamingClient",void 0),W(this,"_channelMediaRelayClient",void 0),W(this,"_networkQualitySensitivity","normal"),W(this,"_p2pChannel",void 0),W(this,"_useLocalAccessPoint",!1),W(this,"_setLocalAPVersion",void 0),W(this,"_joinAndNotLeaveYet",!1),W(this,"_numberOfJoinCount",0),W(this,"_joinResponse",null),W(this,"_remoteDefaultVideoStreamType",void 0),W(this,"_inspect",void 0),W(this,"_moderation",void 0),W(this,"_license",void 0),W(this,"_pendingPublishedUsers",[]),W(this,"ntpAlignErrorCount",0),W(this,"remoteInboundOffset",0),W(this,"_peerConnectionState",void 0),W(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),W(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),W(this,"_handleUserOnline",c=>{if($("BLOCK_LOCAL_CLIENT")&&vd(c.uid,this.channelName))return void A.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&A.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(At.USER_JOINED,d));else{let h=new Zc(c.uid,c.uint_id||c.uid);this._users.push(h),A.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(At.USER_JOINED,h)}}),W(this,"_handleUserOffline",c=>{if($("BLOCK_LOCAL_CLIENT")&&vd(c.uid,this.channelName))return;let d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:Ov(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),A.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(At.USER_LEAVED,d,c.reason))}),W(this,"_handleAddAudioOrVideoStream",(c,d,h,p,f,_,v,b)=>{if($("BLOCK_LOCAL_CLIENT")&&vd(d,this.channelName))return;let w=this._users.find(U=>U.uid===d);if(!w)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));A.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(w.uid,{videoAddNotify:Date.now()});let T=c==="audio"?w.hasAudio:w.hasVideo;if(w._uintid||(w._uintid=_||d),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,h!==void 0&&(w._audioSSRC=h),p!==void 0&&(w._cname=p),v&&(w._audioOrtc=v)):(w._video_added_=!0,h!==void 0&&(w._videoSSRC=h),p!==void 0&&(w._cname=p),b!==void 0&&(w._rtxSsrcId=b),v&&(w._videoOrtc=v)),(c==="audio"?w.hasAudio:w.hasVideo)&&!T&&(A.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(At.USER_PUBLISHED,w,c)),c==="video"?Ze.onGatewayStream(this._sessionId,tr.ON_ADD_VIDEO_STREAM,ys.ON_ADD_VIDEO_STREAM,{peer:_||d,ssrc:w._videoSSRC}):Ze.onGatewayStream(this._sessionId,tr.ON_ADD_AUDIO_STREAM,ys.ON_ADD_AUDIO_STREAM,{peer:_||d,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,h).then(U=>{if(U&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof rf))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(k=>{A.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(U=>{A.error("[".concat(this._clientId,"] resubscribe error"),U.toString())})),c==="video"&&!Tr()&&!zr()){let U=this._getEncodingName(f);(U==null?void 0:U.toLocaleLowerCase())==Vm.av1&&Fae().then(k=>{k||this._gateway.downgradeCodec(U)})}}),W(this,"_handleRemoveStream",c=>{if($("BLOCK_LOCAL_CLIENT")&&vd(c.uid,this.channelName))return;let d=this._users.find(p=>p.uid===c.uid);if(!d)return void A.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));A.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(At.USER_UNPUBLISHED,d,"audio"),A.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(At.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(At.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(At.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof rf&&this._p2pChannel.unsubscribe(d).then(p=>{if(p)return this._gateway.unsubscribe(p,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),Ze.onGatewayStream(this._sessionId,tr.ON_REMOVE_STREAM,ys.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),W(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if($("BLOCK_LOCAL_CLIENT")&&vd(d,this.channelName))return;let p=this._users.find(v=>v.uid===d);if(!p)return void A.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));A.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));let f=c==="audio"?p.hasAudio:p.hasVideo;if(c==="audio"){p._trust_audio_enabled_state_=!0;let v=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===v)return;{let b=p._audio_enabled_?"enable-local-audio":"disable-local-audio";A.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(b)),this.safeEmit(At.USER_INFO_UPDATED,d,b)}}else{p._trust_video_enabled_state_=!0;let v=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===v)return;{let b=p._video_enabled_?"enable-local-video":"disable-local-video";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(b)),this.safeEmit(At.USER_INFO_UPDATED,d,b)}}let _=c==="audio"?p.hasAudio:p.hasVideo;return f!==_?!f&&_?(A.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(At.USER_PUBLISHED,p,c)):(c==="video"&&p._videoTrack&&p._videoTrack._destroy(),c==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,c),A.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(At.USER_UNPUBLISHED,p,c)):void 0}),W(this,"_handleMuteStream",(c,d,h)=>{if($("BLOCK_LOCAL_CLIENT")&&vd(c,this.channelName))return;A.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);let p=this._users.find(v=>v.uid===c);if(!p)return void A.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));let f=d==="audio"?p.hasAudio:p.hasVideo;if(d==="audio"){p._trust_audio_mute_state_=!0;let v=p._audio_muted_;if(p._audio_muted_=h,p._audio_muted_===v)return;{let b=p._audio_muted_?"mute-audio":"unmute-audio";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(b)),this.safeEmit(At.USER_INFO_UPDATED,c,b)}}else{p._trust_video_mute_state_=!0;let v=p._video_muted_;if(p._video_muted_=h,p._video_muted_===v)return;{let b=p._video_muted_?"mute-video":"unmute-video";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(b)),this.safeEmit(At.USER_INFO_UPDATED,c,b)}}let _=d==="audio"?p.hasAudio:p.hasVideo;if(f!==_){if(!f&&_)return(d==="audio"?p._audioSSRC:p._videoSSRC)?(A.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(At.USER_PUBLISHED,p,d)):void A.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),d==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,d),A.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(At.USER_UNPUBLISHED,p,d)}}),W(this,"_handleP2PLost",async c=>{A.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():A.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),W(this,"_handleTokenWillExpire",()=>{A.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(At.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),W(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),A.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),W(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(At.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(At.NETWORK_QUALITY,c)}),W(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,p)=>{let f=this._users.find(v=>v.uid===d);if(!f)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));A.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(f.uid,c,void 0,void 0,void 0,Date.now());let _=c==="audio"?f.hasAudio:f.hasVideo;c==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,c==="audio"?(f._audio_added_=!0,h!==void 0&&(f._audioSSRC=h),p!==void 0&&(f._audioMid=p)):(f._video_added_=!0,h!==void 0&&(f._videoSSRC=h),p!==void 0&&(f._videoMid=p)),(c==="audio"?f.hasAudio:f.hasVideo)&&!_&&(A.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(c)),this.safeEmit(At.USER_PUBLISHED,f,c)),this._p2pChannel.hasPendingRemoteMedia(f,c)&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,c,!0).catch(v=>{A.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=e,this._clientId=t||os(5,"client-"),this.store=new class{constructor(c,d,h,p){gt(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:p,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ud.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case _t.SET_SESSION_ID:return Oe(Oe({},d),{},{sessionId:h.sessionId});case _t.SET_P2P_ID:return Oe(Oe({},d),{},{p2pId:h.p2pId});case _t.SET_UID:return Oe(Oe({},d),{},{uid:h.uid});case _t.SET_INT_UID:return Oe(Oe({},d),{},{intUid:h.intUid});case _t.SET_PUB_ID:return Oe(Oe({},d),{},{pubId:h.pubId});case _t.KEY_METRIC_CLIENT_CREATED:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{clientCreated:h.metric})});case _t.KEY_METRIC_JOIN_START:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{joinStart:h.metric})});case _t.KEY_METRIC_PRELOAD_START:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{preloadStart:h.metric})});case _t.KEY_METRIC_PRELOAD_END:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{preloadEnd:h.metric})});case _t.KEY_METRIC_JOIN_END:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{joinEnd:h.metric})});case _t.KEY_METRIC_REQUEST_AP_START:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{requestAPStart:h.metric})});case _t.KEY_METRIC_REQUEST_AP_END:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{requestAPEnd:h.metric})});case _t.KEY_METRIC_REQUEST_SUA_END:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case _t.KEY_METRIC_BEFORE_CONNECT:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{beforeConnect:h.metric})});case _t.KEY_METRIC_PEER_RECEIVER:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{peerReceiver:h.metric})});case _t.KEY_METRIC_SIGNAL_CONNECTED:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{signalConnected:h.metric})});case _t.KEY_METRIC_JOIN_REQ:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{joinReq:h.metric})});case _t.KEY_METRIC_JOIN_REP:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{joinRep:h.metric})});case _t.KEY_METRIC_JOIN_GATEWAY_START:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case _t.KEY_METRIC_JOIN_GATEWAY_END:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case _t.KEY_METRIC_PEER_CONNECTION_START:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case _t.KEY_METRIC_PEER_CONNECTION_END:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case _t.KEY_METRIC_DESCRIPTION_START:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{descriptionStart:h.metric})});case _t.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case _t.KEY_METRIC_ICE_CONNECTION_END:return Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case _t.KEY_METRIC_PUBLISH:{let p=d.keyMetrics.publish,f=p.findIndex(_=>_.trackId===h.metric.trackId);return f!==-1?(p[f]=Oe(Oe({},p[f]),h.metric),Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{publish:[...p]})})):Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case _t.KEY_METRIC_SUBSCRIBE:{let p=d.keyMetrics.subscribe,f=p.findIndex(_=>_.userId===h.metric.userId&&_.type===h.metric.type);return f!==-1?(p[f]=Oe(Oe({},p[f]),h.metric),Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{subscribe:[...p]})})):Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case _t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let p=d.keyMetrics.firstVideoFrameDecoded,f=p.findIndex(_=>_.userId===h.metric.userId);return f!==-1?(p[f]=Oe(Oe({},p[f]),h.metric),Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{firstVideoFrameDecoded:[...p]})})):Oe(Oe({},d),{},{keyMetrics:Oe(Oe({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case _t.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case _t.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case _t.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=Oe(Oe({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case _t.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case _t.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case _t.SET_USE_P2P:return Oe(Oe({},d),{},{useP2P:h.val});case _t.SET_TRANSPORT_TYPE:return Oe(Oe({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:_t.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:_t.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:_t.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:_t.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:_t.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:_t.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:_t.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:_t.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:_t.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:_t.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:_t.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:_t.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:_t.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:_t.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:_t.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:_t.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:_t.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:_t.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:_t.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:_t.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:_t.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:_t.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:_t.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:_t.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:_t.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:_t.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:_t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Oe({userId:c},d)})}descriptionStart(){this.dispatch({type:_t.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:_t.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:_t.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,p){this.dispatch({type:_t.KEY_METRIC_PUBLISH,metric:Oe(Oe({trackId:c,type:d},h&&{publishStart:h}),p&&{publishEnd:p})})}subscribe(c,d,h,p,f,_,v){this.dispatch({type:_t.KEY_METRIC_SUBSCRIBE,metric:Oe(Oe(Oe(Oe(Oe({userId:c,type:d},h&&{subscribeStart:h}),p&&{subscribeEnd:p}),f&&{firstFrame:f}),_&&{streamAdded:_}),v&&{firstDecoded:v})})}massSubscribe(c,d,h,p){c.forEach(f=>{this.dispatch({type:_t.KEY_METRIC_SUBSCRIBE,metric:Oe(Oe(Oe({userId:f.userId,type:f.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),p&&{firstFrame:p})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:_t.RECORD_JOIN_CHANNEL_SERVICE,record:Oe(Oe({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:_t.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:_t.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:_t.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:_t.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Pr("client-leave",this._clientId),this._publishMutex=new Pr("client-publish",this._clientId),this._renewTokenMutex=new Pr("client-renewtoken",this._clientId),this._subscribeMutex=new Pr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),A.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ii," build: ").concat(L0,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{w0(e.clientRoleOptions),s=Object.assign({},e.clientRoleOptions)}catch(c){A.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new tf(this.store),this._statsCollector.onStatsException=(c,d,h)=>{A.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===kC.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(p=>{p instanceof Kv&&$("ENABLE_ENCODE_EXCEPTION")&&p.findClosestProfile()}),this.safeEmit(At.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,p)=>{let f=this._users.find(_=>_.uid===c);f&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(f._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(f)),Ze.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:f._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if($("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){let d=this.localTracks.find(h=>h instanceof hs);d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?$("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Oae(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Ks,httpRetryConfig:e.httpRetryConfig||Ks,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:s}),this._configDistribute=new Gae(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},cc("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new rf(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,s,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];ts("JOIN_GATEWAY_USE_443PORT_ONLY",d),ts("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);let p=this._gateway.signal.websocket;return p instanceof yC&&(p.use443PortOnly=d,p.tryDoubleDomain=h),async function(f,_,v){Nv.get(f)||Nv.set(f,[]),Rv.get(f)||Rv.set(f,_),yo.get(f)||yo.set(f,0);let b=Nv.get(f),w=Rv.get(f);if(!b||!w)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(yo.get(f)===w){let K=Dm();b.push(K),await K.promise}yo.set(f,yo.get(f)+1);for(var T=arguments.length,U=new Array(T>3?T-3:0),k=3;k<T;k++)U[k-3]=arguments[k];let F=await v(...U);return yo.set(f,yo.get(f)-1),yo.get(f)===w-1&&b.length>0&&(b[0].resolve(),b.shift()),yo.get(f)===0&&(Nv.set(f,[]),Rv.set(f,0),yo.set(f,0)),F}("client.join",$("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,s,a,c)}async join(e,t,s,a,c){let d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);let h=(kv||kv||(kv=(window.location.protocol.split(":")[0]||"").toUpperCase(),kv))==="HTTPS",p=TL()?window.isSecureContext:"Browser Not Support";(!TL()&&!h||!window.isSecureContext)&&A.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let f;Ze.setAppId(e);try{if(!s&&s!==null)throw new de(q.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&gr(s,"token",1,2047),gr(e,"appid",1,2047),rE(t),a&&nE(a),c)if(typeof c=="string")gr(c,"optionalInfo",1,256),f=c;else{if(typeof c!="object")throw new de(q.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:F,enableInstantMuteRestore:K}=c;F&&(Ua(F,"autoSubscribe"),A.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(F)),this.store.autoSubscribe=F),K&&(Ua(K,"enableInstantMuteRestore"),A.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(K)),this.store.enableInstantMuteRestore=K)}}}catch(F){throw Ze.reportApiInvoke(dd(),{name:ks.JOIN,options:[e,t,s,a],states:{isHttps:h,isSecureContext:p},tag:xs.TRACER}).onError(F),F}if(this._leaveMutex.isLocked&&(A.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),A.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let F=new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ze.reportApiInvoke(dd(),{name:ks.JOIN,options:[e,t,s,a],states:{isHttps:h,isSecureContext:p},tag:xs.TRACER}).onError(F),F}this._gateway.state="CONNECTING",this.store.preloadStart();let _=await C5({appId:e,cname:t,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let v=(_==null?void 0:_.sid)||dd();A.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(d)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);let b=Ze.reportApiInvoke(v,{id:this._clientId,name:ks.JOIN,options:[e,t,s,a],states:{isHttps:h,isSecureContext:p},tag:xs.TRACER}),w=pa(pa(pa({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:f,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:$("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(w.stringUid=a,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async F=>{let K=function(te){let Z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),le=new Uint8Array(new ArrayBuffer(Z.length));for(let xe=0;xe<Z.length;xe+=1)le[xe]=Z.charCodeAt(xe);return le}(),Y=await window.crypto.subtle.importKey("spki",K,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),X=x0(F),re=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,X);return function(te){let Z="";for(let le=0;le<te.length;le+=1)Z+=String.fromCharCode(te[le]);return window.btoa(Z)}(new Uint8Array(re))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let F=new TextEncoder,K=$("USE_PURE_ENCRYPTION_MASTER_KEY")?F.encode(w.appId+this._encryptionSecret+this._encryptionSecret):F.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,X,re){let te=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=Y==="aes-128-gcm2"?128:256,le=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:LL,hash:"SHA-256",salt:re},te,Z+cie);return new Uint8Array(le).subarray(Z/8)}(this._encryptionMode,K,ld(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,X,re){let te=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:LL,hash:"SHA-256",salt:re},te,{name:"AES-GCM",length:Z},!0,["encrypt","decrypt"])}(this._encryptionMode,K,ld(this._encryptionSalt))}else p?A.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):A.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,A.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:w.stringUid});let T=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&T===this._sessionId&&Ze.joinChannelTimeout(this._sessionId,5)},5e3);try{var U;let F,K=w.cloudProxyServer;if(ke(U=["proxy3","proxy4","proxy5"]).call(U,K)){let Z=$("PROXY_SERVER_TYPE3");Array.isArray(Z)?w.proxyServer=Z[0]:w.proxyServer=Z}if(Ze.setProxyServer(w.proxyServer),A.setProxyServer(w.proxyServer),this.store.requestAPStart(),_){if(A.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(_.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=_.intUid),F={gatewayInfo:_.ap.gatewayInfo},$("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)A.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let Z=(await xU(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(le=>({turnServerURL:le.address,tcpport:le.tcpport||Ar.tcpport,udpport:le.udpport||Ar.udpport,username:le.username||Ar.username,password:le.password||Ar.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:Z}}R5(_,w.stringUid)}else{if(w.stringUid&&!w.uid){let Z;[Z,F]=await Be.all([$U(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||Ks,this.store).finally(()=>{this.store.requestSUAEnd()}),YU(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Ks,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),A.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(Z)),w.uid=Z,F.gatewayInfo.uid=Z,F.gatewayInfo.res.uid=Z}else F=await YU(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Ks,!0,this.store);if(!this._joinAndNotLeaveYet)throw new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(Km.UPDATE_BITRATE_LIMIT,Z=>{this._p2pChannel.updateBitrateLimit(Z)}),this._configDistribute.on(Km.UPDATE_CLIENT_ROLE_OPTIONS,Z=>{this._setClientRoleOptions(Z)})},0),this._key=s||e;let Y=F.gatewayInfo,X=w.uid?w.uid:Y.uid;this._joinInfo=pa(pa({},w),{},{cid:Y.cid,uid:X,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=X,this.store.cid=Y.cid;let re=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));b.onSuccess(re),this._appId=e,this._channelName=w.cname,this._uid=re,this.store.uid=re,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Tr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let te=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return A.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(te)),setTimeout(()=>{A.startUpload()},5e3),this.store.joinEnd(),k=this,ke(_d).call(_d,k)||_d.push(k),this._cloudProxyServerMode==="disabled"&&Vt().supportWebCrypto&&$("ENABLE_PRELOAD")&&$C(this._joinInfo),re}catch(F){let K=Array.isArray(F)?F[0]:F;throw K&&K.code===q.OPERATION_ABORTED?A.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),K):A.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),K),K.code!==q.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),b.onError(K),K}var k}_joinGateway(){if(!this._joinInfo||!this._key)throw new de(q.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!$("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){A.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Tr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let s=_d.indexOf(t);s!==-1&&_d.splice(s,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return A.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",$t.LEAVE),A.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof ch))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new de(q.INVALID_PARAMS,"param list is empty");let s=e;if(this._gateway.role==="audience")throw new de(q.INVALID_OPERATION,"audience can not publish stream");for(let c of s){if(!(c instanceof ch))throw new de(q.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new de(q.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}A.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));let a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&s.forEach(c=>{let d=this._configDistribute.getBitrateLimit();c instanceof hs&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(s),A.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw A.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(e){if(e==null)throw new de(q.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));ns(e.id,"id",0,65535,!0),Ua(e.ordered,"ordered"),gr(e.metadata,"metadata",0,512),A.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new de(q.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new de(q.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new de(q.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let s=function(c){return UU(c,!1)}(e),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw A.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new de(q.CREATE_DATACHANNEL_ERROR);try{await Be.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==q.DISCONNECT_P2P)throw c}}return A.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw A.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new de(q.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof ch))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);A.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(a=>"".concat(a.getTrackId()," "))," "));let s=await this._publishMutex.lock();try{if(this.store.useP2P){let a=await this._p2pChannel.unpublish(t);a&&await this._gateway.sendExtensionMessage(Ms.UNPUBLISH,{unpubMsg:a},!0)}else{let a=await this._p2pChannel.unpublish(t);a&&await this._gateway.unpublish(a,this._uid),A.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw A.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),A.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(s=>"".concat(s.id," "))," "));let t=await this._publishMutex.lock();try{let s=await this._p2pChannel.unpublishDataChannel(e);s&&await this._gateway.unpublishDataChannel(s),A.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(a=>"".concat(a.id))))}catch(s){throw A.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{t&&t()}}async subscribe(e,t,s){if(!(e instanceof Zc)){let a=this.remoteUsers.find(c=>c.uid===e);if(!a)throw new de(q.INVALID_REMOTE_USER,"user is not in the channel");e=a}return t==="datachannel"?this._subscribeDataChannel(e,s):this._subscribe(e,t)}async presubscribe(e,t){if(er(t,"mediaType",["audio","video"]),this.store.useP2P)throw new de(q.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new de(q.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let s=t===ze.AUDIO,a=t===ze.VIDEO,c=await this._subscribeMutex.lock();try{let{ssrcId:d,ortc:h,rtxSsrcId:p,cname:f,uint_id:_}=await this._gateway.presubscribe(e,t,!0);if(d==null)throw new de(q.UNEXPECTED_RESPONSE,"no ssrc id");let v=this._users.find(w=>w.uid===e);v||(v=new Zc(e,_||e),v._is_pre_created=!0,this._users.push(v)),f&&(v._cname=f),v._uintid||(v._uintid=_||e),s&&(v._audioSSRC=d,v._audio_pre_subscribed=!0,h&&(v._audioOrtc=h)),a&&(v._videoSSRC=d,v._video_pre_subscribed=!0,h&&(v._videoOrtc=h),p!=null&&(v._rtxSsrcId=p)),A.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(v,t,d,p,h);let b=s?v._audioTrack:v._videoTrack;if(!b)throw new de(q.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(v._trust_audio_stream_added_state_=!0,v._audio_added_=!0),a&&(v._trust_video_stream_added_state_=!0,v._video_added_=!0),b}catch(d){throw A.error("[".concat(this._clientId,"] presub user ").concat(e," error"),d),d}finally{c()}}async _subscribeDataChannel(e,t){var s;if(ns(t,"channelId",0,65535,!0),!this._joinInfo)throw new de(q.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new de(q.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new de(q.INVALID_REMOTE_USER,"user is not published");let a=(s=e._dataChannels)===null||s===void 0?void 0:s.find(h=>h.id===t);if(!a)throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new de(q.REMOTE_USER_IS_NOT_PUBLISHED);let c=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let h=await this._p2pChannel.subscribeDataChannel(e,[a]);if(h&&ke(h).call(h,a.id))try{var d;if(typeof a._originDataChannelId!="number")throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new de(q.CREATE_DATACHANNEL_ERROR);let p={id:a.id,datachannelId:a._originDataChannelId,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:(d=a.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(e.uid,p,!0),await a._waitTillOpen()}catch(p){if((p==null?void 0:p.code)!==q.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[a]),p;await this._p2pChannel.unsubscribeDataChannel(e,[a]),this._p2pChannel.setPendingRemoteDataChannel(e,a.id)}return A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),a}finally{c()}}async _p2pSubscribe(e,t,s){if(er(t,"mediaType",["audio","video"]),!this._joinInfo)throw new de(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){let c=new de(q.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){let c=new de(q.INVALID_REMOTE_USER,"user is not published");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!s&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let c=new de(q.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}let a=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let d=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,d,h)}catch(d){throw d}A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{A.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});let c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new de(q.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw A.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{a()}}async _subscribe(e,t,s){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(er(t,"mediaType",["audio","video"]),!this._joinInfo)throw new de(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){let f=new de(q.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){let f=new de(q.INVALID_REMOTE_USER,"user is not published");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(s||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let f=new de(q.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let a=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?ze.AUDIO:ze.VIDEO,ssrcId:a};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});let p=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let _=t==="audio"?e._audioSSRC:e._videoSSRC;_!==void 0&&_!==a&&(a=_,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?ze.AUDIO:ze.VIDEO,ssrcId:a}),Fr.markSubscribeStart(this.store.clientId,a),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,a,d,c);try{this._p2pChannel.isPreSubScribe(a)||await this._gateway.subscribe(e.uid,h,!0)}catch(v){if((v==null?void 0:v.code)!==q.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),v;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,e,t),_}A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(_=>{A.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});let f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new de(q.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),f}catch(f){throw A.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{p()}}async massSubscribe(e){if(nc(e,"subscribeList"),!this._joinInfo)throw new de(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),s=new Map,a=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(p=>{let{user:f,mediaType:_}=p;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(_)}).join("; ")));let c=(e=[...e]).map(p=>{let{user:f,mediaType:_}=p;return{user:f,mediaType:_}}),d=await this._p2pChannel.globalLock();try{var h;for(let f=e.length-1;f>=0;f--){let _=e[f],{user:v,mediaType:b}=_;if(er(b,"mediaType",["audio","video"]),!v){let U=new de(q.INVALID_PARAMS,"user property does not exist in subscribeList item");throw A.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===v)){let U=new de(q.INVALID_REMOTE_USER,"user is not in the channel");A.error("[".concat(this._clientId,"] can not massSubscribe ").concat(v.uid,", this user is not in the channel")),c[f].error=U,e.splice(f,1);continue}if(b==="audio"&&(!v.hasAudio||v._audioSSRC===void 0)||b==="video"&&(!v.hasVideo||v._videoSSRC===void 0)){let U=new de(q.REMOTE_USER_IS_NOT_PUBLISHED);A.error("[".concat(this._clientId,"] can not subscribe ").concat(v.uid," with mediaType ").concat(b,", remote user is not published")),c[f].error=U,e.splice(f,1);continue}let w=or.Video|or.LwoVideo,T=s.get(v);if(T){if(b==="video"?T&w:T&or.Audio){e.splice(f,1),A.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(v.uid,", mediaType:").concat(b," twice"));continue}s.set(v,T|(b==="video"?w:or.Audio))}else s.set(v,b==="video"?w:or.Audio)}for(let f=e.length-1;f>=0;f--){let _=e[f],{user:v,mediaType:b}=_,w=or.Video|or.LwoVideo;if(this._p2pChannel.hasRemoteMedia(v,b)){await this._p2pChannel.unmuteRemoteNoLock(v,b);let T=s.get(v);s.set(v,b==="video"?T^w:T^or.Audio),e.splice(f,1)}}this.store.massSubscribe(e.map(f=>({userId:f.user.uid,type:f.mediaType})),t);let p=Ji(h=Array.from(s.entries())).call(h,(f,_)=>{let[v,b]=_;if(b===0)return f;let w={stream_id:v.uid,stream_type:b};return b&or.Audio&&(w.audio_ssrc=v._audioSSRC),b&or.Video&&(w.video_ssrc=v._videoSSRC),f.push(w),f},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(_=>{let{user:v,mediaType:b}=_;return{user:v,mediaType:b,ssrcId:b===ze.VIDEO?v._videoSSRC:v._audioSSRC,rtxSsrcId:b===ze.VIDEO?v._rtxSsrcId:void 0}}));let f=new Map;if(p=p.filter(_=>_.video_ssrc&&!this._p2pChannel.isPreSubScribe(_.video_ssrc)||_.audio_ssrc&&!this._p2pChannel.isPreSubScribe(_.audio_ssrc)||!_.video_ssrc&&!_.audio_ssrc),p.length>0){let _=await this._gateway.subscribeAll(p,!0);((_==null?void 0:_.users)||[]).forEach(v=>{let{stream_id:b,video_error_code:w,audio_error_code:T,error_code:U}=v;(w||T||U)&&f.set(b,{video_error_code:w,audio_error_code:T,error_code:U})})}if(Array.from(f.entries()).length>0){let _=[];Array.from(f.entries()).forEach(v=>{let[b,w]=v,T=this.remoteUsers.find(U=>U.uid===b);if(T){let U;w.error_code||w.video_error_code&&w.audio_error_code?U=void 0:w.video_error_code?U=ze.VIDEO:w.audio_error_code&&(U=ze.AUDIO),_.push({user:T,mediaType:U})}}),_.length>0&&await this._p2pChannel.massUnsubscribeNoLock(_)}for(let _ of c){let v=f.get(_.user.uid);if(v){let b=v.error_code||_.mediaType==="audio"&&v.audio_error_code||_.mediaType==="video"&&v.video_error_code;if(b){let w=qm(b);A.error("user:".concat(_.user.uid," mediaType:").concat(_.mediaType," has massSubscribe error ").concat(w.desc)),_.error=new de(q.SUBSCRIBE_FAILED,"code ".concat(b,": ").concat(w.desc))}}_.error||(_.mediaType==="video"?_.track=_.user.videoTrack:_.track=_.user.audioTrack)}return this.store.massSubscribe(c.filter(_=>!_.error).map(_=>({userId:_.user.uid,type:_.mediaType})),void 0,Date.now()),c.forEach(_=>{var v;Ze.subscribe(this.store.sessionId,{succ:!!_.error,ec:((v=_.error)===null||v===void 0?void 0:v.code)||null,video:_.mediaType===ze.VIDEO,audio:_.mediaType===ze.AUDIO,peerid:_.user.uid,subscribeRequestid:_.mediaType===ze.VIDEO?_.user._videoSSRC:_.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(_.user._videoSSRC)},!0)}),A.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(_=>{let{user:v,mediaType:b}=_;return"user: ".concat(v==null?void 0:v.uid,", mediaType: ").concat(b)}).join("; "))),c}catch(f){throw await this._p2pChannel.massUnsubscribeNoLock(e),f}}finally{d(),a()}}async unsubscribe(e,t,s){if(!(e instanceof Zc)){let c=this.remoteUsers.find(d=>d.uid===e);if(!c)throw new de(q.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,s)}else await this._unsubscribeDataChannel(e,s);if(t&&er(t,"mediaType",["audio","video"]),!this._joinInfo)throw new de(q.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){let c=new de(q.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}A.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let a=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let c=await this._p2pChannel.unsubscribe(e,t);c&&await this._gateway.unsubscribe(c,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Ov(this._users,e),A.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===q.DISCONNECT_P2P)return void A.warning("disconnecting p2p, abort unsubscribe request.");throw A.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{a()}}async _unsubscribeDataChannel(e,t){if(t&&ns(t,"id",0,65535,!0),!this._joinInfo)throw new de(q.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(a=>a===e)){let a=new de(q.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}let s;if(typeof t=="number"){let a=e._dataChannels.find(c=>c.id===t);a&&(s=[a])}else s=e._dataChannels;if(s===void 0){let a=new de(q.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),a}A.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s.map(a=>a.id)));try{let a=await this._p2pChannel.unsubscribeDataChannel(e,s);a&&await this._gateway.unsubscribeDataChannel(a,e.uid),A.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a))}catch(a){if(a.code===q.DISCONNECT_P2P)return void A.warning("disconnecting p2p, abort unsubscribe request.");throw A.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}}async massUnsubscribe(e){if(nc(e,"unsubscribeList"),!this._joinInfo)throw new de(q.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");A.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];let t=new Map;for(let s=e.length-1;s>=0;s--){let{user:a,mediaType:c}=e[s];if(!a){let h=new de(q.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw A.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(er(c,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===a)){A.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),e.splice(s,1);continue}let d=or.Video|or.LwoVideo;if(t.has(a)){let h=t.get(a),p;switch(c){case"video":p=h&d;break;case"audio":p=h&or.Audio;break;default:p=h&(or.Audio|d)}if(p){A.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),e.splice(s,1);continue}c?c==="audio"?t.set(a,h|or.Audio):c==="video"&&t.set(a,h|d):t.set(a,h|or.Audio|d)}else c?c==="audio"?t.set(a,or.Audio):c==="video"&&t.set(a,d):t.set(a,or.Audio|d)}try{let s=await this._p2pChannel.massUnsubscribe(e);s&&await this._gateway.massUnsubscribe(s),A.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===q.DISCONNECT_P2P)return void A.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw A.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(e){(function(s){if(!s)throw new _e(q.INVALID_PARAMS);As(s.width)||E0(s.width,"streamParameter.width"),As(s.height)||E0(s.height,"streamParameter.height"),As(s.framerate)||E0(s.framerate,"streamParameter.framerate"),As(s.bitrate)||ns(s.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&A.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),A.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ie.LocalVideoLowTrack)}async enableDualStream(){if(!Vt().supportDualStream)throw Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new de(q.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new de(q.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),A.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new de(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ie.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),A.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(a){er(a,"role",["audience","host"])}(e),t&&w0(t),this.mode==="rtc"||this.mode==="p2p")throw A.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new de(q.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new de(q.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new de(q.INVALID_OPERATION,"can not set client role to audience when publishing stream");let s=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==s&&$("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Nr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),A.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&w0(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{A.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let s=t.timestamp-Date.now();return Math.abs(s)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(gr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new de(q.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new de(q.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Ze.setProxyServer(this._proxyServer),A.setProxyServer(this._proxyServer),A.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new de(q.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new de(q.INVALID_OPERATION,"You have already set the proxy")}if(km(e))return this._turnServer={servers:e,mode:"original-manual"},void A.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(s=>s.urls).join(","),"."));e.forEach(s=>mL(s)),this._turnServer={servers:e,mode:"manual"},A.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new de(q.INVALID_OPERATION,"you should set license before join channel");if(gr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new de(q.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,A.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new de(q.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new de(q.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],s;switch(e===void 0&&(e=3),e){case 1:case 2:throw new de(q.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new de(q.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,A.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new de(q.INVALID_OPERATION,"Stop proxy server after leave channel");Ze.setProxyServer(),A.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",A.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new de(q.INVALID_PARAMS,"accessPoints is required.");nc(e.accessPoints.serverList,"accessPoints.serverList"),gr(e.accessPoints.domain,"accessPoints.domain");let t=(w,T)=>{ns(w,T,0,65535,!0)},s=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),s=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new de(q.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");$("CLOSE_AFB_FOR_LOCAL_AP")&&(ts("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),ts("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,d=e.accessPoints.serverList.map(w=>a.test(w)?"".concat(w.replace(/\./g,"-"),".").concat(c):w),h=d.map(w=>"".concat(w,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,ts("WEBCS_DOMAIN",h),ts("WEBCS_DOMAIN_BACKUP_LIST",h),ts("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(nc(e.report.hostname,"report.hostname"),ts("EVENT_REPORT_DOMAIN",e.report.hostname[0]),ts("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(ts("EVENT_REPORT_DOMAIN",d[0]),ts("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let p=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),p=e.report.port),ts("STATS_COLLECTOR_PORT",p),e.report?ts("ENABLE_EVENT_REPORT",!0):ts("ENABLE_EVENT_REPORT",!1);let f="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(nc(e.log.hostname,"log.hostname"),f=e.log.hostname[0]):f=d[0];let _=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),_=e.log.port),ts("LOG_UPLOAD_SERVER","".concat(f,":").concat(_));let v=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(nc(e.cds.hostname,"cds.hostname"),v=e.cds.hostname):v=d;let b=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),b=e.cds.port),ts("CDS_AP",v.map(w=>"".concat(w,":").concat(b))),e.cds?ts("ENABLE_CONFIG_DISTRIBUTE",!0):ts("ENABLE_CONFIG_DISTRIBUTE",!1),A.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(nc(e,"serverList"),gr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new de(q.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(t):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,ts("WEBCS_DOMAIN",e),ts("WEBCS_DOMAIN_BACKUP_LIST",e),ts("GATEWAY_DOMAINS",[t]),ts("EVENT_REPORT_DOMAIN",e[0]),ts("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),ts("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),A.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(er(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw A.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else A.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){er(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let s=this._users.find(a=>a.uid===e);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw A.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}A.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){er(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(s){throw A.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}A.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,s,a){(function(d){er(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),gr(t,"secret");let c=["aes-128-gcm2","aes-256-gcm2"];if(ke(c).call(c,e)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new de(q.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new de(q.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(Ua(a,"encryptDataStream"),!ke(c).call(c,e))throw new de(q.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||A.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,s&&(this._encryptionSalt=Wc(s))}async renewToken(e){if(gr(e,"token",1,2047),!this._key||!this._joinInfo)throw new de(q.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let s=await this._renewTokenMutex.lock();try{if($("USE_NEW_TOKEN")){A.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let a=await Wae(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ks);A.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:a})}else A.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});A.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=t,this._joinInfo.token=t,A.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?A.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(At.VOLUME_INDICATOR,e)},$("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new de(q.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new de(q.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new de(q.LIVE_STREAMING_TASK_CONFLICT);let s=t?ic.TRANSCODE:ic.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(e,s)}setLiveTranscoding(e){return this._createLiveStreamingClient(ic.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(e));if(!t.length)throw new de(q.INVALID_PARAMS,"can not find live streaming url to stop");await Be.all(t.map(s=>s&&s.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){t5(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){t5(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof rf&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new de(q.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let c=new TextEncoder;e.payload=c.encode(e.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(a=!0,e.payload=await async function(c,d,h){var p;let f=Ji(p=Array.from(h)).call(p,(k,F)=>k+F,0),_={serverTs:0,seq:lie++,length:h.length,checkSum:f},v=new Uint8Array(bL(f,2)),b=new ArrayBuffer(sh),w=new DataView(b);w.setUint32(0,_.serverTs),w.setUint16(4,_.seq),w.setUint16(6,_.length),w.setUint16(8,_.checkSum);let T=16-h.length%16;h=_L(h,new Uint8Array(T));let U=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:kL,additionalData:v},d,h);return _L(new Uint8Array(b),new Uint8Array(U))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new de(q.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(pt.DATA_STREAM,{payload:Wc(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Xae},!s)}sendMetadata(e){if(!this._joinInfo)throw new de(q.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new de(q.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(pt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Wc(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(vie),!this._joinInfo)throw new de(q.INVALID_OPERATION,"can not send custom report, not joined");await Ze.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let e=this._statsCollector.getRemoteNetworkQualityStats();if($("DELETE_NEQ_AFTER_USER_LEAVE")){let t=this._users.map(s=>s.uid+"");Object.keys(e).forEach(s=>{ke(t).call(t,s)||delete e[s]})}return e}async pickSVCLayer(e,t){er(t.spatialLayer,"spatialLayer",[0,1,2,3]),er(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(s){throw A.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:s}=e;if(Ua(t,"apRTM"),ns(s,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=s,A.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(A.debug("[".concat(this._clientId,"] reset client")),function(e){let t=mh.indexOf(e);t!==-1&&mh.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=pn.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&N5(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ze.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Pr("client-publish",this._clientId),this._subscribeMutex=new Pr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var s;let a=e||dd();e?A.debug("[".concat(this._clientId,"] new Session ").concat(a)):A.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));let c=e?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,Ze.addSid(a);let d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Ze.sessionInit(this._sessionId,pa({cname:t.channel,appid:t.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new de(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new de(q.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");A.debug("[".concat(this._clientId,"] publish high stream"));try{let s=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(Ms.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let a=(await s.next()).value;if(a){var t;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==q.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let c of e)c instanceof hs&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{A.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,e),(s==null?void 0:s.code)===q.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new de(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new de(q.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));A.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var t;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==q.DISCONNECT_P2P)throw s.throw(d),d}s.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===q.WS_ABORT)return;throw s}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new de(q.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},cc("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,d)=>{Ze.reportApiInvoke(this._sessionId,{name:ks.ON_LIVE_STREAM_ERROR,options:[c,d],tag:xs.TRACER}).onSuccess(),this.safeEmit(At.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{Ze.reportApiInvoke(this._sessionId,{name:ks.ON_LIVE_STREAM_WARNING,options:[c,d],tag:xs.TRACER}).onSuccess(),this.safeEmit(At.LIVE_STREAMING_WARNING,c,d)},s.on(_C.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new de(q.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(p,f,_,v){let b=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(w=>f.proxyServer?"https://".concat(f.proxyServer,"/ap/?url=").concat(w+"/api/v1?action=uap"):"https://".concat(w,"/api/v1?action=uap"));return await kae(b,p,f,_,v)})(c,this._joinInfo,this._axiosCancelSource.token,Ks).then(d).catch(h)}),s};return e===ic.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new de(q.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:s}},cc("ChannelMediaRelay").create(e));a.on("state",c=>{c===Tn.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(At.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(At.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:s,deleted:a}=e,c=[];if(t){let d=[];this._users.forEach(h=>{h._dataChannels.forEach(p=>{s.every(f=>f.uid!==h._uintid||f.stream_id!==p.id)&&d.push({uid:h._uintid,stream_id:p.id,ordered:p.ordered,max_retrans_times:p.maxRetransmits,metadata:p.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach(d=>{let{uid:h,stream_id:p,ordered:f,max_retrans_times:_,metadata:v}=d,b=this._users.find(w=>w._uintid===h);if(!b)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(A.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ke(c).call(c,b)||c.push(b),b._uintid||(b._uintid=h),b._dataChannels.findIndex(w=>w.id===d.stream_id)===-1){let w={id:p,ordered:!!f,maxRetransmits:_,metadata:v},T=function(U){return UU(U,!0)}(w);b._dataChannels.push(T),A.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published datachannel")),t||this.safeEmit(At.USER_PUBLISHED,b,"datachannel",w)}this._p2pChannel.hasPendingRemoteDataChannel(b,d.stream_id)&&(A.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(b.uid," after reconnect.")),this._subscribeDataChannel(b,d.stream_id).catch(w=>{A.error("[".concat(this._clientId,"] resubscribe datachannel error"),w.toString())}))}),t&&(this.safeEmit(At.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{let{uid:h,stream_id:p}=d,f=this._users.find(v=>v._uintid===h);if(!f)return void A.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let _=f._dataChannels.find(v=>v.id===d.stream_id);_&&(A.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(f,[_]).then(v=>{if(f._dataChannels=f._dataChannels.filter(b=>b!==_),v)return this._gateway.unsubscribeDataChannel(v,f.uid)}),A.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(_.id)),this.safeEmit(At.USER_UNPUBLISHED,f,"datachannel",_._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;let s=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(s)for(let c of s){var a;if(c.payloadType===e)return c==null||(a=c.rtpMap)===null||a===void 0?void 0:a.encodingName}}_handleRemoveDataChannels(e){let t=this._users.find(s=>s.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){A.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let s=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(a=>{this.safeEmit(At.USER_UNPUBLISHED,t,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,t.uid)}),s()}}else A.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(dr.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void A.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),s=Date.now();Object.keys(t).forEach(a=>{let{value:c,type:d,expires:h}=t[a];h&&h<=s||d||dC()||!Object.prototype.hasOwnProperty.call(Fv,a)||(Ba[a]=c,Es[a]=c,A.debug("Update gateway parameters from config distribute",a,c))})}catch(t){A.error("Error update config from local cache",t.message)}})()}),this._gateway.on(dr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(dr.CONNECTION_STATE_CHANGE,(e,t,s)=>{var a;if(s===$t.FALLBACK)return;let c=()=>{this.safeEmit(At.CONNECTION_STATE_CHANGE,e,t,s)};if(Ze.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:ks.CONNECTION_STATE_CHANGE,options:[e,t,s],tag:xs.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:s})),A.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,p)=>{this._gateway.setStreamFallbackOption(p,h).catch(f=>{A.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),f)})}),this._remoteStreamTypeCacheMap.forEach((h,p)=>{this._gateway.setRemoteVideoStreamType(p,h).catch(f=>{A.warning("[".concat(this._clientId,"] auto set remote stream type failed"),f)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{A.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{A.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{A.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(A.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ze.AUDIO,!1)),h._trust_video_mute_state_||(A.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ze.VIDEO,!1)),h._trust_audio_enabled_state_||(A.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(A.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(A.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(A.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(A.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(dr.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new de(q.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s,a=await C5(pa(pa({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,R5(a),this._joinInfo.preload=!0):(s=await jC(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ks,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);let c=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d,[p,f]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:p,port:f}):c.push({host:p,port:f})}),e(c)}catch(s){t(s)}}),this._gateway.on(dr.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(At.NETWORK_QUALITY,e)}),this._gateway.on(dr.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(At.STREAM_TYPE_CHANGED,e,t),Ze.reportApiInvoke(this._sessionId,{name:ks.STREAM_TYPE_CHANGE,options:[e,t],tag:xs.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(dr.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(dr.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,s)=>{try{let a=await this._p2pChannel.getEstablishParams();a&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(a=await this._p2pChannel.startP2PConnection(e)),t(a)}catch(a){s(a)}}),this._gateway.on(dr.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let s;this._joinResponse=e,e.attributes?s=e.attributes.userAttributes.preSubSsrcs:A.debug("no attributes in joinResponse");let a=NU(e.ortc,t,s);this._p2pChannel.connect(a)}),this._gateway.on(dr.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:s,turnServer:a}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){let{cert:d,cid:h}=this._joinInfo.apResponse,p="".concat(h,"_").concat(d);if(p.length<4||p.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(d),icePwd:"".concat(h,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=$("FINGERPRINT"))!==null&&c!==void 0?c:s}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(f){f.code&&f.code===q.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(It.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(It.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(It.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(It.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(It.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(It.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(It.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(It.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(It.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,ze.AUDIO,!0)),this._gateway.signal.on(It.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,ze.AUDIO,!1)),this._gateway.signal.on(It.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,ze.VIDEO,!0)),this._gateway.signal.on(It.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,ze.VIDEO,!1)),this._gateway.signal.on(It.RECEIVE_METADATA,e=>{let t=ld(e.metadata);this.safeEmit(At.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(It.ON_DATA_STREAM,async e=>{var t;if(!e)return;let s=ld(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<sh)throw new de(q.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(sh));s=await async function(c,d,h){let p=h.subarray(0,sh),f=p.slice(8,sh),_=(f[0]<<8)+f[1],v=(p[6]<<8)+p[7],b=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:kL,additionalData:new Uint8Array(bL(_,2))},d,h.subarray(sh));return new Uint8Array(b).subarray(0,v)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(e.ordered||e.syncWithAudio){let c=this._p2pChannel.getStats(),d=this.remoteUsers.find(p=>p.uid===e.uid),h=c==null?void 0:c.audioRecv.find(p=>p.ssrc===(d==null?void 0:d._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),Qae(pa(pa({},e),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(It.ON_CRYPT_ERROR,()=>{Bc(()=>{A.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(At.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(It.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(It.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{A.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,$t.TOKEN_EXPIRE),this.safeEmit(At.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(It.ON_STREAM_FALLBACK_UPDATE,e=>{A.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(At.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(It.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),A.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(It.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(It.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ft.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case pt.PUBLISH:{if(!t)return;let c=t.ortc;if(c){var s,a;let d=c.some(f=>{let{stream_type:_}=f;return _===Qt.Audio}),h=c.some(f=>{let{stream_type:_}=f;return _!==Qt.Audio}),p=c.some(f=>{let{stream_type:_}=f;return _===Qt.Screen||_===Qt.ScreenLow});t.state==="offer"&&Ze.publish(this._joinInfo.sid,{eventElapse:Fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:q.TIMEOUT,audio:d,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:d?(s=c.find(f=>{let{stream_type:_}=f;return _===Qt.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find(f=>{let{stream_type:_}=f;return _!==Qt.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case pt.SUBSCRIBE:t&&Ze.subscribe(this._joinInfo.sid,{succ:!1,ec:q.TIMEOUT,audio:t.stream_type===ze.AUDIO,video:t.stream_type===ze.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Fr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(It.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(It.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;$("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(a=>!vd(a.string_id||a.stream_id,this.channelName)));let t=[],s=[];for(let a of e.users){let c=this._users.find(v=>v._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new Zc(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(At.PUBLISHED_USER_LIST).length===0&&(A.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(At.USER_JOINED,c)));let d=or.Audio&a.stream_type,h=(or.Video|or.LwoVideo)&a.stream_type,p=(65280&a.stream_type)!=0,f=d&&c.hasAudio,_=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!f&&this.getListeners(At.PUBLISHED_USER_LIST).length===0&&(A.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(At.USER_PUBLISHED,c,"audio")),h&&!_&&this.getListeners(At.PUBLISHED_USER_LIST).length===0&&(A.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(At.USER_PUBLISHED,c,"video")),(d&&!f||h&&!_||p)&&t.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(A.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{A.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(At.PUBLISHED_USER_LIST).length>0?$("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(A.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(a=>a.uid).join(", "))),this.safeEmit(At.PUBLISHED_USER_LIST,t)):A.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(It.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof rf&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(s=>s.toLowerCase()).filter(s=>{var a;return ke(a=Object.keys(Vm)).call(a,s)}))})}_handleP2PEvents(){this._gateway.signal.on(It.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ms.PUBLISH,(e,t,s)=>{let{uid:a}=e;e.forEach(c=>{let{kind:d,ssrcs:h,mid:p,isMuted:f}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,p);let _=this._users.find(v=>v.uid===a);return _&&this.store.useP2P?this._p2pChannel.mockSubscribe(_,d,h[0].ssrcId,p).then(()=>{t()}).catch(s):t(),this._handleMuteStream(a,d,!!f)})}),this._gateway.signal.on(Ms.CALL,async(e,t,s)=>{if(this.store.useP2P)try{var a;t(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},e))}catch(c){s(c)}}),this._gateway.signal.on(ft.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Ms.UNPUBLISH,async(e,t,s)=>{if(this.store.useP2P){let{unpubMsg:a,uid:c}=e,d=this._users.find(h=>h.uid===c);if(!d)return A.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{a.forEach(async h=>{let{stream_type:p}=h,f=p===Qt.Audio?ze.AUDIO:ze.VIDEO;await this._p2pChannel.unsubscribe(d,f),this._handleMuteStream(c,f,!0)}),t()}catch(h){s(h)}}}),this._gateway.signal.on(Ms.CONTROL,async(e,t)=>{let{action:s}=e;switch(s){case Kc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,ze.VIDEO,!0);break;case Kc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,ze.AUDIO,!0);break;case Kc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,ze.VIDEO,!1);break;case Kc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,ze.AUDIO,!1)}}),this._gateway.signal.on(Ms.RESTART_ICE,async(e,t,s)=>{if(this.store.useP2P)try{let{direction:a,iceParameter:c}=e;a!==on.SEND_ONLY||c?t(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),t())}catch(a){s(a)}}),this._gateway.signal.on(Ms.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:s}=e;this._p2pChannel.addRemoteCandidate(t,s)}}),this._p2pChannel.on(nt.RequestP2PRestartICE,async(e,t,s)=>{try{let{direction:a}=e;t(await this._gateway.sendExtensionMessage(Ms.RESTART_ICE,e,a===on.SEND_ONLY))}catch(a){s(a)}}),this._p2pChannel.on(nt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Ms.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(nt.RequestP2PMuteLocal,async(e,t,s)=>{try{await this._gateway.sendExtensionMessage(Ms.CONTROL,e,!0),t()}catch(a){s(a)}}),this._p2pChannel.on(nt.RequestP2PUnmuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===q.DISCONNECT_P2P?t():s(a)}else t()}),this._p2pChannel.on(nt.RequestP2PMuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===q.DISCONNECT_P2P?t():s(a)}else t()}),this._p2pChannel.on(nt.StateChange,(e,t)=>{t===Xt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(nt.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(At.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(nt.RequestMuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===q.DISCONNECT_P2P?t():s(a)}else t()}),this._p2pChannel.on(nt.RequestUnmuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===q.DISCONNECT_P2P?t():s(a)}else t()}),this._p2pChannel.on(nt.RequestRePublish,(e,t,s)=>{this.publish(e,!1).then(t).catch(s)}),this._p2pChannel.on(nt.RequestRePublishDataChannel,(e,t,s)=>{Be.all(e.map(async a=>{let c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==q.DISCONNECT_P2P)throw d}})).then(t).catch(s)}),this._p2pChannel.on(nt.RequestReSubscribe,async(e,t,s)=>{try{for(let{user:a,kind:c}of e)c===ze.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");t()}catch(a){s(a)}}),this._p2pChannel.on(nt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(nt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(nt.MediaReconnectStart,e=>{this.safeEmit(At.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(nt.MediaReconnectEnd,e=>{this.safeEmit(At.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(nt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(nt.RequestRestartICE,async e=>{if(this.store.useP2P)return;let t=await this._p2pChannel.restartICE(e),s=await t.next();if(s.done)return;let a=s.value,c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void t.throw(h)}let{iceParameters:d}=function(h){let p=h.iceParameters;return{iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd}}}(c);await t.next({remoteIceParameters:d})}),this._p2pChannel.on(nt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(nt.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:s,rtpCapabilities:a}),h=NU(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(nt.RequestUnpublishForReconnectPC,async(e,t,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):s()}),this._p2pChannel.on(nt.P2PLost,()=>{this.safeEmit(At.P2P_LOST,this.store.uid)}),this._p2pChannel.on(nt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(nt.ConnectionTypeChange,e=>{this.safeEmit(At.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(nt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(nt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(nt.AudioMetadata,e=>{this.safeEmit(At.AUDIO_METADATA,e)}),this._p2pChannel.on(nt.AudioPts,e=>{this.safeEmit(At.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let s=(t={config:e},cc("ContentInspect").create(t));this._inspect=s,this.handleVideoInspectEvents(s);let{appId:a,cname:c,sid:d,token:h,uid:p,cid:f,vid:_}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:p,cid:f,vid:_?Number(_):0},Ks)}catch(s){throw Array.isArray(s)?s[0]:s}var t}handleVideoInspectEvents(e){e.on(ur.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(At.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,s),s===la.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(At.CONTENT_INSPECT_ERROR,new de(q.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(ur.INSPECT_RESULT,(t,s)=>{var a;if((s==null?void 0:s.code)===q.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return A.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(At.CONTENT_INSPECT_RESULT,t,s)}),e.on(ur.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Ua(e,"enabled"),e){if(!t)throw new de(q.INVALID_PARAMS,"config is required");if(B5(t),!this._joinInfo)throw new de(q.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let a=(s={config:t},cc("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);let{appId:c,cname:d,sid:h,token:p,uid:f,cid:_,vid:v}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:p,uid:f,cid:_,vid:v?Number(v):0},Ks)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new de(q.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(e){e.on(Ha.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(At.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,s),t===Pi.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new de(q.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Ha.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){er(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new de(q.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,A.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return A.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Ua(e,"enabled"),ts("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Je(He.prototype,"leave",[W5],Object.getOwnPropertyDescriptor(He.prototype,"leave"),He.prototype),Je(He.prototype,"publish",[G5],Object.getOwnPropertyDescriptor(He.prototype,"publish"),He.prototype),Je(He.prototype,"unpublish",[H5],Object.getOwnPropertyDescriptor(He.prototype,"unpublish"),He.prototype),Je(He.prototype,"subscribe",[z5],Object.getOwnPropertyDescriptor(He.prototype,"subscribe"),He.prototype),Je(He.prototype,"presubscribe",[K5],Object.getOwnPropertyDescriptor(He.prototype,"presubscribe"),He.prototype),Je(He.prototype,"massSubscribe",[q5],Object.getOwnPropertyDescriptor(He.prototype,"massSubscribe"),He.prototype),Je(He.prototype,"unsubscribe",[Y5],Object.getOwnPropertyDescriptor(He.prototype,"unsubscribe"),He.prototype),Je(He.prototype,"massUnsubscribe",[$5],Object.getOwnPropertyDescriptor(He.prototype,"massUnsubscribe"),He.prototype),Je(He.prototype,"setLowStreamParameter",[X5],Object.getOwnPropertyDescriptor(He.prototype,"setLowStreamParameter"),He.prototype),Je(He.prototype,"enableDualStream",[J5],Object.getOwnPropertyDescriptor(He.prototype,"enableDualStream"),He.prototype),Je(He.prototype,"disableDualStream",[Q5],Object.getOwnPropertyDescriptor(He.prototype,"disableDualStream"),He.prototype),Je(He.prototype,"setClientRole",[Z5],Object.getOwnPropertyDescriptor(He.prototype,"setClientRole"),He.prototype),Je(He.prototype,"_setClientRoleOptions",[eV],Object.getOwnPropertyDescriptor(He.prototype,"_setClientRoleOptions"),He.prototype),Je(He.prototype,"setProxyServer",[tV],Object.getOwnPropertyDescriptor(He.prototype,"setProxyServer"),He.prototype),Je(He.prototype,"setTurnServer",[sV],Object.getOwnPropertyDescriptor(He.prototype,"setTurnServer"),He.prototype),Je(He.prototype,"setLicense",[rV],Object.getOwnPropertyDescriptor(He.prototype,"setLicense"),He.prototype),Je(He.prototype,"startProxyServer",[nV],Object.getOwnPropertyDescriptor(He.prototype,"startProxyServer"),He.prototype),Je(He.prototype,"stopProxyServer",[iV],Object.getOwnPropertyDescriptor(He.prototype,"stopProxyServer"),He.prototype),Je(He.prototype,"setLocalAccessPointsV2",[aV],Object.getOwnPropertyDescriptor(He.prototype,"setLocalAccessPointsV2"),He.prototype),Je(He.prototype,"setLocalAccessPoints",[oV],Object.getOwnPropertyDescriptor(He.prototype,"setLocalAccessPoints"),He.prototype),Je(He.prototype,"setRemoteDefaultVideoStreamType",[cV],Object.getOwnPropertyDescriptor(He.prototype,"setRemoteDefaultVideoStreamType"),He.prototype),Je(He.prototype,"setRemoteVideoStreamType",[lV],Object.getOwnPropertyDescriptor(He.prototype,"setRemoteVideoStreamType"),He.prototype),Je(He.prototype,"setStreamFallbackOption",[dV],Object.getOwnPropertyDescriptor(He.prototype,"setStreamFallbackOption"),He.prototype),Je(He.prototype,"setEncryptionConfig",[uV],Object.getOwnPropertyDescriptor(He.prototype,"setEncryptionConfig"),He.prototype),Je(He.prototype,"renewToken",[hV],Object.getOwnPropertyDescriptor(He.prototype,"renewToken"),He.prototype),Je(He.prototype,"enableAudioVolumeIndicator",[pV],Object.getOwnPropertyDescriptor(He.prototype,"enableAudioVolumeIndicator"),He.prototype),Je(He.prototype,"startLiveStreaming",[mV],Object.getOwnPropertyDescriptor(He.prototype,"startLiveStreaming"),He.prototype),Je(He.prototype,"setLiveTranscoding",[fV],Object.getOwnPropertyDescriptor(He.prototype,"setLiveTranscoding"),He.prototype),Je(He.prototype,"stopLiveStreaming",[gV],Object.getOwnPropertyDescriptor(He.prototype,"stopLiveStreaming"),He.prototype),Je(He.prototype,"startChannelMediaRelay",[_V],Object.getOwnPropertyDescriptor(He.prototype,"startChannelMediaRelay"),He.prototype),Je(He.prototype,"updateChannelMediaRelay",[vV],Object.getOwnPropertyDescriptor(He.prototype,"updateChannelMediaRelay"),He.prototype),Je(He.prototype,"stopChannelMediaRelay",[EV],Object.getOwnPropertyDescriptor(He.prototype,"stopChannelMediaRelay"),He.prototype),Je(He.prototype,"sendCustomReportMessage",[yV],Object.getOwnPropertyDescriptor(He.prototype,"sendCustomReportMessage"),He.prototype),Je(He.prototype,"pickSVCLayer",[xV],Object.getOwnPropertyDescriptor(He.prototype,"pickSVCLayer"),He.prototype),Je(He.prototype,"setRTMConfig",[bV],Object.getOwnPropertyDescriptor(He.prototype,"setRTMConfig"),He.prototype),Je(He.prototype,"enableContentInspect",[wV],Object.getOwnPropertyDescriptor(He.prototype,"enableContentInspect"),He.prototype),Je(He.prototype,"disableContentInspect",[SV],Object.getOwnPropertyDescriptor(He.prototype,"disableContentInspect"),He.prototype),Je(He.prototype,"setImageModeration",[CV],Object.getOwnPropertyDescriptor(He.prototype,"setImageModeration"),He.prototype),Je(He.prototype,"setP2PTransport",[TV],Object.getOwnPropertyDescriptor(He.prototype,"setP2PTransport"),He.prototype),Je(He.prototype,"getJoinChannelServiceRecords",[NV],Object.getOwnPropertyDescriptor(He.prototype,"getJoinChannelServiceRecords"),He.prototype),Je(He.prototype,"setPublishAudioFilterEnabled",[RV],Object.getOwnPropertyDescriptor(He.prototype,"setPublishAudioFilterEnabled"),He.prototype),He);class of{constructor(t,s){W(this,"id",0),W(this,"element",void 0),W(this,"peerPair",void 0),W(this,"context",void 0),W(this,"audioPlayerElement",void 0),W(this,"audioTrack",void 0),of.count+=1,this.id=of.count,this.element=t,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let s=document.createElement("audio");s.srcObject=new MediaStream([t.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;let t=async(a,c)=>{let d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new Be(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,c)=>await a.setRemoteDescription(c);try{let a=await t(this.peerPair[0],"offer");await s(this.peerPair[1],a);let c=await t(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new de(q.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let s;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(s)}catch(c){throw new de(q.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new de(q.LOCAL_AEC_ERROR,"no dest node when local aec").print();let a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,s=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){A.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var IV,jE;W(of,"count",0);let foe=window.AudioContext||window.webkitAudioContext,goe=new(IV=ut({report:Ze}),Je((jE=class{constructor(){W(this,"units",[]),W(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return A.debug("the system does not need to process local aec"),-1;this.context||(this.context=new foe);let t=this.units.find(s=>s&&s.getElement()===e);return t||(t=new of(e,this.context),this.units.push(t)),t.startEchoCancellation(),A.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Lt().name!==Wt.SAFARI}}).prototype,"processExternalMediaAEC",[IV],Object.getOwnPropertyDescriptor(jE.prototype,"processExternalMediaAEC"),jE.prototype),jE);function DV(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function OV(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?DV(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):DV(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let QC=window||document;function jV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!QC)return;let s=qs._cspEventHandlerPointer;if(s&&t)return void console.error(s,t);let a=c=>{if(!(c&&c.blockedURI&&(qs.onSecurityPolicyViolation||qs.getListeners(To.SECURITY_POLICY_VIOLATION).length>0)))return;let d=c.blockedURI;$("CSP_DETECTED_HOSTNAME_LIST").some(h=>ke(d).call(d,h))&&(qs.onSecurityPolicyViolation&&typeof qs.onSecurityPolicyViolation=="function"&&qs.onSecurityPolicyViolation(c),qs.getListeners(To.SECURITY_POLICY_VIOLATION).length>0&&qs.safeEmit(To.SECURITY_POLICY_VIOLATION,c))};s&&QC.removeEventListener("securitypolicyviolation",s),(t||e&&typeof e=="function"||qs.getListeners(To.SECURITY_POLICY_VIOLATION).length>0)&&QC.addEventListener("securitypolicyviolation",a),qs._cspEventHandlerPointer=a}var _oe=R,voe=f2,PV=RegExp.prototype,Eoe=function(e){return e===PV||_oe(PV,e)?voe(e):e.flags},en=u(Eoe);function Rh(e){let t=e.length;for(;--t>=0;)e[t]=0}let ZC=256,kV=286,cf=30,lf=15,eT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),PE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),yoe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),LV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dc=new Array(576);Rh(dc);let df=new Array(60);Rh(df);let uf=new Array(512);Rh(uf);let hf=new Array(256);Rh(hf);let tT=new Array(29);Rh(tT);let kE=new Array(cf);function sT(e,t,s,a,c){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=e&&e.length}let MV,FV,UV;function rT(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Rh(kE);let VV=e=>e<256?uf[e]:uf[256+(e>>>7)],pf=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},_i=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,pf(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},Ao=(e,t,s)=>{_i(e,s[2*t],s[2*t+1])},BV=(e,t)=>{let s=0;do s|=1&e,e>>>=1,s<<=1;while(--t>0);return s>>>1},WV=(e,t,s)=>{let a=new Array(16),c,d,h=0;for(c=1;c<=lf;c++)h=h+s[c-1]<<1,a[c]=h;for(d=0;d<=t;d++){let p=e[2*d+1];p!==0&&(e[2*d]=BV(a[p]++,p))}},GV=e=>{let t;for(t=0;t<kV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<cf;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},HV=e=>{e.bi_valid>8?pf(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},zV=(e,t,s,a)=>{let c=2*t,d=2*s;return e[c]<e[d]||e[c]===e[d]&&a[t]<=a[s]},nT=(e,t,s)=>{let a=e.heap[s],c=s<<1;for(;c<=e.heap_len&&(c<e.heap_len&&zV(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!zV(t,a,e.heap[c],e.depth));)e.heap[s]=e.heap[c],s=c,c<<=1;e.heap[s]=a},KV=(e,t,s)=>{let a,c,d,h,p=0;if(e.sym_next!==0)do a=255&e.pending_buf[e.sym_buf+p++],a+=(255&e.pending_buf[e.sym_buf+p++])<<8,c=e.pending_buf[e.sym_buf+p++],a===0?Ao(e,c,t):(d=hf[c],Ao(e,d+ZC+1,t),h=eT[d],h!==0&&(c-=tT[d],_i(e,c,h)),a--,d=VV(a),Ao(e,d,s),h=PE[d],h!==0&&(a-=kE[d],_i(e,a,h)));while(p<e.sym_next);Ao(e,256,t)},iT=(e,t)=>{let s=t.dyn_tree,a=t.stat_desc.static_tree,c=t.stat_desc.has_stree,d=t.stat_desc.elems,h,p,f,_=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(e.heap[++e.heap_len]=_=h,e.depth[h]=0):s[2*h+1]=0;for(;e.heap_len<2;)f=e.heap[++e.heap_len]=_<2?++_:0,s[2*f]=1,e.depth[f]=0,e.opt_len--,c&&(e.static_len-=a[2*f+1]);for(t.max_code=_,h=e.heap_len>>1;h>=1;h--)nT(e,s,h);f=d;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],nT(e,s,1),p=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=p,s[2*f]=s[2*h]+s[2*p],e.depth[f]=(e.depth[h]>=e.depth[p]?e.depth[h]:e.depth[p])+1,s[2*h+1]=s[2*p+1]=f,e.heap[1]=f++,nT(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((v,b)=>{let w=b.dyn_tree,T=b.max_code,U=b.stat_desc.static_tree,k=b.stat_desc.has_stree,F=b.stat_desc.extra_bits,K=b.stat_desc.extra_base,Y=b.stat_desc.max_length,X,re,te,Z,le,xe,Ce=0;for(Z=0;Z<=lf;Z++)v.bl_count[Z]=0;for(w[2*v.heap[v.heap_max]+1]=0,X=v.heap_max+1;X<573;X++)re=v.heap[X],Z=w[2*w[2*re+1]+1]+1,Z>Y&&(Z=Y,Ce++),w[2*re+1]=Z,re>T||(v.bl_count[Z]++,le=0,re>=K&&(le=F[re-K]),xe=w[2*re],v.opt_len+=xe*(Z+le),k&&(v.static_len+=xe*(U[2*re+1]+le)));if(Ce!==0){do{for(Z=Y-1;v.bl_count[Z]===0;)Z--;v.bl_count[Z]--,v.bl_count[Z+1]+=2,v.bl_count[Y]--,Ce-=2}while(Ce>0);for(Z=Y;Z!==0;Z--)for(re=v.bl_count[Z];re!==0;)te=v.heap[--X],te>T||(w[2*te+1]!==Z&&(v.opt_len+=(Z-w[2*te+1])*w[2*te],w[2*te+1]=Z),re--)}})(e,t),WV(s,_,e.bl_count)},qV=(e,t,s)=>{let a,c,d=-1,h=t[1],p=0,f=7,_=4;for(h===0&&(f=138,_=3),t[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=t[2*(a+1)+1],++p<f&&c===h||(p<_?e.bl_tree[2*c]+=p:c!==0?(c!==d&&e.bl_tree[2*c]++,e.bl_tree[32]++):p<=10?e.bl_tree[34]++:e.bl_tree[36]++,p=0,d=c,h===0?(f=138,_=3):c===h?(f=6,_=3):(f=7,_=4))},YV=(e,t,s)=>{let a,c,d=-1,h=t[1],p=0,f=7,_=4;for(h===0&&(f=138,_=3),a=0;a<=s;a++)if(c=h,h=t[2*(a+1)+1],!(++p<f&&c===h)){if(p<_)do Ao(e,c,e.bl_tree);while(--p!=0);else c!==0?(c!==d&&(Ao(e,c,e.bl_tree),p--),Ao(e,16,e.bl_tree),_i(e,p-3,2)):p<=10?(Ao(e,17,e.bl_tree),_i(e,p-3,3)):(Ao(e,18,e.bl_tree),_i(e,p-11,7));p=0,d=c,h===0?(f=138,_=3):c===h?(f=6,_=3):(f=7,_=4)}},$V=!1,XV=(e,t,s,a)=>{_i(e,0+(a?1:0),3),HV(e),pf(e,s),pf(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var xoe=e=>{$V||((()=>{let t,s,a,c,d,h=new Array(16);for(a=0,c=0;c<28;c++)for(tT[c]=a,t=0;t<1<<eT[c];t++)hf[a++]=c;for(hf[a-1]=c,d=0,c=0;c<16;c++)for(kE[c]=d,t=0;t<1<<PE[c];t++)uf[d++]=c;for(d>>=7;c<cf;c++)for(kE[c]=d<<7,t=0;t<1<<PE[c]-7;t++)uf[256+d++]=c;for(s=0;s<=lf;s++)h[s]=0;for(t=0;t<=143;)dc[2*t+1]=8,t++,h[8]++;for(;t<=255;)dc[2*t+1]=9,t++,h[9]++;for(;t<=279;)dc[2*t+1]=7,t++,h[7]++;for(;t<=287;)dc[2*t+1]=8,t++,h[8]++;for(WV(dc,287,h),t=0;t<cf;t++)df[2*t+1]=5,df[2*t]=BV(t,5);MV=new sT(dc,eT,257,kV,lf),FV=new sT(df,PE,0,cf,lf),UV=new sT(new Array(0),yoe,0,19,7)})(),$V=!0),e.l_desc=new rT(e.dyn_ltree,MV),e.d_desc=new rT(e.dyn_dtree,FV),e.bl_desc=new rT(e.bl_tree,UV),e.bi_buf=0,e.bi_valid=0,GV(e)},boe=(e,t,s,a)=>{let c,d,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(p=>{let f,_=4093624447;for(f=0;f<=31;f++,_>>>=1)if(1&_&&p.dyn_ltree[2*f]!==0)return 0;if(p.dyn_ltree[18]!==0||p.dyn_ltree[20]!==0||p.dyn_ltree[26]!==0)return 1;for(f=32;f<ZC;f++)if(p.dyn_ltree[2*f]!==0)return 1;return 0})(e)),iT(e,e.l_desc),iT(e,e.d_desc),h=(p=>{let f;for(qV(p,p.dyn_ltree,p.l_desc.max_code),qV(p,p.dyn_dtree,p.d_desc.max_code),iT(p,p.bl_desc),f=18;f>=3&&p.bl_tree[2*LV[f]+1]===0;f--);return p.opt_len+=3*(f+1)+5+5+4,f})(e),c=e.opt_len+3+7>>>3,d=e.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&t!==-1?XV(e,t,s,a):e.strategy===4||d===c?(_i(e,2+(a?1:0),3),KV(e,dc,df)):(_i(e,4+(a?1:0),3),((p,f,_,v)=>{let b;for(_i(p,f-257,5),_i(p,_-1,5),_i(p,v-4,4),b=0;b<v;b++)_i(p,p.bl_tree[2*LV[b]+1],3);YV(p,p.dyn_ltree,f-1),YV(p,p.dyn_dtree,_-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),KV(e,e.dyn_ltree,e.dyn_dtree)),GV(e),a&&HV(e)},woe=(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,t===0?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(hf[s]+ZC+1)]++,e.dyn_dtree[2*VV(t)]++),e.sym_next===e.sym_end),Soe=e=>{_i(e,2,3),Ao(e,256,dc),(t=>{t.bi_valid===16?(pf(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Coe={_tr_init:xoe,_tr_stored_block:XV,_tr_flush_block:boe,_tr_tally:woe,_tr_align:Soe},mf=(e,t,s,a)=>{let c=65535&e|0,d=e>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+t[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};let Toe=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var ln=(e,t,s,a)=>{let c=Toe,d=a+s;e^=-1;for(let h=a;h<d;h++)e=e>>>8^c[255&(e^t[h])];return-1^e},Sd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},LE={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:Noe,_tr_stored_block:aT,_tr_flush_block:Roe,_tr_tally:rl,_tr_align:Aoe}=Coe,{Z_NO_FLUSH:nl,Z_PARTIAL_FLUSH:Ioe,Z_FULL_FLUSH:Doe,Z_FINISH:ma,Z_BLOCK:JV,Z_OK:_n,Z_STREAM_END:QV,Z_STREAM_ERROR:Io,Z_DATA_ERROR:Ooe,Z_BUF_ERROR:oT,Z_DEFAULT_COMPRESSION:joe,Z_FILTERED:Poe,Z_HUFFMAN_ONLY:ME,Z_RLE:koe,Z_FIXED:Loe,Z_DEFAULT_STRATEGY:Moe,Z_UNKNOWN:Foe,Z_DEFLATED:FE}=LE,cT=286,Uoe=30,Voe=19,Boe=2*cT+1,Woe=15,Cd=258,Do=262,Ah=42,Td=113,ff=666,Nd=(e,t)=>(e.msg=Sd[t],t),ZV=e=>2*e-(e>4?9:0),il=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Goe=e=>{let t,s,a,c=e.w_size;t=e.hash_size,a=t;do s=e.head[--a],e.head[a]=s>=c?s-c:0;while(--t);t=c,a=t;do s=e.prev[--a],e.prev[a]=s>=c?s-c:0;while(--t)},al=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask,Li=e=>{let t=e.state,s=t.pending;s>e.avail_out&&(s=e.avail_out),s!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,t.pending===0&&(t.pending_out=0))},Mi=(e,t)=>{Roe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Li(e.strm)},Ls=(e,t)=>{e.pending_buf[e.pending++]=t},gf=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},lT=(e,t,s,a)=>{let c=e.avail_in;return c>a&&(c=a),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),s),e.state.wrap===1?e.adler=mf(e.adler,t,c,s):e.state.wrap===2&&(e.adler=ln(e.adler,t,c,s)),e.next_in+=c,e.total_in+=c,c)},e4=(e,t)=>{let s,a,c=e.max_chain_length,d=e.strstart,h=e.prev_length,p=e.nice_match,f=e.strstart>e.w_size-Do?e.strstart-(e.w_size-Do):0,_=e.window,v=e.w_mask,b=e.prev,w=e.strstart+Cd,T=_[d+h-1],U=_[d+h];e.prev_length>=e.good_match&&(c>>=2),p>e.lookahead&&(p=e.lookahead);do if(s=t,_[s+h]===U&&_[s+h-1]===T&&_[s]===_[d]&&_[++s]===_[d+1]){d+=2,s++;do;while(_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&d<w);if(a=Cd-(w-d),d=w-Cd,a>h){if(e.match_start=t,h=a,a>=p)break;T=_[d+h-1],U=_[d+h]}}while((t=b[t&v])>f&&--c!=0);return h<=e.lookahead?h:e.lookahead},Ih=e=>{let t=e.w_size,s,a,c;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Do)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Goe(e),a+=t),e.strm.avail_in===0)break;if(s=lT(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=s,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=al(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=al(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Do&&e.strm.avail_in!==0)},t4=(e,t)=>{let s,a,c,d=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,p=e.strm.avail_in;do{if(s=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,a=e.strstart-e.block_start,s>a+e.strm.avail_in&&(s=a+e.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&t!==ma||t===nl||s!==a+e.strm.avail_in)))break;h=t===ma&&s===a+e.strm.avail_in?1:0,aT(e,0,0,h),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,Li(e.strm),a&&(a>s&&(a=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,s-=a),s&&(lT(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(h===0);return p-=e.strm.avail_in,p&&(p>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=p&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-p,e.strm.next_in),e.strstart),e.strstart+=p,e.insert+=p>e.w_size-e.insert?e.w_size-e.insert:p),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:t!==nl&&t!==ma&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(lT(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,d=c>e.w_size?e.w_size:c,a=e.strstart-e.block_start,(a>=d||(a||t===ma)&&t!==nl&&e.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=t===ma&&e.strm.avail_in===0&&s===a?1:0,aT(e,e.block_start,s,h),e.block_start+=s,Li(e.strm)),h?3:1)},dT=(e,t)=>{let s,a;for(;;){if(e.lookahead<Do){if(Ih(e),e.lookahead<Do&&t===nl)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=al(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),s!==0&&e.strstart-s<=e.w_size-Do&&(e.match_length=e4(e,s)),e.match_length>=3)if(a=rl(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=al(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=al(e,e.ins_h,e.window[e.strstart+1]);else a=rl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(Mi(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ma?(Mi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Mi(e,!1),e.strm.avail_out===0)?1:2},Dh=(e,t)=>{let s,a,c;for(;;){if(e.lookahead<Do){if(Ih(e),e.lookahead<Do&&t===nl)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=al(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,s!==0&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Do&&(e.match_length=e4(e,s),e.match_length<=5&&(e.strategy===Poe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,a=rl(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=al(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(Mi(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(a=rl(e,0,e.window[e.strstart-1]),a&&Mi(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=rl(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ma?(Mi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Mi(e,!1),e.strm.avail_out===0)?1:2};function Oo(e,t,s,a,c){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=a,this.func=c}let _f=[new Oo(0,0,0,0,t4),new Oo(4,4,8,4,dT),new Oo(4,5,16,8,dT),new Oo(4,6,32,32,dT),new Oo(4,4,16,16,Dh),new Oo(8,16,32,32,Dh),new Oo(8,16,128,128,Dh),new Oo(8,32,128,256,Dh),new Oo(32,128,258,1024,Dh),new Oo(32,258,258,4096,Dh)];function Hoe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=FE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Boe),this.dyn_dtree=new Uint16Array(2*(2*Uoe+1)),this.bl_tree=new Uint16Array(2*(2*Voe+1)),il(this.dyn_ltree),il(this.dyn_dtree),il(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Woe+1),this.heap=new Uint16Array(2*cT+1),il(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*cT+1),il(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let vf=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Ah&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Td&&t.status!==ff?1:0},s4=e=>{if(vf(e))return Nd(e,Io);e.total_in=e.total_out=0,e.data_type=Foe;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Ah:Td,e.adler=t.wrap===2?0:1,t.last_flush=-2,Noe(t),_n},r4=e=>{let t=s4(e);return t===_n&&(s=>{s.window_size=2*s.w_size,il(s.head),s.max_lazy_match=_f[s.level].max_lazy,s.good_match=_f[s.level].good_length,s.nice_match=_f[s.level].nice_length,s.max_chain_length=_f[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(e.state),t},n4=(e,t,s,a,c,d)=>{if(!e)return Io;let h=1;if(t===joe&&(t=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==FE||a<8||a>15||t<0||t>9||d<0||d>Loe||a===8&&h!==1)return Nd(e,Io);a===8&&(a=9);let p=new Hoe;return e.state=p,p.strm=e,p.status=Ah,p.wrap=h,p.gzhead=null,p.w_bits=a,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=c+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<c+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=t,p.strategy=d,p.method=s,r4(e)};var zoe=(e,t)=>{if(vf(e)||t>JV||t<0)return e?Nd(e,Io):Io;let s=e.state;if(!e.output||e.avail_in!==0&&!e.input||s.status===ff&&t!==ma)return Nd(e,e.avail_out===0?oT:Io);let a=s.last_flush;if(s.last_flush=t,s.pending!==0){if(Li(e),e.avail_out===0)return s.last_flush=-1,_n}else if(e.avail_in===0&&ZV(t)<=ZV(a)&&t!==ma)return Nd(e,oT);if(s.status===ff&&e.avail_in!==0)return Nd(e,oT);if(s.status===Ah&&s.wrap===0&&(s.status=Td),s.status===Ah){let c=FE+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=ME||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,gf(s,c),s.strstart!==0&&(gf(s,e.adler>>>16),gf(s,65535&e.adler)),e.adler=1,s.status=Td,Li(e),s.pending!==0)return s.last_flush=-1,_n}if(s.status===57){if(e.adler=0,Ls(s,31),Ls(s,139),Ls(s,8),s.gzhead)Ls(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Ls(s,255&s.gzhead.time),Ls(s,s.gzhead.time>>8&255),Ls(s,s.gzhead.time>>16&255),Ls(s,s.gzhead.time>>24&255),Ls(s,s.level===9?2:s.strategy>=ME||s.level<2?4:0),Ls(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(Ls(s,255&s.gzhead.extra.length),Ls(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=ln(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(Ls(s,0),Ls(s,0),Ls(s,0),Ls(s,0),Ls(s,0),Ls(s,s.level===9?2:s.strategy>=ME||s.level<2?4:0),Ls(s,3),s.status=Td,Li(e),s.pending!==0)return s.last_flush=-1,_n}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let p=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+p),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(e.adler=ln(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=p,Li(e),s.pending!==0)return s.last_flush=-1,_n;c=0,d-=p}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(e.adler=ln(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(e.adler=ln(e.adler,s.pending_buf,s.pending-d,d)),Li(e),s.pending!==0)return s.last_flush=-1,_n;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,Ls(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(e.adler=ln(e.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(e.adler=ln(e.adler,s.pending_buf,s.pending-d,d)),Li(e),s.pending!==0)return s.last_flush=-1,_n;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,Ls(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(e.adler=ln(e.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Li(e),s.pending!==0))return s.last_flush=-1,_n;Ls(s,255&e.adler),Ls(s,e.adler>>8&255),e.adler=0}if(s.status=Td,Li(e),s.pending!==0)return s.last_flush=-1,_n}if(e.avail_in!==0||s.lookahead!==0||t!==nl&&s.status!==ff){let c=s.level===0?t4(s,t):s.strategy===ME?((d,h)=>{let p;for(;;){if(d.lookahead===0&&(Ih(d),d.lookahead===0)){if(h===nl)return 1;break}if(d.match_length=0,p=rl(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(Mi(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===ma?(Mi(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Mi(d,!1),d.strm.avail_out===0)?1:2})(s,t):s.strategy===koe?((d,h)=>{let p,f,_,v,b=d.window;for(;;){if(d.lookahead<=Cd){if(Ih(d),d.lookahead<=Cd&&h===nl)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(_=d.strstart-1,f=b[_],f===b[++_]&&f===b[++_]&&f===b[++_])){v=d.strstart+Cd;do;while(f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&_<v);d.match_length=Cd-(v-_),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=rl(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=rl(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(Mi(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===ma?(Mi(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Mi(d,!1),d.strm.avail_out===0)?1:2})(s,t):_f[s.level].func(s,t);if(c!==3&&c!==4||(s.status=ff),c===1||c===3)return e.avail_out===0&&(s.last_flush=-1),_n;if(c===2&&(t===Ioe?Aoe(s):t!==JV&&(aT(s,0,0,!1),t===Doe&&(il(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Li(e),e.avail_out===0))return s.last_flush=-1,_n}return t!==ma?_n:s.wrap<=0?QV:(s.wrap===2?(Ls(s,255&e.adler),Ls(s,e.adler>>8&255),Ls(s,e.adler>>16&255),Ls(s,e.adler>>24&255),Ls(s,255&e.total_in),Ls(s,e.total_in>>8&255),Ls(s,e.total_in>>16&255),Ls(s,e.total_in>>24&255)):(gf(s,e.adler>>>16),gf(s,65535&e.adler)),Li(e),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?_n:QV)},Koe=(e,t)=>{let s=t.length;if(vf(e))return Io;let a=e.state,c=a.wrap;if(c===2||c===1&&a.status!==Ah||a.lookahead)return Io;if(c===1&&(e.adler=mf(e.adler,t,s,0)),a.wrap=0,s>=a.w_size){c===0&&(il(a.head),a.strstart=0,a.block_start=0,a.insert=0);let f=new Uint8Array(a.w_size);f.set(t.subarray(s-a.w_size,s),0),t=f,s=a.w_size}let d=e.avail_in,h=e.next_in,p=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Ih(a);a.lookahead>=3;){let f=a.strstart,_=a.lookahead-2;do a.ins_h=al(a,a.ins_h,a.window[f+3-1]),a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++;while(--_);a.strstart=f,a.lookahead=2,Ih(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=h,e.input=p,e.avail_in=d,a.wrap=c,_n},Ef={deflateInit:(e,t)=>n4(e,t,FE,15,8,Moe),deflateInit2:n4,deflateReset:r4,deflateResetKeep:s4,deflateSetHeader:(e,t)=>vf(e)||e.state.wrap!==2?Io:(e.state.gzhead=t,_n),deflate:zoe,deflateEnd:e=>{if(vf(e))return Io;let t=e.state.status;return e.state=null,t===Td?Nd(e,Ooe):_n},deflateSetDictionary:Koe,deflateInfo:"pako deflate (from Nodeca project)"};let qoe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var UE={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let s=t.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(let a in s)qoe(s,a)&&(e[a]=s[a])}}return e},flattenChunks:e=>{let t=0;for(let a=0,c=e.length;a<c;a++)t+=e[a].length;let s=new Uint8Array(t);for(let a=0,c=0,d=e.length;a<d;a++){let h=e[a];s.set(h,c),c+=h.length}return s}};let i4=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i4=!1}let yf=new Uint8Array(256);for(let e=0;e<256;e++)yf[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;yf[254]=yf[254]=1;var xf={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,s,a,c,d,h=e.length,p=0;for(c=0;c<h;c++)s=e.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=e.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),p+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(p),d=0,c=0;d<p;c++)s=e.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=e.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?t[d++]=s:s<2048?(t[d++]=192|s>>>6,t[d++]=128|63&s):s<65536?(t[d++]=224|s>>>12,t[d++]=128|s>>>6&63,t[d++]=128|63&s):(t[d++]=240|s>>>18,t[d++]=128|s>>>12&63,t[d++]=128|s>>>6&63,t[d++]=128|63&s);return t},buf2string:(e,t)=>{let s=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let a,c,d=new Array(2*s);for(c=0,a=0;a<s;){let h=e[a++];if(h<128){d[c++]=h;continue}let p=yf[h];if(p>4)d[c++]=65533,a+=p-1;else{for(h&=p===2?31:p===3?15:7;p>1&&a<s;)h=h<<6|63&e[a++],p--;p>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&i4)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let f="";for(let _=0;_<p;_++)f+=String.fromCharCode(h[_]);return f})(d,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&(192&e[s])==128;)s--;return s<0||s===0?t:s+yf[e[s]]>t?s:t}},a4=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let o4=Object.prototype.toString,{Z_NO_FLUSH:Yoe,Z_SYNC_FLUSH:$oe,Z_FULL_FLUSH:Xoe,Z_FINISH:Joe,Z_OK:VE,Z_STREAM_END:Qoe,Z_DEFAULT_COMPRESSION:Zoe,Z_DEFAULT_STRATEGY:ece,Z_DEFLATED:tce}=LE;function BE(e){this.options=UE.assign({level:Zoe,method:tce,chunkSize:16384,windowBits:15,memLevel:8,strategy:ece},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a4,this.strm.avail_out=0;let s=Ef.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==VE)throw new Error(Sd[s]);if(t.header&&Ef.deflateSetHeader(this.strm,t.header),t.dictionary){let a;if(a=typeof t.dictionary=="string"?xf.string2buf(t.dictionary):o4.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,s=Ef.deflateSetDictionary(this.strm,a),s!==VE)throw new Error(Sd[s]);this._dict_set=!0}}function sce(e,t){let s=new BE(t);if(s.push(e,!0),s.err)throw s.msg||Sd[s.err];return s.result}BE.prototype.push=function(e,t){let s=this.strm,a=this.options.chunkSize,c,d;if(this.ended)return!1;for(d=t===~~t?t:t===!0?Joe:Yoe,typeof e=="string"?s.input=xf.string2buf(e):o4.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(d===$oe||d===Xoe)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=Ef.deflate(s,d),c===Qoe)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=Ef.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===VE;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},BE.prototype.onData=function(e){this.chunks.push(e)},BE.prototype.onEnd=function(e){e===VE&&(this.result=UE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rce={deflate:sce};let WE=16209;var nce=function(e,t){let s,a,c,d,h,p,f,_,v,b,w,T,U,k,F,K,Y,X,re,te,Z,le,xe,Ce,je=e.state;s=e.next_in,xe=e.input,a=s+(e.avail_in-5),c=e.next_out,Ce=e.output,d=c-(t-e.avail_out),h=c+(e.avail_out-257),p=je.dmax,f=je.wsize,_=je.whave,v=je.wnext,b=je.window,w=je.hold,T=je.bits,U=je.lencode,k=je.distcode,F=(1<<je.lenbits)-1,K=(1<<je.distbits)-1;e:do{T<15&&(w+=xe[s++]<<T,T+=8,w+=xe[s++]<<T,T+=8),Y=U[w&F];t:for(;;){if(X=Y>>>24,w>>>=X,T-=X,X=Y>>>16&255,X===0)Ce[c++]=65535&Y;else{if(!(16&X)){if(!(64&X)){Y=U[(65535&Y)+(w&(1<<X)-1)];continue t}if(32&X){je.mode=16191;break e}e.msg="invalid literal/length code",je.mode=WE;break e}re=65535&Y,X&=15,X&&(T<X&&(w+=xe[s++]<<T,T+=8),re+=w&(1<<X)-1,w>>>=X,T-=X),T<15&&(w+=xe[s++]<<T,T+=8,w+=xe[s++]<<T,T+=8),Y=k[w&K];s:for(;;){if(X=Y>>>24,w>>>=X,T-=X,X=Y>>>16&255,!(16&X)){if(!(64&X)){Y=k[(65535&Y)+(w&(1<<X)-1)];continue s}e.msg="invalid distance code",je.mode=WE;break e}if(te=65535&Y,X&=15,T<X&&(w+=xe[s++]<<T,T+=8,T<X&&(w+=xe[s++]<<T,T+=8)),te+=w&(1<<X)-1,te>p){e.msg="invalid distance too far back",je.mode=WE;break e}if(w>>>=X,T-=X,X=c-d,te>X){if(X=te-X,X>_&&je.sane){e.msg="invalid distance too far back",je.mode=WE;break e}if(Z=0,le=b,v===0){if(Z+=f-X,X<re){re-=X;do Ce[c++]=b[Z++];while(--X);Z=c-te,le=Ce}}else if(v<X){if(Z+=f+v-X,X-=v,X<re){re-=X;do Ce[c++]=b[Z++];while(--X);if(Z=0,v<re){X=v,re-=X;do Ce[c++]=b[Z++];while(--X);Z=c-te,le=Ce}}}else if(Z+=v-X,X<re){re-=X;do Ce[c++]=b[Z++];while(--X);Z=c-te,le=Ce}for(;re>2;)Ce[c++]=le[Z++],Ce[c++]=le[Z++],Ce[c++]=le[Z++],re-=3;re&&(Ce[c++]=le[Z++],re>1&&(Ce[c++]=le[Z++]))}else{Z=c-te;do Ce[c++]=Ce[Z++],Ce[c++]=Ce[Z++],Ce[c++]=Ce[Z++],re-=3;while(re>2);re&&(Ce[c++]=Ce[Z++],re>1&&(Ce[c++]=Ce[Z++]))}break}}break}}while(s<a&&c<h);re=T>>3,s-=re,T-=re<<3,w&=(1<<T)-1,e.next_in=s,e.next_out=c,e.avail_in=s<a?a-s+5:5-(s-a),e.avail_out=c<h?h-c+257:257-(c-h),je.hold=w,je.bits=T};let GE=15,ice=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ace=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),oce=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),cce=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var bf=(e,t,s,a,c,d,h,p)=>{let f=p.bits,_,v,b,w,T,U,k=0,F=0,K=0,Y=0,X=0,re=0,te=0,Z=0,le=0,xe=0,Ce=null,je=new Uint16Array(16),wt=new Uint16Array(16),Ct,mt,Yt,zt=null;for(k=0;k<=GE;k++)je[k]=0;for(F=0;F<a;F++)je[t[s+F]]++;for(X=f,Y=GE;Y>=1&&je[Y]===0;Y--);if(X>Y&&(X=Y),Y===0)return c[d++]=20971520,c[d++]=20971520,p.bits=1,0;for(K=1;K<Y&&je[K]===0;K++);for(X<K&&(X=K),Z=1,k=1;k<=GE;k++)if(Z<<=1,Z-=je[k],Z<0)return-1;if(Z>0&&(e===0||Y!==1))return-1;for(wt[1]=0,k=1;k<GE;k++)wt[k+1]=wt[k]+je[k];for(F=0;F<a;F++)t[s+F]!==0&&(h[wt[t[s+F]]++]=F);if(e===0?(Ce=zt=h,U=20):e===1?(Ce=ice,zt=ace,U=257):(Ce=oce,zt=cce,U=0),xe=0,F=0,k=K,T=d,re=X,te=0,b=-1,le=1<<X,w=le-1,e===1&&le>852||e===2&&le>592)return 1;for(;;){Ct=k-te,h[F]+1<U?(mt=0,Yt=h[F]):h[F]>=U?(mt=zt[h[F]-U],Yt=Ce[h[F]-U]):(mt=96,Yt=0),_=1<<k-te,v=1<<re,K=v;do v-=_,c[T+(xe>>te)+v]=Ct<<24|mt<<16|Yt|0;while(v!==0);for(_=1<<k-1;xe&_;)_>>=1;if(_!==0?(xe&=_-1,xe+=_):xe=0,F++,--je[k]==0){if(k===Y)break;k=t[s+h[F]]}if(k>X&&(xe&w)!==b){for(te===0&&(te=X),T+=K,re=k-te,Z=1<<re;re+te<Y&&(Z-=je[re+te],!(Z<=0));)re++,Z<<=1;if(le+=1<<re,e===1&&le>852||e===2&&le>592)return 1;b=xe&w,c[b]=X<<24|re<<16|T-d|0}}return xe!==0&&(c[T+xe]=k-te<<24|64<<16|0),p.bits=X,0};let{Z_FINISH:c4,Z_BLOCK:lce,Z_TREES:HE,Z_OK:Rd,Z_STREAM_END:dce,Z_NEED_DICT:uce,Z_STREAM_ERROR:fa,Z_DATA_ERROR:l4,Z_MEM_ERROR:d4,Z_BUF_ERROR:hce,Z_DEFLATED:u4}=LE,zE=16180,KE=16190,uc=16191,uT=16192,hT=16194,qE=16199,YE=16200,pT=16206,hr=16209,h4=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function pce(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Ad=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<zE||t.mode>16211?1:0},p4=e=>{if(Ad(e))return fa;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=zE,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Rd},m4=e=>{if(Ad(e))return fa;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,p4(e)},f4=(e,t)=>{let s;if(Ad(e))return fa;let a=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?fa:(a.window!==null&&a.wbits!==t&&(a.window=null),a.wrap=s,a.wbits=t,m4(e))},g4=(e,t)=>{if(!e)return fa;let s=new pce;e.state=s,s.strm=e,s.window=null,s.mode=zE;let a=f4(e,t);return a!==Rd&&(e.state=null),a},mT,fT,_4=!0,mce=e=>{if(_4){mT=new Int32Array(512),fT=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(bf(1,e.lens,0,288,mT,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;bf(2,e.lens,0,32,fT,0,e.work,{bits:5}),_4=!1}e.lencode=mT,e.lenbits=9,e.distcode=fT,e.distbits=5},v4=(e,t,s,a)=>{let c,d=e.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(t.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(t.subarray(s-a,s-a+c),d.wnext),(a-=c)?(d.window.set(t.subarray(s-a,s),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var fce=(e,t)=>{let s,a,c,d,h,p,f,_,v,b,w,T,U,k,F,K,Y,X,re,te,Z,le,xe=0,Ce=new Uint8Array(4),je,wt,Ct=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ad(e)||!e.output||!e.input&&e.avail_in!==0)return fa;s=e.state,s.mode===uc&&(s.mode=uT),h=e.next_out,c=e.output,f=e.avail_out,d=e.next_in,a=e.input,p=e.avail_in,_=s.hold,v=s.bits,b=p,w=f,le=Rd;e:for(;;)switch(s.mode){case zE:if(s.wrap===0){s.mode=uT;break}for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(2&s.wrap&&_===35615){s.wbits===0&&(s.wbits=15),s.check=0,Ce[0]=255&_,Ce[1]=_>>>8&255,s.check=ln(s.check,Ce,2,0),_=0,v=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",s.mode=hr;break}if((15&_)!==u4){e.msg="unknown compression method",s.mode=hr;break}if(_>>>=4,v-=4,Z=8+(15&_),s.wbits===0&&(s.wbits=Z),Z>15||Z>s.wbits){e.msg="invalid window size",s.mode=hr;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&_?16189:uc,_=0,v=0;break;case 16181:for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(s.flags=_,(255&en(s))!==u4){e.msg="unknown compression method",s.mode=hr;break}if(57344&en(s)){e.msg="unknown header flags set",s.mode=hr;break}s.head&&(s.head.text=_>>8&1),512&en(s)&&4&s.wrap&&(Ce[0]=255&_,Ce[1]=_>>>8&255,s.check=ln(s.check,Ce,2,0)),_=0,v=0,s.mode=16182;case 16182:for(;v<32;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.head&&(s.head.time=_),512&en(s)&&4&s.wrap&&(Ce[0]=255&_,Ce[1]=_>>>8&255,Ce[2]=_>>>16&255,Ce[3]=_>>>24&255,s.check=ln(s.check,Ce,4,0)),_=0,v=0,s.mode=16183;case 16183:for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.head&&(s.head.xflags=255&_,s.head.os=_>>8),512&en(s)&&4&s.wrap&&(Ce[0]=255&_,Ce[1]=_>>>8&255,s.check=ln(s.check,Ce,2,0)),_=0,v=0,s.mode=16184;case 16184:if(1024&en(s)){for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.length=_,s.head&&(s.head.extra_len=_),512&en(s)&&4&s.wrap&&(Ce[0]=255&_,Ce[1]=_>>>8&255,s.check=ln(s.check,Ce,2,0)),_=0,v=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&en(s)&&(T=s.length,T>p&&(T=p),T&&(s.head&&(Z=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(d,d+T),Z)),512&en(s)&&4&s.wrap&&(s.check=ln(s.check,a,T,d)),p-=T,d+=T,s.length-=T),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&en(s)){if(p===0)break e;T=0;do Z=a[d+T++],s.head&&Z&&s.length<65536&&(s.head.name+=String.fromCharCode(Z));while(Z&&T<p);if(512&en(s)&&4&s.wrap&&(s.check=ln(s.check,a,T,d)),p-=T,d+=T,Z)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&en(s)){if(p===0)break e;T=0;do Z=a[d+T++],s.head&&Z&&s.length<65536&&(s.head.comment+=String.fromCharCode(Z));while(Z&&T<p);if(512&en(s)&&4&s.wrap&&(s.check=ln(s.check,a,T,d)),p-=T,d+=T,Z)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&en(s)){for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(4&s.wrap&&_!==(65535&s.check)){e.msg="header crc mismatch",s.mode=hr;break}_=0,v=0}s.head&&(s.head.hcrc=en(s)>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=uc;break;case 16189:for(;v<32;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}e.adler=s.check=h4(_),_=0,v=0,s.mode=KE;case KE:if(s.havedict===0)return e.next_out=h,e.avail_out=f,e.next_in=d,e.avail_in=p,s.hold=_,s.bits=v,uce;e.adler=s.check=1,s.mode=uc;case uc:if(t===lce||t===HE)break e;case uT:if(s.last){_>>>=7&v,v-=7&v,s.mode=pT;break}for(;v<3;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}switch(s.last=1&_,_>>>=1,v-=1,3&_){case 0:s.mode=16193;break;case 1:if(mce(s),s.mode=qE,t===HE){_>>>=2,v-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=hr}_>>>=2,v-=2;break;case 16193:for(_>>>=7&v,v-=7&v;v<32;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",s.mode=hr;break}if(s.length=65535&_,_=0,v=0,s.mode=hT,t===HE)break e;case hT:s.mode=16195;case 16195:if(T=s.length,T){if(T>p&&(T=p),T>f&&(T=f),T===0)break e;c.set(a.subarray(d,d+T),h),p-=T,d+=T,f-=T,h+=T,s.length-=T;break}s.mode=uc;break;case 16196:for(;v<14;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(s.nlen=257+(31&_),_>>>=5,v-=5,s.ndist=1+(31&_),_>>>=5,v-=5,s.ncode=4+(15&_),_>>>=4,v-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=hr;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;v<3;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.lens[Ct[s.have++]]=7&_,_>>>=3,v-=3}for(;s.have<19;)s.lens[Ct[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,je={bits:s.lenbits},le=bf(0,s.lens,0,19,s.lencode,0,s.work,je),s.lenbits=je.bits,le){e.msg="invalid code lengths set",s.mode=hr;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;xe=s.lencode[_&(1<<s.lenbits)-1],F=xe>>>24,K=xe>>>16&255,Y=65535&xe,!(F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(Y<16)_>>>=F,v-=F,s.lens[s.have++]=Y;else{if(Y===16){for(wt=F+2;v<wt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(_>>>=F,v-=F,s.have===0){e.msg="invalid bit length repeat",s.mode=hr;break}Z=s.lens[s.have-1],T=3+(3&_),_>>>=2,v-=2}else if(Y===17){for(wt=F+3;v<wt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}_>>>=F,v-=F,Z=0,T=3+(7&_),_>>>=3,v-=3}else{for(wt=F+7;v<wt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}_>>>=F,v-=F,Z=0,T=11+(127&_),_>>>=7,v-=7}if(s.have+T>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=hr;break}for(;T--;)s.lens[s.have++]=Z}}if(s.mode===hr)break;if(s.lens[256]===0){e.msg="invalid code -- missing end-of-block",s.mode=hr;break}if(s.lenbits=9,je={bits:s.lenbits},le=bf(1,s.lens,0,s.nlen,s.lencode,0,s.work,je),s.lenbits=je.bits,le){e.msg="invalid literal/lengths set",s.mode=hr;break}if(s.distbits=6,s.distcode=s.distdyn,je={bits:s.distbits},le=bf(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,je),s.distbits=je.bits,le){e.msg="invalid distances set",s.mode=hr;break}if(s.mode=qE,t===HE)break e;case qE:s.mode=YE;case YE:if(p>=6&&f>=258){e.next_out=h,e.avail_out=f,e.next_in=d,e.avail_in=p,s.hold=_,s.bits=v,nce(e,w),h=e.next_out,c=e.output,f=e.avail_out,d=e.next_in,a=e.input,p=e.avail_in,_=s.hold,v=s.bits,s.mode===uc&&(s.back=-1);break}for(s.back=0;xe=s.lencode[_&(1<<s.lenbits)-1],F=xe>>>24,K=xe>>>16&255,Y=65535&xe,!(F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(K&&!(240&K)){for(X=F,re=K,te=Y;xe=s.lencode[te+((_&(1<<X+re)-1)>>X)],F=xe>>>24,K=xe>>>16&255,Y=65535&xe,!(X+F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}_>>>=X,v-=X,s.back+=X}if(_>>>=F,v-=F,s.back+=F,s.length=Y,K===0){s.mode=16205;break}if(32&K){s.back=-1,s.mode=uc;break}if(64&K){e.msg="invalid literal/length code",s.mode=hr;break}s.extra=15&K,s.mode=16201;case 16201:if(s.extra){for(wt=s.extra;v<wt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.length+=_&(1<<s.extra)-1,_>>>=s.extra,v-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;xe=s.distcode[_&(1<<s.distbits)-1],F=xe>>>24,K=xe>>>16&255,Y=65535&xe,!(F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(!(240&K)){for(X=F,re=K,te=Y;xe=s.distcode[te+((_&(1<<X+re)-1)>>X)],F=xe>>>24,K=xe>>>16&255,Y=65535&xe,!(X+F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}_>>>=X,v-=X,s.back+=X}if(_>>>=F,v-=F,s.back+=F,64&K){e.msg="invalid distance code",s.mode=hr;break}s.offset=Y,s.extra=15&K,s.mode=16203;case 16203:if(s.extra){for(wt=s.extra;v<wt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.offset+=_&(1<<s.extra)-1,_>>>=s.extra,v-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=hr;break}s.mode=16204;case 16204:if(f===0)break e;if(T=w-f,s.offset>T){if(T=s.offset-T,T>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=hr;break}T>s.wnext?(T-=s.wnext,U=s.wsize-T):U=s.wnext-T,T>s.length&&(T=s.length),k=s.window}else k=c,U=h-s.offset,T=s.length;T>f&&(T=f),f-=T,s.length-=T;do c[h++]=k[U++];while(--T);s.length===0&&(s.mode=YE);break;case 16205:if(f===0)break e;c[h++]=s.length,f--,s.mode=YE;break;case pT:if(s.wrap){for(;v<32;){if(p===0)break e;p--,_|=a[d++]<<v,v+=8}if(w-=f,e.total_out+=w,s.total+=w,4&s.wrap&&w&&(e.adler=s.check=en(s)?ln(s.check,c,w,h-w):mf(s.check,c,w,h-w)),w=f,4&s.wrap&&(en(s)?_:h4(_))!==s.check){e.msg="incorrect data check",s.mode=hr;break}_=0,v=0}s.mode=16207;case 16207:if(s.wrap&&en(s)){for(;v<32;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(4&s.wrap&&_!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=hr;break}_=0,v=0}s.mode=16208;case 16208:le=dce;break e;case hr:le=l4;break e;case 16210:return d4;default:return fa}return e.next_out=h,e.avail_out=f,e.next_in=d,e.avail_in=p,s.hold=_,s.bits=v,(s.wsize||w!==e.avail_out&&s.mode<hr&&(s.mode<pT||t!==c4))&&v4(e,e.output,e.next_out,w-e.avail_out),b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,s.total+=w,4&s.wrap&&w&&(e.adler=s.check=en(s)?ln(s.check,c,w,e.next_out-w):mf(s.check,c,w,e.next_out-w)),e.data_type=s.bits+(s.last?64:0)+(s.mode===uc?128:0)+(s.mode===qE||s.mode===hT?256:0),(b===0&&w===0||t===c4)&&le===Rd&&(le=hce),le},hc={inflateReset:m4,inflateReset2:f4,inflateResetKeep:p4,inflateInit:e=>g4(e,15),inflateInit2:g4,inflate:fce,inflateEnd:e=>{if(Ad(e))return fa;let t=e.state;return t.window&&(t.window=null),e.state=null,Rd},inflateGetHeader:(e,t)=>{if(Ad(e))return fa;let s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,Rd):fa},inflateSetDictionary:(e,t)=>{let s=t.length,a,c,d;return Ad(e)?fa:(a=e.state,a.wrap!==0&&a.mode!==KE?fa:a.mode===KE&&(c=1,c=mf(c,t,s,0),c!==a.check)?l4:(d=v4(e,t,s,s),d?(a.mode=16210,d4):(a.havedict=1,Rd)))},inflateInfo:"pako inflate (from Nodeca project)"},gce=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let E4=Object.prototype.toString,{Z_NO_FLUSH:_ce,Z_FINISH:vce,Z_OK:wf,Z_STREAM_END:gT,Z_NEED_DICT:_T,Z_STREAM_ERROR:Ece,Z_DATA_ERROR:y4,Z_MEM_ERROR:yce}=LE;function $E(e){this.options=UE.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a4,this.strm.avail_out=0;let s=hc.inflateInit2(this.strm,t.windowBits);if(s!==wf)throw new Error(Sd[s]);if(this.header=new gce,hc.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=xf.string2buf(t.dictionary):E4.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=hc.inflateSetDictionary(this.strm,t.dictionary),s!==wf)))throw new Error(Sd[s])}function xce(e,t){let s=new $E(t);if(s.push(e),s.err)throw s.msg||Sd[s.err];return s.result}$E.prototype.push=function(e,t){let s=this.strm,a=this.options.chunkSize,c=this.options.dictionary,d,h,p;if(this.ended)return!1;for(h=t===~~t?t:t===!0?vce:_ce,E4.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),d=hc.inflate(s,h),d===_T&&c&&(d=hc.inflateSetDictionary(s,c),d===wf?d=hc.inflate(s,h):d===y4&&(d=_T));s.avail_in>0&&d===gT&&s.state.wrap>0&&e[s.next_in]!==0;)hc.inflateReset(s),d=hc.inflate(s,h);switch(d){case Ece:case y4:case _T:case yce:return this.onEnd(d),this.ended=!0,!1}if(p=s.avail_out,s.next_out&&(s.avail_out===0||d===gT))if(this.options.to==="string"){let f=xf.utf8border(s.output,s.next_out),_=s.next_out-f,v=xf.buf2string(s.output,f);s.next_out=_,s.avail_out=a-_,_&&s.output.set(s.output.subarray(f,f+_),0),this.onData(v)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==wf||p!==0){if(d===gT)return d=hc.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},$E.prototype.onData=function(e){this.chunks.push(e)},$E.prototype.onEnd=function(e){e===wf&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=UE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bce={inflate:xce};let{deflate:wce}=rce,{inflate:Sce}=bce;var Cce=wce,Tce=Sce,x4=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(x4||{});class Nce{constructor(){W(this,"_sequence",0),W(this,"_startTime",Date.now()),W(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let p=new Uint8Array(4);p.set([1,0,0,0]);let f={id:0,length:4,data:p.buffer},_={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[f]};s.commonPacketHeader.extension=1,s.extension=_,s.payload=this.compress(t),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;$("SHOW_DATASTREAM2_LOG")&&A.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));let a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a),h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){let p=this.serializeExtension(s.extension);c.set(new Uint8Array(p),h),h+=p.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let s=new DataView(t),a=0,c=s.getUint16(a,!0);a+=2;let d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)},h,p;if(a+=4,$("SHOW_DATASTREAM2_LOG")&&A.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(a,!0),a+=2,d.extension){p=this.deserializeExtension(t.slice(a)),a+=2+p.length,h=t.slice(a);let f=!1;if(p.datas.length>0){let _=p.datas.find(v=>v.id===0);_&&(f=(1&new DataView(_.data).getUint32(0,!0))==1)}h=f?this.decompress(h):h}else h=t.slice(8);return h}serializeExtension(t){let{profile:s,length:a,datas:c}=t,d=new ArrayBuffer(a+2),h=new Uint8Array(d),p=new DataView(d),f=0;if(p.setUint8(f++,s),p.setUint8(f++,a),c.forEach(_=>{s?(p.setUint8(f++,_.id),p.setUint8(f++,_.length),h.set(new Uint8Array(_.data),f),f+=_.data.byteLength):(p.setUint8(f++,_.id|_.length<<4),h.set(new Uint8Array(_.data),f),f+=_.data.byteLength)}),f!==a+2)throw Error("serialize extension error, is ".concat(f,"!==").concat(a+2));return d}deserializeExtension(t){let s=new DataView(t),a=0,c=s.getUint8(a);a++;let d=s.getUint8(a);a++;let h=c===x4.TWO_BYTE,p=[],f=new DataView(t,2),_=0;for(;_<d;){let v=0,b=0,w=new ArrayBuffer(0);h?(v=f.getUint8(_),_++,b=f.getUint8(_),_++):(v=15&f.getUint8(_),b=f.getUint8(_)>>4,_++),b>0&&(w=f.buffer.slice(_+2,_+2+b),_+=w.byteLength),p.push({id:v,length:b,data:w})}if(_!==d)throw Error("parse error");return{profile:c,length:d,datas:p}}decompress(t){return Tce(new Uint8Array(t))}compress(t){return Cce(new Uint8Array(t))}}let Rce={name:"DataStream",create:(e,t)=>{let s=t?new kie(e):new Lie(e);return s.useDataStream(new Nce),s}};class Ace extends Cs{constructor(t,s,a){super(),W(this,"ws",void 0),W(this,"requestId",1),W(this,"heartBeatTimer",void 0),W(this,"joinInfo",void 0),W(this,"clientId",void 0),W(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),W(this,"onClose",c=>{this.emit("close"),this.dispose()}),W(this,"onMessage",c=>{let d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=t,this.clientId=s,this.ws=new Ym("cross-channel-".concat(this.clientId),a),this.ws.on(yt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(yt.CONNECTED,this.onOpen),this.ws.on(yt.ON_MESSAGE,this.onMessage),this.ws.on(yt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let s=this.requestId++;return t.requestId=s,t.seq=s,this.ws.sendMessage(t),s}waitStatus(t){return new Be((s,a)=>{let c=window.setTimeout(()=>{a(new de(q.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new de(q.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new de(q.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new de(q.WS_DISCONNECT);let s=()=>new Be((h,p)=>{this.ws.once(yt.CLOSED,()=>p(new de(q.WS_ABORT))),this.ws.once(yt.CONNECTED,h)});this.ws.state!=="connected"&&await s();let a=this.sendMessage(t),c=new Be((h,p)=>{let f=()=>{p(new de(q.WS_ABORT))};this.ws.once(yt.RECONNECTING,f),this.ws.once(yt.CLOSED,f),this.once("req_".concat(a),h),_r(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(yt.RECONNECTING,f),this.ws.off(yt.CLOSED,f),p(new de(q.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new de(q.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(t){this.ws.removeAllListeners(yt.REQUEST_NEW_URLS),this.ws.on(yt.REQUEST_NEW_URLS,s=>{s(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let s=this.requestId++;return t.requestId=s,this.ws.sendMessage(t),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Ice extends Cs{set state(t){t!==this._state&&(t!==Tn.RELAY_STATE_FAILURE&&(this.errorCode=fh.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,s,a,c,d){super(),W(this,"joinInfo",void 0),W(this,"sid",void 0),W(this,"clientId",void 0),W(this,"cancelToken",pn.CancelToken.source()),W(this,"workerToken",void 0),W(this,"requestId",0),W(this,"signal",void 0),W(this,"prevChannelMediaConfig",void 0),W(this,"httpRetryConfig",void 0),W(this,"_resolution",void 0),W(this,"_state",Tn.RELAY_STATE_IDLE),W(this,"errorCode",fh.RELAY_OK),W(this,"onStatus",h=>{A.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",ac.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",ac.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=fh.SRC_TOKEN_EXPIRED,this.state=Tn.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=fh.DEST_TOKEN_EXPIRED,this.state=Tn.RELAY_STATE_FAILURE))}),W(this,"onReconnect",async()=>{A.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ac.NETWORK_DISCONNECTED),this.state=Tn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Tn.RELAY_STATE_IDLE&&(A.error("auto restart channel media relay failed",h.toString()),this.errorCode=fh.SERVER_CONNECTION_LOST,this.state=Tn.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=s,this.sid=dd(),this.signal=new Ace(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(t){if(this.state!==Tn.RELAY_STATE_IDLE)throw new de(q.INVALID_OPERATION);this.state=Tn.RELAY_STATE_CONNECTING,await this.connect(),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new de(q.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new de(q.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new de(q.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Tn.RELAY_STATE_RUNNING)throw new de(q.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Tn.RELAY_STATE_RUNNING)throw new de(q.INVALID_OPERATION);let s=this.genMessage(cn.SetVideoProfile);await this.signal.request(s),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),A.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Tn.RELAY_STATE_IDLE,this.dispose()}dispose(){A.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=pn.CancelToken.source(),this.state=Tn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await Bae(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",ac.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let s=this.genMessage(cn.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let a=this.genMessage(cn.SetSdkProfile,t);await this.signal.request(a),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let c=this.genMessage(cn.SetSourceChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ac.PACKET_JOINED_SRC_CHANNEL),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let d=this.genMessage(cn.SetSourceUserId,t);await this.signal.request(d),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let h=this.genMessage(cn.SetDestChannel,t);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ac.PACKET_JOINED_DEST_CHANNEL),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let p=this.genMessage(cn.StartPacketTransfer,t);await this.signal.request(p),this.emit("event",ac.PACKET_SENT_TO_DEST_CHANNEL),this.state=Tn.RELAY_STATE_RUNNING,A.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let s=this.genMessage(cn.UpdateDestChannel,t);await this.signal.request(s),this.emit("event",ac.PACKET_UPDATE_DEST_CHANNEL),A.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(cn.StopPacketTransfer);await this.signal.request(t),A.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,s){let a=[],c=[],d=[];this.requestId+=1;let h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ii,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let p=null,f=null;switch(t){case cn.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case cn.SetSourceChannel:if(f=s&&s.getSrcChannelMediaInfo(),!f)throw new de(q.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:f.channelName,token:f.token||this.joinInfo.appId},h;case cn.SetSourceUserId:if(f=s&&s.getSrcChannelMediaInfo(),!f)throw new de(q.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:f.uid+""},h;case cn.SetDestChannel:if(p=s&&s.getDestChannelMediaInfo(),!p)throw new de(q.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{a.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case cn.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case cn.Reconnect:return h.clientRequest={command:"Reconnect"},h;case cn.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case cn.UpdateDestChannel:if(p=s&&s.getDestChannelMediaInfo(),!p)throw new de(q.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{a.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case cn.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}let Dce={name:"ChannelMediaRelay",create:function(e){return new Ice(e.joinInfo,e.clientId,e.websocketRetryConfig||Ks,e.httpRetryConfig||Ks,e.resolution)}};function b4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Sf(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?b4(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):b4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class Oce extends Cs{constructor(t,s,a,c){super(),W(this,"spec",void 0),W(this,"token",void 0),W(this,"websocket",void 0),W(this,"pingpongTimer",void 0),W(this,"reconnectMode","retry"),W(this,"serviceMode",void 0),W(this,"reqId",0),W(this,"commandReqId",0),W(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),W(this,"handleWebSocketMessage",d=>{if(!d.data)return;let h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Ze.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===ic.TRANSCODE?1:2}),this.emit(zc.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=t,this.serviceMode=c,this.websocket=new Ym("live-streaming",a),this.websocket.on(yt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(yt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(yt.REQUEST_NEW_URLS,(d,h)=>{Rr(this,zc.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(yt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,s,a,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new de(q.UNEXPECTED_ERROR);let p=Sf({command:t,sdkVersion:Ii==="4.24.0"?"0.0.1":Ii,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new de(q.WS_DISCONNECT);let f=()=>new Be((w,T)=>{this.websocket.once(yt.CLOSED,()=>T(new de(q.WS_ABORT))),this.websocket.once(yt.CONNECTED,w)});this.websocket.state!=="connected"&&await f(),p.clientRequest&&(p.clientRequest.workerToken=this.token);let _=new Be((w,T)=>{let U=()=>{T(new de(q.WS_ABORT))};this.websocket.once(yt.RECONNECTING,U),this.websocket.once(yt.CLOSED,U),this.once("@".concat(h,"-").concat(this.spec.sid),k=>{w(k)})});c&&Ze.workerEvent(this.spec.sid,Sf(Sf({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));let v=Date.now();this.websocket.sendMessage(p);let b=null;try{b=await _}catch(w){if(this.websocket.state==="closed")throw w;return await f(),await this.request(t,s,a)}return c&&Ze.workerEvent(this.spec.sid,Sf(Sf({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:b.code===200,responseTime:Date.now()-v})),b.code!==200&&this.handleResponseError(b),b}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Ii==="4.24.0"?"0.0.1":Ii;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Js.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void A.warning("live stream response already exists stream");case Js.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Js.LIVE_STREAM_RESPONSE_BAD_STREAM:case Js.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new de(q.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Js.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new de(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Js.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new de(q.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Js.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let s=new de(q.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(zc.WARNING,s,t.serverResponse.url)}case Js.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let s=new de(q.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(zc.WARNING,s,t.serverResponse.url)}case Js.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new de(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Js.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new de(q.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Js.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let s=new de(q.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(zc.WARNING,s,t.serverResponse.url)}case Js.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new de(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Js.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new de(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Js.LIVE_STREAM_RESPONSE_WORKER_LOST:case Js.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new de(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Js.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new de(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new de(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Js.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Js.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Js.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Js.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new de(q.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Pv)},6e3)}}function w4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Nn(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?w4(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):w4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class jce extends Cs{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ks,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ks;super(),W(this,"onLiveStreamWarning",void 0),W(this,"onLiveStreamError",void 0),W(this,"spec",void 0),W(this,"retryTimeout",1e4),W(this,"connection",void 0),W(this,"httpRetryConfig",void 0),W(this,"wsRetryConfig",void 0),W(this,"streamingTasks",new Map),W(this,"isStartingStreamingTask",!1),W(this,"taskMutex",new Pr("live-streaming")),W(this,"cancelToken",pn.CancelToken.source()),W(this,"transcodingConfig",void 0),W(this,"uapResponse",void 0),W(this,"lastTaskId",1),W(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(t){let s=Nn(Nn({},Eae),t);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(A.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Nn(Nn(Nn({},vae),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){As(h.width)||ns(h.width,"config.width",0,1e4),As(h.height)||ns(h.height,"config.height",0,1e4),As(h.videoBitrate)||ns(h.videoBitrate,"config.videoBitrate",1,1e6),As(h.videoFrameRate)||ns(h.videoFrameRate,"config.videoFrameRate"),As(h.lowLatency)||Ua(h.lowLatency,"config.lowLatency"),As(h.audioSampleRate)||er(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),As(h.audioBitrate)||ns(h.audioBitrate,"config.audioBitrate",1,128),As(h.audioChannels)||er(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),As(h.videoGop)||ns(h.videoGop,"config.videoGop"),As(h.videoCodecProfile)||er(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),As(h.userCount)||ns(h.userCount,"config.userCount",0,17),As(h.backgroundColor)||ns(h.backgroundColor,"config.backgroundColor",0,16777215),As(h.userConfigExtraInfo)||gr(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!As(h.transcodingUsers)&&(nc(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((p,f)=>{nE(p.uid),As(p.x)||ns(p.x,"transcodingUser[".concat(f,"].x"),0,1e4),As(p.y)||ns(p.y,"transcodingUser[".concat(f,"].y"),0,1e4),As(p.width)||ns(p.width,"transcodingUser[".concat(f,"].width"),0,1e4),As(p.height)||ns(p.height,"transcodingUser[".concat(f,"].height"),0,1e4),As(p.zOrder)||ns(p.zOrder-1,"transcodingUser[".concat(f,"].zOrder"),0,100),As(p.alpha)||ns(p.alpha,"transcodingUser[".concat(f,"].alpha"),0,1,!1)})),As(h.watermark)||gC(h.watermark,"watermark"),As(h.backgroundImage)||gC(h.backgroundImage,"backgroundImage"),h.images&&!As(h.images)&&(nc(h.images,"config.images"),h.images.forEach((p,f)=>{gC(p,"images[".concat(f,"]"))}))}(s);let a=[];s.images&&a.push(...s.images.map(h=>Nn(Nn(Nn({},fC),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(Nn(Nn(Nn({},fC),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(Nn(Nn(Nn({},fC),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Nn({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);let c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?Be.resolve(h.uid):$U(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Be.all(c)).forEach((h,p)=>{s.userConfigs&&s.userConfigs[p]&&(s.userConfigs[p].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;let h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Vn(d=this.streamingTasks).call(d)).map(p=>p.taskId).join("#")});A.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(p=>{A.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,h).then(()=>{A.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(p.url," success"))}).catch(f=>{A.error("[".concat(this.spec.clientId,"] live streaming republish failed"),p.url,f.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,f)})})}}async startLiveStreamingTask(t,s,a){if(!this.transcodingConfig&&s===ic.TRANSCODE)throw new de(q.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};A.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(s));let d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(t)&&!a)return d(),new de(q.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(p){throw d(),p}switch(s){case ic.TRANSCODE:c.transcodingConfig=Nn({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let h=this.lastTaskId++;try{let p=new Be((_,v)=>{_r(this.retryTimeout).then(()=>{if(a)return v(a);let b=this.statusError.get(t);return b?(this.statusError.delete(t),v(b)):void 0})}),f=await Be.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:s===ic.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),p]);this.isStartingStreamingTask=!1,A.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(t,{clientRequest:c,mode:s,url:t,taskId:h}),d()}catch(p){if(d(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||a)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,s,p)):await this.startLiveStreamingTask(t,s,p)}}stopLiveStreamingTask(t){return new Be((s,a)=>{let c=this.streamingTasks.get(t);if(!c||!this.connection)return new de(q.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let d=c.mode;c.abortTask=()=>{A.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:d===ic.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{A.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(a)})}resetAllTask(){var t;let s=Array.from(Vn(t=this.streamingTasks).call(t));this.terminate();for(let a of s)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=pn.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new de(q.UNEXPECTED_ERROR,"live streaming connection has already connected");let s=await Rr(this,_C.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=s,this.connection=new Oce(s.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(zc.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(zc.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(zc.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new de(q.UNEXPECTED_ERROR,"can not get new live streaming address list"));Rr(this,_C.REQUEST_WORKER_MANAGER_LIST,t).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(t){let s=t.serverStatus&&t.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=t.reason;switch(t.code){case Js.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Js.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Js.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Js.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let h=new de(q.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(a)return A.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Js.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let h=new de(q.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Js.LIVE_STREAM_RESPONSE_WORKER_LOST:case Js.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();let h=Array.from(Vn(d=this.streamingTasks).call(d));for(let p of h)p.abortTask?p.abortTask():(A.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new de(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{A.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(f=>{A.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,f)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let Pce={name:"LiveStreaming",create:function(e){return new jce(e.joinInfo,e.websocketRetryConfig||Ks,e.httpRetryConfig||Ks)}};function kce(e){let t=T4();return function(s,a){let c=s.appId;c!==void 0&&(es(a,10),jo(a,c));let d=s.cid;d!==void 0&&(es(a,16),es(a,d));let h=s.cname;h!==void 0&&(es(a,26),jo(a,h));let p=s.deviceId;p!==void 0&&(es(a,34),jo(a,p));let f=s.elapse;f!==void 0&&(es(a,40),ol(a,f));let _=s.fileSize;_!==void 0&&(es(a,48),ol(a,Oh(_)));let v=s.height;v!==void 0&&(es(a,56),ol(a,Oh(v)));let b=s.jpg;b!==void 0&&(es(a,66),es(a,b.length),function(Ur,we){let Le=jh(Ur,we.length);Ur.bytes.set(we,Le)}(a,b));let w=s.networkType;w!==void 0&&(es(a,72),ol(a,Oh(w)));let T=s.osType;T!==void 0&&(es(a,80),ol(a,Oh(T)));let U=s.requestId;U!==void 0&&(es(a,90),jo(a,U));let k=s.sdkVersion;k!==void 0&&(es(a,98),jo(a,k));let F=s.sequence;F!==void 0&&(es(a,104),ol(a,Oh(F)));let K=s.sid;K!==void 0&&(es(a,114),jo(a,K));let Y=s.timestamp;Y!==void 0&&(es(a,120),ol(a,Y));let X=s.uid;X!==void 0&&(es(a,128),es(a,X));let re=s.vid;re!==void 0&&(es(a,136),es(a,re));let te=s.width;te!==void 0&&(es(a,144),ol(a,Oh(te)));let Z=s.service;Z!==void 0&&(es(a,152),es(a,Z));let le=s.callbackData;le!==void 0&&(es(a,162),jo(a,le));let xe=s.jpgEncryption;xe!==void 0&&(es(a,168),es(a,xe));let Ce=s.requestType;Ce!==void 0&&(es(a,176),es(a,Ce));let je=s.scorePorn;je!==void 0&&(es(a,185),bT(a,je));let wt=s.scoreSexy;wt!==void 0&&(es(a,193),bT(a,wt));let Ct=s.scoreNeutral;Ct!==void 0&&(es(a,201),bT(a,Ct));let mt=s.scene;mt!==void 0&&(es(a,208),es(a,mt));let Yt=s.ossFilePrefix;Yt!==void 0&&(es(a,218),jo(a,Yt));let zt=s.serviceVendor;if(zt!==void 0)for(let Ur of zt){es(a,226);let we=T4();Fce(Ur,we),es(a,we.limit),Wce(a,we),Bce(we)}}(e,t),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(t)}function Lce(e){return function(s){let a={};e:for(;!N4(s);){let c=Po(s);switch(c>>>3){case 0:break e;case 1:a.code=Po(s);break;case 2:a.msg=R4(s,Po(s));break;case 3:{let d=Uce(s);a.data=Mce(s),s.limit=d;break}default:S4(s,7&c)}}return a}({bytes:t=e,offset:0,limit:t.length});var t}function Mce(e){let t={};e:for(;!N4(e);){let s=Po(e);switch(s>>>3){case 0:break e;case 1:t.requestId=R4(e,Po(e));break;case 2:t.requestType=Po(e)>>>0;break;case 3:t.scorePorn=xT(e);break;case 4:t.scoreSexy=xT(e);break;case 5:t.scoreNeutral=xT(e);break;case 6:t.requestScene=Po(e)>>>0;break;case 7:t.scene=Po(e)>>>0;break;default:S4(e,7&s)}}return t}function Fce(e,t){let s=e.service;s!==void 0&&(es(t,8),es(t,s));let a=e.vendor;a!==void 0&&(es(t,16),es(t,a));let c=e.token;c!==void 0&&(es(t,26),jo(t,c));let d=e.callbackUrl;d!==void 0&&(es(t,34),jo(t,d))}function Uce(e){let t=Po(e),s=e.limit;return e.limit=e.offset+t,s}function S4(e,t){switch(t){case 0:for(;128&A4(e););break;case 2:ET(e,Po(e));break;case 5:ET(e,4);break;case 1:ET(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Vce=new Float32Array(1);new Uint8Array(Vce.buffer);let vT=new Float64Array(1),Rn=new Uint8Array(vT.buffer);function Oh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let C4=[];function T4(){let e=C4.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Bce(e){C4.push(e)}function ET(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function N4(e){return e.offset>=e.limit}function jh(e,t){let s=e.bytes,a=e.offset,c=e.limit,d=a+t;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),a}function yT(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function R4(e,t){let s=yT(e,t),a=String.fromCharCode,c=e.bytes,d="",h="";for(let p=0;p<t;p++){let f,_,v,b,w=c[p+s];128&w?(224&w)==192?p+1>=t?h+=d:(f=c[p+s+1],(192&f)!=128?h+=d:(b=(31&w)<<6|63&f,b<128?h+=d:(h+=a(b),p++))):(240&w)==224?p+2>=t?h+=d:(f=c[p+s+1],_=c[p+s+2],(49344&(f|_<<8))!=32896?h+=d:(b=(15&w)<<12|(63&f)<<6|63&_,b<2048||b>=55296&&b<=57343?h+=d:(h+=a(b),p+=2))):(248&w)==240?p+3>=t?h+=d:(f=c[p+s+1],_=c[p+s+2],v=c[p+s+3],(12632256&(f|_<<8|v<<16))!=8421504?h+=d:(b=(7&w)<<18|(63&f)<<12|(63&_)<<6|63&v,b<65536||b>1114111?h+=d:(b-=65536,h+=a(55296+(b>>10),56320+(1023&b)),p+=3))):h+=d:h+=a(w)}return h}function jo(e,t){let s=t.length,a=0;for(let h=0;h<s;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<s&&(p=(p<<10)+t.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}es(e,a);let c=jh(e,a),d=e.bytes;for(let h=0;h<s;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<s&&(p=(p<<10)+t.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function Wce(e,t){let s=jh(e,t.limit),a=e.bytes,c=t.bytes;for(let d=0,h=t.limit;d<h;d++)a[d+s]=c[d]}function A4(e){return e.bytes[yT(e,1)]}function I4(e,t){let s=jh(e,1);e.bytes[s]=t}function xT(e){let t=yT(e,8),s=e.bytes;return Rn[0]=s[t++],Rn[1]=s[t++],Rn[2]=s[t++],Rn[3]=s[t++],Rn[4]=s[t++],Rn[5]=s[t++],Rn[6]=s[t++],Rn[7]=s[t++],vT[0]}function bT(e,t){let s=jh(e,8),a=e.bytes;vT[0]=t,a[s++]=Rn[0],a[s++]=Rn[1],a[s++]=Rn[2],a[s++]=Rn[3],a[s++]=Rn[4],a[s++]=Rn[5],a[s++]=Rn[6],a[s++]=Rn[7]}function Po(e){let t,s=0,a=0;do t=A4(e),s<32&&(a|=(127&t)<<s),s+=7;while(128&t);return a}function es(e,t){for(t>>>=0;t>=128;)I4(e,127&t|128),t>>>=7;I4(e,t)}function ol(e,t){let s=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=jh(e,d),p=e.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=d!==9?128|c:127&c;case 8:p[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:p[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:p[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:p[h+4]=d!==5?128|a:127&a;case 4:p[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:p[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:p[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:p[h]=d!==1?128|s:127&s}}function D4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}let Gce=new Map([["moderation",1],["supervise",2]]);class Hce extends Cs{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let s=this._connectionState;this._connectionState=t,this.emit(ur.CONNECTION_STATE_CHANGE,s,t)}get inspectType(){return this._inspectType}set inspectType(t){var s;this._inspectMode=Ji(s=t.map(a=>Gce.get(a)||0)).call(s,(a,c)=>a+c),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),W(this,"name","AgoraRTCVideoContentInspect"),W(this,"_connectionState",la.CONNECTING),W(this,"_innerConnectionState",void 0),W(this,"sequence",0),W(this,"inspectStartTime",void 0),W(this,"workerManagerConnection",void 0),W(this,"workerConnection",void 0),W(this,"workerMessageLengthLimit",void 0),W(this,"inspectIntervalMinimum",void 0),W(this,"qualityRatio",void 0),W(this,"_connectInfo",void 0),W(this,"_cancelTokenSource",pn.CancelToken.source()),W(this,"_retryConfig",void 0),W(this,"wmSequence",0),W(this,"inspectInterval",void 0),W(this,"inspectTimer",null),W(this,"ossFilePrefix",void 0),W(this,"extraInfo",void 0),W(this,"_inspectType",void 0),W(this,"_inspectMode",void 0),W(this,"_quality",1),W(this,"qualityTimer",null),W(this,"_inspectId",void 0),W(this,"_needWorkUrlOnly",!1),W(this,"inspectImage",()=>{if(this.connectionState!==la.CONNECTED)throw new de(q.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===la.CONNECTED?this.requestToInspectImage():A.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=os(5,"inspect-"),this.workerMessageLengthLimit=$("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=$("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=$("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ym("worker-manager-"+this._inspectId,Ks),this.on(ur.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,A.debug("[".concat(this._inspectId,"] Inspect operation :").concat(da[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ym("worker-"+this._inspectId,Ks),this.handleWorkerEvents()}async init(t,s){this.emit(ur.STATE_CHANGE,da.CONNECT_AP),this._connectInfo=t;let a=this._cancelTokenSource.token;return this._retryConfig=s,new Be((c,d)=>{this.on(ur.CONNECTION_STATE_CHANGE,(h,p)=>{p===la.CONNECTED&&c()}),this.requestAP(t,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(t,s,a){let c=$("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),d=await function(p,f,_,v){let{appId:b,areaCode:w,cname:T,sid:U,token:k,uid:F}=f;bh++;let K="image_moderation_api",Y={service_name:K,json_body:JSON.stringify({appId:b,areaCode:w,cname:T,command:"allocateEdge",requestId:bh,seq:bh,sid:U,token:k,ts:Date.now(),uid:F+""})},X,re,te=p[0];return Va(async()=>{X=Date.now();let Z=await za(te,{data:Y,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(re=Date.now()-X,Z.code!==0){let je=new de(q.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Z.code,{retry:!0,responseTime:re});throw A.error(je.toString()),je}let le=JSON.parse(Z.json_body);if(le.code!==200){let je=new de(q.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(le.code,", reason: ").concat(le.reason),{code:le.code,responseTime:re});throw A.error(je.toString()),je}if(!le.servers||!Array.isArray(le.servers)||le.servers.length===0){let je=new de(q.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:le.code,responseTime:re});throw A.error(je.toString()),je}let xe=$("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ce=$("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:le.servers.map(je=>{let{address:wt,wss:Ct}=je;if(wt&&Ct)return"wss://".concat(wt.replace(/\./g,"-"),".").concat(xe,":").concat(Ce||Ct)}).filter(je=>!!je),workerToken:le.workerToken,vid:le.vid,responseTime:re}},(Z,le)=>(Ze.apworkerEvent(U,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(Z.addressList),firstSuccess:le===0,responseTime:re,serverIp:p[le%p.length]}),!1),(Z,le)=>(Ze.apworkerEvent(U,{success:!1,sc:Z.data&&Z.data.code||200,serviceName:K,responseTime:re,serverIp:p[le%p.length]}),!!(Z.code!==q.OPERATION_ABORTED&&Z.code!==q.UNEXPECTED_RESPONSE||Z.data&&Z.data.retry)&&(te=p[(le+1)%p.length],!0)),v)}(c,t,s,a);this.emit(ur.STATE_CHANGE,da.AP_CONNECTED);let{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(t){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(ur.STATE_CHANGE,da.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(yt.CONNECTED,async()=>{this.emit(ur.STATE_CHANGE,da.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(yt.CLOSED,()=>{this._innerConnectionState<da.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(yt.FAILED,()=>{this._innerConnectionState<da.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(yt.RECONNECTING,()=>{this._innerConnectionState<da.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(yt.ON_MESSAGE,async t=>{this.emit(ur.STATE_CHANGE,da.GET_WORKER_MANAGER_RESPONSE);let s=this.workerManagerConnection.url;this.workerManagerConnection.close();let a=JSON.parse(t.data);if(a.code!==200)throw A.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new de(q.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw A.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new de(q.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{let c=$("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(ur.STATE_CHANGE,da.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(ur.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(yt.WILL_RECONNECT,(t,s,a)=>{a(t)}),this.workerManagerConnection.on(yt.REQUEST_NEW_URLS,(t,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(s)})}handleWorkerEvents(){this.workerConnection.on(yt.CONNECTED,async()=>{this.emit(ur.STATE_CHANGE,da.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=la.CONNECTED}),this.workerConnection.on(yt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let a=Lce(new Uint8Array(t.data));if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&A.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ur.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;let c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=Ji(s=Object.keys(c)).call(s,(p,f)=>c[p]>c[f]?p:f,"porn"),h=Object.keys(c).find(p=>p===d);this.emit(ur.INSPECT_RESULT,h)}else this.emit(ur.INSPECT_RESULT,void 0,new de(q.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(ur.INSPECT_RESULT,void 0,new de(q.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else A.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ur.INSPECT_RESULT,void 0,new de(q.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(yt.CLOSED,()=>{this.connectionState=la.CLOSED}),this.workerConnection.on(yt.FAILED,()=>{this.connectionState=la.CLOSED}),this.workerConnection.on(yt.RECONNECTING,()=>{this.connectionState=this.connectionState===la.CONNECTED?la.RECONNECTING:la.CONNECTING}),this.workerConnection.on(yt.WILL_RECONNECT,(t,s,a)=>{t==="recover"&&a(t),a("tryNext")}),this.workerConnection.on(yt.REQUEST_NEW_URLS,(t,s)=>{this.workerManagerConnection.close(),this.once(ur.REQUEST_NEW_WORKER_URL,a=>{t([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}async requestToInspectImage(){this.sequence++;let t=oi(this,ur.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(ur.INSPECT_RESULT,void 0,new de(q.INVALID_OPERATION,"Only the track being played can be inspected"));let a=await this.generateRequestData(t,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(ur.INSPECT_RESULT,void 0,new de(q.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,s){let{appId:a,cname:c,cid:d,vid:h,sid:p,uid:f}=s,_=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),b=await hM(v,a,c),w=this.sequence+"-"+d+"-"+f+"-"+_+"-"+os(12,""),T={appId:a,cid:d,cname:c,deviceId:"",elapse:(U=Number(_-this.inspectStartTime),{low:U|=0,high:U>>31,unsigned:U>=0}),fileSize:b.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:b,networkType:6,osType:7,requestId:w,sdkVersion:"4.24.0",sequence:this.sequence,sid:p,timestamp:U5(_),uid:f,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var U;this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;let k=kce(T);if(k.byteLength<this.workerMessageLengthLimit){if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let F=function(K){for(var Y=1;Y<arguments.length;Y++){var X=arguments[Y]!=null?arguments[Y]:{};Y%2?D4(Object(X),!0).forEach(function(re){W(K,re,X[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(X)):D4(Object(X)).forEach(function(re){Object.defineProperty(K,re,Object.getOwnPropertyDescriptor(X,re))})}return K}({},T);delete F.jpg,A.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(F))}return k}{let F=this.quality*this.qualityRatio;return this.quality=F,await this.generateRequestData(t,{appId:a,cname:c,cid:d,vid:h,sid:p,uid:f})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=pn.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=la.CLOSED,this.emit(ur.STATE_CHANGE,da.CLOSED)}}let zce={name:"ContentInspect",create:function(e){let{config:t}=e;return function(s){if(!s)throw new de(q.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new de(q.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let a=[...new Set(s.inspectType)];a.forEach(c=>{var d;if(!ke(d=["supervise","moderation"]).call(d,c))throw new de(q.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new de(q.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Hce(t)}};var O4=u(Os.Object.getOwnPropertySymbols),Kce=Zt,qce=Ob.indexOf,Yce=n_,wT=ne([].indexOf),j4=!!wT&&1/wT([1],1,-0)<0;Kce({target:"Array",proto:!0,forced:j4||!Yce("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return j4?wT(this,e,t)||0:qce(this,e,t)}});var $ce=Xi("Array","indexOf"),Xce=R,Jce=$ce,ST=Array.prototype,Qce=function(e){var t=e.indexOf;return e===ST||Xce(ST,e)&&t===ST.indexOf?Jce:t},P4=u(Qce);function Zce(e,t){if(e==null)return{};var s,a,c=function(h,p){if(h==null)return{};var f={};for(var _ in h)if({}.hasOwnProperty.call(h,_)){if(P4(p).call(p,_)!==-1)continue;f[_]=h[_]}return f}(e,t);if(O4){var d=O4(e);for(a=0;a<d.length;a++)s=d[a],P4(t).call(t,s)===-1&&{}.propertyIsEnumerable.call(e,s)&&(c[s]=e[s])}return c}let k4=class{get localCapabilities(){return bs(this._localCapabilities)}get rtpCapabilities(){return bs(this._rtpCapabilities)}get candidates(){return bs(this._candidates)}get iceParameters(){return bs(this._iceParameters)}get dtlsParameters(){return bs(this._dtlsParameters)}constructor(e){W(this,"sessionDesc",void 0),W(this,"_localCapabilities",void 0),W(this,"_rtpCapabilities",void 0),W(this,"_candidates",void 0),W(this,"_iceParameters",void 0),W(this,"_dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname","o/i14u9pJrxRKAsu"),W(this,"firefoxSsrcMidMap",new Map),e=bs(e);let{remoteIceParameters:t,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:p,videoCodec:f,audioCodec:_}=e,v;this.setup=p,v=h===on.RECEIVE_ONLY?Sn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Sn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=t,this._dtlsParameters=s,this._localCapabilities=d;let b=h===on.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,w=h===on.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=h===on.RECEIVE_ONLY?c.send.videoCodecs:Qm(ze.VIDEO,b,w,f),U=h===on.RECEIVE_ONLY?c.send.audioCodecs:Qm(ze.AUDIO,b,w,_);for(let k of v.mediaDescriptions)k.attributes.iceUfrag=t.iceUfrag,k.attributes.icePwd=t.icePwd,k.attributes.fingerprints=s.fingerprints,k.attributes.candidates=a,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video"&&(k.media.fmts=T.map(F=>F.payloadType.toString(10)),k.attributes.payloads=T,k.attributes.extmaps=b.videoExtensions),k.media.mediaType==="audio"&&(k.media.fmts=U.map(F=>F.payloadType.toString(10)),k.attributes.payloads=U,k.attributes.extmaps=b.audioExtensions,xh(k));this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return Gc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,s,a,c){s=s.replace(/ /g,"-");let{ssrcs:d,ssrcGroups:h}=Jm(t,this.cname,$("SYNC_GROUP")?s:void 0),p=this.findPreloadMediaDesc(d);if(p){if(Rs()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),c&&(c.twcc||c.remb)){let f=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{let f=this.findAvailableMediaIndex(e,d,a),_;return f===-1?(_=this.createOrRecycleSendMedia(e,d,h,"sendonly",a,c),this.updateBundleMids()):(_=bs(this.sessionDesc.mediaDescriptions[f]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(_,c)),Rs()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{needExchangeSDP:!0,mid:_.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,s){let a=[];return e.forEach(c=>{let d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d),p,f=!1;h===-1?(f=!0,p=this.createOrRecycleRecvMedia(c,[],"recvonly",t,s),this.updateBundleMids()):(p=bs(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="recvonly"),a.push({mid:p.attributes.mid,needCreateTransceiver:f})}),a}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(s=>e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:s,address:a,port:c,type:d,relatedAddress:h,relatedPort:p,priority:f}=new RTCIceCandidate(e),_={foundation:t??"",componentId:"1",transport:s??"",priority:f?f+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:p?p+"":"",extension:{}};this.candidates.some(v=>v.priority===_.priority&&v.connectionAddress===_.connectionAddress&&v.port===_.port)||(this._candidates.push(_),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,s,a,c){let d=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=Qm(d,h,this.localCapabilities.send,d===ze.AUDIO?c:a),f=d===ze.VIDEO?h.videoExtensions:h.audioExtensions,_="".concat(++this.currentMidIndex),v={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungRecvMediaDsec(v,e);let b=this.findFirstClosedMedia(d);if(b){let w=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[w]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(s=>ke(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(s=>ke(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{let c=a.media.mediaType===e&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(Rs()){if(c){let d=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let s=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&s})}predictReceivingMids(e){let t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}restartICE(e){e=bs(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,s,a,c,d){let h=this.rtpCapabilities.send,p=e===ze.VIDEO?h.videoCodecs:h.audioCodecs,f=e===ze.VIDEO?h.videoExtensions:h.audioExtensions;Rs()&&(c="".concat(++this.currentMidIndex));let _={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};_=this.mungSendMediaDesc(_,d);let v=this.findFirstClosedMedia(e);if(v){let b=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[b]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}mungRecvMediaDsec(e,t,s){let a=bs(e);return wC(a),yh(a,t),SC(a,t),AU(a),hE(a,s,this.localCapabilities.send),a}mungSendMediaDesc(e,t){let s=bs(e);return hE(s,t,this.localCapabilities.recv),xh(s),s}updateRecvMedia(e,t){let s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===e);if(s!==-1){let a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var s;return((s=t.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Rs()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},ele=["sdp"];var ps;function L4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function cl(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?L4(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):L4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let M4=(ps=class Bh extends uU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,s,a){super(t,s),W(this,"direction",void 0),W(this,"name",void 0),W(this,"store",void 0),W(this,"spec",void 0),W(this,"peerConnection",void 0),W(this,"initialOffer",void 0),W(this,"transport",void 0),W(this,"statsFilter",void 0),W(this,"localCandidateCount",0),W(this,"_isInRestartIce",!1),W(this,"mutex",void 0),W(this,"onLocalCandidate",void 0),W(this,"remoteSDP",void 0),W(this,"pendingCandidates",[]),W(this,"localCapabilities",void 0),W(this,"isReady",!1),W(this,"restartCnt",0),W(this,"curTurnServerIndex",0),this.store=s,this.spec=t,this.mutex=new Pr("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Bh.resolvePCConfiguration(t,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??on.SEND_ONLY,this.name=this.direction===on.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=O0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Rs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let s=await DU();if(this.localCapabilities=pE(s),t){let{sdp:a}=t,c=Zce(t,ele),d=function(){let v={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},b=Xm(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ua(b,v,"videoExtensions",w,T,U),ua(b,v,"videoCodecs",w,T,U),ua(b,v,"audioExtensions",w,T,U),ua(b,v,"audioCodecs",w,T,U),$("RAISE_H264_BASELINE_PRIORITY")){let k=U.videoCodecs.findIndex(F=>F.rtpMap&&F.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&F.fmtp&&F.fmtp.parameters["profile-level-id"]==="42001f");if(k!==-1){let F=U.videoCodecs.findIndex(K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(F<k){A.debug("raising H264 baseline profile priority");let K=U.videoCodecs[k];U.videoCodecs.splice(k,1),U.videoCodecs.splice(F,0,K)}F!==-1&&$("FILTER_SEND_H264_BASELINE")&&(w.videoCodecs=w.videoCodecs.filter(K=>!(K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:w,recv:T,sendrecv:U}}({},{},a);this.remoteSDP=new k4({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let p=$c(h.sdp);await this.peerConnection.setLocalDescription(h);let f=await OU({},{},h.sdp);this.localCapabilities=pE(f);let _=this.peerConnection.getTransceivers()[0];return _!=null&&_.receiver&&_.receiver.transport&&this.tryBindTransportEvents(_.receiver.transport),cl(cl({},p),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let c=$c(a.sdp);return this.initialOffer=a,cl(cl({},c),{},{sdp:a.sdp})}}catch(s){throw new _e(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:s,iceParameters:a,dtlsParameters:c}=t,d=await OU({},{},s);this.remoteSDP=new k4({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new _e(q.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(t,s,a){var c=this;return Ai(function*(){let d=yield Ut(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let h=[],p=c.remoteSDP.receive(t,s,a);t.forEach((F,K)=>{if(p[K].needCreateTransceiver){let Y=c.peerConnection.addTransceiver(F._mediaStreamTrack,{direction:"sendonly"});h.push(Y),F._updateRtpTransceiver(Y)}else{let Y=c.peerConnection.getTransceivers().find(X=>X.mid===p[K].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[K].mid));h.push(Y),F._updateRtpTransceiver(Y)}}),Rs()&&$("SIMULCAST")===!0&&(yield Ut(c.applySimulcastForFirefox(h,t)));let f=p.map(F=>F.mid),_=yield Ut(c.peerConnection.createOffer()),v=c.mungSendOfferSDP(_.sdp,t,f),b=Sn(v),w=f.map(F=>{let K=b.mediaDescriptions.find(Y=>Y.attributes.mid===F);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return TU(K,$("USE_PUB_RTX"))}),T=h.map((F,K)=>{let Y=f[K];return{localSSRC:w[K],id:Y}});yield Ut(c.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield T}catch(F){let K=c.remoteSDP.toString();throw yield Ut(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ut(c.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield Ut(c.stopSending(f,!0)),F}yield Ut(c.applySimulcastEncodings(h,t)),yield Ut(c.applySendEncodings(h,t));let U=c.remoteSDP.toString(),k=c.logSDPExchange(v,"offer","local","send");return k==null||k(U),yield Ut(c.setRemoteDescription({type:"answer",sdp:U})),h.map((F,K)=>{let Y=f[K];return{localSSRC:w[K],id:Y}})}catch(h){throw h instanceof _e?h:new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(t,s){let a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(f=>t.indexOf(f.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map(f=>{var _;f.direction="inactive",(_=f.stop)===null||_===void 0||_.call(f)});let d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);let p=this.remoteSDP.toString();h==null||h(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,s,a,c);if(h){let f=this.remoteSDP.toString(),_=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});let v=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(v.sdp,d,t);_==null||_(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let p=this.peerConnection.getTransceivers().find(f=>f.mid===d);if(!p||p.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,transceiver:p}}catch(d){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(t,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,s,a,c);if(h){let p=this.remoteSDP.toString(),f=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});let _=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(_.sdp,d,t);f==null||f(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(d){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===ud.Auto&&(this.store.p2pTransport=ud.SdRtn,Vt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Bh.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Vt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Bh.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:a}=$c(s.sdp);return this.store.descriptionStart(),this.direction===on.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===on.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:a}=$c(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);let d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new _e(q.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,s){let a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(s)?Rs()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){let a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let s=t[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:cl(cl({},bo),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:cl(cl({},bo),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,s;ke(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var s;t.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c={iceServers:[]};var d;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(km(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...Bh.turnServerConfigToIceServers(t.turnServer.servers,s,a)),$("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...Bh.turnServerConfigToIceServers(t.turnServer.serversFromGateway,s,a)),ke(d=[ud.Relay,ud.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),$("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&Vt().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),A.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=[],d=t.filter(p=>p.tcpport);A.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));let h=d.length>a?d[a]:d[0];switch(s){case ud.SdRtn:let p=t.filter(_=>{var v;return ke(v=_.username).call(v,"glb:")&&_.turnServerURL==_.turnServerURL}),f=p.length>a?p[a]:p[0];f&&(c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(qc(f.turnServerURL),":").concat(f.tcpport,"?transport=udp")}),c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(qc(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}));break;case ud.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(qc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(qc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var a;t!=null&&t.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,t.state))},t.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};let s=t.iceTransport;s&&(s.onstatechange=()=>{let a=t==null?void 0:t.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){let{local:a,remote:c}=s.getSelectedCandidatePair()||{};if(a&&c){let d=a.address+":"+a.port,h=c.address+":"+c.port;A.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Ed(d)),", remote ").concat(JSON.stringify(Ed(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var a;if(s||(s=this.peerConnection.getSenders().find(v=>v.track===t._mediaStreamTrack)),!s)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return A.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vt().supportSetRtpSenderParameters)return A.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var h;let{bitrateMax:v,frameRate:b,scaleResolutionDownBy:w}=t._encoderConfig;v&&(d.maxBitrate=1e3*v),ke(h=t._hints).call(h,is.LOW_STREAM)&&(b&&(d.maxFramerate=Hn(b)),w&&w>=1&&(d.scaleResolutionDownBy=w))}if($("DSCP_TYPE")&&rc()){var p;let v=$("DSCP_TYPE");ke(p=["very-low","low","medium","high"]).call(p,v)&&(d.networkPriority=v)}let f=s.getParameters(),_=(a=f.encodings)===null||a===void 0?void 0:a[0];Rs()&&!_&&(c.encodings=[d]),_&&Object.assign(_,d),Object.assign(f,c),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await s.setParameters(f)}async applySendEncodings(t,s){try{if(!Vt().supportSetRtpSenderParameters||t.length!==s.length)return;for(let a=0;a<t.length;a++){let c=t[a],d=s[a];d instanceof hs&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,a){let c=Sn(t);return s.forEach((d,h)=>{let p=a[h],f=c.mediaDescriptions.find(_=>_.attributes.mid===p);f&&(yh(f,d),IU(f,d,this.store.codec))}),Gc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let f=0;f<t.length;f++){var a,c,d,h,p;let _=t[f],v=s[f];if(v instanceof hs&&!ke(a=v._hints).call(a,is.LOW_STREAM)&&(c=v._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=v._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=v._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){let b={},w={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];let T=_.sender.getParameters();await _.sender.setParameters(Object.assign(T,b))}}}async applySimulcastEncodings(t,s){if(!Rs()&&t.length===s.length)for(let a=0;a<t.length;a++){let c=s[a];if(c instanceof hs&&this.isVP8Simulcast(c)){let d=t[a],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];let f=d.sender.getParameters();await d.sender.setParameters(Object.assign(f,h))}}}isVP8Simulcast(t){var s,a,c,d,h;return!!(t instanceof hs&&$("SIMULCAST")&&this.store.codec==="vp8"&&!ke(s=t._hints).call(s,is.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,s,a,c){if($("SDP_LOGGING"))return A.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),t),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let s=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let s=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(t,s){var a;if(s=s??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var c;let d=(c=Sn(s).mediaDescriptions.find(h=>h.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(t){var s;await this.peerConnection.setRemoteDescription(t),ke(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,s,a){let c=Sn(t),d=c.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&a===ze.AUDIO&&d.media.mediaType==="audio"&&xh(d),Gc(c)}},Je(ps.prototype,"establish",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"establish"),ps.prototype),Je(ps.prototype,"connect",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"connect"),ps.prototype),Je(ps.prototype,"receive",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"receive"),ps.prototype),Je(ps.prototype,"mockReceive",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"mockReceive"),ps.prototype),Je(ps.prototype,"stopReceiving",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"stopReceiving"),ps.prototype),Je(ps.prototype,"restartICE",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"restartICE"),ps.prototype),Je(ps.prototype,"close",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"close"),ps.prototype),Je(ps.prototype,"updateEncoderConfig",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"updateEncoderConfig"),ps.prototype),Je(ps.prototype,"updateSendParameters",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"updateSendParameters"),ps.prototype),Je(ps.prototype,"replaceTrack",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"replaceTrack"),ps.prototype),Je(ps.prototype,"muteLocal",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"muteLocal"),ps.prototype),Je(ps.prototype,"unmuteLocal",[ga],Object.getOwnPropertyDescriptor(ps.prototype,"unmuteLocal"),ps.prototype),ps);function ga(e,t,s){let a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},s}let Ya=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var F4,U4,V4,B4,W4,G4,H4,z4,K4,q4,Y4,ws;function $4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function XE(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?$4(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let tle=(F4=$a(Ya.SEND_ONLY),U4=$a(Ya.SEND_ONLY),V4=$a(),B4=$a(Ya.RECEIVE_ONLY),W4=$a(Ya.RECEIVE_ONLY),G4=$a(Ya.RECEIVE_ONLY),H4=$a(Ya.RECEIVE_ONLY),z4=$a(Ya.RECEIVE_ONLY),K4=$a(Ya.RECEIVE_ONLY),q4=$a(),Y4=$a(Ya.RECEIVE_ONLY),ws=class extends Cs{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(nt.StateChange,t,this._state)}constructor(e,t){super(),W(this,"isPlanB",!1),W(this,"store",void 0),W(this,"statsUploader",void 0),W(this,"sendConnection",void 0),W(this,"recvConnection",void 0),W(this,"localTrackMap",new Map),W(this,"remoteUserMap",new Map),W(this,"localDataChannels",[]),W(this,"pendingLocalTracks",[]),W(this,"pendingRemoteTracks",[]),W(this,"statsCollector",void 0),W(this,"dtlsFailedCount",0),W(this,"sendMutex",void 0),W(this,"recvMutex",void 0),W(this,"_state",Xt.Disconnected),W(this,"_restartStates",["disconnected","failed"]),W(this,"reconnectInterval",void 0),W(this,"uploadUnplinkStarted",!1),W(this,"uploadDownlinkStarted",!1),W(this,"uplinkStateUploadInterval",void 0),W(this,"downlinkStatsUploadInterval",void 0),W(this,"handleMuteLocalTrack",async(s,a,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Xt.Connected)return void c(new _e(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let f=this.filterTobeMutedTracks(s);if(f.length===0)return void a();let _=f.find(T=>T[0]==="videoLowTrack");_&&_[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(f.map(T=>{let[,{id:U}]=T;return U}));let v=!1;var h,p;s.trackMediaType==="video"?v=!((h=this.localTrackMap.get(Ie.LocalAudioTrack))===null||h===void 0||!h.track._muted):v=((p=this.localTrackMap.get(Ie.LocalVideoTrack))===null||p===void 0?void 0:p.id)===void 0;let b=this.createMuteMessage(f);await as(this,nt.RequestMuteLocal,b);let w=s.trackMediaType==="video"?Kc.MUTE_LOCAL_VIDEO:Kc.MUTE_LOCAL_AUDIO;await as(this,nt.RequestP2PMuteLocal,{action:w,message:b,isMuteAll:v}),a()}catch(f){c(f)}finally{d()}}),W(this,"handleUnmuteLocalTrack",async(s,a,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Xt.Connected)return void c(new _e(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(_=>{let[,{id:v}]=_;return v}));let p=this.createUnmuteMessage(h),f=s.trackMediaType==="video"?Kc.UNMUTE_LOCAL_VIDEO:Kc.UNMUTE_LOCAL_AUDIO;await as(this,nt.RequestP2PMuteLocal,{action:f,message:p}),a()}catch(h){c(h)}finally{d()}}),W(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let f=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.sendConnection||!f||f.track!==s||this.state!==Xt.Connected)return void a();let{id:_,track:v}=f;_&&(await this.sendConnection.updateSendParameters(_,v),await this.sendConnection.updateEncoderConfig(_,v),this.emit(nt.UpdateVideoEncoder,v)),a()}catch(f){c(f)}finally{var p;(p=h)===null||p===void 0||p()}}),W(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let h=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Xt.Connected)return void a();let{id:p,track:f}=h;p&&await this.sendConnection.updateSendParameters(p,f),a()}catch(h){c(h)}finally{d()}}),W(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;A.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var p;let _=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:b}]=v;return s===b});if(!this.sendConnection||!_||_[1].id===void 0||this.state!==Xt.Connected)return void a();if(await((p=this.sendConnection)===null||p===void 0?void 0:p.replaceTrack(s,_[1].id)),_[0]===Ie.LocalVideoTrack&&Vt().supportDualStreamEncoding){let v=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(v){let b=s._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=b,v.track._originMediaStreamTrack=b,await new Be((w,T)=>{this.handleReplaceTrack(v.track,w,T,!0)})}}a()}catch(_){c(_)}finally{var f;(f=h)===null||f===void 0||f()}}),W(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),W(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),W(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),W(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new p5(e),this.bindStatsUploaderEvents(),this.sendMutex=new Pr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Pr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},$("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new _e(q.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new _e(q.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let s;try{if(t){this.recvConnection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new M4(e,this.store,on.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let a=await this.recvConnection.establish(t);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=Xt.New,this.sendConnection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new M4(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(e){if(!this.sendConnection)throw new _e(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Xt.Connected}async addRemoteCandidate(e,t){if(t===on.RECEIVE_ONLY){if(!this.sendConnection)throw new _e(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new _e(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,s){var a=this;return Ai(function*(){let c=yield Ut(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==Xt.Connected){a.throwIfTrackTypeNotMatch(e);let _=e.filter(v=>a.pendingLocalTracks.indexOf(v)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(_))}a.store.pubId=a.store.pubId+1,Fr.markPublishStart(a.store.clientId,a.store.pubId);let d=a.filterTobePublishedTracks(e,t,s);if(d.length===0)return void(yield Ut(a.tryToUnmuteAudio(e)));d.forEach(_=>{let{track:v,type:b}=_,w=Date.now();a.store.publish(v.getTrackId(),b===Ie.LocalAudioTrack?"audio":"video",w)}),a.bindLocalTrackEvents(d);let h=yield Ut(a.sendConnection.send(d.map(_=>{let{track:v}=_;return v}),a.store.codec,a.store.audioCodec)),p=(yield Ut(h.next())).value,f=a.createGatewayPublishMessage(d,p);try{yield f}catch(_){throw h.throw(_),(_==null?void 0:_.code)===q.WS_ABORT&&d.forEach(v=>{let{track:b}=v;a.pendingLocalTracks.indexOf(b)===-1&&a.pendingLocalTracks.push(b)}),a.unbindLocalTrackEvents(d),_}yield Ut(h.next()),d.forEach(_=>{let{type:v}=_;a.statsCollector.addLocalStats(v)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,p),d.forEach(_=>{let{track:v,type:b}=_,w=Date.now();a.store.publish(v.getTrackId(),b===Ie.LocalAudioTrack?"audio":"video",void 0,w)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Xt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ke(e).call(e,c)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let s=t.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();let a=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),t.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Xt.Connected)return s&&s[1].track.close(),a;e.forEach(c=>{let d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],s=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:d,ssrcs:h}]=a,p={stream_type:Kae(d,c),ssrcs:h};d._muted||!d._enabled?t.push(p):s.push(p)}),t.length>0&&t.forEach(a=>{as(this,nt.RequestMuteLocal,[a])}),s.length>0&&s.forEach(a=>{as(this,nt.RequestUnmuteLocal,[a])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Ai(function*(){throw new _e(q.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(A.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Rr(this,nt.RequestRePublish,this.pendingLocalTracks),this.emit(nt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new _e(q.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,s,a){var c;if(!this.recvConnection)throw new _e(q.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let{track:d,mid:h,transceiver:p}=await this.recvConnection.receive(t,[{ssrcId:s}],String(e.uid),a);t===ze.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new hh(d,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=s,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new uh(d,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack));let f=this.remoteUserMap.get(e);f?f.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let _=this.pendingRemoteTracks.findIndex(v=>{let{user:b,kind:w}=v;return b.uid===e.uid&&t===w});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(nt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,s,a){if(!this.recvConnection)throw new _e(q.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:s}],String(e.uid),a)}async unsubscribe(e,t,s){let a=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:p}=d;return t!==void 0?h.uid===e.uid&&t===p:h.uid===e.uid});if(a.forEach(d=>{let h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||a.forEach(d=>{let{kind:h}=d;var p;if(h===ze.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===ze.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:p}]=d;var f,_;if(p===ze.VIDEO&&h._videoSSRC&&((f=this.recvConnection)===null||f===void 0||f.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===ze.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(p===ze.AUDIO){var v;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;as(this,nt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,s]=t;[ze.VIDEO,ze.AUDIO].forEach(a=>{s.has(a)?as(this,nt.RequestP2PUnmuteRemote,a):as(this,nt.RequestP2PMuteRemote,a)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new _e(q.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new _e(q.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new _e(q.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new _e(q.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let s=this.remoteUserMap.get(e);if(!s)return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let a=t===ze.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let s=this.remoteUserMap.get(e);if(!s)return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(t)||A.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(Ie.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Xs){let s=t.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ie.LocalAudioTrack}).filter(a=>{let[c]=a;return!(e&&c===Ie.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(e&&a===Ie.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(e,t,s,a,c){if(e){let h=this.localTrackMap.get(Ie.LocalAudioTrack),p=a?this.localTrackMap.get(Ie.LocalVideoLowTrack):this.localTrackMap.get(Ie.LocalVideoTrack);Ze.publish(this.store.sessionId,{eventElapse:Fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(is.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);let h=s.find(f=>f instanceof Ps),p=a?(d=this.localTrackMap.get(Ie.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(f=>f instanceof hs);Ze.publish(this.store.sessionId,{eventElapse:Fr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(is.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,s,a){let c=a===ze.VIDEO?s._videoSSRC:s._audioSSRC;c&&Ze.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===ze.VIDEO,audio:a===ze.AUDIO,peerid:s.uid,subscribeRequestid:a===ze.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Fr.measureFromSubscribeStart(this.store.clientId,c)})}reset(){A.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Pr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Pr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Ie.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Xs){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(s=>{t.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Xt.Disconnected}getStats(e){var t,s;return e?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Ie.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Ie.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof hs||t&&t.track instanceof Ps?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;let s=Array.from(Cn(t=this.remoteUserMap).call(t)).find(a=>a.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Ie.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ed(e).call(e,(s,a)=>s.level-a.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(A.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Xt.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&((s=t._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:a}]=e;switch(s){case Ie.LocalVideoTrack:ke(t=a._hints).call(t,is.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ie.LocalAudioTrack:a instanceof Xs?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ie.LocalVideoLowTrack:}}),this.emit(nt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Cn(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(t,a)}),this.emit(nt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),A.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let s of this.pendingRemoteTracks){let{user:a,kind:c}=s;if((e instanceof Zc?e.uid:e)===a.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let s,a;if(e===on.SEND_ONLY){if(!this.sendConnection)throw new _e(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new _e(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(t){let c=await a.restartICE(t);return a.isInRestartIce=!1,c}{let c=await a.restartICE();if(c){let d=await Rr(this,nt.RequestP2PRestartICE,{direction:on.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(Ie.LocalVideoTrack),s=this.localTrackMap.get(Ie.LocalAudioTrack),a=e.videoSend.find(T=>{var U;return T.ssrc===(t==null||(U=t.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)}),c=e.audioSend.find(T=>{var U;return T.ssrc===(s==null||(U=s.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)});if(!a||!c)return 1;let d=oi(this,nt.NeedSignalRTT),h=a?a.rttMs:void 0,p=c?c.rttMs:void 0,f=h&&p?(h+p)/2:h||p,_=(f&&d?(f+d)/2:f||d)||0,v=100*e.sendPacketLossRate*.7/50+.3*_/1500,b=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,w=t==null?void 0:t.track;if(w&&w._encoderConfig&&w._hints.indexOf(is.SCREEN_TRACK)===-1){let T=w._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(T&&U){let k=(1e3*T-U)/(1e3*T);return rU[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s,c=a._audioSSRC,d=a._videoSSRC,h=e.audioRecv.find(U=>U.ssrc===c),p=e.videoRecv.find(U=>U.ssrc===d);if(!h&&!p)return void(t+=1);let f=oi(this,nt.NeedSignalRTT),_=e.rtt,v=(_&&f?(_+f)/2:_||f)||0,b=h?h.jitterMs:void 0,w=e.recvPacketLossRate,T=.7*w*100/50+.3*v/1500;b&&(T=.6*w*100/50+.2*v/1500+.2*b/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Be((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}filterTobePublishedTracks(e,t,s){let a=[],c=Vt(),d=this.getAllTracks();e=Qu(e=e.filter(f=>d.indexOf(f)===-1));let h=!1,p=!1;for(let f of e){if(f instanceof hs&&(this.localTrackMap.has(Ie.LocalVideoTrack)||h?new _e(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:f,type:Ie.LocalVideoTrack}),h=!0),t)){let _=this.getLowVideoTrack(f,s);a.push({track:_,type:Ie.LocalVideoLowTrack})}if(f instanceof Ps){let _=this.localTrackMap.get(Ie.LocalAudioTrack);if(_){if(!(_.track instanceof Xs))throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0)}else if(p){let v=a.find(b=>{let{type:w}=b;return w===Ie.LocalAudioTrack});if(!(v.track instanceof Xs))throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(f)}else{if(!c.webAudioMediaStreamDest||f instanceof Xs||f._bypassWebAudio)a.push({track:f,type:Ie.LocalAudioTrack});else{let v=new Xs;v.addAudioTrack(f),a.push({track:v,type:Ie.LocalAudioTrack})}p=!0}}}return a}filterTobeUnpublishedTracks(e){let t=[],s=this.getAllTracks();e=Qu(e=e.filter(a=>s.indexOf(a)!==-1));for(let a of e){if(a instanceof Ps){let c=this.localTrackMap.get(Ie.LocalAudioTrack);if(!c)continue;c.track instanceof Xs?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(t.push([Ie.LocalAudioTrack,c]),c.track.close())):t.push([Ie.LocalAudioTrack,c])}if(a instanceof hs){let c=this.localTrackMap.get(Ie.LocalVideoTrack);if(!c)continue;t.push([Ie.LocalVideoTrack,c]);let d=this.localTrackMap.get(Ie.LocalVideoLowTrack);d&&t.push([Ie.LocalVideoLowTrack,d])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:s,type:a}=t;switch(a){case Ie.LocalVideoTrack:s.addListener(Ye.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ye.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ie.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Xs?e.trackList.forEach(s=>{s.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ye.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ye.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[s,{track:a}]=t;return{track:a,type:s}})),e.forEach(t=>{let{track:s,type:a}=t;switch(a){case Ie.LocalVideoTrack:s.off(Ye.GET_STATS,this.handleGetLocalVideoStats),s.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Ye.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ie.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Xs?e.trackList.forEach(t=>{t.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ye.GET_STATS,this.handleGetLocalAudioStats),t.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ye.GET_STATS,this.handleGetLocalAudioStats),e.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof uh&&t.addListener(Ye.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),t instanceof hh&&t.addListener(Ye.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ye.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(ze.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(ze.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((s,a)=>{var c;let d,{track:h,type:p}=s;switch(p){case Ie.LocalAudioTrack:d=Qt.Audio;break;case Ie.LocalVideoTrack:d=ke(c=h._hints).call(c,is.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:d=Qt.Low}return{kind:p===Ie.LocalAudioTrack?ze.AUDIO:ze.VIDEO,stream_type:d,mid:t[a].id,ssrcs:t[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ie.LocalVideoTrack:a=ke(s=d._hints).call(s,is.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:p}})}assignLocalTracks(e,t){e.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:t[a].id,ssrcs:t[a].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[s]=t;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var s;A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(nt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ke(s=this._restartStates).call(s,t)&&!e.isInRestartIce&&(t==="disconnected"&&await _r(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ze.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:xs.TRACER}).onSuccess(),this.emit(nt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var s;let a=Array.from(Cn(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===t);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Oi.FIRST_FRAME_DECODED),Ze.firstRemoteFrame(this.store.sessionId,tr.FIRST_AUDIO_DECODE,ys.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var s;let a=Array.from(Cn(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===t);a&&Ze.firstRemoteFrame(this.store.sessionId,tr.FIRST_AUDIO_RECEIVED,ys.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,s,a)=>{this.reportVideoFirstFrameDecoded(t,s,a)},e.onFirstVideoReceived=t=>{var s;let a=Array.from(Cn(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===t);a&&Ze.firstRemoteFrame(this.store.sessionId,tr.FIRST_VIDEO_RECEIVED,ys.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Fr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,s)=>{let a=t.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(nt.ConnectionTypeChange,a),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Yc(s))," -> ").concat(JSON.stringify(Yc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,s)=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Yc(s))," -> ").concat(JSON.stringify(Yc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(nt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===on.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,A.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===on.SEND_ONLY?this.restartICE(e):Rr(this,nt.RequestP2PRestartICE,{direction:on.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let s=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof Ps&&(s==null?void 0:s.track)instanceof Xs)return s.track.isActive||t.push([Ie.LocalAudioTrack,s]),t;let a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a&&(t.push(a),a[0]===Ie.LocalVideoTrack)){let c=this.localTrackMap.get(Ie.LocalVideoLowTrack);c&&t.push([Ie.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){let t=[],s=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof Ps&&(s==null?void 0:s.track)instanceof Xs)return s.track.isActive&&t.push([Ie.LocalAudioTrack,s]),t;let a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a)if(a[0]===Ie.LocalVideoTrack){t.push(a);let c=this.localTrackMap.get(Ie.LocalVideoLowTrack);c&&t.push([Ie.LocalVideoLowTrack,c])}else t.push(a);return t}createMuteMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=ke(s=d._hints).call(s,is.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=ke(s=d._hints).call(s,is.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,t){let s=[],a=this.remoteUserMap.get(e);if(!a)return s;if(t){let c=a.get(t);if(!c)return s;s.push([e,{kind:t,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([e,{kind:d,id:h}])});return s}createUnsubscribeMessage(e){let t=[];return e.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case ze.VIDEO:return void(a._videoSSRC&&t.push({stream_type:ze.VIDEO,ssrcId:a._videoSSRC}));case ze.AUDIO:return void(a._audioSSRC&&t.push({stream_type:ze.AUDIO,ssrcId:a._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[s,{kind:a}]=t,c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Ie.LocalVideoTrack),s=this.localTrackMap.get(Ie.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Be((a,c)=>{this.handleUpdateVideoEncoder(t.track,a,c,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Be((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Ps){let s=this.filterTobeUnmutedTracks(e[t]);if(s.length===0)continue;let a=this.createUnmuteMessage(s);return void await as(this,nt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(nt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(nt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await _r(T0(this.dtlsFailedCount,Ks)),this.emit(nt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ie.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof hs)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof hs).length>1)throw new _e(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ps).length>1&&(e.some(t=>t instanceof Ps&&t._bypassWebAudio)||!Vt().webAudioMediaStreamDest))throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof hs&&this.pendingLocalTracks.some(s=>s instanceof hs))throw new _e(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ps&&this.pendingLocalTracks.some(s=>s instanceof Ps)&&(!Vt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Ps&&s._bypassWebAudio)))throw new _e(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let s=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding,a=XE(XE({},{width:160,height:120,framerate:15,bitrate:50}),t),c;c=s?e._mediaStreamTrack.clone():WC(e,a);let d=os(8,"track-low-"),h=new hs(c,XE(XE({},s&&{scaleResolutionDownBy:bC(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(hd.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,ih.LOW_STREAM)}),h._hints.push(is.LOW_STREAM),e.addListener(Ye.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,s,a){var c;let d=Array.from(Cn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());let h=this.store.keyMetrics,p=h.subscribe.find(f=>f.userId===d.uid&&f.type==="video");Ze.firstRemoteVideoDecode(this.store.sessionId,tr.FIRST_VIDEO_DECODE,ys.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:s,subscribeElapse:Fr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.recvConnection)return!1;let a=this.remoteUserMap.get(e);if(!a)return!1;let c=a.get(t);if(!c)return!1;let d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new _e(q.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new _e(q.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new _e(q.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new _e(q.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new _e(q.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new _e(q.NOT_SUPPORTED)}async preConnect(e){throw new _e(q.NOT_SUPPORTED)}getEstablishParams(){throw new _e(q.NOT_SUPPORTED)}async reSubscribe(e){throw new _e(q.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new _e(q.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===Ie.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ih.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Je(ws.prototype,"p2pConnect",[F4],Object.getOwnPropertyDescriptor(ws.prototype,"p2pConnect"),ws.prototype),Je(ws.prototype,"unpublish",[U4],Object.getOwnPropertyDescriptor(ws.prototype,"unpublish"),ws.prototype),Je(ws.prototype,"unpublishLowStream",[V4],Object.getOwnPropertyDescriptor(ws.prototype,"unpublishLowStream"),ws.prototype),Je(ws.prototype,"subscribe",[B4],Object.getOwnPropertyDescriptor(ws.prototype,"subscribe"),ws.prototype),Je(ws.prototype,"mockSubscribe",[W4],Object.getOwnPropertyDescriptor(ws.prototype,"mockSubscribe"),ws.prototype),Je(ws.prototype,"unsubscribe",[G4],Object.getOwnPropertyDescriptor(ws.prototype,"unsubscribe"),ws.prototype),Je(ws.prototype,"muteRemote",[H4],Object.getOwnPropertyDescriptor(ws.prototype,"muteRemote"),ws.prototype),Je(ws.prototype,"unmuteRemote",[z4],Object.getOwnPropertyDescriptor(ws.prototype,"unmuteRemote"),ws.prototype),Je(ws.prototype,"hasRemoteMediaWithLock",[K4],Object.getOwnPropertyDescriptor(ws.prototype,"hasRemoteMediaWithLock"),ws.prototype),Je(ws.prototype,"disconnectForReconnect",[q4],Object.getOwnPropertyDescriptor(ws.prototype,"disconnectForReconnect"),ws.prototype),Je(ws.prototype,"remoteMediaSsrcChanged",[Y4],Object.getOwnPropertyDescriptor(ws.prototype,"remoteMediaSsrcChanged"),ws.prototype),ws);function $a(e){return function(t,s,a){let c=t[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(e){case Ya.SEND_ONLY:{let f=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{f()}}case Ya.RECEIVE_ONLY:{let f=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{f()}}default:{let f=await this.sendMutex.lock("From P2PChannel2.".concat(s)),_=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{f(),_()}}}},a}}class Id extends Cs{constructor(t,s){super(),W(this,"signal",void 0),W(this,"token",void 0),W(this,"tokenTimeout",void 0),W(this,"tokenInterval",void 0),W(this,"_sequence",0),W(this,"userMap",new Map),W(this,"encoder",new TextEncoder),this.signal=t,this.token=s;let a=()=>{this.signal.connectionState===us.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*$("P2P_TOKEN_INTERVAL"))};a()}async send(t,s,a,c,d){var h;if(this.userMap.size===0)return;let p=Array.from(Vn(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=c??os(6,""),d=d??this._sequence++;let f={_id:c,_type:t,_seq:d,_message:s,token:"".concat(this.token,"_").concat(p)};$("SHOW_P2P_LOG")&&A.debug("send message",f,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(f)).forEach(v=>{this.signal.request(pt.DATA_STREAM,{payload:Wc(this.encoder.encode(v))})});let _=new Be((v,b)=>{let w=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),T),this.off("res-@".concat(c),k),this.off(_h.ABORT,U),A.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?b(new _e(q.INVALID_REMOTE_USER)):b(new _e(q.TIMEOUT))},$("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{w&&window.clearTimeout(w),this.off(_h.ABORT,U),a&&v()},U=()=>{w&&window.clearTimeout(w),this.off("res-@".concat(c,"_ack"),T),this.off("res-@".concat(c),k),b(new _e(q.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(_h.ABORT,U),this.once("res-@".concat(c,"_ack"),T);let k=(K,Y)=>{F=!0,w&&window.clearTimeout(w),this.off("res-@".concat(c,"_ack"),T),this.off(_h.ABORT,U),K==="success"?v(Y):b(new _e(q.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))},F=!1;a||(this.once("res-@".concat(c),k),_r($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{F||A.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(f))}))});try{return await _}catch(v){if(v.code===q.TIMEOUT)return await this.send(t,s,a,c,d);throw v}}onMessage(t){var s;let{_uid:a}=t,c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Ms.CHECK)return;let{token:_}=t;c=new Map,d={uid:a,isStart:!0,token:_,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(It.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in t&&"total"in t){var h;let{id:_,total:v}=t,b=(h=c.get(_))!==null&&h!==void 0?h:[];if(b.push(t),c.has(_)||c.set(_,b),b.length!==v)return;{let w=ed(b).call(b,(T,U)=>T.index-U.index).map(T=>T.payload).join("");c.delete(_),(t=JSON.parse(w))._uid=a}}let{_type:p,token:f}=t;if(ke(s=[Ms.ACK,Ms.CHECK]).call(s,p))return p===Ms.CHECK&&this.handleCheckToken(d,f),void this.receiveMessage(t);f==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(t):A.debug('Receive unexpected message", '.concat(f,", cur_token: ").concat(d.token,"_").concat(this.token),t)}check(){let t={_id:os(6,""),token:this.token,_type:Ms.CHECK};$("SHOW_P2P_LOG")&&A.debug("send message",t),this.signal.request(pt.DATA_STREAM,{payload:Wc(this.encoder.encode(JSON.stringify(t)))})}ack(t){let s={_id:t,_type:Ms.ACK,token:this.token};$("SHOW_P2P_LOG")&&A.debug("send message",s),this.signal.request(pt.DATA_STREAM,{payload:Wc(this.encoder.encode(JSON.stringify(s)))})}response(t,s,a){this.send(Ms.RESPONSE,JSON.stringify({success:!a,message:s}),!0,t)}handleReceivedMessage(t){let s=()=>{this.userMap.forEach(_=>{let{receivedMessagesMap:v,nextExpectedSequenceNumber:b}=_;for(;v.has(b);){let w=v.get(b);v.delete(b),this.receiveMessage(w),_.nextExpectedSequenceNumber++}})};if(!t)return void s();let{_uid:a,_seq:c}=t,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:f}=d;if(c<f)return this.ack(t._id),void A.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));h.set(c,t),p&&c===f&&(this.receiveMessage(t),h.delete(f),d.nextExpectedSequenceNumber++,s())}receiveMessage(t){let{_id:s,_type:a,_message:c,_uid:d}=t;if($("SHOW_P2P_LOG")&&A.debug("receive message",t),s){let h;switch(t._type!==Ms.ACK&&(c&&(h=JSON.parse(c)),this.ack(t._id)),t._type){case Ms.CANDIDATE:case Ms.CONTROL:this.signal.emit(a,h,d);break;case Ms.PUBLISH:case Ms.UNPUBLISH:case Ms.RESTART_ICE:case Ms.CALL:h.uid=d,Rr(this.signal,a,h).then(p=>{this.response(t._id,p)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Ms.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case Ms.RESPONSE:{let{success:p,message:f}=h;this.emit("res-@".concat(s),p?"success":"failed",f);break}}}}splitMessage(t){if(t.length<Id.MAX_MESSAGE_SIZE)return[t];let s=[],{remoteToken:a}=JSON.parse(t),c=os(6,""),d=0,h=800,p=Math.ceil(t.length/h);for(;t.length>0;){d++;let f={id:c,index:d,total:p,payload:t.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(f).length>Id.MAX_MESSAGE_SIZE?h-=50:(s.push(f),t=t.slice(h))}return s.map(f=>JSON.stringify(f))}handleCheckToken(t,s){return t.token!==s?(A.debug("token changed, from ".concat(t.token," to ").concat(s)),this.reset(t.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{A.debug("token timeout, ".concat(s)),this.reset(t.uid)},$("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await Rr(this.signal,Ms.CALL,void 0),s=await this.send(Ms.CALL,t);this.signal.emit(ft.P2P_CONNECTION,s,!0)}async reset(t,s){let a=this.userMap.get(t);a&&(this.emit(_h.ABORT),this.signal.emit(It.ON_USER_OFFLINE,{uid:a.uid,reason:yae.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(A.debug("change local token from ".concat(s," to ").concat(s)),this.token=os(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(_h.ABORT)}}W(Id,"MAX_SIZE",1),W(Id,"MAX_MESSAGE_SIZE",1024);class sle extends Cs{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===us.CONNECTED?this.emit(ft.WS_CONNECTED):t===us.RECONNECTING?this.emit(ft.WS_RECONNECTING,this._websocketReconnectReason):t===us.CLOSED&&this.emit(ft.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,s){super(),W(this,"_disconnectedReason",void 0),W(this,"_websocketReconnectReason",void 0),W(this,"_connectionState",us.CLOSED),W(this,"reconnectToken",void 0),W(this,"p2pToken",void 0),W(this,"websocket",void 0),W(this,"openConnectionTime",void 0),W(this,"clientId",void 0),W(this,"lastMsgTime",Date.now()),W(this,"uploadCache",[]),W(this,"uploadCacheInterval",void 0),W(this,"rttRolling",new CL(5)),W(this,"pingpongTimer",void 0),W(this,"pingpongTimeoutCount",0),W(this,"joinResponse",void 0),W(this,"multiIpOption",void 0),W(this,"initError",void 0),W(this,"spec",void 0),W(this,"store",void 0),W(this,"_external_signal",void 0),W(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(ft.ON_BINARY_DATA,a.data);let c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case It.ON_DATA_STREAM:return void this.handleDataStream(c._message);case It.MUTE_AUDIO:case It.MUTE_VIDEO:case It.ON_P2P_LOST:case It.ON_USER_ONLINE:return;case It.ON_USER_OFFLINE:let{uid:d}=c._message;return A.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===It.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===It.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close($t.UID_BANNED);break;case 15:this.close($t.IP_BANNED);break;case 16:this.close($t.CHANNEL_BANNED)}if(c._type===It.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case lt.ERR_LICENSE_MISSING:this.close($t.LICENSE_MISSING);break;case lt.ERR_LICENSE_EXPIRED:this.close($t.LICENSE_EXPIRED);break;case lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close($t.LICENSE_MINUTES_EXCEEDED);break;case lt.ERR_LICENSE_PERIOD_INVALID:this.close($t.LICENSE_PERIOD_INVALID);break;case lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($t.LICENSE_MULTIPLE_SDK_SERVICE);break;case lt.ERR_LICENSE_ILLEGAL:this.close($t.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new yC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===us.CONNECTED&&this.reconnect("retry",Nr.OFFLINE)}),this.p2pToken=os(6,""),this._external_signal=new Id(this,this.p2pToken)}async request(t,s,a,c){let d=os(6,""),h={_id:d,_type:t,_message:s},p=this.websocket.connectionID,f=()=>new Be((U,k)=>{if(this.connectionState===us.CONNECTED)return U();let F=()=>{this.off(ft.WS_CLOSED,K),U()},K=()=>{this.off(ft.WS_CONNECTED,F),k(new _e(q.WS_ABORT))};this.once(ft.WS_CONNECTED,F),this.once(ft.WS_CLOSED,K)});if(this.connectionState!==us.CONNECTING&&this.connectionState!==us.RECONNECTING||t===pt.JOIN||t===pt.REJOIN||await f(),this.websocket.sendMessage(h,!0),c)return;let _=new Be((U,k)=>{let F=!1,K=(X,re)=>{F=!0,U({isSuccess:X==="success",message:re||{}}),this.off(ft.WS_CLOSED,Y),this.off(ft.WS_RECONNECTING,Y),this.emit(ft.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(d),K);let Y=()=>{k(new _e(q.WS_ABORT,"type: ".concat(t))),this.off(ft.WS_CLOSED,Y),this.off(ft.WS_RECONNECTING,Y),this.off("res-@".concat(d),K)};this.once(ft.WS_CLOSED,Y),this.once(ft.WS_RECONNECTING,Y),_r($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||F||(A.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ft.REQUEST_TIMEOUT,t,s))})}),v=null;try{v=await _}catch(U){if(this.connectionState===us.CLOSED||t===pt.LEAVE)throw new _e(q.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?U.throw():t===pt.JOIN||t===pt.REJOIN?null:(await f(),await this.request(t,s))}if(v.isSuccess)return v.message;let b=Number(v.message.error_code||v.message.code),w=qm(b),T=new _e(q.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(v.message.error_str),{code:b,data:v.message,desc:w.desc});return w.action==="success"?v.message:(A.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(w.desc,", action: ").concat(w.action)),b===lt.ERR_TOO_MANY_BROADCASTERS?((t===pt.JOIN||t===pt.REJOIN)&&(this.initError=T,this.close()),T.throw()):w.action==="failed"?T.throw():w.action==="quit"?(this.initError=T,this.close(),T.throw()):(b===lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Nr.MULTI_IP)):this.reconnect(w.action,Nr.SERVER_ERROR),t===pt.JOIN||t===pt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new Be(a=>{let c=d=>{(!s||s(d))&&(this.off(t,c),a(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(zm.WRTC_STATS,s)}upload(t,s){let a={_type:t,_message:s};try{this.websocket.sendMessage(a)}catch{let c=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==us.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,s){let a={_type:t,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(t,s,a){return await this._external_signal.send(t,s,a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Be((s,a)=>{this.once(ft.WS_CONNECTED,()=>s(this.joinResponse)),this.once(ft.WS_CLOSED,()=>a(this.initError||new _e(q.WS_ABORT))),this.connectionState=us.CONNECTING,this.websocket.init(t).catch(a)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||$t.LEAVE,this.connectionState=us.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=os(6,""),this._external_signal.clear(),this._external_signal=new Id(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ft.ABORT_P2P_EXECUTION);let t=await Rr(this,ft.REQUEST_JOIN_INFO),s=await this.request(pt.JOIN,t);if(!s)return this.emit(ft.REPORT_JOIN_GATEWAY,q.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(ft.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=us.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){return!1}handleDataStream(t){try{var s;let a=ld(t.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||ke(s=Object.values(Ms)).call(s,d._type)?(d._uid=t.uid,this._external_signal.onMessage(d)):this.emit(It.ON_DATA_STREAM,t)}catch{this.emit(It.ON_DATA_STREAM,t)}}handleNotification(t){A.debug("[".concat(this.clientId,"] receive notification: "),t);let s=qm(t.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($t.UID_BANNED),void this.close()):void this.reconnect(s.action,Nr.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=$("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(A.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Nr.TIMEOUT):this.request(pt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let a=Date.now()-s;this.rttRolling.add(a),$("REPORT_STATS")&&this.send(pt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(yt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ft.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(yt.CLOSED,()=>{this.connectionState=us.CLOSED}),this.websocket.on(yt.FAILED,()=>{this._disconnectedReason=$t.NETWORK_ERROR,this.connectionState=us.CLOSED}),this.websocket.on(yt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===us.CONNECTED?this.connectionState=us.RECONNECTING:this.connectionState=us.CONNECTING}),this.websocket.on(yt.WILL_RECONNECT,(t,s,a)=>{t!=="retry"?(A.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):A.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(t)}),this.websocket.on(yt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ft.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof _e&&t.code===q.UNEXPECTED_RESPONSE&&t.data.code===lt.ERR_NO_AUTHORIZED)return A.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Nr.SERVER_ERROR);A.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Nr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(yt.REQUEST_NEW_URLS,(t,s)=>{Rr(this,ft.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(It.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let rle={name:"P2PChannel",create:function(e){let{store:t,statsCollector:s}=e;return new tle(t,s)},createSubmodule:function(e){let{store:t,spec:s}=e;return new sle(s,t)}};function X4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function J4(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?X4(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):X4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class nle{constructor(t){W(this,"sessionDesc",void 0),W(this,"localCapabilities",void 0),W(this,"rtpCapabilities",void 0),W(this,"candidates",void 0),W(this,"_originCandidates",void 0),W(this,"iceParameters",void 0),W(this,"dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname",void 0),t=bs(t);let{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:p,sdkCodec:f,cname:_}=t,v=Sn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=bs(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=p,this.cname=_;for(let b=0;b<v.mediaDescriptions.length;b++){let w=v.mediaDescriptions[b];if(w.attributes.iceUfrag=s.iceUfrag,w.attributes.icePwd=s.icePwd,w.attributes.fingerprints=a.fingerprints,w.attributes.candidates=c,w.attributes.setup=h,w.media.mediaType==="video"){w.media.fmts=d.videoCodecs.map(k=>k.payloadType.toString(10));let T=d.videoCodecs.filter(k=>{var F,K;return(F=k.rtpMap)===null||F===void 0?void 0:ke(K=F.encodingName.toLowerCase()).call(K,f)}),U=d.videoCodecs.filter(k=>!ke(T).call(T,k));w.attributes.payloads=[...T,...U],w.attributes.extmaps=d.videoExtensions}w.media.mediaType==="audio"&&(w.media.fmts=d.audioCodecs.map(T=>T.payloadType.toString(10)),w.attributes.payloads=d.audioCodecs,w.attributes.extmaps=d.audioExtensions),v.mediaDescriptions[b]=this.mungMediaDesc(w)}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return Gc(this.sessionDesc)}send(t,s,a){let{ssrcs:c,ssrcGroups:d}=Jm(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(_=>t===ze.VIDEO?_.media.mediaType==="video":_.media.mediaType==="audio"),p=c[0].attributes.label,f=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:p,mslabel:f}}batchSend(t){return t.map(s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(s=>{let a=[],c=[],d=[];s.attributes.ssrcs.forEach(h=>{ke(t).call(t,h.attributes.label||"")?d.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var p;ke(p=d.map(f=>f.ssrcId)).call(p,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c})}mute(t){let s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(t){let s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(t,s,a){t.forEach((c,d)=>{let h=c._mediaStreamTrack,p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===h.kind),f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],c);this.sessionDesc.mediaDescriptions[p]=f})}stopReceiving(t){}updateCandidates(t){let s=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(s.forEach(c=>{a.push(J4(J4({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(t){case Mr.TCP_RELAY:this.candidates=a;break;case Mr.UDP_TCP_RELAY:case Mr.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(let c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=bs(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=t.iceUfrag,s.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let s=[];for(let a=0;a<t;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(t,s){let a=bs(t);return yh(a,s),SC(a,s),a}updateRecvMedia(t,s){let a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===t);if(a!==-1){let c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,s,a){let c=this.sessionDesc.mediaDescriptions.find(h=>t===ze.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){let h=c.attributes.ssrcs.find(p=>p.attributes.label===s);var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(t){let s=bs(t);return wC(s),function(a){let c=a.attributes.extmaps.find(d=>uE(d.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(d=>{let h=d.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(t){for(let s of this.sessionDesc.mediaDescriptions)for(let a of s.attributes.ssrcs)if(a.attributes.label===t)return[a]}}var cs;function Q4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function JE(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Q4(Object(s),!0).forEach(function(a){W(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Q4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let ile=(cs=class Yf extends hU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return ke(s=Object.keys(Vm)).call(s,t)}))]}constructor(t,s){super(t,s),W(this,"store",void 0),W(this,"peerConnection",void 0),W(this,"remoteSDP",void 0),W(this,"initialOffer",void 0),W(this,"statsFilter",void 0),W(this,"useRTX",!1),W(this,"localCapabilities",void 0),W(this,"localCandidateCount",0),W(this,"allCandidatesReceived",!1),W(this,"establishPromise",void 0),W(this,"mutex",void 0),this.store=s,this.mutex=new Pr("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Yf.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=O0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Rs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let s=$c(t.sdp),a=Xm(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=t,JE(JE({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:t.sdp})}catch(t){throw new _e(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new nle(JE(JE({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(t,s){throw new _e(q.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,s){var a=this;return Ai(function*(){let c=yield Ut(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=t.map(w=>a.peerConnection.addTrack(w._mediaStreamTrack)),h=yield Ut(a.peerConnection.createOffer()),p=Sn(h.sdp),f=t.map(w=>{let T=w._mediaStreamTrack,U=p.mediaDescriptions.find(k=>k.attributes.mid===T.kind);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return function(k,F,K){let Y=k.attributes.ssrcs.filter(re=>re.attributes.label===F),X=k.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(X&&Y.length>1){let re=X.find(te=>te.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return re?[{ssrcId:re.ssrcIds[0],rtx:K?re.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(U,T.id,a.useRTX)}),_;try{_=yield f}catch(w){throw d.forEach(T=>{Tr()&&T.replaceTrack(null),a.peerConnection.removeTrack(T)}),w}let v=a.mungSendOfferSDP(h.sdp,t);a.remoteSDP.receive(t,s,_);let b=a.remoteSDP.toString();return yield Ut(a.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ut(a.applySendEncodings(d,t)),yield Ut(a.peerConnection.setRemoteDescription({type:"answer",sdp:b})),t.map((w,T)=>{let U=w._mediaStreamTrack.id;return{localSSRC:f[T],id:U}})}catch(d){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let s=this.peerConnection.getSenders().filter(d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{Tr()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});let a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(t,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:d,mslabel:h}=this.remoteSDP.send(t,s,c),p=new Be((v,b)=>{let w=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(d)))},1e4),T=U=>{let k=Lt();if((k.name==="Safari"&&Number(k.version)===11||zr())&&U.track.id!==d&&U.streams[0].id===h){var F;let K=U.streams[0].getTracks()[0];return(F=this.remoteSDP)===null||F===void 0||F.updateTrackLabel(t,d,U.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(w),void v(K)}if(U.track.id===d)return this.peerConnection.removeEventListener("track",T),clearTimeout(w),void v(U.track)};this.peerConnection.addEventListener("track",T)}),f=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:f});let _=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(_),{track:await p,id:d}}catch(d){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let s=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==t.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(Tr()&&a.track)a.track.enabled=!1;else{let c=a.getParameters();c.encodings.forEach(d=>d.active=!1),a.setParameters(c)}})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let s=this.peerConnection.getSenders().filter(d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(Tr()&&d.track)d.track.enabled=!0;else{let h=d.getParameters();h.encodings.forEach(p=>p.active=!0),await d.setParameters(h)}});let a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return Ai(function*(){let a=yield Ut(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=Vt().supportPCSetConfiguration;if(t===Mr.RELAY&&!c)return;if(c){let _=s.peerConnection.getConfiguration(),v=t===Mr.RELAY?"relay":"all";_.iceTransportPolicy!==v&&(A.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(v,"]")),_.iceTransportPolicy=v,s.peerConnection.setConfiguration(_))}t!==Mr.RELAY&&s.remoteSDP.updateCandidates(t);let d=yield Ut(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let h=$c(d.sdp),{remoteIceParameters:p}=yield h.iceParameters;s.remoteSDP.restartICE(p);let f=s.remoteSDP.toString();yield Ut(s.peerConnection.setLocalDescription(d)),yield Ut(s.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(c){A.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);let d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new _e(q.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,s){let a=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===t});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){let a=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s});a&&await a.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,s){throw new _e(q.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new _e(q.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let s={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(km(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...Yf.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Yf.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(t){let s=[];return t.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(t,s){var a;if(s||(s=this.peerConnection.getSenders().find(_=>{var v;return((v=_.track)===null||v===void 0?void 0:v.id)===t._mediaStreamTrack.id})),!s)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Vt().supportSetRtpSenderParameters)return A.warn("Browser not support set rtp-sender parameters");let c={},d={};if(t instanceof hs)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if($("DSCP_TYPE")&&rc()){var h;let _=$("DSCP_TYPE");ke(h=["very-low","low","medium","high"]).call(h,_)&&(d.networkPriority=_)}let p=s.getParameters(),f=(a=p.encodings)===null||a===void 0?void 0:a[0];f&&Object.assign(f,d),Object.assign(p,c),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await s.setParameters(p)}async applySendEncodings(t,s){try{if(!Vt().supportSetRtpSenderParameters||t.length!==s.length)return;for(let a=0;a<t.length;a++){let c=t[a],d=s[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s){let a=Sn(t);return s.forEach((c,d)=>{let h=c._mediaStreamTrack,p=a.mediaDescriptions.find(f=>f.attributes.mid===h.kind);p&&yh(p,c)}),Gc(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let s=this.remoteSDP.batchSend(t).map((d,h)=>{let{id:p,mslabel:f}=d,{kind:_}=t[h];return new Be((v,b)=>{let w=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(p)))},1e4),T=U=>{let k=Lt();if(k.name==="Safari"&&Number(k.version)===11&&U.track.id!==p&&U.streams[0].id===f){var F;let K=U.streams[0].getTracks()[0];return(F=this.remoteSDP)===null||F===void 0||F.updateTrackLabel(_,p,U.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(w),void v({track:K,id:p})}if(U.track.id===p)return this.peerConnection.removeEventListener("track",T),clearTimeout(w),void v({track:U.track,id:p})};this.peerConnection.addEventListener("track",T)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});let c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await Be.all(s)}catch(s){throw new _e(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let s=this.remoteSDP.getSSRC(t);return s==null?void 0:s[0].ssrcId}setConfiguration(t){if(Vt().supportPCSetConfiguration){let s=Yf.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}}},Je(cs.prototype,"connect",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"connect"),cs.prototype),Je(cs.prototype,"stopSending",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"stopSending"),cs.prototype),Je(cs.prototype,"receive",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"receive"),cs.prototype),Je(cs.prototype,"stopReceiving",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"stopReceiving"),cs.prototype),Je(cs.prototype,"muteRemote",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"muteRemote"),cs.prototype),Je(cs.prototype,"unmuteRemote",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"unmuteRemote"),cs.prototype),Je(cs.prototype,"muteLocal",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"muteLocal"),cs.prototype),Je(cs.prototype,"unmuteLocal",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"unmuteLocal"),cs.prototype),Je(cs.prototype,"close",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"close"),cs.prototype),Je(cs.prototype,"updateEncoderConfig",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"updateEncoderConfig"),cs.prototype),Je(cs.prototype,"updateSendParameters",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"updateSendParameters"),cs.prototype),Je(cs.prototype,"replaceTrack",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"replaceTrack"),cs.prototype),Je(cs.prototype,"getRemoteSSRC",[Fi],Object.getOwnPropertyDescriptor(cs.prototype,"getRemoteSSRC"),cs.prototype),cs);function Fi(e,t,s){let a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},s}let ale={name:"PlanBConnection",create:function(e){let{store:t,spec:s}=e;return new ile(s,t)}},ole={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vt().supportWebRTCEncodedTransform)return void A.warning("browser not support audio encoded transform");if(Yv.has(e)||!e.track)return;let s={track:e.track};if(sc()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void A.error("create audio-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){s.controller||(s.controller=p),e.track&&e.track.id!==s.track.id&&(A.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a));let f=t.metadata&&t.metadata();f?function(_,v){let{chunk:b,controller:w}=v,T=Hc.METADATA;b.data=function(U,k,F){let K=F.byteLength,Y=K+rC+$F,X=tC+sC+Y,re=new ArrayBuffer(U.byteLength+X),te=new DataView(re);te.setUint8(0,YF),te.setUint16(1,Y),te.setUint8(3,k),te.setUint16(4,K);for(let le=0;le<K;le++)te.setUint8(6+le,F[le]);let Z=new Uint8Array(te.buffer);return Z.set(new Uint8Array(U),X),Z.buffer}(b.data,T,_),w.enqueue(b)}(f,{chunk:h,controller:p}):p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Tr()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");let c=qv(),d=new MessageChannel;await new Be(p=>c.onmessage=f=>{f.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);e.transform=h,await new Be(p=>c.onmessage=f=>{f.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var f;if(p.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==s.track.id)A.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a);else if(p.data.getMetadata){let _=t.metadata&&t.metadata();_&&d.port1.postMessage({metadata:_})}},s.worker=c}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}let c=Yv.get(e);if(c){Yv.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){A.warning(p&&p.message)}}}Yv.set(e,s),e.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vt().supportWebRTCEncodedTransform)return void A.warning("browser not support audio encoded transform");if(eE.has(e))return;let s={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(sc()&&!zr()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");h0(Wt.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void A.error("create audio-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){s.controller||(s.controller=p),e.track&&e.track.id!==s.track.id&&(A.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a)),t.enableTopn?function(f,_,v){var b;let w=nC(new DataView(_.data));if(!w)return v.enqueue(_);let T=f.track.id;Bie.set(T,f.track);let U=(b=w.tlv.find(re=>re.tag===Hc.AUDIO_LEVEL))===null||b===void 0?void 0:b.value,k=0;typeof U=="number"&&(k=127-U);let F=Math.round(Math.pow(10,k/60)-1),{selected:K,speaker:Y}=function(re,te){let Z=ph.get(re);if(Z||(Z=function(le){let xe=new JF;return ph.set(le,xe),Wa||(Wa=new Uie($("TOPN_SILENCE_THRESHOLD")||500),Wa.on("ActiveSpeakerChanged",Ce=>{Ce!=null&&(Jv=Ce)})),Wa.addSpeakers([xe]),xe}(re)),ph.size<=QF)return{selected:!0,speaker:Z};if(!Wa)throw new Error("no active speaker detector");return Wa.levelChanged(Z.id,te),gd=Wa.loudest.map(le=>le.id),Jv&&!ke(gd).call(gd,Jv)&&gd.length>=QF&&gd.pop(),{selected:ke(gd).call(gd,Z.id)||Z.id===Jv,speaker:Z}}(f,F),X=function(re,te,Z){let le=Ga.get(re)||new Vie(re,te);return le.score=Z,Ga.set(re,le),function(xe){if(Qv.set(xe,!0),!Zv)return void(Zv=Date.now());let Ce=Date.now();Ce-Zv>1e3&&(Qv.get(xe)?Qv.set(xe,!1):(ZF(xe),Qv.delete(xe)),Zv=Ce)}(re),le}(T,f.track,Y.energyScore);X.addSample(K),X.active&&(_.data=w.frame.buffer,v.enqueue(_))}(e,h,p):t.enableMetadata||t.enablePts?function(f,_,v,b){let w=new DataView(f.data),T=w.getUint8(0),U;if(128&T&&T!==71){let K=function(Y){if(Y.byteLength<=0)return[];let X=[],re=0;for(;re<Y.byteLength;){let Z=(128&Y.getUint8(re))>>7,le=127&Y.getUint8(re);if(!(Z&&re+4<=Y.byteLength)){re++;break}{let xe=Y.getUint32(re,!1),Ce=(16776192&xe)>>10,je=1023&xe;X.push({pt:le,ts_offset:Ce,length:je,data:new Uint8Array}),re+=4}}let te=Y.byteLength-re;for(let Z of X){if(Z.length>te)return console.warn("Broken red payload"),[];Z.length>0&&(Z.data=new Uint8Array(Y.buffer,Y.byteOffset+re,Z.length),re+=Z.length,te-=Z.length)}if(te>0){let Z={pt:X.length>0?X[X.length-1].pt:0,ts_offset:0,length:te,data:new Uint8Array(Y.buffer,Y.byteOffset+re,te)};X.push(Z)}return X}(w);if(K.length>0){let Y=function(X){let re=0;for(let le=0;le<X.length;le++)re+=le<X.length-1?4:1,re+=X[le].length;let te=new Uint8Array(re),Z=0;for(let le=0;le<X.length;le++)if(le<X.length-1){let xe=(2147483648|(127&X[le].pt)<<24|(262143&X[le].ts_offset)<<10|1023&X[le].length)>>>0;te[Z++]=xe>>24&255,te[Z++]=xe>>16&255,te[Z++]=xe>>8&255,te[Z++]=255&xe}else te[Z++]=127&X[le].pt;for(let le of X)te.set(le.data,Z),Z+=le.length;return te}(K.map(X=>{let re=new Uint8Array(X.length);re.set(X.data);let te=nC(new DataView(re.buffer));return te!=null&&te.frame&&(X.data=te==null?void 0:te.frame),U=te,X}));f.data=Y.buffer}}else U=nC(w),U&&(f.data=U.frame.buffer);if(_.enqueue(f),!U)return;let k=U.tlv.find(K=>K.tag===Hc.METADATA);k&&v&&k.value instanceof Uint8Array&&v(k.value);let F=U.tlv.find(K=>K.tag===Hc.AUDIO_64_BIT_PTS);F&&b&&F.value instanceof Uint8Array&&F.value.length==8&&b(new DataView(F.value.buffer).getBigUint64(0,!0))}(h,p,t.onMetadata,t.onPts):p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");let c=qv(),d=new MessageChannel;await new Be(p=>c.onmessage=f=>{f.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);e.transform=h,await new Be(p=>c.onmessage=f=>{f.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var f;p.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==s.track.id?(A.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a)):p.data.metadata&&s.onMetadata?s.onMetadata(p.data.metadata):p.data.pts&&s.onPts&&s.onPts(p.data.pts)},s.worker=c}function a(){e.track.removeEventListener("ended",a),function(c){let d=eE.get(c);if(d){(function(f){let _=ph.get(f);_&&(ph.delete(f),Wa&&(Wa.removeSpeakers([_]),ph.size===0&&(Wa.destroy(),Wa=null)))})(c),ZF(c.track.id),eE.delete(c);try{var h,p;(h=d.controller)===null||h===void 0||h.terminate(),(p=d.worker)===null||p===void 0||p.terminate()}catch(f){A.warning(f&&f.message)}}}(e)}eE.set(e,s),e.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(e,t){if(!Vt().supportWebRTCEncodedTransform)return void A.warning("browser not support video encoded transform");if(tE.has(e)||!e.track)return;let s={track:e.track};if(sc()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(p){return void A.error("create video-encoded-streams error",p&&p.message)}let d=[];t.on("sei-to-send",p=>{d.push(p)});let h=new TransformStream({transform(p,f){s.controller||(s.controller=f),e.track&&e.track.id!==s.track.id&&(A.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a));let _=sU(new Uint8Array(p.data)),v=d.shift();if(v){let b=function(w,T,U){switch(U){case cC:return function(k,F){let K=tU(F),Y=K.length,X=Math.floor(Y/255),re=Y%255,te=new Uint8Array(6+X+1+Y+k.byteLength);te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=6,te[5]=101;let Z=0;for(;Z<X;)te[6+Z]=255,Z++;return te[6+Z]=re,Z++,te.set(K,6+Z),te.set(new Uint8Array(k),6+Z+Y),te.buffer}(w,T);case lC:return function(k,F){let K=tU(F),Y=K.length,X=Math.floor(Y/255),re=Y%255,te=new Uint8Array(7+X+1+Y+1+k.byteLength);te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=78,te[5]=1,te[6]=101;let Z=0;for(;Z<X;)te[7+Z]=255,Z++;return te[7+Z]=re,Z++,te.set(K,7+Z),Z+=Y,te[7+Z]=128,Z++,te.set(new Uint8Array(k),7+Z),te.buffer}(w,T);default:return null}}(p.data,v,_);b&&(p.data=b)}f.enqueue(p)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Tr())return;{if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");let c=qv(),d=new MessageChannel;await new Be(p=>c.onmessage=f=>{f.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);e.transform=h,await new Be(p=>c.onmessage=f=>{f.data==="started"&&p(void 0)}),t.on("sei-to-send",p=>{d.port1.postMessage({sei:p})}),d.port1.onmessage=p=>{var f;p.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==s.track.id&&(A.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}let c=tE.get(e);if(c){tE.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){A.warning(p&&p.message)}}}tE.set(e,s),e.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vt().supportWebRTCEncodedTransform)return void A.warning("browser not support video encoded transform");if(!e.track)return;if(Hm.has(e)){let c=Hm.get(e);return void(c&&(c.onSei=t.onSei))}let s={track:e.track,onSei:t.onSei};if(sc()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void A.error("create video-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){s.controller||(s.controller=p),e.track&&e.track.id!==s.track.id&&(A.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a));let f=function(_,v){switch(v){case cC:return function(b){let w=new DataView(b.data),T=0;for(;T+4<b.data.byteLength;){if(w.getUint8(T+0)===0&&w.getUint8(T+1)===0&&w.getUint8(T+2)===0&&w.getUint8(T+3)===1&&w.getUint8(T+4)===6){let U=T+6,k=0,F=0;for(;(F=w.getUint8(U++))===255;)k+=255;k+=F;let K=eU(b.data,U,k);return new Uint8Array(K)}T++}return null}(_);case lC:return function(b){let w=new DataView(b.data),T=0;for(;T+5<b.data.byteLength;){if(w.getUint8(T+0)===0&&w.getUint8(T+1)===0&&w.getUint8(T+2)===0&&w.getUint8(T+3)===1&&w.getUint8(T+4)===78&&w.getUint8(T+5)===1&&w.getUint8(T+6)===101){let U=T+7,k=0,F=0;for(;(F=w.getUint8(U++))===255;)k+=255;k+=F;let K=eU(b.data,U,k);return new Uint8Array(K)}T++}return null}(_);default:return null}}(h,sU(new Uint8Array(h.data)));f&&s.onSei&&s.onSei(f),p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Tr()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");let c=qv(),d=new MessageChannel;await new Be(p=>c.onmessage=f=>{f.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);e.transform=h,await new Be(p=>c.onmessage=f=>{f.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var f;p.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==s.track.id?(A.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a)):p.data.sei&&s.onSei&&s.onSei(p.data.sei)},s.worker=c}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}(function(c){let d=Hm.get(c);if(d){Hm.delete(c);try{var h,p;(h=d.controller)===null||h===void 0||h.terminate(),(p=d.worker)===null||p===void 0||p.terminate()}catch(f){A.warning(f&&f.message)}}})(e)}Hm.set(e,s),e.track.addEventListener("ended",a)}},cle={name:"InterceptFrame",create:()=>ole};j0(),ts("PROCESS_ID","process-".concat(os(8,""),"-").concat(os(4,""),"-").concat(os(4,""),"-").concat(os(4,""),"-").concat(os(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void A.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),s=Date.now();A.debug("Loading global parameters from cache",t),Object.keys(t).forEach(a=>{if(Object.prototype.hasOwnProperty.call(Es,a)){let{value:c,expires:d}=t[a];if(d&&d<=s)return;Ba[a]=c,Es[a]=c}})}catch(t){A.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Ba.AREAS)&&Ba.AREAS.length>0&&RC(Ba.AREAS,!0);let Z4=(e,t,s)=>{A.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),ts(e,t,s)};Qc(Dce,!1),Qc(Pce,!1),Qc(poe,!1),Qc(zce,!1),Qc(Rce,!1),Qc(rle,!1),Qc(ale,!1),Qc(cle,!1);let qs=function(e){let t=new Cs,s=e,a={getListeners:t.getListeners.bind(t),on:(c,d)=>(function(h,p){h===To.SECURITY_POLICY_VIOLATION&&jV(p,!0)}(c,d),t.on.bind(t)(c,d)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return OV(OV({},s),a)}({__TRACK_LIST__:nh,VERSION:Ii,BUILD:L0,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Z4,getParameter:$,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,s=await async function(a){let c;return Vt().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(t);if(!s)return e;t.close(),t=null,e=function(a){let c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(t){throw new de(q.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=Ze.reportApiInvoke(null,{name:ks.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:xs.TRACER}),t=!1;try{let d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;t=!!(d&&h&&p),t&&v0()&&eL(75)&&new d().close()}catch(d){return A.error("check system requirement failed: ",d),!1}let s=!1,a=Lt();a.name===Wt.CHROME&&Number(a.version)>=58&&(Fa.engine.name!=="WebKit"||function(){let d=Lt();if(Iv()){if(d.os===ar.MAC_OS)return!0;if(d.os===ar.IOS){let h=Fa.os.version&&Fa.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(a.name===Wt.FIREFOX&&Number(a.version)>=56||a.name===Wt.OPERA&&Number(a.version)>=45||a.name===Wt.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(zr()||na())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||aL()||Lt().name===Wt.QQ)&&(s=!0),A.debug("checkSystemRequirements, api:",t,"browser",s);let c=t&&s;return e.onSuccess(c),c},getDevices:function(e){return pi.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return pi.getRecordingDevices(e)},getCameras:function(e){return pi.getCamerasDevices(e)},getElectronScreenSources:eM,getPlaybackDevices:function(e){return pi.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},s=os(5,"client-"),a=Ze.reportApiInvoke(null,{id:s,name:ks.CREATE_CLIENT,options:[t],tag:xs.TRACER});try{(function(c){er(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),er(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&er(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&gr(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&mL(c.turnServer),c.httpRetryConfig!==void 0&&pL(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&pL(c.websocketRetryConfig)})(t)}catch(c){throw a.onError(c),c}return(rL(16,0)||f0(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",A.debug("browser not support vp9, force use vp8")),ts("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),a.onSuccess(),new moe(pa(pa({forceWaitGatewayResponse:!0},t),{},{role:ke(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),s)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=$("CAMERA_CAPTURE_CONFIG"),s=os(8,"track-cam-"),a=Ze.reportApiInvoke(null,{id:s,tag:xs.TRACER,name:ks.CREATE_CAM_VIDEO_TRACK,options:[ds({},e),t]});t&&(e.encoderConfig=t);let c=zv(e),d=null;A.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{d=(await hi({video:c},s)).getVideoTracks()[0]||null}catch(p){throw a.onError(p),p}if(!d){let p=new _e(q.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(p),p.throw(A)}if(e.optimizationMode&&eC(s,d,e,oa(e.encoderConfig)),$("USE_STANDARD_BITRATE_DEFAULT")){let p=oa(e.encoderConfig);e.encoderConfig=p,delete p.bitrateMax,delete p.bitrateMin}let h=new Kv(d,e,c,e.scalabiltyMode?Bv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return a.onSuccess(h.getTrackId()),A.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(e){let t=os(8,"track-cus-"),s=Ze.reportApiInvoke(null,{id:t,tag:xs.TRACER,name:ks.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});$("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);let a=new hs(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Bv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[is.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),A.info("create custom video track success with config",e,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",s=typeof t=="object"?function(w){return dM(w)}(t):void 0;s&&(t="auto");let a=os(8,"track-scr-v-"),c=Ze.reportApiInvoke(null,{id:a,tag:xs.TRACER,name:ks.CREATE_SCREEN_VIDEO_TRACK,options:[ds({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let d=function(w){let T={};w.screenSourceType&&(T.mediaSource=w.screenSourceType),w.extensionId&&sc()&&(T.extensionId=w.extensionId);let{displaySurface:U,selfBrowserSurface:k,surfaceSwitching:F,systemAudio:K,preferCurrentTab:Y}=w;($u(107)||p0(107)||g0(93))&&(U&&(er(U,"displaySurface",["browser","window","monitor"]),T.displaySurface=U),k?(er(k,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=k):T.selfBrowserSurface="include",F&&(er(F,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=F)),($u(105)||p0(105)||g0(91))&&K&&(er(K,"systemAudio",["exclude","include"]),T.systemAudio=K),($u(94)||p0(94)||g0(80))&&Y&&(T.preferCurrentTab=!0),w.electronScreenSourceId&&(T.sourceId=w.electronScreenSourceId);let X=w.encoderConfig?W0(w.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:X?X.width:void 0,maxHeight:X?X.height:void 0},X&&(X.frameRate&&(typeof X.frameRate=="number"?(T.mandatory.maxFrameRate=X.frameRate,T.mandatory.minFrameRate=X.frameRate):(T.mandatory.maxFrameRate=X.frameRate.max||X.frameRate.ideal||X.frameRate.exact||void 0,T.mandatory.minFrameRate=X.frameRate.min||X.frameRate.ideal||X.frameRate.exact||void 0),T.frameRate=X.frameRate),X.width&&(T.width=X.width),X.height&&(T.height=X.height)),T}(e),h=null,p=null,f=Vt();if(!f.supportShareAudio&&t==="enable"){let w=new _e(q.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(w),w.throw(A)}A.info("start create screen video track with config",e,"withAudio",t,"trackId",a);let _=f.supportShareAudio&&t!=="disable";try{let w=await hi({screen:d,screenAudio:_?s||!0:void 0},a);h=w.getVideoTracks()[0]||null,p=w.getAudioTracks()[0]||null}catch(w){throw c.onError(w),w}if(!h){let w=new _e(q.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(w),w.throw(A)}if(!p&&t==="enable"){h&&h.stop();let w=new _e(q.SHARE_AUDIO_NOT_ALLOWED);return c.onError(w),w.throw(A)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(eC(a,h,e,e.encoderConfig&&W0(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let v=new hs(h,e.encoderConfig?W0(e.encoderConfig):{},e.scalabiltyMode?Bv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a,[is.SCREEN_TRACK]);if(!p)return c.onSuccess(v.getTrackId()),A.info("create screen video track success","video:",v.getTrackId()),v;let b=new Ps(p,void 0,os(8,"track-scr-a-"),!1);return c.onSuccess([v.getTrackId(),b.getTrackId()]),A.info("create screen video track success","video:",v.getTrackId(),"audio:",b.getTrackId()),[v,b]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=$("CAMERA_CAPTURE_CONFIG"),a=os(8,"track-mic-"),c=os(8,"track-cam-"),d=Ze.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:xs.TRACER,name:ks.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,s]});s&&(t.encoderConfig=s);let h=zv(t),p=uM(e),f=null,_=null;A.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let w=await hi({audio:p,video:h},"".concat(a,"-").concat(c));f=w.getAudioTracks()[0],_=w.getVideoTracks()[0]}catch(w){throw d.onError(w),w}if(!f||!_){let w=new _e(q.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(w),w.throw(A)}if(t.optimizationMode&&eC(c,_,t,oa(t.encoderConfig)),$("USE_STANDARD_BITRATE_DEFAULT")){let w=oa(t.encoderConfig);t.encoderConfig=w,delete w.bitrateMax,delete w.bitrateMin}let v=new Gm(f,e,p,a),b=new Kv(_,t,h,t.scalabiltyMode?Bv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return d.onSuccess([v.getTrackId(),b.getTrackId()]),A.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[v,b]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=os(8,"track-mic-"),s=Ze.reportApiInvoke(null,{id:t,tag:xs.TRACER,name:ks.CREATE_MIC_AUDIO_TRACK,options:[e]}),a=uM(e),c=null;A.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await hi({audio:a},t)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){let h=new _e(q.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(A)}let d=new Gm(c,e,a,t);return s.onSuccess(d.getTrackId()),A.info("create microphone audio track success, trackId:",t),d},createCustomAudioTrack:function(e){let t=os(8,"track-cus-"),s=Ze.reportApiInvoke(null,{id:t,tag:xs.TRACER,name:ks.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),a=new Ps(e.mediaStreamTrack,e.encoderConfig?Wv(e.encoderConfig):{},t,!1);return A.info("create custom audio track success with config",e,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:s,encoderConfig:a}=e,{source:c}=e,d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:s,encoderConfig:a},h=os(8,"track-buf-"),p=Ze.reportApiInvoke(null,{id:h,tag:xs.TRACER,name:ks.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if($("DISABLE_WEBAUDIO"))throw new _e(q.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");A.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);let f=c;if(!(c instanceof AudioBuffer))try{c=await async function(b,w){let T=null;if(typeof b=="string"){let k=JM.get(b);if(k)return A.debug("use cached audio resource: ",b),k;try{T=(await Va(()=>pn.get(b,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(F){throw new _e(q.FETCH_AUDIO_FILE_FAILED,F.toString())}}else T=await new Be((k,F)=>{let K=new FileReader;K.onload=Y=>{Y.target?k(Y.target.result):F(new _e(q.READ_LOCAL_AUDIO_FILE_ERROR))},K.onerror=()=>{F(new _e(q.READ_LOCAL_AUDIO_FILE_ERROR))},K.readAsArrayBuffer(b)});let U=await function(k){let F=lh();return new Be((K,Y)=>{F.decodeAudioData(k,X=>{K(X)},X=>{Y(new _e(q.DECODE_AUDIO_FILE_FAILED,X.toString()))})})}(T);return typeof b=="string"&&w&&JM.set(b,U),U}(c,s)}catch(b){return p.onError(b),b.throw(A)}let _=new Pie(c),v=new jie(f,_,a?Wv(a):{},h);return A.info("create buffer source audio track success, trackId:",h),p.onSuccess(v.getTrackId()),v},setAppType:function(e){if(A.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw A.debug("Invalid appType"),new de(q.INVALID_PARAMS,"invalid app type",e);ts("APP_TYPE",Math.floor(e))},setLogLevel:function(e){A.setLogLevel(e)},enableLogUpload:function(){$("USE_NEW_LOG")?ts("UPLOAD_LOG",!0):A.enableLogUpload()},disableLogUpload:function(){$("USE_NEW_LOG")?ts("UPLOAD_LOG",!1):A.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new e5},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,s=Ze.reportApiInvoke(null,{tag:xs.TRACER,name:ks.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ps||e instanceof hh)){let f=new de(q.INVALID_TRACK,"the parameter is not a audio track");return s.onError(f),f.throw()}t&&t<1e3&&(t=1e3);let a=e instanceof Ps?e.getTrackLabel():"remote_track",c=e.getVolumeLevel(),d=c,h=c,p=Date.now();return new Be(f=>{let _=setInterval(()=>{let v=e.getVolumeLevel();d=v>d?v:d,h=v<h?v:h;let b=d-h>1e-4,w=Date.now()-p;if(b||w>t){clearInterval(_);let T=b,U={duration:w,deviceLabel:a,maxVolumeLevel:d,result:T};A.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(U))),s.onSuccess(U),f(T)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,s=Ze.reportApiInvoke(null,{tag:xs.TRACER,name:ks.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof hs||e instanceof uh)){let b=new de(q.INVALID_TRACK,"the parameter is not a video track");return s.onError(b),b.throw()}t&&t<1e3&&(t=1e3);let a=e instanceof hs?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Tr()||Iv())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();let h=document.createElement("canvas");h.width=160,h.height=120;let p=0,f=0;try{let b=Date.now();p=await function(w,T,U,k){let F,K=0,Y=null;return new Be((X,re)=>{function te(){K>k&&F&&(F(),X(K));let Z=U.getContext("2d");if(!Z){let Ce=new de(q.UNEXPECTED_ERROR,"can not get canvas 2d context.");return A.error(Ce.toString()),void re(Ce)}Z.drawImage(w,0,0,160,120);let le=Z.getImageData(0,0,U.width,U.height),xe=Math.floor(le.data.length/3);if(Y){for(let Ce=0;Ce<xe;Ce+=3)if(le.data[Ce]!==Y[Ce])return K+=1,void(Y=le.data);Y=le.data}else Y=le.data}setTimeout(()=>{F&&(F(),X(K))},T),F=q0(()=>{te()},30)})}(d,t,h,4),f=Date.now()-b}catch(b){throw s.onError(b),b}Zae===Wt.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;let _=p>4,v={duration:f,changedPicNum:p,deviceLabel:a,result:_};return A.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),s.onSuccess(v),_},setArea:RC,audioElementPlayCenter:mn,resumeAudioContext:function(){mn.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){goe.processExternalMediaAEC(e)},registerExtensions:function(e){let t=$("PLUGIN_INFO")||[];e.forEach(s=>{"name"in s&&!ke(t).call(t,s.name)&&t.push(s.name);let a=s;a.__registered__=!0,a.logger.hookLog=A.extLog,a.reporter.hookApiInvoke=Ze.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=$(c)})}),Z4("PLUGIN_INFO",t)},ChannelMediaRelayError:fh,ChannelMediaRelayEvent:ac,ChannelMediaRelayState:Tn,RemoteStreamFallbackType:Tie,RemoteStreamType:Cie,ConnectionDisconnectedReason:$t,AudienceLatencyLevelType:sie,AREAS:Kt,preload:async function(e,t,s,a){return S5(e,t,s,a)}});return Object.defineProperties(qs,{onAudioAutoplayFailed:{get:()=>mi.onAudioAutoplayFailed,set:e=>{mi.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>mi.onAutoplayFailed,set:e=>{mi.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>qs._onSecurityPolicyViolation,set(e){qs._onSecurityPolicyViolation=e,jV(e)}},__CLIENT_LIST__:{get:()=>$("SHOW_GLOBAL_CLIENT_LIST")?_d:[]}}),pi.on(pd.CAMERA_DEVICE_CHANGED,e=>{A.info("camera device changed",JSON.stringify(e)),qs.onCameraChanged&&qs.onCameraChanged(e),qs.safeEmit(To.CAMERA_CHANGED,e)}),pi.on(pd.RECORDING_DEVICE_CHANGED,e=>{A.info("microphone device changed",JSON.stringify(e)),qs.onMicrophoneChanged&&qs.onMicrophoneChanged(e),qs.safeEmit(To.MICROPHONE_CHANGED,e)}),pi.on(pd.PLAYOUT_DEVICE_CHANGED,e=>{A.debug("playout device changed",JSON.stringify(e)),qs.onPlaybackDeviceChanged&&qs.onPlaybackDeviceChanged(e),qs.safeEmit(To.PLAYBACK_DEVICE_CHANGED,e)}),mn.onAutoplayFailed=()=>{A.info("detect audio element autoplay failed"),mi.onAudioAutoplayFailed&&mi.onAudioAutoplayFailed()},ss.on("autoplay-failed",()=>{A.info("detect webaudio autoplay failed"),mi.onAudioAutoplayFailed&&mi.onAudioAutoplayFailed(),qs.safeEmit(To.AUTOPLAY_FAILED)}),ss.on(Er.STATE_CHANGE,(e,t)=>{A.info("audio context state changed: ".concat(t," => ").concat(e)),qs.onAudioContextStateChanged&&qs.onAudioContextStateChanged(e,t),qs.safeEmit(To.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Vs.on(Ju.NETWORK_STATE_CHANGE,(e,t)=>{A.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=qs),qs})}),cz={};$0e(cz,{AgoraRTCProvider:()=>uz,AgoraRTCReactError:()=>Xn,AgoraRTCScreenShareProvider:()=>aCe,LocalAudioTrack:()=>vz,LocalUser:()=>aA,LocalVideoTrack:()=>xz,RemoteAudioTrack:()=>wz,RemoteUser:()=>$y,RemoteVideoTrack:()=>Sz,TrackBoundary:()=>yCe,VERSION:()=>CCe,default:()=>Cz,useAutoPlayAudioTrack:()=>ZI,useAutoPlayVideoTrack:()=>QI,useClientEvent:()=>rCe,useConnectionState:()=>cCe,useCurrentUID:()=>lCe,useIsConnected:()=>Xp,useJoin:()=>pz,useLocalCameraTrack:()=>gz,useLocalMicrophoneTrack:()=>fz,useLocalScreenTrack:()=>vCe,useNetworkQuality:()=>dCe,usePublish:()=>mz,useRTCClient:()=>mo,useRTCScreenShareClient:()=>oCe,useRemoteAudioTracks:()=>fCe,useRemoteUserTrack:()=>iA,useRemoteUsers:()=>_z,useRemoteVideoTracks:()=>gCe,useTrackEvent:()=>nCe,useVolumeLevel:()=>hCe});var J0e=pu(mu());function Mn(r,n,o){return r.on(n,o),()=>r.off(n,o)}function Q0e(r){try{return r()}catch(n){console.error(n)}}function fu(r){return()=>r.forEach(Q0e)}function Z0e(r,n){let o=setInterval(r,n);return()=>clearInterval(o)}function fb(r,n){let o=setTimeout(r,n);return()=>clearTimeout(o)}function XI(){let r,n,o;function l(){if(n){let x=n;n=void 0,x()}}async function u(){if(o){let x=o;o=void 0;try{await x()}catch(S){console.error(S)}}}async function m(x){r=!0,await u();try{o=await x()}catch(S){console.error(S)}r=!1,l()}async function g(){r=!0,await u(),r=!1,l()}function E(x){r?n=()=>m(x):m(x)}function y(){r?n=g:g()}return{run:E,dispose:y}}var gb=typeof document<"u"?O.useLayoutEffect:O.useEffect;function eCe(r){return r!=null&&typeof r.then=="function"}function Yl(){let r=O.useRef(!1);return O.useEffect(()=>(r.current=!1,()=>{r.current=!0}),[]),r}function tCe(){let r=Yl();function n(o,l){return new Promise(async(u,m)=>{try{let g=await o;r.current||u(g)}catch(g){r.current?l&&l(g):m(g)}})}return O.useCallback(n,[r])}function lz(r){let n=tCe(),[o,l]=O.useState();return gb(()=>{eCe(r)?n(r).then(l):l(r)},[r,n]),o}function gu(r,n){let o=O.useRef();O.useEffect(()=>{let{run:l,dispose:u}=o.current||(o.current=XI());return l(r),u},n)}function sCe(r,n){let o=r.split("."),l=n.split("."),u=Math.max(o.length,l.length);for(let m=0;m<u;m++){let g=parseInt(o[m]||"0"),E=parseInt(l[m]||"0");if(g>E)return 1;if(g<E)return-1}return 0}function rCe(r,n,o){let l=O.useRef(o);gb(()=>{l.current=o},[o]),O.useEffect(()=>{if(r)return Mn(r,n,(...u)=>{l.current&&l.current(...u)})},[n,r])}function nCe(r,n,o){let l=O.useRef(o);gb(()=>{l.current=o},[o]),O.useEffect(()=>{if(r)return Mn(r,n,(...u)=>{l.current&&l.current(...u)})},[n,r])}var dz=O.createContext(null);function uz({client:r,children:n}){return i.jsx(dz.Provider,{value:r,children:n})}function iCe(r){let n=O.useContext(dz);return r||n}function mo(r){let n=iCe(r);if(!n)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return n}var hz=O.createContext(null);function aCe({client:r,children:n}){return i.jsx(hz.Provider,{value:r,children:n})}function oCe(r){let n=O.useContext(hz);return r||n}function cCe(r){let n=mo(r),[o,l]=O.useState(n?n.connectionState:"DISCONNECTED");return O.useEffect(()=>{if(n){l(n.connectionState);let u;return fu([Mn(n,"connection-state-change",m=>{u==null||u(),m==="CONNECTED"?u=fb(()=>l(m),0):l(m)}),()=>u==null?void 0:u()])}else l("DISCONNECTED")},[n]),o}function Xp(r){let n=mo(r),[o,l]=O.useState(n?n.connectionState==="CONNECTED":!1);return O.useEffect(()=>{if(n){l(n.connectionState==="CONNECTED");let u;return fu([Mn(n,"connection-state-change",m=>{u==null||u(),u=fb(()=>l(m==="CONNECTED"),0)}),()=>u==null?void 0:u()])}else l(!1)},[n]),o}function lCe(r){let n=mo(r),[o,l]=O.useState(n==null?void 0:n.uid);return O.useEffect(()=>{if(n)return Mn(n,"connection-state-change",u=>{if(u==="CONNECTED")return fb(()=>l(n.uid),0);u==="DISCONNECTED"&&l(void 0)})},[n]),o}var Xn=class extends Error{constructor(n,o){var r=(...KTe)=>(super(...KTe),Tf(this,"rtcMethod"),Tf(this,"rtcError"),Tf(this,"name","AgoraRTCReactException"),this);r(typeof o=="string"?o:o.message),this.rtcMethod=n,this.rtcError=o}log(n){console[n](this)}};function pz(r,n=!0,o){let l=mo(o),u=Xp(o),m=O.useRef(),[g,E]=O.useState(!1),[y,x]=O.useState(0),[S,C]=O.useState(null),R=Yl();return gu(async()=>{if(R.current||(C(null),x(0),E(!1)),n&&l){try{R.current||E(!0);let{appid:G,channel:I,token:j,uid:L}=typeof r=="function"?await r():r,N=await l.join(G,I,j,L);R.current||x(N)}catch(G){console.error(G),R.current||C(new Xn("IAgoraRTCClient.join",G))}R.current||E(!1);let M=m.current||(m.current=XI());return fu([()=>{M.dispose()},()=>{M.run(()=>l.unpublish(l.localTracks))},()=>{for(let G of l.localTracks)G.isPlaying&&G.stop(),G.close();M.run(()=>l.leave())}])}},[n,o]),{data:y,isLoading:g,isConnected:u,error:S}}var O7=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function dCe(r){let n=mo(r),[o,l]=O.useState(O7);return O.useEffect(()=>{if(n)return Mn(n,"network-quality",u=>l({uplinkNetworkQuality:u.uplinkNetworkQuality,downlinkNetworkQuality:u.downlinkNetworkQuality,delay:n.getRTCStats().RTT??0}));l(O7())},[n]),o}var uCe=pu(mu());function mz(r,n=!0,o){let l=mo(o),u=Xp(o),m=O.useRef([]),[g,E]=O.useState(!1),[y,x]=O.useState(null),S=Yl();return gu(async()=>{if(S.current||(E(!1),x(null)),!l||!u||!n)return;let C=r.filter(Boolean),R=I=>{let j=sCe(uCe.default.VERSION,"4.18.2")>=0;return j||new Xn("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),j?l.mode!=="live"||l.role!=="audience":!0},M=I=>m.current.some(j=>j&&j.getTrackId()===I.getTrackId()),G=I=>R()&&I.enabled&&n&&!M(I);for(let I=0;I<C.length;I++){let j=C[I];if(j&&G(j)){await l.unpublish(m.current.filter(L=>(L==null?void 0:L.trackMediaType)===j.trackMediaType));try{S.current||E(!0),await l.publish(j)}catch(L){console.error(L),S.current||x(new Xn("IAgoraRTCClient.publish",L))}S.current||E(!1)}}m.current=C},[u,n,l,r]),{isLoading:g,error:y}}function hCe(r){let[n,o]=O.useState(0);return O.useEffect(()=>{if(r)return Z0e(()=>{o(r.getVolumeLevel())},1e3)},[r]),n}var pCe=pu(mu());function fz(r=!0,n={ANS:!0,AEC:!0}){let[o,l]=O.useState(null),[u,m]=O.useState(!1),[g,E]=O.useState(null),y=Yl();return gu(async()=>{if(y.current||(m(!1),E(null)),r&&!o){try{y.current||m(!0);let x=await pCe.default.createMicrophoneAudioTrack(n);y.current||l(x)}catch(x){console.error(x),y.current||E(new Xn("IAgoraRTC.createMicrophoneAudioTrack",x))}y.current||m(!1)}},[r]),{localMicrophoneTrack:o,isLoading:u,error:g}}var mCe=pu(mu());function gz(r=!0,n){let[o,l]=O.useState(null),[u,m]=O.useState(!1),[g,E]=O.useState(null),y=Yl();return gu(async()=>{if(y.current||(m(!1),E(null)),r&&!o){try{y.current||m(!0);let x=await mCe.default.createCameraVideoTrack(n);y.current||l(x)}catch(x){console.error(x),y.current||E(new Xn("IAgoraRTC.createCameraVideoTrack",x))}y.current||m(!1)}},[r]),{localCameraTrack:o,isLoading:u,error:g}}function fCe(r,n){let o=mo(n),[l,u]=O.useState([]),m=Xp(),g=O.useRef([]),[E,y]=O.useState(!1),[x,S]=O.useState(null),C=Yl();return gu(async()=>{if(C.current||S(null),!Array.isArray(r)||!m)return;let R=async I=>{if(!I.audioTrack&&r.some(({uid:j})=>I.uid===j)){try{C.current||y(!0),await o.subscribe(I,"audio")}catch(j){console.error(j),C.current||S(new Xn("IAgoraRTCClient.subscribe",j))}I.audioTrack&&!g.current.some(j=>j.getUserId()===I.uid)&&g.current.push(I.audioTrack),g.current=g.current.map(j=>I.audioTrack&&j.getUserId()===I.uid&&j.getTrackId()!==I.audioTrack.getTrackId()?I.audioTrack:j),C.current||(u([...g.current]),y(!1))}},M=async I=>{if(r.some(({uid:j})=>I.uid===j)){C.current||(g.current=g.current.filter(j=>j.getUserId()!==I.uid),u([...g.current]));try{C.current||y(!0),await o.unsubscribe(I,"audio")}catch(j){console.error(j),C.current||S(new Xn("IAgoraRTCClient.unsubscribe",j))}C.current||y(!1)}};r.map(I=>{!I.audioTrack&&I.hasAudio&&R(I)});let G=[];for(let I=0;I<g.current.length;I++){let j=g.current[I];if(!r.some(L=>L.uid===j.getUserId())){let L=o.remoteUsers.find(N=>N.uid===j.getUserId());L&&G.push({user:L,mediaType:"audio"}),g.current.splice(I,1),I--}}if(G.length>0){try{C.current||y(!0),await o.massUnsubscribe(G)}catch(I){console.error(I),C.current||S(new Xn("IAgoraRTCClient.massUnsubscribe",I))}C.current||(u(g.current.slice()),y(!1))}return fu([Mn(o,"user-published",(I,j)=>{r.find(L=>L.uid===I.uid)&&j==="audio"&&R(I)}),Mn(o,"user-unpublished",(I,j)=>{r.find(L=>L.uid===I.uid)&&j==="audio"&&M(I)})])},[m,o,r]),{audioTracks:l,isLoading:E,error:x}}function gCe(r,n){let o=mo(n),[l,u]=O.useState([]),m=Xp(),g=O.useRef([]),[E,y]=O.useState(!1),[x,S]=O.useState(null),C=Yl();return gu(async()=>{if(C.current||S(null),!Array.isArray(r)||!m)return;let R=async I=>{if(!I.videoTrack&&r.some(({uid:j})=>I.uid===j)){try{C.current||y(!0),await o.subscribe(I,"video")}catch(j){console.error(j),C.current||S(new Xn("IAgoraRTCClient.subscribe",j))}I.videoTrack&&!g.current.some(j=>j.getUserId()===I.uid)&&g.current.push(I.videoTrack),g.current=g.current.map(j=>I.videoTrack&&j.getUserId()===I.uid&&j.getTrackId()!==I.videoTrack.getTrackId()?I.videoTrack:j),C.current||(u([...g.current]),y(!1))}},M=async I=>{if(r.some(({uid:j})=>I.uid===j)){C.current||(g.current=g.current.filter(j=>j.getUserId()!==I.uid),u([...g.current]));try{C.current||y(!0),await o.unsubscribe(I,"video")}catch(j){console.error(j),C.current||S(new Xn("IAgoraRTCClient.unsubscribe",j))}C.current||y(!1)}};r.map(I=>{!I.videoTrack&&I.hasVideo&&R(I)});let G=[];for(let I=0;I<g.current.length;I++){let j=g.current[I];if(!r.some(L=>L.uid===j.getUserId())){let L=o.remoteUsers.find(N=>N.uid===j.getUserId());L&&G.push({user:L,mediaType:"video"}),g.current.splice(I,1),I--}}if(G.length>0){try{C.current||y(!0),await o.massUnsubscribe(G)}catch(I){console.error(I),C.current||S(new Xn("IAgoraRTCClient.massUnsubscribe",I))}C.current||(u(g.current.slice()),y(!1))}return fu([Mn(o,"user-published",(I,j)=>{r.find(L=>L.uid===I.uid)&&j==="video"&&R(I)}),Mn(o,"user-unpublished",(I,j)=>{r.find(L=>L.uid===I.uid)&&j==="video"&&M(I)})])},[m,o,r]),{videoTracks:l,isLoading:E,error:x}}function iA(r,n,o){let l=mo(o),u=n==="audio"?"audioTrack":"videoTrack",[m,g]=O.useState(r&&r[u]),E=Xp(),y=O.useRef(),[x,S]=O.useState(!1),[C,R]=O.useState(null);return O.useEffect(()=>{if(!r||!E)return;let M=!1;M||R(null);let G=n==="audio"?"hasAudio":"hasVideo",I=r.uid,j=async(D,V)=>{if(D[u]&&l.remoteUsers.some(({uid:B})=>D.uid===B))try{M||S(!0),await l.unsubscribe(D,V)}catch(B){M||R(new Xn("IAgoraRTCClient.unsubscribe",B)),console.error(B)}M||(g(void 0),S(!1))},L=async(D,V)=>{try{!D[u]&&l.remoteUsers.some(({uid:B})=>D.uid===B)&&(M||S(!0),await l.subscribe(D,V)),M||g(D[u])}catch(B){M||R(new Xn("IAgoraRTCClient.subscribe",B)),console.error(B)}M||S(!1)},N=y.current||(y.current=XI());return!r[u]&&r[G]?N.run(()=>L(r,n)):g(r[u]),fu([()=>{M=!0,N.dispose()},Mn(l,"user-published",(D,V)=>{D.uid===I&&V===n&&N.run(()=>L(D,n))}),Mn(l,"user-unpublished",(D,V)=>{D.uid===I&&V===n&&N.run(()=>j(D,n))})])},[E,l,r,n,u]),{track:m,isLoading:x,error:C}}function _z(r){let n=mo(r),[o,l]=O.useState(n?n.remoteUsers:[]);return O.useEffect(()=>{if(n){let u=()=>l(n.remoteUsers.slice());return fu([Mn(n,"user-joined",u),Mn(n,"user-left",u),Mn(n,"user-published",u),Mn(n,"user-unpublished",u)])}},[n]),o}var _Ce=pu(mu());function vCe(r=!0,n,o){let[l,u]=O.useState(null),[m,g]=O.useState(!1),[E,y]=O.useState(null),x=Yl();return gu(async()=>{if(x.current||(g(!1),y(null)),r&&!l){try{x.current||g(!0);let S=await _Ce.default.createScreenVideoTrack(n,o);x.current||u(S)}catch(S){console.error(S),x.current||y(new Xn("IAgoraRTC.createScreenVideoTrack",S))}x.current||g(!1)}},[r]),{screenTrack:l,isLoading:m,error:E}}function ECe(){let r=new Map,n=1500;return{onMount:o=>{let l=r.get(o);l&&(l(),r.delete(o))},onUnmount:o=>{let l=r.get(o);l&&l(),r.set(o,fb(()=>{o.isPlaying&&o.stop(),r.delete(o)},n))},dispose:()=>{for(let[o,l]of r)o.isPlaying&&o.stop(),l&&l();r.clear()}}}var JI=O.createContext(void 0);function yCe({children:r}){let[n]=O.useState(ECe);return O.useEffect(()=>n.dispose,[n]),i.jsx(JI.Provider,{value:n,children:r})}function QI(r,n,o,l){let u=O.useContext(JI);O.useEffect(()=>{if(r)return l&&n?r.play(l,o||void 0):r.stop(),u?(u.onMount(r),()=>u.onUnmount(r)):()=>{r.isPlaying&&r.stop()}},[r,l,n,u,o])}function ZI(r,n){let o=O.useContext(JI);gb(()=>{if(r)return n?r.play():r.stop(),o?(o.onMount(r),()=>o.onUnmount(r)):()=>{r.isPlaying&&r.stop()}},[r,n,o])}function vz({track:r,play:n=!1,volume:o,disabled:l,muted:u,children:m}){let g=lz(r);return ZI(g,n),O.useEffect(()=>{g&&o!=null&&g.setVolume(o)},[g,o]),O.useEffect(()=>{g&&l!=null&&g.setEnabled(!l).catch(console.warn)},[l,g]),O.useEffect(()=>{g&&u!=null&&g.setMuted(u).catch(console.warn)},[u,g]),m?i.jsx(i.Fragment,{children:m}):null}var Ez={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},yz={width:"100%",height:"100%"},eD={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},_b=(r,n)=>O.useMemo(()=>({...r,...n}),[r,n]);function xz({track:r,play:n,disabled:o,muted:l,style:u,videoPlayerConfig:m,...g}){let E=_b(yz,u),[y,x]=O.useState(null),S=lz(r);return QI(S,n,m,y),O.useEffect(()=>{S&&o!=null&&S.setEnabled(!o).catch(console.warn)},[o,S]),O.useEffect(()=>{S&&l!=null&&S.setMuted(l).catch(console.warn)},[l,S]),i.jsx("div",{...g,ref:x,style:E})}var xCe={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},bCe={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function bz({cover:r}){return i.jsx("div",{style:eD,children:typeof r=="string"?i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{...xCe,backgroundImage:`url(${r})`}}),i.jsx("img",{src:r,style:bCe})]}):r()})}function aA({micOn:r,cameraOn:n,audioTrack:o,videoTrack:l,playAudio:u,playVideo:m,volume:g,cover:E,children:y,style:x,...S}){let C=_b(Ez,x);return m=m??!!n,u=u??!!r,i.jsxs("div",{...S,style:C,children:[i.jsx(xz,{disabled:!n,play:m,track:l}),i.jsx(vz,{disabled:!r,play:u,track:o,volume:g}),E&&!n&&i.jsx(bz,{cover:E}),i.jsx("div",{style:eD,children:y})]})}function wz({track:r,play:n=!1,playbackDeviceId:o,volume:l,children:u}){return ZI(r,n),O.useEffect(()=>{r&&o!=null&&r.setPlaybackDevice(o).catch(console.warn)},[r,o]),O.useEffect(()=>{r&&l!=null&&r.setVolume(l)},[r,l]),u?i.jsx(i.Fragment,{children:u}):null}function Sz({track:r,play:n,style:o,videoPlayerConfig:l,...u}){let m=_b(yz,o),[g,E]=O.useState(null);return QI(r,n,l,g),i.jsx("div",{...u,ref:E,style:m})}function $y({user:r,playVideo:n,playAudio:o,playbackDeviceId:l,volume:u,cover:m,style:g,children:E,videoPlayerConfig:y,...x}){let S=_b(Ez,g),{track:C}=iA(r,"video"),{track:R}=iA(r,"audio");return n=n??(r==null?void 0:r.hasVideo),o=o??(r==null?void 0:r.hasAudio),i.jsxs("div",{...x,style:S,children:[i.jsx(Sz,{play:n,track:C,videoPlayerConfig:y}),i.jsx(wz,{play:o,playbackDeviceId:l,track:R,volume:u}),m&&!n&&i.jsx(bz,{cover:m}),i.jsx("div",{style:eD,children:E})]})}var wCe=pu(mu()),SCe=class{constructor(){Tf(this,"appType",1001);wCe.default.setAppType(this.appType)}};new SCe;var CCe="2.5.0";X0e(cz,pu(mu()));var Cz=J0e.default;async function Vg(r,n,o={}){const{error:l}=await ie.from("meeting_event_logs").insert({meet_id:r,event_type:n,timestamp:new Date().toISOString(),metadata:o});l&&console.error(`Error logging meeting event ${n}:`,l)}async function vb(r){const{data:n,error:o}=await ie.from("meets").select("*").eq("id",r).single();return o||!n?(console.error("Error fetching meeting:",o),null):{id:n.id,status:n.status,scheduledAt:n.scheduled_at,durationMinutes:n.duration_minutes,creatorId:n.creator_id,fanId:n.fan_id,creatorStartedAt:n.creator_started_at,creatorJoinedAt:n.creator_joined_at,fanJoinedAt:n.fan_joined_at,recordingStartedAt:n.recording_started_at,recordingStoppedAt:n.recording_stopped_at,recordingResourceId:n.recording_resource_id,recordingSid:n.recording_sid,recordingMode:n.recording_mode,recordingStatus:n.recording_status,recordingFileList:n.recording_file_list,recordingUrl:n.recording_url}}async function j7(r){const{data:n,error:o}=await ie.from("meets").select("*").ilike("meeting_link",`%${r}%`).single();return o||!n?(console.error("Error fetching meeting by link:",o),null):{id:n.id,status:n.status,scheduledAt:n.scheduled_at,durationMinutes:n.duration_minutes,creatorId:n.creator_id,fanId:n.fan_id,creatorStartedAt:n.creator_started_at,creatorJoinedAt:n.creator_joined_at,fanJoinedAt:n.fan_joined_at,recordingStartedAt:n.recording_started_at,recordingStoppedAt:n.recording_stopped_at,recordingResourceId:n.recording_resource_id,recordingSid:n.recording_sid,recordingMode:n.recording_mode,recordingStatus:n.recording_status,recordingFileList:n.recording_file_list,recordingUrl:n.recording_url}}const TCe="agora-cloud-recording";async function NCe(r,n,o={}){try{const{data:l,error:u}=await ie.functions.invoke(TCe,{body:{action:n,meetId:r,...o}});return u?(console.error(`Edge function error (${n}):`,u),{success:!1,error:u.message}):l!=null&&l.success?{success:!0,data:l}:(console.error(`Edge function responded with failure for ${n}:`,l),{success:!1,error:(l==null?void 0:l.error)||"Unknown recording error"})}catch(l){const u=l;return console.error(`Failed to invoke recording action ${n}:`,u),{success:!1,error:u.message}}}async function RCe(r){console.log(" onCreatorStreamStarted called with meetId:",r);const n=new Date,o=await vb(r);if(!o)return console.error(" Meeting not found for id:",r),{success:!1,error:"Meeting not found"};if(console.log(" Meeting found:",{id:o.id,status:o.status,scheduledAt:o.scheduledAt}),o.status!=="scheduled"&&o.status!=="live")return console.error(" Meeting not in startable state:",o.status),{success:!1,error:`Meeting is not in a startable state (current: ${o.status})`};if(o.status==="live")return console.log(" Meeting already live, returning success"),{success:!0};const l=new Date(o.scheduledAt),u=new Date(o.scheduledAt);if(u.setMinutes(u.getMinutes()+o.durationMinutes),n>=u)return console.error(" Meeting past end time"),{success:!1,error:"Cannot start meeting after scheduled end time"};const m=n<l,g=m?Math.floor((l.getTime()-n.getTime())/1e3):-Math.floor((n.getTime()-l.getTime())/1e3);console.log(" Attempting to update meeting to live...");const{error:E,data:y}=await ie.from("meets").update({status:"live",creator_started_at:n.toISOString()}).eq("id",r).select();return E?(console.error(" Error updating meeting status:",E),{success:!1,error:`Failed to update meeting: ${E.message}`}):(console.log(" Update result:",y),await Vg(r,"CREATOR_STREAM_STARTED",{started_at:n.toISOString(),scheduled_start:o.scheduledAt,started_early:m,seconds_from_scheduled:g}),await tD(r),console.log(" onCreatorStreamStarted completed successfully"),{success:!0})}async function ACe(r,n){const o=new Date,l=await vb(r);if(!l)return{success:!1,error:"Meeting not found"};if(l.creatorId!==n)return{success:!1,error:"User is not the creator of this meeting"};const{error:u}=await ie.from("meets").update({creator_joined_at:o.toISOString()}).eq("id",r);return u?(console.error("Error updating creator joined time:",u),{success:!1,error:"Failed to update meeting"}):(await Vg(r,"CREATOR_JOINED",{creator_id:n,joined_at:o.toISOString()}),await tD(r),{success:!0})}async function RN(r,n){const o=new Date,l=await vb(r);if(!l)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting not found"};if(l.fanId!==n)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"User is not the fan for this meeting"};if(l.status==="cancelled_no_show_creator"||l.status==="cancelled")return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting has been cancelled",meetingEnded:!0};if(l.status==="completed")return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting has already ended",meetingEnded:!0};const u=new Date(l.scheduledAt);if(u.setMinutes(u.getMinutes()+l.durationMinutes),o>=u)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting time has ended",meetingEnded:!0};if(l.status==="scheduled")return await Vg(r,"FAN_WAITING_ROOM",{fan_id:n,attempted_at:o.toISOString()}),{success:!0,showWaitingRoom:!0,canJoin:!1};if(l.status==="live"){if(!l.fanJoinedAt){const{error:m}=await ie.from("meets").update({fan_joined_at:o.toISOString()}).eq("id",r);m&&console.error("Error updating fan joined time:",m),await Vg(r,"FAN_JOINED",{fan_id:n,joined_at:o.toISOString(),scheduled_start:l.scheduledAt,joined_late_by_seconds:o>new Date(l.scheduledAt)?Math.floor((o.getTime()-new Date(l.scheduledAt).getTime())/1e3):0}),await tD(r)}return{success:!0,showWaitingRoom:!1,canJoin:!0}}return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Unknown meeting state"}}async function tD(r){const n=await vb(r);if(!n||n.status!=="live"||n.recordingStartedAt||!(await NCe(r,"start",n.recordingMode?{mode:n.recordingMode}:{})).success)return;const l=new Date().toISOString();await Vg(r,"RECORDING_STARTED",{started_at:l}),console.log(`Recording start requested for meeting ${r}`)}function AN(r){const n=new Date,o=new Date(r.scheduledAt);o.setMinutes(o.getMinutes()+r.durationMinutes);const l=o.getTime()-n.getTime();return Math.max(0,Math.floor(l/1e3))}function Tz(r){const n=new Date,o=new Date(r.scheduledAt),l=new Date(r.scheduledAt);l.setMinutes(l.getMinutes()+r.durationMinutes);const u=Math.floor((o.getTime()-n.getTime())/1e3),m=Math.floor((l.getTime()-n.getTime())/1e3);return{beforeStart:n<o,duringMeeting:n>=o&&n<l,afterEnd:n>=l,secondsUntilStart:u,secondsUntilEnd:m}}const IN={},Nz=(IN==null?void 0:IN.VITE_AGORA_APP_ID)||"4cc829c3ab144792a3f65fea1f905671";console.log(" Agora APP_ID:",Nz);const ICe=()=>{const{meetId:r}=iI(),n=Ns(),{user:o,isLoading:l}=vs(),u=O.useMemo(()=>Cz.createClient({mode:"rtc",codec:"vp8"}),[]),m=O.useCallback(()=>(o==null?void 0:o.role)==="creator"?"/creator/meets":(o==null?void 0:o.role)==="fan"?"/fan/meets":"/",[o==null?void 0:o.role]);return r?l?i.jsx(Rz,{}):o?i.jsx(uz,{client:u,children:i.jsx(DCe,{user:o,meetId:r,onLeave:()=>n(m())})}):i.jsx(Ox,{message:"Please log in to join the meeting",onBack:()=>n("/login")}):i.jsx(Ox,{message:"Invalid Meeting Link",onBack:()=>n("/")})};function DCe({user:r,meetId:n,onLeave:o}){const[l,u]=O.useState("loading"),[m,g]=O.useState(null),[E,y]=O.useState(!1),[x,S]=O.useState(null),[C,R]=O.useState(null),M=O.useRef(null),G=O.useRef(null),I=()=>{M.current&&(clearInterval(M.current),M.current=null)},j=()=>{G.current&&(console.log(" Cleaning up Realtime subscription"),ie.removeChannel(G.current),G.current=null)},L=D=>{if(G.current)return;console.log(" Setting up Supabase Realtime for meeting:",D);const V=ie.channel(`meeting-${D}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"meets",filter:`id=eq.${D}`},async B=>{console.log(" Realtime update received:",B.new);const z=B.new;if(g(H=>H?{...H,status:z.status,creatorStartedAt:z.creator_started_at,creatorJoinedAt:z.creator_joined_at,fanJoinedAt:z.fan_joined_at}:null),z.status==="live"&&z.creator_started_at&&(console.log(" Creator started meeting! (Realtime)"),I(),(await RN(D,r.id)).canJoin)){u("live");const J=new Date(z.scheduled_at);J.setMinutes(J.getMinutes()+z.duration_minutes);const ee=Math.max(0,Math.floor((J.getTime()-Date.now())/1e3));S(ee)}(z.status==="cancelled_no_show_creator"||z.status==="cancelled")&&(console.log(" Meeting cancelled (Realtime)"),I(),u("cancelled")),z.status==="completed"&&(console.log(" Meeting completed (Realtime)"),u("ended")),z.fan_joined_at&&console.log(" Fan joined the meeting! (Realtime)")}).subscribe(B=>{console.log(" Realtime subscription status:",B)});G.current=V},N=D=>{M.current||(console.log(" Starting polling + Realtime for meeting updates..."),L(D),M.current=setInterval(async()=>{const V=await j7(n);V&&(V.status==="live"&&V.creatorStartedAt&&(console.log(" Creator started! (Polling)"),I(),(await RN(V.id,r.id)).canJoin&&(g(V),u("live"),S(AN(V)))),V.status==="cancelled_no_show_creator"&&(console.log(" Meeting cancelled (Polling)"),I(),u("cancelled")))},3e3))};return O.useEffect(()=>{async function D(){const V=await j7(n);if(!V){R("Meeting not found"),u("error");return}g(V);const B=V.creatorId===r.id,z=V.fanId===r.id;if(y(B),!B&&!z){R("You are not a participant of this meeting"),u("error");return}if(V.status==="cancelled_no_show_creator"||V.status==="cancelled"){u("cancelled");return}if(V.status==="completed"){u("ended");return}if(Tz(V).afterEnd){u("ended");return}if(B)L(V.id),u("live"),S(AN(V));else if(V.status==="live"&&V.creatorStartedAt){const J=await RN(V.id,r.id);J.canJoin?(u("live"),S(AN(V))):J.meetingEnded?u("ended"):(u("waiting_room"),N(V.id))}else u("waiting_room"),N(V.id)}return D(),()=>{I(),j()}},[n,r.id]),O.useEffect(()=>{if(l!=="live"||x===null)return;const D=setInterval(()=>{S(V=>V===null||V<=1?(clearInterval(D),u("ended"),0):V-1)},1e3);return()=>clearInterval(D)},[l,x]),l==="loading"?i.jsx(Rz,{}):l==="error"?i.jsx(Ox,{message:C||"An error occurred",onBack:o}):l==="cancelled"?i.jsx(OCe,{isCreator:E,onBack:o}):l==="ended"?i.jsx(jCe,{onBack:o}):l==="waiting_room"&&m?i.jsx(PCe,{meeting:m,onBack:o}):l==="live"&&m?i.jsx(kCe,{user:r,meeting:m,meetId:n,isCreator:E,timeLeft:x,onLeave:o}):i.jsx(Ox,{message:"Unknown state",onBack:o})}function Rz(){return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs("div",{className:"text-center text-white",children:[i.jsx("div",{className:"mb-4 text-4xl",children:""}),i.jsx("p",{className:"text-lg",children:"Loading meeting..."})]})})}function Ox({message:r,onBack:n}){return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs(fe,{className:"max-w-md bg-gray-800 p-8 text-center",children:[i.jsx("div",{className:"mb-4 text-4xl",children:""}),i.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Error"}),i.jsx("p",{className:"mb-6 text-gray-400",children:r}),i.jsx(oe,{onClick:n,children:"Go Back"})]})})}function OCe({isCreator:r,onBack:n}){return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs(fe,{className:"max-w-md bg-gray-800 p-8 text-center",children:[i.jsx("div",{className:"mb-4 text-4xl",children:""}),i.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Meeting Cancelled"}),i.jsx("p",{className:"mb-6 text-gray-400",children:r?"This meeting was cancelled because you did not start before the scheduled time.":"This meeting was cancelled because the creator did not show up. A refund has been issued."}),i.jsx(oe,{onClick:n,children:"Go Back"})]})})}function jCe({onBack:r}){return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs(fe,{className:"max-w-md bg-gray-800 p-8 text-center",children:[i.jsx("div",{className:"mb-4 text-4xl",children:""}),i.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Meeting Ended"}),i.jsx("p",{className:"mb-6 text-gray-400",children:"This meeting has ended. Thank you for participating!"}),i.jsx(oe,{onClick:r,children:"Go Back"})]})})}function PCe({meeting:r,onBack:n}){const o=Tz(r),l=new Date(r.scheduledAt).toLocaleString();return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs(fe,{className:"max-w-lg bg-gray-800 p-8 text-center",children:[i.jsx("div",{className:"mb-4 text-6xl",children:""}),i.jsx("h2",{className:"mb-2 text-2xl font-semibold text-white",children:"Waiting Room"}),i.jsx("p",{className:"mb-4 text-gray-400",children:"The creator hasn't started the meeting yet. Please wait..."}),i.jsxs("div",{className:"mb-6 rounded-lg bg-gray-700 p-4",children:[i.jsxs("p",{className:"text-sm text-gray-300",children:[i.jsx("strong",{children:"Scheduled Start:"})," ",l]}),i.jsxs("p",{className:"text-sm text-gray-300",children:[i.jsx("strong",{children:"Duration:"})," ",r.durationMinutes," minutes"]}),o.beforeStart&&i.jsxs("p",{className:"mt-2 text-sm text-yellow-400",children:[" Meeting starts in ",Math.ceil(o.secondsUntilStart/60)," minutes"]})]}),i.jsxs("div",{className:"mb-4 flex items-center justify-center gap-2",children:[i.jsx("div",{className:"h-3 w-3 animate-pulse rounded-full bg-yellow-500"}),i.jsx("span",{className:"text-sm text-yellow-400",children:"Waiting for creator to start..."})]}),i.jsx("p",{className:"mb-6 text-xs text-gray-500",children:"You'll automatically join when the creator starts the meeting."}),i.jsx(oe,{variant:"secondary",onClick:n,children:"Leave Waiting Room"})]})})}function kCe({user:r,meeting:n,meetId:o,isCreator:l,timeLeft:u,onLeave:m}){const[g,E]=O.useState(!1),[y,x]=O.useState(!1),[S,C]=O.useState("preparing"),[R,M]=O.useState(null),[G,I]=O.useState(null),[j,L]=O.useState(!0),[N,D]=O.useState(!0),[V,B]=O.useState(!0),[z,H]=O.useState("local"),[J,ee]=O.useState(!1),[ne,he]=O.useState(!1),ve=O.useRef(null),ye=O.useRef(null),me=n.id;console.log(" Agora channel name:",me,"(meeting.id, not URL param)"),O.useEffect(()=>{console.log(" Testing mode - using null token for channel:",me),L(!1),E(!0)},[me]);const{isConnected:ue}=pz({appid:Nz,channel:me,token:null},g),{localMicrophoneTrack:Fe}=fz(g),{localCameraTrack:be}=gz(g);mz([Fe,be]);const ae=_z();O.useEffect(()=>{Fe&&Fe.setEnabled(N)},[Fe,N]),O.useEffect(()=>{be&&be.setEnabled(V)},[be,V]),O.useEffect(()=>{console.log(" Agora connection status:",ue?"CONNECTED":"DISCONNECTED"),console.log(" Remote users count:",ae.length),ae.length>0&&console.log(" Remote users:",ae.map(De=>De.uid))},[ue,ae]),O.useEffect(()=>{l&&!y&&(x(!0),console.log(" Creator entered LiveCall view, marking meeting as LIVE immediately"),console.log(" Meeting ID:",n.id),RCe(n.id).then(De=>{De.success?console.log(" Meeting marked as LIVE in database - fan can now join"):console.error(" Failed to mark meeting as LIVE:",De.error)}).catch(De=>{console.error(" Error calling onCreatorStreamStarted:",De)}),ACe(n.id,r.id).catch(De=>{console.error("Error in onCreatorJoined:",De)}),ge())},[l,y,n.id,r.id]),O.useEffect(()=>{n&&(n.recordingStartedAt&&!n.recordingStoppedAt?C("recording"):n.recordingStoppedAt?C("stopped"):C("preparing"))},[n.recordingStartedAt,n.recordingStoppedAt]);async function ge(){try{C("preparing");const{data:De,error:Ae}=await ie.functions.invoke("agora-cloud-recording",{body:{action:"query",meetId:n.id}});if(Ae||!(De!=null&&De.success)){M((Ae==null?void 0:Ae.message)||(De==null?void 0:De.error)||"Unable to verify recording"),C("error");return}C("recording"),M(null)}catch(De){const Ae=De instanceof Error?De.message:"Unknown recording error";console.error("Recording status check failed:",De),M(Ae),C("error")}}async function Se(){try{C("preparing");const{data:De,error:Ae}=await ie.functions.invoke("agora-cloud-recording",{body:{action:"stop",meetId:n.id}});if(Ae||!(De!=null&&De.success)){M((Ae==null?void 0:Ae.message)||(De==null?void 0:De.error)||"Failed to stop recording"),C("error");return}C("stopped"),M(null)}catch(De){const Ae=De instanceof Error?De.message:"Unknown recording error";console.error("Recording stop failed:",De),M(Ae),C("error")}}const it=De=>{const Ae=Math.floor(De/60),Qe=De%60;return`${Ae}:${Qe.toString().padStart(2,"0")}`},Ue=ae.find(De=>De.uid===z)||ae[0]||null,ht=Ue?ae.filter(De=>De.uid!==Ue.uid):[],qe=z==="local"||!Ue;O.useEffect(()=>{if(ae.length===0){ye.current||(ye.current=setTimeout(()=>{H("local"),ee(!1),ye.current=null},350));return}ye.current&&(clearTimeout(ye.current),ye.current=null);const De=z!=="local"&&ae.some(Ae=>Ae.uid===z);if(z!=="local"&&!De){const Ae=ae[0];Ae&&z!==Ae.uid&&H(Ae.uid)}else!J&&z==="local"&&ae.length>0&&H(ae[0].uid)},[ae,z,J]),O.useEffect(()=>()=>{ve.current&&clearTimeout(ve.current),ye.current&&clearTimeout(ye.current)},[]);const Me=()=>{ae.length!==0&&(ee(!0),he(!0),ve.current&&clearTimeout(ve.current),ve.current=setTimeout(()=>{he(!1),ve.current=null},320),H(De=>{if(De==="local"){const Ae=ae[0];return(Ae==null?void 0:Ae.uid)??"local"}return"local"}))},st=S==="recording"?"bg-red-500 animate-pulse":S==="error"?"bg-amber-400":S==="stopped"?"bg-gray-400":"bg-emerald-400 animate-pulse";return i.jsxs("div",{className:"relative flex h-screen w-full flex-col overflow-hidden bg-[#040308] text-white",children:[i.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(88,111,255,0.25),_rgba(4,3,8,0.95))]"}),i.jsxs("div",{className:"relative z-10 flex h-full flex-col",children:[i.jsxs("header",{className:"flex items-center justify-between px-5 pb-2 pt-6 sm:px-8",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs uppercase tracking-[0.35em] text-white/50",children:"FanMeet Live"}),i.jsx("h1",{className:"text-xl font-semibold text-white sm:text-2xl",children:l?"Chat with your fan":"Live with the creator"}),i.jsx("p",{className:"text-[11px] text-white/60",children:"End-to-end encrypted  Agora powered"})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1 text-right",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-[0.3em] text-emerald-300",children:"Live"}),i.jsx("span",{className:`text-2xl font-bold ${u!==null&&u<60?"text-rose-300":"text-white"}`,children:u!==null?it(u):"--:--"}),i.jsxs("span",{className:"text-xs text-white/60",children:[ae.length+1," participant",ae.length!==0?"s":""]})]})]}),i.jsxs("main",{className:"relative flex-1 px-4 pb-36 pt-2 sm:px-8",children:[i.jsxs("div",{className:`relative h-full w-full overflow-hidden rounded-[32px] border border-white/10 bg-black/40 shadow-[0_30px_120px_rgba(0,0,0,0.45)] transition-all duration-300 ease-out ${ne?"ring-2 ring-white/20 scale-[1.01]":""}`,children:[!qe&&Ue?i.jsx($y,{user:Ue,className:"h-full w-full object-cover"}):V?i.jsx(aA,{audioTrack:Fe,videoTrack:be,cameraOn:V,micOn:N,playAudio:!1,playVideo:V,className:"h-full w-full object-cover"}):i.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-center",children:[i.jsx("div",{className:"mb-4 text-5xl",children:""}),i.jsx("p",{className:"text-base font-semibold",children:ae.length?"Your camera is off":`Waiting for ${l?"fan":"creator"} to connect`}),i.jsx("p",{className:"mt-2 max-w-xs text-sm text-white/70",children:ae.length?"Switch on your camera or tap swap to spotlight the participant.":"Well pull them in the moment their camera is active."})]}),i.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-transparent to-black/40"}),i.jsxs("div",{className:"absolute left-5 top-5 flex flex-col gap-1 rounded-2xl bg-black/30 px-4 py-3 backdrop-blur",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-[0.3em] text-white/70",children:!qe&&Ue?"Connected":ae.length?"Self view":"Calling"}),i.jsx("p",{className:"text-lg font-semibold",children:qe?"You are in focus":l?"Fan in focus":"Creator in focus"}),i.jsx("p",{className:"text-xs text-white/70",children:new Date(n.scheduledAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),ht.length>0&&i.jsxs("div",{className:"absolute right-5 top-5 flex gap-2",children:[ht.slice(0,2).map(De=>i.jsx("div",{className:"h-12 w-12 rounded-2xl border border-white/20 bg-white/15 backdrop-blur",children:i.jsx($y,{user:De,className:"h-full w-full rounded-2xl object-cover"})},De.uid)),ht.length>2&&i.jsxs("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl border border-white/20 bg-black/30 text-xs font-semibold text-white/70",children:["+",ht.length-2]})]}),i.jsxs("div",{className:"absolute bottom-5 left-5 flex max-w-[70%] items-center gap-3 rounded-2xl bg-black/35 px-4 py-2 text-xs text-white/80 backdrop-blur",children:[i.jsx("div",{className:`h-2 w-2 rounded-full ${ae.length?"bg-emerald-400":"bg-yellow-400"}`}),i.jsx("p",{className:"truncate",children:ae.length?"All good  video stabilized":"Linking you both together"})]})]}),ae.length>0&&i.jsxs("button",{type:"button",onClick:Me,className:"group absolute bottom-28 right-4 z-20 w-28 rounded-[20px] border border-white/30 bg-black/70 p-2 text-left shadow-2xl backdrop-blur transition-all duration-300 ease-out hover:scale-105 hover:border-white/80 sm:right-10 sm:w-32",children:[i.jsxs("div",{className:"relative h-32 w-full overflow-hidden rounded-2xl",children:[qe&&Ue?i.jsx($y,{user:Ue,className:"h-full w-full object-cover"}):i.jsx(aA,{audioTrack:Fe,videoTrack:be,cameraOn:V,micOn:N,playAudio:!1,playVideo:V,className:"h-full w-full object-cover"}),i.jsx("div",{className:"absolute inset-0 bg-black/30 opacity-0 transition group-hover:opacity-100"})]}),i.jsxs("div",{className:"mt-2 flex items-center justify-between text-[10px] font-medium uppercase tracking-wide text-white/80",children:[i.jsx("span",{children:qe?l?"Fan view":"Creator view":"You"}),i.jsx("span",{className:"text-white/60",children:"Tap to swap"})]})]})]}),i.jsxs("footer",{className:"pointer-events-auto absolute inset-x-0 bottom-0 flex flex-col gap-4 rounded-t-[32px] bg-black/60 px-6 pb-8 pt-6 backdrop-blur-2xl sm:flex-row sm:items-center sm:justify-between sm:px-10",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/70 sm:text-sm",children:[i.jsx("div",{className:`h-2 w-2 rounded-full ${st}`}),i.jsxs("span",{children:[S==="recording"&&"Recording  Cloud backup active",S==="preparing"&&"Arming recording...",S==="stopped"&&"Recording stopped",S==="error"&&(R||"Recording unavailable")]}),S==="recording"&&l&&i.jsx("button",{onClick:Se,className:"ml-3 text-xs font-semibold text-white/90 underline-offset-2 hover:text-white",children:"Stop"})]}),i.jsxs("div",{className:"flex flex-1 flex-wrap items-center justify-center gap-4 sm:justify-end",children:[i.jsxs("button",{onClick:()=>D(De=>!De),className:`flex h-14 w-14 flex-col items-center justify-center rounded-full text-[11px] font-semibold transition sm:h-16 sm:w-16 ${N?"bg-white/15 text-white":"bg-rose-600 text-white shadow-lg shadow-rose-900/40"}`,children:[N?i.jsx(ube,{className:"mb-1 h-5 w-5"}):i.jsx(lbe,{className:"mb-1 h-5 w-5"}),N?"Mute":"Unmute"]}),i.jsxs("button",{onClick:()=>B(De=>!De),className:`flex h-14 w-14 flex-col items-center justify-center rounded-full text-[11px] font-semibold transition sm:h-16 sm:w-16 ${V?"bg-white/15 text-white":"bg-rose-600 text-white shadow-lg shadow-rose-900/40"}`,children:[V?i.jsx(xbe,{className:"mb-1 h-5 w-5"}):i.jsx(Ebe,{className:"mb-1 h-5 w-5"}),V?"Video":"Off"]}),i.jsxs("button",{onClick:m,className:"flex h-14 flex-1 items-center justify-center rounded-2xl bg-rose-600 text-sm font-semibold uppercase tracking-wide text-white shadow-2xl shadow-rose-900/40 sm:h-14 sm:flex-none sm:px-8",children:[i.jsx(pbe,{className:"mr-2 h-5 w-5"}),"Leave"]})]})]})]})]})}function LCe(){const r=Ns();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Privacy Policy"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Last updated: December 15, 2024"}),i.jsxs("div",{className:"prose prose-sm max-w-none text-[#495057]",children:[i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"1. Introduction"}),i.jsx("p",{className:"mb-4",children:'Welcome to FanMeet ("we," "our," or "us"). FanMeet is a platform that connects fans with their favorite creators through live video calls. We are committed to protecting your privacy and ensuring the security of your personal information.'}),i.jsx("p",{className:"mb-4",children:'This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our website and services located at fanmeet.live (the "Platform"). Please read this policy carefully. By using our Platform, you consent to the practices described in this Privacy Policy.'}),i.jsx("p",{children:"FanMeet is operated by FanMeet Technologies Private Limited, a company registered in India under the Companies Act, 2013."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"2. Information We Collect"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"2.1 Personal Information You Provide"}),i.jsxs("ul",{className:"mb-4 list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Account Information:"})," Name, email address, phone number, username, and password when you create an account."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Profile Information:"})," Profile photo, bio, social media links, and category preferences."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Payment Information:"})," Bank account details, UPI ID, and transaction history for processing payouts and refunds. We use Razorpay as our payment processor; your card details are never stored on our servers."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Identity Verification:"})," For creators, we may collect government-issued ID proof, PAN card details, and social media verification for KYC compliance."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Communication Data:"})," Messages, support tickets, and any correspondence with our team."]})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"2.2 Information Collected Automatically"}),i.jsxs("ul",{className:"mb-4 list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Device Information:"})," IP address, browser type, operating system, device identifiers."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Usage Data:"})," Pages visited, time spent on pages, click patterns, search queries."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Video Call Metadata:"})," Call duration, connection quality metrics (video content is NOT recorded or stored)."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Cookies and Tracking:"})," We use cookies and similar technologies for authentication, preferences, and analytics."]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"3. How We Use Your Information"}),i.jsx("p",{className:"mb-4",children:"We use the collected information for the following purposes:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Service Delivery:"})," To facilitate video calls between fans and creators, process bids, and manage event scheduling."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Payment Processing:"})," To process payments, refunds, and creator payouts through our payment partners."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Account Management:"})," To create and manage your account, verify your identity, and maintain security."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Communication:"})," To send transactional emails, event reminders, bid updates, and customer support responses."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Platform Improvement:"})," To analyze usage patterns, fix bugs, and improve our services."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Legal Compliance:"})," To comply with applicable laws, regulations, and legal processes in India."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fraud Prevention:"})," To detect and prevent fraudulent activities, abuse, and security threats."]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"4. Information Sharing and Disclosure"}),i.jsx("p",{className:"mb-4",children:"We do not sell your personal information. We may share your information in the following circumstances:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"With Creators/Fans:"})," Limited profile information is shared between parties for scheduled video calls (name, profile photo, username)."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Payment Processors:"})," We share necessary payment details with Razorpay for processing transactions."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Service Providers:"})," We work with trusted third parties for hosting (Supabase), video calls (Daily.co), and analytics who process data on our behalf."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Legal Requirements:"})," We may disclose information if required by law, court order, or government request in India."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Business Transfers:"})," In case of merger, acquisition, or sale of assets, user data may be transferred to the new entity."]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"5. Data Security"}),i.jsx("p",{className:"mb-4",children:"We implement robust security measures to protect your information:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"All data transmission is encrypted using SSL/TLS (HTTPS)."}),i.jsx("li",{children:"Payment processing is PCI-DSS compliant through Razorpay."}),i.jsx("li",{children:"Database access is restricted and monitored."}),i.jsx("li",{children:"Regular security audits and vulnerability assessments."}),i.jsx("li",{children:"Two-factor authentication available for accounts."})]}),i.jsx("p",{className:"mt-4",children:"While we strive to protect your information, no method of transmission over the Internet is 100% secure. We cannot guarantee absolute security."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"6. Data Retention"}),i.jsx("p",{className:"mb-4",children:"We retain your personal information for as long as necessary to:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Provide our services to you"}),i.jsx("li",{children:"Comply with legal obligations (tax records: 7 years as per Indian law)"}),i.jsx("li",{children:"Resolve disputes and enforce agreements"}),i.jsx("li",{children:"Maintain business records"})]}),i.jsx("p",{className:"mt-4",children:"You may request deletion of your account and associated data at any time, subject to legal retention requirements."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"7. Your Rights"}),i.jsx("p",{className:"mb-4",children:"Under applicable Indian data protection laws, you have the right to:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Access:"})," Request a copy of the personal data we hold about you."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Correction:"})," Request correction of inaccurate or incomplete data."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Deletion:"})," Request deletion of your personal data (subject to legal requirements)."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Portability:"})," Request your data in a portable format."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Withdraw Consent:"})," Withdraw consent for data processing where applicable."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Opt-out:"})," Unsubscribe from marketing communications at any time."]})]}),i.jsx("p",{className:"mt-4",children:"To exercise these rights, contact us at privacy@fanmeet.live or through our support portal."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"8. Cookies Policy"}),i.jsx("p",{className:"mb-4",children:"We use the following types of cookies:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Essential Cookies:"})," Required for authentication and basic platform functionality."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Functional Cookies:"})," Remember your preferences and settings."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Analytics Cookies:"})," Help us understand how users interact with our Platform."]})]}),i.jsx("p",{className:"mt-4",children:"You can manage cookie preferences through your browser settings. Disabling essential cookies may affect Platform functionality."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"9. Children's Privacy"}),i.jsx("p",{children:"FanMeet is not intended for users under 18 years of age. We do not knowingly collect personal information from children. If we become aware that we have collected data from a minor, we will take steps to delete it promptly."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"10. Changes to This Policy"}),i.jsx("p",{children:'We may update this Privacy Policy from time to time. We will notify you of any material changes by posting the updated policy on this page with a new "Last updated" date. Your continued use of the Platform after changes constitutes acceptance of the updated policy.'})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"11. Contact Us"}),i.jsx("p",{className:"mb-4",children:"If you have questions about this Privacy Policy or our data practices, please contact us:"}),i.jsxs("div",{className:"rounded-lg bg-[#F8F9FA] p-4",children:[i.jsx("p",{className:"font-medium text-[#212529]",children:"FanMeet Technologies Private Limited"}),i.jsx("p",{children:"Email: privacy@fanmeet.live"}),i.jsx("p",{children:"Support: support@fanmeet.live"}),i.jsx("p",{children:"Address: Bangalore, Karnataka, India"})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"12. Grievance Officer"}),i.jsx("p",{className:"mb-4",children:"In accordance with the Information Technology Act, 2000 and rules made thereunder, the name and contact details of the Grievance Officer are provided below:"}),i.jsxs("div",{className:"rounded-lg bg-[#F8F9FA] p-4",children:[i.jsx("p",{className:"font-medium text-[#212529]",children:"Grievance Officer"}),i.jsx("p",{children:"Name: FanMeet Support Team"}),i.jsx("p",{children:"Email: grievance@fanmeet.live"}),i.jsx("p",{children:"Response Time: Within 24 hours of receipt"})]})]})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}function MCe(){const r=Ns();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Terms of Service"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Last updated: December 15, 2024"}),i.jsxs("div",{className:"prose prose-sm max-w-none text-[#495057]",children:[i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"1. Acceptance of Terms"}),i.jsx("p",{className:"mb-4",children:'Welcome to FanMeet! These Terms of Service ("Terms") constitute a legally binding agreement between you and FanMeet Technologies Private Limited ("FanMeet," "we," "our," or "us") governing your use of the FanMeet platform, website, and services (collectively, the "Platform").'}),i.jsx("p",{className:"mb-4",children:"By creating an account, accessing, or using our Platform, you acknowledge that you have read, understood, and agree to be bound by these Terms. If you do not agree to these Terms, please do not use our Platform."}),i.jsx("p",{children:"We reserve the right to modify these Terms at any time. Changes will be effective upon posting to the Platform. Your continued use after changes constitutes acceptance of the modified Terms."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"2. Eligibility"}),i.jsx("p",{className:"mb-4",children:"To use FanMeet, you must:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Be at least 18 years of age"}),i.jsx("li",{children:"Be a resident of India (currently, FanMeet operates only in India)"}),i.jsx("li",{children:"Have the legal capacity to enter into a binding agreement"}),i.jsx("li",{children:"Not be prohibited from using the Platform under applicable laws"}),i.jsx("li",{children:"Provide accurate and complete registration information"})]}),i.jsx("p",{className:"mt-4",children:"By using the Platform, you represent and warrant that you meet all eligibility requirements."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"3. Account Registration"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"3.1 Account Creation"}),i.jsx("p",{className:"mb-4",children:"You must create an account to access most features of the Platform. You agree to provide accurate, current, and complete information during registration and keep your account information updated."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"3.2 Account Security"}),i.jsx("p",{className:"mb-4",children:"You are responsible for maintaining the confidentiality of your login credentials and for all activities under your account. Notify us immediately of any unauthorized access or security breach."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"3.3 Account Types"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Fan Account:"})," For users who want to participate in events and connect with creators."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Creator Account:"})," For content creators who want to host events and meet their fans. Creator accounts require additional verification and approval."]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"4. Platform Services"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"4.1 How FanMeet Works"}),i.jsx("p",{className:"mb-4",children:"FanMeet is a marketplace that facilitates live video calls between fans and creators through an auction-based system:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2 mb-4",children:[i.jsx("li",{children:"Creators list events with specified time slots and base prices"}),i.jsx("li",{children:"Fans place bids to win video call opportunities"}),i.jsx("li",{children:"The highest bidder wins the call when the bidding period ends"}),i.jsx("li",{children:"Non-winning bidders receive automatic refunds (90% of bid amount)"}),i.jsx("li",{children:"Video calls are conducted through our integrated video platform"})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"4.2 Free Events"}),i.jsx("p",{children:"Some creators may offer free events where winners are selected through a random draw. No payment is required for entry into free events."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"5. Bidding and Payments"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"5.1 Bidding Rules"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2 mb-4",children:[i.jsx("li",{children:"All bids are binding commitments to pay if you win"}),i.jsx("li",{children:"Bids cannot be cancelled or withdrawn once placed"}),i.jsx("li",{children:"The bid amount is charged immediately upon placement"}),i.jsx("li",{children:"Multiple bids on the same event are allowed (only your highest bid counts)"}),i.jsx("li",{children:"Minimum bid amounts are set by creators (starting from 50 or 100)"})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"5.2 Payment Processing"}),i.jsx("p",{className:"mb-4",children:"All payments are processed securely through Razorpay, our authorized payment gateway. We accept UPI, credit cards, debit cards, and net banking. By making a payment, you agree to Razorpay's terms of service."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"5.3 Platform Fee"}),i.jsx("p",{children:"FanMeet charges a 10% platform fee on successful transactions. Creators receive 90% of the winning bid amount. This fee covers payment processing, platform maintenance, and support services."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"6. Refund Policy"}),i.jsxs("p",{className:"mb-4",children:["Please refer to our detailed ",i.jsx("a",{href:"/refund-policy",className:"text-[#C045FF] underline",children:"Refund Policy"})," for complete information. Key points include:"]}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Non-Winning Bids:"})," 90% refund processed automatically within 5-7 business days"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Creator Cancellation:"})," 100% refund if the creator cancels the event"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Technical Issues:"})," 100% refund or reschedule for platform-caused technical failures"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"No-Show by Creator:"})," 100% refund if the creator fails to attend"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"10% Processing Fee:"})," Retained on non-winning bids to cover payment gateway charges"]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"7. Creator Terms"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"7.1 Creator Eligibility"}),i.jsx("p",{className:"mb-4",children:"To become a creator on FanMeet, you must:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2 mb-4",children:[i.jsx("li",{children:"Have a minimum of 1,000 followers on any social media platform, OR"}),i.jsx("li",{children:"Demonstrate a unique skill or expertise that fans would pay to learn about"}),i.jsx("li",{children:"Complete identity verification (KYC) process"}),i.jsx("li",{children:"Provide valid bank account or UPI details for payouts"}),i.jsx("li",{children:"Receive approval from our team"})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"7.2 Creator Responsibilities"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2 mb-4",children:[i.jsx("li",{children:"Attend all scheduled video calls on time"}),i.jsx("li",{children:"Maintain professional and respectful conduct during calls"}),i.jsx("li",{children:"Not engage in any illegal, inappropriate, or harmful activities"}),i.jsx("li",{children:"Not solicit fans to transact outside the Platform"}),i.jsx("li",{children:"Respond to fan messages within reasonable timeframes"})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"7.3 Payouts"}),i.jsx("p",{children:"Creator earnings (90% of winning bids) are available for withdrawal 48 hours after successful event completion. Payouts are processed within 2-3 business days via bank transfer or UPI."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"8. User Conduct"}),i.jsx("p",{className:"mb-4",children:"You agree NOT to:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Use the Platform for any illegal purpose or in violation of any laws"}),i.jsx("li",{children:"Harass, abuse, threaten, or intimidate other users or creators"}),i.jsx("li",{children:"Share explicit, obscene, or inappropriate content during video calls"}),i.jsx("li",{children:"Impersonate any person or entity, or falsely represent your affiliation"}),i.jsx("li",{children:"Attempt to manipulate bidding through fake accounts or collusion"}),i.jsx("li",{children:"Record, screenshot, or distribute video call content without consent"}),i.jsx("li",{children:"Circumvent the Platform to arrange direct transactions with creators"}),i.jsx("li",{children:"Use bots, scripts, or automated tools to interact with the Platform"}),i.jsx("li",{children:"Interfere with or disrupt the Platform's security or functionality"}),i.jsx("li",{children:"Upload viruses, malware, or other harmful code"})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"9. Intellectual Property"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"9.1 FanMeet's IP"}),i.jsx("p",{className:"mb-4",children:"The Platform, including its design, features, content, and code, is owned by FanMeet and protected by intellectual property laws. You may not copy, modify, distribute, or create derivative works without our written permission."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"9.2 User Content"}),i.jsx("p",{children:"You retain ownership of content you create. By posting content on FanMeet, you grant us a non-exclusive, worldwide, royalty-free license to use, display, and distribute such content for Platform operation and promotion."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"10. Disclaimers"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:'The Platform is provided "as is" without warranties of any kind'}),i.jsx("li",{children:"We do not guarantee continuous, uninterrupted, or error-free service"}),i.jsx("li",{children:"We are not responsible for the conduct of creators or fans during video calls"}),i.jsx("li",{children:"We do not endorse or verify the accuracy of creator claims or content"}),i.jsx("li",{children:"Video call quality depends on participants' internet connections"})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"11. Limitation of Liability"}),i.jsx("p",{className:"mb-4",children:"To the maximum extent permitted by law, FanMeet shall not be liable for any indirect, incidental, special, consequential, or punitive damages, including loss of profits, data, or goodwill, arising from:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Your use or inability to use the Platform"}),i.jsx("li",{children:"Any conduct or content of third parties on the Platform"}),i.jsx("li",{children:"Unauthorized access to your account or data"}),i.jsx("li",{children:"Technical failures or service interruptions"})]}),i.jsx("p",{className:"mt-4",children:"Our total liability shall not exceed the amount you paid to FanMeet in the 12 months preceding the claim."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"12. Indemnification"}),i.jsx("p",{children:"You agree to indemnify and hold harmless FanMeet, its officers, directors, employees, and agents from any claims, damages, losses, or expenses arising from your use of the Platform, violation of these Terms, or infringement of any third-party rights."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"13. Termination"}),i.jsx("p",{className:"mb-4",children:"We may suspend or terminate your account at our discretion, with or without notice, for:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Violation of these Terms"}),i.jsx("li",{children:"Fraudulent or illegal activity"}),i.jsx("li",{children:"Harmful conduct towards other users"}),i.jsx("li",{children:"Extended inactivity"}),i.jsx("li",{children:"Any other reason we deem appropriate"})]}),i.jsx("p",{className:"mt-4",children:"You may close your account at any time through account settings. Upon termination, your right to use the Platform ceases immediately. Pending payouts will be processed according to our policies."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"14. Dispute Resolution"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"14.1 Governing Law"}),i.jsx("p",{className:"mb-4",children:"These Terms are governed by the laws of India. Any disputes shall be subject to the exclusive jurisdiction of the courts in Bangalore, Karnataka."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"14.2 Informal Resolution"}),i.jsx("p",{children:"Before initiating formal proceedings, you agree to contact us at support@fanmeet.live to attempt to resolve any dispute informally within 30 days."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"15. General Provisions"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Entire Agreement:"})," These Terms constitute the entire agreement between you and FanMeet."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Severability:"})," If any provision is found unenforceable, the remaining provisions remain in effect."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Waiver:"})," Our failure to enforce any right does not constitute a waiver of that right."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Assignment:"})," You may not assign your rights under these Terms without our consent."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"16. Contact Information"}),i.jsx("p",{className:"mb-4",children:"For questions about these Terms, please contact us:"}),i.jsxs("div",{className:"rounded-lg bg-[#F8F9FA] p-4",children:[i.jsx("p",{className:"font-medium text-[#212529]",children:"FanMeet Technologies Private Limited"}),i.jsx("p",{children:"Email: legal@fanmeet.live"}),i.jsx("p",{children:"Support: support@fanmeet.live"}),i.jsx("p",{children:"Address: Bangalore, Karnataka, India"})]})]})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}function FCe(){const r=Ns();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Refund Policy"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Last updated: December 15, 2024"}),i.jsxs("div",{className:"space-y-8 text-sm text-[#495057]",children:[i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"1. Overview"}),i.jsx("p",{children:"FanMeet runs paid creator events using bidding (auction-style). To make bidding low-risk, we provide automatic refunds for non-winning bids and full refunds in specific failure cases."})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"2. Refund Cases"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"A) You do not win the bid  90% refund"}),i.jsxs("div",{className:"mt-1",children:["If you placed a bid but did not win, we automatically refund ",i.jsx("strong",{children:"90%"})," of your bid amount. The remaining 10% covers payment gateway and processing costs."]})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"B) Creator cancels the event  100% refund"}),i.jsx("div",{className:"mt-1",children:"All bidders receive a full refund if the creator cancels the event."})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"C) Creator no-show  100% refund (winner)"}),i.jsx("div",{className:"mt-1",children:"If the creator does not join at the scheduled time, the event winner gets a full refund."})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"D) Platform technical failure  100% refund or reschedule"}),i.jsx("div",{className:"mt-1",children:"If the call fails due to FanMeet platform issues, we may provide either a full refund or a rescheduled call."})]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"3. Non-Refundable Cases"}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Winner completed the call successfully:"})," no refund."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fan no-show:"})," if you win but do not join, the payment is not refundable."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fan-side connectivity/device issues:"})," issues caused by your internet/device are not refundable."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Policy violations:"})," abusive or prohibited conduct can void eligibility."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"4. Processing Time"}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsx("li",{children:"Refunds are typically initiated within 24-48 hours after eligibility is confirmed."}),i.jsx("li",{children:"Bank/payment providers may take 5-7 business days to complete the refund."}),i.jsx("li",{children:"Refunds are always sent to the original payment method."})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"5. Contact"}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"Need help with a refund?"}),i.jsx("div",{className:"mt-1",children:"Email: support@fanmeet.live"})]})]})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}function UCe(){const r=Ns();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Cancellation & Rescheduling Policy"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Last updated: December 15, 2024"}),i.jsxs("div",{className:"space-y-8 text-sm text-[#495057]",children:[i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"1. Overview"}),i.jsx("p",{children:"FanMeet events are scheduled, time-bound live video calls. Because creators block time and fans bid for limited slots, cancellations and reschedules are handled with clear rules to protect both sides."})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"2. Creator Cancellations"}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Creator cancels before the event:"})," all bidders receive a 100% refund."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Creator no-show:"})," the winner receives a 100% refund and the creator account may be reviewed."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Repeated cancellations/no-shows:"})," may lead to suspension or removal from the Platform."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"3. Fan Cancellations"}),i.jsx("p",{className:"mb-3",children:"Bids are commitments. Once you place a bid, you cannot cancel it because it impacts the auction and other bidders."}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Non-winning bids:"})," automatically get 90% refund as per Refund Policy."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Winning bids:"})," are not refundable if the call is successfully completed."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fan no-show:"})," if you win but do not join the call, the payment is not refundable."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"4. Rescheduling"}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Platform-side technical issue:"})," we may offer rescheduling or a 100% refund."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Creator requests reschedule:"})," we may reschedule with winner consent; otherwise, a 100% refund is processed."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fan requests reschedule:"})," not guaranteed and handled case-by-case through support."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"5. How to Request Support"}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"Need help?"}),i.jsx("div",{className:"mt-1",children:"Email: support@fanmeet.live"})]})]})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}function VCe(){const r=Ns();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Contact Us"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Need help? We respond fast. Use the details below to reach FanMeet support."}),i.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Support"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Email: support@fanmeet.live"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"Response time: within 24 hours"})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Business / Partnerships"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Email: partners@fanmeet.live"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"For brands and creators onboarding"})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Legal"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Email: legal@fanmeet.live"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"Privacy & policy requests"})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Registered Office"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Bangalore, Karnataka, India"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"(Address can be updated once finalized)"})]})]}),i.jsxs("div",{className:"mt-8 rounded-xl border border-[#E9ECEF] bg-white p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Grievance Officer (India)"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Email: grievance@fanmeet.live"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"We acknowledge complaints within 24 hours."})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}const DN=({allowedRoles:r,children:n})=>{const{isAuthenticated:o,user:l,isLoading:u}=vs(),m=Ac();if(u)return null;if(!o||!l){const g=encodeURIComponent(m.pathname+m.search);return i.jsx(ep,{to:`/auth?redirect=${g}`,replace:!0})}if(r&&!r.includes(l.role)){const g={fan:"/fan",creator:"/creator",admin:"/admin"};return i.jsx(ep,{to:g[l.role],replace:!0})}return i.jsx(i.Fragment,{children:n})},BCe=()=>i.jsx("div",{className:"flex h-full w-full items-center justify-center",children:i.jsxs("div",{className:"flex flex-col items-center gap-3 text-[#6C757D]",children:[i.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-[#FFE5D9] border-l-[#FF6B35]"}),i.jsx("span",{children:"Loading"})]})});function WCe(){return i.jsx(O.Suspense,{fallback:i.jsx(BCe,{}),children:i.jsx(Nfe,{children:i.jsx(qbe,{children:i.jsx(Kwe,{children:i.jsx(Dfe,{children:i.jsxs(Zhe,{children:[i.jsx(at,{path:"meet/:meetId",element:i.jsx(ICe,{})}),i.jsxs(at,{element:i.jsx(Ife,{}),children:[i.jsx(at,{index:!0,element:i.jsx(Ube,{})}),i.jsx(at,{path:"auth",element:i.jsx(Bbe,{})}),i.jsx(at,{path:"auth/forgot-password",element:i.jsx(Wbe,{})}),i.jsx(at,{path:"auth/update-password",element:i.jsx(Gbe,{})}),i.jsx(at,{path:"auth/callback",element:i.jsx(Hbe,{})}),i.jsx(at,{path:"fanmeet/admin/superadmin",element:i.jsx(zbe,{})}),i.jsx(at,{path:"browse-events",element:i.jsx(Ybe,{})}),i.jsx(at,{path:"how-it-works",element:i.jsx($be,{})}),i.jsx(at,{path:"for-creators",element:i.jsx(Jbe,{})}),i.jsx(at,{path:"pricing",element:i.jsx(Qbe,{})}),i.jsx(at,{path:"faq",element:i.jsx(ewe,{})}),i.jsx(at,{path:"free-events",element:i.jsx(twe,{})}),i.jsx(at,{path:"apply",element:i.jsx(swe,{})}),i.jsx(at,{path:"creator-guide",element:i.jsx(rwe,{})}),i.jsx(at,{path:"earnings-calculator",element:i.jsx(nwe,{})}),i.jsx(at,{path:"success-stories",element:i.jsx(awe,{})}),i.jsx(at,{path:"about",element:i.jsx(owe,{})}),i.jsx(at,{path:"team",element:i.jsx(lwe,{})}),i.jsx(at,{path:"press",element:i.jsx(uwe,{})}),i.jsx(at,{path:"careers",element:i.jsx(pwe,{})}),i.jsx(at,{path:"blog",element:i.jsx(fwe,{})}),i.jsx(at,{path:"help-center",element:i.jsx(_we,{})}),i.jsx(at,{path:"privacy-policy",element:i.jsx(LCe,{})}),i.jsx(at,{path:"terms-of-service",element:i.jsx(MCe,{})}),i.jsx(at,{path:"refund-policy",element:i.jsx(FCe,{})}),i.jsx(at,{path:"cancellation-policy",element:i.jsx(UCe,{})}),i.jsx(at,{path:"contact",element:i.jsx(VCe,{})}),i.jsx(at,{path:"events/:eventId",element:i.jsx(W0e,{})}),i.jsx(at,{path:":username",element:i.jsx(M0e,{})})]}),i.jsxs(at,{path:"fan",element:i.jsx(DN,{allowedRoles:["fan"],children:i.jsx(cN,{role:"fan"})}),children:[i.jsx(at,{index:!0,element:i.jsx(ywe,{})}),i.jsx(at,{path:"all-events",element:i.jsx(Mwe,{})}),i.jsx(at,{path:"bids",element:i.jsx(xwe,{})}),i.jsx(at,{path:"meets",element:i.jsx(wwe,{})}),i.jsx(at,{path:"wallet",element:i.jsx(Swe,{})}),i.jsx(at,{path:"following",element:i.jsx(Cwe,{})}),i.jsx(at,{path:"history",element:i.jsx(Nwe,{})}),i.jsx(at,{path:"messages",element:i.jsx(Owe,{})}),i.jsx(at,{path:"notifications",element:i.jsx(Rwe,{})}),i.jsx(at,{path:"settings",element:i.jsx(Awe,{})}),i.jsx(at,{path:"support",element:i.jsx(Pwe,{})}),i.jsx(at,{path:"*",element:i.jsx(ep,{to:".",replace:!0})})]}),i.jsxs(at,{path:"creator",element:i.jsx(DN,{allowedRoles:["creator"],children:i.jsx(cN,{role:"creator"})}),children:[i.jsx(at,{index:!0,element:i.jsx(Vwe,{})}),i.jsx(at,{path:"events",element:i.jsx(Bwe,{})}),i.jsx(at,{path:"events/new",element:i.jsx(Hwe,{})}),i.jsx(at,{path:"profile-setup",element:i.jsx(qwe,{})}),i.jsx(at,{path:"earnings",element:i.jsx(Xwe,{})}),i.jsx(at,{path:"withdrawals",element:i.jsx(tSe,{})}),i.jsx(at,{path:"meets",element:i.jsx(nSe,{})}),i.jsx(at,{path:"followers",element:i.jsx(iSe,{})}),i.jsx(at,{path:"messages",element:i.jsx(FSe,{})}),i.jsx(at,{path:"notifications",element:i.jsx(aSe,{})}),i.jsx(at,{path:"settings",element:i.jsx(cSe,{})}),i.jsx(at,{path:"support",element:i.jsx(VSe,{})}),i.jsx(at,{path:"*",element:i.jsx(ep,{to:".",replace:!0})})]}),i.jsxs(at,{path:"admin",element:i.jsx(DN,{allowedRoles:["admin"],children:i.jsx(cN,{role:"admin"})}),children:[i.jsx(at,{index:!0,element:i.jsx(BSe,{})}),i.jsx(at,{path:"users",element:i.jsx(HSe,{})}),i.jsx(at,{path:"creators",element:i.jsx(KSe,{})}),i.jsx(at,{path:"fans",element:i.jsx(YSe,{})}),i.jsx(at,{path:"events",element:i.jsx(XSe,{})}),i.jsx(at,{path:"featured",element:i.jsx(JSe,{})}),i.jsx(at,{path:"announcements",element:i.jsx(ZSe,{})}),i.jsx(at,{path:"payments",element:i.jsx(t0e,{})}),i.jsx(at,{path:"withdrawals",element:i.jsx(s0e,{})}),i.jsx(at,{path:"refunds",element:i.jsx(n0e,{})}),i.jsx(at,{path:"revenue-analytics",element:i.jsx(i0e,{})}),i.jsx(at,{path:"platform-commission",element:i.jsx(a0e,{})}),i.jsx(at,{path:"business-analytics",element:i.jsx(o0e,{})}),i.jsx(at,{path:"user-analytics",element:i.jsx(c0e,{})}),i.jsx(at,{path:"revenue-reports",element:i.jsx(l0e,{})}),i.jsx(at,{path:"event-analytics",element:i.jsx(d0e,{})}),i.jsx(at,{path:"audit-logs",element:i.jsx(h0e,{})}),i.jsx(at,{path:"support-tickets",element:i.jsx(f0e,{})}),i.jsx(at,{path:"reports-flags",element:i.jsx(_0e,{})}),i.jsx(at,{path:"disputes",element:i.jsx(E0e,{})}),i.jsx(at,{path:"settings/general",element:i.jsx(y0e,{})}),i.jsx(at,{path:"settings/pricing",element:i.jsx(x0e,{})}),i.jsx(at,{path:"settings/email-templates",element:i.jsx(w0e,{})}),i.jsx(at,{path:"settings/notifications",element:i.jsx(T0e,{})}),i.jsx(at,{path:"settings/security",element:i.jsx(N0e,{})}),i.jsx(at,{path:"system/logs",element:i.jsx(R0e,{})}),i.jsx(at,{path:"system/bulk-actions",element:i.jsx(I0e,{})}),i.jsx(at,{path:"system/backup",element:i.jsx(D0e,{})}),i.jsx(at,{path:"debug/meets",element:i.jsx(k0e,{})}),i.jsx(at,{path:"meeting-logs",element:i.jsx(L0e,{})}),i.jsx(at,{path:"profile",element:i.jsx(P0e,{})}),i.jsx(at,{path:"*",element:i.jsx(ep,{to:".",replace:!0})})]}),i.jsx(at,{path:"*",element:i.jsx(ep,{to:"/",replace:!0})})]})})})})})})}const GCe=new ohe;ON.createRoot(document.getElementById("root")).render(i.jsx(uA.StrictMode,{children:i.jsx(lhe,{client:GCe,children:i.jsx(cpe,{children:i.jsx(WCe,{})})})}));export{W7 as g};
