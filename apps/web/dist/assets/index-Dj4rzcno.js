var rle=Object.defineProperty;var J3=s=>{throw TypeError(s)};var sle=(s,n,a)=>n in s?rle(s,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[n]=a;var Tm=(s,n,a)=>sle(s,typeof n!="symbol"?n+"":n,a),CT=(s,n,a)=>n.has(s)||J3("Cannot "+a);var qe=(s,n,a)=>(CT(s,n,"read from private field"),a?a.call(s):n.get(s)),Lr=(s,n,a)=>n.has(s)?J3("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(s):n.set(s,a),sr=(s,n,a,l)=>(CT(s,n,"write to private field"),l?l.call(s,a):n.set(s,a),a),Tn=(s,n,a)=>(CT(s,n,"access private method"),a);var ry=(s,n,a,l)=>({set _(u){sr(s,n,u,a)},get _(){return qe(s,n,l)}});function nle(s,n){for(var a=0;a<n.length;a++){const l=n[a];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in s)){const f=Object.getOwnPropertyDescriptor(l,u);f&&Object.defineProperty(s,u,f.get?f:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function a(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function l(u){if(u.ep)return;u.ep=!0;const f=a(u);fetch(u.href,f)}})();var ba=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function k7(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function ile(s){if(s.__esModule)return s;var n=s.default;if(typeof n=="function"){var a=function l(){return this instanceof l?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};a.prototype=n.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(s).forEach(function(l){var u=Object.getOwnPropertyDescriptor(s,l);Object.defineProperty(a,l,u.get?u:{enumerable:!0,get:function(){return s[l]}})}),a}var j7={exports:{}},Px={},L7={exports:{}},fr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gg=Symbol.for("react.element"),ale=Symbol.for("react.portal"),ole=Symbol.for("react.fragment"),cle=Symbol.for("react.strict_mode"),lle=Symbol.for("react.profiler"),dle=Symbol.for("react.provider"),ule=Symbol.for("react.context"),hle=Symbol.for("react.forward_ref"),ple=Symbol.for("react.suspense"),fle=Symbol.for("react.memo"),mle=Symbol.for("react.lazy"),Q3=Symbol.iterator;function gle(s){return s===null||typeof s!="object"?null:(s=Q3&&s[Q3]||s["@@iterator"],typeof s=="function"?s:null)}var M7={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},F7=Object.assign,U7={};function Up(s,n,a){this.props=s,this.context=n,this.refs=U7,this.updater=a||M7}Up.prototype.isReactComponent={};Up.prototype.setState=function(s,n){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,n,"setState")};Up.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function V7(){}V7.prototype=Up.prototype;function aA(s,n,a){this.props=s,this.context=n,this.refs=U7,this.updater=a||M7}var oA=aA.prototype=new V7;oA.constructor=aA;F7(oA,Up.prototype);oA.isPureReactComponent=!0;var Z3=Array.isArray,B7=Object.prototype.hasOwnProperty,cA={current:null},W7={key:!0,ref:!0,__self:!0,__source:!0};function G7(s,n,a){var l,u={},f=null,g=null;if(n!=null)for(l in n.ref!==void 0&&(g=n.ref),n.key!==void 0&&(f=""+n.key),n)B7.call(n,l)&&!W7.hasOwnProperty(l)&&(u[l]=n[l]);var v=arguments.length-2;if(v===1)u.children=a;else if(1<v){for(var y=Array(v),w=0;w<v;w++)y[w]=arguments[w+2];u.children=y}if(s&&s.defaultProps)for(l in v=s.defaultProps,v)u[l]===void 0&&(u[l]=v[l]);return{$$typeof:Gg,type:s,key:f,ref:g,props:u,_owner:cA.current}}function _le(s,n){return{$$typeof:Gg,type:s.type,key:n,ref:s.ref,props:s.props,_owner:s._owner}}function lA(s){return typeof s=="object"&&s!==null&&s.$$typeof===Gg}function Ele(s){var n={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(a){return n[a]})}var e4=/\/+/g;function TT(s,n){return typeof s=="object"&&s!==null&&s.key!=null?Ele(""+s.key):n.toString(36)}function Dy(s,n,a,l,u){var f=typeof s;(f==="undefined"||f==="boolean")&&(s=null);var g=!1;if(s===null)g=!0;else switch(f){case"string":case"number":g=!0;break;case"object":switch(s.$$typeof){case Gg:case ale:g=!0}}if(g)return g=s,u=u(g),s=l===""?"."+TT(g,0):l,Z3(u)?(a="",s!=null&&(a=s.replace(e4,"$&/")+"/"),Dy(u,n,a,"",function(w){return w})):u!=null&&(lA(u)&&(u=_le(u,a+(!u.key||g&&g.key===u.key?"":(""+u.key).replace(e4,"$&/")+"/")+s)),n.push(u)),1;if(g=0,l=l===""?".":l+":",Z3(s))for(var v=0;v<s.length;v++){f=s[v];var y=l+TT(f,v);g+=Dy(f,n,a,y,u)}else if(y=gle(s),typeof y=="function")for(s=y.call(s),v=0;!(f=s.next()).done;)f=f.value,y=l+TT(f,v++),g+=Dy(f,n,a,y,u);else if(f==="object")throw n=String(s),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return g}function sy(s,n,a){if(s==null)return s;var l=[],u=0;return Dy(s,l,"","",function(f){return n.call(a,f,u++)}),l}function vle(s){if(s._status===-1){var n=s._result;n=n(),n.then(function(a){(s._status===0||s._status===-1)&&(s._status=1,s._result=a)},function(a){(s._status===0||s._status===-1)&&(s._status=2,s._result=a)}),s._status===-1&&(s._status=0,s._result=n)}if(s._status===1)return s._result.default;throw s._result}var qn={current:null},Py={transition:null},yle={ReactCurrentDispatcher:qn,ReactCurrentBatchConfig:Py,ReactCurrentOwner:cA};function H7(){throw Error("act(...) is not supported in production builds of React.")}fr.Children={map:sy,forEach:function(s,n,a){sy(s,function(){n.apply(this,arguments)},a)},count:function(s){var n=0;return sy(s,function(){n++}),n},toArray:function(s){return sy(s,function(n){return n})||[]},only:function(s){if(!lA(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};fr.Component=Up;fr.Fragment=ole;fr.Profiler=lle;fr.PureComponent=aA;fr.StrictMode=cle;fr.Suspense=ple;fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yle;fr.act=H7;fr.cloneElement=function(s,n,a){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var l=F7({},s.props),u=s.key,f=s.ref,g=s._owner;if(n!=null){if(n.ref!==void 0&&(f=n.ref,g=cA.current),n.key!==void 0&&(u=""+n.key),s.type&&s.type.defaultProps)var v=s.type.defaultProps;for(y in n)B7.call(n,y)&&!W7.hasOwnProperty(y)&&(l[y]=n[y]===void 0&&v!==void 0?v[y]:n[y])}var y=arguments.length-2;if(y===1)l.children=a;else if(1<y){v=Array(y);for(var w=0;w<y;w++)v[w]=arguments[w+2];l.children=v}return{$$typeof:Gg,type:s.type,key:u,ref:f,props:l,_owner:g}};fr.createContext=function(s){return s={$$typeof:ule,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:dle,_context:s},s.Consumer=s};fr.createElement=G7;fr.createFactory=function(s){var n=G7.bind(null,s);return n.type=s,n};fr.createRef=function(){return{current:null}};fr.forwardRef=function(s){return{$$typeof:hle,render:s}};fr.isValidElement=lA;fr.lazy=function(s){return{$$typeof:mle,_payload:{_status:-1,_result:s},_init:vle}};fr.memo=function(s,n){return{$$typeof:fle,type:s,compare:n===void 0?null:n}};fr.startTransition=function(s){var n=Py.transition;Py.transition={};try{s()}finally{Py.transition=n}};fr.unstable_act=H7;fr.useCallback=function(s,n){return qn.current.useCallback(s,n)};fr.useContext=function(s){return qn.current.useContext(s)};fr.useDebugValue=function(){};fr.useDeferredValue=function(s){return qn.current.useDeferredValue(s)};fr.useEffect=function(s,n){return qn.current.useEffect(s,n)};fr.useId=function(){return qn.current.useId()};fr.useImperativeHandle=function(s,n,a){return qn.current.useImperativeHandle(s,n,a)};fr.useInsertionEffect=function(s,n){return qn.current.useInsertionEffect(s,n)};fr.useLayoutEffect=function(s,n){return qn.current.useLayoutEffect(s,n)};fr.useMemo=function(s,n){return qn.current.useMemo(s,n)};fr.useReducer=function(s,n,a){return qn.current.useReducer(s,n,a)};fr.useRef=function(s){return qn.current.useRef(s)};fr.useState=function(s){return qn.current.useState(s)};fr.useSyncExternalStore=function(s,n,a){return qn.current.useSyncExternalStore(s,n,a)};fr.useTransition=function(){return qn.current.useTransition()};fr.version="18.3.1";L7.exports=fr;var L=L7.exports;const dA=k7(L),xle=nle({__proto__:null,default:dA},[L]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ble=L,wle=Symbol.for("react.element"),Sle=Symbol.for("react.fragment"),Cle=Object.prototype.hasOwnProperty,Tle=ble.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Rle={key:!0,ref:!0,__self:!0,__source:!0};function z7(s,n,a){var l,u={},f=null,g=null;a!==void 0&&(f=""+a),n.key!==void 0&&(f=""+n.key),n.ref!==void 0&&(g=n.ref);for(l in n)Cle.call(n,l)&&!Rle.hasOwnProperty(l)&&(u[l]=n[l]);if(s&&s.defaultProps)for(l in n=s.defaultProps,n)u[l]===void 0&&(u[l]=n[l]);return{$$typeof:wle,type:s,key:f,ref:g,props:u,_owner:Tle.current}}Px.Fragment=Sle;Px.jsx=z7;Px.jsxs=z7;j7.exports=Px;var o=j7.exports,DR={},K7={exports:{}},Vi={},q7={exports:{}},Y7={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function n(ae,Ee){var Le=ae.length;ae.push(Ee);e:for(;0<Le;){var Ke=Le-1>>>1,He=ae[Ke];if(0<u(He,Ee))ae[Ke]=Ee,ae[Le]=He,Le=Ke;else break e}}function a(ae){return ae.length===0?null:ae[0]}function l(ae){if(ae.length===0)return null;var Ee=ae[0],Le=ae.pop();if(Le!==Ee){ae[0]=Le;e:for(var Ke=0,He=ae.length,gt=He>>>1;Ke<gt;){var yt=2*(Ke+1)-1,It=ae[yt],Ct=yt+1,et=ae[Ct];if(0>u(It,Le))Ct<He&&0>u(et,It)?(ae[Ke]=et,ae[Ct]=Le,Ke=Ct):(ae[Ke]=It,ae[yt]=Le,Ke=yt);else if(Ct<He&&0>u(et,Le))ae[Ke]=et,ae[Ct]=Le,Ke=Ct;else break e}}return Ee}function u(ae,Ee){var Le=ae.sortIndex-Ee.sortIndex;return Le!==0?Le:ae.id-Ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;s.unstable_now=function(){return f.now()}}else{var g=Date,v=g.now();s.unstable_now=function(){return g.now()-v}}var y=[],w=[],T=1,S=null,I=3,j=!1,B=!1,A=!1,F=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function O(ae){for(var Ee=a(w);Ee!==null;){if(Ee.callback===null)l(w);else if(Ee.startTime<=ae)l(w),Ee.sortIndex=Ee.expirationTime,n(y,Ee);else break;Ee=a(w)}}function V(ae){if(A=!1,O(ae),!B)if(a(y)!==null)B=!0,Xe(G);else{var Ee=a(w);Ee!==null&&Oe(V,Ee.startTime-ae)}}function G(ae,Ee){B=!1,A&&(A=!1,D(q),q=-1),j=!0;var Le=I;try{for(O(Ee),S=a(y);S!==null&&(!(S.expirationTime>Ee)||ae&&!de());){var Ke=S.callback;if(typeof Ke=="function"){S.callback=null,I=S.priorityLevel;var He=Ke(S.expirationTime<=Ee);Ee=s.unstable_now(),typeof He=="function"?S.callback=He:S===a(y)&&l(y),O(Ee)}else l(y);S=a(y)}if(S!==null)var gt=!0;else{var yt=a(w);yt!==null&&Oe(V,yt.startTime-Ee),gt=!1}return gt}finally{S=null,I=Le,j=!1}}var J=!1,$=null,q=-1,ee=5,ne=-1;function de(){return!(s.unstable_now()-ne<ee)}function me(){if($!==null){var ae=s.unstable_now();ne=ae;var Ee=!0;try{Ee=$(!0,ae)}finally{Ee?ve():(J=!1,$=null)}}else J=!1}var ve;if(typeof R=="function")ve=function(){R(me)};else if(typeof MessageChannel<"u"){var _e=new MessageChannel,De=_e.port2;_e.port1.onmessage=me,ve=function(){De.postMessage(null)}}else ve=function(){F(me,0)};function Xe(ae){$=ae,J||(J=!0,ve())}function Oe(ae,Ee){q=F(function(){ae(s.unstable_now())},Ee)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(ae){ae.callback=null},s.unstable_continueExecution=function(){B||j||(B=!0,Xe(G))},s.unstable_forceFrameRate=function(ae){0>ae||125<ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<ae?Math.floor(1e3/ae):5},s.unstable_getCurrentPriorityLevel=function(){return I},s.unstable_getFirstCallbackNode=function(){return a(y)},s.unstable_next=function(ae){switch(I){case 1:case 2:case 3:var Ee=3;break;default:Ee=I}var Le=I;I=Ee;try{return ae()}finally{I=Le}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(ae,Ee){switch(ae){case 1:case 2:case 3:case 4:case 5:break;default:ae=3}var Le=I;I=ae;try{return Ee()}finally{I=Le}},s.unstable_scheduleCallback=function(ae,Ee,Le){var Ke=s.unstable_now();switch(typeof Le=="object"&&Le!==null?(Le=Le.delay,Le=typeof Le=="number"&&0<Le?Ke+Le:Ke):Le=Ke,ae){case 1:var He=-1;break;case 2:He=250;break;case 5:He=1073741823;break;case 4:He=1e4;break;default:He=5e3}return He=Le+He,ae={id:T++,callback:Ee,priorityLevel:ae,startTime:Le,expirationTime:He,sortIndex:-1},Le>Ke?(ae.sortIndex=Le,n(w,ae),a(y)===null&&ae===a(w)&&(A?(D(q),q=-1):A=!0,Oe(V,Le-Ke))):(ae.sortIndex=He,n(y,ae),B||j||(B=!0,Xe(G))),ae},s.unstable_shouldYield=de,s.unstable_wrapCallback=function(ae){var Ee=I;return function(){var Le=I;I=Ee;try{return ae.apply(this,arguments)}finally{I=Le}}}})(Y7);q7.exports=Y7;var Nle=q7.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ale=L,Ui=Nle;function Qe(s){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+s,a=1;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+s+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var $7=new Set,hg={};function du(s,n){Tp(s,n),Tp(s+"Capture",n)}function Tp(s,n){for(hg[s]=n,s=0;s<n.length;s++)$7.add(n[s])}var vc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),PR=Object.prototype.hasOwnProperty,Ile=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,t4={},r4={};function Ole(s){return PR.call(r4,s)?!0:PR.call(t4,s)?!1:Ile.test(s)?r4[s]=!0:(t4[s]=!0,!1)}function Dle(s,n,a,l){if(a!==null&&a.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return l?!1:a!==null?!a.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function Ple(s,n,a,l){if(n===null||typeof n>"u"||Dle(s,n,a,l))return!0;if(l)return!1;if(a!==null)switch(a.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Yn(s,n,a,l,u,f,g){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=l,this.attributeNamespace=u,this.mustUseProperty=a,this.propertyName=s,this.type=n,this.sanitizeURL=f,this.removeEmptyString=g}var _n={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){_n[s]=new Yn(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var n=s[0];_n[n]=new Yn(n,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){_n[s]=new Yn(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){_n[s]=new Yn(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){_n[s]=new Yn(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){_n[s]=new Yn(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){_n[s]=new Yn(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){_n[s]=new Yn(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){_n[s]=new Yn(s,5,!1,s.toLowerCase(),null,!1,!1)});var uA=/[\-:]([a-z])/g;function hA(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var n=s.replace(uA,hA);_n[n]=new Yn(n,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var n=s.replace(uA,hA);_n[n]=new Yn(n,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var n=s.replace(uA,hA);_n[n]=new Yn(n,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){_n[s]=new Yn(s,1,!1,s.toLowerCase(),null,!1,!1)});_n.xlinkHref=new Yn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){_n[s]=new Yn(s,1,!1,s.toLowerCase(),null,!0,!0)});function pA(s,n,a,l){var u=_n.hasOwnProperty(n)?_n[n]:null;(u!==null?u.type!==0:l||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(Ple(n,a,u,l)&&(a=null),l||u===null?Ole(n)&&(a===null?s.removeAttribute(n):s.setAttribute(n,""+a)):u.mustUseProperty?s[u.propertyName]=a===null?u.type===3?!1:"":a:(n=u.attributeName,l=u.attributeNamespace,a===null?s.removeAttribute(n):(u=u.type,a=u===3||u===4&&a===!0?"":""+a,l?s.setAttributeNS(l,n,a):s.setAttribute(n,a))))}var Sc=Ale.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ny=Symbol.for("react.element"),Hh=Symbol.for("react.portal"),zh=Symbol.for("react.fragment"),fA=Symbol.for("react.strict_mode"),kR=Symbol.for("react.profiler"),X7=Symbol.for("react.provider"),J7=Symbol.for("react.context"),mA=Symbol.for("react.forward_ref"),jR=Symbol.for("react.suspense"),LR=Symbol.for("react.suspense_list"),gA=Symbol.for("react.memo"),pl=Symbol.for("react.lazy"),Q7=Symbol.for("react.offscreen"),s4=Symbol.iterator;function Rm(s){return s===null||typeof s!="object"?null:(s=s4&&s[s4]||s["@@iterator"],typeof s=="function"?s:null)}var ys=Object.assign,RT;function Wm(s){if(RT===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);RT=n&&n[1]||""}return`
`+RT+s}var NT=!1;function AT(s,n){if(!s||NT)return"";NT=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(w){var l=w}Reflect.construct(s,[],n)}else{try{n.call()}catch(w){l=w}s.call(n.prototype)}else{try{throw Error()}catch(w){l=w}s()}}catch(w){if(w&&l&&typeof w.stack=="string"){for(var u=w.stack.split(`
`),f=l.stack.split(`
`),g=u.length-1,v=f.length-1;1<=g&&0<=v&&u[g]!==f[v];)v--;for(;1<=g&&0<=v;g--,v--)if(u[g]!==f[v]){if(g!==1||v!==1)do if(g--,v--,0>v||u[g]!==f[v]){var y=`
`+u[g].replace(" at new "," at ");return s.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",s.displayName)),y}while(1<=g&&0<=v);break}}}finally{NT=!1,Error.prepareStackTrace=a}return(s=s?s.displayName||s.name:"")?Wm(s):""}function kle(s){switch(s.tag){case 5:return Wm(s.type);case 16:return Wm("Lazy");case 13:return Wm("Suspense");case 19:return Wm("SuspenseList");case 0:case 2:case 15:return s=AT(s.type,!1),s;case 11:return s=AT(s.type.render,!1),s;case 1:return s=AT(s.type,!0),s;default:return""}}function MR(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case zh:return"Fragment";case Hh:return"Portal";case kR:return"Profiler";case fA:return"StrictMode";case jR:return"Suspense";case LR:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case J7:return(s.displayName||"Context")+".Consumer";case X7:return(s._context.displayName||"Context")+".Provider";case mA:var n=s.render;return s=s.displayName,s||(s=n.displayName||n.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case gA:return n=s.displayName||null,n!==null?n:MR(s.type)||"Memo";case pl:n=s._payload,s=s._init;try{return MR(s(n))}catch{}}return null}function jle(s){var n=s.type;switch(s.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=n.render,s=s.displayName||s.name||"",n.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return MR(n);case 8:return n===fA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Ml(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Z7(s){var n=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Lle(s){var n=Z7(s)?"checked":"value",a=Object.getOwnPropertyDescriptor(s.constructor.prototype,n),l=""+s[n];if(!s.hasOwnProperty(n)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var u=a.get,f=a.set;return Object.defineProperty(s,n,{configurable:!0,get:function(){return u.call(this)},set:function(g){l=""+g,f.call(this,g)}}),Object.defineProperty(s,n,{enumerable:a.enumerable}),{getValue:function(){return l},setValue:function(g){l=""+g},stopTracking:function(){s._valueTracker=null,delete s[n]}}}}function iy(s){s._valueTracker||(s._valueTracker=Lle(s))}function eW(s){if(!s)return!1;var n=s._valueTracker;if(!n)return!0;var a=n.getValue(),l="";return s&&(l=Z7(s)?s.checked?"true":"false":s.value),s=l,s!==a?(n.setValue(s),!0):!1}function Xy(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function FR(s,n){var a=n.checked;return ys({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??s._wrapperState.initialChecked})}function n4(s,n){var a=n.defaultValue==null?"":n.defaultValue,l=n.checked!=null?n.checked:n.defaultChecked;a=Ml(n.value!=null?n.value:a),s._wrapperState={initialChecked:l,initialValue:a,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function tW(s,n){n=n.checked,n!=null&&pA(s,"checked",n,!1)}function UR(s,n){tW(s,n);var a=Ml(n.value),l=n.type;if(a!=null)l==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+a):s.value!==""+a&&(s.value=""+a);else if(l==="submit"||l==="reset"){s.removeAttribute("value");return}n.hasOwnProperty("value")?VR(s,n.type,a):n.hasOwnProperty("defaultValue")&&VR(s,n.type,Ml(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(s.defaultChecked=!!n.defaultChecked)}function i4(s,n,a){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var l=n.type;if(!(l!=="submit"&&l!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+s._wrapperState.initialValue,a||n===s.value||(s.value=n),s.defaultValue=n}a=s.name,a!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,a!==""&&(s.name=a)}function VR(s,n,a){(n!=="number"||Xy(s.ownerDocument)!==s)&&(a==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+a&&(s.defaultValue=""+a))}var Gm=Array.isArray;function lp(s,n,a,l){if(s=s.options,n){n={};for(var u=0;u<a.length;u++)n["$"+a[u]]=!0;for(a=0;a<s.length;a++)u=n.hasOwnProperty("$"+s[a].value),s[a].selected!==u&&(s[a].selected=u),u&&l&&(s[a].defaultSelected=!0)}else{for(a=""+Ml(a),n=null,u=0;u<s.length;u++){if(s[u].value===a){s[u].selected=!0,l&&(s[u].defaultSelected=!0);return}n!==null||s[u].disabled||(n=s[u])}n!==null&&(n.selected=!0)}}function BR(s,n){if(n.dangerouslySetInnerHTML!=null)throw Error(Qe(91));return ys({},n,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function a4(s,n){var a=n.value;if(a==null){if(a=n.children,n=n.defaultValue,a!=null){if(n!=null)throw Error(Qe(92));if(Gm(a)){if(1<a.length)throw Error(Qe(93));a=a[0]}n=a}n==null&&(n=""),a=n}s._wrapperState={initialValue:Ml(a)}}function rW(s,n){var a=Ml(n.value),l=Ml(n.defaultValue);a!=null&&(a=""+a,a!==s.value&&(s.value=a),n.defaultValue==null&&s.defaultValue!==a&&(s.defaultValue=a)),l!=null&&(s.defaultValue=""+l)}function o4(s){var n=s.textContent;n===s._wrapperState.initialValue&&n!==""&&n!==null&&(s.value=n)}function sW(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function WR(s,n){return s==null||s==="http://www.w3.org/1999/xhtml"?sW(n):s==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var ay,nW=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,a,l,u){MSApp.execUnsafeLocalFunction(function(){return s(n,a,l,u)})}:s}(function(s,n){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=n;else{for(ay=ay||document.createElement("div"),ay.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=ay.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;n.firstChild;)s.appendChild(n.firstChild)}});function pg(s,n){if(n){var a=s.firstChild;if(a&&a===s.lastChild&&a.nodeType===3){a.nodeValue=n;return}}s.textContent=n}var $m={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Mle=["Webkit","ms","Moz","O"];Object.keys($m).forEach(function(s){Mle.forEach(function(n){n=n+s.charAt(0).toUpperCase()+s.substring(1),$m[n]=$m[s]})});function iW(s,n,a){return n==null||typeof n=="boolean"||n===""?"":a||typeof n!="number"||n===0||$m.hasOwnProperty(s)&&$m[s]?(""+n).trim():n+"px"}function aW(s,n){s=s.style;for(var a in n)if(n.hasOwnProperty(a)){var l=a.indexOf("--")===0,u=iW(a,n[a],l);a==="float"&&(a="cssFloat"),l?s.setProperty(a,u):s[a]=u}}var Fle=ys({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function GR(s,n){if(n){if(Fle[s]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(Qe(137,s));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(Qe(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(Qe(61))}if(n.style!=null&&typeof n.style!="object")throw Error(Qe(62))}}function HR(s,n){if(s.indexOf("-")===-1)return typeof n.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zR=null;function _A(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var KR=null,dp=null,up=null;function c4(s){if(s=Kg(s)){if(typeof KR!="function")throw Error(Qe(280));var n=s.stateNode;n&&(n=Fx(n),KR(s.stateNode,s.type,n))}}function oW(s){dp?up?up.push(s):up=[s]:dp=s}function cW(){if(dp){var s=dp,n=up;if(up=dp=null,c4(s),n)for(s=0;s<n.length;s++)c4(n[s])}}function lW(s,n){return s(n)}function dW(){}var IT=!1;function uW(s,n,a){if(IT)return s(n,a);IT=!0;try{return lW(s,n,a)}finally{IT=!1,(dp!==null||up!==null)&&(dW(),cW())}}function fg(s,n){var a=s.stateNode;if(a===null)return null;var l=Fx(a);if(l===null)return null;a=l[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(s=s.type,l=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!l;break e;default:s=!1}if(s)return null;if(a&&typeof a!="function")throw Error(Qe(231,n,typeof a));return a}var qR=!1;if(vc)try{var Nm={};Object.defineProperty(Nm,"passive",{get:function(){qR=!0}}),window.addEventListener("test",Nm,Nm),window.removeEventListener("test",Nm,Nm)}catch{qR=!1}function Ule(s,n,a,l,u,f,g,v,y){var w=Array.prototype.slice.call(arguments,3);try{n.apply(a,w)}catch(T){this.onError(T)}}var Xm=!1,Jy=null,Qy=!1,YR=null,Vle={onError:function(s){Xm=!0,Jy=s}};function Ble(s,n,a,l,u,f,g,v,y){Xm=!1,Jy=null,Ule.apply(Vle,arguments)}function Wle(s,n,a,l,u,f,g,v,y){if(Ble.apply(this,arguments),Xm){if(Xm){var w=Jy;Xm=!1,Jy=null}else throw Error(Qe(198));Qy||(Qy=!0,YR=w)}}function uu(s){var n=s,a=s;if(s.alternate)for(;n.return;)n=n.return;else{s=n;do n=s,n.flags&4098&&(a=n.return),s=n.return;while(s)}return n.tag===3?a:null}function hW(s){if(s.tag===13){var n=s.memoizedState;if(n===null&&(s=s.alternate,s!==null&&(n=s.memoizedState)),n!==null)return n.dehydrated}return null}function l4(s){if(uu(s)!==s)throw Error(Qe(188))}function Gle(s){var n=s.alternate;if(!n){if(n=uu(s),n===null)throw Error(Qe(188));return n!==s?null:s}for(var a=s,l=n;;){var u=a.return;if(u===null)break;var f=u.alternate;if(f===null){if(l=u.return,l!==null){a=l;continue}break}if(u.child===f.child){for(f=u.child;f;){if(f===a)return l4(u),s;if(f===l)return l4(u),n;f=f.sibling}throw Error(Qe(188))}if(a.return!==l.return)a=u,l=f;else{for(var g=!1,v=u.child;v;){if(v===a){g=!0,a=u,l=f;break}if(v===l){g=!0,l=u,a=f;break}v=v.sibling}if(!g){for(v=f.child;v;){if(v===a){g=!0,a=f,l=u;break}if(v===l){g=!0,l=f,a=u;break}v=v.sibling}if(!g)throw Error(Qe(189))}}if(a.alternate!==l)throw Error(Qe(190))}if(a.tag!==3)throw Error(Qe(188));return a.stateNode.current===a?s:n}function pW(s){return s=Gle(s),s!==null?fW(s):null}function fW(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var n=fW(s);if(n!==null)return n;s=s.sibling}return null}var mW=Ui.unstable_scheduleCallback,d4=Ui.unstable_cancelCallback,Hle=Ui.unstable_shouldYield,zle=Ui.unstable_requestPaint,Ms=Ui.unstable_now,Kle=Ui.unstable_getCurrentPriorityLevel,EA=Ui.unstable_ImmediatePriority,gW=Ui.unstable_UserBlockingPriority,Zy=Ui.unstable_NormalPriority,qle=Ui.unstable_LowPriority,_W=Ui.unstable_IdlePriority,kx=null,Vo=null;function Yle(s){if(Vo&&typeof Vo.onCommitFiberRoot=="function")try{Vo.onCommitFiberRoot(kx,s,void 0,(s.current.flags&128)===128)}catch{}}var no=Math.clz32?Math.clz32:Jle,$le=Math.log,Xle=Math.LN2;function Jle(s){return s>>>=0,s===0?32:31-($le(s)/Xle|0)|0}var oy=64,cy=4194304;function Hm(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function ex(s,n){var a=s.pendingLanes;if(a===0)return 0;var l=0,u=s.suspendedLanes,f=s.pingedLanes,g=a&268435455;if(g!==0){var v=g&~u;v!==0?l=Hm(v):(f&=g,f!==0&&(l=Hm(f)))}else g=a&~u,g!==0?l=Hm(g):f!==0&&(l=Hm(f));if(l===0)return 0;if(n!==0&&n!==l&&!(n&u)&&(u=l&-l,f=n&-n,u>=f||u===16&&(f&4194240)!==0))return n;if(l&4&&(l|=a&16),n=s.entangledLanes,n!==0)for(s=s.entanglements,n&=l;0<n;)a=31-no(n),u=1<<a,l|=s[a],n&=~u;return l}function Qle(s,n){switch(s){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zle(s,n){for(var a=s.suspendedLanes,l=s.pingedLanes,u=s.expirationTimes,f=s.pendingLanes;0<f;){var g=31-no(f),v=1<<g,y=u[g];y===-1?(!(v&a)||v&l)&&(u[g]=Qle(v,n)):y<=n&&(s.expiredLanes|=v),f&=~v}}function $R(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function EW(){var s=oy;return oy<<=1,!(oy&4194240)&&(oy=64),s}function OT(s){for(var n=[],a=0;31>a;a++)n.push(s);return n}function Hg(s,n,a){s.pendingLanes|=n,n!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,n=31-no(n),s[n]=a}function ede(s,n){var a=s.pendingLanes&~n;s.pendingLanes=n,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=n,s.mutableReadLanes&=n,s.entangledLanes&=n,n=s.entanglements;var l=s.eventTimes;for(s=s.expirationTimes;0<a;){var u=31-no(a),f=1<<u;n[u]=0,l[u]=-1,s[u]=-1,a&=~f}}function vA(s,n){var a=s.entangledLanes|=n;for(s=s.entanglements;a;){var l=31-no(a),u=1<<l;u&n|s[l]&n&&(s[l]|=n),a&=~u}}var Wr=0;function vW(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var yW,yA,xW,bW,wW,XR=!1,ly=[],Nl=null,Al=null,Il=null,mg=new Map,gg=new Map,gl=[],tde="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function u4(s,n){switch(s){case"focusin":case"focusout":Nl=null;break;case"dragenter":case"dragleave":Al=null;break;case"mouseover":case"mouseout":Il=null;break;case"pointerover":case"pointerout":mg.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":gg.delete(n.pointerId)}}function Am(s,n,a,l,u,f){return s===null||s.nativeEvent!==f?(s={blockedOn:n,domEventName:a,eventSystemFlags:l,nativeEvent:f,targetContainers:[u]},n!==null&&(n=Kg(n),n!==null&&yA(n)),s):(s.eventSystemFlags|=l,n=s.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),s)}function rde(s,n,a,l,u){switch(n){case"focusin":return Nl=Am(Nl,s,n,a,l,u),!0;case"dragenter":return Al=Am(Al,s,n,a,l,u),!0;case"mouseover":return Il=Am(Il,s,n,a,l,u),!0;case"pointerover":var f=u.pointerId;return mg.set(f,Am(mg.get(f)||null,s,n,a,l,u)),!0;case"gotpointercapture":return f=u.pointerId,gg.set(f,Am(gg.get(f)||null,s,n,a,l,u)),!0}return!1}function SW(s){var n=Gd(s.target);if(n!==null){var a=uu(n);if(a!==null){if(n=a.tag,n===13){if(n=hW(a),n!==null){s.blockedOn=n,wW(s.priority,function(){xW(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){s.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}s.blockedOn=null}function ky(s){if(s.blockedOn!==null)return!1;for(var n=s.targetContainers;0<n.length;){var a=JR(s.domEventName,s.eventSystemFlags,n[0],s.nativeEvent);if(a===null){a=s.nativeEvent;var l=new a.constructor(a.type,a);zR=l,a.target.dispatchEvent(l),zR=null}else return n=Kg(a),n!==null&&yA(n),s.blockedOn=a,!1;n.shift()}return!0}function h4(s,n,a){ky(s)&&a.delete(n)}function sde(){XR=!1,Nl!==null&&ky(Nl)&&(Nl=null),Al!==null&&ky(Al)&&(Al=null),Il!==null&&ky(Il)&&(Il=null),mg.forEach(h4),gg.forEach(h4)}function Im(s,n){s.blockedOn===n&&(s.blockedOn=null,XR||(XR=!0,Ui.unstable_scheduleCallback(Ui.unstable_NormalPriority,sde)))}function _g(s){function n(u){return Im(u,s)}if(0<ly.length){Im(ly[0],s);for(var a=1;a<ly.length;a++){var l=ly[a];l.blockedOn===s&&(l.blockedOn=null)}}for(Nl!==null&&Im(Nl,s),Al!==null&&Im(Al,s),Il!==null&&Im(Il,s),mg.forEach(n),gg.forEach(n),a=0;a<gl.length;a++)l=gl[a],l.blockedOn===s&&(l.blockedOn=null);for(;0<gl.length&&(a=gl[0],a.blockedOn===null);)SW(a),a.blockedOn===null&&gl.shift()}var hp=Sc.ReactCurrentBatchConfig,tx=!0;function nde(s,n,a,l){var u=Wr,f=hp.transition;hp.transition=null;try{Wr=1,xA(s,n,a,l)}finally{Wr=u,hp.transition=f}}function ide(s,n,a,l){var u=Wr,f=hp.transition;hp.transition=null;try{Wr=4,xA(s,n,a,l)}finally{Wr=u,hp.transition=f}}function xA(s,n,a,l){if(tx){var u=JR(s,n,a,l);if(u===null)BT(s,n,l,rx,a),u4(s,l);else if(rde(u,s,n,a,l))l.stopPropagation();else if(u4(s,l),n&4&&-1<tde.indexOf(s)){for(;u!==null;){var f=Kg(u);if(f!==null&&yW(f),f=JR(s,n,a,l),f===null&&BT(s,n,l,rx,a),f===u)break;u=f}u!==null&&l.stopPropagation()}else BT(s,n,l,null,a)}}var rx=null;function JR(s,n,a,l){if(rx=null,s=_A(l),s=Gd(s),s!==null)if(n=uu(s),n===null)s=null;else if(a=n.tag,a===13){if(s=hW(n),s!==null)return s;s=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;s=null}else n!==s&&(s=null);return rx=s,null}function CW(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Kle()){case EA:return 1;case gW:return 4;case Zy:case qle:return 16;case _W:return 536870912;default:return 16}default:return 16}}var Sl=null,bA=null,jy=null;function TW(){if(jy)return jy;var s,n=bA,a=n.length,l,u="value"in Sl?Sl.value:Sl.textContent,f=u.length;for(s=0;s<a&&n[s]===u[s];s++);var g=a-s;for(l=1;l<=g&&n[a-l]===u[f-l];l++);return jy=u.slice(s,1<l?1-l:void 0)}function Ly(s){var n=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&n===13&&(s=13)):s=n,s===10&&(s=13),32<=s||s===13?s:0}function dy(){return!0}function p4(){return!1}function Bi(s){function n(a,l,u,f,g){this._reactName=a,this._targetInst=u,this.type=l,this.nativeEvent=f,this.target=g,this.currentTarget=null;for(var v in s)s.hasOwnProperty(v)&&(a=s[v],this[v]=a?a(f):f[v]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?dy:p4,this.isPropagationStopped=p4,this}return ys(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=dy)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=dy)},persist:function(){},isPersistent:dy}),n}var Vp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wA=Bi(Vp),zg=ys({},Vp,{view:0,detail:0}),ade=Bi(zg),DT,PT,Om,jx=ys({},zg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:SA,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Om&&(Om&&s.type==="mousemove"?(DT=s.screenX-Om.screenX,PT=s.screenY-Om.screenY):PT=DT=0,Om=s),DT)},movementY:function(s){return"movementY"in s?s.movementY:PT}}),f4=Bi(jx),ode=ys({},jx,{dataTransfer:0}),cde=Bi(ode),lde=ys({},zg,{relatedTarget:0}),kT=Bi(lde),dde=ys({},Vp,{animationName:0,elapsedTime:0,pseudoElement:0}),ude=Bi(dde),hde=ys({},Vp,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),pde=Bi(hde),fde=ys({},Vp,{data:0}),m4=Bi(fde),mde={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gde={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_de={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ede(s){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(s):(s=_de[s])?!!n[s]:!1}function SA(){return Ede}var vde=ys({},zg,{key:function(s){if(s.key){var n=mde[s.key]||s.key;if(n!=="Unidentified")return n}return s.type==="keypress"?(s=Ly(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?gde[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:SA,charCode:function(s){return s.type==="keypress"?Ly(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Ly(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),yde=Bi(vde),xde=ys({},jx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),g4=Bi(xde),bde=ys({},zg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:SA}),wde=Bi(bde),Sde=ys({},Vp,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cde=Bi(Sde),Tde=ys({},jx,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Rde=Bi(Tde),Nde=[9,13,27,32],CA=vc&&"CompositionEvent"in window,Jm=null;vc&&"documentMode"in document&&(Jm=document.documentMode);var Ade=vc&&"TextEvent"in window&&!Jm,RW=vc&&(!CA||Jm&&8<Jm&&11>=Jm),_4=" ",E4=!1;function NW(s,n){switch(s){case"keyup":return Nde.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function AW(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Kh=!1;function Ide(s,n){switch(s){case"compositionend":return AW(n);case"keypress":return n.which!==32?null:(E4=!0,_4);case"textInput":return s=n.data,s===_4&&E4?null:s;default:return null}}function Ode(s,n){if(Kh)return s==="compositionend"||!CA&&NW(s,n)?(s=TW(),jy=bA=Sl=null,Kh=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return RW&&n.locale!=="ko"?null:n.data;default:return null}}var Dde={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function v4(s){var n=s&&s.nodeName&&s.nodeName.toLowerCase();return n==="input"?!!Dde[s.type]:n==="textarea"}function IW(s,n,a,l){oW(l),n=sx(n,"onChange"),0<n.length&&(a=new wA("onChange","change",null,a,l),s.push({event:a,listeners:n}))}var Qm=null,Eg=null;function Pde(s){BW(s,0)}function Lx(s){var n=$h(s);if(eW(n))return s}function kde(s,n){if(s==="change")return n}var OW=!1;if(vc){var jT;if(vc){var LT="oninput"in document;if(!LT){var y4=document.createElement("div");y4.setAttribute("oninput","return;"),LT=typeof y4.oninput=="function"}jT=LT}else jT=!1;OW=jT&&(!document.documentMode||9<document.documentMode)}function x4(){Qm&&(Qm.detachEvent("onpropertychange",DW),Eg=Qm=null)}function DW(s){if(s.propertyName==="value"&&Lx(Eg)){var n=[];IW(n,Eg,s,_A(s)),uW(Pde,n)}}function jde(s,n,a){s==="focusin"?(x4(),Qm=n,Eg=a,Qm.attachEvent("onpropertychange",DW)):s==="focusout"&&x4()}function Lde(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Lx(Eg)}function Mde(s,n){if(s==="click")return Lx(n)}function Fde(s,n){if(s==="input"||s==="change")return Lx(n)}function Ude(s,n){return s===n&&(s!==0||1/s===1/n)||s!==s&&n!==n}var ao=typeof Object.is=="function"?Object.is:Ude;function vg(s,n){if(ao(s,n))return!0;if(typeof s!="object"||s===null||typeof n!="object"||n===null)return!1;var a=Object.keys(s),l=Object.keys(n);if(a.length!==l.length)return!1;for(l=0;l<a.length;l++){var u=a[l];if(!PR.call(n,u)||!ao(s[u],n[u]))return!1}return!0}function b4(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function w4(s,n){var a=b4(s);s=0;for(var l;a;){if(a.nodeType===3){if(l=s+a.textContent.length,s<=n&&l>=n)return{node:a,offset:n-s};s=l}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=b4(a)}}function PW(s,n){return s&&n?s===n?!0:s&&s.nodeType===3?!1:n&&n.nodeType===3?PW(s,n.parentNode):"contains"in s?s.contains(n):s.compareDocumentPosition?!!(s.compareDocumentPosition(n)&16):!1:!1}function kW(){for(var s=window,n=Xy();n instanceof s.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)s=n.contentWindow;else break;n=Xy(s.document)}return n}function TA(s){var n=s&&s.nodeName&&s.nodeName.toLowerCase();return n&&(n==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||n==="textarea"||s.contentEditable==="true")}function Vde(s){var n=kW(),a=s.focusedElem,l=s.selectionRange;if(n!==a&&a&&a.ownerDocument&&PW(a.ownerDocument.documentElement,a)){if(l!==null&&TA(a)){if(n=l.start,s=l.end,s===void 0&&(s=n),"selectionStart"in a)a.selectionStart=n,a.selectionEnd=Math.min(s,a.value.length);else if(s=(n=a.ownerDocument||document)&&n.defaultView||window,s.getSelection){s=s.getSelection();var u=a.textContent.length,f=Math.min(l.start,u);l=l.end===void 0?f:Math.min(l.end,u),!s.extend&&f>l&&(u=l,l=f,f=u),u=w4(a,f);var g=w4(a,l);u&&g&&(s.rangeCount!==1||s.anchorNode!==u.node||s.anchorOffset!==u.offset||s.focusNode!==g.node||s.focusOffset!==g.offset)&&(n=n.createRange(),n.setStart(u.node,u.offset),s.removeAllRanges(),f>l?(s.addRange(n),s.extend(g.node,g.offset)):(n.setEnd(g.node,g.offset),s.addRange(n)))}}for(n=[],s=a;s=s.parentNode;)s.nodeType===1&&n.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<n.length;a++)s=n[a],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var Bde=vc&&"documentMode"in document&&11>=document.documentMode,qh=null,QR=null,Zm=null,ZR=!1;function S4(s,n,a){var l=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;ZR||qh==null||qh!==Xy(l)||(l=qh,"selectionStart"in l&&TA(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Zm&&vg(Zm,l)||(Zm=l,l=sx(QR,"onSelect"),0<l.length&&(n=new wA("onSelect","select",null,n,a),s.push({event:n,listeners:l}),n.target=qh)))}function uy(s,n){var a={};return a[s.toLowerCase()]=n.toLowerCase(),a["Webkit"+s]="webkit"+n,a["Moz"+s]="moz"+n,a}var Yh={animationend:uy("Animation","AnimationEnd"),animationiteration:uy("Animation","AnimationIteration"),animationstart:uy("Animation","AnimationStart"),transitionend:uy("Transition","TransitionEnd")},MT={},jW={};vc&&(jW=document.createElement("div").style,"AnimationEvent"in window||(delete Yh.animationend.animation,delete Yh.animationiteration.animation,delete Yh.animationstart.animation),"TransitionEvent"in window||delete Yh.transitionend.transition);function Mx(s){if(MT[s])return MT[s];if(!Yh[s])return s;var n=Yh[s],a;for(a in n)if(n.hasOwnProperty(a)&&a in jW)return MT[s]=n[a];return s}var LW=Mx("animationend"),MW=Mx("animationiteration"),FW=Mx("animationstart"),UW=Mx("transitionend"),VW=new Map,C4="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vl(s,n){VW.set(s,n),du(n,[s])}for(var FT=0;FT<C4.length;FT++){var UT=C4[FT],Wde=UT.toLowerCase(),Gde=UT[0].toUpperCase()+UT.slice(1);Vl(Wde,"on"+Gde)}Vl(LW,"onAnimationEnd");Vl(MW,"onAnimationIteration");Vl(FW,"onAnimationStart");Vl("dblclick","onDoubleClick");Vl("focusin","onFocus");Vl("focusout","onBlur");Vl(UW,"onTransitionEnd");Tp("onMouseEnter",["mouseout","mouseover"]);Tp("onMouseLeave",["mouseout","mouseover"]);Tp("onPointerEnter",["pointerout","pointerover"]);Tp("onPointerLeave",["pointerout","pointerover"]);du("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));du("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));du("onBeforeInput",["compositionend","keypress","textInput","paste"]);du("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));du("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));du("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hde=new Set("cancel close invalid load scroll toggle".split(" ").concat(zm));function T4(s,n,a){var l=s.type||"unknown-event";s.currentTarget=a,Wle(l,n,void 0,s),s.currentTarget=null}function BW(s,n){n=(n&4)!==0;for(var a=0;a<s.length;a++){var l=s[a],u=l.event;l=l.listeners;e:{var f=void 0;if(n)for(var g=l.length-1;0<=g;g--){var v=l[g],y=v.instance,w=v.currentTarget;if(v=v.listener,y!==f&&u.isPropagationStopped())break e;T4(u,v,w),f=y}else for(g=0;g<l.length;g++){if(v=l[g],y=v.instance,w=v.currentTarget,v=v.listener,y!==f&&u.isPropagationStopped())break e;T4(u,v,w),f=y}}}if(Qy)throw s=YR,Qy=!1,YR=null,s}function ss(s,n){var a=n[nN];a===void 0&&(a=n[nN]=new Set);var l=s+"__bubble";a.has(l)||(WW(n,s,2,!1),a.add(l))}function VT(s,n,a){var l=0;n&&(l|=4),WW(a,s,l,n)}var hy="_reactListening"+Math.random().toString(36).slice(2);function yg(s){if(!s[hy]){s[hy]=!0,$7.forEach(function(a){a!=="selectionchange"&&(Hde.has(a)||VT(a,!1,s),VT(a,!0,s))});var n=s.nodeType===9?s:s.ownerDocument;n===null||n[hy]||(n[hy]=!0,VT("selectionchange",!1,n))}}function WW(s,n,a,l){switch(CW(n)){case 1:var u=nde;break;case 4:u=ide;break;default:u=xA}a=u.bind(null,n,a,s),u=void 0,!qR||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),l?u!==void 0?s.addEventListener(n,a,{capture:!0,passive:u}):s.addEventListener(n,a,!0):u!==void 0?s.addEventListener(n,a,{passive:u}):s.addEventListener(n,a,!1)}function BT(s,n,a,l,u){var f=l;if(!(n&1)&&!(n&2)&&l!==null)e:for(;;){if(l===null)return;var g=l.tag;if(g===3||g===4){var v=l.stateNode.containerInfo;if(v===u||v.nodeType===8&&v.parentNode===u)break;if(g===4)for(g=l.return;g!==null;){var y=g.tag;if((y===3||y===4)&&(y=g.stateNode.containerInfo,y===u||y.nodeType===8&&y.parentNode===u))return;g=g.return}for(;v!==null;){if(g=Gd(v),g===null)return;if(y=g.tag,y===5||y===6){l=f=g;continue e}v=v.parentNode}}l=l.return}uW(function(){var w=f,T=_A(a),S=[];e:{var I=VW.get(s);if(I!==void 0){var j=wA,B=s;switch(s){case"keypress":if(Ly(a)===0)break e;case"keydown":case"keyup":j=yde;break;case"focusin":B="focus",j=kT;break;case"focusout":B="blur",j=kT;break;case"beforeblur":case"afterblur":j=kT;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=f4;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=cde;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=wde;break;case LW:case MW:case FW:j=ude;break;case UW:j=Cde;break;case"scroll":j=ade;break;case"wheel":j=Rde;break;case"copy":case"cut":case"paste":j=pde;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=g4}var A=(n&4)!==0,F=!A&&s==="scroll",D=A?I!==null?I+"Capture":null:I;A=[];for(var R=w,O;R!==null;){O=R;var V=O.stateNode;if(O.tag===5&&V!==null&&(O=V,D!==null&&(V=fg(R,D),V!=null&&A.push(xg(R,V,O)))),F)break;R=R.return}0<A.length&&(I=new j(I,B,null,a,T),S.push({event:I,listeners:A}))}}if(!(n&7)){e:{if(I=s==="mouseover"||s==="pointerover",j=s==="mouseout"||s==="pointerout",I&&a!==zR&&(B=a.relatedTarget||a.fromElement)&&(Gd(B)||B[yc]))break e;if((j||I)&&(I=T.window===T?T:(I=T.ownerDocument)?I.defaultView||I.parentWindow:window,j?(B=a.relatedTarget||a.toElement,j=w,B=B?Gd(B):null,B!==null&&(F=uu(B),B!==F||B.tag!==5&&B.tag!==6)&&(B=null)):(j=null,B=w),j!==B)){if(A=f4,V="onMouseLeave",D="onMouseEnter",R="mouse",(s==="pointerout"||s==="pointerover")&&(A=g4,V="onPointerLeave",D="onPointerEnter",R="pointer"),F=j==null?I:$h(j),O=B==null?I:$h(B),I=new A(V,R+"leave",j,a,T),I.target=F,I.relatedTarget=O,V=null,Gd(T)===w&&(A=new A(D,R+"enter",B,a,T),A.target=O,A.relatedTarget=F,V=A),F=V,j&&B)t:{for(A=j,D=B,R=0,O=A;O;O=Lh(O))R++;for(O=0,V=D;V;V=Lh(V))O++;for(;0<R-O;)A=Lh(A),R--;for(;0<O-R;)D=Lh(D),O--;for(;R--;){if(A===D||D!==null&&A===D.alternate)break t;A=Lh(A),D=Lh(D)}A=null}else A=null;j!==null&&R4(S,I,j,A,!1),B!==null&&F!==null&&R4(S,F,B,A,!0)}}e:{if(I=w?$h(w):window,j=I.nodeName&&I.nodeName.toLowerCase(),j==="select"||j==="input"&&I.type==="file")var G=kde;else if(v4(I))if(OW)G=Fde;else{G=Lde;var J=jde}else(j=I.nodeName)&&j.toLowerCase()==="input"&&(I.type==="checkbox"||I.type==="radio")&&(G=Mde);if(G&&(G=G(s,w))){IW(S,G,a,T);break e}J&&J(s,I,w),s==="focusout"&&(J=I._wrapperState)&&J.controlled&&I.type==="number"&&VR(I,"number",I.value)}switch(J=w?$h(w):window,s){case"focusin":(v4(J)||J.contentEditable==="true")&&(qh=J,QR=w,Zm=null);break;case"focusout":Zm=QR=qh=null;break;case"mousedown":ZR=!0;break;case"contextmenu":case"mouseup":case"dragend":ZR=!1,S4(S,a,T);break;case"selectionchange":if(Bde)break;case"keydown":case"keyup":S4(S,a,T)}var $;if(CA)e:{switch(s){case"compositionstart":var q="onCompositionStart";break e;case"compositionend":q="onCompositionEnd";break e;case"compositionupdate":q="onCompositionUpdate";break e}q=void 0}else Kh?NW(s,a)&&(q="onCompositionEnd"):s==="keydown"&&a.keyCode===229&&(q="onCompositionStart");q&&(RW&&a.locale!=="ko"&&(Kh||q!=="onCompositionStart"?q==="onCompositionEnd"&&Kh&&($=TW()):(Sl=T,bA="value"in Sl?Sl.value:Sl.textContent,Kh=!0)),J=sx(w,q),0<J.length&&(q=new m4(q,s,null,a,T),S.push({event:q,listeners:J}),$?q.data=$:($=AW(a),$!==null&&(q.data=$)))),($=Ade?Ide(s,a):Ode(s,a))&&(w=sx(w,"onBeforeInput"),0<w.length&&(T=new m4("onBeforeInput","beforeinput",null,a,T),S.push({event:T,listeners:w}),T.data=$))}BW(S,n)})}function xg(s,n,a){return{instance:s,listener:n,currentTarget:a}}function sx(s,n){for(var a=n+"Capture",l=[];s!==null;){var u=s,f=u.stateNode;u.tag===5&&f!==null&&(u=f,f=fg(s,a),f!=null&&l.unshift(xg(s,f,u)),f=fg(s,n),f!=null&&l.push(xg(s,f,u))),s=s.return}return l}function Lh(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function R4(s,n,a,l,u){for(var f=n._reactName,g=[];a!==null&&a!==l;){var v=a,y=v.alternate,w=v.stateNode;if(y!==null&&y===l)break;v.tag===5&&w!==null&&(v=w,u?(y=fg(a,f),y!=null&&g.unshift(xg(a,y,v))):u||(y=fg(a,f),y!=null&&g.push(xg(a,y,v)))),a=a.return}g.length!==0&&s.push({event:n,listeners:g})}var zde=/\r\n?/g,Kde=/\u0000|\uFFFD/g;function N4(s){return(typeof s=="string"?s:""+s).replace(zde,`
`).replace(Kde,"")}function py(s,n,a){if(n=N4(n),N4(s)!==n&&a)throw Error(Qe(425))}function nx(){}var eN=null,tN=null;function rN(s,n){return s==="textarea"||s==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var sN=typeof setTimeout=="function"?setTimeout:void 0,qde=typeof clearTimeout=="function"?clearTimeout:void 0,A4=typeof Promise=="function"?Promise:void 0,Yde=typeof queueMicrotask=="function"?queueMicrotask:typeof A4<"u"?function(s){return A4.resolve(null).then(s).catch($de)}:sN;function $de(s){setTimeout(function(){throw s})}function WT(s,n){var a=n,l=0;do{var u=a.nextSibling;if(s.removeChild(a),u&&u.nodeType===8)if(a=u.data,a==="/$"){if(l===0){s.removeChild(u),_g(n);return}l--}else a!=="$"&&a!=="$?"&&a!=="$!"||l++;a=u}while(a);_g(n)}function Ol(s){for(;s!=null;s=s.nextSibling){var n=s.nodeType;if(n===1||n===3)break;if(n===8){if(n=s.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return s}function I4(s){s=s.previousSibling;for(var n=0;s;){if(s.nodeType===8){var a=s.data;if(a==="$"||a==="$!"||a==="$?"){if(n===0)return s;n--}else a==="/$"&&n++}s=s.previousSibling}return null}var Bp=Math.random().toString(36).slice(2),Uo="__reactFiber$"+Bp,bg="__reactProps$"+Bp,yc="__reactContainer$"+Bp,nN="__reactEvents$"+Bp,Xde="__reactListeners$"+Bp,Jde="__reactHandles$"+Bp;function Gd(s){var n=s[Uo];if(n)return n;for(var a=s.parentNode;a;){if(n=a[yc]||a[Uo]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(s=I4(s);s!==null;){if(a=s[Uo])return a;s=I4(s)}return n}s=a,a=s.parentNode}return null}function Kg(s){return s=s[Uo]||s[yc],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function $h(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(Qe(33))}function Fx(s){return s[bg]||null}var iN=[],Xh=-1;function Bl(s){return{current:s}}function ns(s){0>Xh||(s.current=iN[Xh],iN[Xh]=null,Xh--)}function es(s,n){Xh++,iN[Xh]=s.current,s.current=n}var Fl={},kn=Bl(Fl),gi=Bl(!1),su=Fl;function Rp(s,n){var a=s.type.contextTypes;if(!a)return Fl;var l=s.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===n)return l.__reactInternalMemoizedMaskedChildContext;var u={},f;for(f in a)u[f]=n[f];return l&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=n,s.__reactInternalMemoizedMaskedChildContext=u),u}function _i(s){return s=s.childContextTypes,s!=null}function ix(){ns(gi),ns(kn)}function O4(s,n,a){if(kn.current!==Fl)throw Error(Qe(168));es(kn,n),es(gi,a)}function GW(s,n,a){var l=s.stateNode;if(n=n.childContextTypes,typeof l.getChildContext!="function")return a;l=l.getChildContext();for(var u in l)if(!(u in n))throw Error(Qe(108,jle(s)||"Unknown",u));return ys({},a,l)}function ax(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Fl,su=kn.current,es(kn,s),es(gi,gi.current),!0}function D4(s,n,a){var l=s.stateNode;if(!l)throw Error(Qe(169));a?(s=GW(s,n,su),l.__reactInternalMemoizedMergedChildContext=s,ns(gi),ns(kn),es(kn,s)):ns(gi),es(gi,a)}var fc=null,Ux=!1,GT=!1;function HW(s){fc===null?fc=[s]:fc.push(s)}function Qde(s){Ux=!0,HW(s)}function Wl(){if(!GT&&fc!==null){GT=!0;var s=0,n=Wr;try{var a=fc;for(Wr=1;s<a.length;s++){var l=a[s];do l=l(!0);while(l!==null)}fc=null,Ux=!1}catch(u){throw fc!==null&&(fc=fc.slice(s+1)),mW(EA,Wl),u}finally{Wr=n,GT=!1}}return null}var Jh=[],Qh=0,ox=null,cx=0,ga=[],_a=0,nu=null,gc=1,_c="";function Ld(s,n){Jh[Qh++]=cx,Jh[Qh++]=ox,ox=s,cx=n}function zW(s,n,a){ga[_a++]=gc,ga[_a++]=_c,ga[_a++]=nu,nu=s;var l=gc;s=_c;var u=32-no(l)-1;l&=~(1<<u),a+=1;var f=32-no(n)+u;if(30<f){var g=u-u%5;f=(l&(1<<g)-1).toString(32),l>>=g,u-=g,gc=1<<32-no(n)+u|a<<u|l,_c=f+s}else gc=1<<f|a<<u|l,_c=s}function RA(s){s.return!==null&&(Ld(s,1),zW(s,1,0))}function NA(s){for(;s===ox;)ox=Jh[--Qh],Jh[Qh]=null,cx=Jh[--Qh],Jh[Qh]=null;for(;s===nu;)nu=ga[--_a],ga[_a]=null,_c=ga[--_a],ga[_a]=null,gc=ga[--_a],ga[_a]=null}var Fi=null,Li=null,cs=!1,ro=null;function KW(s,n){var a=va(5,null,null,0);a.elementType="DELETED",a.stateNode=n,a.return=s,n=s.deletions,n===null?(s.deletions=[a],s.flags|=16):n.push(a)}function P4(s,n){switch(s.tag){case 5:var a=s.type;return n=n.nodeType!==1||a.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(s.stateNode=n,Fi=s,Li=Ol(n.firstChild),!0):!1;case 6:return n=s.pendingProps===""||n.nodeType!==3?null:n,n!==null?(s.stateNode=n,Fi=s,Li=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(a=nu!==null?{id:gc,overflow:_c}:null,s.memoizedState={dehydrated:n,treeContext:a,retryLane:1073741824},a=va(18,null,null,0),a.stateNode=n,a.return=s,s.child=a,Fi=s,Li=null,!0):!1;default:return!1}}function aN(s){return(s.mode&1)!==0&&(s.flags&128)===0}function oN(s){if(cs){var n=Li;if(n){var a=n;if(!P4(s,n)){if(aN(s))throw Error(Qe(418));n=Ol(a.nextSibling);var l=Fi;n&&P4(s,n)?KW(l,a):(s.flags=s.flags&-4097|2,cs=!1,Fi=s)}}else{if(aN(s))throw Error(Qe(418));s.flags=s.flags&-4097|2,cs=!1,Fi=s}}}function k4(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Fi=s}function fy(s){if(s!==Fi)return!1;if(!cs)return k4(s),cs=!0,!1;var n;if((n=s.tag!==3)&&!(n=s.tag!==5)&&(n=s.type,n=n!=="head"&&n!=="body"&&!rN(s.type,s.memoizedProps)),n&&(n=Li)){if(aN(s))throw qW(),Error(Qe(418));for(;n;)KW(s,n),n=Ol(n.nextSibling)}if(k4(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Qe(317));e:{for(s=s.nextSibling,n=0;s;){if(s.nodeType===8){var a=s.data;if(a==="/$"){if(n===0){Li=Ol(s.nextSibling);break e}n--}else a!=="$"&&a!=="$!"&&a!=="$?"||n++}s=s.nextSibling}Li=null}}else Li=Fi?Ol(s.stateNode.nextSibling):null;return!0}function qW(){for(var s=Li;s;)s=Ol(s.nextSibling)}function Np(){Li=Fi=null,cs=!1}function AA(s){ro===null?ro=[s]:ro.push(s)}var Zde=Sc.ReactCurrentBatchConfig;function Dm(s,n,a){if(s=a.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(Qe(309));var l=a.stateNode}if(!l)throw Error(Qe(147,s));var u=l,f=""+s;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===f?n.ref:(n=function(g){var v=u.refs;g===null?delete v[f]:v[f]=g},n._stringRef=f,n)}if(typeof s!="string")throw Error(Qe(284));if(!a._owner)throw Error(Qe(290,s))}return s}function my(s,n){throw s=Object.prototype.toString.call(n),Error(Qe(31,s==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":s))}function j4(s){var n=s._init;return n(s._payload)}function YW(s){function n(D,R){if(s){var O=D.deletions;O===null?(D.deletions=[R],D.flags|=16):O.push(R)}}function a(D,R){if(!s)return null;for(;R!==null;)n(D,R),R=R.sibling;return null}function l(D,R){for(D=new Map;R!==null;)R.key!==null?D.set(R.key,R):D.set(R.index,R),R=R.sibling;return D}function u(D,R){return D=jl(D,R),D.index=0,D.sibling=null,D}function f(D,R,O){return D.index=O,s?(O=D.alternate,O!==null?(O=O.index,O<R?(D.flags|=2,R):O):(D.flags|=2,R)):(D.flags|=1048576,R)}function g(D){return s&&D.alternate===null&&(D.flags|=2),D}function v(D,R,O,V){return R===null||R.tag!==6?(R=XT(O,D.mode,V),R.return=D,R):(R=u(R,O),R.return=D,R)}function y(D,R,O,V){var G=O.type;return G===zh?T(D,R,O.props.children,V,O.key):R!==null&&(R.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===pl&&j4(G)===R.type)?(V=u(R,O.props),V.ref=Dm(D,R,O),V.return=D,V):(V=Gy(O.type,O.key,O.props,null,D.mode,V),V.ref=Dm(D,R,O),V.return=D,V)}function w(D,R,O,V){return R===null||R.tag!==4||R.stateNode.containerInfo!==O.containerInfo||R.stateNode.implementation!==O.implementation?(R=JT(O,D.mode,V),R.return=D,R):(R=u(R,O.children||[]),R.return=D,R)}function T(D,R,O,V,G){return R===null||R.tag!==7?(R=eu(O,D.mode,V,G),R.return=D,R):(R=u(R,O),R.return=D,R)}function S(D,R,O){if(typeof R=="string"&&R!==""||typeof R=="number")return R=XT(""+R,D.mode,O),R.return=D,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case ny:return O=Gy(R.type,R.key,R.props,null,D.mode,O),O.ref=Dm(D,null,R),O.return=D,O;case Hh:return R=JT(R,D.mode,O),R.return=D,R;case pl:var V=R._init;return S(D,V(R._payload),O)}if(Gm(R)||Rm(R))return R=eu(R,D.mode,O,null),R.return=D,R;my(D,R)}return null}function I(D,R,O,V){var G=R!==null?R.key:null;if(typeof O=="string"&&O!==""||typeof O=="number")return G!==null?null:v(D,R,""+O,V);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case ny:return O.key===G?y(D,R,O,V):null;case Hh:return O.key===G?w(D,R,O,V):null;case pl:return G=O._init,I(D,R,G(O._payload),V)}if(Gm(O)||Rm(O))return G!==null?null:T(D,R,O,V,null);my(D,O)}return null}function j(D,R,O,V,G){if(typeof V=="string"&&V!==""||typeof V=="number")return D=D.get(O)||null,v(R,D,""+V,G);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case ny:return D=D.get(V.key===null?O:V.key)||null,y(R,D,V,G);case Hh:return D=D.get(V.key===null?O:V.key)||null,w(R,D,V,G);case pl:var J=V._init;return j(D,R,O,J(V._payload),G)}if(Gm(V)||Rm(V))return D=D.get(O)||null,T(R,D,V,G,null);my(R,V)}return null}function B(D,R,O,V){for(var G=null,J=null,$=R,q=R=0,ee=null;$!==null&&q<O.length;q++){$.index>q?(ee=$,$=null):ee=$.sibling;var ne=I(D,$,O[q],V);if(ne===null){$===null&&($=ee);break}s&&$&&ne.alternate===null&&n(D,$),R=f(ne,R,q),J===null?G=ne:J.sibling=ne,J=ne,$=ee}if(q===O.length)return a(D,$),cs&&Ld(D,q),G;if($===null){for(;q<O.length;q++)$=S(D,O[q],V),$!==null&&(R=f($,R,q),J===null?G=$:J.sibling=$,J=$);return cs&&Ld(D,q),G}for($=l(D,$);q<O.length;q++)ee=j($,D,q,O[q],V),ee!==null&&(s&&ee.alternate!==null&&$.delete(ee.key===null?q:ee.key),R=f(ee,R,q),J===null?G=ee:J.sibling=ee,J=ee);return s&&$.forEach(function(de){return n(D,de)}),cs&&Ld(D,q),G}function A(D,R,O,V){var G=Rm(O);if(typeof G!="function")throw Error(Qe(150));if(O=G.call(O),O==null)throw Error(Qe(151));for(var J=G=null,$=R,q=R=0,ee=null,ne=O.next();$!==null&&!ne.done;q++,ne=O.next()){$.index>q?(ee=$,$=null):ee=$.sibling;var de=I(D,$,ne.value,V);if(de===null){$===null&&($=ee);break}s&&$&&de.alternate===null&&n(D,$),R=f(de,R,q),J===null?G=de:J.sibling=de,J=de,$=ee}if(ne.done)return a(D,$),cs&&Ld(D,q),G;if($===null){for(;!ne.done;q++,ne=O.next())ne=S(D,ne.value,V),ne!==null&&(R=f(ne,R,q),J===null?G=ne:J.sibling=ne,J=ne);return cs&&Ld(D,q),G}for($=l(D,$);!ne.done;q++,ne=O.next())ne=j($,D,q,ne.value,V),ne!==null&&(s&&ne.alternate!==null&&$.delete(ne.key===null?q:ne.key),R=f(ne,R,q),J===null?G=ne:J.sibling=ne,J=ne);return s&&$.forEach(function(me){return n(D,me)}),cs&&Ld(D,q),G}function F(D,R,O,V){if(typeof O=="object"&&O!==null&&O.type===zh&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case ny:e:{for(var G=O.key,J=R;J!==null;){if(J.key===G){if(G=O.type,G===zh){if(J.tag===7){a(D,J.sibling),R=u(J,O.props.children),R.return=D,D=R;break e}}else if(J.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===pl&&j4(G)===J.type){a(D,J.sibling),R=u(J,O.props),R.ref=Dm(D,J,O),R.return=D,D=R;break e}a(D,J);break}else n(D,J);J=J.sibling}O.type===zh?(R=eu(O.props.children,D.mode,V,O.key),R.return=D,D=R):(V=Gy(O.type,O.key,O.props,null,D.mode,V),V.ref=Dm(D,R,O),V.return=D,D=V)}return g(D);case Hh:e:{for(J=O.key;R!==null;){if(R.key===J)if(R.tag===4&&R.stateNode.containerInfo===O.containerInfo&&R.stateNode.implementation===O.implementation){a(D,R.sibling),R=u(R,O.children||[]),R.return=D,D=R;break e}else{a(D,R);break}else n(D,R);R=R.sibling}R=JT(O,D.mode,V),R.return=D,D=R}return g(D);case pl:return J=O._init,F(D,R,J(O._payload),V)}if(Gm(O))return B(D,R,O,V);if(Rm(O))return A(D,R,O,V);my(D,O)}return typeof O=="string"&&O!==""||typeof O=="number"?(O=""+O,R!==null&&R.tag===6?(a(D,R.sibling),R=u(R,O),R.return=D,D=R):(a(D,R),R=XT(O,D.mode,V),R.return=D,D=R),g(D)):a(D,R)}return F}var Ap=YW(!0),$W=YW(!1),lx=Bl(null),dx=null,Zh=null,IA=null;function OA(){IA=Zh=dx=null}function DA(s){var n=lx.current;ns(lx),s._currentValue=n}function cN(s,n,a){for(;s!==null;){var l=s.alternate;if((s.childLanes&n)!==n?(s.childLanes|=n,l!==null&&(l.childLanes|=n)):l!==null&&(l.childLanes&n)!==n&&(l.childLanes|=n),s===a)break;s=s.return}}function pp(s,n){dx=s,IA=Zh=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&n&&(fi=!0),s.firstContext=null)}function wa(s){var n=s._currentValue;if(IA!==s)if(s={context:s,memoizedValue:n,next:null},Zh===null){if(dx===null)throw Error(Qe(308));Zh=s,dx.dependencies={lanes:0,firstContext:s}}else Zh=Zh.next=s;return n}var Hd=null;function PA(s){Hd===null?Hd=[s]:Hd.push(s)}function XW(s,n,a,l){var u=n.interleaved;return u===null?(a.next=a,PA(n)):(a.next=u.next,u.next=a),n.interleaved=a,xc(s,l)}function xc(s,n){s.lanes|=n;var a=s.alternate;for(a!==null&&(a.lanes|=n),a=s,s=s.return;s!==null;)s.childLanes|=n,a=s.alternate,a!==null&&(a.childLanes|=n),a=s,s=s.return;return a.tag===3?a.stateNode:null}var fl=!1;function kA(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function JW(s,n){s=s.updateQueue,n.updateQueue===s&&(n.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Ec(s,n){return{eventTime:s,lane:n,tag:0,payload:null,callback:null,next:null}}function Dl(s,n,a){var l=s.updateQueue;if(l===null)return null;if(l=l.shared,Rr&2){var u=l.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),l.pending=n,xc(s,a)}return u=l.interleaved,u===null?(n.next=n,PA(l)):(n.next=u.next,u.next=n),l.interleaved=n,xc(s,a)}function My(s,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194240)!==0)){var l=n.lanes;l&=s.pendingLanes,a|=l,n.lanes=a,vA(s,a)}}function L4(s,n){var a=s.updateQueue,l=s.alternate;if(l!==null&&(l=l.updateQueue,a===l)){var u=null,f=null;if(a=a.firstBaseUpdate,a!==null){do{var g={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};f===null?u=f=g:f=f.next=g,a=a.next}while(a!==null);f===null?u=f=n:f=f.next=n}else u=f=n;a={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:f,shared:l.shared,effects:l.effects},s.updateQueue=a;return}s=a.lastBaseUpdate,s===null?a.firstBaseUpdate=n:s.next=n,a.lastBaseUpdate=n}function ux(s,n,a,l){var u=s.updateQueue;fl=!1;var f=u.firstBaseUpdate,g=u.lastBaseUpdate,v=u.shared.pending;if(v!==null){u.shared.pending=null;var y=v,w=y.next;y.next=null,g===null?f=w:g.next=w,g=y;var T=s.alternate;T!==null&&(T=T.updateQueue,v=T.lastBaseUpdate,v!==g&&(v===null?T.firstBaseUpdate=w:v.next=w,T.lastBaseUpdate=y))}if(f!==null){var S=u.baseState;g=0,T=w=y=null,v=f;do{var I=v.lane,j=v.eventTime;if((l&I)===I){T!==null&&(T=T.next={eventTime:j,lane:0,tag:v.tag,payload:v.payload,callback:v.callback,next:null});e:{var B=s,A=v;switch(I=n,j=a,A.tag){case 1:if(B=A.payload,typeof B=="function"){S=B.call(j,S,I);break e}S=B;break e;case 3:B.flags=B.flags&-65537|128;case 0:if(B=A.payload,I=typeof B=="function"?B.call(j,S,I):B,I==null)break e;S=ys({},S,I);break e;case 2:fl=!0}}v.callback!==null&&v.lane!==0&&(s.flags|=64,I=u.effects,I===null?u.effects=[v]:I.push(v))}else j={eventTime:j,lane:I,tag:v.tag,payload:v.payload,callback:v.callback,next:null},T===null?(w=T=j,y=S):T=T.next=j,g|=I;if(v=v.next,v===null){if(v=u.shared.pending,v===null)break;I=v,v=I.next,I.next=null,u.lastBaseUpdate=I,u.shared.pending=null}}while(!0);if(T===null&&(y=S),u.baseState=y,u.firstBaseUpdate=w,u.lastBaseUpdate=T,n=u.shared.interleaved,n!==null){u=n;do g|=u.lane,u=u.next;while(u!==n)}else f===null&&(u.shared.lanes=0);au|=g,s.lanes=g,s.memoizedState=S}}function M4(s,n,a){if(s=n.effects,n.effects=null,s!==null)for(n=0;n<s.length;n++){var l=s[n],u=l.callback;if(u!==null){if(l.callback=null,l=a,typeof u!="function")throw Error(Qe(191,u));u.call(l)}}}var qg={},Bo=Bl(qg),wg=Bl(qg),Sg=Bl(qg);function zd(s){if(s===qg)throw Error(Qe(174));return s}function jA(s,n){switch(es(Sg,n),es(wg,s),es(Bo,qg),s=n.nodeType,s){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:WR(null,"");break;default:s=s===8?n.parentNode:n,n=s.namespaceURI||null,s=s.tagName,n=WR(n,s)}ns(Bo),es(Bo,n)}function Ip(){ns(Bo),ns(wg),ns(Sg)}function QW(s){zd(Sg.current);var n=zd(Bo.current),a=WR(n,s.type);n!==a&&(es(wg,s),es(Bo,a))}function LA(s){wg.current===s&&(ns(Bo),ns(wg))}var gs=Bl(0);function hx(s){for(var n=s;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var HT=[];function MA(){for(var s=0;s<HT.length;s++)HT[s]._workInProgressVersionPrimary=null;HT.length=0}var Fy=Sc.ReactCurrentDispatcher,zT=Sc.ReactCurrentBatchConfig,iu=0,Es=null,Xs=null,on=null,px=!1,eg=!1,Cg=0,eue=0;function Rn(){throw Error(Qe(321))}function FA(s,n){if(n===null)return!1;for(var a=0;a<n.length&&a<s.length;a++)if(!ao(s[a],n[a]))return!1;return!0}function UA(s,n,a,l,u,f){if(iu=f,Es=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,Fy.current=s===null||s.memoizedState===null?nue:iue,s=a(l,u),eg){f=0;do{if(eg=!1,Cg=0,25<=f)throw Error(Qe(301));f+=1,on=Xs=null,n.updateQueue=null,Fy.current=aue,s=a(l,u)}while(eg)}if(Fy.current=fx,n=Xs!==null&&Xs.next!==null,iu=0,on=Xs=Es=null,px=!1,n)throw Error(Qe(300));return s}function VA(){var s=Cg!==0;return Cg=0,s}function jo(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return on===null?Es.memoizedState=on=s:on=on.next=s,on}function Sa(){if(Xs===null){var s=Es.alternate;s=s!==null?s.memoizedState:null}else s=Xs.next;var n=on===null?Es.memoizedState:on.next;if(n!==null)on=n,Xs=s;else{if(s===null)throw Error(Qe(310));Xs=s,s={memoizedState:Xs.memoizedState,baseState:Xs.baseState,baseQueue:Xs.baseQueue,queue:Xs.queue,next:null},on===null?Es.memoizedState=on=s:on=on.next=s}return on}function Tg(s,n){return typeof n=="function"?n(s):n}function KT(s){var n=Sa(),a=n.queue;if(a===null)throw Error(Qe(311));a.lastRenderedReducer=s;var l=Xs,u=l.baseQueue,f=a.pending;if(f!==null){if(u!==null){var g=u.next;u.next=f.next,f.next=g}l.baseQueue=u=f,a.pending=null}if(u!==null){f=u.next,l=l.baseState;var v=g=null,y=null,w=f;do{var T=w.lane;if((iu&T)===T)y!==null&&(y=y.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),l=w.hasEagerState?w.eagerState:s(l,w.action);else{var S={lane:T,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};y===null?(v=y=S,g=l):y=y.next=S,Es.lanes|=T,au|=T}w=w.next}while(w!==null&&w!==f);y===null?g=l:y.next=v,ao(l,n.memoizedState)||(fi=!0),n.memoizedState=l,n.baseState=g,n.baseQueue=y,a.lastRenderedState=l}if(s=a.interleaved,s!==null){u=s;do f=u.lane,Es.lanes|=f,au|=f,u=u.next;while(u!==s)}else u===null&&(a.lanes=0);return[n.memoizedState,a.dispatch]}function qT(s){var n=Sa(),a=n.queue;if(a===null)throw Error(Qe(311));a.lastRenderedReducer=s;var l=a.dispatch,u=a.pending,f=n.memoizedState;if(u!==null){a.pending=null;var g=u=u.next;do f=s(f,g.action),g=g.next;while(g!==u);ao(f,n.memoizedState)||(fi=!0),n.memoizedState=f,n.baseQueue===null&&(n.baseState=f),a.lastRenderedState=f}return[f,l]}function ZW(){}function e8(s,n){var a=Es,l=Sa(),u=n(),f=!ao(l.memoizedState,u);if(f&&(l.memoizedState=u,fi=!0),l=l.queue,BA(s8.bind(null,a,l,s),[s]),l.getSnapshot!==n||f||on!==null&&on.memoizedState.tag&1){if(a.flags|=2048,Rg(9,r8.bind(null,a,l,u,n),void 0,null),cn===null)throw Error(Qe(349));iu&30||t8(a,n,u)}return u}function t8(s,n,a){s.flags|=16384,s={getSnapshot:n,value:a},n=Es.updateQueue,n===null?(n={lastEffect:null,stores:null},Es.updateQueue=n,n.stores=[s]):(a=n.stores,a===null?n.stores=[s]:a.push(s))}function r8(s,n,a,l){n.value=a,n.getSnapshot=l,n8(n)&&i8(s)}function s8(s,n,a){return a(function(){n8(n)&&i8(s)})}function n8(s){var n=s.getSnapshot;s=s.value;try{var a=n();return!ao(s,a)}catch{return!0}}function i8(s){var n=xc(s,1);n!==null&&io(n,s,1,-1)}function F4(s){var n=jo();return typeof s=="function"&&(s=s()),n.memoizedState=n.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tg,lastRenderedState:s},n.queue=s,s=s.dispatch=sue.bind(null,Es,s),[n.memoizedState,s]}function Rg(s,n,a,l){return s={tag:s,create:n,destroy:a,deps:l,next:null},n=Es.updateQueue,n===null?(n={lastEffect:null,stores:null},Es.updateQueue=n,n.lastEffect=s.next=s):(a=n.lastEffect,a===null?n.lastEffect=s.next=s:(l=a.next,a.next=s,s.next=l,n.lastEffect=s)),s}function a8(){return Sa().memoizedState}function Uy(s,n,a,l){var u=jo();Es.flags|=s,u.memoizedState=Rg(1|n,a,void 0,l===void 0?null:l)}function Vx(s,n,a,l){var u=Sa();l=l===void 0?null:l;var f=void 0;if(Xs!==null){var g=Xs.memoizedState;if(f=g.destroy,l!==null&&FA(l,g.deps)){u.memoizedState=Rg(n,a,f,l);return}}Es.flags|=s,u.memoizedState=Rg(1|n,a,f,l)}function U4(s,n){return Uy(8390656,8,s,n)}function BA(s,n){return Vx(2048,8,s,n)}function o8(s,n){return Vx(4,2,s,n)}function c8(s,n){return Vx(4,4,s,n)}function l8(s,n){if(typeof n=="function")return s=s(),n(s),function(){n(null)};if(n!=null)return s=s(),n.current=s,function(){n.current=null}}function d8(s,n,a){return a=a!=null?a.concat([s]):null,Vx(4,4,l8.bind(null,n,s),a)}function WA(){}function u8(s,n){var a=Sa();n=n===void 0?null:n;var l=a.memoizedState;return l!==null&&n!==null&&FA(n,l[1])?l[0]:(a.memoizedState=[s,n],s)}function h8(s,n){var a=Sa();n=n===void 0?null:n;var l=a.memoizedState;return l!==null&&n!==null&&FA(n,l[1])?l[0]:(s=s(),a.memoizedState=[s,n],s)}function p8(s,n,a){return iu&21?(ao(a,n)||(a=EW(),Es.lanes|=a,au|=a,s.baseState=!0),n):(s.baseState&&(s.baseState=!1,fi=!0),s.memoizedState=a)}function tue(s,n){var a=Wr;Wr=a!==0&&4>a?a:4,s(!0);var l=zT.transition;zT.transition={};try{s(!1),n()}finally{Wr=a,zT.transition=l}}function f8(){return Sa().memoizedState}function rue(s,n,a){var l=kl(s);if(a={lane:l,action:a,hasEagerState:!1,eagerState:null,next:null},m8(s))g8(n,a);else if(a=XW(s,n,a,l),a!==null){var u=zn();io(a,s,l,u),_8(a,n,l)}}function sue(s,n,a){var l=kl(s),u={lane:l,action:a,hasEagerState:!1,eagerState:null,next:null};if(m8(s))g8(n,u);else{var f=s.alternate;if(s.lanes===0&&(f===null||f.lanes===0)&&(f=n.lastRenderedReducer,f!==null))try{var g=n.lastRenderedState,v=f(g,a);if(u.hasEagerState=!0,u.eagerState=v,ao(v,g)){var y=n.interleaved;y===null?(u.next=u,PA(n)):(u.next=y.next,y.next=u),n.interleaved=u;return}}catch{}finally{}a=XW(s,n,u,l),a!==null&&(u=zn(),io(a,s,l,u),_8(a,n,l))}}function m8(s){var n=s.alternate;return s===Es||n!==null&&n===Es}function g8(s,n){eg=px=!0;var a=s.pending;a===null?n.next=n:(n.next=a.next,a.next=n),s.pending=n}function _8(s,n,a){if(a&4194240){var l=n.lanes;l&=s.pendingLanes,a|=l,n.lanes=a,vA(s,a)}}var fx={readContext:wa,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useInsertionEffect:Rn,useLayoutEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useMutableSource:Rn,useSyncExternalStore:Rn,useId:Rn,unstable_isNewReconciler:!1},nue={readContext:wa,useCallback:function(s,n){return jo().memoizedState=[s,n===void 0?null:n],s},useContext:wa,useEffect:U4,useImperativeHandle:function(s,n,a){return a=a!=null?a.concat([s]):null,Uy(4194308,4,l8.bind(null,n,s),a)},useLayoutEffect:function(s,n){return Uy(4194308,4,s,n)},useInsertionEffect:function(s,n){return Uy(4,2,s,n)},useMemo:function(s,n){var a=jo();return n=n===void 0?null:n,s=s(),a.memoizedState=[s,n],s},useReducer:function(s,n,a){var l=jo();return n=a!==void 0?a(n):n,l.memoizedState=l.baseState=n,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:n},l.queue=s,s=s.dispatch=rue.bind(null,Es,s),[l.memoizedState,s]},useRef:function(s){var n=jo();return s={current:s},n.memoizedState=s},useState:F4,useDebugValue:WA,useDeferredValue:function(s){return jo().memoizedState=s},useTransition:function(){var s=F4(!1),n=s[0];return s=tue.bind(null,s[1]),jo().memoizedState=s,[n,s]},useMutableSource:function(){},useSyncExternalStore:function(s,n,a){var l=Es,u=jo();if(cs){if(a===void 0)throw Error(Qe(407));a=a()}else{if(a=n(),cn===null)throw Error(Qe(349));iu&30||t8(l,n,a)}u.memoizedState=a;var f={value:a,getSnapshot:n};return u.queue=f,U4(s8.bind(null,l,f,s),[s]),l.flags|=2048,Rg(9,r8.bind(null,l,f,a,n),void 0,null),a},useId:function(){var s=jo(),n=cn.identifierPrefix;if(cs){var a=_c,l=gc;a=(l&~(1<<32-no(l)-1)).toString(32)+a,n=":"+n+"R"+a,a=Cg++,0<a&&(n+="H"+a.toString(32)),n+=":"}else a=eue++,n=":"+n+"r"+a.toString(32)+":";return s.memoizedState=n},unstable_isNewReconciler:!1},iue={readContext:wa,useCallback:u8,useContext:wa,useEffect:BA,useImperativeHandle:d8,useInsertionEffect:o8,useLayoutEffect:c8,useMemo:h8,useReducer:KT,useRef:a8,useState:function(){return KT(Tg)},useDebugValue:WA,useDeferredValue:function(s){var n=Sa();return p8(n,Xs.memoizedState,s)},useTransition:function(){var s=KT(Tg)[0],n=Sa().memoizedState;return[s,n]},useMutableSource:ZW,useSyncExternalStore:e8,useId:f8,unstable_isNewReconciler:!1},aue={readContext:wa,useCallback:u8,useContext:wa,useEffect:BA,useImperativeHandle:d8,useInsertionEffect:o8,useLayoutEffect:c8,useMemo:h8,useReducer:qT,useRef:a8,useState:function(){return qT(Tg)},useDebugValue:WA,useDeferredValue:function(s){var n=Sa();return Xs===null?n.memoizedState=s:p8(n,Xs.memoizedState,s)},useTransition:function(){var s=qT(Tg)[0],n=Sa().memoizedState;return[s,n]},useMutableSource:ZW,useSyncExternalStore:e8,useId:f8,unstable_isNewReconciler:!1};function Ja(s,n){if(s&&s.defaultProps){n=ys({},n),s=s.defaultProps;for(var a in s)n[a]===void 0&&(n[a]=s[a]);return n}return n}function lN(s,n,a,l){n=s.memoizedState,a=a(l,n),a=a==null?n:ys({},n,a),s.memoizedState=a,s.lanes===0&&(s.updateQueue.baseState=a)}var Bx={isMounted:function(s){return(s=s._reactInternals)?uu(s)===s:!1},enqueueSetState:function(s,n,a){s=s._reactInternals;var l=zn(),u=kl(s),f=Ec(l,u);f.payload=n,a!=null&&(f.callback=a),n=Dl(s,f,u),n!==null&&(io(n,s,u,l),My(n,s,u))},enqueueReplaceState:function(s,n,a){s=s._reactInternals;var l=zn(),u=kl(s),f=Ec(l,u);f.tag=1,f.payload=n,a!=null&&(f.callback=a),n=Dl(s,f,u),n!==null&&(io(n,s,u,l),My(n,s,u))},enqueueForceUpdate:function(s,n){s=s._reactInternals;var a=zn(),l=kl(s),u=Ec(a,l);u.tag=2,n!=null&&(u.callback=n),n=Dl(s,u,l),n!==null&&(io(n,s,l,a),My(n,s,l))}};function V4(s,n,a,l,u,f,g){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(l,f,g):n.prototype&&n.prototype.isPureReactComponent?!vg(a,l)||!vg(u,f):!0}function E8(s,n,a){var l=!1,u=Fl,f=n.contextType;return typeof f=="object"&&f!==null?f=wa(f):(u=_i(n)?su:kn.current,l=n.contextTypes,f=(l=l!=null)?Rp(s,u):Fl),n=new n(a,f),s.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Bx,s.stateNode=n,n._reactInternals=s,l&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=u,s.__reactInternalMemoizedMaskedChildContext=f),n}function B4(s,n,a,l){s=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,l),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,l),n.state!==s&&Bx.enqueueReplaceState(n,n.state,null)}function dN(s,n,a,l){var u=s.stateNode;u.props=a,u.state=s.memoizedState,u.refs={},kA(s);var f=n.contextType;typeof f=="object"&&f!==null?u.context=wa(f):(f=_i(n)?su:kn.current,u.context=Rp(s,f)),u.state=s.memoizedState,f=n.getDerivedStateFromProps,typeof f=="function"&&(lN(s,n,f,a),u.state=s.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(n=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),n!==u.state&&Bx.enqueueReplaceState(u,u.state,null),ux(s,a,u,l),u.state=s.memoizedState),typeof u.componentDidMount=="function"&&(s.flags|=4194308)}function Op(s,n){try{var a="",l=n;do a+=kle(l),l=l.return;while(l);var u=a}catch(f){u=`
Error generating stack: `+f.message+`
`+f.stack}return{value:s,source:n,stack:u,digest:null}}function YT(s,n,a){return{value:s,source:null,stack:a??null,digest:n??null}}function uN(s,n){try{console.error(n.value)}catch(a){setTimeout(function(){throw a})}}var oue=typeof WeakMap=="function"?WeakMap:Map;function v8(s,n,a){a=Ec(-1,a),a.tag=3,a.payload={element:null};var l=n.value;return a.callback=function(){gx||(gx=!0,xN=l),uN(s,n)},a}function y8(s,n,a){a=Ec(-1,a),a.tag=3;var l=s.type.getDerivedStateFromError;if(typeof l=="function"){var u=n.value;a.payload=function(){return l(u)},a.callback=function(){uN(s,n)}}var f=s.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(a.callback=function(){uN(s,n),typeof l!="function"&&(Pl===null?Pl=new Set([this]):Pl.add(this));var g=n.stack;this.componentDidCatch(n.value,{componentStack:g!==null?g:""})}),a}function W4(s,n,a){var l=s.pingCache;if(l===null){l=s.pingCache=new oue;var u=new Set;l.set(n,u)}else u=l.get(n),u===void 0&&(u=new Set,l.set(n,u));u.has(a)||(u.add(a),s=xue.bind(null,s,n,a),n.then(s,s))}function G4(s){do{var n;if((n=s.tag===13)&&(n=s.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return s;s=s.return}while(s!==null);return null}function H4(s,n,a,l,u){return s.mode&1?(s.flags|=65536,s.lanes=u,s):(s===n?s.flags|=65536:(s.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(n=Ec(-1,1),n.tag=2,Dl(a,n,1))),a.lanes|=1),s)}var cue=Sc.ReactCurrentOwner,fi=!1;function Wn(s,n,a,l){n.child=s===null?$W(n,null,a,l):Ap(n,s.child,a,l)}function z4(s,n,a,l,u){a=a.render;var f=n.ref;return pp(n,u),l=UA(s,n,a,l,f,u),a=VA(),s!==null&&!fi?(n.updateQueue=s.updateQueue,n.flags&=-2053,s.lanes&=~u,bc(s,n,u)):(cs&&a&&RA(n),n.flags|=1,Wn(s,n,l,u),n.child)}function K4(s,n,a,l,u){if(s===null){var f=a.type;return typeof f=="function"&&!XA(f)&&f.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(n.tag=15,n.type=f,x8(s,n,f,l,u)):(s=Gy(a.type,null,l,n,n.mode,u),s.ref=n.ref,s.return=n,n.child=s)}if(f=s.child,!(s.lanes&u)){var g=f.memoizedProps;if(a=a.compare,a=a!==null?a:vg,a(g,l)&&s.ref===n.ref)return bc(s,n,u)}return n.flags|=1,s=jl(f,l),s.ref=n.ref,s.return=n,n.child=s}function x8(s,n,a,l,u){if(s!==null){var f=s.memoizedProps;if(vg(f,l)&&s.ref===n.ref)if(fi=!1,n.pendingProps=l=f,(s.lanes&u)!==0)s.flags&131072&&(fi=!0);else return n.lanes=s.lanes,bc(s,n,u)}return hN(s,n,a,l,u)}function b8(s,n,a){var l=n.pendingProps,u=l.children,f=s!==null?s.memoizedState:null;if(l.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},es(tp,ji),ji|=a;else{if(!(a&1073741824))return s=f!==null?f.baseLanes|a:a,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:s,cachePool:null,transitions:null},n.updateQueue=null,es(tp,ji),ji|=s,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=f!==null?f.baseLanes:a,es(tp,ji),ji|=l}else f!==null?(l=f.baseLanes|a,n.memoizedState=null):l=a,es(tp,ji),ji|=l;return Wn(s,n,u,a),n.child}function w8(s,n){var a=n.ref;(s===null&&a!==null||s!==null&&s.ref!==a)&&(n.flags|=512,n.flags|=2097152)}function hN(s,n,a,l,u){var f=_i(a)?su:kn.current;return f=Rp(n,f),pp(n,u),a=UA(s,n,a,l,f,u),l=VA(),s!==null&&!fi?(n.updateQueue=s.updateQueue,n.flags&=-2053,s.lanes&=~u,bc(s,n,u)):(cs&&l&&RA(n),n.flags|=1,Wn(s,n,a,u),n.child)}function q4(s,n,a,l,u){if(_i(a)){var f=!0;ax(n)}else f=!1;if(pp(n,u),n.stateNode===null)Vy(s,n),E8(n,a,l),dN(n,a,l,u),l=!0;else if(s===null){var g=n.stateNode,v=n.memoizedProps;g.props=v;var y=g.context,w=a.contextType;typeof w=="object"&&w!==null?w=wa(w):(w=_i(a)?su:kn.current,w=Rp(n,w));var T=a.getDerivedStateFromProps,S=typeof T=="function"||typeof g.getSnapshotBeforeUpdate=="function";S||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(v!==l||y!==w)&&B4(n,g,l,w),fl=!1;var I=n.memoizedState;g.state=I,ux(n,l,g,u),y=n.memoizedState,v!==l||I!==y||gi.current||fl?(typeof T=="function"&&(lN(n,a,T,l),y=n.memoizedState),(v=fl||V4(n,a,v,l,I,y,w))?(S||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(n.flags|=4194308)):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=l,n.memoizedState=y),g.props=l,g.state=y,g.context=w,l=v):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),l=!1)}else{g=n.stateNode,JW(s,n),v=n.memoizedProps,w=n.type===n.elementType?v:Ja(n.type,v),g.props=w,S=n.pendingProps,I=g.context,y=a.contextType,typeof y=="object"&&y!==null?y=wa(y):(y=_i(a)?su:kn.current,y=Rp(n,y));var j=a.getDerivedStateFromProps;(T=typeof j=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(v!==S||I!==y)&&B4(n,g,l,y),fl=!1,I=n.memoizedState,g.state=I,ux(n,l,g,u);var B=n.memoizedState;v!==S||I!==B||gi.current||fl?(typeof j=="function"&&(lN(n,a,j,l),B=n.memoizedState),(w=fl||V4(n,a,w,l,I,B,y)||!1)?(T||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(l,B,y),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(l,B,y)),typeof g.componentDidUpdate=="function"&&(n.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof g.componentDidUpdate!="function"||v===s.memoizedProps&&I===s.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||v===s.memoizedProps&&I===s.memoizedState||(n.flags|=1024),n.memoizedProps=l,n.memoizedState=B),g.props=l,g.state=B,g.context=y,l=w):(typeof g.componentDidUpdate!="function"||v===s.memoizedProps&&I===s.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||v===s.memoizedProps&&I===s.memoizedState||(n.flags|=1024),l=!1)}return pN(s,n,a,l,f,u)}function pN(s,n,a,l,u,f){w8(s,n);var g=(n.flags&128)!==0;if(!l&&!g)return u&&D4(n,a,!1),bc(s,n,f);l=n.stateNode,cue.current=n;var v=g&&typeof a.getDerivedStateFromError!="function"?null:l.render();return n.flags|=1,s!==null&&g?(n.child=Ap(n,s.child,null,f),n.child=Ap(n,null,v,f)):Wn(s,n,v,f),n.memoizedState=l.state,u&&D4(n,a,!0),n.child}function S8(s){var n=s.stateNode;n.pendingContext?O4(s,n.pendingContext,n.pendingContext!==n.context):n.context&&O4(s,n.context,!1),jA(s,n.containerInfo)}function Y4(s,n,a,l,u){return Np(),AA(u),n.flags|=256,Wn(s,n,a,l),n.child}var fN={dehydrated:null,treeContext:null,retryLane:0};function mN(s){return{baseLanes:s,cachePool:null,transitions:null}}function C8(s,n,a){var l=n.pendingProps,u=gs.current,f=!1,g=(n.flags&128)!==0,v;if((v=g)||(v=s!==null&&s.memoizedState===null?!1:(u&2)!==0),v?(f=!0,n.flags&=-129):(s===null||s.memoizedState!==null)&&(u|=1),es(gs,u&1),s===null)return oN(n),s=n.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(n.mode&1?s.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(g=l.children,s=l.fallback,f?(l=n.mode,f=n.child,g={mode:"hidden",children:g},!(l&1)&&f!==null?(f.childLanes=0,f.pendingProps=g):f=Hx(g,l,0,null),s=eu(s,l,a,null),f.return=n,s.return=n,f.sibling=s,n.child=f,n.child.memoizedState=mN(a),n.memoizedState=fN,s):GA(n,g));if(u=s.memoizedState,u!==null&&(v=u.dehydrated,v!==null))return lue(s,n,g,l,v,u,a);if(f){f=l.fallback,g=n.mode,u=s.child,v=u.sibling;var y={mode:"hidden",children:l.children};return!(g&1)&&n.child!==u?(l=n.child,l.childLanes=0,l.pendingProps=y,n.deletions=null):(l=jl(u,y),l.subtreeFlags=u.subtreeFlags&14680064),v!==null?f=jl(v,f):(f=eu(f,g,a,null),f.flags|=2),f.return=n,l.return=n,l.sibling=f,n.child=l,l=f,f=n.child,g=s.child.memoizedState,g=g===null?mN(a):{baseLanes:g.baseLanes|a,cachePool:null,transitions:g.transitions},f.memoizedState=g,f.childLanes=s.childLanes&~a,n.memoizedState=fN,l}return f=s.child,s=f.sibling,l=jl(f,{mode:"visible",children:l.children}),!(n.mode&1)&&(l.lanes=a),l.return=n,l.sibling=null,s!==null&&(a=n.deletions,a===null?(n.deletions=[s],n.flags|=16):a.push(s)),n.child=l,n.memoizedState=null,l}function GA(s,n){return n=Hx({mode:"visible",children:n},s.mode,0,null),n.return=s,s.child=n}function gy(s,n,a,l){return l!==null&&AA(l),Ap(n,s.child,null,a),s=GA(n,n.pendingProps.children),s.flags|=2,n.memoizedState=null,s}function lue(s,n,a,l,u,f,g){if(a)return n.flags&256?(n.flags&=-257,l=YT(Error(Qe(422))),gy(s,n,g,l)):n.memoizedState!==null?(n.child=s.child,n.flags|=128,null):(f=l.fallback,u=n.mode,l=Hx({mode:"visible",children:l.children},u,0,null),f=eu(f,u,g,null),f.flags|=2,l.return=n,f.return=n,l.sibling=f,n.child=l,n.mode&1&&Ap(n,s.child,null,g),n.child.memoizedState=mN(g),n.memoizedState=fN,f);if(!(n.mode&1))return gy(s,n,g,null);if(u.data==="$!"){if(l=u.nextSibling&&u.nextSibling.dataset,l)var v=l.dgst;return l=v,f=Error(Qe(419)),l=YT(f,l,void 0),gy(s,n,g,l)}if(v=(g&s.childLanes)!==0,fi||v){if(l=cn,l!==null){switch(g&-g){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(l.suspendedLanes|g)?0:u,u!==0&&u!==f.retryLane&&(f.retryLane=u,xc(s,u),io(l,s,u,-1))}return $A(),l=YT(Error(Qe(421))),gy(s,n,g,l)}return u.data==="$?"?(n.flags|=128,n.child=s.child,n=bue.bind(null,s),u._reactRetry=n,null):(s=f.treeContext,Li=Ol(u.nextSibling),Fi=n,cs=!0,ro=null,s!==null&&(ga[_a++]=gc,ga[_a++]=_c,ga[_a++]=nu,gc=s.id,_c=s.overflow,nu=n),n=GA(n,l.children),n.flags|=4096,n)}function $4(s,n,a){s.lanes|=n;var l=s.alternate;l!==null&&(l.lanes|=n),cN(s.return,n,a)}function $T(s,n,a,l,u){var f=s.memoizedState;f===null?s.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:l,tail:a,tailMode:u}:(f.isBackwards=n,f.rendering=null,f.renderingStartTime=0,f.last=l,f.tail=a,f.tailMode=u)}function T8(s,n,a){var l=n.pendingProps,u=l.revealOrder,f=l.tail;if(Wn(s,n,l.children,a),l=gs.current,l&2)l=l&1|2,n.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=n.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&$4(s,a,n);else if(s.tag===19)$4(s,a,n);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}l&=1}if(es(gs,l),!(n.mode&1))n.memoizedState=null;else switch(u){case"forwards":for(a=n.child,u=null;a!==null;)s=a.alternate,s!==null&&hx(s)===null&&(u=a),a=a.sibling;a=u,a===null?(u=n.child,n.child=null):(u=a.sibling,a.sibling=null),$T(n,!1,u,a,f);break;case"backwards":for(a=null,u=n.child,n.child=null;u!==null;){if(s=u.alternate,s!==null&&hx(s)===null){n.child=u;break}s=u.sibling,u.sibling=a,a=u,u=s}$T(n,!0,a,null,f);break;case"together":$T(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Vy(s,n){!(n.mode&1)&&s!==null&&(s.alternate=null,n.alternate=null,n.flags|=2)}function bc(s,n,a){if(s!==null&&(n.dependencies=s.dependencies),au|=n.lanes,!(a&n.childLanes))return null;if(s!==null&&n.child!==s.child)throw Error(Qe(153));if(n.child!==null){for(s=n.child,a=jl(s,s.pendingProps),n.child=a,a.return=n;s.sibling!==null;)s=s.sibling,a=a.sibling=jl(s,s.pendingProps),a.return=n;a.sibling=null}return n.child}function due(s,n,a){switch(n.tag){case 3:S8(n),Np();break;case 5:QW(n);break;case 1:_i(n.type)&&ax(n);break;case 4:jA(n,n.stateNode.containerInfo);break;case 10:var l=n.type._context,u=n.memoizedProps.value;es(lx,l._currentValue),l._currentValue=u;break;case 13:if(l=n.memoizedState,l!==null)return l.dehydrated!==null?(es(gs,gs.current&1),n.flags|=128,null):a&n.child.childLanes?C8(s,n,a):(es(gs,gs.current&1),s=bc(s,n,a),s!==null?s.sibling:null);es(gs,gs.current&1);break;case 19:if(l=(a&n.childLanes)!==0,s.flags&128){if(l)return T8(s,n,a);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),es(gs,gs.current),l)break;return null;case 22:case 23:return n.lanes=0,b8(s,n,a)}return bc(s,n,a)}var R8,gN,N8,A8;R8=function(s,n){for(var a=n.child;a!==null;){if(a.tag===5||a.tag===6)s.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};gN=function(){};N8=function(s,n,a,l){var u=s.memoizedProps;if(u!==l){s=n.stateNode,zd(Bo.current);var f=null;switch(a){case"input":u=FR(s,u),l=FR(s,l),f=[];break;case"select":u=ys({},u,{value:void 0}),l=ys({},l,{value:void 0}),f=[];break;case"textarea":u=BR(s,u),l=BR(s,l),f=[];break;default:typeof u.onClick!="function"&&typeof l.onClick=="function"&&(s.onclick=nx)}GR(a,l);var g;a=null;for(w in u)if(!l.hasOwnProperty(w)&&u.hasOwnProperty(w)&&u[w]!=null)if(w==="style"){var v=u[w];for(g in v)v.hasOwnProperty(g)&&(a||(a={}),a[g]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(hg.hasOwnProperty(w)?f||(f=[]):(f=f||[]).push(w,null));for(w in l){var y=l[w];if(v=u!=null?u[w]:void 0,l.hasOwnProperty(w)&&y!==v&&(y!=null||v!=null))if(w==="style")if(v){for(g in v)!v.hasOwnProperty(g)||y&&y.hasOwnProperty(g)||(a||(a={}),a[g]="");for(g in y)y.hasOwnProperty(g)&&v[g]!==y[g]&&(a||(a={}),a[g]=y[g])}else a||(f||(f=[]),f.push(w,a)),a=y;else w==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,v=v?v.__html:void 0,y!=null&&v!==y&&(f=f||[]).push(w,y)):w==="children"?typeof y!="string"&&typeof y!="number"||(f=f||[]).push(w,""+y):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(hg.hasOwnProperty(w)?(y!=null&&w==="onScroll"&&ss("scroll",s),f||v===y||(f=[])):(f=f||[]).push(w,y))}a&&(f=f||[]).push("style",a);var w=f;(n.updateQueue=w)&&(n.flags|=4)}};A8=function(s,n,a,l){a!==l&&(n.flags|=4)};function Pm(s,n){if(!cs)switch(s.tailMode){case"hidden":n=s.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?s.tail=null:a.sibling=null;break;case"collapsed":a=s.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?n||s.tail===null?s.tail=null:s.tail.sibling=null:l.sibling=null}}function Nn(s){var n=s.alternate!==null&&s.alternate.child===s.child,a=0,l=0;if(n)for(var u=s.child;u!==null;)a|=u.lanes|u.childLanes,l|=u.subtreeFlags&14680064,l|=u.flags&14680064,u.return=s,u=u.sibling;else for(u=s.child;u!==null;)a|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=s,u=u.sibling;return s.subtreeFlags|=l,s.childLanes=a,n}function uue(s,n,a){var l=n.pendingProps;switch(NA(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nn(n),null;case 1:return _i(n.type)&&ix(),Nn(n),null;case 3:return l=n.stateNode,Ip(),ns(gi),ns(kn),MA(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(fy(n)?n.flags|=4:s===null||s.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,ro!==null&&(SN(ro),ro=null))),gN(s,n),Nn(n),null;case 5:LA(n);var u=zd(Sg.current);if(a=n.type,s!==null&&n.stateNode!=null)N8(s,n,a,l,u),s.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!l){if(n.stateNode===null)throw Error(Qe(166));return Nn(n),null}if(s=zd(Bo.current),fy(n)){l=n.stateNode,a=n.type;var f=n.memoizedProps;switch(l[Uo]=n,l[bg]=f,s=(n.mode&1)!==0,a){case"dialog":ss("cancel",l),ss("close",l);break;case"iframe":case"object":case"embed":ss("load",l);break;case"video":case"audio":for(u=0;u<zm.length;u++)ss(zm[u],l);break;case"source":ss("error",l);break;case"img":case"image":case"link":ss("error",l),ss("load",l);break;case"details":ss("toggle",l);break;case"input":n4(l,f),ss("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!f.multiple},ss("invalid",l);break;case"textarea":a4(l,f),ss("invalid",l)}GR(a,f),u=null;for(var g in f)if(f.hasOwnProperty(g)){var v=f[g];g==="children"?typeof v=="string"?l.textContent!==v&&(f.suppressHydrationWarning!==!0&&py(l.textContent,v,s),u=["children",v]):typeof v=="number"&&l.textContent!==""+v&&(f.suppressHydrationWarning!==!0&&py(l.textContent,v,s),u=["children",""+v]):hg.hasOwnProperty(g)&&v!=null&&g==="onScroll"&&ss("scroll",l)}switch(a){case"input":iy(l),i4(l,f,!0);break;case"textarea":iy(l),o4(l);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(l.onclick=nx)}l=u,n.updateQueue=l,l!==null&&(n.flags|=4)}else{g=u.nodeType===9?u:u.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=sW(a)),s==="http://www.w3.org/1999/xhtml"?a==="script"?(s=g.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof l.is=="string"?s=g.createElement(a,{is:l.is}):(s=g.createElement(a),a==="select"&&(g=s,l.multiple?g.multiple=!0:l.size&&(g.size=l.size))):s=g.createElementNS(s,a),s[Uo]=n,s[bg]=l,R8(s,n,!1,!1),n.stateNode=s;e:{switch(g=HR(a,l),a){case"dialog":ss("cancel",s),ss("close",s),u=l;break;case"iframe":case"object":case"embed":ss("load",s),u=l;break;case"video":case"audio":for(u=0;u<zm.length;u++)ss(zm[u],s);u=l;break;case"source":ss("error",s),u=l;break;case"img":case"image":case"link":ss("error",s),ss("load",s),u=l;break;case"details":ss("toggle",s),u=l;break;case"input":n4(s,l),u=FR(s,l),ss("invalid",s);break;case"option":u=l;break;case"select":s._wrapperState={wasMultiple:!!l.multiple},u=ys({},l,{value:void 0}),ss("invalid",s);break;case"textarea":a4(s,l),u=BR(s,l),ss("invalid",s);break;default:u=l}GR(a,u),v=u;for(f in v)if(v.hasOwnProperty(f)){var y=v[f];f==="style"?aW(s,y):f==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&nW(s,y)):f==="children"?typeof y=="string"?(a!=="textarea"||y!=="")&&pg(s,y):typeof y=="number"&&pg(s,""+y):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(hg.hasOwnProperty(f)?y!=null&&f==="onScroll"&&ss("scroll",s):y!=null&&pA(s,f,y,g))}switch(a){case"input":iy(s),i4(s,l,!1);break;case"textarea":iy(s),o4(s);break;case"option":l.value!=null&&s.setAttribute("value",""+Ml(l.value));break;case"select":s.multiple=!!l.multiple,f=l.value,f!=null?lp(s,!!l.multiple,f,!1):l.defaultValue!=null&&lp(s,!!l.multiple,l.defaultValue,!0);break;default:typeof u.onClick=="function"&&(s.onclick=nx)}switch(a){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return Nn(n),null;case 6:if(s&&n.stateNode!=null)A8(s,n,s.memoizedProps,l);else{if(typeof l!="string"&&n.stateNode===null)throw Error(Qe(166));if(a=zd(Sg.current),zd(Bo.current),fy(n)){if(l=n.stateNode,a=n.memoizedProps,l[Uo]=n,(f=l.nodeValue!==a)&&(s=Fi,s!==null))switch(s.tag){case 3:py(l.nodeValue,a,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&py(l.nodeValue,a,(s.mode&1)!==0)}f&&(n.flags|=4)}else l=(a.nodeType===9?a:a.ownerDocument).createTextNode(l),l[Uo]=n,n.stateNode=l}return Nn(n),null;case 13:if(ns(gs),l=n.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(cs&&Li!==null&&n.mode&1&&!(n.flags&128))qW(),Np(),n.flags|=98560,f=!1;else if(f=fy(n),l!==null&&l.dehydrated!==null){if(s===null){if(!f)throw Error(Qe(318));if(f=n.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(Qe(317));f[Uo]=n}else Np(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;Nn(n),f=!1}else ro!==null&&(SN(ro),ro=null),f=!0;if(!f)return n.flags&65536?n:null}return n.flags&128?(n.lanes=a,n):(l=l!==null,l!==(s!==null&&s.memoizedState!==null)&&l&&(n.child.flags|=8192,n.mode&1&&(s===null||gs.current&1?Js===0&&(Js=3):$A())),n.updateQueue!==null&&(n.flags|=4),Nn(n),null);case 4:return Ip(),gN(s,n),s===null&&yg(n.stateNode.containerInfo),Nn(n),null;case 10:return DA(n.type._context),Nn(n),null;case 17:return _i(n.type)&&ix(),Nn(n),null;case 19:if(ns(gs),f=n.memoizedState,f===null)return Nn(n),null;if(l=(n.flags&128)!==0,g=f.rendering,g===null)if(l)Pm(f,!1);else{if(Js!==0||s!==null&&s.flags&128)for(s=n.child;s!==null;){if(g=hx(s),g!==null){for(n.flags|=128,Pm(f,!1),l=g.updateQueue,l!==null&&(n.updateQueue=l,n.flags|=4),n.subtreeFlags=0,l=a,a=n.child;a!==null;)f=a,s=l,f.flags&=14680066,g=f.alternate,g===null?(f.childLanes=0,f.lanes=s,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=g.childLanes,f.lanes=g.lanes,f.child=g.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=g.memoizedProps,f.memoizedState=g.memoizedState,f.updateQueue=g.updateQueue,f.type=g.type,s=g.dependencies,f.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),a=a.sibling;return es(gs,gs.current&1|2),n.child}s=s.sibling}f.tail!==null&&Ms()>Dp&&(n.flags|=128,l=!0,Pm(f,!1),n.lanes=4194304)}else{if(!l)if(s=hx(g),s!==null){if(n.flags|=128,l=!0,a=s.updateQueue,a!==null&&(n.updateQueue=a,n.flags|=4),Pm(f,!0),f.tail===null&&f.tailMode==="hidden"&&!g.alternate&&!cs)return Nn(n),null}else 2*Ms()-f.renderingStartTime>Dp&&a!==1073741824&&(n.flags|=128,l=!0,Pm(f,!1),n.lanes=4194304);f.isBackwards?(g.sibling=n.child,n.child=g):(a=f.last,a!==null?a.sibling=g:n.child=g,f.last=g)}return f.tail!==null?(n=f.tail,f.rendering=n,f.tail=n.sibling,f.renderingStartTime=Ms(),n.sibling=null,a=gs.current,es(gs,l?a&1|2:a&1),n):(Nn(n),null);case 22:case 23:return YA(),l=n.memoizedState!==null,s!==null&&s.memoizedState!==null!==l&&(n.flags|=8192),l&&n.mode&1?ji&1073741824&&(Nn(n),n.subtreeFlags&6&&(n.flags|=8192)):Nn(n),null;case 24:return null;case 25:return null}throw Error(Qe(156,n.tag))}function hue(s,n){switch(NA(n),n.tag){case 1:return _i(n.type)&&ix(),s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 3:return Ip(),ns(gi),ns(kn),MA(),s=n.flags,s&65536&&!(s&128)?(n.flags=s&-65537|128,n):null;case 5:return LA(n),null;case 13:if(ns(gs),s=n.memoizedState,s!==null&&s.dehydrated!==null){if(n.alternate===null)throw Error(Qe(340));Np()}return s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 19:return ns(gs),null;case 4:return Ip(),null;case 10:return DA(n.type._context),null;case 22:case 23:return YA(),null;case 24:return null;default:return null}}var _y=!1,On=!1,pue=typeof WeakSet=="function"?WeakSet:Set,Et=null;function ep(s,n){var a=s.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(l){As(s,n,l)}else a.current=null}function _N(s,n,a){try{a()}catch(l){As(s,n,l)}}var X4=!1;function fue(s,n){if(eN=tx,s=kW(),TA(s)){if("selectionStart"in s)var a={start:s.selectionStart,end:s.selectionEnd};else e:{a=(a=s.ownerDocument)&&a.defaultView||window;var l=a.getSelection&&a.getSelection();if(l&&l.rangeCount!==0){a=l.anchorNode;var u=l.anchorOffset,f=l.focusNode;l=l.focusOffset;try{a.nodeType,f.nodeType}catch{a=null;break e}var g=0,v=-1,y=-1,w=0,T=0,S=s,I=null;t:for(;;){for(var j;S!==a||u!==0&&S.nodeType!==3||(v=g+u),S!==f||l!==0&&S.nodeType!==3||(y=g+l),S.nodeType===3&&(g+=S.nodeValue.length),(j=S.firstChild)!==null;)I=S,S=j;for(;;){if(S===s)break t;if(I===a&&++w===u&&(v=g),I===f&&++T===l&&(y=g),(j=S.nextSibling)!==null)break;S=I,I=S.parentNode}S=j}a=v===-1||y===-1?null:{start:v,end:y}}else a=null}a=a||{start:0,end:0}}else a=null;for(tN={focusedElem:s,selectionRange:a},tx=!1,Et=n;Et!==null;)if(n=Et,s=n.child,(n.subtreeFlags&1028)!==0&&s!==null)s.return=n,Et=s;else for(;Et!==null;){n=Et;try{var B=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var A=B.memoizedProps,F=B.memoizedState,D=n.stateNode,R=D.getSnapshotBeforeUpdate(n.elementType===n.type?A:Ja(n.type,A),F);D.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var O=n.stateNode.containerInfo;O.nodeType===1?O.textContent="":O.nodeType===9&&O.documentElement&&O.removeChild(O.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Qe(163))}}catch(V){As(n,n.return,V)}if(s=n.sibling,s!==null){s.return=n.return,Et=s;break}Et=n.return}return B=X4,X4=!1,B}function tg(s,n,a){var l=n.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var u=l=l.next;do{if((u.tag&s)===s){var f=u.destroy;u.destroy=void 0,f!==void 0&&_N(n,a,f)}u=u.next}while(u!==l)}}function Wx(s,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&s)===s){var l=a.create;a.destroy=l()}a=a.next}while(a!==n)}}function EN(s){var n=s.ref;if(n!==null){var a=s.stateNode;switch(s.tag){case 5:s=a;break;default:s=a}typeof n=="function"?n(s):n.current=s}}function I8(s){var n=s.alternate;n!==null&&(s.alternate=null,I8(n)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(n=s.stateNode,n!==null&&(delete n[Uo],delete n[bg],delete n[nN],delete n[Xde],delete n[Jde])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function O8(s){return s.tag===5||s.tag===3||s.tag===4}function J4(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||O8(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function vN(s,n,a){var l=s.tag;if(l===5||l===6)s=s.stateNode,n?a.nodeType===8?a.parentNode.insertBefore(s,n):a.insertBefore(s,n):(a.nodeType===8?(n=a.parentNode,n.insertBefore(s,a)):(n=a,n.appendChild(s)),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=nx));else if(l!==4&&(s=s.child,s!==null))for(vN(s,n,a),s=s.sibling;s!==null;)vN(s,n,a),s=s.sibling}function yN(s,n,a){var l=s.tag;if(l===5||l===6)s=s.stateNode,n?a.insertBefore(s,n):a.appendChild(s);else if(l!==4&&(s=s.child,s!==null))for(yN(s,n,a),s=s.sibling;s!==null;)yN(s,n,a),s=s.sibling}var mn=null,eo=!1;function al(s,n,a){for(a=a.child;a!==null;)D8(s,n,a),a=a.sibling}function D8(s,n,a){if(Vo&&typeof Vo.onCommitFiberUnmount=="function")try{Vo.onCommitFiberUnmount(kx,a)}catch{}switch(a.tag){case 5:On||ep(a,n);case 6:var l=mn,u=eo;mn=null,al(s,n,a),mn=l,eo=u,mn!==null&&(eo?(s=mn,a=a.stateNode,s.nodeType===8?s.parentNode.removeChild(a):s.removeChild(a)):mn.removeChild(a.stateNode));break;case 18:mn!==null&&(eo?(s=mn,a=a.stateNode,s.nodeType===8?WT(s.parentNode,a):s.nodeType===1&&WT(s,a),_g(s)):WT(mn,a.stateNode));break;case 4:l=mn,u=eo,mn=a.stateNode.containerInfo,eo=!0,al(s,n,a),mn=l,eo=u;break;case 0:case 11:case 14:case 15:if(!On&&(l=a.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){u=l=l.next;do{var f=u,g=f.destroy;f=f.tag,g!==void 0&&(f&2||f&4)&&_N(a,n,g),u=u.next}while(u!==l)}al(s,n,a);break;case 1:if(!On&&(ep(a,n),l=a.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=a.memoizedProps,l.state=a.memoizedState,l.componentWillUnmount()}catch(v){As(a,n,v)}al(s,n,a);break;case 21:al(s,n,a);break;case 22:a.mode&1?(On=(l=On)||a.memoizedState!==null,al(s,n,a),On=l):al(s,n,a);break;default:al(s,n,a)}}function Q4(s){var n=s.updateQueue;if(n!==null){s.updateQueue=null;var a=s.stateNode;a===null&&(a=s.stateNode=new pue),n.forEach(function(l){var u=wue.bind(null,s,l);a.has(l)||(a.add(l),l.then(u,u))})}}function Ya(s,n){var a=n.deletions;if(a!==null)for(var l=0;l<a.length;l++){var u=a[l];try{var f=s,g=n,v=g;e:for(;v!==null;){switch(v.tag){case 5:mn=v.stateNode,eo=!1;break e;case 3:mn=v.stateNode.containerInfo,eo=!0;break e;case 4:mn=v.stateNode.containerInfo,eo=!0;break e}v=v.return}if(mn===null)throw Error(Qe(160));D8(f,g,u),mn=null,eo=!1;var y=u.alternate;y!==null&&(y.return=null),u.return=null}catch(w){As(u,n,w)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)P8(n,s),n=n.sibling}function P8(s,n){var a=s.alternate,l=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(Ya(n,s),Po(s),l&4){try{tg(3,s,s.return),Wx(3,s)}catch(A){As(s,s.return,A)}try{tg(5,s,s.return)}catch(A){As(s,s.return,A)}}break;case 1:Ya(n,s),Po(s),l&512&&a!==null&&ep(a,a.return);break;case 5:if(Ya(n,s),Po(s),l&512&&a!==null&&ep(a,a.return),s.flags&32){var u=s.stateNode;try{pg(u,"")}catch(A){As(s,s.return,A)}}if(l&4&&(u=s.stateNode,u!=null)){var f=s.memoizedProps,g=a!==null?a.memoizedProps:f,v=s.type,y=s.updateQueue;if(s.updateQueue=null,y!==null)try{v==="input"&&f.type==="radio"&&f.name!=null&&tW(u,f),HR(v,g);var w=HR(v,f);for(g=0;g<y.length;g+=2){var T=y[g],S=y[g+1];T==="style"?aW(u,S):T==="dangerouslySetInnerHTML"?nW(u,S):T==="children"?pg(u,S):pA(u,T,S,w)}switch(v){case"input":UR(u,f);break;case"textarea":rW(u,f);break;case"select":var I=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!f.multiple;var j=f.value;j!=null?lp(u,!!f.multiple,j,!1):I!==!!f.multiple&&(f.defaultValue!=null?lp(u,!!f.multiple,f.defaultValue,!0):lp(u,!!f.multiple,f.multiple?[]:"",!1))}u[bg]=f}catch(A){As(s,s.return,A)}}break;case 6:if(Ya(n,s),Po(s),l&4){if(s.stateNode===null)throw Error(Qe(162));u=s.stateNode,f=s.memoizedProps;try{u.nodeValue=f}catch(A){As(s,s.return,A)}}break;case 3:if(Ya(n,s),Po(s),l&4&&a!==null&&a.memoizedState.isDehydrated)try{_g(n.containerInfo)}catch(A){As(s,s.return,A)}break;case 4:Ya(n,s),Po(s);break;case 13:Ya(n,s),Po(s),u=s.child,u.flags&8192&&(f=u.memoizedState!==null,u.stateNode.isHidden=f,!f||u.alternate!==null&&u.alternate.memoizedState!==null||(KA=Ms())),l&4&&Q4(s);break;case 22:if(T=a!==null&&a.memoizedState!==null,s.mode&1?(On=(w=On)||T,Ya(n,s),On=w):Ya(n,s),Po(s),l&8192){if(w=s.memoizedState!==null,(s.stateNode.isHidden=w)&&!T&&s.mode&1)for(Et=s,T=s.child;T!==null;){for(S=Et=T;Et!==null;){switch(I=Et,j=I.child,I.tag){case 0:case 11:case 14:case 15:tg(4,I,I.return);break;case 1:ep(I,I.return);var B=I.stateNode;if(typeof B.componentWillUnmount=="function"){l=I,a=I.return;try{n=l,B.props=n.memoizedProps,B.state=n.memoizedState,B.componentWillUnmount()}catch(A){As(l,a,A)}}break;case 5:ep(I,I.return);break;case 22:if(I.memoizedState!==null){eB(S);continue}}j!==null?(j.return=I,Et=j):eB(S)}T=T.sibling}e:for(T=null,S=s;;){if(S.tag===5){if(T===null){T=S;try{u=S.stateNode,w?(f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(v=S.stateNode,y=S.memoizedProps.style,g=y!=null&&y.hasOwnProperty("display")?y.display:null,v.style.display=iW("display",g))}catch(A){As(s,s.return,A)}}}else if(S.tag===6){if(T===null)try{S.stateNode.nodeValue=w?"":S.memoizedProps}catch(A){As(s,s.return,A)}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===s)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===s)break e;for(;S.sibling===null;){if(S.return===null||S.return===s)break e;T===S&&(T=null),S=S.return}T===S&&(T=null),S.sibling.return=S.return,S=S.sibling}}break;case 19:Ya(n,s),Po(s),l&4&&Q4(s);break;case 21:break;default:Ya(n,s),Po(s)}}function Po(s){var n=s.flags;if(n&2){try{e:{for(var a=s.return;a!==null;){if(O8(a)){var l=a;break e}a=a.return}throw Error(Qe(160))}switch(l.tag){case 5:var u=l.stateNode;l.flags&32&&(pg(u,""),l.flags&=-33);var f=J4(s);yN(s,f,u);break;case 3:case 4:var g=l.stateNode.containerInfo,v=J4(s);vN(s,v,g);break;default:throw Error(Qe(161))}}catch(y){As(s,s.return,y)}s.flags&=-3}n&4096&&(s.flags&=-4097)}function mue(s,n,a){Et=s,k8(s)}function k8(s,n,a){for(var l=(s.mode&1)!==0;Et!==null;){var u=Et,f=u.child;if(u.tag===22&&l){var g=u.memoizedState!==null||_y;if(!g){var v=u.alternate,y=v!==null&&v.memoizedState!==null||On;v=_y;var w=On;if(_y=g,(On=y)&&!w)for(Et=u;Et!==null;)g=Et,y=g.child,g.tag===22&&g.memoizedState!==null?tB(u):y!==null?(y.return=g,Et=y):tB(u);for(;f!==null;)Et=f,k8(f),f=f.sibling;Et=u,_y=v,On=w}Z4(s)}else u.subtreeFlags&8772&&f!==null?(f.return=u,Et=f):Z4(s)}}function Z4(s){for(;Et!==null;){var n=Et;if(n.flags&8772){var a=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:On||Wx(5,n);break;case 1:var l=n.stateNode;if(n.flags&4&&!On)if(a===null)l.componentDidMount();else{var u=n.elementType===n.type?a.memoizedProps:Ja(n.type,a.memoizedProps);l.componentDidUpdate(u,a.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var f=n.updateQueue;f!==null&&M4(n,f,l);break;case 3:var g=n.updateQueue;if(g!==null){if(a=null,n.child!==null)switch(n.child.tag){case 5:a=n.child.stateNode;break;case 1:a=n.child.stateNode}M4(n,g,a)}break;case 5:var v=n.stateNode;if(a===null&&n.flags&4){a=v;var y=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&a.focus();break;case"img":y.src&&(a.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var w=n.alternate;if(w!==null){var T=w.memoizedState;if(T!==null){var S=T.dehydrated;S!==null&&_g(S)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Qe(163))}On||n.flags&512&&EN(n)}catch(I){As(n,n.return,I)}}if(n===s){Et=null;break}if(a=n.sibling,a!==null){a.return=n.return,Et=a;break}Et=n.return}}function eB(s){for(;Et!==null;){var n=Et;if(n===s){Et=null;break}var a=n.sibling;if(a!==null){a.return=n.return,Et=a;break}Et=n.return}}function tB(s){for(;Et!==null;){var n=Et;try{switch(n.tag){case 0:case 11:case 15:var a=n.return;try{Wx(4,n)}catch(y){As(n,a,y)}break;case 1:var l=n.stateNode;if(typeof l.componentDidMount=="function"){var u=n.return;try{l.componentDidMount()}catch(y){As(n,u,y)}}var f=n.return;try{EN(n)}catch(y){As(n,f,y)}break;case 5:var g=n.return;try{EN(n)}catch(y){As(n,g,y)}}}catch(y){As(n,n.return,y)}if(n===s){Et=null;break}var v=n.sibling;if(v!==null){v.return=n.return,Et=v;break}Et=n.return}}var gue=Math.ceil,mx=Sc.ReactCurrentDispatcher,HA=Sc.ReactCurrentOwner,xa=Sc.ReactCurrentBatchConfig,Rr=0,cn=null,Hs=null,gn=0,ji=0,tp=Bl(0),Js=0,Ng=null,au=0,Gx=0,zA=0,rg=null,pi=null,KA=0,Dp=1/0,pc=null,gx=!1,xN=null,Pl=null,Ey=!1,Cl=null,_x=0,sg=0,bN=null,By=-1,Wy=0;function zn(){return Rr&6?Ms():By!==-1?By:By=Ms()}function kl(s){return s.mode&1?Rr&2&&gn!==0?gn&-gn:Zde.transition!==null?(Wy===0&&(Wy=EW()),Wy):(s=Wr,s!==0||(s=window.event,s=s===void 0?16:CW(s.type)),s):1}function io(s,n,a,l){if(50<sg)throw sg=0,bN=null,Error(Qe(185));Hg(s,a,l),(!(Rr&2)||s!==cn)&&(s===cn&&(!(Rr&2)&&(Gx|=a),Js===4&&_l(s,gn)),Ei(s,l),a===1&&Rr===0&&!(n.mode&1)&&(Dp=Ms()+500,Ux&&Wl()))}function Ei(s,n){var a=s.callbackNode;Zle(s,n);var l=ex(s,s===cn?gn:0);if(l===0)a!==null&&d4(a),s.callbackNode=null,s.callbackPriority=0;else if(n=l&-l,s.callbackPriority!==n){if(a!=null&&d4(a),n===1)s.tag===0?Qde(rB.bind(null,s)):HW(rB.bind(null,s)),Yde(function(){!(Rr&6)&&Wl()}),a=null;else{switch(vW(l)){case 1:a=EA;break;case 4:a=gW;break;case 16:a=Zy;break;case 536870912:a=_W;break;default:a=Zy}a=W8(a,j8.bind(null,s))}s.callbackPriority=n,s.callbackNode=a}}function j8(s,n){if(By=-1,Wy=0,Rr&6)throw Error(Qe(327));var a=s.callbackNode;if(fp()&&s.callbackNode!==a)return null;var l=ex(s,s===cn?gn:0);if(l===0)return null;if(l&30||l&s.expiredLanes||n)n=Ex(s,l);else{n=l;var u=Rr;Rr|=2;var f=M8();(cn!==s||gn!==n)&&(pc=null,Dp=Ms()+500,Zd(s,n));do try{vue();break}catch(v){L8(s,v)}while(!0);OA(),mx.current=f,Rr=u,Hs!==null?n=0:(cn=null,gn=0,n=Js)}if(n!==0){if(n===2&&(u=$R(s),u!==0&&(l=u,n=wN(s,u))),n===1)throw a=Ng,Zd(s,0),_l(s,l),Ei(s,Ms()),a;if(n===6)_l(s,l);else{if(u=s.current.alternate,!(l&30)&&!_ue(u)&&(n=Ex(s,l),n===2&&(f=$R(s),f!==0&&(l=f,n=wN(s,f))),n===1))throw a=Ng,Zd(s,0),_l(s,l),Ei(s,Ms()),a;switch(s.finishedWork=u,s.finishedLanes=l,n){case 0:case 1:throw Error(Qe(345));case 2:Md(s,pi,pc);break;case 3:if(_l(s,l),(l&130023424)===l&&(n=KA+500-Ms(),10<n)){if(ex(s,0)!==0)break;if(u=s.suspendedLanes,(u&l)!==l){zn(),s.pingedLanes|=s.suspendedLanes&u;break}s.timeoutHandle=sN(Md.bind(null,s,pi,pc),n);break}Md(s,pi,pc);break;case 4:if(_l(s,l),(l&4194240)===l)break;for(n=s.eventTimes,u=-1;0<l;){var g=31-no(l);f=1<<g,g=n[g],g>u&&(u=g),l&=~f}if(l=u,l=Ms()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*gue(l/1960))-l,10<l){s.timeoutHandle=sN(Md.bind(null,s,pi,pc),l);break}Md(s,pi,pc);break;case 5:Md(s,pi,pc);break;default:throw Error(Qe(329))}}}return Ei(s,Ms()),s.callbackNode===a?j8.bind(null,s):null}function wN(s,n){var a=rg;return s.current.memoizedState.isDehydrated&&(Zd(s,n).flags|=256),s=Ex(s,n),s!==2&&(n=pi,pi=a,n!==null&&SN(n)),s}function SN(s){pi===null?pi=s:pi.push.apply(pi,s)}function _ue(s){for(var n=s;;){if(n.flags&16384){var a=n.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var l=0;l<a.length;l++){var u=a[l],f=u.getSnapshot;u=u.value;try{if(!ao(f(),u))return!1}catch{return!1}}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function _l(s,n){for(n&=~zA,n&=~Gx,s.suspendedLanes|=n,s.pingedLanes&=~n,s=s.expirationTimes;0<n;){var a=31-no(n),l=1<<a;s[a]=-1,n&=~l}}function rB(s){if(Rr&6)throw Error(Qe(327));fp();var n=ex(s,0);if(!(n&1))return Ei(s,Ms()),null;var a=Ex(s,n);if(s.tag!==0&&a===2){var l=$R(s);l!==0&&(n=l,a=wN(s,l))}if(a===1)throw a=Ng,Zd(s,0),_l(s,n),Ei(s,Ms()),a;if(a===6)throw Error(Qe(345));return s.finishedWork=s.current.alternate,s.finishedLanes=n,Md(s,pi,pc),Ei(s,Ms()),null}function qA(s,n){var a=Rr;Rr|=1;try{return s(n)}finally{Rr=a,Rr===0&&(Dp=Ms()+500,Ux&&Wl())}}function ou(s){Cl!==null&&Cl.tag===0&&!(Rr&6)&&fp();var n=Rr;Rr|=1;var a=xa.transition,l=Wr;try{if(xa.transition=null,Wr=1,s)return s()}finally{Wr=l,xa.transition=a,Rr=n,!(Rr&6)&&Wl()}}function YA(){ji=tp.current,ns(tp)}function Zd(s,n){s.finishedWork=null,s.finishedLanes=0;var a=s.timeoutHandle;if(a!==-1&&(s.timeoutHandle=-1,qde(a)),Hs!==null)for(a=Hs.return;a!==null;){var l=a;switch(NA(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&ix();break;case 3:Ip(),ns(gi),ns(kn),MA();break;case 5:LA(l);break;case 4:Ip();break;case 13:ns(gs);break;case 19:ns(gs);break;case 10:DA(l.type._context);break;case 22:case 23:YA()}a=a.return}if(cn=s,Hs=s=jl(s.current,null),gn=ji=n,Js=0,Ng=null,zA=Gx=au=0,pi=rg=null,Hd!==null){for(n=0;n<Hd.length;n++)if(a=Hd[n],l=a.interleaved,l!==null){a.interleaved=null;var u=l.next,f=a.pending;if(f!==null){var g=f.next;f.next=u,l.next=g}a.pending=l}Hd=null}return s}function L8(s,n){do{var a=Hs;try{if(OA(),Fy.current=fx,px){for(var l=Es.memoizedState;l!==null;){var u=l.queue;u!==null&&(u.pending=null),l=l.next}px=!1}if(iu=0,on=Xs=Es=null,eg=!1,Cg=0,HA.current=null,a===null||a.return===null){Js=1,Ng=n,Hs=null;break}e:{var f=s,g=a.return,v=a,y=n;if(n=gn,v.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var w=y,T=v,S=T.tag;if(!(T.mode&1)&&(S===0||S===11||S===15)){var I=T.alternate;I?(T.updateQueue=I.updateQueue,T.memoizedState=I.memoizedState,T.lanes=I.lanes):(T.updateQueue=null,T.memoizedState=null)}var j=G4(g);if(j!==null){j.flags&=-257,H4(j,g,v,f,n),j.mode&1&&W4(f,w,n),n=j,y=w;var B=n.updateQueue;if(B===null){var A=new Set;A.add(y),n.updateQueue=A}else B.add(y);break e}else{if(!(n&1)){W4(f,w,n),$A();break e}y=Error(Qe(426))}}else if(cs&&v.mode&1){var F=G4(g);if(F!==null){!(F.flags&65536)&&(F.flags|=256),H4(F,g,v,f,n),AA(Op(y,v));break e}}f=y=Op(y,v),Js!==4&&(Js=2),rg===null?rg=[f]:rg.push(f),f=g;do{switch(f.tag){case 3:f.flags|=65536,n&=-n,f.lanes|=n;var D=v8(f,y,n);L4(f,D);break e;case 1:v=y;var R=f.type,O=f.stateNode;if(!(f.flags&128)&&(typeof R.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(Pl===null||!Pl.has(O)))){f.flags|=65536,n&=-n,f.lanes|=n;var V=y8(f,v,n);L4(f,V);break e}}f=f.return}while(f!==null)}U8(a)}catch(G){n=G,Hs===a&&a!==null&&(Hs=a=a.return);continue}break}while(!0)}function M8(){var s=mx.current;return mx.current=fx,s===null?fx:s}function $A(){(Js===0||Js===3||Js===2)&&(Js=4),cn===null||!(au&268435455)&&!(Gx&268435455)||_l(cn,gn)}function Ex(s,n){var a=Rr;Rr|=2;var l=M8();(cn!==s||gn!==n)&&(pc=null,Zd(s,n));do try{Eue();break}catch(u){L8(s,u)}while(!0);if(OA(),Rr=a,mx.current=l,Hs!==null)throw Error(Qe(261));return cn=null,gn=0,Js}function Eue(){for(;Hs!==null;)F8(Hs)}function vue(){for(;Hs!==null&&!Hle();)F8(Hs)}function F8(s){var n=B8(s.alternate,s,ji);s.memoizedProps=s.pendingProps,n===null?U8(s):Hs=n,HA.current=null}function U8(s){var n=s;do{var a=n.alternate;if(s=n.return,n.flags&32768){if(a=hue(a,n),a!==null){a.flags&=32767,Hs=a;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{Js=6,Hs=null;return}}else if(a=uue(a,n,ji),a!==null){Hs=a;return}if(n=n.sibling,n!==null){Hs=n;return}Hs=n=s}while(n!==null);Js===0&&(Js=5)}function Md(s,n,a){var l=Wr,u=xa.transition;try{xa.transition=null,Wr=1,yue(s,n,a,l)}finally{xa.transition=u,Wr=l}return null}function yue(s,n,a,l){do fp();while(Cl!==null);if(Rr&6)throw Error(Qe(327));a=s.finishedWork;var u=s.finishedLanes;if(a===null)return null;if(s.finishedWork=null,s.finishedLanes=0,a===s.current)throw Error(Qe(177));s.callbackNode=null,s.callbackPriority=0;var f=a.lanes|a.childLanes;if(ede(s,f),s===cn&&(Hs=cn=null,gn=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Ey||(Ey=!0,W8(Zy,function(){return fp(),null})),f=(a.flags&15990)!==0,a.subtreeFlags&15990||f){f=xa.transition,xa.transition=null;var g=Wr;Wr=1;var v=Rr;Rr|=4,HA.current=null,fue(s,a),P8(a,s),Vde(tN),tx=!!eN,tN=eN=null,s.current=a,mue(a),zle(),Rr=v,Wr=g,xa.transition=f}else s.current=a;if(Ey&&(Ey=!1,Cl=s,_x=u),f=s.pendingLanes,f===0&&(Pl=null),Yle(a.stateNode),Ei(s,Ms()),n!==null)for(l=s.onRecoverableError,a=0;a<n.length;a++)u=n[a],l(u.value,{componentStack:u.stack,digest:u.digest});if(gx)throw gx=!1,s=xN,xN=null,s;return _x&1&&s.tag!==0&&fp(),f=s.pendingLanes,f&1?s===bN?sg++:(sg=0,bN=s):sg=0,Wl(),null}function fp(){if(Cl!==null){var s=vW(_x),n=xa.transition,a=Wr;try{if(xa.transition=null,Wr=16>s?16:s,Cl===null)var l=!1;else{if(s=Cl,Cl=null,_x=0,Rr&6)throw Error(Qe(331));var u=Rr;for(Rr|=4,Et=s.current;Et!==null;){var f=Et,g=f.child;if(Et.flags&16){var v=f.deletions;if(v!==null){for(var y=0;y<v.length;y++){var w=v[y];for(Et=w;Et!==null;){var T=Et;switch(T.tag){case 0:case 11:case 15:tg(8,T,f)}var S=T.child;if(S!==null)S.return=T,Et=S;else for(;Et!==null;){T=Et;var I=T.sibling,j=T.return;if(I8(T),T===w){Et=null;break}if(I!==null){I.return=j,Et=I;break}Et=j}}}var B=f.alternate;if(B!==null){var A=B.child;if(A!==null){B.child=null;do{var F=A.sibling;A.sibling=null,A=F}while(A!==null)}}Et=f}}if(f.subtreeFlags&2064&&g!==null)g.return=f,Et=g;else e:for(;Et!==null;){if(f=Et,f.flags&2048)switch(f.tag){case 0:case 11:case 15:tg(9,f,f.return)}var D=f.sibling;if(D!==null){D.return=f.return,Et=D;break e}Et=f.return}}var R=s.current;for(Et=R;Et!==null;){g=Et;var O=g.child;if(g.subtreeFlags&2064&&O!==null)O.return=g,Et=O;else e:for(g=R;Et!==null;){if(v=Et,v.flags&2048)try{switch(v.tag){case 0:case 11:case 15:Wx(9,v)}}catch(G){As(v,v.return,G)}if(v===g){Et=null;break e}var V=v.sibling;if(V!==null){V.return=v.return,Et=V;break e}Et=v.return}}if(Rr=u,Wl(),Vo&&typeof Vo.onPostCommitFiberRoot=="function")try{Vo.onPostCommitFiberRoot(kx,s)}catch{}l=!0}return l}finally{Wr=a,xa.transition=n}}return!1}function sB(s,n,a){n=Op(a,n),n=v8(s,n,1),s=Dl(s,n,1),n=zn(),s!==null&&(Hg(s,1,n),Ei(s,n))}function As(s,n,a){if(s.tag===3)sB(s,s,a);else for(;n!==null;){if(n.tag===3){sB(n,s,a);break}else if(n.tag===1){var l=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Pl===null||!Pl.has(l))){s=Op(a,s),s=y8(n,s,1),n=Dl(n,s,1),s=zn(),n!==null&&(Hg(n,1,s),Ei(n,s));break}}n=n.return}}function xue(s,n,a){var l=s.pingCache;l!==null&&l.delete(n),n=zn(),s.pingedLanes|=s.suspendedLanes&a,cn===s&&(gn&a)===a&&(Js===4||Js===3&&(gn&130023424)===gn&&500>Ms()-KA?Zd(s,0):zA|=a),Ei(s,n)}function V8(s,n){n===0&&(s.mode&1?(n=cy,cy<<=1,!(cy&130023424)&&(cy=4194304)):n=1);var a=zn();s=xc(s,n),s!==null&&(Hg(s,n,a),Ei(s,a))}function bue(s){var n=s.memoizedState,a=0;n!==null&&(a=n.retryLane),V8(s,a)}function wue(s,n){var a=0;switch(s.tag){case 13:var l=s.stateNode,u=s.memoizedState;u!==null&&(a=u.retryLane);break;case 19:l=s.stateNode;break;default:throw Error(Qe(314))}l!==null&&l.delete(n),V8(s,a)}var B8;B8=function(s,n,a){if(s!==null)if(s.memoizedProps!==n.pendingProps||gi.current)fi=!0;else{if(!(s.lanes&a)&&!(n.flags&128))return fi=!1,due(s,n,a);fi=!!(s.flags&131072)}else fi=!1,cs&&n.flags&1048576&&zW(n,cx,n.index);switch(n.lanes=0,n.tag){case 2:var l=n.type;Vy(s,n),s=n.pendingProps;var u=Rp(n,kn.current);pp(n,a),u=UA(null,n,l,s,u,a);var f=VA();return n.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,_i(l)?(f=!0,ax(n)):f=!1,n.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,kA(n),u.updater=Bx,n.stateNode=u,u._reactInternals=n,dN(n,l,s,a),n=pN(null,n,l,!0,f,a)):(n.tag=0,cs&&f&&RA(n),Wn(null,n,u,a),n=n.child),n;case 16:l=n.elementType;e:{switch(Vy(s,n),s=n.pendingProps,u=l._init,l=u(l._payload),n.type=l,u=n.tag=Cue(l),s=Ja(l,s),u){case 0:n=hN(null,n,l,s,a);break e;case 1:n=q4(null,n,l,s,a);break e;case 11:n=z4(null,n,l,s,a);break e;case 14:n=K4(null,n,l,Ja(l.type,s),a);break e}throw Error(Qe(306,l,""))}return n;case 0:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ja(l,u),hN(s,n,l,u,a);case 1:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ja(l,u),q4(s,n,l,u,a);case 3:e:{if(S8(n),s===null)throw Error(Qe(387));l=n.pendingProps,f=n.memoizedState,u=f.element,JW(s,n),ux(n,l,null,a);var g=n.memoizedState;if(l=g.element,f.isDehydrated)if(f={element:l,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},n.updateQueue.baseState=f,n.memoizedState=f,n.flags&256){u=Op(Error(Qe(423)),n),n=Y4(s,n,l,a,u);break e}else if(l!==u){u=Op(Error(Qe(424)),n),n=Y4(s,n,l,a,u);break e}else for(Li=Ol(n.stateNode.containerInfo.firstChild),Fi=n,cs=!0,ro=null,a=$W(n,null,l,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Np(),l===u){n=bc(s,n,a);break e}Wn(s,n,l,a)}n=n.child}return n;case 5:return QW(n),s===null&&oN(n),l=n.type,u=n.pendingProps,f=s!==null?s.memoizedProps:null,g=u.children,rN(l,u)?g=null:f!==null&&rN(l,f)&&(n.flags|=32),w8(s,n),Wn(s,n,g,a),n.child;case 6:return s===null&&oN(n),null;case 13:return C8(s,n,a);case 4:return jA(n,n.stateNode.containerInfo),l=n.pendingProps,s===null?n.child=Ap(n,null,l,a):Wn(s,n,l,a),n.child;case 11:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ja(l,u),z4(s,n,l,u,a);case 7:return Wn(s,n,n.pendingProps,a),n.child;case 8:return Wn(s,n,n.pendingProps.children,a),n.child;case 12:return Wn(s,n,n.pendingProps.children,a),n.child;case 10:e:{if(l=n.type._context,u=n.pendingProps,f=n.memoizedProps,g=u.value,es(lx,l._currentValue),l._currentValue=g,f!==null)if(ao(f.value,g)){if(f.children===u.children&&!gi.current){n=bc(s,n,a);break e}}else for(f=n.child,f!==null&&(f.return=n);f!==null;){var v=f.dependencies;if(v!==null){g=f.child;for(var y=v.firstContext;y!==null;){if(y.context===l){if(f.tag===1){y=Ec(-1,a&-a),y.tag=2;var w=f.updateQueue;if(w!==null){w=w.shared;var T=w.pending;T===null?y.next=y:(y.next=T.next,T.next=y),w.pending=y}}f.lanes|=a,y=f.alternate,y!==null&&(y.lanes|=a),cN(f.return,a,n),v.lanes|=a;break}y=y.next}}else if(f.tag===10)g=f.type===n.type?null:f.child;else if(f.tag===18){if(g=f.return,g===null)throw Error(Qe(341));g.lanes|=a,v=g.alternate,v!==null&&(v.lanes|=a),cN(g,a,n),g=f.sibling}else g=f.child;if(g!==null)g.return=f;else for(g=f;g!==null;){if(g===n){g=null;break}if(f=g.sibling,f!==null){f.return=g.return,g=f;break}g=g.return}f=g}Wn(s,n,u.children,a),n=n.child}return n;case 9:return u=n.type,l=n.pendingProps.children,pp(n,a),u=wa(u),l=l(u),n.flags|=1,Wn(s,n,l,a),n.child;case 14:return l=n.type,u=Ja(l,n.pendingProps),u=Ja(l.type,u),K4(s,n,l,u,a);case 15:return x8(s,n,n.type,n.pendingProps,a);case 17:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ja(l,u),Vy(s,n),n.tag=1,_i(l)?(s=!0,ax(n)):s=!1,pp(n,a),E8(n,l,u),dN(n,l,u,a),pN(null,n,l,!0,s,a);case 19:return T8(s,n,a);case 22:return b8(s,n,a)}throw Error(Qe(156,n.tag))};function W8(s,n){return mW(s,n)}function Sue(s,n,a,l){this.tag=s,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function va(s,n,a,l){return new Sue(s,n,a,l)}function XA(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Cue(s){if(typeof s=="function")return XA(s)?1:0;if(s!=null){if(s=s.$$typeof,s===mA)return 11;if(s===gA)return 14}return 2}function jl(s,n){var a=s.alternate;return a===null?(a=va(s.tag,n,s.key,s.mode),a.elementType=s.elementType,a.type=s.type,a.stateNode=s.stateNode,a.alternate=s,s.alternate=a):(a.pendingProps=n,a.type=s.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=s.flags&14680064,a.childLanes=s.childLanes,a.lanes=s.lanes,a.child=s.child,a.memoizedProps=s.memoizedProps,a.memoizedState=s.memoizedState,a.updateQueue=s.updateQueue,n=s.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=s.sibling,a.index=s.index,a.ref=s.ref,a}function Gy(s,n,a,l,u,f){var g=2;if(l=s,typeof s=="function")XA(s)&&(g=1);else if(typeof s=="string")g=5;else e:switch(s){case zh:return eu(a.children,u,f,n);case fA:g=8,u|=8;break;case kR:return s=va(12,a,n,u|2),s.elementType=kR,s.lanes=f,s;case jR:return s=va(13,a,n,u),s.elementType=jR,s.lanes=f,s;case LR:return s=va(19,a,n,u),s.elementType=LR,s.lanes=f,s;case Q7:return Hx(a,u,f,n);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case X7:g=10;break e;case J7:g=9;break e;case mA:g=11;break e;case gA:g=14;break e;case pl:g=16,l=null;break e}throw Error(Qe(130,s==null?s:typeof s,""))}return n=va(g,a,n,u),n.elementType=s,n.type=l,n.lanes=f,n}function eu(s,n,a,l){return s=va(7,s,l,n),s.lanes=a,s}function Hx(s,n,a,l){return s=va(22,s,l,n),s.elementType=Q7,s.lanes=a,s.stateNode={isHidden:!1},s}function XT(s,n,a){return s=va(6,s,null,n),s.lanes=a,s}function JT(s,n,a){return n=va(4,s.children!==null?s.children:[],s.key,n),n.lanes=a,n.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},n}function Tue(s,n,a,l,u){this.tag=n,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=OT(0),this.expirationTimes=OT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=OT(0),this.identifierPrefix=l,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function JA(s,n,a,l,u,f,g,v,y){return s=new Tue(s,n,a,v,y),n===1?(n=1,f===!0&&(n|=8)):n=0,f=va(3,null,null,n),s.current=f,f.stateNode=s,f.memoizedState={element:l,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},kA(f),s}function Rue(s,n,a){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hh,key:l==null?null:""+l,children:s,containerInfo:n,implementation:a}}function G8(s){if(!s)return Fl;s=s._reactInternals;e:{if(uu(s)!==s||s.tag!==1)throw Error(Qe(170));var n=s;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(_i(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(Qe(171))}if(s.tag===1){var a=s.type;if(_i(a))return GW(s,a,n)}return n}function H8(s,n,a,l,u,f,g,v,y){return s=JA(a,l,!0,s,u,f,g,v,y),s.context=G8(null),a=s.current,l=zn(),u=kl(a),f=Ec(l,u),f.callback=n??null,Dl(a,f,u),s.current.lanes=u,Hg(s,u,l),Ei(s,l),s}function zx(s,n,a,l){var u=n.current,f=zn(),g=kl(u);return a=G8(a),n.context===null?n.context=a:n.pendingContext=a,n=Ec(f,g),n.payload={element:s},l=l===void 0?null:l,l!==null&&(n.callback=l),s=Dl(u,n,g),s!==null&&(io(s,u,g,f),My(s,u,g)),g}function vx(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function nB(s,n){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var a=s.retryLane;s.retryLane=a!==0&&a<n?a:n}}function QA(s,n){nB(s,n),(s=s.alternate)&&nB(s,n)}function Nue(){return null}var z8=typeof reportError=="function"?reportError:function(s){console.error(s)};function ZA(s){this._internalRoot=s}Kx.prototype.render=ZA.prototype.render=function(s){var n=this._internalRoot;if(n===null)throw Error(Qe(409));zx(s,n,null,null)};Kx.prototype.unmount=ZA.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var n=s.containerInfo;ou(function(){zx(null,s,null,null)}),n[yc]=null}};function Kx(s){this._internalRoot=s}Kx.prototype.unstable_scheduleHydration=function(s){if(s){var n=bW();s={blockedOn:null,target:s,priority:n};for(var a=0;a<gl.length&&n!==0&&n<gl[a].priority;a++);gl.splice(a,0,s),a===0&&SW(s)}};function eI(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function qx(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function iB(){}function Aue(s,n,a,l,u){if(u){if(typeof l=="function"){var f=l;l=function(){var w=vx(g);f.call(w)}}var g=H8(n,l,s,0,null,!1,!1,"",iB);return s._reactRootContainer=g,s[yc]=g.current,yg(s.nodeType===8?s.parentNode:s),ou(),g}for(;u=s.lastChild;)s.removeChild(u);if(typeof l=="function"){var v=l;l=function(){var w=vx(y);v.call(w)}}var y=JA(s,0,!1,null,null,!1,!1,"",iB);return s._reactRootContainer=y,s[yc]=y.current,yg(s.nodeType===8?s.parentNode:s),ou(function(){zx(n,y,a,l)}),y}function Yx(s,n,a,l,u){var f=a._reactRootContainer;if(f){var g=f;if(typeof u=="function"){var v=u;u=function(){var y=vx(g);v.call(y)}}zx(n,g,s,u)}else g=Aue(a,n,s,u,l);return vx(g)}yW=function(s){switch(s.tag){case 3:var n=s.stateNode;if(n.current.memoizedState.isDehydrated){var a=Hm(n.pendingLanes);a!==0&&(vA(n,a|1),Ei(n,Ms()),!(Rr&6)&&(Dp=Ms()+500,Wl()))}break;case 13:ou(function(){var l=xc(s,1);if(l!==null){var u=zn();io(l,s,1,u)}}),QA(s,1)}};yA=function(s){if(s.tag===13){var n=xc(s,134217728);if(n!==null){var a=zn();io(n,s,134217728,a)}QA(s,134217728)}};xW=function(s){if(s.tag===13){var n=kl(s),a=xc(s,n);if(a!==null){var l=zn();io(a,s,n,l)}QA(s,n)}};bW=function(){return Wr};wW=function(s,n){var a=Wr;try{return Wr=s,n()}finally{Wr=a}};KR=function(s,n,a){switch(n){case"input":if(UR(s,a),n=a.name,a.type==="radio"&&n!=null){for(a=s;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<a.length;n++){var l=a[n];if(l!==s&&l.form===s.form){var u=Fx(l);if(!u)throw Error(Qe(90));eW(l),UR(l,u)}}}break;case"textarea":rW(s,a);break;case"select":n=a.value,n!=null&&lp(s,!!a.multiple,n,!1)}};lW=qA;dW=ou;var Iue={usingClientEntryPoint:!1,Events:[Kg,$h,Fx,oW,cW,qA]},km={findFiberByHostInstance:Gd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Oue={bundleType:km.bundleType,version:km.version,rendererPackageName:km.rendererPackageName,rendererConfig:km.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Sc.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=pW(s),s===null?null:s.stateNode},findFiberByHostInstance:km.findFiberByHostInstance||Nue,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vy.isDisabled&&vy.supportsFiber)try{kx=vy.inject(Oue),Vo=vy}catch{}}Vi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Iue;Vi.createPortal=function(s,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eI(n))throw Error(Qe(200));return Rue(s,n,null,a)};Vi.createRoot=function(s,n){if(!eI(s))throw Error(Qe(299));var a=!1,l="",u=z8;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onRecoverableError!==void 0&&(u=n.onRecoverableError)),n=JA(s,1,!1,null,null,a,!1,l,u),s[yc]=n.current,yg(s.nodeType===8?s.parentNode:s),new ZA(n)};Vi.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var n=s._reactInternals;if(n===void 0)throw typeof s.render=="function"?Error(Qe(188)):(s=Object.keys(s).join(","),Error(Qe(268,s)));return s=pW(n),s=s===null?null:s.stateNode,s};Vi.flushSync=function(s){return ou(s)};Vi.hydrate=function(s,n,a){if(!qx(n))throw Error(Qe(200));return Yx(null,s,n,!0,a)};Vi.hydrateRoot=function(s,n,a){if(!eI(s))throw Error(Qe(405));var l=a!=null&&a.hydratedSources||null,u=!1,f="",g=z8;if(a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onRecoverableError!==void 0&&(g=a.onRecoverableError)),n=H8(n,null,s,1,a??null,u,!1,f,g),s[yc]=n.current,yg(s),l)for(s=0;s<l.length;s++)a=l[s],u=a._getVersion,u=u(a._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[a,u]:n.mutableSourceEagerHydrationData.push(a,u);return new Kx(n)};Vi.render=function(s,n,a){if(!qx(n))throw Error(Qe(200));return Yx(null,s,n,!1,a)};Vi.unmountComponentAtNode=function(s){if(!qx(s))throw Error(Qe(40));return s._reactRootContainer?(ou(function(){Yx(null,null,s,!1,function(){s._reactRootContainer=null,s[yc]=null})}),!0):!1};Vi.unstable_batchedUpdates=qA;Vi.unstable_renderSubtreeIntoContainer=function(s,n,a,l){if(!qx(a))throw Error(Qe(200));if(s==null||s._reactInternals===void 0)throw Error(Qe(38));return Yx(s,n,a,!1,l)};Vi.version="18.3.1-next-f1338f8080-20240426";function K8(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(K8)}catch(s){console.error(s)}}K8(),K7.exports=Vi;var Due=K7.exports,aB=Due;DR.createRoot=aB.createRoot,DR.hydrateRoot=aB.hydrateRoot;var $x=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(s){return this.listeners.add(s),this.onSubscribe(),()=>{this.listeners.delete(s),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Xx=typeof window>"u"||"Deno"in globalThis;function Qa(){}function Pue(s,n){return typeof s=="function"?s(n):s}function kue(s){return typeof s=="number"&&s>=0&&s!==1/0}function jue(s,n){return Math.max(s+(n||0)-Date.now(),0)}function oB(s,n){return typeof s=="function"?s(n):s}function Lue(s,n){return typeof s=="function"?s(n):s}function cB(s,n){const{type:a="all",exact:l,fetchStatus:u,predicate:f,queryKey:g,stale:v}=s;if(g){if(l){if(n.queryHash!==tI(g,n.options))return!1}else if(!Ig(n.queryKey,g))return!1}if(a!=="all"){const y=n.isActive();if(a==="active"&&!y||a==="inactive"&&y)return!1}return!(typeof v=="boolean"&&n.isStale()!==v||u&&u!==n.state.fetchStatus||f&&!f(n))}function lB(s,n){const{exact:a,status:l,predicate:u,mutationKey:f}=s;if(f){if(!n.options.mutationKey)return!1;if(a){if(Ag(n.options.mutationKey)!==Ag(f))return!1}else if(!Ig(n.options.mutationKey,f))return!1}return!(l&&n.state.status!==l||u&&!u(n))}function tI(s,n){return((n==null?void 0:n.queryKeyHashFn)||Ag)(s)}function Ag(s){return JSON.stringify(s,(n,a)=>CN(a)?Object.keys(a).sort().reduce((l,u)=>(l[u]=a[u],l),{}):a)}function Ig(s,n){return s===n?!0:typeof s!=typeof n?!1:s&&n&&typeof s=="object"&&typeof n=="object"?!Object.keys(n).some(a=>!Ig(s[a],n[a])):!1}function q8(s,n){if(s===n)return s;const a=dB(s)&&dB(n);if(a||CN(s)&&CN(n)){const l=a?s:Object.keys(s),u=l.length,f=a?n:Object.keys(n),g=f.length,v=a?[]:{};let y=0;for(let w=0;w<g;w++){const T=a?w:f[w];(!a&&l.includes(T)||a)&&s[T]===void 0&&n[T]===void 0?(v[T]=void 0,y++):(v[T]=q8(s[T],n[T]),v[T]===s[T]&&s[T]!==void 0&&y++)}return u===g&&y===u?s:v}return n}function dB(s){return Array.isArray(s)&&s.length===Object.keys(s).length}function CN(s){if(!uB(s))return!1;const n=s.constructor;if(n===void 0)return!0;const a=n.prototype;return!(!uB(a)||!a.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(s)!==Object.prototype)}function uB(s){return Object.prototype.toString.call(s)==="[object Object]"}function Mue(s){return new Promise(n=>{setTimeout(n,s)})}function Fue(s,n,a){return typeof a.structuralSharing=="function"?a.structuralSharing(s,n):a.structuralSharing!==!1?q8(s,n):n}function Uue(s,n,a=0){const l=[...s,n];return a&&l.length>a?l.slice(1):l}function Vue(s,n,a=0){const l=[n,...s];return a&&l.length>a?l.slice(0,-1):l}var Y8=Symbol(),$8=(s,n)=>!s.queryFn&&(n!=null&&n.initialPromise)?()=>n.initialPromise:!s.queryFn||s.queryFn===Y8?()=>Promise.reject(new Error(`Missing queryFn: '${s.queryHash}'`)):s.queryFn,$d,vl,_p,T7,Bue=(T7=class extends $x{constructor(){super();Lr(this,$d);Lr(this,vl);Lr(this,_p);sr(this,_p,n=>{if(!Xx&&window.addEventListener){const a=()=>n();return window.addEventListener("visibilitychange",a,!1),()=>{window.removeEventListener("visibilitychange",a)}}})}onSubscribe(){qe(this,vl)||this.setEventListener(qe(this,_p))}onUnsubscribe(){var n;this.hasListeners()||((n=qe(this,vl))==null||n.call(this),sr(this,vl,void 0))}setEventListener(n){var a;sr(this,_p,n),(a=qe(this,vl))==null||a.call(this),sr(this,vl,n(l=>{typeof l=="boolean"?this.setFocused(l):this.onFocus()}))}setFocused(n){qe(this,$d)!==n&&(sr(this,$d,n),this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(a=>{a(n)})}isFocused(){var n;return typeof qe(this,$d)=="boolean"?qe(this,$d):((n=globalThis.document)==null?void 0:n.visibilityState)!=="hidden"}},$d=new WeakMap,vl=new WeakMap,_p=new WeakMap,T7),X8=new Bue,Ep,yl,vp,R7,Wue=(R7=class extends $x{constructor(){super();Lr(this,Ep,!0);Lr(this,yl);Lr(this,vp);sr(this,vp,n=>{if(!Xx&&window.addEventListener){const a=()=>n(!0),l=()=>n(!1);return window.addEventListener("online",a,!1),window.addEventListener("offline",l,!1),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",l)}}})}onSubscribe(){qe(this,yl)||this.setEventListener(qe(this,vp))}onUnsubscribe(){var n;this.hasListeners()||((n=qe(this,yl))==null||n.call(this),sr(this,yl,void 0))}setEventListener(n){var a;sr(this,vp,n),(a=qe(this,yl))==null||a.call(this),sr(this,yl,n(this.setOnline.bind(this)))}setOnline(n){qe(this,Ep)!==n&&(sr(this,Ep,n),this.listeners.forEach(l=>{l(n)}))}isOnline(){return qe(this,Ep)}},Ep=new WeakMap,yl=new WeakMap,vp=new WeakMap,R7),yx=new Wue;function Gue(s){return Math.min(1e3*2**s,3e4)}function J8(s){return(s??"online")==="online"?yx.isOnline():!0}var Q8=class{constructor(s){this.revert=s==null?void 0:s.revert,this.silent=s==null?void 0:s.silent}};function QT(s){return s instanceof Q8}function Z8(s){let n=!1,a=0,l=!1,u,f,g;const v=new Promise((D,R)=>{f=D,g=R}),y=D=>{var R;l||(B(new Q8(D)),(R=s.abort)==null||R.call(s))},w=()=>{n=!0},T=()=>{n=!1},S=()=>X8.isFocused()&&(s.networkMode==="always"||yx.isOnline())&&s.canRun(),I=()=>J8(s.networkMode)&&s.canRun(),j=D=>{var R;l||(l=!0,(R=s.onSuccess)==null||R.call(s,D),u==null||u(),f(D))},B=D=>{var R;l||(l=!0,(R=s.onError)==null||R.call(s,D),u==null||u(),g(D))},A=()=>new Promise(D=>{var R;u=O=>{(l||S())&&D(O)},(R=s.onPause)==null||R.call(s)}).then(()=>{var D;u=void 0,l||(D=s.onContinue)==null||D.call(s)}),F=()=>{if(l)return;let D;const R=a===0?s.initialPromise:void 0;try{D=R??s.fn()}catch(O){D=Promise.reject(O)}Promise.resolve(D).then(j).catch(O=>{var q;if(l)return;const V=s.retry??(Xx?0:3),G=s.retryDelay??Gue,J=typeof G=="function"?G(a,O):G,$=V===!0||typeof V=="number"&&a<V||typeof V=="function"&&V(a,O);if(n||!$){B(O);return}a++,(q=s.onFail)==null||q.call(s,a,O),Mue(J).then(()=>S()?void 0:A()).then(()=>{n?B(O):F()})})};return{promise:v,cancel:y,continue:()=>(u==null||u(),v),cancelRetry:w,continueRetry:T,canStart:I,start:()=>(I()?F():A().then(F),v)}}function Hue(){let s=[],n=0,a=I=>{I()},l=I=>{I()},u=I=>setTimeout(I,0);const f=I=>{u=I},g=I=>{let j;n++;try{j=I()}finally{n--,n||w()}return j},v=I=>{n?s.push(I):u(()=>{a(I)})},y=I=>(...j)=>{v(()=>{I(...j)})},w=()=>{const I=s;s=[],I.length&&u(()=>{l(()=>{I.forEach(j=>{a(j)})})})};return{batch:g,batchCalls:y,schedule:v,setNotifyFunction:I=>{a=I},setBatchNotifyFunction:I=>{l=I},setScheduler:f}}var Gn=Hue(),Xd,N7,e9=(N7=class{constructor(){Lr(this,Xd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),kue(this.gcTime)&&sr(this,Xd,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(s){this.gcTime=Math.max(this.gcTime||0,s??(Xx?1/0:5*60*1e3))}clearGcTimeout(){qe(this,Xd)&&(clearTimeout(qe(this,Xd)),sr(this,Xd,void 0))}},Xd=new WeakMap,N7),yp,xp,ma,An,Bg,Jd,Za,hc,A7,zue=(A7=class extends e9{constructor(n){super();Lr(this,Za);Lr(this,yp);Lr(this,xp);Lr(this,ma);Lr(this,An);Lr(this,Bg);Lr(this,Jd);sr(this,Jd,!1),sr(this,Bg,n.defaultOptions),this.setOptions(n.options),this.observers=[],sr(this,ma,n.cache),this.queryKey=n.queryKey,this.queryHash=n.queryHash,sr(this,yp,n.state||que(this.options)),this.state=qe(this,yp),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var n;return(n=qe(this,An))==null?void 0:n.promise}setOptions(n){this.options={...qe(this,Bg),...n},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&qe(this,ma).remove(this)}setData(n,a){const l=Fue(this.state.data,n,this.options);return Tn(this,Za,hc).call(this,{data:l,type:"success",dataUpdatedAt:a==null?void 0:a.updatedAt,manual:a==null?void 0:a.manual}),l}setState(n,a){Tn(this,Za,hc).call(this,{type:"setState",state:n,setStateOptions:a})}cancel(n){var l,u;const a=(l=qe(this,An))==null?void 0:l.promise;return(u=qe(this,An))==null||u.cancel(n),a?a.then(Qa).catch(Qa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(qe(this,yp))}isActive(){return this.observers.some(n=>Lue(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(n=0){return this.state.isInvalidated||this.state.data===void 0||!jue(this.state.dataUpdatedAt,n)}onFocus(){var a;const n=this.observers.find(l=>l.shouldFetchOnWindowFocus());n==null||n.refetch({cancelRefetch:!1}),(a=qe(this,An))==null||a.continue()}onOnline(){var a;const n=this.observers.find(l=>l.shouldFetchOnReconnect());n==null||n.refetch({cancelRefetch:!1}),(a=qe(this,An))==null||a.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),qe(this,ma).notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(a=>a!==n),this.observers.length||(qe(this,An)&&(qe(this,Jd)?qe(this,An).cancel({revert:!0}):qe(this,An).cancelRetry()),this.scheduleGc()),qe(this,ma).notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Tn(this,Za,hc).call(this,{type:"invalidate"})}fetch(n,a){var y,w,T;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(a!=null&&a.cancelRefetch))this.cancel({silent:!0});else if(qe(this,An))return qe(this,An).continueRetry(),qe(this,An).promise}if(n&&this.setOptions(n),!this.options.queryFn){const S=this.observers.find(I=>I.options.queryFn);S&&this.setOptions(S.options)}const l=new AbortController,u=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(sr(this,Jd,!0),l.signal)})},f=()=>{const S=$8(this.options,a),I={queryKey:this.queryKey,meta:this.meta};return u(I),sr(this,Jd,!1),this.options.persister?this.options.persister(S,I,this):S(I)},g={fetchOptions:a,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:f};u(g),(y=this.options.behavior)==null||y.onFetch(g,this),sr(this,xp,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((w=g.fetchOptions)==null?void 0:w.meta))&&Tn(this,Za,hc).call(this,{type:"fetch",meta:(T=g.fetchOptions)==null?void 0:T.meta});const v=S=>{var I,j,B,A;QT(S)&&S.silent||Tn(this,Za,hc).call(this,{type:"error",error:S}),QT(S)||((j=(I=qe(this,ma).config).onError)==null||j.call(I,S,this),(A=(B=qe(this,ma).config).onSettled)==null||A.call(B,this.state.data,S,this)),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return sr(this,An,Z8({initialPromise:a==null?void 0:a.initialPromise,fn:g.fetchFn,abort:l.abort.bind(l),onSuccess:S=>{var I,j,B,A;if(S===void 0){v(new Error(`${this.queryHash} data is undefined`));return}this.setData(S),(j=(I=qe(this,ma).config).onSuccess)==null||j.call(I,S,this),(A=(B=qe(this,ma).config).onSettled)==null||A.call(B,S,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:v,onFail:(S,I)=>{Tn(this,Za,hc).call(this,{type:"failed",failureCount:S,error:I})},onPause:()=>{Tn(this,Za,hc).call(this,{type:"pause"})},onContinue:()=>{Tn(this,Za,hc).call(this,{type:"continue"})},retry:g.options.retry,retryDelay:g.options.retryDelay,networkMode:g.options.networkMode,canRun:()=>!0})),qe(this,An).start()}},yp=new WeakMap,xp=new WeakMap,ma=new WeakMap,An=new WeakMap,Bg=new WeakMap,Jd=new WeakMap,Za=new WeakSet,hc=function(n){const a=l=>{switch(n.type){case"failed":return{...l,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...l,fetchStatus:"paused"};case"continue":return{...l,fetchStatus:"fetching"};case"fetch":return{...l,...Kue(l.data,this.options),fetchMeta:n.meta??null};case"success":return{...l,data:n.data,dataUpdateCount:l.dataUpdateCount+1,dataUpdatedAt:n.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const u=n.error;return QT(u)&&u.revert&&qe(this,xp)?{...qe(this,xp),fetchStatus:"idle"}:{...l,error:u,errorUpdateCount:l.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:l.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...l,isInvalidated:!0};case"setState":return{...l,...n.state}}};this.state=a(this.state),Gn.batch(()=>{this.observers.forEach(l=>{l.onQueryUpdate()}),qe(this,ma).notify({query:this,type:"updated",action:n})})},A7);function Kue(s,n){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:J8(n.networkMode)?"fetching":"paused",...s===void 0&&{error:null,status:"pending"}}}function que(s){const n=typeof s.initialData=="function"?s.initialData():s.initialData,a=n!==void 0,l=a?typeof s.initialDataUpdatedAt=="function"?s.initialDataUpdatedAt():s.initialDataUpdatedAt:0;return{data:n,dataUpdateCount:0,dataUpdatedAt:a?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:a?"success":"pending",fetchStatus:"idle"}}var Lo,I7,Yue=(I7=class extends $x{constructor(n={}){super();Lr(this,Lo);this.config=n,sr(this,Lo,new Map)}build(n,a,l){const u=a.queryKey,f=a.queryHash??tI(u,a);let g=this.get(f);return g||(g=new zue({cache:this,queryKey:u,queryHash:f,options:n.defaultQueryOptions(a),state:l,defaultOptions:n.getQueryDefaults(u)}),this.add(g)),g}add(n){qe(this,Lo).has(n.queryHash)||(qe(this,Lo).set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const a=qe(this,Lo).get(n.queryHash);a&&(n.destroy(),a===n&&qe(this,Lo).delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){Gn.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return qe(this,Lo).get(n)}getAll(){return[...qe(this,Lo).values()]}find(n){const a={exact:!0,...n};return this.getAll().find(l=>cB(a,l))}findAll(n={}){const a=this.getAll();return Object.keys(n).length>0?a.filter(l=>cB(n,l)):a}notify(n){Gn.batch(()=>{this.listeners.forEach(a=>{a(n)})})}onFocus(){Gn.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){Gn.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},Lo=new WeakMap,I7),Mo,Bn,Qd,Fo,cl,O7,$ue=(O7=class extends e9{constructor(n){super();Lr(this,Fo);Lr(this,Mo);Lr(this,Bn);Lr(this,Qd);this.mutationId=n.mutationId,sr(this,Bn,n.mutationCache),sr(this,Mo,[]),this.state=n.state||Xue(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){qe(this,Mo).includes(n)||(qe(this,Mo).push(n),this.clearGcTimeout(),qe(this,Bn).notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){sr(this,Mo,qe(this,Mo).filter(a=>a!==n)),this.scheduleGc(),qe(this,Bn).notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){qe(this,Mo).length||(this.state.status==="pending"?this.scheduleGc():qe(this,Bn).remove(this))}continue(){var n;return((n=qe(this,Qd))==null?void 0:n.continue())??this.execute(this.state.variables)}async execute(n){var u,f,g,v,y,w,T,S,I,j,B,A,F,D,R,O,V,G,J,$;sr(this,Qd,Z8({fn:()=>this.options.mutationFn?this.options.mutationFn(n):Promise.reject(new Error("No mutationFn found")),onFail:(q,ee)=>{Tn(this,Fo,cl).call(this,{type:"failed",failureCount:q,error:ee})},onPause:()=>{Tn(this,Fo,cl).call(this,{type:"pause"})},onContinue:()=>{Tn(this,Fo,cl).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>qe(this,Bn).canRun(this)}));const a=this.state.status==="pending",l=!qe(this,Qd).canStart();try{if(!a){Tn(this,Fo,cl).call(this,{type:"pending",variables:n,isPaused:l}),await((f=(u=qe(this,Bn).config).onMutate)==null?void 0:f.call(u,n,this));const ee=await((v=(g=this.options).onMutate)==null?void 0:v.call(g,n));ee!==this.state.context&&Tn(this,Fo,cl).call(this,{type:"pending",context:ee,variables:n,isPaused:l})}const q=await qe(this,Qd).start();return await((w=(y=qe(this,Bn).config).onSuccess)==null?void 0:w.call(y,q,n,this.state.context,this)),await((S=(T=this.options).onSuccess)==null?void 0:S.call(T,q,n,this.state.context)),await((j=(I=qe(this,Bn).config).onSettled)==null?void 0:j.call(I,q,null,this.state.variables,this.state.context,this)),await((A=(B=this.options).onSettled)==null?void 0:A.call(B,q,null,n,this.state.context)),Tn(this,Fo,cl).call(this,{type:"success",data:q}),q}catch(q){try{throw await((D=(F=qe(this,Bn).config).onError)==null?void 0:D.call(F,q,n,this.state.context,this)),await((O=(R=this.options).onError)==null?void 0:O.call(R,q,n,this.state.context)),await((G=(V=qe(this,Bn).config).onSettled)==null?void 0:G.call(V,void 0,q,this.state.variables,this.state.context,this)),await(($=(J=this.options).onSettled)==null?void 0:$.call(J,void 0,q,n,this.state.context)),q}finally{Tn(this,Fo,cl).call(this,{type:"error",error:q})}}finally{qe(this,Bn).runNext(this)}}},Mo=new WeakMap,Bn=new WeakMap,Qd=new WeakMap,Fo=new WeakSet,cl=function(n){const a=l=>{switch(n.type){case"failed":return{...l,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...l,isPaused:!0};case"continue":return{...l,isPaused:!1};case"pending":return{...l,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...l,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...l,data:void 0,error:n.error,failureCount:l.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=a(this.state),Gn.batch(()=>{qe(this,Mo).forEach(l=>{l.onMutationUpdate(n)}),qe(this,Bn).notify({mutation:this,type:"updated",action:n})})},O7);function Xue(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ki,Wg,D7,Jue=(D7=class extends $x{constructor(n={}){super();Lr(this,ki);Lr(this,Wg);this.config=n,sr(this,ki,new Map),sr(this,Wg,Date.now())}build(n,a,l){const u=new $ue({mutationCache:this,mutationId:++ry(this,Wg)._,options:n.defaultMutationOptions(a),state:l});return this.add(u),u}add(n){const a=yy(n),l=qe(this,ki).get(a)??[];l.push(n),qe(this,ki).set(a,l),this.notify({type:"added",mutation:n})}remove(n){var l;const a=yy(n);if(qe(this,ki).has(a)){const u=(l=qe(this,ki).get(a))==null?void 0:l.filter(f=>f!==n);u&&(u.length===0?qe(this,ki).delete(a):qe(this,ki).set(a,u))}this.notify({type:"removed",mutation:n})}canRun(n){var l;const a=(l=qe(this,ki).get(yy(n)))==null?void 0:l.find(u=>u.state.status==="pending");return!a||a===n}runNext(n){var l;const a=(l=qe(this,ki).get(yy(n)))==null?void 0:l.find(u=>u!==n&&u.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}clear(){Gn.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}getAll(){return[...qe(this,ki).values()].flat()}find(n){const a={exact:!0,...n};return this.getAll().find(l=>lB(a,l))}findAll(n={}){return this.getAll().filter(a=>lB(n,a))}notify(n){Gn.batch(()=>{this.listeners.forEach(a=>{a(n)})})}resumePausedMutations(){const n=this.getAll().filter(a=>a.state.isPaused);return Gn.batch(()=>Promise.all(n.map(a=>a.continue().catch(Qa))))}},ki=new WeakMap,Wg=new WeakMap,D7);function yy(s){var n;return((n=s.options.scope)==null?void 0:n.id)??String(s.mutationId)}function Que(s){return{onFetch:(n,a)=>{const l=async()=>{var B,A,F,D,R;const u=n.options,f=(F=(A=(B=n.fetchOptions)==null?void 0:B.meta)==null?void 0:A.fetchMore)==null?void 0:F.direction,g=((D=n.state.data)==null?void 0:D.pages)||[],v=((R=n.state.data)==null?void 0:R.pageParams)||[],y={pages:[],pageParams:[]};let w=!1;const T=O=>{Object.defineProperty(O,"signal",{enumerable:!0,get:()=>(n.signal.aborted?w=!0:n.signal.addEventListener("abort",()=>{w=!0}),n.signal)})},S=$8(n.options,n.fetchOptions),I=async(O,V,G)=>{if(w)return Promise.reject();if(V==null&&O.pages.length)return Promise.resolve(O);const J={queryKey:n.queryKey,pageParam:V,direction:G?"backward":"forward",meta:n.options.meta};T(J);const $=await S(J),{maxPages:q}=n.options,ee=G?Vue:Uue;return{pages:ee(O.pages,$,q),pageParams:ee(O.pageParams,V,q)}};let j;if(f&&g.length){const O=f==="backward",V=O?Zue:hB,G={pages:g,pageParams:v},J=V(u,G);j=await I(G,J,O)}else{j=await I(y,v[0]??u.initialPageParam);const O=s??g.length;for(let V=1;V<O;V++){const G=hB(u,j);j=await I(j,G)}}return j};n.options.persister?n.fetchFn=()=>{var u,f;return(f=(u=n.options).persister)==null?void 0:f.call(u,l,{queryKey:n.queryKey,meta:n.options.meta,signal:n.signal},a)}:n.fetchFn=l}}}function hB(s,{pages:n,pageParams:a}){const l=n.length-1;return s.getNextPageParam(n[l],n,a[l],a)}function Zue(s,{pages:n,pageParams:a}){var l;return(l=s.getPreviousPageParam)==null?void 0:l.call(s,n[0],n,a[0],a)}var Rs,xl,bl,bp,wp,wl,Sp,Cp,P7,ehe=(P7=class{constructor(s={}){Lr(this,Rs);Lr(this,xl);Lr(this,bl);Lr(this,bp);Lr(this,wp);Lr(this,wl);Lr(this,Sp);Lr(this,Cp);sr(this,Rs,s.queryCache||new Yue),sr(this,xl,s.mutationCache||new Jue),sr(this,bl,s.defaultOptions||{}),sr(this,bp,new Map),sr(this,wp,new Map),sr(this,wl,0)}mount(){ry(this,wl)._++,qe(this,wl)===1&&(sr(this,Sp,X8.subscribe(async s=>{s&&(await this.resumePausedMutations(),qe(this,Rs).onFocus())})),sr(this,Cp,yx.subscribe(async s=>{s&&(await this.resumePausedMutations(),qe(this,Rs).onOnline())})))}unmount(){var s,n;ry(this,wl)._--,qe(this,wl)===0&&((s=qe(this,Sp))==null||s.call(this),sr(this,Sp,void 0),(n=qe(this,Cp))==null||n.call(this),sr(this,Cp,void 0))}isFetching(s){return qe(this,Rs).findAll({...s,fetchStatus:"fetching"}).length}isMutating(s){return qe(this,xl).findAll({...s,status:"pending"}).length}getQueryData(s){var a;const n=this.defaultQueryOptions({queryKey:s});return(a=qe(this,Rs).get(n.queryHash))==null?void 0:a.state.data}ensureQueryData(s){const n=this.getQueryData(s.queryKey);if(n===void 0)return this.fetchQuery(s);{const a=this.defaultQueryOptions(s),l=qe(this,Rs).build(this,a);return s.revalidateIfStale&&l.isStaleByTime(oB(a.staleTime,l))&&this.prefetchQuery(a),Promise.resolve(n)}}getQueriesData(s){return qe(this,Rs).findAll(s).map(({queryKey:n,state:a})=>{const l=a.data;return[n,l]})}setQueryData(s,n,a){const l=this.defaultQueryOptions({queryKey:s}),u=qe(this,Rs).get(l.queryHash),f=u==null?void 0:u.state.data,g=Pue(n,f);if(g!==void 0)return qe(this,Rs).build(this,l).setData(g,{...a,manual:!0})}setQueriesData(s,n,a){return Gn.batch(()=>qe(this,Rs).findAll(s).map(({queryKey:l})=>[l,this.setQueryData(l,n,a)]))}getQueryState(s){var a;const n=this.defaultQueryOptions({queryKey:s});return(a=qe(this,Rs).get(n.queryHash))==null?void 0:a.state}removeQueries(s){const n=qe(this,Rs);Gn.batch(()=>{n.findAll(s).forEach(a=>{n.remove(a)})})}resetQueries(s,n){const a=qe(this,Rs),l={type:"active",...s};return Gn.batch(()=>(a.findAll(s).forEach(u=>{u.reset()}),this.refetchQueries(l,n)))}cancelQueries(s={},n={}){const a={revert:!0,...n},l=Gn.batch(()=>qe(this,Rs).findAll(s).map(u=>u.cancel(a)));return Promise.all(l).then(Qa).catch(Qa)}invalidateQueries(s={},n={}){return Gn.batch(()=>{if(qe(this,Rs).findAll(s).forEach(l=>{l.invalidate()}),s.refetchType==="none")return Promise.resolve();const a={...s,type:s.refetchType??s.type??"active"};return this.refetchQueries(a,n)})}refetchQueries(s={},n){const a={...n,cancelRefetch:(n==null?void 0:n.cancelRefetch)??!0},l=Gn.batch(()=>qe(this,Rs).findAll(s).filter(u=>!u.isDisabled()).map(u=>{let f=u.fetch(void 0,a);return a.throwOnError||(f=f.catch(Qa)),u.state.fetchStatus==="paused"?Promise.resolve():f}));return Promise.all(l).then(Qa)}fetchQuery(s){const n=this.defaultQueryOptions(s);n.retry===void 0&&(n.retry=!1);const a=qe(this,Rs).build(this,n);return a.isStaleByTime(oB(n.staleTime,a))?a.fetch(n):Promise.resolve(a.state.data)}prefetchQuery(s){return this.fetchQuery(s).then(Qa).catch(Qa)}fetchInfiniteQuery(s){return s.behavior=Que(s.pages),this.fetchQuery(s)}prefetchInfiniteQuery(s){return this.fetchInfiniteQuery(s).then(Qa).catch(Qa)}resumePausedMutations(){return yx.isOnline()?qe(this,xl).resumePausedMutations():Promise.resolve()}getQueryCache(){return qe(this,Rs)}getMutationCache(){return qe(this,xl)}getDefaultOptions(){return qe(this,bl)}setDefaultOptions(s){sr(this,bl,s)}setQueryDefaults(s,n){qe(this,bp).set(Ag(s),{queryKey:s,defaultOptions:n})}getQueryDefaults(s){const n=[...qe(this,bp).values()];let a={};return n.forEach(l=>{Ig(s,l.queryKey)&&(a={...a,...l.defaultOptions})}),a}setMutationDefaults(s,n){qe(this,wp).set(Ag(s),{mutationKey:s,defaultOptions:n})}getMutationDefaults(s){const n=[...qe(this,wp).values()];let a={};return n.forEach(l=>{Ig(s,l.mutationKey)&&(a={...a,...l.defaultOptions})}),a}defaultQueryOptions(s){if(s._defaulted)return s;const n={...qe(this,bl).queries,...this.getQueryDefaults(s.queryKey),...s,_defaulted:!0};return n.queryHash||(n.queryHash=tI(n.queryKey,n)),n.refetchOnReconnect===void 0&&(n.refetchOnReconnect=n.networkMode!=="always"),n.throwOnError===void 0&&(n.throwOnError=!!n.suspense),!n.networkMode&&n.persister&&(n.networkMode="offlineFirst"),n.enabled!==!0&&n.queryFn===Y8&&(n.enabled=!1),n}defaultMutationOptions(s){return s!=null&&s._defaulted?s:{...qe(this,bl).mutations,...(s==null?void 0:s.mutationKey)&&this.getMutationDefaults(s.mutationKey),...s,_defaulted:!0}}clear(){qe(this,Rs).clear(),qe(this,xl).clear()}},Rs=new WeakMap,xl=new WeakMap,bl=new WeakMap,bp=new WeakMap,wp=new WeakMap,wl=new WeakMap,Sp=new WeakMap,Cp=new WeakMap,P7),the=L.createContext(void 0),rhe=({client:s,children:n})=>(L.useEffect(()=>(s.mount(),()=>{s.unmount()}),[s]),o.jsx(the.Provider,{value:s,children:n}));/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Og(){return Og=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(s[l]=a[l])}return s},Og.apply(this,arguments)}var Tl;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(Tl||(Tl={}));const pB="popstate";function she(s){s===void 0&&(s={});function n(l,u){let{pathname:f,search:g,hash:v}=l.location;return TN("",{pathname:f,search:g,hash:v},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function a(l,u){return typeof u=="string"?u:xx(u)}return ihe(n,a,null,s)}function vs(s,n){if(s===!1||s===null||typeof s>"u")throw new Error(n)}function t9(s,n){if(!s){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function nhe(){return Math.random().toString(36).substr(2,8)}function fB(s,n){return{usr:s.state,key:s.key,idx:n}}function TN(s,n,a,l){return a===void 0&&(a=null),Og({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof n=="string"?Wp(n):n,{state:a,key:n&&n.key||l||nhe()})}function xx(s){let{pathname:n="/",search:a="",hash:l=""}=s;return a&&a!=="?"&&(n+=a.charAt(0)==="?"?a:"?"+a),l&&l!=="#"&&(n+=l.charAt(0)==="#"?l:"#"+l),n}function Wp(s){let n={};if(s){let a=s.indexOf("#");a>=0&&(n.hash=s.substr(a),s=s.substr(0,a));let l=s.indexOf("?");l>=0&&(n.search=s.substr(l),s=s.substr(0,l)),s&&(n.pathname=s)}return n}function ihe(s,n,a,l){l===void 0&&(l={});let{window:u=document.defaultView,v5Compat:f=!1}=l,g=u.history,v=Tl.Pop,y=null,w=T();w==null&&(w=0,g.replaceState(Og({},g.state,{idx:w}),""));function T(){return(g.state||{idx:null}).idx}function S(){v=Tl.Pop;let F=T(),D=F==null?null:F-w;w=F,y&&y({action:v,location:A.location,delta:D})}function I(F,D){v=Tl.Push;let R=TN(A.location,F,D);w=T()+1;let O=fB(R,w),V=A.createHref(R);try{g.pushState(O,"",V)}catch(G){if(G instanceof DOMException&&G.name==="DataCloneError")throw G;u.location.assign(V)}f&&y&&y({action:v,location:A.location,delta:1})}function j(F,D){v=Tl.Replace;let R=TN(A.location,F,D);w=T();let O=fB(R,w),V=A.createHref(R);g.replaceState(O,"",V),f&&y&&y({action:v,location:A.location,delta:0})}function B(F){let D=u.location.origin!=="null"?u.location.origin:u.location.href,R=typeof F=="string"?F:xx(F);return R=R.replace(/ $/,"%20"),vs(D,"No window.location.(origin|href) available to create URL for href: "+R),new URL(R,D)}let A={get action(){return v},get location(){return s(u,g)},listen(F){if(y)throw new Error("A history only accepts one active listener");return u.addEventListener(pB,S),y=F,()=>{u.removeEventListener(pB,S),y=null}},createHref(F){return n(u,F)},createURL:B,encodeLocation(F){let D=B(F);return{pathname:D.pathname,search:D.search,hash:D.hash}},push:I,replace:j,go(F){return g.go(F)}};return A}var mB;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(mB||(mB={}));function ahe(s,n,a){return a===void 0&&(a="/"),ohe(s,n,a)}function ohe(s,n,a,l){let u=typeof n=="string"?Wp(n):n,f=Pp(u.pathname||"/",a);if(f==null)return null;let g=r9(s);che(g);let v=null;for(let y=0;v==null&&y<g.length;++y){let w=vhe(f);v=_he(g[y],w)}return v}function r9(s,n,a,l){n===void 0&&(n=[]),a===void 0&&(a=[]),l===void 0&&(l="");let u=(f,g,v)=>{let y={relativePath:v===void 0?f.path||"":v,caseSensitive:f.caseSensitive===!0,childrenIndex:g,route:f};y.relativePath.startsWith("/")&&(vs(y.relativePath.startsWith(l),'Absolute route path "'+y.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),y.relativePath=y.relativePath.slice(l.length));let w=Ll([l,y.relativePath]),T=a.concat(y);f.children&&f.children.length>0&&(vs(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),r9(f.children,n,T,w)),!(f.path==null&&!f.index)&&n.push({path:w,score:mhe(w,f.index),routesMeta:T})};return s.forEach((f,g)=>{var v;if(f.path===""||!((v=f.path)!=null&&v.includes("?")))u(f,g);else for(let y of s9(f.path))u(f,g,y)}),n}function s9(s){let n=s.split("/");if(n.length===0)return[];let[a,...l]=n,u=a.endsWith("?"),f=a.replace(/\?$/,"");if(l.length===0)return u?[f,""]:[f];let g=s9(l.join("/")),v=[];return v.push(...g.map(y=>y===""?f:[f,y].join("/"))),u&&v.push(...g),v.map(y=>s.startsWith("/")&&y===""?"/":y)}function che(s){s.sort((n,a)=>n.score!==a.score?a.score-n.score:ghe(n.routesMeta.map(l=>l.childrenIndex),a.routesMeta.map(l=>l.childrenIndex)))}const lhe=/^:[\w-]+$/,dhe=3,uhe=2,hhe=1,phe=10,fhe=-2,gB=s=>s==="*";function mhe(s,n){let a=s.split("/"),l=a.length;return a.some(gB)&&(l+=fhe),n&&(l+=uhe),a.filter(u=>!gB(u)).reduce((u,f)=>u+(lhe.test(f)?dhe:f===""?hhe:phe),l)}function ghe(s,n){return s.length===n.length&&s.slice(0,-1).every((l,u)=>l===n[u])?s[s.length-1]-n[n.length-1]:0}function _he(s,n,a){let{routesMeta:l}=s,u={},f="/",g=[];for(let v=0;v<l.length;++v){let y=l[v],w=v===l.length-1,T=f==="/"?n:n.slice(f.length)||"/",S=RN({path:y.relativePath,caseSensitive:y.caseSensitive,end:w},T),I=y.route;if(!S)return null;Object.assign(u,S.params),g.push({params:u,pathname:Ll([f,S.pathname]),pathnameBase:whe(Ll([f,S.pathnameBase])),route:I}),S.pathnameBase!=="/"&&(f=Ll([f,S.pathnameBase]))}return g}function RN(s,n){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[a,l]=Ehe(s.path,s.caseSensitive,s.end),u=n.match(a);if(!u)return null;let f=u[0],g=f.replace(/(.)\/+$/,"$1"),v=u.slice(1);return{params:l.reduce((w,T,S)=>{let{paramName:I,isOptional:j}=T;if(I==="*"){let A=v[S]||"";g=f.slice(0,f.length-A.length).replace(/(.)\/+$/,"$1")}const B=v[S];return j&&!B?w[I]=void 0:w[I]=(B||"").replace(/%2F/g,"/"),w},{}),pathname:f,pathnameBase:g,pattern:s}}function Ehe(s,n,a){n===void 0&&(n=!1),a===void 0&&(a=!0),t9(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let l=[],u="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,v,y)=>(l.push({paramName:v,isOptional:y!=null}),y?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(l.push({paramName:"*"}),u+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?u+="\\/*$":s!==""&&s!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,n?void 0:"i"),l]}function vhe(s){try{return s.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return t9(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),s}}function Pp(s,n){if(n==="/")return s;if(!s.toLowerCase().startsWith(n.toLowerCase()))return null;let a=n.endsWith("/")?n.length-1:n.length,l=s.charAt(a);return l&&l!=="/"?null:s.slice(a)||"/"}function yhe(s,n){n===void 0&&(n="/");let{pathname:a,search:l="",hash:u=""}=typeof s=="string"?Wp(s):s;return{pathname:a?a.startsWith("/")?a:xhe(a,n):n,search:She(l),hash:Che(u)}}function xhe(s,n){let a=n.replace(/\/+$/,"").split("/");return s.split("/").forEach(u=>{u===".."?a.length>1&&a.pop():u!=="."&&a.push(u)}),a.length>1?a.join("/"):"/"}function ZT(s,n,a,l){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function bhe(s){return s.filter((n,a)=>a===0||n.route.path&&n.route.path.length>0)}function rI(s,n){let a=bhe(s);return n?a.map((l,u)=>u===a.length-1?l.pathname:l.pathnameBase):a.map(l=>l.pathnameBase)}function sI(s,n,a,l){l===void 0&&(l=!1);let u;typeof s=="string"?u=Wp(s):(u=Og({},s),vs(!u.pathname||!u.pathname.includes("?"),ZT("?","pathname","search",u)),vs(!u.pathname||!u.pathname.includes("#"),ZT("#","pathname","hash",u)),vs(!u.search||!u.search.includes("#"),ZT("#","search","hash",u)));let f=s===""||u.pathname==="",g=f?"/":u.pathname,v;if(g==null)v=a;else{let S=n.length-1;if(!l&&g.startsWith("..")){let I=g.split("/");for(;I[0]==="..";)I.shift(),S-=1;u.pathname=I.join("/")}v=S>=0?n[S]:"/"}let y=yhe(u,v),w=g&&g!=="/"&&g.endsWith("/"),T=(f||g===".")&&a.endsWith("/");return!y.pathname.endsWith("/")&&(w||T)&&(y.pathname+="/"),y}const Ll=s=>s.join("/").replace(/\/\/+/g,"/"),whe=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),She=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,Che=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function The(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const n9=["post","put","patch","delete"];new Set(n9);const Rhe=["get",...n9];new Set(Rhe);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dg(){return Dg=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(s[l]=a[l])}return s},Dg.apply(this,arguments)}const Jx=L.createContext(null),i9=L.createContext(null),Cc=L.createContext(null),Qx=L.createContext(null),zo=L.createContext({outlet:null,matches:[],isDataRoute:!1}),a9=L.createContext(null);function Nhe(s,n){let{relative:a}=n===void 0?{}:n;Gp()||vs(!1);let{basename:l,navigator:u}=L.useContext(Cc),{hash:f,pathname:g,search:v}=Zx(s,{relative:a}),y=g;return l!=="/"&&(y=g==="/"?l:Ll([l,g])),u.createHref({pathname:y,search:v,hash:f})}function Gp(){return L.useContext(Qx)!=null}function Tc(){return Gp()||vs(!1),L.useContext(Qx).location}function o9(s){L.useContext(Cc).static||L.useLayoutEffect(s)}function Fs(){let{isDataRoute:s}=L.useContext(zo);return s?Ghe():Ahe()}function Ahe(){Gp()||vs(!1);let s=L.useContext(Jx),{basename:n,future:a,navigator:l}=L.useContext(Cc),{matches:u}=L.useContext(zo),{pathname:f}=Tc(),g=JSON.stringify(rI(u,a.v7_relativeSplatPath)),v=L.useRef(!1);return o9(()=>{v.current=!0}),L.useCallback(function(w,T){if(T===void 0&&(T={}),!v.current)return;if(typeof w=="number"){l.go(w);return}let S=sI(w,JSON.parse(g),f,T.relative==="path");s==null&&n!=="/"&&(S.pathname=S.pathname==="/"?n:Ll([n,S.pathname])),(T.replace?l.replace:l.push)(S,T.state,T)},[n,l,g,f,s])}const Ihe=L.createContext(null);function Ohe(s){let n=L.useContext(zo).outlet;return n&&L.createElement(Ihe.Provider,{value:s},n)}function nI(){let{matches:s}=L.useContext(zo),n=s[s.length-1];return n?n.params:{}}function Zx(s,n){let{relative:a}=n===void 0?{}:n,{future:l}=L.useContext(Cc),{matches:u}=L.useContext(zo),{pathname:f}=Tc(),g=JSON.stringify(rI(u,l.v7_relativeSplatPath));return L.useMemo(()=>sI(s,JSON.parse(g),f,a==="path"),[s,g,f,a])}function Dhe(s,n){return Phe(s,n)}function Phe(s,n,a,l){Gp()||vs(!1);let{navigator:u}=L.useContext(Cc),{matches:f}=L.useContext(zo),g=f[f.length-1],v=g?g.params:{};g&&g.pathname;let y=g?g.pathnameBase:"/";g&&g.route;let w=Tc(),T;if(n){var S;let F=typeof n=="string"?Wp(n):n;y==="/"||(S=F.pathname)!=null&&S.startsWith(y)||vs(!1),T=F}else T=w;let I=T.pathname||"/",j=I;if(y!=="/"){let F=y.replace(/^\//,"").split("/");j="/"+I.replace(/^\//,"").split("/").slice(F.length).join("/")}let B=ahe(s,{pathname:j}),A=Fhe(B&&B.map(F=>Object.assign({},F,{params:Object.assign({},v,F.params),pathname:Ll([y,u.encodeLocation?u.encodeLocation(F.pathname).pathname:F.pathname]),pathnameBase:F.pathnameBase==="/"?y:Ll([y,u.encodeLocation?u.encodeLocation(F.pathnameBase).pathname:F.pathnameBase])})),f,a,l);return n&&A?L.createElement(Qx.Provider,{value:{location:Dg({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:Tl.Pop}},A):A}function khe(){let s=Whe(),n=The(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),a=s instanceof Error?s.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return L.createElement(L.Fragment,null,L.createElement("h2",null,"Unexpected Application Error!"),L.createElement("h3",{style:{fontStyle:"italic"}},n),a?L.createElement("pre",{style:u},a):null,null)}const jhe=L.createElement(khe,null);class Lhe extends L.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,a){return a.location!==n.location||a.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:a.error,location:a.location,revalidation:n.revalidation||a.revalidation}}componentDidCatch(n,a){console.error("React Router caught the following error during render",n,a)}render(){return this.state.error!==void 0?L.createElement(zo.Provider,{value:this.props.routeContext},L.createElement(a9.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Mhe(s){let{routeContext:n,match:a,children:l}=s,u=L.useContext(Jx);return u&&u.static&&u.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=a.route.id),L.createElement(zo.Provider,{value:n},l)}function Fhe(s,n,a,l){var u;if(n===void 0&&(n=[]),a===void 0&&(a=null),l===void 0&&(l=null),s==null){var f;if(!a)return null;if(a.errors)s=a.matches;else if((f=l)!=null&&f.v7_partialHydration&&n.length===0&&!a.initialized&&a.matches.length>0)s=a.matches;else return null}let g=s,v=(u=a)==null?void 0:u.errors;if(v!=null){let T=g.findIndex(S=>S.route.id&&(v==null?void 0:v[S.route.id])!==void 0);T>=0||vs(!1),g=g.slice(0,Math.min(g.length,T+1))}let y=!1,w=-1;if(a&&l&&l.v7_partialHydration)for(let T=0;T<g.length;T++){let S=g[T];if((S.route.HydrateFallback||S.route.hydrateFallbackElement)&&(w=T),S.route.id){let{loaderData:I,errors:j}=a,B=S.route.loader&&I[S.route.id]===void 0&&(!j||j[S.route.id]===void 0);if(S.route.lazy||B){y=!0,w>=0?g=g.slice(0,w+1):g=[g[0]];break}}}return g.reduceRight((T,S,I)=>{let j,B=!1,A=null,F=null;a&&(j=v&&S.route.id?v[S.route.id]:void 0,A=S.route.errorElement||jhe,y&&(w<0&&I===0?(Hhe("route-fallback"),B=!0,F=null):w===I&&(B=!0,F=S.route.hydrateFallbackElement||null)));let D=n.concat(g.slice(0,I+1)),R=()=>{let O;return j?O=A:B?O=F:S.route.Component?O=L.createElement(S.route.Component,null):S.route.element?O=S.route.element:O=T,L.createElement(Mhe,{match:S,routeContext:{outlet:T,matches:D,isDataRoute:a!=null},children:O})};return a&&(S.route.ErrorBoundary||S.route.errorElement||I===0)?L.createElement(Lhe,{location:a.location,revalidation:a.revalidation,component:A,error:j,children:R(),routeContext:{outlet:null,matches:D,isDataRoute:!0}}):R()},null)}var c9=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(c9||{}),l9=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(l9||{});function Uhe(s){let n=L.useContext(Jx);return n||vs(!1),n}function Vhe(s){let n=L.useContext(i9);return n||vs(!1),n}function Bhe(s){let n=L.useContext(zo);return n||vs(!1),n}function d9(s){let n=Bhe(),a=n.matches[n.matches.length-1];return a.route.id||vs(!1),a.route.id}function Whe(){var s;let n=L.useContext(a9),a=Vhe(),l=d9();return n!==void 0?n:(s=a.errors)==null?void 0:s[l]}function Ghe(){let{router:s}=Uhe(c9.UseNavigateStable),n=d9(l9.UseNavigateStable),a=L.useRef(!1);return o9(()=>{a.current=!0}),L.useCallback(function(u,f){f===void 0&&(f={}),a.current&&(typeof u=="number"?s.navigate(u):s.navigate(u,Dg({fromRouteId:n},f)))},[s,n])}const _B={};function Hhe(s,n,a){_B[s]||(_B[s]=!0)}function rp(s){let{to:n,replace:a,state:l,relative:u}=s;Gp()||vs(!1);let{future:f,static:g}=L.useContext(Cc),{matches:v}=L.useContext(zo),{pathname:y}=Tc(),w=Fs(),T=sI(n,rI(v,f.v7_relativeSplatPath),y,u==="path"),S=JSON.stringify(T);return L.useEffect(()=>w(JSON.parse(S),{replace:a,state:l,relative:u}),[w,S,u,a,l]),null}function u9(s){return Ohe(s.context)}function ut(s){vs(!1)}function zhe(s){let{basename:n="/",children:a=null,location:l,navigationType:u=Tl.Pop,navigator:f,static:g=!1,future:v}=s;Gp()&&vs(!1);let y=n.replace(/^\/*/,"/"),w=L.useMemo(()=>({basename:y,navigator:f,static:g,future:Dg({v7_relativeSplatPath:!1},v)}),[y,v,f,g]);typeof l=="string"&&(l=Wp(l));let{pathname:T="/",search:S="",hash:I="",state:j=null,key:B="default"}=l,A=L.useMemo(()=>{let F=Pp(T,y);return F==null?null:{location:{pathname:F,search:S,hash:I,state:j,key:B},navigationType:u}},[y,T,S,I,j,B,u]);return A==null?null:L.createElement(Cc.Provider,{value:w},L.createElement(Qx.Provider,{children:a,value:A}))}function Khe(s){let{children:n,location:a}=s;return Dhe(NN(n),a)}new Promise(()=>{});function NN(s,n){n===void 0&&(n=[]);let a=[];return L.Children.forEach(s,(l,u)=>{if(!L.isValidElement(l))return;let f=[...n,u];if(l.type===L.Fragment){a.push.apply(a,NN(l.props.children,f));return}l.type!==ut&&vs(!1),!l.props.index||!l.props.children||vs(!1);let g={id:l.props.id||f.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(g.children=NN(l.props.children,f)),a.push(g)}),a}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bx(){return bx=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(s[l]=a[l])}return s},bx.apply(this,arguments)}function h9(s,n){if(s==null)return{};var a={},l=Object.keys(s),u,f;for(f=0;f<l.length;f++)u=l[f],!(n.indexOf(u)>=0)&&(a[u]=s[u]);return a}function qhe(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function Yhe(s,n){return s.button===0&&(!n||n==="_self")&&!qhe(s)}function AN(s){return s===void 0&&(s=""),new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((n,a)=>{let l=s[a];return n.concat(Array.isArray(l)?l.map(u=>[a,u]):[[a,l]])},[]))}function $he(s,n){let a=AN(s);return n&&n.forEach((l,u)=>{a.has(u)||n.getAll(u).forEach(f=>{a.append(u,f)})}),a}const Xhe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Jhe=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],Qhe="6";try{window.__reactRouterVersion=Qhe}catch{}const Zhe=L.createContext({isTransitioning:!1}),epe="startTransition",EB=xle[epe];function tpe(s){let{basename:n,children:a,future:l,window:u}=s,f=L.useRef();f.current==null&&(f.current=she({window:u,v5Compat:!0}));let g=f.current,[v,y]=L.useState({action:g.action,location:g.location}),{v7_startTransition:w}=l||{},T=L.useCallback(S=>{w&&EB?EB(()=>y(S)):y(S)},[y,w]);return L.useLayoutEffect(()=>g.listen(T),[g,T]),L.createElement(zhe,{basename:n,children:a,location:v.location,navigationType:v.action,navigator:g,future:l})}const rpe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",spe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Rl=L.forwardRef(function(n,a){let{onClick:l,relative:u,reloadDocument:f,replace:g,state:v,target:y,to:w,preventScrollReset:T,unstable_viewTransition:S}=n,I=h9(n,Xhe),{basename:j}=L.useContext(Cc),B,A=!1;if(typeof w=="string"&&spe.test(w)&&(B=w,rpe))try{let O=new URL(window.location.href),V=w.startsWith("//")?new URL(O.protocol+w):new URL(w),G=Pp(V.pathname,j);V.origin===O.origin&&G!=null?w=G+V.search+V.hash:A=!0}catch{}let F=Nhe(w,{relative:u}),D=ipe(w,{replace:g,state:v,target:y,preventScrollReset:T,relative:u,unstable_viewTransition:S});function R(O){l&&l(O),O.defaultPrevented||D(O)}return L.createElement("a",bx({},I,{href:B||F,onClick:A||f?l:R,ref:a,target:y}))}),ll=L.forwardRef(function(n,a){let{"aria-current":l="page",caseSensitive:u=!1,className:f="",end:g=!1,style:v,to:y,unstable_viewTransition:w,children:T}=n,S=h9(n,Jhe),I=Zx(y,{relative:S.relative}),j=Tc(),B=L.useContext(i9),{navigator:A,basename:F}=L.useContext(Cc),D=B!=null&&ape(I)&&w===!0,R=A.encodeLocation?A.encodeLocation(I).pathname:I.pathname,O=j.pathname,V=B&&B.navigation&&B.navigation.location?B.navigation.location.pathname:null;u||(O=O.toLowerCase(),V=V?V.toLowerCase():null,R=R.toLowerCase()),V&&F&&(V=Pp(V,F)||V);const G=R!=="/"&&R.endsWith("/")?R.length-1:R.length;let J=O===R||!g&&O.startsWith(R)&&O.charAt(G)==="/",$=V!=null&&(V===R||!g&&V.startsWith(R)&&V.charAt(R.length)==="/"),q={isActive:J,isPending:$,isTransitioning:D},ee=J?l:void 0,ne;typeof f=="function"?ne=f(q):ne=[f,J?"active":null,$?"pending":null,D?"transitioning":null].filter(Boolean).join(" ");let de=typeof v=="function"?v(q):v;return L.createElement(Rl,bx({},S,{"aria-current":ee,className:ne,ref:a,style:de,to:y,unstable_viewTransition:w}),typeof T=="function"?T(q):T)});var IN;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(IN||(IN={}));var vB;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(vB||(vB={}));function npe(s){let n=L.useContext(Jx);return n||vs(!1),n}function ipe(s,n){let{target:a,replace:l,state:u,preventScrollReset:f,relative:g,unstable_viewTransition:v}=n===void 0?{}:n,y=Fs(),w=Tc(),T=Zx(s,{relative:g});return L.useCallback(S=>{if(Yhe(S,a)){S.preventDefault();let I=l!==void 0?l:xx(w)===xx(T);y(s,{replace:I,state:u,preventScrollReset:f,relative:g,unstable_viewTransition:v})}},[w,y,T,l,u,a,s,f,g,v])}function Yg(s){let n=L.useRef(AN(s)),a=L.useRef(!1),l=Tc(),u=L.useMemo(()=>$he(l.search,a.current?null:n.current),[l.search]),f=Fs(),g=L.useCallback((v,y)=>{const w=AN(typeof v=="function"?v(u):v);a.current=!0,f("?"+w,y)},[f,u]);return[u,g]}function ape(s,n){n===void 0&&(n={});let a=L.useContext(Zhe);a==null&&vs(!1);let{basename:l}=npe(IN.useViewTransitionState),u=Zx(s,{relative:n.relative});if(!a.isTransitioning)return!1;let f=Pp(a.currentLocation.pathname,l)||a.currentLocation.pathname,g=Pp(a.nextLocation.pathname,l)||a.nextLocation.pathname;return RN(u.pathname,g)!=null||RN(u.pathname,f)!=null}function p9(s){var n,a,l="";if(typeof s=="string"||typeof s=="number")l+=s;else if(typeof s=="object")if(Array.isArray(s)){var u=s.length;for(n=0;n<u;n++)s[n]&&(a=p9(s[n]))&&(l&&(l+=" "),l+=a)}else for(a in s)s[a]&&(l&&(l+=" "),l+=a);return l}function Gl(){for(var s,n,a=0,l="",u=arguments.length;a<u;a++)(s=arguments[a])&&(n=p9(s))&&(l&&(l+=" "),l+=n);return l}const ope="inline-flex items-center justify-center rounded-[12px] font-semibold transition-transform duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:cursor-not-allowed",cpe={primary:"bg-[#050014] text-white shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)] hover:-translate-y-[1px] hover:bg-[#140423] active:brightness-110 disabled:bg-[#E9ECEF] disabled:text-[#6C757D]",secondary:"bg-white text-[#C045FF] border-2 border-[#C045FF] hover:bg-[#F4E6FF] hover:text-[#8B3FFF] active:bg-[#8B3FFF] active:text-white disabled:text-[#6C757D] disabled:border-[#E9ECEF] disabled:bg-transparent",ghost:"bg-transparent text-[#C045FF] hover:bg-[#F4E6FF] hover:text-[#8B3FFF] active:bg-[#8B3FFF] active:text-white disabled:text-[#6C757D]",danger:"bg-[#DC3545] text-white hover:bg-[#C82333] shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)] disabled:bg-[#E9ECEF] disabled:text-[#6C757D]"},lpe={md:"h-12 px-6 text-base",sm:"h-10 px-4 text-sm rounded-[8px]",lg:"h-14 px-8 text-lg",icon:"h-12 w-12 rounded-full"},ue=L.forwardRef(({variant:s="primary",size:n="md",leftIcon:a,rightIcon:l,className:u,children:f,...g},v)=>o.jsxs("button",{ref:v,className:Gl(ope,cpe[s],lpe[n],u),...g,children:[a&&o.jsx("span",{className:"mr-2 flex items-center text-lg",children:a}),f,l&&o.jsx("span",{className:"ml-2 flex items-center text-lg",children:l})]}));ue.displayName="Button";const f9="mb-2 block text-sm font-semibold text-[#212529]",m9="mt-1 text-sm text-[#6C757D]",g9="mt-1 text-sm text-[#E63946]",_9="w-full rounded-[8px] border-2 border-[#E9ECEF] bg-white px-4 py-3 text-base transition-colors focus:border-[#FF6B35] focus:shadow-[0_0_0_3px_rgba(255,107,53,0.1)] focus:outline-none disabled:cursor-not-allowed disabled:bg-[#F8F9FA]",nt=L.forwardRef(({label:s,helperText:n,error:a,requiredIndicator:l=!0,className:u,id:f,...g},v)=>{const y=f??g.name;return o.jsxs("div",{className:"flex w-full flex-col",children:[s&&o.jsxs("label",{className:f9,htmlFor:y,children:[s,g.required&&l?o.jsx("span",{className:"ml-1 text-[#E63946]",children:"*"}):null]}),o.jsx("input",{ref:v,id:y,className:Gl(_9,a&&"border-[#E63946] focus:shadow-none",u),...g}),a?o.jsx("span",{className:g9,children:a}):n?o.jsx("span",{className:m9,children:n}):null]})});nt.displayName="TextInput";const ls=L.forwardRef(({label:s,helperText:n,error:a,requiredIndicator:l=!0,className:u,id:f,rows:g=4,...v},y)=>{const w=f??v.name;return o.jsxs("div",{className:"flex w-full flex-col",children:[s&&o.jsxs("label",{className:f9,htmlFor:w,children:[s,v.required&&l?o.jsx("span",{className:"ml-1 text-[#E63946]",children:"*"}):null]}),o.jsx("textarea",{ref:y,id:w,rows:g,className:Gl(_9,"resize-y",a&&"border-[#E63946] focus:shadow-none",u),...v}),a?o.jsx("span",{className:g9,children:a}):n?o.jsx("span",{className:m9,children:n}):null]})});ls.displayName="TextArea";const pe=({elevated:s=!1,className:n,...a})=>o.jsx("div",{className:Gl("rounded-[16px] border border-[#E9ECEF] bg-white p-6 transition-shadow",s?"shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)]":"shadow-[var(--shadow-sm)]",n),...a}),Ne=({title:s,subtitle:n,className:a,children:l,...u})=>o.jsxs("div",{className:Gl("mb-4 flex flex-col gap-1",a),...u,children:[s?o.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:s}):null,n?o.jsx("p",{className:"text-sm text-[#6C757D]",children:n}):null,l]}),be=({className:s,...n})=>o.jsx("div",{className:Gl("flex flex-col gap-4",s),...n}),dpe={default:"bg-[#F8F9FA] text-[#6C757D]",primary:"bg-[#F4E6FF] text-[#C045FF]",success:"bg-[#D4EDDA] text-[#155724]",danger:"bg-[#F8D7DA] text-[#721C24]",warning:"bg-[#FFF3CD] text-[#856404]",live:"bg-[#DC3545] text-white animate-pulse"},Ye=({variant:s="default",pill:n=!0,className:a,...l})=>o.jsx("span",{className:Gl("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-wide",n?"rounded-full":"rounded-[6px]",dpe[s],a),...l});L.createContext(void 0);const upe={sm:"h-8 w-8 text-xs",md:"h-12 w-12 text-sm",lg:"h-16 w-16 text-base",xl:"h-20 w-20 text-lg"},Mi=({src:s,alt:n,initials:a,size:l="md",className:u,badgeColor:f,...g})=>o.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[o.jsx("div",{className:Gl("flex items-center justify-center overflow-hidden rounded-full border-4 border-white bg-[#C045FF] font-semibold uppercase text-white shadow-[var(--shadow-sm)]",upe[l],u),...g,children:s?o.jsx("img",{className:"h-full w-full object-cover",src:s,alt:n}):a??""}),f&&o.jsx("span",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white",style:{backgroundColor:f}})]}),hpe="modulepreload",ppe=function(s){return"/"+s},yB={},kp=function(n,a,l){let u=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),v=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));u=Promise.allSettled(a.map(y=>{if(y=ppe(y),y in yB)return;yB[y]=!0;const w=y.endsWith(".css"),T=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${T}`))return;const S=document.createElement("link");if(S.rel=w?"stylesheet":hpe,w||(S.as="script"),S.crossOrigin="",S.href=y,v&&S.setAttribute("nonce",v),document.head.appendChild(S),w)return new Promise((I,j)=>{S.addEventListener("load",I),S.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${y}`)))})}))}function f(g){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=g,window.dispatchEvent(v),!v.defaultPrevented)throw g}return u.then(g=>{for(const v of g||[])v.status==="rejected"&&f(v.reason);return n().catch(f)})},fpe=s=>{let n;return s?n=s:typeof fetch>"u"?n=(...a)=>kp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...a)):n=fetch,(...a)=>n(...a)};class iI extends Error{constructor(n,a="FunctionsError",l){super(n),this.name=a,this.context=l}}class mpe extends iI{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}}class gpe extends iI{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}}class _pe extends iI{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}}var ON;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(ON||(ON={}));var Epe=function(s,n,a,l){function u(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function v(T){try{w(l.next(T))}catch(S){g(S)}}function y(T){try{w(l.throw(T))}catch(S){g(S)}}function w(T){T.done?f(T.value):u(T.value).then(v,y)}w((l=l.apply(s,n||[])).next())})};class vpe{constructor(n,{headers:a={},customFetch:l,region:u=ON.Any}={}){this.url=n,this.headers=a,this.region=u,this.fetch=fpe(l)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,a={}){var l;return Epe(this,void 0,void 0,function*(){try{const{headers:u,method:f,body:g}=a;let v={},{region:y}=a;y||(y=this.region),y&&y!=="any"&&(v["x-region"]=y);let w;g&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)&&(typeof Blob<"u"&&g instanceof Blob||g instanceof ArrayBuffer?(v["Content-Type"]="application/octet-stream",w=g):typeof g=="string"?(v["Content-Type"]="text/plain",w=g):typeof FormData<"u"&&g instanceof FormData?w=g:(v["Content-Type"]="application/json",w=JSON.stringify(g)));const T=yield this.fetch(`${this.url}/${n}`,{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},v),this.headers),u),body:w}).catch(B=>{throw new mpe(B)}),S=T.headers.get("x-relay-error");if(S&&S==="true")throw new gpe(T);if(!T.ok)throw new _pe(T);let I=((l=T.headers.get("Content-Type"))!==null&&l!==void 0?l:"text/plain").split(";")[0].trim(),j;return I==="application/json"?j=yield T.json():I==="application/octet-stream"?j=yield T.blob():I==="text/event-stream"?j=T:I==="multipart/form-data"?j=yield T.formData():j=yield T.text(),{data:j,error:null}}catch(u){return{data:null,error:u}}})}}var Ea={},aI={},eb={},$g={},tb={},rb={},ype=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},jp=ype();const xpe=jp.fetch,E9=jp.fetch.bind(jp),v9=jp.Headers,bpe=jp.Request,wpe=jp.Response,Hp=Object.freeze(Object.defineProperty({__proto__:null,Headers:v9,Request:bpe,Response:wpe,default:E9,fetch:xpe},Symbol.toStringTag,{value:"Module"})),Spe=ile(Hp);var oI={};Object.defineProperty(oI,"__esModule",{value:!0});class Cpe extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}oI.default=Cpe;var y9=ba&&ba.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(rb,"__esModule",{value:!0});const Tpe=y9(Spe),Rpe=y9(oI);let Npe=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=Tpe.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(n,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const l=this.fetch;let u=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async f=>{var g,v,y;let w=null,T=null,S=null,I=f.status,j=f.statusText;if(f.ok){if(this.method!=="HEAD"){const D=await f.text();D===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?T=D:T=JSON.parse(D))}const A=(g=this.headers.Prefer)===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),F=(v=f.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");A&&F&&F.length>1&&(S=parseInt(F[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(T)&&(T.length>1?(w={code:"PGRST116",details:`Results contain ${T.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},T=null,S=null,I=406,j="Not Acceptable"):T.length===1?T=T[0]:T=null)}else{const A=await f.text();try{w=JSON.parse(A),Array.isArray(w)&&f.status===404&&(T=[],w=null,I=200,j="OK")}catch{f.status===404&&A===""?(I=204,j="No Content"):w={message:A}}if(w&&this.isMaybeSingle&&(!((y=w==null?void 0:w.details)===null||y===void 0)&&y.includes("0 rows"))&&(w=null,I=200,j="OK"),w&&this.shouldThrowOnError)throw new Rpe.default(w)}return{error:w,data:T,count:S,status:I,statusText:j}});return this.shouldThrowOnError||(u=u.catch(f=>{var g,v,y;return{error:{message:`${(g=f==null?void 0:f.name)!==null&&g!==void 0?g:"FetchError"}: ${f==null?void 0:f.message}`,details:`${(v=f==null?void 0:f.stack)!==null&&v!==void 0?v:""}`,hint:"",code:`${(y=f==null?void 0:f.code)!==null&&y!==void 0?y:""}`},data:null,count:null,status:0,statusText:""}})),u.then(n,a)}};rb.default=Npe;var Ape=ba&&ba.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(tb,"__esModule",{value:!0});const Ipe=Ape(rb);let Ope=class extends Ipe.default{select(n){let a=!1;const l=(n??"*").split("").map(u=>/\s/.test(u)&&!a?"":(u==='"'&&(a=!a),u)).join("");return this.url.searchParams.set("select",l),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:a=!0,nullsFirst:l,foreignTable:u,referencedTable:f=u}={}){const g=f?`${f}.order`:"order",v=this.url.searchParams.get(g);return this.url.searchParams.set(g,`${v?`${v},`:""}${n}.${a?"asc":"desc"}${l===void 0?"":l?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:a,referencedTable:l=a}={}){const u=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(u,`${n}`),this}range(n,a,{foreignTable:l,referencedTable:u=l}={}){const f=typeof u>"u"?"offset":`${u}.offset`,g=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(f,`${n}`),this.url.searchParams.set(g,`${a-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:a=!1,settings:l=!1,buffers:u=!1,wal:f=!1,format:g="text"}={}){var v;const y=[n?"analyze":null,a?"verbose":null,l?"settings":null,u?"buffers":null,f?"wal":null].filter(Boolean).join("|"),w=(v=this.headers.Accept)!==null&&v!==void 0?v:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${g}; for="${w}"; options=${y};`,g==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};tb.default=Ope;var Dpe=ba&&ba.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty($g,"__esModule",{value:!0});const Ppe=Dpe(tb);let kpe=class extends Ppe.default{eq(n,a){return this.url.searchParams.append(n,`eq.${a}`),this}neq(n,a){return this.url.searchParams.append(n,`neq.${a}`),this}gt(n,a){return this.url.searchParams.append(n,`gt.${a}`),this}gte(n,a){return this.url.searchParams.append(n,`gte.${a}`),this}lt(n,a){return this.url.searchParams.append(n,`lt.${a}`),this}lte(n,a){return this.url.searchParams.append(n,`lte.${a}`),this}like(n,a){return this.url.searchParams.append(n,`like.${a}`),this}likeAllOf(n,a){return this.url.searchParams.append(n,`like(all).{${a.join(",")}}`),this}likeAnyOf(n,a){return this.url.searchParams.append(n,`like(any).{${a.join(",")}}`),this}ilike(n,a){return this.url.searchParams.append(n,`ilike.${a}`),this}ilikeAllOf(n,a){return this.url.searchParams.append(n,`ilike(all).{${a.join(",")}}`),this}ilikeAnyOf(n,a){return this.url.searchParams.append(n,`ilike(any).{${a.join(",")}}`),this}is(n,a){return this.url.searchParams.append(n,`is.${a}`),this}in(n,a){const l=Array.from(new Set(a)).map(u=>typeof u=="string"&&new RegExp("[,()]").test(u)?`"${u}"`:`${u}`).join(",");return this.url.searchParams.append(n,`in.(${l})`),this}contains(n,a){return typeof a=="string"?this.url.searchParams.append(n,`cs.${a}`):Array.isArray(a)?this.url.searchParams.append(n,`cs.{${a.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(a)}`),this}containedBy(n,a){return typeof a=="string"?this.url.searchParams.append(n,`cd.${a}`):Array.isArray(a)?this.url.searchParams.append(n,`cd.{${a.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(a)}`),this}rangeGt(n,a){return this.url.searchParams.append(n,`sr.${a}`),this}rangeGte(n,a){return this.url.searchParams.append(n,`nxl.${a}`),this}rangeLt(n,a){return this.url.searchParams.append(n,`sl.${a}`),this}rangeLte(n,a){return this.url.searchParams.append(n,`nxr.${a}`),this}rangeAdjacent(n,a){return this.url.searchParams.append(n,`adj.${a}`),this}overlaps(n,a){return typeof a=="string"?this.url.searchParams.append(n,`ov.${a}`):this.url.searchParams.append(n,`ov.{${a.join(",")}}`),this}textSearch(n,a,{config:l,type:u}={}){let f="";u==="plain"?f="pl":u==="phrase"?f="ph":u==="websearch"&&(f="w");const g=l===void 0?"":`(${l})`;return this.url.searchParams.append(n,`${f}fts${g}.${a}`),this}match(n){return Object.entries(n).forEach(([a,l])=>{this.url.searchParams.append(a,`eq.${l}`)}),this}not(n,a,l){return this.url.searchParams.append(n,`not.${a}.${l}`),this}or(n,{foreignTable:a,referencedTable:l=a}={}){const u=l?`${l}.or`:"or";return this.url.searchParams.append(u,`(${n})`),this}filter(n,a,l){return this.url.searchParams.append(n,`${a}.${l}`),this}};$g.default=kpe;var jpe=ba&&ba.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(eb,"__esModule",{value:!0});const jm=jpe($g);let Lpe=class{constructor(n,{headers:a={},schema:l,fetch:u}){this.url=n,this.headers=a,this.schema=l,this.fetch=u}select(n,{head:a=!1,count:l}={}){const u=a?"HEAD":"GET";let f=!1;const g=(n??"*").split("").map(v=>/\s/.test(v)&&!f?"":(v==='"'&&(f=!f),v)).join("");return this.url.searchParams.set("select",g),l&&(this.headers.Prefer=`count=${l}`),new jm.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:a,defaultToNull:l=!0}={}){const u="POST",f=[];if(this.headers.Prefer&&f.push(this.headers.Prefer),a&&f.push(`count=${a}`),l||f.push("missing=default"),this.headers.Prefer=f.join(","),Array.isArray(n)){const g=n.reduce((v,y)=>v.concat(Object.keys(y)),[]);if(g.length>0){const v=[...new Set(g)].map(y=>`"${y}"`);this.url.searchParams.set("columns",v.join(","))}}return new jm.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:a,ignoreDuplicates:l=!1,count:u,defaultToNull:f=!0}={}){const g="POST",v=[`resolution=${l?"ignore":"merge"}-duplicates`];if(a!==void 0&&this.url.searchParams.set("on_conflict",a),this.headers.Prefer&&v.push(this.headers.Prefer),u&&v.push(`count=${u}`),f||v.push("missing=default"),this.headers.Prefer=v.join(","),Array.isArray(n)){const y=n.reduce((w,T)=>w.concat(Object.keys(T)),[]);if(y.length>0){const w=[...new Set(y)].map(T=>`"${T}"`);this.url.searchParams.set("columns",w.join(","))}}return new jm.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:a}={}){const l="PATCH",u=[];return this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),this.headers.Prefer=u.join(","),new jm.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const a="DELETE",l=[];return n&&l.push(`count=${n}`),this.headers.Prefer&&l.unshift(this.headers.Prefer),this.headers.Prefer=l.join(","),new jm.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};eb.default=Lpe;var sb={},nb={};Object.defineProperty(nb,"__esModule",{value:!0});nb.version=void 0;nb.version="0.0.0-automated";Object.defineProperty(sb,"__esModule",{value:!0});sb.DEFAULT_HEADERS=void 0;const Mpe=nb;sb.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Mpe.version}`};var x9=ba&&ba.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(aI,"__esModule",{value:!0});const Fpe=x9(eb),Upe=x9($g),Vpe=sb;let Bpe=class b9{constructor(n,{headers:a={},schema:l,fetch:u}={}){this.url=n,this.headers=Object.assign(Object.assign({},Vpe.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=u}from(n){const a=new URL(`${this.url}/${n}`);return new Fpe.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new b9(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,a={},{head:l=!1,get:u=!1,count:f}={}){let g;const v=new URL(`${this.url}/rpc/${n}`);let y;l||u?(g=l?"HEAD":"GET",Object.entries(a).filter(([T,S])=>S!==void 0).map(([T,S])=>[T,Array.isArray(S)?`{${S.join(",")}}`:`${S}`]).forEach(([T,S])=>{v.searchParams.append(T,S)})):(g="POST",y=a);const w=Object.assign({},this.headers);return f&&(w.Prefer=`count=${f}`),new Upe.default({method:g,url:v,headers:w,schema:this.schemaName,body:y,fetch:this.fetch,allowEmpty:!1})}};aI.default=Bpe;var Xg=ba&&ba.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ea,"__esModule",{value:!0});Ea.PostgrestBuilder=Ea.PostgrestTransformBuilder=Ea.PostgrestFilterBuilder=Ea.PostgrestQueryBuilder=Ea.PostgrestClient=void 0;const w9=Xg(aI);Ea.PostgrestClient=w9.default;const S9=Xg(eb);Ea.PostgrestQueryBuilder=S9.default;const C9=Xg($g);Ea.PostgrestFilterBuilder=C9.default;const T9=Xg(tb);Ea.PostgrestTransformBuilder=T9.default;const R9=Xg(rb);Ea.PostgrestBuilder=R9.default;var Wpe=Ea.default={PostgrestClient:w9.default,PostgrestQueryBuilder:S9.default,PostgrestFilterBuilder:C9.default,PostgrestTransformBuilder:T9.default,PostgrestBuilder:R9.default};const{PostgrestClient:Gpe,PostgrestQueryBuilder:eCe,PostgrestFilterBuilder:tCe,PostgrestTransformBuilder:rCe,PostgrestBuilder:sCe}=Wpe,Hpe="2.10.2",zpe={"X-Client-Info":`realtime-js/${Hpe}`},Kpe="1.0.0",N9=1e4,qpe=1e3;var mp;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(mp||(mp={}));var Pi;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(Pi||(Pi={}));var to;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(to||(to={}));var DN;(function(s){s.websocket="websocket"})(DN||(DN={}));var Wd;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Wd||(Wd={}));class Ype{constructor(){this.HEADER_LENGTH=1}decode(n,a){return n.constructor===ArrayBuffer?a(this._binaryDecode(n)):a(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){const a=new DataView(n),l=new TextDecoder;return this._decodeBroadcast(n,a,l)}_decodeBroadcast(n,a,l){const u=a.getUint8(1),f=a.getUint8(2);let g=this.HEADER_LENGTH+2;const v=l.decode(n.slice(g,g+u));g=g+u;const y=l.decode(n.slice(g,g+f));g=g+f;const w=JSON.parse(l.decode(n.slice(g,n.byteLength)));return{ref:null,topic:v,event:y,payload:w}}}class A9{constructor(n,a){this.callback=n,this.timerCalc=a,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=a}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Zr;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(Zr||(Zr={}));const xB=(s,n,a={})=>{var l;const u=(l=a.skipTypes)!==null&&l!==void 0?l:[];return Object.keys(n).reduce((f,g)=>(f[g]=$pe(g,s,n,u),f),{})},$pe=(s,n,a,l)=>{const u=n.find(v=>v.name===s),f=u==null?void 0:u.type,g=a[s];return f&&!l.includes(f)?I9(f,g):PN(g)},I9=(s,n)=>{if(s.charAt(0)==="_"){const a=s.slice(1,s.length);return Zpe(n,a)}switch(s){case Zr.bool:return Xpe(n);case Zr.float4:case Zr.float8:case Zr.int2:case Zr.int4:case Zr.int8:case Zr.numeric:case Zr.oid:return Jpe(n);case Zr.json:case Zr.jsonb:return Qpe(n);case Zr.timestamp:return efe(n);case Zr.abstime:case Zr.date:case Zr.daterange:case Zr.int4range:case Zr.int8range:case Zr.money:case Zr.reltime:case Zr.text:case Zr.time:case Zr.timestamptz:case Zr.timetz:case Zr.tsrange:case Zr.tstzrange:return PN(n);default:return PN(n)}},PN=s=>s,Xpe=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Jpe=s=>{if(typeof s=="string"){const n=parseFloat(s);if(!Number.isNaN(n))return n}return s},Qpe=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(n){return console.log(`JSON parse error: ${n}`),s}return s},Zpe=(s,n)=>{if(typeof s!="string")return s;const a=s.length-1,l=s[a];if(s[0]==="{"&&l==="}"){let f;const g=s.slice(1,a);try{f=JSON.parse("["+g+"]")}catch{f=g?g.split(","):[]}return f.map(v=>I9(n,v))}return s},efe=s=>typeof s=="string"?s.replace(" ","T"):s,O9=s=>{let n=s;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};class eR{constructor(n,a,l={},u=N9){this.channel=n,this.event=a,this.payload=l,this.timeout=u,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,a){var l;return this._hasReceived(n)&&a((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:n,callback:a}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const n=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,a){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:a})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:a}){this.recHooks.filter(l=>l.status===n).forEach(l=>l.callback(a))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}}var bB;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(bB||(bB={}));class ng{constructor(n,a){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=(a==null?void 0:a.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},u=>{const{onJoin:f,onLeave:g,onSync:v}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ng.syncState(this.state,u,f,g),this.pendingDiffs.forEach(y=>{this.state=ng.syncDiff(this.state,y,f,g)}),this.pendingDiffs=[],v()}),this.channel._on(l.diff,{},u=>{const{onJoin:f,onLeave:g,onSync:v}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(u):(this.state=ng.syncDiff(this.state,u,f,g),v())}),this.onJoin((u,f,g)=>{this.channel._trigger("presence",{event:"join",key:u,currentPresences:f,newPresences:g})}),this.onLeave((u,f,g)=>{this.channel._trigger("presence",{event:"leave",key:u,currentPresences:f,leftPresences:g})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,a,l,u){const f=this.cloneDeep(n),g=this.transformState(a),v={},y={};return this.map(f,(w,T)=>{g[w]||(y[w]=T)}),this.map(g,(w,T)=>{const S=f[w];if(S){const I=T.map(F=>F.presence_ref),j=S.map(F=>F.presence_ref),B=T.filter(F=>j.indexOf(F.presence_ref)<0),A=S.filter(F=>I.indexOf(F.presence_ref)<0);B.length>0&&(v[w]=B),A.length>0&&(y[w]=A)}else v[w]=T}),this.syncDiff(f,{joins:v,leaves:y},l,u)}static syncDiff(n,a,l,u){const{joins:f,leaves:g}={joins:this.transformState(a.joins),leaves:this.transformState(a.leaves)};return l||(l=()=>{}),u||(u=()=>{}),this.map(f,(v,y)=>{var w;const T=(w=n[v])!==null&&w!==void 0?w:[];if(n[v]=this.cloneDeep(y),T.length>0){const S=n[v].map(j=>j.presence_ref),I=T.filter(j=>S.indexOf(j.presence_ref)<0);n[v].unshift(...I)}l(v,T,y)}),this.map(g,(v,y)=>{let w=n[v];if(!w)return;const T=y.map(S=>S.presence_ref);w=w.filter(S=>T.indexOf(S.presence_ref)<0),n[v]=w,u(v,w,y),w.length===0&&delete n[v]}),n}static map(n,a){return Object.getOwnPropertyNames(n).map(l=>a(l,n[l]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((a,l)=>{const u=n[l];return"metas"in u?a[l]=u.metas.map(f=>(f.presence_ref=f.phx_ref,delete f.phx_ref,delete f.phx_ref_prev,f)):a[l]=u,a},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var wB;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(wB||(wB={}));var SB;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes"})(SB||(SB={}));var CB;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(CB||(CB={}));class cI{constructor(n,a={config:{}},l){this.topic=n,this.params=a,this.socket=l,this.bindings={},this.state=Pi.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},a.config),this.timeout=this.socket.timeout,this.joinPush=new eR(this,to.join,this.params,this.timeout),this.rejoinTimer=new A9(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Pi.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(u=>u.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Pi.closed,this.socket._remove(this)}),this._onError(u=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,u),this.state=Pi.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Pi.errored,this.rejoinTimer.scheduleTimeout())}),this._on(to.reply,{},(u,f)=>{this._trigger(this._replyEventName(f),u)}),this.presence=new ng(this),this.broadcastEndpointURL=O9(this.socket.endPoint)+"/api/broadcast"}subscribe(n,a=this.timeout){var l,u;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:f,presence:g,private:v}}=this.params;this._onError(T=>n&&n("CHANNEL_ERROR",T)),this._onClose(()=>n&&n("CLOSED"));const y={},w={broadcast:f,presence:g,postgres_changes:(u=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(T=>T.filter))!==null&&u!==void 0?u:[],private:v};this.socket.accessToken&&(y.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:w},y)),this.joinedOnce=!0,this._rejoin(a),this.joinPush.receive("ok",({postgres_changes:T})=>{var S;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),T===void 0){n&&n("SUBSCRIBED");return}else{const I=this.bindings.postgres_changes,j=(S=I==null?void 0:I.length)!==null&&S!==void 0?S:0,B=[];for(let A=0;A<j;A++){const F=I[A],{filter:{event:D,schema:R,table:O,filter:V}}=F,G=T&&T[A];if(G&&G.event===D&&G.schema===R&&G.table===O&&G.filter===V)B.push(Object.assign(Object.assign({},F),{id:G.id}));else{this.unsubscribe(),n&&n("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=B,n&&n("SUBSCRIBED");return}}).receive("error",T=>{n&&n("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(T).join(", ")||"error")))}).receive("timeout",()=>{n&&n("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(n,a={}){return await this.send({type:"presence",event:"track",payload:n},a.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,a,l){return this._on(n,a,l)}async send(n,a={}){var l,u;if(!this._canPush()&&n.type==="broadcast"){const{event:f,payload:g}=n,v={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:f,payload:g}]})};try{const y=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(l=a.timeout)!==null&&l!==void 0?l:this.timeout);return await((u=y.body)===null||u===void 0?void 0:u.cancel()),y.ok?"ok":"error"}catch(y){return y.name==="AbortError"?"timed out":"error"}}else return new Promise(f=>{var g,v,y;const w=this._push(n.type,n,a.timeout||this.timeout);n.type==="broadcast"&&!(!((y=(v=(g=this.params)===null||g===void 0?void 0:g.config)===null||v===void 0?void 0:v.broadcast)===null||y===void 0)&&y.ack)&&f("ok"),w.receive("ok",()=>f("ok")),w.receive("error",()=>f("error")),w.receive("timeout",()=>f("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=Pi.leaving;const a=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(to.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(l=>{const u=new eR(this,to.leave,{},n);u.receive("ok",()=>{a(),l("ok")}).receive("timeout",()=>{a(),l("timed out")}).receive("error",()=>{l("error")}),u.send(),this._canPush()||u.trigger("ok",{})})}async _fetchWithTimeout(n,a,l){const u=new AbortController,f=setTimeout(()=>u.abort(),l),g=await this.socket.fetch(n,Object.assign(Object.assign({},a),{signal:u.signal}));return clearTimeout(f),g}_push(n,a,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let u=new eR(this,n,a,l);return this._canPush()?u.send():(u.startTimeout(),this.pushBuffer.push(u)),u}_onMessage(n,a,l){return a}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,a,l){var u,f;const g=n.toLocaleLowerCase(),{close:v,error:y,leave:w,join:T}=to;if(l&&[v,y,w,T].indexOf(g)>=0&&l!==this._joinRef())return;let I=this._onMessage(g,a,l);if(a&&!I)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(g)?(u=this.bindings.postgres_changes)===null||u===void 0||u.filter(j=>{var B,A,F;return((B=j.filter)===null||B===void 0?void 0:B.event)==="*"||((F=(A=j.filter)===null||A===void 0?void 0:A.event)===null||F===void 0?void 0:F.toLocaleLowerCase())===g}).map(j=>j.callback(I,l)):(f=this.bindings[g])===null||f===void 0||f.filter(j=>{var B,A,F,D,R,O;if(["broadcast","presence","postgres_changes"].includes(g))if("id"in j){const V=j.id,G=(B=j.filter)===null||B===void 0?void 0:B.event;return V&&((A=a.ids)===null||A===void 0?void 0:A.includes(V))&&(G==="*"||(G==null?void 0:G.toLocaleLowerCase())===((F=a.data)===null||F===void 0?void 0:F.type.toLocaleLowerCase()))}else{const V=(R=(D=j==null?void 0:j.filter)===null||D===void 0?void 0:D.event)===null||R===void 0?void 0:R.toLocaleLowerCase();return V==="*"||V===((O=a==null?void 0:a.event)===null||O===void 0?void 0:O.toLocaleLowerCase())}else return j.type.toLocaleLowerCase()===g}).map(j=>{if(typeof I=="object"&&"ids"in I){const B=I.data,{schema:A,table:F,commit_timestamp:D,type:R,errors:O}=B;I=Object.assign(Object.assign({},{schema:A,table:F,commit_timestamp:D,eventType:R,new:{},old:{},errors:O}),this._getPayloadRecords(B))}j.callback(I,l)})}_isClosed(){return this.state===Pi.closed}_isJoined(){return this.state===Pi.joined}_isJoining(){return this.state===Pi.joining}_isLeaving(){return this.state===Pi.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,a,l){const u=n.toLocaleLowerCase(),f={type:u,filter:a,callback:l};return this.bindings[u]?this.bindings[u].push(f):this.bindings[u]=[f],this}_off(n,a){const l=n.toLocaleLowerCase();return this.bindings[l]=this.bindings[l].filter(u=>{var f;return!(((f=u.type)===null||f===void 0?void 0:f.toLocaleLowerCase())===l&&cI.isEqual(u.filter,a))}),this}static isEqual(n,a){if(Object.keys(n).length!==Object.keys(a).length)return!1;for(const l in n)if(n[l]!==a[l])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(to.close,{},n)}_onError(n){this._on(to.error,{},a=>n(a))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Pi.joining,this.joinPush.resend(n))}_getPayloadRecords(n){const a={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(a.new=xB(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(a.old=xB(n.columns,n.old_record)),a}}const tfe=()=>{},rfe=typeof WebSocket<"u";class sfe{constructor(n,a){var l;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=zpe,this.params={},this.timeout=N9,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=tfe,this.conn=null,this.sendBuffer=[],this.serializer=new Ype,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=f=>{let g;return f?g=f:typeof fetch>"u"?g=(...v)=>kp(async()=>{const{default:y}=await Promise.resolve().then(()=>Hp);return{default:y}},void 0).then(({default:y})=>y(...v)):g=fetch,(...v)=>g(...v)},this.endPoint=`${n}/${DN.websocket}`,this.httpEndpoint=O9(n),a!=null&&a.transport?this.transport=a.transport:this.transport=null,a!=null&&a.params&&(this.params=a.params),a!=null&&a.headers&&(this.headers=Object.assign(Object.assign({},this.headers),a.headers)),a!=null&&a.timeout&&(this.timeout=a.timeout),a!=null&&a.logger&&(this.logger=a.logger),a!=null&&a.heartbeatIntervalMs&&(this.heartbeatIntervalMs=a.heartbeatIntervalMs);const u=(l=a==null?void 0:a.params)===null||l===void 0?void 0:l.apikey;u&&(this.accessToken=u,this.apiKey=u),this.reconnectAfterMs=a!=null&&a.reconnectAfterMs?a.reconnectAfterMs:f=>[1e3,2e3,5e3,1e4][f-1]||1e4,this.encode=a!=null&&a.encode?a.encode:(f,g)=>g(JSON.stringify(f)),this.decode=a!=null&&a.decode?a.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new A9(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(a==null?void 0:a.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(rfe){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new nfe(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),kp(async()=>{const{default:n}=await import("./browser-r38IUHC5.js").then(a=>a.b);return{default:n}},[]).then(({default:n})=>{this.conn=new n(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(n,a){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,a??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){const a=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),a}async removeAllChannels(){const n=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.disconnect(),n}log(n,a,l){this.logger(n,a,l)}connectionState(){switch(this.conn&&this.conn.readyState){case mp.connecting:return Wd.Connecting;case mp.open:return Wd.Open;case mp.closing:return Wd.Closing;default:return Wd.Closed}}isConnected(){return this.connectionState()===Wd.Open}channel(n,a={config:{}}){const l=new cI(`realtime:${n}`,a,this);return this.channels.push(l),l}push(n){const{topic:a,event:l,payload:u,ref:f}=n,g=()=>{this.encode(n,v=>{var y;(y=this.conn)===null||y===void 0||y.send(v)})};this.log("push",`${a} ${l} (${f})`,u),this.isConnected()?g():this.sendBuffer.push(g)}setAuth(n){this.accessToken=n,this.channels.forEach(a=>{n&&a.updateJoinPayload({access_token:n}),a.joinedOnce&&a._isJoined()&&a._push(to.access_token,{access_token:n})})}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let a=this.channels.find(l=>l.topic===n&&(l._isJoined()||l._isJoining()));a&&(this.log("transport",`leaving duplicate topic "${n}"`),a.unsubscribe())}_remove(n){this.channels=this.channels.filter(a=>a._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Kpe}))}_onConnMessage(n){this.decode(n.data,a=>{let{topic:l,event:u,payload:f,ref:g}=a;(g&&g===this.pendingHeartbeatRef||u===(f==null?void 0:f.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${f.status||""} ${l} ${u} ${g&&"("+g+")"||""}`,f),this.channels.filter(v=>v._isMember(l)).forEach(v=>v._trigger(u,f,g)),this.stateChangeCallbacks.message.forEach(v=>v(a))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(a=>a(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(a=>a(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(to.error))}_appendParams(n,a){if(Object.keys(a).length===0)return n;const l=n.match(/\?/)?"&":"?",u=new URLSearchParams(a);return`${n}${l}${u}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(qpe,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class nfe{constructor(n,a,l){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=mp.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=l.close}}class lI extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}}function In(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class ife extends lI{constructor(n,a){super(n),this.name="StorageApiError",this.status=a}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class TB extends lI{constructor(n,a){super(n),this.name="StorageUnknownError",this.originalError=a}}var afe=function(s,n,a,l){function u(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function v(T){try{w(l.next(T))}catch(S){g(S)}}function y(T){try{w(l.throw(T))}catch(S){g(S)}}function w(T){T.done?f(T.value):u(T.value).then(v,y)}w((l=l.apply(s,n||[])).next())})};const D9=s=>{let n;return s?n=s:typeof fetch>"u"?n=(...a)=>kp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...a)):n=fetch,(...a)=>n(...a)},ofe=()=>afe(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield kp(()=>Promise.resolve().then(()=>Hp),void 0)).Response:Response});var zp=function(s,n,a,l){function u(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function v(T){try{w(l.next(T))}catch(S){g(S)}}function y(T){try{w(l.throw(T))}catch(S){g(S)}}function w(T){T.done?f(T.value):u(T.value).then(v,y)}w((l=l.apply(s,n||[])).next())})};const tR=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),cfe=(s,n)=>zp(void 0,void 0,void 0,function*(){const a=yield ofe();s instanceof a?s.json().then(l=>{n(new ife(tR(l),s.status||500))}).catch(l=>{n(new TB(tR(l),l))}):n(new TB(tR(s),s))}),lfe=(s,n,a,l)=>{const u={method:s,headers:(n==null?void 0:n.headers)||{}};return s==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json"},n==null?void 0:n.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),a))};function ib(s,n,a,l,u,f){return zp(this,void 0,void 0,function*(){return new Promise((g,v)=>{s(a,lfe(n,l,u,f)).then(y=>{if(!y.ok)throw y;return l!=null&&l.noResolveJson?y:y.json()}).then(y=>g(y)).catch(y=>cfe(y,v))})})}function kN(s,n,a,l){return zp(this,void 0,void 0,function*(){return ib(s,"GET",n,a,l)})}function ml(s,n,a,l,u){return zp(this,void 0,void 0,function*(){return ib(s,"POST",n,l,u,a)})}function dfe(s,n,a,l,u){return zp(this,void 0,void 0,function*(){return ib(s,"PUT",n,l,u,a)})}function P9(s,n,a,l,u){return zp(this,void 0,void 0,function*(){return ib(s,"DELETE",n,l,u,a)})}var ha=function(s,n,a,l){function u(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function v(T){try{w(l.next(T))}catch(S){g(S)}}function y(T){try{w(l.throw(T))}catch(S){g(S)}}function w(T){T.done?f(T.value):u(T.value).then(v,y)}w((l=l.apply(s,n||[])).next())})};const ufe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},RB={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class hfe{constructor(n,a={},l,u){this.url=n,this.headers=a,this.bucketId=l,this.fetch=D9(u)}uploadOrUpdate(n,a,l,u){return ha(this,void 0,void 0,function*(){try{let f;const g=Object.assign(Object.assign({},RB),u),v=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(g.upsert)});typeof Blob<"u"&&l instanceof Blob?(f=new FormData,f.append("cacheControl",g.cacheControl),f.append("",l)):typeof FormData<"u"&&l instanceof FormData?(f=l,f.append("cacheControl",g.cacheControl)):(f=l,v["cache-control"]=`max-age=${g.cacheControl}`,v["content-type"]=g.contentType);const y=this._removeEmptyFolders(a),w=this._getFinalPath(y),T=yield this.fetch(`${this.url}/object/${w}`,Object.assign({method:n,body:f,headers:v},g!=null&&g.duplex?{duplex:g.duplex}:{})),S=yield T.json();return T.ok?{data:{path:y,id:S.Id,fullPath:S.Key},error:null}:{data:null,error:S}}catch(f){if(In(f))return{data:null,error:f};throw f}})}upload(n,a,l){return ha(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,a,l)})}uploadToSignedUrl(n,a,l,u){return ha(this,void 0,void 0,function*(){const f=this._removeEmptyFolders(n),g=this._getFinalPath(f),v=new URL(this.url+`/object/upload/sign/${g}`);v.searchParams.set("token",a);try{let y;const w=Object.assign({upsert:RB.upsert},u),T=Object.assign(Object.assign({},this.headers),{"x-upsert":String(w.upsert)});typeof Blob<"u"&&l instanceof Blob?(y=new FormData,y.append("cacheControl",w.cacheControl),y.append("",l)):typeof FormData<"u"&&l instanceof FormData?(y=l,y.append("cacheControl",w.cacheControl)):(y=l,T["cache-control"]=`max-age=${w.cacheControl}`,T["content-type"]=w.contentType);const S=yield this.fetch(v.toString(),{method:"PUT",body:y,headers:T}),I=yield S.json();return S.ok?{data:{path:f,fullPath:I.Key},error:null}:{data:null,error:I}}catch(y){if(In(y))return{data:null,error:y};throw y}})}createSignedUploadUrl(n,a){return ha(this,void 0,void 0,function*(){try{let l=this._getFinalPath(n);const u=Object.assign({},this.headers);a!=null&&a.upsert&&(u["x-upsert"]="true");const f=yield ml(this.fetch,`${this.url}/object/upload/sign/${l}`,{},{headers:u}),g=new URL(this.url+f.url),v=g.searchParams.get("token");if(!v)throw new lI("No token returned by API");return{data:{signedUrl:g.toString(),path:n,token:v},error:null}}catch(l){if(In(l))return{data:null,error:l};throw l}})}update(n,a,l){return ha(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,a,l)})}move(n,a,l){return ha(this,void 0,void 0,function*(){try{return{data:yield ml(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:a,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers}),error:null}}catch(u){if(In(u))return{data:null,error:u};throw u}})}copy(n,a,l){return ha(this,void 0,void 0,function*(){try{return{data:{path:(yield ml(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:a,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers})).Key},error:null}}catch(u){if(In(u))return{data:null,error:u};throw u}})}createSignedUrl(n,a,l){return ha(this,void 0,void 0,function*(){try{let u=this._getFinalPath(n),f=yield ml(this.fetch,`${this.url}/object/sign/${u}`,Object.assign({expiresIn:a},l!=null&&l.transform?{transform:l.transform}:{}),{headers:this.headers});const g=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return f={signedUrl:encodeURI(`${this.url}${f.signedURL}${g}`)},{data:f,error:null}}catch(u){if(In(u))return{data:null,error:u};throw u}})}createSignedUrls(n,a,l){return ha(this,void 0,void 0,function*(){try{const u=yield ml(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:a,paths:n},{headers:this.headers}),f=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return{data:u.map(g=>Object.assign(Object.assign({},g),{signedUrl:g.signedURL?encodeURI(`${this.url}${g.signedURL}${f}`):null})),error:null}}catch(u){if(In(u))return{data:null,error:u};throw u}})}download(n,a){return ha(this,void 0,void 0,function*(){const u=typeof(a==null?void 0:a.transform)<"u"?"render/image/authenticated":"object",f=this.transformOptsToQueryString((a==null?void 0:a.transform)||{}),g=f?`?${f}`:"";try{const v=this._getFinalPath(n);return{data:yield(yield kN(this.fetch,`${this.url}/${u}/${v}${g}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(v){if(In(v))return{data:null,error:v};throw v}})}getPublicUrl(n,a){const l=this._getFinalPath(n),u=[],f=a!=null&&a.download?`download=${a.download===!0?"":a.download}`:"";f!==""&&u.push(f);const v=typeof(a==null?void 0:a.transform)<"u"?"render/image":"object",y=this.transformOptsToQueryString((a==null?void 0:a.transform)||{});y!==""&&u.push(y);let w=u.join("&");return w!==""&&(w=`?${w}`),{data:{publicUrl:encodeURI(`${this.url}/${v}/public/${l}${w}`)}}}remove(n){return ha(this,void 0,void 0,function*(){try{return{data:yield P9(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(a){if(In(a))return{data:null,error:a};throw a}})}list(n,a,l){return ha(this,void 0,void 0,function*(){try{const u=Object.assign(Object.assign(Object.assign({},ufe),a),{prefix:n||""});return{data:yield ml(this.fetch,`${this.url}/object/list/${this.bucketId}`,u,{headers:this.headers},l),error:null}}catch(u){if(In(u))return{data:null,error:u};throw u}})}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const a=[];return n.width&&a.push(`width=${n.width}`),n.height&&a.push(`height=${n.height}`),n.resize&&a.push(`resize=${n.resize}`),n.format&&a.push(`format=${n.format}`),n.quality&&a.push(`quality=${n.quality}`),a.join("&")}}const pfe="2.6.0",ffe={"X-Client-Info":`storage-js/${pfe}`};var Mh=function(s,n,a,l){function u(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function v(T){try{w(l.next(T))}catch(S){g(S)}}function y(T){try{w(l.throw(T))}catch(S){g(S)}}function w(T){T.done?f(T.value):u(T.value).then(v,y)}w((l=l.apply(s,n||[])).next())})};class mfe{constructor(n,a={},l){this.url=n,this.headers=Object.assign(Object.assign({},ffe),a),this.fetch=D9(l)}listBuckets(){return Mh(this,void 0,void 0,function*(){try{return{data:yield kN(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(In(n))return{data:null,error:n};throw n}})}getBucket(n){return Mh(this,void 0,void 0,function*(){try{return{data:yield kN(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(a){if(In(a))return{data:null,error:a};throw a}})}createBucket(n,a={public:!1}){return Mh(this,void 0,void 0,function*(){try{return{data:yield ml(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:a.public,file_size_limit:a.fileSizeLimit,allowed_mime_types:a.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(In(l))return{data:null,error:l};throw l}})}updateBucket(n,a){return Mh(this,void 0,void 0,function*(){try{return{data:yield dfe(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:a.public,file_size_limit:a.fileSizeLimit,allowed_mime_types:a.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(In(l))return{data:null,error:l};throw l}})}emptyBucket(n){return Mh(this,void 0,void 0,function*(){try{return{data:yield ml(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(In(a))return{data:null,error:a};throw a}})}deleteBucket(n){return Mh(this,void 0,void 0,function*(){try{return{data:yield P9(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(a){if(In(a))return{data:null,error:a};throw a}})}}class gfe extends mfe{constructor(n,a={},l){super(n,a,l)}from(n){return new hfe(this.url,this.headers,n,this.fetch)}}const _fe="2.45.1";let Km="";typeof Deno<"u"?Km="deno":typeof document<"u"?Km="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Km="react-native":Km="node";const Efe={"X-Client-Info":`supabase-js-${Km}/${_fe}`},vfe={headers:Efe},yfe={schema:"public"},xfe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},bfe={};var wfe=function(s,n,a,l){function u(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function v(T){try{w(l.next(T))}catch(S){g(S)}}function y(T){try{w(l.throw(T))}catch(S){g(S)}}function w(T){T.done?f(T.value):u(T.value).then(v,y)}w((l=l.apply(s,n||[])).next())})};const Sfe=s=>{let n;return s?n=s:typeof fetch>"u"?n=E9:n=fetch,(...a)=>n(...a)},Cfe=()=>typeof Headers>"u"?v9:Headers,Tfe=(s,n,a)=>{const l=Sfe(a),u=Cfe();return(f,g)=>wfe(void 0,void 0,void 0,function*(){var v;const y=(v=yield n())!==null&&v!==void 0?v:s;let w=new u(g==null?void 0:g.headers);return w.has("apikey")||w.set("apikey",s),w.has("Authorization")||w.set("Authorization",`Bearer ${y}`),l(f,Object.assign(Object.assign({},g),{headers:w}))})};var Rfe=function(s,n,a,l){function u(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function v(T){try{w(l.next(T))}catch(S){g(S)}}function y(T){try{w(l.throw(T))}catch(S){g(S)}}function w(T){T.done?f(T.value):u(T.value).then(v,y)}w((l=l.apply(s,n||[])).next())})};function Nfe(s){return s.replace(/\/$/,"")}function Afe(s,n){const{db:a,auth:l,realtime:u,global:f}=s,{db:g,auth:v,realtime:y,global:w}=n,T={db:Object.assign(Object.assign({},g),a),auth:Object.assign(Object.assign({},v),l),realtime:Object.assign(Object.assign({},y),u),global:Object.assign(Object.assign({},w),f),accessToken:()=>Rfe(this,void 0,void 0,function*(){return""})};return s.accessToken?T.accessToken=s.accessToken:delete T.accessToken,T}const k9="2.64.4",Ife="http://localhost:9999",Ofe="supabase.auth.token",Dfe={"X-Client-Info":`gotrue-js/${k9}`},NB=10,jN="X-Supabase-Api-Version",j9={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Pfe(s){return Math.round(Date.now()/1e3)+s}function kfe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const n=Math.random()*16|0;return(s=="x"?n:n&3|8).toString(16)})}const $a=()=>typeof document<"u",Od={tested:!1,writable:!1},ig=()=>{if(!$a())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Od.tested)return Od.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Od.tested=!0,Od.writable=!0}catch{Od.tested=!0,Od.writable=!1}return Od.writable};function rR(s){const n={},a=new URL(s);if(a.hash&&a.hash[0]==="#")try{new URLSearchParams(a.hash.substring(1)).forEach((u,f)=>{n[f]=u})}catch{}return a.searchParams.forEach((l,u)=>{n[u]=l}),n}const L9=s=>{let n;return s?n=s:typeof fetch>"u"?n=(...a)=>kp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...a)):n=fetch,(...a)=>n(...a)},jfe=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",M9=async(s,n,a)=>{await s.setItem(n,JSON.stringify(a))},xy=async(s,n)=>{const a=await s.getItem(n);if(!a)return null;try{return JSON.parse(a)}catch{return a}},sR=async(s,n)=>{await s.removeItem(n)};function Lfe(s){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let a="",l,u,f,g,v,y,w,T=0;for(s=s.replace("-","+").replace("_","/");T<s.length;)g=n.indexOf(s.charAt(T++)),v=n.indexOf(s.charAt(T++)),y=n.indexOf(s.charAt(T++)),w=n.indexOf(s.charAt(T++)),l=g<<2|v>>4,u=(v&15)<<4|y>>2,f=(y&3)<<6|w,a=a+String.fromCharCode(l),y!=64&&u!=0&&(a=a+String.fromCharCode(u)),w!=64&&f!=0&&(a=a+String.fromCharCode(f));return a}class ab{constructor(){this.promise=new ab.promiseConstructor((n,a)=>{this.resolve=n,this.reject=a})}}ab.promiseConstructor=Promise;function AB(s){const n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,a=s.split(".");if(a.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!n.test(a[1]))throw new Error("JWT is not valid: payload is not in base64url format");const l=a[1];return JSON.parse(Lfe(l))}async function Mfe(s){return await new Promise(n=>{setTimeout(()=>n(null),s)})}function Ffe(s,n){return new Promise((l,u)=>{(async()=>{for(let f=0;f<1/0;f++)try{const g=await s(f);if(!n(f,null,g)){l(g);return}}catch(g){if(!n(f,g)){u(g);return}}})()})}function Ufe(s){return("0"+s.toString(16)).substr(-2)}function Vfe(){const n=new Uint32Array(56);if(typeof crypto>"u"){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=a.length;let u="";for(let f=0;f<56;f++)u+=a.charAt(Math.floor(Math.random()*l));return u}return crypto.getRandomValues(n),Array.from(n,Ufe).join("")}async function Bfe(s){const a=new TextEncoder().encode(s),l=await crypto.subtle.digest("SHA-256",a),u=new Uint8Array(l);return Array.from(u).map(f=>String.fromCharCode(f)).join("")}function Wfe(s){return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Gfe(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const a=await Bfe(s);return Wfe(a)}async function Fh(s,n,a=!1){const l=Vfe();let u=l;a&&(u+="/PASSWORD_RECOVERY"),await M9(s,`${n}-code-verifier`,u);const f=await Gfe(l);return[f,l===f?"plain":"s256"]}const Hfe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function zfe(s){const n=s.headers.get(jN);if(!n||!n.match(Hfe))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}class dI extends Error{constructor(n,a,l){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=a,this.code=l}}function pr(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Kfe extends dI{constructor(n,a,l){super(n,a,l),this.name="AuthApiError",this.status=a,this.code=l}}function qfe(s){return pr(s)&&s.name==="AuthApiError"}class F9 extends dI{constructor(n,a){super(n),this.name="AuthUnknownError",this.originalError=a}}class hu extends dI{constructor(n,a,l,u){super(n,l,u),this.name=a,this.status=l}}class Dd extends hu{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class nR extends hu{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class by extends hu{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}}class wy extends hu{constructor(n,a=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class IB extends hu{constructor(n,a=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class LN extends hu{constructor(n,a){super(n,"AuthRetryableFetchError",a,void 0)}}function iR(s){return pr(s)&&s.name==="AuthRetryableFetchError"}class OB extends hu{constructor(n,a,l){super(n,"AuthWeakPasswordError",a,"weak_password"),this.reasons=l}}var Yfe=function(s,n){var a={};for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&n.indexOf(l)<0&&(a[l]=s[l]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(s);u<l.length;u++)n.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(s,l[u])&&(a[l[u]]=s[l[u]]);return a};const Fd=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),$fe=[502,503,504];async function DB(s){var n;if(!jfe(s))throw new LN(Fd(s),0);if($fe.includes(s.status))throw new LN(Fd(s),s.status);let a;try{a=await s.json()}catch(f){throw new F9(Fd(f),f)}let l;const u=zfe(s);if(u&&u.getTime()>=j9["2024-01-01"].timestamp&&typeof a=="object"&&a&&typeof a.code=="string"?l=a.code:typeof a=="object"&&a&&typeof a.error_code=="string"&&(l=a.error_code),l){if(l==="weak_password")throw new OB(Fd(a),s.status,((n=a.weak_password)===null||n===void 0?void 0:n.reasons)||[])}else if(typeof a=="object"&&a&&typeof a.weak_password=="object"&&a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.reasons.reduce((f,g)=>f&&typeof g=="string",!0))throw new OB(Fd(a),s.status,a.weak_password.reasons);throw new Kfe(Fd(a),s.status||500,l)}const Xfe=(s,n,a,l)=>{const u={method:s,headers:(n==null?void 0:n.headers)||{}};return s==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n==null?void 0:n.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),a))};async function xr(s,n,a,l){var u;const f=Object.assign({},l==null?void 0:l.headers);f[jN]||(f[jN]=j9["2024-01-01"].name),l!=null&&l.jwt&&(f.Authorization=`Bearer ${l.jwt}`);const g=(u=l==null?void 0:l.query)!==null&&u!==void 0?u:{};l!=null&&l.redirectTo&&(g.redirect_to=l.redirectTo);const v=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",y=await Jfe(s,n,a+v,{headers:f,noResolveJson:l==null?void 0:l.noResolveJson},{},l==null?void 0:l.body);return l!=null&&l.xform?l==null?void 0:l.xform(y):{data:Object.assign({},y),error:null}}async function Jfe(s,n,a,l,u,f){const g=Xfe(n,l,u,f);let v;try{v=await s(a,Object.assign({},g))}catch(y){throw console.error(y),new LN(Fd(y),0)}if(v.ok||await DB(v),l!=null&&l.noResolveJson)return v;try{return await v.json()}catch(y){await DB(y)}}function dl(s){var n;let a=null;tme(s)&&(a=Object.assign({},s),s.expires_at||(a.expires_at=Pfe(s.expires_in)));const l=(n=s.user)!==null&&n!==void 0?n:s;return{data:{session:a,user:l},error:null}}function PB(s){const n=dl(s);return!n.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((a,l)=>a&&typeof l=="string",!0)&&(n.data.weak_password=s.weak_password),n}function El(s){var n;return{data:{user:(n=s.user)!==null&&n!==void 0?n:s},error:null}}function Qfe(s){return{data:s,error:null}}function Zfe(s){const{action_link:n,email_otp:a,hashed_token:l,redirect_to:u,verification_type:f}=s,g=Yfe(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),v={action_link:n,email_otp:a,hashed_token:l,redirect_to:u,verification_type:f},y=Object.assign({},g);return{data:{properties:v,user:y},error:null}}function eme(s){return s}function tme(s){return s.access_token&&s.refresh_token&&s.expires_in}var rme=function(s,n){var a={};for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&n.indexOf(l)<0&&(a[l]=s[l]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(s);u<l.length;u++)n.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(s,l[u])&&(a[l[u]]=s[l[u]]);return a};class sme{constructor({url:n="",headers:a={},fetch:l}){this.url=n,this.headers=a,this.fetch=L9(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,a="global"){try{return await xr(this.fetch,"POST",`${this.url}/logout?scope=${a}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(l){if(pr(l))return{data:null,error:l};throw l}}async inviteUserByEmail(n,a={}){try{return await xr(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:a.data},headers:this.headers,redirectTo:a.redirectTo,xform:El})}catch(l){if(pr(l))return{data:{user:null},error:l};throw l}}async generateLink(n){try{const{options:a}=n,l=rme(n,["options"]),u=Object.assign(Object.assign({},l),a);return"newEmail"in l&&(u.new_email=l==null?void 0:l.newEmail,delete u.newEmail),await xr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:u,headers:this.headers,xform:Zfe,redirectTo:a==null?void 0:a.redirectTo})}catch(a){if(pr(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(n){try{return await xr(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:El})}catch(a){if(pr(a))return{data:{user:null},error:a};throw a}}async listUsers(n){var a,l,u,f,g,v,y;try{const w={nextPage:null,lastPage:0,total:0},T=await xr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(a=n==null?void 0:n.page)===null||a===void 0?void 0:a.toString())!==null&&l!==void 0?l:"",per_page:(f=(u=n==null?void 0:n.perPage)===null||u===void 0?void 0:u.toString())!==null&&f!==void 0?f:""},xform:eme});if(T.error)throw T.error;const S=await T.json(),I=(g=T.headers.get("x-total-count"))!==null&&g!==void 0?g:0,j=(y=(v=T.headers.get("link"))===null||v===void 0?void 0:v.split(","))!==null&&y!==void 0?y:[];return j.length>0&&(j.forEach(B=>{const A=parseInt(B.split(";")[0].split("=")[1].substring(0,1)),F=JSON.parse(B.split(";")[1].split("=")[1]);w[`${F}Page`]=A}),w.total=parseInt(I)),{data:Object.assign(Object.assign({},S),w),error:null}}catch(w){if(pr(w))return{data:{users:[]},error:w};throw w}}async getUserById(n){try{return await xr(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:El})}catch(a){if(pr(a))return{data:{user:null},error:a};throw a}}async updateUserById(n,a){try{return await xr(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:a,headers:this.headers,xform:El})}catch(l){if(pr(l))return{data:{user:null},error:l};throw l}}async deleteUser(n,a=!1){try{return await xr(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:a},xform:El})}catch(l){if(pr(l))return{data:{user:null},error:l};throw l}}async _listFactors(n){try{const{data:a,error:l}=await xr(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:u=>({data:{factors:u},error:null})});return{data:a,error:l}}catch(a){if(pr(a))return{data:null,error:a};throw a}}async _deleteFactor(n){try{return{data:await xr(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(a){if(pr(a))return{data:null,error:a};throw a}}}const nme={getItem:s=>ig()?globalThis.localStorage.getItem(s):null,setItem:(s,n)=>{ig()&&globalThis.localStorage.setItem(s,n)},removeItem:s=>{ig()&&globalThis.localStorage.removeItem(s)}};function kB(s={}){return{getItem:n=>s[n]||null,setItem:(n,a)=>{s[n]=a},removeItem:n=>{delete s[n]}}}function ime(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Uh={debug:!!(globalThis&&ig()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class U9 extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}}class ame extends U9{}async function ome(s,n,a){Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,n);const l=new globalThis.AbortController;return n>0&&setTimeout(()=>{l.abort(),Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},n),await globalThis.navigator.locks.request(s,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async u=>{if(u){Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,u.name);try{return await a()}finally{Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,u.name)}}else{if(n===0)throw Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new ame(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Uh.debug)try{const f=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(f,null,"  "))}catch(f){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",f)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await a()}})}ime();const cme={url:Ife,storageKey:Ofe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Dfe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Lm=30*1e3,jB=3;async function LB(s,n,a){return await a()}class Pg{constructor(n){var a,l;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Pg.nextInstanceID,Pg.nextInstanceID+=1,this.instanceID>0&&$a()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const u=Object.assign(Object.assign({},cme),n);if(this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.persistSession=u.persistSession,this.storageKey=u.storageKey,this.autoRefreshToken=u.autoRefreshToken,this.admin=new sme({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=L9(u.fetch),this.lock=u.lock||LB,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,u.lock?this.lock=u.lock:$a()&&(!((a=globalThis==null?void 0:globalThis.navigator)===null||a===void 0)&&a.locks)?this.lock=ome:this.lock=LB,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?u.storage?this.storage=u.storage:ig()?this.storage=nme:(this.memoryStorage={},this.storage=kB(this.memoryStorage)):(this.memoryStorage={},this.storage=kB(this.memoryStorage)),$a()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(f){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",f)}(l=this.broadcastChannel)===null||l===void 0||l.addEventListener("message",async f=>{this._debug("received broadcast notification from other tab or client",f),await this._notifyAllSubscribers(f.data.event,f.data.session,!1)})}this.initialize()}_debug(...n){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${k9}) ${new Date().toISOString()}`,...n),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const n=$a()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",n),n||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:a,error:l}=await this._getSessionFromURL(n);if(l)return this._debug("#_initialize()","error detecting session from URL",l),(l==null?void 0:l.message)==="Identity is already linked"||(l==null?void 0:l.message)==="Identity is already linked to another user"?{error:l}:(await this._removeSession(),{error:l});const{session:u,redirectType:f}=a;return this._debug("#_initialize()","detected session in URL",u,"redirect type",f),await this._saveSession(u),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return pr(n)?{error:n}:{error:new F9("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(n){var a,l,u;try{const f=await xr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(a=n==null?void 0:n.options)===null||a===void 0?void 0:a.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(u=n==null?void 0:n.options)===null||u===void 0?void 0:u.captchaToken}},xform:dl}),{data:g,error:v}=f;if(v||!g)return{data:{user:null,session:null},error:v};const y=g.session,w=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",y)),{data:{user:w,session:y},error:null}}catch(f){if(pr(f))return{data:{user:null,session:null},error:f};throw f}}async signUp(n){var a,l,u;try{let f;if("email"in n){const{email:T,password:S,options:I}=n;let j=null,B=null;this.flowType==="pkce"&&([j,B]=await Fh(this.storage,this.storageKey)),f=await xr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:I==null?void 0:I.emailRedirectTo,body:{email:T,password:S,data:(a=I==null?void 0:I.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:I==null?void 0:I.captchaToken},code_challenge:j,code_challenge_method:B},xform:dl})}else if("phone"in n){const{phone:T,password:S,options:I}=n;f=await xr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:T,password:S,data:(l=I==null?void 0:I.data)!==null&&l!==void 0?l:{},channel:(u=I==null?void 0:I.channel)!==null&&u!==void 0?u:"sms",gotrue_meta_security:{captcha_token:I==null?void 0:I.captchaToken}},xform:dl})}else throw new by("You must provide either an email or phone number and a password");const{data:g,error:v}=f;if(v||!g)return{data:{user:null,session:null},error:v};const y=g.session,w=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",y)),{data:{user:w,session:y},error:null}}catch(f){if(pr(f))return{data:{user:null,session:null},error:f};throw f}}async signInWithPassword(n){try{let a;if("email"in n){const{email:f,password:g,options:v}=n;a=await xr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:f,password:g,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:PB})}else if("phone"in n){const{phone:f,password:g,options:v}=n;a=await xr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:f,password:g,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:PB})}else throw new by("You must provide either an email or phone number and a password");const{data:l,error:u}=a;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new nR}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:u})}catch(a){if(pr(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithOAuth(n){var a,l,u,f;return await this._handleProviderSignIn(n.provider,{redirectTo:(a=n.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=n.options)===null||l===void 0?void 0:l.scopes,queryParams:(u=n.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:(f=n.options)===null||f===void 0?void 0:f.skipBrowserRedirect})}async exchangeCodeForSession(n){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(n))}async _exchangeCodeForSession(n){const a=await xy(this.storage,`${this.storageKey}-code-verifier`),[l,u]=(a??"").split("/"),{data:f,error:g}=await xr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:n,code_verifier:l},xform:dl});return await sR(this.storage,`${this.storageKey}-code-verifier`),g?{data:{user:null,session:null,redirectType:null},error:g}:!f||!f.session||!f.user?{data:{user:null,session:null,redirectType:null},error:new nR}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:Object.assign(Object.assign({},f),{redirectType:u??null}),error:g})}async signInWithIdToken(n){try{const{options:a,provider:l,token:u,access_token:f,nonce:g}=n,v=await xr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:u,access_token:f,nonce:g,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:dl}),{data:y,error:w}=v;return w?{data:{user:null,session:null},error:w}:!y||!y.session||!y.user?{data:{user:null,session:null},error:new nR}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:y,error:w})}catch(a){if(pr(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithOtp(n){var a,l,u,f,g;try{if("email"in n){const{email:v,options:y}=n;let w=null,T=null;this.flowType==="pkce"&&([w,T]=await Fh(this.storage,this.storageKey));const{error:S}=await xr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:v,data:(a=y==null?void 0:y.data)!==null&&a!==void 0?a:{},create_user:(l=y==null?void 0:y.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken},code_challenge:w,code_challenge_method:T},redirectTo:y==null?void 0:y.emailRedirectTo});return{data:{user:null,session:null},error:S}}if("phone"in n){const{phone:v,options:y}=n,{data:w,error:T}=await xr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:v,data:(u=y==null?void 0:y.data)!==null&&u!==void 0?u:{},create_user:(f=y==null?void 0:y.shouldCreateUser)!==null&&f!==void 0?f:!0,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken},channel:(g=y==null?void 0:y.channel)!==null&&g!==void 0?g:"sms"}});return{data:{user:null,session:null,messageId:w==null?void 0:w.message_id},error:T}}throw new by("You must provide either an email or phone number.")}catch(v){if(pr(v))return{data:{user:null,session:null},error:v};throw v}}async verifyOtp(n){var a,l;try{let u,f;"options"in n&&(u=(a=n.options)===null||a===void 0?void 0:a.redirectTo,f=(l=n.options)===null||l===void 0?void 0:l.captchaToken);const{data:g,error:v}=await xr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},n),{gotrue_meta_security:{captcha_token:f}}),redirectTo:u,xform:dl});if(v)throw v;if(!g)throw new Error("An error occurred on token verification.");const y=g.session,w=g.user;return y!=null&&y.access_token&&(await this._saveSession(y),await this._notifyAllSubscribers(n.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",y)),{data:{user:w,session:y},error:null}}catch(u){if(pr(u))return{data:{user:null,session:null},error:u};throw u}}async signInWithSSO(n){var a,l,u;try{let f=null,g=null;return this.flowType==="pkce"&&([f,g]=await Fh(this.storage,this.storageKey)),await xr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in n?{provider_id:n.providerId}:null),"domain"in n?{domain:n.domain}:null),{redirect_to:(l=(a=n.options)===null||a===void 0?void 0:a.redirectTo)!==null&&l!==void 0?l:void 0}),!((u=n==null?void 0:n.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:n.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:g}),headers:this.headers,xform:Qfe})}catch(f){if(pr(f))return{data:null,error:f};throw f}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async n=>{const{data:{session:a},error:l}=n;if(l)throw l;if(!a)throw new Dd;const{error:u}=await xr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:a.access_token});return{data:{user:null,session:null},error:u}})}catch(n){if(pr(n))return{data:{user:null,session:null},error:n};throw n}}async resend(n){try{const a=`${this.url}/resend`;if("email"in n){const{email:l,type:u,options:f}=n,{error:g}=await xr(this.fetch,"POST",a,{headers:this.headers,body:{email:l,type:u,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},redirectTo:f==null?void 0:f.emailRedirectTo});return{data:{user:null,session:null},error:g}}else if("phone"in n){const{phone:l,type:u,options:f}=n,{data:g,error:v}=await xr(this.fetch,"POST",a,{headers:this.headers,body:{phone:l,type:u,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}}});return{data:{user:null,session:null,messageId:g==null?void 0:g.message_id},error:v}}throw new by("You must provide either an email or phone number and a type")}catch(a){if(pr(a))return{data:{user:null,session:null},error:a};throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(n,a){this._debug("#_acquireLock","begin",n);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),u=(async()=>(await l,await a()))();return this.pendingInLock.push((async()=>{try{await u}catch{}})()),u}return await this.lock(`lock:${this.storageKey}`,n,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=a();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const u=[...this.pendingInLock];await Promise.all(u),this.pendingInLock.splice(0,u.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(n){this._debug("#_useSession","begin");try{const a=await this.__loadSession();return await n(a)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let n=null;const a=await xy(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",a),a!==null&&(this._isValidSession(a)?n=a:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!n)return{data:{session:null},error:null};const l=n.expires_at?n.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",n.expires_at),!l){if(this.storage.isServer){let g=this.suppressGetSessionWarning;n=new Proxy(n,{get:(y,w,T)=>(!g&&w==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),g=!0,this.suppressGetSessionWarning=!0),Reflect.get(y,w,T))})}return{data:{session:n},error:null}}const{session:u,error:f}=await this._callRefreshToken(n.refresh_token);return f?{data:{session:null},error:f}:{data:{session:u},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(n){return n?await this._getUser(n):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(n){try{return n?await xr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:n,xform:El}):await this._useSession(async a=>{var l,u,f;const{data:g,error:v}=a;if(v)throw v;return!(!((l=g.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Dd}:await xr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(f=(u=g.session)===null||u===void 0?void 0:u.access_token)!==null&&f!==void 0?f:void 0,xform:El})})}catch(a){if(pr(a))return{data:{user:null},error:a};throw a}}async updateUser(n,a={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(n,a))}async _updateUser(n,a={}){try{return await this._useSession(async l=>{const{data:u,error:f}=l;if(f)throw f;if(!u.session)throw new Dd;const g=u.session;let v=null,y=null;this.flowType==="pkce"&&n.email!=null&&([v,y]=await Fh(this.storage,this.storageKey));const{data:w,error:T}=await xr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:a==null?void 0:a.emailRedirectTo,body:Object.assign(Object.assign({},n),{code_challenge:v,code_challenge_method:y}),jwt:g.access_token,xform:El});if(T)throw T;return g.user=w.user,await this._saveSession(g),await this._notifyAllSubscribers("USER_UPDATED",g),{data:{user:g.user},error:null}})}catch(l){if(pr(l))return{data:{user:null},error:l};throw l}}_decodeJWT(n){return AB(n)}async setSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(n))}async _setSession(n){try{if(!n.access_token||!n.refresh_token)throw new Dd;const a=Date.now()/1e3;let l=a,u=!0,f=null;const g=AB(n.access_token);if(g.exp&&(l=g.exp,u=l<=a),u){const{session:v,error:y}=await this._callRefreshToken(n.refresh_token);if(y)return{data:{user:null,session:null},error:y};if(!v)return{data:{user:null,session:null},error:null};f=v}else{const{data:v,error:y}=await this._getUser(n.access_token);if(y)throw y;f={access_token:n.access_token,refresh_token:n.refresh_token,user:v.user,token_type:"bearer",expires_in:l-a,expires_at:l},await this._saveSession(f),await this._notifyAllSubscribers("SIGNED_IN",f)}return{data:{user:f.user,session:f},error:null}}catch(a){if(pr(a))return{data:{session:null,user:null},error:a};throw a}}async refreshSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(n))}async _refreshSession(n){try{return await this._useSession(async a=>{var l;if(!n){const{data:g,error:v}=a;if(v)throw v;n=(l=g.session)!==null&&l!==void 0?l:void 0}if(!(n!=null&&n.refresh_token))throw new Dd;const{session:u,error:f}=await this._callRefreshToken(n.refresh_token);return f?{data:{user:null,session:null},error:f}:u?{data:{user:u.user,session:u},error:null}:{data:{user:null,session:null},error:null}})}catch(a){if(pr(a))return{data:{user:null,session:null},error:a};throw a}}async _getSessionFromURL(n){try{if(!$a())throw new wy("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new wy("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!n)throw new IB("Not a valid PKCE flow url.");const a=rR(window.location.href);if(n){if(!a.code)throw new IB("No code detected.");const{data:R,error:O}=await this._exchangeCodeForSession(a.code);if(O)throw O;const V=new URL(window.location.href);return V.searchParams.delete("code"),window.history.replaceState(window.history.state,"",V.toString()),{data:{session:R.session,redirectType:null},error:null}}if(a.error||a.error_description||a.error_code)throw new wy(a.error_description||"Error in URL with unspecified error_description",{error:a.error||"unspecified_error",code:a.error_code||"unspecified_code"});const{provider_token:l,provider_refresh_token:u,access_token:f,refresh_token:g,expires_in:v,expires_at:y,token_type:w}=a;if(!f||!v||!g||!w)throw new wy("No session defined in URL");const T=Math.round(Date.now()/1e3),S=parseInt(v);let I=T+S;y&&(I=parseInt(y));const j=I-T;j*1e3<=Lm&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${j}s, should have been closer to ${S}s`);const B=I-S;T-B>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",B,I,T):T-B<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",B,I,T);const{data:A,error:F}=await this._getUser(f);if(F)throw F;const D={provider_token:l,provider_refresh_token:u,access_token:f,expires_in:S,expires_at:I,refresh_token:g,token_type:w,user:A.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:D,redirectType:a.type},error:null}}catch(a){if(pr(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantFlow(){const n=rR(window.location.href);return!!($a()&&(n.access_token||n.error_description))}async _isPKCEFlow(){const n=rR(window.location.href),a=await xy(this.storage,`${this.storageKey}-code-verifier`);return!!(n.code&&a)}async signOut(n={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(n))}async _signOut({scope:n}={scope:"global"}){return await this._useSession(async a=>{var l;const{data:u,error:f}=a;if(f)return{error:f};const g=(l=u.session)===null||l===void 0?void 0:l.access_token;if(g){const{error:v}=await this.admin.signOut(g,n);if(v&&!(qfe(v)&&(v.status===404||v.status===401||v.status===403)))return{error:v}}return n!=="others"&&(await this._removeSession(),await sR(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(n){const a=kfe(),l={id:a,callback:n,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",a),this.stateChangeEmitters.delete(a)}};return this._debug("#onAuthStateChange()","registered callback with id",a),this.stateChangeEmitters.set(a,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(a)})))(),{data:{subscription:l}}}async _emitInitialSession(n){return await this._useSession(async a=>{var l,u;try{const{data:{session:f},error:g}=a;if(g)throw g;await((l=this.stateChangeEmitters.get(n))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",f)),this._debug("INITIAL_SESSION","callback id",n,"session",f)}catch(f){await((u=this.stateChangeEmitters.get(n))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",n,"error",f),console.error(f)}})}async resetPasswordForEmail(n,a={}){let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Fh(this.storage,this.storageKey,!0));try{return await xr(this.fetch,"POST",`${this.url}/recover`,{body:{email:n,code_challenge:l,code_challenge_method:u,gotrue_meta_security:{captcha_token:a.captchaToken}},headers:this.headers,redirectTo:a.redirectTo})}catch(f){if(pr(f))return{data:null,error:f};throw f}}async getUserIdentities(){var n;try{const{data:a,error:l}=await this.getUser();if(l)throw l;return{data:{identities:(n=a.user.identities)!==null&&n!==void 0?n:[]},error:null}}catch(a){if(pr(a))return{data:null,error:a};throw a}}async linkIdentity(n){var a;try{const{data:l,error:u}=await this._useSession(async f=>{var g,v,y,w,T;const{data:S,error:I}=f;if(I)throw I;const j=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,n.provider,{redirectTo:(g=n.options)===null||g===void 0?void 0:g.redirectTo,scopes:(v=n.options)===null||v===void 0?void 0:v.scopes,queryParams:(y=n.options)===null||y===void 0?void 0:y.queryParams,skipBrowserRedirect:!0});return await xr(this.fetch,"GET",j,{headers:this.headers,jwt:(T=(w=S.session)===null||w===void 0?void 0:w.access_token)!==null&&T!==void 0?T:void 0})});if(u)throw u;return $a()&&!(!((a=n.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(l==null?void 0:l.url),{data:{provider:n.provider,url:l==null?void 0:l.url},error:null}}catch(l){if(pr(l))return{data:{provider:n.provider,url:null},error:l};throw l}}async unlinkIdentity(n){try{return await this._useSession(async a=>{var l,u;const{data:f,error:g}=a;if(g)throw g;return await xr(this.fetch,"DELETE",`${this.url}/user/identities/${n.identity_id}`,{headers:this.headers,jwt:(u=(l=f.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})})}catch(a){if(pr(a))return{data:null,error:a};throw a}}async _refreshAccessToken(n){const a=`#_refreshAccessToken(${n.substring(0,5)}...)`;this._debug(a,"begin");try{const l=Date.now();return await Ffe(async u=>(u>0&&await Mfe(200*Math.pow(2,u-1)),this._debug(a,"refreshing attempt",u),await xr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:n},headers:this.headers,xform:dl})),(u,f)=>{const g=200*Math.pow(2,u);return f&&iR(f)&&Date.now()+g-l<Lm})}catch(l){if(this._debug(a,"error",l),pr(l))return{data:{session:null,user:null},error:l};throw l}finally{this._debug(a,"end")}}_isValidSession(n){return typeof n=="object"&&n!==null&&"access_token"in n&&"refresh_token"in n&&"expires_at"in n}async _handleProviderSignIn(n,a){const l=await this._getUrlForProvider(`${this.url}/authorize`,n,{redirectTo:a.redirectTo,scopes:a.scopes,queryParams:a.queryParams});return this._debug("#_handleProviderSignIn()","provider",n,"options",a,"url",l),$a()&&!a.skipBrowserRedirect&&window.location.assign(l),{data:{provider:n,url:l},error:null}}async _recoverAndRefresh(){var n;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const l=await xy(this.storage,this.storageKey);if(this._debug(a,"session from storage",l),!this._isValidSession(l)){this._debug(a,"session is not valid"),l!==null&&await this._removeSession();return}const u=Math.round(Date.now()/1e3),f=((n=l.expires_at)!==null&&n!==void 0?n:1/0)<u+NB;if(this._debug(a,`session has${f?"":" not"} expired with margin of ${NB}s`),f){if(this.autoRefreshToken&&l.refresh_token){const{error:g}=await this._callRefreshToken(l.refresh_token);g&&(console.error(g),iR(g)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",g),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",l)}catch(l){this._debug(a,"error",l),console.error(l);return}finally{this._debug(a,"end")}}async _callRefreshToken(n){var a,l;if(!n)throw new Dd;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const u=`#_callRefreshToken(${n.substring(0,5)}...)`;this._debug(u,"begin");try{this.refreshingDeferred=new ab;const{data:f,error:g}=await this._refreshAccessToken(n);if(g)throw g;if(!f.session)throw new Dd;await this._saveSession(f.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",f.session);const v={session:f.session,error:null};return this.refreshingDeferred.resolve(v),v}catch(f){if(this._debug(u,"error",f),pr(f)){const g={session:null,error:f};return iR(f)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(a=this.refreshingDeferred)===null||a===void 0||a.resolve(g),g}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(f),f}finally{this.refreshingDeferred=null,this._debug(u,"end")}}async _notifyAllSubscribers(n,a,l=!0){const u=`#_notifyAllSubscribers(${n})`;this._debug(u,"begin",a,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:n,session:a});const f=[],g=Array.from(this.stateChangeEmitters.values()).map(async v=>{try{await v.callback(n,a)}catch(y){f.push(y)}});if(await Promise.all(g),f.length>0){for(let v=0;v<f.length;v+=1)console.error(f[v]);throw f[0]}}finally{this._debug(u,"end")}}async _saveSession(n){this._debug("#_saveSession()",n),this.suppressGetSessionWarning=!0,await M9(this.storage,this.storageKey,n)}async _removeSession(){this._debug("#_removeSession()"),await sR(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const n=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{n&&$a()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",n)}catch(a){console.error("removing visibilitychange callback failed",a)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const n=setInterval(()=>this._autoRefreshTokenTick(),Lm);this.autoRefreshTicker=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const n=this.autoRefreshTicker;this.autoRefreshTicker=null,n&&clearInterval(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const n=Date.now();try{return await this._useSession(async a=>{const{data:{session:l}}=a;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const u=Math.floor((l.expires_at*1e3-n)/Lm);this._debug("#_autoRefreshTokenTick()",`access token expires in ${u} ticks, a tick lasts ${Lm}ms, refresh threshold is ${jB} ticks`),u<=jB&&await this._callRefreshToken(l.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(n){if(n.isAcquireTimeout||n instanceof U9)this._debug("auto refresh token tick lock not available");else throw n}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!$a()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(n){console.error("_handleVisibilityChange",n)}}async _onVisibilityChanged(n){const a=`#_onVisibilityChanged(${n})`;this._debug(a,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),n||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(a,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(n,a,l){const u=[`provider=${encodeURIComponent(a)}`];if(l!=null&&l.redirectTo&&u.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l!=null&&l.scopes&&u.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[f,g]=await Fh(this.storage,this.storageKey),v=new URLSearchParams({code_challenge:`${encodeURIComponent(f)}`,code_challenge_method:`${encodeURIComponent(g)}`});u.push(v.toString())}if(l!=null&&l.queryParams){const f=new URLSearchParams(l.queryParams);u.push(f.toString())}return l!=null&&l.skipBrowserRedirect&&u.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${n}?${u.join("&")}`}async _unenroll(n){try{return await this._useSession(async a=>{var l;const{data:u,error:f}=a;return f?{data:null,error:f}:await xr(this.fetch,"DELETE",`${this.url}/factors/${n.factorId}`,{headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token})})}catch(a){if(pr(a))return{data:null,error:a};throw a}}async _enroll(n){try{return await this._useSession(async a=>{var l,u;const{data:f,error:g}=a;if(g)return{data:null,error:g};const{data:v,error:y}=await xr(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:n.friendlyName,factor_type:n.factorType,issuer:n.issuer},headers:this.headers,jwt:(l=f==null?void 0:f.session)===null||l===void 0?void 0:l.access_token});return y?{data:null,error:y}:(!((u=v==null?void 0:v.totp)===null||u===void 0)&&u.qr_code&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(a){if(pr(a))return{data:null,error:a};throw a}}async _verify(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var l;const{data:u,error:f}=a;if(f)return{data:null,error:f};const{data:g,error:v}=await xr(this.fetch,"POST",`${this.url}/factors/${n.factorId}/verify`,{body:{code:n.code,challenge_id:n.challengeId},headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token});return v?{data:null,error:v}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+g.expires_in},g)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",g),{data:g,error:v})})}catch(a){if(pr(a))return{data:null,error:a};throw a}})}async _challenge(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var l;const{data:u,error:f}=a;return f?{data:null,error:f}:await xr(this.fetch,"POST",`${this.url}/factors/${n.factorId}/challenge`,{headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token})})}catch(a){if(pr(a))return{data:null,error:a};throw a}})}async _challengeAndVerify(n){const{data:a,error:l}=await this._challenge({factorId:n.factorId});return l?{data:null,error:l}:await this._verify({factorId:n.factorId,challengeId:a.id,code:n.code})}async _listFactors(){const{data:{user:n},error:a}=await this.getUser();if(a)return{data:null,error:a};const l=(n==null?void 0:n.factors)||[],u=l.filter(f=>f.factor_type==="totp"&&f.status==="verified");return{data:{all:l,totp:u},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async n=>{var a,l;const{data:{session:u},error:f}=n;if(f)return{data:null,error:f};if(!u)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const g=this._decodeJWT(u.access_token);let v=null;g.aal&&(v=g.aal);let y=v;((l=(a=u.user.factors)===null||a===void 0?void 0:a.filter(S=>S.status==="verified"))!==null&&l!==void 0?l:[]).length>0&&(y="aal2");const T=g.amr||[];return{data:{currentLevel:v,nextLevel:y,currentAuthenticationMethods:T},error:null}}))}}Pg.nextInstanceID=0;const lme=Pg;class dme extends lme{constructor(n){super(n)}}var ume=function(s,n,a,l){function u(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function v(T){try{w(l.next(T))}catch(S){g(S)}}function y(T){try{w(l.throw(T))}catch(S){g(S)}}function w(T){T.done?f(T.value):u(T.value).then(v,y)}w((l=l.apply(s,n||[])).next())})};class hme{constructor(n,a,l){var u,f,g;if(this.supabaseUrl=n,this.supabaseKey=a,!n)throw new Error("supabaseUrl is required.");if(!a)throw new Error("supabaseKey is required.");const v=Nfe(n);this.realtimeUrl=`${v}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${v}/auth/v1`,this.storageUrl=`${v}/storage/v1`,this.functionsUrl=`${v}/functions/v1`;const y=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,w={db:yfe,realtime:bfe,auth:Object.assign(Object.assign({},xfe),{storageKey:y}),global:vfe},T=Afe(l??{},w);this.storageKey=(u=T.auth.storageKey)!==null&&u!==void 0?u:"",this.headers=(f=T.global.headers)!==null&&f!==void 0?f:{},T.accessToken?(this.accessToken=T.accessToken,this.auth=new Proxy({},{get:(S,I)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(I)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((g=T.auth)!==null&&g!==void 0?g:{},this.headers,T.global.fetch),this.fetch=Tfe(a,this._getAccessToken.bind(this),T.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},T.realtime)),this.rest=new Gpe(`${v}/rest/v1`,{headers:this.headers,schema:T.db.schema,fetch:this.fetch}),T.accessToken||this._listenForAuthEvents()}get functions(){return new vpe(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new gfe(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,a={},l={}){return this.rest.rpc(n,a,l)}channel(n,a={config:{}}){return this.realtime.channel(n,a)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,a;return ume(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:l}=yield this.auth.getSession();return(a=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:a,detectSessionInUrl:l,storage:u,storageKey:f,flowType:g,lock:v,debug:y},w,T){var S;const I={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new dme({url:this.authUrl,headers:Object.assign(Object.assign({},I),w),storageKey:f,autoRefreshToken:n,persistSession:a,detectSessionInUrl:l,storage:u,flowType:g,lock:v,debug:y,fetch:T,hasCustomAuthorizationHeader:(S="Authorization"in this.headers)!==null&&S!==void 0?S:!1})}_initRealtimeClient(n){return new sfe(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,l)=>{this._handleTokenChanged(a,"CLIENT",l==null?void 0:l.access_token)})}_handleTokenChanged(n,a,l){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==l?(this.realtime.setAuth(l??null),this.changedAccessToken=l):n==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),a=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const pme=(s,n,a)=>new hme(s,n,a),V9=typeof import.meta<"u"&&"https://iktldcrkyphkvxjwmxyb.supabase.co"||"",B9=typeof import.meta<"u"&&"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlrdGxkY3JreXBoa3Z4andteHliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTM4NTUsImV4cCI6MjA3ODYyOTg1NX0.ToXGJWTGBj0xaKp6EEHJY0H3hrqW122CE486oju4opI"||"";(!V9||!B9)&&console.warn("Supabase URL or anon key is not set. Auth will not work correctly until these env vars are configured.");const ie=pme(V9,B9),W9=L.createContext(void 0),G9=s=>(s.split("@")[0]||"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()||"user",aR=s=>({id:s.id,email:s.email,role:s.role,username:G9(s.email),user_metadata:void 0,creatorProfileStatus:s.creator_profile_status}),fme=({children:s})=>{const[n,a]=L.useState(null),[l,u]=L.useState(!0);L.useEffect(()=>{(async()=>{try{const{data:{user:I}}=await ie.auth.getUser();if(!I)return;const{data:j,error:B}=await ie.from("users").select("id,email,role,creator_profile_status").eq("id",I.id).maybeSingle();!B&&j&&a(aR(j))}finally{u(!1)}})()},[]);const f=async({email:S,password:I})=>{const{data:j,error:B}=await ie.auth.signInWithPassword({email:S,password:I});if(B||!j.user)throw new Error("Invalid email or password.");const{data:A,error:F}=await ie.from("users").select("id,email,role,creator_profile_status").eq("id",j.user.id).maybeSingle();if(F||!A)throw new Error("No profile found for this account.");const D=aR(A);return a(D),D},g=async({email:S,password:I,role:j})=>{const{data:B,error:A}=await ie.auth.signUp({email:S,password:I});if(A||!B.user)throw new Error((A==null?void 0:A.message)??"Could not create account.");const F=B.user,{error:D}=await ie.from("users").insert({id:F.id,email:F.email,role:j});if(D)throw new Error(D.message??"Could not create profile.");const R=G9(S),O=R.charAt(0).toUpperCase()+R.slice(1),{error:V}=await ie.from("profiles").insert({user_id:F.id,username:R,display_name:O});V&&console.error("Error creating public profile:",V);const G=aR({id:F.id,email:F.email??S,role:j});return a(G),G},v=async()=>{try{await ie.auth.signOut()}finally{a(null)}},[y,w]=L.useState(new Set);L.useEffect(()=>{if(!n)return;const S=ie.channel("online-users");return S.on("presence",{event:"sync"},()=>{const I=S.presenceState(),j=new Set;Object.values(I).forEach(B=>{B.forEach(A=>{A.user_id&&j.add(A.user_id)})}),w(j)}).subscribe(async I=>{I==="SUBSCRIBED"&&await S.track({user_id:n.id,online_at:new Date().toISOString()})}),()=>{S.unsubscribe()}},[n]);const T=L.useMemo(()=>({user:n,isAuthenticated:!!n,isLoading:l,login:f,signup:g,logout:v,onlineUsers:y}),[l,n,y]);return o.jsx(W9.Provider,{value:T,children:s})},mr=()=>{const s=L.useContext(W9);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Vh=({isActive:s})=>`text-base font-medium transition-colors ${s?"text-[#C045FF]":"text-[#6C757D] hover:text-[#C045FF]"}`,mme=()=>{const s=Fs(),n=Tc(),[a,l]=L.useState(!1),{isAuthenticated:u,user:f}=mr(),g=n.pathname==="/",v=()=>{(f==null?void 0:f.role)==="fan"?s("/fan"):(f==null?void 0:f.role)==="creator"?s("/creator"):(f==null?void 0:f.role)==="admin"&&s("/admin")};return o.jsxs("div",{className:"min-h-screen bg-[#FFFFFF]",children:[!g&&o.jsxs(o.Fragment,{children:[o.jsxs("header",{className:"sticky top-0 z-50 flex h-[70px] items-center justify-between border-b border-[#E9ECEF] bg-white px-6 md:px-12",children:[o.jsxs("div",{className:"flex items-center gap-6 md:gap-10",children:[o.jsx(ll,{to:"/",className:"flex items-center gap-2 text-2xl font-bold text-[#C045FF]",children:"FanMeet"}),o.jsxs("nav",{className:"hidden gap-6 md:flex",children:[o.jsx(ll,{to:"/browse-events",className:Vh,children:"Browse Events"}),o.jsx(ll,{to:"/how-it-works",className:Vh,children:"How It Works"}),o.jsx(ll,{to:"/for-creators",className:Vh,children:"For Creators"})]})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"hidden items-center gap-3 md:flex",children:u?o.jsx(ue,{size:"sm",onClick:v,children:(f==null?void 0:f.role)==="fan"?" Fan Dashboard":(f==null?void 0:f.role)==="creator"?" Creator Dashboard":"Dashboard"}):o.jsxs(o.Fragment,{children:[o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>s("/auth"),children:"Login"}),o.jsx(ue,{size:"sm",onClick:()=>s("/auth"),children:"Get Started"})]})}),o.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-md border border-[#E9ECEF] p-2 text-[#343A40] md:hidden",onClick:()=>l(y=>!y),children:[o.jsx("span",{className:"sr-only",children:"Toggle navigation"}),o.jsxs("div",{className:"flex flex-col gap-[3px]",children:[o.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),o.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),o.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"})]})]})]})]}),a&&o.jsx("div",{className:"border-b border-[#E9ECEF] bg-white px-6 py-3 md:hidden",children:o.jsxs("nav",{className:"flex flex-col gap-3",children:[o.jsx(ll,{to:"/browse-events",className:Vh,onClick:()=>l(!1),children:"Browse Events"}),o.jsx(ll,{to:"/how-it-works",className:Vh,onClick:()=>l(!1),children:"How It Works"}),o.jsx(ll,{to:"/for-creators",className:Vh,onClick:()=>l(!1),children:"For Creators"}),o.jsx("div",{className:"mt-2 flex flex-col gap-2",children:u?o.jsx(ue,{size:"sm",className:"w-full",onClick:()=>{l(!1),v()},children:(f==null?void 0:f.role)==="fan"?" Fan Dashboard":(f==null?void 0:f.role)==="creator"?" Creator Dashboard":"Dashboard"}):o.jsxs(o.Fragment,{children:[o.jsx(ue,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{l(!1),s("/auth")},children:"Login"}),o.jsx(ue,{size:"sm",className:"w-full",onClick:()=>{l(!1),s("/auth")},children:"Get Started"})]})})]})})]}),o.jsx("main",{className:"bg-gradient-to-b from-white to-[#FFE5D9]",children:o.jsx(u9,{})})]})},Ue=(s,n="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:n}).format(s),Bt=s=>new Intl.DateTimeFormat("en-IN",{dateStyle:"medium",timeStyle:"short"}).format(typeof s=="string"?new Date(s):s),Kd=(...s)=>s.filter(Boolean).join(" "),H9=L.createContext(void 0),gme=({children:s})=>{const[n,a]=L.useState([]),[l,u]=L.useState([]),[f,g]=L.useState(!0),{user:v}=mr(),y=L.useMemo(()=>n.filter(O=>!O.read).length,[n]),w=L.useMemo(()=>l.filter(O=>!O.read&&O.receiver_id===(v==null?void 0:v.id)).length,[l,v]),T=async()=>{if(!v){a([]);return}const{data:O,error:V}=await ie.from("notifications").select("*").eq("user_id",v.id).order("created_at",{ascending:!1}).limit(50);V?console.error("Error fetching notifications:",V):a(O||[])},S=async()=>{if(!v){u([]);return}const{data:O,error:V}=await ie.from("messages").select("*").or(`sender_id.eq.${v.id},receiver_id.eq.${v.id}`).order("created_at",{ascending:!0});if(V){console.error("Error fetching messages:",V);return}if(O&&O.length>0){const G=[...new Set([...O.map(ee=>ee.sender_id),...O.map(ee=>ee.receiver_id)])],{data:J}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",G),$=new Map((J==null?void 0:J.map(ee=>[ee.user_id,ee]))||[]),q=O.map(ee=>{var ne,de,me,ve;return{...ee,sender_username:(ne=$.get(ee.sender_id))==null?void 0:ne.username,sender_display_name:(de=$.get(ee.sender_id))==null?void 0:de.display_name,receiver_username:(me=$.get(ee.receiver_id))==null?void 0:me.username,receiver_display_name:(ve=$.get(ee.receiver_id))==null?void 0:ve.display_name}});u(q)}else u([])};L.useEffect(()=>{(async()=>{g(!0),await Promise.all([T(),S()]),g(!1)})()},[v]);const I=async O=>{const{error:V}=await ie.from("notifications").update({read:!0}).eq("id",O);V?console.error("Error marking notification as read:",V):a(G=>G.map(J=>J.id===O?{...J,read:!0}:J))},j=async()=>{if(!v)return;const{error:O}=await ie.from("notifications").update({read:!0}).eq("user_id",v.id).eq("read",!1);O?console.error("Error marking all notifications as read:",O):a(V=>V.map(G=>({...G,read:!0})))},B=async O=>{const{error:V}=await ie.from("messages").update({read:!0}).eq("id",O);V?console.error("Error marking message as read:",V):u(G=>G.map(J=>J.id===O?{...J,read:!0}:J))},A=async(O,V,G)=>{if(!v)throw new Error("User not logged in");const{error:J}=await ie.from("messages").insert({sender_id:v.id,receiver_id:O,message:V,meet_id:G||null});if(J)throw console.error("Error sending message:",J),J;await S()},F=async()=>{await T()},D=async()=>{await S()},R=L.useMemo(()=>({notifications:n,messages:l,unreadNotificationsCount:y,unreadMessagesCount:w,isLoading:f,markNotificationAsRead:I,markAllNotificationsAsRead:j,markMessageAsRead:B,sendMessage:A,refreshNotifications:F,refreshMessages:D}),[n,l,y,w,f]);return o.jsx(H9.Provider,{value:R,children:s})},Jg=()=>{const s=L.useContext(H9);if(!s)throw new Error("useNotifications must be used within a NotificationsProvider");return s};function wx(s){"@babel/helpers - typeof";return wx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wx(s)}function cu(s){if(s===null||s===!0||s===!1)return NaN;var n=Number(s);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}function $n(s,n){if(n.length<s)throw new TypeError(s+" argument"+(s>1?"s":"")+" required, but only "+n.length+" present")}function Ko(s){$n(1,arguments);var n=Object.prototype.toString.call(s);return s instanceof Date||wx(s)==="object"&&n==="[object Date]"?new Date(s.getTime()):typeof s=="number"||n==="[object Number]"?new Date(s):((typeof s=="string"||n==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function _me(s,n){$n(2,arguments);var a=Ko(s).getTime(),l=cu(n);return new Date(a+l)}var Eme={};function ob(){return Eme}function vme(s){var n=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return n.setUTCFullYear(s.getFullYear()),s.getTime()-n.getTime()}function yme(s){return $n(1,arguments),s instanceof Date||wx(s)==="object"&&Object.prototype.toString.call(s)==="[object Date]"}function xme(s){if($n(1,arguments),!yme(s)&&typeof s!="number")return!1;var n=Ko(s);return!isNaN(Number(n))}function bme(s,n){$n(2,arguments);var a=cu(n);return _me(s,-a)}var wme=864e5;function Sme(s){$n(1,arguments);var n=Ko(s),a=n.getTime();n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0);var l=n.getTime(),u=a-l;return Math.floor(u/wme)+1}function Sx(s){$n(1,arguments);var n=1,a=Ko(s),l=a.getUTCDay(),u=(l<n?7:0)+l-n;return a.setUTCDate(a.getUTCDate()-u),a.setUTCHours(0,0,0,0),a}function z9(s){$n(1,arguments);var n=Ko(s),a=n.getUTCFullYear(),l=new Date(0);l.setUTCFullYear(a+1,0,4),l.setUTCHours(0,0,0,0);var u=Sx(l),f=new Date(0);f.setUTCFullYear(a,0,4),f.setUTCHours(0,0,0,0);var g=Sx(f);return n.getTime()>=u.getTime()?a+1:n.getTime()>=g.getTime()?a:a-1}function Cme(s){$n(1,arguments);var n=z9(s),a=new Date(0);a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0);var l=Sx(a);return l}var Tme=6048e5;function Rme(s){$n(1,arguments);var n=Ko(s),a=Sx(n).getTime()-Cme(n).getTime();return Math.round(a/Tme)+1}function Cx(s,n){var a,l,u,f,g,v,y,w;$n(1,arguments);var T=ob(),S=cu((a=(l=(u=(f=n==null?void 0:n.weekStartsOn)!==null&&f!==void 0?f:n==null||(g=n.locale)===null||g===void 0||(v=g.options)===null||v===void 0?void 0:v.weekStartsOn)!==null&&u!==void 0?u:T.weekStartsOn)!==null&&l!==void 0?l:(y=T.locale)===null||y===void 0||(w=y.options)===null||w===void 0?void 0:w.weekStartsOn)!==null&&a!==void 0?a:0);if(!(S>=0&&S<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var I=Ko(s),j=I.getUTCDay(),B=(j<S?7:0)+j-S;return I.setUTCDate(I.getUTCDate()-B),I.setUTCHours(0,0,0,0),I}function K9(s,n){var a,l,u,f,g,v,y,w;$n(1,arguments);var T=Ko(s),S=T.getUTCFullYear(),I=ob(),j=cu((a=(l=(u=(f=n==null?void 0:n.firstWeekContainsDate)!==null&&f!==void 0?f:n==null||(g=n.locale)===null||g===void 0||(v=g.options)===null||v===void 0?void 0:v.firstWeekContainsDate)!==null&&u!==void 0?u:I.firstWeekContainsDate)!==null&&l!==void 0?l:(y=I.locale)===null||y===void 0||(w=y.options)===null||w===void 0?void 0:w.firstWeekContainsDate)!==null&&a!==void 0?a:1);if(!(j>=1&&j<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var B=new Date(0);B.setUTCFullYear(S+1,0,j),B.setUTCHours(0,0,0,0);var A=Cx(B,n),F=new Date(0);F.setUTCFullYear(S,0,j),F.setUTCHours(0,0,0,0);var D=Cx(F,n);return T.getTime()>=A.getTime()?S+1:T.getTime()>=D.getTime()?S:S-1}function Nme(s,n){var a,l,u,f,g,v,y,w;$n(1,arguments);var T=ob(),S=cu((a=(l=(u=(f=n==null?void 0:n.firstWeekContainsDate)!==null&&f!==void 0?f:n==null||(g=n.locale)===null||g===void 0||(v=g.options)===null||v===void 0?void 0:v.firstWeekContainsDate)!==null&&u!==void 0?u:T.firstWeekContainsDate)!==null&&l!==void 0?l:(y=T.locale)===null||y===void 0||(w=y.options)===null||w===void 0?void 0:w.firstWeekContainsDate)!==null&&a!==void 0?a:1),I=K9(s,n),j=new Date(0);j.setUTCFullYear(I,0,S),j.setUTCHours(0,0,0,0);var B=Cx(j,n);return B}var Ame=6048e5;function Ime(s,n){$n(1,arguments);var a=Ko(s),l=Cx(a,n).getTime()-Nme(a,n).getTime();return Math.round(l/Ame)+1}function Vr(s,n){for(var a=s<0?"-":"",l=Math.abs(s).toString();l.length<n;)l="0"+l;return a+l}var ol={y:function(n,a){var l=n.getUTCFullYear(),u=l>0?l:1-l;return Vr(a==="yy"?u%100:u,a.length)},M:function(n,a){var l=n.getUTCMonth();return a==="M"?String(l+1):Vr(l+1,2)},d:function(n,a){return Vr(n.getUTCDate(),a.length)},a:function(n,a){var l=n.getUTCHours()/12>=1?"pm":"am";switch(a){case"a":case"aa":return l.toUpperCase();case"aaa":return l;case"aaaaa":return l[0];case"aaaa":default:return l==="am"?"a.m.":"p.m."}},h:function(n,a){return Vr(n.getUTCHours()%12||12,a.length)},H:function(n,a){return Vr(n.getUTCHours(),a.length)},m:function(n,a){return Vr(n.getUTCMinutes(),a.length)},s:function(n,a){return Vr(n.getUTCSeconds(),a.length)},S:function(n,a){var l=a.length,u=n.getUTCMilliseconds(),f=Math.floor(u*Math.pow(10,l-3));return Vr(f,a.length)}},Bh={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ome={G:function(n,a,l){var u=n.getUTCFullYear()>0?1:0;switch(a){case"G":case"GG":case"GGG":return l.era(u,{width:"abbreviated"});case"GGGGG":return l.era(u,{width:"narrow"});case"GGGG":default:return l.era(u,{width:"wide"})}},y:function(n,a,l){if(a==="yo"){var u=n.getUTCFullYear(),f=u>0?u:1-u;return l.ordinalNumber(f,{unit:"year"})}return ol.y(n,a)},Y:function(n,a,l,u){var f=K9(n,u),g=f>0?f:1-f;if(a==="YY"){var v=g%100;return Vr(v,2)}return a==="Yo"?l.ordinalNumber(g,{unit:"year"}):Vr(g,a.length)},R:function(n,a){var l=z9(n);return Vr(l,a.length)},u:function(n,a){var l=n.getUTCFullYear();return Vr(l,a.length)},Q:function(n,a,l){var u=Math.ceil((n.getUTCMonth()+1)/3);switch(a){case"Q":return String(u);case"QQ":return Vr(u,2);case"Qo":return l.ordinalNumber(u,{unit:"quarter"});case"QQQ":return l.quarter(u,{width:"abbreviated",context:"formatting"});case"QQQQQ":return l.quarter(u,{width:"narrow",context:"formatting"});case"QQQQ":default:return l.quarter(u,{width:"wide",context:"formatting"})}},q:function(n,a,l){var u=Math.ceil((n.getUTCMonth()+1)/3);switch(a){case"q":return String(u);case"qq":return Vr(u,2);case"qo":return l.ordinalNumber(u,{unit:"quarter"});case"qqq":return l.quarter(u,{width:"abbreviated",context:"standalone"});case"qqqqq":return l.quarter(u,{width:"narrow",context:"standalone"});case"qqqq":default:return l.quarter(u,{width:"wide",context:"standalone"})}},M:function(n,a,l){var u=n.getUTCMonth();switch(a){case"M":case"MM":return ol.M(n,a);case"Mo":return l.ordinalNumber(u+1,{unit:"month"});case"MMM":return l.month(u,{width:"abbreviated",context:"formatting"});case"MMMMM":return l.month(u,{width:"narrow",context:"formatting"});case"MMMM":default:return l.month(u,{width:"wide",context:"formatting"})}},L:function(n,a,l){var u=n.getUTCMonth();switch(a){case"L":return String(u+1);case"LL":return Vr(u+1,2);case"Lo":return l.ordinalNumber(u+1,{unit:"month"});case"LLL":return l.month(u,{width:"abbreviated",context:"standalone"});case"LLLLL":return l.month(u,{width:"narrow",context:"standalone"});case"LLLL":default:return l.month(u,{width:"wide",context:"standalone"})}},w:function(n,a,l,u){var f=Ime(n,u);return a==="wo"?l.ordinalNumber(f,{unit:"week"}):Vr(f,a.length)},I:function(n,a,l){var u=Rme(n);return a==="Io"?l.ordinalNumber(u,{unit:"week"}):Vr(u,a.length)},d:function(n,a,l){return a==="do"?l.ordinalNumber(n.getUTCDate(),{unit:"date"}):ol.d(n,a)},D:function(n,a,l){var u=Sme(n);return a==="Do"?l.ordinalNumber(u,{unit:"dayOfYear"}):Vr(u,a.length)},E:function(n,a,l){var u=n.getUTCDay();switch(a){case"E":case"EE":case"EEE":return l.day(u,{width:"abbreviated",context:"formatting"});case"EEEEE":return l.day(u,{width:"narrow",context:"formatting"});case"EEEEEE":return l.day(u,{width:"short",context:"formatting"});case"EEEE":default:return l.day(u,{width:"wide",context:"formatting"})}},e:function(n,a,l,u){var f=n.getUTCDay(),g=(f-u.weekStartsOn+8)%7||7;switch(a){case"e":return String(g);case"ee":return Vr(g,2);case"eo":return l.ordinalNumber(g,{unit:"day"});case"eee":return l.day(f,{width:"abbreviated",context:"formatting"});case"eeeee":return l.day(f,{width:"narrow",context:"formatting"});case"eeeeee":return l.day(f,{width:"short",context:"formatting"});case"eeee":default:return l.day(f,{width:"wide",context:"formatting"})}},c:function(n,a,l,u){var f=n.getUTCDay(),g=(f-u.weekStartsOn+8)%7||7;switch(a){case"c":return String(g);case"cc":return Vr(g,a.length);case"co":return l.ordinalNumber(g,{unit:"day"});case"ccc":return l.day(f,{width:"abbreviated",context:"standalone"});case"ccccc":return l.day(f,{width:"narrow",context:"standalone"});case"cccccc":return l.day(f,{width:"short",context:"standalone"});case"cccc":default:return l.day(f,{width:"wide",context:"standalone"})}},i:function(n,a,l){var u=n.getUTCDay(),f=u===0?7:u;switch(a){case"i":return String(f);case"ii":return Vr(f,a.length);case"io":return l.ordinalNumber(f,{unit:"day"});case"iii":return l.day(u,{width:"abbreviated",context:"formatting"});case"iiiii":return l.day(u,{width:"narrow",context:"formatting"});case"iiiiii":return l.day(u,{width:"short",context:"formatting"});case"iiii":default:return l.day(u,{width:"wide",context:"formatting"})}},a:function(n,a,l){var u=n.getUTCHours(),f=u/12>=1?"pm":"am";switch(a){case"a":case"aa":return l.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"aaa":return l.dayPeriod(f,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return l.dayPeriod(f,{width:"narrow",context:"formatting"});case"aaaa":default:return l.dayPeriod(f,{width:"wide",context:"formatting"})}},b:function(n,a,l){var u=n.getUTCHours(),f;switch(u===12?f=Bh.noon:u===0?f=Bh.midnight:f=u/12>=1?"pm":"am",a){case"b":case"bb":return l.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"bbb":return l.dayPeriod(f,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return l.dayPeriod(f,{width:"narrow",context:"formatting"});case"bbbb":default:return l.dayPeriod(f,{width:"wide",context:"formatting"})}},B:function(n,a,l){var u=n.getUTCHours(),f;switch(u>=17?f=Bh.evening:u>=12?f=Bh.afternoon:u>=4?f=Bh.morning:f=Bh.night,a){case"B":case"BB":case"BBB":return l.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"BBBBB":return l.dayPeriod(f,{width:"narrow",context:"formatting"});case"BBBB":default:return l.dayPeriod(f,{width:"wide",context:"formatting"})}},h:function(n,a,l){if(a==="ho"){var u=n.getUTCHours()%12;return u===0&&(u=12),l.ordinalNumber(u,{unit:"hour"})}return ol.h(n,a)},H:function(n,a,l){return a==="Ho"?l.ordinalNumber(n.getUTCHours(),{unit:"hour"}):ol.H(n,a)},K:function(n,a,l){var u=n.getUTCHours()%12;return a==="Ko"?l.ordinalNumber(u,{unit:"hour"}):Vr(u,a.length)},k:function(n,a,l){var u=n.getUTCHours();return u===0&&(u=24),a==="ko"?l.ordinalNumber(u,{unit:"hour"}):Vr(u,a.length)},m:function(n,a,l){return a==="mo"?l.ordinalNumber(n.getUTCMinutes(),{unit:"minute"}):ol.m(n,a)},s:function(n,a,l){return a==="so"?l.ordinalNumber(n.getUTCSeconds(),{unit:"second"}):ol.s(n,a)},S:function(n,a){return ol.S(n,a)},X:function(n,a,l,u){var f=u._originalDate||n,g=f.getTimezoneOffset();if(g===0)return"Z";switch(a){case"X":return FB(g);case"XXXX":case"XX":return Ud(g);case"XXXXX":case"XXX":default:return Ud(g,":")}},x:function(n,a,l,u){var f=u._originalDate||n,g=f.getTimezoneOffset();switch(a){case"x":return FB(g);case"xxxx":case"xx":return Ud(g);case"xxxxx":case"xxx":default:return Ud(g,":")}},O:function(n,a,l,u){var f=u._originalDate||n,g=f.getTimezoneOffset();switch(a){case"O":case"OO":case"OOO":return"GMT"+MB(g,":");case"OOOO":default:return"GMT"+Ud(g,":")}},z:function(n,a,l,u){var f=u._originalDate||n,g=f.getTimezoneOffset();switch(a){case"z":case"zz":case"zzz":return"GMT"+MB(g,":");case"zzzz":default:return"GMT"+Ud(g,":")}},t:function(n,a,l,u){var f=u._originalDate||n,g=Math.floor(f.getTime()/1e3);return Vr(g,a.length)},T:function(n,a,l,u){var f=u._originalDate||n,g=f.getTime();return Vr(g,a.length)}};function MB(s,n){var a=s>0?"-":"+",l=Math.abs(s),u=Math.floor(l/60),f=l%60;if(f===0)return a+String(u);var g=n;return a+String(u)+g+Vr(f,2)}function FB(s,n){if(s%60===0){var a=s>0?"-":"+";return a+Vr(Math.abs(s)/60,2)}return Ud(s,n)}function Ud(s,n){var a=n||"",l=s>0?"-":"+",u=Math.abs(s),f=Vr(Math.floor(u/60),2),g=Vr(u%60,2);return l+f+a+g}var UB=function(n,a){switch(n){case"P":return a.date({width:"short"});case"PP":return a.date({width:"medium"});case"PPP":return a.date({width:"long"});case"PPPP":default:return a.date({width:"full"})}},q9=function(n,a){switch(n){case"p":return a.time({width:"short"});case"pp":return a.time({width:"medium"});case"ppp":return a.time({width:"long"});case"pppp":default:return a.time({width:"full"})}},Dme=function(n,a){var l=n.match(/(P+)(p+)?/)||[],u=l[1],f=l[2];if(!f)return UB(n,a);var g;switch(u){case"P":g=a.dateTime({width:"short"});break;case"PP":g=a.dateTime({width:"medium"});break;case"PPP":g=a.dateTime({width:"long"});break;case"PPPP":default:g=a.dateTime({width:"full"});break}return g.replace("{{date}}",UB(u,a)).replace("{{time}}",q9(f,a))},Pme={p:q9,P:Dme},kme=["D","DD"],jme=["YY","YYYY"];function Lme(s){return kme.indexOf(s)!==-1}function Mme(s){return jme.indexOf(s)!==-1}function VB(s,n,a){if(s==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(n,"`) for formatting years to the input `").concat(a,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(n,"`) for formatting years to the input `").concat(a,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(n,"`) for formatting days of the month to the input `").concat(a,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(n,"`) for formatting days of the month to the input `").concat(a,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Fme={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ume=function(n,a,l){var u,f=Fme[n];return typeof f=="string"?u=f:a===1?u=f.one:u=f.other.replace("{{count}}",a.toString()),l!=null&&l.addSuffix?l.comparison&&l.comparison>0?"in "+u:u+" ago":u};function oR(s){return function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width?String(n.width):s.defaultWidth,l=s.formats[a]||s.formats[s.defaultWidth];return l}}var Vme={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Bme={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Wme={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Gme={date:oR({formats:Vme,defaultWidth:"full"}),time:oR({formats:Bme,defaultWidth:"full"}),dateTime:oR({formats:Wme,defaultWidth:"full"})},Hme={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},zme=function(n,a,l,u){return Hme[n]};function Mm(s){return function(n,a){var l=a!=null&&a.context?String(a.context):"standalone",u;if(l==="formatting"&&s.formattingValues){var f=s.defaultFormattingWidth||s.defaultWidth,g=a!=null&&a.width?String(a.width):f;u=s.formattingValues[g]||s.formattingValues[f]}else{var v=s.defaultWidth,y=a!=null&&a.width?String(a.width):s.defaultWidth;u=s.values[y]||s.values[v]}var w=s.argumentCallback?s.argumentCallback(n):n;return u[w]}}var Kme={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},qme={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Yme={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},$me={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Xme={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Jme={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Qme=function(n,a){var l=Number(n),u=l%100;if(u>20||u<10)switch(u%10){case 1:return l+"st";case 2:return l+"nd";case 3:return l+"rd"}return l+"th"},Zme={ordinalNumber:Qme,era:Mm({values:Kme,defaultWidth:"wide"}),quarter:Mm({values:qme,defaultWidth:"wide",argumentCallback:function(n){return n-1}}),month:Mm({values:Yme,defaultWidth:"wide"}),day:Mm({values:$me,defaultWidth:"wide"}),dayPeriod:Mm({values:Xme,defaultWidth:"wide",formattingValues:Jme,defaultFormattingWidth:"wide"})};function Fm(s){return function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=a.width,u=l&&s.matchPatterns[l]||s.matchPatterns[s.defaultMatchWidth],f=n.match(u);if(!f)return null;var g=f[0],v=l&&s.parsePatterns[l]||s.parsePatterns[s.defaultParseWidth],y=Array.isArray(v)?tge(v,function(S){return S.test(g)}):ege(v,function(S){return S.test(g)}),w;w=s.valueCallback?s.valueCallback(y):y,w=a.valueCallback?a.valueCallback(w):w;var T=n.slice(g.length);return{value:w,rest:T}}}function ege(s,n){for(var a in s)if(s.hasOwnProperty(a)&&n(s[a]))return a}function tge(s,n){for(var a=0;a<s.length;a++)if(n(s[a]))return a}function rge(s){return function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=n.match(s.matchPattern);if(!l)return null;var u=l[0],f=n.match(s.parsePattern);if(!f)return null;var g=s.valueCallback?s.valueCallback(f[0]):f[0];g=a.valueCallback?a.valueCallback(g):g;var v=n.slice(u.length);return{value:g,rest:v}}}var sge=/^(\d+)(th|st|nd|rd)?/i,nge=/\d+/i,ige={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},age={any:[/^b/i,/^(a|c)/i]},oge={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},cge={any:[/1/i,/2/i,/3/i,/4/i]},lge={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},dge={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},uge={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},hge={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},pge={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},fge={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},mge={ordinalNumber:rge({matchPattern:sge,parsePattern:nge,valueCallback:function(n){return parseInt(n,10)}}),era:Fm({matchPatterns:ige,defaultMatchWidth:"wide",parsePatterns:age,defaultParseWidth:"any"}),quarter:Fm({matchPatterns:oge,defaultMatchWidth:"wide",parsePatterns:cge,defaultParseWidth:"any",valueCallback:function(n){return n+1}}),month:Fm({matchPatterns:lge,defaultMatchWidth:"wide",parsePatterns:dge,defaultParseWidth:"any"}),day:Fm({matchPatterns:uge,defaultMatchWidth:"wide",parsePatterns:hge,defaultParseWidth:"any"}),dayPeriod:Fm({matchPatterns:pge,defaultMatchWidth:"any",parsePatterns:fge,defaultParseWidth:"any"})},gge={code:"en-US",formatDistance:Ume,formatLong:Gme,formatRelative:zme,localize:Zme,match:mge,options:{weekStartsOn:0,firstWeekContainsDate:1}},_ge=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ege=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,vge=/^'([^]*?)'?$/,yge=/''/g,xge=/[a-zA-Z]/;function lu(s,n,a){var l,u,f,g,v,y,w,T,S,I,j,B,A,F;$n(2,arguments);var D=String(n),R=ob(),O=(l=(u=void 0)!==null&&u!==void 0?u:R.locale)!==null&&l!==void 0?l:gge,V=cu((f=(g=(v=(y=void 0)!==null&&y!==void 0?y:void 0)!==null&&v!==void 0?v:R.firstWeekContainsDate)!==null&&g!==void 0?g:(w=R.locale)===null||w===void 0||(T=w.options)===null||T===void 0?void 0:T.firstWeekContainsDate)!==null&&f!==void 0?f:1);if(!(V>=1&&V<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var G=cu((S=(I=(j=(B=void 0)!==null&&B!==void 0?B:void 0)!==null&&j!==void 0?j:R.weekStartsOn)!==null&&I!==void 0?I:(A=R.locale)===null||A===void 0||(F=A.options)===null||F===void 0?void 0:F.weekStartsOn)!==null&&S!==void 0?S:0);if(!(G>=0&&G<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!O.localize)throw new RangeError("locale must contain localize property");if(!O.formatLong)throw new RangeError("locale must contain formatLong property");var J=Ko(s);if(!xme(J))throw new RangeError("Invalid time value");var $=vme(J),q=bme(J,$),ee={firstWeekContainsDate:V,weekStartsOn:G,locale:O,_originalDate:J},ne=D.match(Ege).map(function(de){var me=de[0];if(me==="p"||me==="P"){var ve=Pme[me];return ve(de,O.formatLong)}return de}).join("").match(_ge).map(function(de){if(de==="''")return"'";var me=de[0];if(me==="'")return bge(de);var ve=Ome[me];if(ve)return Mme(de)&&VB(de,n,String(s)),Lme(de)&&VB(de,n,String(s)),ve(q,de,O.localize,ee);if(me.match(xge))throw new RangeError("Format string contains an unescaped latin alphabet character `"+me+"`");return de}).join("");return ne}function bge(s){var n=s.match(vge);return n?n[1].replace(yge,"'"):s}const wge={fan:{title:"Fan Dashboard",menu:[{type:"link",to:"/fan",label:"Browse Events",icon:""},{type:"link",to:"/fan/following",label:"Following",icon:""},{type:"link",to:"/fan/bids",label:"My Bids",icon:""},{type:"link",to:"/fan/meets",label:"Upcoming Meets",icon:""},{type:"link",to:"/fan/history",label:"History",icon:""},{type:"link",to:"/fan/wallet",label:"Payment History",icon:""},{type:"link",to:"/fan/messages",label:"Messages",icon:""},{type:"link",to:"/fan/notifications",label:"Notifications",icon:""},{type:"link",to:"/fan/settings",label:"Settings",icon:""},{type:"link",to:"/fan/support",label:"Help & Support",icon:""}]},creator:{title:"Creator Control Room",menu:[{type:"link",to:"/creator",label:"Overview",icon:""},{type:"link",to:"/creator/events",label:"My Events",icon:""},{type:"link",to:"/creator/events/new",label:"Create Event",icon:""},{type:"link",to:"/creator/profile-setup",label:"Profile Setup",icon:""},{type:"link",to:"/creator/followers",label:"Followers",icon:""},{type:"link",to:"/creator/earnings",label:"Earnings",icon:""},{type:"link",to:"/creator/withdrawals",label:"Withdrawals",icon:""},{type:"link",to:"/creator/meets",label:"Upcoming Meets",icon:""},{type:"link",to:"/creator/messages",label:"Messages",icon:""},{type:"link",to:"/creator/notifications",label:"Notifications",icon:""},{type:"link",to:"/creator/settings",label:"Settings",icon:""},{type:"link",to:"/creator/support",label:"Help & Support",icon:""}]},admin:{title:"Admin Command Center",menu:[{type:"link",to:"/admin",label:"Dashboard",icon:""},{type:"section",label:"USER MANAGEMENT"},{type:"link",to:"/admin/users",label:"All Users",icon:""},{type:"link",to:"/admin/creators",label:"Creators Management",icon:""},{type:"link",to:"/admin/fans",label:"Fans Management",icon:""},{type:"section",label:"CONTENT MANAGEMENT"},{type:"link",to:"/admin/events",label:"Events Management",icon:""},{type:"link",to:"/admin/featured",label:"Featured Creators",icon:""},{type:"link",to:"/admin/announcements",label:"Announcements",icon:""},{type:"section",label:"FINANCIAL"},{type:"link",to:"/admin/payments",label:"Payments & Transactions",icon:""},{type:"link",to:"/admin/withdrawals",label:"Withdrawal Requests",icon:""},{type:"link",to:"/admin/refunds",label:"Refunds Management",icon:""},{type:"link",to:"/admin/revenue-analytics",label:"Revenue Analytics",icon:""},{type:"link",to:"/admin/platform-commission",label:"Platform Commission",icon:""},{type:"section",label:"REPORTS & ANALYTICS"},{type:"link",to:"/admin/business-analytics",label:"Business Analytics",icon:""},{type:"link",to:"/admin/user-analytics",label:"User Analytics",icon:""},{type:"link",to:"/admin/revenue-reports",label:"Revenue Reports",icon:""},{type:"link",to:"/admin/event-analytics",label:"Event Analytics",icon:""},{type:"link",to:"/admin/audit-logs",label:"Audit Logs",icon:""},{type:"section",label:"SUPPORT & MODERATION"},{type:"link",to:"/admin/support-tickets",label:"Support Tickets",icon:""},{type:"link",to:"/admin/reports-flags",label:"Reports & Flags",icon:""},{type:"link",to:"/admin/disputes",label:"Dispute Management",icon:""},{type:"section",label:"PLATFORM SETTINGS"},{type:"link",to:"/admin/settings/general",label:"General Settings",icon:""},{type:"link",to:"/admin/settings/pricing",label:"Pricing & Commission",icon:""},{type:"link",to:"/admin/settings/email-templates",label:"Email Templates",icon:""},{type:"link",to:"/admin/settings/notifications",label:"Notification Settings",icon:""},{type:"link",to:"/admin/settings/security",label:"Security & Access",icon:""},{type:"section",label:"SYSTEM"},{type:"link",to:"/admin/system/logs",label:"System Logs",icon:""},{type:"link",to:"/admin/system/bulk-actions",label:"Bulk Actions",icon:""},{type:"link",to:"/admin/system/backup",label:"Database Backup",icon:""},{type:"section",label:"ACCOUNT"},{type:"link",to:"/admin/profile",label:"My Profile",icon:""}]}},cR=({role:s})=>{var de,me;const n=wge[s],a=Fs(),{logout:l,user:u}=mr(),{notifications:f,unreadNotificationsCount:g,unreadMessagesCount:v,markAllNotificationsAsRead:y}=Jg(),w=u!=null&&u.username?u.username.substring(0,2).toUpperCase():((de=u==null?void 0:u.email)==null?void 0:de.substring(0,2).toUpperCase())||"U",T=u!=null&&u.username?u.username.charAt(0).toUpperCase()+u.username.slice(1):((me=u==null?void 0:u.email)==null?void 0:me.split("@")[0])||"User",S=L.useMemo(()=>`/${s}`,[s]),[I,j]=L.useState(!1),[B,A]=L.useState(!1),[F,D]=L.useState(320),[R,O]=L.useState(!1),[V,G]=L.useState("none"),[J,$]=L.useState(""),q=()=>{l(),a("/auth")};L.useEffect(()=>{if(!R)return;const ve=De=>{const ae=Math.min(420,Math.max(220,De.clientX));D(ae)},_e=()=>{O(!1)};return window.addEventListener("mousemove",ve),window.addEventListener("mouseup",_e),()=>{window.removeEventListener("mousemove",ve),window.removeEventListener("mouseup",_e)}},[R]);const ee=ve=>n.menu.map(_e=>{if("type"in _e&&_e.type==="section")return o.jsx("div",{className:"mt-4 mb-1 text-xs font-semibold uppercase tracking-[0.2em] text-white/60",children:_e.label},_e.label);const De=_e,Xe=!!De.disabled,Oe=De.to===S;let ae=0;return De.label==="Notifications"?ae=g:De.label==="Messages"&&(ae=v),o.jsxs(ll,{to:De.to,end:Oe,onClick:Ee=>{if(Xe){Ee.preventDefault(),Ee.stopPropagation();return}ve!=null&&ve.closeOnSelect&&j(!1)},className:({isActive:Ee})=>Kd("flex items-center gap-3 rounded-[12px] border border-transparent px-5 py-3 text-base transition-all",Xe?"cursor-not-allowed text-white/40 opacity-60":Ee?"bg-white/10 text-white font-semibold shadow-[0_18px_45px_rgba(0,0,0,0.65)]":"text-white/75 hover:bg-white/5 hover:text-white"),children:[o.jsx("span",{className:Kd("flex-1",s==="admin"?"font-semibold tracking-wide":"",B?"hidden":""),children:De.label}),!Xe&&ae>0?o.jsx(Ye,{variant:"danger",children:ae}):null]},De.to)}),ne=()=>V==="notifications"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center justify-between border-b border-[#E9ECEF] px-5 py-4",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Notifications"}),o.jsx("div",{className:"text-xs text-[#6C757D]",children:"Latest updates on your bids and meets."})]}),o.jsx(ue,{variant:"secondary",size:"sm",className:"border-none bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>y(),children:"Mark all read"})]}),o.jsx("div",{className:"flex-1 space-y-3 overflow-y-auto px-5 py-4",children:f.length===0?o.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No notifications yet."}):f.slice(0,5).map(ve=>o.jsxs("div",{className:"rounded-[12px] bg-white/90 p-3 shadow-sm",children:[o.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:ve.title}),o.jsx("div",{className:"text-xs text-[#6C757D]",children:ve.message}),o.jsx("div",{className:"mt-1 text-[10px] text-[#ADB5BD]",children:lu(new Date(ve.created_at),"MMM d, h:mm a")})]},ve.id))}),o.jsx("div",{className:"border-t border-[#E9ECEF] p-4",children:o.jsx(ue,{variant:"secondary",size:"sm",className:"w-full border-none bg-white text-[#050014] hover:bg-[#F8F9FA]",onClick:()=>a(`/${s}/notifications`),children:"View all notifications"})})]}):V==="profile"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center gap-3 border-b border-[#E9ECEF] px-5 py-4",children:[o.jsx(Mi,{initials:w,size:"md"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:T}),o.jsxs("div",{className:"text-xs text-[#6C757D]",children:[s.charAt(0).toUpperCase()+s.slice(1)," account  Premium"]})]})]}),o.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4",children:[o.jsxs("div",{className:"rounded-[12px] bg-white/90 p-3 shadow-sm",children:[o.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:"Payment Info"}),o.jsx("div",{className:"mt-1 text-sm font-semibold text-[#212529]",children:"Auto-refund enabled"}),o.jsx("div",{className:"mt-1 text-xs text-[#6C757D]",children:"90% refund for unsuccessful bids"})]}),o.jsxs("div",{className:"grid gap-2 text-sm text-[#343A40]",children:[o.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>a(`/${s}/wallet`),children:[o.jsx("span",{children:"Payment history"}),o.jsx("span",{children:""})]}),o.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>a(`/${s}/meets`),children:[o.jsx("span",{children:"Upcoming meets"}),o.jsx("span",{children:""})]}),o.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>a(`/${s}/settings`),children:[o.jsx("span",{children:"Profile & settings"}),o.jsx("span",{children:""})]})]})]}),o.jsx("div",{className:"border-t border-[#E9ECEF] p-4",children:o.jsx(ue,{variant:"secondary",size:"sm",className:"w-full border-none bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>{q()},children:"Switch account"})})]}):null;return o.jsxs("div",{className:"flex min-h-screen bg-[#F8F9FA]",children:[o.jsxs("aside",{className:"sticky top-0 hidden h-screen max-h-screen flex-shrink-0 border-r border-[#1F2933] bg-gradient-to-b from-[#050014] via-[#050014] to-[#140423] text-white md:flex md:flex-col relative",style:{width:B?80:F},children:[o.jsxs("div",{className:Kd("flex flex-1 flex-col overflow-y-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden py-8",B?"px-3":"px-6"),children:[o.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[o.jsx(Mi,{initials:w,size:"lg"}),o.jsxs("div",{className:Kd("text-lg font-semibold text-white",B?"hidden":""),children:["Hey, ",T,"!"]}),B?null:o.jsx(Ye,{variant:"primary",children:"Premium"})]}),o.jsx("nav",{className:"mt-8 flex flex-1 flex-col gap-1",children:ee()})]}),o.jsx("button",{type:"button",onClick:()=>A(ve=>!ve),className:"absolute -right-3 top-24 hidden h-7 w-7 items-center justify-center rounded-full border border-white/30 bg-[#050014] text-xs text-white shadow-md transition hover:bg-white hover:text-[#050014] md:flex",children:B?"":""}),o.jsx("div",{className:"absolute right-0 top-0 hidden h-full w-1 cursor-col-resize md:block",onMouseDown:()=>O(!0)}),o.jsx("div",{className:"px-6 pb-6",children:o.jsx("button",{type:"button",className:"inline-flex h-10 w-full items-center justify-start rounded-[8px] bg-black px-4 text-sm font-semibold text-white transition-colors hover:bg-black/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:q,children:"Logout"})})]}),I&&o.jsxs("div",{className:"fixed inset-0 z-40 flex md:hidden",children:[o.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:()=>j(!1)}),o.jsxs("div",{className:"relative z-10 flex h-full w-[260px] flex-col border-r border-[#1F2933] bg-gradient-to-b from-[#050014] via-[#050014] to-[#140423] text-white",children:[o.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 px-4 py-3",children:[o.jsx("span",{className:"text-sm font-semibold text-white",children:n.title}),o.jsx("button",{type:"button",className:"rounded-md border border-white/30 p-1 text-white",onClick:()=>j(!1),children:""})]}),o.jsxs("div",{className:"flex flex-1 flex-col overflow-y-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden px-4 py-4",children:[o.jsx("nav",{className:"flex flex-1 flex-col gap-1",children:ee({closeOnSelect:!0})}),o.jsx("div",{className:"mt-4",children:o.jsx("button",{type:"button",className:"inline-flex h-10 w-full items-center justify-start rounded-[8px] bg-black px-4 text-sm font-semibold text-white transition-colors hover:bg-black/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:q,children:"Logout"})})]})]})]}),V!=="none"&&o.jsx("div",{className:"fixed inset-y-0 right-0 z-30 hidden w-80 flex-col border-l border-[#E9ECEF] bg-gradient-to-b from-[#FFF7FF] via-[#F4E6FF] to-[#F5F0FF] shadow-[0_0_45px_rgba(15,23,42,0.25)] backdrop-blur-xl md:flex",onMouseLeave:()=>G("none"),children:ne()}),o.jsxs("div",{className:"flex w-full flex-col",children:[o.jsxs("header",{className:"sticky top-0 z-40 flex h-[70px] items-center justify-between border-b border-[#E9ECEF] bg-white px-6 shadow-sm",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-md border border-[#E9ECEF] p-2 text-[#343A40] md:hidden",onClick:()=>j(ve=>!ve),children:[o.jsx("span",{className:"sr-only",children:"Open sidebar"}),o.jsxs("div",{className:"flex flex-col gap-[3px]",children:[o.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),o.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),o.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"})]})]}),o.jsx("div",{className:"text-xl font-semibold text-[#212529]",children:n.title})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"relative hidden md:block",children:[o.jsx("input",{className:"h-11 rounded-[12px] border-2 border-[#E9ECEF] px-4 pr-10 text-sm focus:border-[#FF6B35] focus:shadow-[0_0_0_3px_rgba(255,107,53,0.1)]",placeholder:"Search events, creators",value:J,onChange:ve=>$(ve.target.value),onKeyDown:ve=>{ve.key==="Enter"&&a(`${s==="fan"?"/fan":"/browse-events"}?q=${encodeURIComponent(J)}`)}}),o.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-lg text-[#6C757D]",children:""})]}),o.jsx("div",{className:"hidden md:block",onMouseEnter:()=>G("notifications"),children:o.jsxs(ue,{variant:"secondary",size:"icon",className:"bg-black text-white border-none hover:bg-black/90 relative",children:["",g>0&&o.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white",children:g})]})}),o.jsx("div",{className:"hidden md:block",onMouseEnter:()=>G("profile"),children:o.jsx(Mi,{initials:w,size:"sm"})}),o.jsxs("div",{className:"flex items-center gap-2 md:hidden",children:[o.jsxs(ue,{variant:"secondary",size:"icon",className:"bg-black text-white border-none hover:bg-black/90 relative",onClick:()=>G(V==="notifications"?"none":"notifications"),children:["",g>0&&o.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white",children:g})]}),o.jsx(Mi,{initials:w,size:"sm"})]})]})]}),o.jsx("main",{className:"flex-1 px-4 py-6 md:px-12 md:py-10",children:o.jsx(u9,{})})]})]})},uI=L.createContext({});function Kp(s){const n=L.useRef(null);return n.current===null&&(n.current=s()),n.current}const hI=typeof window<"u",cb=hI?L.useLayoutEffect:L.useEffect,lb=L.createContext(null);function pI(s,n){s.indexOf(n)===-1&&s.push(n)}function fI(s,n){const a=s.indexOf(n);a>-1&&s.splice(a,1)}const Ho=(s,n,a)=>a>n?n:a<s?s:a;let kg=()=>{};const wc={},Y9=s=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(s);function $9(s){return typeof s=="object"&&s!==null}const X9=s=>/^0[^.\s]+$/u.test(s);function mI(s){let n;return()=>(n===void 0&&(n=s()),n)}const vi=s=>s,Sge=(s,n)=>a=>n(s(a)),Qg=(...s)=>s.reduce(Sge),Lp=(s,n,a)=>{const l=n-s;return l===0?1:(a-s)/l};class gI{constructor(){this.subscriptions=[]}add(n){return pI(this.subscriptions,n),()=>fI(this.subscriptions,n)}notify(n,a,l){const u=this.subscriptions.length;if(u)if(u===1)this.subscriptions[0](n,a,l);else for(let f=0;f<u;f++){const g=this.subscriptions[f];g&&g(n,a,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Wo=s=>s*1e3,ya=s=>s/1e3;function _I(s,n){return n?s*(1e3/n):0}const J9=(s,n,a)=>(((1-3*a+3*n)*s+(3*a-6*n))*s+3*n)*s,Cge=1e-7,Tge=12;function Rge(s,n,a,l,u){let f,g,v=0;do g=n+(a-n)/2,f=J9(g,l,u)-s,f>0?a=g:n=g;while(Math.abs(f)>Cge&&++v<Tge);return g}function Zg(s,n,a,l){if(s===n&&a===l)return vi;const u=f=>Rge(f,0,1,s,a);return f=>f===0||f===1?f:J9(u(f),n,l)}const Q9=s=>n=>n<=.5?s(2*n)/2:(2-s(2*(1-n)))/2,Z9=s=>n=>1-s(1-n),eG=Zg(.33,1.53,.69,.99),EI=Z9(eG),tG=Q9(EI),rG=s=>(s*=2)<1?.5*EI(s):.5*(2-Math.pow(2,-10*(s-1))),vI=s=>1-Math.sin(Math.acos(s)),sG=Z9(vI),nG=Q9(vI),Nge=Zg(.42,0,1,1),Age=Zg(0,0,.58,1),iG=Zg(.42,0,.58,1),Ige=s=>Array.isArray(s)&&typeof s[0]!="number",aG=s=>Array.isArray(s)&&typeof s[0]=="number",Oge={linear:vi,easeIn:Nge,easeInOut:iG,easeOut:Age,circIn:vI,circInOut:nG,circOut:sG,backIn:EI,backInOut:tG,backOut:eG,anticipate:rG},Dge=s=>typeof s=="string",BB=s=>{if(aG(s)){kg(s.length===4);const[n,a,l,u]=s;return Zg(n,a,l,u)}else if(Dge(s))return Oge[s];return s},Sy=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Pge(s,n){let a=new Set,l=new Set,u=!1,f=!1;const g=new WeakSet;let v={delta:0,timestamp:0,isProcessing:!1};function y(T){g.has(T)&&(w.schedule(T),s()),T(v)}const w={schedule:(T,S=!1,I=!1)=>{const B=I&&u?a:l;return S&&g.add(T),B.has(T)||B.add(T),T},cancel:T=>{l.delete(T),g.delete(T)},process:T=>{if(v=T,u){f=!0;return}u=!0,[a,l]=[l,a],a.forEach(y),a.clear(),u=!1,f&&(f=!1,w.process(T))}};return w}const kge=40;function oG(s,n){let a=!1,l=!0;const u={delta:0,timestamp:0,isProcessing:!1},f=()=>a=!0,g=Sy.reduce((O,V)=>(O[V]=Pge(f),O),{}),{setup:v,read:y,resolveKeyframes:w,preUpdate:T,update:S,preRender:I,render:j,postRender:B}=g,A=()=>{const O=wc.useManualTiming?u.timestamp:performance.now();a=!1,wc.useManualTiming||(u.delta=l?1e3/60:Math.max(Math.min(O-u.timestamp,kge),1)),u.timestamp=O,u.isProcessing=!0,v.process(u),y.process(u),w.process(u),T.process(u),S.process(u),I.process(u),j.process(u),B.process(u),u.isProcessing=!1,a&&n&&(l=!1,s(A))},F=()=>{a=!0,l=!0,u.isProcessing||s(A)};return{schedule:Sy.reduce((O,V)=>{const G=g[V];return O[V]=(J,$=!1,q=!1)=>(a||F(),G.schedule(J,$,q)),O},{}),cancel:O=>{for(let V=0;V<Sy.length;V++)g[Sy[V]].cancel(O)},state:u,steps:g}}const{schedule:Br,cancel:oo,state:an,steps:lR}=oG(typeof requestAnimationFrame<"u"?requestAnimationFrame:vi,!0);let Hy;function jge(){Hy=void 0}const mi={now:()=>(Hy===void 0&&mi.set(an.isProcessing||wc.useManualTiming?an.timestamp:performance.now()),Hy),set:s=>{Hy=s,queueMicrotask(jge)}},cG=s=>n=>typeof n=="string"&&n.startsWith(s),yI=cG("--"),Lge=cG("var(--"),xI=s=>Lge(s)?Mge.test(s.split("/*")[0].trim()):!1,Mge=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,qp={test:s=>typeof s=="number",parse:parseFloat,transform:s=>s},jg={...qp,transform:s=>Ho(0,1,s)},Cy={...qp,default:1},ag=s=>Math.round(s*1e5)/1e5,bI=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Fge(s){return s==null}const Uge=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,wI=(s,n)=>a=>!!(typeof a=="string"&&Uge.test(a)&&a.startsWith(s)||n&&!Fge(a)&&Object.prototype.hasOwnProperty.call(a,n)),lG=(s,n,a)=>l=>{if(typeof l!="string")return l;const[u,f,g,v]=l.match(bI);return{[s]:parseFloat(u),[n]:parseFloat(f),[a]:parseFloat(g),alpha:v!==void 0?parseFloat(v):1}},Vge=s=>Ho(0,255,s),dR={...qp,transform:s=>Math.round(Vge(s))},qd={test:wI("rgb","red"),parse:lG("red","green","blue"),transform:({red:s,green:n,blue:a,alpha:l=1})=>"rgba("+dR.transform(s)+", "+dR.transform(n)+", "+dR.transform(a)+", "+ag(jg.transform(l))+")"};function Bge(s){let n="",a="",l="",u="";return s.length>5?(n=s.substring(1,3),a=s.substring(3,5),l=s.substring(5,7),u=s.substring(7,9)):(n=s.substring(1,2),a=s.substring(2,3),l=s.substring(3,4),u=s.substring(4,5),n+=n,a+=a,l+=l,u+=u),{red:parseInt(n,16),green:parseInt(a,16),blue:parseInt(l,16),alpha:u?parseInt(u,16)/255:1}}const MN={test:wI("#"),parse:Bge,transform:qd.transform},e_=s=>({test:n=>typeof n=="string"&&n.endsWith(s)&&n.split(" ").length===1,parse:parseFloat,transform:n=>`${n}${s}`}),ul=e_("deg"),Go=e_("%"),Ut=e_("px"),Wge=e_("vh"),Gge=e_("vw"),WB={...Go,parse:s=>Go.parse(s)/100,transform:s=>Go.transform(s*100)},sp={test:wI("hsl","hue"),parse:lG("hue","saturation","lightness"),transform:({hue:s,saturation:n,lightness:a,alpha:l=1})=>"hsla("+Math.round(s)+", "+Go.transform(ag(n))+", "+Go.transform(ag(a))+", "+ag(jg.transform(l))+")"},Gs={test:s=>qd.test(s)||MN.test(s)||sp.test(s),parse:s=>qd.test(s)?qd.parse(s):sp.test(s)?sp.parse(s):MN.parse(s),transform:s=>typeof s=="string"?s:s.hasOwnProperty("red")?qd.transform(s):sp.transform(s),getAnimatableNone:s=>{const n=Gs.parse(s);return n.alpha=0,Gs.transform(n)}},Hge=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function zge(s){var n,a;return isNaN(s)&&typeof s=="string"&&(((n=s.match(bI))==null?void 0:n.length)||0)+(((a=s.match(Hge))==null?void 0:a.length)||0)>0}const dG="number",uG="color",Kge="var",qge="var(",GB="${}",Yge=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Lg(s){const n=s.toString(),a=[],l={color:[],number:[],var:[]},u=[];let f=0;const v=n.replace(Yge,y=>(Gs.test(y)?(l.color.push(f),u.push(uG),a.push(Gs.parse(y))):y.startsWith(qge)?(l.var.push(f),u.push(Kge),a.push(y)):(l.number.push(f),u.push(dG),a.push(parseFloat(y))),++f,GB)).split(GB);return{values:a,split:v,indexes:l,types:u}}function hG(s){return Lg(s).values}function pG(s){const{split:n,types:a}=Lg(s),l=n.length;return u=>{let f="";for(let g=0;g<l;g++)if(f+=n[g],u[g]!==void 0){const v=a[g];v===dG?f+=ag(u[g]):v===uG?f+=Gs.transform(u[g]):f+=u[g]}return f}}const $ge=s=>typeof s=="number"?0:Gs.test(s)?Gs.getAnimatableNone(s):s;function Xge(s){const n=hG(s);return pG(s)(n.map($ge))}const Ul={test:zge,parse:hG,createTransformer:pG,getAnimatableNone:Xge};function uR(s,n,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?s+(n-s)*6*a:a<1/2?n:a<2/3?s+(n-s)*(2/3-a)*6:s}function Jge({hue:s,saturation:n,lightness:a,alpha:l}){s/=360,n/=100,a/=100;let u=0,f=0,g=0;if(!n)u=f=g=a;else{const v=a<.5?a*(1+n):a+n-a*n,y=2*a-v;u=uR(y,v,s+1/3),f=uR(y,v,s),g=uR(y,v,s-1/3)}return{red:Math.round(u*255),green:Math.round(f*255),blue:Math.round(g*255),alpha:l}}function Tx(s,n){return a=>a>0?n:s}const _s=(s,n,a)=>s+(n-s)*a,hR=(s,n,a)=>{const l=s*s,u=a*(n*n-l)+l;return u<0?0:Math.sqrt(u)},Qge=[MN,qd,sp],Zge=s=>Qge.find(n=>n.test(s));function HB(s){const n=Zge(s);if(!n)return!1;let a=n.parse(s);return n===sp&&(a=Jge(a)),a}const zB=(s,n)=>{const a=HB(s),l=HB(n);if(!a||!l)return Tx(s,n);const u={...a};return f=>(u.red=hR(a.red,l.red,f),u.green=hR(a.green,l.green,f),u.blue=hR(a.blue,l.blue,f),u.alpha=_s(a.alpha,l.alpha,f),qd.transform(u))},FN=new Set(["none","hidden"]);function e_e(s,n){return FN.has(s)?a=>a<=0?s:n:a=>a>=1?n:s}function t_e(s,n){return a=>_s(s,n,a)}function SI(s){return typeof s=="number"?t_e:typeof s=="string"?xI(s)?Tx:Gs.test(s)?zB:n_e:Array.isArray(s)?fG:typeof s=="object"?Gs.test(s)?zB:r_e:Tx}function fG(s,n){const a=[...s],l=a.length,u=s.map((f,g)=>SI(f)(f,n[g]));return f=>{for(let g=0;g<l;g++)a[g]=u[g](f);return a}}function r_e(s,n){const a={...s,...n},l={};for(const u in a)s[u]!==void 0&&n[u]!==void 0&&(l[u]=SI(s[u])(s[u],n[u]));return u=>{for(const f in l)a[f]=l[f](u);return a}}function s_e(s,n){const a=[],l={color:0,var:0,number:0};for(let u=0;u<n.values.length;u++){const f=n.types[u],g=s.indexes[f][l[f]],v=s.values[g]??0;a[u]=v,l[f]++}return a}const n_e=(s,n)=>{const a=Ul.createTransformer(n),l=Lg(s),u=Lg(n);return l.indexes.var.length===u.indexes.var.length&&l.indexes.color.length===u.indexes.color.length&&l.indexes.number.length>=u.indexes.number.length?FN.has(s)&&!u.values.length||FN.has(n)&&!l.values.length?e_e(s,n):Qg(fG(s_e(l,u),u.values),a):Tx(s,n)};function mG(s,n,a){return typeof s=="number"&&typeof n=="number"&&typeof a=="number"?_s(s,n,a):SI(s)(s,n)}const i_e=s=>{const n=({timestamp:a})=>s(a);return{start:(a=!0)=>Br.update(n,a),stop:()=>oo(n),now:()=>an.isProcessing?an.timestamp:mi.now()}},gG=(s,n,a=10)=>{let l="";const u=Math.max(Math.round(n/a),2);for(let f=0;f<u;f++)l+=Math.round(s(f/(u-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},Rx=2e4;function CI(s){let n=0;const a=50;let l=s.next(n);for(;!l.done&&n<Rx;)n+=a,l=s.next(n);return n>=Rx?1/0:n}function a_e(s,n=100,a){const l=a({...s,keyframes:[0,n]}),u=Math.min(CI(l),Rx);return{type:"keyframes",ease:f=>l.next(u*f).value/n,duration:ya(u)}}const o_e=5;function _G(s,n,a){const l=Math.max(n-o_e,0);return _I(a-s(l),n-l)}const Ns={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},pR=.001;function c_e({duration:s=Ns.duration,bounce:n=Ns.bounce,velocity:a=Ns.velocity,mass:l=Ns.mass}){let u,f,g=1-n;g=Ho(Ns.minDamping,Ns.maxDamping,g),s=Ho(Ns.minDuration,Ns.maxDuration,ya(s)),g<1?(u=w=>{const T=w*g,S=T*s,I=T-a,j=UN(w,g),B=Math.exp(-S);return pR-I/j*B},f=w=>{const S=w*g*s,I=S*a+a,j=Math.pow(g,2)*Math.pow(w,2)*s,B=Math.exp(-S),A=UN(Math.pow(w,2),g);return(-u(w)+pR>0?-1:1)*((I-j)*B)/A}):(u=w=>{const T=Math.exp(-w*s),S=(w-a)*s+1;return-pR+T*S},f=w=>{const T=Math.exp(-w*s),S=(a-w)*(s*s);return T*S});const v=5/s,y=d_e(u,f,v);if(s=Wo(s),isNaN(y))return{stiffness:Ns.stiffness,damping:Ns.damping,duration:s};{const w=Math.pow(y,2)*l;return{stiffness:w,damping:g*2*Math.sqrt(l*w),duration:s}}}const l_e=12;function d_e(s,n,a){let l=a;for(let u=1;u<l_e;u++)l=l-s(l)/n(l);return l}function UN(s,n){return s*Math.sqrt(1-n*n)}const u_e=["duration","bounce"],h_e=["stiffness","damping","mass"];function KB(s,n){return n.some(a=>s[a]!==void 0)}function p_e(s){let n={velocity:Ns.velocity,stiffness:Ns.stiffness,damping:Ns.damping,mass:Ns.mass,isResolvedFromDuration:!1,...s};if(!KB(s,h_e)&&KB(s,u_e))if(s.visualDuration){const a=s.visualDuration,l=2*Math.PI/(a*1.2),u=l*l,f=2*Ho(.05,1,1-(s.bounce||0))*Math.sqrt(u);n={...n,mass:Ns.mass,stiffness:u,damping:f}}else{const a=c_e(s);n={...n,...a,mass:Ns.mass},n.isResolvedFromDuration=!0}return n}function Nx(s=Ns.visualDuration,n=Ns.bounce){const a=typeof s!="object"?{visualDuration:s,keyframes:[0,1],bounce:n}:s;let{restSpeed:l,restDelta:u}=a;const f=a.keyframes[0],g=a.keyframes[a.keyframes.length-1],v={done:!1,value:f},{stiffness:y,damping:w,mass:T,duration:S,velocity:I,isResolvedFromDuration:j}=p_e({...a,velocity:-ya(a.velocity||0)}),B=I||0,A=w/(2*Math.sqrt(y*T)),F=g-f,D=ya(Math.sqrt(y/T)),R=Math.abs(F)<5;l||(l=R?Ns.restSpeed.granular:Ns.restSpeed.default),u||(u=R?Ns.restDelta.granular:Ns.restDelta.default);let O;if(A<1){const G=UN(D,A);O=J=>{const $=Math.exp(-A*D*J);return g-$*((B+A*D*F)/G*Math.sin(G*J)+F*Math.cos(G*J))}}else if(A===1)O=G=>g-Math.exp(-D*G)*(F+(B+D*F)*G);else{const G=D*Math.sqrt(A*A-1);O=J=>{const $=Math.exp(-A*D*J),q=Math.min(G*J,300);return g-$*((B+A*D*F)*Math.sinh(q)+G*F*Math.cosh(q))/G}}const V={calculatedDuration:j&&S||null,next:G=>{const J=O(G);if(j)v.done=G>=S;else{let $=G===0?B:0;A<1&&($=G===0?Wo(B):_G(O,G,J));const q=Math.abs($)<=l,ee=Math.abs(g-J)<=u;v.done=q&&ee}return v.value=v.done?g:J,v},toString:()=>{const G=Math.min(CI(V),Rx),J=gG($=>V.next(G*$).value,G,30);return G+"ms "+J},toTransition:()=>{}};return V}Nx.applyToOptions=s=>{const n=a_e(s,100,Nx);return s.ease=n.ease,s.duration=Wo(n.duration),s.type="keyframes",s};function VN({keyframes:s,velocity:n=0,power:a=.8,timeConstant:l=325,bounceDamping:u=10,bounceStiffness:f=500,modifyTarget:g,min:v,max:y,restDelta:w=.5,restSpeed:T}){const S=s[0],I={done:!1,value:S},j=q=>v!==void 0&&q<v||y!==void 0&&q>y,B=q=>v===void 0?y:y===void 0||Math.abs(v-q)<Math.abs(y-q)?v:y;let A=a*n;const F=S+A,D=g===void 0?F:g(F);D!==F&&(A=D-S);const R=q=>-A*Math.exp(-q/l),O=q=>D+R(q),V=q=>{const ee=R(q),ne=O(q);I.done=Math.abs(ee)<=w,I.value=I.done?D:ne};let G,J;const $=q=>{j(I.value)&&(G=q,J=Nx({keyframes:[I.value,B(I.value)],velocity:_G(O,q,I.value),damping:u,stiffness:f,restDelta:w,restSpeed:T}))};return $(0),{calculatedDuration:null,next:q=>{let ee=!1;return!J&&G===void 0&&(ee=!0,V(q),$(q)),G!==void 0&&q>=G?J.next(q-G):(!ee&&V(q),I)}}}function f_e(s,n,a){const l=[],u=a||wc.mix||mG,f=s.length-1;for(let g=0;g<f;g++){let v=u(s[g],s[g+1]);if(n){const y=Array.isArray(n)?n[g]||vi:n;v=Qg(y,v)}l.push(v)}return l}function TI(s,n,{clamp:a=!0,ease:l,mixer:u}={}){const f=s.length;if(kg(f===n.length),f===1)return()=>n[0];if(f===2&&n[0]===n[1])return()=>n[1];const g=s[0]===s[1];s[0]>s[f-1]&&(s=[...s].reverse(),n=[...n].reverse());const v=f_e(n,l,u),y=v.length,w=T=>{if(g&&T<s[0])return n[0];let S=0;if(y>1)for(;S<s.length-2&&!(T<s[S+1]);S++);const I=Lp(s[S],s[S+1],T);return v[S](I)};return a?T=>w(Ho(s[0],s[f-1],T)):w}function m_e(s,n){const a=s[s.length-1];for(let l=1;l<=n;l++){const u=Lp(0,n,l);s.push(_s(a,1,u))}}function EG(s){const n=[0];return m_e(n,s.length-1),n}function g_e(s,n){return s.map(a=>a*n)}function __e(s,n){return s.map(()=>n||iG).splice(0,s.length-1)}function og({duration:s=300,keyframes:n,times:a,ease:l="easeInOut"}){const u=Ige(l)?l.map(BB):BB(l),f={done:!1,value:n[0]},g=g_e(a&&a.length===n.length?a:EG(n),s),v=TI(g,n,{ease:Array.isArray(u)?u:__e(n,u)});return{calculatedDuration:s,next:y=>(f.value=v(y),f.done=y>=s,f)}}const E_e=s=>s!==null;function RI(s,{repeat:n,repeatType:a="loop"},l,u=1){const f=s.filter(E_e),v=u<0||n&&a!=="loop"&&n%2===1?0:f.length-1;return!v||l===void 0?f[v]:l}const v_e={decay:VN,inertia:VN,tween:og,keyframes:og,spring:Nx};function vG(s){typeof s.type=="string"&&(s.type=v_e[s.type])}class NI{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(n=>{this.resolve=n})}notifyFinished(){this.resolve()}then(n,a){return this.finished.then(n,a)}}const y_e=s=>s/100;class AI extends NI{constructor(n){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var l,u;const{motionValue:a}=this.options;a&&a.updatedAt!==mi.now()&&this.tick(mi.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(u=(l=this.options).onStop)==null||u.call(l))},this.options=n,this.initAnimation(),this.play(),n.autoplay===!1&&this.pause()}initAnimation(){const{options:n}=this;vG(n);const{type:a=og,repeat:l=0,repeatDelay:u=0,repeatType:f,velocity:g=0}=n;let{keyframes:v}=n;const y=a||og;y!==og&&typeof v[0]!="number"&&(this.mixKeyframes=Qg(y_e,mG(v[0],v[1])),v=[0,100]);const w=y({...n,keyframes:v});f==="mirror"&&(this.mirroredGenerator=y({...n,keyframes:[...v].reverse(),velocity:-g})),w.calculatedDuration===null&&(w.calculatedDuration=CI(w));const{calculatedDuration:T}=w;this.calculatedDuration=T,this.resolvedDuration=T+u,this.totalDuration=this.resolvedDuration*(l+1)-u,this.generator=w}updateTime(n){const a=Math.round(n-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=a}tick(n,a=!1){const{generator:l,totalDuration:u,mixKeyframes:f,mirroredGenerator:g,resolvedDuration:v,calculatedDuration:y}=this;if(this.startTime===null)return l.next(0);const{delay:w=0,keyframes:T,repeat:S,repeatType:I,repeatDelay:j,type:B,onUpdate:A,finalKeyframe:F}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,n):this.speed<0&&(this.startTime=Math.min(n-u/this.speed,this.startTime)),a?this.currentTime=n:this.updateTime(n);const D=this.currentTime-w*(this.playbackSpeed>=0?1:-1),R=this.playbackSpeed>=0?D<0:D>u;this.currentTime=Math.max(D,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let O=this.currentTime,V=l;if(S){const q=Math.min(this.currentTime,u)/v;let ee=Math.floor(q),ne=q%1;!ne&&q>=1&&(ne=1),ne===1&&ee--,ee=Math.min(ee,S+1),!!(ee%2)&&(I==="reverse"?(ne=1-ne,j&&(ne-=j/v)):I==="mirror"&&(V=g)),O=Ho(0,1,ne)*v}const G=R?{done:!1,value:T[0]}:V.next(O);f&&(G.value=f(G.value));let{done:J}=G;!R&&y!==null&&(J=this.playbackSpeed>=0?this.currentTime>=u:this.currentTime<=0);const $=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&J);return $&&B!==VN&&(G.value=RI(T,this.options,F,this.speed)),A&&A(G.value),$&&this.finish(),G}then(n,a){return this.finished.then(n,a)}get duration(){return ya(this.calculatedDuration)}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+ya(n)}get time(){return ya(this.currentTime)}set time(n){var a;n=Wo(n),this.currentTime=n,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=n:this.driver&&(this.startTime=this.driver.now()-n/this.playbackSpeed),(a=this.driver)==null||a.start(!1)}get speed(){return this.playbackSpeed}set speed(n){this.updateTime(mi.now());const a=this.playbackSpeed!==n;this.playbackSpeed=n,a&&(this.time=ya(this.currentTime))}play(){var u,f;if(this.isStopped)return;const{driver:n=i_e,startTime:a}=this.options;this.driver||(this.driver=n(g=>this.tick(g))),(f=(u=this.options).onPlay)==null||f.call(u);const l=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=l):this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime||(this.startTime=a??l),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(mi.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var n,a;this.notifyFinished(),this.teardown(),this.state="finished",(a=(n=this.options).onComplete)==null||a.call(n)}cancel(){var n,a;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(a=(n=this.options).onCancel)==null||a.call(n)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(n){return this.startTime=0,this.tick(n,!0)}attachTimeline(n){var a;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(a=this.driver)==null||a.stop(),n.observe(this)}}function x_e(s){for(let n=1;n<s.length;n++)s[n]??(s[n]=s[n-1])}const Yd=s=>s*180/Math.PI,BN=s=>{const n=Yd(Math.atan2(s[1],s[0]));return WN(n)},b_e={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:s=>(Math.abs(s[0])+Math.abs(s[3]))/2,rotate:BN,rotateZ:BN,skewX:s=>Yd(Math.atan(s[1])),skewY:s=>Yd(Math.atan(s[2])),skew:s=>(Math.abs(s[1])+Math.abs(s[2]))/2},WN=s=>(s=s%360,s<0&&(s+=360),s),qB=BN,YB=s=>Math.sqrt(s[0]*s[0]+s[1]*s[1]),$B=s=>Math.sqrt(s[4]*s[4]+s[5]*s[5]),w_e={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:YB,scaleY:$B,scale:s=>(YB(s)+$B(s))/2,rotateX:s=>WN(Yd(Math.atan2(s[6],s[5]))),rotateY:s=>WN(Yd(Math.atan2(-s[2],s[0]))),rotateZ:qB,rotate:qB,skewX:s=>Yd(Math.atan(s[4])),skewY:s=>Yd(Math.atan(s[1])),skew:s=>(Math.abs(s[1])+Math.abs(s[4]))/2};function GN(s){return s.includes("scale")?1:0}function HN(s,n){if(!s||s==="none")return GN(n);const a=s.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,u;if(a)l=w_e,u=a;else{const v=s.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=b_e,u=v}if(!u)return GN(n);const f=l[n],g=u[1].split(",").map(C_e);return typeof f=="function"?f(g):g[f]}const S_e=(s,n)=>{const{transform:a="none"}=getComputedStyle(s);return HN(a,n)};function C_e(s){return parseFloat(s.trim())}const Yp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],$p=new Set(Yp),XB=s=>s===qp||s===Ut,T_e=new Set(["x","y","z"]),R_e=Yp.filter(s=>!T_e.has(s));function N_e(s){const n=[];return R_e.forEach(a=>{const l=s.getValue(a);l!==void 0&&(n.push([a,l.get()]),l.set(a.startsWith("scale")?1:0))}),n}const tu={width:({x:s},{paddingLeft:n="0",paddingRight:a="0"})=>s.max-s.min-parseFloat(n)-parseFloat(a),height:({y:s},{paddingTop:n="0",paddingBottom:a="0"})=>s.max-s.min-parseFloat(n)-parseFloat(a),top:(s,{top:n})=>parseFloat(n),left:(s,{left:n})=>parseFloat(n),bottom:({y:s},{top:n})=>parseFloat(n)+(s.max-s.min),right:({x:s},{left:n})=>parseFloat(n)+(s.max-s.min),x:(s,{transform:n})=>HN(n,"x"),y:(s,{transform:n})=>HN(n,"y")};tu.translateX=tu.x;tu.translateY=tu.y;const ru=new Set;let zN=!1,KN=!1,qN=!1;function yG(){if(KN){const s=Array.from(ru).filter(l=>l.needsMeasurement),n=new Set(s.map(l=>l.element)),a=new Map;n.forEach(l=>{const u=N_e(l);u.length&&(a.set(l,u),l.render())}),s.forEach(l=>l.measureInitialState()),n.forEach(l=>{l.render();const u=a.get(l);u&&u.forEach(([f,g])=>{var v;(v=l.getValue(f))==null||v.set(g)})}),s.forEach(l=>l.measureEndState()),s.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}KN=!1,zN=!1,ru.forEach(s=>s.complete(qN)),ru.clear()}function xG(){ru.forEach(s=>{s.readKeyframes(),s.needsMeasurement&&(KN=!0)})}function A_e(){qN=!0,xG(),yG(),qN=!1}class II{constructor(n,a,l,u,f,g=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...n],this.onComplete=a,this.name=l,this.motionValue=u,this.element=f,this.isAsync=g}scheduleResolve(){this.state="scheduled",this.isAsync?(ru.add(this),zN||(zN=!0,Br.read(xG),Br.resolveKeyframes(yG))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:n,name:a,element:l,motionValue:u}=this;if(n[0]===null){const f=u==null?void 0:u.get(),g=n[n.length-1];if(f!==void 0)n[0]=f;else if(l&&a){const v=l.readValue(a,g);v!=null&&(n[0]=v)}n[0]===void 0&&(n[0]=g),u&&f===void 0&&u.set(n[0])}x_e(n)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(n=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,n),ru.delete(this)}cancel(){this.state==="scheduled"&&(ru.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const I_e=s=>s.startsWith("--");function O_e(s,n,a){I_e(n)?s.style.setProperty(n,a):s.style[n]=a}const bG=mI(()=>window.ScrollTimeline!==void 0),D_e={};function P_e(s,n){const a=mI(s);return()=>D_e[n]??a()}const wG=P_e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),qm=([s,n,a,l])=>`cubic-bezier(${s}, ${n}, ${a}, ${l})`,JB={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:qm([0,.65,.55,1]),circOut:qm([.55,0,1,.45]),backIn:qm([.31,.01,.66,-.59]),backOut:qm([.33,1.53,.69,.99])};function SG(s,n){if(s)return typeof s=="function"?wG()?gG(s,n):"ease-out":aG(s)?qm(s):Array.isArray(s)?s.map(a=>SG(a,n)||JB.easeOut):JB[s]}function k_e(s,n,a,{delay:l=0,duration:u=300,repeat:f=0,repeatType:g="loop",ease:v="easeOut",times:y}={},w=void 0){const T={[n]:a};y&&(T.offset=y);const S=SG(v,u);Array.isArray(S)&&(T.easing=S);const I={delay:l,duration:u,easing:Array.isArray(S)?"linear":S,fill:"both",iterations:f+1,direction:g==="reverse"?"alternate":"normal"};return w&&(I.pseudoElement=w),s.animate(T,I)}function CG(s){return typeof s=="function"&&"applyToOptions"in s}function j_e({type:s,...n}){return CG(s)&&wG()?s.applyToOptions(n):(n.duration??(n.duration=300),n.ease??(n.ease="easeOut"),n)}class L_e extends NI{constructor(n){if(super(),this.finishedTime=null,this.isStopped=!1,!n)return;const{element:a,name:l,keyframes:u,pseudoElement:f,allowFlatten:g=!1,finalKeyframe:v,onComplete:y}=n;this.isPseudoElement=!!f,this.allowFlatten=g,this.options=n,kg(typeof n.type!="string");const w=j_e(n);this.animation=k_e(a,l,u,w,f),w.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!f){const T=RI(u,this.options,v,this.speed);this.updateMotionValue?this.updateMotionValue(T):O_e(a,l,T),this.animation.cancel()}y==null||y(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var n,a;(a=(n=this.animation).finish)==null||a.call(n)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:n}=this;n==="idle"||n==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,a;this.isPseudoElement||(a=(n=this.animation).commitStyles)==null||a.call(n)}get duration(){var a,l;const n=((l=(a=this.animation.effect)==null?void 0:a.getComputedTiming)==null?void 0:l.call(a).duration)||0;return ya(Number(n))}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+ya(n)}get time(){return ya(Number(this.animation.currentTime)||0)}set time(n){this.finishedTime=null,this.animation.currentTime=Wo(n)}get speed(){return this.animation.playbackRate}set speed(n){n<0&&(this.finishedTime=null),this.animation.playbackRate=n}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(n){this.animation.startTime=n}attachTimeline({timeline:n,observe:a}){var l;return this.allowFlatten&&((l=this.animation.effect)==null||l.updateTiming({easing:"linear"})),this.animation.onfinish=null,n&&bG()?(this.animation.timeline=n,vi):a(this)}}const TG={anticipate:rG,backInOut:tG,circInOut:nG};function M_e(s){return s in TG}function F_e(s){typeof s.ease=="string"&&M_e(s.ease)&&(s.ease=TG[s.ease])}const QB=10;class U_e extends L_e{constructor(n){F_e(n),vG(n),super(n),n.startTime&&(this.startTime=n.startTime),this.options=n}updateMotionValue(n){const{motionValue:a,onUpdate:l,onComplete:u,element:f,...g}=this.options;if(!a)return;if(n!==void 0){a.set(n);return}const v=new AI({...g,autoplay:!1}),y=Wo(this.finishedTime??this.time);a.setWithVelocity(v.sample(y-QB).value,v.sample(y).value,QB),v.stop()}}const ZB=(s,n)=>n==="zIndex"?!1:!!(typeof s=="number"||Array.isArray(s)||typeof s=="string"&&(Ul.test(s)||s==="0")&&!s.startsWith("url("));function V_e(s){const n=s[0];if(s.length===1)return!0;for(let a=0;a<s.length;a++)if(s[a]!==n)return!0}function B_e(s,n,a,l){const u=s[0];if(u===null)return!1;if(n==="display"||n==="visibility")return!0;const f=s[s.length-1],g=ZB(u,n),v=ZB(f,n);return!g||!v?!1:V_e(s)||(a==="spring"||CG(a))&&l}function YN(s){s.duration=0,s.type="keyframes"}const W_e=new Set(["opacity","clipPath","filter","transform"]),G_e=mI(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function H_e(s){var T;const{motionValue:n,name:a,repeatDelay:l,repeatType:u,damping:f,type:g}=s;if(!(((T=n==null?void 0:n.owner)==null?void 0:T.current)instanceof HTMLElement))return!1;const{onUpdate:y,transformTemplate:w}=n.owner.getProps();return G_e()&&a&&W_e.has(a)&&(a!=="transform"||!w)&&!y&&!l&&u!=="mirror"&&f!==0&&g!=="inertia"}const z_e=40;class K_e extends NI{constructor({autoplay:n=!0,delay:a=0,type:l="keyframes",repeat:u=0,repeatDelay:f=0,repeatType:g="loop",keyframes:v,name:y,motionValue:w,element:T,...S}){var B;super(),this.stop=()=>{var A,F;this._animation&&(this._animation.stop(),(A=this.stopTimeline)==null||A.call(this)),(F=this.keyframeResolver)==null||F.cancel()},this.createdAt=mi.now();const I={autoplay:n,delay:a,type:l,repeat:u,repeatDelay:f,repeatType:g,name:y,motionValue:w,element:T,...S},j=(T==null?void 0:T.KeyframeResolver)||II;this.keyframeResolver=new j(v,(A,F,D)=>this.onKeyframesResolved(A,F,I,!D),y,w,T),(B=this.keyframeResolver)==null||B.scheduleResolve()}onKeyframesResolved(n,a,l,u){this.keyframeResolver=void 0;const{name:f,type:g,velocity:v,delay:y,isHandoff:w,onUpdate:T}=l;this.resolvedAt=mi.now(),B_e(n,f,g,v)||((wc.instantAnimations||!y)&&(T==null||T(RI(n,l,a))),n[0]=n[n.length-1],YN(l),l.repeat=0);const I={startTime:u?this.resolvedAt?this.resolvedAt-this.createdAt>z_e?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:a,...l,keyframes:n},j=!w&&H_e(I)?new U_e({...I,element:I.motionValue.owner.current}):new AI(I);j.finished.then(()=>this.notifyFinished()).catch(vi),this.pendingTimeline&&(this.stopTimeline=j.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=j}get finished(){return this._animation?this.animation.finished:this._finished}then(n,a){return this.finished.finally(n).then(()=>{})}get animation(){var n;return this._animation||((n=this.keyframeResolver)==null||n.resume(),A_e()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(n){this.animation.time=n}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(n){this.animation.speed=n}get startTime(){return this.animation.startTime}attachTimeline(n){return this._animation?this.stopTimeline=this.animation.attachTimeline(n):this.pendingTimeline=n,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var n;this._animation&&this.animation.cancel(),(n=this.keyframeResolver)==null||n.cancel()}}const q_e=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Y_e(s){const n=q_e.exec(s);if(!n)return[,];const[,a,l,u]=n;return[`--${a??l}`,u]}function RG(s,n,a=1){const[l,u]=Y_e(s);if(!l)return;const f=window.getComputedStyle(n).getPropertyValue(l);if(f){const g=f.trim();return Y9(g)?parseFloat(g):g}return xI(u)?RG(u,n,a+1):u}function OI(s,n){return(s==null?void 0:s[n])??(s==null?void 0:s.default)??s}const NG=new Set(["width","height","top","left","right","bottom",...Yp]),$_e={test:s=>s==="auto",parse:s=>s},AG=s=>n=>n.test(s),IG=[qp,Ut,Go,ul,Gge,Wge,$_e],e6=s=>IG.find(AG(s));function X_e(s){return typeof s=="number"?s===0:s!==null?s==="none"||s==="0"||X9(s):!0}const J_e=new Set(["brightness","contrast","saturate","opacity"]);function Q_e(s){const[n,a]=s.slice(0,-1).split("(");if(n==="drop-shadow")return s;const[l]=a.match(bI)||[];if(!l)return s;const u=a.replace(l,"");let f=J_e.has(n)?1:0;return l!==a&&(f*=100),n+"("+f+u+")"}const Z_e=/\b([a-z-]*)\(.*?\)/gu,$N={...Ul,getAnimatableNone:s=>{const n=s.match(Z_e);return n?n.map(Q_e).join(" "):s}},t6={...qp,transform:Math.round},eEe={rotate:ul,rotateX:ul,rotateY:ul,rotateZ:ul,scale:Cy,scaleX:Cy,scaleY:Cy,scaleZ:Cy,skew:ul,skewX:ul,skewY:ul,distance:Ut,translateX:Ut,translateY:Ut,translateZ:Ut,x:Ut,y:Ut,z:Ut,perspective:Ut,transformPerspective:Ut,opacity:jg,originX:WB,originY:WB,originZ:Ut},DI={borderWidth:Ut,borderTopWidth:Ut,borderRightWidth:Ut,borderBottomWidth:Ut,borderLeftWidth:Ut,borderRadius:Ut,radius:Ut,borderTopLeftRadius:Ut,borderTopRightRadius:Ut,borderBottomRightRadius:Ut,borderBottomLeftRadius:Ut,width:Ut,maxWidth:Ut,height:Ut,maxHeight:Ut,top:Ut,right:Ut,bottom:Ut,left:Ut,padding:Ut,paddingTop:Ut,paddingRight:Ut,paddingBottom:Ut,paddingLeft:Ut,margin:Ut,marginTop:Ut,marginRight:Ut,marginBottom:Ut,marginLeft:Ut,backgroundPositionX:Ut,backgroundPositionY:Ut,...eEe,zIndex:t6,fillOpacity:jg,strokeOpacity:jg,numOctaves:t6},tEe={...DI,color:Gs,backgroundColor:Gs,outlineColor:Gs,fill:Gs,stroke:Gs,borderColor:Gs,borderTopColor:Gs,borderRightColor:Gs,borderBottomColor:Gs,borderLeftColor:Gs,filter:$N,WebkitFilter:$N},OG=s=>tEe[s];function DG(s,n){let a=OG(s);return a!==$N&&(a=Ul),a.getAnimatableNone?a.getAnimatableNone(n):void 0}const rEe=new Set(["auto","none","0"]);function sEe(s,n,a){let l=0,u;for(;l<s.length&&!u;){const f=s[l];typeof f=="string"&&!rEe.has(f)&&Lg(f).values.length&&(u=s[l]),l++}if(u&&a)for(const f of n)s[f]=DG(a,u)}class nEe extends II{constructor(n,a,l,u,f){super(n,a,l,u,f,!0)}readKeyframes(){const{unresolvedKeyframes:n,element:a,name:l}=this;if(!a||!a.current)return;super.readKeyframes();for(let y=0;y<n.length;y++){let w=n[y];if(typeof w=="string"&&(w=w.trim(),xI(w))){const T=RG(w,a.current);T!==void 0&&(n[y]=T),y===n.length-1&&(this.finalKeyframe=w)}}if(this.resolveNoneKeyframes(),!NG.has(l)||n.length!==2)return;const[u,f]=n,g=e6(u),v=e6(f);if(g!==v)if(XB(g)&&XB(v))for(let y=0;y<n.length;y++){const w=n[y];typeof w=="string"&&(n[y]=parseFloat(w))}else tu[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:n,name:a}=this,l=[];for(let u=0;u<n.length;u++)(n[u]===null||X_e(n[u]))&&l.push(u);l.length&&sEe(n,l,a)}measureInitialState(){const{element:n,unresolvedKeyframes:a,name:l}=this;if(!n||!n.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=tu[l](n.measureViewportBox(),window.getComputedStyle(n.current)),a[0]=this.measuredOrigin;const u=a[a.length-1];u!==void 0&&n.getValue(l,u).jump(u,!1)}measureEndState(){var v;const{element:n,name:a,unresolvedKeyframes:l}=this;if(!n||!n.current)return;const u=n.getValue(a);u&&u.jump(this.measuredOrigin,!1);const f=l.length-1,g=l[f];l[f]=tu[a](n.measureViewportBox(),window.getComputedStyle(n.current)),g!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=g),(v=this.removedTransforms)!=null&&v.length&&this.removedTransforms.forEach(([y,w])=>{n.getValue(y).set(w)}),this.resolveNoneKeyframes()}}function PG(s,n,a){if(s instanceof EventTarget)return[s];if(typeof s=="string"){const u=document.querySelectorAll(s);return u?Array.from(u):[]}return Array.from(s)}const kG=(s,n)=>n&&typeof s=="number"?n.transform(s):s;function PI(s){return $9(s)&&"offsetHeight"in s}const r6=30,iEe=s=>!isNaN(parseFloat(s)),cg={current:void 0};class aEe{constructor(n,a={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{var f;const u=mi.now();if(this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&((f=this.events.change)==null||f.notify(this.current),this.dependents))for(const g of this.dependents)g.dirty()},this.hasAnimated=!1,this.setCurrent(n),this.owner=a.owner}setCurrent(n){this.current=n,this.updatedAt=mi.now(),this.canTrackVelocity===null&&n!==void 0&&(this.canTrackVelocity=iEe(this.current))}setPrevFrameValue(n=this.current){this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt}onChange(n){return this.on("change",n)}on(n,a){this.events[n]||(this.events[n]=new gI);const l=this.events[n].add(a);return n==="change"?()=>{l(),Br.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const n in this.events)this.events[n].clear()}attach(n,a){this.passiveEffect=n,this.stopPassiveEffect=a}set(n){this.passiveEffect?this.passiveEffect(n,this.updateAndNotify):this.updateAndNotify(n)}setWithVelocity(n,a,l){this.set(a),this.prev=void 0,this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt-l}jump(n,a=!0){this.updateAndNotify(n),this.prev=n,this.prevUpdatedAt=this.prevFrameValue=void 0,a&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var n;(n=this.events.change)==null||n.notify(this.current)}addDependent(n){this.dependents||(this.dependents=new Set),this.dependents.add(n)}removeDependent(n){this.dependents&&this.dependents.delete(n)}get(){return cg.current&&cg.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const n=mi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||n-this.updatedAt>r6)return 0;const a=Math.min(this.updatedAt-this.prevUpdatedAt,r6);return _I(parseFloat(this.current)-parseFloat(this.prevFrameValue),a)}start(n){return this.stop(),new Promise(a=>{this.hasAnimated=!0,this.animation=n(a),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var n,a;(n=this.dependents)==null||n.clear(),(a=this.events.destroy)==null||a.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function so(s,n){return new aEe(s,n)}const{schedule:kI}=oG(queueMicrotask,!1),Xa={x:!1,y:!1};function jG(){return Xa.x||Xa.y}function oEe(s){return s==="x"||s==="y"?Xa[s]?null:(Xa[s]=!0,()=>{Xa[s]=!1}):Xa.x||Xa.y?null:(Xa.x=Xa.y=!0,()=>{Xa.x=Xa.y=!1})}function LG(s,n){const a=PG(s),l=new AbortController,u={passive:!0,...n,signal:l.signal};return[a,u,()=>l.abort()]}function s6(s){return!(s.pointerType==="touch"||jG())}function cEe(s,n,a={}){const[l,u,f]=LG(s,a),g=v=>{if(!s6(v))return;const{target:y}=v,w=n(y,v);if(typeof w!="function"||!y)return;const T=S=>{s6(S)&&(w(S),y.removeEventListener("pointerleave",T))};y.addEventListener("pointerleave",T,u)};return l.forEach(v=>{v.addEventListener("pointerenter",g,u)}),f}const MG=(s,n)=>n?s===n?!0:MG(s,n.parentElement):!1,jI=s=>s.pointerType==="mouse"?typeof s.button!="number"||s.button<=0:s.isPrimary!==!1,lEe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function dEe(s){return lEe.has(s.tagName)||s.tabIndex!==-1}const zy=new WeakSet;function n6(s){return n=>{n.key==="Enter"&&s(n)}}function fR(s,n){s.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}const uEe=(s,n)=>{const a=s.currentTarget;if(!a)return;const l=n6(()=>{if(zy.has(a))return;fR(a,"down");const u=n6(()=>{fR(a,"up")}),f=()=>fR(a,"cancel");a.addEventListener("keyup",u,n),a.addEventListener("blur",f,n)});a.addEventListener("keydown",l,n),a.addEventListener("blur",()=>a.removeEventListener("keydown",l),n)};function i6(s){return jI(s)&&!jG()}function hEe(s,n,a={}){const[l,u,f]=LG(s,a),g=v=>{const y=v.currentTarget;if(!i6(v))return;zy.add(y);const w=n(y,v),T=(j,B)=>{window.removeEventListener("pointerup",S),window.removeEventListener("pointercancel",I),zy.has(y)&&zy.delete(y),i6(j)&&typeof w=="function"&&w(j,{success:B})},S=j=>{T(j,y===window||y===document||a.useGlobalTarget||MG(y,j.target))},I=j=>{T(j,!1)};window.addEventListener("pointerup",S,u),window.addEventListener("pointercancel",I,u)};return l.forEach(v=>{(a.useGlobalTarget?window:v).addEventListener("pointerdown",g,u),PI(v)&&(v.addEventListener("focus",w=>uEe(w,u)),!dEe(v)&&!v.hasAttribute("tabindex")&&(v.tabIndex=0))}),f}function LI(s){return $9(s)&&"ownerSVGElement"in s}const Ky=new WeakMap;let hl;const FG=(s,n,a)=>(l,u)=>u&&u[0]?u[0][s+"Size"]:LI(l)&&"getBBox"in l?l.getBBox()[n]:l[a],pEe=FG("inline","width","offsetWidth"),fEe=FG("block","height","offsetHeight");function mEe({target:s,borderBoxSize:n}){var a;(a=Ky.get(s))==null||a.forEach(l=>{l(s,{get width(){return pEe(s,n)},get height(){return fEe(s,n)}})})}function gEe(s){s.forEach(mEe)}function _Ee(){typeof ResizeObserver>"u"||(hl=new ResizeObserver(gEe))}function EEe(s,n){hl||_Ee();const a=PG(s);return a.forEach(l=>{let u=Ky.get(l);u||(u=new Set,Ky.set(l,u)),u.add(n),hl==null||hl.observe(l)}),()=>{a.forEach(l=>{const u=Ky.get(l);u==null||u.delete(n),u!=null&&u.size||hl==null||hl.unobserve(l)})}}const qy=new Set;let np;function vEe(){np=()=>{const s={get width(){return window.innerWidth},get height(){return window.innerHeight}};qy.forEach(n=>n(s))},window.addEventListener("resize",np)}function yEe(s){return qy.add(s),np||vEe(),()=>{qy.delete(s),!qy.size&&typeof np=="function"&&(window.removeEventListener("resize",np),np=void 0)}}function xEe(s,n){return typeof s=="function"?yEe(s):EEe(s,n)}function UG(s,n){let a;const l=()=>{const{currentTime:u}=n,g=(u===null?0:u.value)/100;a!==g&&s(g),a=g};return Br.preUpdate(l,!0),()=>oo(l)}function bEe(s){return LI(s)&&s.tagName==="svg"}function wEe(...s){const n=!Array.isArray(s[0]),a=n?0:-1,l=s[0+a],u=s[1+a],f=s[2+a],g=s[3+a],v=TI(u,f,g);return n?v(l):v}const Dn=s=>!!(s&&s.getVelocity),SEe=[...IG,Gs,Ul],CEe=s=>SEe.find(AG(s)),db=L.createContext({transformPagePoint:s=>s,isStatic:!1,reducedMotion:"never"});function a6(s,n){if(typeof s=="function")return s(n);s!=null&&(s.current=n)}function TEe(...s){return n=>{let a=!1;const l=s.map(u=>{const f=a6(u,n);return!a&&typeof f=="function"&&(a=!0),f});if(a)return()=>{for(let u=0;u<l.length;u++){const f=l[u];typeof f=="function"?f():a6(s[u],null)}}}}function REe(...s){return L.useCallback(TEe(...s),s)}class NEe extends L.Component{getSnapshotBeforeUpdate(n){const a=this.props.childRef.current;if(a&&n.isPresent&&!this.props.isPresent){const l=a.offsetParent,u=PI(l)&&l.offsetWidth||0,f=this.props.sizeRef.current;f.height=a.offsetHeight||0,f.width=a.offsetWidth||0,f.top=a.offsetTop,f.left=a.offsetLeft,f.right=u-f.width-f.left}return null}componentDidUpdate(){}render(){return this.props.children}}function AEe({children:s,isPresent:n,anchorX:a,root:l}){const u=L.useId(),f=L.useRef(null),g=L.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:v}=L.useContext(db),y=REe(f,s==null?void 0:s.ref);return L.useInsertionEffect(()=>{const{width:w,height:T,top:S,left:I,right:j}=g.current;if(n||!f.current||!w||!T)return;const B=a==="left"?`left: ${I}`:`right: ${j}`;f.current.dataset.motionPopId=u;const A=document.createElement("style");v&&(A.nonce=v);const F=l??document.head;return F.appendChild(A),A.sheet&&A.sheet.insertRule(`
          [data-motion-pop-id="${u}"] {
            position: absolute !important;
            width: ${w}px !important;
            height: ${T}px !important;
            ${B}px !important;
            top: ${S}px !important;
          }
        `),()=>{F.contains(A)&&F.removeChild(A)}},[n]),o.jsx(NEe,{isPresent:n,childRef:f,sizeRef:g,children:L.cloneElement(s,{ref:y})})}const IEe=({children:s,initial:n,isPresent:a,onExitComplete:l,custom:u,presenceAffectsLayout:f,mode:g,anchorX:v,root:y})=>{const w=Kp(OEe),T=L.useId();let S=!0,I=L.useMemo(()=>(S=!1,{id:T,initial:n,isPresent:a,custom:u,onExitComplete:j=>{w.set(j,!0);for(const B of w.values())if(!B)return;l&&l()},register:j=>(w.set(j,!1),()=>w.delete(j))}),[a,w,l]);return f&&S&&(I={...I}),L.useMemo(()=>{w.forEach((j,B)=>w.set(B,!1))},[a]),L.useEffect(()=>{!a&&!w.size&&l&&l()},[a]),g==="popLayout"&&(s=o.jsx(AEe,{isPresent:a,anchorX:v,root:y,children:s})),o.jsx(lb.Provider,{value:I,children:s})};function OEe(){return new Map}function VG(s=!0){const n=L.useContext(lb);if(n===null)return[!0,null];const{isPresent:a,onExitComplete:l,register:u}=n,f=L.useId();L.useEffect(()=>{if(s)return u(f)},[s]);const g=L.useCallback(()=>s&&l&&l(f),[f,l,s]);return!a&&l?[!1,g]:[!0]}const Ty=s=>s.key||"";function o6(s){const n=[];return L.Children.forEach(s,a=>{L.isValidElement(a)&&n.push(a)}),n}const c6=({children:s,custom:n,initial:a=!0,onExitComplete:l,presenceAffectsLayout:u=!0,mode:f="sync",propagate:g=!1,anchorX:v="left",root:y})=>{const[w,T]=VG(g),S=L.useMemo(()=>o6(s),[s]),I=g&&!w?[]:S.map(Ty),j=L.useRef(!0),B=L.useRef(S),A=Kp(()=>new Map),[F,D]=L.useState(S),[R,O]=L.useState(S);cb(()=>{j.current=!1,B.current=S;for(let J=0;J<R.length;J++){const $=Ty(R[J]);I.includes($)?A.delete($):A.get($)!==!0&&A.set($,!1)}},[R,I.length,I.join("-")]);const V=[];if(S!==F){let J=[...S];for(let $=0;$<R.length;$++){const q=R[$],ee=Ty(q);I.includes(ee)||(J.splice($,0,q),V.push(q))}return f==="wait"&&V.length&&(J=V),O(o6(J)),D(S),null}const{forceRender:G}=L.useContext(uI);return o.jsx(o.Fragment,{children:R.map(J=>{const $=Ty(J),q=g&&!w?!1:S===R||I.includes($),ee=()=>{if(A.has($))A.set($,!0);else return;let ne=!0;A.forEach(de=>{de||(ne=!1)}),ne&&(G==null||G(),O(B.current),g&&(T==null||T()),l&&l())};return o.jsx(IEe,{isPresent:q,initial:!j.current||a?void 0:!1,custom:n,presenceAffectsLayout:u,mode:f,root:y,onExitComplete:q?void 0:ee,anchorX:v,children:J},$)})})},BG=L.createContext({strict:!1}),l6={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Mp={};for(const s in l6)Mp[s]={isEnabled:n=>l6[s].some(a=>!!n[a])};function DEe(s){for(const n in s)Mp[n]={...Mp[n],...s[n]}}const PEe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ax(s){return s.startsWith("while")||s.startsWith("drag")&&s!=="draggable"||s.startsWith("layout")||s.startsWith("onTap")||s.startsWith("onPan")||s.startsWith("onLayout")||PEe.has(s)}let WG=s=>!Ax(s);function kEe(s){typeof s=="function"&&(WG=n=>n.startsWith("on")?!Ax(n):s(n))}try{kEe(require("@emotion/is-prop-valid").default)}catch{}function jEe(s,n,a){const l={};for(const u in s)u==="values"&&typeof s.values=="object"||(WG(u)||a===!0&&Ax(u)||!n&&!Ax(u)||s.draggable&&u.startsWith("onDrag"))&&(l[u]=s[u]);return l}const ub=L.createContext({});function hb(s){return s!==null&&typeof s=="object"&&typeof s.start=="function"}function Mg(s){return typeof s=="string"||Array.isArray(s)}const MI=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],FI=["initial",...MI];function pb(s){return hb(s.animate)||FI.some(n=>Mg(s[n]))}function GG(s){return!!(pb(s)||s.variants)}function LEe(s,n){if(pb(s)){const{initial:a,animate:l}=s;return{initial:a===!1||Mg(a)?a:void 0,animate:Mg(l)?l:void 0}}return s.inherit!==!1?n:{}}function MEe(s){const{initial:n,animate:a}=LEe(s,L.useContext(ub));return L.useMemo(()=>({initial:n,animate:a}),[d6(n),d6(a)])}function d6(s){return Array.isArray(s)?s.join(" "):s}const Fg={};function FEe(s){for(const n in s)Fg[n]=s[n],yI(n)&&(Fg[n].isCSSVariable=!0)}function HG(s,{layout:n,layoutId:a}){return $p.has(s)||s.startsWith("origin")||(n||a!==void 0)&&(!!Fg[s]||s==="opacity")}const UEe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},VEe=Yp.length;function BEe(s,n,a){let l="",u=!0;for(let f=0;f<VEe;f++){const g=Yp[f],v=s[g];if(v===void 0)continue;let y=!0;if(typeof v=="number"?y=v===(g.startsWith("scale")?1:0):y=parseFloat(v)===0,!y||a){const w=kG(v,DI[g]);if(!y){u=!1;const T=UEe[g]||g;l+=`${T}(${w}) `}a&&(n[g]=w)}}return l=l.trim(),a?l=a(n,u?"":l):u&&(l="none"),l}function UI(s,n,a){const{style:l,vars:u,transformOrigin:f}=s;let g=!1,v=!1;for(const y in n){const w=n[y];if($p.has(y)){g=!0;continue}else if(yI(y)){u[y]=w;continue}else{const T=kG(w,DI[y]);y.startsWith("origin")?(v=!0,f[y]=T):l[y]=T}}if(n.transform||(g||a?l.transform=BEe(n,s.transform,a):l.transform&&(l.transform="none")),v){const{originX:y="50%",originY:w="50%",originZ:T=0}=f;l.transformOrigin=`${y} ${w} ${T}`}}const VI=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function zG(s,n,a){for(const l in n)!Dn(n[l])&&!HG(l,a)&&(s[l]=n[l])}function WEe({transformTemplate:s},n){return L.useMemo(()=>{const a=VI();return UI(a,n,s),Object.assign({},a.vars,a.style)},[n])}function GEe(s,n){const a=s.style||{},l={};return zG(l,a,s),Object.assign(l,WEe(s,n)),l}function HEe(s,n){const a={},l=GEe(s,n);return s.drag&&s.dragListener!==!1&&(a.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=s.drag===!0?"none":`pan-${s.drag==="x"?"y":"x"}`),s.tabIndex===void 0&&(s.onTap||s.onTapStart||s.whileTap)&&(a.tabIndex=0),a.style=l,a}const zEe={offset:"stroke-dashoffset",array:"stroke-dasharray"},KEe={offset:"strokeDashoffset",array:"strokeDasharray"};function qEe(s,n,a=1,l=0,u=!0){s.pathLength=1;const f=u?zEe:KEe;s[f.offset]=Ut.transform(-l);const g=Ut.transform(n),v=Ut.transform(a);s[f.array]=`${g} ${v}`}function KG(s,{attrX:n,attrY:a,attrScale:l,pathLength:u,pathSpacing:f=1,pathOffset:g=0,...v},y,w,T){if(UI(s,v,w),y){s.style.viewBox&&(s.attrs.viewBox=s.style.viewBox);return}s.attrs=s.style,s.style={};const{attrs:S,style:I}=s;S.transform&&(I.transform=S.transform,delete S.transform),(I.transform||S.transformOrigin)&&(I.transformOrigin=S.transformOrigin??"50% 50%",delete S.transformOrigin),I.transform&&(I.transformBox=(T==null?void 0:T.transformBox)??"fill-box",delete S.transformBox),n!==void 0&&(S.x=n),a!==void 0&&(S.y=a),l!==void 0&&(S.scale=l),u!==void 0&&qEe(S,u,f,g,!1)}const qG=()=>({...VI(),attrs:{}}),YG=s=>typeof s=="string"&&s.toLowerCase()==="svg";function YEe(s,n,a,l){const u=L.useMemo(()=>{const f=qG();return KG(f,n,YG(l),s.transformTemplate,s.style),{...f.attrs,style:{...f.style}}},[n]);if(s.style){const f={};zG(f,s.style,s),u.style={...f,...u.style}}return u}const $Ee=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function BI(s){return typeof s!="string"||s.includes("-")?!1:!!($Ee.indexOf(s)>-1||/[A-Z]/u.test(s))}function XEe(s,n,a,{latestValues:l},u,f=!1){const v=(BI(s)?YEe:HEe)(n,l,u,s),y=jEe(n,typeof s=="string",f),w=s!==L.Fragment?{...y,...v,ref:a}:{},{children:T}=n,S=L.useMemo(()=>Dn(T)?T.get():T,[T]);return L.createElement(s,{...w,children:S})}function u6(s){const n=[{},{}];return s==null||s.values.forEach((a,l)=>{n[0][l]=a.get(),n[1][l]=a.getVelocity()}),n}function WI(s,n,a,l){if(typeof n=="function"){const[u,f]=u6(l);n=n(a!==void 0?a:s.custom,u,f)}if(typeof n=="string"&&(n=s.variants&&s.variants[n]),typeof n=="function"){const[u,f]=u6(l);n=n(a!==void 0?a:s.custom,u,f)}return n}function Yy(s){return Dn(s)?s.get():s}function JEe({scrapeMotionValuesFromProps:s,createRenderState:n},a,l,u){return{latestValues:QEe(a,l,u,s),renderState:n()}}function QEe(s,n,a,l){const u={},f=l(s,{});for(const I in f)u[I]=Yy(f[I]);let{initial:g,animate:v}=s;const y=pb(s),w=GG(s);n&&w&&!y&&s.inherit!==!1&&(g===void 0&&(g=n.initial),v===void 0&&(v=n.animate));let T=a?a.initial===!1:!1;T=T||g===!1;const S=T?v:g;if(S&&typeof S!="boolean"&&!hb(S)){const I=Array.isArray(S)?S:[S];for(let j=0;j<I.length;j++){const B=WI(s,I[j]);if(B){const{transitionEnd:A,transition:F,...D}=B;for(const R in D){let O=D[R];if(Array.isArray(O)){const V=T?O.length-1:0;O=O[V]}O!==null&&(u[R]=O)}for(const R in A)u[R]=A[R]}}}return u}const $G=s=>(n,a)=>{const l=L.useContext(ub),u=L.useContext(lb),f=()=>JEe(s,n,l,u);return a?f():Kp(f)};function GI(s,n,a){var f;const{style:l}=s,u={};for(const g in l)(Dn(l[g])||n.style&&Dn(n.style[g])||HG(g,s)||((f=a==null?void 0:a.getValue(g))==null?void 0:f.liveStyle)!==void 0)&&(u[g]=l[g]);return u}const ZEe=$G({scrapeMotionValuesFromProps:GI,createRenderState:VI});function XG(s,n,a){const l=GI(s,n,a);for(const u in s)if(Dn(s[u])||Dn(n[u])){const f=Yp.indexOf(u)!==-1?"attr"+u.charAt(0).toUpperCase()+u.substring(1):u;l[f]=s[u]}return l}const eve=$G({scrapeMotionValuesFromProps:XG,createRenderState:qG}),tve=Symbol.for("motionComponentSymbol");function ip(s){return s&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,"current")}function rve(s,n,a){return L.useCallback(l=>{l&&s.onMount&&s.onMount(l),n&&(l?n.mount(l):n.unmount()),a&&(typeof a=="function"?a(l):ip(a)&&(a.current=l))},[n])}const HI=s=>s.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),sve="framerAppearId",JG="data-"+HI(sve),QG=L.createContext({});function nve(s,n,a,l,u){var A,F;const{visualElement:f}=L.useContext(ub),g=L.useContext(BG),v=L.useContext(lb),y=L.useContext(db).reducedMotion,w=L.useRef(null);l=l||g.renderer,!w.current&&l&&(w.current=l(s,{visualState:n,parent:f,props:a,presenceContext:v,blockInitialAnimation:v?v.initial===!1:!1,reducedMotionConfig:y}));const T=w.current,S=L.useContext(QG);T&&!T.projection&&u&&(T.type==="html"||T.type==="svg")&&ive(w.current,a,u,S);const I=L.useRef(!1);L.useInsertionEffect(()=>{T&&I.current&&T.update(a,v)});const j=a[JG],B=L.useRef(!!j&&!((A=window.MotionHandoffIsComplete)!=null&&A.call(window,j))&&((F=window.MotionHasOptimisedAnimation)==null?void 0:F.call(window,j)));return cb(()=>{T&&(I.current=!0,window.MotionIsMounted=!0,T.updateFeatures(),T.scheduleRenderMicrotask(),B.current&&T.animationState&&T.animationState.animateChanges())}),L.useEffect(()=>{T&&(!B.current&&T.animationState&&T.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{var D;(D=window.MotionHandoffMarkAsComplete)==null||D.call(window,j)}),B.current=!1),T.enteringChildren=void 0)}),T}function ive(s,n,a,l){const{layoutId:u,layout:f,drag:g,dragConstraints:v,layoutScroll:y,layoutRoot:w,layoutCrossfade:T}=n;s.projection=new a(s.latestValues,n["data-framer-portal-id"]?void 0:ZG(s.parent)),s.projection.setOptions({layoutId:u,layout:f,alwaysMeasureLayout:!!g||v&&ip(v),visualElement:s,animationType:typeof f=="string"?f:"both",initialPromotionConfig:l,crossfade:T,layoutScroll:y,layoutRoot:w})}function ZG(s){if(s)return s.options.allowProjection!==!1?s.projection:ZG(s.parent)}function mR(s,{forwardMotionProps:n=!1}={},a,l){a&&DEe(a);const u=BI(s)?eve:ZEe;function f(v,y){let w;const T={...L.useContext(db),...v,layoutId:ave(v)},{isStatic:S}=T,I=MEe(v),j=u(v,S);if(!S&&hI){ove();const B=cve(T);w=B.MeasureLayout,I.visualElement=nve(s,j,T,l,B.ProjectionNode)}return o.jsxs(ub.Provider,{value:I,children:[w&&I.visualElement?o.jsx(w,{visualElement:I.visualElement,...T}):null,XEe(s,v,rve(j,I.visualElement,y),j,S,n)]})}f.displayName=`motion.${typeof s=="string"?s:`create(${s.displayName??s.name??""})`}`;const g=L.forwardRef(f);return g[tve]=s,g}function ave({layoutId:s}){const n=L.useContext(uI).id;return n&&s!==void 0?n+"-"+s:s}function ove(s,n){L.useContext(BG).strict}function cve(s){const{drag:n,layout:a}=Mp;if(!n&&!a)return{};const l={...n,...a};return{MeasureLayout:n!=null&&n.isEnabled(s)||a!=null&&a.isEnabled(s)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function lve(s,n){if(typeof Proxy>"u")return mR;const a=new Map,l=(f,g)=>mR(f,g,s,n),u=(f,g)=>l(f,g);return new Proxy(u,{get:(f,g)=>g==="create"?l:(a.has(g)||a.set(g,mR(g,void 0,s,n)),a.get(g))})}function eH({top:s,left:n,right:a,bottom:l}){return{x:{min:n,max:a},y:{min:s,max:l}}}function dve({x:s,y:n}){return{top:n.min,right:s.max,bottom:n.max,left:s.min}}function uve(s,n){if(!n)return s;const a=n({x:s.left,y:s.top}),l=n({x:s.right,y:s.bottom});return{top:a.y,left:a.x,bottom:l.y,right:l.x}}function gR(s){return s===void 0||s===1}function XN({scale:s,scaleX:n,scaleY:a}){return!gR(s)||!gR(n)||!gR(a)}function Vd(s){return XN(s)||tH(s)||s.z||s.rotate||s.rotateX||s.rotateY||s.skewX||s.skewY}function tH(s){return h6(s.x)||h6(s.y)}function h6(s){return s&&s!=="0%"}function Ix(s,n,a){const l=s-a,u=n*l;return a+u}function p6(s,n,a,l,u){return u!==void 0&&(s=Ix(s,u,l)),Ix(s,a,l)+n}function JN(s,n=0,a=1,l,u){s.min=p6(s.min,n,a,l,u),s.max=p6(s.max,n,a,l,u)}function rH(s,{x:n,y:a}){JN(s.x,n.translate,n.scale,n.originPoint),JN(s.y,a.translate,a.scale,a.originPoint)}const f6=.999999999999,m6=1.0000000000001;function hve(s,n,a,l=!1){const u=a.length;if(!u)return;n.x=n.y=1;let f,g;for(let v=0;v<u;v++){f=a[v],g=f.projectionDelta;const{visualElement:y}=f.options;y&&y.props.style&&y.props.style.display==="contents"||(l&&f.options.layoutScroll&&f.scroll&&f!==f.root&&op(s,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),g&&(n.x*=g.x.scale,n.y*=g.y.scale,rH(s,g)),l&&Vd(f.latestValues)&&op(s,f.latestValues))}n.x<m6&&n.x>f6&&(n.x=1),n.y<m6&&n.y>f6&&(n.y=1)}function ap(s,n){s.min=s.min+n,s.max=s.max+n}function g6(s,n,a,l,u=.5){const f=_s(s.min,s.max,u);JN(s,n,a,f,l)}function op(s,n){g6(s.x,n.x,n.scaleX,n.scale,n.originX),g6(s.y,n.y,n.scaleY,n.scale,n.originY)}function sH(s,n){return eH(uve(s.getBoundingClientRect(),n))}function pve(s,n,a){const l=sH(s,a),{scroll:u}=n;return u&&(ap(l.x,u.offset.x),ap(l.y,u.offset.y)),l}const _6=()=>({translate:0,scale:1,origin:0,originPoint:0}),cp=()=>({x:_6(),y:_6()}),E6=()=>({min:0,max:0}),Ls=()=>({x:E6(),y:E6()}),QN={current:null},nH={current:!1};function fve(){if(nH.current=!0,!!hI)if(window.matchMedia){const s=window.matchMedia("(prefers-reduced-motion)"),n=()=>QN.current=s.matches;s.addEventListener("change",n),n()}else QN.current=!1}const mve=new WeakMap;function gve(s,n,a){for(const l in n){const u=n[l],f=a[l];if(Dn(u))s.addValue(l,u);else if(Dn(f))s.addValue(l,so(u,{owner:s}));else if(f!==u)if(s.hasValue(l)){const g=s.getValue(l);g.liveStyle===!0?g.jump(u):g.hasAnimated||g.set(u)}else{const g=s.getStaticValue(l);s.addValue(l,so(g!==void 0?g:u,{owner:s}))}}for(const l in a)n[l]===void 0&&s.removeValue(l);return n}const v6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class _ve{scrapeMotionValuesFromProps(n,a,l){return{}}constructor({parent:n,props:a,presenceContext:l,reducedMotionConfig:u,blockInitialAnimation:f,visualState:g},v={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=II,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const I=mi.now();this.renderScheduledAt<I&&(this.renderScheduledAt=I,Br.render(this.render,!1,!0))};const{latestValues:y,renderState:w}=g;this.latestValues=y,this.baseTarget={...y},this.initialValues=a.initial?{...y}:{},this.renderState=w,this.parent=n,this.props=a,this.presenceContext=l,this.depth=n?n.depth+1:0,this.reducedMotionConfig=u,this.options=v,this.blockInitialAnimation=!!f,this.isControllingVariants=pb(a),this.isVariantNode=GG(a),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(n&&n.current);const{willChange:T,...S}=this.scrapeMotionValuesFromProps(a,{},this);for(const I in S){const j=S[I];y[I]!==void 0&&Dn(j)&&j.set(y[I])}}mount(n){var a;this.current=n,mve.set(n,this),this.projection&&!this.projection.instance&&this.projection.mount(n),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((l,u)=>this.bindToMotionValue(u,l)),nH.current||fve(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:QN.current,(a=this.parent)==null||a.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var n;this.projection&&this.projection.unmount(),oo(this.notifyUpdate),oo(this.render),this.valueSubscriptions.forEach(a=>a()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(n=this.parent)==null||n.removeChild(this);for(const a in this.events)this.events[a].clear();for(const a in this.features){const l=this.features[a];l&&(l.unmount(),l.isMounted=!1)}this.current=null}addChild(n){this.children.add(n),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(n)}removeChild(n){this.children.delete(n),this.enteringChildren&&this.enteringChildren.delete(n)}bindToMotionValue(n,a){this.valueSubscriptions.has(n)&&this.valueSubscriptions.get(n)();const l=$p.has(n);l&&this.onBindTransform&&this.onBindTransform();const u=a.on("change",g=>{this.latestValues[n]=g,this.props.onUpdate&&Br.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,n,a)),this.valueSubscriptions.set(n,()=>{u(),f&&f(),a.owner&&a.stop()})}sortNodePosition(n){return!this.current||!this.sortInstanceNodePosition||this.type!==n.type?0:this.sortInstanceNodePosition(this.current,n.current)}updateFeatures(){let n="animation";for(n in Mp){const a=Mp[n];if(!a)continue;const{isEnabled:l,Feature:u}=a;if(!this.features[n]&&u&&l(this.props)&&(this.features[n]=new u(this)),this.features[n]){const f=this.features[n];f.isMounted?f.update():(f.mount(),f.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ls()}getStaticValue(n){return this.latestValues[n]}setStaticValue(n,a){this.latestValues[n]=a}update(n,a){(n.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=n,this.prevPresenceContext=this.presenceContext,this.presenceContext=a;for(let l=0;l<v6.length;l++){const u=v6[l];this.propEventSubscriptions[u]&&(this.propEventSubscriptions[u](),delete this.propEventSubscriptions[u]);const f="on"+u,g=n[f];g&&(this.propEventSubscriptions[u]=this.on(u,g))}this.prevMotionValues=gve(this,this.scrapeMotionValuesFromProps(n,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(n){return this.props.variants?this.props.variants[n]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(n){const a=this.getClosestVariantNode();if(a)return a.variantChildren&&a.variantChildren.add(n),()=>a.variantChildren.delete(n)}addValue(n,a){const l=this.values.get(n);a!==l&&(l&&this.removeValue(n),this.bindToMotionValue(n,a),this.values.set(n,a),this.latestValues[n]=a.get())}removeValue(n){this.values.delete(n);const a=this.valueSubscriptions.get(n);a&&(a(),this.valueSubscriptions.delete(n)),delete this.latestValues[n],this.removeValueFromRenderState(n,this.renderState)}hasValue(n){return this.values.has(n)}getValue(n,a){if(this.props.values&&this.props.values[n])return this.props.values[n];let l=this.values.get(n);return l===void 0&&a!==void 0&&(l=so(a===null?void 0:a,{owner:this}),this.addValue(n,l)),l}readValue(n,a){let l=this.latestValues[n]!==void 0||!this.current?this.latestValues[n]:this.getBaseTargetFromProps(this.props,n)??this.readValueFromInstance(this.current,n,this.options);return l!=null&&(typeof l=="string"&&(Y9(l)||X9(l))?l=parseFloat(l):!CEe(l)&&Ul.test(a)&&(l=DG(n,a)),this.setBaseTarget(n,Dn(l)?l.get():l)),Dn(l)?l.get():l}setBaseTarget(n,a){this.baseTarget[n]=a}getBaseTarget(n){var f;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const g=WI(this.props,a,(f=this.presenceContext)==null?void 0:f.custom);g&&(l=g[n])}if(a&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,n);return u!==void 0&&!Dn(u)?u:this.initialValues[n]!==void 0&&l===void 0?void 0:this.baseTarget[n]}on(n,a){return this.events[n]||(this.events[n]=new gI),this.events[n].add(a)}notify(n,...a){this.events[n]&&this.events[n].notify(...a)}scheduleRenderMicrotask(){kI.render(this.render)}}class iH extends _ve{constructor(){super(...arguments),this.KeyframeResolver=nEe}sortInstanceNodePosition(n,a){return n.compareDocumentPosition(a)&2?1:-1}getBaseTargetFromProps(n,a){return n.style?n.style[a]:void 0}removeValueFromRenderState(n,{vars:a,style:l}){delete a[n],delete l[n]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:n}=this.props;Dn(n)&&(this.childSubscription=n.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}function aH(s,{style:n,vars:a},l,u){const f=s.style;let g;for(g in n)f[g]=n[g];u==null||u.applyProjectionStyles(f,l);for(g in a)f.setProperty(g,a[g])}function Eve(s){return window.getComputedStyle(s)}class vve extends iH{constructor(){super(...arguments),this.type="html",this.renderInstance=aH}readValueFromInstance(n,a){var l;if($p.has(a))return(l=this.projection)!=null&&l.isProjecting?GN(a):S_e(n,a);{const u=Eve(n),f=(yI(a)?u.getPropertyValue(a):u[a])||0;return typeof f=="string"?f.trim():f}}measureInstanceViewportBox(n,{transformPagePoint:a}){return sH(n,a)}build(n,a,l){UI(n,a,l.transformTemplate)}scrapeMotionValuesFromProps(n,a,l){return GI(n,a,l)}}const oH=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function yve(s,n,a,l){aH(s,n,void 0,l);for(const u in n.attrs)s.setAttribute(oH.has(u)?u:HI(u),n.attrs[u])}class xve extends iH{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ls}getBaseTargetFromProps(n,a){return n[a]}readValueFromInstance(n,a){if($p.has(a)){const l=OG(a);return l&&l.default||0}return a=oH.has(a)?a:HI(a),n.getAttribute(a)}scrapeMotionValuesFromProps(n,a,l){return XG(n,a,l)}build(n,a,l){KG(n,a,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(n,a,l,u){yve(n,a,l,u)}mount(n){this.isSVGTag=YG(n.tagName),super.mount(n)}}const bve=(s,n)=>BI(s)?new xve(n):new vve(n,{allowProjection:s!==L.Fragment});function gp(s,n,a){const l=s.getProps();return WI(l,n,a!==void 0?a:l.custom,s)}const ZN=s=>Array.isArray(s);function wve(s,n,a){s.hasValue(n)?s.getValue(n).set(a):s.addValue(n,so(a))}function Sve(s){return ZN(s)?s[s.length-1]||0:s}function Cve(s,n){const a=gp(s,n);let{transitionEnd:l={},transition:u={},...f}=a||{};f={...f,...l};for(const g in f){const v=Sve(f[g]);wve(s,g,v)}}function Tve(s){return!!(Dn(s)&&s.add)}function eA(s,n){const a=s.getValue("willChange");if(Tve(a))return a.add(n);if(!a&&wc.WillChange){const l=new wc.WillChange("auto");s.addValue("willChange",l),l.add(n)}}function cH(s){return s.props[JG]}const Rve=s=>s!==null;function Nve(s,{repeat:n,repeatType:a="loop"},l){const u=s.filter(Rve),f=n&&a!=="loop"&&n%2===1?0:u.length-1;return u[f]}const Ave={type:"spring",stiffness:500,damping:25,restSpeed:10},Ive=s=>({type:"spring",stiffness:550,damping:s===0?2*Math.sqrt(550):30,restSpeed:10}),Ove={type:"keyframes",duration:.8},Dve={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Pve=(s,{keyframes:n})=>n.length>2?Ove:$p.has(s)?s.startsWith("scale")?Ive(n[1]):Ave:Dve;function kve({when:s,delay:n,delayChildren:a,staggerChildren:l,staggerDirection:u,repeat:f,repeatType:g,repeatDelay:v,from:y,elapsed:w,...T}){return!!Object.keys(T).length}const zI=(s,n,a,l={},u,f)=>g=>{const v=OI(l,s)||{},y=v.delay||l.delay||0;let{elapsed:w=0}=l;w=w-Wo(y);const T={keyframes:Array.isArray(a)?a:[null,a],ease:"easeOut",velocity:n.getVelocity(),...v,delay:-w,onUpdate:I=>{n.set(I),v.onUpdate&&v.onUpdate(I)},onComplete:()=>{g(),v.onComplete&&v.onComplete()},name:s,motionValue:n,element:f?void 0:u};kve(v)||Object.assign(T,Pve(s,T)),T.duration&&(T.duration=Wo(T.duration)),T.repeatDelay&&(T.repeatDelay=Wo(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let S=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(YN(T),T.delay===0&&(S=!0)),(wc.instantAnimations||wc.skipAnimations)&&(S=!0,YN(T),T.delay=0),T.allowFlatten=!v.type&&!v.ease,S&&!f&&n.get()!==void 0){const I=Nve(T.keyframes,v);if(I!==void 0){Br.update(()=>{T.onUpdate(I),T.onComplete()});return}}return v.isSync?new AI(T):new K_e(T)};function jve({protectedKeys:s,needsAnimating:n},a){const l=s.hasOwnProperty(a)&&n[a]!==!0;return n[a]=!1,l}function lH(s,n,{delay:a=0,transitionOverride:l,type:u}={}){let{transition:f=s.getDefaultTransition(),transitionEnd:g,...v}=n;l&&(f=l);const y=[],w=u&&s.animationState&&s.animationState.getState()[u];for(const T in v){const S=s.getValue(T,s.latestValues[T]??null),I=v[T];if(I===void 0||w&&jve(w,T))continue;const j={delay:a,...OI(f||{},T)},B=S.get();if(B!==void 0&&!S.isAnimating&&!Array.isArray(I)&&I===B&&!j.velocity)continue;let A=!1;if(window.MotionHandoffAnimation){const D=cH(s);if(D){const R=window.MotionHandoffAnimation(D,T,Br);R!==null&&(j.startTime=R,A=!0)}}eA(s,T),S.start(zI(T,S,I,s.shouldReduceMotion&&NG.has(T)?{type:!1}:j,s,A));const F=S.animation;F&&y.push(F)}return g&&Promise.all(y).then(()=>{Br.update(()=>{g&&Cve(s,g)})}),y}function dH(s,n,a,l=0,u=1){const f=Array.from(s).sort((w,T)=>w.sortNodePosition(T)).indexOf(n),g=s.size,v=(g-1)*l;return typeof a=="function"?a(f,g):u===1?f*l:v-f*l}function tA(s,n,a={}){var y;const l=gp(s,n,a.type==="exit"?(y=s.presenceContext)==null?void 0:y.custom:void 0);let{transition:u=s.getDefaultTransition()||{}}=l||{};a.transitionOverride&&(u=a.transitionOverride);const f=l?()=>Promise.all(lH(s,l,a)):()=>Promise.resolve(),g=s.variantChildren&&s.variantChildren.size?(w=0)=>{const{delayChildren:T=0,staggerChildren:S,staggerDirection:I}=u;return Lve(s,n,w,T,S,I,a)}:()=>Promise.resolve(),{when:v}=u;if(v){const[w,T]=v==="beforeChildren"?[f,g]:[g,f];return w().then(()=>T())}else return Promise.all([f(),g(a.delay)])}function Lve(s,n,a=0,l=0,u=0,f=1,g){const v=[];for(const y of s.variantChildren)y.notify("AnimationStart",n),v.push(tA(y,n,{...g,delay:a+(typeof l=="function"?0:l)+dH(s.variantChildren,y,l,u,f)}).then(()=>y.notify("AnimationComplete",n)));return Promise.all(v)}function Mve(s,n,a={}){s.notify("AnimationStart",n);let l;if(Array.isArray(n)){const u=n.map(f=>tA(s,f,a));l=Promise.all(u)}else if(typeof n=="string")l=tA(s,n,a);else{const u=typeof n=="function"?gp(s,n,a.custom):n;l=Promise.all(lH(s,u,a))}return l.then(()=>{s.notify("AnimationComplete",n)})}function uH(s,n){if(!Array.isArray(n))return!1;const a=n.length;if(a!==s.length)return!1;for(let l=0;l<a;l++)if(n[l]!==s[l])return!1;return!0}const Fve=FI.length;function hH(s){if(!s)return;if(!s.isControllingVariants){const a=s.parent?hH(s.parent)||{}:{};return s.props.initial!==void 0&&(a.initial=s.props.initial),a}const n={};for(let a=0;a<Fve;a++){const l=FI[a],u=s.props[l];(Mg(u)||u===!1)&&(n[l]=u)}return n}const Uve=[...MI].reverse(),Vve=MI.length;function Bve(s){return n=>Promise.all(n.map(({animation:a,options:l})=>Mve(s,a,l)))}function Wve(s){let n=Bve(s),a=y6(),l=!0;const u=y=>(w,T)=>{var I;const S=gp(s,T,y==="exit"?(I=s.presenceContext)==null?void 0:I.custom:void 0);if(S){const{transition:j,transitionEnd:B,...A}=S;w={...w,...A,...B}}return w};function f(y){n=y(s)}function g(y){const{props:w}=s,T=hH(s.parent)||{},S=[],I=new Set;let j={},B=1/0;for(let F=0;F<Vve;F++){const D=Uve[F],R=a[D],O=w[D]!==void 0?w[D]:T[D],V=Mg(O),G=D===y?R.isActive:null;G===!1&&(B=F);let J=O===T[D]&&O!==w[D]&&V;if(J&&l&&s.manuallyAnimateOnMount&&(J=!1),R.protectedKeys={...j},!R.isActive&&G===null||!O&&!R.prevProp||hb(O)||typeof O=="boolean")continue;const $=Gve(R.prevProp,O);let q=$||D===y&&R.isActive&&!J&&V||F>B&&V,ee=!1;const ne=Array.isArray(O)?O:[O];let de=ne.reduce(u(D),{});G===!1&&(de={});const{prevResolvedValues:me={}}=R,ve={...me,...de},_e=Oe=>{q=!0,I.has(Oe)&&(ee=!0,I.delete(Oe)),R.needsAnimating[Oe]=!0;const ae=s.getValue(Oe);ae&&(ae.liveStyle=!1)};for(const Oe in ve){const ae=de[Oe],Ee=me[Oe];if(j.hasOwnProperty(Oe))continue;let Le=!1;ZN(ae)&&ZN(Ee)?Le=!uH(ae,Ee):Le=ae!==Ee,Le?ae!=null?_e(Oe):I.add(Oe):ae!==void 0&&I.has(Oe)?_e(Oe):R.protectedKeys[Oe]=!0}R.prevProp=O,R.prevResolvedValues=de,R.isActive&&(j={...j,...de}),l&&s.blockInitialAnimation&&(q=!1);const De=J&&$;q&&(!De||ee)&&S.push(...ne.map(Oe=>{const ae={type:D};if(typeof Oe=="string"&&l&&!De&&s.manuallyAnimateOnMount&&s.parent){const{parent:Ee}=s,Le=gp(Ee,Oe);if(Ee.enteringChildren&&Le){const{delayChildren:Ke}=Le.transition||{};ae.delay=dH(Ee.enteringChildren,s,Ke)}}return{animation:Oe,options:ae}}))}if(I.size){const F={};if(typeof w.initial!="boolean"){const D=gp(s,Array.isArray(w.initial)?w.initial[0]:w.initial);D&&D.transition&&(F.transition=D.transition)}I.forEach(D=>{const R=s.getBaseTarget(D),O=s.getValue(D);O&&(O.liveStyle=!0),F[D]=R??null}),S.push({animation:F})}let A=!!S.length;return l&&(w.initial===!1||w.initial===w.animate)&&!s.manuallyAnimateOnMount&&(A=!1),l=!1,A?n(S):Promise.resolve()}function v(y,w){var S;if(a[y].isActive===w)return Promise.resolve();(S=s.variantChildren)==null||S.forEach(I=>{var j;return(j=I.animationState)==null?void 0:j.setActive(y,w)}),a[y].isActive=w;const T=g(y);for(const I in a)a[I].protectedKeys={};return T}return{animateChanges:g,setActive:v,setAnimateFunction:f,getState:()=>a,reset:()=>{a=y6()}}}function Gve(s,n){return typeof n=="string"?n!==s:Array.isArray(n)?!uH(n,s):!1}function Pd(s=!1){return{isActive:s,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function y6(){return{animate:Pd(!0),whileInView:Pd(),whileHover:Pd(),whileTap:Pd(),whileDrag:Pd(),whileFocus:Pd(),exit:Pd()}}class Hl{constructor(n){this.isMounted=!1,this.node=n}update(){}}class Hve extends Hl{constructor(n){super(n),n.animationState||(n.animationState=Wve(n))}updateAnimationControlsSubscription(){const{animate:n}=this.node.getProps();hb(n)&&(this.unmountControls=n.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:n}=this.node.getProps(),{animate:a}=this.node.prevProps||{};n!==a&&this.updateAnimationControlsSubscription()}unmount(){var n;this.node.animationState.reset(),(n=this.unmountControls)==null||n.call(this)}}let zve=0;class Kve extends Hl{constructor(){super(...arguments),this.id=zve++}update(){if(!this.node.presenceContext)return;const{isPresent:n,onExitComplete:a}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||n===l)return;const u=this.node.animationState.setActive("exit",!n);a&&!n&&u.then(()=>{a(this.id)})}mount(){const{register:n,onExitComplete:a}=this.node.presenceContext||{};a&&a(this.id),n&&(this.unmount=n(this.id))}unmount(){}}const qve={animation:{Feature:Hve},exit:{Feature:Kve}};function Ug(s,n,a,l={passive:!0}){return s.addEventListener(n,a,l),()=>s.removeEventListener(n,a)}function t_(s){return{point:{x:s.pageX,y:s.pageY}}}const Yve=s=>n=>jI(n)&&s(n,t_(n));function lg(s,n,a,l){return Ug(s,n,Yve(a),l)}const pH=1e-4,$ve=1-pH,Xve=1+pH,fH=.01,Jve=0-fH,Qve=0+fH;function Hn(s){return s.max-s.min}function Zve(s,n,a){return Math.abs(s-n)<=a}function x6(s,n,a,l=.5){s.origin=l,s.originPoint=_s(n.min,n.max,s.origin),s.scale=Hn(a)/Hn(n),s.translate=_s(a.min,a.max,s.origin)-s.originPoint,(s.scale>=$ve&&s.scale<=Xve||isNaN(s.scale))&&(s.scale=1),(s.translate>=Jve&&s.translate<=Qve||isNaN(s.translate))&&(s.translate=0)}function dg(s,n,a,l){x6(s.x,n.x,a.x,l?l.originX:void 0),x6(s.y,n.y,a.y,l?l.originY:void 0)}function b6(s,n,a){s.min=a.min+n.min,s.max=s.min+Hn(n)}function eye(s,n,a){b6(s.x,n.x,a.x),b6(s.y,n.y,a.y)}function w6(s,n,a){s.min=n.min-a.min,s.max=s.min+Hn(n)}function ug(s,n,a){w6(s.x,n.x,a.x),w6(s.y,n.y,a.y)}function fa(s){return[s("x"),s("y")]}const mH=({current:s})=>s?s.ownerDocument.defaultView:null,S6=(s,n)=>Math.abs(s-n);function tye(s,n){const a=S6(s.x,n.x),l=S6(s.y,n.y);return Math.sqrt(a**2+l**2)}class gH{constructor(n,a,{transformPagePoint:l,contextWindow:u=window,dragSnapToOrigin:f=!1,distanceThreshold:g=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=ER(this.lastMoveEventInfo,this.history),j=this.startEvent!==null,B=tye(I.offset,{x:0,y:0})>=this.distanceThreshold;if(!j&&!B)return;const{point:A}=I,{timestamp:F}=an;this.history.push({...A,timestamp:F});const{onStart:D,onMove:R}=this.handlers;j||(D&&D(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),R&&R(this.lastMoveEvent,I)},this.handlePointerMove=(I,j)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=_R(j,this.transformPagePoint),Br.update(this.updatePoint,!0)},this.handlePointerUp=(I,j)=>{this.end();const{onEnd:B,onSessionEnd:A,resumeAnimation:F}=this.handlers;if(this.dragSnapToOrigin&&F&&F(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const D=ER(I.type==="pointercancel"?this.lastMoveEventInfo:_R(j,this.transformPagePoint),this.history);this.startEvent&&B&&B(I,D),A&&A(I,D)},!jI(n))return;this.dragSnapToOrigin=f,this.handlers=a,this.transformPagePoint=l,this.distanceThreshold=g,this.contextWindow=u||window;const v=t_(n),y=_R(v,this.transformPagePoint),{point:w}=y,{timestamp:T}=an;this.history=[{...w,timestamp:T}];const{onSessionStart:S}=a;S&&S(n,ER(y,this.history)),this.removeListeners=Qg(lg(this.contextWindow,"pointermove",this.handlePointerMove),lg(this.contextWindow,"pointerup",this.handlePointerUp),lg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(n){this.handlers=n}end(){this.removeListeners&&this.removeListeners(),oo(this.updatePoint)}}function _R(s,n){return n?{point:n(s.point)}:s}function C6(s,n){return{x:s.x-n.x,y:s.y-n.y}}function ER({point:s},n){return{point:s,delta:C6(s,_H(n)),offset:C6(s,rye(n)),velocity:sye(n,.1)}}function rye(s){return s[0]}function _H(s){return s[s.length-1]}function sye(s,n){if(s.length<2)return{x:0,y:0};let a=s.length-1,l=null;const u=_H(s);for(;a>=0&&(l=s[a],!(u.timestamp-l.timestamp>Wo(n)));)a--;if(!l)return{x:0,y:0};const f=ya(u.timestamp-l.timestamp);if(f===0)return{x:0,y:0};const g={x:(u.x-l.x)/f,y:(u.y-l.y)/f};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}function nye(s,{min:n,max:a},l){return n!==void 0&&s<n?s=l?_s(n,s,l.min):Math.max(s,n):a!==void 0&&s>a&&(s=l?_s(a,s,l.max):Math.min(s,a)),s}function T6(s,n,a){return{min:n!==void 0?s.min+n:void 0,max:a!==void 0?s.max+a-(s.max-s.min):void 0}}function iye(s,{top:n,left:a,bottom:l,right:u}){return{x:T6(s.x,a,u),y:T6(s.y,n,l)}}function R6(s,n){let a=n.min-s.min,l=n.max-s.max;return n.max-n.min<s.max-s.min&&([a,l]=[l,a]),{min:a,max:l}}function aye(s,n){return{x:R6(s.x,n.x),y:R6(s.y,n.y)}}function oye(s,n){let a=.5;const l=Hn(s),u=Hn(n);return u>l?a=Lp(n.min,n.max-l,s.min):l>u&&(a=Lp(s.min,s.max-u,n.min)),Ho(0,1,a)}function cye(s,n){const a={};return n.min!==void 0&&(a.min=n.min-s.min),n.max!==void 0&&(a.max=n.max-s.min),a}const rA=.35;function lye(s=rA){return s===!1?s=0:s===!0&&(s=rA),{x:N6(s,"left","right"),y:N6(s,"top","bottom")}}function N6(s,n,a){return{min:A6(s,n),max:A6(s,a)}}function A6(s,n){return typeof s=="number"?s:s[n]||0}const dye=new WeakMap;class uye{constructor(n){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ls(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=n}start(n,{snapToCursor:a=!1,distanceThreshold:l}={}){const{presenceContext:u}=this.visualElement;if(u&&u.isPresent===!1)return;const f=S=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),a&&this.snapToCursor(t_(S).point)},g=(S,I)=>{const{drag:j,dragPropagation:B,onDragStart:A}=this.getProps();if(j&&!B&&(this.openDragLock&&this.openDragLock(),this.openDragLock=oEe(j),!this.openDragLock))return;this.latestPointerEvent=S,this.latestPanInfo=I,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),fa(D=>{let R=this.getAxisMotionValue(D).get()||0;if(Go.test(R)){const{projection:O}=this.visualElement;if(O&&O.layout){const V=O.layout.layoutBox[D];V&&(R=Hn(V)*(parseFloat(R)/100))}}this.originPoint[D]=R}),A&&Br.postRender(()=>A(S,I)),eA(this.visualElement,"transform");const{animationState:F}=this.visualElement;F&&F.setActive("whileDrag",!0)},v=(S,I)=>{this.latestPointerEvent=S,this.latestPanInfo=I;const{dragPropagation:j,dragDirectionLock:B,onDirectionLock:A,onDrag:F}=this.getProps();if(!j&&!this.openDragLock)return;const{offset:D}=I;if(B&&this.currentDirection===null){this.currentDirection=hye(D),this.currentDirection!==null&&A&&A(this.currentDirection);return}this.updateAxis("x",I.point,D),this.updateAxis("y",I.point,D),this.visualElement.render(),F&&F(S,I)},y=(S,I)=>{this.latestPointerEvent=S,this.latestPanInfo=I,this.stop(S,I),this.latestPointerEvent=null,this.latestPanInfo=null},w=()=>fa(S=>{var I;return this.getAnimationState(S)==="paused"&&((I=this.getAxisMotionValue(S).animation)==null?void 0:I.play())}),{dragSnapToOrigin:T}=this.getProps();this.panSession=new gH(n,{onSessionStart:f,onStart:g,onMove:v,onSessionEnd:y,resumeAnimation:w},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,distanceThreshold:l,contextWindow:mH(this.visualElement)})}stop(n,a){const l=n||this.latestPointerEvent,u=a||this.latestPanInfo,f=this.isDragging;if(this.cancel(),!f||!u||!l)return;const{velocity:g}=u;this.startAnimation(g);const{onDragEnd:v}=this.getProps();v&&Br.postRender(()=>v(l,u))}cancel(){this.isDragging=!1;const{projection:n,animationState:a}=this.visualElement;n&&(n.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:l}=this.getProps();!l&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),a&&a.setActive("whileDrag",!1)}updateAxis(n,a,l){const{drag:u}=this.getProps();if(!l||!Ry(n,u,this.currentDirection))return;const f=this.getAxisMotionValue(n);let g=this.originPoint[n]+l[n];this.constraints&&this.constraints[n]&&(g=nye(g,this.constraints[n],this.elastic[n])),f.set(g)}resolveConstraints(){var f;const{dragConstraints:n,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(f=this.visualElement.projection)==null?void 0:f.layout,u=this.constraints;n&&ip(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&l?this.constraints=iye(l.layoutBox,n):this.constraints=!1,this.elastic=lye(a),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&fa(g=>{this.constraints!==!1&&this.getAxisMotionValue(g)&&(this.constraints[g]=cye(l.layoutBox[g],this.constraints[g]))})}resolveRefConstraints(){const{dragConstraints:n,onMeasureDragConstraints:a}=this.getProps();if(!n||!ip(n))return!1;const l=n.current,{projection:u}=this.visualElement;if(!u||!u.layout)return!1;const f=pve(l,u.root,this.visualElement.getTransformPagePoint());let g=aye(u.layout.layoutBox,f);if(a){const v=a(dve(g));this.hasMutatedConstraints=!!v,v&&(g=eH(v))}return g}startAnimation(n){const{drag:a,dragMomentum:l,dragElastic:u,dragTransition:f,dragSnapToOrigin:g,onDragTransitionEnd:v}=this.getProps(),y=this.constraints||{},w=fa(T=>{if(!Ry(T,a,this.currentDirection))return;let S=y&&y[T]||{};g&&(S={min:0,max:0});const I=u?200:1e6,j=u?40:1e7,B={type:"inertia",velocity:l?n[T]:0,bounceStiffness:I,bounceDamping:j,timeConstant:750,restDelta:1,restSpeed:10,...f,...S};return this.startAxisValueAnimation(T,B)});return Promise.all(w).then(v)}startAxisValueAnimation(n,a){const l=this.getAxisMotionValue(n);return eA(this.visualElement,n),l.start(zI(n,l,0,a,this.visualElement,!1))}stopAnimation(){fa(n=>this.getAxisMotionValue(n).stop())}pauseAnimation(){fa(n=>{var a;return(a=this.getAxisMotionValue(n).animation)==null?void 0:a.pause()})}getAnimationState(n){var a;return(a=this.getAxisMotionValue(n).animation)==null?void 0:a.state}getAxisMotionValue(n){const a=`_drag${n.toUpperCase()}`,l=this.visualElement.getProps(),u=l[a];return u||this.visualElement.getValue(n,(l.initial?l.initial[n]:void 0)||0)}snapToCursor(n){fa(a=>{const{drag:l}=this.getProps();if(!Ry(a,l,this.currentDirection))return;const{projection:u}=this.visualElement,f=this.getAxisMotionValue(a);if(u&&u.layout){const{min:g,max:v}=u.layout.layoutBox[a];f.set(n[a]-_s(g,v,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:n,dragConstraints:a}=this.getProps(),{projection:l}=this.visualElement;if(!ip(a)||!l||!this.constraints)return;this.stopAnimation();const u={x:0,y:0};fa(g=>{const v=this.getAxisMotionValue(g);if(v&&this.constraints!==!1){const y=v.get();u[g]=oye({min:y,max:y},this.constraints[g])}});const{transformTemplate:f}=this.visualElement.getProps();this.visualElement.current.style.transform=f?f({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),fa(g=>{if(!Ry(g,n,null))return;const v=this.getAxisMotionValue(g),{min:y,max:w}=this.constraints[g];v.set(_s(y,w,u[g]))})}addListeners(){if(!this.visualElement.current)return;dye.set(this.visualElement,this);const n=this.visualElement.current,a=lg(n,"pointerdown",y=>{const{drag:w,dragListener:T=!0}=this.getProps();w&&T&&this.start(y)}),l=()=>{const{dragConstraints:y}=this.getProps();ip(y)&&y.current&&(this.constraints=this.resolveRefConstraints())},{projection:u}=this.visualElement,f=u.addEventListener("measure",l);u&&!u.layout&&(u.root&&u.root.updateScroll(),u.updateLayout()),Br.read(l);const g=Ug(window,"resize",()=>this.scalePositionWithinConstraints()),v=u.addEventListener("didUpdate",({delta:y,hasLayoutChanged:w})=>{this.isDragging&&w&&(fa(T=>{const S=this.getAxisMotionValue(T);S&&(this.originPoint[T]+=y[T].translate,S.set(S.get()+y[T].translate))}),this.visualElement.render())});return()=>{g(),a(),f(),v&&v()}}getProps(){const n=this.visualElement.getProps(),{drag:a=!1,dragDirectionLock:l=!1,dragPropagation:u=!1,dragConstraints:f=!1,dragElastic:g=rA,dragMomentum:v=!0}=n;return{...n,drag:a,dragDirectionLock:l,dragPropagation:u,dragConstraints:f,dragElastic:g,dragMomentum:v}}}function Ry(s,n,a){return(n===!0||n===s)&&(a===null||a===s)}function hye(s,n=10){let a=null;return Math.abs(s.y)>n?a="y":Math.abs(s.x)>n&&(a="x"),a}class pye extends Hl{constructor(n){super(n),this.removeGroupControls=vi,this.removeListeners=vi,this.controls=new uye(n)}mount(){const{dragControls:n}=this.node.getProps();n&&(this.removeGroupControls=n.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||vi}unmount(){this.removeGroupControls(),this.removeListeners()}}const I6=s=>(n,a)=>{s&&Br.postRender(()=>s(n,a))};class fye extends Hl{constructor(){super(...arguments),this.removePointerDownListener=vi}onPointerDown(n){this.session=new gH(n,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:mH(this.node)})}createPanHandlers(){const{onPanSessionStart:n,onPanStart:a,onPan:l,onPanEnd:u}=this.node.getProps();return{onSessionStart:I6(n),onStart:I6(a),onMove:l,onEnd:(f,g)=>{delete this.session,u&&Br.postRender(()=>u(f,g))}}}mount(){this.removePointerDownListener=lg(this.node.current,"pointerdown",n=>this.onPointerDown(n))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const $y={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function O6(s,n){return n.max===n.min?0:s/(n.max-n.min)*100}const Um={correct:(s,n)=>{if(!n.target)return s;if(typeof s=="string")if(Ut.test(s))s=parseFloat(s);else return s;const a=O6(s,n.target.x),l=O6(s,n.target.y);return`${a}% ${l}%`}},mye={correct:(s,{treeScale:n,projectionDelta:a})=>{const l=s,u=Ul.parse(s);if(u.length>5)return l;const f=Ul.createTransformer(s),g=typeof u[0]!="number"?1:0,v=a.x.scale*n.x,y=a.y.scale*n.y;u[0+g]/=v,u[1+g]/=y;const w=_s(v,y,.5);return typeof u[2+g]=="number"&&(u[2+g]/=w),typeof u[3+g]=="number"&&(u[3+g]/=w),f(u)}};let vR=!1;class gye extends L.Component{componentDidMount(){const{visualElement:n,layoutGroup:a,switchLayoutGroup:l,layoutId:u}=this.props,{projection:f}=n;FEe(_ye),f&&(a.group&&a.group.add(f),l&&l.register&&u&&l.register(f),vR&&f.root.didUpdate(),f.addEventListener("animationComplete",()=>{this.safeToRemove()}),f.setOptions({...f.options,onExitComplete:()=>this.safeToRemove()})),$y.hasEverUpdated=!0}getSnapshotBeforeUpdate(n){const{layoutDependency:a,visualElement:l,drag:u,isPresent:f}=this.props,{projection:g}=l;return g&&(g.isPresent=f,vR=!0,u||n.layoutDependency!==a||a===void 0||n.isPresent!==f?g.willUpdate():this.safeToRemove(),n.isPresent!==f&&(f?g.promote():g.relegate()||Br.postRender(()=>{const v=g.getStack();(!v||!v.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:n}=this.props.visualElement;n&&(n.root.didUpdate(),kI.postRender(()=>{!n.currentAnimation&&n.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:n,layoutGroup:a,switchLayoutGroup:l}=this.props,{projection:u}=n;vR=!0,u&&(u.scheduleCheckAfterUnmount(),a&&a.group&&a.group.remove(u),l&&l.deregister&&l.deregister(u))}safeToRemove(){const{safeToRemove:n}=this.props;n&&n()}render(){return null}}function EH(s){const[n,a]=VG(),l=L.useContext(uI);return o.jsx(gye,{...s,layoutGroup:l,switchLayoutGroup:L.useContext(QG),isPresent:n,safeToRemove:a})}const _ye={borderRadius:{...Um,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Um,borderTopRightRadius:Um,borderBottomLeftRadius:Um,borderBottomRightRadius:Um,boxShadow:mye};function Eye(s,n,a){const l=Dn(s)?s:so(s);return l.start(zI("",l,n,a)),l.animation}const vye=(s,n)=>s.depth-n.depth;class yye{constructor(){this.children=[],this.isDirty=!1}add(n){pI(this.children,n),this.isDirty=!0}remove(n){fI(this.children,n),this.isDirty=!0}forEach(n){this.isDirty&&this.children.sort(vye),this.isDirty=!1,this.children.forEach(n)}}function xye(s,n){const a=mi.now(),l=({timestamp:u})=>{const f=u-a;f>=n&&(oo(l),s(f-n))};return Br.setup(l,!0),()=>oo(l)}const vH=["TopLeft","TopRight","BottomLeft","BottomRight"],bye=vH.length,D6=s=>typeof s=="string"?parseFloat(s):s,P6=s=>typeof s=="number"||Ut.test(s);function wye(s,n,a,l,u,f){u?(s.opacity=_s(0,a.opacity??1,Sye(l)),s.opacityExit=_s(n.opacity??1,0,Cye(l))):f&&(s.opacity=_s(n.opacity??1,a.opacity??1,l));for(let g=0;g<bye;g++){const v=`border${vH[g]}Radius`;let y=k6(n,v),w=k6(a,v);if(y===void 0&&w===void 0)continue;y||(y=0),w||(w=0),y===0||w===0||P6(y)===P6(w)?(s[v]=Math.max(_s(D6(y),D6(w),l),0),(Go.test(w)||Go.test(y))&&(s[v]+="%")):s[v]=w}(n.rotate||a.rotate)&&(s.rotate=_s(n.rotate||0,a.rotate||0,l))}function k6(s,n){return s[n]!==void 0?s[n]:s.borderRadius}const Sye=yH(0,.5,sG),Cye=yH(.5,.95,vi);function yH(s,n,a){return l=>l<s?0:l>n?1:a(Lp(s,n,l))}function j6(s,n){s.min=n.min,s.max=n.max}function pa(s,n){j6(s.x,n.x),j6(s.y,n.y)}function L6(s,n){s.translate=n.translate,s.scale=n.scale,s.originPoint=n.originPoint,s.origin=n.origin}function M6(s,n,a,l,u){return s-=n,s=Ix(s,1/a,l),u!==void 0&&(s=Ix(s,1/u,l)),s}function Tye(s,n=0,a=1,l=.5,u,f=s,g=s){if(Go.test(n)&&(n=parseFloat(n),n=_s(g.min,g.max,n/100)-g.min),typeof n!="number")return;let v=_s(f.min,f.max,l);s===f&&(v-=n),s.min=M6(s.min,n,a,v,u),s.max=M6(s.max,n,a,v,u)}function F6(s,n,[a,l,u],f,g){Tye(s,n[a],n[l],n[u],n.scale,f,g)}const Rye=["x","scaleX","originX"],Nye=["y","scaleY","originY"];function U6(s,n,a,l){F6(s.x,n,Rye,a?a.x:void 0,l?l.x:void 0),F6(s.y,n,Nye,a?a.y:void 0,l?l.y:void 0)}function V6(s){return s.translate===0&&s.scale===1}function xH(s){return V6(s.x)&&V6(s.y)}function B6(s,n){return s.min===n.min&&s.max===n.max}function Aye(s,n){return B6(s.x,n.x)&&B6(s.y,n.y)}function W6(s,n){return Math.round(s.min)===Math.round(n.min)&&Math.round(s.max)===Math.round(n.max)}function bH(s,n){return W6(s.x,n.x)&&W6(s.y,n.y)}function G6(s){return Hn(s.x)/Hn(s.y)}function H6(s,n){return s.translate===n.translate&&s.scale===n.scale&&s.originPoint===n.originPoint}class Iye{constructor(){this.members=[]}add(n){pI(this.members,n),n.scheduleRender()}remove(n){if(fI(this.members,n),n===this.prevLead&&(this.prevLead=void 0),n===this.lead){const a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(n){const a=this.members.findIndex(u=>n===u);if(a===0)return!1;let l;for(let u=a;u>=0;u--){const f=this.members[u];if(f.isPresent!==!1){l=f;break}}return l?(this.promote(l),!0):!1}promote(n,a){const l=this.lead;if(n!==l&&(this.prevLead=l,this.lead=n,n.show(),l)){l.instance&&l.scheduleRender(),n.scheduleRender(),n.resumeFrom=l,a&&(n.resumeFrom.preserveOpacity=!0),l.snapshot&&(n.snapshot=l.snapshot,n.snapshot.latestValues=l.animationValues||l.latestValues),n.root&&n.root.isUpdating&&(n.isLayoutDirty=!0);const{crossfade:u}=n.options;u===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(n=>{const{options:a,resumingFrom:l}=n;a.onExitComplete&&a.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(n=>{n.instance&&n.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Oye(s,n,a){let l="";const u=s.x.translate/n.x,f=s.y.translate/n.y,g=(a==null?void 0:a.z)||0;if((u||f||g)&&(l=`translate3d(${u}px, ${f}px, ${g}px) `),(n.x!==1||n.y!==1)&&(l+=`scale(${1/n.x}, ${1/n.y}) `),a){const{transformPerspective:w,rotate:T,rotateX:S,rotateY:I,skewX:j,skewY:B}=a;w&&(l=`perspective(${w}px) ${l}`),T&&(l+=`rotate(${T}deg) `),S&&(l+=`rotateX(${S}deg) `),I&&(l+=`rotateY(${I}deg) `),j&&(l+=`skewX(${j}deg) `),B&&(l+=`skewY(${B}deg) `)}const v=s.x.scale*n.x,y=s.y.scale*n.y;return(v!==1||y!==1)&&(l+=`scale(${v}, ${y})`),l||"none"}const yR=["","X","Y","Z"],Dye=1e3;let Pye=0;function xR(s,n,a,l){const{latestValues:u}=n;u[s]&&(a[s]=u[s],n.setStaticValue(s,0),l&&(l[s]=0))}function wH(s){if(s.hasCheckedOptimisedAppear=!0,s.root===s)return;const{visualElement:n}=s.options;if(!n)return;const a=cH(n);if(window.MotionHasOptimisedAnimation(a,"transform")){const{layout:u,layoutId:f}=s.options;window.MotionCancelOptimisedAnimation(a,"transform",Br,!(u||f))}const{parent:l}=s;l&&!l.hasCheckedOptimisedAppear&&wH(l)}function SH({attachResizeListener:s,defaultParent:n,measureScroll:a,checkIsScrollRoot:l,resetTransform:u}){return class{constructor(g={},v=n==null?void 0:n()){this.id=Pye++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Lye),this.nodes.forEach(Vye),this.nodes.forEach(Bye),this.nodes.forEach(Mye)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=g,this.root=v?v.root||v:this,this.path=v?[...v.path,v]:[],this.parent=v,this.depth=v?v.depth+1:0;for(let y=0;y<this.path.length;y++)this.path[y].shouldResetTransform=!0;this.root===this&&(this.nodes=new yye)}addEventListener(g,v){return this.eventHandlers.has(g)||this.eventHandlers.set(g,new gI),this.eventHandlers.get(g).add(v)}notifyListeners(g,...v){const y=this.eventHandlers.get(g);y&&y.notify(...v)}hasListeners(g){return this.eventHandlers.has(g)}mount(g){if(this.instance)return;this.isSVG=LI(g)&&!bEe(g),this.instance=g;const{layoutId:v,layout:y,visualElement:w}=this.options;if(w&&!w.current&&w.mount(g),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(y||v)&&(this.isLayoutDirty=!0),s){let T,S=0;const I=()=>this.root.updateBlockedByResize=!1;Br.read(()=>{S=window.innerWidth}),s(g,()=>{const j=window.innerWidth;j!==S&&(S=j,this.root.updateBlockedByResize=!0,T&&T(),T=xye(I,250),$y.hasAnimatedSinceResize&&($y.hasAnimatedSinceResize=!1,this.nodes.forEach(q6)))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||y)&&this.addEventListener("didUpdate",({delta:T,hasLayoutChanged:S,hasRelativeLayoutChanged:I,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||w.getDefaultTransition()||Kye,{onLayoutAnimationStart:A,onLayoutAnimationComplete:F}=w.getProps(),D=!this.targetLayout||!bH(this.targetLayout,j),R=!S&&I;if(this.options.layoutRoot||this.resumeFrom||R||S&&(D||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const O={...OI(B,"layout"),onPlay:A,onComplete:F};(w.shouldReduceMotion||this.options.layoutRoot)&&(O.delay=0,O.type=!1),this.startAnimation(O),this.setAnimationOrigin(T,R)}else S||q6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const g=this.getStack();g&&g.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),oo(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Wye),this.animationId++)}getTransformTemplate(){const{visualElement:g}=this.options;return g&&g.getProps().transformTemplate}willUpdate(g=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&wH(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let T=0;T<this.path.length;T++){const S=this.path[T];S.shouldResetTransform=!0,S.updateScroll("snapshot"),S.options.layoutRoot&&S.willUpdate(!1)}const{layoutId:v,layout:y}=this.options;if(v===void 0&&!y)return;const w=this.getTransformTemplate();this.prevTransformTemplateValue=w?w(this.latestValues,""):void 0,this.updateSnapshot(),g&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(z6);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(K6);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Uye),this.nodes.forEach(kye),this.nodes.forEach(jye)):this.nodes.forEach(K6),this.clearAllSnapshots();const v=mi.now();an.delta=Ho(0,1e3/60,v-an.timestamp),an.timestamp=v,an.isProcessing=!0,lR.update.process(an),lR.preRender.process(an),lR.render.process(an),an.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,kI.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Fye),this.sharedNodes.forEach(Gye)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Br.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Br.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Hn(this.snapshot.measuredBox.x)&&!Hn(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let y=0;y<this.path.length;y++)this.path[y].updateScroll();const g=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ls(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:v}=this.options;v&&v.notify("LayoutMeasure",this.layout.layoutBox,g?g.layoutBox:void 0)}updateScroll(g="measure"){let v=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===g&&(v=!1),v&&this.instance){const y=l(this.instance);this.scroll={animationId:this.root.animationId,phase:g,isRoot:y,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:y}}}resetTransform(){if(!u)return;const g=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,v=this.projectionDelta&&!xH(this.projectionDelta),y=this.getTransformTemplate(),w=y?y(this.latestValues,""):void 0,T=w!==this.prevTransformTemplateValue;g&&this.instance&&(v||Vd(this.latestValues)||T)&&(u(this.instance,w),this.shouldResetTransform=!1,this.scheduleRender())}measure(g=!0){const v=this.measurePageBox();let y=this.removeElementScroll(v);return g&&(y=this.removeTransform(y)),qye(y),{animationId:this.root.animationId,measuredBox:v,layoutBox:y,latestValues:{},source:this.id}}measurePageBox(){var w;const{visualElement:g}=this.options;if(!g)return Ls();const v=g.measureViewportBox();if(!(((w=this.scroll)==null?void 0:w.wasRoot)||this.path.some(Yye))){const{scroll:T}=this.root;T&&(ap(v.x,T.offset.x),ap(v.y,T.offset.y))}return v}removeElementScroll(g){var y;const v=Ls();if(pa(v,g),(y=this.scroll)!=null&&y.wasRoot)return v;for(let w=0;w<this.path.length;w++){const T=this.path[w],{scroll:S,options:I}=T;T!==this.root&&S&&I.layoutScroll&&(S.wasRoot&&pa(v,g),ap(v.x,S.offset.x),ap(v.y,S.offset.y))}return v}applyTransform(g,v=!1){const y=Ls();pa(y,g);for(let w=0;w<this.path.length;w++){const T=this.path[w];!v&&T.options.layoutScroll&&T.scroll&&T!==T.root&&op(y,{x:-T.scroll.offset.x,y:-T.scroll.offset.y}),Vd(T.latestValues)&&op(y,T.latestValues)}return Vd(this.latestValues)&&op(y,this.latestValues),y}removeTransform(g){const v=Ls();pa(v,g);for(let y=0;y<this.path.length;y++){const w=this.path[y];if(!w.instance||!Vd(w.latestValues))continue;XN(w.latestValues)&&w.updateSnapshot();const T=Ls(),S=w.measurePageBox();pa(T,S),U6(v,w.latestValues,w.snapshot?w.snapshot.layoutBox:void 0,T)}return Vd(this.latestValues)&&U6(v,this.latestValues),v}setTargetDelta(g){this.targetDelta=g,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(g){this.options={...this.options,...g,crossfade:g.crossfade!==void 0?g.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==an.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(g=!1){var I;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const y=!!this.resumingFrom||this!==v;if(!(g||y&&this.isSharedProjectionDirty||this.isProjectionDirty||(I=this.parent)!=null&&I.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:T,layoutId:S}=this.options;if(!(!this.layout||!(T||S))){if(this.resolvedRelativeTargetAt=an.timestamp,!this.targetDelta&&!this.relativeTarget){const j=this.getClosestProjectingParent();j&&j.layout&&this.animationProgress!==1?(this.relativeParent=j,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ls(),this.relativeTargetOrigin=Ls(),ug(this.relativeTargetOrigin,this.layout.layoutBox,j.layout.layoutBox),pa(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ls(),this.targetWithTransforms=Ls()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),eye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):pa(this.target,this.layout.layoutBox),rH(this.target,this.targetDelta)):pa(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const j=this.getClosestProjectingParent();j&&!!j.resumingFrom==!!this.resumingFrom&&!j.options.layoutScroll&&j.target&&this.animationProgress!==1?(this.relativeParent=j,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ls(),this.relativeTargetOrigin=Ls(),ug(this.relativeTargetOrigin,this.target,j.target),pa(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||XN(this.parent.latestValues)||tH(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var B;const g=this.getLead(),v=!!this.resumingFrom||this!==g;let y=!0;if((this.isProjectionDirty||(B=this.parent)!=null&&B.isProjectionDirty)&&(y=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(y=!1),this.resolvedRelativeTargetAt===an.timestamp&&(y=!1),y)return;const{layout:w,layoutId:T}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||T))return;pa(this.layoutCorrected,this.layout.layoutBox);const S=this.treeScale.x,I=this.treeScale.y;hve(this.layoutCorrected,this.treeScale,this.path,v),g.layout&&!g.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(g.target=g.layout.layoutBox,g.targetWithTransforms=Ls());const{target:j}=g;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(L6(this.prevProjectionDelta.x,this.projectionDelta.x),L6(this.prevProjectionDelta.y,this.projectionDelta.y)),dg(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==S||this.treeScale.y!==I||!H6(this.projectionDelta.x,this.prevProjectionDelta.x)||!H6(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(g=!0){var v;if((v=this.options.visualElement)==null||v.scheduleRender(),g){const y=this.getStack();y&&y.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=cp(),this.projectionDelta=cp(),this.projectionDeltaWithTransform=cp()}setAnimationOrigin(g,v=!1){const y=this.snapshot,w=y?y.latestValues:{},T={...this.latestValues},S=cp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!v;const I=Ls(),j=y?y.source:void 0,B=this.layout?this.layout.source:void 0,A=j!==B,F=this.getStack(),D=!F||F.members.length<=1,R=!!(A&&!D&&this.options.crossfade===!0&&!this.path.some(zye));this.animationProgress=0;let O;this.mixTargetDelta=V=>{const G=V/1e3;Y6(S.x,g.x,G),Y6(S.y,g.y,G),this.setTargetDelta(S),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ug(I,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Hye(this.relativeTarget,this.relativeTargetOrigin,I,G),O&&Aye(this.relativeTarget,O)&&(this.isProjectionDirty=!1),O||(O=Ls()),pa(O,this.relativeTarget)),A&&(this.animationValues=T,wye(T,w,this.latestValues,G,R,D)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=G},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(g){var v,y,w;this.notifyListeners("animationStart"),(v=this.currentAnimation)==null||v.stop(),(w=(y=this.resumingFrom)==null?void 0:y.currentAnimation)==null||w.stop(),this.pendingAnimation&&(oo(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Br.update(()=>{$y.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=so(0)),this.currentAnimation=Eye(this.motionValue,[0,1e3],{...g,velocity:0,isSync:!0,onUpdate:T=>{this.mixTargetDelta(T),g.onUpdate&&g.onUpdate(T)},onStop:()=>{},onComplete:()=>{g.onComplete&&g.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const g=this.getStack();g&&g.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Dye),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const g=this.getLead();let{targetWithTransforms:v,target:y,layout:w,latestValues:T}=g;if(!(!v||!y||!w)){if(this!==g&&this.layout&&w&&CH(this.options.animationType,this.layout.layoutBox,w.layoutBox)){y=this.target||Ls();const S=Hn(this.layout.layoutBox.x);y.x.min=g.target.x.min,y.x.max=y.x.min+S;const I=Hn(this.layout.layoutBox.y);y.y.min=g.target.y.min,y.y.max=y.y.min+I}pa(v,y),op(v,T),dg(this.projectionDeltaWithTransform,this.layoutCorrected,v,T)}}registerSharedNode(g,v){this.sharedNodes.has(g)||this.sharedNodes.set(g,new Iye),this.sharedNodes.get(g).add(v);const w=v.options.initialPromotionConfig;v.promote({transition:w?w.transition:void 0,preserveFollowOpacity:w&&w.shouldPreserveFollowOpacity?w.shouldPreserveFollowOpacity(v):void 0})}isLead(){const g=this.getStack();return g?g.lead===this:!0}getLead(){var v;const{layoutId:g}=this.options;return g?((v=this.getStack())==null?void 0:v.lead)||this:this}getPrevLead(){var v;const{layoutId:g}=this.options;return g?(v=this.getStack())==null?void 0:v.prevLead:void 0}getStack(){const{layoutId:g}=this.options;if(g)return this.root.sharedNodes.get(g)}promote({needsReset:g,transition:v,preserveFollowOpacity:y}={}){const w=this.getStack();w&&w.promote(this,y),g&&(this.projectionDelta=void 0,this.needsReset=!0),v&&this.setOptions({transition:v})}relegate(){const g=this.getStack();return g?g.relegate(this):!1}resetSkewAndRotation(){const{visualElement:g}=this.options;if(!g)return;let v=!1;const{latestValues:y}=g;if((y.z||y.rotate||y.rotateX||y.rotateY||y.rotateZ||y.skewX||y.skewY)&&(v=!0),!v)return;const w={};y.z&&xR("z",g,w,this.animationValues);for(let T=0;T<yR.length;T++)xR(`rotate${yR[T]}`,g,w,this.animationValues),xR(`skew${yR[T]}`,g,w,this.animationValues);g.render();for(const T in w)g.setStaticValue(T,w[T]),this.animationValues&&(this.animationValues[T]=w[T]);g.scheduleRender()}applyProjectionStyles(g,v){if(!this.instance||this.isSVG)return;if(!this.isVisible){g.visibility="hidden";return}const y=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,g.visibility="",g.opacity="",g.pointerEvents=Yy(v==null?void 0:v.pointerEvents)||"",g.transform=y?y(this.latestValues,""):"none";return}const w=this.getLead();if(!this.projectionDelta||!this.layout||!w.target){this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=Yy(v==null?void 0:v.pointerEvents)||""),this.hasProjected&&!Vd(this.latestValues)&&(g.transform=y?y({},""):"none",this.hasProjected=!1);return}g.visibility="";const T=w.animationValues||w.latestValues;this.applyTransformsToTarget();let S=Oye(this.projectionDeltaWithTransform,this.treeScale,T);y&&(S=y(T,S)),g.transform=S;const{x:I,y:j}=this.projectionDelta;g.transformOrigin=`${I.origin*100}% ${j.origin*100}% 0`,w.animationValues?g.opacity=w===this?T.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:T.opacityExit:g.opacity=w===this?T.opacity!==void 0?T.opacity:"":T.opacityExit!==void 0?T.opacityExit:0;for(const B in Fg){if(T[B]===void 0)continue;const{correct:A,applyTo:F,isCSSVariable:D}=Fg[B],R=S==="none"?T[B]:A(T[B],w);if(F){const O=F.length;for(let V=0;V<O;V++)g[F[V]]=R}else D?this.options.visualElement.renderState.vars[B]=R:g[B]=R}this.options.layoutId&&(g.pointerEvents=w===this?Yy(v==null?void 0:v.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(g=>{var v;return(v=g.currentAnimation)==null?void 0:v.stop()}),this.root.nodes.forEach(z6),this.root.sharedNodes.clear()}}}function kye(s){s.updateLayout()}function jye(s){var a;const n=((a=s.resumeFrom)==null?void 0:a.snapshot)||s.snapshot;if(s.isLead()&&s.layout&&n&&s.hasListeners("didUpdate")){const{layoutBox:l,measuredBox:u}=s.layout,{animationType:f}=s.options,g=n.source!==s.layout.source;f==="size"?fa(S=>{const I=g?n.measuredBox[S]:n.layoutBox[S],j=Hn(I);I.min=l[S].min,I.max=I.min+j}):CH(f,n.layoutBox,l)&&fa(S=>{const I=g?n.measuredBox[S]:n.layoutBox[S],j=Hn(l[S]);I.max=I.min+j,s.relativeTarget&&!s.currentAnimation&&(s.isProjectionDirty=!0,s.relativeTarget[S].max=s.relativeTarget[S].min+j)});const v=cp();dg(v,l,n.layoutBox);const y=cp();g?dg(y,s.applyTransform(u,!0),n.measuredBox):dg(y,l,n.layoutBox);const w=!xH(v);let T=!1;if(!s.resumeFrom){const S=s.getClosestProjectingParent();if(S&&!S.resumeFrom){const{snapshot:I,layout:j}=S;if(I&&j){const B=Ls();ug(B,n.layoutBox,I.layoutBox);const A=Ls();ug(A,l,j.layoutBox),bH(B,A)||(T=!0),S.options.layoutRoot&&(s.relativeTarget=A,s.relativeTargetOrigin=B,s.relativeParent=S)}}}s.notifyListeners("didUpdate",{layout:l,snapshot:n,delta:y,layoutDelta:v,hasLayoutChanged:w,hasRelativeLayoutChanged:T})}else if(s.isLead()){const{onExitComplete:l}=s.options;l&&l()}s.options.transition=void 0}function Lye(s){s.parent&&(s.isProjecting()||(s.isProjectionDirty=s.parent.isProjectionDirty),s.isSharedProjectionDirty||(s.isSharedProjectionDirty=!!(s.isProjectionDirty||s.parent.isProjectionDirty||s.parent.isSharedProjectionDirty)),s.isTransformDirty||(s.isTransformDirty=s.parent.isTransformDirty))}function Mye(s){s.isProjectionDirty=s.isSharedProjectionDirty=s.isTransformDirty=!1}function Fye(s){s.clearSnapshot()}function z6(s){s.clearMeasurements()}function K6(s){s.isLayoutDirty=!1}function Uye(s){const{visualElement:n}=s.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),s.resetTransform()}function q6(s){s.finishAnimation(),s.targetDelta=s.relativeTarget=s.target=void 0,s.isProjectionDirty=!0}function Vye(s){s.resolveTargetDelta()}function Bye(s){s.calcProjection()}function Wye(s){s.resetSkewAndRotation()}function Gye(s){s.removeLeadSnapshot()}function Y6(s,n,a){s.translate=_s(n.translate,0,a),s.scale=_s(n.scale,1,a),s.origin=n.origin,s.originPoint=n.originPoint}function $6(s,n,a,l){s.min=_s(n.min,a.min,l),s.max=_s(n.max,a.max,l)}function Hye(s,n,a,l){$6(s.x,n.x,a.x,l),$6(s.y,n.y,a.y,l)}function zye(s){return s.animationValues&&s.animationValues.opacityExit!==void 0}const Kye={duration:.45,ease:[.4,0,.1,1]},X6=s=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(s),J6=X6("applewebkit/")&&!X6("chrome/")?Math.round:vi;function Q6(s){s.min=J6(s.min),s.max=J6(s.max)}function qye(s){Q6(s.x),Q6(s.y)}function CH(s,n,a){return s==="position"||s==="preserve-aspect"&&!Zve(G6(n),G6(a),.2)}function Yye(s){var n;return s!==s.root&&((n=s.scroll)==null?void 0:n.wasRoot)}const $ye=SH({attachResizeListener:(s,n)=>Ug(s,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),bR={current:void 0},TH=SH({measureScroll:s=>({x:s.scrollLeft,y:s.scrollTop}),defaultParent:()=>{if(!bR.current){const s=new $ye({});s.mount(window),s.setOptions({layoutScroll:!0}),bR.current=s}return bR.current},resetTransform:(s,n)=>{s.style.transform=n!==void 0?n:"none"},checkIsScrollRoot:s=>window.getComputedStyle(s).position==="fixed"}),Xye={pan:{Feature:fye},drag:{Feature:pye,ProjectionNode:TH,MeasureLayout:EH}};function Z6(s,n,a){const{props:l}=s;s.animationState&&l.whileHover&&s.animationState.setActive("whileHover",a==="Start");const u="onHover"+a,f=l[u];f&&Br.postRender(()=>f(n,t_(n)))}class Jye extends Hl{mount(){const{current:n}=this.node;n&&(this.unmount=cEe(n,(a,l)=>(Z6(this.node,l,"Start"),u=>Z6(this.node,u,"End"))))}unmount(){}}class Qye extends Hl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let n=!1;try{n=this.node.current.matches(":focus-visible")}catch{n=!0}!n||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Qg(Ug(this.node.current,"focus",()=>this.onFocus()),Ug(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function e7(s,n,a){const{props:l}=s;if(s.current instanceof HTMLButtonElement&&s.current.disabled)return;s.animationState&&l.whileTap&&s.animationState.setActive("whileTap",a==="Start");const u="onTap"+(a==="End"?"":a),f=l[u];f&&Br.postRender(()=>f(n,t_(n)))}class Zye extends Hl{mount(){const{current:n}=this.node;n&&(this.unmount=hEe(n,(a,l)=>(e7(this.node,l,"Start"),(u,{success:f})=>e7(this.node,u,f?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const sA=new WeakMap,wR=new WeakMap,exe=s=>{const n=sA.get(s.target);n&&n(s)},txe=s=>{s.forEach(exe)};function rxe({root:s,...n}){const a=s||document;wR.has(a)||wR.set(a,{});const l=wR.get(a),u=JSON.stringify(n);return l[u]||(l[u]=new IntersectionObserver(txe,{root:s,...n})),l[u]}function sxe(s,n,a){const l=rxe(n);return sA.set(s,a),l.observe(s),()=>{sA.delete(s),l.unobserve(s)}}const nxe={some:0,all:1};class ixe extends Hl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:n={}}=this.node.getProps(),{root:a,margin:l,amount:u="some",once:f}=n,g={root:a?a.current:void 0,rootMargin:l,threshold:typeof u=="number"?u:nxe[u]},v=y=>{const{isIntersecting:w}=y;if(this.isInView===w||(this.isInView=w,f&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:T,onViewportLeave:S}=this.node.getProps(),I=w?T:S;I&&I(y)};return sxe(this.node.current,g,v)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:n,prevProps:a}=this.node;["amount","margin","root"].some(axe(n,a))&&this.startObserver()}unmount(){}}function axe({viewport:s={}},{viewport:n={}}={}){return a=>s[a]!==n[a]}const oxe={inView:{Feature:ixe},tap:{Feature:Zye},focus:{Feature:Qye},hover:{Feature:Jye}},cxe={layout:{ProjectionNode:TH,MeasureLayout:EH}},lxe={...qve,...oxe,...Xye,...cxe},mc=lve(lxe,bve),dxe=50,t7=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),uxe=()=>({time:0,x:t7(),y:t7()}),hxe={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function r7(s,n,a,l){const u=a[n],{length:f,position:g}=hxe[n],v=u.current,y=a.time;u.current=s[`scroll${g}`],u.scrollLength=s[`scroll${f}`]-s[`client${f}`],u.offset.length=0,u.offset[0]=0,u.offset[1]=u.scrollLength,u.progress=Lp(0,u.scrollLength,u.current);const w=l-y;u.velocity=w>dxe?0:_I(u.current-v,w)}function pxe(s,n,a){r7(s,"x",n,a),r7(s,"y",n,a),n.time=a}function fxe(s,n){const a={x:0,y:0};let l=s;for(;l&&l!==n;)if(PI(l))a.x+=l.offsetLeft,a.y+=l.offsetTop,l=l.offsetParent;else if(l.tagName==="svg"){const u=l.getBoundingClientRect();l=l.parentElement;const f=l.getBoundingClientRect();a.x+=u.left-f.left,a.y+=u.top-f.top}else if(l instanceof SVGGraphicsElement){const{x:u,y:f}=l.getBBox();a.x+=u,a.y+=f;let g=null,v=l.parentNode;for(;!g;)v.tagName==="svg"&&(g=v),v=l.parentNode;l=g}else break;return a}const nA={start:0,center:.5,end:1};function s7(s,n,a=0){let l=0;if(s in nA&&(s=nA[s]),typeof s=="string"){const u=parseFloat(s);s.endsWith("px")?l=u:s.endsWith("%")?s=u/100:s.endsWith("vw")?l=u/100*document.documentElement.clientWidth:s.endsWith("vh")?l=u/100*document.documentElement.clientHeight:s=u}return typeof s=="number"&&(l=n*s),a+l}const mxe=[0,0];function gxe(s,n,a,l){let u=Array.isArray(s)?s:mxe,f=0,g=0;return typeof s=="number"?u=[s,s]:typeof s=="string"&&(s=s.trim(),s.includes(" ")?u=s.split(" "):u=[s,nA[s]?s:"0"]),f=s7(u[0],a,l),g=s7(u[1],n),f-g}const _xe={All:[[0,0],[1,1]]},Exe={x:0,y:0};function vxe(s){return"getBBox"in s&&s.tagName!=="svg"?s.getBBox():{width:s.clientWidth,height:s.clientHeight}}function yxe(s,n,a){const{offset:l=_xe.All}=a,{target:u=s,axis:f="y"}=a,g=f==="y"?"height":"width",v=u!==s?fxe(u,s):Exe,y=u===s?{width:s.scrollWidth,height:s.scrollHeight}:vxe(u),w={width:s.clientWidth,height:s.clientHeight};n[f].offset.length=0;let T=!n[f].interpolate;const S=l.length;for(let I=0;I<S;I++){const j=gxe(l[I],w[g],y[g],v[f]);!T&&j!==n[f].interpolatorOffsets[I]&&(T=!0),n[f].offset[I]=j}T&&(n[f].interpolate=TI(n[f].offset,EG(l),{clamp:!1}),n[f].interpolatorOffsets=[...n[f].offset]),n[f].progress=Ho(0,1,n[f].interpolate(n[f].current))}function xxe(s,n=s,a){if(a.x.targetOffset=0,a.y.targetOffset=0,n!==s){let l=n;for(;l&&l!==s;)a.x.targetOffset+=l.offsetLeft,a.y.targetOffset+=l.offsetTop,l=l.offsetParent}a.x.targetLength=n===s?n.scrollWidth:n.clientWidth,a.y.targetLength=n===s?n.scrollHeight:n.clientHeight,a.x.containerLength=s.clientWidth,a.y.containerLength=s.clientHeight}function bxe(s,n,a,l={}){return{measure:u=>{xxe(s,l.target,a),pxe(s,a,u),(l.offset||l.target)&&yxe(s,a,l)},notify:()=>n(a)}}const Vm=new WeakMap,n7=new WeakMap,SR=new WeakMap,i7=s=>s===document.scrollingElement?window:s;function RH(s,{container:n=document.scrollingElement,...a}={}){if(!n)return vi;let l=SR.get(n);l||(l=new Set,SR.set(n,l));const u=uxe(),f=bxe(n,s,u,a);if(l.add(f),!Vm.has(n)){const v=()=>{for(const S of l)S.measure(an.timestamp);Br.preUpdate(y)},y=()=>{for(const S of l)S.notify()},w=()=>Br.read(v);Vm.set(n,w);const T=i7(n);window.addEventListener("resize",w,{passive:!0}),n!==document.documentElement&&n7.set(n,xEe(n,w)),T.addEventListener("scroll",w,{passive:!0}),w()}const g=Vm.get(n);return Br.read(g,!1,!0),()=>{var w;oo(g);const v=SR.get(n);if(!v||(v.delete(f),v.size))return;const y=Vm.get(n);Vm.delete(n),y&&(i7(n).removeEventListener("scroll",y),(w=n7.get(n))==null||w(),window.removeEventListener("resize",y))}}const a7=new Map;function wxe(s){const n={value:0},a=RH(l=>{n.value=l[s.axis].progress*100},s);return{currentTime:n,cancel:a}}function NH({source:s,container:n,...a}){const{axis:l}=a;s&&(n=s);const u=a7.get(n)??new Map;a7.set(n,u);const f=a.target??"self",g=u.get(f)??{},v=l+(a.offset??[]).join(",");return g[v]||(g[v]=!a.target&&bG()?new ScrollTimeline({source:n,axis:l}):wxe({container:n,...a})),g[v]}function Sxe(s,n){const a=NH(n);return s.attachTimeline({timeline:n.target?void 0:a,observe:l=>(l.pause(),UG(u=>{l.time=l.iterationDuration*u},a))})}function Cxe(s){return s.length===2}function Txe(s,n){return Cxe(s)?RH(a=>{s(a[n.axis].progress,a)},n):UG(s,NH(n))}function Rxe(s,{axis:n="y",container:a=document.scrollingElement,...l}={}){if(!a)return vi;const u={axis:n,container:a,...l};return typeof s=="function"?Txe(s,u):Sxe(s,u)}const Nxe=()=>({scrollX:so(0),scrollY:so(0),scrollXProgress:so(0),scrollYProgress:so(0)}),Ny=s=>s?!s.current:!1;function Axe({container:s,target:n,...a}={}){const l=Kp(Nxe),u=L.useRef(null),f=L.useRef(!1),g=L.useCallback(()=>(u.current=Rxe((v,{x:y,y:w})=>{l.scrollX.set(y.current),l.scrollXProgress.set(y.progress),l.scrollY.set(w.current),l.scrollYProgress.set(w.progress)},{...a,container:(s==null?void 0:s.current)||void 0,target:(n==null?void 0:n.current)||void 0}),()=>{var v;(v=u.current)==null||v.call(u)}),[s,n,JSON.stringify(a.offset)]);return cb(()=>{if(f.current=!1,Ny(s)||Ny(n)){f.current=!0;return}else return g()},[g]),L.useEffect(()=>{if(f.current)return kg(!Ny(s)),kg(!Ny(n)),g()},[g]),l}function Ixe(s){const n=Kp(()=>so(s)),{isStatic:a}=L.useContext(db);if(a){const[,l]=L.useState(s);L.useEffect(()=>n.on("change",l),[])}return n}function AH(s,n){const a=Ixe(n()),l=()=>a.set(n());return l(),cb(()=>{const u=()=>Br.preRender(l,!1,!0),f=s.map(g=>g.on("change",u));return()=>{f.forEach(g=>g()),oo(l)}}),a}function Oxe(s){cg.current=[],s();const n=AH(cg.current,s);return cg.current=void 0,n}function CR(s,n,a,l){if(typeof s=="function")return Oxe(s);const u=typeof n=="function"?n:wEe(n,a,l);return Array.isArray(s)?o7(s,u):o7([s],([f])=>u(f))}function o7(s,n){const a=Kp(()=>[]);return AH(s,()=>{a.length=0;const l=s.length;for(let u=0;u<l;u++)a[u]=s[u].get();return n(a)})}const ko={degreesToRadians:s=>s*(Math.PI/180),radiansToDegrees:s=>s*(180/Math.PI),sphericalToCartesian:(s,n,a)=>({x:s*Math.sin(a)*Math.cos(n),y:s*Math.cos(a),z:s*Math.sin(a)*Math.sin(n)}),calculateDistance:(s,n={x:0,y:0,z:0})=>{const a=s.x-n.x,l=s.y-n.y,u=s.z-n.z;return Math.sqrt(a*a+l*l+u*u)},normalizeAngle:s=>{for(;s>180;)s-=360;for(;s<-180;)s+=360;return s}},Dxe=({images:s=[],containerSize:n=400,sphereRadius:a=200,dragSensitivity:l=.5,momentumDecay:u=.95,maxRotationSpeed:f=5,baseImageScale:g=.12,hoverScale:v=1.2,perspective:y=1e3,autoRotate:w=!1,autoRotateSpeed:T=.3,className:S=""})=>{const[I,j]=L.useState(!1),[B,A]=L.useState({x:15,y:15,z:0}),[F,D]=L.useState({x:0,y:0}),[R,O]=L.useState(!1),[V,G]=L.useState(null),[J,$]=L.useState([]),[q,ee]=L.useState(null),ne=L.useRef(null),de=L.useRef({x:0,y:0}),me=L.useRef(null),ve=a||n*.5,_e=n*g,De=L.useCallback(()=>{const We=[],Ze=s.length,ye=(1+Math.sqrt(5))/2,Pe=2*Math.PI/ye;for(let $e=0;$e<Ze;$e++){const kt=$e/Ze,Kt=Math.acos(1-2*kt),Ht=Pe*$e;let ft=Kt*180/Math.PI,dr=Ht*180/Math.PI%360;const jt=Math.pow(Math.abs(ft-90)/90,.6)*35;ft<90?ft=Math.max(5,ft-jt):ft=Math.min(175,ft+jt),ft=15+ft/180*150;const Pr=(Math.random()-.5)*20;dr=(dr+Pr)%360,ft=Math.max(0,Math.min(180,ft+(Math.random()-.5)*10)),We.push({theta:dr,phi:ft,radius:ve})}return We},[s.length,ve]),Xe=L.useCallback(()=>{const Ze=[...J.map((ye,Pe)=>{const $e=ko.degreesToRadians(ye.theta),kt=ko.degreesToRadians(ye.phi),Kt=ko.degreesToRadians(B.x),Ht=ko.degreesToRadians(B.y);let ft=ye.radius*Math.sin(kt)*Math.cos($e),dr=ye.radius*Math.cos(kt),jt=ye.radius*Math.sin(kt)*Math.sin($e);const Pr=ft*Math.cos(Ht)+jt*Math.sin(Ht),Xn=-ft*Math.sin(Ht)+jt*Math.cos(Ht);ft=Pr,jt=Xn;const Yo=dr*Math.cos(Kt)-jt*Math.sin(Kt),lo=dr*Math.sin(Kt)+jt*Math.cos(Kt);dr=Yo,jt=lo;const Qs={x:ft,y:dr,z:jt},xs=-10,uo=-30,Kl=Qs.z>uo;let ln=1;Qs.z<=xs&&(ln=Math.max(0,(Qs.z-uo)/(xs-uo)));const ur=ye.phi<30||ye.phi>150,Ir=Math.sqrt(Qs.x*Qs.x+Qs.y*Qs.y),hr=Math.min(Ir/ve,1),_u=Math.max(.3,1-hr*(ur?.4:.7)),Ta=(Qs.z+ve)/(2*ve),Eu=_u*Math.max(.5,.8+Ta*.3);return{...Qs,scale:Eu,zIndex:Math.round(1e3+Qs.z),isVisible:Kl,fadeOpacity:ln,originalIndex:Pe}})];for(let ye=0;ye<Ze.length;ye++){const Pe=Ze[ye];if(!Pe.isVisible)continue;let $e=Pe.scale;const kt=_e*$e;for(let Kt=0;Kt<Ze.length;Kt++){if(ye===Kt)continue;const Ht=Ze[Kt];if(!Ht.isVisible)continue;const ft=_e*Ht.scale,dr=Pe.x-Ht.x,jt=Pe.y-Ht.y,Pr=Math.sqrt(dr*dr+jt*jt),Xn=(kt+ft)/2+25;if(Pr<Xn&&Pr>0){const Yo=Xn-Pr,lo=Math.max(.4,1-Yo/Xn*.6);$e=Math.min($e,$e*lo)}}Ze[ye]={...Pe,scale:Math.max(.25,$e)}}return Ze},[J,B,ve,_e]),Oe=L.useCallback(We=>Math.max(-f,Math.min(f,We)),[f]),ae=L.useCallback(()=>{R||(D(We=>{const Ze={x:We.x*u,y:We.y*u};return!w&&Math.abs(Ze.x)<.01&&Math.abs(Ze.y)<.01?{x:0,y:0}:Ze}),A(We=>{let Ze=We.y;return w&&(Ze+=T),Ze+=Oe(F.y),{x:ko.normalizeAngle(We.x+Oe(F.x)),y:ko.normalizeAngle(Ze),z:We.z}}))},[R,u,F,Oe,w,T]),Ee=L.useCallback(We=>{We.preventDefault(),O(!0),D({x:0,y:0}),de.current={x:We.clientX,y:We.clientY}},[]),Le=L.useCallback(We=>{if(!R)return;const Ze=We.clientX-de.current.x,Pe={x:-(We.clientY-de.current.y)*l,y:Ze*l};A($e=>({x:ko.normalizeAngle($e.x+Oe(Pe.x)),y:ko.normalizeAngle($e.y+Oe(Pe.y)),z:$e.z})),D({x:Oe(Pe.x),y:Oe(Pe.y)}),de.current={x:We.clientX,y:We.clientY}},[R,l,Oe]),Ke=L.useCallback(()=>{O(!1)},[]),He=L.useCallback(We=>{We.preventDefault();const Ze=We.touches[0];O(!0),D({x:0,y:0}),de.current={x:Ze.clientX,y:Ze.clientY}},[]),gt=L.useCallback(We=>{if(!R)return;We.preventDefault();const Ze=We.touches[0],ye=Ze.clientX-de.current.x,$e={x:-(Ze.clientY-de.current.y)*l,y:ye*l};A(kt=>({x:ko.normalizeAngle(kt.x+Oe($e.x)),y:ko.normalizeAngle(kt.y+Oe($e.y)),z:kt.z})),D({x:Oe($e.x),y:Oe($e.y)}),de.current={x:Ze.clientX,y:Ze.clientY}},[R,l,Oe]),yt=L.useCallback(()=>{O(!1)},[]);L.useEffect(()=>{j(!0)},[]),L.useEffect(()=>{$(De())},[De]),L.useEffect(()=>{const We=()=>{ae(),me.current=requestAnimationFrame(We)};return I&&(me.current=requestAnimationFrame(We)),()=>{me.current&&cancelAnimationFrame(me.current)}},[I,ae]),L.useEffect(()=>{if(!(!I||!ne.current))return document.addEventListener("mousemove",Le),document.addEventListener("mouseup",Ke),document.addEventListener("touchmove",gt,{passive:!1}),document.addEventListener("touchend",yt),()=>{document.removeEventListener("mousemove",Le),document.removeEventListener("mouseup",Ke),document.removeEventListener("touchmove",gt),document.removeEventListener("touchend",yt)}},[I,Le,Ke,gt,yt]);const It=Xe(),Ct=L.useCallback((We,Ze)=>{const ye=It[Ze];if(!ye||!ye.isVisible)return null;_e*ye.scale;const $e=q===Ze?Math.min(v,v/ye.scale):1;return o.jsx("div",{className:"absolute cursor-pointer select-none transition-transform duration-200 ease-out",style:{width:`${_e/n*100}%`,height:`${_e/n*100}%`,left:`${50+ye.x/n*100}%`,top:`${50+ye.y/n*100}%`,opacity:ye.fadeOpacity,transform:`translate(-50%, -50%) scale(${$e})`,zIndex:ye.zIndex},onMouseEnter:()=>ee(Ze),onMouseLeave:()=>ee(null),onClick:()=>G(We),children:o.jsx("div",{className:"relative w-full h-full rounded-full overflow-hidden shadow-lg border-2 border-white/20",children:o.jsx("img",{src:We.src,alt:We.alt,className:"w-full h-full object-cover",draggable:!1,loading:Ze<3?"eager":"lazy"})})},We.id)},[It,_e,n,q,v]),et=()=>V?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/30",onClick:()=>G(null),style:{animation:"fadeIn 0.3s ease-out"},children:o.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full overflow-hidden",onClick:We=>We.stopPropagation(),style:{animation:"scaleIn 0.3s ease-out"},children:[o.jsxs("div",{className:"relative aspect-square",children:[o.jsx("img",{src:V.src,alt:V.alt,className:"w-full h-full object-cover"}),o.jsx("button",{onClick:()=>G(null),className:"absolute top-2 right-2 w-8 h-8 bg-black bg-opacity-50 rounded-full text-white flex items-center justify-center hover:bg-opacity-70 transition-all cursor-pointer",children:o.jsx("span",{className:"text-sm leading-none",children:""})})]}),(V.title||V.description)&&o.jsxs("div",{className:"p-6",children:[V.title&&o.jsx("h3",{className:"text-xl font-bold mb-2",children:V.title}),V.description&&o.jsx("p",{className:"text-gray-600",children:V.description})]})]})}):null;return I?s.length?o.jsxs(o.Fragment,{children:[o.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes scaleIn {
          from { transform: scale(0.8); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
      `}),o.jsx("div",{ref:ne,className:`relative select-none cursor-grab active:cursor-grabbing w-full h-full max-w-[250px] max-h-[250px] md:max-w-[420px] md:max-h-[420px] ${S}`,style:{perspective:`${y}px`},onMouseDown:Ee,onTouchStart:He,children:o.jsx("div",{className:"relative w-full h-full",style:{zIndex:10},children:s.map((We,Ze)=>Ct(We,Ze))})}),et()]}):o.jsx("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center",style:{width:n,height:n},children:o.jsxs("div",{className:"text-gray-400 text-center",children:[o.jsx("p",{children:"No images provided"}),o.jsx("p",{className:"text-sm",children:"Add images to the images prop"})]})}):o.jsx("div",{className:"bg-gray-100 rounded-lg animate-pulse flex items-center justify-center",style:{width:n,height:n},children:o.jsx("div",{className:"text-gray-400",children:"Loading..."})})},Pxe="/assets/Ready-to-Share%20Social%20Media%20Posts%20to%20Amplify%20Your%20Brand%20on%20Pinterest-DaRwwLah.jpeg";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kxe=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),IH=(...s)=>s.filter((n,a,l)=>!!n&&n.trim()!==""&&l.indexOf(n)===a).join(" ").trim();/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var jxe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lxe=L.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:l,className:u="",children:f,iconNode:g,...v},y)=>L.createElement("svg",{ref:y,...jxe,width:n,height:n,stroke:s,strokeWidth:l?Number(a)*24/Number(n):a,className:IH("lucide",u),...v},[...g.map(([w,T])=>L.createElement(w,T)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=(s,n)=>{const a=L.forwardRef(({className:l,...u},f)=>L.createElement(Lxe,{ref:f,iconNode:n,className:IH(`lucide-${kxe(s)}`,l),...u}));return a.displayName=`${s}`,a};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mxe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],OH=Ca("Bell",Mxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fxe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],DH=Ca("Check",Fxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uxe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Vxe=Ca("ChevronLeft",Uxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bxe=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Wxe=Ca("ChevronRight",Bxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gxe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],PH=Ca("Copy",Gxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hxe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],kH=Ca("EllipsisVertical",Hxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zxe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],jH=Ca("Ellipsis",zxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kxe=[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]],LH=Ca("Flag",Kxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qxe=[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]],MH=Ca("Reply",qxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yxe=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],FH=Ca("Settings",Yxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $xe=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],UH=Ca("Trash2",$xe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xxe=[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 19h-6",key:"vcuq98"}]],VH=Ca("UserRoundMinus",Xxe),Jxe=({testimonials:s,autoplay:n=!1,className:a=""})=>{const[l,u]=L.useState(0),f=()=>{u(T=>(T+1)%s.length)},g=()=>{u(T=>(T-1+s.length)%s.length)};L.useEffect(()=>{if(!n)return;const T=setInterval(f,5e3);return()=>clearInterval(T)},[n]);const v=T=>T===l,y=()=>Math.floor(Math.random()*21)-10,w=s[l];return o.jsx("div",{className:`max-w-sm md:max-w-4xl mx-auto px-4 md:px-8 lg:px-12 py-12 md:py-20 ${a}`,children:o.jsxs("div",{className:"relative grid grid-cols-1 gap-12 md:grid-cols-2 md:gap-20",children:[o.jsx("div",{children:o.jsx("div",{className:"relative h-72 w-full md:h-80",children:o.jsx(c6,{children:s.map((T,S)=>o.jsx(mc.div,{initial:{opacity:0,scale:.9,z:-100,rotate:y()},animate:{opacity:v(S)?1:.7,scale:v(S)?1:.95,z:v(S)?0:-100,rotate:v(S)?0:y(),zIndex:v(S)?999:s.length+2-S,y:v(S)?[0,-40,0]:0},exit:{opacity:0,scale:.9,z:100,rotate:y()},transition:{duration:.4,ease:"easeInOut"},className:"absolute inset-0 origin-bottom overflow-hidden rounded-3xl border border-[#E9ECEF] bg-white shadow-[var(--shadow-lg)]",children:o.jsx("img",{src:T.src,alt:T.name,draggable:!1,className:"h-full w-full object-cover object-center"})},T.src))})})}),o.jsxs("div",{className:"flex flex-col justify-between py-2",children:[o.jsx(c6,{mode:"wait",children:o.jsxs(mc.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:-20,opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[o.jsx("h3",{className:"text-2xl font-bold text-[#212529]",children:w.name}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:w.designation}),o.jsx("p",{className:"mt-6 text-base text-[#343A40] md:text-lg",children:w.quote})]},l)}),o.jsxs("div",{className:"mt-8 flex gap-4 md:mt-12",children:[o.jsx("button",{type:"button",onClick:g,className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#F1F3F5] text-[#212529] shadow-sm transition-transform duration-300 hover:-translate-x-0.5",children:o.jsx(Vxe,{className:"h-4 w-4"})}),o.jsx("button",{type:"button",onClick:f,className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#F1F3F5] text-[#212529] shadow-sm transition-transform duration-300 hover:translate-x-0.5",children:o.jsx(Wxe,{className:"h-4 w-4"})})]})]})]})})},Ox=[{name:"Priya Sharma",category:" Gamer",followers:"52K followers",priceRange:"120-360",avatar:"PS",highlight:"Speedruns & strategy coaching"},{name:"Rohan Gupta",category:" Chef",followers:"68K followers",priceRange:"90-280",avatar:"RG",highlight:"Teaches restaurant-style recipes"},{name:"Amit Singh",category:" Artist",followers:"74K followers",priceRange:"150-400",avatar:"AS",highlight:"Live sketching + portfolio reviews"},{name:"Neha Kapoor",category:" Life Coach",followers:"38K followers",priceRange:"200-420",avatar:"NK",highlight:"Career clarity & confidence boosts"},{name:"Arjun Mehta",category:" Musician",followers:"81K followers",priceRange:"110-300",avatar:"AM",highlight:"Song breakdowns + songwriting tips"},{name:"Sana Rao",category:" Fitness",followers:"46K followers",priceRange:"95-260",avatar:"SR",highlight:"At-home workouts & accountability"}],c7=["https://images.pexels.com/photos/1181519/pexels-photo-1181519.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181670/pexels-photo-1181670.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181681/pexels-photo-1181681.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181675/pexels-photo-1181675.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181672/pexels-photo-1181672.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181680/pexels-photo-1181680.jpeg?auto=compress&cs=tinysrgb&w=800"],Qxe=Array.from({length:32}).map((s,n)=>{const a=Ox[n%Ox.length],l=c7[n%c7.length];return{id:`featured-${n}`,src:l,alt:a.name,title:a.name,description:`${a.category}  ${a.highlight}`}}),Zxe=[{icon:"",title:"Pick Your Creator",description:"Find someone you want to meet. Could be a YouTuber, chef, gamer, or anyone awesome!",step:"1"},{icon:"",title:"Bid (It's Like an Auction)",description:"Place a bid to win a video call. The highest bid wins! Don't worry - if you lose, you get most of your money back!",step:"2"},{icon:"",title:"Meet Them on Video Call",description:"If you win, you get 5-10 minutes to chat one-on-one. How cool is that?!",step:"3"}],ebe=[{value:"1,247",label:"Happy Fans Joined"},{value:"200",label:"Video Meets Completed"},{value:"95%",label:"Success Rate (Fans Win)"}],tbe=[{value:"89",label:"Creators Active Now"},{value:"4.5L",label:"Total Money Creators Earned"},{value:"10",label:"Minutes Average Meeting Time"},{value:"2-10",label:"Minutes Call Length Options"}],rbe=[{name:"Priya Sharma  Content Creator  52K followers",quote:"I've done brand deals, sponsorships, everything. But FanMeet is different. I actually get to TALK to my supporters. I earned 45,000 last month and it helps fund new content!",duration:"60 sec clip"},{name:"Rohan Verma  Gaming Streamer  48K followers",quote:"My fans are the reason I do this. FanMeet lets me give back. These 10-minute calls remind me why I started. Plus, the extra income upgrades my setup. Win-win!",duration:"75 sec clip"}],l7=[{id:"photo-1",quote:"Dreams come true! ",context:"Got cooking tips from Chef Amit!"},{id:"photo-2",quote:"Best birthday surprise ever ",context:"He sang my favourite song live!"},{id:"photo-3",quote:"She remembered my username!! ",context:"Finally spoke to my art icon"},{id:"photo-4",quote:"Career clarity in 10 minutes",context:"Life coach gave me a plan"},{id:"photo-5",quote:"We geeked out over anime ",context:"Felt like chatting with a friend"},{id:"photo-6",quote:"He reviewed my vlog setup ",context:"Got technical tips + motivation"}],d7=["https://images.pexels.com/photos/1181675/pexels-photo-1181675.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1183266/pexels-photo-1183266.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181519/pexels-photo-1181519.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181670/pexels-photo-1181670.jpeg?auto=compress&cs=tinysrgb&w=800","https://images.pexels.com/photos/1181686/pexels-photo-1181686.jpeg?auto=compress&cs=tinysrgb&w=800"],u7=[{quote:"I've been following Chef Amit for 2 years on YouTube and never thought I'd get to talk to him personally. FanMeet made it possible! He gave me tips on starting my own food blog and even shared his secret recipe. Best 350 I ever spent. Thank you FanMeet! ",name:"Neha Kapoor, 26  Food Blogger  Mumbai",met:"Met: Chef Amit Gupta"},{quote:"As an introvert, I was scared to bid. But I really wanted career advice from Aditi. I won at 280. The call was so comfortable! She answered all my questions and even followed up with resources via email. Worth every rupee.",name:"Anonymous Fan, 23  Software Engineer",met:"Met: Aditi Sharma (Career Coach)"},{quote:"Booked a FanMeet for my little brother with his favourite tech creator. They both nerded out about gadgets for 10 minutes. He's still smiling a week later. 300 very well spent!",name:"Pooja Malhotra, 27  Pune",met:"Met: Tech with Raj"},{quote:"I used FanMeet to get feedback on my indie game from a gaming creator I admire. He gave me 3 actionable tips and shared my demo with his Discord server. Instant confidence boost!",name:"Harsh Patel, 21  Game Developer  Ahmedabad",met:"Met: Rohan Live"}],sbe=[{icon:"",title:"Secure Payments",bullets:["All payments encrypted via Razorpay","Your card details never touch our servers","Same security as Amazon & Flipkart"],badge:"Razorpay Partner"},{icon:"",title:"Safe Refunds",bullets:["Get 90% back if you do not win","Instant & automatic  no forms to fill","1.2 lakh refunded with 98.5% success rate"],badge:"90% Refund Guarantee"},{icon:"",title:"Verified Creators",bullets:["Every creator manually approved by our team","Identity + social media checks","No fake accounts allowed"],badge:"Human Verified"},{icon:"",title:"24/7 Support",bullets:["Real humans reply within 2.3 hours","Email, chat, or call anytime","We stay with you till the call ends"],badge:"Always On"}],nbe=[{title:"Paid Events (Bidding)",description:"Highest bid wins a 5-10 minute one-on-one call.",highlights:["Starting bids at 50 or 100","If you lose, 90% is refunded automatically","Average winning bid 250-400"],story:"I bid 250 for a 10-minute call with my favourite YouTuber. I won! The other 22 bidders got 225 back. Losing would cost only 25  cheaper than a coffee!  Rahul, College Student, Delhi",cta:"Browse Paid Events"},{title:"Free Events (Lucky Draw)",description:"Zero cost entries for surprise video calls.",highlights:["0 entry  completely free","Random winner chosen, no risk at all","Calls last 5-10 minutes just like paid events"],story:"I joined a free draw for Chef Amit and actually got picked! No money spent, just pure luck.  Priya, Food Blogger, Mumbai",cta:"Join Free Draws"}],ibe=[{name:"Arjun Singh",role:"Founder",bio:"I once drove 8 hours to meet my favourite musician. Worth it. Now I help others meet their heroes from the couch!",funFact:"Biggest fan of Samay Raina"},{name:"Priya Mehta",role:"Co-Founder",bio:"Former food blogger (15K followers). I know both sides of the fan-creator equation. We built this for YOU.",funFact:"Made 47 prototypes before the final design"},{name:"Rahul Verma",role:"Tech Lead",bio:"I make sure calls never lag and payments stay secure. Boring? Yes. Important? Also yes.",funFact:"Fixed a bug at 3 AM while eating Maggi"},{name:"Neha Kapoor",role:"Customer Support",bio:"I reply to every email personally. Got a question? I am on it!",funFact:"Fastest typer in the team (110 WPM)"},{name:"Amit Gupta",role:"Marketing",bio:"I find awesome creators, make memes, and keep the community buzzing.",funFact:"Binged 200 YouTube channels for research"},{name:"Sneha Sharma",role:"Operations",bio:"I approve creator applications and keep every event running smooth.",funFact:"Interviewed 89 creators personally"}],h7=["https://images.unsplash.com/photo-1544723795-3fb6469f5b39?auto=format&fit=crop&w=900&q=80","https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=900&q=80","https://images.unsplash.com/photo-1544723795-432537d12f6c?auto=format&fit=crop&w=900&q=80","https://images.unsplash.com/photo-1544723795-3fb0b90c07c1?auto=format&fit=crop&w=900&q=80","https://images.unsplash.com/photo-1525130413817-d45c1d127c42?auto=format&fit=crop&w=900&q=80","https://images.unsplash.com/photo-1525130413817-9e0b0a50b9d5?auto=format&fit=crop&w=900&q=80"],abe=ibe.map((s,n)=>({quote:s.bio,name:s.name,designation:s.role,src:h7[n%h7.length]})),obe=[{category:"Fans",question:"What if I don't win the bid?",answer:"You automatically get 90% of your money back within 5-7 business days. If you bid 200, you only risk 20  less than a movie ticket!"},{category:"Fans",question:"How do I know creators are real?",answer:"Every creator is manually verified by our team. We check social media, identity, and test their video setup. No fake accounts allowed."},{category:"Fans",question:"What can I talk about in the call?",answer:"Anything! Ask questions, get advice, request shoutouts, share your story. It's your 10 minutes. Just be kind and respectful."},{category:"Fans",question:"What if my internet is bad?",answer:"Our video software works on 3G/4G. If there is a technical issue on our end, you get 100% refund or a reschedule  your choice."},{category:"Creators",question:"How do payouts work?",answer:"You keep 90% of the winning bid. Withdraw anytime via UPI or bank transfer. We process payouts within 2-3 business days."},{category:"Creators",question:"What if a fan is rude?",answer:"End the call immediately. We ban that user and you still keep your earnings. Your safety comes first."},{category:"Creators",question:"Do I need lots of followers?",answer:"If you have 1,000+ followers or a unique skill people want to learn, you are good to go. Smaller creators often get more bids!"},{category:"General",question:"Is FanMeet available outside India?",answer:"Right now we are India-only, but the waitlist is open. Drop your email and we will notify you when we expand."},{category:"General",question:"How is this different from Cameo?",answer:"Cameo is pre-recorded videos. FanMeet is live, two-way conversations. Ask follow-ups, share screens, and build a real connection."}],cbe=[{type:"press",name:"YourStory",quote:"FanMeet is building Indias most intimate creator-fan marketplace.",url:"#"},{type:"press",name:"Inc42",quote:"A refreshing take on live interactions. Fans are bidding for moments, not merch.",url:"#"},{type:"social",name:"@creatorsneha",quote:"Just wrapped my third FanMeet. Tears, laughs, and a fan who wants to start creating again. ",url:"#"},{type:"social",name:"@chefamit",quote:"FanMeet calls feel like cooking with friends. 25 bids last night!",url:"#"}],lbe=[{feature:"Real-time interaction",fanmeet:" Yes",social:" One-way comments",cameo:" Pre-recorded"},{feature:"Two-way conversation",fanmeet:" Talk & listen",social:" No",cameo:" No"},{feature:"Length of experience",fanmeet:"5-10 minutes",social:"Few seconds",cameo:"30-60 seconds"},{feature:"Ask follow-up questions",fanmeet:" Unlimited",social:" Maybe answered",cameo:" No"},{feature:"Typical price",fanmeet:"50-400",social:"Free (ignored)",cameo:"500-5000"},{feature:"Refund if you do not win",fanmeet:" 90-100%",social:"N/A",cameo:" No"}],dbe=[{title:"From Fan to Friend",before:"Rahul followed gaming creator Rohan for 3 years without a single reply.",during:"He won a 320 bid and spent 10 minutes discussing streaming tips.",after:"Rohan now recognizes Rahul in chat and they exchange DMs about upcoming games. Confidence boosted x100."},{title:"Career-Changing Advice",before:"Priya was torn between UX design and product management.",during:"She paid 400 to chat with a career coach creator who mapped a 90-day plan.",after:"Priya launched her own service studio within two months. Her first paying client came from that creators recommendation."},{title:"Gift That Made Her Cry",before:"Amit wanted a meaningful birthday surprise for his partner, an art lover.",during:"He booked a FanMeet with her favourite illustrator who live-sketched her while they talked.",after:"She cried happy tears and the sketch now hangs in their living room."}],Wh={fanmeet:{tagline:"Connecting fans and creators, one call at a time.",socials:[{label:"Instagram",url:"#"},{label:"Twitter",url:"#"},{label:"YouTube",url:"#"},{label:"LinkedIn",url:"#"}]},fans:[{label:"Browse Events",url:"#"},{label:"How It Works",url:"#how-it-works"},{label:"Pricing",url:"#pricing"},{label:"FAQs",url:"#faq"},{label:"Free Events",url:"#"}],creators:[{label:"Apply Now",url:"#creators"},{label:"Creator Guide",url:"#"},{label:"Earnings Calculator",url:"#"},{label:"Success Stories",url:"#success-stories"},{label:"Creator FAQs",url:"#faq"}],company:[{label:"About Us",url:"#team"},{label:"Our Team",url:"#team"},{label:"Press & Media",url:"#press"},{label:"Careers (We're Hiring!)",url:"#"},{label:"Blog",url:"#"}],support:[{label:"Help Center",url:"#"},{label:"Contact Us",url:"#"},{label:"Terms of Service",url:"#"},{label:"Privacy Policy",url:"#"},{label:"Refund Policy",url:"#"}]},ube=["Razorpay","Visa","Mastercard","UPI"],hbe=({titleComponent:s,children:n})=>{const a=L.useRef(null),{scrollYProgress:l}=Axe({target:a}),[u,f]=L.useState(!1);L.useEffect(()=>{const T=()=>{typeof window<"u"&&f(window.innerWidth<=768)};return T(),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T)}},[]);const g=u?[.9,1]:[1.05,1],v=CR(l,[0,1],[20,0]),y=CR(l,[0,1],g),w=CR(l,[0,1],[0,-80]);return o.jsx("div",{className:"h-[38rem] md:h-[49rem] flex justify-center relative px-2 md:px-16",ref:a,children:o.jsxs("div",{className:"py-5 md:py-8 w-full relative",style:{perspective:"1000px"},children:[o.jsx(pbe,{translate:w,titleComponent:s}),o.jsx(fbe,{rotate:v,scale:y,children:n})]})})},pbe=({translate:s,titleComponent:n})=>o.jsx(mc.div,{style:{translateY:s},className:"max-w-5xl mx-auto text-center mb-6 md:mb-8",children:n}),fbe=({rotate:s,scale:n,children:a})=>o.jsx(mc.div,{style:{rotateX:s,scale:n,boxShadow:"0 0 #0000004d, 0 9px 20px #0000004a, 0 37px 37px #00000042, 0 84px 50px #00000026, 0 149px 60px #0000000a, 0 233px 65px #00000003"},className:"max-w-5xl mx-auto h-[28rem] md:h-[38rem] w-full border-4 border-[#6C6C6C] p-3 md:p-6 bg-[#222222] rounded-[30px] shadow-2xl",children:o.jsx("div",{className:"h-full w-full overflow-hidden rounded-2xl bg-gray-100 dark:bg-zinc-900 flex",children:a})});function mbe(){const s=Fs(),[n,a]=L.useState("All"),[l,u]=L.useState(!1),[f,g]=L.useState(!1),v=n==="All"?Ox:Ox.filter(y=>y.category.toLowerCase().includes(n.toLowerCase()));return o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("section",{className:"relative overflow-hidden bg-[#050014] text-white",children:[o.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(0,213,255,0.32)_0,_transparent_55%),radial-gradient(circle_at_bottom,_rgba(236,72,153,0.32)_0,_transparent_55%)]"}),o.jsxs("div",{className:"relative z-10 mx-auto flex max-w-none flex-col px-2 pb-4 pt-6 md:max-w-7xl md:px-8 md:pb-6 md:pt-8",children:[o.jsxs("div",{className:"flex items-center justify-between text-white",children:[o.jsxs("div",{className:"flex items-center gap-6 md:gap-10",children:[o.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold md:text-xl",children:[o.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] shadow-[0_0_25px_rgba(192,69,255,0.6)]"}),o.jsx("span",{children:"FanMeet"})]}),o.jsxs("nav",{className:"hidden items-center gap-6 text-sm font-medium text-white/80 md:flex",children:[o.jsx("button",{type:"button",onClick:()=>s("/browse-events"),className:"transition-colors hover:text-white",children:"Browse Events"}),o.jsx("button",{type:"button",onClick:()=>s("/how-it-works"),className:"transition-colors hover:text-white",children:"How It Works"}),o.jsx("button",{type:"button",onClick:()=>s("/for-creators"),className:"transition-colors hover:text-white",children:"For Creators"})]})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("button",{type:"button",className:"hidden rounded-full border border-white/30 bg-black/40 px-4 py-1.5 text-xs font-medium text-white shadow-lg backdrop-blur-xl transition-all hover:-translate-y-0.5 hover:border-white hover:bg-black/60 hover:shadow-[0_0_25px_rgba(255,255,255,0.6)] md:inline-flex",onClick:()=>s("/auth"),children:"Log in"}),o.jsx("button",{type:"button",className:"hidden rounded-full border border-transparent bg-gradient-to-r from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] px-4 py-1.5 text-xs font-semibold text-white shadow-lg transition-all hover:-translate-y-0.5 hover:shadow-[0_0_35px_rgba(192,69,255,0.8)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#E6FF00] md:inline-flex",onClick:()=>s("/auth"),children:"Sign up"}),o.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-full border border-white/40 bg-black/40 p-2 text-white shadow-md backdrop-blur-xl transition-colors md:hidden",onClick:()=>g(y=>!y),children:[o.jsx("span",{className:"sr-only",children:"Toggle navigation"}),o.jsxs("div",{className:"flex flex-col gap-[3px]",children:[o.jsx("span",{className:"h-[2px] w-4 bg-white"}),o.jsx("span",{className:"h-[2px] w-4 bg-white"}),o.jsx("span",{className:"h-[2px] w-4 bg-white"})]})]})]})]}),f&&o.jsxs("div",{className:"mt-3 flex flex-col gap-2 rounded-2xl border border-white/20 bg-black/70 p-4 text-sm md:hidden",children:[o.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),s("/browse-events")},children:"Browse Events"}),o.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),s("/how-it-works")},children:"How It Works"}),o.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),s("/for-creators")},children:"For Creators"}),o.jsxs("div",{className:"mt-1 flex flex-col gap-2",children:[o.jsx("button",{type:"button",className:"w-full rounded-full border border-white/40 bg-black/60 px-4 py-2 text-center text-xs font-medium text-white hover:bg-black/80",onClick:()=>{g(!1),s("/auth")},children:"Log in"}),o.jsx("button",{type:"button",className:"w-full rounded-full bg-gradient-to-r from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] px-4 py-2 text-center text-xs font-semibold text-white shadow-md hover:shadow-[0_0_25px_rgba(192,69,255,0.8)]",onClick:()=>{g(!1),s("/auth")},children:"Sign up"})]})]}),o.jsxs(mc.div,{className:"mt-6 flex flex-col gap-8 md:mt-12 md:flex-row md:items-stretch",initial:{opacity:0,y:32},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[o.jsxs("div",{className:"flex w-full flex-col md:w-1/2 lg:w-3/5",children:[o.jsxs("div",{className:"max-w-xl space-y-6",children:[o.jsx("p",{className:"inline-block text-xl font-normal text-white/90 drop-shadow-[0_8px_30px_rgba(0,0,0,0.8)] sm:text-2xl",style:{fontFamily:"cursive"},children:"meet your favourite creators on fanmet"}),o.jsxs("h1",{className:"text-4xl font-extrabold leading-tight sm:text-5xl lg:text-6xl",children:["Live 1:1 video calls",o.jsx("span",{className:"block text-[#FACC15]",children:"with the people you actually care about."})]}),o.jsx("div",{className:"h-1 w-24 rounded-full bg-gradient-to-r from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),o.jsx("p",{className:"max-w-lg text-sm text-white/80 sm:text-base",children:"Bid in tiny live auctions to win 510 minute video hangs with creators, gamers, chefs, coaches and other internet favourites. If you don't win, you get most of your money back."}),o.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[o.jsx("button",{type:"button",onClick:()=>s("/fan"),className:"inline-flex items-center justify-center rounded-full bg-gradient-to-r from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] px-7 py-3 text-sm font-semibold text-white shadow-[0_18px_50px_rgba(0,0,0,0.7)] transition-transform duration-200 hover:-translate-y-1 hover:shadow-[0_24px_70px_rgba(192,69,255,0.9)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#E6FF00] focus-visible:ring-offset-2",children:"Explore live meets"}),o.jsxs("button",{type:"button",onClick:()=>{const y=document.getElementById("how-it-works");y&&y.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center justify-center rounded-full border border-white/40 bg-black/40 px-5 py-2.5 text-sm font-medium text-white shadow-md backdrop-blur-xl transition-transform duration-200 hover:-translate-y-0.5 hover:bg-black/70",children:[o.jsx("span",{className:"mr-2 text-base",children:""}),"How FanMeet works"]})]})]}),o.jsxs("div",{className:"mt-4 grid gap-4 text-xs text-white/80 sm:grid-cols-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#22C55E]/20 text-sm",children:""}),o.jsx("span",{children:"90% refund if you don't win the bid."})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#00D5FF]/20 text-sm",children:""}),o.jsx("span",{children:"Verified creators, safe payments, no fake profiles."})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#EC4899]/20 text-sm",children:""}),o.jsx("span",{children:"Built in India for Indian fans & creators."})]})]})]}),o.jsx(mc.div,{className:"hidden w-full h-[280px] md:block md:h-[440px] md:w-1/2 lg:h-[530px] lg:w-2/5",initial:{clipPath:"polygon(100% 0, 100% 0, 100% 100%, 100% 100%)"},animate:{clipPath:"polygon(25% 0, 100% 0, 100% 100%, 0% 100%)"},transition:{duration:1.2,ease:"circOut"},children:o.jsxs("div",{className:"h-full w-full overflow-hidden rounded-[32px] shadow-[0_28px_80px_rgba(0,0,0,0.85)]",children:[o.jsx("img",{src:Pxe,alt:"FanMeet colourful hero",className:"h-full w-full object-cover"}),o.jsx("div",{className:"hidden h-full w-full rounded-[32px] bg-gradient-to-t from-black/60 via-black/10 to-transparent md:block"})]})})]})]})]}),o.jsx("section",{id:"how-it-works",className:"bg-white px-6 py-16 md:px-16 md:py-24",children:o.jsxs("div",{className:"mx-auto max-w-6xl",children:[o.jsxs("div",{className:"mb-10 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#140423]",children:"Scroll through how FanMeet works"}),o.jsx("p",{className:"mt-2 text-base text-[#4A3B78]",children:"Cards stack as you scroll, revealing every piece of the fan-meet journey  from bidding to posting your own events."})]}),o.jsxs("div",{className:"mt-8 grid gap-6 md:grid-cols-3",children:[o.jsx(mc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#FF6B9D] via-[#FFC46B] to-[#E6FF00] p-[1px] shadow-[0_18px_45px_rgba(255,107,157,0.55)]",whileHover:{y:-12,rotateX:3,rotateY:-3},transition:{type:"spring",stiffness:220,damping:20},children:o.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[o.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#C045FF]",children:"Step 1"}),o.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"How it works"}),o.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Browse upcoming events, pick your creator, and place a bid to win a live 1:1 video call."}),o.jsx("ul",{className:"mt-4 space-y-2 text-sm text-[#4A3B78]",children:Zxe.map(y=>o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"mt-0.5 text-base",children:y.icon}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-[#140423]",children:y.title}),o.jsx("p",{className:"text-xs text-[#6C5A9C]",children:y.description})]})]},y.step))})]})}),o.jsx(mc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#FFE66B] via-[#E6FF00] to-[#00F0FF] p-[1px] shadow-[0_18px_45px_rgba(0,240,255,0.45)]",whileHover:{y:-12,rotateX:3,rotateY:3},transition:{type:"spring",stiffness:220,damping:20},children:o.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[o.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#00A3FF]",children:"Step 2"}),o.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"Featured creators"}),o.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Discover creators across categories. Tap a chip to filter the grid."}),o.jsx("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:["All","Beauty","Cosplay","Fitness","Music","Sports","Gaming"].map(y=>o.jsx("button",{type:"button",onClick:()=>a(y),className:"rounded-full px-3 py-1 font-medium transition-colors "+(n===y?"bg-[#140423] text-white":"bg-white/80 text-[#4A3B78] hover:bg-white"),children:y},y))}),o.jsx("div",{className:"mt-4 grid gap-3 text-xs text-[#4A3B78] md:grid-cols-2",children:v.slice(0,4).map(y=>o.jsxs("div",{className:"flex items-center gap-2 rounded-2xl bg-[#F8F5FF] px-3 py-2",children:[o.jsx(Mi,{initials:y.avatar,size:"sm"}),o.jsxs("div",{className:"min-w-0",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[o.jsx("p",{className:"text-xs font-semibold text-[#140423]",children:y.name}),o.jsx(Ye,{variant:"primary",className:"px-2 py-0.5 text-[9px] leading-tight",children:"Verified"})]}),o.jsxs("p",{className:"text-[11px] text-[#6C5A9C]",children:[y.category,"  ",y.followers]}),o.jsxs("p",{className:"text-[11px] text-[#C045FF]",children:["From ",y.priceRange]})]})]},y.name))})]})}),o.jsx(mc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#00F0FF] via-[#6B6BFF] to-[#C045FF] p-[1px] shadow-[0_18px_45px_rgba(107,107,255,0.55)]",whileHover:{y:-12,rotateX:-3,rotateY:3},transition:{type:"spring",stiffness:220,damping:20},children:o.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[o.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#C045FF]",children:"Step 3"}),o.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"Get verified as a creator"}),o.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Apply once, get verified, and start hosting paid or free fan meets from anywhere."}),o.jsxs("ul",{className:"mt-4 space-y-2 text-sm text-[#4A3B78]",children:[o.jsx("li",{children:" 1K+ followers or a unique skill people want to learn"}),o.jsx("li",{children:" Simple KYC & social verification by our team"}),o.jsx("li",{children:" 90% payout on every winning bid  no hidden fees"})]}),o.jsx("button",{type:"button",onClick:()=>s("/creator"),className:"mt-4 inline-flex items-center justify-center rounded-full bg-white px-4 py-2 text-xs font-semibold text-[#140423] shadow-md transition-transform hover:-translate-y-0.5",children:"Apply to get verified"})]})})]})]})}),o.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"featured",children:o.jsxs("div",{className:"mx-auto flex max-w-6xl flex-col items-center gap-10",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Who Can You Meet on FanMeet?"}),o.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"We have creators from every field!"})]}),o.jsx("div",{className:"flex w-full flex-col items-center justify-center",children:o.jsx("div",{className:"w-[250px] h-[250px] md:w-[420px] md:h-[420px] flex items-center justify-center",children:o.jsx(Dxe,{images:Qxe,containerSize:280,sphereRadius:130,autoRotate:!0,autoRotateSpeed:.35,dragSensitivity:.7,className:"mx-auto"})})})]})}),o.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#00D5FF_0,_#050014_50%),radial-gradient(circle_at_bottom,_#F97316_0,_#050014_55%)] px-6 py-16 md:px-16",children:o.jsxs("div",{className:"mx-auto max-w-6xl",children:[o.jsxs("div",{className:"mb-12 text-center",children:[o.jsx("h2",{className:"mb-4 text-3xl font-bold text-white",children:"Join Thousands of Happy Fans! "}),o.jsx("p",{className:"text-lg text-[#ADB5BD]",children:"Real numbers from real people having real conversations"})]}),o.jsx("div",{className:"grid gap-8 md:grid-cols-2 lg:grid-cols-4",children:ebe.map(y=>o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"mb-2 text-4xl font-bold text-[#FACC15]",children:y.value}),o.jsx("div",{className:"text-sm text-[#ADB5BD]",children:y.label})]},y.label))}),o.jsx("div",{className:"mt-8 grid gap-8 md:grid-cols-2 lg:grid-cols-4",children:tbe.map(y=>o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"mb-2 text-4xl font-bold text-[#22C55E]",children:y.value}),o.jsx("div",{className:"text-sm text-[#ADB5BD]",children:y.label})]},y.label))})]})}),o.jsxs("section",{className:"relative overflow-hidden bg-[#050014] px-6 py-16 text-white md:px-16 md:py-24",children:[o.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(0,213,255,0.32)_0,_transparent_55%),radial-gradient(circle_at_bottom,_rgba(236,72,153,0.32)_0,_transparent_55%)]"}),o.jsxs("div",{className:"relative z-10 mx-auto flex max-w-6xl flex-col gap-10 md:grid md:grid-cols-[minmax(0,1.1fr)_minmax(0,1.1fr)] md:items-center",children:[o.jsxs("div",{className:"space-y-4 text-left text-white",children:[o.jsx("p",{className:"inline-flex items-center rounded-full bg-white/10 px-3 py-1 text-xs font-medium uppercase tracking-[0.16em] text-[#E6FF00] backdrop-blur-md",children:"LIVE DEMO"}),o.jsx("h2",{className:"text-3xl font-extrabold leading-tight sm:text-4xl lg:text-[2.6rem]",children:"See how a real FanMeet feels in under 2 minutes"}),o.jsx("p",{className:"max-w-xl text-sm text-white/80 sm:text-base",children:"Watch a real fan bid, win, and jump into a live video call with their favourite creator. No scripts, no actors  just genuine reactions."}),o.jsxs("ul",{className:"mt-4 space-y-2 text-sm text-white/80",children:[o.jsx("li",{children:" What the bidding screen looks like in action"}),o.jsx("li",{children:" How we keep calls safe, timed, and high-quality"}),o.jsx("li",{children:" The moment a fan realises their call is actually happening"})]})]}),o.jsx("div",{className:"relative mx-auto w-full max-w-3xl",children:o.jsx("div",{className:"relative overflow-hidden rounded-[28px] bg-black/40 p-[2px] shadow-[0_20px_60px_rgba(5,0,20,0.7)]",children:o.jsx("div",{className:"relative aspect-video w-full overflow-hidden rounded-[24px] bg-black",children:l?o.jsx("iframe",{className:"h-full w-full",src:"https://www.youtube.com/embed/S5IQtZlgNC8?autoplay=1&rel=0&modestbranding=1",title:"FanMeet overview video",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):o.jsxs("button",{type:"button",onClick:()=>u(!0),className:"group relative h-full w-full",children:[o.jsx("img",{src:"https://cdn.prod.website-files.com/62c48d78ef34931f8a604ef5/67630876396363c467036ede_video-poster.webp",alt:"FanMeet overview video preview",className:"h-full w-full object-cover opacity-90 transition-opacity group-hover:opacity-100"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"}),o.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 text-center text-white",children:[o.jsxs("div",{className:"inline-flex items-center gap-3 rounded-full bg-white/10 px-4 py-2 text-xs font-medium backdrop-blur-md",children:[o.jsx("span",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-white text-sm font-semibold text-[#C045FF] shadow-lg",children:""}),o.jsx("span",{className:"text-xs sm:text-sm",children:"Play 2 min overview"})]}),o.jsx("p",{className:"max-w-md text-xs text-white/80 sm:text-sm",children:'"This feels like a private show with your favourite creator. I forgot we were on camera."  real fan'})]})]})})})})]})]}),o.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",children:o.jsxs("div",{className:"mx-auto max-w-5xl",children:[o.jsxs("div",{className:"mb-12 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Creators Love FanMeet Too"}),o.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Hear how meaningful conversations boost their community and income"})]}),o.jsx("div",{className:"grid gap-8 md:grid-cols-2",children:rbe.map(y=>o.jsxs(pe,{elevated:!0,className:"overflow-hidden border border-[#E9ECEF]",children:[o.jsx("div",{className:"relative aspect-[16/9] bg-gradient-to-br from-[#212529] via-[#343A40] to-[#212529]",children:o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsxs("span",{className:"rounded-full bg-white px-4 py-2 text-sm font-semibold text-[#C045FF] shadow",children:[" ",y.duration]})})}),o.jsxs(be,{className:"flex flex-col gap-4 p-6",children:[o.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:y.name}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["",y.quote,""]})]})]},y.name))})]})}),o.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-16 md:px-16",children:o.jsxs("div",{className:"mx-auto max-w-6xl",children:[o.jsxs("div",{className:"mb-10 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Real FanMeets"}),o.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Real moments and reactions captured from live FanMeet calls."})]}),o.jsx("div",{className:"flex flex-col gap-6 md:gap-8",children:Array.from({length:6}).map((y,w)=>{const T=l7[w%l7.length],S=u7[w%u7.length],I=d7[w%d7.length];return o.jsx(hbe,{titleComponent:o.jsxs("div",{className:"mt-6 md:mt-0",children:[o.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:["Real FanMeet #",w+1]}),o.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:T.context})]}),children:o.jsx("div",{className:"flex h-full",children:o.jsxs("div",{className:"flex h-full flex-col md:flex-row gap-4 rounded-2xl bg-white p-3 md:p-4 shadow-md border border-[#F1F3F5] w-full",children:[o.jsx("div",{className:"w-full md:w-1/2",children:o.jsx("div",{className:"h-full w-full overflow-hidden rounded-xl",children:o.jsx("img",{src:I,alt:T.context,className:"h-full w-full object-cover"})})}),o.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:"Full Review"}),o.jsxs("p",{className:"mt-2 text-sm font-semibold text-[#212529]",children:["",S.quote,""]})]}),o.jsxs("div",{className:"mt-3 flex flex-col gap-1 text-xs text-[#6C757D]",children:[o.jsx("span",{className:"font-semibold text-[#212529]",children:S.name}),o.jsx("span",{children:S.met}),o.jsxs("span",{className:"text-[11px] text-[#868E96]",children:["Moment: ",T.context]}),o.jsx("span",{className:"flex items-center gap-1 text-[#C045FF]",children:"".split("").map((j,B)=>o.jsx("span",{children:j},`${T.id}-star-${B}`))})]})]})]})})},`${T.id}-scroll-${w}`)})})]})}),o.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"trust",children:o.jsxs("div",{className:"mx-auto max-w-6xl",children:[o.jsxs("div",{className:"mb-10 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Trust Comes First"}),o.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"We built FanMeet to be safe, secure, and fan-friendly from day one."})]}),o.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-4",children:sbe.map(y=>o.jsx(pe,{elevated:!0,className:"h-full border border-[#F1F3F5]",children:o.jsxs(be,{className:"flex h-full flex-col gap-4 p-6",children:[o.jsxs("div",{className:"flex items-center gap-3 text-[#C045FF]",children:[o.jsx("span",{className:"text-2xl",children:y.icon}),o.jsx("span",{className:"text-sm font-semibold uppercase tracking-wide text-[#6C757D]",children:y.badge})]}),o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.title}),o.jsx("ul",{className:"space-y-2 text-sm text-[#6C757D]",children:y.bullets.map(w=>o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"text-[#C045FF]",children:""}),o.jsx("span",{children:w})]},w))})]})},y.title))})]})}),o.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#ECFEFF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"pricing",children:o.jsxs("div",{className:"mx-auto max-w-6xl",children:[o.jsxs("div",{className:"mb-12 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Two Ways to Meet Your Heroes"}),o.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Whether you want to bid or try your luck, FanMeet keeps it fair and transparent."})]}),o.jsx("div",{className:"grid gap-8 md:grid-cols-2",children:nbe.map(y=>o.jsxs(pe,{elevated:!0,className:"border border-[#E9ECEF] bg-white",children:[o.jsx(Ne,{title:y.title,subtitle:y.description,className:"border-b border-[#F1F3F5]"}),o.jsxs(be,{className:"flex flex-col gap-4 p-6",children:[o.jsx("ul",{className:"space-y-3 text-sm text-[#212529]",children:y.highlights.map(w=>o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"text-[#C045FF]",children:""}),o.jsx("span",{children:w})]},w))}),o.jsx("p",{className:"rounded-[14px] bg-[#FFF3ED] p-4 text-sm text-[#6C757D]",children:y.story}),o.jsx(ue,{className:"mt-2 w-full",variant:"secondary",children:y.cta})]})]},y.title))})]})}),o.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"team",children:o.jsxs("div",{className:"mx-auto max-w-6xl",children:[o.jsx("div",{className:"mb-8 text-center",children:o.jsx("h2",{className:"text-3xl font-bold tracking-[0.25em] text-[#212529]",children:"ABOUT US"})}),o.jsx(Jxe,{testimonials:abe,autoplay:!0})]})}),o.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"faq",children:o.jsxs("div",{className:"mx-auto max-w-5xl",children:[o.jsxs("div",{className:"mb-10 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Questions? We Already Answered Them."}),o.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Everything fans and creators ask before hitting that Bid or Apply button."})]}),o.jsx("div",{className:"flex flex-col gap-4",children:obe.map(y=>o.jsxs("details",{className:"group rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[o.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between gap-4 text-left text-sm font-semibold text-[#212529]",children:[o.jsxs("span",{className:"text-[#C045FF]",children:["[",y.category,"]"]}),o.jsx("span",{className:"flex-1 text-[#212529]",children:y.question}),o.jsx("span",{className:"text-[#ADB5BD] transition-transform group-open:rotate-45",children:"+"})]}),o.jsx("p",{className:"mt-3 text-sm text-[#6C757D]",children:y.answer})]},`${y.category}-${y.question}`))})]})}),o.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#00D5FF_0,_#050014_50%),radial-gradient(circle_at_bottom,_#EC4899_0,_#050014_55%)] px-6 py-20 text-white md:px-16",id:"press",children:o.jsxs("div",{className:"mx-auto max-w-6xl",children:[o.jsxs("div",{className:"mb-10 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold",children:"People Are Talking About FanMeet"}),o.jsx("p",{className:"mt-2 text-base text-[#CED4DA]",children:"Press features, creator shoutouts, and community buzz."})]}),o.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:cbe.map(y=>o.jsx(pe,{className:"border border-[#343A40] bg-[#2C3036]",children:o.jsxs(be,{className:"flex flex-col gap-3 p-6",children:[o.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:y.type==="press"?"As Seen In":"From the Community"}),o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.name}),o.jsx("p",{className:"text-sm text-[#212529]",children:y.quote}),o.jsx(ue,{variant:"ghost",className:"self-start px-0 text-sm text-[#C045FF]",children:"Read more "})]})},`${y.type}-${y.name}`))})]})}),o.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#ECFEFF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"comparison",children:o.jsxs("div",{className:"mx-auto max-w-5xl",children:[o.jsxs("div",{className:"mb-8 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Why FanMeet Beats DMs and Cameo"}),o.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"The only place for real, two-way conversations with creators you admire."})]}),o.jsx("div",{className:"overflow-x-auto rounded-[18px] border border-[#E9ECEF]",children:o.jsxs("table",{className:"min-w-full divide-y divide-[#E9ECEF]",children:[o.jsx("thead",{className:"bg-[#F8F9FA] text-sm uppercase tracking-wide text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-4 py-3 text-left",children:"Feature"}),o.jsx("th",{className:"px-4 py-3 text-left text-[#C045FF]",children:"FanMeet"}),o.jsx("th",{className:"px-4 py-3 text-left",children:"Commenting"}),o.jsx("th",{className:"px-4 py-3 text-left",children:"Paid Shoutouts"})]})}),o.jsx("tbody",{className:"divide-y divide-[#F1F3F5] text-sm text-[#212529]",children:lbe.map(y=>o.jsxs("tr",{className:"bg-white",children:[o.jsx("td",{className:"px-4 py-3 font-medium text-[#212529]",children:y.feature}),o.jsx("td",{className:"px-4 py-3 text-[#20C997]",children:y.fanmeet}),o.jsx("td",{className:"px-4 py-3 text-[#6C757D]",children:y.social}),o.jsx("td",{className:"px-4 py-3 text-[#6C757D]",children:y.cameo})]},y.feature))})]})}),o.jsx("p",{className:"mt-6 text-center text-sm text-[#6C757D]",children:"FanMeet is the only place to have a REAL conversation with creators you admire."})]})}),o.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#FFF7ED_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"success-stories",children:o.jsxs("div",{className:"mx-auto max-w-5xl",children:[o.jsxs("div",{className:"mb-10 text-center",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Three Stories You Will Brag About Later"}),o.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Real transformations from fans who hit Bid and never looked back."})]}),o.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:dbe.map(y=>o.jsx(pe,{elevated:!0,className:"border border-[#E9ECEF]",children:o.jsxs(be,{className:"flex h-full flex-col gap-3 p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.title}),o.jsxs("div",{className:"space-y-2 text-sm text-[#6C757D]",children:[o.jsxs("p",{children:[o.jsx("span",{className:"font-semibold text-[#212529]",children:"Before:"})," ",y.before]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-semibold text-[#212529]",children:"During:"})," ",y.during]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-semibold text-[#212529]",children:"After:"})," ",y.after]})]})]})},y.title))})]})}),o.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",children:o.jsxs("div",{className:"mx-auto max-w-4xl rounded-[24px] border border-[#F1F3F5] bg-[radial-gradient(circle_at_top,_#FDF2EC_0,_#FFFFFF_70%)] p-10 text-center shadow-[var(--shadow-lg)]",children:[o.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Ready to Meet Your Hero?"}),o.jsx("p",{className:"mt-3 text-base text-[#6C757D]",children:"Join 1,247 people who already had life-changing conversations."}),o.jsxs("div",{className:"mt-6 flex flex-wrap justify-center gap-4",children:[o.jsx(ue,{size:"lg",className:"px-8 text-base",children:"Browse Events & Start Bidding "}),o.jsx(ue,{size:"lg",variant:"secondary",className:"px-8 text-base",children:"Apply to Become a Creator "})]}),o.jsxs("div",{className:"mt-6 grid gap-3 md:grid-cols-2",children:[o.jsx("div",{className:"rounded-[16px] bg-white p-4 text-sm text-[#6C757D]",children:"I bid 280, won the call, and my creator remembered me on stream a week later.  Neeraj, Pune"}),o.jsx("div",{className:"rounded-[16px] bg-white p-4 text-sm text-[#6C757D]",children:"Applications took 2 minutes. I now run weekly coaching calls and finally understand my fans.  Ananya, Creator"})]}),o.jsxs("div",{className:"mt-6 flex flex-wrap justify-center gap-4 text-xs text-[#6C757D]",children:[o.jsx("span",{children:" 90% Refund Guarantee"}),o.jsx("span",{children:" Verified Creators Only"}),o.jsx("span",{children:" Secure Payments"}),o.jsx("span",{children:" 24/7 Support"})]})]})}),o.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-16 text-white md:px-16",children:o.jsxs("div",{className:"mx-auto max-w-6xl",children:[o.jsxs("div",{className:"grid gap-10 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,3fr)]",children:[o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-[#C045FF]",children:"FanMeet"}),o.jsx("p",{className:"mt-2 text-sm text-[#ADB5BD]",children:Wh.fanmeet.tagline})]}),o.jsx("div",{className:"flex flex-wrap items-center gap-3 text-sm text-[#ADB5BD]",children:ube.map(y=>o.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:y},y))}),o.jsx("div",{className:"flex flex-wrap gap-3 text-sm text-[#ADB5BD]",children:Wh.fanmeet.socials.map(y=>o.jsxs(ue,{variant:"ghost",className:"px-0 text-sm text-[#ADB5BD]",children:[y.label," "]},y.label))})]}),o.jsxs("div",{className:"grid gap-8 sm:grid-cols-2 lg:grid-cols-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:"For Fans"}),o.jsx("ul",{className:"mt-3 space-y-2 text-sm text-[#ADB5BD]",children:Wh.fans.map(y=>o.jsx("li",{children:y.label},y.label))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:"For Creators"}),o.jsx("ul",{className:"mt-3 space-y-2 text-sm text-[#ADB5BD]",children:Wh.creators.map(y=>o.jsx("li",{children:y.label},y.label))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:"Company"}),o.jsx("ul",{className:"mt-3 space-y-2 text-sm text-[#ADB5BD]",children:Wh.company.map(y=>o.jsx("li",{children:y.label},y.label))})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:"Support"}),o.jsx("ul",{className:"mt-3 space-y-2 text-sm text-[#ADB5BD]",children:Wh.support.map(y=>o.jsx("li",{children:y.label},y.label))})]})]})]}),o.jsxs("div",{className:"mt-10 border-t border-[#343A40] pt-6 text-center text-xs text-[#6C757D]",children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})]})})]})}const gbe=[{title:"300+ creators onboarded",description:"Host exclusive AMA sessions, workshops, and meet & greets."},{title:"10k+ fan requests",description:"Fans are lining up for authentic, small-group interactions."}];function _be(){const[s,n]=L.useState("login"),[a,l]=L.useState("fan"),[u,f]=L.useState(""),[g,v]=L.useState(""),[y,w]=L.useState(""),[T,S]=L.useState(!1),I=Fs(),[j]=Yg(),{login:B,signup:A,isAuthenticated:F,user:D}=mr();L.useEffect(()=>{F&&D&&I({fan:"/fan",creator:"/creator",admin:"/admin"}[D.role],{replace:!0})},[F,D,I]);const R=async O=>{if(O.preventDefault(),!u.trim()||!g.trim()){w("Please enter both email and password.");return}w(""),S(!0);try{const V={fan:"/fan",creator:"/creator",admin:"/admin"},G=s==="signup"?await A({email:u,password:g,role:a}):await B({email:u,password:g}),J=j.get("redirect"),$=V[G.role],q=J&&J.trim().length>0?J:$;I(q,{replace:!0})}catch(V){V instanceof Error?w(V.message):w("Something went wrong. Please try again.")}finally{S(!1)}};return o.jsxs("div",{className:"grid min-h-[calc(100vh-70px)] grid-cols-1 bg-gradient-to-b from-white to-[#F8F0FF] md:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]",children:[o.jsxs("section",{className:"relative hidden h-full w-full items-start justify-start bg-gradient-to-br from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] px-10 py-9 text-[#050014] md:flex",children:[o.jsxs("div",{className:"relative z-10 mx-auto flex max-w-xl flex-col gap-6",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-4 py-1 text-sm font-medium tracking-wide text-[#C045FF]",children:[o.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"})," LIVE MOMENTS  REAL CONNECTIONS"]}),o.jsx("h1",{className:"text-2xl font-bold leading-tight text-[#050014] md:text-3xl lg:text-4xl",children:"Bring creators and fans together through premium digital meetups"}),o.jsx("p",{className:"text-xs text-[#4B445F] md:text-sm lg:text-base",children:"Secure bidding, curated events, and rich creator tooling packaged in one vibrant platform."})]}),o.jsxs("div",{className:"hidden xl:flex xl:flex-col xl:gap-4",children:[o.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:gbe.map(O=>o.jsx(pe,{className:"bg-white/10 backdrop-blur-md transition hover:bg-white/20",elevated:!0,children:o.jsxs("div",{className:"flex flex-col gap-2 p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-[#050014]",children:O.title}),o.jsx("p",{className:"text-sm text-[#4B445F]",children:O.description})]})},O.title))}),o.jsxs("div",{className:"relative mt-2",children:[o.jsx("img",{src:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=1200&q=80",alt:"Creators collaborating",className:"h-36 w-full rounded-3xl object-cover shadow-2xl shadow-[#C045FF]/40"}),o.jsx("div",{className:"absolute bottom-2 left-1/2 w-[85%] -translate-x-1/2 rounded-2xl bg-white/95 p-3 shadow-xl shadow-[#C045FF]/15",children:o.jsxs("div",{className:"flex items-center gap-2.5",children:[o.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-[#C045FF]/10 text-2xl",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:"Creator Spotlight"}),o.jsx("p",{className:"text-sm text-[#212529]",children:"My fans love our micro-meet sessionsit feels personal and seamless."})]})]})})]})]})]}),o.jsx("div",{className:"absolute right-0 top-0 h-full w-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"})]}),o.jsx("section",{className:"flex items-start justify-center px-4 py-4 md:px-6 md:py-4",children:o.jsxs("div",{className:"flex w-full max-w-md flex-col gap-4 md:gap-3.5",children:[o.jsxs("div",{className:"flex flex-col gap-1.5 text-center md:text-left",children:[o.jsx(Rl,{to:"/",className:"text-sm font-semibold text-[#C045FF]",children:" Back to home"}),o.jsx("h2",{className:"text-2xl font-bold text-[#212529] md:text-3xl",children:s==="login"?"Welcome back":"Create your FanMeet account"}),o.jsx("p",{className:"hidden text-sm text-[#6C757D] lg:block",children:s==="login"?"Sign in to manage your events, track bids, and stay close to your community.":"Sign up once to access your fan or creator dashboard and manage all your sessions."})]}),o.jsxs("form",{className:"flex flex-col gap-3",onSubmit:R,children:[o.jsxs("div",{className:"flex items-center justify-between rounded-full bg-[#F1F3F5] p-1 text-xs font-medium text-[#495057]",children:[o.jsx("button",{type:"button",onClick:()=>{n("login"),w("")},className:Kd("flex-1 rounded-full px-3 py-1.5 transition-all",s==="login"?"bg-white text-[#212529] shadow-sm":"bg-transparent"),children:"Log in"}),o.jsx("button",{type:"button",onClick:()=>{n("signup"),w("")},className:Kd("flex-1 rounded-full px-3 py-1.5 transition-all",s==="signup"?"bg-white text-[#212529] shadow-sm":"bg-transparent"),children:"Sign up"})]}),o.jsx("div",{className:"flex flex-col gap-1.5",children:s==="signup"&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-sm font-medium text-[#212529]",children:"Sign up as"}),o.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"Fan",value:"fan",emoji:""},{label:"Creator",value:"creator",emoji:""}].map(O=>o.jsxs("button",{type:"button",onClick:()=>l(O.value),className:Kd("flex items-center gap-2.5 rounded-[14px] border-2 px-3.5 py-2.5 text-left transition-all","shadow-[var(--shadow-sm)] hover:shadow-[var(--shadow-md)]",a===O.value?"border-[#C045FF] bg-[#F4E6FF] text-[#212529]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"),children:[o.jsx("span",{className:"text-lg",children:O.emoji}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[13px] font-semibold",children:O.label}),o.jsxs("p",{className:"text-[11px] text-[#6C757D]",children:[O.value==="fan"&&"Bid, join meets, and manage your sessions.",O.value==="creator"&&"Host immersive experiences and track earnings."]})]})]},O.value))})]})}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx(nt,{label:"Email",placeholder:"you@example.com",type:"email",required:!0,value:u,onChange:O=>f(O.target.value)}),o.jsx(nt,{label:"Password",placeholder:"Enter your password",type:"password",required:!0,value:g,onChange:O=>v(O.target.value)}),o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("label",{className:"flex items-center gap-2 text-[#6C757D]",children:[o.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Remember me"]}),o.jsx(Rl,{to:"#",className:"font-medium text-[#C045FF] hover:text-[#8B3FFF]",children:"Forgot password?"})]})]}),y?o.jsx("p",{className:"text-[11px] font-medium text-[#DC3545]",children:y}):null,o.jsx(ue,{type:"submit",size:"md",className:"h-9 text-[13px]",children:"Continue with email"}),o.jsxs("div",{className:"flex items-center gap-2.5",children:[o.jsx("span",{className:"h-px flex-1 bg-[#E9ECEF]"}),o.jsx("span",{className:"text-sm font-medium text-[#6C757D]",children:"or"}),o.jsx("span",{className:"h-px flex-1 bg-[#E9ECEF]"})]}),o.jsxs("div",{className:"grid gap-2",children:[o.jsx(ue,{variant:"secondary",size:"md",className:"h-9 text-[13px]",children:"Continue with Google"}),o.jsx(ue,{variant:"ghost",size:"md",className:"h-9 text-[13px]",children:"Continue with Apple"})]})]}),o.jsxs("p",{className:"hidden text-xs text-[#ADB5BD] lg:block",children:["By continuing, you agree to our"," ",o.jsx(Rl,{to:"#",className:"font-medium text-[#C045FF]",children:"Terms of Service"})," ","and"," ",o.jsx(Rl,{to:"#",className:"font-medium text-[#C045FF]",children:"Privacy Policy"}),"."]})]})})]})}function Ebe(){const{login:s,isAuthenticated:n,user:a,logout:l}=mr(),[u,f]=L.useState(""),[g,v]=L.useState(""),[y,w]=L.useState(""),[T,S]=L.useState(!1),I=Fs();L.useEffect(()=>{n&&(a==null?void 0:a.role)==="admin"&&I("/admin",{replace:!0})},[n,a,I]);const j=async B=>{if(B.preventDefault(),!u.trim()||!g.trim()){w("Please enter both email and password.");return}w(""),S(!0);try{if((await s({email:u,password:g})).role!=="admin"){w("This account is not an admin."),await l();return}I("/admin",{replace:!0})}catch(A){A instanceof Error?w(A.message):w("Something went wrong. Please try again.")}finally{S(!1)}};return o.jsxs("div",{className:"grid min-h-[calc(100vh-70px)] grid-cols-1 bg-gradient-to-b from-white to-[#F8F0FF] md:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]",children:[o.jsxs("section",{className:"relative hidden h-full w-full items-start justify-start bg-gradient-to-br from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] px-10 py-9 text-[#050014] md:flex",children:[o.jsx("div",{className:"relative z-10 mx-auto flex max-w-xl flex-col gap-6",children:o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-4 py-1 text-sm font-medium tracking-wide text-[#C045FF]",children:[o.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"})," ADMIN ACCESS"]}),o.jsx("h1",{className:"text-2xl font-bold leading-tight text-[#050014] md:text-3xl lg:text-4xl",children:"Sign in to your FanMeet admin console"}),o.jsx("p",{className:"text-xs text-[#4B445F] md:text-sm lg:text-base",children:"Manage creators, fans, events, payouts, and platform settings from a single secure dashboard."})]})}),o.jsx("div",{className:"absolute right-0 top-0 h-full w-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"})]}),o.jsx("section",{className:"flex items-start justify-center px-4 py-4 md:px-6 md:py-4",children:o.jsxs("div",{className:"flex w-full max-w-md flex-col gap-4 md:gap-3.5",children:[o.jsxs("div",{className:"flex flex-col gap-1.5 text-center md:text-left",children:[o.jsx(Rl,{to:"/",className:"text-sm font-semibold text-[#C045FF]",children:" Back to home"}),o.jsx("h2",{className:"text-2xl font-bold text-[#212529] md:text-3xl",children:"Admin sign in"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Use your admin credentials to access the platform controls."})]}),o.jsxs("form",{className:"flex flex-col gap-3",onSubmit:j,children:[o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx(nt,{label:"Admin email",placeholder:"you@company.com",type:"email",required:!0,value:u,onChange:B=>f(B.target.value)}),o.jsx(nt,{label:"Password",placeholder:"Enter your password",type:"password",required:!0,value:g,onChange:B=>v(B.target.value)})]}),y?o.jsx("p",{className:"text-[11px] font-medium text-[#DC3545]",children:y}):null,o.jsx(ue,{type:"submit",size:"md",className:"h-9 text-[13px]",disabled:T,children:T?"Signing in":"Sign in as admin"}),o.jsx(pe,{className:"mt-2 border-[#FFE5D9] bg-[#FFF8F3] p-3 text-xs text-[#6C757D]",children:"Admin access is restricted. If you believe you should have access, contact the platform owner."})]})]})})]})}const BH=L.createContext(void 0);function vbe(s,n){return!s&&!n?"":s?n?`${s}   ${n}`:s:n}const ybe=({children:s})=>{const[n,a]=L.useState([]),[l,u]=L.useState([]),[f,g]=L.useState([]),[v,y]=L.useState([]),[w,T]=L.useState(!0),{user:S}=mr();L.useEffect(()=>{(async()=>{const{data:q,error:ee}=await ie.from("events").select("*");if(ee){console.error("Error fetching events:",ee);return}if(!q)return;const{data:ne}=await ie.from("bids").select("*"),de=q.map(De=>De.creator_id),{data:me}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",de),ve=new Map((me==null?void 0:me.map(De=>[De.user_id,De]))||[]),_e=q.map(De=>{const Xe=(ne==null?void 0:ne.filter(Ze=>Ze.event_id===De.id))||[],Oe=Xe.length>0?Math.max(...Xe.map(Ze=>Ze.amount)):0,ae=new Set(Xe.map(Ze=>Ze.fan_id)).size,Ee=new Date(De.starts_at),Le=new Date,He=(De.bidding_closes_at?new Date(De.bidding_closes_at):Ee).getTime()-Le.getTime();let gt="Bidding Closed";if(He>0){const Ze=Math.floor(He/36e5);Ze>24?gt=`${Math.floor(Ze/24)} days left to bid`:Ze>0?gt=`${Ze} hours left to bid`:gt=`${Math.floor(He/6e4)} minutes left to bid`}const yt=Ee.toLocaleDateString(),It=Ee.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Ct=ve.get(De.creator_id),et=((Ct==null?void 0:Ct.username)||`user${De.creator_id.substring(0,8)}`).toLowerCase();let We;return De.status==="completed"||De.status==="cancelled"?We="Completed":De.bidding_closes_at&&new Date(De.bidding_closes_at)>Le?We="Accepting Bids":De.status==="live"?We="LIVE":We="Upcoming",{id:De.id,creatorUsername:et,creatorDisplayName:(Ct==null?void 0:Ct.display_name)||"Unknown",title:De.title,description:De.description,category:De.category||"general",status:We,date:`${yt} @ ${It}`,duration:`${De.duration_minutes} minutes`,basePrice:De.base_price,currentBid:Math.max(De.base_price,Oe),participants:ae,endsIn:gt}});a(_e),T(!1)})()},[]),L.useEffect(()=>{if(!S){u([]),g([]);return}(async()=>{const{data:q,error:ee}=await ie.from("bids").select("*").eq("fan_id",S.id);if(!ee&&q){const me=q.map(ae=>ae.event_id),{data:ve}=await ie.from("events").select("id, title, creator_id").in("id",me),_e=new Map((ve==null?void 0:ve.map(ae=>[ae.id,ae]))||[]),De=Array.from(new Set((ve??[]).map(ae=>ae.creator_id).filter(Boolean))),{data:Xe}=De.length?await ie.from("profiles").select("user_id, username").in("user_id",De):{data:null},Oe=new Map((Xe??[]).map(ae=>[ae.user_id,ae.username]));u(q.map(ae=>{const Ee=_e.get(ae.event_id),Le=Ee?Oe.get(Ee.creator_id):void 0;return{id:ae.id,eventId:ae.event_id,amount:ae.amount,status:ae.status,createdAt:ae.created_at,eventTitle:Ee==null?void 0:Ee.title,creatorUsername:Le}}))}else ee&&console.error("Error fetching bids:",ee);const{data:ne,error:de}=await ie.from("meets").select("*").eq("fan_id",S.id).in("status",["scheduled","live","completed"]);if(!de&&ne){const me=ne.map(De=>De.creator_id),{data:ve}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",me),_e=new Map((ve==null?void 0:ve.map(De=>[De.user_id,De]))||[]);g(ne.map(De=>{const Xe=_e.get(De.creator_id);return{id:De.id,eventId:De.event_id,creatorId:De.creator_id,creatorUsername:(Xe==null?void 0:Xe.username)||"unknown",creatorDisplayName:(Xe==null?void 0:Xe.display_name)||"Unknown",scheduledAt:De.scheduled_at,durationMinutes:De.duration_minutes,meetingLink:De.meeting_link,status:De.status}}))}else de&&console.error("Error fetching meets:",de)})()},[S]);const I=async $=>{if(!S)throw new Error("User not logged in");const q=new Date(`${$.date}T${$.time}`).toISOString(),ee=new Date(`${$.biddingDeadlineDate}T${$.biddingDeadlineTime}`).toISOString(),ne=parseInt($.duration.replace(/\D/g,""),10)||15,{data:de,error:me}=await ie.from("events").insert({creator_id:S.id,title:$.title,description:$.description,status:"upcoming",starts_at:q,bidding_closes_at:ee,duration_minutes:ne,base_price:$.basePrice,is_paid:$.basePrice>0,meeting_link:$.meetingLink}).select().single();if(me)throw console.error("Error creating event:",me),me;const ve={id:de.id,creatorUsername:S.username.toLowerCase(),creatorDisplayName:$.creatorDisplayName,title:de.title,description:de.description,status:"Upcoming",date:vbe($.date,$.time),duration:$.duration,basePrice:de.base_price,currentBid:0,participants:0,endsIn:"Bid ding open"};return a(_e=>[..._e,ve]),ve},j=$=>{const q=$.trim().replace(/^@/,"").toLowerCase();return n.filter(ee=>ee.creatorUsername===q)},B=$=>{if(!S)return 0;const q=l.filter(ee=>ee.eventId===$&&ee.status==="active");return q.length===0?0:Math.max(...q.map(ee=>ee.amount))},A=async $=>{const{data:q,error:ee}=await ie.from("bids").select("id, fan_id, amount, created_at").eq("event_id",$).order("created_at",{ascending:!1}).limit(5);if(ee||!q)return console.error("Error fetching bid history:",ee),[];const ne=q.map(De=>De.fan_id),{data:de}=await ie.from("profiles").select("user_id, username").in("user_id",ne),me=new Map((de==null?void 0:de.map(De=>[De.user_id,De.username]))||[]),ve=q.length>0?Math.max(...q.map(De=>De.amount)):0,_e=q.map(De=>({id:De.id,fanId:De.fan_id,fanUsername:me.get(De.fan_id)||"Anonymous",amount:De.amount,createdAt:De.created_at,isCurrentLeader:De.amount===ve}));return y(_e),_e},F=async($,q)=>{if(!q||Number.isNaN(q))return;if(!S)throw console.error("User must be logged in to bid"),new Error("Please log in to place a bid");const{error:ee}=await ie.from("bids").insert({event_id:$,fan_id:S.id,amount:q,status:"active"});if(ee)throw console.error("Error placing bid:",ee),new Error("Failed to place bid. Please try again.");a(ne=>ne.map(de=>de.id!==$||q<=de.currentBid?de:{...de,currentBid:q,participants:de.participants+1})),await R(),await A($)},D=async($,q,ee)=>{if(!(!q||Number.isNaN(q)))throw S?new Error(`PAYMENT_REQUIRED:${q}:${$}`):new Error("Please log in to place a bid")},R=async()=>{if(!S)return;const{data:$}=await ie.from("bids").select("*").eq("fan_id",S.id);if($){const q=$.map(_e=>_e.event_id),{data:ee}=await ie.from("events").select("id, title, creator_id").in("id",q),ne=new Map((ee==null?void 0:ee.map(_e=>[_e.id,_e]))||[]),de=Array.from(new Set((ee??[]).map(_e=>_e.creator_id).filter(Boolean))),{data:me}=de.length?await ie.from("profiles").select("user_id, username").in("user_id",de):{data:null},ve=new Map((me??[]).map(_e=>[_e.user_id,_e.username]));u($.map(_e=>{const De=ne.get(_e.event_id),Xe=De?ve.get(De.creator_id):void 0;return{id:_e.id,eventId:_e.event_id,amount:_e.amount,status:_e.status,createdAt:_e.created_at,eventTitle:De==null?void 0:De.title,creatorUsername:Xe}}))}},O=async($,q)=>{const{error:ee}=await ie.from("meets").update({status:q}).eq("id",$);if(ee)throw console.error("Error updating meet status:",ee),ee;await V()},V=async()=>{if(!S)return;const{data:$,error:q}=await ie.from("meets").select("*").eq("fan_id",S.id).in("status",["scheduled","live","completed"]);if(!q&&$){const ee=$.map(me=>me.creator_id),{data:ne}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",ee),de=new Map((ne==null?void 0:ne.map(me=>[me.user_id,me]))||[]);g($.map(me=>{const ve=de.get(me.creator_id);return{id:me.id,eventId:me.event_id,creatorId:me.creator_id,creatorUsername:(ve==null?void 0:ve.username)||"unknown",creatorDisplayName:(ve==null?void 0:ve.display_name)||"Unknown",scheduledAt:me.scheduled_at,durationMinutes:me.duration_minutes,meetingLink:me.meeting_link,status:me.status,creatorStartedAt:me.creator_started_at,creatorJoinedAt:me.creator_joined_at,fanJoinedAt:me.fan_joined_at,recordingStartedAt:me.recording_started_at,recordingStoppedAt:me.recording_stopped_at}}))}};L.useEffect(()=>{if(!S||S.role!=="fan")return;const $=ie.channel(`fan-meets-${S.id}`).on("postgres_changes",{event:"*",schema:"public",table:"meets",filter:`fan_id=eq.${S.id}`},q=>{console.log(" Realtime meets update for fan:",q),V()}).subscribe();return()=>{ie.removeChannel($)}},[S]);const G=async $=>{if(!S)return;const{data:q,error:ee}=await ie.from("events").select("*").eq("id",$).single();if(ee||!q)throw console.error("Error fetching event to finalize:",ee),new Error("Event not found");const{data:ne,error:de}=await ie.from("bids").select("*").eq("event_id",$).eq("status","active").order("amount",{ascending:!1}).limit(1);if(de)throw console.error("Error fetching winning bid:",de),new Error("Could not determine winner");const me=ne&&ne.length>0?ne[0]:null;if(!me&&q.is_paid&&console.log("No bids for event, closing without meet."),me){const{error:_e}=await ie.from("meets").insert({event_id:$,creator_id:S.id,fan_id:me.fan_id,scheduled_at:q.starts_at,duration_minutes:q.duration_minutes,meeting_link:q.meeting_link,status:"scheduled"});if(_e)throw console.error("Error creating meet:",_e),new Error("Failed to create meet")}const{error:ve}=await ie.from("events").update({status:"completed"}).eq("id",$);ve&&console.error("Error updating event status:",ve),await V()},J=L.useMemo(()=>({events:n,myBids:l,myMeets:f,bidHistory:v,isLoading:w,createEvent:I,getEventsForCreator:j,placeBid:F,placeBidWithPayment:D,updateMeetStatus:O,refreshMeets:V,getBidHistory:A,getUserCurrentBidForEvent:B,finalizeEvent:G}),[n,l,f,v,w]);return L.useEffect(()=>{if(!S||S.role!=="creator")return;const $=async()=>{const{data:ee}=await ie.from("events").select("id, title").eq("creator_id",S.id).in("status",["upcoming","live"]).lt("bidding_closes_at",new Date().toISOString());if(ee&&ee.length>0){console.log(" Auto-finalizing expired events:",ee);for(const ne of ee)try{await G(ne.id),console.log(` Auto-finalized event: ${ne.title}`)}catch(de){console.error(` Failed to auto-finalize event ${ne.id}:`,de)}}},q=setInterval($,3e4);return $(),()=>clearInterval(q)},[S]),L.useEffect(()=>{if(!S)return;const $=async()=>{const{data:ee,error:ne}=await ie.from("meets").select("id, scheduled_at, duration_minutes").eq("status","live");if(ne||!ee)return;const de=new Date,me=ee.filter(ve=>{const _e=new Date(new Date(ve.scheduled_at).getTime()+ve.duration_minutes*60*1e3);return de>_e});if(me.length>0){console.log(" Auto-completing expired meetings:",me.length);for(const ve of me)await ie.from("meets").update({status:"completed"}).eq("id",ve.id);V()}},q=setInterval($,3e4);return $(),()=>clearInterval(q)},[S]),o.jsx(BH.Provider,{value:J,children:s})},qo=()=>{const s=L.useContext(BH);if(!s)throw new Error("useEvents must be used within an EventProvider");return s},Ay=20;function xbe(){const s=Fs(),[n,a]=Yg(),{events:l,isLoading:u}=qo(),f=n.get("q")||"",[g,v]=L.useState(parseInt(n.get("page")||"1",10)),y=L.useMemo(()=>{if(!f)return l;const A=f.toLowerCase();return l.filter(F=>{var D,R;return F.creatorDisplayName.toLowerCase().includes(A)||F.title.toLowerCase().includes(A)||((D=F.category)==null?void 0:D.toLowerCase().includes(A))||((R=F.description)==null?void 0:R.toLowerCase().includes(A))})},[l,f]),w=Math.ceil(y.length/Ay),T=(g-1)*Ay,S=y.slice(T,T+Ay),I=y.length>Ay,j=A=>{v(A);const F=new URLSearchParams(n);A>1?F.set("page",String(A)):F.delete("page"),a(F,{replace:!0}),window.scrollTo({top:0,behavior:"smooth"})},B=A=>{const F=new URLSearchParams;A&&F.set("q",A),a(F,{replace:!0}),v(1)};return u?o.jsx("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"text-4xl mb-4",children:""}),o.jsx("p",{className:"text-[#6C757D]",children:"Loading events..."})]})}):o.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[o.jsxs("section",{className:"space-y-4",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Browse Events"}),o.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Explore live and upcoming FanMeet events."}),o.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"This is a public browse page so fans can get a feel for the experience before creating an account. When you are ready to bid or join, you can sign up in a single step."})]}),o.jsx("section",{children:o.jsxs("div",{className:"relative max-w-md",children:[o.jsx("input",{type:"text",placeholder:"Search events or creators...",value:f,onChange:A=>B(A.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),o.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]})}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("p",{className:"text-sm text-[#6C757D]",children:[y.length," ",y.length===1?"event":"events"," found",I&&` (showing ${S.length} on page ${g})`]}),f&&o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>B(""),children:"Clear Search"})]}),o.jsx("section",{className:"grid gap-6 md:grid-cols-2",children:S.length>0?S.map(A=>o.jsxs(pe,{elevated:!0,className:"flex h-full flex-col overflow-hidden p-0 cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>s(`/events/${A.id}`),children:[o.jsx("div",{className:"relative h-36 w-full flex-shrink-0 bg-gradient-to-br from-[#FCE7FF] via-white to-[#E5DEFF]"}),o.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-6 pb-6 pt-5",children:[o.jsxs("div",{className:"flex items-start justify-between gap-3",children:[o.jsxs("div",{children:[A.status==="Accepting Bids"?o.jsx("div",{className:"mb-1 inline-block rounded-[8px] bg-[#1E4620] px-2 py-1",children:o.jsx("span",{className:"text-[11px] font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):o.jsx(Ye,{variant:A.status==="LIVE"?"danger":"primary",className:"mb-1 text-[11px] uppercase tracking-wide",children:A.status==="LIVE"?" Live Now":A.status}),o.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:A.creatorDisplayName}),o.jsx("div",{className:"text-sm text-[#495057]",children:A.title}),o.jsx("div",{className:"text-xs text-[#6C757D]",children:A.category||"General"})]}),o.jsxs("div",{className:"text-right text-xs text-[#6C757D]",children:[o.jsx("div",{children:A.duration}),o.jsxs("div",{className:"mt-1",children:["Base: ",Ue(A.basePrice)]})]})]}),o.jsxs("div",{className:"rounded-[14px] border border-[#F4E6FF] bg-[#F8F9FA] p-4 text-sm text-[#343A40]",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{children:"Current highest bid"}),o.jsx("span",{className:"text-base font-semibold text-[#C045FF]",children:Ue(A.currentBid)})]}),o.jsxs("div",{className:"mt-1 text-xs text-[#6C757D]",children:[A.participants," fans bidding"]})]}),o.jsxs("div",{className:"text-xs text-[#6C757D]",children:[" ",A.date,"   ",A.endsIn]}),o.jsx(ue,{className:"mt-auto w-full bg-[#050014] text-white hover:bg-[#140423]",size:"sm",children:"View event details "})]})]},A.id)):o.jsxs("div",{className:"col-span-full text-center py-12 text-[#6C757D]",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),f?o.jsxs("p",{children:['No events found matching "',f,'"']}):o.jsx("p",{children:"No events available at the moment. Check back soon!"})]})}),w>1&&o.jsxs("div",{className:"flex items-center justify-center gap-2",children:[o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>j(g-1),disabled:g===1,children:" Previous"}),o.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:w},(A,F)=>F+1).map(A=>{const F=A===1||A===w||Math.abs(A-g)<=1,D=A===2&&g>3||A===w-1&&g<w-2;return!F&&!D?null:D&&!F?o.jsx("span",{className:"px-2 text-[#6C757D]",children:"..."},A):o.jsx("button",{onClick:()=>j(A),className:`min-w-[36px] rounded-lg px-3 py-2 text-sm font-medium transition-all ${g===A?"bg-[#C045FF] text-white":"bg-[#F8F9FA] text-[#6C757D] hover:bg-[#E9ECEF]"}`,children:A},A)})}),o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>j(g+1),disabled:g===w,children:"Next "})]}),o.jsx("section",{children:o.jsxs(pe,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[o.jsx(Ne,{title:"Ready to bid or join a free event?",subtitle:"Create a fan account in less than 30 seconds and keep track of all your bids and meetings."}),o.jsxs(be,{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Login or sign up from the top-right corner when you are ready. You can browse this page without an account."}),o.jsx(ue,{size:"sm",onClick:()=>s("/auth"),children:"Go to login / sign up"})]})]})})]})}function bbe(){return o.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[o.jsxs("section",{className:"space-y-4",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"How It Works"}),o.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Simple 3-step flow for fans and creators."}),o.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"This page gives a high-level explanation of FanMeet without requiring login. Use it from marketing, ads, or the header navigation to explain the product."})]}),o.jsxs("section",{className:"grid gap-4 md:grid-cols-3",children:[o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"1. Pick a creator",subtitle:"Browse public events and choose the creator you want to meet."}),o.jsx(be,{className:"text-sm text-[#6C757D]",children:"Filter by category, price, and availability. Each event clearly shows duration, base price, and current winning bid."})]}),o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"2. Bid or join",subtitle:"Place a bid for paid events or join free lucky-draw sessions."}),o.jsx(be,{className:"text-sm text-[#6C757D]",children:"Highest bid wins the call. If you do not win, you receive up to 90% of your money back automatically."})]}),o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"3. Meet on video",subtitle:"Enjoy a live 1:1 video call from your laptop or phone."}),o.jsx(be,{className:"text-sm text-[#6C757D]",children:"Join directly from your FanMeet dashboard at the scheduled time. No extra apps needed."})]})]}),o.jsx("section",{children:o.jsxs(pe,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[o.jsx(Ne,{title:"For fans and creators",subtitle:"Fans get intimate access. Creators get a new revenue stream and deeper community."}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2 text-sm text-[#6C757D]",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Fans"}),o.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[o.jsx("li",{children:"Bid safely with transparent pricing and refund rules."}),o.jsx("li",{children:"Win 510 minute live calls with creators you truly care about."}),o.jsx("li",{children:"Ask questions, get advice, or just share a moment."})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Creators"}),o.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[o.jsx("li",{children:"Host live micro-meets with your most engaged supporters."}),o.jsx("li",{children:"Set your own prices and schedule, we handle payments and refunds."}),o.jsx("li",{children:"Turn superfans into long-term community members."})]})]})]})]})})]})}const wbe=[{label:"Typical monthly earnings",value:"30k50k",note:"for active mid-sized creators"},{label:"Refund handled by FanMeet",value:"90%",note:"we manage all payment flows"},{label:"Average call length",value:"510 min",note:"short, meaningful conversations"}];function Sbe(){return o.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[o.jsxs("section",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"For Creators"}),o.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Turn your audience into premium, live 1:1 experiences."}),o.jsx("p",{className:"max-w-xl text-sm text-[#6C757D] md:text-base",children:"This is a public overview page about the creator side of FanMeet. Share it with potential creators before they sign up."})]}),o.jsx(Ye,{variant:"primary",className:"self-start md:self-auto",children:"Early creator program open"})]}),o.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:wbe.map(s=>o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:s.label}),o.jsxs(be,{className:"space-y-1 text-sm text-[#6C757D]",children:[o.jsx("div",{className:"text-xl font-semibold text-[#050014]",children:s.value}),o.jsx("div",{className:"text-xs text-[#6C757D]",children:s.note})]})]},s.label))}),o.jsx("section",{children:o.jsxs(pe,{elevated:!0,className:"bg-[#050014] text-white",children:[o.jsx(Ne,{title:"Why creators love FanMeet",subtitle:"You focus on the conversation. We handle everything else."}),o.jsxs(be,{className:"grid gap-4 text-sm md:grid-cols-2",children:[o.jsxs("ul",{className:"space-y-1 list-disc pl-5 text-white/80",children:[o.jsx("li",{children:"Host paid or free events for superfans."}),o.jsx("li",{children:"Flexible schedule that fits around your content calendar."}),o.jsx("li",{children:"Dashboard to track bids, winners, and upcoming calls."})]}),o.jsxs("ul",{className:"space-y-1 list-disc pl-5 text-white/80",children:[o.jsx("li",{children:"Secure payments, refunds, and payouts managed by FanMeet."}),o.jsx("li",{children:"Human review of fans and clear safety controls for calls."}),o.jsx("li",{children:"Dedicated support team for you and your community."})]})]})]})}),o.jsx("section",{children:o.jsxs(pe,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[o.jsx(Ne,{title:"Interested in hosting events?",subtitle:"Start by creating a creator account. You can explore the dashboard before running your first event."}),o.jsxs(be,{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Use the login / sign up button in the header when you are ready. Once you are in, switch to the creator panel from the role selector."}),o.jsx(ue,{size:"sm",children:"Login / Sign up"})]})]})})]})}const Cbe=[{value:"all",label:"All Events",emoji:""},{value:"entertainment",label:"Entertainment",emoji:""},{value:"music",label:"Music",emoji:""},{value:"education",label:"Education",emoji:""},{value:"fitness",label:"Fitness",emoji:""},{value:"gaming",label:"Gaming",emoji:""},{value:"lifestyle",label:"Lifestyle",emoji:""},{value:"general",label:"General",emoji:""}],Tbe=[{value:"popular",label:"Most Popular"},{value:"ending-soon",label:"Ending Soon"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"},{value:"newest",label:"Newly Added"}];function Rbe(){const s=Fs(),[n]=Yg(),{events:a,myBids:l}=qo(),[u,f]=L.useState("all"),[g,v]=L.useState("popular"),[y,w]=L.useState(n.get("q")||"");L.useEffect(()=>{const A=n.get("q");A!==null&&A!==y&&w(A)},[n]);const T=L.useMemo(()=>[...a.filter(D=>{var R;if(u!=="all"&&D.category!==u)return!1;if(y){const O=y.toLowerCase();return D.title.toLowerCase().includes(O)||D.creatorDisplayName.toLowerCase().includes(O)||((R=D.description)==null?void 0:R.toLowerCase().includes(O))}return!0})].sort((D,R)=>{switch(g){case"popular":return R.participants-D.participants;case"price-low":return D.basePrice-R.basePrice;case"price-high":return R.basePrice-D.basePrice;case"newest":return R.id.localeCompare(D.id);case"ending-soon":const O=V=>V.includes("Closed")?999999:V.includes("days")?parseInt(V)*24*60:V.includes("hours")?parseInt(V)*60:V.includes("minutes")?parseInt(V):0;return O(D.endsIn)-O(R.endsIn);default:return 0}}),[a,u,g,y]),S=20,I=T.length>S,j=T.slice(0,S),B=L.useMemo(()=>{const A=l.length,F=l.filter(O=>O.status==="won").length,D=A>0?Math.round(F/A*100):0,R=l.filter(O=>O.status==="lost").reduce((O,V)=>O+Math.floor(V.amount*.9),0);return[{id:"stat-1",label:"Bids placed",value:String(A),hint:`${l.filter(O=>O.status==="active"||O.status==="outbid").length} active`},{id:"stat-2",label:"Win rate",value:`${D}%`,hint:`${F} wins out of ${A}`},{id:"stat-3",label:"Refunds received",value:Ue(R),hint:"90% back on lost bids"},{id:"stat-4",label:"Meets completed",value:String(F),hint:`Across ${new Set(l.filter(O=>O.status==="won").map(O=>O.creatorUsername)).size} creators`}]},[l]);return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx(pe,{elevated:!0,className:"overflow-hidden border-none bg-gradient-to-r from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] shadow-[0_24px_60px_rgba(160,64,255,0.18)]",children:o.jsxs("div",{className:"relative flex flex-col gap-6 px-6 py-6 md:flex-row md:items-center md:px-8 md:py-8",children:[o.jsxs("div",{className:"max-w-xl space-y-3",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Browse Events"}),o.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Find a live FanMeet that matches your vibe."}),o.jsx("p",{className:"text-sm text-[#4B445F]",children:"Browse, bid, and secure your spot with your favorite creators in small, exclusive meetups."})]}),o.jsx("div",{className:"flex-shrink-0 text-6xl md:text-7xl",children:""})]})}),o.jsx(pe,{children:o.jsxs(be,{className:"gap-6",children:[o.jsxs("div",{className:"relative",children:[o.jsx("input",{type:"text",placeholder:"Search events or creators...",value:y,onChange:A=>w(A.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),o.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Categories"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:Cbe.map(A=>o.jsxs("button",{onClick:()=>f(A.value),className:`rounded-full border-2 px-4 py-2 text-sm font-medium transition-all ${u===A.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:[o.jsx("span",{className:"mr-1",children:A.emoji}),A.label]},A.value))})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Sort By"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:Tbe.map(A=>o.jsx("button",{onClick:()=>v(A.value),className:`rounded-full border-2 px-4 py-2 text-sm font-medium transition-all ${g===A.value?"border-[#C045FF] bg-[#C045FF] text-white":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:A.label},A.value))})]})]})}),o.jsxs("div",{children:[o.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[o.jsxs("h2",{className:"text-xl font-semibold text-[#212529]",children:[T.length," ",T.length===1?"Event":"Events"," Found",I&&o.jsxs("span",{className:"ml-2 text-sm font-normal text-[#6C757D]",children:["(showing ",j.length,")"]})]}),I&&o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>s("/fan/all-events"),children:"View All Events "})]}),j.length===0?o.jsx(pe,{children:o.jsxs(be,{className:"py-12 text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),o.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Try adjusting your filters or search query"}),o.jsx(ue,{onClick:()=>{f("all"),w("")},children:"Clear Filters"})]})}):o.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:j.map(A=>o.jsx(pe,{className:"group cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>s(`/events/${A.id}`),children:o.jsxs(be,{className:"gap-4",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"mb-1 text-xs text-[#6C757D]",children:A.creatorDisplayName}),o.jsx("h3",{className:"text-base font-semibold text-[#212529] group-hover:text-[#C045FF]",children:A.title})]}),A.status==="Accepting Bids"?o.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:o.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):o.jsx(Ye,{variant:A.status==="LIVE"?"danger":"primary",children:A.status})]}),A.description&&o.jsx("p",{className:"line-clamp-2 text-sm text-[#6C757D]",children:A.description}),o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-xs text-[#6C757D]",children:"Current Bid"}),o.jsx("div",{className:"font-semibold text-[#C045FF]",children:Ue(A.currentBid)})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-xs text-[#6C757D]",children:"Base Price"}),o.jsx("div",{className:"font-semibold text-[#212529]",children:Ue(A.basePrice)})]})]}),o.jsxs("div",{className:"flex items-center justify-between border-t border-[#E9ECEF] pt-3 text-xs text-[#6C757D]",children:[o.jsxs("span",{children:[" ",A.participants," bidding"]}),o.jsxs("span",{children:[" ",A.endsIn]})]}),o.jsx(ue,{className:"w-full",size:"sm",children:"View & Bid "})]})},A.id))}),I&&j.length>0&&o.jsx(pe,{className:"mt-6 border-dashed border-2 border-[#C045FF]/30 bg-gradient-to-r from-[#FCE7FF]/50 via-white to-[#E5DEFF]/50",children:o.jsxs(be,{className:"py-8 text-center",children:[o.jsx("div",{className:"text-4xl mb-3",children:""}),o.jsxs("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:[T.length-j.length," more events available"]}),o.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Explore all events to find the perfect creator meet for you"}),o.jsx(ue,{onClick:()=>s("/fan/all-events"),children:"Browse All Events "})]})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Your Activity",subtitle:"Track your bidding performance"}),o.jsx(be,{children:o.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:B.map(A=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-gradient-to-br from-[#F8F9FA] to-white p-4",children:[o.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:A.label}),o.jsx("div",{className:"mt-1 text-2xl font-bold text-[#212529]",children:A.value}),o.jsx("div",{className:"mt-1 text-xs text-[#6C757D]",children:A.hint})]},A.id))})})]})]})}function Nbe(){const{myBids:s,events:n}=qo(),a=Fs(),l=s.filter(g=>g.status==="active"||g.status==="outbid"),u=s.filter(g=>g.status==="won"||g.status==="lost"||g.status==="cancelled"),f=g=>n.find(v=>v.id===g);return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Bids"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track your bidding activity and results."})]}),o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Active Bids",subtitle:"Stay on top of the events you are currently bidding on"}),o.jsx(be,{className:"gap-6",children:l.length===0?o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-8 text-center",children:[o.jsx("p",{className:"text-sm text-[#6C757D]",children:"You don't have any active bids."}),o.jsx(ue,{className:"mt-4",onClick:()=>a("/fan"),children:"Browse Events"})]}):l.map(g=>{const v=f(g.eventId),y=g.status==="outbid";return o.jsxs("div",{className:`grid gap-3 rounded-[16px] border p-4 md:grid-cols-[1.5fr_1fr_auto] md:items-center ${y?"border-[#FFC107] bg-[#FFF9E6]":"border-[#E9ECEF] bg-[#F8F9FA]"}`,children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-[#6C757D]",children:(v==null?void 0:v.creatorDisplayName)||"Unknown Creator"}),o.jsx("div",{className:"text-base font-semibold text-[#212529]",children:g.eventTitle||"Event"}),y&&o.jsx(Ye,{variant:"danger",className:"mt-1",children:" You've been outbid!"}),(v==null?void 0:v.status)==="Accepting Bids"&&!y&&o.jsx("div",{className:"mt-1 inline-flex rounded-[8px] bg-[#1E4620] px-2 py-0.5",children:o.jsx("span",{className:"text-[10px] font-semibold text-[#4ADE80]",children:" Accepting Bids"})})]}),o.jsxs("div",{className:"grid gap-1 text-sm text-[#6C757D] md:justify-items-end",children:[o.jsxs("span",{children:["Your Bid: ",o.jsx("strong",{className:"text-[#212529]",children:Ue(g.amount)})]}),v&&o.jsxs(o.Fragment,{children:[o.jsxs("span",{children:["Current: ",o.jsx("strong",{className:"text-[#C045FF]",children:Ue(v.currentBid)})]}),o.jsxs("span",{children:[" ",v.endsIn]})]})]}),o.jsxs("div",{className:"flex gap-2 md:justify-end",children:[o.jsx(ue,{size:"sm",variant:y?"primary":"secondary",onClick:()=>a(`/events/${g.eventId}`),children:y?"Increase Bid Now":"Increase Bid"}),o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>a(`/events/${g.eventId}`),children:"Details "})]})]},g.id)})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Bid Results"}),o.jsx(be,{className:"overflow-x-auto",children:u.length===0?o.jsx("div",{className:"py-8 text-center text-sm text-[#6C757D]",children:"No past bid results yet."}):o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Event"}),o.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Your Bid"}),o.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Result"})]})}),o.jsx("tbody",{className:"text-[#212529]",children:u.map(g=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3",children:g.creatorUsername||"Unknown"}),o.jsx("td",{className:"py-3",children:g.eventTitle||"Event"}),o.jsx("td",{className:"py-3",children:Ue(g.amount)}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:g.status==="won"?"success":"danger",children:g.status==="won"?" Won":g.status==="lost"?" Lost":"Cancelled"})})]},g.id))})]})})]})]})}function Abe(s){const n=new Date(s),a=new Date,l=n.getTime()-a.getTime();if(l<=0)return"Starting soon";const u=Math.floor(l/(1e3*60)),f=Math.floor(u/60),g=Math.floor(f/24),v=u%60;if(g>0){const y=f%24;return`${g} day${g>1?"s":""}${y>0?` ${y} hr${y>1?"s":""}`:""}`}return f>0?`${f} hr${f>1?"s":""}${v>0?` ${v} min`:""}`:`${v} min`}function Ibe(){const{myMeets:s}=qo(),n=s.filter(u=>u.status==="scheduled"||u.status==="live"||u.status==="completed").sort((u,f)=>{const g={live:0,scheduled:1,completed:2},v=(g[u.status]||3)-(g[f.status]||3);return v!==0?v:new Date(u.scheduledAt).getTime()-new Date(f.scheduledAt).getTime()});n.filter(u=>u.status==="live"),n.filter(u=>u.status==="scheduled"),n.filter(u=>u.status==="completed");const a=u=>{u&&navigator!=null&&navigator.clipboard&&navigator.clipboard.writeText(u)},l=u=>{u&&window.open(u,"_blank","noopener,noreferrer")};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Upcoming Meets"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Access your confirmed sessions and join on time."})]}),n.length===0?o.jsx(pe,{elevated:!0,className:"grid min-h-[320px] place-items-center text-center",children:o.jsxs("div",{className:"flex flex-col items-center gap-3",children:[o.jsx("span",{className:"text-5xl",children:""}),o.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:"No meets yet"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Win an event to see your meeting details right here."}),o.jsx(ue,{children:"Browse Events "})]})}):o.jsxs(pe,{elevated:!0,className:"border-l-4 border-[#28A745]",children:[o.jsx(Ne,{title:" You Won!",subtitle:"Get ready for your upcoming 1-on-1 session",className:"border-b border-[#E9ECEF] pb-4"}),o.jsx(be,{className:"gap-6",children:n.map(u=>o.jsxs("div",{className:"grid gap-4 md:grid-cols-[auto_1fr] md:gap-6",children:[o.jsx(Ye,{variant:u.status==="live"?"success":u.status==="completed"?"default":"primary",className:`w-fit px-4 py-2 text-sm ${u.status==="live"?"animate-pulse":""}`,children:u.status==="live"?" LIVE - Creator is waiting!":u.status==="completed"?" Completed":"Scheduled"}),o.jsxs("div",{className:"flex flex-col gap-4",children:[o.jsxs("div",{children:[o.jsxs("h3",{className:"text-xl font-semibold text-[#212529]",children:["Meeting with ",u.creatorDisplayName||u.creatorUsername]}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:[Bt(u.scheduledAt),"  Duration ",u.durationMinutes," minutes"]})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("div",{className:"flex flex-col gap-2 rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[o.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Meeting Link"}),o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsx("span",{className:"break-all text-sm text-[#212529]",children:u.meetingLink||"Link not available yet"}),u.meetingLink&&o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>a(u.meetingLink),children:"Copy"})]})]}),o.jsxs("div",{className:"flex flex-wrap gap-3",children:[u.status!=="completed"&&o.jsx(ue,{variant:"secondary",children:"Add to Calendar"}),o.jsx(ue,{disabled:!u.meetingLink||u.status==="completed",onClick:()=>l(u.meetingLink),children:u.status==="completed"?"Meeting Ended":"Join Meeting "})]}),u.status!=="completed"?o.jsxs("span",{className:"text-sm text-[#6C757D]",children:[" Starts in:"," ",o.jsx("strong",{className:"text-[#C045FF]",children:Abe(u.scheduledAt)})]}):o.jsx("span",{className:"text-sm text-[#6C757D]",children:" This meeting has been completed"})]})]})]},u.id))})]})]})}function Obe(){const{user:s}=mr(),[n,a]=L.useState(!0),[l,u]=L.useState([]),[f,g]=L.useState({totalPaid:0,totalRefunded:0});L.useEffect(()=>{(async()=>{if(!s){u([]),a(!1);return}a(!0);try{const{data:w,error:T}=await ie.from("payments").select("id, amount, status, type, description, created_at").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(50);T&&console.error("Error fetching payments:",T);const{data:S}=await ie.from("bids").select("id, amount, status, created_at, event_id").eq("fan_id",s.id).order("created_at",{ascending:!1}).limit(50),I=(S==null?void 0:S.map(R=>R.event_id))||[],{data:j}=I.length>0?await ie.from("events").select("id, title").in("id",I):{data:[]},B=new Map((j==null?void 0:j.map(R=>[R.id,R.title]))||[]),A=[];if(w)for(const R of w)A.push({id:R.id,date:new Date(R.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:R.description||(R.type==="refund"?"Refund":"Payment"),amount:R.amount,type:R.type==="refund"?"credit":"debit",status:R.status});if(S)for(const R of S){const O=B.get(R.event_id)||"Event",V=R.status==="refunded"||R.status==="lost";A.push({id:`bid-${R.id}`,date:new Date(R.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:`Bid on "${O}"`,amount:R.amount,type:"debit",status:R.status==="won"?"completed":R.status==="active"?"pending":"completed"}),V&&A.push({id:`refund-${R.id}`,date:new Date(R.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:`Refund for "${O}" (Auto-refund)`,amount:Math.floor(R.amount*.9),type:"credit",status:"refunded"})}A.sort((R,O)=>new Date(O.date).getTime()-new Date(R.date).getTime());const F=A.filter(R=>R.type==="debit"&&R.status!=="failed").reduce((R,O)=>R+O.amount,0),D=A.filter(R=>R.type==="credit").reduce((R,O)=>R+O.amount,0);u(A),g({totalPaid:F,totalRefunded:D})}finally{a(!1)}})()},[s]);const v=(y,w)=>{if(w==="credit")return o.jsx(Ye,{variant:"success",children:"Refunded"});switch(y){case"completed":return o.jsx(Ye,{variant:"success",children:"Completed"});case"pending":return o.jsx(Ye,{variant:"warning",children:"Pending"});case"failed":return o.jsx(Ye,{variant:"danger",children:"Failed"});default:return o.jsx(Ye,{variant:"primary",children:y})}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Payment History"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"View all your payments and refunds. Auto-refunds are processed for unsuccessful bids."})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2 max-w-2xl",children:[o.jsx(pe,{elevated:!0,children:o.jsxs(be,{className:"p-4",children:[o.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Paid"}),o.jsx("div",{className:"mt-1 text-2xl font-bold text-[#212529]",children:n?"...":Ue(f.totalPaid)}),o.jsx("div",{className:"text-xs text-[#6C757D]",children:"All-time bid payments"})]})}),o.jsx(pe,{elevated:!0,children:o.jsxs(be,{className:"p-4",children:[o.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunded"}),o.jsx("div",{className:"mt-1 text-2xl font-bold text-green-600",children:n?"...":Ue(f.totalRefunded)}),o.jsx("div",{className:"text-xs text-[#6C757D]",children:"Auto-refunds (90% of bid amount)"})]})})]}),o.jsx(pe,{className:"max-w-2xl bg-[#F0FDF4] border-green-200",children:o.jsx(be,{className:"p-4",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("span",{className:"text-xl",children:""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-semibold text-green-800",children:"Auto-Refund System Active"}),o.jsx("div",{className:"text-sm text-green-700",children:"If you don't win an event, 90% of your bid amount is automatically refunded to your original payment method within 5-7 business days."})]})]})})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Transaction History",subtitle:"All payments and refunds"}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Date"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Description"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Amount"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Type"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Status"})]})}),o.jsx("tbody",{className:"text-[#212529]",children:n?o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"py-8 text-center text-sm text-[#6C757D]",children:"Loading payment history..."})}):l.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"py-8 text-center text-sm text-[#6C757D]",children:"No payments yet. Place a bid on an event to get started!"})}):l.map(y=>o.jsxs("tr",{className:"border-b border-[#E9ECEF] hover:bg-[#F8F9FA]",children:[o.jsx("td",{className:"py-3 px-2 whitespace-nowrap",children:y.date}),o.jsx("td",{className:"py-3 px-2",children:y.description}),o.jsx("td",{className:"py-3 px-2",children:o.jsxs("span",{className:y.type==="credit"?"text-green-600 font-semibold":"text-[#212529]",children:[y.type==="credit"?"+":"-",Ue(y.amount)]})}),o.jsx("td",{className:"py-3 px-2",children:o.jsx(Ye,{variant:y.type==="credit"?"success":"primary",children:y.type==="credit"?"Credit":"Debit"})}),o.jsx("td",{className:"py-3 px-2",children:v(y.status,y.type)})]},y.id))})]})})]})]})}function Dbe(){const{user:s}=mr(),n=Fs(),[a,l]=L.useState([]),[u,f]=L.useState(!0);return L.useEffect(()=>{async function g(){if(s)try{const{data:v,error:y}=await ie.from("creator_follows").select("creator_id").eq("fan_id",s.id);if(y)throw y;if(v&&v.length>0){const w=v.map(I=>I.creator_id),{data:T,error:S}=await ie.from("profiles").select("*").in("user_id",w);if(S)throw S;T&&l(T)}else l([])}catch(v){console.error("Error fetching following:",v)}finally{f(!1)}}g()},[s]),u?o.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading..."}):o.jsxs("div",{className:"mx-auto flex max-w-4xl flex-col gap-6",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Following"}),o.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"Creators you follow. Join their upcoming events faster from here."})]}),o.jsxs("div",{className:"space-y-4",children:[a.map(g=>{var v,y;return o.jsx(pe,{elevated:!0,className:"border-none bg-white/95",children:o.jsxs(be,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[o.jsx("div",{className:"flex flex-col gap-1",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Mi,{src:g.avatar_url,initials:((v=g.display_name)==null?void 0:v.charAt(0))||((y=g.username)==null?void 0:y.charAt(0)),size:"md"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:g.display_name||g.username}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",g.username]})]})]})}),o.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[o.jsx(Ye,{variant:"primary",children:"Following"}),o.jsx("div",{className:"flex gap-2",children:o.jsx(ue,{size:"sm",className:"rounded-full",onClick:()=>n(`/${g.username}`),children:"View profile"})})]})]})},g.user_id)}),a.length===0&&o.jsx(pe,{children:o.jsx(be,{children:o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Youre not following any creators yet. Start by placing a bid or hitting follow on a creator profile."})})})]})]})}const Pbe={active:"primary",lost:"danger",won:"success"};function kbe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState([]),[f,g]=L.useState(!0);return L.useEffect(()=>{(async()=>{if(s)try{const{data:y,error:w}=await ie.from("meets").select(`
            id,
            scheduled_at,
            status,
            event_id,
            creator_id
          `).eq("fan_id",s.id).eq("status","completed").order("scheduled_at",{ascending:!1});if(w)throw w;const T=await Promise.all((y||[]).map(async B=>{const{data:A}=await ie.from("events").select("title").eq("id",B.event_id).single(),{data:F}=await ie.from("profiles").select("display_name").eq("user_id",B.creator_id).single(),{data:D}=await ie.from("bids").select("amount").eq("event_id",B.event_id).eq("bidder_id",s.id).eq("status","won").single();return{id:B.id,creator_name:(F==null?void 0:F.display_name)||"Unknown Creator",event_title:(A==null?void 0:A.title)||"Unknown Event",scheduled_at:B.scheduled_at,amount:(D==null?void 0:D.amount)||0,status:B.status}}));a(T);const{data:S,error:I}=await ie.from("bids").select(`
            id,
            amount,
            status,
            created_at,
            event_id
          `).eq("bidder_id",s.id).eq("status","active").order("created_at",{ascending:!1});if(I)throw I;const j=await Promise.all((S||[]).map(async B=>{const{data:A}=await ie.from("events").select("title, creator_id").eq("id",B.event_id).single();let F="Unknown Creator";if(A!=null&&A.creator_id){const{data:D}=await ie.from("profiles").select("display_name").eq("user_id",A.creator_id).single();F=(D==null?void 0:D.display_name)||"Unknown Creator"}return{id:B.id,creator_name:F,event_title:(A==null?void 0:A.title)||"Unknown Event",created_at:B.created_at,amount:B.amount,status:B.status}}));u(j)}catch(y){console.error("Error fetching history:",y)}finally{g(!1)}})()},[s]),f?o.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading history..."}):o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"History"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Catch up on your past sessions and keep tabs on upcoming requests."})]}),o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Past Experiences",subtitle:"Rate your meets and revisit standout memories.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsx(be,{className:"gap-6",children:n.length===0?o.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No past meets yet."}):n.map(v=>o.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] p-4 md:flex-row md:items-center md:justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsx(Ye,{variant:"primary",children:v.creator_name}),o.jsx("span",{className:"text-sm text-[#6C757D]",children:Bt(new Date(v.scheduled_at))})]}),o.jsx("h3",{className:"mt-2 text-lg font-semibold text-[#212529]",children:v.event_title})]}),o.jsxs("div",{className:"flex flex-col items-end gap-2",children:[o.jsx("span",{className:"text-sm text-[#6C757D]",children:"Winning Bid"}),o.jsx("span",{className:"text-xl font-semibold text-[#212529]",children:Ue(v.amount)})]})]},v.id))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Pending Requests",subtitle:"Stay updated on events waiting for confirmation.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsxs(be,{className:"gap-4",children:[l.length===0?o.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No pending requests."}):l.map(v=>o.jsxs("div",{className:"flex flex-col gap-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[o.jsxs("div",{children:[o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Requested on ",Bt(new Date(v.created_at))]}),o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:v.event_title}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",v.creator_name]})]}),o.jsxs("div",{className:"flex flex-col items-end gap-2",children:[o.jsx(Ye,{variant:Pbe[v.status]??"default",children:v.status}),o.jsxs("span",{className:"text-sm font-medium text-[#212529]",children:["Bid: ",Ue(v.amount)]})]})]},v.id)),o.jsx(ue,{variant:"ghost",className:"self-start",children:"View all requests "})]})]})]})}function jbe(){const{notifications:s,markNotificationAsRead:n,markAllNotificationsAsRead:a}=Jg();return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-[#111827]",children:"Notifications"}),o.jsx("p",{className:"text-[#6C757D]",children:"Manage your alerts and preferences"})]}),o.jsxs("button",{onClick:()=>a(),className:"flex items-center gap-2 text-sm font-medium text-[#FF6B35] hover:text-[#E85D2E]",children:[o.jsx(DH,{className:"h-4 w-4"}),"Mark all as read"]})]}),o.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[o.jsx("div",{className:"lg:col-span-2 space-y-4",children:o.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[o.jsx("h2",{className:"mb-4 text-lg font-semibold text-[#111827]",children:"Latest alerts"}),o.jsx("div",{className:"space-y-4",children:s.length===0?o.jsx("div",{className:"text-center py-8 text-[#6C757D]",children:"No notifications yet"}):s.map(l=>o.jsxs("div",{className:`flex gap-4 rounded-lg border p-4 transition-colors cursor-pointer ${l.read?"border-transparent bg-white":"border-[#FFE5D9] bg-[#FFF5F2]"}`,onClick:()=>!l.read&&n(l.id),children:[o.jsx("div",{className:`mt-1 flex h-8 w-8 flex-none items-center justify-center rounded-full ${l.read?"bg-[#F8F9FA] text-[#6C757D]":"bg-[#FFE5D9] text-[#FF6B35]"}`,children:o.jsx(OH,{className:"h-4 w-4"})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-start justify-between gap-2",children:[o.jsx("h3",{className:`font-medium ${l.read?"text-[#111827]":"text-[#FF6B35]"}`,children:l.title}),o.jsx("span",{className:"whitespace-nowrap text-xs text-[#6C757D]",children:lu(new Date(l.created_at),"MMM d, h:mm a")})]}),o.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:l.message})]}),!l.read&&o.jsx("div",{className:"mt-2 h-2 w-2 rounded-full bg-[#FF6B35]"})]},l.id))})]})}),o.jsx("div",{className:"space-y-6",children:o.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[o.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[o.jsx(FH,{className:"h-5 w-5 text-[#6C757D]"}),o.jsx("h2",{className:"text-lg font-semibold text-[#111827]",children:"Preferences"})]}),o.jsx("div",{className:"space-y-4",children:["Email notifications","Push notifications","SMS alerts"].map(l=>o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm text-[#111827]",children:l}),o.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[o.jsx("input",{type:"checkbox",className:"peer sr-only",defaultChecked:!0}),o.jsx("div",{className:"peer h-6 w-11 rounded-full bg-[#E9ECEF] after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-[#FF6B35] peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#FFE5D9]"})]})]},l))})]})})]})]})}function Lbe(){const{user:s}=mr(),[n,a]=L.useState(!1),[l,u]=L.useState(!1),[f,g]=L.useState(""),[v,y]=L.useState(""),[w,T]=L.useState(""),[S,I]=L.useState(""),[j,B]=L.useState(""),[A,F]=L.useState([]);L.useEffect(()=>{if(!s)return;(async()=>{a(!0);try{const{data:O,error:V}=await ie.from("profiles").select("display_name, username, bio, primary_language, timezone").eq("user_id",s.id).single();V?console.error("Error fetching profile:",V):O&&(g(O.display_name||""),y(O.username||""),T(O.bio||""),I(O.primary_language||""),B(O.timezone||""));const{data:G,error:J}=await ie.from("security_logs").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(5);J?console.error("Error fetching security logs:",J):G&&F(G)}catch(O){console.error("Unexpected error fetching data:",O)}finally{a(!1)}})()},[s]);const D=async()=>{if(s){u(!0);try{if(v){const{data:O,error:V}=await ie.from("profiles").select("user_id").eq("username",v).neq("user_id",s.id).maybeSingle();if(V){console.error("Error checking username:",V),alert("Error checking username availability."),u(!1);return}if(O){alert("Username already taken. Please choose another one."),u(!1);return}}const{error:R}=await ie.from("profiles").update({display_name:f,username:v,bio:w,primary_language:S,timezone:j,updated_at:new Date().toISOString()}).eq("user_id",s.id);alert(R?"Error updating profile: "+R.message:"Profile updated successfully!")}catch(R){console.error("Error saving profile:",R),alert("Failed to save profile.")}finally{u(!1)}}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Settings"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Update your profile details, preferences, and review recent security activity."})]}),o.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,0.8fr)]",children:[o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Profile",subtitle:"Let creators know who theyre meeting."}),o.jsxs(be,{className:"gap-5",children:[o.jsx(nt,{label:"Full name",placeholder:"Your Name",value:f,onChange:R=>g(R.target.value),disabled:n}),o.jsx(nt,{label:"Public username",placeholder:"@username",value:v,onChange:R=>y(R.target.value),disabled:n}),o.jsx(ls,{label:"About you",placeholder:"Share your interests, favorite creators, and background.",value:w,onChange:R=>T(R.target.value),rows:4,disabled:n}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Preferred language",placeholder:"English",value:S,onChange:R=>I(R.target.value),disabled:n}),o.jsx(nt,{label:"Timezone",placeholder:"IST",value:j,onChange:R=>B(R.target.value),disabled:n})]}),o.jsx(ue,{size:"lg",onClick:D,disabled:n||l,children:l?"Saving...":"Save profile"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Communication",subtitle:"Choose how we keep you informed."}),o.jsxs(be,{className:"gap-4 text-sm text-[#212529]",children:[o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",defaultChecked:!0,className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Email me when Im outbid on an event"]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",defaultChecked:!0,className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Remind me 24 hours before a meet"]}),o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Send me creator spotlights and platform updates"]}),o.jsx(ue,{variant:"secondary",className:"self-start",children:"Save preferences"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Security activity",subtitle:"Recent actions that impact your account safety.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsxs(be,{className:"gap-4",children:[A.length===0?o.jsx("div",{className:"text-sm text-[#6C757D]",children:"No recent security activity found."}):A.map(R=>o.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-sm font-semibold text-[#212529]",children:R.event_type}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:[new Date(R.created_at).toLocaleString(),"  ",R.location||"Unknown Location"]})]}),o.jsx(Ye,{variant:"default",children:"Logged"})]},R.id)),o.jsx(ue,{variant:"ghost",className:"self-start",children:"Review all security events "})]})]})]})}const Mbe={online:"#22c55e",dnd:"#ef4444",offline:"#9ca3af"};function Fbe({status:s}){return o.jsx("span",{"aria-label":s,className:"inline-block h-2.5 w-2.5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:Mbe[s]}})}function Ube(){const[s,n]=L.useState(""),[a,l]=L.useState(null),{messages:u,sendMessage:f,markMessageAsRead:g}=Jg(),{user:v}=mr(),y=L.useMemo(()=>{if(!v||!u)return[];const I=new Map;return u.forEach(j=>{const B=j.sender_id===v.id?j.receiver_id:j.sender_id,A=j.sender_id===v.id?j.receiver_display_name:j.sender_display_name,F=j.sender_id===v.id?j.receiver_username:j.sender_username,D=I.get(B),R=!j.read&&j.receiver_id===v.id;D?(new Date(j.created_at)>new Date(D.lastTime)&&(D.lastMessage=j.message,D.lastTime=j.created_at),R&&(D.unread+=1)):I.set(B,{id:B,participant:{id:B,name:A||"Unknown User",username:F||"unknown",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${A||"User"}`,status:"offline"},lastMessage:j.message,lastTime:j.created_at,unread:R?1:0})}),Array.from(I.values()).sort((j,B)=>new Date(B.lastTime).getTime()-new Date(j.lastTime).getTime())},[u,v]),w=L.useMemo(()=>y.find(I=>I.id===a)||null,[y,a]),T=L.useMemo(()=>u.filter(I=>I.sender_id===(v==null?void 0:v.id)&&I.receiver_id===a||I.sender_id===a&&I.receiver_id===(v==null?void 0:v.id)),[u,v,a]);L.useEffect(()=>{a&&v&&T.filter(j=>!j.read&&j.receiver_id===v.id).forEach(j=>g(j.id))},[a,T,v,g]);const S=async I=>{if(I.preventDefault(),!(!s.trim()||!a))try{await f(a,s),n("")}catch(j){console.error("Failed to send message:",j)}};return o.jsxs("div",{className:"flex h-[calc(100vh-140px)] flex-col gap-4 md:flex-row",children:[o.jsxs("div",{className:`flex w-full flex-col gap-3 md:w-80 ${w?"hidden md:flex":"flex"}`,children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Messages"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Chat with creators after your meets."})]}),o.jsxs(pe,{className:"flex h-full min-h-[260px] flex-col overflow-hidden",children:[o.jsx(Ne,{className:"flex flex-row items-center justify-between gap-2 border-b border-[#E9ECEF] pb-3",children:o.jsxs("div",{children:[o.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Conversations"}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Tap a creator to open your chat."})]})}),o.jsx(be,{className:"min-h-0 flex-1 gap-2 p-0",children:o.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[y.map(I=>{const j=I.id===a;return o.jsxs("button",{type:"button",onClick:()=>l(I.id),className:`mb-2 flex w-full items-center gap-3 rounded-[12px] border px-3 py-2 text-left text-sm transition-colors ${j?"border-[#C045FF] bg-[#F4E6FF] text-[#140423]":"border-[#E9ECEF] bg-white text-[#212529] hover:border-[#C045FF]/50 hover:bg-[#F8F5FF]"}`,children:[o.jsx(Mi,{src:I.participant.avatar,alt:I.participant.name,initials:I.participant.name.charAt(0),size:"sm"}),o.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsx("span",{className:"truncate text-[13px] font-semibold",children:I.participant.name}),o.jsx("span",{className:"whitespace-nowrap text-[11px] text-[#6C757D]",children:lu(new Date(I.lastTime),"h:mm a")})]}),o.jsx("span",{className:"mt-0.5 line-clamp-1 text-[12px] text-[#6C757D]",children:I.lastMessage})]}),I.unread>0&&o.jsx("span",{className:"ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-[#C045FF] px-1 text-[11px] font-semibold text-white",children:I.unread})]},I.id)}),y.length===0&&o.jsx("p",{className:"pt-4 text-center text-xs text-[#6C757D]",children:"No conversations yet. Join a FanMeet to start chatting with creators."})]})})]})]}),o.jsx(pe,{elevated:!0,className:`flex h-full w-full flex-1 flex-col overflow-hidden ${w?"flex":"hidden md:flex"}`,children:w?o.jsxs(o.Fragment,{children:[o.jsxs(Ne,{className:"flex flex-row items-center justify-between gap-3 border-b border-[#E9ECEF] bg-white/80 py-3 backdrop-blur",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("button",{type:"button",className:"flex h-8 w-8 items-center justify-center rounded-full border border-[#E9ECEF] bg-white text-sm text-[#343A40] md:hidden",onClick:()=>l(null),children:""}),o.jsx(Mi,{src:w.participant.avatar,alt:w.participant.name,initials:w.participant.name.charAt(0),size:"sm"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:w.participant.name}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#6C757D]",children:[w.participant.status&&o.jsx(Fbe,{status:w.participant.status}),o.jsx("span",{children:w.participant.status==="online"?"Online now":"Offline"})]})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ue,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:o.jsx(VH,{className:"h-4 w-4","aria-hidden":"true"})}),o.jsx(ue,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:o.jsx(kH,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),o.jsxs(be,{className:"flex min-h-0 flex-1 flex-col p-0",children:[o.jsx("div",{className:"flex-1 space-y-4 overflow-y-auto bg-[#F8F9FA] p-4",children:T.map(I=>{var B;const j=I.sender_id===(v==null?void 0:v.id);return o.jsx("div",{className:`group my-2 flex gap-2 ${j?"justify-end":"justify-start"}`,children:o.jsxs("div",{className:`flex max-w-[80%] items-start gap-2 ${j?"flex-row-reverse":"flex-row"}`,children:[o.jsx(Mi,{src:j?`https://api.dicebear.com/9.x/initials/svg?seed=${((B=v==null?void 0:v.user_metadata)==null?void 0:B.full_name)||"Me"}`:w.participant.avatar,alt:j?"Me":w.participant.name,initials:j?"Me":w.participant.name.charAt(0),size:"sm"}),o.jsxs("div",{children:[o.jsx("div",{className:`rounded-2xl px-3 py-2 text-sm ${j?"bg-gradient-to-r from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] text-white shadow-[0_10px_30px_rgba(0,0,0,0.25)]":"border border-[#E9ECEF] bg-white text-[#212529]"}`,children:I.message}),o.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-[#6C757D]",children:[o.jsx("time",{dateTime:I.created_at,children:lu(new Date(I.created_at),"h:mm a")}),o.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:o.jsx(MH,{className:"h-3 w-3","aria-hidden":"true"})}),o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:o.jsx(PH,{className:"h-3 w-3","aria-hidden":"true"})}),!j&&o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:o.jsx(LH,{className:"h-3 w-3","aria-hidden":"true"})}),j&&o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:o.jsx(UH,{className:"h-3 w-3","aria-hidden":"true"})}),o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:o.jsx(jH,{className:"h-3 w-3","aria-hidden":"true"})})]})]})]})]})},I.id)})}),o.jsx("div",{className:"border-t border-[#E9ECEF] bg-white p-3",children:o.jsxs("form",{onSubmit:S,className:"flex items-center gap-3",children:[o.jsx("input",{type:"text",value:s,onChange:I=>n(I.target.value),placeholder:"Type your message...",className:"h-11 flex-1 rounded-[12px] border-2 border-[#E9ECEF] bg-white px-4 text-sm text-[#212529] placeholder:text-[#ADB5BD] focus:border-[#C045FF] focus:shadow-[0_0_0_3px_rgba(192,69,255,0.18)] focus:outline-none"}),o.jsx(ue,{type:"submit",size:"md",disabled:!s.trim(),className:"px-5 text-sm",children:"Send"})]})})]})]}):o.jsx("div",{className:"flex h-full flex-1 items-center justify-center bg-[#F8F9FA] p-6 text-center text-sm text-[#6C757D]",children:o.jsx("p",{className:"max-w-xs",children:"Select a conversation to start messaging a creator. After your next FanMeet, their chat will appear here."})})})]})}const Vbe={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"};function Bbe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState([]),[f,g]=L.useState(""),[v,y]=L.useState(""),[w,T]=L.useState(!1),[S,I]=L.useState(!0),[j,B]=L.useState(null),[A,F]=L.useState(""),[D,R]=L.useState(!1);L.useEffect(()=>{(async()=>{if(!s){I(!1);return}const{data:J,error:$}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at").eq("user_id",s.id).order("created_at",{ascending:!1});if($||!J){console.error("Error fetching support tickets:",$),a([]),I(!1);return}a(J.map(q=>({id:q.id,subject:q.subject,description:q.description,status:q.status,createdAt:q.created_at,updatedAt:q.updated_at}))),I(!1)})()},[s]),L.useEffect(()=>{(async()=>{if(!j){u([]);return}const{data:J,error:$}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at").eq("ticket_id",j).order("created_at",{ascending:!0});if($||!J){console.error("Error fetching replies:",$),u([]);return}u(J.map(q=>({id:q.id,message:q.message,isAdminReply:q.is_admin_reply,createdAt:q.created_at})))})()},[j]);const O=async()=>{if(!s||!j||!A.trim()){alert("Please enter a message.");return}R(!0);try{const{error:G}=await ie.from("ticket_replies").insert({ticket_id:j,user_id:s.id,message:A.trim(),is_admin_reply:!1});if(G){console.error("Error sending reply:",G),alert("Failed to send reply.");return}u(J=>[...J,{id:`temp-${Date.now()}`,message:A.trim(),isAdminReply:!1,createdAt:new Date().toISOString()}]),F(""),alert("Reply sent! Our support team will respond soon.")}finally{R(!1)}};n.find(G=>G.id===j);const V=async()=>{if(!s){alert("Please log in to raise a support ticket.");return}if(!f.trim()||!v.trim()){alert("Please enter a subject and description.");return}T(!0);try{const{data:G,error:J}=await ie.from("support_tickets").insert({user_id:s.id,subject:f.trim(),description:v.trim(),status:"open"}).select("id, subject, description, status, created_at, updated_at").single();if(J||!G){console.error("Error creating support ticket:",J),alert("Failed to create support ticket.");return}a($=>[{id:G.id,subject:G.subject,description:G.description,status:G.status,createdAt:G.created_at,updatedAt:G.updated_at},...$]),g(""),y(""),alert("Support ticket created successfully. Our team will get back to you.")}finally{T(!1)}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs(pe,{children:[o.jsx(Ne,{title:"Help & Support",subtitle:"Raise a ticket if you face issues with payments, meets, or your account."}),o.jsxs(be,{className:"gap-4",children:[o.jsx(ls,{label:"Subject",rows:2,placeholder:"Briefly describe your issue",value:f,onChange:G=>g(G.target.value)}),o.jsx(ls,{label:"Details",rows:5,placeholder:"Share as many details as possible, including event names, creators, dates, and screenshots where relevant.",value:v,onChange:G=>y(G.target.value)}),o.jsx(ue,{onClick:V,disabled:w,children:w?"Submitting":"Submit Ticket"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Your Tickets",subtitle:"Click a ticket to view the conversation and reply."}),o.jsx(be,{className:"flex flex-col gap-3",children:S?o.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading tickets"}):n.length===0?o.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"You have not raised any tickets yet."}):n.map(G=>o.jsxs("div",{children:[o.jsxs("button",{type:"button",onClick:()=>B(j===G.id?null:G.id),className:`w-full text-left rounded-[12px] border p-4 text-sm text-[#212529] transition-all ${j===G.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-white hover:border-[#C045FF]/50"}`,children:[o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"font-semibold",children:G.subject}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:Bt(G.createdAt)})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ye,{variant:Vbe[G.status],children:G.status.replace("_"," ")}),o.jsx("span",{className:"text-[#6C757D]",children:j===G.id?"":""})]})]}),o.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-[#6C757D] whitespace-pre-line",children:G.description})]}),j===G.id&&o.jsxs("div",{className:"mt-2 ml-4 border-l-2 border-[#C045FF] pl-4 space-y-4",children:[o.jsx("div",{className:"space-y-3",children:l.length===0?o.jsx("p",{className:"text-sm text-[#6C757D] py-2",children:"No replies yet. Our support team will respond soon."}):l.map(J=>o.jsxs("div",{className:`rounded-[10px] p-3 text-sm ${J.isAdminReply?"bg-[#F4E6FF] border-l-4 border-[#C045FF]":"bg-[#F8F9FA]"}`,children:[o.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[o.jsx("span",{className:`font-semibold ${J.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:J.isAdminReply?" Support Team":"You"}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:Bt(J.createdAt)})]}),o.jsx("p",{className:"text-[#212529] whitespace-pre-line",children:J.message})]},J.id))}),G.status!=="closed"&&G.status!=="resolved"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx(ls,{label:"Reply to this ticket",rows:3,placeholder:"Type your message...",value:A,onChange:J=>F(J.target.value)}),o.jsx(ue,{size:"sm",onClick:O,disabled:D||!A.trim(),children:D?"Sending...":"Send Reply"})]}),(G.status==="closed"||G.status==="resolved")&&o.jsxs("p",{className:"text-sm text-[#6C757D] italic",children:["This ticket is ",G.status,". Create a new ticket if you need further assistance."]})]})]},G.id))})]})]})}const Wbe=[{value:"all",label:"All Events",emoji:""},{value:"entertainment",label:"Entertainment",emoji:""},{value:"music",label:"Music",emoji:""},{value:"education",label:"Education",emoji:""},{value:"fitness",label:"Fitness",emoji:""},{value:"gaming",label:"Gaming",emoji:""},{value:"lifestyle",label:"Lifestyle",emoji:""},{value:"general",label:"General",emoji:""}],Gbe=[{value:"popular",label:"Most Popular"},{value:"ending-soon",label:"Ending Soon"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"},{value:"newest",label:"Newly Added"}],Iy=20;function Hbe(){const s=Fs(),[n,a]=Yg(),{events:l}=qo(),[u,f]=L.useState(n.get("category")||"all"),[g,v]=L.useState(n.get("sort")||"popular"),[y,w]=L.useState(n.get("q")||""),[T,S]=L.useState(parseInt(n.get("page")||"1",10));L.useEffect(()=>{const D=new URLSearchParams;u!=="all"&&D.set("category",u),g!=="popular"&&D.set("sort",g),y&&D.set("q",y),T>1&&D.set("page",String(T)),a(D,{replace:!0})},[u,g,y,T]);const I=L.useMemo(()=>[...l.filter(O=>{var V;if(u!=="all"&&O.category!==u)return!1;if(y){const G=y.toLowerCase();return O.title.toLowerCase().includes(G)||O.creatorDisplayName.toLowerCase().includes(G)||((V=O.description)==null?void 0:V.toLowerCase().includes(G))}return!0})].sort((O,V)=>{switch(g){case"popular":return V.participants-O.participants;case"price-low":return O.basePrice-V.basePrice;case"price-high":return V.basePrice-O.basePrice;case"newest":return V.id.localeCompare(O.id);case"ending-soon":const G=J=>J.includes("Closed")?999999:J.includes("days")?parseInt(J)*24*60:J.includes("hours")?parseInt(J)*60:J.includes("minutes")?parseInt(J):0;return G(O.endsIn)-G(V.endsIn);default:return 0}}),[l,u,g,y]),j=Math.ceil(I.length/Iy),B=(T-1)*Iy,A=I.slice(B,B+Iy);L.useEffect(()=>{S(1)},[u,g,y]);const F=D=>{S(D),window.scrollTo({top:0,behavior:"smooth"})};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"All Events"}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Browse through all ",I.length," available events"]})]}),o.jsx(ue,{variant:"secondary",onClick:()=>s("/fan"),children:" Back to Dashboard"})]}),o.jsx(pe,{children:o.jsxs(be,{className:"gap-6",children:[o.jsxs("div",{className:"relative",children:[o.jsx("input",{type:"text",placeholder:"Search events or creators...",value:y,onChange:D=>w(D.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),o.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Categories"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:Wbe.map(D=>o.jsxs("button",{onClick:()=>f(D.value),className:`rounded-full border-2 px-4 py-2 text-sm font-medium transition-all ${u===D.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:[o.jsx("span",{className:"mr-1",children:D.emoji}),D.label]},D.value))})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Sort By"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:Gbe.map(D=>o.jsx("button",{onClick:()=>v(D.value),className:`rounded-full border-2 px-4 py-2 text-sm font-medium transition-all ${g===D.value?"border-[#C045FF] bg-[#C045FF] text-white":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:D.label},D.value))})]})]})}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("h2",{className:"text-lg font-semibold text-[#212529]",children:[I.length," ",I.length===1?"Event":"Events",I.length>Iy&&o.jsxs("span",{className:"ml-2 text-sm font-normal text-[#6C757D]",children:["(Page ",T," of ",j,")"]})]}),(u!=="all"||y)&&o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>{f("all"),w("")},children:"Clear Filters"})]}),A.length===0?o.jsx(pe,{children:o.jsxs(be,{className:"py-12 text-center",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),o.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Try adjusting your filters or search query"}),o.jsx(ue,{onClick:()=>{f("all"),w("")},children:"Clear Filters"})]})}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:A.map(D=>o.jsx(pe,{className:"group cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>s(`/events/${D.id}`),children:o.jsxs(be,{className:"gap-4",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"mb-1 text-xs text-[#6C757D]",children:D.creatorDisplayName}),o.jsx("h3",{className:"text-base font-semibold text-[#212529] group-hover:text-[#C045FF]",children:D.title})]}),D.status==="Accepting Bids"?o.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:o.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):o.jsx(Ye,{variant:D.status==="LIVE"?"danger":"primary",children:D.status})]}),D.description&&o.jsx("p",{className:"line-clamp-2 text-sm text-[#6C757D]",children:D.description}),o.jsxs("div",{className:"flex items-center justify-between text-sm",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-xs text-[#6C757D]",children:"Current Bid"}),o.jsx("div",{className:"font-semibold text-[#C045FF]",children:Ue(D.currentBid)})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-xs text-[#6C757D]",children:"Base Price"}),o.jsx("div",{className:"font-semibold text-[#212529]",children:Ue(D.basePrice)})]})]}),o.jsxs("div",{className:"flex items-center justify-between border-t border-[#E9ECEF] pt-3 text-xs text-[#6C757D]",children:[o.jsxs("span",{children:[" ",D.participants," bidding"]}),o.jsxs("span",{children:[" ",D.endsIn]})]}),o.jsx(ue,{className:"w-full",size:"sm",children:"View & Bid "})]})},D.id))}),j>1&&o.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>F(T-1),disabled:T===1,children:" Previous"}),o.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:j},(D,R)=>R+1).map(D=>{const R=D===1||D===j||Math.abs(D-T)<=1,O=D===2&&T>3||D===j-1&&T<j-2;return!R&&!O?null:O&&!R?o.jsx("span",{className:"px-2 text-[#6C757D]",children:"..."},D):o.jsx("button",{onClick:()=>F(D),className:`min-w-[36px] rounded-lg px-3 py-2 text-sm font-medium transition-all ${T===D?"bg-[#C045FF] text-white":"bg-[#F8F9FA] text-[#6C757D] hover:bg-[#E9ECEF]"}`,children:D},D)})}),o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>F(T+1),disabled:T===j,children:"Next "})]})]})]})}const zbe="your_cloud_name",Kbe="fanmeet_profiles";function qbe(s){const n=typeof s=="string"?new Date(s):s,a=Date.now()-n.getTime(),l=Math.floor(a/1e3);if(l<60)return"Just now";const u=Math.floor(l/60);if(u<60)return`${u} min${u===1?"":"s"} ago`;const f=Math.floor(u/60);if(f<24)return`${f} hour${f===1?"":"s"} ago`;const g=Math.floor(f/24);if(g<7)return`${g} day${g===1?"":"s"} ago`;const v=Math.floor(g/7);return`${v} week${v===1?"":"s"} ago`}function Ybe(s){const n=s.trim();if(!n)return"";const a=n.split(/\s+/);return a.length===1?a[0].slice(0,2).toUpperCase():`${a[0][0]}${a[1][0]}`.toUpperCase()}function $be(){var De,Xe,Oe;const s=Fs(),{user:n}=mr(),{events:a}=qo(),[l,u]=L.useState([]),[f,g]=L.useState(!1),[v,y]=L.useState(0),[w,T]=L.useState(0),[S,I]=L.useState(0),[j,B]=L.useState(void 0),[A,F]=L.useState([]),[D,R]=L.useState(!1),[O,V]=L.useState(null),[G,J]=L.useState(""),[$,q]=L.useState(!1),ee=L.useRef(null);L.useEffect(()=>{(async()=>{if(!n)return;const{data:Ee}=await ie.from("profiles").select("profile_photo_url, display_name").eq("user_id",n.id).single();Ee&&(V(Ee.profile_photo_url||null),J(Ee.display_name||""))})()},[n]);const ne=async ae=>{var Le;const Ee=(Le=ae.target.files)==null?void 0:Le[0];if(!(!Ee||!n)){if(!Ee.type.startsWith("image/")){alert("Please select an image file.");return}if(Ee.size>5*1024*1024){alert("Image must be less than 5MB.");return}q(!0);try{const Ke=new FormData;Ke.append("file",Ee),Ke.append("upload_preset",Kbe),Ke.append("folder","fanmeet/profiles");const He=await fetch(`https://api.cloudinary.com/v1_1/${zbe}/image/upload`,{method:"POST",body:Ke});if(!He.ok)throw new Error("Upload failed");const gt=await He.json();await ie.from("profiles").update({profile_photo_url:gt.secure_url}).eq("user_id",n.id),V(gt.secure_url),alert("Profile photo updated!")}catch(Ke){console.error("Upload error:",Ke),alert("Failed to upload photo.")}finally{q(!1),ee.current&&(ee.current.value="")}}},de=async()=>{if(!(!n||!confirm("Remove your profile photo?"))){q(!0);try{await ie.from("profiles").update({profile_photo_url:null}).eq("user_id",n.id),V(null),alert("Profile photo removed.")}catch{alert("Failed to remove photo.")}finally{q(!1)}}};L.useEffect(()=>{(async()=>{g(!0);try{const Ee=new Date,Le=new Date(Ee.getFullYear(),Ee.getMonth(),1),Ke=new Date(Ee.getFullYear(),Ee.getMonth()+1,1),{data:He,error:gt}=await ie.from("bids").select("event_id, amount, status, created_at").eq("status","won").gte("created_at",Le.toISOString()).lt("created_at",Ke.toISOString());if(gt||!He||He.length===0){u([]);return}const yt=Array.from(new Set(He.map(Kt=>Kt.event_id)));if(yt.length===0){u([]);return}const{data:It,error:Ct}=await ie.from("events").select("id, creator_id").in("id",yt);if(Ct||!It||It.length===0){u([]);return}const et=new Map(It.map(Kt=>[Kt.id,Kt.creator_id])),We=new Map;for(const Kt of He){const Ht=et.get(Kt.event_id);if(!Ht)continue;const ft=We.get(Ht)??0;We.set(Ht,ft+(Kt.amount??0))}if(We.size===0){u([]);return}const Ze=Array.from(We.entries()).sort((Kt,Ht)=>Ht[1]-Kt[1]).slice(0,3),ye=Ze.map(([Kt])=>Kt),{data:Pe}=await ie.from("profiles").select("user_id, display_name, username, category").in("user_id",ye),$e=new Map((Pe??[]).map(Kt=>[Kt.user_id,Kt])),kt=Ze.map(([Kt,Ht])=>{const ft=$e.get(Kt),dr=(ft==null?void 0:ft.display_name)||(ft==null?void 0:ft.username)||"Creator",jt=ft!=null&&ft.username?`@${ft.username}`:"@creator",Pr=(ft==null?void 0:ft.category)||"general";return{id:Kt,displayName:dr,handle:jt,category:Pr,earnings:Ht,initials:Ybe(dr)}});u(kt)}finally{g(!1)}})()},[]),L.useEffect(()=>{(async()=>{if(!n){y(0),T(0),I(0),F([]),B(void 0);return}R(!0);try{let Ee=0,Le=0,Ke;const{count:He}=await ie.from("meets").select("id",{count:"exact",head:!0}).eq("creator_id",n.id).eq("status","completed");I(typeof He=="number"?He:0);const{data:gt}=await ie.from("events").select("id, title").eq("creator_id",n.id),yt=new Map((gt??[]).map(ye=>[ye.id,ye.title])),It=Array.from(yt.keys()),Ct=[];if(It.length>0){const{data:ye}=await ie.from("bids").select("id, event_id, amount, status, created_at").in("event_id",It).order("created_at",{ascending:!1}),Pe=(ye??[]).filter($e=>$e.status==="won");if(Pe.length>0){const $e=new Date;Ee=Pe.reduce((dr,jt)=>dr+(jt.amount??0),0);const kt=new Date($e.getFullYear(),$e.getMonth(),1),Kt=new Date($e.getFullYear(),$e.getMonth()-1,1),Ht=Pe.filter(dr=>new Date(dr.created_at)>=kt).reduce((dr,jt)=>dr+(jt.amount??0),0),ft=Pe.filter(dr=>{const jt=new Date(dr.created_at);return jt>=Kt&&jt<kt}).reduce((dr,jt)=>dr+(jt.amount??0),0);if(ft>0){const dr=(Ht-ft)/ft*100,jt=Math.round(dr);Ke=`${jt>=0?"+":""}${jt}% vs last month`}else Ht>0?Ke="New this month":Ke=void 0}(ye??[]).forEach($e=>{const kt=yt.get($e.event_id)??"Event";Ct.push({id:`bid-${$e.id}`,description:`New bid of ${Ue($e.amount)} on ${kt}`,createdAt:$e.created_at})})}const{data:et}=await ie.from("withdrawal_requests").select("id, amount, status, requested_at").eq("creator_id",n.id).order("requested_at",{ascending:!1}).limit(10);let We=0;(et??[]).forEach(ye=>{ye.status==="completed"&&(We+=ye.amount??0),Ct.push({id:`wd-${ye.id}`,description:`Withdrawal request of ${Ue(ye.amount)} (${ye.status})`,createdAt:ye.requested_at})}),Le=Math.max(Ee-We,0),y(Ee),T(Le),B(Ke),Ct.sort((ye,Pe)=>new Date(Pe.createdAt).getTime()-new Date(ye.createdAt).getTime());const Ze=Ct.slice(0,10).map(ye=>({id:ye.id,description:ye.description,time:qbe(ye.createdAt)}));F(Ze)}finally{R(!1)}})()},[n]);const ve=(n?a.filter(ae=>ae.creatorUsername===n.username):[]).filter(ae=>ae.status==="LIVE"||ae.status==="Upcoming").length,_e=[{id:"stat-1",icon:"",title:"Total Earnings",value:v,change:j},{id:"stat-2",icon:"",title:"Active Events",value:ve.toString(),caption:`${ve} upcoming or live`},{id:"stat-3",icon:"",title:"Pending Balance",value:w,action:"Withdraw "},{id:"meets",icon:"",title:"Completed Meets",value:S.toString(),caption:"Happy fans across sessions"}];return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx(pe,{elevated:!0,className:"border-none",children:o.jsx(be,{className:"gap-4",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"relative",children:O?o.jsx("img",{src:O,alt:"Profile",className:"h-20 w-20 rounded-full object-cover ring-2 ring-[#C045FF]/30"}):o.jsx("div",{className:"h-20 w-20 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-2xl ring-2 ring-[#C045FF]/30",children:((De=G==null?void 0:G.charAt(0))==null?void 0:De.toUpperCase())||((Oe=(Xe=n==null?void 0:n.email)==null?void 0:Xe.charAt(0))==null?void 0:Oe.toUpperCase())||"?"})}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:G||"Creator"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:n==null?void 0:n.email})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{ref:ee,type:"file",accept:"image/*",onChange:ne,className:"hidden"}),o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>{var ae;return(ae=ee.current)==null?void 0:ae.click()},disabled:$,children:$?"Uploading...":O?"Change Photo":"Add Photo"}),O&&o.jsx(ue,{variant:"ghost",size:"sm",onClick:de,disabled:$,className:"text-red-500 hover:text-red-600",children:"Remove"})]})]})]})})}),o.jsx(pe,{elevated:!0,className:"overflow-hidden border-none bg-gradient-to-r from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] shadow-[0_24px_60px_rgba(160,64,255,0.18)]",children:o.jsxs("div",{className:"relative flex flex-col gap-6 px-6 py-6 md:flex-row md:items-center md:px-8 md:py-8",children:[o.jsxs("div",{className:"max-w-xl space-y-3",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Creator earnings"}),o.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"See how top creators earn with FanMeet."}),o.jsx("p",{className:"text-sm text-[#6C757D] md:text-base",children:"Track your revenue, learn from other creators, and turn every 1:1 meet into predictable income."}),o.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:o.jsx("span",{className:"text-xs text-[#6C757D]",children:"Your personal earnings, events, and activity summary are updated live from your FanMeet account."})})]}),o.jsxs("div",{className:"mt-4 w-full max-w-md rounded-[20px] bg-white/90 p-4 shadow-[0_18px_45px_rgba(15,23,42,0.18)] md:ml-auto md:mt-0",children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:"Top creators this month"})}),o.jsx("div",{className:"mt-3 space-y-3",children:f?o.jsx("div",{className:"text-xs text-[#6C757D]",children:"Loading top creators"}):l.length===0?o.jsx("div",{className:"text-xs text-[#6C757D]",children:"No earnings data yet this month."}):l.map(ae=>o.jsxs("div",{className:"flex items-center justify-between rounded-[12px] bg-[#F8F9FA] px-3 py-2 text-sm",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] text-xs font-semibold text-white",children:ae.initials}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"font-semibold text-[#212529]",children:ae.displayName}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:[ae.handle,"  ",ae.category]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-sm font-bold text-[#050014]",children:Ue(ae.earnings)}),o.jsx("div",{className:"text-xs text-[#6C757D]",children:"This month"})]})]},ae.id))})]})]})}),o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl font-semibold text-[#212529]",children:"Overview"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"High-level snapshot of your performance."})]}),o.jsx(ue,{variant:"primary",className:"bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>s("/creator/events/new"),children:"Create Event "})]}),o.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-4",children:_e.map(ae=>o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:ae.icon}),o.jsx("span",{children:ae.title})]})}),o.jsxs(be,{className:"gap-2",children:[o.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:typeof ae.value=="number"?Ue(ae.value):ae.value}),ae.change?o.jsx(Ye,{variant:"success",className:"w-fit",children:ae.change}):null,ae.caption?o.jsx("p",{className:"text-sm text-[#6C757D]",children:ae.caption}):null,ae.action?o.jsx(ue,{variant:"primary",size:"sm",className:"mt-2 w-fit bg-[#050014] text-white hover:bg-[#140423]",children:ae.action}):null]})]},ae.id))}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Recent Activity",subtitle:"Latest updates from your events and fans"}),o.jsx(be,{className:"gap-4",children:D&&A.length===0?o.jsx("div",{className:"text-sm text-[#6C757D]",children:"Loading activity"}):A.length===0?o.jsx("div",{className:"text-sm text-[#6C757D]",children:"No recent activity yet."}):A.map(ae=>o.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[o.jsx("div",{children:ae.description}),o.jsx("div",{className:"text-xs text-[#6C757D]",children:ae.time})]},ae.id))})]})]})}function Xbe(){const s=Fs(),{user:n}=mr(),{events:a,finalizeEvent:l}=qo(),u=(n==null?void 0:n.role)==="creator"?n.username:null,f=u?a.filter(v=>v.creatorUsername===u):[],g=v=>{const y=`${window.location.origin}/events/${v}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(y).then(()=>{window.alert("Share link copied to clipboard. Send it to your fans to start receiving bids.")},()=>{window.prompt("Share this link with your fans:",y)}):window.prompt("Share this link with your fans:",y)};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Events"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage and monitor all of your scheduled sessions."})]}),o.jsx("div",{className:"flex gap-2",children:["All","Upcoming","Live","Completed"].map(v=>o.jsx(ue,{size:"sm",variant:v==="All"?"primary":"secondary",className:"rounded-full px-4",children:v},v))})]}),o.jsx("div",{className:"flex flex-col gap-6",children:u&&f.length>0?f.map(v=>o.jsxs(pe,{elevated:!0,className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[o.jsxs("div",{className:"flex-1 space-y-3",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsx(Ye,{variant:v.status==="LIVE"?"danger":"primary",children:v.status==="LIVE"?" LIVE":v.status}),o.jsx("span",{className:"text-sm text-[#6C757D]",children:v.date})]}),o.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:v.title}),o.jsxs("div",{className:"text-sm text-[#6C757D]",children:["Duration: ",v.duration,"  Base Price: ",Ue(v.basePrice)]}),o.jsxs("div",{className:"grid gap-2 rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm",children:[o.jsxs("span",{children:[" Current Bid:"," ",o.jsx("strong",{className:"text-[#212529]",children:Ue(v.currentBid)})]}),o.jsxs("span",{children:[" ",v.participants," participants"]}),o.jsxs("span",{children:[" ",v.endsIn]})]})]}),o.jsxs("div",{className:"flex flex-wrap gap-3",children:[o.jsx(ue,{variant:"secondary",children:"Edit"}),o.jsx(ue,{variant:"danger",children:"Delete"}),o.jsx(ue,{onClick:()=>g(v.id),children:"Copy Link"}),(v.status==="Accepting Bids"||v.status==="Upcoming")&&o.jsx(ue,{variant:"primary",className:"bg-green-600 hover:bg-green-700 text-white border-none",onClick:async()=>{if(window.confirm("Close bidding and generate meeting link for the highest bidder?"))try{await l(v.id),window.alert('Success! Meeting created. Check "My Meets" tab.')}catch{window.alert("Error finalizing event. Please try again.")}},children:"End Bidding & Create Meet"}),o.jsx(ue,{variant:"ghost",onClick:()=>s(`/events/${v.id}`),children:"View Details "})]})]},v.id)):o.jsx(pe,{elevated:!0,className:"grid min-h-[220px] place-items-center text-center",children:o.jsxs(be,{className:"flex flex-col items-center gap-3",children:[o.jsx("span",{className:"text-4xl",children:""}),o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:"No events yet"}),o.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Create your first FanMeet event to start receiving bids. Once created, youll see it listed here and can share your public link with fans."})]})})})]})}const Jbe=["50","100","150"],Qbe=["5 minutes","10 minutes","15 minutes"];function Zbe(){const s=Fs(),{user:n}=mr(),{createEvent:a}=qo(),[l,u]=L.useState(""),[f,g]=L.useState(""),[v,y]=L.useState(null),[w,T]=L.useState(""),[S,I]=L.useState(""),[j,B]=L.useState(""),[A,F]=L.useState(""),[D,R]=L.useState(""),[O,V]=L.useState(""),[G,J]=L.useState("paid"),$=async()=>{if(!n||n.role!=="creator"){window.alert("Please login as a creator to create events."),s("/auth?redirect=/creator/events/new");return}if(n.creatorProfileStatus!=="approved"){const de=n.creatorProfileStatus==="pending"?"Your creator profile is pending approval. Please wait for admin approval before creating events.":"Your creator profile has been rejected. Please contact support for more information.";window.alert(` ${de}`);return}if(!l.trim()||v===null||!w||!S||!j||!A||!D){V("Please fill in all required fields before creating the event.");return}V("");const ne=n.email.split("@")[0]||n.username;try{const de=await a({creatorUsername:n.username,creatorDisplayName:ne,title:l.trim(),description:f.trim()||void 0,basePrice:v,duration:w,date:S,time:j,biddingDeadlineDate:A,biddingDeadlineTime:D,meetingLink:`${window.location.origin}/meet/${crypto.randomUUID()}`}),me=`${window.location.origin}/events/${de.id}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(me).then(()=>{window.alert("Event created! Share link copied to your clipboard.")},()=>{window.prompt("Event created! Share this link with your fans:",me)}):window.prompt("Event created! Share this link with your fans:",me),s("/creator/events")}catch(de){console.error("Failed to create event:",de),V("Failed to create event. Please try again.")}},q=(n==null?void 0:n.creatorProfileStatus)==="approved",ee=(n==null?void 0:n.creatorProfileStatus)==="pending";return o.jsxs("div",{className:"flex flex-col gap-8",children:[n&&n.role==="creator"&&!q&&o.jsx("div",{className:`rounded-[12px] p-4 ${ee?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:ee?"":""}),o.jsxs("div",{children:[o.jsx("h3",{className:`font-semibold ${ee?"text-yellow-800":"text-red-800"}`,children:ee?"Profile Pending Approval":"Profile Not Approved"}),o.jsx("p",{className:`text-sm ${ee?"text-yellow-700":"text-red-700"}`,children:ee?"Your creator profile is being reviewed by our team. You cannot create events until approved.":"Your creator profile was not approved. Please contact support for more information."})]})]})}),o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Create New Event"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Set up a new live experience for your fans."})]}),o.jsx(Ye,{variant:"primary",className:"px-4 py-2 text-sm",children:"Preview updates in real time"})]}),o.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[o.jsxs(pe,{elevated:!0,className:"p-0",children:[o.jsx(Ne,{title:"Event Details",subtitle:"Provide the basics so fans know what to expect",className:"border-b border-[#E9ECEF] px-8 py-6"}),o.jsxs(be,{className:"gap-6 px-8 py-6",children:[o.jsxs("div",{className:"flex flex-col gap-4",children:[o.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Event Type *"}),o.jsxs("div",{className:"flex flex-wrap gap-3",children:[o.jsx(ue,{variant:G==="paid"?"secondary":"ghost",size:"sm",className:"rounded-[8px]",onClick:()=>{J("paid"),y(null)},children:"Paid Event"}),o.jsx(ue,{variant:G==="free"?"secondary":"ghost",size:"sm",className:"rounded-[8px]",onClick:()=>{J("free"),y(0)},children:"Free Event"})]})]}),o.jsx(nt,{label:"Event Title *",placeholder:"Give your event an exciting headline",required:!0,value:l,onChange:ne=>u(ne.target.value)}),o.jsx(ls,{label:"Description",placeholder:"Describe the experience, topics, or value fans will get.",rows:5,value:f,onChange:ne=>g(ne.target.value)}),o.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Base Price *"}),o.jsx("div",{className:"flex flex-wrap gap-3",children:G==="free"?o.jsx(ue,{variant:"primary",size:"sm",className:"rounded-[8px]",disabled:!0,children:"Free (0)"}):Jbe.map(ne=>{const de=parseInt(ne.replace(/[^0-9]/g,""),10)||0,me=v===de;return o.jsx(ue,{variant:me?"primary":"secondary",size:"sm",className:"rounded-[8px]",onClick:()=>y(de),children:ne},ne)})})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Duration *"}),o.jsx("div",{className:"flex flex-wrap gap-3",children:Qbe.map(ne=>o.jsx(ue,{variant:w===ne?"primary":"secondary",size:"sm",className:"rounded-[8px]",onClick:()=>T(ne),children:ne},ne))})]})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{type:"date",label:"Event Date *",required:!0,value:S,onChange:ne=>I(ne.target.value)}),o.jsx(nt,{type:"time",label:"Event Time *",required:!0,value:j,onChange:ne=>B(ne.target.value)})]}),o.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[o.jsx("div",{className:"mb-3 text-sm font-semibold text-[#212529]",children:" Bidding Window *"}),o.jsx("p",{className:"mb-4 text-xs text-[#6C757D]",children:"Set when bidding closes. Fans can bid until this time, and the highest bidder wins."}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{type:"date",label:"Bidding Closes Date *",required:!0,value:A,onChange:ne=>F(ne.target.value)}),o.jsx(nt,{type:"time",label:"Bidding Closes Time *",required:!0,value:D,onChange:ne=>R(ne.target.value)})]})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Cover Image (optional)"}),o.jsxs("div",{className:"flex h-44 flex-col items-center justify-center gap-3 rounded-[16px] border-2 border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsx("span",{className:"text-sm font-medium text-[#212529]",children:"Drag & Drop or click to upload"}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:"JPG, PNG, or WEBP up to 5MB"}),o.jsx(ue,{size:"sm",variant:"secondary",children:"Browse Files"})]})]}),O?o.jsx("p",{className:"text-sm font-medium text-[#DC3545]",children:O}):null]}),o.jsxs("div",{className:"flex justify-end gap-3 border-t border-[#E9ECEF] px-8 py-6",children:[o.jsx(ue,{variant:"secondary",children:"Cancel"}),o.jsx(ue,{onClick:$,children:"Create Event "})]})]}),o.jsxs(pe,{className:"h-fit",children:[o.jsx(Ne,{title:"Preview",subtitle:"Fans will see this layout before bidding"}),o.jsxs(be,{className:"gap-4",children:[o.jsx("div",{className:"h-32 rounded-[16px] bg-gradient-to-br from-[#FFE5D9] to-white"}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:"Meet & Greet - Q&A Session"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Jan 15  4:00 PM IST  10 minutes"})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsx(Ye,{variant:"danger",children:" LIVE SOON"}),o.jsx(Ye,{variant:"primary",children:"Base Price: 100"})]}),o.jsx("div",{className:"rounded-[12px] bg-[#F8F9FA] p-4 text-sm text-[#6C757D]",children:"Fans can view event info, schedule, and place their bids here."})]})]})]})]})}const WH=L.createContext(void 0),ewe=()=>`${Date.now()}-${Math.random().toString(16).slice(2)}`,twe=({children:s})=>{const[n,a]=L.useState([]),[l,u]=L.useState([]),{user:f}=mr(),[g,v]=L.useState([]);L.useEffect(()=>{(async()=>{const{data:R,error:O}=await ie.from("profiles").select("username, display_name, bio, profile_photo_url");if(O){console.error("Error fetching profiles:",O);return}R&&a(R.map(V=>({username:V.username,displayName:V.display_name||"",bio:V.bio||"",profilePhotoUrl:V.profile_photo_url||void 0})))})()},[]),L.useEffect(()=>{if(!f){v([]);return}(async()=>{const{data:R,error:O}=await ie.from("creator_follows").select("creator_id").eq("fan_id",f.id);if(O){console.error("Error fetching following:",O);return}if(R&&R.length>0){const V=R.map($=>$.creator_id),{data:G}=await ie.from("profiles").select("username").in("user_id",V),J=(G==null?void 0:G.map($=>$.username).filter(Boolean))||[];v(J)}})()},[f]);const y=D=>n.find(R=>R.username===D),w=async({username:D,displayName:R,bio:O})=>{const V=n.find(J=>J.username===D),G={username:D,displayName:R,bio:O};if(a(V?J=>J.map($=>$.username===D?G:$):J=>[...J,G]),f){const{error:J}=await ie.from("profiles").upsert({user_id:f.id,username:D,display_name:R,bio:O,updated_at:new Date().toISOString()});J&&console.error("Error updating profile:",J)}return G},T=async D=>{if(!f)return;v(V=>[...V,D]);const{data:R}=await ie.from("profiles").select("user_id").eq("username",D).single();if(!R)return;const{error:O}=await ie.from("creator_follows").insert({fan_id:f.id,creator_id:R.user_id});O&&(console.error("Error following creator:",O),v(V=>V.filter(G=>G!==D)))},S=async D=>{if(!f)return;v(V=>V.filter(G=>G!==D));const{data:R}=await ie.from("profiles").select("user_id").eq("username",D).single();if(!R)return;const{error:O}=await ie.from("creator_follows").delete().eq("fan_id",f.id).eq("creator_id",R.user_id);O&&(console.error("Error unfollowing creator:",O),v(V=>[...V,D]))},I=D=>l.filter(R=>R.username===D).sort((R,O)=>R.id<O.id?1:-1),j=({username:D,text:R})=>{const O=R.trim();if(!O)throw new Error("Post text cannot be empty");const V={id:ewe(),username:D,text:O,createdAtLabel:"Just now"};return u(G=>[V,...G]),V},B=(D,R)=>{u(O=>O.map(V=>V.id===D?{...V,text:R.trim()}:V))},A=D=>{u(R=>R.filter(O=>O.id!==D))},F=L.useMemo(()=>({profiles:n,posts:l,following:g,getProfile:y,upsertProfile:w,followCreator:T,unfollowCreator:S,getPostsForCreator:I,addPost:j,updatePost:B,deletePost:A}),[n,l,g]);return o.jsx(WH.Provider,{value:F,children:s})},KI=()=>{const s=L.useContext(WH);if(!s)throw new Error("useCreatorProfiles must be used within a CreatorProfileProvider");return s};function rwe(){const{user:s}=mr(),{getProfile:n,upsertProfile:a}=KI();if(!s||s.role!=="creator")return o.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[o.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Creator profile setup"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Please sign in as a creator to edit your public profile."})]});const l=n(s.username),u=(l==null?void 0:l.displayName)||s.email.split("@")[0]||s.username,f=(l==null?void 0:l.bio)||"Tell fans who you are, what you create, and what kind of micro-meets or AMAs they can expect.",[g,v]=L.useState(u),[y,w]=L.useState(f),[T,S]=L.useState(!1),I=async()=>{await a({username:s.username,displayName:g.trim(),bio:y.trim()}),S(!0),window.setTimeout(()=>S(!1),2e3)},j=()=>{const B=`${window.location.origin}/${s.username}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(B).then(()=>{window.alert("Profile link copied. Share it with your fans.")},()=>{window.prompt("Share this profile link with your fans:",B)}):window.prompt("Share this profile link with your fans:",B)};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Public profile setup"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Update what fans see on your public page."})]}),o.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.3fr)_minmax(0,0.7fr)]",children:[o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Profile details",subtitle:"These details are shown at the top of your public page."}),o.jsxs(be,{className:"gap-5",children:[o.jsx(nt,{label:"Display name",placeholder:"Your public display name",value:g,onChange:B=>v(B.target.value)}),o.jsx(nt,{label:"Public username",value:`@${s.username}`,disabled:!0,helperText:"Your profile link uses this username."}),o.jsx(ls,{label:"Bio",rows:4,value:y,onChange:B=>w(B.target.value),placeholder:"Short description that appears on your public profile."}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(ue,{onClick:I,children:"Save profile"}),T&&o.jsx("span",{className:"text-xs font-medium text-[#28A745]",children:"Saved. Your public page is updated."})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Public page preview",subtitle:"Fans visiting your profile will see something like this."}),o.jsxs(be,{className:"gap-4",children:[o.jsxs("div",{className:"rounded-[16px] bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] p-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"h-10 w-10 rounded-full bg-[#050014] text-center text-sm font-semibold leading-10 text-white",children:g.charAt(0).toUpperCase()}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:g}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",s.username]})]})]}),o.jsx("p",{className:"mt-3 text-xs text-[#6C757D]",children:y})]}),o.jsxs("div",{className:"flex items-center justify-between gap-3 text-xs text-[#6C757D]",children:[o.jsxs("p",{children:["Visit ",o.jsxs("span",{className:"font-mono font-semibold",children:["/",s.username]})," to see your public page in a new tab."]}),o.jsx(ue,{size:"sm",variant:"secondary",onClick:j,children:"Share profile"})]})]})]})]})]})}const swe=10,nwe=s=>Math.floor(s*(100-swe)/100);function iwe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState([]),[f,g]=L.useState(0),[v,y]=L.useState(0),[w,T]=L.useState(0),[S,I]=L.useState(!1);L.useEffect(()=>{(async()=>{if(!s){a([]),u([]),g(0),y(0),T(0);return}I(!0);try{const{data:R,error:O}=await ie.from("events").select("id, title, status, starts_at").eq("creator_id",s.id);if(O||!R||R.length===0){a([]),u([]),g(0),y(0),T(0);return}const V=R.map(He=>He.id),{data:G}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at").in("event_id",V),{data:J}=await ie.from("meets").select("event_id, status").in("event_id",V),$=Array.from(new Set((G??[]).map(He=>He.fan_id).filter(Boolean)));let q=null;if($.length>0){const{data:He}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",$);q=He??[]}const ee=new Map((q??[]).map(He=>[He.user_id,He])),ne=new Map;for(const He of G??[]){const gt=ne.get(He.event_id)??[];gt.push(He),ne.set(He.event_id,gt)}const de=new Map;for(const He of J??[]){const gt=de.get(He.event_id)??[];gt.push(He),de.set(He.event_id,gt)}const me=new Date,ve=new Date(me.getFullYear(),me.getMonth(),1),_e=new Date(me);_e.setDate(me.getDate()-29);let De=0,Xe=0;const Oe=new Map,ae=[];for(const He of R){const gt=ne.get(He.id)??[],yt=gt.length,It=gt.filter(Ht=>Ht.status==="won"),Ct=It.length>0?It.reduce((Ht,ft)=>ft.amount>Ht.amount?ft:Ht,It[0]):null,et=(Ct==null?void 0:Ct.amount)??0,We=nwe(et);let Ze="-",ye=null;if(Ct){const Ht=ee.get(Ct.fan_id);Ze=(Ht==null?void 0:Ht.display_name)||(Ht==null?void 0:Ht.username)||"Winner",ye=new Date(Ct.created_at)}else He.starts_at&&(ye=new Date(He.starts_at));if(We>0&&ye&&(De+=We,ye>=ve&&(Xe+=We),ye>=_e)){const Ht=ye.toISOString().slice(0,10),ft=Oe.get(Ht)??0;Oe.set(Ht,ft+We)}const kt=(de.get(He.id)??[]).some(Ht=>Ht.status==="completed")?"Cleared":"Upcoming",Kt=ye?ye.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}):"-";ae.push({id:He.id,date:Kt,event:He.title,bids:yt,winner:Ze,grossAmount:et,earned:We,status:kt})}const Ee=ae.filter(He=>He.earned>0).length,Le=Ee>0?De/Ee:0,Ke=[];for(let He=0;He<30;He+=1){const gt=new Date(_e);gt.setDate(_e.getDate()+He);const yt=gt.toISOString().slice(0,10),It=Oe.get(yt)??0;Ke.push({dateKey:yt,label:gt.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}),total:It})}ae.sort((He,gt)=>He.date<gt.date?1:-1),a(ae),u(Ke),g(De),y(Xe),T(Le)}finally{I(!1)}})()},[s]);const j=()=>{if(!n.length){alert("No earnings to export yet.");return}const O=[["Date","Event","Bids","Winner","Earned","Status"].join(","),...n.map($=>{const q=ee=>`"${ee.replace(/"/g,'""')}"`;return[q($.date),q($.event),$.bids.toString(),q($.winner),$.earned.toString(),q($.status)].join(",")})].join(`
`),V=new Blob([O],{type:"text/csv;charset=utf-8;"}),G=URL.createObjectURL(V),J=document.createElement("a");J.href=G,J.setAttribute("download","earnings.csv"),document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(G)},B=[{id:"sum-1",title:"Total Earned",value:f},{id:"sum-2",title:"This Month",value:v},{id:"sum-3",title:"Average/Event",value:w}],A=l.reduce((D,R)=>R.total>D?R.total:D,0),F={Cleared:"success",Upcoming:"primary"};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Earnings"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track revenue trends and payment history."})]}),o.jsx(ue,{variant:"secondary",onClick:j,children:"Export CSV"})]}),o.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:B.map(D=>o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:D.title}),o.jsx(be,{children:o.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:S?"":Ue(D.value)})})]},D.id))}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Revenue (Last 30 days)",subtitle:"Visualize how your earnings have changed over time"}),o.jsx(be,{children:o.jsx("div",{className:"flex h-64 items-end gap-1 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] px-4 py-4",children:l.every(D=>D.total===0)?o.jsx("div",{className:"m-auto text-sm text-[#6C757D]",children:"No earnings in the last 30 days."}):o.jsx("div",{className:"flex h-full w-full items-end gap-1",children:l.map(D=>o.jsxs("div",{className:"flex flex-1 flex-col items-center gap-1",children:[o.jsx("div",{className:"flex h-full w-full items-end",children:o.jsx("div",{className:"w-full rounded-t-md bg-[#FF6B35]",style:{height:A>0?`${Math.max(6,D.total/A*100)}%`:"6px"}})}),o.jsx("div",{className:"text-[10px] text-[#6C757D]",children:D.label})]},D.dateKey))})})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Earnings Breakdown"}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Winner"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Net Earnings"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),o.jsx("tbody",{className:"text-[#212529]",children:S&&n.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading earnings"})}):n.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#6C757D]",children:"No earnings yet."})}):n.map(D=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3",children:D.date}),o.jsx("td",{className:"py-3",children:D.event}),o.jsx("td",{className:"py-3",children:D.bids}),o.jsx("td",{className:"py-3",children:D.winner}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"font-medium text-green-600",children:Ue(D.earned)}),D.grossAmount>0&&o.jsxs("span",{className:"text-xs text-[#6C757D]",children:["(Bid: ",Ue(D.grossAmount)," - 10% fee)"]})]})}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:F[D.status]??"primary",children:D.status})})]},D.id))})]})})]})]})}const awe={completed:"success",in_review:"warning",pending:"primary",failed:"danger"},owe={completed:"Completed",in_review:"In review",pending:"Pending",failed:"Failed"},cwe=10,lwe=s=>Math.floor(s*(100-cwe)/100);function dwe(){const{user:s}=mr(),[n,a]=L.useState(0),[l,u]=L.useState(0),[f,g]=L.useState(null),[v,y]=L.useState([]),[w,T]=L.useState(!1),[S,I]=L.useState(!1),[j,B]=L.useState(""),[A,F]=L.useState(""),[D,R]=L.useState(!1),[O,V]=L.useState("");L.useEffect(()=>{(async()=>{if(!s){a(0),u(0),g(null),y([]);return}T(!0);try{const{data:$,error:q}=await ie.from("users").select("role, account_status, creator_profile_status").eq("id",s.id).maybeSingle();if(q||!$){R(!0),V("We could not load your creator profile. Please contact support."),T(!1);return}if($.role!=="creator"){R(!0),V("Withdrawals are only available for creator accounts."),T(!1);return}if($.account_status&&$.account_status!=="active"){R(!0),V("Your creator account is not active. Please contact support."),T(!1);return}if($.creator_profile_status&&$.creator_profile_status!=="approved"){R(!0),V("Your creator profile is not approved yet. Once an admin approves you, withdrawals will be enabled."),T(!1);return}const{data:ee}=await ie.from("profiles").select("bank_account_number, bank_ifsc, upi_id, razorpay_fund_account_id").eq("user_id",s.id).single();if(ee){const Ke=ee.razorpay_fund_account_id?"Linked Payout Account":ee.bank_account_number?`Bank Account ending in ${ee.bank_account_number.slice(-4)}`:ee.upi_id?`UPI: ${ee.upi_id}`:"";Ke&&F(Ke)}const{data:ne}=await ie.from("events").select("id").eq("creator_id",s.id),de=(ne??[]).map(Ke=>Ke.id);let me=0,ve=0;if(de.length>0){const{data:Ke}=await ie.from("bids").select("event_id, amount, status, created_at").in("event_id",de).eq("status","won"),{data:He}=await ie.from("meets").select("event_id, status, updated_at").in("event_id",de),gt=new Map;for(const Ct of He??[]){const et=gt.get(Ct.event_id)??[];et.push(Ct),gt.set(Ct.event_id,et)}const yt=new Date,It=48*60*60*1e3;for(const Ct of Ke??[]){const et=lwe(Ct.amount??0);me+=et;const Ze=(gt.get(Ct.event_id)??[]).find(Pe=>Pe.status==="completed");Ze&&Ze.updated_at&&yt.getTime()-new Date(Ze.updated_at).getTime()>It||(ve+=et)}}const{data:_e}=await ie.from("withdrawal_requests").select("*").eq("creator_id",s.id).order("requested_at",{ascending:!1});let De=0,Xe=0,Oe=null;const ae=[];for(const Ke of _e??[])Ke.status==="completed"?(De+=Ke.amount??0,!Oe&&Ke.processed_at&&(Oe={amount:Ke.amount,processedAt:new Date(Ke.processed_at)})):(Ke.status==="pending"||Ke.status==="in_review")&&(Xe+=Ke.amount??0),ae.push({id:Ke.id,amount:Ke.amount,status:Ke.status,destination:Ke.destination||"Not specified",requestedAt:new Date(Ke.requested_at),processedAt:Ke.processed_at?new Date(Ke.processed_at):null});const Ee=me-ve,Le=Math.max(Ee-De-Xe,0);a(Le),u(ve),g(Oe),y(ae)}finally{T(!1)}})()},[s]);const G=async()=>{if(!s){alert("Please log in to request a withdrawal.");return}if(D){alert(O||"Withdrawals are currently unavailable for your account. Please contact support.");return}const J=parseInt(j,10);if(isNaN(J)||J<=0){alert("Please enter a valid amount.");return}if(J<500){alert("Minimum withdrawal amount is 500.");return}if(J>n){alert(`You can only withdraw up to ${Ue(n)}.`);return}if(!A.trim()){alert("Please enter a destination account.");return}I(!0);try{const{data:$,error:q}=await ie.from("withdrawal_requests").insert({creator_id:s.id,amount:J,destination:A.trim(),status:"pending",requested_at:new Date().toISOString(),created_at:new Date().toISOString()}).select().single();if(q||!$){console.error("Error submitting withdrawal:",q),alert("Failed to submit withdrawal request. Please try again.");return}ie.functions.invoke("trigger-payout",{body:{withdrawal_request_id:$.id}}).then(({error:ee})=>{ee&&console.error("Auto-payout trigger failed:",ee)}),alert(`Withdrawal request of ${Ue(J)} submitted successfully!`),B(""),F(""),a(ee=>ee-J),y(ee=>[{id:`temp-${Date.now()}`,amount:J,status:"pending",destination:A.trim(),requestedAt:new Date,processedAt:null},...ee])}finally{I(!1)}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Withdrawals"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track your payout requests, bank destinations, and release timelines."})]}),o.jsxs("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]",children:[o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Available Balance",subtitle:"Withdraw to your linked account any time."}),o.jsxs(be,{className:"gap-6",children:[o.jsxs("div",{className:"rounded-[16px] bg-[#F4E6FF]/60 p-6",children:[o.jsx("span",{className:"text-sm text-[#6C757D]",children:"Ready to withdraw"}),o.jsx("p",{className:"text-4xl font-bold text-[#C045FF]",children:w?"":Ue(n)})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[o.jsx("span",{className:"text-sm text-[#6C757D]",children:"Pending clearance"}),o.jsx("p",{className:"text-xl font-semibold text-[#212529]",children:w?"":Ue(l)}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Net earnings (90%) after 10% platform fee. Available after 48 hours."})]}),o.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[o.jsx("span",{className:"text-sm text-[#6C757D]",children:"Last payout"}),o.jsx("p",{className:"text-xl font-semibold text-[#212529]",children:w?"":f?Ue(f.amount):""}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:f?`Processed ${Bt(f.processedAt)}`:"No payouts yet"})]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Request Withdrawal",subtitle:"Transfers typically arrive in 2-3 business days."}),o.jsxs(be,{className:"gap-5",children:[D&&o.jsx("div",{className:"rounded-[12px] border border-[#FECACA] bg-[#FFF5F5] p-3 text-xs text-[#B91C1C]",children:O}),o.jsxs("div",{className:"grid gap-4",children:[o.jsx(nt,{label:"Amount",placeholder:"5,000",type:"number",min:500,step:100,value:j,onChange:J=>B(J.target.value)}),o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx(nt,{label:"Destination account",placeholder:"No linked account",value:A,disabled:!0,onChange:()=>{}}),!A&&o.jsxs("p",{className:"text-xs text-red-500",children:["Please ",o.jsx(Rl,{to:"/creator/settings",className:"underline",children:"add your bank details"})," in settings to withdraw."]}),A&&o.jsxs("p",{className:"text-xs text-[#6C757D]",children:["To change this, go to ",o.jsx(Rl,{to:"/creator/settings",className:"underline",children:"Settings"}),"."]})]})]}),o.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-4 text-sm text-[#6C757D]",children:["Note: We process withdrawals above 500. Ensure your KYC details are up to date for smoother payouts.",n>0&&o.jsxs("span",{className:"mt-1 block font-medium text-[#212529]",children:["Maximum available: ",Ue(n)]})]}),o.jsx(ue,{size:"lg",onClick:G,disabled:S||n<500||D,children:S?"Submitting":"Submit request"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Payout History",subtitle:"A log of all recent withdrawal activity.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsx(be,{className:"gap-4",children:w&&v.length===0?o.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading payout history"}):v.length===0?o.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No withdrawal requests yet."}):v.map(J=>o.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsx(Ye,{variant:awe[J.status]??"default",children:owe[J.status]??J.status}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Requested ",Bt(J.requestedAt)]})]}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Destination: ",J.destination]})]}),o.jsxs("div",{className:"flex flex-col items-end gap-1",children:[o.jsx("span",{className:"text-sm text-[#6C757D]",children:"Amount"}),o.jsx("span",{className:"text-xl font-semibold text-[#212529]",children:Ue(J.amount)}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:J.processedAt?`Processed ${Bt(J.processedAt)}`:"Awaiting processing"})]})]},J.id))})]})]})}const uwe=["Review fan questions in advance to personalize the session.","Test your audio/video setup 15 minutes before the meet.","Keep exclusive content ready to reward high bidders.","Use the built-in timer to stay on schedule."],hwe={scheduled:"success",live:"primary",completed:"primary",cancelled:"danger",cancelled_no_show_creator:"danger",no_show:"warning"};function pwe(){const{user:s,onlineUsers:n}=mr(),a=Fs(),[l,u]=L.useState([]),[f,g]=L.useState(!0),v=async()=>{if(!s)return;const{data:S,error:I}=await ie.from("meets").select(`
        *,
        events:event_id (title, base_price)
      `).eq("creator_id",s.id).order("scheduled_at",{ascending:!0});if(I){console.error("Error fetching meets:",I),g(!1);return}if(console.log(" Fetched meets for creator:",s.id),console.log(" Meets data:",S),console.log(" Number of meets:",(S==null?void 0:S.length)||0),S&&S.length>0){const j=[...new Set(S.map(O=>O.fan_id))],{data:B}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",j),A=new Map((B==null?void 0:B.map(O=>[O.user_id,O]))||[]),F=[...new Set(S.map(O=>O.event_id))],{data:D}=await ie.from("bids").select("event_id, amount").in("event_id",F),R=S.map(O=>({...O,fan_profile:A.get(O.fan_id),bids:(D==null?void 0:D.filter(V=>V.event_id===O.event_id))||[]}));u(R)}else u(S||[]);g(!1)};L.useEffect(()=>{v()},[s]);const y=l.filter(S=>S.status==="scheduled"||S.status==="live"),w=l.filter(S=>S.status==="completed"),T=l.filter(S=>S.status==="cancelled"||S.status==="cancelled_no_show_creator");return console.log(" Upcoming meets (scheduled):",y.length,y),console.log(" Completed meets:",w.length,w),console.log(" All meets:",l.length,l),f?o.jsx("div",{className:"p-8 text-center",children:"Loading meets..."}):o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Meets"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage your scheduled sessions and turn every meet into a wow moment."})]}),o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Session Prep Center",subtitle:"Best practices to deliver memorable fan experiences.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsx(be,{className:"gap-3",children:uwe.map(S=>o.jsxs("div",{className:"flex items-start gap-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[o.jsx("span",{className:"mt-1 text-lg",children:""}),o.jsx("p",{className:"text-sm text-[#212529]",children:S})]},S))})]}),o.jsx("div",{className:"rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 p-4",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-blue-800",children:"Automatic Meeting System"}),o.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[o.jsx("strong",{children:"Important:"})," You must start your call ",o.jsx("strong",{children:"before"})," the scheduled time. If you don't join before the scheduled time, the meeting will be auto-cancelled and the fan will receive a full refund. Meetings automatically complete at the scheduled end time and your earnings (90%) will be credited to your wallet."]})]})]})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Upcoming Sessions",subtitle:"Start your call before the scheduled time to avoid no-show cancellation.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsxs(be,{className:"gap-4",children:[y.map(S=>{var j,B,A,F;const I=S.bids&&S.bids.length>0?Math.max(...S.bids.map(D=>D.amount)):((j=S.events)==null?void 0:j.base_price)||0;return o.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[#E9ECEF] bg-white p-4",children:o.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[o.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsx(Ye,{variant:hwe[S.status]??"default",children:S.status}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Bt(S.scheduled_at),"  ",S.duration_minutes," mins"]}),o.jsxs("span",{className:"text-xs font-semibold text-[#28A745]",children:["Amount: ",Ue(I)]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((B=S.events)==null?void 0:B.title)||"Untitled Event"}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((A=S.fan_profile)==null?void 0:A.display_name)||((F=S.fan_profile)==null?void 0:F.username)||"Unknown Fan"]})]}),o.jsxs("div",{className:"text-sm text-[#6C757D]",children:[o.jsx("span",{className:"font-medium",children:"Meeting Link: "}),o.jsx("span",{className:"break-all",children:S.meeting_link||"No link yet"})]})]}),o.jsx("div",{className:"flex flex-col gap-2",children:S.meeting_link&&o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>navigator.clipboard.writeText(S.meeting_link),children:"Copy Link"}),o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>a(`/messages?chatWith=${S.fan_id}`),children:"Message Fan"})]}),(()=>{const D=new Date,R=new Date(S.scheduled_at),O=new Date(R.getTime()+S.duration_minutes*60*1e3),V=D>=new Date(R.getTime()-3e4),G=D>=O||S.status==="completed"||S.status==="cancelled"||S.status==="cancelled_no_show_creator",J=S.status==="live";return o.jsx(ue,{size:"sm",disabled:G||!J&&!n.has(S.fan_id)||!J&&!V,variant:G?"secondary":"primary",title:G?"This meeting has ended":J?"Rejoin your live call":n.has(S.fan_id)?V?"Start the call":`Call starts at ${Bt(S.scheduled_at)} (30s early buffer available)`:"Fan is offline. You cannot start the call.",onClick:()=>window.open(S.meeting_link,"_blank","noopener,noreferrer"),children:G?" Completed":J?"Rejoin Call":"Start Call"})})(),!n.has(S.fan_id)&&o.jsx("span",{className:"text-[10px] text-red-500",children:"Fan is offline"})]})})]})},S.id)}),y.length===0&&o.jsx("p",{className:"text-sm text-[#6C757D]",children:"No upcoming meets scheduled."})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Completed Sessions",subtitle:"Your past meets and earnings.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsxs(be,{className:"gap-4",children:[w.map(S=>{var j,B,A,F;const I=S.bids&&S.bids.length>0?Math.max(...S.bids.map(D=>D.amount)):((j=S.events)==null?void 0:j.base_price)||0;return o.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[#28A745] bg-gradient-to-r from-green-50 to-white p-4",children:o.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:o.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsx(Ye,{variant:"success",children:" Completed"}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Bt(S.scheduled_at),"  ",S.duration_minutes," mins"]}),o.jsx("div",{className:"flex items-center gap-2 rounded-full bg-[#28A745] px-3 py-1",children:o.jsxs("span",{className:"text-xs font-bold text-white",children:[" ",Ue(I)]})})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((B=S.events)==null?void 0:B.title)||"Untitled Event"}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((A=S.fan_profile)==null?void 0:A.display_name)||((F=S.fan_profile)==null?void 0:F.username)||"Unknown Fan"]})]})]})})},S.id)}),w.length===0&&o.jsx("p",{className:"text-sm text-[#6C757D]",children:"No completed meets yet."})]})]}),T.length>0&&o.jsxs(pe,{children:[o.jsx(Ne,{title:"Cancelled Sessions",subtitle:"Meetings that were cancelled due to no-show.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsx(be,{className:"gap-4",children:T.map(S=>{var I,j,B;return o.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-red-200 bg-gradient-to-r from-red-50 to-white p-4",children:o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o.jsx(Ye,{variant:"danger",children:S.status==="cancelled_no_show_creator"?" No-Show":" Cancelled"}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Bt(S.scheduled_at),"  ",S.duration_minutes," mins"]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((I=S.events)==null?void 0:I.title)||"Untitled Event"}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((j=S.fan_profile)==null?void 0:j.display_name)||((B=S.fan_profile)==null?void 0:B.username)||"Unknown Fan"]})]}),S.status==="cancelled_no_show_creator"&&o.jsx("p",{className:"text-xs text-red-600",children:" You did not start the call before the scheduled time. Fan received a full refund."})]})},S.id)})})]})]})}function fwe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState(!0);return L.useEffect(()=>{async function f(){if(s)try{const{data:g,error:v}=await ie.from("creator_follows").select("fan_id").eq("creator_id",s.id);if(v)throw v;if(g&&g.length>0){const y=g.map(S=>S.fan_id),{data:w,error:T}=await ie.from("profiles").select("*").in("user_id",y);if(T)throw T;w&&a(w)}else a([])}catch(g){console.error("Error fetching followers:",g)}finally{u(!1)}}f()},[s]),l?o.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading..."}):o.jsxs("div",{className:"mx-auto flex max-w-4xl flex-col gap-6",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Followers"}),o.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"People who follow you on FanMeet. Use this list to understand who shows up for your events most often."})]}),o.jsxs("div",{className:"space-y-4",children:[n.map(f=>{var g,v;return o.jsx(pe,{elevated:!0,className:"border-none bg-white/95",children:o.jsxs(be,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[o.jsx("div",{className:"flex flex-col gap-1",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Mi,{src:f.avatar_url,initials:((g=f.display_name)==null?void 0:g.charAt(0))||((v=f.username)==null?void 0:v.charAt(0)),size:"md"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:f.display_name||f.username}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",f.username]})]})]})}),o.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[o.jsx(Ye,{variant:"primary",children:"Follower"}),o.jsx("div",{className:"flex gap-2",children:o.jsx(ue,{size:"sm",variant:"secondary",className:"rounded-full",children:"Message"})})]})]})},f.user_id)}),n.length===0&&o.jsx(pe,{children:o.jsx(be,{children:o.jsx("p",{className:"text-sm text-[#6C757D]",children:"You dont have any followers yet. Share your profile link and host a few events to start building your fan list."})})})]})]})}function mwe(){const{notifications:s,markNotificationAsRead:n,markAllNotificationsAsRead:a}=Jg();return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-[#111827]",children:"Notifications"}),o.jsx("p",{className:"text-[#6C757D]",children:"Manage your alerts and preferences"})]}),o.jsxs("button",{onClick:()=>a(),className:"flex items-center gap-2 text-sm font-medium text-[#FF6B35] hover:text-[#E85D2E]",children:[o.jsx(DH,{className:"h-4 w-4"}),"Mark all as read"]})]}),o.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[o.jsx("div",{className:"lg:col-span-2 space-y-4",children:o.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[o.jsx("h2",{className:"mb-4 text-lg font-semibold text-[#111827]",children:"Latest alerts"}),o.jsx("div",{className:"space-y-4",children:s.length===0?o.jsx("div",{className:"text-center py-8 text-[#6C757D]",children:"No notifications yet"}):s.map(l=>o.jsxs("div",{className:`flex gap-4 rounded-lg border p-4 transition-colors cursor-pointer ${l.read?"border-transparent bg-white":"border-[#FFE5D9] bg-[#FFF5F2]"}`,onClick:()=>!l.read&&n(l.id),children:[o.jsx("div",{className:`mt-1 flex h-8 w-8 flex-none items-center justify-center rounded-full ${l.read?"bg-[#F8F9FA] text-[#6C757D]":"bg-[#FFE5D9] text-[#FF6B35]"}`,children:o.jsx(OH,{className:"h-4 w-4"})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-start justify-between gap-2",children:[o.jsx("h3",{className:`font-medium ${l.read?"text-[#111827]":"text-[#FF6B35]"}`,children:l.title}),o.jsx("span",{className:"whitespace-nowrap text-xs text-[#6C757D]",children:lu(new Date(l.created_at),"MMM d, h:mm a")})]}),o.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:l.message})]}),!l.read&&o.jsx("div",{className:"mt-2 h-2 w-2 rounded-full bg-[#FF6B35]"})]},l.id))})]})}),o.jsx("div",{className:"space-y-6",children:o.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[o.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[o.jsx(FH,{className:"h-5 w-5 text-[#6C757D]"}),o.jsx("h2",{className:"text-lg font-semibold text-[#111827]",children:"Preferences"})]}),o.jsx("div",{className:"space-y-4",children:["Email notifications","Push notifications","SMS alerts"].map(l=>o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm text-[#111827]",children:l}),o.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[o.jsx("input",{type:"checkbox",className:"peer sr-only",defaultChecked:!0}),o.jsx("div",{className:"peer h-6 w-11 rounded-full bg-[#E9ECEF] after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-[#FF6B35] peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#FFE5D9]"})]})]},l))})]})})]})]})}const gwe="your_cloud_name",_we="fanmeet_profiles",Ewe={Connected:"success","Reconnect required":"warning"};function vwe(){var Xe,Oe;const{user:s}=mr(),[n,a]=L.useState(!0),[l,u]=L.useState(!1),[f,g]=L.useState(!1),[v,y]=L.useState(!1),[w,T]=L.useState(!1),[S,I]=L.useState(!1),[j,B]=L.useState(null),A=L.useRef(null),[F,D]=L.useState({display_name:"",username:"",bio:"",category:"",primary_language:""}),[R,O]=L.useState({bank_account_number:"",confirm_bank_account_number:"",bank_ifsc:"",bank_account_name:"",upi_id:""}),[V,G]=L.useState({contact_email:"",phone_number:"",sms_alerts:!1,share_calendar:!1}),[J,$]=L.useState([]),[q,ee]=L.useState({instagram:"",youtube:"",twitter:"",linkedin:"",website:""});L.useEffect(()=>{async function ae(){if(s)try{const{data:Ee}=await ie.from("profiles").select("*").eq("user_id",s.id).single();Ee&&(D({display_name:Ee.display_name||"",username:Ee.username||"",bio:Ee.bio||"",category:Ee.category||"",primary_language:Ee.primary_language||""}),B(Ee.profile_photo_url||null),ee({instagram:Ee.instagram_url||"",youtube:Ee.youtube_url||"",twitter:Ee.twitter_url||"",linkedin:Ee.linkedin_url||"",website:Ee.website_url||""}),O({bank_account_number:Ee.bank_account_number||"",confirm_bank_account_number:Ee.bank_account_number||"",bank_ifsc:Ee.bank_ifsc||"",bank_account_name:Ee.bank_account_name||"",upi_id:Ee.upi_id||""}));const{data:Le}=await ie.from("creator_settings").select("*").eq("user_id",s.id).maybeSingle();Le&&G({contact_email:Le.contact_email||"",phone_number:Le.phone_number||"",sms_alerts:Le.sms_alerts||!1,share_calendar:Le.share_calendar||!1});const{data:Ke}=await ie.from("linked_channels").select("*").eq("user_id",s.id);Ke&&$(Ke)}catch(Ee){console.error("Error fetching settings:",Ee)}finally{a(!1)}}ae()},[s]);const ne=async()=>{if(s){u(!0);try{const{error:ae}=await ie.from("profiles").update(F).eq("user_id",s.id);if(ae)throw ae;alert("Profile updated successfully!")}catch(ae){console.error("Error updating profile:",ae),alert("Failed to update profile.")}finally{u(!1)}}},de=async ae=>{var Le;const Ee=(Le=ae.target.files)==null?void 0:Le[0];if(!(!Ee||!s)){if(!Ee.type.startsWith("image/")){alert("Please select an image file.");return}if(Ee.size>5*1024*1024){alert("Image must be less than 5MB.");return}I(!0);try{const Ke=new FormData;Ke.append("file",Ee),Ke.append("upload_preset",_we),Ke.append("folder","fanmeet/profiles");const He=await fetch(`https://api.cloudinary.com/v1_1/${gwe}/image/upload`,{method:"POST",body:Ke});if(!He.ok)throw new Error("Failed to upload image");const yt=(await He.json()).secure_url,{error:It}=await ie.from("profiles").update({profile_photo_url:yt}).eq("user_id",s.id);if(It)throw It;B(yt),alert("Profile photo updated successfully!")}catch(Ke){console.error("Error uploading photo:",Ke),alert("Failed to upload photo. Please try again.")}finally{I(!1),A.current&&(A.current.value="")}}},me=async()=>{if(s&&confirm("Are you sure you want to remove your profile photo?")){I(!0);try{const{error:ae}=await ie.from("profiles").update({profile_photo_url:null}).eq("user_id",s.id);if(ae)throw ae;B(null),alert("Profile photo removed.")}catch(ae){console.error("Error removing photo:",ae),alert("Failed to remove photo.")}finally{I(!1)}}},ve=async()=>{if(s){T(!0);try{const{error:ae}=await ie.from("profiles").update({instagram_url:q.instagram||null,youtube_url:q.youtube||null,twitter_url:q.twitter||null,linkedin_url:q.linkedin||null,website_url:q.website||null}).eq("user_id",s.id);if(ae)throw ae;alert("Social links updated successfully!")}catch(ae){console.error("Error updating social links:",ae),alert("Failed to update social links.")}finally{T(!1)}}},_e=async()=>{if(s){g(!0);try{const{data:ae}=await ie.from("creator_settings").select("user_id").eq("user_id",s.id).single();let Ee;if(ae){const{error:Le}=await ie.from("creator_settings").update(V).eq("user_id",s.id);Ee=Le}else{const{error:Le}=await ie.from("creator_settings").insert({...V,user_id:s.id});Ee=Le}if(Ee)throw Ee;alert("Contact settings updated successfully!")}catch(ae){console.error("Error updating contact settings:",ae),alert("Failed to update contact settings.")}finally{g(!1)}}},De=async()=>{if(!s)return;const ae=!!R.upi_id,Ee=!!R.bank_account_number;if(!ae&&!Ee){alert("Please provide either Bank Account details or a UPI ID.");return}if(Ee){if(!R.bank_account_name){alert("Please enter the Account Holder Name.");return}if(!R.bank_ifsc||R.bank_ifsc.length!==11){alert("Please enter a valid 11-character IFSC code.");return}if(R.bank_account_number!==R.confirm_bank_account_number){alert("Account numbers do not match. Please re-enter.");return}}y(!0);try{const Le={name:R.bank_account_name,ifsc:R.bank_ifsc,account_number:R.bank_account_number,upi_id:R.upi_id},{data:Ke,error:He}=await ie.functions.invoke("create-razorpay-fund-account",{body:Le});if(He){console.error("Edge function error:",He),alert(`Verification failed: ${He.message||"Unknown error"}`),y(!1);return}const{confirm_bank_account_number:gt,...yt}=R,It={...yt};Ke!=null&&Ke.fund_account_id&&(It.razorpay_fund_account_id=Ke.fund_account_id);const{error:Ct}=await ie.from("profiles").update(It).eq("user_id",s.id);if(Ct)throw Ct;alert("Bank details updated successfully! Your earnings will be available for withdrawal 48 hours after event completion.")}catch(Le){console.error("Error updating bank details:",Le),alert("Failed to update bank details.")}finally{y(!1)}};return n?o.jsx("div",{className:"p-8 text-center",children:"Loading settings..."}):o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Settings"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Fine-tune your public profile, contact preferences, and streaming setup."})]}),o.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,0.8fr)]",children:[o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Profile information",subtitle:"Fans see these details before bidding."}),o.jsxs(be,{className:"gap-5",children:[o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx("label",{className:"text-sm font-medium text-[#212529]",children:"Profile Photo"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"relative",children:j?o.jsx("img",{src:j,alt:"Profile",className:"h-24 w-24 rounded-full object-cover ring-2 ring-[#C045FF]/20"}):o.jsx("div",{className:"h-24 w-24 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-2xl ring-2 ring-[#C045FF]/20",children:((Oe=(Xe=F.display_name)==null?void 0:Xe.charAt(0))==null?void 0:Oe.toUpperCase())||"?"})}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:de,className:"hidden",id:"profile-photo-upload"}),o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>{var ae;return(ae=A.current)==null?void 0:ae.click()},disabled:S,children:S?"Uploading...":j?"Change Photo":"Upload Photo"}),j&&o.jsx(ue,{variant:"ghost",size:"sm",onClick:me,disabled:S,className:"text-red-500 hover:text-red-600",children:"Remove Photo"}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"JPG, PNG, GIF. Max 5MB."})]})]})]}),o.jsx(nt,{label:"Display name",placeholder:"Your Name",value:F.display_name,onChange:ae=>D({...F,display_name:ae.target.value})}),o.jsx(nt,{label:"Public username",placeholder:"@username",value:F.username,onChange:ae=>D({...F,username:ae.target.value})}),o.jsx(ls,{label:"Bio",placeholder:"Tell your fans what to expect...",value:F.bio,onChange:ae=>D({...F,bio:ae.target.value}),rows:4}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Category",placeholder:"e.g. Music, Tech",value:F.category,onChange:ae=>D({...F,category:ae.target.value})}),o.jsx(nt,{label:"Primary language",placeholder:"e.g. English",value:F.primary_language,onChange:ae=>D({...F,primary_language:ae.target.value})})]}),o.jsx(ue,{size:"lg",onClick:ne,disabled:l,children:l?"Saving...":"Save profile"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Contact settings",subtitle:"Well use this for payouts and urgent reminders."}),o.jsxs(be,{className:"gap-4",children:[o.jsx(nt,{label:"Contact email",placeholder:"email@example.com",value:V.contact_email,onChange:ae=>G({...V,contact_email:ae.target.value})}),o.jsx(nt,{label:"Phone number",placeholder:"+1 234 567 8900",value:V.phone_number,onChange:ae=>G({...V,phone_number:ae.target.value})}),o.jsxs("label",{className:"flex items-center gap-3 text-sm text-[#212529]",children:[o.jsx("input",{type:"checkbox",checked:V.sms_alerts,onChange:ae=>G({...V,sms_alerts:ae.target.checked}),className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Send SMS alerts for high-value bids"]}),o.jsxs("label",{className:"flex items-center gap-3 text-sm text-[#212529]",children:[o.jsx("input",{type:"checkbox",checked:V.share_calendar,onChange:ae=>G({...V,share_calendar:ae.target.checked}),className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Share calendar availability with FanMeet team"]}),o.jsx(ue,{variant:"secondary",className:"self-start",onClick:_e,disabled:f,children:f?"Updating...":"Update contact info"})]})]})]}),o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Social Media Links",subtitle:"Add your social media profiles so fans can find and follow you."}),o.jsxs(be,{className:"gap-5",children:[o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Instagram",placeholder:"https://instagram.com/yourhandle",value:q.instagram,onChange:ae=>ee({...q,instagram:ae.target.value})}),o.jsx(nt,{label:"YouTube",placeholder:"https://youtube.com/@yourhandle",value:q.youtube,onChange:ae=>ee({...q,youtube:ae.target.value})})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Twitter / X",placeholder:"https://twitter.com/yourhandle",value:q.twitter,onChange:ae=>ee({...q,twitter:ae.target.value})}),o.jsx(nt,{label:"LinkedIn",placeholder:"https://linkedin.com/in/yourprofile",value:q.linkedin,onChange:ae=>ee({...q,linkedin:ae.target.value})})]}),o.jsx(nt,{label:"Website",placeholder:"https://yourwebsite.com",value:q.website,onChange:ae=>ee({...q,website:ae.target.value})}),o.jsx(ue,{size:"lg",onClick:ve,disabled:w,children:w?"Saving...":"Save Social Links"})]})]}),o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Bank & Payout Details",subtitle:"Add your bank account or UPI for automatic withdrawals. Earnings are available 48 hours after event completion."}),o.jsxs(be,{className:"gap-5",children:[o.jsx("div",{className:"rounded-[12px] bg-[#F4E6FF]/60 p-4",children:o.jsxs("p",{className:"text-sm text-[#6C757D]",children:[" ",o.jsx("strong",{children:"Auto-withdrawal:"})," Your earnings (90% after platform fee) become available for withdrawal 48 hours after each event ends. Add either bank account OR UPI details below."]})}),o.jsxs("div",{className:"flex flex-col gap-4 rounded-xl border border-[#E9ECEF] p-4",children:[o.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[o.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#E9ECEF] text-sm font-bold text-[#495057]",children:"1"}),o.jsx("h3",{className:"font-semibold text-[#212529]",children:"Bank Transfer (NEFT/IMPS)"})]}),o.jsx(nt,{label:"Beneficiary Name",placeholder:"Name as per bank records",value:R.bank_account_name,onChange:ae=>O({...R,bank_account_name:ae.target.value})}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Account Number",placeholder:"e.g. 1234567890",type:"password",value:R.bank_account_number,onChange:ae=>O({...R,bank_account_number:ae.target.value})}),o.jsx(nt,{label:"Confirm Account Number",placeholder:"Re-enter account number",value:R.confirm_bank_account_number,onChange:ae=>O({...R,confirm_bank_account_number:ae.target.value})})]}),o.jsx(nt,{label:"IFSC Code",placeholder:"e.g. HDFC0001234",value:R.bank_ifsc,onChange:ae=>O({...R,bank_ifsc:ae.target.value.toUpperCase()}),maxLength:11})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"}),o.jsx("span",{className:"text-sm font-medium text-[#6C757D]",children:"OR USE UPI"}),o.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"})]}),o.jsxs("div",{className:"flex flex-col gap-4 rounded-xl border border-[#E9ECEF] p-4",children:[o.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[o.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#E9ECEF] text-sm font-bold text-[#495057]",children:"2"}),o.jsx("h3",{className:"font-semibold text-[#212529]",children:"UPI ID (VPA)"})]}),o.jsx(nt,{label:"UPI ID",placeholder:"e.g. username@oksbi",value:R.upi_id,onChange:ae=>O({...R,upi_id:ae.target.value})})]}),o.jsx(ue,{size:"lg",onClick:De,disabled:v,children:v?"Verifying & Saving...":"Save Payout Details"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Streaming & channel integrations",subtitle:"Connect tools to streamline your live experiences.",className:"border-b border-[#E9ECEF] pb-4"}),o.jsxs(be,{className:"gap-4",children:[J.map(ae=>o.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:ae.platform}),o.jsx("span",{className:"text-sm text-[#6C757D]",children:ae.handle})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Ye,{variant:Ewe[ae.status]??"default",children:ae.status}),o.jsx(ue,{variant:"ghost",size:"sm",children:"Manage"})]})]},ae.id)),J.length===0&&o.jsx("p",{className:"text-sm text-[#6C757D]",children:"No channels connected yet."}),o.jsx(ue,{variant:"ghost",className:"self-start",children:"+ Connect new channel"})]})]})]})}const ywe={},p7=s=>{let n;const a=new Set,l=(T,S)=>{const I=typeof T=="function"?T(n):T;if(!Object.is(I,n)){const j=n;n=S??(typeof I!="object"||I===null)?I:Object.assign({},n,I),a.forEach(B=>B(n,j))}},u=()=>n,y={setState:l,getState:u,getInitialState:()=>w,subscribe:T=>(a.add(T),()=>a.delete(T)),destroy:()=>{(ywe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),a.clear()}},w=n=s(l,u,y);return y},xwe=s=>s?p7(s):p7;var GH={exports:{}},HH={},zH={exports:{}},KH={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fp=L;function bwe(s,n){return s===n&&(s!==0||1/s===1/n)||s!==s&&n!==n}var wwe=typeof Object.is=="function"?Object.is:bwe,Swe=Fp.useState,Cwe=Fp.useEffect,Twe=Fp.useLayoutEffect,Rwe=Fp.useDebugValue;function Nwe(s,n){var a=n(),l=Swe({inst:{value:a,getSnapshot:n}}),u=l[0].inst,f=l[1];return Twe(function(){u.value=a,u.getSnapshot=n,TR(u)&&f({inst:u})},[s,a,n]),Cwe(function(){return TR(u)&&f({inst:u}),s(function(){TR(u)&&f({inst:u})})},[s]),Rwe(a),a}function TR(s){var n=s.getSnapshot;s=s.value;try{var a=n();return!wwe(s,a)}catch{return!0}}function Awe(s,n){return n()}var Iwe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Awe:Nwe;KH.useSyncExternalStore=Fp.useSyncExternalStore!==void 0?Fp.useSyncExternalStore:Iwe;zH.exports=KH;var Owe=zH.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fb=L,Dwe=Owe;function Pwe(s,n){return s===n&&(s!==0||1/s===1/n)||s!==s&&n!==n}var kwe=typeof Object.is=="function"?Object.is:Pwe,jwe=Dwe.useSyncExternalStore,Lwe=fb.useRef,Mwe=fb.useEffect,Fwe=fb.useMemo,Uwe=fb.useDebugValue;HH.useSyncExternalStoreWithSelector=function(s,n,a,l,u){var f=Lwe(null);if(f.current===null){var g={hasValue:!1,value:null};f.current=g}else g=f.current;f=Fwe(function(){function y(j){if(!w){if(w=!0,T=j,j=l(j),u!==void 0&&g.hasValue){var B=g.value;if(u(B,j))return S=B}return S=j}if(B=S,kwe(T,j))return B;var A=l(j);return u!==void 0&&u(B,A)?B:(T=j,S=A)}var w=!1,T,S,I=a===void 0?null:a;return[function(){return y(n())},I===null?void 0:function(){return y(I())}]},[n,a,l,u]);var v=jwe(s,f[0],f[1]);return Mwe(function(){g.hasValue=!0,g.value=v},[v]),Uwe(v),v};GH.exports=HH;var Vwe=GH.exports;const Bwe=k7(Vwe),qH={},{useDebugValue:Wwe}=dA,{useSyncExternalStoreWithSelector:Gwe}=Bwe;let f7=!1;const Hwe=s=>s;function zwe(s,n=Hwe,a){(qH?"production":void 0)!=="production"&&a&&!f7&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),f7=!0);const l=Gwe(s.subscribe,s.getState,s.getServerState||s.getInitialState,n,a);return Wwe(l),l}const m7=s=>{(qH?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof s=="function"?xwe(s):s,a=(l,u)=>zwe(n,l,u);return Object.assign(a,n),a},Kwe=s=>s?m7(s):m7,YH="fanmeet-demo-creator-dm-open",qwe=()=>typeof window>"u"?"open":window.localStorage.getItem(YH)==="closed"?"closed":"open",Ywe=Kwe(s=>({creatorDmStatus:qwe(),setCreatorDmStatus:n=>{typeof window<"u"&&window.localStorage.setItem(YH,n),s({creatorDmStatus:n})}}));function $we(){const[s,n]=L.useState(""),{creatorDmStatus:a,setCreatorDmStatus:l}=Ywe(),[u,f]=L.useState(null),{messages:g,sendMessage:v,markMessageAsRead:y}=Jg(),{user:w}=mr(),T=a==="open",S=L.useMemo(()=>{if(!w||!g)return[];const O=new Map;return g.forEach(V=>{const G=V.sender_id===w.id?V.receiver_id:V.sender_id,J=V.sender_id===w.id?V.receiver_display_name:V.sender_display_name,$=V.sender_id===w.id?V.receiver_username:V.sender_username,q=O.get(G),ee=!V.read&&V.receiver_id===w.id;q?(new Date(V.created_at)>new Date(q.lastTime)&&(q.lastMessage=V.message,q.lastTime=V.created_at),ee&&(q.unread+=1)):O.set(G,{id:G,participant:{id:G,name:J||"Unknown User",username:$||"unknown",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${J||"User"}`,status:"offline"},lastMessage:V.message,lastTime:V.created_at,unread:ee?1:0})}),Array.from(O.values()).sort((V,G)=>new Date(G.lastTime).getTime()-new Date(V.lastTime).getTime())},[g,w]),I=L.useMemo(()=>g.filter(O=>O.sender_id===(w==null?void 0:w.id)&&O.receiver_id===u||O.sender_id===u&&O.receiver_id===(w==null?void 0:w.id)),[g,w,u]);L.useEffect(()=>{u&&w&&I.filter(V=>!V.read&&V.receiver_id===w.id).forEach(V=>y(V.id))},[u,I,w,y]);const[j]=Yg(),[B,A]=L.useState(null);L.useEffect(()=>{const O=j.get("chatWith");O&&f(O)},[j]),L.useEffect(()=>{const O=S.some(V=>V.id===u);u&&!O&&(async()=>{if((B==null?void 0:B.id)===u)return;const{data:G}=await ie.from("profiles").select("user_id, display_name, username").eq("user_id",u).single();G&&A({id:G.user_id,participant:{id:G.user_id,name:G.display_name||G.username||"User",username:G.username||"user",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${G.display_name||G.username||"User"}`,status:"offline"},lastMessage:"",lastTime:new Date().toISOString(),unread:0})})()},[u,S,B]);const F=L.useMemo(()=>S.find(O=>O.id===u)||B,[S,u,B]),D=async O=>{if(O.preventDefault(),!(!s.trim()||!T||!u))try{await v(u,s),n("")}catch(V){console.error("Failed to send message:",V)}},R=()=>{l(T?"closed":"open")};return o.jsxs("div",{className:"flex h-[calc(100vh-140px)] flex-col gap-4 md:flex-row",children:[o.jsxs("div",{className:`flex w-full flex-col gap-3 md:w-80 ${F?"hidden md:flex":"flex"}`,children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Messages"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Chat with fans who have joined your FanMeets."})]}),o.jsxs(pe,{className:"flex h-full min-h-[260px] flex-col overflow-hidden",children:[o.jsxs(Ne,{className:"flex flex-row items-center justify-between gap-2 border-b border-[#E9ECEF] pb-3",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Conversations"}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Select a fan to view your chat."})]}),o.jsx(ue,{type:"button",size:"sm",variant:"secondary",className:"rounded-full px-3 text-[11px]",onClick:R,children:T?"Turn off DMs":"Turn on DMs"})]}),o.jsx(be,{className:"min-h-0 flex-1 gap-2 p-0",children:o.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[S.map(O=>{const V=O.id===u;return o.jsxs("button",{type:"button",onClick:()=>f(O.id),className:`mb-2 flex w-full items-center gap-3 rounded-[12px] border px-3 py-2 text-left text-sm transition-colors ${V?"border-[#C045FF] bg-[#F4E6FF] text-[#140423]":"border-[#E9ECEF] bg-white text-[#212529] hover:border-[#C045FF]/50 hover:bg-[#F8F5FF]"}`,children:[o.jsx(Mi,{src:O.participant.avatar,alt:O.participant.name,initials:O.participant.name.charAt(0),size:"sm"}),o.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsx("span",{className:"truncate text-[13px] font-semibold",children:O.participant.name}),o.jsx("span",{className:"whitespace-nowrap text-[11px] text-[#6C757D]",children:lu(new Date(O.lastTime),"h:mm a")})]}),o.jsx("span",{className:"mt-0.5 line-clamp-1 text-[12px] text-[#6C757D]",children:O.lastMessage})]}),O.unread>0&&o.jsx("span",{className:"ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-[#C045FF] px-1 text-[11px] font-semibold text-white",children:O.unread})]},O.id)}),S.length===0&&o.jsx("p",{className:"pt-4 text-center text-xs text-[#6C757D]",children:"No fan conversations yet. Once a fan wins your FanMeet, their chat will appear here."})]})})]})]}),o.jsx(pe,{elevated:!0,className:`flex h-full w-full flex-1 flex-col overflow-hidden ${F?"flex":"hidden md:flex"}`,children:F?o.jsxs(o.Fragment,{children:[o.jsxs(Ne,{className:"flex flex-row items-center justify-between gap-3 border-b border-[#E9ECEF] bg-white/80 py-3 backdrop-blur",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("button",{type:"button",className:"flex h-8 w-8 items-center justify-center rounded-full border border-[#E9ECEF] bg-white text-sm text-[#343A40] md:hidden",onClick:()=>f(null),children:""}),o.jsx(Mi,{src:F.participant.avatar,alt:F.participant.name,initials:F.participant.name.charAt(0),size:"sm"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:F.participant.name}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#6C757D]",children:[o.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"}),o.jsx("span",{children:"Fan"})]})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ue,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:o.jsx(VH,{className:"h-4 w-4","aria-hidden":"true"})}),o.jsx(ue,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:o.jsx(kH,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),o.jsxs(be,{className:"flex min-h-0 flex-1 flex-col p-0",children:[o.jsx("div",{className:"flex-1 space-y-4 overflow-y-auto bg-[#F8F9FA] p-4",children:I.map(O=>{var G;const V=O.sender_id===(w==null?void 0:w.id);return o.jsx("div",{className:`group my-2 flex gap-2 ${V?"justify-end":"justify-start"}`,children:o.jsxs("div",{className:`flex max-w-[80%] items-start gap-2 ${V?"flex-row-reverse":"flex-row"}`,children:[o.jsx(Mi,{src:V?`https://api.dicebear.com/9.x/initials/svg?seed=${((G=w==null?void 0:w.user_metadata)==null?void 0:G.full_name)||"Me"}`:F.participant.avatar,alt:V?"Me":F.participant.name,initials:V?"Me":F.participant.name.charAt(0),size:"sm"}),o.jsxs("div",{children:[o.jsx("div",{className:`rounded-2xl px-3 py-2 text-sm ${V?"bg-gradient-to-r from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] text-white shadow-[0_10px_30px_rgba(0,0,0,0.25)]":"border border-[#E9ECEF] bg-white text-[#212529]"}`,children:O.message}),o.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-[#6C757D]",children:[o.jsx("time",{dateTime:O.created_at,children:lu(new Date(O.created_at),"h:mm a")}),o.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:o.jsx(MH,{className:"h-3 w-3","aria-hidden":"true"})}),o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:o.jsx(PH,{className:"h-3 w-3","aria-hidden":"true"})}),!V&&o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:o.jsx(LH,{className:"h-3 w-3","aria-hidden":"true"})}),V&&o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:o.jsx(UH,{className:"h-3 w-3","aria-hidden":"true"})}),o.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:o.jsx(jH,{className:"h-3 w-3","aria-hidden":"true"})})]})]})]})]})},O.id)})}),o.jsxs("div",{className:"border-t border-[#E9ECEF] bg-white p-3",children:[!T&&o.jsx("p",{className:"mb-2 text-xs font-medium text-[#E63946]",children:"You have turned off direct messages. Fans can still see past messages but cannot send you new DMs."}),o.jsxs("form",{onSubmit:D,className:"flex items-center gap-3",children:[o.jsx("input",{type:"text",value:s,onChange:O=>n(O.target.value),placeholder:T?"Type your message to this fan...":"DMs are currently turned off",disabled:!T,className:"h-11 flex-1 rounded-[12px] border-2 border-[#E9ECEF] bg-white px-4 text-sm text-[#212529] placeholder:text-[#ADB5BD] focus:border-[#C045FF] focus:shadow-[0_0_0_3px_rgba(192,69,255,0.18)] focus:outline-none disabled:cursor-not-allowed disabled:bg-[#F8F9FA]"}),o.jsx(ue,{type:"submit",size:"md",disabled:!T||!s.trim(),className:"px-5 text-sm",children:"Send"})]})]})]})]}):o.jsx("div",{className:"flex h-full flex-1 items-center justify-center bg-[#F8F9FA] p-6 text-center text-sm text-[#6C757D]",children:o.jsx("p",{className:"max-w-xs",children:"Select a fan conversation to start messaging. After your next FanMeet, their chat will appear here."})})})]})}const Xwe={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"};function Jwe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState([]),[f,g]=L.useState(""),[v,y]=L.useState(""),[w,T]=L.useState(!1),[S,I]=L.useState(!0),[j,B]=L.useState(null),[A,F]=L.useState(""),[D,R]=L.useState(!1);L.useEffect(()=>{(async()=>{if(!s){I(!1);return}const{data:J,error:$}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at").eq("user_id",s.id).order("created_at",{ascending:!1});if($||!J){console.error("Error fetching support tickets:",$),a([]),I(!1);return}a(J.map(q=>({id:q.id,subject:q.subject,description:q.description,status:q.status,createdAt:q.created_at,updatedAt:q.updated_at}))),I(!1)})()},[s]),L.useEffect(()=>{(async()=>{if(!j){u([]);return}const{data:J,error:$}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at").eq("ticket_id",j).order("created_at",{ascending:!0});if($||!J){console.error("Error fetching replies:",$),u([]);return}u(J.map(q=>({id:q.id,message:q.message,isAdminReply:q.is_admin_reply,createdAt:q.created_at})))})()},[j]);const O=async()=>{if(!s||!j||!A.trim()){alert("Please enter a message.");return}R(!0);try{const{error:G}=await ie.from("ticket_replies").insert({ticket_id:j,user_id:s.id,message:A.trim(),is_admin_reply:!1});if(G){console.error("Error sending reply:",G),alert("Failed to send reply.");return}u(J=>[...J,{id:`temp-${Date.now()}`,message:A.trim(),isAdminReply:!1,createdAt:new Date().toISOString()}]),F(""),alert("Reply sent! Our support team will respond soon.")}finally{R(!1)}},V=async()=>{if(!s){alert("Please log in to raise a support ticket.");return}if(!f.trim()||!v.trim()){alert("Please enter a subject and description.");return}T(!0);try{const{data:G,error:J}=await ie.from("support_tickets").insert({user_id:s.id,subject:f.trim(),description:v.trim(),status:"open"}).select("id, subject, description, status, created_at, updated_at").single();if(J||!G){console.error("Error creating support ticket:",J),alert("Failed to create support ticket.");return}a($=>[{id:G.id,subject:G.subject,description:G.description,status:G.status,createdAt:G.created_at,updatedAt:G.updated_at},...$]),g(""),y(""),alert("Support ticket created successfully. Our team will get back to you.")}finally{T(!1)}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs(pe,{children:[o.jsx(Ne,{title:"Creator Support",subtitle:"Raise a ticket for payout issues, events, or other account questions."}),o.jsxs(be,{className:"gap-4",children:[o.jsx(ls,{label:"Subject",rows:2,placeholder:"Briefly describe your issue",value:f,onChange:G=>g(G.target.value)}),o.jsx(ls,{label:"Details",rows:5,placeholder:"Share as many details as possible, including event names, fans, dates, and screenshots where relevant.",value:v,onChange:G=>y(G.target.value)}),o.jsx(ue,{onClick:V,disabled:w,children:w?"Submitting":"Submit Ticket"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Your Tickets",subtitle:"Click a ticket to view the conversation and reply."}),o.jsx(be,{className:"flex flex-col gap-3",children:S?o.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading tickets"}):n.length===0?o.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"You have not raised any tickets yet."}):n.map(G=>o.jsxs("div",{children:[o.jsxs("button",{type:"button",onClick:()=>B(j===G.id?null:G.id),className:`w-full text-left rounded-[12px] border p-4 text-sm text-[#212529] transition-all ${j===G.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-white hover:border-[#C045FF]/50"}`,children:[o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"font-semibold",children:G.subject}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:Bt(G.createdAt)})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ye,{variant:Xwe[G.status],children:G.status.replace("_"," ")}),o.jsx("span",{className:"text-[#6C757D]",children:j===G.id?"":""})]})]}),o.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-[#6C757D] whitespace-pre-line",children:G.description})]}),j===G.id&&o.jsxs("div",{className:"mt-2 ml-4 border-l-2 border-[#C045FF] pl-4 space-y-4",children:[o.jsx("div",{className:"space-y-3",children:l.length===0?o.jsx("p",{className:"text-sm text-[#6C757D] py-2",children:"No replies yet. Our support team will respond soon."}):l.map(J=>o.jsxs("div",{className:`rounded-[10px] p-3 text-sm ${J.isAdminReply?"bg-[#F4E6FF] border-l-4 border-[#C045FF]":"bg-[#F8F9FA]"}`,children:[o.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[o.jsx("span",{className:`font-semibold ${J.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:J.isAdminReply?" Support Team":"You"}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:Bt(J.createdAt)})]}),o.jsx("p",{className:"text-[#212529] whitespace-pre-line",children:J.message})]},J.id))}),G.status!=="closed"&&G.status!=="resolved"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx(ls,{label:"Reply to this ticket",rows:3,placeholder:"Type your message...",value:A,onChange:J=>F(J.target.value)}),o.jsx(ue,{size:"sm",onClick:O,disabled:D||!A.trim(),children:D?"Sending...":"Send Reply"})]}),(G.status==="closed"||G.status==="resolved")&&o.jsxs("p",{className:"text-sm text-[#6C757D] italic",children:["This ticket is ",G.status,". Create a new ticket if you need further assistance."]})]})]},G.id))})]})]})}function Oy(s){const n=new Date,a=new Date(s),l=n.getTime()-a.getTime(),u=Math.floor(l/6e4),f=Math.floor(u/60),g=Math.floor(f/24);return u<1?"just now":u<60?`${u} min${u>1?"s":""} ago`:f<24?`${f} hour${f>1?"s":""} ago`:`${g} day${g>1?"s":""} ago`}function Qwe(){var O,V;const s=Fs(),[n,a]=L.useState(!0),[l,u]=L.useState(new Date),[f,g]=L.useState({totalUsers:0,activeEvents:0,liveNow:0,revenueThisMonth:0,commission:0,creators:0,fans:0,pendingWithdrawals:0,pendingWithdrawalsAmount:0,totalBids:0,bidsToday:0,refundsThisMonth:0}),[v,y]=L.useState({newFansToday:0,newCreatorsToday:0,activeMeetsNow:0,eventsEndingToday:0}),[w,T]=L.useState([]),[S,I]=L.useState([]),[j,B]=L.useState([]),[A,F]=L.useState([]),D=L.useCallback(async()=>{var G;a(!0);try{const J=new Date,$=new Date(J.getFullYear(),J.getMonth(),J.getDate()),q=new Date(J.getFullYear(),J.getMonth(),1),ee=new Date(J.getTime()+60*60*1e3),ne=new Date(J.getTime()-29*24*60*60*1e3),{count:de}=await ie.from("users").select("*",{count:"exact",head:!0}),{count:me}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","creator"),{count:ve}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","fan"),{count:_e}=await ie.from("events").select("*",{count:"exact",head:!0}).in("status",["live","upcoming"]),{count:De}=await ie.from("events").select("*",{count:"exact",head:!0}).eq("status","live"),{data:Xe}=await ie.from("bids").select("amount, status, created_at").gte("created_at",q.toISOString()),Oe=(Xe??[]).filter(ur=>ur.status==="won"),ae=(Xe??[]).filter(ur=>ur.status==="lost"),Ee=Oe.reduce((ur,Ir)=>ur+(Ir.amount??0),0),Le=[...Oe,...ae].reduce((ur,Ir)=>ur+(Ir.amount??0),0),Ke=Math.round(Le*.1),{data:He}=await ie.from("withdrawal_requests").select("amount").in("status",["pending","in_review"]),gt=(He==null?void 0:He.length)??0,yt=(He??[]).reduce((ur,Ir)=>ur+(Ir.amount??0),0),{count:It}=await ie.from("bids").select("*",{count:"exact",head:!0}),{count:Ct}=await ie.from("bids").select("*",{count:"exact",head:!0}).gte("created_at",$.toISOString()),{data:et}=await ie.from("wallet_transactions").select("amount").eq("type","bid_refund").gte("created_at",q.toISOString()),We=(et??[]).reduce((ur,Ir)=>ur+(Ir.amount??0),0);g({totalUsers:de??0,activeEvents:_e??0,liveNow:De??0,revenueThisMonth:Ee,commission:Ke,creators:me??0,fans:ve??0,pendingWithdrawals:gt,pendingWithdrawalsAmount:yt,totalBids:It??0,bidsToday:Ct??0,refundsThisMonth:We});const{count:Ze}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","fan").gte("created_at",$.toISOString()),{count:ye}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","creator").gte("created_at",$.toISOString()),Pe=new Date(J.getTime()-30*60*1e3),$e=new Date(J.getTime()+60*60*1e3),{count:kt}=await ie.from("meets").select("*",{count:"exact",head:!0}).eq("status","scheduled").gte("scheduled_at",Pe.toISOString()).lte("scheduled_at",$e.toISOString()),Kt=new Date($.getTime()+24*60*60*1e3),{count:Ht}=await ie.from("events").select("*",{count:"exact",head:!0}).gte("starts_at",$.toISOString()).lt("starts_at",Kt.toISOString());y({newFansToday:Ze??0,newCreatorsToday:ye??0,activeMeetsNow:kt??0,eventsEndingToday:Ht??0});const ft=[],{count:dr}=await ie.from("events").select("*",{count:"exact",head:!0}).gte("starts_at",J.toISOString()).lte("starts_at",ee.toISOString());(dr??0)>0&&ft.push({id:"events-soon",emoji:"",text:`${dr} event${dr===1?"":"s"} starting in the next hour`,count:dr??0}),gt>0&&ft.push({id:"pending-wd",emoji:"",text:`${gt} withdrawal request${gt===1?"":"s"} awaiting review`,count:gt});const{count:jt}=await ie.from("meets").select("*",{count:"exact",head:!0}).eq("status","completed").gte("updated_at",new Date(J.getTime()-24*60*60*1e3).toISOString());(jt??0)>0&&ft.push({id:"completed-meets",emoji:"",text:`${jt} meet${jt===1?"":"s"} completed in last 24h`,count:jt??0}),T(ft);const Pr=[],{data:Xn}=await ie.from("events").select("id, title, created_at, creator_id").order("created_at",{ascending:!1}).limit(3);if(Xn&&Xn.length>0){const ur=Xn.map(hr=>hr.creator_id),{data:Ir}=await ie.from("profiles").select("user_id, username").in("user_id",ur),En=new Map((Ir??[]).map(hr=>[hr.user_id,hr.username]));for(const hr of Xn){const Wi=En.get(hr.creator_id)||"creator";Pr.push({id:`event-${hr.id}`,emoji:"",text:`New event "${hr.title}" by @${Wi}`,time:Oy(hr.created_at)})}}const{data:Yo}=await ie.from("users").select("id, email, role, created_at").order("created_at",{ascending:!1}).limit(3);for(const ur of Yo??[]){const Ir=((G=ur.email)==null?void 0:G.split("@")[0])||"User";Pr.push({id:`user-${ur.id}`,emoji:"",text:`New ${ur.role} signup: ${Ir}`,time:Oy(ur.created_at)})}const{data:lo}=await ie.from("withdrawal_requests").select("id, amount, requested_at, creator_id").order("requested_at",{ascending:!1}).limit(3);if(lo&&lo.length>0){const ur=lo.map(hr=>hr.creator_id),{data:Ir}=await ie.from("profiles").select("user_id, username").in("user_id",ur),En=new Map((Ir??[]).map(hr=>[hr.user_id,hr.username]));for(const hr of lo){const Wi=En.get(hr.creator_id)||"creator";Pr.push({id:`wd-${hr.id}`,emoji:"",text:`Withdrawal request: ${Ue(hr.amount)} by @${Wi}`,time:Oy(hr.requested_at)})}}const{data:Qs}=await ie.from("meets").select("id, event_id, updated_at").eq("status","completed").order("updated_at",{ascending:!1}).limit(2);if(Qs&&Qs.length>0){const ur=Qs.map(hr=>hr.event_id),{data:Ir}=await ie.from("events").select("id, title").in("id",ur),En=new Map((Ir??[]).map(hr=>[hr.id,hr.title]));for(const hr of Qs){const Wi=En.get(hr.event_id)||"Event";Pr.push({id:`meet-${hr.id}`,emoji:"",text:`Meet completed: "${Wi}"`,time:Oy(hr.updated_at)})}}Pr.sort((ur,Ir)=>0),I(Pr.slice(0,8));const{data:xs}=await ie.from("bids").select("amount, created_at").eq("status","won").gte("created_at",ne.toISOString()),uo=new Map;for(const ur of xs??[]){const Ir=new Date(ur.created_at).toISOString().slice(0,10),En=uo.get(Ir)??0;uo.set(Ir,En+(ur.amount??0))}const Kl=[];for(let ur=0;ur<30;ur++){const Ir=new Date(ne);Ir.setDate(ne.getDate()+ur);const En=Ir.toISOString().slice(0,10);Kl.push({date:En,label:Ir.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}),value:uo.get(En)??0})}B(Kl);const{data:ln}=await ie.from("bids").select("event_id, amount").eq("status","won").gte("created_at",q.toISOString());if(ln&&ln.length>0){const ur=[...new Set(ln.map(zs=>zs.event_id))],{data:Ir}=await ie.from("events").select("id, creator_id").in("id",ur),En=new Map((Ir??[]).map(zs=>[zs.id,zs.creator_id])),hr=new Map;for(const zs of ln){const Jn=En.get(zs.event_id);if(!Jn)continue;const Ra=hr.get(Jn)??0;hr.set(Jn,Ra+(zs.amount??0))}const Wi=Array.from(hr.entries()).sort((zs,Jn)=>Jn[1]-zs[1]).slice(0,10),_u=Wi.map(([zs])=>zs),{data:Ta}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",_u),Eu=new Map((Ta??[]).map(zs=>[zs.user_id,zs])),vb=Wi.map(([zs,Jn])=>{const Ra=Eu.get(zs);return{id:zs,name:(Ra==null?void 0:Ra.display_name)||(Ra==null?void 0:Ra.username)||"Creator",earnings:Jn}});F(vb)}else F([]);u(new Date)}finally{a(!1)}},[]);L.useEffect(()=>{D();const G=setInterval(D,6e4);return()=>clearInterval(G)},[D]);const R=Math.max(...j.map(G=>G.value),1);return o.jsxs("div",{className:"flex flex-col gap-10",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{children:[o.jsx(Ye,{variant:"primary",pill:!1,className:"mb-2 w-fit",children:" Admin Control Center"}),o.jsx("h1",{className:"text-3xl font-semibold text-[#1B1C1F]",children:"Platform Overview"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Real-time glance at health, revenue, and moderation signals across FanMeet."})]}),o.jsxs("div",{className:"flex flex-col items-end gap-1",children:[o.jsx(ue,{variant:"secondary",size:"sm",onClick:D,disabled:n,children:n?" Refreshing":" Refresh"}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Last updated: ",l.toLocaleTimeString()]})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:o.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Total Users"}),className:"pb-2"}),o.jsxs(be,{className:"gap-2",children:[o.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":f.totalUsers.toLocaleString()}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:[f.fans," fans  ",f.creators," creators"]})]})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:o.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Active Events"}),className:"pb-2"}),o.jsxs(be,{className:"gap-2",children:[o.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":f.activeEvents}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:[f.liveNow," Live Now"]})]})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:o.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Winning Bid Volume (This Month)"}),className:"pb-2"}),o.jsx(be,{className:"gap-2",children:o.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":Ue(f.revenueThisMonth)})})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:o.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Commission (10%)"}),className:"pb-2"}),o.jsx(be,{className:"gap-2",children:o.jsx("span",{className:"text-3xl font-bold text-[#28A745]",children:n?"":Ue(f.commission)})})]})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:o.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Creators"}),className:"pb-2"}),o.jsx(be,{className:"gap-2",children:o.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":f.creators})})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:o.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Pending Withdrawals"}),className:"pb-2"}),o.jsxs(be,{className:"gap-2",children:[o.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":f.pendingWithdrawals}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:Ue(f.pendingWithdrawalsAmount)})]})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:o.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Total Bids"}),className:"pb-2"}),o.jsxs(be,{className:"gap-2",children:[o.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":f.totalBids.toLocaleString()}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Today: ",f.bidsToday]})]})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:o.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Refunds (This Month)"}),className:"pb-2"}),o.jsx(be,{className:"gap-2",children:o.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":Ue(f.refundsThisMonth)})})]})]})]}),o.jsxs("section",{className:"grid gap-4 lg:grid-cols-2",children:[o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:"Quick Stats",subtitle:"Operational health snapshots"}),o.jsxs(be,{className:"gap-3",children:[o.jsxs("ul",{className:"flex flex-col gap-2 text-sm text-[#212529]",children:[o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),o.jsxs("span",{children:["New signups today: ",v.newFansToday," fans, ",v.newCreatorsToday," creators"]})]}),o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),o.jsxs("span",{children:["Active meets right now: ",v.activeMeetsNow]})]}),o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),o.jsxs("span",{children:["Events starting today: ",v.eventsEndingToday]})]}),o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),o.jsxs("span",{children:["Pending withdrawals: ",f.pendingWithdrawals]})]})]}),o.jsx(ue,{variant:"primary",className:"self-start bg-[#050014] text-white hover:bg-[#140423]",size:"sm",onClick:()=>s("/admin/business-analytics"),children:"View detailed reports "})]})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:"Alerts & Notifications",subtitle:"Attention-required items"}),o.jsxs(be,{className:"gap-3",children:[o.jsx("div",{className:"flex flex-col gap-3",children:w.length===0?o.jsx("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] px-4 py-3 text-sm text-[#6C757D]",children:" No urgent alerts at this time"}):w.map(G=>o.jsxs("div",{className:"rounded-[12px] border border-[#F4E6FF] bg-[#F4E6FF]/60 px-4 py-3 text-sm text-[#C045FF]",children:[G.emoji," ",G.text]},G.id))}),o.jsx(ue,{variant:"primary",size:"sm",className:"self-start bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>s("/admin/withdrawals"),children:"Review withdrawals"})]})]})]}),o.jsxs("section",{className:"grid gap-4 xl:grid-cols-2",children:[o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:"Revenue Trend",subtitle:"Total Revenue  Last 30 days"}),o.jsxs(be,{children:[o.jsx("div",{className:"flex h-48 items-end gap-1",children:j.map(G=>o.jsx("div",{className:"group relative flex-1",title:`${G.label}: ${Ue(G.value)}`,children:o.jsx("div",{className:"w-full rounded-t bg-[#C045FF] transition-all hover:bg-[#A030DD]",style:{height:`${Math.max(G.value/R*100,2)}%`,minHeight:G.value>0?"4px":"2px"}})},G.date))}),o.jsxs("div",{className:"mt-2 flex justify-between text-xs text-[#6C757D]",children:[o.jsx("span",{children:(O=j[0])==null?void 0:O.label}),o.jsx("span",{children:(V=j[j.length-1])==null?void 0:V.label})]})]})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:"Top Creators by Revenue",subtitle:"Top 10 creators this month"}),o.jsx(be,{children:A.length===0?o.jsx("div",{className:"flex h-48 items-center justify-center text-sm text-[#6C757D]",children:"No creator earnings this month yet"}):o.jsx("div",{className:"flex flex-col gap-2",children:A.map((G,J)=>o.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-[#E9ECEF] bg-white px-3 py-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-[#F4E6FF] text-xs font-bold text-[#C045FF]",children:J+1}),o.jsx("span",{className:"text-sm font-medium text-[#212529]",children:G.name})]}),o.jsx("span",{className:"text-sm font-semibold text-[#28A745]",children:Ue(G.earnings)})]},G.id))})})]})]}),o.jsxs("section",{className:"grid gap-4 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:"Recent Activity",subtitle:"Latest admin, user, and system events"}),o.jsx(be,{className:"divide-y divide-[#F0F1F3]",children:S.length===0?o.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No recent activity"}):S.map(G=>o.jsx("div",{className:"flex items-center justify-between py-3 text-sm text-[#212529]",children:o.jsxs("span",{children:[G.emoji," ",G.text,o.jsxs("span",{className:"ml-2 text-xs text-[#6C757D]",children:["(",G.time,")"]})]})},G.id))})]}),o.jsxs(pe,{className:"border-[#F0F1F3] bg-white",children:[o.jsx(Ne,{title:"Quick Actions",subtitle:"Jump to critical modules"}),o.jsxs(be,{className:"gap-3",children:[o.jsx(ue,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>s("/admin/audit-logs"),children:" Review audit logs"}),o.jsx(ue,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>s("/admin/support-tickets"),children:" Open support queue"}),o.jsx(ue,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>s("/admin/withdrawals"),children:" Review withdrawals"}),o.jsx(ue,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>s("/admin/revenue-reports"),children:" Export revenue summary"})]})]})]})]})}const Zwe=[{label:"All",value:"all"},{label:"Fans",value:"fan"},{label:"Creators",value:"creator"},{label:"Admins",value:"admin"}],eSe=[{label:"All",value:"all"},{label:"Active",value:"active"},{label:"Suspended",value:"suspended"},{label:"Banned",value:"banned"}];function tSe(){const[s,n]=L.useState([]),[a,l]=L.useState(!1),[u,f]=L.useState(""),[g,v]=L.useState("all"),[y,w]=L.useState("all"),[T,S]=L.useState(null);L.useEffect(()=>{(async()=>{l(!0);try{const{data:F,error:D}=await ie.from("users").select("id, email, display_name, role, account_status, created_at, updated_at");if(D||!F){console.error("Error fetching users:",D),n([]);return}const{data:R}=await ie.from("bids").select("event_id, fan_id, amount, status").eq("status","won"),O=new Map;for(const q of R??[]){const ee=O.get(q.fan_id)??0;O.set(q.fan_id,ee+(q.amount??0))}const{data:V}=await ie.from("events").select("id, creator_id"),G=new Map((V??[]).map(q=>[q.id,q.creator_id])),J=new Map;for(const q of R??[]){const ee=G.get(q.event_id);if(!ee)continue;const ne=J.get(ee)??0;J.set(ee,ne+(q.amount??0))}const $=F.map(q=>{const ee=q.display_name||(q.email?q.email.split("@")[0]:"User"),ne=q.role,de=q.account_status??"active",me=O.get(q.id)??0,ve=J.get(q.id)??0;return{id:q.id,email:q.email,displayName:ee,role:ne,accountStatus:de,joinedAt:q.created_at,lastActiveAt:q.updated_at,totalAmount:ne==="fan"?me:ne==="creator"?ve:0}});n($),$.length>0&&!T&&S($[0].id)}finally{l(!1)}})()},[T]);const I=L.useMemo(()=>{const A=u.trim().toLowerCase();return s.filter(F=>g!=="all"&&F.role!==g||y!=="all"&&F.accountStatus!==y?!1:A?F.displayName.toLowerCase().includes(A)||F.email.toLowerCase().includes(A)||F.id.toLowerCase().includes(A):!0)},[s,u,g,y]),j=L.useMemo(()=>s.find(A=>A.id===T)??null,[s,T]),B=async(A,F)=>{const D={active:"Activate",suspended:"Suspend",banned:"Ban"};if(window.confirm(`${D[F]} ${A.displayName}? This will update their account status.`)){l(!0);try{const{error:O}=await ie.from("users").update({account_status:F}).eq("id",A.id);if(O){console.error("Error updating account status:",O),alert("Failed to update account status.");return}n(V=>V.map(G=>G.id===A.id?{...G,accountStatus:F}:G))}finally{l(!1)}}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"All Users"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Search, filter, and take bulk actions across the entire user base."})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",disabled:!0,children:"Export CSV"}),o.jsx(ue,{disabled:!0,children:"Send Notification"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Filters",subtitle:"Refine the user list by role, status, or activity."}),o.jsxs(be,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Search",placeholder:"Name, email, or ID",value:u,onChange:A=>f(A.target.value)}),o.jsx(nt,{label:"Registration Date",placeholder:"(coming soon)",disabled:!0}),o.jsx(nt,{label:"Last Active",placeholder:"(coming soon)",disabled:!0}),o.jsx(nt,{label:"Verification",placeholder:"(coming soon)",disabled:!0})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Roles"}),o.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:Zwe.map(A=>o.jsx("button",{className:`rounded-full border px-3 py-1 text-xs font-medium ${g===A.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,type:"button",onClick:()=>v(A.value),children:A.label},A.value))})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),o.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:eSe.map(A=>o.jsx("button",{className:`rounded-full border px-3 py-1 text-xs font-medium ${y===A.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,type:"button",onClick:()=>w(A.value),children:A.label},A.value))})]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Users",subtitle:"Bulk manage accounts and view key metrics."}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Select"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Name"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Email"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Role"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Joined"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Last Active"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent / Earned"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsxs("tbody",{children:[I.map(A=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3",children:o.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-[#CED4DA]"})}),o.jsx("td",{className:"py-3 text-[#212529]",children:A.displayName}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:A.email}),o.jsx("td",{className:"py-3 text-[#212529]",children:A.role}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:A.accountStatus==="active"?"success":A.accountStatus==="suspended"?"warning":"danger",children:A.accountStatus==="active"?"Active":A.accountStatus==="suspended"?"Suspended":"Banned"})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:Bt(A.joinedAt)}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:A.lastActiveAt?Bt(A.lastActiveAt):""}),o.jsx("td",{className:"py-3 text-[#212529]",children:A.totalAmount>0?Ue(A.totalAmount):""}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>S(A.id),children:"View"}),A.accountStatus!=="banned"&&o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>B(A,A.accountStatus==="suspended"?"active":"suspended"),children:A.accountStatus==="suspended"?"Unsuspend":"Suspend"}),A.accountStatus==="banned"?o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>B(A,"active"),children:"Unban"}):o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>B(A,"banned"),children:"Ban"})]})})]},A.id)),I.length===0&&!a&&o.jsx("tr",{children:o.jsx("td",{colSpan:9,className:"py-6 text-center text-sm text-[#6C757D]",children:"No users match your filters."})})]})]})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:j?`User Detail  ${j.displayName}`:"User Detail",subtitle:"Full profile view for context and actions."}),o.jsx(be,{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:j?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsxs("div",{className:"grid gap-2 text-sm text-[#212529] md:grid-cols-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Email"}),o.jsx("p",{children:j.email})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Role"}),o.jsx(Ye,{variant:"primary",children:j.role})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),o.jsx("p",{children:Bt(j.joinedAt)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Last Active"}),o.jsx("p",{children:j.lastActiveAt?Bt(j.lastActiveAt):""})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Status"}),o.jsx(Ye,{variant:j.accountStatus==="active"?"success":j.accountStatus==="suspended"?"warning":"danger",children:j.accountStatus==="active"?"Active":j.accountStatus==="suspended"?"Suspended":"Banned"})]})]}),o.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:o.jsxs("div",{className:"rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:j.role==="fan"?"Total Spent":j.role==="creator"?"Total Earned":"Total Volume"}),o.jsx("p",{className:"text-xl font-semibold",children:j.totalAmount>0?Ue(j.totalAmount):""})]})})]}),o.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"Admin Actions"}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx(ue,{variant:"secondary",onClick:()=>B(j,j.accountStatus==="active"?"suspended":"active"),children:j.accountStatus==="suspended"?"Unsuspend Account":"Suspend Account"}),o.jsx(ue,{variant:"danger",onClick:()=>B(j,"banned"),children:"Ban Account"})]})]})]}):o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Select a user from the table above to view details."})})]})]})}const rSe=[{label:"All",value:"all"},{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"}],g7={pending:"primary",approved:"success",rejected:"danger"},_7={pending:"Pending",approved:"Approved",rejected:"Rejected"};function sSe(){const[s,n]=L.useState([]),[a,l]=L.useState(!1),[u,f]=L.useState(""),[g,v]=L.useState("all"),[y,w]=L.useState(null),T=async()=>{l(!0);try{const{data:D,error:R}=await ie.from("users").select("id, email, display_name, role, creator_profile_status, created_at").eq("role","creator");if(R||!D||D.length===0){R&&console.error("Error fetching creators:",R),n([]);return}const O=D.map(ve=>ve.id);let V=[];if(O.length>0){const{data:ve}=await ie.from("profiles").select("user_id, username, display_name, bio").in("user_id",O);V=ve??[]}const G=new Map(V.map(ve=>[ve.user_id,ve]));let J=[];if(O.length>0){const{data:ve}=await ie.from("creator_settings").select("user_id, phone_number").in("user_id",O);J=ve??[]}const $=new Map(J.map(ve=>[ve.user_id,ve]));let q=[];if(O.length>0){const{data:ve}=await ie.from("linked_channels").select("user_id, platform, handle").in("user_id",O);q=ve??[]}const ee=new Map;for(const ve of q){const _e=ee.get(ve.user_id)??{};ve.platform==="instagram"?_e.instagram=ve.handle:ve.platform==="youtube"&&(_e.youtube=ve.handle),ee.set(ve.user_id,_e)}let ne=[];if(O.length>0){const{data:ve}=await ie.from("events").select("id, creator_id").in("creator_id",O);ne=ve??[]}const de=new Map;for(const ve of ne){const _e=ve.creator_id;de.set(_e,(de.get(_e)??0)+1)}const me=D.map(ve=>{const _e=G.get(ve.id),De=$.get(ve.id),Xe=ee.get(ve.id)??{},Oe=(_e==null?void 0:_e.display_name)||ve.display_name||(ve.email?ve.email.split("@")[0]:"Creator"),ae=_e!=null&&_e.username?`@${_e.username}`:"@creator",Ee=ve.creator_profile_status??"pending";return{id:ve.id,name:Oe,username:ae,email:ve.email,joinedAt:ve.created_at,status:Ee,phone:(De==null?void 0:De.phone_number)??null,bio:(_e==null?void 0:_e.bio)??null,instagram:Xe.instagram??null,youtube:Xe.youtube??null,totalEvents:de.get(ve.id)??0}});n(me),w(ve=>{var _e;return ve??((_e=me[0])==null?void 0:_e.id)??null})}finally{l(!1)}};L.useEffect(()=>{T()},[]);const S=L.useMemo(()=>{const D=u.trim().toLowerCase();return s.filter(R=>g!=="all"&&R.status!==g?!1:D?R.name.toLowerCase().includes(D)||R.email.toLowerCase().includes(D)||R.username.toLowerCase().includes(D):!0)},[s,u,g]),I=L.useMemo(()=>S.filter(D=>D.status==="pending"),[S]),j=L.useMemo(()=>S.filter(D=>D.status==="approved"),[S]),B=L.useMemo(()=>S.find(D=>D.id===y)??null,[S,y]),A=async(D,R)=>{if(window.confirm(`${R==="approved"?"Approve":"Reject"} ${D.name}?`)){l(!0);try{const{error:V}=await ie.from("users").update({creator_profile_status:R}).eq("id",D.id);if(V){console.error("Error updating creator status:",V),alert("Failed to update creator status.");return}const{error:G}=await ie.from("profiles").update({creator_profile_status:R}).eq("user_id",D.id);G&&console.error("Error updating creator status on profile:",G),n(J=>J.map($=>$.id===D.id?{...$,status:R}:$))}finally{l(!1)}}},F=D=>{try{return new Date(D).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"})}catch{return D}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Creator Approvals"}),o.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Review new applications and manage existing creators."})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",disabled:a,children:"Export"}),o.jsx(ue,{disabled:a,children:"Invite Creator"})]})]}),o.jsxs(pe,{className:"bg-[#2C2F33] text-white",children:[o.jsx(Ne,{title:"Filters",subtitle:"Search and filter creators by status.",className:"border-b border-[#3A3D42]"}),o.jsxs(be,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[o.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:o.jsx(nt,{label:"Search",placeholder:"Name, username, or email",value:u,onChange:D=>f(D.target.value)})}),o.jsx("div",{className:"flex flex-col gap-3",children:o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#ADB5BD]",children:"Status"}),o.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:rSe.map(D=>o.jsx("button",{type:"button",onClick:()=>v(D.value),className:`rounded-full border px-3 py-1 font-medium ${g===D.value?"border-[#C045FF] bg-[#3A1B4D] text-[#F7E9FF]":"border-[#3A3D42] bg-[#1F2124] text-[#ADB5BD] hover:border-[#C045FF]/60"}`,children:D.label},D.value))})]})})]})]}),o.jsxs(pe,{className:"bg-[#2C2F33] text-white",children:[o.jsx(Ne,{title:"Pending Approval",subtitle:"Creators awaiting manual review before onboarding",className:"border-b border-[#3A3D42]"}),o.jsx(be,{className:"gap-6",children:a&&I.length===0?o.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Loading pending creators"}):I.length===0?o.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"No creators pending approval."}):I.map(D=>o.jsxs("div",{className:"rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-lg font-semibold",children:D.name}),o.jsx("div",{className:"text-sm text-[#ADB5BD]",children:D.username})]}),o.jsxs(Ye,{variant:"primary",children:["Joined ",F(D.joinedAt)]})]}),o.jsxs("div",{className:"mt-4 grid gap-3 text-sm text-[#ADB5BD] md:grid-cols-2",children:[o.jsxs("div",{children:["Email: ",D.email]}),o.jsxs("div",{children:["Phone: ",D.phone??"Not provided"]}),o.jsxs("div",{className:"md:col-span-2",children:["Bio: ",D.bio??"Not provided"]}),o.jsxs("div",{children:[" Instagram: ",D.instagram??"Not linked"]}),o.jsxs("div",{children:[" YouTube: ",D.youtube??"Not linked"]})]}),o.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[o.jsx(ue,{variant:"danger",onClick:()=>A(D,"rejected"),disabled:a,children:" Reject"}),o.jsx(ue,{onClick:()=>A(D,"approved"),disabled:a,children:" Approve"}),o.jsx(ue,{variant:"secondary",onClick:()=>w(D.id),disabled:a,children:"View details"})]})]},D.id))})]}),o.jsxs(pe,{className:"bg-[#2C2F33] text-white",children:[o.jsx(Ne,{title:"Approved Creators"}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#ADB5BD]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Username"}),o.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Events"}),o.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Joined"}),o.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Actions"})]})}),o.jsxs("tbody",{children:[j.map(D=>o.jsxs("tr",{className:"border-b border-[#3A3D42]",children:[o.jsx("td",{className:"py-3 text-white",children:D.name}),o.jsx("td",{className:"py-3 text-[#ADB5BD]",children:D.username}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:g7[D.status],children:_7[D.status]})}),o.jsx("td",{className:"py-3 text-white",children:D.totalEvents}),o.jsx("td",{className:"py-3 text-[#ADB5BD]",children:F(D.joinedAt)}),o.jsx("td",{className:"py-3",children:o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>w(D.id),disabled:a,children:"View"})})]},D.id)),j.length===0&&!a&&o.jsx("tr",{children:o.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#ADB5BD]",children:"No approved creators yet."})})]})]})})]}),o.jsxs(pe,{className:"bg-[#2C2F33] text-white",children:[o.jsx(Ne,{title:B?`Creator Detail  ${B.name}`:"Creator Detail",subtitle:"Full profile view and admin actions for this creator.",className:"border-b border-[#3A3D42]"}),o.jsx(be,{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:B?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid gap-4 rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6",children:[o.jsxs("div",{className:"grid gap-3 text-sm text-[#ADB5BD] md:grid-cols-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Email"}),o.jsx("p",{className:"text-white",children:B.email})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Username"}),o.jsx("p",{className:"text-white",children:B.username})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Status"}),o.jsx(Ye,{variant:g7[B.status],children:_7[B.status]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),o.jsx("p",{className:"text-white",children:F(B.joinedAt)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Total Events"}),o.jsx("p",{className:"text-white",children:B.totalEvents})]})]}),o.jsxs("div",{className:"grid gap-3 text-sm text-[#ADB5BD]",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Phone"}),o.jsx("p",{className:"text-white",children:B.phone??"Not provided"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Instagram"}),o.jsx("p",{className:"text-white",children:B.instagram??"Not linked"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"YouTube"}),o.jsx("p",{className:"text-white",children:B.youtube??"Not linked"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Bio"}),o.jsx("p",{className:"text-white",children:B.bio??"Not provided"})]})]})]}),o.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6 text-sm text-white",children:[o.jsx("p",{className:"text-[#ADB5BD]",children:"Admin Actions"}),o.jsxs("div",{className:"flex flex-col gap-2",children:[B.status!=="approved"&&o.jsx(ue,{onClick:()=>A(B,"approved"),disabled:a,children:"Approve Creator"}),B.status!=="rejected"&&o.jsx(ue,{variant:"danger",onClick:()=>A(B,"rejected"),disabled:a,children:"Reject Creator"})]})]})]}):o.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Select a creator from the list above to view details."})})]})]})}const E7={segments:["High Spenders","Active Bidders","Inactive","Multiple Wins","Never Won","Refund Issues"],sortOptions:["Total Spent","Number of Bids","Wins Count","Join Date","Last Activity"]};function nSe(s){if(!s)return"No bids yet";const n=new Date(s),l=new Date().getTime()-n.getTime(),u=Math.floor(l/(1e3*60));if(u<1)return"Just now";if(u<60)return`${u} min ago`;const f=Math.floor(u/60);return f<24?`${f} h ago`:`${Math.floor(f/24)} d ago`}function v7(s,n,a,l){const u=n.find(F=>F.id===s);if(!u)return null;const f=a.filter(F=>F.fanId===s),g=f.length,v=f.reduce((F,D)=>F+(D.amount??0),0),y=f.reduce((F,D)=>Math.max(F,D.amount??0),0),w=f.filter(F=>F.status==="won").length,T=g>0?Math.round(w/g*100):0,S=f.filter(F=>F.status==="lost").reduce((F,D)=>F+Math.floor((D.amount??0)*.9),0),I=new Map;for(const F of f){const D=l[F.eventId],R=(D==null?void 0:D.category)||"General";I.set(R,(I.get(R)??0)+1)}const j=Array.from(I.entries()).sort((F,D)=>D[1]-F[1]).slice(0,3).map(([F])=>F),B=j.length>0?j.join(", "):"No data yet",A=f.slice().sort((F,D)=>new Date(D.createdAt).getTime()-new Date(F.createdAt).getTime()).slice(0,5).map(F=>{const D=l[F.eventId],O=new Date(F.createdAt).toLocaleDateString("en-IN",{month:"short",day:"2-digit"});let V;return F.status==="won"?V=" Won":F.status==="lost"?V=" Lost":F.status==="cancelled"?V="Cancelled":V=F.status,{date:O,event:(D==null?void 0:D.title)??"Event",amountLabel:Ue(F.amount??0),resultLabel:V}});return{profile:{id:u.id,code:u.code,name:u.name,email:u.email,phone:null,joinDate:Bt(u.joinedAt),preferredEvents:B,status:u.status,isVip:u.isVip,isFlagged:u.isFlagged},spending:{averageBid:g>0?v/g:0,highestBid:y,winRate:T,refundsTotal:S},bidHistory:A}}function iSe(){const[s,n]=L.useState([]),[a,l]=L.useState([]),[u,f]=L.useState({}),[g,v]=L.useState(null),[y,w]=L.useState(null),[T,S]=L.useState(!1),[I,j]=L.useState("");L.useEffect(()=>{(async()=>{var G;S(!0);try{const{data:J,error:$}=await ie.from("users").select("id, email, display_name, account_status, created_at, updated_at, is_vip, is_flagged_for_review").eq("role","fan");if($||!J){console.error("Error fetching fans:",$),n([]),l([]),f({}),v(null),w(null);return}const{data:q}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at"),ee=(q??[]).map(ae=>({id:ae.id,fanId:ae.fan_id,eventId:ae.event_id,amount:ae.amount??0,status:ae.status,createdAt:ae.created_at})),ne=Array.from(new Set(ee.map(ae=>ae.eventId).filter(Boolean))),{data:de}=ne.length?await ie.from("events").select("id, title, category").in("id",ne):{data:null},me={};for(const ae of de??[])me[ae.id]={id:ae.id,title:ae.title,category:ae.category};const ve=new Map;for(const ae of ee){const Ee=ve.get(ae.fanId)??[];Ee.push(ae),ve.set(ae.fanId,Ee)}const _e=new Date,De=J.map(ae=>{const Ee=ve.get(ae.id)??[],Le=Ee.filter(We=>We.status==="won").reduce((We,Ze)=>We+(Ze.amount??0),0),Ke=Ee.length,He=Ee.filter(We=>We.status==="won").length,gt=Ee.reduce((We,Ze)=>We?new Date(Ze.createdAt)>new Date(We.createdAt)?Ze:We:Ze,null),yt=gt?gt.createdAt:null;let It="Inactive";if(!yt)It="Inactive";else{const We=(_e.getTime()-new Date(yt).getTime())/864e5;We<=7?It="Active":We<=30?It="At risk":It="Inactive"}const Ct=`#F-${String(ae.id).slice(0,4).toUpperCase()}`,et=ae.display_name||(ae.email?ae.email.split("@")[0]:"Fan");return{id:ae.id,code:Ct,name:et,email:ae.email,totalSpent:Le,bids:Ke,wins:He,lastBidAt:yt,status:It,joinedAt:ae.created_at,isVip:ae.is_vip??!1,isFlagged:ae.is_flagged_for_review??!1}});De.sort((ae,Ee)=>Ee.totalSpent-ae.totalSpent);const Xe=((G=De[0])==null?void 0:G.id)??null,Oe=Xe?v7(Xe,De,ee,me):null;n(De),l(ee),f(me),v(Xe),w(Oe)}finally{S(!1)}})()},[]);const B=L.useMemo(()=>{const V=I.trim().toLowerCase();let G=[...s];return V&&(G=G.filter(J=>J.name.toLowerCase().includes(V)||J.email.toLowerCase().includes(V)||J.code.toLowerCase().includes(V))),G.sort((J,$)=>$.totalSpent-J.totalSpent),G},[s,I]),A=V=>{v(V);const G=v7(V,s,a,u);w(G)},F=async(V,G)=>{const J=window.prompt(`Enter offer amount () to send to ${G}:`,"100");if(!J)return;const $=parseInt(J,10);if(isNaN($)||$<=0){alert("Please enter a valid amount.");return}S(!0);try{const{error:q}=await ie.from("fan_offers").insert({fan_id:V,offer_type:"discount",offer_details:`${$} discount offer`,status:"pending",expires_at:new Date(Date.now()+6048e5).toISOString()});if(q){console.error("Error creating offer:",q),alert("Failed to send offer.");return}alert(`Offer of ${$} sent to ${G}!`)}finally{S(!1)}},D=async()=>{if(!g||!y)return;const V=window.prompt(`Enter loyalty reward amount () to add to ${y.profile.name}'s wallet:`,"500");if(!V)return;const G=parseInt(V,10);if(isNaN(G)||G<=0){alert("Please enter a valid amount.");return}S(!0);try{const{error:J}=await ie.from("loyalty_rewards").insert({fan_id:g,reward_type:"credits",amount:G,description:`Loyalty reward of ${G}`});if(J){console.error("Error creating loyalty reward:",J),alert("Failed to create loyalty reward record.");return}const{data:$}=await ie.from("wallets").select("id, balance").eq("user_id",g).maybeSingle();$?await ie.from("wallets").update({balance:($.balance??0)+G}).eq("id",$.id):await ie.from("wallets").insert({user_id:g,balance:G}),alert(`Loyalty reward of ${G} added to ${y.profile.name}'s wallet!`)}finally{S(!1)}},R=async()=>{if(!g||!y)return;const V=y.profile.isVip,G=V?"remove VIP status from":"grant VIP status to";if(window.confirm(`${G} ${y.profile.name}?`)){S(!0);try{const{error:$}=await ie.from("users").update({is_vip:!V}).eq("id",g);if($){console.error("Error updating VIP status:",$),alert("Failed to update VIP status.");return}n(q=>q.map(ee=>ee.id===g?{...ee,isVip:!V}:ee)),w(q=>q?{...q,profile:{...q.profile,isVip:!V}}:null),alert(`${y.profile.name} ${V?"removed from":"marked as"} VIP!`)}finally{S(!1)}}},O=async()=>{if(!g||!y)return;const V=y.profile.isFlagged;let G=null;if(V){if(!window.confirm(`Remove flag from ${y.profile.name}?`))return}else if(G=window.prompt("Enter reason for flagging this fan for review:"),G===null)return;S(!0);try{const{error:J}=await ie.from("users").update({is_flagged_for_review:!V,flagged_reason:V?null:G}).eq("id",g);if(J){console.error("Error updating flag status:",J),alert("Failed to update flag status.");return}n($=>$.map(q=>q.id===g?{...q,isFlagged:!V}:q)),w($=>$?{...$,profile:{...$.profile,isFlagged:!V}}:null),alert(`${y.profile.name} ${V?"unflagged":"flagged for review"}!`)}finally{S(!1)}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Fans Management"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Surface high-value fans, address churn risk, and track spending patterns."})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",children:"Create Segment"}),o.jsx(ue,{children:"Send Campaign"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Filters",subtitle:"Mix and match segments to focus on specific fan cohorts."}),o.jsxs(be,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Search Fans",placeholder:"Name, email, or ID",value:I,onChange:V=>j(V.target.value)}),o.jsx(nt,{label:"Date Range",placeholder:"Last activity"}),o.jsx(nt,{label:"Total Spent",placeholder:"> 5,000"}),o.jsx(nt,{label:"Win Rate",placeholder:"> 20%"})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Segments"}),o.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:E7.segments.map(V=>o.jsx(Ye,{variant:"primary",children:V},V))})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Sort By"}),o.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:E7.sortOptions.map(V=>o.jsx(Ye,{variant:"warning",children:V},V))})]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Fan Leaderboard",subtitle:"Compare engagement, wins, and spend at a glance."}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Fan"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Email"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Wins"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Last Bid"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsx("tbody",{children:B.map(V=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529]",children:o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-medium",children:[V.name,V.isVip&&o.jsx("span",{className:"ml-1 text-xs text-[#FFD700]",children:" VIP"}),V.isFlagged&&o.jsx("span",{className:"ml-1 text-xs text-[#DC3545]",children:""})]}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:V.code})]})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:V.email}),o.jsx("td",{className:"py-3 text-[#212529]",children:Ue(V.totalSpent)}),o.jsx("td",{className:"py-3 text-[#212529]",children:V.bids}),o.jsx("td",{className:"py-3 text-[#212529]",children:V.wins}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:nSe(V.lastBidAt)}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:V.status==="Active"?"success":V.status==="At risk"?"warning":"danger",children:V.status})}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>A(V.id),children:"View Profile"}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>F(V.id,V.name),disabled:T,children:"Send Offer"})]})})]},V.id))})]})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Fan Detail",subtitle:"Deep dive into engagement and outcomes for a specific fan."}),o.jsx(be,{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]",children:y?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[o.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Name / ID"}),o.jsx("p",{children:y.profile.name}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:y.profile.code})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Email"}),o.jsx("p",{children:y.profile.email})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Phone"}),o.jsx("p",{children:y.profile.phone??"Not provided"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),o.jsx("p",{children:y.profile.joinDate})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Status"}),o.jsxs("div",{className:"flex flex-wrap gap-1",children:[o.jsx(Ye,{variant:y.profile.status==="Active"?"success":y.profile.status==="At risk"?"warning":"danger",children:y.profile.status}),y.profile.isVip&&o.jsx(Ye,{variant:"warning",children:" VIP"}),y.profile.isFlagged&&o.jsx(Ye,{variant:"danger",children:" Flagged"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Preferences"}),o.jsx("p",{children:y.profile.preferredEvents})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"text-[#6C757D]",children:"Spending Pattern"}),o.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[o.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Average Bid"}),o.jsx("p",{className:"text-lg font-semibold",children:Ue(y.spending.averageBid)})]}),o.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Highest Bid"}),o.jsx("p",{className:"text-lg font-semibold",children:Ue(y.spending.highestBid)})]}),o.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Win Rate"}),o.jsxs("p",{className:"text-lg font-semibold",children:[y.spending.winRate,"%"]})]}),o.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Refunds"}),o.jsx("p",{className:"text-lg font-semibold",children:Ue(y.spending.refundsTotal)})]})]})]})]}),o.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Recent Bid History"}),o.jsx("ul",{className:"mt-2 space-y-2",children:y.bidHistory.map(V=>o.jsxs("li",{className:"flex items-center justify-between rounded-[10px] bg-[#F8F9FA] px-3 py-2",children:[o.jsxs("span",{children:[o.jsx("strong",{children:V.date}),"  ",V.event]}),o.jsxs("span",{children:[V.amountLabel," ",V.resultLabel]})]},`${V.date}-${V.event}-${V.amountLabel}`))})]}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx(ue,{variant:"secondary",onClick:D,disabled:T,children:" Send Loyalty Reward"}),o.jsx(ue,{variant:y.profile.isVip?"ghost":"primary",onClick:R,disabled:T,children:y.profile.isVip?" Remove VIP":" Mark as VIP"}),o.jsx(ue,{variant:y.profile.isFlagged?"secondary":"danger",onClick:O,disabled:T,children:y.profile.isFlagged?" Unflag":" Flag for Review"})]})]})]}):o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Select a fan from the leaderboard above to view detailed stats."})})]})]})}const aSe={live:{label:" LIVE",variant:"danger"},upcoming:{label:" Upcoming",variant:"primary"},completed:{label:" Completed",variant:"success"},cancelled:{label:" Cancelled",variant:"danger"},draft:{label:" Draft",variant:"warning"}};function oSe(){const[s,n]=L.useState([]),[a,l]=L.useState(null),[u,f]=L.useState(!1),[g,v]=L.useState(""),[y,w]=L.useState("all"),T=async()=>{f(!0);try{const{data:F,error:D}=await ie.from("events").select("id, creator_id, title, description, status, base_price, starts_at, duration_minutes, category, meeting_link").order("created_at",{ascending:!1});if(D||!F){console.error("Error fetching events:",D),n([]);return}const R=Array.from(new Set(F.map(q=>q.creator_id))),{data:O}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",R),V=new Map;for(const q of O??[])V.set(q.user_id,{displayName:q.display_name||q.username||"Creator",username:q.username||"creator"});const{data:G}=await ie.from("bids").select("event_id, amount"),J=new Map;for(const q of G??[]){const ee=J.get(q.event_id)??{count:0,highest:0};J.set(q.event_id,{count:ee.count+1,highest:Math.max(ee.highest,q.amount??0)})}const $=F.map(q=>{const ee=V.get(q.creator_id),ne=J.get(q.id)??{count:0,highest:0};return{id:q.id,code:`#E-${q.id.slice(0,4).toUpperCase()}`,creatorId:q.creator_id,creatorName:(ee==null?void 0:ee.displayName)??"Unknown",title:q.title,status:q.status,bidsCount:ne.count,highestBid:ne.highest,basePrice:q.base_price??0,startsAt:q.starts_at,category:q.category??"general"}});n($)}finally{f(!1)}};L.useEffect(()=>{T()},[]);const S=L.useMemo(()=>{let F=[...s];y!=="all"&&(F=F.filter(R=>R.status===y));const D=g.trim().toLowerCase();return D&&(F=F.filter(R=>R.title.toLowerCase().includes(D)||R.creatorName.toLowerCase().includes(D)||R.code.toLowerCase().includes(D))),F},[s,y,g]),I=async F=>{const D=s.find(V=>V.id===F);if(!D)return;const{data:R}=await ie.from("events").select("*").eq("id",F).single(),{data:O}=await ie.from("users").select("email").eq("id",D.creatorId).single();R&&l({id:R.id,code:`#E-${R.id.slice(0,4).toUpperCase()}`,title:R.title,description:R.description,creatorName:D.creatorName,creatorEmail:(O==null?void 0:O.email)??"N/A",status:R.status,category:R.category??"general",basePrice:R.base_price??0,highestBid:D.highestBid,bidsCount:D.bidsCount,startsAt:R.starts_at,durationMinutes:R.duration_minutes,meetingLink:R.meeting_link})},j=async F=>{if(window.confirm("Are you sure you want to cancel this event?")){f(!0);try{const{error:R}=await ie.from("events").update({status:"cancelled"}).eq("id",F);if(R){console.error("Error cancelling event:",R),alert("Failed to cancel event.");return}await T(),l(null),alert("Event cancelled successfully.")}finally{f(!1)}}},B=async F=>{if(window.confirm("Are you sure you want to DELETE this event? This cannot be undone.")){f(!0);try{await ie.from("bids").delete().eq("event_id",F);const{error:R}=await ie.from("events").delete().eq("id",F);if(R){console.error("Error deleting event:",R),alert("Failed to delete event.");return}await T(),l(null),alert("Event deleted successfully.")}finally{f(!1)}}},A=F=>aSe[F]??{label:F,variant:"secondary"};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Events Management"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track live, upcoming, and completed events."})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:["all","live","upcoming","completed","cancelled"].map(F=>o.jsx(ue,{variant:y===F?"secondary":"ghost",size:"sm",onClick:()=>w(F),children:F==="all"?"All":F.charAt(0).toUpperCase()+F.slice(1)},F))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Events",subtitle:`${S.length} events found`}),o.jsxs(be,{children:[o.jsx("div",{className:"mb-4",children:o.jsx(nt,{label:"Search Events",placeholder:"Search by title, creator, or ID...",value:g,onChange:F=>v(F.target.value)})}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event Title"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Highest Bid"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Starts At"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsxs("tbody",{children:[S.map(F=>{const D=A(F.status);return o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529]",children:F.code}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:F.creatorName}),o.jsx("td",{className:"py-3 text-[#212529]",children:F.title}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:D.variant,children:D.label})}),o.jsx("td",{className:"py-3 text-[#212529]",children:F.bidsCount}),o.jsx("td",{className:"py-3 text-[#212529]",children:F.highestBid>0?Ue(F.highestBid):Ue(F.basePrice)}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:Bt(F.startsAt)}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>I(F.id),disabled:u,children:"View"}),F.status!=="cancelled"&&F.status!=="completed"&&o.jsx(ue,{variant:"danger",size:"sm",onClick:()=>j(F.id),disabled:u,children:"Cancel"})]})})]},F.id)}),S.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:8,className:"py-8 text-center text-[#6C757D]",children:u?"Loading events...":"No events found"})})]})]})})]})]}),a&&o.jsxs(pe,{children:[o.jsx(Ne,{title:"Event Details",subtitle:a.code}),o.jsx(be,{children:o.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[o.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:a.title}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:a.description||"No description"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Creator"}),o.jsx("p",{className:"font-medium",children:a.creatorName}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:a.creatorEmail})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Category"}),o.jsx("p",{className:"font-medium capitalize",children:a.category})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Base Price"}),o.jsx("p",{className:"font-medium",children:Ue(a.basePrice)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Highest Bid"}),o.jsx("p",{className:"font-medium",children:Ue(a.highestBid)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Total Bids"}),o.jsx("p",{className:"font-medium",children:a.bidsCount})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Duration"}),o.jsxs("p",{className:"font-medium",children:[a.durationMinutes," min"]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Status"}),o.jsx(Ye,{variant:A(a.status).variant,children:A(a.status).label})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Starts At"}),o.jsx("p",{className:"font-medium",children:Bt(a.startsAt)})]})]}),a.meetingLink&&o.jsxs("div",{children:[o.jsx("p",{className:"text-[#6C757D]",children:"Meeting Link"}),o.jsx("a",{href:a.meetingLink,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 underline",children:a.meetingLink})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("h4",{className:"font-semibold text-[#212529]",children:"Admin Actions"}),o.jsxs("div",{className:"flex flex-col gap-2",children:[a.status!=="cancelled"&&a.status!=="completed"&&o.jsx(ue,{variant:"danger",onClick:()=>j(a.id),disabled:u,children:" Cancel Event"}),o.jsx(ue,{variant:"ghost",onClick:()=>B(a.id),disabled:u,children:" Delete Event Permanently"}),o.jsx(ue,{variant:"secondary",onClick:()=>l(null),children:"Close Details"})]})]})]})})]})]})}function cSe(){const[s,n]=L.useState([]),[a,l]=L.useState([]),[u,f]=L.useState(!1),g=async()=>{f(!0);try{const{data:S}=await ie.from("featured_creators").select("id, creator_id, display_order, featured_since, is_active").eq("is_active",!0).order("display_order",{ascending:!0}),I=(S??[]).map(ne=>ne.creator_id),{data:j}=await ie.from("users").select("id, email, display_name").eq("role","creator"),B=(j??[]).map(ne=>ne.id),{data:A}=await ie.from("profiles").select("user_id, display_name, username, category").in("user_id",B),F=new Map;for(const ne of A??[])F.set(ne.user_id,ne);const{data:D}=await ie.from("events").select("id, creator_id"),R=new Map;for(const ne of D??[])R.set(ne.creator_id,(R.get(ne.creator_id)??0)+1);const{data:O}=await ie.from("meets").select("creator_id, status").eq("status","completed"),V=new Map;for(const ne of O??[])V.set(ne.creator_id,(V.get(ne.creator_id)??0)+1);const{data:G}=await ie.from("bids").select("event_id, amount, status").eq("status","won"),J=new Map;for(const ne of D??[])J.set(ne.id,ne.creator_id);const $=new Map;for(const ne of G??[]){const de=J.get(ne.event_id);de&&$.set(de,($.get(de)??0)+(ne.amount??0))}const q=(S??[]).map(ne=>{const de=F.get(ne.creator_id);return{id:ne.id,creatorId:ne.creator_id,name:(de==null?void 0:de.display_name)||(de==null?void 0:de.username)||"Creator",username:de!=null&&de.username?`@${de.username}`:"@creator",category:(de==null?void 0:de.category)||"general",totalEarnings:$.get(ne.creator_id)??0,eventsCount:R.get(ne.creator_id)??0,featuredSince:ne.featured_since,displayOrder:ne.display_order}}),ee=(j??[]).filter(ne=>!I.includes(ne.id)).map(ne=>{const de=F.get(ne.id);return{id:ne.id,name:(de==null?void 0:de.display_name)||(de==null?void 0:de.username)||ne.display_name||"Creator",username:de!=null&&de.username?`@${de.username}`:"@creator",category:(de==null?void 0:de.category)||"general",eventsCount:R.get(ne.id)??0,completedMeets:V.get(ne.id)??0,totalEarnings:$.get(ne.id)??0}}).sort((ne,de)=>de.totalEarnings-ne.totalEarnings);n(q),l(ee)}finally{f(!1)}};L.useEffect(()=>{g()},[]);const v=async(S,I)=>{if(window.confirm(`Add ${I} to featured creators?`)){f(!0);try{const B=s.reduce((F,D)=>Math.max(F,D.displayOrder),0),{error:A}=await ie.from("featured_creators").insert({creator_id:S,display_order:B+1,is_active:!0});if(A){console.error("Error featuring creator:",A),alert("Failed to feature creator.");return}await g(),alert(`${I} is now featured!`)}finally{f(!1)}}},y=async(S,I)=>{if(window.confirm(`Remove ${I} from featured creators?`)){f(!0);try{const{error:B}=await ie.from("featured_creators").update({is_active:!1}).eq("id",S);if(B){console.error("Error removing featured creator:",B),alert("Failed to remove featured creator.");return}await g(),alert(`${I} removed from featured.`)}finally{f(!1)}}},w=async(S,I)=>{if(!(I<=1)){f(!0);try{const j=s.find(B=>B.displayOrder===I-1);j&&await ie.from("featured_creators").update({display_order:I}).eq("id",j.id),await ie.from("featured_creators").update({display_order:I-1}).eq("id",S),await g()}finally{f(!1)}}},T=async(S,I)=>{const j=s.reduce((B,A)=>Math.max(B,A.displayOrder),0);if(!(I>=j)){f(!0);try{const B=s.find(A=>A.displayOrder===I+1);B&&await ie.from("featured_creators").update({display_order:I}).eq("id",B.id),await ie.from("featured_creators").update({display_order:I+1}).eq("id",S),await g()}finally{f(!1)}}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Featured Creators"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control homepage placement, scheduling, and promotion of spotlighted creators."})]})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Featured Creators",subtitle:`${s.length} creators featured  Priority influences homepage carousel`}),o.jsxs(be,{className:"space-y-4",children:[s.length===0&&!u&&o.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No featured creators yet. Add creators from the candidate pool below."}),s.map((S,I)=>o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>w(S.id,S.displayOrder),disabled:u||I===0,children:""}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>T(S.id,S.displayOrder),disabled:u||I===s.length-1,children:""})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"text-sm text-[#6C757D]",children:["#",I+1]}),o.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:S.name}),o.jsx("div",{className:"text-sm text-[#6C757D]",children:S.username})]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-[#6C757D]",children:[o.jsxs("div",{children:["Category ",o.jsx("span",{className:"font-semibold capitalize text-[#212529]",children:S.category})]}),o.jsxs("div",{children:["Events ",o.jsx("span",{className:"font-semibold text-[#212529]",children:S.eventsCount})]}),o.jsxs("div",{children:["Earned ",o.jsx("span",{className:"font-semibold text-[#212529]",children:Ue(S.totalEarnings)})]}),o.jsxs(Ye,{variant:"primary",children:["Featured since ",new Date(S.featuredSince).toLocaleDateString("en-IN",{month:"short",day:"numeric",year:"numeric"})]})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:o.jsx(ue,{size:"sm",variant:"danger",onClick:()=>y(S.id,S.name),disabled:u,children:"Remove"})})]},S.id))]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Candidate Pool",subtitle:"High-performing creators eligible for featuring."}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Category"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Completed Meets"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Earnings"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsxs("tbody",{children:[a.map(S=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"font-medium text-[#212529]",children:S.name}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:S.username})]})}),o.jsx("td",{className:"py-3 capitalize text-[#212529]",children:S.category}),o.jsx("td",{className:"py-3 text-[#212529]",children:S.eventsCount}),o.jsx("td",{className:"py-3 text-[#212529]",children:S.completedMeets}),o.jsx("td",{className:"py-3 text-[#212529]",children:Ue(S.totalEarnings)}),o.jsx("td",{className:"py-3",children:o.jsx("div",{className:"flex gap-2 text-xs",children:o.jsx(ue,{size:"sm",variant:"primary",onClick:()=>v(S.id,S.name),disabled:u,children:" Feature"})})})]},S.id)),a.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:6,className:"py-8 text-center text-[#6C757D]",children:u?"Loading creators...":"No candidates available"})})]})]})})]})]})}const Bm={all:"All Users",fans:"Fans Only",creators:"Creators Only"},lSe={notification:"In-App Notification",banner:"Banner",modal:"Modal",email:"Email"},y7={draft:"warning",active:"success",expired:"danger",cancelled:"danger"};function dSe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState(!1),[f,g]=L.useState(""),[v,y]=L.useState(""),[w,T]=L.useState("all"),[S,I]=L.useState("notification"),[j,B]=L.useState(""),A=async()=>{u(!0);try{const{data:ee,error:ne}=await ie.from("admin_announcements").select("*").order("created_at",{ascending:!1});if(ne){console.error("Error fetching announcements:",ne),a([]);return}const de=(ee??[]).map(me=>({id:me.id,title:me.title,message:me.message,targetAudience:me.target_audience,displayType:me.display_type,status:me.status,scheduledAt:me.scheduled_at,expiresAt:me.expires_at,viewsCount:me.views_count??0,clicksCount:me.clicks_count??0,createdAt:me.created_at}));a(de)}finally{u(!1)}};L.useEffect(()=>{A()},[]);const F=()=>{g(""),y(""),T("all"),I("notification"),B("")},D=async()=>{if(!f.trim()||!v.trim()){alert("Please enter a title and message.");return}u(!0);try{const{error:ee}=await ie.from("admin_announcements").insert({title:f.trim(),message:v.trim(),target_audience:w,display_type:S,status:"draft",expires_at:j?new Date(j).toISOString():null,created_by:s==null?void 0:s.id});if(ee){console.error("Error saving draft:",ee),alert("Failed to save draft.");return}F(),await A(),alert("Draft saved successfully!")}finally{u(!1)}},R=async()=>{if(!f.trim()||!v.trim()){alert("Please enter a title and message.");return}const ee=Bm[w];if(window.confirm(`Publish announcement to ${ee}?

This will send notifications to all ${w==="all"?"users":w}.`)){u(!0);try{const{data:de,error:me}=await ie.from("admin_announcements").insert({title:f.trim(),message:v.trim(),target_audience:w,display_type:S,status:"active",expires_at:j?new Date(j).toISOString():null,created_by:s==null?void 0:s.id}).select().single();if(me||!de){console.error("Error creating announcement:",me),alert("Failed to create announcement.");return}let ve=ie.from("users").select("id");w==="fans"?ve=ve.eq("role","fan"):w==="creators"?ve=ve.eq("role","creator"):ve=ve.in("role",["fan","creator"]);const{data:_e,error:De}=await ve;if(De&&console.error("Error fetching users:",De),_e&&_e.length>0){const Xe=_e.map(Oe=>({user_id:Oe.id,type:"announcement",title:f.trim(),message:v.trim(),announcement_id:de.id,read:!1}));for(let Oe=0;Oe<Xe.length;Oe+=100){const ae=Xe.slice(Oe,Oe+100);await ie.from("notifications").insert(ae)}}F(),await A(),alert(`Announcement published! Notifications sent to ${(_e==null?void 0:_e.length)??0} users.`)}finally{u(!1)}}},O=async ee=>{const ne=n.find(ve=>ve.id===ee);if(!ne)return;const de=Bm[ne.targetAudience];if(window.confirm(`Publish "${ne.title}" to ${de}?

This will send notifications to all ${ne.targetAudience==="all"?"users":ne.targetAudience}.`)){u(!0);try{await ie.from("admin_announcements").update({status:"active"}).eq("id",ee);let ve=ie.from("users").select("id");ne.targetAudience==="fans"?ve=ve.eq("role","fan"):ne.targetAudience==="creators"?ve=ve.eq("role","creator"):ve=ve.in("role",["fan","creator"]);const{data:_e}=await ve;if(_e&&_e.length>0){const De=_e.map(Xe=>({user_id:Xe.id,type:"announcement",title:ne.title,message:ne.message,announcement_id:ee,read:!1}));for(let Xe=0;Xe<De.length;Xe+=100){const Oe=De.slice(Xe,Xe+100);await ie.from("notifications").insert(Oe)}}await A(),alert(`Announcement published! Notifications sent to ${(_e==null?void 0:_e.length)??0} users.`)}finally{u(!1)}}},V=async ee=>{if(window.confirm("Deactivate this announcement?")){u(!0);try{await ie.from("admin_announcements").update({status:"cancelled"}).eq("id",ee),await A(),alert("Announcement deactivated.")}finally{u(!1)}}},G=async ee=>{if(window.confirm("Delete this announcement permanently?")){u(!0);try{await ie.from("notifications").delete().eq("announcement_id",ee),await ie.from("admin_announcements").delete().eq("id",ee),await A(),alert("Announcement deleted.")}finally{u(!1)}}},J=n.filter(ee=>ee.status==="active"),$=n.filter(ee=>ee.status==="draft"),q=n.filter(ee=>ee.status==="expired"||ee.status==="cancelled");return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Announcements"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Publish platform-wide communications and send notifications to users."})]})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Composer",subtitle:"Create a new announcement with targeting options."}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Title",placeholder:"Announcement headline",value:f,onChange:ee=>g(ee.target.value)}),o.jsxs("div",{children:[o.jsx("label",{className:"mb-1 block text-sm font-medium text-[#212529]",children:"Target Audience"}),o.jsxs("select",{className:"w-full rounded-lg border border-[#E9ECEF] bg-white px-3 py-2 text-sm",value:w,onChange:ee=>T(ee.target.value),children:[o.jsx("option",{value:"all",children:" All Users (Fans + Creators)"}),o.jsx("option",{value:"fans",children:" Fans Only"}),o.jsx("option",{value:"creators",children:" Creators Only"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"mb-1 block text-sm font-medium text-[#212529]",children:"Display Type"}),o.jsxs("select",{className:"w-full rounded-lg border border-[#E9ECEF] bg-white px-3 py-2 text-sm",value:S,onChange:ee=>I(ee.target.value),children:[o.jsx("option",{value:"notification",children:" In-App Notification"}),o.jsx("option",{value:"banner",children:" Banner"}),o.jsx("option",{value:"modal",children:" Modal Popup"}),o.jsx("option",{value:"email",children:" Email"})]})]}),o.jsx(nt,{label:"Expiry Date (Optional)",type:"datetime-local",value:j,onChange:ee=>B(ee.target.value)}),o.jsx("div",{className:"md:col-span-2",children:o.jsx(ls,{label:"Message",rows:4,placeholder:"Write the announcement message here...",value:v,onChange:ee=>y(ee.target.value)})}),o.jsxs("div",{className:"flex flex-wrap gap-2 md:col-span-2",children:[o.jsx(ue,{variant:"secondary",onClick:D,disabled:l,children:" Save as Draft"}),o.jsx(ue,{onClick:R,disabled:l,children:" Publish & Send Notifications"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Active Announcements",subtitle:`${J.length} live announcements`}),o.jsxs(be,{className:"space-y-4",children:[J.length===0&&o.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No active announcements"}),J.map(ee=>o.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:ee.title}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Target: ",Bm[ee.targetAudience],"  Type: ",lSe[ee.displayType]]})]}),o.jsx(Ye,{variant:y7[ee.status],children:ee.status.charAt(0).toUpperCase()+ee.status.slice(1)})]}),o.jsx("p",{className:"text-sm text-[#212529]",children:ee.message}),o.jsxs("div",{className:"flex flex-wrap gap-6 text-sm text-[#6C757D]",children:[o.jsxs("span",{children:["Created: ",Bt(ee.createdAt)]}),ee.expiresAt&&o.jsxs("span",{children:["Expires: ",Bt(ee.expiresAt)]}),o.jsxs("span",{children:["Views: ",ee.viewsCount.toLocaleString()]})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:o.jsx(ue,{size:"sm",variant:"danger",onClick:()=>V(ee.id),disabled:l,children:"Deactivate"})})]},ee.id))]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Drafts",subtitle:`${$.length} drafts awaiting publish`}),o.jsxs(be,{className:"space-y-3",children:[$.length===0&&o.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No drafts"}),$.map(ee=>o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium",children:ee.title}),o.jsxs("div",{className:"text-xs text-[#6C757D]",children:["Target: ",Bm[ee.targetAudience],"  Created: ",Bt(ee.createdAt)]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{size:"sm",variant:"primary",onClick:()=>O(ee.id),disabled:l,children:" Publish Now"}),o.jsx(ue,{size:"sm",variant:"danger",onClick:()=>G(ee.id),disabled:l,children:"Delete"})]})]},ee.id))]})]}),q.length>0&&o.jsxs(pe,{children:[o.jsx(Ne,{title:"Past Announcements",subtitle:"Expired or cancelled announcements"}),o.jsx(be,{className:"space-y-3",children:q.map(ee=>o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium",children:ee.title}),o.jsxs("div",{className:"text-xs text-[#6C757D]",children:[Bm[ee.targetAudience],"  ",Bt(ee.createdAt)]})]}),o.jsx(Ye,{variant:y7[ee.status],children:ee.status.charAt(0).toUpperCase()+ee.status.slice(1)}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>G(ee.id),disabled:l,children:" Delete"})]},ee.id))})]})]})}const uSe={bid_authorization:"Bid",bid_refund:"Refund",bid_capture:"Capture",creator_earning:"Earning",creator_payout:"Payout",manual_adjustment:"Adjustment"};function hSe(){const[s,n]=L.useState([]),[a,l]=L.useState({totalProcessed:0,totalRefunded:0,pendingPayouts:0,totalCommission:0}),[u,f]=L.useState(!1),[g,v]=L.useState("all");L.useEffect(()=>{(async()=>{var T;f(!0);try{const{data:S}=await ie.from("wallet_transactions").select("id, wallet_id, type, direction, amount, reference_table, reference_id, description, created_at").order("created_at",{ascending:!1}).limit(100),I=Array.from(new Set((S??[]).map(_e=>_e.wallet_id))),{data:j}=I.length?await ie.from("wallets").select("id, user_id").in("id",I):{data:[]},B=new Map;for(const _e of j??[])B.set(_e.id,_e.user_id);const A=Array.from(new Set(Array.from(B.values()))),{data:F}=A.length?await ie.from("users").select("id, display_name, email").in("id",A):{data:[]},D=new Map;for(const _e of F??[])D.set(_e.id,_e.display_name||((T=_e.email)==null?void 0:T.split("@")[0])||"User");const R=(S??[]).filter(_e=>_e.reference_table==="events"||_e.reference_table==="bids").map(_e=>_e.reference_id).filter(Boolean),{data:O}=R.length?await ie.from("events").select("id, title").in("id",R):{data:[]},V=new Map;for(const _e of O??[])V.set(_e.id,_e.title);const G=(S??[]).map(_e=>{const De=B.get(_e.wallet_id)??"",Xe=new Date(_e.created_at);return{id:_e.id,date:Xe.toLocaleDateString("en-IN",{month:"short",day:"numeric"}),time:Xe.toLocaleTimeString("en-IN",{hour:"numeric",minute:"2-digit"}),userId:De,userName:D.get(De)??"Unknown",eventId:_e.reference_id,eventTitle:V.get(_e.reference_id)??_e.description??"-",amount:_e.amount??0,type:_e.type,direction:_e.direction,status:"Processed"}});n(G);const{data:J}=await ie.from("bids").select("amount, status"),$=(J??[]).filter(_e=>_e.status==="won"),q=(J??[]).filter(_e=>_e.status==="lost"),ee=$.reduce((_e,De)=>_e+(De.amount??0),0),ne=q.reduce((_e,De)=>_e+Math.floor((De.amount??0)*.9),0),de=$.reduce((_e,De)=>_e+Math.floor((De.amount??0)*.1),0)+q.reduce((_e,De)=>_e+Math.floor((De.amount??0)*.1),0),{data:me}=await ie.from("withdrawal_requests").select("amount").eq("status","pending"),ve=(me??[]).reduce((_e,De)=>_e+(De.amount??0),0);l({totalProcessed:ee,totalRefunded:ne,pendingPayouts:ve,totalCommission:de})}finally{f(!1)}})()},[]);const y=s.filter(w=>g==="all"?!0:g==="bids"?w.type==="bid_authorization"||w.type==="bid_capture":g==="refunds"?w.type==="bid_refund":g==="payouts"?w.type==="creator_payout"||w.type==="creator_earning":!0);return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Payments"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Review platform transactions, refunds, and commissions."})]}),o.jsx("div",{className:"flex gap-2",children:["all","bids","refunds","payouts"].map(w=>o.jsx(ue,{size:"sm",variant:g===w?"secondary":"ghost",onClick:()=>v(w),children:w.charAt(0).toUpperCase()+w.slice(1)},w))})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[o.jsxs(pe,{children:[o.jsx(Ne,{title:"Total Processed"}),o.jsxs(be,{children:[o.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:Ue(a.totalProcessed)}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"From winning bids"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Amount Returned to Fans"}),o.jsxs(be,{children:[o.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:Ue(a.totalRefunded)}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"90% of lost bids (non-winners)"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Pending Payouts"}),o.jsxs(be,{children:[o.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:Ue(a.pendingPayouts)}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Awaiting approval"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Platform Commission"}),o.jsxs(be,{children:[o.jsx("div",{className:"text-3xl font-bold text-[#28A745]",children:Ue(a.totalCommission)}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"10% from all bids"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Transactions",subtitle:`${y.length} transactions`}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Time"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Description"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Type"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Direction"})]})}),o.jsxs("tbody",{children:[y.map(w=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529]",children:w.date}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:w.time}),o.jsx("td",{className:"py-3 text-[#212529]",children:w.userName}),o.jsx("td",{className:"py-3 text-[#212529]",children:w.eventTitle}),o.jsx("td",{className:"py-3 text-[#212529]",children:Ue(w.amount)}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:"primary",children:uSe[w.type]??w.type})}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:w.direction==="credit"?"success":"danger",children:w.direction==="credit"?" Credit":" Debit"})})]},w.id)),y.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"py-8 text-center text-[#6C757D]",children:u?"Loading transactions...":"No transactions found"})})]})]})})]})]})}function pSe(){const[s,n]=L.useState([]),[a,l]=L.useState([]),[u,f]=L.useState(!1),[g,v]=L.useState({}),[y,w]=L.useState({}),T=async()=>{f(!0);try{const{data:A}=await ie.from("withdrawal_requests").select("*").order("requested_at",{ascending:!1}),F=Array.from(new Set((A??[]).map(de=>de.creator_id))),{data:D}=F.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",F):{data:[]},R=new Map;for(const de of D??[])R.set(de.user_id,{displayName:de.display_name||de.username||"Creator",username:de.username?`@${de.username}`:"@creator"});const{data:O}=await ie.from("bids").select("event_id, amount, status").eq("status","won"),{data:V}=await ie.from("events").select("id, creator_id"),G=new Map;for(const de of V??[])G.set(de.id,de.creator_id);const J=new Map;for(const de of O??[]){const me=G.get(de.event_id);if(me){const ve=Math.floor((de.amount??0)*.9);J.set(me,(J.get(me)??0)+ve)}}const $=new Map;for(const de of A??[])de.status==="completed"&&$.set(de.creator_id,($.get(de.creator_id)??0)+(de.amount??0));const q=(A??[]).map(de=>{const me=R.get(de.creator_id),ve=J.get(de.creator_id)??0,_e=$.get(de.creator_id)??0;return{id:de.id,code:`#WR-${de.id.slice(0,4).toUpperCase()}`,creatorId:de.creator_id,creatorName:(me==null?void 0:me.displayName)??"Unknown",creatorUsername:(me==null?void 0:me.username)??"@creator",amount:de.amount??0,destination:de.destination,status:de.status,requestedAt:de.requested_at,processedAt:de.processed_at,adminNotes:de.admin_notes,gatewayReference:de.gateway_reference,rejectionReason:de.rejection_reason,earnings:{total:ve,withdrawn:_e,pending:ve-_e}}}),ee=q.filter(de=>de.status==="pending"||de.status==="in_review"),ne=q.filter(de=>de.status==="completed"||de.status==="failed");n(ee),l(ne)}finally{f(!1)}};L.useEffect(()=>{T()},[]);const S=async A=>{const F=g[A]??{gatewayReference:"",adminNotes:""};if(!F.gatewayReference.trim()){alert("Please enter the gateway reference ID.");return}if(window.confirm("Confirm this payment has been processed?")){f(!0);try{const{error:R}=await ie.from("withdrawal_requests").update({status:"completed",processed_at:new Date().toISOString(),gateway_reference:F.gatewayReference.trim(),admin_notes:F.adminNotes.trim()||null}).eq("id",A);if(R){console.error("Error approving withdrawal:",R),alert("Failed to approve withdrawal.");return}await T(),v(O=>{const V={...O};return delete V[A],V}),alert("Withdrawal approved and marked as completed!")}finally{f(!1)}}},I=async A=>{const F=y[A]??{reason:"",message:""};if(!F.reason.trim()){alert("Please enter a rejection reason.");return}if(window.confirm("Reject this withdrawal request?")){f(!0);try{const{error:R}=await ie.from("withdrawal_requests").update({status:"failed",processed_at:new Date().toISOString(),rejection_reason:F.reason.trim(),admin_notes:F.message.trim()||null}).eq("id",A);if(R){console.error("Error rejecting withdrawal:",R),alert("Failed to reject withdrawal.");return}await T(),w(O=>{const V={...O};return delete V[A],V}),alert("Withdrawal request rejected.")}finally{f(!1)}}},j=A=>{const F=new Date(A),R=new Date().getTime()-F.getTime(),O=Math.floor(R/(1e3*60*60));return O<1?"Just now":O<24?`${O} hours ago`:`${Math.floor(O/24)} days ago`},B={pending:"warning",in_review:"primary",completed:"success",failed:"danger"};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Withdrawal Requests"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Verify payouts, capture references, and keep the audit trail healthy."})]}),o.jsxs(Ye,{variant:"warning",children:[s.length," pending"]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Pending",subtitle:"Requests needing manual review or payment confirmation."}),o.jsxs(be,{className:"space-y-4",children:[s.length===0&&o.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:u?"Loading...":"No pending withdrawal requests"}),s.map(A=>{const F=g[A.id]??{gatewayReference:"",adminNotes:""},D=y[A.id]??{reason:"",message:""};return o.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:A.creatorName}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:[A.creatorUsername,"  Requested ",j(A.requestedAt)]})]}),o.jsx(Ye,{variant:B[A.status]??"warning",children:A.status==="pending"?"Awaiting payout":A.status})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsxs("div",{className:"space-y-2 text-sm text-[#212529]",children:[o.jsxs("p",{children:["Request ID: ",o.jsx("strong",{children:A.code})]}),o.jsxs("p",{children:["Amount: ",o.jsx("strong",{className:"text-lg",children:Ue(A.amount)})]}),o.jsxs("p",{children:["Method: ",A.destination||"Not specified"]}),o.jsxs("p",{children:["Requested On: ",Bt(A.requestedAt)]})]}),o.jsxs("div",{className:"space-y-2 rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"Creator Earnings Breakdown"}),o.jsxs("p",{children:["Total Earnings: ",o.jsx("strong",{children:Ue(A.earnings.total)})]}),o.jsxs("p",{children:["Withdrawn: ",o.jsx("strong",{children:Ue(A.earnings.withdrawn)})]}),o.jsxs("p",{children:["Available Balance: ",o.jsx("strong",{className:"text-[#28A745]",children:Ue(A.earnings.pending)})]})]})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[o.jsxs("div",{className:"space-y-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[o.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:" Mark as Paid"}),o.jsx(nt,{label:"Gateway Reference ID",placeholder:"pay_xyz123",value:F.gatewayReference,onChange:R=>v(O=>({...O,[A.id]:{...F,gatewayReference:R.target.value}}))}),o.jsx(ls,{label:"Admin Notes",rows:2,placeholder:"Optional note for audit log",value:F.adminNotes,onChange:R=>v(O=>({...O,[A.id]:{...F,adminNotes:R.target.value}}))}),o.jsx(ue,{size:"sm",onClick:()=>S(A.id),disabled:u,children:"Confirm Payment"})]}),o.jsxs("div",{className:"space-y-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[o.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:" Reject Request"}),o.jsx(nt,{label:"Reason",placeholder:"Insufficient balance / pending dispute / ...",value:D.reason,onChange:R=>w(O=>({...O,[A.id]:{...D,reason:R.target.value}}))}),o.jsx(ls,{label:"Message to creator",rows:2,placeholder:"Explain next steps",value:D.message,onChange:R=>w(O=>({...O,[A.id]:{...D,message:R.target.value}}))}),o.jsx(ue,{size:"sm",variant:"danger",onClick:()=>I(A.id),disabled:u,children:"Reject Request"})]})]})]},A.id)})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"History",subtitle:"Resolved withdrawal requests across the platform."}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Method"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Processed"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Reference"})]})}),o.jsxs("tbody",{children:[a.map(A=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#6C757D]",children:A.code}),o.jsx("td",{className:"py-3 text-[#212529]",children:A.creatorName}),o.jsx("td",{className:"py-3 text-[#212529]",children:Ue(A.amount)}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:A.destination||"-"}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:B[A.status]??"primary",children:A.status==="completed"?"Paid":"Rejected"})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:A.processedAt?Bt(A.processedAt):"-"}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:A.gatewayReference||A.rejectionReason||"-"})]},A.id)),a.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"py-8 text-center text-[#6C757D]",children:u?"Loading...":"No withdrawal history"})})]})]})})]})]})}const fSe=[{id:"#RF-789",user:"Rahul Kumar",email:"rahul@email.com",event:"#342  Meet & Greet with Priya",amount:"270",type:"Auto 90%",status:"Processed",processedOn:"Jan 12, 2025"},{id:"#RF-788",user:"Priya Singh",email:"priya@email.com",event:"#341  Cooking Demo",amount:"180",type:"Auto 90%",status:"Processed",processedOn:"Jan 12, 2025"},{id:"#RF-787",user:"Amit Gupta",email:"amit@email.com",event:"#340  Productivity Masterclass",amount:"450",type:"Manual",status:"Pending Retry",processedOn:"Jan 11, 2025"},{id:"#RF-786",user:"Neha Kapoor",email:"neha@email.com",event:"#339  Cooking with Chef Rohan",amount:"320",type:"Auto 90%",status:"Failed",processedOn:"Jan 11, 2025"}],kd={id:"#RF-786",reason:"Payment method expired / Bank account closed",gatewayError:"BAD_REQUEST_ERROR  Invalid account details",attempts:3,amount:"288 (90%)",originalBid:"320",user:"Neha Kumar (neha@email.com)"};function mSe(){return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Refunds Management"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track automatic and manual refunds, investigate failures, and trigger overrides."})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",children:"Export Report"}),o.jsx(ue,{children:"Process Manual Refund"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Overview",subtitle:"Quick insight into refund volume and outcomes."}),o.jsx(be,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[{label:"Refunds Today",value:"23,450  89 refunds"},{label:"This Week",value:"1,45,200  456 refunds"},{label:"This Month",value:"4,52,300  1,234 refunds"},{label:"Failed Pending",value:"12  3,400"}].map(s=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:s.label}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:s.value})]},s.label))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Refunds",subtitle:"Filter by status, type, or amount to focus investigation."}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Type"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Processed"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsx("tbody",{children:fSe.map(s=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#6C757D]",children:s.id}),o.jsx("td",{className:"py-3 text-[#212529]",children:o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"font-medium",children:s.user}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:s.email})]})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:s.event}),o.jsx("td",{className:"py-3 text-[#212529]",children:s.amount}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:s.type}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:s.status==="Processed"?"success":s.status==="Pending Retry"?"warning":"danger",children:s.status})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:s.processedOn}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[o.jsx(ue,{size:"sm",variant:"secondary",children:"View Details"}),o.jsx(ue,{size:"sm",variant:"ghost",children:"Retry"})]})})]},s.id))})]})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Failed Refunds Requiring Action",subtitle:"Resolve gateway failures with manual interventions."}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[o.jsxs("p",{className:"font-semibold",children:["Refund ",kd.id]}),o.jsx("p",{className:"mt-1 text-[#6C757D]",children:kd.user}),o.jsxs("p",{className:"mt-4",children:["Original Bid: ",kd.originalBid]}),o.jsxs("p",{children:["Refund Amount: ",kd.amount]}),o.jsxs("p",{children:["Attempts: ",kd.attempts]}),o.jsxs("p",{className:"mt-3 text-[#D9480F]",children:["Failure Reason: ",kd.reason]}),o.jsxs("p",{className:"text-[#6C757D]",children:["Gateway Error: ",kd.gatewayError]})]}),o.jsxs("div",{className:"space-y-3 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[o.jsx(nt,{label:"Next Step",placeholder:"Retry via gateway / Manual transfer"}),o.jsx(ls,{label:"Notes",rows:3,placeholder:"Add context for audit trail"}),o.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[o.jsx(ue,{variant:"secondary",children:"Retry Refund"}),o.jsx(ue,{variant:"ghost",children:"Contact User"})]}),o.jsx(ue,{variant:"danger",children:"Mark as Resolved"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Manual Refund",subtitle:"Issue full or partial refunds outside the automatic flow."}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"User",placeholder:"Search by email / phone / ID"}),o.jsx(nt,{label:"Event (optional)",placeholder:"Search event"}),o.jsx(nt,{label:"Refund Amount",placeholder:""}),o.jsx(nt,{label:"Reason",placeholder:"Event cancelled / Technical issue / Gesture"}),o.jsx(ls,{label:"Additional Notes",rows:3,placeholder:"Context for support team"}),o.jsx("div",{className:"md:col-span-2",children:o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsx(ue,{variant:"secondary",children:"Preview Email"}),o.jsx(ue,{children:"Process Refund"})]})})]})]})]})}function gSe(){const[s,n]=L.useState("month"),[a,l]=L.useState({grossRevenue:0,netRevenue:0,platformCommission:0,creatorPayouts:0,avgEventRevenue:0,paidEventsCount:0,freeEventsCount:0,totalRefunds:0}),[u,f]=L.useState([]),[g,v]=L.useState([]),[y,w]=L.useState([]),[T,S]=L.useState([]),[I,j]=L.useState(!1),B=R=>{const O=new Date,V=new Date(O);let G=new Date(O);switch(R){case"today":G.setHours(0,0,0,0);break;case"7days":G.setDate(G.getDate()-7);break;case"30days":G.setDate(G.getDate()-30);break;case"month":G=new Date(O.getFullYear(),O.getMonth(),1);break;case"all":G=new Date(2020,0,1);break}return{start:G,end:V}};L.useEffect(()=>{(async()=>{j(!0);try{const{start:O,end:V}=B(s),{data:G}=await ie.from("bids").select("id, event_id, amount, status, created_at").gte("created_at",O.toISOString()).lte("created_at",V.toISOString()),J=Array.from(new Set((G??[]).map(Pe=>Pe.event_id))),{data:$}=J.length?await ie.from("events").select("id, creator_id, base_price, duration_minutes, is_paid, created_at").in("id",J):{data:[]},q=new Map;for(const Pe of $??[])q.set(Pe.id,Pe);const{data:ee}=await ie.from("events").select("id, is_paid, created_at").gte("created_at",O.toISOString()).lte("created_at",V.toISOString()),ne=(ee??[]).filter(Pe=>Pe.is_paid!==!1).length,de=(ee??[]).filter(Pe=>Pe.is_paid===!1).length,me=Array.from(new Set(($??[]).map(Pe=>Pe.creator_id))),{data:ve}=me.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",me):{data:[]},_e=new Map;for(const Pe of ve??[])_e.set(Pe.user_id,Pe.display_name||Pe.username||"Creator");const De=(G??[]).filter(Pe=>Pe.status==="won"),Xe=(G??[]).filter(Pe=>Pe.status==="lost"),Oe=[...De,...Xe].reduce((Pe,$e)=>Pe+($e.amount??0),0),ae=Math.floor(Oe*.1),Ee=Xe.reduce((Pe,$e)=>Pe+Math.floor(($e.amount??0)*.9),0),Le=De.reduce((Pe,$e)=>Pe+Math.floor(($e.amount??0)*.9),0),Ke=Oe,He=ae,gt=J.length>0?Ke/J.length:0;l({grossRevenue:Ke,netRevenue:He,platformCommission:ae,creatorPayouts:Le,avgEventRevenue:gt,paidEventsCount:ne,freeEventsCount:de,totalRefunds:Ee});const yt=new Map;for(const Pe of G??[]){const $e=new Date(Pe.created_at).toLocaleDateString("en-IN",{month:"short",day:"numeric"}),kt=yt.get($e)??{date:$e,eventsCount:0,bidsCount:0,revenue:0,commission:0,refunds:0};kt.bidsCount++,Pe.status==="won"?(kt.revenue+=Pe.amount??0,kt.commission+=Math.floor((Pe.amount??0)*.1)):Pe.status==="lost"&&(kt.refunds+=Math.floor((Pe.amount??0)*.9),kt.commission+=Math.floor((Pe.amount??0)*.1)),yt.set($e,kt)}for(const Pe of ee??[]){const $e=new Date(Pe.created_at).toLocaleDateString("en-IN",{month:"short",day:"numeric"}),kt=yt.get($e);kt&&kt.eventsCount++}f(Array.from(yt.values()).slice(0,10));const It=new Map;for(const Pe of De){const $e=q.get(Pe.event_id);if(!$e)continue;const kt=It.get($e.creator_id)??0;It.set($e.creator_id,kt+(Pe.amount??0))}const Ct=Array.from(It.entries()).map(([Pe,$e])=>({creatorId:Pe,name:_e.get(Pe)??"Unknown",revenue:$e})).sort((Pe,$e)=>$e.revenue-Pe.revenue).slice(0,5);v(Ct);const et=new Map;for(const Pe of De){const $e=q.get(Pe.event_id);if(!$e)continue;const kt=($e.base_price??0)<=50?"Paid Events  50 Base":($e.base_price??0)<=100?"Paid Events  100 Base":"Paid Events  100+ Base";et.set(kt,(et.get(kt)??0)+(Pe.amount??0))}const We=Array.from(et.entries()).map(([Pe,$e])=>({type:Pe,revenue:$e,percent:Ke>0?$e/Ke*100:0})).sort((Pe,$e)=>$e.revenue-Pe.revenue);w(We);const Ze=new Map;for(const Pe of De){const $e=q.get(Pe.event_id);if(!$e)continue;const kt=($e.duration_minutes??5)<=5?"5-minute events":($e.duration_minutes??5)<=10?"10-minute events":"15+ minute events";Ze.set(kt,(Ze.get(kt)??0)+(Pe.amount??0))}const ye=Array.from(Ze.entries()).map(([Pe,$e])=>({duration:Pe,revenue:$e,percent:Ke>0?$e/Ke*100:0})).sort((Pe,$e)=>$e.revenue-Pe.revenue);S(ye)}finally{j(!1)}})()},[s]);const A=a.paidEventsCount+a.freeEventsCount,F=A>0?Math.round(a.paidEventsCount/A*100):0,D=A>0?Math.round(a.freeEventsCount/A*100):0;return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Revenue Analytics"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Monitor revenue flows, commission, and payouts with configurable time ranges."})]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"today",label:"Today"},{key:"7days",label:"Last 7 Days"},{key:"30days",label:"Last 30 Days"},{key:"month",label:"This Month"},{key:"all",label:"All Time"}].map(R=>o.jsx(ue,{size:"sm",variant:s===R.key?"secondary":"ghost",onClick:()=>n(R.key),children:R.label},R.key))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Summary",subtitle:"Key financial metrics for the selected range."}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Gross Revenue"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Ue(a.grossRevenue)})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Net Revenue"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Ue(a.netRevenue)})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Platform Commission"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#28A745]",children:Ue(a.platformCommission)})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Creator Payouts"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Ue(a.creatorPayouts)})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Avg Event Revenue"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Ue(a.avgEventRevenue)})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Paid Events"}),o.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:[a.paidEventsCount," (",F,"%)"]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Free Events"}),o.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:[a.freeEventsCount," (",D,"%)"]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunds"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#DC3545]",children:Ue(a.totalRefunds)})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Revenue Breakdown",subtitle:"Analyze by event type, duration, and top creators."}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-3",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[o.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Revenue by Event Type"}),o.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[y.length===0&&o.jsx("li",{children:"No data"}),y.map(R=>o.jsxs("li",{children:[R.type,"  ",R.percent.toFixed(0),"% (",Ue(R.revenue),")"]},R.type))]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[o.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Top Revenue Creators"}),o.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[g.length===0&&o.jsx("li",{children:"No data"}),g.map(R=>o.jsxs("li",{children:[R.name,"  ",Ue(R.revenue)]},R.creatorId))]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[o.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Revenue by Duration"}),o.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[T.length===0&&o.jsx("li",{children:"No data"}),T.map(R=>o.jsxs("li",{children:[R.duration,"  ",R.percent.toFixed(0),"% (",Ue(R.revenue),")"]},R.duration))]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Revenue by Date",subtitle:"Daily breakdown for reporting."}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Revenue"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Commission"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Refunds"})]})}),o.jsxs("tbody",{children:[u.map(R=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529]",children:R.date}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:R.eventsCount}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:R.bidsCount}),o.jsx("td",{className:"py-3 text-[#212529]",children:Ue(R.revenue)}),o.jsx("td",{className:"py-3 text-[#28A745]",children:Ue(R.commission)}),o.jsx("td",{className:"py-3 text-[#DC3545]",children:Ue(R.refunds)})]},R.date)),u.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:6,className:"py-8 text-center text-[#6C757D]",children:I?"Loading...":"No revenue data available"})})]})]})})]})]})}function _Se(){const[s,n]=L.useState({total:0,fromWinners:0,fromNonWinners:0,eventsProcessed:0,avgPerEvent:0,yearlyProjection:0}),[a,l]=L.useState([]),[u,f]=L.useState([]),[g,v]=L.useState(!1);L.useEffect(()=>{(async()=>{v(!0);try{const{data:S}=await ie.from("bids").select("id, event_id, amount, status, created_at"),I=Array.from(new Set((S??[]).map(Ee=>Ee.event_id))),{data:j}=I.length?await ie.from("events").select("id, creator_id, base_price, status").in("id",I):{data:[]},B=new Map;for(const Ee of j??[])B.set(Ee.id,{creatorId:Ee.creator_id,basePrice:Ee.base_price??0});const A=Array.from(new Set((j??[]).map(Ee=>Ee.creator_id))),{data:F}=A.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",A):{data:[]},D=new Map;for(const Ee of F??[])D.set(Ee.user_id,Ee.display_name||Ee.username||"Creator");const R=(S??[]).filter(Ee=>Ee.status==="won"),O=(S??[]).filter(Ee=>Ee.status==="lost"),V=R.reduce((Ee,Le)=>Ee+Math.floor((Le.amount??0)*.1),0),G=O.reduce((Ee,Le)=>Ee+Math.floor((Le.amount??0)*.1),0),J=V+G,q=(j??[]).filter(Ee=>Ee.status==="completed").length||I.length,ee=q>0?J/q:0,ne=new Date,de=new Date(ne.getFullYear(),ne.getMonth()+1,0).getDate(),me=ne.getDate(),_e=(me>0?J/me*de:J)*12;n({total:J,fromWinners:V,fromNonWinners:G,eventsProcessed:q,avgPerEvent:ee,yearlyProjection:_e});const De=new Map;for(const Ee of S??[]){const Le=B.get(Ee.event_id);if(!Le)continue;const{creatorId:Ke}=Le,He=De.get(Ke)??{events:new Set,revenue:0,commission:0};He.events.add(Ee.event_id),Ee.status==="won"?(He.revenue+=Ee.amount??0,He.commission+=Math.floor((Ee.amount??0)*.1)):Ee.status==="lost"&&(He.commission+=Math.floor((Ee.amount??0)*.1)),De.set(Ke,He)}const Xe=Array.from(De.entries()).map(([Ee,Le])=>({creatorId:Ee,creatorName:D.get(Ee)??"Unknown",eventsCount:Le.events.size,totalRevenue:Le.revenue,commission:Le.commission,sharePercent:J>0?Le.commission/J*100:0})).sort((Ee,Le)=>Le.commission-Ee.commission).slice(0,10);l(Xe);const Oe=new Map;for(const Ee of S??[]){if(Ee.status!=="won"&&Ee.status!=="lost")continue;const Le=B.get(Ee.event_id);if(!Le)continue;const Ke=Le.basePrice<=50?"50 Base":Le.basePrice<=100?"100 Base":"100+ Base",He=Oe.get(Ke)??{commission:0};He.commission+=Math.floor((Ee.amount??0)*.1),Oe.set(Ke,He)}const ae=Array.from(Oe.entries()).map(([Ee,Le])=>({basePrice:Ee,commission:Le.commission,sharePercent:J>0?Le.commission/J*100:0})).sort((Ee,Le)=>Le.commission-Ee.commission);f(ae)}finally{v(!1)}})()},[]);const y=s.total>0?Math.round(s.fromWinners/s.total*100):0,w=s.total>0?Math.round(s.fromNonWinners/s.total*100):0;return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Platform Commission"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Breakdown of commission collected across winners and non-winners plus projection insights."})]})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Summary",subtitle:"Current overview"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Commission"}),o.jsx("p",{className:"mt-2 text-xl font-semibold text-[#28A745]",children:Ue(s.total)}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"All event revenue combined"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"From Winners"}),o.jsxs("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:[Ue(s.fromWinners)," (",y,"%)"]}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"10% cut from winning bids"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"From Non-winners"}),o.jsxs("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:[Ue(s.fromNonWinners)," (",w,"%)"]}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Retained from 90% refunds"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Processed"}),o.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:s.eventsProcessed}),o.jsxs("p",{className:"text-xs text-[#6C757D]",children:["Average per event ",Ue(s.avgPerEvent)]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Yearly Projection"}),o.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:Ue(s.yearlyProjection)}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Based on current run rate"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Event Type Breakdown",subtitle:"Commission by pricing tier"}),o.jsxs(be,{className:"space-y-3",children:[u.length===0&&!g&&o.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No data available"}),u.map(T=>o.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[o.jsx("span",{children:T.basePrice}),o.jsxs("span",{className:"text-[#6C757D]",children:[T.sharePercent.toFixed(1),"%"]}),o.jsx("span",{className:"font-semibold",children:Ue(T.commission)})]},T.basePrice))]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Commission by Creator",subtitle:"Top contributors to platform revenue"}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Revenue"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Commission"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Share"})]})}),o.jsxs("tbody",{children:[a.map(T=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529]",children:T.creatorName}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:T.eventsCount}),o.jsx("td",{className:"py-3 text-[#212529]",children:Ue(T.totalRevenue)}),o.jsx("td",{className:"py-3 font-semibold text-[#28A745]",children:Ue(T.commission)}),o.jsxs("td",{className:"py-3 text-[#6C757D]",children:[T.sharePercent.toFixed(1),"%"]})]},T.creatorId)),a.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:g?"Loading...":"No commission data available"})})]})]})})]})]})}function ESe(){const[s,n]=L.useState([]),[a,l]=L.useState([]),[u,f]=L.useState([]),[g,v]=L.useState([]),[y,w]=L.useState(!1);return L.useEffect(()=>{(async()=>{w(!0);try{const{data:S}=await ie.from("users").select("id, role, created_at"),I=(S==null?void 0:S.length)??0,j=(S??[]).filter(ye=>ye.role==="fan").length,B=(S??[]).filter(ye=>ye.role==="creator").length,{data:A}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at"),F=(A==null?void 0:A.length)??0,D=(A??[]).filter(ye=>ye.status==="won"),R=new Set((A??[]).map(ye=>ye.fan_id)).size,O=F>0?(A??[]).reduce((ye,Pe)=>ye+(Pe.amount??0),0)/F:0,V=F>0?D.length/F*100:0,{data:G}=await ie.from("events").select("id, creator_id, status, base_price, is_paid, created_at"),J=(G==null?void 0:G.length)??0,$=(G??[]).filter(ye=>ye.status==="completed").length,q=J>0?$/J*100:0,{data:ee}=await ie.from("meets").select("id, status"),ne=(ee??[]).filter(ye=>ye.status==="completed").length,de=D.reduce((ye,Pe)=>ye+(Pe.amount??0),0),me=j>0?de/j:0,ve=I>0?R/I*100:0,_e=new Date,De=new Date(_e.getFullYear(),_e.getMonth(),1),Xe=new Date(_e.getFullYear(),_e.getMonth()-1,1),Oe=new Date(_e.getFullYear(),_e.getMonth(),0),ae=(S??[]).filter(ye=>new Date(ye.created_at)>=De).length,Ee=(S??[]).filter(ye=>{const Pe=new Date(ye.created_at);return Pe>=Xe&&Pe<=Oe}).length,Le=Ee>0?(ae-Ee)/Ee*100:0;n([{label:"Monthly Growth Rate",value:`${Le>=0?"+":""}${Le.toFixed(1)}%`,variant:Le>=0?"success":"danger"},{label:"Conversion Rate",value:`${ve.toFixed(1)}%`,variant:ve>10?"success":"warning"},{label:"Avg Bid Amount",value:Ue(O)},{label:"Win Rate",value:`${V.toFixed(1)}%`},{label:"Event Completion",value:`${q.toFixed(1)}%`,variant:q>90?"success":"warning"},{label:"ARPU",value:Ue(me)},{label:"Total Revenue",value:Ue(de),variant:"success"},{label:"Active Creators",value:B.toString()}]),l([{stage:"Total Users",value:I,percentage:"100%"},{stage:"Fans (Potential Bidders)",value:j,percentage:I>0?`${(j/I*100).toFixed(1)}%`:"0%"},{stage:"Placed a Bid",value:R,percentage:I>0?`${(R/I*100).toFixed(1)}%`:"0%"},{stage:"Won an Event",value:D.length,percentage:I>0?`${(D.length/I*100).toFixed(1)}%`:"0%"},{stage:"Completed Meet",value:ne,percentage:I>0?`${(ne/I*100).toFixed(1)}%`:"0%"}]);const Ke=(G??[]).filter(ye=>(ye.base_price??0)<=50&&ye.is_paid!==!1),He=(G??[]).filter(ye=>(ye.base_price??0)>50&&(ye.base_price??0)<=100),gt=(G??[]).filter(ye=>ye.is_paid===!1),yt=(ye,Pe)=>{const $e=ye.map(ft=>ft.id),kt=(A??[]).filter(ft=>$e.includes(ft.event_id)),Kt=kt.filter(ft=>ft.status==="won"),Ht=ye.filter(ft=>ft.status==="completed").length;return{label:Pe,totalCreated:ye.length,avgParticipants:ye.length>0?kt.length/ye.length:0,avgFinalBid:Kt.length>0?Kt.reduce((ft,dr)=>ft+(dr.amount??0),0)/Kt.length:0,completionRate:ye.length>0?Ht/ye.length*100:0,avgCreatorRevenue:Kt.length>0?Kt.reduce((ft,dr)=>ft+(dr.amount??0),0)*.9/Kt.length:0}};f([yt(Ke,"Paid Events (50 Base)"),yt(He,"Paid Events (100 Base)"),yt(gt,"Free Events")]);const{data:It}=await ie.from("profiles").select("user_id, display_name, username"),Ct=new Map;for(const ye of It??[])Ct.set(ye.user_id,ye.display_name||ye.username||"Creator");const et=new Map;for(const ye of G??[])et.set(ye.id,ye.creator_id);const We=new Map;for(const ye of D){const Pe=et.get(ye.event_id);if(!Pe)continue;const $e=We.get(Pe)??{events:new Set,revenue:0};$e.events.add(ye.event_id),$e.revenue+=(ye.amount??0)*.9,We.set(Pe,$e)}const Ze=Array.from(We.entries()).map(([ye,Pe])=>({creatorId:ye,name:Ct.get(ye)??"Unknown",eventsCount:Pe.events.size,revenue:Pe.revenue})).sort((ye,Pe)=>Pe.revenue-ye.revenue).slice(0,5);v(Ze)}finally{w(!1)}})()},[]),o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Business Analytics"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"High-level KPIs, funnel health, and performance metrics."})]})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Key Performance Indicators",subtitle:"Current metrics overview"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[s.map(T=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:T.label}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:T.value}),T.variant&&o.jsx(Ye,{variant:T.variant,children:"Current"})]},T.label)),s.length===0&&y&&o.jsx("p",{className:"col-span-4 py-4 text-center text-sm text-[#6C757D]",children:"Loading..."})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Conversion Funnel",subtitle:"User journey from signup to completed meet"}),o.jsxs(be,{className:"space-y-3",children:[a.map((T,S)=>o.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-[#6C757D] text-xs text-white",children:S+1}),T.stage]}),o.jsx("span",{className:"text-[#6C757D]",children:T.percentage}),o.jsx("span",{className:"font-semibold",children:T.value.toLocaleString()})]},T.stage)),a.length===0&&!y&&o.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No data available"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Event Performance",subtitle:"Compare paid vs free categories"}),o.jsx(be,{className:"grid gap-4 md:grid-cols-3",children:u.map(T=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[o.jsx("h2",{className:"font-semibold",children:T.label}),o.jsxs("ul",{className:"mt-3 space-y-2 text-[#6C757D]",children:[o.jsxs("li",{children:["Total Created: ",o.jsx("strong",{children:T.totalCreated})]}),o.jsxs("li",{children:["Avg Participants: ",o.jsx("strong",{children:T.avgParticipants.toFixed(1)})]}),o.jsxs("li",{children:["Avg Final Bid: ",o.jsx("strong",{children:Ue(T.avgFinalBid)})]}),o.jsxs("li",{children:["Completion: ",o.jsxs("strong",{children:[T.completionRate.toFixed(0),"%"]})]}),o.jsxs("li",{children:["Avg Creator Revenue: ",o.jsx("strong",{children:Ue(T.avgCreatorRevenue)})]})]})]},T.label))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Top Creators by Revenue",subtitle:"Highest earning creators"}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rank"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Revenue"})]})}),o.jsxs("tbody",{children:[g.map((T,S)=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3",children:o.jsxs(Ye,{variant:S===0?"success":S===1?"primary":"warning",children:["#",S+1]})}),o.jsx("td",{className:"py-3 text-[#212529]",children:T.name}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:T.eventsCount}),o.jsx("td",{className:"py-3 font-semibold text-[#28A745]",children:Ue(T.revenue)})]},T.creatorId)),g.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"py-8 text-center text-[#6C757D]",children:y?"Loading...":"No creator data available"})})]})]})})]})]})}function vSe(){const[s,n]=L.useState({totalUsers:0,totalFans:0,totalCreators:0,activeLast24h:0,activeLast7d:0,activeLast30d:0,newUsersToday:0,newUsersThisWeek:0,newUsersThisMonth:0}),[a,l]=L.useState([]),[u,f]=L.useState({inactiveUsers:0,inactiveRate:"0%",usersNeverBid:0,usersNeverWon:0}),[g,v]=L.useState([]),[y,w]=L.useState(!1);L.useEffect(()=>{(async()=>{w(!0);try{const j=new Date,B=new Date(j.getFullYear(),j.getMonth(),j.getDate()),A=new Date(j.getTime()-7*24*60*60*1e3),F=new Date(j.getTime()-30*24*60*60*1e3),D=new Date(j.getFullYear(),j.getMonth(),1),{data:R}=await ie.from("users").select("id, role, created_at, account_status"),O=(R==null?void 0:R.length)??0,V=(R??[]).filter(ye=>ye.role==="fan").length,G=(R??[]).filter(ye=>ye.role==="creator").length,J=(R??[]).filter(ye=>new Date(ye.created_at)>=B).length,$=(R??[]).filter(ye=>new Date(ye.created_at)>=A).length,q=(R??[]).filter(ye=>new Date(ye.created_at)>=D).length,{data:ee}=await ie.from("bids").select("id, fan_id, amount, status, created_at"),ne=(ee??[]).filter(ye=>new Date(ye.created_at)>=B),de=(ee??[]).filter(ye=>new Date(ye.created_at)>=A),me=(ee??[]).filter(ye=>new Date(ye.created_at)>=F),ve=new Set(ne.map(ye=>ye.fan_id)).size,_e=new Set(de.map(ye=>ye.fan_id)).size,De=new Set(me.map(ye=>ye.fan_id)).size;n({totalUsers:O,totalFans:V,totalCreators:G,activeLast24h:ve,activeLast7d:_e,activeLast30d:De,newUsersToday:J,newUsersThisWeek:$,newUsersThisMonth:q});const Xe=new Map;for(const ye of ee??[]){const Pe=Xe.get(ye.fan_id)??{count:0,total:0,wins:0};Pe.count++,Pe.total+=ye.amount??0,ye.status==="won"&&Pe.wins++,Xe.set(ye.fan_id,Pe)}const Oe=(R??[]).filter(ye=>ye.role==="fan").map(ye=>ye.id),ae=Oe.filter(ye=>Xe.has(ye)),Ee=Oe.length-ae.length,Le=ae.filter(ye=>{var Pe;return(((Pe=Xe.get(ye))==null?void 0:Pe.count)??0)>=5}),Ke=ae.filter(ye=>{var $e;const Pe=(($e=Xe.get(ye))==null?void 0:$e.count)??0;return Pe>=2&&Pe<5}),He=ae.filter(ye=>{var $e;return((($e=Xe.get(ye))==null?void 0:$e.count)??0)===1}),gt=ae.filter(ye=>{var Pe;return(((Pe=Xe.get(ye))==null?void 0:Pe.wins)??0)===0}).length,yt=new Set(me.map(ye=>ye.fan_id)),It=Oe.filter(ye=>!yt.has(ye)),Ct=Oe.length>0?It.length/Oe.length*100:0;l([{name:"High Value Users",count:Le.length,share:V>0?`${(Le.length/V*100).toFixed(1)}%`:"0%",description:`5+ bids  Avg spend ${Ue(Le.reduce((ye,Pe)=>{var $e;return ye+((($e=Xe.get(Pe))==null?void 0:$e.total)??0)},0)/Math.max(Le.length,1))}`,variant:"success"},{name:"Regular Users",count:Ke.length,share:V>0?`${(Ke.length/V*100).toFixed(1)}%`:"0%",description:`2-4 bids  Avg spend ${Ue(Ke.reduce((ye,Pe)=>{var $e;return ye+((($e=Xe.get(Pe))==null?void 0:$e.total)??0)},0)/Math.max(Ke.length,1))}`,variant:"primary"},{name:"Occasional Users",count:He.length,share:V>0?`${(He.length/V*100).toFixed(1)}%`:"0%",description:`1 bid  Avg spend ${Ue(He.reduce((ye,Pe)=>{var $e;return ye+((($e=Xe.get(Pe))==null?void 0:$e.total)??0)},0)/Math.max(He.length,1))}`,variant:"warning"},{name:"Inactive Users",count:It.length,share:V>0?`${(It.length/V*100).toFixed(1)}%`:"0%",description:"No activity in 30+ days  at-risk",variant:"danger"}]),f({inactiveUsers:It.length,inactiveRate:`${Ct.toFixed(1)}%`,usersNeverBid:Ee,usersNeverWon:gt});const{data:et}=await ie.from("profiles").select("user_id, display_name, username"),We=new Map;for(const ye of et??[])We.set(ye.user_id,ye.display_name||ye.username||"Fan");const Ze=Array.from(Xe.entries()).map(([ye,Pe])=>({fanId:ye,name:We.get(ye)??"Unknown",bidsCount:Pe.count,totalSpent:Pe.total,winsCount:Pe.wins})).sort((ye,Pe)=>Pe.totalSpent-ye.totalSpent).slice(0,5);v(Ze)}finally{w(!1)}})()},[]);const T=s.activeLast30d>0?(s.activeLast24h/s.activeLast30d*100).toFixed(1):"0",S=s.activeLast30d>0?(s.activeLast7d/s.activeLast30d*100).toFixed(1):"0";return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"User Analytics"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Understand who your users are and how they behave across the platform."})]})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"User Overview",subtitle:"Total user counts by role"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-3",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Users"}),o.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:s.totalUsers.toLocaleString()})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Fans"}),o.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:s.totalFans.toLocaleString()})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Creators"}),o.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:s.totalCreators.toLocaleString()})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Activity Metrics",subtitle:"User engagement over different time periods"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-3",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"Active Last 24h (DAU)"}),o.jsx("p",{className:"mt-2 text-lg font-semibold",children:s.activeLast24h.toLocaleString()})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"Active Last 7 Days (WAU)"}),o.jsx("p",{className:"mt-2 text-lg font-semibold",children:s.activeLast7d.toLocaleString()})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"Active Last 30 Days (MAU)"}),o.jsx("p",{className:"mt-2 text-lg font-semibold",children:s.activeLast30d.toLocaleString()})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"DAU/MAU Ratio"}),o.jsxs("p",{className:"mt-2 text-lg font-semibold",children:[T,"%"]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"WAU/MAU Ratio"}),o.jsxs("p",{className:"mt-2 text-lg font-semibold",children:[S,"%"]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"New Users This Month"}),o.jsx("p",{className:"mt-2 text-lg font-semibold",children:s.newUsersThisMonth.toLocaleString()})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"User Segments",subtitle:"Behavior-based clusters"}),o.jsx(be,{className:"grid gap-4 md:grid-cols-2",children:a.map(I=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{className:"font-semibold",children:I.name}),o.jsxs(Ye,{variant:I.variant,children:[I.count," users (",I.share,")"]})]}),o.jsx("p",{className:"mt-3 text-[#6C757D]",children:I.description})]},I.name))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Churn & Risk Analysis",subtitle:"Keep an eye on at-risk users"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"Inactive Rate (30+ days)"}),o.jsx("p",{className:"text-3xl font-semibold text-[#DC3545]",children:u.inactiveRate}),o.jsxs("p",{className:"mt-3",children:["Inactive Users: ",o.jsx("strong",{children:u.inactiveUsers})]}),o.jsxs("p",{children:["Users Never Bid: ",o.jsx("strong",{children:u.usersNeverBid})]}),o.jsxs("p",{children:["Users Never Won: ",o.jsx("strong",{children:u.usersNeverWon})]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-[#6C757D]",children:"New User Growth"}),o.jsxs("ul",{className:"mt-3 space-y-2 text-[#6C757D]",children:[o.jsxs("li",{className:"flex justify-between",children:[o.jsx("span",{children:"Today"}),o.jsxs(Ye,{variant:"success",children:["+",s.newUsersToday]})]}),o.jsxs("li",{className:"flex justify-between",children:[o.jsx("span",{children:"This Week"}),o.jsxs(Ye,{variant:"primary",children:["+",s.newUsersThisWeek]})]}),o.jsxs("li",{className:"flex justify-between",children:[o.jsx("span",{children:"This Month"}),o.jsxs(Ye,{variant:"warning",children:["+",s.newUsersThisMonth]})]})]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Top Fans by Spending",subtitle:"Most engaged users"}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rank"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Fan"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Wins"})]})}),o.jsxs("tbody",{children:[g.map((I,j)=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3",children:o.jsxs(Ye,{variant:j===0?"success":j===1?"primary":"warning",children:["#",j+1]})}),o.jsx("td",{className:"py-3 text-[#212529]",children:I.name}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:I.bidsCount}),o.jsx("td",{className:"py-3 font-semibold text-[#212529]",children:Ue(I.totalSpent)}),o.jsx("td",{className:"py-3",children:o.jsxs(Ye,{variant:I.winsCount>0?"success":"warning",children:[I.winsCount," wins"]})})]},I.fanId)),g.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:y?"Loading...":"No fan data available"})})]})]})})]})]})}function ySe(){var B;const[s,n]=L.useState("revenue"),[a,l]=L.useState("month"),[u,f]=L.useState({totalRevenue:0,totalCommission:0,totalRefunds:0,eventsCount:0,bidsCount:0,creatorsCount:0,withdrawalsCount:0}),[g,v]=L.useState(!1),[y,w]=L.useState(!1),T=A=>{const F=new Date,D=new Date(F);let R=new Date(F);switch(A){case"7days":R.setDate(R.getDate()-7);break;case"30days":R.setDate(R.getDate()-30);break;case"month":R=new Date(F.getFullYear(),F.getMonth(),1);break;case"all":R=new Date(2020,0,1);break}return{start:R,end:D}};L.useEffect(()=>{(async()=>{v(!0);try{const{start:F,end:D}=T(a),{data:R}=await ie.from("bids").select("amount, status, created_at").gte("created_at",F.toISOString()).lte("created_at",D.toISOString()),O=(R??[]).filter(me=>me.status==="won"),V=(R??[]).filter(me=>me.status==="lost"),G=[...O,...V].reduce((me,ve)=>me+(ve.amount??0),0),J=Math.floor(G*.1),$=J,q=V.reduce((me,ve)=>me+Math.floor((ve.amount??0)*.9),0),{data:ee}=await ie.from("events").select("id").gte("created_at",F.toISOString()).lte("created_at",D.toISOString()),{data:ne}=await ie.from("users").select("id").eq("role","creator"),{data:de}=await ie.from("withdrawal_requests").select("id").gte("requested_at",F.toISOString()).lte("requested_at",D.toISOString());f({totalRevenue:$,totalCommission:J,totalRefunds:q,eventsCount:(ee==null?void 0:ee.length)??0,bidsCount:(R==null?void 0:R.length)??0,creatorsCount:(ne==null?void 0:ne.length)??0,withdrawalsCount:(de==null?void 0:de.length)??0})}finally{v(!1)}})()},[a]);const S=async()=>{w(!0);try{const{start:A,end:F}=T(a);let D="",R="";if(s==="revenue"||s==="bids"){const{data:J}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at").gte("created_at",A.toISOString()).lte("created_at",F.toISOString()).order("created_at",{ascending:!1});D=`ID,Event ID,Fan ID,Amount,Status,Date
`;for(const $ of J??[])D+=`${$.id},${$.event_id},${$.fan_id},${$.amount},${$.status},"${Bt($.created_at)}"
`;R=`bids_report_${a}.csv`}else if(s==="events"){const{data:J}=await ie.from("events").select("id, creator_id, title, status, base_price, starts_at, created_at").gte("created_at",A.toISOString()).lte("created_at",F.toISOString()).order("created_at",{ascending:!1});D=`ID,Creator ID,Title,Status,Base Price,Starts At,Created At
`;for(const $ of J??[])D+=`${$.id},${$.creator_id},"${$.title}",${$.status},${$.base_price},"${Bt($.starts_at)}","${Bt($.created_at)}"
`;R=`events_report_${a}.csv`}else if(s==="creators"){const{data:J}=await ie.from("profiles").select("user_id, display_name, username, category, created_at"),{data:$}=await ie.from("users").select("id, email").eq("role","creator"),q=new Map;for(const ee of $??[])q.set(ee.id,ee.email);D=`User ID,Display Name,Username,Email,Category,Created At
`;for(const ee of J??[]){const ne=q.get(ee.user_id)??"";ne&&(D+=`${ee.user_id},"${ee.display_name??""}",${ee.username??""},${ne},${ee.category??""},"${Bt(ee.created_at)}"
`)}R="creators_report.csv"}else if(s==="withdrawals"){const{data:J}=await ie.from("withdrawal_requests").select("id, creator_id, amount, destination, status, requested_at, processed_at").gte("requested_at",A.toISOString()).lte("requested_at",F.toISOString()).order("requested_at",{ascending:!1});D=`ID,Creator ID,Amount,Destination,Status,Requested At,Processed At
`;for(const $ of J??[])D+=`${$.id},${$.creator_id},${$.amount},"${$.destination??""}",${$.status},"${Bt($.requested_at)}","${$.processed_at?Bt($.processed_at):""}"
`;R=`withdrawals_report_${a}.csv`}const O=new Blob([D],{type:"text/csv;charset=utf-8;"}),V=URL.createObjectURL(O),G=document.createElement("a");G.setAttribute("href",V),G.setAttribute("download",R),G.style.visibility="hidden",document.body.appendChild(G),G.click(),document.body.removeChild(G),alert(`Report exported: ${R}`)}finally{w(!1)}},I=[{key:"revenue",label:"Revenue Summary",icon:""},{key:"bids",label:"Bids Report",icon:""},{key:"events",label:"Events Report",icon:""},{key:"creators",label:"Creators Report",icon:""},{key:"withdrawals",label:"Withdrawals Report",icon:""}],j={"7days":"Last 7 Days","30days":"Last 30 Days",month:"This Month",all:"All Time"};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Revenue Reports"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Generate and export financial reports from your platform data."})]})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Quick Stats",subtitle:`Overview for ${j[a]}`}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Revenue"}),o.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:Ue(u.totalRevenue)})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Platform Commission"}),o.jsx("p",{className:"mt-2 text-xl font-semibold text-[#28A745]",children:Ue(u.totalCommission)})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunds"}),o.jsx("p",{className:"mt-2 text-xl font-semibold text-[#DC3545]",children:Ue(u.totalRefunds)})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Totals"}),o.jsxs("p",{className:"mt-2 text-sm text-[#212529]",children:[u.eventsCount," events  ",u.bidsCount," bids  ",u.creatorsCount," creators"]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Generate Report",subtitle:"Select report type and date range to export."}),o.jsxs(be,{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("p",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Report Type"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(A=>o.jsxs(ue,{size:"sm",variant:s===A.key?"secondary":"ghost",onClick:()=>n(A.key),children:[A.icon," ",A.label]},A.key))})]}),o.jsxs("div",{children:[o.jsx("p",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Date Range"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:["7days","30days","month","all"].map(A=>o.jsx(ue,{size:"sm",variant:a===A?"secondary":"ghost",onClick:()=>l(A),children:j[A]},A))})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Report Configuration"}),o.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[o.jsxs("li",{className:"flex items-center justify-between",children:[o.jsx("span",{children:"Report Type"}),o.jsx("span",{className:"font-medium text-[#212529]",children:(B=I.find(A=>A.key===s))==null?void 0:B.label})]}),o.jsxs("li",{className:"flex items-center justify-between",children:[o.jsx("span",{children:"Date Range"}),o.jsx("span",{className:"font-medium text-[#212529]",children:j[a]})]}),o.jsxs("li",{className:"flex items-center justify-between",children:[o.jsx("span",{children:"Format"}),o.jsx("span",{className:"font-medium text-[#212529]",children:"CSV"})]})]})]}),o.jsx(ue,{onClick:S,disabled:y||g,children:y?" Generating...":" Export CSV Report"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Available Reports",subtitle:"Quick export options for common reports."}),o.jsx(be,{className:"space-y-3",children:I.map(A=>o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium text-[#212529]",children:[A.icon," ",A.label]}),o.jsxs("div",{className:"text-xs text-[#6C757D]",children:["Export ",A.key==="creators"?"all creators":`${j[a].toLowerCase()}`," data"]})]}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>{n(A.key),S()},disabled:y,children:"Export"})]},A.key))})]})]})}function xSe(){const[s,n]=L.useState({liveNow:0,eventsToday:0,eventsThisWeek:0,eventsThisMonth:0,completionRate:0,avgBidAmount:0,avgBidsPerEvent:0,totalRevenue:0}),[a,l]=L.useState([]),[u,f]=L.useState([]),[g,v]=L.useState([]),[y,w]=L.useState([]),[T,S]=L.useState(!1);L.useEffect(()=>{(async()=>{S(!0);try{const B=new Date,A=new Date(B.getFullYear(),B.getMonth(),B.getDate()),F=new Date(B.getTime()-7*24*60*60*1e3),D=new Date(B.getFullYear(),B.getMonth(),1),{data:R}=await ie.from("events").select("id, creator_id, title, status, category, base_price, starts_at, created_at"),O=(R==null?void 0:R.length)??0,V=(R??[]).filter(et=>et.status==="live").length,G=(R??[]).filter(et=>new Date(et.created_at)>=A).length,J=(R??[]).filter(et=>new Date(et.created_at)>=F).length,$=(R??[]).filter(et=>new Date(et.created_at)>=D).length,q=(R??[]).filter(et=>et.status==="completed").length,ee=O>0?q/O*100:0,{data:ne}=await ie.from("bids").select("id, event_id, amount, status"),de=(ne==null?void 0:ne.length)??0,me=de>0?(ne??[]).reduce((et,We)=>et+(We.amount??0),0)/de:0,ve=O>0?de/O:0,_e=(ne??[]).filter(et=>et.status==="won"),De=_e.reduce((et,We)=>et+(We.amount??0),0);n({liveNow:V,eventsToday:G,eventsThisWeek:J,eventsThisMonth:$,completionRate:ee,avgBidAmount:me,avgBidsPerEvent:ve,totalRevenue:De});const Xe=new Map;for(const et of R??[])Xe.set(et.status,(Xe.get(et.status)??0)+1);const Oe=Array.from(Xe.entries()).map(([et,We])=>({status:et,count:We,percentage:O>0?We/O*100:0})).sort((et,We)=>We.count-et.count);l(Oe);const ae=new Map;for(const et of R??[]){const We=et.category||"general",Ze=ae.get(We)??{count:0,eventIds:[]};Ze.count++,Ze.eventIds.push(et.id),ae.set(We,Ze)}const Ee=Array.from(ae.entries()).map(([et,We])=>{const ye=_e.filter(Pe=>We.eventIds.includes(Pe.event_id)).reduce((Pe,$e)=>Pe+($e.amount??0),0);return{category:et,count:We.count,revenue:ye}}).sort((et,We)=>We.count-et.count);f(Ee);const Le=Array.from(new Set((R??[]).map(et=>et.creator_id))),{data:Ke}=Le.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Le):{data:[]},He=new Map;for(const et of Ke??[])He.set(et.user_id,et.display_name||et.username||"Creator");const gt=new Map;for(const et of ne??[]){const We=gt.get(et.event_id)??{count:0,highest:0};We.count++,We.highest=Math.max(We.highest,et.amount??0),gt.set(et.event_id,We)}const yt=(R??[]).map(et=>{var We,Ze;return{id:et.id,title:et.title,creatorName:He.get(et.creator_id)??"Unknown",bidsCount:((We=gt.get(et.id))==null?void 0:We.count)??0,highestBid:((Ze=gt.get(et.id))==null?void 0:Ze.highest)??0,status:et.status}}),It=[...yt].sort((et,We)=>We.bidsCount-et.bidsCount).slice(0,5);v(It);const Ct=[...yt].sort((et,We)=>{const Ze=(R??[]).find(Pe=>Pe.id===et.id),ye=(R??[]).find(Pe=>Pe.id===We.id);return new Date((ye==null?void 0:ye.created_at)??0).getTime()-new Date((Ze==null?void 0:Ze.created_at)??0).getTime()}).slice(0,5);w(Ct)}finally{S(!1)}})()},[]);const I={live:"danger",upcoming:"primary",completed:"success",cancelled:"warning",draft:"warning"};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Event Analytics"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Deep dive into event performance and engagement metrics."})]})}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Key Metrics",subtitle:"Real-time event snapshot"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Live Now"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#DC3545]",children:s.liveNow}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Currently active"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Today"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:s.eventsToday}),o.jsxs("p",{className:"text-xs text-[#6C757D]",children:[s.eventsThisWeek," this week"]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Completion Rate"}),o.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#28A745]",children:[s.completionRate.toFixed(1),"%"]}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Events successfully completed"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Avg Bid Amount"}),o.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Ue(s.avgBidAmount)}),o.jsxs("p",{className:"text-xs text-[#6C757D]",children:[s.avgBidsPerEvent.toFixed(1)," bids/event avg"]})]})]})]}),o.jsxs("div",{className:"grid gap-8 lg:grid-cols-2",children:[o.jsxs(pe,{children:[o.jsx(Ne,{title:"Events by Status",subtitle:"Distribution across statuses"}),o.jsxs(be,{className:"space-y-3",children:[a.map(j=>o.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",children:[o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(Ye,{variant:I[j.status]??"primary",children:j.status.charAt(0).toUpperCase()+j.status.slice(1)})}),o.jsxs("span",{className:"text-[#6C757D]",children:[j.percentage.toFixed(1),"%"]}),o.jsx("span",{className:"font-semibold text-[#212529]",children:j.count})]},j.status)),a.length===0&&o.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:T?"Loading...":"No events data"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Events by Category",subtitle:"Revenue and count per category"}),o.jsxs(be,{className:"space-y-3",children:[u.map(j=>o.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",children:[o.jsx("span",{className:"text-[#212529] capitalize",children:j.category}),o.jsxs("span",{className:"text-[#6C757D]",children:[j.count," events"]}),o.jsx("span",{className:"font-semibold text-[#28A745]",children:Ue(j.revenue)})]},j.category)),u.length===0&&o.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:T?"Loading...":"No category data"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Top Events by Bids",subtitle:"Most popular events"}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Highest Bid"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),o.jsxs("tbody",{children:[g.map(j=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529]",children:j.title}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:j.creatorName}),o.jsx("td",{className:"py-3 font-semibold text-[#212529]",children:j.bidsCount}),o.jsx("td",{className:"py-3 text-[#28A745]",children:Ue(j.highestBid)}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:I[j.status]??"primary",children:j.status})})]},j.id)),g.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:T?"Loading...":"No event data available"})})]})]})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Recent Events",subtitle:"Latest created events"}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),o.jsx("tbody",{children:y.map(j=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529]",children:j.title}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:j.creatorName}),o.jsx("td",{className:"py-3 text-[#212529]",children:j.bidsCount}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:I[j.status]??"primary",children:j.status})})]},j.id))})]})})]})]})}const x7={login:"Login",logout:"Logout",signup:"Signup",event_created:"Event Created",event_updated:"Event Updated",event_cancelled:"Event Cancelled",event_completed:"Event Completed",bid_placed:"Bid Placed",bid_won:"Bid Won",bid_refunded:"Bid Refunded",withdrawal_requested:"Withdrawal Requested",withdrawal_approved:"Withdrawal Approved",withdrawal_rejected:"Withdrawal Rejected",user_suspended:"User Suspended",user_banned:"User Banned",user_unbanned:"User Unbanned",creator_approved:"Creator Approved",creator_rejected:"Creator Rejected",settings_updated:"Settings Updated",announcement_published:"Announcement Published",meet_scheduled:"Meet Scheduled",meet_completed:"Meet Completed",payment_processed:"Payment Processed",refund_processed:"Refund Processed",other:"Other"},bSe={system:"primary",admin:"danger",creator:"success",fan:"warning"};function wSe(){const[s,n]=L.useState([]),[a,l]=L.useState(!1),[u,f]=L.useState(""),[g,v]=L.useState(null),[y,w]=L.useState(null),T=async()=>{l(!0);try{let A=ie.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(100);g&&(A=A.eq("action_type",g)),y&&(A=A.eq("actor_type",y));const{data:F,error:D}=await A;if(D){console.error("Error fetching audit logs:",D),n([]);return}const R=(F??[]).map(O=>({id:O.id,actorId:O.actor_id,actorType:O.actor_type,actorName:O.actor_name,action:O.action,actionType:O.action_type,resourceType:O.resource_type,resourceId:O.resource_id,details:O.details,status:O.status,createdAt:O.created_at}));n(R)}finally{l(!1)}};L.useEffect(()=>{T()},[g,y]);const S=s.filter(A=>{var D;if(!u)return!0;const F=u.toLowerCase();return A.action.toLowerCase().includes(F)||A.id.toLowerCase().includes(F)||(((D=A.actorName)==null?void 0:D.toLowerCase().includes(F))??!1)}),I=["system","admin","creator","fan"],j={success:"success",warning:"warning",error:"danger"},B=()=>{const A=`ID,Time,Actor,Action,Type,Status
`+S.map(O=>`${O.id},"${Bt(O.createdAt)}","${O.actorName||O.actorType}","${O.action}",${O.actionType},${O.status}`).join(`
`),F=new Blob([A],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(F),R=document.createElement("a");R.setAttribute("href",D),R.setAttribute("download",`audit_logs_${new Date().toISOString().split("T")[0]}.csv`),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Audit Logs"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Immutable record of every critical action across the platform."})]}),o.jsx(ue,{variant:"secondary",onClick:B,children:" Export CSV"})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Filters",subtitle:"Filter logs by actor type and action type"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[o.jsx(nt,{label:"Search",placeholder:"ID, actor, action...",value:u,onChange:A=>f(A.target.value)}),o.jsxs("div",{children:[o.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Actor Type"}),o.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[o.jsx(ue,{size:"sm",variant:y===null?"secondary":"ghost",onClick:()=>w(null),children:"All"}),I.map(A=>o.jsx(ue,{size:"sm",variant:y===A?"secondary":"ghost",onClick:()=>w(A),children:A.charAt(0).toUpperCase()+A.slice(1)},A))]})]}),o.jsxs("div",{className:"md:col-span-2",children:[o.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Action Type"}),o.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[o.jsx(ue,{size:"sm",variant:g===null?"secondary":"ghost",onClick:()=>v(null),children:"All"}),["login","bid_placed","bid_won","bid_refunded","withdrawal_approved","event_created"].map(A=>o.jsx(ue,{size:"sm",variant:g===A?"secondary":"ghost",onClick:()=>v(A),children:x7[A]},A))]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Log Stream",subtitle:`${S.length} entries  Newest first`}),o.jsxs(be,{className:"space-y-4",children:[S.length===0&&o.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:a?"Loading logs...":"No audit logs found. Actions will appear here as they occur."}),S.map(A=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[o.jsx("div",{className:"font-semibold",children:A.action}),o.jsx(Ye,{variant:j[A.status]??"primary",children:A.status.charAt(0).toUpperCase()+A.status.slice(1)})]}),o.jsxs("p",{className:"mt-2 text-[#6C757D]",children:[Bt(A.createdAt)," "," ",o.jsx(Ye,{variant:bSe[A.actorType]??"primary",children:A.actorType}),A.actorName&&`  ${A.actorName}`]}),A.details&&Object.keys(A.details).length>0&&o.jsxs("p",{className:"mt-2 text-xs text-[#6C757D]",children:[JSON.stringify(A.details).slice(0,200),JSON.stringify(A.details).length>200&&"..."]}),o.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:[o.jsx(Ye,{variant:"primary",children:x7[A.actionType]??A.actionType}),A.resourceType&&o.jsx(Ye,{variant:"warning",children:A.resourceType})]})]},A.id))]})]})]})}const SSe=[{label:"All",value:"all"},{label:" Overdue",value:"overdue"},{label:"Open",value:"open"},{label:"In Progress",value:"in_progress"},{label:"Resolved",value:"resolved"},{label:"Closed",value:"closed"}],b7={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"},CSe=(s,n,a)=>{if(a==="resolved"||a==="closed"||n)return!1;const l=new Date(s);return(new Date().getTime()-l.getTime())/(1e3*60*60)>=24};function TSe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState([]),[f,g]=L.useState(!1),[v,y]=L.useState(""),[w,T]=L.useState("all"),[S,I]=L.useState(null),[j,B]=L.useState(""),[A,F]=L.useState(!1);L.useEffect(()=>{(async()=>{g(!0);try{const{data:J,error:$}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at, first_response_at, users:user_id (email, role, display_name)").order("created_at",{ascending:!0});if($||!J){console.error("Error fetching support tickets:",$),a([]);return}const q=J.map(ee=>{const ne=ee.users,de=(ne==null?void 0:ne.display_name)||(ne!=null&&ne.email?ne.email.split("@")[0]:"User"),me=CSe(ee.created_at,ee.first_response_at,ee.status);return{id:ee.id,subject:ee.subject,description:ee.description,status:ee.status,createdAt:ee.created_at,updatedAt:ee.updated_at,firstResponseAt:ee.first_response_at,userName:de,userEmail:(ne==null?void 0:ne.email)??"",userRole:(ne==null?void 0:ne.role)??"",isOverdue:me}});q.sort((ee,ne)=>ee.isOverdue&&!ne.isOverdue?-1:!ee.isOverdue&&ne.isOverdue?1:new Date(ee.createdAt).getTime()-new Date(ne.createdAt).getTime()),a(q),q.length>0&&!S&&I(q[0].id)}finally{g(!1)}})()},[]),L.useEffect(()=>{(async()=>{if(!S){u([]);return}const{data:J,error:$}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at, user_id").eq("ticket_id",S).order("created_at",{ascending:!0});if($||!J){console.error("Error fetching replies:",$),u([]);return}const q=[...new Set(J.map(ne=>ne.user_id).filter(Boolean))];let ee={};if(q.length>0){const{data:ne}=await ie.from("users").select("id, display_name, email").in("id",q);ne&&(ee=Object.fromEntries(ne.map(de=>{var me;return[de.id,de.display_name||((me=de.email)==null?void 0:me.split("@")[0])||"User"]})))}u(J.map(ne=>({id:ne.id,message:ne.message,isAdminReply:ne.is_admin_reply,createdAt:ne.created_at,userName:ne.is_admin_reply?"Support Team":ee[ne.user_id]||"User"})))})()},[S]);const D=L.useMemo(()=>{const G=v.trim().toLowerCase();return n.filter(J=>{if(w==="overdue"){if(!J.isOverdue)return!1}else if(w!=="all"&&J.status!==w)return!1;return G?J.subject.toLowerCase().includes(G)||J.userName.toLowerCase().includes(G)||J.userEmail.toLowerCase().includes(G)||J.id.toLowerCase().includes(G):!0})},[n,v,w]),R=async()=>{if(!s||!S||!j.trim()){alert("Please enter a reply message.");return}F(!0);try{const{error:G}=await ie.from("ticket_replies").insert({ticket_id:S,user_id:s.id,message:j.trim(),is_admin_reply:!0});if(G){console.error("Error sending reply:",G),alert("Failed to send reply.");return}const J=n.find($=>$.id===S);J&&!J.firstResponseAt&&(await ie.from("support_tickets").update({first_response_at:new Date().toISOString(),status:J.status==="open"?"in_progress":J.status}).eq("id",S),a($=>$.map(q=>q.id===S?{...q,firstResponseAt:new Date().toISOString(),isOverdue:!1,status:q.status==="open"?"in_progress":q.status}:q))),u($=>[...$,{id:`temp-${Date.now()}`,message:j.trim(),isAdminReply:!0,createdAt:new Date().toISOString(),userName:"Support Team"}]),B(""),alert("Reply sent successfully!")}finally{F(!1)}},O=L.useMemo(()=>n.find(G=>G.id===S)??null,[n,S]),V=async(G,J)=>{if(window.confirm(`Change status of ticket "${G.subject}" to ${J.replace("_"," ")}?`)){g(!0);try{const{error:q}=await ie.from("support_tickets").update({status:J}).eq("id",G.id);if(q){console.error("Error updating ticket:",q),alert("Failed to update ticket status.");return}a(ee=>ee.map(ne=>ne.id===G.id?{...ne,status:J}:ne))}finally{g(!1)}}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Support Tickets"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track customer issues, update their status, and maintain SLAs."})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",disabled:!0,children:"View SLA Dashboard"}),o.jsx(ue,{disabled:!0,children:"Assign to Me"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Filters",subtitle:"Focus on critical tickets or specific owners."}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[o.jsx(nt,{label:"Search",placeholder:"Ticket ID, subject, user",value:v,onChange:G=>y(G.target.value)}),o.jsx(nt,{label:"Date Range",placeholder:"(coming soon)",disabled:!0}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),o.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:SSe.map(G=>o.jsx("button",{type:"button",className:`rounded-full border px-3 py-1 text-xs font-medium ${w===G.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,onClick:()=>T(G.value),children:G.label},G.value))})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Priority"}),o.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:[o.jsx(Ye,{variant:"danger",children:"Critical (coming soon)"}),o.jsx(Ye,{variant:"warning",children:"High (coming soon)"})]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Tickets",subtitle:"Oldest tickets shown first. Overdue tickets (24h+ no response) highlighted in red."}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Ticket"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Created"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"SLA"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsxs("tbody",{children:[D.map(G=>o.jsxs("tr",{className:`border-b border-[#E9ECEF] ${G.isOverdue?"bg-red-50 hover:bg-red-100":S===G.id?"bg-[#F8F9FA]":""}`,children:[o.jsx("td",{className:"py-3 text-[#212529]",children:o.jsxs("button",{type:"button",className:"flex flex-col text-left",onClick:()=>I(G.id),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[G.isOverdue&&o.jsx("span",{className:"text-red-500",children:""}),o.jsx("span",{className:"font-semibold",children:G.subject})]}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:[G.id.slice(0,8),"..."]})]})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{children:G.userName}),o.jsx("span",{className:"text-xs",children:G.userEmail})]})}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:b7[G.status],children:G.status.replace("_"," ")})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:Bt(G.createdAt)}),o.jsx("td",{className:"py-3",children:G.isOverdue?o.jsx("span",{className:"font-semibold text-red-600",children:" OVERDUE"}):G.firstResponseAt?o.jsx("span",{className:"text-green-600",children:" Responded"}):o.jsx("span",{className:"text-yellow-600",children:"Awaiting"})}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[G.status!=="resolved"&&o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>V(G,"resolved"),children:"Mark Resolved"}),G.status!=="in_progress"&&G.status!=="resolved"&&o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>V(G,"in_progress"),children:"In Progress"}),G.status!=="closed"&&o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>V(G,"closed"),children:"Close"})]})})]},G.id)),D.length===0&&!f&&o.jsx("tr",{children:o.jsx("td",{colSpan:6,className:"py-6 text-center text-sm text-[#6C757D]",children:"No tickets match your filters."})})]})]})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Ticket Detail & Conversation",subtitle:"View ticket details and reply to the user."}),o.jsx(be,{className:"flex flex-col gap-4",children:O?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[O.isOverdue&&o.jsx("span",{className:"text-red-500 text-lg",children:""}),o.jsx("h2",{className:"text-lg font-semibold",children:O.subject})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[O.isOverdue&&o.jsx(Ye,{variant:"danger",children:"OVERDUE 24h+"}),o.jsx(Ye,{variant:b7[O.status],children:O.status.replace("_"," ")})]})]}),o.jsxs("div",{className:"grid gap-2 text-[#6C757D] md:grid-cols-3",children:[o.jsxs("p",{children:[o.jsx("span",{className:"font-semibold text-[#212529]",children:"From:"})," ",O.userName," (",O.userEmail,")"]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-semibold text-[#212529]",children:"Created:"})," ",Bt(O.createdAt)]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-semibold text-[#212529]",children:"Role:"})," ",O.userRole||"User"]})]}),o.jsxs("div",{className:"rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Original Message"}),o.jsx("p",{className:"mt-2 whitespace-pre-line",children:O.description})]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6",children:[o.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-4",children:["Conversation (",l.length," ",l.length===1?"reply":"replies",")"]}),o.jsx("div",{className:"flex flex-col gap-3 max-h-[400px] overflow-y-auto",children:l.length===0?o.jsx("p",{className:"text-sm text-[#6C757D] text-center py-4",children:"No replies yet. Be the first to respond!"}):l.map(G=>o.jsxs("div",{className:`rounded-[12px] p-4 ${G.isAdminReply?"bg-[#F4E6FF] ml-8":"bg-[#F8F9FA] mr-8"}`,children:[o.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[o.jsxs("span",{className:`text-sm font-semibold ${G.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:[G.userName,G.isAdminReply&&" (Admin)"]}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:Bt(G.createdAt)})]}),o.jsx("p",{className:"text-sm text-[#212529] whitespace-pre-line",children:G.message})]},G.id))})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-3",children:"Send Reply"}),o.jsx(ls,{label:"",rows:4,placeholder:"Type your reply to the user...",value:j,onChange:G=>B(G.target.value)}),o.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[o.jsx(ue,{onClick:R,disabled:A||!j.trim(),children:A?"Sending...":"Send Reply"}),o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>O&&V(O,"resolved"),children:"Mark Resolved"}),o.jsx(ue,{variant:"ghost",size:"sm",onClick:()=>O&&V(O,"in_progress"),children:"In Progress"}),o.jsx(ue,{variant:"danger",size:"sm",onClick:()=>O&&V(O,"closed"),children:"Close"})]})]})]}):o.jsx("p",{className:"text-sm text-[#6C757D] text-center py-8",children:"Select a ticket from the table above to view details and reply."})})]})]})}const RSe=["new","investigating","resolved","escalated","dismissed"];function NSe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState(!1),[f,g]=L.useState(""),[v,y]=L.useState(null),[w,T]=L.useState(null),[S,I]=L.useState(""),j=async()=>{u(!0);try{const{data:R,error:O}=await ie.from("reports").select("*").order("created_at",{ascending:!1});if(O){console.error("Error fetching reports:",O);return}const V=new Set;for(const q of R??[])q.reporter_id&&V.add(q.reporter_id),q.reported_user_id&&V.add(q.reported_user_id);const{data:G}=V.size?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Array.from(V)):{data:[]},J=new Map;for(const q of G??[])J.set(q.user_id,q.display_name||q.username||"User");const $=(R??[]).map(q=>({id:q.id,reporterId:q.reporter_id,reporterName:J.get(q.reporter_id)??"System",reportedUserId:q.reported_user_id,reportedUserName:q.reported_user_id?J.get(q.reported_user_id)??"Unknown":null,reportedEventId:q.reported_event_id,reportType:q.report_type,resourceType:q.resource_type,title:q.title,description:q.description,severity:q.severity,status:q.status,createdAt:q.created_at}));a($)}finally{u(!1)}};L.useEffect(()=>{j()},[]);const B=async(R,O)=>{if(window.confirm(`Update report status to "${O}"?`)){u(!0);try{const G={status:O,updated_at:new Date().toISOString()};(O==="resolved"||O==="dismissed")&&(G.resolved_at=new Date().toISOString(),G.resolved_by=s==null?void 0:s.id,S.trim()&&(G.resolution_notes=S.trim()));const{error:J}=await ie.from("reports").update(G).eq("id",R);if(J){console.error("Error updating report:",J),alert("Failed to update report");return}await j(),I(""),alert("Report updated successfully")}finally{u(!1)}}},A=n.filter(R=>{var O;if(v&&R.status!==v)return!1;if(f){const V=f.toLowerCase();return R.title.toLowerCase().includes(V)||R.reporterName.toLowerCase().includes(V)||(((O=R.reportedUserName)==null?void 0:O.toLowerCase().includes(V))??!1)||R.id.toLowerCase().includes(V)}return!0}),F={new:"primary",investigating:"warning",resolved:"success",escalated:"danger",dismissed:"warning"},D={low:"primary",medium:"warning",high:"warning",critical:"danger"};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Reports & Flags"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Investigate community reports and moderate platform safety."})]}),o.jsxs(Ye,{variant:n.filter(R=>R.status==="new").length>0?"danger":"success",children:[n.filter(R=>R.status==="new").length," new reports"]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Filters",subtitle:"Narrow down by status or search"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Search",placeholder:"Report ID, title, reporter...",value:f,onChange:R=>g(R.target.value)}),o.jsxs("div",{children:[o.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsx(ue,{size:"sm",variant:v===null?"secondary":"ghost",onClick:()=>y(null),children:"All"}),RSe.map(R=>o.jsx(ue,{size:"sm",variant:v===R?"secondary":"ghost",onClick:()=>y(R),children:R.charAt(0).toUpperCase()+R.slice(1).replace("_"," ")},R))]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Flagged Items",subtitle:`${A.length} reports`}),o.jsxs(be,{className:"space-y-4",children:[A.length===0&&o.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No reports found"}),A.map(R=>o.jsxs("div",{className:`flex flex-col gap-4 rounded-[16px] border p-5 text-sm text-[#212529] ${(w==null?void 0:w.id)===R.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-[#F8F9FA]"}`,onClick:()=>T(R),children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-lg font-semibold",children:R.title}),o.jsxs("p",{className:"text-[#6C757D]",children:[R.resourceType,"  ",R.reportType]})]}),o.jsx(Ye,{variant:F[R.status]??"primary",children:R.status.replace("_"," ")})]}),o.jsxs("div",{className:"grid gap-3 md:grid-cols-3 text-[#6C757D]",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Reporter"}),o.jsx("p",{children:R.reporterName})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Reported"}),o.jsx("p",{children:R.reportedUserName||"N/A"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Submitted"}),o.jsx("p",{children:Bt(R.createdAt)})]})]}),R.description&&o.jsx("p",{className:"text-[#6C757D]",children:R.description}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsx(Ye,{variant:D[R.severity]??"primary",children:R.severity}),R.status==="new"&&o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>B(R.id,"investigating"),children:"Investigate"}),R.status==="investigating"&&o.jsxs(o.Fragment,{children:[o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>B(R.id,"escalated"),children:"Escalate"}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>B(R.id,"resolved"),children:"Resolve"})]}),R.status!=="resolved"&&R.status!=="dismissed"&&o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>B(R.id,"dismissed"),children:"Dismiss"})]})]},R.id))]})]}),w&&o.jsxs(pe,{children:[o.jsx(Ne,{title:"Resolution Notes",subtitle:`For report: ${w.title}`}),o.jsxs(be,{className:"space-y-4",children:[o.jsx(ls,{label:"Resolution Summary",rows:3,placeholder:"Explain action taken, evidence reviewed, outcome...",value:S,onChange:R=>I(R.target.value)}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",onClick:()=>B(w.id,"resolved"),disabled:l,children:"Mark Resolved"}),o.jsx(ue,{variant:"ghost",onClick:()=>B(w.id,"escalated"),disabled:l,children:"Escalate"})]})]})]})]})}const ASe=["new","under_review","escalated","resolved","closed"];function ISe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState(!1),[f,g]=L.useState(""),[v,y]=L.useState(null),[w,T]=L.useState(null),[S,I]=L.useState(""),j=async()=>{u(!0);try{const{data:R,error:O}=await ie.from("disputes").select("*").order("created_at",{ascending:!1});if(O){console.error("Error fetching disputes:",O);return}const V=new Set;for(const ne of R??[])V.add(ne.complainant_id),V.add(ne.respondent_id);const{data:G}=V.size?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Array.from(V)):{data:[]},{data:J}=V.size?await ie.from("users").select("id, role").in("id",Array.from(V)):{data:[]},$=new Map,q=new Map;for(const ne of G??[])$.set(ne.user_id,ne.display_name||ne.username||"User");for(const ne of J??[])q.set(ne.id,ne.role);const ee=(R??[]).map(ne=>({id:ne.id,complainantId:ne.complainant_id,complainantName:`${q.get(ne.complainant_id)==="creator"?"Creator":"Fan"}  ${$.get(ne.complainant_id)??"Unknown"}`,respondentId:ne.respondent_id,respondentName:`${q.get(ne.respondent_id)==="creator"?"Creator":"Fan"}  ${$.get(ne.respondent_id)??"Unknown"}`,eventId:ne.event_id,disputeType:ne.dispute_type,title:ne.title,description:ne.description,amount:ne.amount??0,priority:ne.priority,status:ne.status,resolution:ne.resolution,createdAt:ne.created_at}));a(ee)}finally{u(!1)}};L.useEffect(()=>{j()},[]);const B=async(R,O)=>{if(window.confirm(`Update dispute status to "${O.replace("_"," ")}"?`)){u(!0);try{const G={status:O,updated_at:new Date().toISOString()};(O==="resolved"||O==="closed")&&(G.resolved_at=new Date().toISOString(),G.resolved_by=s==null?void 0:s.id,S.trim()&&(G.resolution=S.trim()));const{error:J}=await ie.from("disputes").update(G).eq("id",R);if(J){console.error("Error updating dispute:",J),alert("Failed to update dispute");return}await j(),I(""),alert("Dispute updated successfully")}finally{u(!1)}}},A=n.filter(R=>{if(v&&R.status!==v)return!1;if(f){const O=f.toLowerCase();return R.title.toLowerCase().includes(O)||R.complainantName.toLowerCase().includes(O)||R.respondentName.toLowerCase().includes(O)||R.id.toLowerCase().includes(O)}return!0}),F={new:"primary",under_review:"warning",escalated:"danger",resolved:"success",closed:"success"},D={low:"primary",medium:"warning",high:"warning",critical:"danger"};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Dispute Management"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Resolve conflicts between fans and creators fairly."})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(Ye,{variant:"warning",children:[n.filter(R=>R.status==="new"||R.status==="under_review").length," active"]}),o.jsxs(Ye,{variant:"danger",children:[n.filter(R=>R.status==="escalated").length," escalated"]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Filters",subtitle:"Identify disputes based on status"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Search",placeholder:"Dispute ID, title, names...",value:f,onChange:R=>g(R.target.value)}),o.jsxs("div",{children:[o.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsx(ue,{size:"sm",variant:v===null?"secondary":"ghost",onClick:()=>y(null),children:"All"}),ASe.map(R=>o.jsx(ue,{size:"sm",variant:v===R?"secondary":"ghost",onClick:()=>y(R),children:R.replace("_"," ")},R))]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Active Disputes",subtitle:`${A.length} disputes`}),o.jsx(be,{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Dispute"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Complainant"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Respondent"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Priority"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Created"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsxs("tbody",{children:[A.map(R=>o.jsxs("tr",{className:`border-b border-[#E9ECEF] cursor-pointer hover:bg-[#F8F9FA] ${(w==null?void 0:w.id)===R.id?"bg-[#F4E6FF]/30":""}`,onClick:()=>T(R),children:[o.jsx("td",{className:"py-3 text-[#212529]",children:o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"font-semibold",children:R.title}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:R.disputeType})]})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:R.complainantName}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:R.respondentName}),o.jsx("td",{className:"py-3 text-[#212529]",children:Ue(R.amount)}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:F[R.status]??"primary",children:R.status.replace("_"," ")})}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:D[R.priority]??"primary",children:R.priority})}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:Bt(R.createdAt)}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[R.status==="new"&&o.jsx(ue,{size:"sm",variant:"secondary",onClick:O=>{O.stopPropagation(),B(R.id,"under_review")},children:"Review"}),R.status==="under_review"&&o.jsx(ue,{size:"sm",variant:"ghost",onClick:O=>{O.stopPropagation(),B(R.id,"escalated")},children:"Escalate"}),R.status!=="resolved"&&R.status!=="closed"&&o.jsx(ue,{size:"sm",variant:"ghost",onClick:O=>{O.stopPropagation(),B(R.id,"resolved")},children:"Resolve"})]})})]},R.id)),A.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:8,className:"py-8 text-center text-[#6C757D]",children:l?"Loading...":"No disputes found"})})]})]})})]}),w&&o.jsxs(pe,{children:[o.jsx(Ne,{title:"Dispute Detail",subtitle:w.title}),o.jsxs(be,{className:"grid gap-4 lg:grid-cols-2",children:[o.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx(Ye,{variant:F[w.status]??"primary",children:w.status.replace("_"," ")}),o.jsx(Ye,{variant:D[w.priority]??"primary",children:w.priority}),o.jsx(Ye,{variant:"primary",children:w.disputeType})]}),o.jsxs("div",{className:"space-y-2 text-[#6C757D]",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Complainant:"})," ",w.complainantName]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Respondent:"})," ",w.respondentName]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Amount:"})," ",Ue(w.amount)]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Created:"})," ",Bt(w.createdAt)]})]}),w.description&&o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold",children:"Description"}),o.jsx("p",{className:"text-[#6C757D]",children:w.description})]}),w.resolution&&o.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[o.jsx("p",{className:"font-semibold text-[#28A745]",children:"Resolution"}),o.jsx("p",{className:"text-[#6C757D]",children:w.resolution})]})]}),o.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Resolution"}),o.jsx(ls,{label:"Decision & Outcome",rows:4,placeholder:"Describe resolution, compensation, actions taken...",value:S,onChange:R=>I(R.target.value)}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsx(ue,{variant:"secondary",onClick:()=>B(w.id,"resolved"),disabled:l,children:"Mark Resolved"}),w.status!=="escalated"&&o.jsx(ue,{variant:"ghost",onClick:()=>B(w.id,"escalated"),disabled:l,children:"Escalate"}),o.jsx(ue,{variant:"ghost",onClick:()=>B(w.id,"closed"),disabled:l,children:"Close"})]})]})]})]})]})}function OSe(){const{user:s}=mr(),[n,a]=L.useState({platform_name:"FanMeet Five",support_email:"support@fanmeet.com",support_phone:"+91 98765 43210",default_timezone:"Asia/Kolkata",maintenance_mode:!1,welcome_message:"",default_commission:10,cancellation_window:12,auto_refund_percentage:90}),[l,u]=L.useState(!1),[f,g]=L.useState(!1);L.useEffect(()=>{(async()=>{u(!0);try{const{data:T,error:S}=await ie.from("platform_settings").select("key, value").in("key",["platform_name","support_email","support_phone","default_timezone","maintenance_mode","welcome_message","default_commission","cancellation_window","auto_refund_percentage"]);if(S){console.error("Error fetching settings:",S);return}const I={...n};for(const j of T??[])try{I[j.key]=JSON.parse(j.value)}catch{I[j.key]=j.value}a(I)}finally{u(!1)}})()},[]);const v=async()=>{g(!0);try{const w=Object.entries(n).map(([T,S])=>({key:T,value:JSON.stringify(S),updated_by:s==null?void 0:s.id,updated_at:new Date().toISOString()}));for(const T of w){const{error:S}=await ie.from("platform_settings").update({value:T.value,updated_by:T.updated_by,updated_at:T.updated_at}).eq("key",T.key);S&&console.error("Error updating setting:",T.key,S)}alert("Settings saved successfully!")}finally{g(!1)}},y=async()=>{const w=!n.maintenance_mode;if(!window.confirm(`Are you sure you want to ${w?"enable":"disable"} maintenance mode?`))return;a({...n,maintenance_mode:w});const{error:S}=await ie.from("platform_settings").update({value:JSON.stringify(w),updated_by:s==null?void 0:s.id,updated_at:new Date().toISOString()}).eq("key","maintenance_mode");S&&(console.error("Error toggling maintenance mode:",S),a({...n,maintenance_mode:!w}),alert("Failed to update maintenance mode"))};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"General Settings"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Configure platform basics, support contacts, and global defaults."})]}),o.jsx(ue,{onClick:v,disabled:f,children:f?"Saving...":"Save Changes"})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Platform Info",subtitle:"Branding and contact details"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Platform Name",value:n.platform_name,onChange:w=>a({...n,platform_name:w.target.value})}),o.jsx(nt,{label:"Support Email",value:n.support_email,onChange:w=>a({...n,support_email:w.target.value})}),o.jsx(nt,{label:"Support Phone",value:n.support_phone,onChange:w=>a({...n,support_phone:w.target.value})}),o.jsx(nt,{label:"Default Timezone",value:n.default_timezone,onChange:w=>a({...n,default_timezone:w.target.value})}),o.jsx("div",{className:"md:col-span-2",children:o.jsx(ls,{label:"Welcome Message",rows:3,placeholder:"Displayed to new users",value:n.welcome_message,onChange:w=>a({...n,welcome_message:w.target.value})})})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Sessions & Commission",subtitle:"Monetization and scheduling settings"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Cancellation Window (hours)",type:"number",value:n.cancellation_window.toString(),onChange:w=>a({...n,cancellation_window:parseInt(w.target.value)||0})}),o.jsx(nt,{label:"Default Commission (%)",type:"number",value:n.default_commission.toString(),onChange:w=>a({...n,default_commission:parseInt(w.target.value)||0})}),o.jsx(nt,{label:"Auto Refund Percentage",type:"number",value:n.auto_refund_percentage.toString(),onChange:w=>a({...n,auto_refund_percentage:parseInt(w.target.value)||0})}),o.jsxs("div",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[o.jsxs("div",{children:[o.jsxs("p",{className:"text-sm font-semibold text-[#212529]",children:["Auto Refunds: ",n.auto_refund_percentage,"%"]}),o.jsxs("p",{className:"text-xs text-[#6C757D]",children:["Retain ",100-n.auto_refund_percentage,"% commission from non-winning bids"]})]}),o.jsx(Ye,{variant:"success",children:"Active"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Maintenance Mode",subtitle:"Temporarily pause user access during updates"}),o.jsxs(be,{className:`flex flex-wrap items-center justify-between gap-4 rounded-[16px] border p-5 ${n.maintenance_mode?"border-[#DC3545] bg-[#DC3545]/10":"border-[#28A745] bg-[#28A745]/10"}`,children:[o.jsxs("div",{children:[o.jsxs("p",{className:`text-sm font-semibold ${n.maintenance_mode?"text-[#DC3545]":"text-[#28A745]"}`,children:["Maintenance mode is currently ",n.maintenance_mode?"ON":"OFF"]}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:n.maintenance_mode?"Users cannot access the platform. Disable to restore access.":"Platform is operational. Enable to block user access."})]}),o.jsx(ue,{variant:n.maintenance_mode?"secondary":"danger",onClick:y,children:n.maintenance_mode?"Disable Maintenance":"Enable Maintenance"})]})]})]})}function DSe(){const{user:s}=mr(),[n,a]=L.useState({default_commission:10,min_bid_increment:20,fast_payout_fee:20,auto_refund_percentage:90}),[l,u]=L.useState(!1),[f,g]=L.useState(!1),v=[{basePrice:50,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage},{basePrice:100,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage},{basePrice:200,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage}].map(w=>({...w,creatorShare:w.basePrice*(1-w.commission/100)}));L.useEffect(()=>{(async()=>{u(!0);try{const{data:T,error:S}=await ie.from("platform_settings").select("key, value").in("key",["default_commission","min_bid_increment","fast_payout_fee","auto_refund_percentage"]);if(S){console.error("Error fetching settings:",S);return}const I={...n};for(const j of T??[])try{I[j.key]=JSON.parse(j.value)}catch{I[j.key]=j.value}a(I)}finally{u(!1)}})()},[]);const y=async()=>{g(!0);try{const w=Object.entries(n).map(([T,S])=>({key:T,value:JSON.stringify(S),updated_by:s==null?void 0:s.id,updated_at:new Date().toISOString()}));for(const T of w){const{error:S}=await ie.from("platform_settings").update({value:T.value,updated_by:T.updated_by,updated_at:T.updated_at}).eq("key",T.key);S&&console.error("Error updating setting:",T.key,S)}alert("Pricing settings saved successfully!")}finally{g(!1)}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Pricing & Commission"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control base pricing, creator revenue share, and commission rates."})]}),o.jsx(ue,{onClick:y,disabled:f,children:f?"Saving...":"Save Changes"})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Commission Settings",subtitle:"Configure platform commission and fees"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Default Commission (%)",type:"number",value:n.default_commission.toString(),onChange:w=>a({...n,default_commission:parseInt(w.target.value)||0})}),o.jsx(nt,{label:"Auto Refund (%)",type:"number",value:n.auto_refund_percentage.toString(),onChange:w=>a({...n,auto_refund_percentage:parseInt(w.target.value)||0})}),o.jsx(nt,{label:"Minimum Bid Increment ()",type:"number",value:n.min_bid_increment.toString(),onChange:w=>a({...n,min_bid_increment:parseInt(w.target.value)||0})}),o.jsx(nt,{label:"Fast Payout Fee ()",type:"number",value:n.fast_payout_fee.toString(),onChange:w=>a({...n,fast_payout_fee:parseInt(w.target.value)||0})})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Revenue Split Preview",subtitle:"How revenue is divided based on current settings"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-3",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#C045FF]/30 bg-[#C045FF]/10 p-5 text-center",children:[o.jsxs("p",{className:"text-3xl font-bold text-[#C045FF]",children:[n.default_commission,"%"]}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Platform Commission"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-center",children:[o.jsxs("p",{className:"text-3xl font-bold text-[#28A745]",children:[100-n.default_commission,"%"]}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Creator Earnings"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#FFC107]/30 bg-[#FFC107]/10 p-5 text-center",children:[o.jsxs("p",{className:"text-3xl font-bold text-[#FFC107]",children:[n.auto_refund_percentage,"%"]}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Non-Winner Refund"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Pricing Tiers",subtitle:"Example pricing calculations based on current settings"}),o.jsx(be,{className:"space-y-4",children:v.map(w=>o.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-lg font-semibold",children:[Ue(w.basePrice)," Base Price"]}),o.jsx("p",{className:"text-[#6C757D]",children:"Entry-level pricing tier"})]}),o.jsxs(Ye,{variant:"primary",children:[w.commission,"% commission"]})]}),o.jsxs("div",{className:"grid gap-3 md:grid-cols-3 text-[#6C757D]",children:[o.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[o.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Creator Receives"}),o.jsx("p",{className:"text-lg font-semibold text-[#28A745]",children:Ue(w.creatorShare)})]}),o.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[o.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Platform Gets"}),o.jsx("p",{className:"text-lg font-semibold text-[#C045FF]",children:Ue(w.basePrice-w.creatorShare)})]}),o.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[o.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Non-Winner Refund"}),o.jsx("p",{className:"text-lg font-semibold text-[#FFC107]",children:Ue(w.basePrice*w.autoRefund/100)})]})]})]},w.basePrice))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Fee Structure",subtitle:"Current platform fees"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[o.jsx("p",{className:"font-semibold text-[#212529]",children:"Minimum Bid Increment"}),o.jsx("p",{className:"text-2xl font-bold text-[#C045FF]",children:Ue(n.min_bid_increment)}),o.jsx("p",{className:"mt-2 text-xs text-[#6C757D]",children:"Minimum amount fans must increase their bids by"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[o.jsx("p",{className:"font-semibold text-[#212529]",children:"Fast Payout Fee"}),o.jsx("p",{className:"text-2xl font-bold text-[#C045FF]",children:Ue(n.fast_payout_fee)}),o.jsx("p",{className:"mt-2 text-xs text-[#6C757D]",children:"Fee for instant withdrawal processing"})]})]})]})]})}const PSe=[{name:"{{fan_name}}",description:"Fan's first name"},{name:"{{creator_name}}",description:"Creator display name"},{name:"{{event_title}}",description:"Event name"},{name:"{{cta_link}}",description:"Primary button URL"},{name:"{{amount}}",description:"Currency amount"}];function kSe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState(!1),[f,g]=L.useState(null),[v,y]=L.useState(""),[w,T]=L.useState(""),[S,I]=L.useState(""),[j,B]=L.useState(""),[A,F]=L.useState(!1),D=async()=>{u(!0);try{const{data:J,error:$}=await ie.from("email_templates").select("*").order("created_at",{ascending:!1});if($){console.error("Error fetching templates:",$);return}const q=(J??[]).map(ee=>({id:ee.id,name:ee.name,subject:ee.subject,body:ee.body,audience:ee.audience,status:ee.status,createdAt:ee.created_at,updatedAt:ee.updated_at}));a(q)}finally{u(!1)}};L.useEffect(()=>{D()},[]);const R=J=>{g(J),y(J.name),T(J.subject),I(J.body),B(J.audience),F(!1)},O=()=>{g(null),y(""),T(""),I(""),B("all"),F(!0)},V=async J=>{if(!v.trim()||!w.trim()){alert("Name and subject are required");return}u(!0);try{if(A){const{error:$}=await ie.from("email_templates").insert({name:v.trim(),subject:w.trim(),body:S.trim(),audience:j.trim()||"all",status:J,created_by:s==null?void 0:s.id,updated_by:s==null?void 0:s.id});if($){console.error("Error creating template:",$),alert("Failed to create template");return}}else if(f){const{error:$}=await ie.from("email_templates").update({name:v.trim(),subject:w.trim(),body:S.trim(),audience:j.trim()||"all",status:J,updated_by:s==null?void 0:s.id,updated_at:new Date().toISOString()}).eq("id",f.id);if($){console.error("Error updating template:",$),alert("Failed to update template");return}}await D(),alert(`Template ${A?"created":"updated"} successfully!`),F(!1)}finally{u(!1)}},G=async J=>{if(!window.confirm("Are you sure you want to delete this template?"))return;const{error:q}=await ie.from("email_templates").delete().eq("id",J);if(q){console.error("Error deleting template:",q),alert("Failed to delete template");return}await D(),(f==null?void 0:f.id)===J&&g(null)};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Email Templates"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage transactional and lifecycle emails sent by FanMeet."})]}),o.jsx(ue,{onClick:O,children:"Create New Template"})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Templates",subtitle:`${n.length} templates`}),o.jsxs(be,{className:"space-y-4",children:[n.length===0&&o.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No templates yet. Create your first template."}),n.map(J=>o.jsxs("div",{className:`flex flex-col gap-4 rounded-[16px] border p-5 text-sm text-[#212529] cursor-pointer ${(f==null?void 0:f.id)===J.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-[#F8F9FA]"}`,onClick:()=>R(J),children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-lg font-semibold",children:J.name}),o.jsxs("p",{className:"text-[#6C757D]",children:["Subject: ",J.subject]}),o.jsxs("p",{className:"text-xs text-[#ADB5BD]",children:["Audience: ",J.audience]})]}),o.jsx(Ye,{variant:J.status==="active"?"success":"warning",children:J.status})]}),o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-[#6C757D]",children:[o.jsxs("span",{children:["Last updated: ",Bt(J.updatedAt)]}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:$=>{$.stopPropagation(),G(J.id)},children:"Delete"})]})]},J.id))]})]}),(f||A)&&o.jsxs(pe,{children:[o.jsx(Ne,{title:A?"New Template":"Edit Template",subtitle:A?"Create a new email template":f==null?void 0:f.name}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsx(nt,{label:"Template Name",value:v,onChange:J=>y(J.target.value),placeholder:"e.g., Welcome Email"}),o.jsx(nt,{label:"Email Subject",value:w,onChange:J=>T(J.target.value),placeholder:"e.g., Welcome to FanMeet Five!"}),o.jsx(nt,{label:"Audience",value:j,onChange:J=>B(J.target.value),placeholder:"e.g., New fans, Creators"}),o.jsx(ls,{label:"Body",rows:10,value:S,onChange:J=>I(J.target.value),placeholder:`Hi {{fan_name}},

Thanks for joining...`}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",onClick:()=>V("draft"),disabled:l,children:"Save Draft"}),o.jsx(ue,{onClick:()=>V("active"),disabled:l,children:"Publish"})]})]}),o.jsxs("div",{className:"space-y-3 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[o.jsx("h2",{className:"text-sm font-semibold",children:"Available Snippets"}),o.jsx("ul",{className:"space-y-2 text-[#6C757D]",children:PSe.map(J=>o.jsxs("li",{className:"flex items-center justify-between",children:[o.jsx("code",{className:"bg-[#F8F9FA] px-2 py-1 rounded text-xs",children:J.name}),o.jsx("span",{className:"text-xs",children:J.description})]},J.name))}),o.jsxs("div",{className:"mt-4 rounded-[12px] bg-[#F8F9FA] p-4",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Preview"}),o.jsx("p",{className:"mt-2 whitespace-pre-line text-sm",children:S.replace("{{fan_name}}","Neha").replace("{{creator_name}}","Priya").replace("{{event_title}}","Live Chat Session").replace("{{cta_link}}","https://fanmeet.app").replace("{{amount}}","500")})]})]})]})]})]})}const jSe=[{id:"email",label:"Email",description:"Transactional and marketing emails",enabled:!0},{id:"push",label:"Push Notifications",description:"Mobile push via FanMeet app",enabled:!0},{id:"sms",label:"SMS",description:"Critical alerts and OTP delivery",enabled:!1},{id:"whatsapp",label:"WhatsApp",description:"High priority creator alerts",enabled:!1}],LSe=["bid_placed","bid_won","bid_refunded","event_created","event_cancelled","withdrawal_approved","withdrawal_rejected","meet_scheduled","meet_completed","support_ticket_update","dispute_escalated","creator_approved"];function MSe(){const[s,n]=L.useState([]),[a,l]=L.useState(jSe),[u,f]=L.useState(!1),[g,v]=L.useState(""),[y,w]=L.useState(["email"]),T=async()=>{f(!0);try{const{data:F,error:D}=await ie.from("notification_rules").select("*").order("trigger_event",{ascending:!0});if(D){console.error("Error fetching notification rules:",D);return}const R=(F??[]).map(O=>({id:O.id,triggerEvent:O.trigger_event,channels:O.channels??[],templateId:O.template_id,status:O.status}));n(R)}finally{f(!1)}};L.useEffect(()=>{T()},[]);const S=F=>{l(D=>D.map(R=>R.id===F?{...R,enabled:!R.enabled}:R))},I=async()=>{if(!g){alert("Select a trigger event");return}f(!0);try{const{error:F}=await ie.from("notification_rules").insert({trigger_event:g,channels:y,status:"active"});if(F){console.error("Error creating rule:",F),alert("Failed to create rule. It may already exist.");return}await T(),v(""),alert("Rule created successfully!")}finally{f(!1)}},j=async F=>{const D=F.status==="active"?"disabled":"active",{error:R}=await ie.from("notification_rules").update({status:D,updated_at:new Date().toISOString()}).eq("id",F.id);if(R){console.error("Error updating rule:",R),alert("Failed to update rule");return}await T()},B=async F=>{if(!window.confirm("Delete this notification rule?"))return;const{error:R}=await ie.from("notification_rules").delete().eq("id",F);if(R){console.error("Error deleting rule:",R),alert("Failed to delete rule");return}await T()},A=F=>F.split("_").map(D=>D.charAt(0).toUpperCase()+D.slice(1)).join(" ");return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Notification Settings"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control channels, templates, and delivery rules for platform alerts."})]}),o.jsxs(Ye,{variant:"primary",children:[s.length," rules configured"]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Channels",subtitle:"Enable or disable notification channels"}),o.jsx(be,{className:"space-y-3",children:a.map(F=>o.jsxs("label",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529] cursor-pointer",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold",children:F.label}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:F.description})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ye,{variant:F.enabled?"success":"warning",children:F.enabled?"Enabled":"Disabled"}),o.jsx("input",{type:"checkbox",checked:F.enabled,onChange:()=>S(F.id),className:"h-5 w-5 rounded border-[#CED4DA]"})]})]},F.id))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Automated Rules",subtitle:"Template and channel mapping per trigger"}),o.jsx(be,{className:"overflow-x-auto text-sm",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Trigger"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Channel(s)"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsxs("tbody",{children:[s.map(F=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529] font-medium",children:A(F.triggerEvent)}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:F.channels.length>0?F.channels.join(", "):"-"}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:F.status==="active"?"success":"warning",children:F.status})}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>j(F),children:F.status==="active"?"Disable":"Enable"}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>B(F.id),children:"Delete"})]})})]},F.id)),s.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"py-8 text-center text-[#6C757D]",children:u?"Loading...":"No notification rules configured"})})]})]})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Add New Rule",subtitle:"Configure a new notification trigger"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Trigger Event"}),o.jsxs("select",{className:"w-full rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",value:g,onChange:F=>v(F.target.value),children:[o.jsx("option",{value:"",children:"Select trigger..."}),LSe.map(F=>o.jsx("option",{value:F,children:A(F)},F))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Channels"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:["email","push","sms"].map(F=>o.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[o.jsx("input",{type:"checkbox",checked:y.includes(F),onChange:D=>{D.target.checked?w([...y,F]):w(y.filter(R=>R!==F))}}),F.toUpperCase()]},F))})]}),o.jsx("div",{className:"md:col-span-2",children:o.jsx(ue,{onClick:I,disabled:u||!g,children:"Create Rule"})})]})]})]})}function FSe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState({require_2fa:!0,session_timeout:45,password_min_length:12}),[f,g]=L.useState(!1),[v,y]=L.useState(!1);L.useEffect(()=>{(async()=>{g(!0);try{const{data:j}=await ie.from("users").select("id, email, role, created_at, account_status").eq("role","admin");if(j){const{data:A}=await ie.from("profiles").select("user_id, display_name").in("user_id",j.map(R=>R.id)),F=new Map;for(const R of A??[])F.set(R.user_id,R.display_name||"Admin");const D=j.map(R=>({id:R.id,email:R.email,displayName:F.get(R.id)??R.email.split("@")[0],createdAt:R.created_at,accountStatus:R.account_status??"active"}));a(D)}const{data:B}=await ie.from("platform_settings").select("key, value").in("key",["require_2fa","session_timeout","password_min_length"]);if(B){const A={...l};for(const F of B)try{A[F.key]=JSON.parse(F.value)}catch{A[F.key]=F.value}u(A)}}finally{g(!1)}})()},[]);const w=async()=>{y(!0);try{const I=[{key:"require_2fa",value:JSON.stringify(l.require_2fa)},{key:"session_timeout",value:JSON.stringify(l.session_timeout)},{key:"password_min_length",value:JSON.stringify(l.password_min_length)}];for(const j of I)await ie.from("platform_settings").update({value:j.value,updated_by:s==null?void 0:s.id,updated_at:new Date().toISOString()}).eq("key",j.key);alert("Security settings saved!")}finally{y(!1)}},T=async I=>{if(I===(s==null?void 0:s.id)){alert("You cannot suspend yourself");return}if(!window.confirm("Suspend this admin account?"))return;const{error:B}=await ie.from("users").update({account_status:"suspended"}).eq("id",I);if(B){console.error("Error suspending admin:",B),alert("Failed to suspend admin");return}a(A=>A.map(F=>F.id===I?{...F,accountStatus:"suspended"}:F))},S=async I=>{const{error:j}=await ie.from("users").update({account_status:"active"}).eq("id",I);if(j){console.error("Error reactivating admin:",j),alert("Failed to reactivate admin");return}a(B=>B.map(A=>A.id===I?{...A,accountStatus:"active"}:A))};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Security & Access"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control admin access and authentication policies."})]}),o.jsx(ue,{onClick:w,disabled:v,children:v?"Saving...":"Save Changes"})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Access Policies",subtitle:"Security requirements for admin accounts"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Session Timeout (minutes)",type:"number",value:l.session_timeout.toString(),onChange:I=>u({...l,session_timeout:parseInt(I.target.value)||0})}),o.jsx(nt,{label:"Minimum Password Length",type:"number",value:l.password_min_length.toString(),onChange:I=>u({...l,password_min_length:parseInt(I.target.value)||8})}),o.jsxs("label",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 md:col-span-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:"Require 2FA for all admins"}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"Mandatory via authenticator app or SMS backup."})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ye,{variant:l.require_2fa?"success":"warning",children:l.require_2fa?"Enabled":"Disabled"}),o.jsx("input",{type:"checkbox",checked:l.require_2fa,onChange:I=>u({...l,require_2fa:I.target.checked}),className:"h-5 w-5 rounded border-[#CED4DA]"})]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Admin Users",subtitle:`${n.length} admin accounts`}),o.jsxs(be,{className:"space-y-4",children:[n.map(I=>o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold",children:I.displayName}),o.jsx("p",{className:"text-[#6C757D]",children:I.email})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ye,{variant:I.accountStatus==="active"?"success":"danger",children:I.accountStatus}),I.id!==(s==null?void 0:s.id)&&(I.accountStatus==="active"?o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>T(I.id),children:"Suspend"}):o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>S(I.id),children:"Reactivate"})),I.id===(s==null?void 0:s.id)&&o.jsx(Ye,{variant:"primary",children:"You"})]})]},I.id)),n.length===0&&o.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:f?"Loading...":"No admin users found"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Security Overview",subtitle:"Current security status"}),o.jsxs(be,{className:"grid gap-3 md:grid-cols-3",children:[o.jsxs("div",{className:`rounded-[16px] border p-4 text-sm ${l.require_2fa?"border-[#28A745]/30 bg-[#28A745]/10 text-[#28A745]":"border-[#DC3545]/30 bg-[#DC3545]/10 text-[#DC3545]"}`,children:[o.jsx("p",{className:"font-semibold",children:"2FA Status"}),o.jsx("p",{className:"text-xs",children:l.require_2fa?"Required for all admins":"Not required - Enable for better security"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[o.jsx("p",{className:"font-semibold",children:"Session Timeout"}),o.jsxs("p",{className:"text-xs text-[#6C757D]",children:[l.session_timeout," minutes"]})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[o.jsx("p",{className:"font-semibold",children:"Active Admins"}),o.jsxs("p",{className:"text-xs text-[#6C757D]",children:[n.filter(I=>I.accountStatus==="active").length," of ",n.length]})]})]})]})]})}function USe(){const[s,n]=L.useState([]),[a,l]=L.useState(!1),[u,f]=L.useState(""),[g,v]=L.useState(null),y=async()=>{l(!0);try{let A=ie.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(100);g&&(A=A.eq("status",g));const{data:F,error:D}=await A;if(D){console.error("Error fetching logs:",D);return}const R=(F??[]).map(O=>({id:O.id,actorType:O.actor_type,actorName:O.actor_name,action:O.action,actionType:O.action_type,status:O.status,resourceType:O.resource_type,details:O.details,createdAt:O.created_at}));n(R)}finally{l(!1)}};L.useEffect(()=>{y()},[g]);const w=s.filter(A=>{var D;if(!u)return!0;const F=u.toLowerCase();return A.action.toLowerCase().includes(F)||A.actionType.toLowerCase().includes(F)||(((D=A.actorName)==null?void 0:D.toLowerCase().includes(F))??!1)}),T={success:"success",warning:"warning",error:"danger"},S=()=>{const A=`ID,Time,Actor,Action,Type,Status
`+w.map(O=>`${O.id},"${Bt(O.createdAt)}","${O.actorName||O.actorType}","${O.action}",${O.actionType},${O.status}`).join(`
`),F=new Blob([A],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(F),R=document.createElement("a");R.setAttribute("href",D),R.setAttribute("download",`system_logs_${new Date().toISOString().split("T")[0]}.csv`),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)},I=s.filter(A=>A.status==="error").length,j=s.filter(A=>A.status==="warning").length,B=s.filter(A=>A.status==="success").length;return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"System Logs"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Monitor platform activity and system health."})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",onClick:S,children:"Download Logs"}),o.jsx(ue,{onClick:y,disabled:a,children:a?"Loading...":"Refresh"})]})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-[#212529]",children:s.length}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Total Logs"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-[#28A745]",children:B}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Success"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#FFC107]/30 bg-[#FFC107]/10 p-5 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-[#FFC107]",children:j}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Warnings"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#DC3545]/30 bg-[#DC3545]/10 p-5 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-[#DC3545]",children:I}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Errors"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Filters",subtitle:"Search and filter logs"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Search",placeholder:"Action, type, actor...",value:u,onChange:A=>f(A.target.value)}),o.jsxs("div",{children:[o.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsx(ue,{size:"sm",variant:g===null?"secondary":"ghost",onClick:()=>v(null),children:"All"}),o.jsx(ue,{size:"sm",variant:g==="success"?"secondary":"ghost",onClick:()=>v("success"),children:"Success"}),o.jsx(ue,{size:"sm",variant:g==="warning"?"secondary":"ghost",onClick:()=>v("warning"),children:"Warning"}),o.jsx(ue,{size:"sm",variant:g==="error"?"secondary":"ghost",onClick:()=>v("error"),children:"Error"})]})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Log Stream",subtitle:`${w.length} entries  Newest first`}),o.jsxs(be,{className:"space-y-4",children:[w.length===0&&o.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:a?"Loading logs...":"No logs found"}),w.map(A=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[o.jsx("div",{className:"font-semibold",children:A.action}),o.jsx(Ye,{variant:T[A.status]??"primary",children:A.status})]}),o.jsxs("p",{className:"mt-2 text-[#6C757D]",children:[Bt(A.createdAt),"  ",A.actorType,A.actorName&&`  ${A.actorName}`]}),A.details&&Object.keys(A.details).length>0&&o.jsxs("details",{className:"mt-2",children:[o.jsx("summary",{className:"cursor-pointer text-xs text-[#6C757D]",children:"View Details"}),o.jsx("pre",{className:"mt-2 overflow-x-auto rounded bg-white p-2 text-xs",children:JSON.stringify(A.details,null,2)})]}),o.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:[o.jsx(Ye,{variant:"primary",children:A.actionType}),A.resourceType&&o.jsx(Ye,{variant:"warning",children:A.resourceType})]})]},A.id))]})]})]})}const VSe=["suspend_users","ban_users","approve_withdrawals","send_notifications","update_status","delete_records","export_data","other"];function BSe(){const{user:s}=mr(),[n,a]=L.useState([]),[l,u]=L.useState(!1),[f,g]=L.useState(""),[v,y]=L.useState(""),[w,T]=L.useState("other"),[S,I]=L.useState(""),j=async()=>{u(!0);try{const{data:O,error:V}=await ie.from("bulk_actions").select("*").order("created_at",{ascending:!1});if(V){console.error("Error fetching bulk actions:",V);return}const G=new Set;for(const ee of O??[])ee.created_by&&G.add(ee.created_by);const{data:J}=G.size?await ie.from("profiles").select("user_id, display_name").in("user_id",Array.from(G)):{data:[]},$=new Map;for(const ee of J??[])$.set(ee.user_id,ee.display_name||"Admin");const q=(O??[]).map(ee=>({id:ee.id,title:ee.title,description:ee.description,actionType:ee.action_type,targetCriteria:ee.target_criteria,affectedCount:ee.affected_count??0,status:ee.status,notes:ee.notes,createdBy:ee.created_by,createdByName:$.get(ee.created_by)??"System",createdAt:ee.created_at}));a(q)}finally{u(!1)}};L.useEffect(()=>{j()},[]);const B=async O=>{if(!f.trim()){alert("Title is required");return}u(!0);try{let V=null;if(S.trim())try{V=JSON.parse(S)}catch{V={description:S}}const{error:G}=await ie.from("bulk_actions").insert({title:f.trim(),description:v.trim()||null,action_type:w,target_criteria:V,status:O,created_by:s==null?void 0:s.id});if(G){console.error("Error creating bulk action:",G),alert("Failed to create bulk action");return}await j(),g(""),y(""),I(""),alert(`Bulk action ${O==="pending"?"saved as draft":"submitted for approval"}!`)}finally{u(!1)}},A=async(O,V)=>{if(!window.confirm(`Update action status to "${V}"?`))return;const J={status:V,updated_at:new Date().toISOString()};V==="approved"&&(J.approved_by=s==null?void 0:s.id),V==="completed"&&(J.executed_at=new Date().toISOString());const{error:$}=await ie.from("bulk_actions").update(J).eq("id",O);if($){console.error("Error updating bulk action:",$),alert("Failed to update action");return}await j()},F=async O=>{if(!window.confirm("Delete this bulk action?"))return;const{error:G}=await ie.from("bulk_actions").delete().eq("id",O);if(G){console.error("Error deleting bulk action:",G),alert("Failed to delete action");return}await j()},D={pending:"warning",approved:"primary",completed:"success",rejected:"danger",failed:"danger"},R=O=>O.split("_").map(V=>V.charAt(0).toUpperCase()+V.slice(1)).join(" ");return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Bulk Actions"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Execute large-scale updates safely with approval trails."})]}),o.jsxs(Ye,{variant:"primary",children:[n.filter(O=>O.status==="pending").length," pending"]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Active Actions",subtitle:`${n.length} bulk actions`}),o.jsxs(be,{className:"space-y-4",children:[n.length===0&&o.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No bulk actions created yet"}),n.map(O=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-lg font-semibold",children:O.title}),o.jsxs("p",{className:"text-xs text-[#6C757D]",children:[O.createdByName,"  ",Bt(O.createdAt)]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ye,{variant:"primary",children:R(O.actionType)}),o.jsx(Ye,{variant:D[O.status]??"primary",children:O.status})]})]}),O.description&&o.jsx("p",{className:"mt-3 text-[#6C757D]",children:O.description}),O.notes&&o.jsxs("p",{className:"mt-2 text-xs text-[#ADB5BD]",children:["Notes: ",O.notes]}),o.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[O.status==="pending"&&o.jsxs(o.Fragment,{children:[o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>A(O.id,"approved"),children:"Approve"}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>A(O.id,"rejected"),children:"Reject"})]}),O.status==="approved"&&o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>A(O.id,"completed"),children:"Mark Completed"}),o.jsx(ue,{size:"sm",variant:"ghost",onClick:()=>F(O.id),children:"Delete"})]})]},O.id))]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"New Bulk Action",subtitle:"Design and schedule batch operations"}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Action Title",placeholder:"e.g. Suspend flagged accounts",value:f,onChange:O=>g(O.target.value)}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Action Type"}),o.jsx("select",{className:"w-full rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",value:w,onChange:O=>T(O.target.value),children:VSe.map(O=>o.jsx("option",{value:O,children:R(O)},O))})]}),o.jsx(ls,{label:"Description",rows:3,placeholder:"Describe what this action will do...",value:v,onChange:O=>y(O.target.value)}),o.jsx(ls,{label:"Target Criteria (JSON or text)",rows:3,placeholder:'{"user_status": "flagged"} or plain text description',value:S,onChange:O=>I(O.target.value)}),o.jsxs("div",{className:"md:col-span-2 flex flex-wrap gap-2",children:[o.jsx(ue,{variant:"secondary",onClick:()=>B("pending"),disabled:l,children:"Save Draft"}),o.jsx(ue,{onClick:()=>B("approved"),disabled:l,children:"Submit for Approval"})]})]})]})]})}function WSe(){const[s,n]=L.useState([]),[a,l]=L.useState({totalTables:0,totalRows:0,projectId:"iktldcrkyphkvxjwmxyb",region:"ap-south-1"}),[u,f]=L.useState(!1),[g,v]=L.useState(null),y=async()=>{f(!0);try{const S=["users","events","bids","meets","profiles","notifications","support_tickets","withdrawal_requests","wallet_transactions","reports","disputes","audit_logs","bulk_actions"],I=[];let j=0;for(const B of S){const{count:A,error:F}=await ie.from(B).select("*",{count:"exact",head:!0});if(!F){const D=A??0;j+=D,I.push({name:B,rowCount:D,size:`~${Math.max(1,Math.round(D*.5))} KB`})}}I.sort((B,A)=>A.rowCount-B.rowCount),n(I),l({totalTables:I.length,totalRows:j,projectId:"iktldcrkyphkvxjwmxyb",region:"ap-south-1"}),v(new Date)}finally{f(!1)}};L.useEffect(()=>{y()},[]);const w=async S=>{f(!0);try{const{data:I,error:j}=await ie.from(S).select("*").limit(1e3);if(j){alert(`Failed to export ${S}: ${j.message}`);return}const B=JSON.stringify(I,null,2),A=new Blob([B],{type:"application/json"}),F=URL.createObjectURL(A),D=document.createElement("a");D.setAttribute("href",F),D.setAttribute("download",`${S}_export_${new Date().toISOString().split("T")[0]}.json`),D.style.visibility="hidden",document.body.appendChild(D),D.click(),document.body.removeChild(D)}finally{f(!1)}},T=async()=>{if(window.confirm("Export all tables? This may take a moment.")){f(!0);try{const I={};for(const D of s){const{data:R}=await ie.from(D.name).select("*").limit(1e3);R&&(I[D.name]=R)}const j=JSON.stringify(I,null,2),B=new Blob([j],{type:"application/json"}),A=URL.createObjectURL(B),F=document.createElement("a");F.setAttribute("href",A),F.setAttribute("download",`full_database_export_${new Date().toISOString().split("T")[0]}.json`),F.style.visibility="hidden",document.body.appendChild(F),F.click(),document.body.removeChild(F),alert("Full database export completed!")}finally{f(!1)}}};return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Database Backup"}),o.jsxs("p",{className:"text-sm text-[#6C757D]",children:["View database statistics and export data.",g&&` Last refreshed: ${Bt(g.toISOString())}`]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",onClick:T,disabled:u,children:"Export All Tables"}),o.jsx(ue,{onClick:y,disabled:u,children:u?"Loading...":"Refresh Stats"})]})]}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-[#212529]",children:a.totalTables}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Tables"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[o.jsx("p",{className:"text-3xl font-bold text-[#C045FF]",children:a.totalRows.toLocaleString()}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Total Rows"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[o.jsxs("p",{className:"text-lg font-bold text-[#212529]",children:[a.projectId.slice(0,8),"..."]}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Project ID"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[o.jsx("p",{className:"text-lg font-bold text-[#212529]",children:a.region}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Region"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Supabase Managed Backups",subtitle:"Automatic daily backups handled by Supabase"}),o.jsxs(be,{className:"grid gap-3 md:grid-cols-3",children:[o.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-sm",children:[o.jsx("p",{className:"font-semibold text-[#28A745]",children:"Daily Backups"}),o.jsx("p",{className:"mt-2 text-[#6C757D]",children:"Automatic daily point-in-time recovery enabled"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"font-semibold",children:"Retention"}),o.jsx("p",{className:"mt-2 text-[#6C757D]",children:"7 days (Free tier) / 30 days (Pro)"})]}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"font-semibold",children:"PITR"}),o.jsx("p",{className:"mt-2 text-[#6C757D]",children:"Point-in-time recovery available"})]})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Table Statistics",subtitle:`${s.length} tables  Export individual tables`}),o.jsx(be,{className:"overflow-x-auto text-sm",children:o.jsxs("table",{className:"min-w-full table-auto border-collapse text-left",children:[o.jsx("thead",{className:"text-[#6C757D]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Table"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rows"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Est. Size"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),o.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),o.jsxs("tbody",{children:[s.map(S=>o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsx("td",{className:"py-3 text-[#212529] font-medium",children:S.name}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:S.rowCount.toLocaleString()}),o.jsx("td",{className:"py-3 text-[#6C757D]",children:S.size}),o.jsx("td",{className:"py-3",children:o.jsx(Ye,{variant:"success",children:"Active"})}),o.jsx("td",{className:"py-3",children:o.jsx(ue,{size:"sm",variant:"secondary",onClick:()=>w(S.name),disabled:u,children:"Export JSON"})})]},S.name)),s.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:u?"Loading table statistics...":"No tables found"})})]})]})})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Backup Notes",subtitle:"Important information about data protection"}),o.jsxs(be,{className:"space-y-3 text-sm text-[#6C757D]",children:[o.jsxs("p",{children:[o.jsx("strong",{className:"text-[#212529]",children:"Automatic Backups:"})," Supabase automatically handles daily backups and point-in-time recovery. No manual intervention is needed for standard backup operations."]}),o.jsxs("p",{children:[o.jsx("strong",{className:"text-[#212529]",children:"Manual Exports:"})," Use the export buttons above to download JSON snapshots of individual tables or the entire database for local backups or data analysis."]}),o.jsxs("p",{children:[o.jsx("strong",{className:"text-[#212529]",children:"Restore:"})," To restore from a backup, contact Supabase support or use the Supabase Dashboard to access point-in-time recovery options."]})]})]})]})}const jd={name:"Megha Sharma",title:"Head of Operations",email:"megha@fanmeet.com",phone:"+91 98765 43210",role:"Super Admin",lastLogin:"Jan 12, 2025  10:15 AM IST",timezone:"Asia/Kolkata"},GSe=[{team:"Support Desk",scope:"Tickets, Reports",status:"Active",expires:"Feb 01, 2025"},{team:"Finance Ops",scope:"Withdrawals, Refunds",status:"Active",expires:"Mar 15, 2025"}],HSe=["Jan 12  Approved withdrawal batch WR-BATCH-24","Jan 12  Updated pricing tier 100 Base","Jan 11  Resolved dispute DSP-311","Jan 10  Published announcement ANN-210"];function zSe(){return o.jsxs("div",{className:"flex flex-col gap-8",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"My Profile"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage your contact info, access, and delegated permissions."})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",children:"Download Activity Log"}),o.jsx(ue,{children:"Update Security"})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Personal Information",subtitle:"Visible to other admins."}),o.jsxs(be,{className:"grid gap-4 md:grid-cols-2",children:[o.jsx(nt,{label:"Full Name",defaultValue:jd.name}),o.jsx(nt,{label:"Title",defaultValue:jd.title}),o.jsx(nt,{label:"Email",defaultValue:jd.email}),o.jsx(nt,{label:"Phone",defaultValue:jd.phone}),o.jsx(nt,{label:"Timezone",defaultValue:jd.timezone}),o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Role"}),o.jsx(Ye,{variant:"primary",className:"mt-3 w-fit",children:jd.role}),o.jsxs("p",{className:"mt-3 text-xs text-[#6C757D]",children:["Last login: ",jd.lastLogin]})]}),o.jsx("div",{className:"md:col-span-2",children:o.jsx(ls,{label:"Out of Office Message",rows:3,placeholder:"Optional note for delegating responsibilities."})})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Delegated Access",subtitle:"Teams that can act on your behalf."}),o.jsx(be,{className:"grid gap-4 md:grid-cols-2",children:GSe.map(s=>o.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[o.jsx("p",{className:"text-lg font-semibold",children:s.team}),o.jsxs("p",{className:"mt-2 text-[#6C757D]",children:["Scope: ",s.scope]}),o.jsxs("p",{className:"text-xs text-[#ADB5BD]",children:["Expires: ",s.expires]}),o.jsx(Ye,{variant:"success",className:"mt-3 w-fit",children:s.status}),o.jsxs("div",{className:"mt-4 flex gap-2",children:[o.jsx(ue,{size:"sm",variant:"secondary",children:"Modify"}),o.jsx(ue,{size:"sm",variant:"ghost",children:"Revoke"})]})]},s.team))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Recent Activity",subtitle:"Latest actions performed under this account."}),o.jsx(be,{children:o.jsx("ul",{className:"space-y-2 text-sm text-[#212529]",children:HSe.map(s=>o.jsxs("li",{className:"flex items-center gap-2 rounded-[12px] bg-[#F8F9FA] px-4 py-3",children:[o.jsx("span",{className:"text-[#C045FF]",children:""}),o.jsx("span",{children:s})]},s))})})]}),o.jsxs("div",{className:"flex flex-wrap gap-3",children:[o.jsx(ue,{variant:"secondary",children:"Save Changes"}),o.jsx(ue,{variant:"ghost",children:"Cancel"}),o.jsx(ue,{variant:"danger",children:"Deactivate Account"})]})]})}function KSe(){const[s,n]=L.useState([]),[a,l]=L.useState(new Map),[u,f]=L.useState(!0),g=async()=>{f(!0);const{data:w,error:T}=await ie.from("meets").select("*").order("created_at",{ascending:!1});if(T)console.error("Error fetching meets:",T);else{n(w||[]);const S=[...new Set((w==null?void 0:w.map(B=>B.creator_id))||[])],I=[...new Set((w==null?void 0:w.map(B=>B.fan_id))||[])],j=[...new Set([...S,...I])];if(j.length>0){const{data:B}=await ie.from("profiles").select("*").in("user_id",j),A=new Map((B==null?void 0:B.map(F=>[F.user_id,F]))||[]);l(A)}}f(!1)};L.useEffect(()=>{g()},[]);const v=async w=>{const{error:T}=await ie.from("meets").update({meeting_link:"https://meet.google.com/abc-defg-hij"}).eq("id",w);T?(console.error("Error updating meeting link:",T),alert("Failed to update meeting link")):(alert("Meeting link updated successfully!"),g())},y=async(w,T)=>{const{error:S}=await ie.from("meets").update({status:T}).eq("id",w);S?(console.error("Error updating status:",S),alert("Failed to update status")):(alert("Status updated successfully!"),g())};return u?o.jsx("div",{className:"p-8 text-center",children:"Loading..."}):o.jsxs("div",{className:"flex flex-col gap-8 p-8",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Admin: Meets Debug"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"View and manage all meetings in the database"})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:`All Meets (${s.length})`}),o.jsx(be,{className:"gap-4",children:s.length===0?o.jsx("p",{className:"text-sm text-[#6C757D]",children:"No meets found in database"}):o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"border-b border-[#E9ECEF]",children:o.jsxs("tr",{className:"text-left",children:[o.jsx("th",{className:"pb-2",children:"ID"}),o.jsx("th",{className:"pb-2",children:"Creator"}),o.jsx("th",{className:"pb-2",children:"Fan"}),o.jsx("th",{className:"pb-2",children:"Scheduled"}),o.jsx("th",{className:"pb-2",children:"Duration"}),o.jsx("th",{className:"pb-2",children:"Status"}),o.jsx("th",{className:"pb-2",children:"Meeting Link"}),o.jsx("th",{className:"pb-2",children:"Actions"})]})}),o.jsx("tbody",{children:s.map(w=>{const T=a.get(w.creator_id),S=a.get(w.fan_id);return o.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[o.jsxs("td",{className:"py-3 text-xs",children:[w.id.substring(0,8),"..."]}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"text-xs",children:[o.jsx("div",{children:(T==null?void 0:T.display_name)||"Unknown"}),o.jsxs("div",{className:"text-[#6C757D]",children:["@",(T==null?void 0:T.username)||"unknown"]})]})}),o.jsx("td",{className:"py-3",children:o.jsxs("div",{className:"text-xs",children:[o.jsx("div",{children:(S==null?void 0:S.display_name)||"Unknown"}),o.jsxs("div",{className:"text-[#6C757D]",children:["@",(S==null?void 0:S.username)||"unknown"]})]})}),o.jsx("td",{className:"py-3 text-xs",children:Bt(w.scheduled_at)}),o.jsxs("td",{className:"py-3 text-xs",children:[w.duration_minutes," min"]}),o.jsx("td",{className:"py-3",children:o.jsxs("select",{value:w.status,onChange:I=>y(w.id,I.target.value),className:"text-xs rounded border border-[#E9ECEF] px-2 py-1",children:[o.jsx("option",{value:"scheduled",children:"scheduled"}),o.jsx("option",{value:"completed",children:"completed"}),o.jsx("option",{value:"cancelled",children:"cancelled"}),o.jsx("option",{value:"no_show",children:"no_show"})]})}),o.jsx("td",{className:"py-3",children:o.jsx("div",{className:"text-xs break-all max-w-xs",children:w.meeting_link||o.jsx("span",{className:"text-red-500",children:"No link"})})}),o.jsx("td",{className:"py-3",children:!w.meeting_link&&o.jsx(ue,{size:"sm",onClick:()=>v(w.id),children:"Add Link"})})]},w.id)})})]})})})]}),o.jsx(ue,{onClick:g,children:"Refresh Data"})]})}const RR={CREATOR_STREAM_STARTED:"bg-emerald-100 text-emerald-800",CREATOR_JOINED:"bg-blue-100 text-blue-800",FAN_JOINED:"bg-violet-100 text-violet-800",FAN_WAITING_ROOM:"bg-amber-100 text-amber-800",RECORDING_STARTED:"bg-rose-100 text-rose-800",RECORDING_STOPPED:"bg-slate-100 text-slate-800",MEETING_CANCELLED_NO_SHOW_CREATOR:"bg-red-100 text-red-800",REFUND_ISSUED:"bg-orange-100 text-orange-800",MEETING_COMPLETED:"bg-green-100 text-green-800",FAN_JOIN_STATUS_AT_S:"bg-indigo-100 text-indigo-800"},w7={scheduled:{color:"text-blue-600",bg:"bg-blue-500",icon:""},live:{color:"text-green-600",bg:"bg-green-500",icon:""},completed:{color:"text-gray-600",bg:"bg-gray-500",icon:""},cancelled:{color:"text-red-600",bg:"bg-red-500",icon:""},cancelled_no_show_creator:{color:"text-red-600",bg:"bg-red-600",icon:""}};function qSe(){const[s,n]=L.useState([]),[a,l]=L.useState([]),[u,f]=L.useState([]),[g,v]=L.useState(!0),[y,w]=L.useState(null),[T,S]=L.useState("all"),[I,j]=L.useState("overview"),[B,A]=L.useState({total:0,scheduled:0,live:0,completed:0,cancelled:0,totalRefunds:0,totalRefundAmount:0});L.useEffect(()=>{F()},[]);const F=async()=>{v(!0),await Promise.all([D(),R(),O()]),v(!1)},D=async()=>{const{data:$,error:q}=await ie.from("meets").select("*").order("scheduled_at",{ascending:!1}).limit(100);if(q){console.error("Error fetching meets:",q);return}const ee=[...new Set(($||[]).map(Oe=>Oe.creator_id))],ne=[...new Set(($||[]).map(Oe=>Oe.fan_id))],de=[...new Set(($||[]).map(Oe=>Oe.event_id))],[me,ve]=await Promise.all([ie.from("profiles").select("user_id, username, display_name").in("user_id",[...ee,...ne]),ie.from("events").select("id, title").in("id",de)]),_e=new Map((me.data||[]).map(Oe=>[Oe.user_id,Oe])),De=new Map((ve.data||[]).map(Oe=>[Oe.id,Oe])),Xe=[];for(const Oe of $||[]){const{data:ae}=await ie.from("meeting_event_logs").select("*").eq("meet_id",Oe.id).order("timestamp",{ascending:!0});Xe.push({...Oe,logs:ae||[],creator_profile:_e.get(Oe.creator_id),fan_profile:_e.get(Oe.fan_id),event:De.get(Oe.event_id)})}n(Xe),A(Oe=>({...Oe,total:Xe.length,scheduled:Xe.filter(ae=>ae.status==="scheduled").length,live:Xe.filter(ae=>ae.status==="live").length,completed:Xe.filter(ae=>ae.status==="completed").length,cancelled:Xe.filter(ae=>ae.status==="cancelled_no_show_creator"||ae.status==="cancelled").length}))},R=async()=>{const{data:$,error:q}=await ie.from("bids").select("*").eq("refund_status","refunded").order("refunded_at",{ascending:!1}).limit(50);if(q){console.error("Error fetching refunds:",q);return}const ee=[...new Set(($||[]).map(Oe=>Oe.fan_id))],ne=[...new Set(($||[]).map(Oe=>Oe.event_id))],[de,me]=await Promise.all([ie.from("profiles").select("user_id, username, display_name").in("user_id",ee),ie.from("events").select("id, title").in("id",ne)]),ve=new Map((de.data||[]).map(Oe=>[Oe.user_id,Oe])),_e=new Map((me.data||[]).map(Oe=>[Oe.id,Oe])),De=($||[]).map(Oe=>({...Oe,fan_profile:ve.get(Oe.fan_id),event:_e.get(Oe.event_id)})),Xe=De.reduce((Oe,ae)=>Oe+(ae.refund_amount||ae.amount),0);l(De),A(Oe=>({...Oe,totalRefunds:De.length,totalRefundAmount:Xe}))},O=async()=>{const{data:$,error:q}=await ie.from("meeting_event_logs").select("*").order("timestamp",{ascending:!1}).limit(200);q||f($||[])},V=$=>new Date($).toLocaleString(),G=$=>new Date($).toLocaleDateString(),J=T==="all"?s:s.filter($=>$.status===T);return g?o.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-[#C045FF] border-t-transparent rounded-full mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500",children:"Loading dashboard..."})]})}):o.jsxs("div",{className:"flex flex-col gap-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-[#212529]",children:"Meeting Lifecycle"}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Automated meeting management with auto-refunds"})]}),o.jsx(ue,{onClick:F,variant:"secondary",size:"sm",children:" Refresh"})]}),o.jsx("div",{className:"flex gap-1 p-1 bg-gray-100 rounded-lg w-fit",children:["overview","meetings","refunds","logs"].map($=>o.jsxs("button",{onClick:()=>j($),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${I===$?"bg-white text-[#C045FF] shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[$==="overview"&&"Overview",$==="meetings"&&`Meetings (${B.total})`,$==="refunds"&&`Refunds (${B.totalRefunds})`,$==="logs"&&`Logs (${u.length})`]},$))}),I==="overview"&&o.jsxs("div",{className:"grid gap-6",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[o.jsx(pe,{className:"p-5 hover:shadow-md transition-shadow",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center text-2xl",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B.total}),o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total"})]})]})}),o.jsx(pe,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-blue-500",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center text-2xl",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-blue-600",children:B.scheduled}),o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Scheduled"})]})]})}),o.jsx(pe,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-green-500",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-50 flex items-center justify-center text-2xl",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-green-600",children:B.live}),o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Live"})]})]})}),o.jsx(pe,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-gray-400",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center text-2xl",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-gray-600",children:B.completed}),o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Completed"})]})]})}),o.jsx(pe,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-red-500",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-50 flex items-center justify-center text-2xl",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-2xl font-bold text-red-600",children:B.cancelled}),o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Cancelled"})]})]})})]}),o.jsx(pe,{className:"p-6 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200",children:o.jsxs("div",{className:"flex items-start gap-4",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl bg-green-500 flex items-center justify-center text-white text-2xl flex-shrink-0",children:""}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-bold text-green-800 text-lg mb-2",children:"Automatic Payment System Active"}),o.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-green-600 mt-0.5",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-green-800",children:"Creator No-Show"}),o.jsx("p",{className:"text-green-600",children:"100% auto-refund to fan's wallet"})]})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-green-600 mt-0.5",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-green-800",children:"Meeting Completed"}),o.jsx("p",{className:"text-green-600",children:"90% auto-credited to creator (10% platform fee)"})]})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-green-600 mt-0.5",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-green-800",children:"Fan No-Show"}),o.jsx("p",{className:"text-green-600",children:"No refund - creator still gets paid on completion"})]})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-green-600 mt-0.5",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-green-800",children:"Cron Running"}),o.jsx("p",{className:"text-green-600",children:"Checks every minute for no-shows & completions"})]})]})]})]})]})}),B.totalRefunds>0&&o.jsx(pe,{className:"p-5",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-orange-100 flex items-center justify-center text-2xl",children:""}),o.jsxs("div",{children:[o.jsxs("p",{className:"font-semibold text-gray-800",children:[B.totalRefunds," Auto-Refunds Processed"]}),o.jsxs("p",{className:"text-sm text-gray-500",children:["Total: ",Ue(B.totalRefundAmount)]})]})]}),o.jsx(ue,{variant:"secondary",size:"sm",onClick:()=>j("refunds"),children:"View All "})]})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Recent Activity"}),o.jsx("div",{className:"space-y-2",children:u.slice(0,5).map($=>o.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg border hover:bg-gray-50 transition-colors",children:[o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${RR[$.event_type]||"bg-gray-100"}`,children:$.event_type.replace(/_/g," ")}),o.jsxs("span",{className:"text-sm text-gray-600 flex-1",children:[$.meet_id.slice(0,8),"..."]}),o.jsx("span",{className:"text-xs text-gray-400",children:V($.timestamp)})]},$.id))})]})]}),I==="meetings"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"flex flex-wrap gap-2",children:["all","scheduled","live","completed","cancelled_no_show_creator"].map($=>o.jsx("button",{onClick:()=>S($),className:`px-4 py-2 text-sm rounded-lg transition-all ${T===$?"bg-[#C045FF] text-white shadow-sm":"bg-white text-gray-600 border hover:border-[#C045FF] hover:text-[#C045FF]"}`,children:$==="all"?"All":$==="cancelled_no_show_creator"?"No-Show":$.charAt(0).toUpperCase()+$.slice(1)},$))}),o.jsxs("div",{className:"space-y-3",children:[J.map($=>{var q,ee,ne,de,me;return o.jsxs(pe,{className:"overflow-hidden hover:shadow-md transition-shadow",children:[o.jsx("div",{className:"p-4 cursor-pointer",onClick:()=>w(y===$.id?null:$.id),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:`w-10 h-10 rounded-full ${((q=w7[$.status])==null?void 0:q.bg)||"bg-gray-400"} flex items-center justify-center text-white text-lg`,children:((ee=w7[$.status])==null?void 0:ee.icon)||"?"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-gray-900",children:((ne=$.event)==null?void 0:ne.title)||"Untitled"}),o.jsxs("p",{className:"text-sm text-gray-500",children:[((de=$.creator_profile)==null?void 0:de.display_name)||"Creator","  ",((me=$.fan_profile)==null?void 0:me.display_name)||"Fan"]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx(Ye,{variant:$.status==="live"?"success":$.status==="completed"?"primary":$.status.includes("cancelled")?"danger":"default",children:$.status.replace(/_/g," ")}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:G($.scheduled_at)})]})]})}),y===$.id&&o.jsxs(be,{className:"bg-gray-50 border-t",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[o.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Creator Started"}),o.jsx("p",{className:"font-medium text-sm mt-1",children:$.creator_started_at?V($.creator_started_at):o.jsx("span",{className:"text-red-500",children:"Not started"})})]}),o.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fan Joined"}),o.jsx("p",{className:"font-medium text-sm mt-1",children:$.fan_joined_at?V($.fan_joined_at):o.jsx("span",{className:"text-red-500",children:"Not joined"})})]}),o.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Recording"}),o.jsx("p",{className:"font-medium text-sm mt-1",children:$.recording_started_at?o.jsx("span",{className:"text-green-600",children:" Recorded"}):o.jsx("span",{className:"text-gray-400",children:"None"})})]}),o.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Duration"}),o.jsxs("p",{className:"font-medium text-sm mt-1",children:[$.duration_minutes," min"]})]})]}),$.cancellation_reason&&o.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[o.jsxs("p",{className:"text-sm font-medium text-red-800",children:["Cancellation: ",$.cancellation_reason]}),$.refund_id&&o.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Refund ID: ",$.refund_id]})]}),o.jsxs("div",{children:[o.jsxs("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:["Event Timeline (",$.logs.length,")"]}),$.logs.length===0?o.jsx("p",{className:"text-sm text-gray-400",children:"No events yet"}):o.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:$.logs.map(ve=>o.jsxs("div",{className:"flex items-start gap-3 p-2 bg-white rounded border text-sm",children:[o.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${RR[ve.event_type]||"bg-gray-100"}`,children:ve.event_type.replace(/_/g," ")}),o.jsx("span",{className:"text-xs text-gray-400",children:V(ve.timestamp)})]},ve.id))})]})]})]},$.id)}),J.length===0&&o.jsxs(pe,{className:"p-12 text-center",children:[o.jsx("p",{className:"text-4xl mb-2",children:""}),o.jsx("p",{className:"text-gray-500",children:"No meetings found"})]})]})]}),I==="refunds"&&o.jsxs("div",{className:"space-y-4",children:[o.jsx(pe,{className:"p-5 bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-500 flex items-center justify-center text-white text-xl",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"font-bold text-green-800",children:"Auto-Refund Active"}),o.jsx("p",{className:"text-sm text-green-600",children:"Creator no-shows trigger 100% instant wallet refund to fans"})]})]})}),B.totalRefunds>0&&o.jsxs("div",{className:"flex gap-4",children:[o.jsxs(pe,{className:"flex-1 p-4",children:[o.jsx("p",{className:"text-sm text-gray-500",children:"Total Refunds"}),o.jsx("p",{className:"text-2xl font-bold text-gray-800",children:B.totalRefunds})]}),o.jsxs(pe,{className:"flex-1 p-4",children:[o.jsx("p",{className:"text-sm text-gray-500",children:"Total Amount"}),o.jsx("p",{className:"text-2xl font-bold text-green-600",children:Ue(B.totalRefundAmount)})]})]}),a.length===0?o.jsxs(pe,{className:"p-12 text-center",children:[o.jsx("p",{className:"text-4xl mb-2",children:""}),o.jsx("p",{className:"text-gray-500",children:"No refunds processed yet"}),o.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Refunds appear here when creators miss meetings"})]}):o.jsx("div",{className:"space-y-3",children:a.map($=>{var q,ee,ne;return o.jsx(pe,{className:"p-4 hover:shadow-md transition-shadow",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 text-lg",children:""}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-gray-900",children:((q=$.event)==null?void 0:q.title)||"Unknown Event"}),o.jsxs("p",{className:"text-sm text-gray-500",children:["To: ",((ee=$.fan_profile)==null?void 0:ee.display_name)||((ne=$.fan_profile)==null?void 0:ne.username)||"Fan"]}),o.jsx("p",{className:"text-xs text-gray-400",children:V($.refunded_at)})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-xl font-bold text-green-600",children:Ue($.refund_amount||$.amount)}),o.jsx(Ye,{variant:"success",children:"Auto-Refunded"})]})]})},$.id)})})]}),I==="logs"&&o.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:u.length===0?o.jsxs(pe,{className:"p-12 text-center",children:[o.jsx("p",{className:"text-4xl mb-2",children:""}),o.jsx("p",{className:"text-gray-500",children:"No logs yet"})]}):u.map($=>o.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border hover:shadow-sm transition-shadow",children:[o.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${RR[$.event_type]||"bg-gray-100"}`,children:$.event_type.replace(/_/g," ")}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[o.jsxs("span",{className:"text-gray-600",children:["Meet: ",o.jsx("code",{className:"bg-gray-100 px-1 rounded",children:$.meet_id.slice(0,8)})]}),o.jsx("span",{className:"text-gray-400",children:V($.timestamp)})]}),Object.keys($.metadata||{}).length>0&&o.jsxs("details",{className:"mt-2",children:[o.jsx("summary",{className:"text-xs text-gray-400 cursor-pointer hover:text-gray-600",children:"View metadata"}),o.jsx("pre",{className:"text-xs text-gray-600 mt-1 p-2 bg-gray-50 rounded overflow-x-auto",children:JSON.stringify($.metadata,null,2)})]})]})]},$.id))})]})}function YSe(){const{username:s}=nI(),n=Fs(),{getEventsForCreator:a}=qo(),{getProfile:l,followCreator:u,unfollowCreator:f,following:g}=KI(),{isAuthenticated:v,user:y}=mr(),[w,T]=L.useState(!1),S=(s??"").replace(/^@/,"").toLowerCase();L.useEffect(()=>{S&&T(g.includes(S))},[S,g]);const I=S?a(S):[],j=!I.length&&S?Array.from({length:5}).map((q,ee)=>{const ne=S.split(/[-_]/).filter(Boolean).map(_e=>_e.charAt(0).toUpperCase()+_e.slice(1)).join(" ")||"Creator",de=100+ee*25,me=ee%2===0?de+120:0,ve=ee%2===0?5+ee*2:0;return{id:`synthetic-${S}-${ee}`,creatorUsername:S,creatorDisplayName:ne,title:ee===0?"Meet & Greet  1:1 Fan Session":ee===1?"Premium AMA  Ask Me Anything":ee===2?"Deep Dive  Strategy Session":ee===3?"Behind the Scenes Chat":"Quick Catch-up Call",description:"A quick 1:1 session to say hi, ask a couple of questions, and take a virtual selfie together.",status:ee===0?"LIVE":"Upcoming",date:ee===0?"Today  8:00 PM IST":"This week  8:00 PM IST",duration:ee%2===0?"10 minutes":"5 minutes",basePrice:de,currentBid:me,participants:ve,endsIn:ee===0?"00:35:12 left":"Starts soon"}}):void 0,B=I.length>0?I:j??[],A=B[0],F=S?l(S):void 0,D=(F==null?void 0:F.displayName)||(A==null?void 0:A.creatorDisplayName)||"Creator",R=`@${S||"creator"}`,O=(F==null?void 0:F.bio)||(A==null?void 0:A.description)||"Host of intimate FanMeet sessions. Expect honest stories, practical advice, and space for your questions.",V=q=>{const ee=`${window.location.origin}/events/${q}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(ee).then(()=>{window.alert("Event link copied. Share it with your fans to start receiving bids.")},()=>{window.prompt("Share this event link with your fans:",ee)}):window.prompt("Share this event link with your fans:",ee)},G=!!A,J=()=>{if(!S)return;const q=`${window.location.origin}/${S}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(q).then(()=>{window.alert("Profile link copied. Share it with your fans.")},()=>{window.prompt("Share this profile link with your fans:",q)}):window.prompt("Share this profile link with your fans:",q)},$=async()=>{if(!v){window.confirm(`Please log in to follow creators.

Click OK to go to login page.`)&&n(`/auth?redirect=/${S}`);return}if((y==null?void 0:y.role)!=="fan"){window.alert(`Only fans can follow creators.

Please log in with a fan account.`);return}try{w?(await f(S),T(!1),window.alert(`Unfollowed ${(F==null?void 0:F.displayName)||S} successfully!`)):(await u(S),T(!0),window.alert(`Now following ${(F==null?void 0:F.displayName)||S}! 

You'll see their events in your feed.`))}catch(q){console.error("Error toggling follow:",q),window.alert("Something went wrong. Please try again.")}};return o.jsxs("div",{className:"flex min-h-[calc(100vh-70px)] flex-col bg-white md:bg-gradient-to-b md:from-[#FDEBFF] md:via-[#FFF] md:to-[#F0F2F5]",children:[o.jsxs("div",{className:"relative md:mx-auto md:w-full md:max-w-5xl",children:[o.jsx("div",{className:"h-40 w-full bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] md:h-48 md:rounded-b-lg"}),o.jsxs("div",{className:"absolute inset-x-0 top-0 flex items-center justify-between bg-gradient-to-b from-black/40 to-transparent px-4 py-3 text-xs font-medium text-white md:rounded-t-lg",children:[o.jsx("button",{type:"button",className:"rounded-full bg-black/30 px-3 py-1",onClick:()=>n(-1),children:" Back"}),o.jsxs("div",{className:"flex items-center gap-3 text-[11px]",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[" ",o.jsx("span",{children:"48K"})]}),o.jsxs("span",{className:"flex items-center gap-1",children:[" ",o.jsx("span",{children:"120"})]})]})]}),o.jsx("div",{className:"absolute -bottom-9 left-4 flex items-end gap-3",children:o.jsx("div",{className:"h-20 w-20 overflow-hidden rounded-full border-4 border-white bg-[#050014]",children:o.jsx("img",{src:"https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=400&q=80",alt:D,className:"h-full w-full object-cover"})})})]}),o.jsx("div",{className:"px-4 pt-12 pb-3 md:mx-auto md:w-full md:max-w-5xl md:bg-white md:shadow-sm",children:o.jsxs("div",{className:"flex items-start justify-between gap-3",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("h1",{className:"text-lg font-semibold text-[#212529]",children:D}),o.jsxs("span",{className:"text-xs text-[#6C757D]",children:[R,"  Seen 9 minutes ago"]}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:O}),G?o.jsxs("span",{className:"mt-1 text-[11px] font-medium uppercase tracking-wide text-[#C045FF]",children:[B.length," active events"]}):null]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ue,{variant:"secondary",size:"sm",className:"rounded-full px-3 py-1 text-xs",onClick:J,children:"Share profile"}),o.jsx(ue,{size:"sm",className:"rounded-full px-3 py-1 text-xs",variant:w?"primary":"secondary",onClick:$,children:w?" Following":"Follow"})]})]})}),o.jsx("div",{className:"flex-1 px-4 py-4 md:mx-auto md:w-full md:max-w-5xl md:bg-[#F6EBFF]/70 md:rounded-b-xl",children:o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-[#6C757D]",children:"Upcoming events"}),B.map(q=>o.jsx(pe,{elevated:!0,className:"border-none",children:o.jsxs(be,{className:"gap-3",children:[o.jsxs("div",{className:"flex items-center justify-between text-[11px] text-[#6C757D]",children:[o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[q.status==="Accepting Bids"?o.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:o.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):o.jsx(Ye,{variant:q.status==="LIVE"?"danger":"primary",children:q.status==="LIVE"?" LIVE":q.status}),o.jsx("span",{children:q.date}),o.jsxs("span",{children:[" ",q.duration]})]}),o.jsx("button",{type:"button",className:"rounded-full bg-[#F8F9FA] px-3 py-1 font-medium text-[#C045FF]",onClick:()=>V(q.id),children:"Share"})]}),o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:q.title}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:q.description})]}),o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-[11px] text-[#6C757D]",children:[o.jsxs("span",{children:["Base ",Ue(q.basePrice)]}),o.jsxs("span",{children:["Highest bid"," ",q.currentBid?Ue(q.currentBid):"No bids yet"]}),o.jsxs("span",{children:[" ",q.participants," participants"]})]}),o.jsx("div",{className:"mt-2 flex gap-2",children:o.jsx(ue,{size:"sm",className:"flex-1 rounded-full",onClick:()=>n(`/events/${q.id}`),children:"View & bid"})})]})},q.id)),B.length===0&&o.jsx(pe,{children:o.jsx(be,{children:o.jsx("p",{className:"text-sm text-[#6C757D]",children:"This creator has not set up any bidding events yet. Check back soon for upcoming sessions."})})})]})})})]})}const $H="https://iktldcrkyphkvxjwmxyb.supabase.co",$Se=()=>new Promise(s=>{if(window.Razorpay){s(!0);return}const n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>s(!0),n.onerror=()=>s(!1),document.body.appendChild(n)}),XSe=async s=>{const{data:{session:n}}=await ie.auth.getSession();if(!n)throw new Error("Please log in to continue.");const a=await fetch(`${$H}/functions/v1/razorpay-create-order`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({amount:s.amount})});if(!a.ok){const l=await a.json();throw new Error(l.error||"Failed to create order.")}return await a.json()},JSe=async s=>{const{data:{session:n}}=await ie.auth.getSession();if(!n)throw new Error("Please log in to continue.");const a=await fetch(`${$H}/functions/v1/razorpay-verify-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify(s)});if(!a.ok){const l=await a.json();throw new Error(l.error||"Payment verification failed.")}return await a.json()},QSe=s=>{const n={key:s.keyId,amount:s.amount*100,currency:"INR",name:"FanMeet",description:s.description||"Payment",order_id:s.orderId,handler:s.onSuccess,prefill:{email:s.userEmail||""},theme:{color:"#C045FF"},modal:{ondismiss:s.onDismiss||(()=>{})}};new window.Razorpay(n).open()};function ZSe(){const{eventId:s}=nI(),n=Fs(),{isAuthenticated:a,user:l}=mr(),{events:u,placeBid:f,isLoading:g,getBidHistory:v,bidHistory:y,getUserCurrentBidForEvent:w}=qo(),{getProfile:T}=KI();let S=u.find(q=>q.id===s);if(!S&&s&&s.startsWith("synthetic-")){const q=s.replace(/^synthetic-/,""),ee=q.lastIndexOf("-");if(ee>0){const ne=q.slice(0,ee),de=q.slice(ee+1),me=Number(de);if(ne&&Number.isFinite(me)){const ve=ne.split(/[-_]/).filter(Boolean).map(Oe=>Oe.charAt(0).toUpperCase()+Oe.slice(1)).join(" ")||"Creator",_e=100+me*25,De=me%2===0?_e+120:0,Xe=me%2===0?5+me*2:0;S={id:s,creatorUsername:ne,creatorDisplayName:ve,title:me===0?"Meet & Greet  1:1 Fan Session":me===1?"Premium AMA  Ask Me Anything":me===2?"Deep Dive  Strategy Session":me===3?"Behind the Scenes Chat":"Quick Catch-up Call",description:"A quick 1:1 session to say hi, ask a couple of questions, and take a virtual selfie together.",status:me===0?"LIVE":"Upcoming",date:me===0?"Today  8:00 PM IST":"This week  8:00 PM IST",duration:me%2===0?"10 minutes":"5 minutes",basePrice:_e,currentBid:De,participants:Xe,endsIn:me===0?"00:35:12 left":"Starts soon"}}}}const[I,j]=L.useState(""),[B,A]=L.useState(!1),[F,D]=L.useState(!1),R=S?T(S.creatorUsername):void 0,O=S?w(S.id):0,V=Number(I)||0,G=O+V;if(L.useEffect(()=>{S!=null&&S.id&&!S.id.startsWith("synthetic-")&&v(S.id)},[S==null?void 0:S.id]),g)return o.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-4 px-4 py-8",children:o.jsx(pe,{elevated:!0,children:o.jsxs(be,{className:"gap-4 p-8 text-center",children:[o.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:"Loading event..."}),o.jsx("p",{className:"text-sm text-[#6C757D]",children:"Please wait while we fetch the event details."})]})})});if(!S)return o.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-4 px-4 py-8",children:o.jsxs(pe,{elevated:!0,children:[o.jsx(Ne,{title:"Event not found",subtitle:"This event may have expired or been removed."}),o.jsxs(be,{className:"gap-4",children:[o.jsx("p",{className:"text-sm text-[#6C757D]",children:"If you followed an older link, ask the creator for their latest event or visit their profile for current sessions."}),o.jsxs("div",{className:"flex flex-wrap gap-3",children:[o.jsx(ue,{variant:"secondary",onClick:()=>n(-1),children:"Go back"}),o.jsx(ue,{onClick:()=>n("/"),children:"Go to homepage"})]})]})]})});const J=()=>{const q=`${window.location.origin}/events/${S.id}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(q).then(()=>{window.alert("Event link copied. Share it with your fans to start receiving bids.")},()=>{window.prompt("Share this event link with your fans:",q)}):window.prompt("Share this event link with your fans:",q)},$=async()=>{const q=O>0?G:Number(I);if(!q||Number.isNaN(q)){window.alert("Enter a valid bid amount to continue.");return}if(q<=S.currentBid){window.alert(`Your bid must be higher than the current bid of ${Ue(S.currentBid)}.`);return}if(!a||(l==null?void 0:l.role)!=="fan"){A(!0);return}D(!0);try{if(!await $Se())throw new Error("Failed to load payment gateway");const{orderId:ne,keyId:de}=await XSe({amount:q,userId:l.id,userEmail:l.email});QSe({amount:q,orderId:ne,keyId:de,userEmail:l.email,description:`Bid of ${Ue(q)} for ${S.title}`,onSuccess:async me=>{try{await JSe(me),await f(S.id,q),window.alert(` Payment successful! Bid of ${Ue(q)} placed!

You'll be notified if someone outbids you.

 If you don't win, 90% will be auto-refunded.`),j("")}catch(ve){console.error("Error after payment:",ve),window.alert("Payment received but bid placement failed. Please contact support.")}finally{D(!1)}},onDismiss:()=>{D(!1)}})}catch(ee){console.error("Bid error:",ee),window.alert("Failed to initiate payment. Please try again."),D(!1)}};return o.jsxs("div",{className:"mx-auto flex min-h-[calc(100vh-70px)] max-w-3xl flex-col bg-white pb-6",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"h-40 w-full bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] md:h-48"}),o.jsxs("div",{className:"absolute inset-x-0 top-0 flex items-center justify-between bg-gradient-to-b from-black/40 to-transparent px-4 py-3 text-xs font-medium text-white",children:[o.jsx("button",{type:"button",className:"rounded-full bg-black/30 px-3 py-1",onClick:()=>n(-1),children:" Back"}),o.jsxs("div",{className:"flex flex-col items-end gap-1 text-right",children:[o.jsx("span",{className:"text-[11px] uppercase tracking-wide text-white/80",children:"Bidding event"}),o.jsx("span",{className:"text-sm font-semibold",children:S.title})]})]})]}),o.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-4 pt-4",children:[o.jsx(pe,{elevated:!0,className:"border-none",children:o.jsxs(be,{className:"gap-4",children:[o.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[o.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group",onClick:()=>n(`/${S.creatorUsername}`),children:[o.jsx("div",{className:"relative flex-shrink-0",children:R!=null&&R.profilePhotoUrl?o.jsx("img",{src:R.profilePhotoUrl,alt:S.creatorDisplayName,className:"h-16 w-16 rounded-full object-cover ring-2 ring-[#C045FF]/20 group-hover:ring-[#C045FF]/40 transition-all"}):o.jsx("div",{className:"h-16 w-16 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-xl ring-2 ring-[#C045FF]/20 group-hover:ring-[#C045FF]/40 transition-all",children:S.creatorDisplayName.charAt(0).toUpperCase()})}),o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Hosted by"}),o.jsx("span",{className:"text-sm font-semibold text-[#212529] group-hover:text-[#C045FF] transition-colors",children:S.creatorDisplayName}),o.jsxs("span",{className:"text-xs text-[#C045FF] underline decoration-dotted group-hover:decoration-solid transition-all",children:["@",S.creatorUsername]}),o.jsx("span",{className:"text-[10px] text-[#6C757D] mt-0.5 group-hover:text-[#C045FF] transition-colors",children:" Click to view profile"})]})]}),o.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-[#6C757D]",children:[o.jsxs("span",{className:"rounded-full bg-[#F8F9FA] px-3 py-1",children:[" ",S.participants," participants"]}),o.jsxs("span",{className:"rounded-full bg-[#F8F9FA] px-3 py-1",children:[" ",S.duration]})]})]}),o.jsxs("div",{className:"grid gap-3 text-xs text-[#6C757D] md:grid-cols-2",children:[o.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-3",children:[o.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide",children:"Schedule"}),o.jsx("div",{className:"mt-1 text-sm text-[#212529]",children:S.date})]}),o.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-3",children:[o.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide",children:"Status"}),o.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-[#212529]",children:[S.status==="Accepting Bids"?o.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-3 py-1.5",children:o.jsx("span",{className:"text-sm font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):o.jsx(Ye,{variant:S.status==="LIVE"?"danger":"primary",children:S.status==="LIVE"?" LIVE":S.status}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:S.endsIn})]})]})]})]})}),S.description?o.jsxs(pe,{children:[o.jsx(Ne,{title:"About this event"}),o.jsxs(be,{className:"gap-3",children:[o.jsx("p",{className:"text-sm text-[#495057]",children:S.description}),o.jsx("p",{className:"text-xs text-[#6C757D]",children:"This is a demo environment. In a real product, this section would outline the exact flow of the experience, how long the interaction lasts, and any preparation required before joining."})]})]}):null,y.length>0&&o.jsxs(pe,{children:[o.jsx(Ne,{title:"Recent Bids",subtitle:"Live bidding activity"}),o.jsx(be,{className:"gap-3",children:y.map(q=>o.jsxs("div",{className:`flex items-center justify-between p-3 rounded-[12px] ${q.isCurrentLeader?"bg-[#C045FF]/10 border border-[#C045FF]/30":"bg-[#F8F9FA]"}`,children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsxs("span",{className:"text-sm font-semibold text-[#212529]",children:["@",q.fanUsername]}),o.jsx("span",{className:"text-xs text-[#6C757D]",children:new Date(q.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),o.jsxs("div",{className:"flex flex-col items-end gap-1",children:[o.jsx("span",{className:"text-lg font-semibold text-[#C045FF]",children:Ue(q.amount)}),q.isCurrentLeader&&o.jsx("span",{className:"text-[10px] font-semibold text-[#C045FF] bg-white px-2 py-0.5 rounded-full",children:" Leading"})]})]},q.id))})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"What you'll get"}),o.jsxs(be,{className:"gap-3 text-sm text-[#495057]",children:[o.jsxs("ul",{className:"space-y-1 text-xs text-[#495057]",children:[o.jsx("li",{children:" A 1:1 micro-meet with the creator with room for your questions."}),o.jsx("li",{children:" Optional screenshot / selfie moment at the end of the call."}),o.jsx("li",{children:" Priority chat placement during the live session."})]}),o.jsx("p",{className:"text-[11px] text-[#6C757D]",children:"Exact perks are for demo only and can be customised per creator event."})]})]}),o.jsxs(pe,{children:[o.jsx(Ne,{title:"Small print"}),o.jsxs(be,{className:"gap-2 text-[11px] text-[#6C757D]",children:[o.jsx("p",{children:"Bids placed in this sandbox are not real payments. In production, only the top bidders would be charged after the auction window ends."}),o.jsx("p",{children:"By placing a bid you agree to follow community guidelines and respect the creator's time and boundaries."})]})]}),o.jsx(pe,{elevated:!0,className:"sticky bottom-0 border-none shadow-[0_-8px_24px_rgba(15,23,42,0.12)] md:static md:shadow-none",children:o.jsxs(be,{className:"gap-4",children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-[#6C757D]",children:"Current highest bid"}),o.jsx("span",{className:"text-xl font-semibold text-[#C045FF]",children:S.currentBid?Ue(S.currentBid):Ue(S.basePrice)}),o.jsxs("span",{className:"text-[11px] text-[#6C757D]",children:["Base price ",Ue(S.basePrice),"  ",S.participants," participants"]})]}),o.jsx(ue,{variant:"secondary",size:"sm",className:"rounded-full text-xs",onClick:J,children:"Share event link"})]}),o.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx(nt,{type:"number",label:O>0?"Add to your bid":"Your bid amount",placeholder:String(S.basePrice),value:I,onChange:q=>j(q.target.value)}),V>0&&o.jsx("div",{className:"mt-2 text-sm",children:O>0?o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsxs("span",{className:"text-[#6C757D]",children:["Your current bid: ",o.jsx("strong",{className:"text-[#212529]",children:Ue(O)})]}),o.jsxs("span",{className:"text-[#C045FF] font-semibold",children:["Adding ",Ue(V),"  New total: ",Ue(G)]})]}):o.jsxs("span",{className:"text-[#C045FF] font-semibold",children:["Your bid: ",Ue(V)]})})]}),o.jsx(ue,{className:"md:w-40",onClick:$,disabled:F,children:F?"Processing...":"Place Bid "})]})]})})]}),B&&o.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4",children:o.jsxs("div",{className:"max-w-sm flex-1 rounded-2xl bg-white p-6 shadow-2xl",children:[o.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:"Login to place your bid"}),o.jsx("p",{className:"mt-2 text-sm text-[#6C757D]",children:"You'll need a fan account to place bids and join this meet. We'll take you to the login page and bring you back here after you're done."}),o.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[o.jsx(ue,{onClick:()=>n(`/auth?redirect=/events/${S.id}`),className:"w-full",children:"Continue to login / signup"}),o.jsx(ue,{variant:"secondary",className:"w-full",onClick:()=>A(!1),children:"Cancel"})]})]})})]})}/**
 * @license agora-rtc-react
 * @version 2.5.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var e0e=Object.create,qI=Object.defineProperty,t0e=Object.getOwnPropertyDescriptor,r0e=Object.getOwnPropertyNames,s0e=Object.getPrototypeOf,n0e=Object.prototype.hasOwnProperty,i0e=(s,n)=>()=>(n||s((n={exports:{}}).exports,n),n.exports),a0e=(s,n)=>{for(var a in n)qI(s,a,{get:n[a],enumerable:!0})},XH=(s,n,a,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of r0e(n))!n0e.call(s,u)&&u!==a&&qI(s,u,{get:()=>n[u],enumerable:!(l=t0e(n,u))||l.enumerable});return s},o0e=(s,n,a)=>(XH(s,n,"default"),a),pu=(s,n,a)=>(a=s!=null?e0e(s0e(s)):{},XH(!s||!s.__esModule?qI(a,"default",{value:s,enumerable:!0}):a,s)),fu=i0e((s,n)=>{(function(a,l){typeof s=="object"&&typeof n<"u"?n.exports=l():typeof define=="function"&&define.amd?define(l):(a=typeof globalThis<"u"?globalThis:a||self).AgoraRTC=l()})(s,function(){function a(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(i){if(i!=="default"&&!(i in e)){var c=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,c.get?c:{enumerable:!0,get:function(){return r[i]}})}})}),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f=function(e){try{return!!e()}catch{return!0}},g=!f(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),v=g,y=Function.prototype,w=y.call,T=v&&y.bind.bind(w,w),S=v?T:function(e){return function(){return w.apply(e,arguments)}},I=S({}.isPrototypeOf),j=function(e){return e&&e.Math===Math&&e},B=j(typeof globalThis=="object"&&globalThis)||j(typeof window=="object"&&window)||j(typeof self=="object"&&self)||j(typeof l=="object"&&l)||j(typeof l=="object"&&l)||function(){return this}()||Function("return this")(),A=g,F=Function.prototype,D=F.apply,R=F.call,O=typeof Reflect=="object"&&Reflect.apply||(A?R.bind(D):function(){return R.apply(D,arguments)}),V=S,G=V({}.toString),J=V("".slice),$=function(e){return J(G(e),8,-1)},q=$,ee=S,ne=function(e){if(q(e)==="Function")return ee(e)},de=typeof document=="object"&&document.all,me=de===void 0&&de!==void 0?function(e){return typeof e=="function"||e===de}:function(e){return typeof e=="function"},ve={},_e=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),De=g,Xe=Function.prototype.call,Oe=De?Xe.bind(Xe):function(){return Xe.apply(Xe,arguments)},ae={},Ee={}.propertyIsEnumerable,Le=Object.getOwnPropertyDescriptor,Ke=Le&&!Ee.call({1:2},1);ae.f=Ke?function(e){var t=Le(this,e);return!!t&&t.enumerable}:Ee;var He,gt,yt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},It=f,Ct=$,et=Object,We=S("".split),Ze=It(function(){return!et("z").propertyIsEnumerable(0)})?function(e){return Ct(e)==="String"?We(e,""):et(e)}:et,ye=function(e){return e==null},Pe=ye,$e=TypeError,kt=function(e){if(Pe(e))throw new $e("Can't call method on "+e);return e},Kt=Ze,Ht=kt,ft=function(e){return Kt(Ht(e))},dr=me,jt=function(e){return typeof e=="object"?e!==null:dr(e)},Pr={},Xn=Pr,Yo=B,lo=me,Qs=function(e){return lo(e)?e:void 0},xs=function(e,t){return arguments.length<2?Qs(Xn[e])||Qs(Yo[e]):Xn[e]&&Xn[e][t]||Yo[e]&&Yo[e][t]},uo=B.navigator,Kl=uo&&uo.userAgent,ln=Kl?String(Kl):"",ur=B,Ir=ln,En=ur.process,hr=ur.Deno,Wi=En&&En.versions||hr&&hr.version,_u=Wi&&Wi.v8;_u&&(gt=(He=_u.split("."))[0]>0&&He[0]<4?1:+(He[0]+He[1])),!gt&&Ir&&(!(He=Ir.match(/Edge\/(\d+)/))||He[1]>=74)&&(He=Ir.match(/Chrome\/(\d+)/))&&(gt=+He[1]);var Ta=gt,Eu=Ta,vb=f,zs=B.String,Jn=!!Object.getOwnPropertySymbols&&!vb(function(){var e=Symbol("symbol detection");return!zs(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Eu&&Eu<41}),Ra=Jn&&!Symbol.sham&&typeof Symbol.iterator=="symbol",bz=xs,wz=me,Sz=I,Cz=Object,Jp=Ra?function(e){return typeof e=="symbol"}:function(e){var t=bz("Symbol");return wz(t)&&Sz(t.prototype,Cz(e))},Tz=String,vu=function(e){try{return Tz(e)}catch{return"Object"}},Rz=me,Nz=vu,Az=TypeError,Qn=function(e){if(Rz(e))return e;throw new Az(Nz(e)+" is not a function")},Iz=Qn,Oz=ye,r_=function(e,t){var r=e[t];return Oz(r)?void 0:Iz(r)},ZI=Oe,eO=me,tO=jt,Dz=TypeError,rO={exports:{}},sO=B,Pz=Object.defineProperty,kz=B,jz=function(e,t){try{Pz(sO,e,{value:t,configurable:!0,writable:!0})}catch{sO[e]=t}return t},nO="__core-js_shared__",iO=rO.exports=kz[nO]||jz(nO,{});(iO.versions||(iO.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var yb=rO.exports,aO=yb,yu=function(e,t){return aO[e]||(aO[e]=t||{})},Lz=kt,Mz=Object,ho=function(e){return Mz(Lz(e))},Fz=ho,Uz=S({}.hasOwnProperty),Us=Object.hasOwn||function(e,t){return Uz(Fz(e),t)},Vz=S,Bz=0,Wz=Math.random(),Gz=Vz(1 .toString),xb=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Gz(++Bz+Wz,36)},Hz=yu,oO=Us,zz=xb,Kz=Jn,qz=Ra,xu=B.Symbol,bb=Hz("wks"),Yz=qz?xu.for||xu:xu&&xu.withoutSetter||zz,Kr=function(e){return oO(bb,e)||(bb[e]=Kz&&oO(xu,e)?xu[e]:Yz("Symbol."+e)),bb[e]},$z=Oe,cO=jt,lO=Jp,Xz=r_,Jz=function(e,t){var r,i;if(eO(r=e.toString)&&!tO(i=ZI(r,e))||eO(r=e.valueOf)&&!tO(i=ZI(r,e))||t!=="string")return i;throw new Dz("Can't convert object to primitive value")},Qz=TypeError,Zz=Kr("toPrimitive"),eK=function(e,t){if(!cO(e)||lO(e))return e;var r,i=Xz(e,Zz);if(i){if(r=$z(i,e,t),!cO(r)||lO(r))return r;throw new Qz("Can't convert object to primitive value")}return Jz(e,t)},tK=Jp,wb=function(e){var t=eK(e,"string");return tK(t)?t:t+""},dO=jt,Sb=B.document,rK=dO(Sb)&&dO(Sb.createElement),Cb=function(e){return rK?Sb.createElement(e):{}},sK=Cb,uO=!_e&&!f(function(){return Object.defineProperty(sK("div"),"a",{get:function(){return 7}}).a!==7}),nK=_e,iK=Oe,aK=ae,oK=yt,cK=ft,lK=wb,dK=Us,uK=uO,hO=Object.getOwnPropertyDescriptor;ve.f=nK?hO:function(e,t){if(e=cK(e),t=lK(t),uK)try{return hO(e,t)}catch{}if(dK(e,t))return oK(!iK(aK.f,e,t),e[t])};var hK=f,pK=me,fK=/#|\.prototype\./,Qp=function(e,t){var r=gK[mK(e)];return r===EK||r!==_K&&(pK(t)?hK(t):!!t)},mK=Qp.normalize=function(e){return String(e).replace(fK,".").toLowerCase()},gK=Qp.data={},_K=Qp.NATIVE="N",EK=Qp.POLYFILL="P",pO=Qp,vK=Qn,yK=g,xK=ne(ne.bind),Rc=function(e,t){return vK(e),t===void 0?e:yK?xK(e,t):function(){return e.apply(t,arguments)}},Gi={},fO=_e&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),bK=jt,wK=String,SK=TypeError,jn=function(e){if(bK(e))return e;throw new SK(wK(e)+" is not an object")},CK=_e,TK=uO,RK=fO,s_=jn,mO=wb,NK=TypeError,Tb=Object.defineProperty,AK=Object.getOwnPropertyDescriptor,Rb="enumerable",Nb="configurable",Ab="writable";Gi.f=CK?RK?function(e,t,r){if(s_(e),t=mO(t),s_(r),typeof e=="function"&&t==="prototype"&&"value"in r&&Ab in r&&!r[Ab]){var i=AK(e,t);i&&i[Ab]&&(e[t]=r.value,r={configurable:Nb in r?r[Nb]:i[Nb],enumerable:Rb in r?r[Rb]:i[Rb],writable:!1})}return Tb(e,t,r)}:Tb:function(e,t,r){if(s_(e),t=mO(t),s_(r),TK)try{return Tb(e,t,r)}catch{}if("get"in r||"set"in r)throw new NK("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var IK=Gi,OK=yt,ql=_e?function(e,t,r){return IK.f(e,t,OK(1,r))}:function(e,t,r){return e[t]=r,e},Zp=B,DK=O,PK=ne,kK=me,jK=ve.f,LK=pO,bu=Pr,MK=Rc,wu=ql,gO=Us,FK=function(e){var t=function(r,i,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,c)}return DK(e,this,arguments)};return t.prototype=e.prototype,t},qt=function(e,t){var r,i,c,d,h,p,m,_,E,x=e.target,b=e.global,C=e.stat,U=e.proto,k=b?Zp:C?Zp[x]:Zp[x]&&Zp[x].prototype,M=b?bu:bu[x]||wu(bu,x,{})[x],H=M.prototype;for(d in t)i=!(r=LK(b?d:x+(C?".":"#")+d,e.forced))&&k&&gO(k,d),p=M[d],i&&(m=e.dontCallGetSet?(E=jK(k,d))&&E.value:k[d]),h=i&&m?m:t[d],(r||U||typeof p!=typeof h)&&(_=e.bind&&i?MK(h,Zp):e.wrap&&i?FK(h):U&&kK(h)?PK(h):h,(e.sham||h&&h.sham||p&&p.sham)&&wu(_,"sham",!0),wu(M,d,_),U&&(gO(bu,c=x+"Prototype")||wu(bu,c,{}),wu(bu[c],d,h),e.real&&H&&(r||!H[d])&&wu(H,d,h)))},UK=Math.ceil,VK=Math.floor,BK=Math.trunc||function(e){var t=+e;return(t>0?VK:UK)(t)},WK=BK,Ib=function(e){var t=+e;return t!=t||t===0?0:WK(t)},GK=Ib,HK=Math.max,zK=Math.min,Ob=function(e,t){var r=GK(e);return r<0?HK(r+t,0):zK(r,t)},KK=Ib,qK=Math.min,_O=function(e){var t=KK(e);return t>0?qK(t,9007199254740991):0},YK=_O,Nc=function(e){return YK(e.length)},$K=ft,XK=Ob,JK=Nc,EO=function(e){return function(t,r,i){var c=$K(t),d=JK(c);if(d===0)return!e&&-1;var h,p=XK(i,d);if(e&&r!=r){for(;d>p;)if((h=c[p++])!=h)return!0}else for(;d>p;p++)if((e||p in c)&&c[p]===r)return e||p||0;return!e&&-1}},Db={includes:EO(!0),indexOf:EO(!1)},QK=Db.includes;qt({target:"Array",proto:!0,forced:f(function(){return!Array(1).includes()})},{includes:function(e){return QK(this,e,arguments.length>1?arguments[1]:void 0)}});var ZK=B,eq=Pr,Hi=function(e,t){var r=eq[e+"Prototype"],i=r&&r[t];if(i)return i;var c=ZK[e],d=c&&c.prototype;return d&&d[t]},tq=Hi("Array","includes"),rq=jt,sq=$,nq=Kr("match"),vO=function(e){var t;return rq(e)&&((t=e[nq])!==void 0?!!t:sq(e)==="RegExp")},iq=vO,aq=TypeError,yO={};yO[Kr("toStringTag")]="z";var Pb=String(yO)==="[object z]",oq=Pb,cq=me,n_=$,lq=Kr("toStringTag"),dq=Object,uq=n_(function(){return arguments}())==="Arguments",Ac=oq?n_:function(e){var t,r,i;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(c,d){try{return c[d]}catch{}}(t=dq(e),lq))=="string"?r:uq?n_(t):(i=n_(t))==="Object"&&cq(t.callee)?"Arguments":i},hq=Ac,pq=String,Zn=function(e){if(hq(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return pq(e)},fq=Kr("match"),mq=qt,gq=function(e){if(iq(e))throw new aq("The method doesn't accept regular expressions");return e},_q=kt,xO=Zn,Eq=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[fq]=!1,"/./"[e](t)}catch{}}return!1},vq=S("".indexOf);mq({target:"String",proto:!0,forced:!Eq("includes")},{includes:function(e){return!!~vq(xO(_q(this)),xO(gq(e)),arguments.length>1?arguments[1]:void 0)}});var yq=Hi("String","includes"),bO=I,xq=tq,bq=yq,kb=Array.prototype,jb=String.prototype,wq=function(e){var t=e.includes;return e===kb||bO(kb,e)&&t===kb.includes?xq:typeof e=="string"||e===jb||bO(jb,e)&&t===jb.includes?bq:t},Ae=u(wq),Sq=Qn,Cq=ho,Tq=Ze,Rq=Nc,wO=TypeError,SO="Reduce of empty array with no initial value",Nq=function(e){return function(t,r,i,c){var d=Cq(t),h=Tq(d),p=Rq(d);if(Sq(r),p===0&&i<2)throw new wO(SO);var m=0,_=1;if(i<2)for(;;){if(m in h){c=h[m],m+=_;break}if(m+=_,p<=m)throw new wO(SO)}for(;p>m;m+=_)m in h&&(c=r(c,h[m],m,d));return c}},Aq={left:Nq()},Iq=f,i_=function(e,t){var r=[][e];return!!r&&Iq(function(){r.call(null,t||function(){return 1},1)})},ef=B,Oq=ln,Dq=$,a_=function(e){return Oq.slice(0,e.length)===e},Lb=a_("Bun/")?"BUN":a_("Cloudflare-Workers")?"CLOUDFLARE":a_("Deno/")?"DENO":a_("Node.js/")?"NODE":ef.Bun&&typeof Bun.version=="string"?"BUN":ef.Deno&&typeof Deno.version=="object"?"DENO":Dq(ef.process)==="process"?"NODE":ef.window&&ef.document?"BROWSER":"REST",o_=Lb==="NODE",Pq=Aq.left;qt({target:"Array",proto:!0,forced:!o_&&Ta>79&&Ta<83||!i_("reduce")},{reduce:function(e){var t=arguments.length;return Pq(this,e,t,t>1?arguments[1]:void 0)}});var kq=Hi("Array","reduce"),jq=I,Lq=kq,Mb=Array.prototype,Mq=function(e){var t=e.reduce;return e===Mb||jq(Mb,e)&&t===Mb.reduce?Lq:t},CO=Mq,zi=u(CO),Fq=$,tf=Array.isArray||function(e){return Fq(e)==="Array"},Uq=qt,Vq=tf,Bq=S([].reverse),TO=[1,2];Uq({target:"Array",proto:!0,forced:String(TO)===String(TO.reverse())},{reverse:function(){return Vq(this)&&(this.length=this.length),Bq(this)}});var Wq=Hi("Array","reverse"),Gq=I,Hq=Wq,Fb=Array.prototype,zq=function(e){var t=e.reverse;return e===Fb||Gq(Fb,e)&&t===Fb.reverse?Hq:t},RO=zq,NO=u(RO),Kq=xb,AO=yu("keys"),c_=function(e){return AO[e]||(AO[e]=Kq(e))},qq=!f(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Yq=Us,$q=me,Xq=ho,Jq=qq,IO=c_("IE_PROTO"),Ub=Object,Qq=Ub.prototype,Vb=Jq?Ub.getPrototypeOf:function(e){var t=Xq(e);if(Yq(t,IO))return t[IO];var r=t.constructor;return $q(r)&&t instanceof r?r.prototype:t instanceof Ub?Qq:null},Zq=S,eY=Qn,tY=jt,rY=function(e){return tY(e)||e===null},sY=String,nY=TypeError,iY=function(e,t,r){try{return Zq(eY(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},aY=jt,oY=kt,cY=function(e){if(rY(e))return e;throw new nY("Can't set "+sY(e)+" as a prototype")},lY=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=iY(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(i,c){return oY(i),cY(c),aY(i)&&(t?e(i,c):i.__proto__=c),i}}():void 0),l_={},d_={},Bb=Us,dY=ft,uY=Db.indexOf,hY=d_,OO=S([].push),DO=function(e,t){var r,i=dY(e),c=0,d=[];for(r in i)!Bb(hY,r)&&Bb(i,r)&&OO(d,r);for(;t.length>c;)Bb(i,r=t[c++])&&(~uY(d,r)||OO(d,r));return d},Wb=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],pY=DO,fY=Wb.concat("length","prototype");l_.f=Object.getOwnPropertyNames||function(e){return pY(e,fY)};var rf={};rf.f=Object.getOwnPropertySymbols;var mY=xs,gY=l_,_Y=rf,EY=jn,vY=S([].concat),yY=mY("Reflect","ownKeys")||function(e){var t=gY.f(EY(e)),r=_Y.f;return r?vY(t,r(e)):t},PO=Us,xY=yY,bY=ve,wY=Gi,Gb={},SY=DO,CY=Wb,u_=Object.keys||function(e){return SY(e,CY)},TY=_e,RY=fO,NY=Gi,AY=jn,IY=ft,OY=u_;Gb.f=TY&&!RY?Object.defineProperties:function(e,t){AY(e);for(var r,i=IY(t),c=OY(t),d=c.length,h=0;d>h;)NY.f(e,r=c[h++],i[r]);return e};var h_,kO=xs("document","documentElement"),DY=jn,PY=Gb,jO=Wb,kY=d_,jY=kO,LY=Cb,Hb="prototype",zb="script",LO=c_("IE_PROTO"),Kb=function(){},MO=function(e){return"<"+zb+">"+e+"</"+zb+">"},FO=function(e){e.write(MO("")),e.close();var t=e.parentWindow.Object;return e=null,t},p_=function(){try{h_=new ActiveXObject("htmlfile")}catch{}var e,t,r;p_=typeof document<"u"?document.domain&&h_?FO(h_):(t=LY("iframe"),r="java"+zb+":",t.style.display="none",jY.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(MO("document.F=Object")),e.close(),e.F):FO(h_);for(var i=jO.length;i--;)delete p_[Hb][jO[i]];return p_()};kY[LO]=!0;var sf=Object.create||function(e,t){var r;return e!==null?(Kb[Hb]=DY(e),r=new Kb,Kb[Hb]=null,r[LO]=e):r=p_(),t===void 0?r:PY.f(r,t)},MY=jt,FY=ql,UO=Error,UY=S("".replace),VY=String(new UO("zxcasd").stack),VO=/\n\s*at [^:]*:[^\n]*/,BY=VO.test(VY),WY=yt,GY=!f(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",WY(1,7)),e.stack!==7)}),HY=ql,zY=function(e,t){if(BY&&typeof e=="string"&&!UO.prepareStackTrace)for(;t--;)e=UY(e,VO,"");return e},KY=GY,BO=Error.captureStackTrace,Su={},qY=Su,YY=Kr("iterator"),$Y=Array.prototype,WO=function(e){return e!==void 0&&(qY.Array===e||$Y[YY]===e)},XY=Ac,GO=r_,JY=ye,QY=Su,ZY=Kr("iterator"),f_=function(e){if(!JY(e))return GO(e,ZY)||GO(e,"@@iterator")||QY[XY(e)]},e$=Oe,t$=Qn,r$=jn,s$=vu,n$=f_,i$=TypeError,qb=function(e,t){var r=arguments.length<2?n$(e):t;if(t$(r))return r$(e$(r,e));throw new i$(s$(e)+" is not iterable")},a$=Oe,HO=jn,o$=r_,zO=function(e,t,r){var i,c;HO(e);try{if(!(i=o$(e,"return"))){if(t==="throw")throw r;return r}i=a$(i,e)}catch(d){c=!0,i=d}if(t==="throw")throw r;if(c)throw i;return HO(i),r},c$=Rc,l$=Oe,d$=jn,u$=vu,h$=WO,p$=Nc,KO=I,f$=qb,m$=f_,qO=zO,g$=TypeError,m_=function(e,t){this.stopped=e,this.result=t},YO=m_.prototype,nf=function(e,t,r){var i,c,d,h,p,m,_,E=r&&r.that,x=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_RECORD),C=!(!r||!r.IS_ITERATOR),U=!(!r||!r.INTERRUPTED),k=c$(t,E),M=function(K){return i&&qO(i,"normal",K),new m_(!0,K)},H=function(K){return x?(d$(K),U?k(K[0],K[1],M):k(K[0],K[1])):U?k(K,M):k(K)};if(b)i=e.iterator;else if(C)i=e;else{if(!(c=m$(e)))throw new g$(u$(e)+" is not iterable");if(h$(c)){for(d=0,h=p$(e);h>d;d++)if((p=H(e[d]))&&KO(YO,p))return p;return new m_(!1)}i=f$(e,c)}for(m=b?e.next:i.next;!(_=l$(m,i)).done;){try{p=H(_.value)}catch(K){qO(i,"throw",K)}if(typeof p=="object"&&p&&KO(YO,p))return p}return new m_(!1)},_$=Zn,E$=qt,v$=I,y$=Vb,g_=lY,x$=function(e,t,r){for(var i=xY(t),c=wY.f,d=bY.f,h=0;h<i.length;h++){var p=i[h];PO(e,p)||r&&PO(r,p)||c(e,p,d(t,p))}},$O=sf,Yb=ql,$b=yt,b$=function(e,t){MY(t)&&"cause"in t&&FY(e,"cause",t.cause)},w$=function(e,t,r,i){KY&&(BO?BO(e,t):HY(e,"stack",zY(r,i)))},S$=nf,C$=function(e,t){return e===void 0?arguments.length<2?"":t:_$(e)},T$=Kr("toStringTag"),__=Error,R$=[].push,Cu=function(e,t){var r,i=v$(Xb,this);g_?r=g_(new __,i?y$(this):Xb):(r=i?this:$O(Xb),Yb(r,T$,"Error")),t!==void 0&&Yb(r,"message",C$(t)),w$(r,Cu,r.stack,1),arguments.length>2&&b$(r,arguments[2]);var c=[];return S$(e,R$,{that:c}),Yb(r,"errors",c),r};g_?g_(Cu,__):x$(Cu,__,{name:!0});var Xb=Cu.prototype=$O(__.prototype,{constructor:$b(1,Cu),message:$b(1,""),name:$b(1,"AggregateError")});E$({global:!0},{AggregateError:Cu});var E_,af,v_,N$=me,XO=B.WeakMap,A$=N$(XO)&&/native code/.test(String(XO)),JO=B,I$=jt,O$=ql,Jb=Us,Qb=yb,D$=c_,P$=d_,QO="Object already initialized",Zb=JO.TypeError,k$=JO.WeakMap;if(A$||Qb.state){var po=Qb.state||(Qb.state=new k$);po.get=po.get,po.has=po.has,po.set=po.set,E_=function(e,t){if(po.has(e))throw new Zb(QO);return t.facade=e,po.set(e,t),t},af=function(e){return po.get(e)||{}},v_=function(e){return po.has(e)}}else{var Tu=D$("state");P$[Tu]=!0,E_=function(e,t){if(Jb(e,Tu))throw new Zb(QO);return t.facade=e,O$(e,Tu,t),t},af=function(e){return Jb(e,Tu)?e[Tu]:{}},v_=function(e){return Jb(e,Tu)}}var Yl,ZO,eD,$l={set:E_,get:af,has:v_,enforce:function(e){return v_(e)?af(e):E_(e,{})},getterFor:function(e){return function(t){var r;if(!I$(t)||(r=af(t)).type!==e)throw new Zb("Incompatible receiver, "+e+" required");return r}}},ew=_e,j$=Us,tD=Function.prototype,L$=ew&&Object.getOwnPropertyDescriptor,rD=j$(tD,"name"),sD={PROPER:rD&&(function(){}).name==="something",CONFIGURABLE:rD&&(!ew||ew&&L$(tD,"name").configurable)},M$=ql,Ic=function(e,t,r,i){return i&&i.enumerable?e[t]=r:M$(e,t,r),e},F$=f,U$=me,V$=jt,B$=sf,nD=Vb,W$=Ic,tw=Kr("iterator"),iD=!1;[].keys&&("next"in(eD=[].keys())?(ZO=nD(nD(eD)))!==Object.prototype&&(Yl=ZO):iD=!0);var G$=!V$(Yl)||F$(function(){var e={};return Yl[tw].call(e)!==e});U$((Yl=G$?{}:B$(Yl))[tw])||W$(Yl,tw,function(){return this});var aD={IteratorPrototype:Yl,BUGGY_SAFARI_ITERATORS:iD},H$=Ac,z$=Pb?{}.toString:function(){return"[object "+H$(this)+"]"},K$=Pb,q$=Gi.f,Y$=ql,$$=Us,X$=z$,oD=Kr("toStringTag"),$o=function(e,t,r,i){var c=r?e:e&&e.prototype;c&&($$(c,oD)||q$(c,oD,{configurable:!0,value:t}),i&&!K$&&Y$(c,"toString",X$))},J$=aD.IteratorPrototype,Q$=sf,Z$=yt,eX=$o,tX=Su,rX=function(){return this},rw=function(e,t,r,i){var c=t+" Iterator";return e.prototype=Q$(J$,{next:Z$(+!i,r)}),eX(e,c,!1,!0),tX[c]=rX,e},sX=qt,nX=Oe,iX=sD,aX=rw,oX=Vb,cX=$o,cD=Ic,lD=Su,lX=aD,dX=iX.PROPER,y_=lX.BUGGY_SAFARI_ITERATORS,sw=Kr("iterator"),dD="keys",x_="values",uD="entries",uX=function(){return this},hD=function(e,t,r,i,c,d,h){aX(r,t,i);var p,m,_,E=function(H){if(H===c&&k)return k;if(!y_&&H&&H in C)return C[H];switch(H){case dD:case x_:case uD:return function(){return new r(this,H)}}return function(){return new r(this)}},x=t+" Iterator",b=!1,C=e.prototype,U=C[sw]||C["@@iterator"]||c&&C[c],k=!y_&&U||E(c),M=t==="Array"&&C.entries||U;if(M&&(p=oX(M.call(new e)))!==Object.prototype&&p.next&&(cX(p,x,!0,!0),lD[x]=uX),dX&&c===x_&&U&&U.name!==x_&&(b=!0,k=function(){return nX(U,this)}),c)if(m={values:E(x_),keys:d?k:E(dD),entries:E(uD)},h)for(_ in m)(y_||b||!(_ in C))&&cD(C,_,m[_]);else sX({target:t,proto:!0,forced:y_||b},m);return h&&C[sw]!==k&&cD(C,sw,k,{}),lD[t]=k,m},b_=function(e,t){return{value:e,done:t}},hX=ft,pD=Su,fD=$l;Gi.f;var pX=hD,w_=b_,mD="Array Iterator",fX=fD.set,mX=fD.getterFor(mD);pX(Array,"Array",function(e,t){fX(this,{type:mD,target:hX(e),index:0,kind:t})},function(){var e=mX(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,w_(void 0,!0);switch(e.kind){case"keys":return w_(r,!1);case"values":return w_(t[r],!1)}return w_([r,t[r]],!1)},"values"),pD.Arguments=pD.Array;var gX=Gi,S_=function(e,t,r){return gX.f(e,t,r)},_X=xs,EX=S_,vX=_e,gD=Kr("species"),yX=I,xX=TypeError,nw=function(e,t){if(yX(t,e))return e;throw new xX("Incorrect invocation")},bX=me,iw=yb,wX=S(Function.toString);bX(iw.inspectSource)||(iw.inspectSource=function(e){return wX(e)});var _D=iw.inspectSource,SX=S,CX=f,ED=me,TX=Ac,RX=_D,vD=function(){},yD=xs("Reflect","construct"),aw=/^\s*(?:class|function)\b/,NX=SX(aw.exec),AX=!aw.test(vD),of=function(e){if(!ED(e))return!1;try{return yD(vD,[],e),!0}catch{return!1}},xD=function(e){if(!ED(e))return!1;switch(TX(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return AX||!!NX(aw,RX(e))}catch{return!0}};xD.sham=!0;var cf,Ru,bD,ow,C_=!yD||CX(function(){var e;return of(of.call)||!of(Object)||!of(function(){e=!0})||e})?xD:of,IX=C_,OX=vu,DX=TypeError,wD=jn,PX=function(e){if(IX(e))return e;throw new DX(OX(e)+" is not a constructor")},kX=ye,jX=Kr("species"),cw=function(e,t){var r,i=wD(e).constructor;return i===void 0||kX(r=wD(i)[jX])?t:PX(r)},Oc=S([].slice),LX=TypeError,Xl=function(e,t){if(e<t)throw new LX("Not enough arguments");return e},SD=/(?:ipad|iphone|ipod).*applewebkit/i.test(ln),yi=B,MX=O,FX=Rc,CD=me,UX=Us,TD=f,RD=kO,VX=Oc,ND=Cb,BX=Xl,WX=SD,GX=o_,lw=yi.setImmediate,dw=yi.clearImmediate,HX=yi.process,uw=yi.Dispatch,zX=yi.Function,AD=yi.MessageChannel,KX=yi.String,hw=0,lf={},ID="onreadystatechange";TD(function(){cf=yi.location});var pw=function(e){if(UX(lf,e)){var t=lf[e];delete lf[e],t()}},fw=function(e){return function(){pw(e)}},OD=function(e){pw(e.data)},DD=function(e){yi.postMessage(KX(e),cf.protocol+"//"+cf.host)};lw&&dw||(lw=function(e){BX(arguments.length,1);var t=CD(e)?e:zX(e),r=VX(arguments,1);return lf[++hw]=function(){MX(t,void 0,r)},Ru(hw),hw},dw=function(e){delete lf[e]},GX?Ru=function(e){HX.nextTick(fw(e))}:uw&&uw.now?Ru=function(e){uw.now(fw(e))}:AD&&!WX?(ow=(bD=new AD).port2,bD.port1.onmessage=OD,Ru=FX(ow.postMessage,ow)):yi.addEventListener&&CD(yi.postMessage)&&!yi.importScripts&&cf&&cf.protocol!=="file:"&&!TD(DD)?(Ru=DD,yi.addEventListener("message",OD,!1)):Ru=ID in ND("script")?function(e){RD.appendChild(ND("script"))[ID]=function(){RD.removeChild(this),pw(e)}}:function(e){setTimeout(fw(e),0)});var T_={set:lw,clear:dw},PD=B,qX=_e,YX=Object.getOwnPropertyDescriptor,kD=function(e){if(!qX)return PD[e];var t=YX(PD,e);return t&&t.value},jD=function(){this.head=null,this.tail=null};jD.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Nu,mw,gw,_w,LD,MD=jD,$X=/ipad|iphone|ipod/i.test(ln)&&typeof Pebble<"u",XX=/web0s(?!.*chrome)/i.test(ln),Au=B,JX=kD,FD=Rc,Ew=T_.set,QX=MD,ZX=SD,eJ=$X,tJ=XX,vw=o_,UD=Au.MutationObserver||Au.WebKitMutationObserver,VD=Au.document,BD=Au.process,R_=Au.Promise,yw=JX("queueMicrotask");if(!yw){var N_=new QX,A_=function(){var e,t;for(vw&&(e=BD.domain)&&e.exit();t=N_.get();)try{t()}catch(r){throw N_.head&&Nu(),r}e&&e.enter()};ZX||vw||tJ||!UD||!VD?!eJ&&R_&&R_.resolve?((_w=R_.resolve(void 0)).constructor=R_,LD=FD(_w.then,_w),Nu=function(){LD(A_)}):vw?Nu=function(){BD.nextTick(A_)}:(Ew=FD(Ew,Au),Nu=function(){Ew(A_)}):(mw=!0,gw=VD.createTextNode(""),new UD(A_).observe(gw,{characterData:!0}),Nu=function(){gw.data=mw=!mw}),yw=function(e){N_.head||Nu(),N_.add(e)}}var WD=yw,Iu=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Jl=B.Promise,rJ=B,df=Jl,sJ=me,nJ=pO,iJ=_D,aJ=Kr,GD=Lb,xw=Ta,HD=df&&df.prototype,oJ=aJ("species"),zD=sJ(rJ.PromiseRejectionEvent),cJ=nJ("Promise",function(){var e=iJ(df),t=e!==String(df);if(!t&&xw===66||!HD.catch||!HD.finally)return!0;if(!xw||xw<51||!/native code/.test(e)){var r=new df(function(c){c(1)}),i=function(c){c(function(){},function(){})};if((r.constructor={})[oJ]=i,!(r.then(function(){})instanceof i))return!0}return!(t||GD!=="BROWSER"&&GD!=="DENO"||zD)}),uf={CONSTRUCTOR:cJ,REJECTION_EVENT:zD},fo={},KD=Qn,lJ=TypeError,dJ=function(e){var t,r;this.promise=new e(function(i,c){if(t!==void 0||r!==void 0)throw new lJ("Bad Promise constructor");t=i,r=c}),this.resolve=KD(t),this.reject=KD(r)};fo.f=function(e){return new dJ(e)};var bw,qD,uJ=qt,I_=o_,Dc=B,hf=Oe,hJ=Ic,pJ=$o,fJ=function(e){var t=_X(e);vX&&t&&!t[gD]&&EX(t,gD,{configurable:!0,get:function(){return this}})},mJ=Qn,ww=me,gJ=jt,_J=nw,EJ=cw,YD=T_.set,Sw=WD,vJ=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},yJ=Iu,xJ=MD,$D=$l,Cw=Jl,XD=uf,JD=fo,O_="Promise",QD=XD.CONSTRUCTOR,bJ=XD.REJECTION_EVENT,Tw=$D.getterFor(O_),wJ=$D.set,SJ=Cw&&Cw.prototype,pf=Cw,Rw=SJ,ZD=Dc.TypeError,Nw=Dc.document,Aw=Dc.process,Iw=JD.f,CJ=Iw,TJ=!!(Nw&&Nw.createEvent&&Dc.dispatchEvent),eP="unhandledrejection",tP=function(e){var t;return!(!gJ(e)||!ww(t=e.then))&&t},rP=function(e,t){var r,i,c,d=t.value,h=t.state===1,p=h?e.ok:e.fail,m=e.resolve,_=e.reject,E=e.domain;try{p?(h||(t.rejection===2&&NJ(t),t.rejection=1),p===!0?r=d:(E&&E.enter(),r=p(d),E&&(E.exit(),c=!0)),r===e.promise?_(new ZD("Promise-chain cycle")):(i=tP(r))?hf(i,r,m,_):m(r)):_(d)}catch(x){E&&!c&&E.exit(),_(x)}},sP=function(e,t){e.notified||(e.notified=!0,Sw(function(){for(var r,i=e.reactions;r=i.get();)rP(r,e);e.notified=!1,t&&!e.rejection&&RJ(e)}))},nP=function(e,t,r){var i,c;TJ?((i=Nw.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),Dc.dispatchEvent(i)):i={promise:t,reason:r},!bJ&&(c=Dc["on"+e])?c(i):e===eP&&vJ("Unhandled promise rejection",r)},RJ=function(e){hf(YD,Dc,function(){var t,r=e.facade,i=e.value;if(iP(e)&&(t=yJ(function(){I_?Aw.emit("unhandledRejection",i,r):nP(eP,r,i)}),e.rejection=I_||iP(e)?2:1,t.error))throw t.value})},iP=function(e){return e.rejection!==1&&!e.parent},NJ=function(e){hf(YD,Dc,function(){var t=e.facade;I_?Aw.emit("rejectionHandled",t):nP("rejectionhandled",t,e.value)})},Ou=function(e,t,r){return function(i){e(t,i,r)}},Du=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,sP(e,!0))},Ow=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new ZD("Promise can't be resolved itself");var i=tP(t);i?Sw(function(){var c={done:!1};try{hf(i,t,Ou(Ow,c,e),Ou(Du,c,e))}catch(d){Du(c,d,e)}}):(e.value=t,e.state=1,sP(e,!1))}catch(c){Du({done:!1},c,e)}}};QD&&(Rw=(pf=function(e){_J(this,Rw),mJ(e),hf(bw,this);var t=Tw(this);try{e(Ou(Ow,t),Ou(Du,t))}catch(r){Du(t,r)}}).prototype,(bw=function(e){wJ(this,{type:O_,done:!1,notified:!1,parent:!1,reactions:new xJ,rejection:!1,state:0,value:null})}).prototype=hJ(Rw,"then",function(e,t){var r=Tw(this),i=Iw(EJ(this,pf));return r.parent=!0,i.ok=!ww(e)||e,i.fail=ww(t)&&t,i.domain=I_?Aw.domain:void 0,r.state===0?r.reactions.add(i):Sw(function(){rP(i,r)}),i.promise}),qD=function(){var e=new bw,t=Tw(e);this.promise=e,this.resolve=Ou(Ow,t),this.reject=Ou(Du,t)},JD.f=Iw=function(e){return e===pf||e===void 0?new qD(e):CJ(e)}),uJ({global:!0,wrap:!0,forced:QD},{Promise:pf}),pJ(pf,O_,!1,!0),fJ(O_);var aP=Kr("iterator"),oP=!1;try{var AJ=0,cP={next:function(){return{done:!!AJ++}},return:function(){oP=!0}};cP[aP]=function(){return this},Array.from(cP,function(){throw 2})}catch{}var IJ=Jl,OJ=function(e,t){try{if(!t&&!oP)return!1}catch{return!1}var r=!1;try{var i={};i[aP]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch{}return r},D_=uf.CONSTRUCTOR||!OJ(function(e){IJ.all(e).then(void 0,function(){})}),DJ=Oe,PJ=Qn,kJ=fo,jJ=Iu,LJ=nf;qt({target:"Promise",stat:!0,forced:D_},{all:function(e){var t=this,r=kJ.f(t),i=r.resolve,c=r.reject,d=jJ(function(){var h=PJ(t.resolve),p=[],m=0,_=1;LJ(e,function(E){var x=m++,b=!1;_++,DJ(h,t,E).then(function(C){b||(b=!0,p[x]=C,--_||i(p))},c)}),--_||i(p)});return d.error&&c(d.value),r.promise}});var MJ=qt,FJ=uf.CONSTRUCTOR;Jl&&Jl.prototype,MJ({target:"Promise",proto:!0,forced:FJ,real:!0},{catch:function(e){return this.then(void 0,e)}});var UJ=Oe,VJ=Qn,BJ=fo,WJ=Iu,GJ=nf;qt({target:"Promise",stat:!0,forced:D_},{race:function(e){var t=this,r=BJ.f(t),i=r.reject,c=WJ(function(){var d=VJ(t.resolve);GJ(e,function(h){UJ(d,t,h).then(r.resolve,i)})});return c.error&&i(c.value),r.promise}});var HJ=fo;qt({target:"Promise",stat:!0,forced:uf.CONSTRUCTOR},{reject:function(e){var t=HJ.f(this);return(0,t.reject)(e),t.promise}});var zJ=jn,KJ=jt,qJ=fo,lP=function(e,t){if(zJ(e),KJ(t)&&t.constructor===e)return t;var r=qJ.f(e);return(0,r.resolve)(t),r.promise},YJ=qt,$J=Jl,XJ=uf.CONSTRUCTOR,JJ=lP,QJ=xs("Promise"),ZJ=!XJ;YJ({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return JJ(ZJ&&this===QJ?$J:this,e)}});var eQ=Oe,tQ=Qn,rQ=fo,sQ=Iu,nQ=nf;qt({target:"Promise",stat:!0,forced:D_},{allSettled:function(e){var t=this,r=rQ.f(t),i=r.resolve,c=r.reject,d=sQ(function(){var h=tQ(t.resolve),p=[],m=0,_=1;nQ(e,function(E){var x=m++,b=!1;_++,eQ(h,t,E).then(function(C){b||(b=!0,p[x]={status:"fulfilled",value:C},--_||i(p))},function(C){b||(b=!0,p[x]={status:"rejected",reason:C},--_||i(p))})}),--_||i(p)});return d.error&&c(d.value),r.promise}});var iQ=Oe,aQ=Qn,oQ=xs,cQ=fo,lQ=Iu,dQ=nf,dP="No one promise resolved";qt({target:"Promise",stat:!0,forced:D_},{any:function(e){var t=this,r=oQ("AggregateError"),i=cQ.f(t),c=i.resolve,d=i.reject,h=lQ(function(){var p=aQ(t.resolve),m=[],_=0,E=1,x=!1;dQ(e,function(b){var C=_++,U=!1;E++,iQ(p,t,b).then(function(k){U||x||(x=!0,c(k))},function(k){U||x||(U=!0,m[C]=k,--E||d(new r(m,dP)))})}),--E||d(new r(m,dP))});return h.error&&d(h.value),i.promise}});var uQ=qt,hQ=O,pQ=Oc,fQ=fo,mQ=Qn,uP=Iu,Dw=B.Promise,hP=!1;uQ({target:"Promise",stat:!0,forced:!Dw||!Dw.try||uP(function(){Dw.try(function(e){hP=e===8},8)}).error||!hP},{try:function(e){var t=arguments.length>1?pQ(arguments,1):[],r=fQ.f(this),i=uP(function(){return hQ(mQ(e),void 0,t)});return(i.error?r.reject:r.resolve)(i.value),r.promise}});var gQ=fo;qt({target:"Promise",stat:!0},{withResolvers:function(){var e=gQ.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var _Q=qt,Pw=Jl,EQ=f,vQ=xs,yQ=me,xQ=cw,pP=lP,bQ=Pw&&Pw.prototype;_Q({target:"Promise",proto:!0,real:!0,forced:!!Pw&&EQ(function(){bQ.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=xQ(this,vQ("Promise")),r=yQ(e);return this.then(r?function(i){return pP(t,e()).then(function(){return i})}:e,r?function(i){return pP(t,e()).then(function(){throw i})}:e)}});var kw=S,wQ=Ib,SQ=Zn,CQ=kt,TQ=kw("".charAt),fP=kw("".charCodeAt),RQ=kw("".slice),mP=function(e){return function(t,r){var i,c,d=SQ(CQ(t)),h=wQ(r),p=d.length;return h<0||h>=p?e?"":void 0:(i=fP(d,h))<55296||i>56319||h+1===p||(c=fP(d,h+1))<56320||c>57343?e?TQ(d,h):i:e?RQ(d,h,h+2):c-56320+(i-55296<<10)+65536}},jw={codeAt:mP(!1),charAt:mP(!0)},NQ=jw.charAt,AQ=Zn,gP=$l,IQ=hD,_P=b_,EP="String Iterator",OQ=gP.set,DQ=gP.getterFor(EP);IQ(String,"String",function(e){OQ(this,{type:EP,string:AQ(e),index:0})},function(){var e,t=DQ(this),r=t.string,i=t.index;return i>=r.length?_P(void 0,!0):(e=NQ(r,i),t.index+=e.length,_P(e,!1))});var PQ=Pr.Promise,kQ={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},jQ=B,LQ=$o,vP=Su;for(var Lw in kQ)LQ(jQ[Lw],Lw),vP[Lw]=vP.Array;var yP=PQ,je=u(yP),MQ=Hi("Array","values"),FQ=Ac,UQ=Us,VQ=I,BQ=MQ,Mw=Array.prototype,WQ={DOMTokenList:!0,NodeList:!0},GQ=function(e){var t=e.values;return e===Mw||VQ(Mw,e)&&t===Mw.values||UQ(WQ,FQ(e))?BQ:t},Ln=u(GQ),xP=vu,HQ=TypeError,bP=Oc,zQ=Math.floor,Fw=function(e,t){var r=e.length;if(r<8)for(var i,c,d=1;d<r;){for(c=d,i=e[d];c&&t(e[c-1],i)>0;)e[c]=e[--c];c!==d++&&(e[c]=i)}else for(var h=zQ(r/2),p=Fw(bP(e,0,h),t),m=Fw(bP(e,h),t),_=p.length,E=m.length,x=0,b=0;x<_||b<E;)e[x+b]=x<_&&b<E?t(p[x],m[b])<=0?p[x++]:m[b++]:x<_?p[x++]:m[b++];return e},wP=Fw,SP=ln.match(/firefox\/(\d+)/i),KQ=!!SP&&+SP[1],qQ=/MSIE|Trident/.test(ln),CP=ln.match(/AppleWebKit\/(\d+)\./),YQ=!!CP&&+CP[1],$Q=qt,TP=S,XQ=Qn,JQ=ho,RP=Nc,QQ=function(e,t){if(!delete e[t])throw new HQ("Cannot delete property "+xP(t)+" of "+xP(e))},NP=Zn,Uw=f,ZQ=wP,eZ=i_,AP=KQ,tZ=qQ,IP=Ta,OP=YQ,Pc=[],DP=TP(Pc.sort),rZ=TP(Pc.push),sZ=Uw(function(){Pc.sort(void 0)}),nZ=Uw(function(){Pc.sort(null)}),iZ=eZ("sort"),PP=!Uw(function(){if(IP)return IP<70;if(!(AP&&AP>3)){if(tZ)return!0;if(OP)return OP<603;var e,t,r,i,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)Pc.push({k:t+i,v:r})}for(Pc.sort(function(d,h){return h.v-d.v}),i=0;i<Pc.length;i++)t=Pc[i].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}});$Q({target:"Array",proto:!0,forced:sZ||!nZ||!iZ||!PP},{sort:function(e){e!==void 0&&XQ(e);var t=JQ(this);if(PP)return e===void 0?DP(t):DP(t,e);var r,i,c=[],d=RP(t);for(i=0;i<d;i++)i in t&&rZ(c,t[i]);for(ZQ(c,function(h){return function(p,m){return m===void 0?-1:p===void 0?1:h!==void 0?+h(p,m)||0:NP(p)>NP(m)?1:-1}}(e)),r=RP(c),i=0;i<r;)t[i]=c[i++];for(;i<d;)QQ(t,i++);return t}});var aZ=Hi("Array","sort"),oZ=I,cZ=aZ,Vw=Array.prototype,lZ=function(e){var t=e.sort;return e===Vw||oZ(Vw,e)&&t===Vw.sort?cZ:t},Ql=u(lZ),dZ=qt,uZ=S,hZ=Ob,pZ=RangeError,kP=String.fromCharCode,jP=String.fromCodePoint,fZ=uZ([].join);dZ({target:"String",stat:!0,forced:!!jP&&jP.length!==1},{fromCodePoint:function(e){for(var t,r=[],i=arguments.length,c=0;i>c;){if(t=+arguments[c++],hZ(t,1114111)!==t)throw new pZ(t+" is not a valid code point");r[c]=t<65536?kP(t):kP(55296+((t-=65536)>>10),t%1024+56320)}return fZ(r,"")}});var mZ=f,gZ=Kr("iterator"),P_=!mZ(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(c,d){t.delete("b"),i+=d+c}),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[gZ]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),_Z=Ic,Bw=qt,LP=B,Ww=kD,EZ=xs,k_=Oe,Na=S,ff=_e,MP=P_,FP=Ic,vZ=S_,yZ=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:_Z(e,i,t[i],r);return e},xZ=$o,bZ=rw,Gw=$l,UP=nw,Hw=me,wZ=Us,SZ=Rc,CZ=Ac,TZ=jn,VP=jt,Mn=Zn,RZ=sf,BP=yt,WP=qb,NZ=f_,j_=b_,Pu=Xl,AZ=wP,IZ=Kr("iterator"),ku="URLSearchParams",GP=ku+"Iterator",HP=Gw.set,Ki=Gw.getterFor(ku),OZ=Gw.getterFor(GP),zP=Ww("fetch"),L_=Ww("Request"),mf=Ww("Headers"),zw=L_&&L_.prototype,KP=mf&&mf.prototype,DZ=LP.TypeError,PZ=LP.encodeURIComponent,kZ=String.fromCharCode,jZ=EZ("String","fromCodePoint"),LZ=parseInt,M_=Na("".charAt),qP=Na([].join),kc=Na([].push),YP=Na("".replace),MZ=Na([].shift),$P=Na([].splice),XP=Na("".split),JP=Na("".slice),FZ=Na(/./.exec),UZ=/\+/g,VZ=/^[0-9a-f]+$/i,QP=function(e,t){var r=JP(e,t,t+2);return FZ(VZ,r)?LZ(r,16):NaN},BZ=function(e){for(var t=0,r=128;r>0&&e&r;r>>=1)t++;return t},WZ=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},ZP=function(e){for(var t=(e=YP(e,UZ," ")).length,r="",i=0;i<t;){var c=M_(e,i);if(c==="%"){if(M_(e,i+1)==="%"||i+3>t){r+="%",i++;continue}var d=QP(e,i+1);if(d!=d){r+=c,i++;continue}i+=2;var h=BZ(d);if(h===0)c=kZ(d);else{if(h===1||h>4){r+="",i++;continue}for(var p=[d],m=1;m<h&&!(++i+3>t||M_(e,i)!=="%");){var _=QP(e,i+1);if(_!=_){i+=3;break}if(_>191||_<128)break;kc(p,_),i+=2,m++}if(p.length!==h){r+="";continue}var E=WZ(p);E===null?r+="":c=jZ(E)}}r+=c,i++}return r},GZ=/[!'()~]|%20/g,HZ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zZ=function(e){return HZ[e]},ek=function(e){return YP(PZ(e),GZ,zZ)},Kw=bZ(function(e,t){HP(this,{type:GP,target:Ki(e).entries,index:0,kind:t})},ku,function(){var e=OZ(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,j_(void 0,!0);var i=t[r];switch(e.kind){case"keys":return j_(i.key,!1);case"values":return j_(i.value,!1)}return j_([i.key,i.value],!1)},!0),tk=function(e){this.entries=[],this.url=null,e!==void 0&&(VP(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?M_(e,0)==="?"?JP(e,1):e:Mn(e)))};tk.prototype={type:ku,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,i,c,d,h,p,m=this.entries,_=NZ(e);if(_)for(r=(t=WP(e,_)).next;!(i=k_(r,t)).done;){if(d=(c=WP(TZ(i.value))).next,(h=k_(d,c)).done||(p=k_(d,c)).done||!k_(d,c).done)throw new DZ("Expected sequence with length 2");kc(m,{key:Mn(h.value),value:Mn(p.value)})}else for(var E in e)wZ(e,E)&&kc(m,{key:E,value:Mn(e[E])})},parseQuery:function(e){if(e)for(var t,r,i=this.entries,c=XP(e,"&"),d=0;d<c.length;)(t=c[d++]).length&&(r=XP(t,"="),kc(i,{key:ZP(MZ(r)),value:ZP(qP(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],i=0;i<t.length;)e=t[i++],kc(r,ek(e.key)+"="+ek(e.value));return qP(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var F_=function(){UP(this,ju);var e=HP(this,new tk(arguments.length>0?arguments[0]:void 0));ff||(this.size=e.entries.length)},ju=F_.prototype;if(yZ(ju,{append:function(e,t){var r=Ki(this);Pu(arguments.length,2),kc(r.entries,{key:Mn(e),value:Mn(t)}),ff||this.length++,r.updateURL()},delete:function(e){for(var t=Ki(this),r=Pu(arguments.length,1),i=t.entries,c=Mn(e),d=r<2?void 0:arguments[1],h=d===void 0?d:Mn(d),p=0;p<i.length;){var m=i[p];if(m.key!==c||h!==void 0&&m.value!==h)p++;else if($P(i,p,1),h!==void 0)break}ff||(this.size=i.length),t.updateURL()},get:function(e){var t=Ki(this).entries;Pu(arguments.length,1);for(var r=Mn(e),i=0;i<t.length;i++)if(t[i].key===r)return t[i].value;return null},getAll:function(e){var t=Ki(this).entries;Pu(arguments.length,1);for(var r=Mn(e),i=[],c=0;c<t.length;c++)t[c].key===r&&kc(i,t[c].value);return i},has:function(e){for(var t=Ki(this).entries,r=Pu(arguments.length,1),i=Mn(e),c=r<2?void 0:arguments[1],d=c===void 0?c:Mn(c),h=0;h<t.length;){var p=t[h++];if(p.key===i&&(d===void 0||p.value===d))return!0}return!1},set:function(e,t){var r=Ki(this);Pu(arguments.length,1);for(var i,c=r.entries,d=!1,h=Mn(e),p=Mn(t),m=0;m<c.length;m++)(i=c[m]).key===h&&(d?$P(c,m--,1):(d=!0,i.value=p));d||kc(c,{key:h,value:p}),ff||(this.size=c.length),r.updateURL()},sort:function(){var e=Ki(this);AZ(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=Ki(this).entries,i=SZ(e,arguments.length>1?arguments[1]:void 0),c=0;c<r.length;)i((t=r[c++]).value,t.key,this)},keys:function(){return new Kw(this,"keys")},values:function(){return new Kw(this,"values")},entries:function(){return new Kw(this,"entries")}},{enumerable:!0}),FP(ju,IZ,ju.entries,{}),FP(ju,"toString",function(){return Ki(this).serialize()},{enumerable:!0}),ff&&vZ(ju,"size",{get:function(){return Ki(this).entries.length},configurable:!0,enumerable:!0}),xZ(F_,ku),Bw({global:!0,forced:!MP},{URLSearchParams:F_}),!MP&&Hw(mf)){var KZ=Na(KP.has),qZ=Na(KP.set),rk=function(e){if(VP(e)){var t,r=e.body;if(CZ(r)===ku)return t=e.headers?new mf(e.headers):new mf,KZ(t,"content-type")||qZ(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),RZ(e,{body:BP(0,Mn(r)),headers:BP(0,t)})}return e};if(Hw(zP)&&Bw({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return zP(e,arguments.length>1?rk(arguments[1]):{})}}),Hw(L_)){var qw=function(e){return UP(this,zw),new L_(e,arguments.length>1?rk(arguments[1]):{})};zw.constructor=qw,qw.prototype=zw,Bw({global:!0,dontCallGetSet:!0,forced:!0},{Request:qw})}}var qi,YZ={URLSearchParams:F_,getState:Ki},$Z=Pr.URLSearchParams,sk=_e,XZ=S,JZ=Oe,QZ=f,Yw=u_,ZZ=rf,eee=ae,tee=ho,ree=Ze,Lu=Object.assign,nk=Object.defineProperty,see=XZ([].concat),nee=!Lu||QZ(function(){if(sk&&Lu({b:1},Lu(nk({},"a",{enumerable:!0,get:function(){nk(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(c){t[c]=c}),Lu({},e)[r]!==7||Yw(Lu({},t)).join("")!==i})?function(e,t){for(var r=tee(e),i=arguments.length,c=1,d=ZZ.f,h=eee.f;i>c;)for(var p,m=ree(arguments[c++]),_=d?see(Yw(m),d(m)):Yw(m),E=_.length,x=0;E>x;)p=_[x++],sk&&!JZ(h,m,p)||(r[p]=m[p]);return r}:Lu,iee=jn,aee=zO,oee=_e,cee=Gi,lee=yt,$w=function(e,t,r){oee?cee.f(e,t,lee(0,r)):e[t]=r},dee=Rc,uee=Oe,hee=ho,pee=function(e,t,r,i){try{return i?t(iee(r)[0],r[1]):t(r)}catch(c){aee(e,"throw",c)}},fee=WO,mee=C_,gee=Nc,ik=$w,_ee=qb,Eee=f_,ak=Array,Zl=S,Xw=2147483647,vee=/[^\0-\u007E]/,ok=/[.\u3002\uFF0E\uFF61]/g,ck="Overflow: input needs wider integers to process",lk=RangeError,yee=Zl(ok.exec),Mu=Math.floor,Jw=String.fromCharCode,dk=Zl("".charCodeAt),uk=Zl([].join),jc=Zl([].push),xee=Zl("".replace),bee=Zl("".split),wee=Zl("".toLowerCase),hk=function(e){return e+22+75*(e<26)},See=function(e,t,r){var i=0;for(e=r?Mu(e/700):e>>1,e+=Mu(e/t);e>455;)e=Mu(e/35),i+=36;return Mu(i+36*e/(e+38))},Cee=function(e){var t=[];e=function(H){for(var K=[],X=0,se=H.length;X<se;){var te=dk(H,X++);if(te>=55296&&te<=56319&&X<se){var Z=dk(H,X++);(64512&Z)==56320?jc(K,((1023&te)<<10)+(1023&Z)+65536):(jc(K,te),X--)}else jc(K,te)}return K}(e);var r,i,c=e.length,d=128,h=0,p=72;for(r=0;r<e.length;r++)(i=e[r])<128&&jc(t,Jw(i));var m=t.length,_=m;for(m&&jc(t,"-");_<c;){var E=Xw;for(r=0;r<e.length;r++)(i=e[r])>=d&&i<E&&(E=i);var x=_+1;if(E-d>Mu((Xw-h)/x))throw new lk(ck);for(h+=(E-d)*x,d=E,r=0;r<e.length;r++){if((i=e[r])<d&&++h>Xw)throw new lk(ck);if(i===d){for(var b=h,C=36;;){var U=C<=p?1:C>=p+26?26:C-p;if(b<U)break;var k=b-U,M=36-U;jc(t,Jw(hk(U+k%M))),b=Mu(k/M),C+=36}jc(t,Jw(hk(b))),p=See(h,x,_===m),h=0,_++}}h++,d++}return uk(t,"")},Tee=qt,Qw=_e,Ree=P_,Zw=B,pk=Rc,Yi=S,U_=Ic,$i=S_,Nee=nw,eS=Us,tS=nee,Fu=function(e){var t=hee(e),r=mee(this),i=arguments.length,c=i>1?arguments[1]:void 0,d=c!==void 0;d&&(c=dee(c,i>2?arguments[2]:void 0));var h,p,m,_,E,x,b=Eee(t),C=0;if(!b||this===ak&&fee(b))for(h=gee(t),p=r?new this(h):ak(h);h>C;C++)x=d?c(t[C],C):t[C],ik(p,C,x);else for(p=r?new this:[],E=(_=_ee(t,b)).next;!(m=uee(E,_)).done;C++)x=d?pee(_,c,[m.value,C],!0):m.value,ik(p,C,x);return p.length=C,p},Aa=Oc,Aee=jw.codeAt,Iee=function(e){var t,r,i=[],c=bee(xee(wee(e),ok,"."),".");for(t=0;t<c.length;t++)r=c[t],jc(i,yee(vee,r)?"xn--"+Cee(r):r);return uk(i,".")},Xo=Zn,Oee=$o,Dee=Xl,fk=YZ,mk=$l,Pee=mk.set,V_=mk.getterFor("URL"),kee=fk.URLSearchParams,jee=fk.getState,gf=Zw.URL,rS=Zw.TypeError,B_=Zw.parseInt,Lee=Math.floor,gk=Math.pow,Xi=Yi("".charAt),Ia=Yi(/./.exec),_f=Yi([].join),Mee=Yi(1 .toString),Fee=Yi([].pop),Uu=Yi([].push),sS=Yi("".replace),Uee=Yi([].shift),Vee=Yi("".split),Ef=Yi("".slice),W_=Yi("".toLowerCase),Bee=Yi([].unshift),nS="Invalid scheme",vf="Invalid host",_k="Invalid port",Ek=/[a-z]/i,Wee=/[\d+-.a-z]/i,iS=/\d/,Gee=/^0x/i,Hee=/^[0-7]+$/,zee=/^\d+$/,vk=/^[\da-f]+$/i,Kee=/[\0\t\n\r #%/:<>?@[\\\]^|]/,qee=/[\0\t\n\r #/:<>?@[\\\]^|]/,Yee=/^[\u0000-\u0020]+/,$ee=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Xee=/[\t\n\r]/g,yf=function(e){var t,r,i,c;if(typeof e=="number"){for(t=[],r=0;r<4;r++)Bee(t,e%256),e=Lee(e/256);return _f(t,".")}if(typeof e=="object"){for(t="",i=function(d){for(var h=null,p=1,m=null,_=0,E=0;E<8;E++)d[E]!==0?(_>p&&(h=m,p=_),m=null,_=0):(m===null&&(m=E),++_);return _>p?m:h}(e),r=0;r<8;r++)c&&e[r]===0||(c&&(c=!1),i===r?(t+=r?":":"::",c=!0):(t+=Mee(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},G_={},yk=tS({},G_,{" ":1,'"':1,"<":1,">":1,"`":1}),xk=tS({},yk,{"#":1,"?":1,"{":1,"}":1}),aS=tS({},xk,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Lc=function(e,t){var r=Aee(e,0);return r>32&&r<127&&!eS(t,e)?e:encodeURIComponent(e)},H_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},xf=function(e,t){var r;return e.length===2&&Ia(Ek,Xi(e,0))&&((r=Xi(e,1))===":"||!t&&r==="|")},bk=function(e){var t;return e.length>1&&xf(Ef(e,0,2))&&(e.length===2||(t=Xi(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Jee=function(e){return e==="."||W_(e)==="%2e"},oS={},wk={},cS={},Sk={},Ck={},lS={},Tk={},Rk={},z_={},K_={},dS={},uS={},hS={},pS={},Nk={},fS={},Vu={},mo={},Ak={},ed={},Jo={},mS=function(e,t,r){var i,c,d,h=Xo(e);if(t){if(c=this.parse(h))throw new rS(c);this.searchParams=null}else{if(r!==void 0&&(i=new mS(r,!0)),c=this.parse(h,null,i))throw new rS(c);(d=jee(new kee)).bindURL(this),this.searchParams=d}};mS.prototype={type:"URL",parse:function(e,t,r){var i,c,d,h,p,m=this,_=t||oS,E=0,x="",b=!1,C=!1,U=!1;for(e=Xo(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=sS(e,Yee,""),e=sS(e,$ee,"$1")),e=sS(e,Xee,""),i=Fu(e);E<=i.length;){switch(c=i[E],_){case oS:if(!c||!Ia(Ek,c)){if(t)return nS;_=cS;continue}x+=W_(c),_=wk;break;case wk:if(c&&(Ia(Wee,c)||c==="+"||c==="-"||c==="."))x+=W_(c);else{if(c!==":"){if(t)return nS;x="",_=cS,E=0;continue}if(t&&(m.isSpecial()!==eS(H_,x)||x==="file"&&(m.includesCredentials()||m.port!==null)||m.scheme==="file"&&!m.host))return;if(m.scheme=x,t)return void(m.isSpecial()&&H_[m.scheme]===m.port&&(m.port=null));x="",m.scheme==="file"?_=pS:m.isSpecial()&&r&&r.scheme===m.scheme?_=Sk:m.isSpecial()?_=Rk:i[E+1]==="/"?(_=Ck,E++):(m.cannotBeABaseURL=!0,Uu(m.path,""),_=Ak)}break;case cS:if(!r||r.cannotBeABaseURL&&c!=="#")return nS;if(r.cannotBeABaseURL&&c==="#"){m.scheme=r.scheme,m.path=Aa(r.path),m.query=r.query,m.fragment="",m.cannotBeABaseURL=!0,_=Jo;break}_=r.scheme==="file"?pS:lS;continue;case Sk:if(c!=="/"||i[E+1]!=="/"){_=lS;continue}_=z_,E++;break;case Ck:if(c==="/"){_=K_;break}_=mo;continue;case lS:if(m.scheme=r.scheme,c===qi)m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,m.path=Aa(r.path),m.query=r.query;else if(c==="/"||c==="\\"&&m.isSpecial())_=Tk;else if(c==="?")m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,m.path=Aa(r.path),m.query="",_=ed;else{if(c!=="#"){m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,m.path=Aa(r.path),m.path.length--,_=mo;continue}m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,m.path=Aa(r.path),m.query=r.query,m.fragment="",_=Jo}break;case Tk:if(!m.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){m.username=r.username,m.password=r.password,m.host=r.host,m.port=r.port,_=mo;continue}_=K_}else _=z_;break;case Rk:if(_=z_,c!=="/"||Xi(x,E+1)!=="/")continue;E++;break;case z_:if(c!=="/"&&c!=="\\"){_=K_;continue}break;case K_:if(c==="@"){b&&(x="%40"+x),b=!0,d=Fu(x);for(var k=0;k<d.length;k++){var M=d[k];if(M!==":"||U){var H=Lc(M,aS);U?m.password+=H:m.username+=H}else U=!0}x=""}else if(c===qi||c==="/"||c==="?"||c==="#"||c==="\\"&&m.isSpecial()){if(b&&x==="")return"Invalid authority";E-=Fu(x).length+1,x="",_=dS}else x+=c;break;case dS:case uS:if(t&&m.scheme==="file"){_=fS;continue}if(c!==":"||C){if(c===qi||c==="/"||c==="?"||c==="#"||c==="\\"&&m.isSpecial()){if(m.isSpecial()&&x==="")return vf;if(t&&x===""&&(m.includesCredentials()||m.port!==null))return;if(h=m.parseHost(x))return h;if(x="",_=Vu,t)return;continue}c==="["?C=!0:c==="]"&&(C=!1),x+=c}else{if(x==="")return vf;if(h=m.parseHost(x))return h;if(x="",_=hS,t===uS)return}break;case hS:if(!Ia(iS,c)){if(c===qi||c==="/"||c==="?"||c==="#"||c==="\\"&&m.isSpecial()||t){if(x!==""){var K=B_(x,10);if(K>65535)return _k;m.port=m.isSpecial()&&K===H_[m.scheme]?null:K,x=""}if(t)return;_=Vu;continue}return _k}x+=c;break;case pS:if(m.scheme="file",c==="/"||c==="\\")_=Nk;else{if(!r||r.scheme!=="file"){_=mo;continue}switch(c){case qi:m.host=r.host,m.path=Aa(r.path),m.query=r.query;break;case"?":m.host=r.host,m.path=Aa(r.path),m.query="",_=ed;break;case"#":m.host=r.host,m.path=Aa(r.path),m.query=r.query,m.fragment="",_=Jo;break;default:bk(_f(Aa(i,E),""))||(m.host=r.host,m.path=Aa(r.path),m.shortenPath()),_=mo;continue}}break;case Nk:if(c==="/"||c==="\\"){_=fS;break}r&&r.scheme==="file"&&!bk(_f(Aa(i,E),""))&&(xf(r.path[0],!0)?Uu(m.path,r.path[0]):m.host=r.host),_=mo;continue;case fS:if(c===qi||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&xf(x))_=mo;else if(x===""){if(m.host="",t)return;_=Vu}else{if(h=m.parseHost(x))return h;if(m.host==="localhost"&&(m.host=""),t)return;x="",_=Vu}continue}x+=c;break;case Vu:if(m.isSpecial()){if(_=mo,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==qi&&(_=mo,c!=="/"))continue}else m.fragment="",_=Jo;else m.query="",_=ed;break;case mo:if(c===qi||c==="/"||c==="\\"&&m.isSpecial()||!t&&(c==="?"||c==="#")){if((p=W_(p=x))===".."||p==="%2e."||p===".%2e"||p==="%2e%2e"?(m.shortenPath(),c==="/"||c==="\\"&&m.isSpecial()||Uu(m.path,"")):Jee(x)?c==="/"||c==="\\"&&m.isSpecial()||Uu(m.path,""):(m.scheme==="file"&&!m.path.length&&xf(x)&&(m.host&&(m.host=""),x=Xi(x,0)+":"),Uu(m.path,x)),x="",m.scheme==="file"&&(c===qi||c==="?"||c==="#"))for(;m.path.length>1&&m.path[0]==="";)Uee(m.path);c==="?"?(m.query="",_=ed):c==="#"&&(m.fragment="",_=Jo)}else x+=Lc(c,xk);break;case Ak:c==="?"?(m.query="",_=ed):c==="#"?(m.fragment="",_=Jo):c!==qi&&(m.path[0]+=Lc(c,G_));break;case ed:t||c!=="#"?c!==qi&&(c==="'"&&m.isSpecial()?m.query+="%27":m.query+=c==="#"?"%23":Lc(c,G_)):(m.fragment="",_=Jo);break;case Jo:c!==qi&&(m.fragment+=Lc(c,yk))}E++}},parseHost:function(e){var t,r,i;if(Xi(e,0)==="["){if(Xi(e,e.length-1)!=="]"||(t=function(c){var d,h,p,m,_,E,x,b=[0,0,0,0,0,0,0,0],C=0,U=null,k=0,M=function(){return Xi(c,k)};if(M()===":"){if(Xi(c,1)!==":")return;k+=2,U=++C}for(;M();){if(C===8)return;if(M()!==":"){for(d=h=0;h<4&&Ia(vk,M());)d=16*d+B_(M(),16),k++,h++;if(M()==="."){if(h===0||(k-=h,C>6))return;for(p=0;M();){if(m=null,p>0){if(!(M()==="."&&p<4))return;k++}if(!Ia(iS,M()))return;for(;Ia(iS,M());){if(_=B_(M(),10),m===null)m=_;else{if(m===0)return;m=10*m+_}if(m>255)return;k++}b[C]=256*b[C]+m,++p!=2&&p!==4||C++}if(p!==4)return;break}if(M()===":"){if(k++,!M())return}else if(M())return;b[C++]=d}else{if(U!==null)return;k++,U=++C}}if(U!==null)for(E=C-U,C=7;C!==0&&E>0;)x=b[C],b[C--]=b[U+E-1],b[U+--E]=x;else if(C!==8)return;return b}(Ef(e,1,-1)),!t))return vf;this.host=t}else if(this.isSpecial()){if(e=Iee(e),Ia(Kee,e)||(t=function(c){var d,h,p,m,_,E,x,b=Vee(c,".");if(b.length&&b[b.length-1]===""&&b.length--,(d=b.length)>4)return c;for(h=[],p=0;p<d;p++){if((m=b[p])==="")return c;if(_=10,m.length>1&&Xi(m,0)==="0"&&(_=Ia(Gee,m)?16:8,m=Ef(m,_===8?1:2)),m==="")E=0;else{if(!Ia(_===10?zee:_===8?Hee:vk,m))return c;E=B_(m,_)}Uu(h,E)}for(p=0;p<d;p++)if(E=h[p],p===d-1){if(E>=gk(256,5-d))return null}else if(E>255)return null;for(x=Fee(h),p=0;p<h.length;p++)x+=h[p]*gk(256,3-p);return x}(e),t===null))return vf;this.host=t}else{if(Ia(qee,e))return vf;for(t="",r=Fu(e),i=0;i<r.length;i++)t+=Lc(r[i],G_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return eS(H_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&xf(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,i=e.password,c=e.host,d=e.port,h=e.path,p=e.query,m=e.fragment,_=t+":";return c!==null?(_+="//",e.includesCredentials()&&(_+=r+(i?":"+i:"")+"@"),_+=yf(c),d!==null&&(_+=":"+d)):t==="file"&&(_+="//"),_+=e.cannotBeABaseURL?h[0]:h.length?"/"+_f(h,"/"):"",p!==null&&(_+="?"+p),m!==null&&(_+="#"+m),_},setHref:function(e){var t=this.parse(e);if(t)throw new rS(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Bu(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+yf(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Xo(e)+":",oS)},getUsername:function(){return this.username},setUsername:function(e){var t=Fu(Xo(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=Lc(t[r],aS)}},getPassword:function(){return this.password},setPassword:function(e){var t=Fu(Xo(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=Lc(t[r],aS)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?yf(e):yf(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,dS)},getHostname:function(){var e=this.host;return e===null?"":yf(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,uS)},getPort:function(){var e=this.port;return e===null?"":Xo(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Xo(e))===""?this.port=null:this.parse(e,hS))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+_f(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Vu))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Xo(e))===""?this.query=null:(Xi(e,0)==="?"&&(e=Ef(e,1)),this.query="",this.parse(e,ed)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Xo(e))!==""?(Xi(e,0)==="#"&&(e=Ef(e,1)),this.fragment="",this.parse(e,Jo)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Bu=function(e){var t=Nee(this,Fn),r=Dee(arguments.length,1)>1?arguments[1]:void 0,i=Pee(t,new mS(e,!1,r));Qw||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},Fn=Bu.prototype,Ji=function(e,t){return{get:function(){return V_(this)[e]()},set:t&&function(r){return V_(this)[t](r)},configurable:!0,enumerable:!0}};if(Qw&&($i(Fn,"href",Ji("serialize","setHref")),$i(Fn,"origin",Ji("getOrigin")),$i(Fn,"protocol",Ji("getProtocol","setProtocol")),$i(Fn,"username",Ji("getUsername","setUsername")),$i(Fn,"password",Ji("getPassword","setPassword")),$i(Fn,"host",Ji("getHost","setHost")),$i(Fn,"hostname",Ji("getHostname","setHostname")),$i(Fn,"port",Ji("getPort","setPort")),$i(Fn,"pathname",Ji("getPathname","setPathname")),$i(Fn,"search",Ji("getSearch","setSearch")),$i(Fn,"searchParams",Ji("getSearchParams")),$i(Fn,"hash",Ji("getHash","setHash"))),U_(Fn,"toJSON",function(){return V_(this).serialize()},{enumerable:!0}),U_(Fn,"toString",function(){return V_(this).serialize()},{enumerable:!0}),gf){var Ik=gf.createObjectURL,Ok=gf.revokeObjectURL;Ik&&U_(Bu,"createObjectURL",pk(Ik,gf)),Ok&&U_(Bu,"revokeObjectURL",pk(Ok,gf))}Oee(Bu,"URL"),Tee({global:!0,forced:!Ree,sham:!Qw},{URL:Bu});var Qee=qt,Dk=f,Zee=Xl,Pk=Zn,ete=P_,gS=xs("URL"),tte=ete&&Dk(function(){gS.canParse()}),rte=Dk(function(){return gS.canParse.length!==1});Qee({target:"URL",stat:!0,forced:!tte||rte},{canParse:function(e){var t=Zee(arguments.length,1),r=Pk(e),i=t<2||arguments[1]===void 0?void 0:Pk(arguments[1]);try{return!!new gS(r,i)}catch{return!1}}});var ste=qt,nte=Xl,kk=Zn,ite=P_,ate=xs("URL");ste({target:"URL",stat:!0,forced:!ite},{parse:function(e){var t=nte(arguments.length,1),r=kk(e),i=t<2||arguments[1]===void 0?void 0:kk(arguments[1]);try{return new ate(r,i)}catch{return null}}});var q_=u(Pr.URL);let jk=!0,Lk=!0;function Y_(e,t,r){let i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function td(e,t,r){if(!e.RTCPeerConnection)return;let i=e.RTCPeerConnection.prototype,c=i.addEventListener;i.addEventListener=function(h,p){if(h!==t)return c.apply(this,arguments);let m=_=>{let E=r(_);E&&(p.handleEvent?p.handleEvent(E):p(E))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(p,m),c.apply(this,[h,m])};let d=i.removeEventListener;i.removeEventListener=function(h,p){if(h!==t||!this._eventMap||!this._eventMap[t])return d.apply(this,arguments);if(!this._eventMap[t].has(p))return d.apply(this,arguments);let m=this._eventMap[t].get(p);return this._eventMap[t].delete(p),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function ote(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(jk=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function cte(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Lk=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Mk(){if(typeof window=="object"){if(jk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _S(e,t){Lk&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Fk(e){return Object.prototype.toString.call(e)==="[object Object]"}function Uk(e){var t;return Fk(e)?zi(t=Object.keys(e)).call(t,function(r,i){let c=Fk(e[i]),d=c?Uk(e[i]):e[i],h=c&&!Object.keys(d).length;return d===void 0||h?r:Object.assign(r,{[i]:d})},{}):e}function ES(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?ES(e,e.get(t[i]),r):i.endsWith("Ids")&&t[i].forEach(c=>{ES(e,e.get(c),r)})}))}function Vk(e,t,r){let i=r?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;let d=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&d.push(h)}),d.forEach(h=>{e.forEach(p=>{p.type===i&&p.trackId===h.id&&ES(e,p,c)})}),c}let Bk=Mk;function Wk(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let i=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;let p={};return Object.keys(h).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;let _=typeof h[m]=="object"?h[m]:{ideal:h[m]};_.exact!==void 0&&typeof _.exact=="number"&&(_.min=_.max=_.exact);let E=function(x,b){return x?x+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(_.ideal!==void 0){p.optional=p.optional||[];let x={};typeof _.ideal=="number"?(x[E("min",m)]=_.ideal,p.optional.push(x),x={},x[E("max",m)]=_.ideal,p.optional.push(x)):(x[E("",m)]=_.ideal,p.optional.push(x))}_.exact!==void 0&&typeof _.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[E("",m)]=_.exact):["min","max"].forEach(x=>{_[x]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[E(x,m)]=_[x])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},c=function(h,p){if(t.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){let m=function(_,E,x){E in _&&!(x in _)&&(_[x]=_[E],delete _[E])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=i(h.audio)}if(h&&typeof h.video=="object"){let m=h.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});let _=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||_)){let E;if(delete h.video.facingMode,m.exact==="environment"||m.ideal==="environment"?E=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(E=["front"]),E)return r.mediaDevices.enumerateDevices().then(x=>{x=x.filter(C=>C.kind==="videoinput");let b=x.find(C=>E.some(U=>{var k;return Ae(k=C.label.toLowerCase()).call(k,U)}));return!b&&x.length&&Ae(E).call(E,"back")&&(b=x[x.length-1]),b&&(h.video.deviceId=m.exact?{exact:b.deviceId}:{ideal:b.deviceId}),h.video=i(h.video),Bk("chrome: "+JSON.stringify(h)),p(h)})}h.video=i(h.video)}return Bk("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(h,p,m){c(h,_=>{r.webkitGetUserMedia(_,p,E=>{m&&m(d(E))})})}).bind(r),r.mediaDevices.getUserMedia){let h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return c(p,m=>h(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return _},_=>je.reject(d(_))))}}}function Gk(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Hk(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===i.track.id):{track:i.track};let d=new Event("track");d.track=i.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[r.stream],this.dispatchEvent(d)}),r.stream.getTracks().forEach(i=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===i.id):{track:i};let d=new Event("track");d.track=i,d.receiver=c,d.transceiver={receiver:c},d.streams=[r.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else td(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function zk(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,p){let m=c.apply(this,arguments);return m||(m=t(this,h),this._senders.push(m)),m};let d=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);let p=this._senders.indexOf(h);p!==-1&&this._senders.splice(p,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(t(this,d))})};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(d=>{let h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Kk(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[r,i,c]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);let d=function(p){let m={};return p.result().forEach(_=>{let E={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(x=>{E[x]=_.stat(x)}),m[E.id]=E}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};if(arguments.length>=2){let p=function(m){i(h(d(m)))};return t.apply(this,[p,r])}return new je((p,m)=>{t.apply(this,[function(_){p(h(d(_)))},m])}).then(i,c)}}function qk(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let c=r.apply(this,[]);return c.forEach(d=>d._pc=this),c});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let c=i.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){let c=this;return this._pc.getStats().then(d=>Vk(d,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=r.apply(this,[]);return i.forEach(c=>c._pc=this),i}),td(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){let i=this;return this._pc.getStats().then(c=>Vk(c,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let r=arguments[0],i,c,d;return this.getSenders().forEach(h=>{h.track===r&&(i?d=!0:i=h)}),this.getReceivers().forEach(h=>(h.track===r&&(c?d=!0:c=h),h.track===r)),d||i&&c?je.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():c?c.getStats():je.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Yk(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let p=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(p)===-1&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});let h=this.getSenders();r.apply(this,arguments);let p=this.getSenders().filter(m=>h.indexOf(m)===-1);this._shimmedLocalStreams[d.id]=[d].concat(p)};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],i.apply(this,arguments)};let c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{let p=this._shimmedLocalStreams[h].indexOf(d);p!==-1&&this._shimmedLocalStreams[h].splice(p,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function $k(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Yk(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let m=r.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(E=>E.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){let _=new e.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}i.apply(this,[m])};let c=e.RTCPeerConnection.prototype.removeStream;function d(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(x=>{let b=m._reverseStreams[x],C=m._streams[b.id];E=E.replace(new RegExp(C.id,"g"),b.id)}),new RTCSessionDescription({type:_.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find(b=>b===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let x=this._streams[_.id];if(x)x.addTrack(m),je.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let b=new e.MediaStream([m]);this._streams[_.id]=b,this._reverseStreams[b.id]=_,this.addStream(b)}return this.getSenders().find(b=>b.track===m)},["createOffer","createAnswer"].forEach(function(m){let _=e.RTCPeerConnection.prototype[m],E={[m](){let x=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[b=>{let C=d(this,b);x[0].apply(null,[C])},b=>{x[1]&&x[1].apply(null,b)},arguments[2]]):_.apply(this,arguments).then(b=>d(this,b))}};e.RTCPeerConnection.prototype[m]=E[m]});let h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(x=>{let b=m._reverseStreams[x],C=m._streams[b.id];E=E.replace(new RegExp(b.id,"g"),C.id)}),new RTCSessionDescription({type:_.type,sdp:E})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};let p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let m=p.get.apply(this);return m.type===""?m:d(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(x=>m.track===x)&&(_=this._streams[E])}),_&&(_.getTracks().length===1?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function vS(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let i=e.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=c[r]})}function Xk(e,t){td(e,"negotiationneeded",r=>{let i=r.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return r})}var Jk=Object.freeze({__proto__:null,fixNegotiationNeeded:Xk,shimAddTrackRemoveTrack:$k,shimAddTrackRemoveTrackWithNative:Yk,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{let c=r.video&&r.video.width,d=r.video&&r.video.height,h=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:h||3}},c&&(r.video.mandatory.maxWidth=c),d&&(r.video.mandatory.maxHeight=d),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:zk,shimGetStats:Kk,shimGetUserMedia:Wk,shimMediaStream:Gk,shimOnTrack:Hk,shimPeerConnection:vS,shimSenderReceiverGetStats:qk});function Qk(e,t){let r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(c,d,h){_S("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(d,h)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let c=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},i&&i.prototype.getSettings){let h=i.prototype.getSettings;i.prototype.getSettings=function(){let p=h.apply(this,arguments);return c(p,"mozAutoGainControl","autoGainControl"),c(p,"mozNoiseSuppression","noiseSuppression"),p}}if(i&&i.prototype.applyConstraints){let h=i.prototype.applyConstraints;i.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),c(p,"autoGainControl","mozAutoGainControl"),c(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function Zk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yS(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){let d=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[c,d,h]=arguments;return i.apply(this,[c||null]).then(p=>{if(t.version<53&&!d)try{p.forEach(m=>{m.type=r[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;p.forEach((_,E)=>{p.set(E,Object.assign({},_,{type:r[_.type]||_.type}))})}return p}).then(d,h)}}function e1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(c=>c._pc=this),i});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):je.resolve(new Map)}}function t1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),td(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function r1(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){_S("removeStream","removeTrack"),this.getSenders().forEach(r=>{var i;r.track&&Ae(i=t.getTracks()).call(i,r.track)&&this.removeTrack(r)})})}function s1(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function n1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];let i=r.length>0;i&&r.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let c=t.apply(this,arguments);if(i){let{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=r,d.sendEncodings=r,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function i1(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function a1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?je.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function o1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?je.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var c1=Object.freeze({__proto__:null,shimAddTransceiver:n1,shimCreateAnswer:o1,shimCreateOffer:a1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){let i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,je.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:i1,shimGetUserMedia:Qk,shimOnTrack:Zk,shimPeerConnection:yS,shimRTCDataChannel:s1,shimReceiverGetStats:t1,shimRemoveStream:r1,shimSenderGetStats:e1});function l1(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var i;this._localStreams||(this._localStreams=[]),Ae(i=this._localStreams).call(i,r)||this._localStreams.push(r),r.getAudioTracks().forEach(c=>t.call(this,c,r)),r.getVideoTracks().forEach(c=>t.call(this,c,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,c=new Array(i>1?i-1:0),d=1;d<i;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var p;this._localStreams?Ae(p=this._localStreams).call(p,h)||this._localStreams.push(h):this._localStreams=[h]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);let i=t.getTracks();this.getSenders().forEach(c=>{Ae(i).call(i,c.track)&&this.removeTrack(c)})})}}function d1(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),Ae(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);let h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);let d=new Event("addstream");d.stream=c,r.dispatchEvent(d)})}),t.apply(r,arguments)}}}function u1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,c=t.setLocalDescription,d=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(m,_){let E=arguments.length>=2?arguments[2]:arguments[0],x=r.apply(this,[E]);return _?(x.then(m,_),je.resolve()):x},t.createAnswer=function(m,_){let E=arguments.length>=2?arguments[2]:arguments[0],x=i.apply(this,[E]);return _?(x.then(m,_),je.resolve()):x};let p=function(m,_,E){let x=c.apply(this,[m]);return E?(x.then(_,E),je.resolve()):x};t.setLocalDescription=p,p=function(m,_,E){let x=d.apply(this,[m]);return E?(x.then(_,E),je.resolve()):x},t.setRemoteDescription=p,p=function(m,_,E){let x=h.apply(this,[m]);return E?(x.then(_,E),je.resolve()):x},t.addIceCandidate=p}function h1(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let r=t.mediaDevices,i=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=c=>i(p1(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,i,c){t.mediaDevices.getUserMedia(r).then(i,c)}).bind(t))}function p1(e){return e&&e.video!==void 0?Object.assign({},e,{video:Uk(e.video)}):e}function f1(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){let c=[];for(let d=0;d<r.iceServers.length;d++){let h=r.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(_S("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(r.iceServers[d])}r.iceServers=c}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function m1(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function g1(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);let i=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);let c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function _1(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var E1=Object.freeze({__proto__:null,shimAudioContext:_1,shimCallbacksAPI:u1,shimConstraints:p1,shimCreateOfferLegacy:g1,shimGetUserMedia:h1,shimLocalStreamsAPI:l1,shimRTCIceServerUrls:f1,shimRemoteStreamsAPI:d1,shimTrackEventTransceiver:m1}),v1=`	
\v\f\r \u2028\u2029\uFEFF`,lte=kt,dte=Zn,xS=v1,y1=S("".replace),ute=RegExp("^["+xS+"]+"),hte=RegExp("(^|[^"+xS+"])["+xS+"]+$"),pte=function(e){return function(t){var r=dte(lte(t));return r=y1(r,ute,""),r=y1(r,hte,"$1"),r}},fte={trim:pte()},mte=sD.PROPER,gte=f,x1=v1,_te=fte.trim;qt({target:"String",proto:!0,forced:function(e){return gte(function(){return!!x1[e]()||""[e]()!==""||mte&&x1[e].name!==e})}("trim")},{trim:function(){return _te(this)}});var Ete=Hi("String","trim"),vte=I,yte=Ete,bS=String.prototype,xte=function(e){var t=e.trim;return typeof e=="string"||e===bS||vte(bS,e)&&t===bS.trim?yte:t},Ks=u(xte),b1={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(r){return r.split(`
m=`).map((i,c)=>(c>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(r){let i=t.splitSections(r);return i&&i[0]},t.getMediaSections=function(r){let i=t.splitSections(r);return i.shift(),i},t.matchPrefix=function(r,i){return t.splitLines(r).filter(c=>c.indexOf(i)===0)},t.parseCandidate=function(r){let i;i=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");let c={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let d=8;d<i.length;d+=2)switch(i[d]){case"raddr":c.relatedAddress=i[d+1];break;case"rport":c.relatedPort=parseInt(i[d+1],10);break;case"tcptype":c.tcpType=i[d+1];break;case"ufrag":c.ufrag=i[d+1],c.usernameFragment=i[d+1];break;default:c[i[d]]===void 0&&(c[i[d]]=i[d+1])}return c},t.writeCandidate=function(r){let i=[];i.push(r.foundation);let c=r.component;c==="rtp"?i.push(1):c==="rtcp"?i.push(2):i.push(c),i.push(r.protocol.toUpperCase()),i.push(r.priority),i.push(r.address||r.ip),i.push(r.port);let d=r.type;return i.push("typ"),i.push(d),d!=="host"&&r.relatedAddress&&r.relatedPort&&(i.push("raddr"),i.push(r.relatedAddress),i.push("rport"),i.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(i.push("ufrag"),i.push(r.usernameFragment||r.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let i=r.substring(9).split(" "),c={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),c.name=i[0],c.clockRate=parseInt(i[1],10),c.channels=i.length===3?parseInt(i[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(r){let i=r.payloadType;r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType);let c=r.channels||r.numChannels||1;return"a=rtpmap:"+i+" "+r.name+"/"+r.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(r){let i=r.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){let i={},c,d=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),i[c[0].trim()]=c[1];return i},t.writeFmtp=function(r){let i="",c=r.payloadType;if(r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){let d=[];Object.keys(r.parameters).forEach(h=>{r.parameters[h]!==void 0?d.push(h+"="+r.parameters[h]):d.push(h)}),i+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return i},t.parseRtcpFb=function(r){let i=r.substring(r.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(r){let i="",c=r.payloadType;return r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(d=>{i+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(r){let i=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,i),10)},d=r.indexOf(":",i);return d>-1?(c.attribute=r.substring(i+1,d),c.value=r.substring(d+1)):c.attribute=r.substring(i+1),c},t.parseSsrcGroup=function(r){let i=r.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(c=>parseInt(c,10))}},t.getMid=function(r){let i=t.matchPrefix(r,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(r){let i=r.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(r,i){return{role:"auto",fingerprints:t.matchPrefix(r+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,i){let c="a=setup:"+i+`\r
`;return r.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},t.parseCryptoLine=function(r){let i=r.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;let i=r.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,i){return t.matchPrefix(r+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,i){let c=t.matchPrefix(r+i,"a=ice-ufrag:")[0],d=t.matchPrefix(r+i,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},t.writeIceParameters=function(r){let i="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(r){let i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(r)[0].split(" ");i.profile=c[2];for(let h=3;h<c.length;h++){let p=c[h],m=t.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(m){let _=t.parseRtpMap(m),E=t.matchPrefix(r,"a=fmtp:"+p+" ");switch(_.parameters=E.length?t.parseFmtp(E[0]):{},_.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),i.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(_.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(h=>{i.headerExtensions.push(t.parseExtmap(h))});let d=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),i},t.writeRtpDescription=function(r,i){let c="";c+="m="+r+" ",c+=i.codecs.length>0?"9":"0",c+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=i.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(h=>{c+=t.writeRtpMap(h),c+=t.writeFmtp(h),c+=t.writeRtcpFb(h)});let d=0;return i.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(h=>{c+=t.writeExtmap(h)}),c},t.parseRtpEncodingParameters=function(r){let i=[],c=t.parseRtpParameters(r),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,p=t.matchPrefix(r,"a=ssrc:").map(b=>t.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),m=p.length>0&&p[0].ssrc,_,E=t.matchPrefix(r,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(C=>parseInt(C,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(_=E[0][1]),c.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let C={ssrc:m,codecPayloadType:parseInt(b.parameters.apt,10)};m&&_&&(C.rtx={ssrc:_}),i.push(C),d&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},i.push(C))}}),i.length===0&&m&&i.push({ssrc:m});let x=t.matchPrefix(r,"b=");return x.length&&(x=x[0].indexOf("b=TIAS:")===0?parseInt(x[0].substring(7),10):x[0].indexOf("b=AS:")===0?1e3*parseInt(x[0].substring(5),10)*.95-16e3:void 0,i.forEach(b=>{b.maxBitrate=x})),i},t.parseRtcpParameters=function(r){let i={},c=t.matchPrefix(r,"a=ssrc:").map(p=>t.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];c&&(i.cname=c.value,i.ssrc=c.ssrc);let d=t.matchPrefix(r,"a=rtcp-rsize");i.reducedSize=d.length>0,i.compound=d.length===0;let h=t.matchPrefix(r,"a=rtcp-mux");return i.mux=h.length>0,i},t.writeRtcpParameters=function(r){let i="";return r.reducedSize&&(i+=`a=rtcp-rsize\r
`),r.mux&&(i+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(i+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),i},t.parseMsid=function(r){let i,c=t.matchPrefix(r,"a=msid:");if(c.length===1)return i=c[0].substring(7).split(" "),{stream:i[0],track:i[1]};let d=t.matchPrefix(r,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(i=d[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(r){let i=t.parseMLine(r),c=t.matchPrefix(r,"a=max-message-size:"),d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);let h=t.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:i.fmt,maxMessageSize:d};let p=t.matchPrefix(r,"a=sctpmap:");if(p.length>0){let m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},t.writeSctpDescription=function(r,i){let c=[];return c=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&c.push("a=max-message-size:"+i.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,i,c){let d,h=i!==void 0?i:2;return d=r||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,i){let c=t.splitLines(r);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){let i=t.splitLines(r)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(r){let i=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;let i=t.splitLines(r);for(let c=0;c<i.length;c++)if(i[c].length<2||i[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(b1);var w1=b1.exports,Wu=u(w1),bte=a({__proto__:null,default:Wu},[w1]);function $_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){let i=new t(r),c=Wu.parseCandidate(r.candidate),d=Object.assign(i,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,td(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function wS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||td(e,"icecandidate",t=>{if(t.candidate){let r=Wu.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function X_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let r=function(p){if(!p||!p.sdp)return!1;let m=Wu.splitSections(p.sdp);return m.shift(),m.some(_=>{let E=Wu.parseMLine(_);return E&&E.kind==="application"&&E.protocol.indexOf("SCTP")!==-1})},i=function(p){let m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;let _=parseInt(m[1],10);return _!=_?-1:_},c=function(p){let m=65536;return t.browser==="firefox"&&(m=t.version<57?p===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},d=function(p,m){let _=65536;t.browser==="firefox"&&t.version===57&&(_=65535);let E=Wu.matchPrefix(p.sdp,"a=max-message-size:");return E.length>0?_=parseInt(E[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(_=2147483637),_},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let p=i(arguments[0]),m=c(p),_=d(arguments[0],p),E;E=m===0&&_===0?Number.POSITIVE_INFINITY:m===0||_===0?Math.max(m,_):Math.min(m,_);let x={};Object.defineProperty(x,"maxMessageSize",{get:()=>E}),this._sctp=x}return h.apply(this,arguments)}}function J_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,c){let d=i.send;i.send=function(){let h=arguments[0],p=h.length||h.size||h.byteLength;if(i.readyState==="open"&&c.sctp&&p>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(i,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let i=r.apply(this,arguments);return t(i,this),i},td(e,"datachannel",i=>(t(i.channel,i.target),i))}function SS(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let i=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{let d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;let h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function CS(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let c=i.sdp.split(`
`).filter(d=>Ks(d).call(d)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:c}):i.sdp=c}return r.apply(this,arguments)}}function Q_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?je.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),je.resolve())})}function Z_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return r.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?r.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>r.apply(this,[c]))})}var wte=Object.freeze({__proto__:null,removeExtmapAllowMixed:CS,shimAddIceCandidateNullOrEmpty:Q_,shimConnectionState:SS,shimMaxMessageSize:X_,shimParameterlessSetLocalDescription:Z_,shimRTCIceCandidate:$_,shimRTCIceCandidateRelayProtocol:wS,shimSendThrowTypeError:J_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=Mk,i=function(d){let h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;let{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=Y_(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=Y_(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=Y_(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:i,commonShim:wte,extractVersion:Y_,disableLog:ote,disableWarnings:cte,sdp:bte};switch(i.browser){case"chrome":if(!Jk||!vS||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(i.version===null)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=Jk,Q_(e,i),Z_(e),Wk(e,i),Gk(e),vS(e,i),Hk(e),$k(e,i),zk(e),Kk(e),qk(e),Xk(e,i),$_(e),wS(e),SS(e),X_(e,i),J_(e),CS(e,i);break;case"firefox":if(!c1||!yS||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=c1,Q_(e,i),Z_(e),Qk(e,i),yS(e,i),Zk(e),r1(e),e1(e),t1(e),s1(e),n1(e),i1(e),a1(e),o1(e),$_(e),SS(e),X_(e,i),J_(e);break;case"safari":if(!E1||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=E1,Q_(e,i),Z_(e),f1(e),g1(e),u1(e),l1(e),d1(e),m1(e),h1(e),_1(e),$_(e),wS(e),X_(e,i),J_(e),CS(e,i);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var TS=B;qt({global:!0,forced:TS.globalThis!==TS},{globalThis:TS});var S1=u(B),RS={exports:{}};(function(e,t){(function(r,i){var c="function",d="undefined",h="object",p="string",m="major",_="model",E="name",x="type",b="vendor",C="version",U="architecture",k="console",M="mobile",H="tablet",K="smarttv",X="wearable",se="embedded",te="Amazon",Z="Apple",ce="ASUS",fe="BlackBerry",xe="Browser",Te="Chrome",_t="Firefox",vt="Google",at="Huawei",Vt="LG",Mt="Microsoft",js="Motorola",ge="Opera",Ie="Samsung",Ve="Sharp",we="Sony",P="Xiaomi",Q="Zebra",re="Facebook",Re="Chromium OS",ht="Mac OS",cr=" Browser",$r=function(zr){for(var Xr={},lr=0;lr<zr.length;lr++)Xr[zr[lr].toUpperCase()]=zr[lr];return Xr},Oi=function(zr,Xr){return typeof zr===p&&ua(Xr).indexOf(ua(zr))!==-1},ua=function(zr){return zr.toLowerCase()},Cm=function(zr,Xr){if(typeof zr===p)return zr=zr.replace(/^\s\s*/,""),typeof Xr===d?zr:zr.substring(0,500)},Ad=function(zr,Xr){for(var lr,Cn,Ka,jr,uc,At,qa=0;qa<Xr.length&&!uc;){var Id=Xr[qa],Do=Xr[qa+1];for(lr=Cn=0;lr<Id.length&&!uc&&Id[lr];)if(uc=Id[lr++].exec(zr))for(Ka=0;Ka<Do.length;Ka++)At=uc[++Cn],typeof(jr=Do[Ka])===h&&jr.length>0?jr.length===2?typeof jr[1]==c?this[jr[0]]=jr[1].call(this,At):this[jr[0]]=jr[1]:jr.length===3?typeof jr[1]!==c||jr[1].exec&&jr[1].test?this[jr[0]]=At?At.replace(jr[1],jr[2]):i:this[jr[0]]=At?jr[1].call(this,At,jr[2]):i:jr.length===4&&(this[jr[0]]=At?jr[3].call(this,At.replace(jr[1],jr[2])):i):this[jr]=At||i;qa+=2}},jh=function(zr,Xr){for(var lr in Xr)if(typeof Xr[lr]===h&&Xr[lr].length>0){for(var Cn=0;Cn<Xr[lr].length;Cn++)if(Oi(Xr[lr][Cn],zr))return lr==="?"?i:lr}else if(Oi(Xr[lr],zr))return lr==="?"?i:lr;return Xr.hasOwnProperty("*")?Xr["*"]:zr},Zv={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ey={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,C],[/opios[\/ ]+([\w\.]+)/i],[C,[E,ge+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[C,[E,ge+" GX"]],[/\bopr\/([\w\.]+)/i],[C,[E,ge]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[C,[E,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[C,[E,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[E,C],[/quark(?:pc)?\/([-\w\.]+)/i],[C,[E,"Quark"]],[/\bddg\/([\w\.]+)/i],[C,[E,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[E,"UC"+xe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[C,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[E,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[C,[E,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[C,[E,"Smart Lenovo "+xe]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+xe],C],[/\bfocus\/([\w\.]+)/i],[C,[E,_t+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[E,ge+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[E,ge+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[E,"MIUI"+cr]],[/fxios\/([\w\.-]+)/i],[C,[E,_t]],[/\bqihoobrowser\/?([\w\.]*)/i],[C,[E,"360"]],[/\b(qq)\/([\w\.]+)/i],[[E,/(.+)/,"$1Browser"],C],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1"+cr],C],[/samsungbrowser\/([\w\.]+)/i],[C,[E,Ie+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[C,[E,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[E,"Sogou Mobile"],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[E,C],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[E],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[C,E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,re],C],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[E,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[E,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[C,[E,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[E,Te+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,Te+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[E,"Android "+xe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[C,jh,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],C],[/(wolvic|librewolf)\/([\w\.]+)/i],[E,C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[E,_t+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[E,[C,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[E,[C,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[U,"amd64"]],[/(ia32(?=;))/i],[[U,ua]],[/((?:i[346]|x)86)[;\)]/i],[[U,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[U,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[U,"armhf"]],[/windows (ce|mobile); ppc;/i],[[U,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[U,/ower/,"",ua]],[/(sun4\w)[;\)]/i],[[U,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[U,ua]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[b,Ie],[x,H]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[_,[b,Ie],[x,M]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[_,[b,Z],[x,M]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[b,Z],[x,H]],[/(macintosh);/i],[_,[b,Z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[b,Ve],[x,M]],[/(?:honor)([-\w ]+)[;\)]/i],[_,[b,"Honor"],[x,M]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[b,at],[x,H]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[b,at],[x,M]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[_,/_/g," "],[b,P],[x,M]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[b,P],[x,H]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[b,"OPPO"],[x,M]],[/\b(opd2\d{3}a?) bui/i],[_,[b,"OPPO"],[x,H]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[b,"Vivo"],[x,M]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[_,[b,"Realme"],[x,M]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[b,js],[x,M]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[b,js],[x,H]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[b,Vt],[x,H]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[b,Vt],[x,M]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[b,"Lenovo"],[x,H]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[b,"Nokia"],[x,M]],[/(pixel c)\b/i],[_,[b,vt],[x,H]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[b,vt],[x,M]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[b,we],[x,M]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[b,we],[x,H]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[b,"OnePlus"],[x,M]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[b,te],[x,H]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[b,te],[x,M]],[/(playbook);[-\w\),; ]+(rim)/i],[_,b,[x,H]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[b,fe],[x,M]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[b,ce],[x,H]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[b,ce],[x,M]],[/(nexus 9)/i],[_,[b,"HTC"],[x,H]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[_,/_/g," "],[x,M]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[_,[b,"TCL"],[x,H]],[/(itel) ((\w+))/i],[[b,ua],_,[x,jh,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[b,"Acer"],[x,H]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[b,"Meizu"],[x,M]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[_,[b,"Ulefone"],[x,M]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[_,[b,"Energizer"],[x,M]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[_,[b,"Cat"],[x,M]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[_,[b,"Smartfren"],[x,M]],[/droid.+; (a(?:015|06[35]|142p?))/i],[_,[b,"Nothing"],[x,M]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[b,_,[x,M]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,_,[x,H]],[/(surface duo)/i],[_,[b,Mt],[x,H]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[b,"Fairphone"],[x,M]],[/(u304aa)/i],[_,[b,"AT&T"],[x,M]],[/\bsie-(\w*)/i],[_,[b,"Siemens"],[x,M]],[/\b(rct\w+) b/i],[_,[b,"RCA"],[x,H]],[/\b(venue[\d ]{2,7}) b/i],[_,[b,"Dell"],[x,H]],[/\b(q(?:mv|ta)\w+) b/i],[_,[b,"Verizon"],[x,H]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[b,"Barnes & Noble"],[x,H]],[/\b(tm\d{3}\w+) b/i],[_,[b,"NuVision"],[x,H]],[/\b(k88) b/i],[_,[b,"ZTE"],[x,H]],[/\b(nx\d{3}j) b/i],[_,[b,"ZTE"],[x,M]],[/\b(gen\d{3}) b.+49h/i],[_,[b,"Swiss"],[x,M]],[/\b(zur\d{3}) b/i],[_,[b,"Swiss"],[x,H]],[/\b((zeki)?tb.*\b) b/i],[_,[b,"Zeki"],[x,H]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],_,[x,H]],[/\b(ns-?\w{0,9}) b/i],[_,[b,"Insignia"],[x,H]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[b,"NextBook"],[x,H]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],_,[x,M]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],_,[x,M]],[/\b(ph-1) /i],[_,[b,"Essential"],[x,M]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[b,"Envizen"],[x,H]],[/\b(trio[-\w\. ]+) b/i],[_,[b,"MachSpeed"],[x,H]],[/\btu_(1491) b/i],[_,[b,"Rotor"],[x,H]],[/(shield[\w ]+) b/i],[_,[b,"Nvidia"],[x,H]],[/(sprint) (\w+)/i],[b,_,[x,M]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[b,Mt],[x,M]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[b,Q],[x,H]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[b,Q],[x,M]],[/smart-tv.+(samsung)/i],[b,[x,K]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[b,Ie],[x,K]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,Vt],[x,K]],[/(apple) ?tv/i],[b,[_,Z+" TV"],[x,K]],[/crkey/i],[[_,Te+"cast"],[b,vt],[x,K]],[/droid.+aft(\w+)( bui|\))/i],[_,[b,te],[x,K]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[b,Ve],[x,K]],[/(bravia[\w ]+)( bui|\))/i],[_,[b,we],[x,K]],[/(mitv-\w{5}) bui/i],[_,[b,P],[x,K]],[/Hbbtv.*(technisat) (.*);/i],[b,_,[x,K]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,Cm],[_,Cm],[x,K]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[x,K]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,_,[x,k]],[/droid.+; (shield) bui/i],[_,[b,"Nvidia"],[x,k]],[/(playstation [345portablevi]+)/i],[_,[b,we],[x,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[b,Mt],[x,k]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[_,[b,Ie],[x,X]],[/((pebble))app/i],[b,_,[x,X]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[b,Z],[x,X]],[/droid.+; (glass) \d/i],[_,[b,vt],[x,X]],[/droid.+; (wt63?0{2,3})\)/i],[_,[b,Q],[x,X]],[/droid.+; (glass) \d/i],[_,[b,vt],[x,X]],[/(pico) (4|neo3(?: link|pro)?)/i],[b,_,[x,X]],[/; (quest( \d| pro)?)/i],[_,[b,re],[x,X]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[x,se]],[/(aeobc)\b/i],[_,[b,te],[x,se]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[_,[x,M]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[x,H]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[x,H]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[x,M]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[E,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[E,C],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[E,C],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,C],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[E,[C,jh,Zv]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[C,jh,Zv],[E,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,ht],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,C],[/\(bb(10);/i],[C,[E,fe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[C,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[E,_t+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[E,Te+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,Re],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,C],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[E,C]]},Di=function(zr,Xr){if(typeof zr===h&&(Xr=zr,zr=i),!(this instanceof Di))return new Di(zr,Xr).getResult();var lr=typeof r!==d&&r.navigator?r.navigator:i,Cn=zr||(lr&&lr.userAgent?lr.userAgent:""),Ka=lr&&lr.userAgentData?lr.userAgentData:i,jr=Xr?function(At,qa){var Id={};for(var Do in At)qa[Do]&&qa[Do].length%2==0?Id[Do]=qa[Do].concat(At[Do]):Id[Do]=At[Do];return Id}(ey,Xr):ey,uc=lr&&lr.userAgent==Cn;return this.getBrowser=function(){var At={};return At[E]=i,At[C]=i,Ad.call(At,Cn,jr.browser),At[m]=function(qa){return typeof qa===p?qa.replace(/[^\d\.]/g,"").split(".")[0]:i}(At[C]),uc&&lr&&lr.brave&&typeof lr.brave.isBrave==c&&(At[E]="Brave"),At},this.getCPU=function(){var At={};return At[U]=i,Ad.call(At,Cn,jr.cpu),At},this.getDevice=function(){var At={};return At[b]=i,At[_]=i,At[x]=i,Ad.call(At,Cn,jr.device),uc&&!At[x]&&Ka&&Ka.mobile&&(At[x]=M),uc&&At[_]=="Macintosh"&&lr&&typeof lr.standalone!==d&&lr.maxTouchPoints&&lr.maxTouchPoints>2&&(At[_]="iPad",At[x]=H),At},this.getEngine=function(){var At={};return At[E]=i,At[C]=i,Ad.call(At,Cn,jr.engine),At},this.getOS=function(){var At={};return At[E]=i,At[C]=i,Ad.call(At,Cn,jr.os),uc&&!At[E]&&Ka&&Ka.platform&&Ka.platform!="Unknown"&&(At[E]=Ka.platform.replace(/chrome os/i,Re).replace(/macos/i,ht)),At},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Cn},this.setUA=function(At){return Cn=typeof At===p&&At.length>500?Cm(At,500):At,this},this.setUA(Cn),this};Di.VERSION="0.7.40",Di.BROWSER=$r([E,C,m]),Di.CPU=$r([U]),Di.DEVICE=$r([_,b,x,k,M,K,H,X,se]),Di.ENGINE=Di.OS=$r([E,C]),e.exports&&(t=e.exports=Di),t.UAParser=Di;var dc=typeof r!==d&&(r.jQuery||r.Zepto);if(dc&&!dc.ua){var ty=new Di;dc.ua=ty.getResult(),dc.ua.get=function(){return ty.getUA()},dc.ua.set=function(zr){ty.setUA(zr);var Xr=ty.getResult();for(var lr in Xr)dc.ua[lr]=Xr[lr]}}})(typeof window=="object"?window:l)})(RS,RS.exports);var Ste=u(RS.exports),C1=T_.clear;qt({global:!0,bind:!0,forced:B.clearImmediate!==C1},{clearImmediate:C1});var T1=B,Cte=O,Tte=me,Rte=Lb,Nte=ln,Ate=Oc,Ite=Xl,Ote=T1.Function,Dte=/MSIE .\./.test(Nte)||Rte==="BUN"&&function(){var e=T1.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Pte=qt,R1=B,N1=T_.set,kte=function(e,t){var r=1;return Dte?function(i,c){var d=Ite(arguments.length,1)>r,h=Tte(i)?i:Ote(i),p=d?Ate(arguments,r):[],m=d?function(){Cte(h,this,p)}:h;return e(m)}:e},A1=R1.setImmediate?kte(N1):N1;Pte({global:!0,bind:!0,forced:R1.setImmediate!==A1},{setImmediate:A1});var I1=u(Pr.setImmediate),jte=B,Lte=WD,Mte=Qn,Fte=Xl,Ute=_e;qt({global:!0,dontCallGetSet:!0,forced:f(function(){return Ute&&Object.getOwnPropertyDescriptor(jte,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){Fte(arguments.length,1),Lte(Mte(e))}});var O1=u(Pr.queueMicrotask);function D1(e,t){return function(){return e.apply(t,arguments)}}let{toString:Vte}=Object.prototype,{getPrototypeOf:NS}=Object,{iterator:eE,toStringTag:P1}=Symbol,tE=(AS=Object.create(null),e=>{let t=Vte.call(e);return AS[t]||(AS[t]=t.slice(8,-1).toLowerCase())});var AS;let Oa=e=>(e=e.toLowerCase(),t=>tE(t)===e),rE=e=>t=>typeof t===e,{isArray:Gu}=Array,bf=rE("undefined"),k1=Oa("ArrayBuffer"),Bte=rE("string"),ei=rE("function"),j1=rE("number"),sE=e=>e!==null&&typeof e=="object",nE=e=>{if(tE(e)!=="object")return!1;let t=NS(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||P1 in e||eE in e)},Wte=Oa("Date"),Gte=Oa("File"),Hte=Oa("Blob"),zte=Oa("FileList"),Kte=Oa("URLSearchParams"),[qte,Yte,$te,Xte]=["ReadableStream","Request","Response","Headers"].map(Oa);function wf(e,t){let r,i,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Gu(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{let d=c?Object.getOwnPropertyNames(e):Object.keys(e),h=d.length,p;for(r=0;r<h;r++)p=d[r],t.call(null,e[p],p,e)}}function L1(e,t){t=t.toLowerCase();let r=Object.keys(e),i,c=r.length;for(;c-- >0;)if(i=r[c],t===i.toLowerCase())return i;return null}let rd=S1!==void 0?S1:typeof self<"u"?self:typeof window<"u"?window:global,M1=e=>!bf(e)&&e!==rd,Jte=(IS=typeof Uint8Array<"u"&&NS(Uint8Array),e=>IS&&e instanceof IS);var IS;let Qte=Oa("HTMLFormElement"),F1=(e=>{let{hasOwnProperty:t}=e;return(r,i)=>t.call(r,i)})(Object.prototype),Zte=Oa("RegExp"),U1=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),i={};wf(r,(c,d)=>{let h;(h=t(c,d,e))!==!1&&(i[d]=h||c)}),Object.defineProperties(e,i)},ere=Oa("AsyncFunction"),V1=(B1=typeof I1=="function",W1=ei(rd.postMessage),B1?I1:W1?(OS="axios@".concat(Math.random()),iE=[],rd.addEventListener("message",e=>{let{source:t,data:r}=e;t===rd&&r===OS&&iE.length&&iE.shift()()},!1),e=>{iE.push(e),rd.postMessage(OS,"*")}):e=>setTimeout(e));var B1,W1,OS,iE;let tre=O1!==void 0?O1.bind(rd):typeof process<"u"&&process.nextTick||V1;var ke={isArray:Gu,isArrayBuffer:k1,isBuffer:function(e){return e!==null&&!bf(e)&&e.constructor!==null&&!bf(e.constructor)&&ei(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ei(e.append)&&((t=tE(e))==="formdata"||t==="object"&&ei(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&k1(e.buffer),t},isString:Bte,isNumber:j1,isBoolean:e=>e===!0||e===!1,isObject:sE,isPlainObject:nE,isReadableStream:qte,isRequest:Yte,isResponse:$te,isHeaders:Xte,isUndefined:bf,isDate:Wte,isFile:Gte,isBlob:Hte,isRegExp:Zte,isFunction:ei,isStream:e=>sE(e)&&ei(e.pipe),isURLSearchParams:Kte,isTypedArray:Jte,isFileList:zte,forEach:wf,merge:function e(){let{caseless:t}=M1(this)&&this||{},r={},i=(c,d)=>{let h=t&&L1(r,d)||d;nE(r[h])&&nE(c)?r[h]=e(r[h],c):nE(c)?r[h]=e({},c):Gu(c)?r[h]=c.slice():r[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&wf(arguments[c],i);return r},extend:function(e,t,r){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return wf(t,(c,d)=>{r&&ei(c)?e[d]=D1(c,r):e[d]=c},{allOwnKeys:i}),e},trim:e=>Ks(e)?Ks(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,i)=>{let c,d,h,p={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),d=c.length;d-- >0;)h=c[d],i&&!i(h,e,t)||p[h]||(t[h]=e[h],p[h]=!0);e=r!==!1&&NS(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:tE,kindOfTest:Oa,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;let i=e.indexOf(t,r);return i!==-1&&i===r},toArray:e=>{if(!e)return null;if(Gu(e))return e;let t=e.length;if(!j1(t))return null;let r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{let r=(e&&e[eE]).call(e),i;for(;(i=r.next())&&!i.done;){let c=i.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let r,i=[];for(;(r=e.exec(t))!==null;)i.push(r);return i},isHTMLForm:Qte,hasOwnProperty:F1,hasOwnProp:F1,reduceDescriptors:U1,freezeMethods:e=>{U1(e,(t,r)=>{if(ei(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;let i=e[r];ei(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{let r={},i=c=>{c.forEach(d=>{r[d]=!0})};return Gu(e)?i(e):i(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:L1,global:rd,isContextDefined:M1,isSpecCompliantForm:function(e){return!!(e&&ei(e.append)&&e[P1]==="FormData"&&e[eE])},toJSONObject:e=>{let t=new Array(10),r=(i,c)=>{if(sE(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[c]=i;let d=Gu(i)?[]:{};return wf(i,(h,p)=>{let m=r(h,c+1);!bf(m)&&(d[p]=m)}),t[c]=void 0,d}}return i};return r(e,0)},isAsyncFn:ere,isThenable:e=>e&&(sE(e)||ei(e))&&ei(e.then)&&ei(e.catch),setImmediate:V1,asap:tre,isIterable:e=>e!=null&&ei(e[eE])};function Jt(e,t,r,i,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),c&&(this.response=c,this.status=c.status?c.status:null)}ke.inherits(Jt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ke.toJSONObject(this.config),code:this.code,status:this.status}}});let G1=Jt.prototype,H1={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{H1[e]={value:e}}),Object.defineProperties(Jt,H1),Object.defineProperty(G1,"isAxiosError",{value:!0}),Jt.from=(e,t,r,i,c,d)=>{let h=Object.create(G1);return ke.toFlatObject(e,h,function(p){return p!==Error.prototype},p=>p!=="isAxiosError"),Jt.call(h,e.message,t,r,i,c),h.cause=e,h.name=e.name,d&&Object.assign(h,d),h};function DS(e){return ke.isPlainObject(e)||ke.isArray(e)}function z1(e){return ke.endsWith(e,"[]")?e.slice(0,-2):e}function K1(e,t,r){return e?e.concat(t).map(function(i,c){return i=z1(i),!r&&c?"["+i+"]":i}).join(r?".":""):t}let rre=ke.toFlatObject(ke,{},null,function(e){return/^is[A-Z]/.test(e)});function aE(e,t,r){if(!ke.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let i=(r=ke.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,C){return!ke.isUndefined(C[b])})).metaTokens,c=r.visitor||_,d=r.dots,h=r.indexes,p=(r.Blob||typeof Blob<"u"&&Blob)&&ke.isSpecCompliantForm(t);if(!ke.isFunction(c))throw new TypeError("visitor must be a function");function m(b){if(b===null)return"";if(ke.isDate(b))return b.toISOString();if(!p&&ke.isBlob(b))throw new Jt("Blob is not supported. Use a Buffer instead.");return ke.isArrayBuffer(b)||ke.isTypedArray(b)?p&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function _(b,C,U){let k=b;if(b&&!U&&typeof b=="object"){if(ke.endsWith(C,"{}"))C=i?C:C.slice(0,-2),b=JSON.stringify(b);else if(ke.isArray(b)&&function(M){return ke.isArray(M)&&!M.some(DS)}(b)||(ke.isFileList(b)||ke.endsWith(C,"[]"))&&(k=ke.toArray(b)))return C=z1(C),k.forEach(function(M,H){!ke.isUndefined(M)&&M!==null&&t.append(h===!0?K1([C],H,d):h===null?C:C+"[]",m(M))}),!1}return!!DS(b)||(t.append(K1(U,C,d),m(b)),!1)}let E=[],x=Object.assign(rre,{defaultVisitor:_,convertValue:m,isVisitable:DS});if(!ke.isObject(e))throw new TypeError("data must be an object");return function b(C,U){if(!ke.isUndefined(C)){if(E.indexOf(C)!==-1)throw Error("Circular reference detected in "+U.join("."));E.push(C),ke.forEach(C,function(k,M){(!(ke.isUndefined(k)||k===null)&&c.call(t,k,ke.isString(M)?Ks(M).call(M):M,U,x))===!0&&b(k,U?U.concat(M):[M])}),E.pop()}}(e),t}function q1(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function PS(e,t){this._pairs=[],e&&aE(e,this,t)}let Y1=PS.prototype;function sre(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $1(e,t,r){if(!t)return e;let i=r&&r.encode||sre;ke.isFunction(r)&&(r={serialize:r});let c=r&&r.serialize,d;if(d=c?c(t,r):ke.isURLSearchParams(t)?t.toString():new PS(t,r).toString(i),d){let h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+d}return e}Y1.append=function(e,t){this._pairs.push([e,t])},Y1.toString=function(e){let t=e?function(r){return e.call(this,r,q1)}:q1;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var X1=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ke.forEach(this.handlers,function(t){t!==null&&e(t)})}},J1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Q1={exports:{}},nre=qt,ire=_e,Z1=Gi.f;nre({target:"Object",stat:!0,forced:Object.defineProperty!==Z1,sham:!ire},{defineProperty:Z1});var ej=Pr.Object,are=Q1.exports=function(e,t,r){return ej.defineProperty(e,t,r)};ej.defineProperty.sham&&(are.sham=!0);var tj=u(Q1.exports),ore=TypeError,rj=tf,cre=C_,lre=jt,dre=Kr("species"),sj=Array,ure=function(e){var t;return rj(e)&&(t=e.constructor,(cre(t)&&(t===sj||rj(t.prototype))||lre(t)&&(t=t[dre])===null)&&(t=void 0)),t===void 0?sj:t},nj=function(e,t){return new(ure(e))(t===0?0:t)},hre=f,pre=Ta,fre=Kr("species"),ij=function(e){return pre>=51||!hre(function(){var t=[];return(t.constructor={})[fre]=function(){return{foo:1}},t[e](Boolean).foo!==1})},mre=qt,gre=f,_re=tf,Ere=jt,vre=ho,yre=Nc,aj=function(e){if(e>9007199254740991)throw ore("Maximum allowed index exceeded");return e},oj=$w,xre=nj,bre=ij,wre=Ta,cj=Kr("isConcatSpreadable"),Sre=wre>=51||!gre(function(){var e=[];return e[cj]=!1,e.concat()[0]!==e}),Cre=function(e){if(!Ere(e))return!1;var t=e[cj];return t!==void 0?!!t:_re(e)};mre({target:"Array",proto:!0,forced:!Sre||!bre("concat")},{concat:function(e){var t,r,i,c,d,h=vre(this),p=xre(h,0),m=0;for(t=-1,i=arguments.length;t<i;t++)if(Cre(d=t===-1?h:arguments[t]))for(c=yre(d),aj(m+c),r=0;r<c;r++,m++)r in d&&oj(p,m,d[r]);else aj(m+1),oj(p,m++,d);return p.length=m,p}});var lj={},Tre=$,Rre=ft,dj=l_.f,Nre=Oc,uj=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];lj.f=function(e){return uj&&Tre(e)==="Window"?function(t){try{return dj(t)}catch{return Nre(uj)}}(e):dj(Rre(e))};var Hu={},Are=Kr;Hu.f=Are;var hj=Pr,Ire=Us,Ore=Hu,Dre=Gi.f,ds=function(e){var t=hj.Symbol||(hj.Symbol={});Ire(t,e)||Dre(t,e,{value:Ore.f(e)})},Pre=Oe,kre=xs,jre=Kr,Lre=Ic,pj=function(){var e=kre("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,i=jre("toPrimitive");t&&!t[i]&&Lre(t,i,function(c){return Pre(r,this)},{})},Mre=Rc,Fre=Ze,Ure=ho,Vre=Nc,Bre=nj;S([].push);var Wre=function(e){return function(t,r,i,c){for(var d,h,p=Ure(t),m=Fre(p),_=Vre(m),E=Mre(r,i),x=0,b=c||Bre,C=void 0;_>x;x++)x in m&&(h=E(d=m[x],x,p));return C}},fj={forEach:Wre(0)},oE=qt,Sf=B,kS=Oe,Gre=S,zu=_e,Ku=Jn,Hre=f,Zs=Us,zre=I,jS=jn,cE=ft,LS=wb,Kre=Zn,MS=yt,qu=sf,mj=u_,qre=l_,gj=lj,Yre=rf,_j=ve,Ej=Gi,$re=Gb,vj=ae,yj=Ic,Xre=S_,FS=yu,xj=d_,bj=xb,Jre=Kr,Qre=Hu,Zre=ds,ese=pj,tse=$o,wj=$l,lE=fj.forEach,ti=c_("hidden"),dE="Symbol",Cf="prototype",rse=wj.set,Sj=wj.getterFor(dE),Da=Object[Cf],sd=Sf.Symbol,uE=sd&&sd[Cf],sse=Sf.RangeError,nse=Sf.TypeError,US=Sf.QObject,Cj=_j.f,nd=Ej.f,Tj=gj.f,ise=vj.f,Rj=Gre([].push),Qo=FS("symbols"),Tf=FS("op-symbols"),ase=FS("wks"),VS=!US||!US[Cf]||!US[Cf].findChild,Nj=function(e,t,r){var i=Cj(Da,t);i&&delete Da[t],nd(e,t,r),i&&e!==Da&&nd(Da,t,i)},BS=zu&&Hre(function(){return qu(nd({},"a",{get:function(){return nd(this,"a",{value:7}).a}})).a!==7})?Nj:nd,WS=function(e,t){var r=Qo[e]=qu(uE);return rse(r,{type:dE,tag:e,description:t}),zu||(r.description=t),r},hE=function(e,t,r){e===Da&&hE(Tf,t,r),jS(e);var i=LS(t);return jS(r),Zs(Qo,i)?(r.enumerable?(Zs(e,ti)&&e[ti][i]&&(e[ti][i]=!1),r=qu(r,{enumerable:MS(0,!1)})):(Zs(e,ti)||nd(e,ti,MS(1,qu(null))),e[ti][i]=!0),BS(e,i,r)):nd(e,i,r)},GS=function(e,t){jS(e);var r=cE(t),i=mj(r).concat(Dj(r));return lE(i,function(c){zu&&!kS(Aj,r,c)||hE(e,c,r[c])}),e},Aj=function(e){var t=LS(e),r=kS(ise,this,t);return!(this===Da&&Zs(Qo,t)&&!Zs(Tf,t))&&(!(r||!Zs(this,t)||!Zs(Qo,t)||Zs(this,ti)&&this[ti][t])||r)},Ij=function(e,t){var r=cE(e),i=LS(t);if(r!==Da||!Zs(Qo,i)||Zs(Tf,i)){var c=Cj(r,i);return!c||!Zs(Qo,i)||Zs(r,ti)&&r[ti][i]||(c.enumerable=!0),c}},Oj=function(e){var t=Tj(cE(e)),r=[];return lE(t,function(i){Zs(Qo,i)||Zs(xj,i)||Rj(r,i)}),r},Dj=function(e){var t=e===Da,r=Tj(t?Tf:cE(e)),i=[];return lE(r,function(c){!Zs(Qo,c)||t&&!Zs(Da,c)||Rj(i,Qo[c])}),i};Ku||(sd=function(){if(zre(uE,this))throw new nse("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Kre(arguments[0]):void 0,t=bj(e),r=function(i){var c=this===void 0?Sf:this;c===Da&&kS(r,Tf,i),Zs(c,ti)&&Zs(c[ti],t)&&(c[ti][t]=!1);var d=MS(1,i);try{BS(c,t,d)}catch(h){if(!(h instanceof sse))throw h;Nj(c,t,d)}};return zu&&VS&&BS(Da,t,{configurable:!0,set:r}),WS(t,e)},yj(uE=sd[Cf],"toString",function(){return Sj(this).tag}),yj(sd,"withoutSetter",function(e){return WS(bj(e),e)}),vj.f=Aj,Ej.f=hE,$re.f=GS,_j.f=Ij,qre.f=gj.f=Oj,Yre.f=Dj,Qre.f=function(e){return WS(Jre(e),e)},zu&&Xre(uE,"description",{configurable:!0,get:function(){return Sj(this).description}})),oE({global:!0,wrap:!0,forced:!Ku,sham:!Ku},{Symbol:sd}),lE(mj(ase),function(e){Zre(e)}),oE({target:dE,stat:!0,forced:!Ku},{useSetter:function(){VS=!0},useSimple:function(){VS=!1}}),oE({target:"Object",stat:!0,forced:!Ku,sham:!zu},{create:function(e,t){return t===void 0?qu(e):GS(qu(e),t)},defineProperty:hE,defineProperties:GS,getOwnPropertyDescriptor:Ij}),oE({target:"Object",stat:!0,forced:!Ku},{getOwnPropertyNames:Oj}),ese(),tse(sd,dE),xj[ti]=!0;var Pj=Jn&&!!Symbol.for&&!!Symbol.keyFor,ose=qt,cse=xs,lse=Us,dse=Zn,kj=yu,use=Pj,HS=kj("string-to-symbol-registry"),hse=kj("symbol-to-string-registry");ose({target:"Symbol",stat:!0,forced:!use},{for:function(e){var t=dse(e);if(lse(HS,t))return HS[t];var r=cse("Symbol")(t);return HS[t]=r,hse[r]=t,r}});var pse=qt,fse=Us,mse=Jp,gse=vu,_se=Pj,jj=yu("symbol-to-string-registry");pse({target:"Symbol",stat:!0,forced:!_se},{keyFor:function(e){if(!mse(e))throw new TypeError(gse(e)+" is not a symbol");if(fse(jj,e))return jj[e]}});var Lj=tf,Ese=me,Mj=$,vse=Zn,Fj=S([].push),yse=qt,Uj=xs,Vj=O,xse=Oe,Rf=S,Bj=f,Wj=me,Gj=Jp,Hj=Oc,bse=function(e){if(Ese(e))return e;if(Lj(e)){for(var t=e.length,r=[],i=0;i<t;i++){var c=e[i];typeof c=="string"?Fj(r,c):typeof c!="number"&&Mj(c)!=="Number"&&Mj(c)!=="String"||Fj(r,vse(c))}var d=r.length,h=!0;return function(p,m){if(h)return h=!1,m;if(Lj(this))return m;for(var _=0;_<d;_++)if(r[_]===p)return m}}},wse=Jn,Sse=String,Mc=Uj("JSON","stringify"),pE=Rf(/./.exec),zj=Rf("".charAt),Cse=Rf("".charCodeAt),Tse=Rf("".replace),Rse=Rf(1 .toString),Nse=/[\uD800-\uDFFF]/g,Kj=/^[\uD800-\uDBFF]$/,qj=/^[\uDC00-\uDFFF]$/,Yj=!wse||Bj(function(){var e=Uj("Symbol")("stringify detection");return Mc([e])!=="[null]"||Mc({a:e})!=="{}"||Mc(Object(e))!=="{}"}),$j=Bj(function(){return Mc("\uDF06\uD834")!=='"\\udf06\\ud834"'||Mc("\uDEAD")!=='"\\udead"'}),Ase=function(e,t){var r=Hj(arguments),i=bse(t);if(Wj(i)||e!==void 0&&!Gj(e))return r[1]=function(c,d){if(Wj(i)&&(d=xse(i,this,Sse(c),d)),!Gj(d))return d},Vj(Mc,null,r)},Ise=function(e,t,r){var i=zj(r,t-1),c=zj(r,t+1);return pE(Kj,e)&&!pE(qj,c)||pE(qj,e)&&!pE(Kj,i)?"\\u"+Rse(Cse(e,0),16):e};Mc&&yse({target:"JSON",stat:!0,forced:Yj||$j},{stringify:function(e,t,r){var i=Hj(arguments),c=Vj(Yj?Ase:Mc,null,i);return $j&&typeof c=="string"?Tse(c,Nse,Ise):c}});var Xj=rf,Ose=ho;qt({target:"Object",stat:!0,forced:!Jn||f(function(){Xj.f(1)})},{getOwnPropertySymbols:function(e){var t=Xj.f;return t?t(Ose(e)):[]}}),ds("asyncIterator"),ds("hasInstance"),ds("isConcatSpreadable"),ds("iterator"),ds("match"),ds("matchAll"),ds("replace"),ds("search"),ds("species"),ds("split");var Dse=pj;ds("toPrimitive"),Dse();var Pse=xs,kse=$o;ds("toStringTag"),kse(Pse("Symbol"),"Symbol"),ds("unscopables"),$o(B.JSON,"JSON",!0);var jse=Pr.Symbol,Lse=Kr,Mse=Gi.f,Jj=Lse("metadata"),Qj=Function.prototype;Qj[Jj]===void 0&&Mse(Qj,Jj,{value:null}),ds("asyncDispose"),ds("dispose"),ds("metadata");var Fse=jse,Use=S,zS=xs("Symbol"),Vse=zS.keyFor,Bse=Use(zS.prototype.valueOf),Zj=zS.isRegisteredSymbol||function(e){try{return Vse(Bse(e))!==void 0}catch{return!1}};qt({target:"Symbol",stat:!0},{isRegisteredSymbol:Zj});for(var Wse=yu,eL=xs,Gse=S,Hse=Jp,zse=Kr,fE=eL("Symbol"),tL=fE.isWellKnownSymbol,rL=eL("Object","getOwnPropertyNames"),Kse=Gse(fE.prototype.valueOf),sL=Wse("wks"),KS=0,nL=rL(fE),qse=nL.length;KS<qse;KS++)try{var iL=nL[KS];Hse(fE[iL])&&zse(iL)}catch{}var aL=function(e){if(tL&&tL(e))return!0;try{for(var t=Kse(e),r=0,i=rL(sL),c=i.length;r<c;r++)if(sL[i[r]]==t)return!0}catch{}return!1};qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:aL}),ds("customMatcher"),ds("observable"),qt({target:"Symbol",stat:!0},{isRegistered:Zj}),qt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:aL}),ds("matcher"),ds("metadataKey"),ds("patternMatch"),ds("replaceAll");var Yu=u(Fse),oL=u(Hu.f("iterator"));function Nf(e){return Nf=typeof Yu=="function"&&typeof oL=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Yu=="function"&&t.constructor===Yu&&t!==Yu.prototype?"symbol":typeof t},Nf(e)}var Yse=u(Hu.f("toPrimitive"));function $se(e){var t=function(r,i){if(Nf(r)!="object"||!r)return r;var c=r[Yse];if(c!==void 0){var d=c.call(r,i);if(Nf(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(r)}(e,"string");return Nf(t)=="symbol"?t:t+""}function W(e,t,r){return(t=$se(t))in e?tj(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var cL=u($Z),Xse={isBrowser:!0,classes:{URLSearchParams:cL!==void 0?cL:PS,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let qS=typeof window<"u"&&typeof document<"u",YS=typeof navigator=="object"&&navigator||void 0,Jse=qS&&(!YS||["ReactNative","NativeScript","NS"].indexOf(YS.product)<0),Qse=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Zse=qS&&window.location.href||"http://localhost";function lL(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function dL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lL(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lL(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var vn=dL(dL({},Object.freeze({__proto__:null,hasBrowserEnv:qS,hasStandardBrowserEnv:Jse,hasStandardBrowserWebWorkerEnv:Qse,navigator:YS,origin:Zse})),Xse),ene=jn,tne=Oe,rne=Us,sne=I,nne=function(){var e=ene(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},uL=RegExp.prototype,hL=function(e){var t=e.flags;return t!==void 0||"flags"in uL||rne(e,"flags")||!sne(uL,e)?t:tne(nne,e)},ine=jw.charAt,pL=Oe,ane=jn,one=me,cne=$,lne=/./.exec,dne=TypeError,une=qt,fL=Oe,mL=ne,hne=rw,mE=b_,gL=kt,_L=_O,Af=Zn,pne=jn,fne=jt,mne=$,gne=vO,EL=hL,_ne=r_,Ene=f,vne=cw,yne=function(e,t,r){return t+(r?ine(e,t).length:1)},xne=function(e,t){var r=e.exec;if(one(r)){var i=pL(r,e,t);return i!==null&&ane(i),i}if(cne(e)==="RegExp")return pL(lne,e,t);throw new dne("RegExp#exec called on incompatible receiver")},vL=$l,bne=Kr("matchAll"),yL="RegExp String",xL=yL+" Iterator",wne=vL.set,Sne=vL.getterFor(xL),Cne=TypeError,$S=mL("".indexOf),gE=mL("".matchAll),XS=!!gE&&!Ene(function(){gE("a",/./)}),Tne=hne(function(e,t,r,i){wne(this,{type:xL,regexp:e,string:t,global:r,unicode:i,done:!1})},yL,function(){var e=Sne(this);if(e.done)return mE(void 0,!0);var t=e.regexp,r=e.string,i=xne(t,r);return i===null?(e.done=!0,mE(void 0,!0)):e.global?(Af(i[0])===""&&(t.lastIndex=yne(r,_L(t.lastIndex),e.unicode)),mE(i,!1)):(e.done=!0,mE(i,!1))}),bL=function(e){var t,r,i,c=pne(this),d=Af(e),h=vne(c,RegExp),p=Af(EL(c));return t=new h(h===RegExp?c.source:c,p),r=!!~$S(p,"g"),i=!!~$S(p,"u"),t.lastIndex=_L(c.lastIndex),new Tne(t,d,r,i)};une({target:"String",proto:!0,forced:XS},{matchAll:function(e){var t,r,i,c,d=gL(this);if(fne(e)){if(gne(e)&&(t=Af(gL(EL(e))),!~$S(t,"g")))throw new Cne("`.matchAll` does not allow non-global regexes");if(XS)return gE(d,e);if((i=_ne(e,bne))===void 0&&mne(e)==="RegExp"&&(i=bL),i)return fL(i,e,d)}else if(XS)return gE(d,e);return r=Af(d),c=new RegExp(e,"g"),fL(bL,c,r)}});var Rne=Hi("String","matchAll"),Nne=I,Ane=Rne,JS=String.prototype,Ine=function(e){var t=e.matchAll;return typeof e=="string"||e===JS||Nne(JS,e)&&t===JS.matchAll?Ane:t},One=u(Ine);function wL(e){function t(r,i,c,d){let h=r[d++];if(h==="__proto__")return!0;let p=Number.isFinite(+h),m=d>=r.length;return h=!h&&ke.isArray(c)?c.length:h,m?(ke.hasOwnProp(c,h)?c[h]=[c[h],i]:c[h]=i,!p):(c[h]&&ke.isObject(c[h])||(c[h]=[]),t(r,i,c[h],d)&&ke.isArray(c[h])&&(c[h]=function(_){let E={},x=Object.keys(_),b,C=x.length,U;for(b=0;b<C;b++)U=x[b],E[U]=_[U];return E}(c[h])),!p)}if(ke.isFormData(e)&&ke.isFunction(e.entries)){let r={};return ke.forEachEntry(e,(i,c)=>{t(function(d){return One(ke).call(ke,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(i),c,r,0)}),r}return null}let QS={transitional:J1,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let r=t.getContentType()||"",i=r.indexOf("application/json")>-1,c=ke.isObject(e);if(c&&ke.isHTMLForm(e)&&(e=new FormData(e)),ke.isFormData(e))return i?JSON.stringify(wL(e)):e;if(ke.isArrayBuffer(e)||ke.isBuffer(e)||ke.isStream(e)||ke.isFile(e)||ke.isBlob(e)||ke.isReadableStream(e))return e;if(ke.isArrayBufferView(e))return e.buffer;if(ke.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(c){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(h,p){return aE(h,new vn.classes.URLSearchParams,Object.assign({visitor:function(m,_,E,x){return vn.isNode&&ke.isBuffer(m)?(this.append(_,m.toString("base64")),!1):x.defaultVisitor.apply(this,arguments)}},p))}(e,this.formSerializer).toString();if((d=ke.isFileList(e))||r.indexOf("multipart/form-data")>-1){let h=this.env&&this.env.FormData;return aE(d?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||i?(t.setContentType("application/json",!1),function(h,p,m){if(ke.isString(h))try{return(p||JSON.parse)(h),Ks(ke).call(ke,h)}catch(_){if(_.name!=="SyntaxError")throw _}return(m||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){let t=this.transitional||QS.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(ke.isResponse(e)||ke.isReadableStream(e))return e;if(e&&ke.isString(e)&&(r&&!this.responseType||i)){let c=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(d){if(c)throw d.name==="SyntaxError"?Jt.from(d,Jt.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:vn.classes.FormData,Blob:vn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ke.forEach(["delete","get","head","post","put","patch"],e=>{QS.headers[e]={}});var ZS=QS;let Dne=ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),SL=Symbol("internals");function If(e){var t;return e&&Ks(t=String(e)).call(t).toLowerCase()}function _E(e){return e===!1||e==null?e:ke.isArray(e)?e.map(_E):String(e)}function e0(e,t,r,i,c){return ke.isFunction(i)?i.call(this,t,r):(c&&(t=r),ke.isString(t)?ke.isString(i)?t.indexOf(i)!==-1:ke.isRegExp(i)?i.test(t):void 0:void 0)}class EE{constructor(t){t&&this.set(t)}set(t,r,i){let c=this;function d(m,_,E){let x=If(_);if(!x)throw new Error("header name must be a non-empty string");let b=ke.findKey(c,x);(!b||c[b]===void 0||E===!0||E===void 0&&c[b]!==!1)&&(c[b||_]=_E(m))}let h=(m,_)=>ke.forEach(m,(E,x)=>d(E,x,_));if(ke.isPlainObject(t)||t instanceof this.constructor)h(t,r);else if(ke.isString(t)&&(t=Ks(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ks(p=t).call(p)))h((m=>{let _={},E,x,b;return m&&m.split(`
`).forEach(function(C){var U,k;b=C.indexOf(":"),E=Ks(U=C.substring(0,b)).call(U).toLowerCase(),x=Ks(k=C.substring(b+1)).call(k),!E||_[E]&&Dne[E]||(E==="set-cookie"?_[E]?_[E].push(x):_[E]=[x]:_[E]=_[E]?_[E]+", "+x:x)}),_})(t),r);else if(ke.isObject(t)&&ke.isIterable(t)){let m,_,E={};for(let x of t){if(!ke.isArray(x))throw TypeError("Object iterator must return a key-value pair");E[_=x[0]]=(m=E[_])?ke.isArray(m)?[...m,x[1]]:[m,x[1]]:x[1]}h(E,r)}else t!=null&&d(r,t,i);var p;return this}get(t,r){if(t=If(t)){let i=ke.findKey(this,t);if(i){let c=this[i];if(!r)return c;if(r===!0)return function(d){let h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,m;for(;m=p.exec(d);)h[m[1]]=m[2];return h}(c);if(ke.isFunction(r))return r.call(this,c,i);if(ke.isRegExp(r))return r.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=If(t)){let i=ke.findKey(this,t);return!(!i||this[i]===void 0||r&&!e0(0,this[i],i,r))}return!1}delete(t,r){let i=this,c=!1;function d(h){if(h=If(h)){let p=ke.findKey(i,h);!p||r&&!e0(0,i[p],p,r)||(delete i[p],c=!0)}}return ke.isArray(t)?t.forEach(d):d(t),c}clear(t){let r=Object.keys(this),i=r.length,c=!1;for(;i--;){let d=r[i];t&&!e0(0,this[d],d,t,!0)||(delete this[d],c=!0)}return c}normalize(t){let r=this,i={};return ke.forEach(this,(c,d)=>{var h;let p=ke.findKey(i,d);if(p)return r[p]=_E(c),void delete r[d];let m=t?function(_){return Ks(_).call(_).toLowerCase().replace(/([a-z\d])(\w*)/g,(E,x,b)=>x.toUpperCase()+b)}(d):Ks(h=String(d)).call(h);m!==d&&delete r[d],r[m]=_E(c),i[m]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.constructor.concat(this,...r)}toJSON(t){let r=Object.create(null);return ke.forEach(this,(i,c)=>{i!=null&&i!==!1&&(r[c]=t&&ke.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,i]=t;return r+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let r=new this(t);for(var i=arguments.length,c=new Array(i>1?i-1:0),d=1;d<i;d++)c[d-1]=arguments[d];return c.forEach(h=>r.set(h)),r}static accessor(t){let r=(this[SL]=this[SL]={accessors:{}}).accessors,i=this.prototype;function c(d){let h=If(d);r[h]||(function(p,m){let _=ke.toCamelCase(" "+m);["get","set","has"].forEach(E=>{Object.defineProperty(p,E+_,{value:function(x,b,C){return this[E].call(this,m,x,b,C)},configurable:!0})})}(i,d),r[h]=!0)}return ke.isArray(t)?t.forEach(c):c(t),this}}EE.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ke.reduceDescriptors(EE.prototype,(e,t)=>{let{value:r}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(c){this[i]=c}}}),ke.freezeMethods(EE);var Pa=EE;function t0(e,t){let r=this||ZS,i=t||r,c=Pa.from(i.headers),d=i.data;return ke.forEach(e,function(h){d=h.call(r,d,c.normalize(),t?t.status:void 0)}),c.normalize(),d}function CL(e){return!(!e||!e.__CANCEL__)}function $u(e,t,r){Jt.call(this,e??"canceled",Jt.ERR_CANCELED,t,r),this.name="CanceledError"}function TL(e,t,r){let i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(new Jt("Request failed with status code "+r.status,[Jt.ERR_BAD_REQUEST,Jt.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}ke.inherits($u,Jt,{__CANCEL__:!0});let vE=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0,c=function(d,h){d=d||10;let p=new Array(d),m=new Array(d),_,E=0,x=0;return h=h!==void 0?h:1e3,function(b){let C=Date.now(),U=m[x];_||(_=C),p[E]=b,m[E]=C;let k=x,M=0;for(;k!==E;)M+=p[k++],k%=d;if(E=(E+1)%d,E===x&&(x=(x+1)%d),C-_<h)return;let H=U&&C-U;return H?Math.round(1e3*M/H):void 0}}(50,250);return function(d,h){let p,m,_=0,E=1e3/h,x=function(b){_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),p=null,m&&(clearTimeout(m),m=null),d.apply(null,b)};return[function(){let b=Date.now(),C=b-_;for(var U=arguments.length,k=new Array(U),M=0;M<U;M++)k[M]=arguments[M];C>=E?x(k,b):(p=k,m||(m=setTimeout(()=>{m=null,x(p)},E-C)))},()=>p&&x(p)]}(d=>{let h=d.loaded,p=d.lengthComputable?d.total:void 0,m=h-i,_=c(m);i=h,e({loaded:h,total:p,progress:p?h/p:void 0,bytes:m,rate:_||void 0,estimated:_&&p&&h<=p?(p-h)/_:void 0,event:d,lengthComputable:p!=null,[t?"download":"upload"]:!0})},r)},RL=(e,t)=>{let r=e!=null;return[i=>t[0]({lengthComputable:r,total:e,loaded:i}),t[1]]},NL=e=>function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return ke.asap(()=>e(...r))};var Pne=vn.hasStandardBrowserEnv?((e,t)=>r=>(r=new q_(r,vn.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new q_(vn.origin),vn.navigator&&/(msie|trident)/i.test(vn.navigator.userAgent)):()=>!0,kne=vn.hasStandardBrowserEnv?{write(e,t,r,i,c,d){let h=[e+"="+encodeURIComponent(t)];ke.isNumber(r)&&h.push("expires="+new Date(r).toGMTString()),ke.isString(i)&&h.push("path="+i),ke.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function AL(e,t,r){let i=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(t);return e&&(i||r==0)?function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}(e,t):t}function IL(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}let OL=e=>e instanceof Pa?function(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?IL(Object(i),!0).forEach(function(c){W(t,c,i[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):IL(Object(i)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(i,c))})}return t}({},e):e;function id(e,t){t=t||{};let r={};function i(_,E,x,b){return ke.isPlainObject(_)&&ke.isPlainObject(E)?ke.merge.call({caseless:b},_,E):ke.isPlainObject(E)?ke.merge({},E):ke.isArray(E)?E.slice():E}function c(_,E,x,b){return ke.isUndefined(E)?ke.isUndefined(_)?void 0:i(void 0,_,0,b):i(_,E,0,b)}function d(_,E){if(!ke.isUndefined(E))return i(void 0,E)}function h(_,E){return ke.isUndefined(E)?ke.isUndefined(_)?void 0:i(void 0,_):i(void 0,E)}function p(_,E,x){return x in t?i(_,E):x in e?i(void 0,_):void 0}let m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p,headers:(_,E,x)=>c(OL(_),OL(E),0,!0)};return ke.forEach(Object.keys(Object.assign({},e,t)),function(_){let E=m[_]||c,x=E(e[_],t[_],_);ke.isUndefined(x)&&E!==p||(r[_]=x)}),r}var DL=e=>{let t=id({},e),r,{data:i,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:p,auth:m}=t;if(t.headers=p=Pa.from(p),t.url=$1(AL(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),m&&p.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),ke.isFormData(i)){if(vn.hasStandardBrowserEnv||vn.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if((r=p.getContentType())!==!1){let[_,...E]=r?r.split(";").map(x=>Ks(x).call(x)).filter(Boolean):[];p.setContentType([_||"multipart/form-data",...E].join("; "))}}if(vn.hasStandardBrowserEnv&&(c&&ke.isFunction(c)&&(c=c(t)),c||c!==!1&&Pne(t.url))){let _=d&&h&&kne.read(h);_&&p.set(d,_)}return t},jne=typeof XMLHttpRequest<"u"&&function(e){return new je(function(t,r){let i=DL(e),c=i.data,d=Pa.from(i.headers).normalize(),h,p,m,_,E,{responseType:x,onUploadProgress:b,onDownloadProgress:C}=i;function U(){_&&_(),E&&E(),i.cancelToken&&i.cancelToken.unsubscribe(h),i.signal&&i.signal.removeEventListener("abort",h)}let k=new XMLHttpRequest;function M(){if(!k)return;let K=Pa.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders());TL(function(X){t(X),U()},function(X){r(X),U()},{data:x&&x!=="text"&&x!=="json"?k.response:k.responseText,status:k.status,statusText:k.statusText,headers:K,config:e,request:k}),k=null}k.open(i.method.toUpperCase(),i.url,!0),k.timeout=i.timeout,"onloadend"in k?k.onloadend=M:k.onreadystatechange=function(){k&&k.readyState===4&&(k.status!==0||k.responseURL&&k.responseURL.indexOf("file:")===0)&&setTimeout(M)},k.onabort=function(){k&&(r(new Jt("Request aborted",Jt.ECONNABORTED,e,k)),k=null)},k.onerror=function(){r(new Jt("Network Error",Jt.ERR_NETWORK,e,k)),k=null},k.ontimeout=function(){let K=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded",X=i.transitional||J1;i.timeoutErrorMessage&&(K=i.timeoutErrorMessage),r(new Jt(K,X.clarifyTimeoutError?Jt.ETIMEDOUT:Jt.ECONNABORTED,e,k)),k=null},c===void 0&&d.setContentType(null),"setRequestHeader"in k&&ke.forEach(d.toJSON(),function(K,X){k.setRequestHeader(X,K)}),ke.isUndefined(i.withCredentials)||(k.withCredentials=!!i.withCredentials),x&&x!=="json"&&(k.responseType=i.responseType),C&&([m,E]=vE(C,!0),k.addEventListener("progress",m)),b&&k.upload&&([p,_]=vE(b),k.upload.addEventListener("progress",p),k.upload.addEventListener("loadend",_)),(i.cancelToken||i.signal)&&(h=K=>{k&&(r(!K||K.type?new $u(null,e,k):K),k.abort(),k=null)},i.cancelToken&&i.cancelToken.subscribe(h),i.signal&&(i.signal.aborted?h():i.signal.addEventListener("abort",h)));let H=function(K){let X=/^([-+\w]{1,25})(:?\/\/|:)/.exec(K);return X&&X[1]||""}(i.url);H&&vn.protocols.indexOf(H)===-1?r(new Jt("Unsupported protocol "+H+":",Jt.ERR_BAD_REQUEST,e)):k.send(c||null)})},Lne=(e,t)=>{let{length:r}=e=e?e.filter(Boolean):[];if(t||r){let i,c=new AbortController,d=function(_){if(!i){i=!0,p();let E=_ instanceof Error?_:this.reason;c.abort(E instanceof Jt?E:new $u(E instanceof Error?E.message:E))}},h=t&&setTimeout(()=>{h=null,d(new Jt("timeout ".concat(t," of ms exceeded"),Jt.ETIMEDOUT))},t),p=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(_=>{_.unsubscribe?_.unsubscribe(d):_.removeEventListener("abort",d)}),e=null)};e.forEach(_=>_.addEventListener("abort",d));let{signal:m}=c;return m.unsubscribe=()=>ke.asap(p),m}},r0=u(yP),PL=Hu.f("asyncIterator"),Mne=u(PL);function s0(e,t){this.v=e,this.k=t}function xi(e){return function(){return new Of(e.apply(this,arguments))}}function Of(e){var t,r;function i(d,h){try{var p=e[d](h),m=p.value,_=m instanceof s0;r0.resolve(_?m.v:m).then(function(E){if(_){var x=d==="return"?"return":"next";if(!m.k||E.done)return i(x,E);E=e[x](E).value}c(p.done?"return":"normal",E)},function(E){i("throw",E)})}catch(E){c("throw",E)}}function c(d,h){switch(d){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?i(t.key,t.arg):r=null}this._invoke=function(d,h){return new r0(function(p,m){var _={key:d,arg:h,resolve:p,reject:m,next:null};r?r=r.next=_:(t=r=_,i(d,h))})},typeof e.return!="function"&&(this.return=void 0)}function Ot(e){return new s0(e,0)}function yE(e){var t={},r=!1;function i(c,d){return r=!0,d=new r0(function(h){h(e[c](d))}),{done:!1,value:new s0(d,1)}}return t[Yu!==void 0&&oL||"@@iterator"]=function(){return this},t.next=function(c){return r?(r=!1,c):i("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(r)throw r=!1,c;return i("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return r?(r=!1,c):i("return",c)}),t}Of.prototype[typeof Yu=="function"&&Mne||"@@asyncIterator"]=function(){return this},Of.prototype.next=function(e){return this._invoke("next",e)},Of.prototype.throw=function(e){return this._invoke("throw",e)},Of.prototype.return=function(e){return this._invoke("return",e)};var n0=u(PL);function i0(e){var t,r,i,c=2;for(typeof Symbol<"u"&&(r=n0,i=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new xE(t.call(e));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function xE(e){function t(r){if(Object(r)!==r)return je.reject(new TypeError(r+" is not an object."));var i=r.done;return je.resolve(r.value).then(function(c){return{value:c,done:i}})}return xE=function(r){this.s=r,this.n=r.next},xE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?je.resolve({value:r,done:!0}):t(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?je.reject(r):t(i.apply(this.s,arguments))}},new xE(e)}let Fne=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let i,c=0;for(;c<r;)i=c+t,yield e.slice(c,i),c=i},Une=function(){var e=xi(function*(t,r){var i,c=!1,d=!1;try{for(var h,p=i0(Vne(t));c=!(h=yield Ot(p.next())).done;c=!1){let m=h.value;yield*yE(i0(Fne(m,r)))}}catch(m){d=!0,i=m}finally{try{c&&p.return!=null&&(yield Ot(p.return()))}finally{if(d)throw i}}});return function(t,r){return e.apply(this,arguments)}}(),Vne=function(){var e=xi(function*(t){if(t[n0])return void(yield*yE(i0(t)));let r=t.getReader();try{for(;;){let{done:i,value:c}=yield Ot(r.read());if(i)break;yield c}}finally{yield Ot(r.cancel())}});return function(t){return e.apply(this,arguments)}}(),kL=(e,t,r,i)=>{let c=Une(e,t),d,h=0,p=m=>{d||(d=!0,i&&i(m))};return new ReadableStream({async pull(m){try{let{done:_,value:E}=await c.next();if(_)return p(),void m.close();let x=E.byteLength;if(r){let b=h+=x;r(b)}m.enqueue(new Uint8Array(E))}catch(_){throw p(_),_}},cancel:m=>(p(m),c.return())},{highWaterMark:2})};function jL(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function LL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jL(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jL(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let bE=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ML=bE&&typeof ReadableStream=="function",Bne=bE&&(typeof TextEncoder=="function"?(FL=new TextEncoder,e=>FL.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var FL;let UL=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return!!e(...r)}catch{return!1}},Wne=ML&&UL(()=>{let e=!1,t=new Request(vn.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),a0=ML&&UL(()=>ke.isReadableStream(new Response("").body)),wE={stream:a0&&(e=>e.body)};var VL;bE&&(VL=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!wE[e]&&(wE[e]=ke.isFunction(VL[e])?t=>t[e]():(t,r)=>{throw new Jt("Response type '".concat(e,"' is not supported"),Jt.ERR_NOT_SUPPORT,r)})}));let Gne=async(e,t)=>ke.toFiniteNumber(e.getContentLength())??(async i=>i==null?0:ke.isBlob(i)?i.size:ke.isSpecCompliantForm(i)?(await new Request(vn.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:ke.isArrayBufferView(i)||ke.isArrayBuffer(i)?i.byteLength:(ke.isURLSearchParams(i)&&(i+=""),ke.isString(i)?(await Bne(i)).byteLength:void 0))(t);var Hne=bE&&(async e=>{let{url:t,method:r,data:i,signal:c,cancelToken:d,timeout:h,onDownloadProgress:p,onUploadProgress:m,responseType:_,headers:E,withCredentials:x="same-origin",fetchOptions:b}=DL(e);_=_?(_+"").toLowerCase():"text";let C,U=Lne([c,d&&d.toAbortSignal()],h),k=U&&U.unsubscribe&&(()=>{U.unsubscribe()}),M;try{if(m&&Wne&&r!=="get"&&r!=="head"&&(M=await Gne(E,i))!==0){let te,Z=new Request(t,{method:"POST",body:i,duplex:"half"});if(ke.isFormData(i)&&(te=Z.headers.get("content-type"))&&E.setContentType(te),Z.body){let[ce,fe]=RL(M,vE(NL(m)));i=kL(Z.body,65536,ce,fe)}}ke.isString(x)||(x=x?"include":"omit");let H="credentials"in Request.prototype;C=new Request(t,LL(LL({},b),{},{signal:U,method:r.toUpperCase(),headers:E.normalize().toJSON(),body:i,duplex:"half",credentials:H?x:void 0}));let K=await fetch(C),X=a0&&(_==="stream"||_==="response");if(a0&&(p||X&&k)){let te={};["status","statusText","headers"].forEach(xe=>{te[xe]=K[xe]});let Z=ke.toFiniteNumber(K.headers.get("content-length")),[ce,fe]=p&&RL(Z,vE(NL(p),!0))||[];K=new Response(kL(K.body,65536,ce,()=>{fe&&fe(),k&&k()}),te)}_=_||"text";let se=await wE[ke.findKey(wE,_)||"text"](K,e);return!X&&k&&k(),await new je((te,Z)=>{TL(te,Z,{data:se,headers:Pa.from(K.headers),status:K.status,statusText:K.statusText,config:e,request:C})})}catch(H){throw k&&k(),H&&H.name==="TypeError"&&/Load failed|fetch/i.test(H.message)?Object.assign(new Jt("Network Error",Jt.ERR_NETWORK,e,C),{cause:H.cause||H}):Jt.from(H,H&&H.code,e,C)}});let o0={http:null,xhr:jne,fetch:Hne};ke.forEach(o0,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let BL=e=>"- ".concat(e),zne=e=>ke.isFunction(e)||e===null||e===!1;var WL={getAdapter:e=>{e=ke.isArray(e)?e:[e];let{length:t}=e,r,i,c={};for(let d=0;d<t;d++){let h;if(r=e[d],i=r,!zne(r)&&(i=o0[(h=String(r)).toLowerCase()],i===void 0))throw new Jt("Unknown adapter '".concat(h,"'"));if(i)break;c[h||"#"+d]=i}if(!i){let d=Object.entries(c).map(h=>{let[p,m]=h;return"adapter ".concat(p," ")+(m===!1?"is not supported by the environment":"is not available in the build")});throw new Jt("There is no suitable adapter to dispatch the request "+(t?d.length>1?`since :
`+d.map(BL).join(`
`):" "+BL(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:o0};function c0(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new $u(null,e)}function GL(e){return c0(e),e.headers=Pa.from(e.headers),e.data=t0.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),WL.getAdapter(e.adapter||ZS.adapter)(e).then(function(t){return c0(e),t.data=t0.call(e,e.transformResponse,t),t.headers=Pa.from(t.headers),t},function(t){return CL(t)||(c0(e),t&&t.response&&(t.response.data=t0.call(e,e.transformResponse,t.response),t.response.headers=Pa.from(t.response.headers))),je.reject(t)})}let HL="1.9.0",SE={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{SE[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});let zL={};SE.transitional=function(e,t,r){function i(c,d){return"[Axios v"+HL+"] Transitional option '"+c+"'"+d+(r?". "+r:"")}return(c,d,h)=>{if(e===!1)throw new Jt(i(d," has been removed"+(t?" in "+t:"")),Jt.ERR_DEPRECATED);return t&&!zL[d]&&(zL[d]=!0,console.warn(i(d," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,d,h)}},SE.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var CE={assertOptions:function(e,t,r){if(typeof e!="object")throw new Jt("options must be an object",Jt.ERR_BAD_OPTION_VALUE);let i=Object.keys(e),c=i.length;for(;c-- >0;){let d=i[c],h=t[d];if(h){let p=e[d],m=p===void 0||h(p,d,e);if(m!==!0)throw new Jt("option "+d+" must be "+m,Jt.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new Jt("Unknown option "+d,Jt.ERR_BAD_OPTION)}},validators:SE};let go=CE.validators,TE=class{constructor(e){this.defaults=e||{},this.interceptors={request:new X1,response:new X1}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;let c=i.stack?i.stack.replace(/^.+\n/,""):"";try{r.stack?c&&!String(r.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+c):r.stack=c}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=id(this.defaults,t);let{transitional:r,paramsSerializer:i,headers:c}=t;r!==void 0&&CE.assertOptions(r,{silentJSONParsing:go.transitional(go.boolean),forcedJSONParsing:go.transitional(go.boolean),clarifyTimeoutError:go.transitional(go.boolean)},!1),i!=null&&(ke.isFunction(i)?t.paramsSerializer={serialize:i}:CE.assertOptions(i,{encode:go.function,serialize:go.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),CE.assertOptions(t,{baseUrl:go.spelling("baseURL"),withXsrfToken:go.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let d=c&&ke.merge(c.common,c[t.method]);c&&ke.forEach(["delete","get","head","post","put","patch","common"],C=>{delete c[C]}),t.headers=Pa.concat(d,c);let h=[],p=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(t)===!1||(p=p&&C.synchronous,h.unshift(C.fulfilled,C.rejected))});let m=[],_;this.interceptors.response.forEach(function(C){m.push(C.fulfilled,C.rejected)});let E,x=0;if(!p){let C=[GL.bind(this),void 0];for(C.unshift.apply(C,h),C.push.apply(C,m),E=C.length,_=je.resolve(t);x<E;)_=_.then(C[x++],C[x++]);return _}E=h.length;let b=t;for(x=0;x<E;){let C=h[x++],U=h[x++];try{b=C(b)}catch(k){U.call(this,k);break}}try{_=GL.call(this,b)}catch(C){return je.reject(C)}for(x=0,E=m.length;x<E;)_=_.then(m[x++],m[x++]);return _}getUri(e){return $1(AL((e=id(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ke.forEach(["delete","get","head","options"],function(e){TE.prototype[e]=function(t,r){return this.request(id(r||{},{method:e,url:t,data:(r||{}).data}))}}),ke.forEach(["post","put","patch"],function(e){function t(r){return function(i,c,d){return this.request(id(d||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:c}))}}TE.prototype[e]=t(),TE.prototype[e+"Form"]=t(!0)});var RE=TE;class l0{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new je(function(c){r=c});let i=this;this.promise.then(c=>{if(!i._listeners)return;let d=i._listeners.length;for(;d-- >0;)i._listeners[d](c);i._listeners=null}),this.promise.then=c=>{let d,h=new je(p=>{i.subscribe(p),d=p}).then(c);return h.cancel=function(){i.unsubscribe(d)},h},t(function(c,d,h){i.reason||(i.reason=new $u(c,d,h),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){let t=new AbortController,r=i=>{t.abort(i)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new l0(function(r){t=r}),cancel:t}}}var Kne=l0;let d0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(d0).forEach(e=>{let[t,r]=e;d0[r]=t});var qne=d0;let Vs=function e(t){let r=new RE(t),i=D1(RE.prototype.request,r);return ke.extend(i,RE.prototype,r,{allOwnKeys:!0}),ke.extend(i,r,null,{allOwnKeys:!0}),i.create=function(c){return e(id(t,c))},i}(ZS);Vs.Axios=RE,Vs.CanceledError=$u,Vs.CancelToken=Kne,Vs.isCancel=CL,Vs.VERSION=HL,Vs.toFormData=aE,Vs.AxiosError=Jt,Vs.Cancel=Vs.CanceledError,Vs.all=function(e){return je.all(e)},Vs.spread=function(e){return function(t){return e.apply(null,t)}},Vs.isAxiosError=function(e){return ke.isObject(e)&&e.isAxiosError===!0},Vs.mergeConfig=id,Vs.AxiosHeaders=Pa,Vs.formToJSON=e=>wL(ke.isHTMLForm(e)?new FormData(e):e),Vs.getAdapter=WL.getAdapter,Vs.HttpStatusCode=qne,Vs.default=Vs;var dn=Vs;let Yne=()=>{};function Df(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Yne};return e.promise=new je((t,r)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(i))}}),e}let NE=new Map,AE=new Map,_o=new Map,ts=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Lt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),KL=new Ste,ka=KL.getResult(),u0=null;function Rt(e){if(!u0){ka=KL.getResult();let t=function(p){if(p.engine.name==="Blink"&&p.browser.name!=="WeChat")return Lt.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Lt.CHROME;case"Safari":case"Mobile Safari":return Lt.SAFARI;case"Edge":return Lt.EDGE;case"Firefox":return Lt.FIREFOX;case"QQ":case"QQBrowser":return Lt.QQ;case"Opera":return Lt.OPERA;case"WeChat":return Lt.WECHAT;default:return p.browser.name||""}}(ka),r=qL(ka),i=function(p){return p.os.name==="Windows"?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||""}(ka),c=ka.os.version,d=qL(ka,!1),h=ka.device.type;if(!(t&&r&&i&&c))return{name:t,version:r,os:i,osVersion:c,browserVersion:d,deviceType:h};u0={name:t,version:r,os:i,osVersion:c,browserVersion:d,deviceType:h}}return u0}function qL(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function IE(){return Rt().os}function YL(){let e=Rt();return"".concat(e.os," ").concat(e.osVersion)}function OE(){let e=Rt();return!!(ka.engine.name==="WebKit"&&e.os===ts.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Lt.SAFARI||Bs()&&e.name!==Lt.SAFARI)}function Zo(){return Rt().name===Lt.CHROME}function bs(){return Rt().name===Lt.SAFARI}function $L(){let e=Rt();if(e.name!==Lt.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function XL(){return Rt().name===Lt.EDGE}function Sr(){return Rt().name===Lt.FIREFOX}function Bs(){return Rt().os===ts.IOS}function Xu(e){let t=Rt();return!(t.name!==Lt.CHROME||!t.osVersion)&&Number(t.version)>=e}function JL(e){let t=Rt();return!(t.name!==Lt.CHROME||!t.osVersion)&&Number(t.version)<e}function h0(e,t,r){let i=Rt();return!(i.name!==e||!i.osVersion)&&(r?Number(i.version)>=t&&Number(i.version)<=r:Number(i.version)===t)}function p0(e){let t=Rt();return!(t.name!==Lt.EDGE||!t.osVersion)&&Number(t.version)>=e}function f0(e){let t=Rt();return!(t.name!==Lt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function QL(e){let t=Rt();return!(t.name!==Lt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function ZL(e,t,r){let i=Rt();if(i.os!==ts.IOS||!i.osVersion)return!1;let c=i.osVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])>t||Number(c[0])>e:t?Number(c[0])===e&&Number(c[1])>=t||Number(c[0])>e:Number(c[0])>=e}function e2(e,t,r){let i=Rt();if(i.os!==ts.IOS||!i.osVersion)return!1;let c=i.osVersion.split(".");return t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e}function m0(e,t,r){let i=Rt();if(i.name!==Lt.SAFARI||!i.osVersion||!i.browserVersion)return!1;let c=i.browserVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function g0(e){let t=Rt();return!(t.name!==Lt.OPERA||!t.osVersion)&&Number(t.version)>=e}function t2(){let e=Rt();if(e.os!==ts.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Ju(){let e=Rt();if(e.os!==ts.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function _0(){let e=Rt();if(e.os!==ts.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function r2(){let e=Rt();if(e.os!==ts.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Qi(){return bs()&&navigator.maxTouchPoints>0}function s2(){return Rt().name===Lt.WECHAT}function n2(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function E0(){let e=IE();return function(){let{deviceType:t}=Rt();return t==="mobile"||t==="tablet"}()||e===ts.ANDROID||e===ts.IOS||e===ts.HARMONY_OS}function ec(){let e=Rt();return e.name!==Lt.EDGE&&e.name!==Lt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function DE(){return IE()===ts.ANDROID}function Pf(){let e=Rt();return DE()&&(e.name===Lt.CHROME||e.name===Lt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function ct(e,t,r){return(t=function(i){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var m=p.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(i);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Ce(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?i2(Object(r),!0).forEach(function(i){ct(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i2(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let z=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),he=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),ct(this,"code",void 0),ct(this,"message",void 0),ct(this,"data",void 0),ct(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function ja(e,t){if(typeof e!="boolean")throw new he(z.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Jr(e,t,r){if(!Ae(r).call(r,e))throw new he(z.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Qt(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new he(z.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(i,"]. integer only"))}function v0(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new he(z.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Qt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Qt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Qt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Qt(e.ideal,"".concat(t,".ideal"),1,1/0)}else Qt(e,t,1,1/0)}function us(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new he(z.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!a2(e,r,i,c))throw new he(z.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(i,"].").concat(c?" ASCII characters only.":""))}function tc(e,t){if(!Array.isArray(e))throw new he(z.INVALID_PARAMS,"".concat(t," should be an array"))}function Cr(e){return e==null}function a2(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!i||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){let h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(e))}var kf=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(kf||{}),y0=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(y0||{});let o2=new class{constructor(){ct(this,"_clientSize",null),ct(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),ct(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),ct(this,"getStyle",e=>window.getComputedStyle(e,null)),ct(this,"checkCssVisibleProperty",e=>{var t;let r=!0,i=this.getStyle(e),{display:c,visibility:d,opacity:h,filter:p}=i;return(c==="none"||Ae(t=["hidden","collapse"]).call(t,d)||Number(h)<.1)&&(r=!1),!!r&&(p&&p.split(" ").filter(m=>{var _;let E=m.split("(")[0];return Ae(_=["brightness","blur","opacity"]).call(_,E)}).map(m=>{let[_,E]=m.split(/\(|\)/);return[_,Number(E.match(/^[0-9\.]+/))]}).forEach(m=>{let[_,E]=m;switch(_){case"brightness":(E<.1||E>3)&&(r=!1);break;case"blur":E>3&&(r=!1);break;case"opacity":E<.1&&(r=!1)}}),r)}),ct(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,i=!0,c=h=>t(h),d=e;for(;d&&i;)c(d)||(r=!1,i=!1),d=d.parentElement,d||(i=!1);return r}),ct(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),ct(this,"getSizeAboutClient",e=>{let{width:t,height:r,left:i,right:c,top:d,bottom:h}=e.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:r,left:i,right:c,top:d,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),ct(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),ct(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),ct(this,"checkCoverForAPoint",(e,t,r)=>{let i=this.elementFromPoint(e,t);return i!==null&&i!==r}),ct(this,"getPointPositionList",()=>{let{width:e,height:t,left:r,top:i}=this._clientSize,c=e/6,d=t/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++){let E=(r*p+(m===0?.1:m===4?(c*m*p-1e5)/p:c*m)*p)/p,x=(i*p+(_===0?.1:_===4?(d*_*p-1e5)/p:d*_)*p)/p;h.push({x:E,y:x})}return[...h]}),ct(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),ct(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),ct(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:r,bottom:i,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize,p,m,_,E;if(e<0)p=0;else{if(!(e<d))return!1;p=e}if(t<0)return!1;if(m=t<d?t:d,r<0)_=0;else{if(!(r<c))return!1;_=r}if(i<0)return!1;E=i<c?i:c;let x=m-p,b=E-_;return this.checkSizeIsVisible(x,b,h)}),ct(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),ct(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(kf.COVERED);{let t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(kf.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(kf.SIZE)}}return this.returnHiddenResult(kf.STYLE)}return this.returnHiddenResult(y0.UNMOUNTED)}return this.returnHiddenResult(y0.INVALID_HTML_ELEMENT)}),ct(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function x0(e){return new TextEncoder().encode(e)}let c2=function(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},b0=async e=>function(t,r){let i="";return new Uint8Array(t).forEach(c=>{i+=c.toString(r).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",x0(e)),16);class br{constructor(){ct(this,"_events",{}),ct(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);let i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);let i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;let i=this._events[t],c=this._indexOfListener(i,r);c!==-1&&i.splice(c,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);let r=this._events[t].map(h=>h);for(var i=arguments.length,c=new Array(i>1?i-1:0),d=1;d<i;d++)c[d-1]=arguments[d];for(let h=0;h<r.length;h+=1){let p=r[h];p.once&&this.off(t,p.listener),p.listener.apply(this,c||[])}}safeEmit(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),c=1;c<r;c++)i[c-1]=arguments[c];[...this._events[t]||[]].forEach(d=>{d.once&&this.off(t,d.listener);try{d.listener.apply(this,i)}catch(h){console.error("safeEmit event:".concat(t," error ").concat(h==null?void 0:h.toString()))}})}_indexOfListener(t,r){let i=t.length;for(;i--;)if(t[i].listener===r)return i;return-1}}let jf=null;function l2(){if(jf)return jf;if(window.electron)return jf=window.electron;if(!window.require)return null;try{return jf=window.require("electron"),jf}catch{return null}}let Or=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),Er=function(e){return e.TRACER="tracer",e}({});function d2(e){return Qt(e.timeout,"config.timeout",0,1e5),Qt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Qt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Qt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let $ne=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Wt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Lf(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function u2(e){return us(e.turnServerURL,"turnServerURL"),us(e.username,"username"),us(e.password,"password"),e.udpport&&Qt(e.udpport,"udpport",1,99999,!0),e.forceturn&&ja(e.forceturn,"forceturn"),e.security&&ja(e.security,"security"),e.tcpport&&Qt(e.tcpport,"tcpport",1,99999,!0),!0}function w0(e){return e.level!==void 0&&Jr(e.level,"level",[1,2,3]),e.delay!==void 0&&Qt(e.delay,"delay",0,3e3,!0),!0}let wt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ws=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Un=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Qu=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Ss(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),c=2;c<r;c++)i[c-2]=arguments[c];return e.getListeners(t).length===0?je.reject(new he(z.UNEXPECTED_ERROR,"can not emit promise")):new je((d,h)=>{e.emit(t,...i,d,h)})}function er(e,t){if(e.getListeners(t).length===0)return je.resolve();for(var r=arguments.length,i=new Array(r>2?r-2:0),c=2;c<r;c++)i[c-2]=arguments[c];return Ss(e,t,...i)}function ri(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,i=new Array(r>2?r-2:0),c=2;c<r;c++)i[c-2]=arguments[c];return Mf(e,t,...i)}function Mf(e,t){let r=null,i=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(e.emit(t,...d,p=>{r=p},p=>{i=p}),i!==null)throw i;if(r===null)throw new he(z.UNEXPECTED_ERROR,"handler is not sync");return r}let Mr=new class extends br{set networkState(e){this.emit(Qu.NETWORK_STATE_CHANGE,e,this._networkState),e===Un.ONLINE?this.emit(Qu.ONLINE):e===Un.OFFLINE&&(this.onlineWaiter=new je(t=>{this.once(Qu.ONLINE,()=>{this.onlineWaiter=void 0,t(Un.ONLINE)})}),this.emit(Qu.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Un.ONLINE}constructor(){super(),ct(this,"_moduleName","network-indicator"),ct(this,"_networkState",Un.ONLINE),ct(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Un.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Un.OFFLINE})}};function PE(e,t){let r=e.indexOf(t);r!==-1&&e.splice(r,1)}function Zu(e){let t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function kE(e){je!==void 0?je.resolve().then(e):setTimeout(e,0)}function vr(e){return JSON.parse(JSON.stringify(e))}function ad(e){try{return vr(e)}catch{return e}}let h2={};function Fc(e,t){h2[t]||(h2[t]=!0,e())}function od(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)r[i]=t.charCodeAt(i);return r}function Uc(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function p2(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){let i=new Uint8Array(t);i.set(r),r=i}return r}function f2(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=zi(t).call(t,(h,p)=>h+p.length,0),c=new Uint8Array(new ArrayBuffer(i)),d=0;return t.forEach(h=>{c.set(h,d),d+=h.length}),c}function Eo(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function m2(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?Eo(r):r.size}),t+138}function Xne(e){let t=new he(z.TIMEOUT,"timeout");return new je((r,i)=>{window.setTimeout(()=>i(t),e)})}function hs(e){return new je(t=>{window.setTimeout(t,e)})}function tr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+tr(e-r.length,"")}function cd(){return tr(32,"").toUpperCase()}let jE=()=>{},g2=new class{constructor(){ct(this,"fnMap",new Map)}throttleByKey(e,t,r,i){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(t)){let p=this.fnMap.get(t);if(p.threshold!==r){p.fn(...p.args),clearTimeout(p.timer);let m=window.setTimeout(()=>{let _=this.fnMap.get(t);_&&_.fn(..._.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:m,args:d,skipFn:i})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(t,Ce(Ce({},p),{},{fn:e,args:d,skipFn:i}))}else{let p=window.setTimeout(()=>{let m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:p,args:d,skipFn:i})}}},_2=g2.throttleByKey.bind(g2);function E2(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function S0(e,t){if(!E2(e)||!E2(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let r=[...e];for(let i=0;i<t.length;i++)r[i]=S0(e[i],t[i]);return r}{let r=Ce({},e);for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?r[i]=S0(e[i],t[i]):r[i]=t[i]);return r}}function v2(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let i=0;for(;e>0&&(r[i]=255&e,e>>=8,i++,i!==t););return r}function eh(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function C0(e){return zi(e).call(e,(t,r)=>t+r,0)}function y2(e){let t="0123456789abcdef";function r(X){let se,te="";for(se=0;se<=3;se++)te+=t.charAt(X>>8*se+4&15)+t.charAt(X>>8*se&15);return te}function i(X,se){let te=(65535&X)+(65535&se);return(X>>16)+(se>>16)+(te>>16)<<16|65535&te}function c(X,se,te,Z,ce,fe){return i(function(xe,Te){return xe<<Te|xe>>>32-Te}(i(i(se,X),i(Z,fe)),ce),te)}function d(X,se,te,Z,ce,fe,xe){return c(se&te|~se&Z,X,se,ce,fe,xe)}function h(X,se,te,Z,ce,fe,xe){return c(se&Z|te&~Z,X,se,ce,fe,xe)}function p(X,se,te,Z,ce,fe,xe){return c(se^te^Z,X,se,ce,fe,xe)}function m(X,se,te,Z,ce,fe,xe){return c(te^(se|~Z),X,se,ce,fe,xe)}let _=function(X){let se,te=1+(X.length+8>>6),Z=new Array(16*te);for(se=0;se<16*te;se++)Z[se]=0;for(se=0;se<X.length;se++)Z[se>>2]|=X.charCodeAt(se)<<se%4*8;return Z[se>>2]|=128<<se%4*8,Z[16*te-2]=8*X.length,Z}(e),E,x,b,C,U,k=1732584193,M=-271733879,H=-1732584194,K=271733878;for(E=0;E<_.length;E+=16)x=k,b=M,C=H,U=K,k=d(k,M,H,K,_[E+0],7,-680876936),K=d(K,k,M,H,_[E+1],12,-389564586),H=d(H,K,k,M,_[E+2],17,606105819),M=d(M,H,K,k,_[E+3],22,-1044525330),k=d(k,M,H,K,_[E+4],7,-176418897),K=d(K,k,M,H,_[E+5],12,1200080426),H=d(H,K,k,M,_[E+6],17,-1473231341),M=d(M,H,K,k,_[E+7],22,-45705983),k=d(k,M,H,K,_[E+8],7,1770035416),K=d(K,k,M,H,_[E+9],12,-1958414417),H=d(H,K,k,M,_[E+10],17,-42063),M=d(M,H,K,k,_[E+11],22,-1990404162),k=d(k,M,H,K,_[E+12],7,1804603682),K=d(K,k,M,H,_[E+13],12,-40341101),H=d(H,K,k,M,_[E+14],17,-1502002290),M=d(M,H,K,k,_[E+15],22,1236535329),k=h(k,M,H,K,_[E+1],5,-165796510),K=h(K,k,M,H,_[E+6],9,-1069501632),H=h(H,K,k,M,_[E+11],14,643717713),M=h(M,H,K,k,_[E+0],20,-373897302),k=h(k,M,H,K,_[E+5],5,-701558691),K=h(K,k,M,H,_[E+10],9,38016083),H=h(H,K,k,M,_[E+15],14,-660478335),M=h(M,H,K,k,_[E+4],20,-405537848),k=h(k,M,H,K,_[E+9],5,568446438),K=h(K,k,M,H,_[E+14],9,-1019803690),H=h(H,K,k,M,_[E+3],14,-187363961),M=h(M,H,K,k,_[E+8],20,1163531501),k=h(k,M,H,K,_[E+13],5,-1444681467),K=h(K,k,M,H,_[E+2],9,-51403784),H=h(H,K,k,M,_[E+7],14,1735328473),M=h(M,H,K,k,_[E+12],20,-1926607734),k=p(k,M,H,K,_[E+5],4,-378558),K=p(K,k,M,H,_[E+8],11,-2022574463),H=p(H,K,k,M,_[E+11],16,1839030562),M=p(M,H,K,k,_[E+14],23,-35309556),k=p(k,M,H,K,_[E+1],4,-1530992060),K=p(K,k,M,H,_[E+4],11,1272893353),H=p(H,K,k,M,_[E+7],16,-155497632),M=p(M,H,K,k,_[E+10],23,-1094730640),k=p(k,M,H,K,_[E+13],4,681279174),K=p(K,k,M,H,_[E+0],11,-358537222),H=p(H,K,k,M,_[E+3],16,-722521979),M=p(M,H,K,k,_[E+6],23,76029189),k=p(k,M,H,K,_[E+9],4,-640364487),K=p(K,k,M,H,_[E+12],11,-421815835),H=p(H,K,k,M,_[E+15],16,530742520),M=p(M,H,K,k,_[E+2],23,-995338651),k=m(k,M,H,K,_[E+0],6,-198630844),K=m(K,k,M,H,_[E+7],10,1126891415),H=m(H,K,k,M,_[E+14],15,-1416354905),M=m(M,H,K,k,_[E+5],21,-57434055),k=m(k,M,H,K,_[E+12],6,1700485571),K=m(K,k,M,H,_[E+3],10,-1894986606),H=m(H,K,k,M,_[E+10],15,-1051523),M=m(M,H,K,k,_[E+1],21,-2054922799),k=m(k,M,H,K,_[E+8],6,1873313359),K=m(K,k,M,H,_[E+15],10,-30611744),H=m(H,K,k,M,_[E+6],15,-1560198380),M=m(M,H,K,k,_[E+13],21,1309151649),k=m(k,M,H,K,_[E+4],6,-145523070),K=m(K,k,M,H,_[E+11],10,-1120210379),H=m(H,K,k,M,_[E+2],15,718787259),M=m(M,H,K,k,_[E+9],21,-343485551),k=i(k,x),M=i(M,b),H=i(H,C),K=i(K,U);return r(k)+r(M)+r(H)+r(K)}let Jne=1,x2=console,Is=class{static setLogger(e){x2=e}constructor(e,t){ct(this,"id",void 0),ct(this,"lockingPromise",je.resolve()),ct(this,"locks",0),ct(this,"name",""),ct(this,"lockId",void 0),this.lockId=Jne++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");x2.debug("".concat(r," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let r=new je(c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),i}};function th(e,t){return function(r,i,c){let d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){let h=this[t];if(!h)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let p=await h.lock("From ".concat(e,".").concat(i));try{for(var m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];return await d.apply(this,_)}finally{p()}},c}}let Gr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function T0(e,t){let r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function La(e,t,r,i){let c=Object.assign({},Gr,i),d=c.timeout,h=async()=>{await function(_){return new je(E=>{window.setTimeout(E,_)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)},p=!1,m=new je(async(_,E)=>{t=t||(()=>!1),r=r||(()=>!0);for(let x=0;x<c.maxRetryCount;x+=1){if(p)return E(new he(z.OPERATION_ABORTED));try{let b=await e();if(!t(b,x)||x+1===c.maxRetryCount)return _(b);await h()}catch(b){if(!r(b,x)||x+1===c.maxRetryCount)return E(b);await h()}}});return m.cancel=()=>p=!0,m}let LE,b2=class{constructor(e){ct(this,"input",[]),ct(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:zi(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},ME=0,R0=0;function N0(e,t,r,i){return new je((c,d)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),ME+=Eo(t.data)):r&&(t.data.size?ME+=t.data.size:t.data instanceof FormData?ME+=m2(t.data):ME+=Eo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,dn.request(t).then(h=>{typeof h.data=="string"?R0+=Eo(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?R0+=h.data.byteLength:R0+=Eo(JSON.stringify(h.data)),c(h.data)}).catch(h=>{dn.isCancel(h)?d(new he(z.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new he(z.NETWORK_TIMEOUT,h.message)):h.response?d(new he(z.NETWORK_RESPONSE_ERROR,h.response.status)):d(new he(z.NETWORK_ERROR,h.message))})})}async function Qne(e,t){let r=new Blob([t.data],{type:"buffer"});return await N0(e,Ce(Ce({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}let w2=()=>window.isSecureContext!==void 0;function Zi(e){if(Array.isArray(e))return e.map(r=>r);if(!S2(e))return e;let t={};for(let r in e){let i=e[r];S2(i)||Array.isArray(i)?t[r]=Zi(i):t[r]=i}return t}function S2(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let A0=class{constructor(e){ct(this,"input",[]),ct(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},vo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Ff={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:vo,remoteCandidate:vo},updateInterval:0},C2={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},T2={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},R2={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},N2={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},I0=class{constructor(e,t){ct(this,"onFirstVideoReceived",void 0),ct(this,"onFirstVideoDecoded",void 0),ct(this,"onFirstAudioReceived",void 0),ct(this,"onFirstVideoDecodedTimeout",void 0),ct(this,"onFirstAudioDecoded",void 0),ct(this,"onSelectedLocalCandidateChanged",void 0),ct(this,"onSelectedRemoteCandidateChanged",void 0),ct(this,"videoIsReady",!1),ct(this,"videoIsReady2",{}),ct(this,"pc",void 0),ct(this,"options",void 0),ct(this,"intervalTimer",void 0),ct(this,"stats",Zi(Ff)),ct(this,"isFirstVideoReceived",{}),ct(this,"isFirstVideoDecoded",{}),ct(this,"isFirstAudioReceived",{}),ct(this,"isFirstAudioDecoded",{}),ct(this,"isFirstVideoDecodedTimeout",{}),ct(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new je(e=>{e({local:Ce({},vo),remote:Ce({},vo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"],i=0,c=0,d=0,h=0;for(let p of r)e[p].forEach((m,_)=>{if(!this.lossRateWindowStats[t-1][p][_]||!this.lossRateWindowStats[0][p][_])return;let E=this.lossRateWindowStats[t-1][p][_].packets-this.lossRateWindowStats[0][p][_].packets,x=this.lossRateWindowStats[t-1][p][_].packetsLost-this.lossRateWindowStats[0][p][_].packetsLost;p==="videoSend"||p==="audioSend"?(i+=E,d+=x):(c+=E,h+=x),Number.isNaN(E)||Number.isNaN(E)?m.packetLostRate=0:m.packetLostRate=E<=0||x<=0?0:x/(E+x)});e.sendPacketLossRate=i<=0||d<=0?0:d/(i+d),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Zne=class extends I0{constructor(){super(...arguments),ct(this,"_stats",Ff),ct(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Zi(Ff);let r=t.filter(c=>c.type==="ssrc");this.processSSRCStats(r);let i=t.find(c=>c.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;let i=Ae(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{let c=Zi(T2);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{let c=Zi(C2),d=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){let h=d.stats,p=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=p,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Ce({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{let c=Zi(N2);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{let c=Zi(R2);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new je((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(r=>{let i={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(c=>{i[c]=r.stat(c)}),t.push(i)}),t}},Uf=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),FE=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),O0=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),si=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var rh=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(rh||{});function Vf(e,t,r,i){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:rh.kNone;if(!t)return;let d=Number(t[r]);if(typeof d!="number")return;let h=Number(t[i]);if(typeof h!="number")return;if(!e)return h?d/h*c:void 0;let p=Number(e[r]);if(typeof p!="number")return;let m=Number(e[i]);if(typeof m!="number")return;let _=h-m;return _?(d-p)/_*c:void 0}let A2=class extends I0{constructor(){super(...arguments),ct(this,"_stats",Ff),ct(this,"report",void 0),ct(this,"lastDecodeVideoReceiverStats",new Map),ct(this,"lastVideoFramesRecv",new Map),ct(this,"lastVideoFramesSent",new Map),ct(this,"lastVideoFramesDecode",new Map),ct(this,"lastVideoFramesOutput",new Map),ct(this,"lastVideoJBDelay",new Map),ct(this,"lastAudioJBDelay",new Map),ct(this,"mediaBytesSent",new Map),ct(this,"mediaBytesRetransmit",new Map),ct(this,"mediaBytesTargetEncode",new Map),ct(this,"lastDecodeAudioReceiverStats",new Map),ct(this,"lastAudioConcealment",new Map),ct(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Zi(Ff),this.report.forEach(e=>{switch(e.type){case si.OUTBOUND:case si.INBOUND:{let t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===si.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===si.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case si.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case si.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:Ce({},vo),remote:Ce({},vo)};return e.forEach(r=>{let i;if(r.type===si.TRANSPORT&&(i=e.get(r.selectedCandidatePairId)),r.type===si.CANDIDATE_PAIR&&r.selected&&(i=r),i){let c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(i.localCandidateId){let d=e.get(i.localCandidateId);d&&c(t.local,d)}if(i.remoteCandidateId){let d=e.get(i.remoteCandidateId);d&&c(t.remote,d)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===si.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===si.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===si.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ce({},t),Ce({},this.stats.selectedCandidatePair.localCandidate)),e.type===si.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ce({},t),Ce({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=Zi(N2),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Vf(r,t,"totalProcessingDelay","jitterBufferEmittedCount",rh.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,r,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Ce({},t))}calculateAudioFreeze(e,t,r){let i=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&i!=null){let c=i.lts,d=r.timestamp,h=d-c;if(h<=0)return;let p=e.concealedSamples-t.concealedSamples-0,m=i.nonSilent+p,_=e.totalSamplesReceived-t.totalSamplesReceived;if(_<=0)return;let E=80*_/h,x=200*_/h,b=h/_,C=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,m>E&&(i.plc80>0?(e.freezeSamples80+=p,e.freezeMs80+=Math.round(p*b)):(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*b)),C=i.plc80+1);let U=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,m>x&&(i.plc200>0?(e.freezeSamples200+=p,e.freezeMs200+=Math.round(p*b)):(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*b)),U=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:p,lts:d,plc80:C,plc200:U})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);t||(t=Zi(C2),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let r=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),d=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let h=t.decodedFrame?t.decodedFrame.width:0,p=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,h,p),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){let h=r.stats,p=d-r.lts;t.framesDecodeFreezeTime=h.framesDecodeFreezeTime,t.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=p,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<h.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Vf(r==null?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Vf(r==null?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",rh.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Vf(r==null?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",rh.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Vf(r==null?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",rh.kMillisecondsFromSeconds),i&&d-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((d-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&d-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Ce({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=Zi(T2),this._stats.videoSend.push(t));let r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{let i=new A0(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){let i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{let c=new A0(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){let i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{let c=new A0(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){let i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let c=e.framesEncoded-i.lastFrameCount,d=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*d/c}}if(e.framesEncoded&&e.qpSum){let i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let i=this.findRemoteStatsId(e.ssrc,si.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=Zi(R2),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,si.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;let i=Array.from(Ln(r=this.report).call(r)).find(c=>c.type===t&&c.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){let r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){let r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var i,c,d,h;let p=t?this.report.get(t):void 0,m=(i=p==null?void 0:p.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof m!="number")return;let _=(c=p==null?void 0:p.frameWidth)!==null&&c!==void 0?c:e.frameWidth,E=(d=p==null?void 0:p.frameHeight)!==null&&d!==void 0?d:e.frameHeight,x=(h=p==null?void 0:p.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof _=="number"&&typeof E=="number"||(_=0,E=0),x==null){let b=Date.now(),C=this.lastVideoFramesSent.get(r.ssrc);C&&b-C.lts>=800?(x=Math.round((m-C.count)/((b-C.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:m,lts:b,rate:x})):C?x=C.rate:this.lastVideoFramesSent.set(r.ssrc,{count:m,lts:b,rate:0})}r.sentFrame={width:_,height:E,frameRate:Math.max(0,x)}}processVideoTrackReceiverStats(e,t,r){var i,c,d,h,p;let m=t?this.report.get(t):void 0,_=(i=m==null?void 0:m.framesReceived)!==null&&i!==void 0?i:e.framesReceived,E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,x=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:e.frameHeight,b=(h=m==null?void 0:m.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,C=(p=m==null?void 0:m.jitterBufferEmittedCount)!==null&&p!==void 0?p:e.jitterBufferEmittedCount;if(typeof _=="number"){let U=this.lastVideoFramesRecv.get(r.ssrc),k=Date.now();r.framesReceivedCount=_;let M=0;U&&k-U.lts>=800?(M=Math.round((_-U.count)/((k-U.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:_,lts:k,rate:M})):U?M=U.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:_,lts:k,rate:0}),r.receivedFrame={width:E||0,height:x||0,frameRate:M||0},r.decodedFrame={width:E||0,height:x||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:E||0,height:x||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(b&&C){let U=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},k=U.jitterBufferMs,M=C-U.jitterBufferEmittedCount;M>0&&(k=1e3*(b-U.jitterBufferDelay)/M),r.jitterBufferMs=k,r.currentDelayMs=Math.round(k),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:C,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var i,c,d,h;let p=t?this.report.get(t):void 0,m=(i=(c=p==null?void 0:p.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&i!==void 0?i:0,_=(d=(h=p==null?void 0:p.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;r.aecReturnLoss=m,r.aecReturnLossEnhancement=_}processAudioTrackReceiverStats(e,t,r){var i,c,d,h,p,m,_,E,x;let b=t?this.report.get(t):void 0,C=(i=b==null?void 0:b.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,U=(c=b==null?void 0:b.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(d=b==null?void 0:b.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,M=(h=b==null?void 0:b.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,H=(p=b==null?void 0:b.audioLevel)!==null&&p!==void 0?p:e==null?void 0:e.audioLevel,K=(m=b==null?void 0:b.totalSamplesDuration)!==null&&m!==void 0?m:e==null?void 0:e.totalSamplesDuration,X=(_=b==null?void 0:b.concealedSamples)!==null&&_!==void 0?_:e.concealedSamples,se=(E=b==null?void 0:b.silentConcealedSamples)!==null&&E!==void 0?E:e.silentConcealedSamples,te=(x=b==null?void 0:b.concealmentEvents)!==null&&x!==void 0?x:e.concealmentEvents;if(typeof U=="number"&&(r.totalSamplesReceived=U),typeof se=="number"&&(r.silentConcealedSamples=se),typeof te=="number"&&(r.concealmentEvents=te),typeof X=="number"&&(r.concealedSamples=X),C&&U&&(r.accelerateRate=C/U),k&&M){let ce=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},fe=ce.jitterBufferMs,xe=M-ce.jitterBufferEmittedCount;xe>0&&(fe=1e3*(k-ce.jitterBufferDelay)/xe),r.jitterBufferMs=Math.round(fe),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:M,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=H;let Z=1920;K&&U&&(Z=U/K/50,r.receivedFrames=Math.round(U/Z)),X&&(r.droppedFrames=Math.round(X/Z))}processRemoteInboundStats(e,t){let r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{t=t===null?c.diffMean():t+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()});let i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},eie=class extends I0{updateStats(){return je.resolve()}};function D0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,d=function(){let h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new Zne(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:c}):new A2(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;let p=h.getStats();return!!(p instanceof je||function(m){return!!m&&(typeof m=="object"||typeof m=="function")&&typeof m.then=="function"}(p))}(e)?new A2(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:c}):new eie(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:c})}let I2="websdk_ng_install_id";function P0(){try{if(Y("INSTALL_ID"))return Y("INSTALL_ID");let e=window.localStorage.getItem(I2);return e||(e=cd(),window.localStorage.setItem(I2,e)),$t("INSTALL_ID",e),e}catch{return}}let bi=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let r=t[1],i=t[2];return"".concat(r,".").concat(i)}return"4.0.0.999"}("4.24.0"),k0=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),ld=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),Cs=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");let i=r.join(""),c=[];for(let p=0;p<6;p++)c.push("1");let d=c.join(""),h={};return h[e]=i,h[t]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Cs;let UE={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},j0={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},L0="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",M0={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},gr=Ce(Ce(Ce(Ce({},M0),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:j0,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},UE),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function $t(e,t,r){var i,c,d;Ae(i=Object.keys(gr)).call(i,e)&&(!r&&Ae(c=Object.keys(Ma)).call(c,e)||(gr[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(gr.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(d=!!t,gr.USE_NEW_NETWORK_CONFIG=d,d&&(gr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],gr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],gr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],gr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],gr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",gr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",gr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(gr.ENABLE_INSTANT_VIDEO=!0,gr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(gr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(gr.NEW_TURN_MODE||(gr.NEW_TURN_MODE=4))))}function Y(e){return gr[e]}k0||(gr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],gr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],gr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],gr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],gr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],gr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],gr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",gr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",gr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",gr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",gr.AREAS=["NORTH_AMERICA","OVERSEA"]);let O2=function(e){return e[e.REALTIME=1]="REALTIME",e}({}),Ma={};var lt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(lt||{});let Bf=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let D2=128,tie=96,P2=1e3,sh=10,rie=0;var k2=(()=>{var e={8:(i,c,d)=>{d.r(c),d.d(c,{Parser:()=>xe,Printer:()=>Vt,parse:()=>Ie,print:()=>Ve});let h=`
`,p="".concat("\r").concat(h),m=" ",_;function E(we){return we>="0"&&we<="9"}function x(we){return we>="!"&&we<="~"}function b(we){return x(we)||we>=""&&we<=""}function C(we){return we==="!"||we>="#"&&we<="'"||we>="*"&&we<="+"||we>="-"&&we<="."||we>="0"&&we<="9"||we>="A"&&we<="Z"||we>="^"&&we<="~"}function U(we){return we>="1"&&we<="9"}function k(we){return we>="A"&&we<="Z"||we>="a"&&we<="z"}function M(we){return we==="d"||we==="h"||we==="m"||we==="s"}function H(we){return we>""&&we<"	"||we>"\v"&&we<"\f"||we>""&&we<""}function K(we){return k(we)||E(we)||we==="+"||we==="/"}function X(we){return E(we)||k(we)||we==="+"||we==="/"||we==="-"||we==="_"}function se(we){return k(we)||E(we)||we==="+"||we==="/"}function te(we,P){var Q=Object.keys(we);if(Object.getOwnPropertySymbols){var re=Object.getOwnPropertySymbols(we);P&&(re=re.filter(function(Re){return Object.getOwnPropertyDescriptor(we,Re).enumerable})),Q.push.apply(Q,re)}return Q}function Z(we){for(var P=1;P<arguments.length;P++){var Q=arguments[P]!=null?arguments[P]:{};P%2?te(Object(Q),!0).forEach(function(re){ce(we,re,Q[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(we,Object.getOwnPropertyDescriptors(Q)):te(Object(Q)).forEach(function(re){Object.defineProperty(we,re,Object.getOwnPropertyDescriptor(Q,re))})}return we}function ce(we,P,Q){return P in we?Object.defineProperty(we,P,{value:Q,enumerable:!0,configurable:!0,writable:!0}):we[P]=Q,we}(function(we){we.VERSION="v",we.ORIGIN="o",we.SESSION_NAME="s",we.INFORMATION="i",we.URI="u",we.EMAIL="e",we.PHONE="p",we.CONNECTION="c",we.BANDWIDTH="b",we.TIME="t",we.REPEAT="r",we.ZONE_ADJUSTMENTS="z",we.KEY="k",we.ATTRIBUTE="a",we.MEDIA="m"})(_||(_={}));class fe{consumeText(P,Q){let re=Q;for(;re<P.length;){let Re=P[re];if(Re==="\0"||Re==="\r"||Re===h)break;re+=1}if(re-Q==0)throw new Error("Invalid text, at ".concat(P));return re}consumeUnicastAddress(P,Q,re){return this.consumeTill(P,Q,m)}consumeOneOrMore(P,Q,re){let Re=Q;for(;re(P[Re]);)Re++;if(Re-Q==0)throw new Error("Invalid rule at ".concat(Q,"."));return Re}consumeSpace(P,Q){if(P[Q]===m)return Q+1;throw new Error("Invalid space at ".concat(Q,"."))}consumeIP4Address(P,Q){let re=Q;for(let Re=0;Re<4;Re++)if(re=this.consumeDecimalUChar(P,re),Re!==3){if(P[re]!==".")throw new Error("Invalid IP4 address.");re++}return re}consumeDecimalUChar(P,Q){let re=Q;for(let ht=0;ht<3&&E(P[re]);ht++,re++);if(re-Q==0)throw new Error("Invalid decimal uchar.");let Re=parseInt(P.slice(Q,re));if(Re>=0&&Re<=255)return re;throw new Error("Invalid decimal uchar")}consumeIP6Address(P,Q){let re=this.consumeHexpart(P,Q);return P[re]===":"&&(re+=1,re=this.consumeIP4Address(P,re)),re}consumeHexpart(P,Q){let re=Q;if(P[re]===":"&&P[re+1]===":"){re+=2;try{re=this.consumeHexseq(P,re)}catch{}return re}if(re=this.consumeHexseq(P,re),P[re]===":"&&P[re+1]===":"){re+=2;try{re=this.consumeHexseq(P,re)}catch{}return re}return re}consumeHexseq(P,Q){let re=Q;for(;re=this.consumeHex4(P,re),P[re]===":"&&P[re+1]!==":";)re+=1;return re}consumeHex4(P,Q){let re=0;for(;re<4;re++)if(!((Re=P[Q+re])>="0"&&Re<="9"||Re>="a"&&Re<="f"||Re>="A"&&Re<="F")){if(re===0)throw new Error("Invalid hex 4");break}var Re;return Q+re}consumeFQDN(P,Q){let re=Q;for(;E(P[re])||k(P[re])||P[re]==="-"||P[re]===".";)re+=1;if(re-Q<4)throw new Error("Invalid FQDN");return re}consumeExtnAddr(P,Q){return this.consumeOneOrMore(P,Q,b)}consumeMulticastAddress(P,Q,re){switch(re){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(P,Q);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(P,Q);default:try{return this.consumeFQDN(P,Q)}catch{return this.consumeExtnAddr(P,Q)}}}consumeIP6MulticastAddress(P,Q){let re=this.consumeHexpart(P,Q);return P[re]==="/"?this.consumeInteger(P,re+1):re}consumeIP4MulticastAddress(P,Q){let re=Q+3,Re=P.slice(Q,re),ht=parseInt(Re);if(ht<224||ht>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let cr=0;cr<3;cr++){if(P[re]!==".")throw new Error("Invalid IP4 multicast address.");re+=1,re=this.consumeDecimalUChar(P,re)}return P[re]==="/"&&(re+=1),re=this.consumeTTL(P,re),P[re]==="/"&&(re=this.consumeInteger(P,re)),re}consumeInteger(P,Q){if(!U(P[Q]))throw new Error("Invalid integer.");for(Q+=1;E(P[Q]);)Q+=1;return Q}consumeTTL(P,Q){if(P[Q]==="0")return Q+1;if(!U(P[Q]))throw new Error("Invalid TTL.");Q+=1;for(let re=0;re<2&&E(P[Q]);re++)Q+=1;return Q}consumeToken(P,Q){return this.consumeOneOrMore(P,Q,C)}consumeTime(P,Q){let re=Q;if(P[re]==="0")return re+1;for(U(P[re])&&(re+=1);E(P[re]);)re++;if(re-Q<10)throw new Error("Invalid time");return re}consumeAddress(P,Q){return this.consumeTill(P,Q,m)}consumeTypedTime(P,Q){let re=Q;return re=this.consumeOneOrMore(P,re,E),M(P[re])?re+1:re}consumeRepeatInterval(P,Q){if(!U(P[Q]))throw new Error("Invalid repeat interval");for(Q+=1;E(P[Q]);)Q+=1;return M(P[Q])&&(Q+=1),Q}consumePort(P,Q){return this.consumeOneOrMore(P,Q,E)}consume(P,Q,re){for(let Re=0;Re<re.length;Re++){if(Q+Re>=P.length)throw new Error("consume exceeding value length");if(P[Q+Re]!==re[Re])throw new Error("consume ".concat(re," failed at ").concat(Re))}return Q+re.length}consumeTill(P,Q,re){let Re=Q;for(;Re<P.length&&(typeof re!="string"||P[Re]!==re)&&(typeof re!="function"||!re(P[Re]));)Re++;return Re}}class xe extends fe{constructor(){super(),ce(this,"records",[]),ce(this,"currentLine",0)}parse(P){let Q=this.probeEOL(P);this.records=P.split(Q).filter(dc=>!!Ks(dc).call(dc)).map(this.parseLine),this.currentLine=0;let re=this.parseVersion(),Re=this.parseOrigin(),ht=this.parseSessionName(),cr=this.parseInformation(),$r=this.parseUri(),Oi=this.parseEmail(),ua=this.parsePhone(),Cm=this.parseConnection(),Ad=this.parseBandWidth(),jh=this.parseTimeFields(),Zv=this.parseKey(),ey=this.parseSessionAttribute(),Di=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:re,origin:Re,sessionName:ht,information:cr,uri:$r,emails:Oi,phones:ua,connection:Cm,bandwidths:Ad,timeFields:jh,key:Zv,attributes:ey,mediaDescriptions:Di}}getCurrentRecord(){let P=this.records[this.currentLine];if(!P)throw new Error("Record doesn't exit.");return P}probeEOL(P){for(let Q=0;Q<P.length;Q++)if(P[Q]===h)return P[Q-1]==="\r"?p:h;throw new Error("Invalid newline character.")}parseLine(P,Q){if(P.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let re=P[0];if(P[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:re,value:P.slice(2),line:Q,cur:0}}parseSessionAttribute(){let P=new _t;for(;this.currentLine<this.records.length;){let Q=this.getCurrentRecord();if(Q.type!==_.ATTRIBUTE)break;let re={attField:this.extractOneOrMore(Q,Re=>C(Re)&&Re!==":"),_cur:0};Q.value[Q.cur]===":"&&(Q.cur+=1,re.attValue=this.extractOneOrMore(Q,H)),P.parse(re),this.currentLine++}return P.digest()}parseMediaAttributes(P){let Q=new vt(P);for(;this.currentLine<this.records.length;){let re=this.getCurrentRecord();if(re.type!==_.ATTRIBUTE)break;let Re={attField:this.extractOneOrMore(re,ht=>C(ht)&&ht!==":"),_cur:0};re.value[re.cur]===":"&&(re.cur+=1,Re.attValue=this.extractOneOrMore(re,H)),Q.parse(Re),this.currentLine++}return Q.digest()}parseKey(){let P=this.getCurrentRecord();if(P.type===_.KEY){if(P.value==="prompt"||P.value==="clear:"||P.value==="base64:"||P.value==="uri:")return P.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let P=this.getCurrentRecord();if(P.type===_.ZONE_ADJUSTMENTS){let Q=[];for(;;)try{let re=this.extract(P,this.consumeTime);this.consumeSpaceForRecord(P);let Re=!1;P.value[P.cur]==="-"&&(Re=!0,P.cur+=1);let ht=this.extract(P,this.consumeTypedTime);Q.push({time:re,typedTime:ht,back:Re})}catch{break}if(Q.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,Q}return[]}parseRepeat(){let P=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.REPEAT)break;{let re=this.extract(Q,this.consumeRepeatInterval),Re=this.parseTypedTime(Q);P.push({repeatInterval:re,typedTimes:Re}),this.currentLine++}}return P}parseTypedTime(P){let Q=[];for(;;)try{this.consumeSpaceForRecord(P),Q.push(this.extract(P,this.consumeTypedTime))}catch{break}if(Q.length===0)throw new Error("Invalid typed time.");return Q}parseTime(){let P=this.getCurrentRecord(),Q=this.extract(P,this.consumeTime);this.consumeSpaceForRecord(P);let re=this.extract(P,this.consumeTime);return this.currentLine++,{startTime:Q,stopTime:re}}parseBandWidth(){let P=[];for(;this.currentLine<this.records.length;){let Q=this.getCurrentRecord();if(Q.type!==_.BANDWIDTH)break;{let re=this.extractOneOrMore(Q,C);if(Q.value[Q.cur]!==":")throw new Error("Invalid bandwidth field.");Q.cur++;let Re=this.extractOneOrMore(Q,E);P.push({bwtype:re,bandwidth:Re}),this.currentLine++}}return P}parseVersion(){let P=this.getCurrentRecord();if(P.type!==_.VERSION)throw new Error("first sdp record must be version");let Q=P.value.slice(0,this.consumeOneOrMore(P.value,0,E));if(Q.length!==P.value.length)throw new Error('invalid proto version, "v='.concat(P.value,'"'));return this.currentLine++,Q}parseOrigin(){let P=this.getCurrentRecord();if(P.type!==_.ORIGIN)throw new Error("second line of sdp must be origin");let Q=this.extractOneOrMore(P,b);this.consumeSpaceForRecord(P);let re=this.extractOneOrMore(P,E);this.consumeSpaceForRecord(P);let Re=this.extractOneOrMore(P,E);this.consumeSpaceForRecord(P);let ht=this.extractOneOrMore(P,C);this.consumeSpaceForRecord(P);let cr=this.extractOneOrMore(P,C);this.consumeSpaceForRecord(P);let $r=this.extract(P,this.consumeUnicastAddress);return this.currentLine++,{username:Q,sessId:re,sessVersion:Re,nettype:ht,addrtype:cr,unicastAddress:$r}}parseSessionName(){let P=this.getCurrentRecord();if(P.type===_.SESSION_NAME){let Q=this.extract(P,this.consumeText);return this.currentLine++,Q}}parseInformation(){let P=this.getCurrentRecord();if(P.type!==_.INFORMATION)return;let Q=this.extract(P,this.consumeText);return this.currentLine++,Q}parseUri(){let P=this.getCurrentRecord();if(P.type===_.URI)return this.currentLine++,P.value}parseEmail(){let P=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.EMAIL)break;P.push(Q.value),this.currentLine++}return P}parsePhone(){let P=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.PHONE)break;P.push(Q.value),this.currentLine++}return P}parseConnection(){let P=this.getCurrentRecord();if(P.type===_.CONNECTION){let Q=this.extractOneOrMore(P,C);this.consumeSpaceForRecord(P);let re=this.extractOneOrMore(P,C);this.consumeSpaceForRecord(P);let Re=this.extract(P,this.consumeAddress);return this.currentLine++,{nettype:Q,addrtype:re,address:Re}}}parseMedia(){let P=this.getCurrentRecord(),Q=this.extract(P,this.consumeToken);this.consumeSpaceForRecord(P);let re=this.extract(P,this.consumePort);P.value[P.cur]==="/"&&(P.cur+=1,re+=this.extract(P,this.consumeInteger)),this.consumeSpaceForRecord(P);let Re=[];for(Re.push(this.extract(P,this.consumeToken));P.value[P.cur]==="/";)P.cur+=1,Re.push(this.extract(P,this.consumeToken));if(Re.length===0)throw new Error("Invalid proto");let ht=this.parseFmt(P);return this.currentLine++,{mediaType:Q,port:re,protos:Re,fmts:ht}}parseTimeFields(){let P=[];for(;this.getCurrentRecord().type===_.TIME;){let Q=this.parseTime(),re=this.parseRepeat(),Re=this.parseZone();P.push({time:Q,repeats:re,zones:Re})}return P}parseMediaDescription(){let P=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.MEDIA;){let Q=this.parseMedia(),re=this.parseInformation(),Re=this.parseConnections(),ht=this.parseBandWidth(),cr=this.parseKey(),$r=this.parseMediaAttributes(Q);P.push({media:Q,information:re,connections:Re,bandwidths:ht,key:cr,attributes:$r})}return P}parseConnections(){let P=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.CONNECTION;)P.push(this.parseConnection());return P}parseFmt(P){let Q=[];for(;;)try{this.consumeSpaceForRecord(P),Q.push(this.extract(P,this.consumeToken))}catch{break}if(Q.length===0)throw new Error("Invalid fmts");return Q}extract(P,Q){for(var re=arguments.length,Re=new Array(re>2?re-2:0),ht=2;ht<re;ht++)Re[ht-2]=arguments[ht];let cr=Q.call(this,P.value,P.cur,...Re),$r=P.value.slice(P.cur,cr);return P.cur=cr,$r}extractOneOrMore(P,Q){let re=this.consumeOneOrMore(P.value,P.cur,Q),Re=P.value.slice(P.cur,re);return P.cur=re,Re}consumeSpaceForRecord(P){if(P.value[P.cur]!==m)throw new Error("Invalid space at ".concat(P.cur,"."));P.cur+=1}}class Te extends fe{constructor(){super(...arguments),ce(this,"attributes",void 0),ce(this,"digested",!1)}extractOneOrMore(P,Q,re){let Re=this.consumeOneOrMore(P.attValue,P._cur,Q),ht=P.attValue.slice(P._cur,Re),[cr,$r]=re||[];if(typeof cr=="number"&&ht.length<cr)throw new Error("error in length, should be more or equal than ".concat(cr," characters."));if(typeof $r=="number"&&ht.length>$r)throw new Error("error in length, should be less or equal than ".concat($r," characters."));return P._cur=Re,ht}consumeAttributeSpace(P){if(P.attValue[P._cur]!==m)throw new Error("Invalid space at ".concat(P._cur,"."));P._cur+=1}extract(P,Q){if(!P.attValue)throw new Error("Nothing to extract from attValue.");for(var re=arguments.length,Re=new Array(re>2?re-2:0),ht=2;ht<re;ht++)Re[ht-2]=arguments[ht];let cr=Q.call(this,P.attValue,P._cur,...Re),$r=P.attValue.slice(P._cur,cr);return P._cur=cr,$r}atEnd(P){if(!P.attValue)throw new Error;return P._cur>=P.attValue.length}peekChar(P){if(!P.attValue)throw new Error;return P.attValue[P._cur]}peek(P,Q){if(!P.attValue)throw new Error;for(let re=0;re<Q.length;re++)if(Q[re]!==P.attValue[P._cur+re])return!1;return!0}parseIceUfrag(P){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(P,K,[4,256])}parseIcePwd(P){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(P,K,[22,256])}parseIceOptions(P){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let Q=[];for(;!this.atEnd(P);){Q.push(this.extractOneOrMore(P,K));try{this.consumeAttributeSpace(P)}catch(re){if(this.atEnd(P))break;throw re}}this.attributes.iceOptions=Q}parseFingerprint(P){let Q=this.extract(P,this.consumeToken);this.consumeAttributeSpace(P);let re=this.extract(P,this.consumeTill);this.attributes.fingerprints.push({hashFunction:Q,fingerprint:re})}parseExtmap(P){let Q=this.extractOneOrMore(P,E),re;this.peekChar(P)==="/"&&(this.extract(P,this.consume,"/"),re=this.extract(P,this.consumeToken)),this.consumeAttributeSpace(P);let Re=this.extract(P,this.consumeTill,m),ht=Z(Z({entry:parseInt(Q,10)},re&&{direction:re}),{},{extensionName:Re});this.peekChar(P)===m&&(this.consumeAttributeSpace(P),ht.extensionAttributes=this.extract(P,this.consumeTill)),this.attributes.extmaps.push(ht)}parseSetup(P){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let Q=this.extract(P,this.consumeTill);if(Q!=="active"&&Q!=="passive"&&Q!=="actpass"&&Q!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=Q}}class _t extends Te{constructor(){super(...arguments),ce(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(P){if(this.digested)throw new Error("already digested");try{switch(P.attField){case"group":this.parseGroup(P);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(P);break;case"ice-pwd":this.parseIcePwd(P);break;case"ice-options":this.parseIceOptions(P);break;case"fingerprint":this.parseFingerprint(P);break;case"setup":this.parseSetup(P);break;case"tls-id":this.parseTlsId(P);break;case"identity":this.parseIdentity(P);break;case"extmap":this.parseExtmap(P);break;case"msid-semantic":this.parseMsidSemantic(P);break;default:P.ignored=!0,this.attributes.unrecognized.push(P)}}catch(Q){throw console.error("parsing session attribute ".concat(P.attField,' error, "a=').concat(P.attField,":").concat(P.attValue,'"')),Q}if(!P.ignored&&P.attValue&&!this.atEnd(P))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(P){let Q=this.extract(P,this.consumeToken),re=[];for(;!this.atEnd(P)&&this.peekChar(P)===m;)this.consumeAttributeSpace(P),re.push(this.extract(P,this.consumeToken));this.attributes.groups.push({semantic:Q,identificationTag:re})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(P){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(P,X)}parseIdentity(P){let Q=this.extractOneOrMore(P,se),re=[];for(;!this.atEnd(P)&&this.peekChar(P)===m;){this.consumeAttributeSpace(P);let Re=this.extract(P,this.consumeToken);this.extract(P,this.consume,"=");let ht=this.extractOneOrMore(P,cr=>cr!==m&&H(cr));re.push({name:Re,value:ht})}this.attributes.identities.push({assertionValue:Q,extensions:re})}parseMsidSemantic(P){this.peekChar(P)===m&&this.consumeAttributeSpace(P);let Q={semantic:this.extract(P,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(P)}catch{break}if(this.peekChar(P)==="*"){this.extract(P,this.consume,"*"),Q.applyForAll=!0;break}{let re=this.extract(P,this.consumeTill,m);Q.identifierList.push(re)}}this.attributes.msidSemantic=Q}}class vt extends Te{constructor(P){super(),ce(this,"attributes",void 0),P.protos.indexOf("RTP")!==-1||P.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(P){if(this.digested)throw new Error("already digested");try{switch(P.attField){case"extmap":this.parseExtmap(P);break;case"setup":this.parseSetup(P);break;case"ice-ufrag":this.parseIceUfrag(P);break;case"ice-pwd":this.parseIcePwd(P);break;case"ice-options":this.parseIceOptions(P);break;case"candidate":this.parseCandidate(P);break;case"remote-candidate":this.parseRemoteCandidate(P);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(P);break;case"rtpmap":this.parseRtpmap(P);break;case"ptime":this.parsePtime(P);break;case"maxptime":this.parseMaxPtime(P);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(P);break;case"ssrc":this.parseSSRC(P);break;case"fmtp":this.parseFmtp(P);break;case"rtcp-fb":this.parseRtcpFb(P);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(P);break;case"mid":this.parseMid(P);break;case"msid":this.parseMsid(P);break;case"imageattr":this.parseImageAttr(P);break;case"rid":this.parseRid(P);break;case"simulcast":this.parseSimulcast(P);break;case"sctp-port":this.parseSctpPort(P);break;case"max-message-size":this.parseMaxMessageSize(P);break;case"ssrc-group":this.parseSSRCGroup(P);break;default:P.ignored=!0,this.attributes.unrecognized.push(P)}}catch(Q){throw console.error("parsing media attribute ".concat(P.attField,' error, "a=').concat(P.attField,":").concat(P.attValue,'"')),Q}if(!P.ignored&&P.attValue&&!this.atEnd(P))throw new Error("attribute parsing error")}parseCandidate(P){let Q=this.extractOneOrMore(P,K,[1,32]);this.consumeAttributeSpace(P);let re=this.extractOneOrMore(P,E,[1,5]);this.consumeAttributeSpace(P);let Re=this.extract(P,this.consumeToken);this.consumeAttributeSpace(P);let ht=this.extractOneOrMore(P,E,[1,10]);this.consumeAttributeSpace(P);let cr=this.extract(P,this.consumeAddress);this.consumeAttributeSpace(P);let $r=this.extract(P,this.consumePort);this.consumeAttributeSpace(P),this.extract(P,this.consume,"typ"),this.consumeAttributeSpace(P);let Oi={foundation:Q,componentId:re,transport:Re,priority:ht,connectionAddress:cr,port:$r,type:this.extract(P,this.consumeToken),extension:{}};for(this.peek(P," raddr")&&(this.extract(P,this.consume," raddr"),this.consumeAttributeSpace(P),Oi.relAddr=this.extract(P,this.consumeAddress)),this.peek(P," rport")&&(this.extract(P,this.consume," rport"),this.consumeAttributeSpace(P),Oi.relPort=this.extract(P,this.consumePort));this.peekChar(P)===m;){this.consumeAttributeSpace(P);let ua=this.extract(P,this.consumeToken);this.consumeAttributeSpace(P),Oi.extension[ua]=this.extractOneOrMore(P,x)}this.attributes.candidates.push(Oi)}parseRemoteCandidate(P){let Q=[];for(;;){let re=this.extractOneOrMore(P,E,[1,5]);this.consumeAttributeSpace(P);let Re=this.extract(P,this.consumeAddress);this.consumeAttributeSpace(P);let ht=this.extract(P,this.consumePort);Q.push({componentId:re,connectionAddress:Re,port:ht});try{this.consumeAttributeSpace(P)}catch{break}}this.attributes.remoteCandidatesList.push(Q)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(P){let Q=this.extract(P,this.consumeToken);this.consumeAttributeSpace(P);let re=this.extract(P,this.consumeTill,"/");this.extract(P,this.consume,"/");let Re={encodingName:re,clockRate:this.extractOneOrMore(P,E)};this.atEnd(P)||this.peekChar(P)!=="/"||(this.extract(P,this.consume,"/"),Re.encodingParameters=parseInt(this.extract(P,this.consumeTill),10));let ht=this.attributes.payloads.find(cr=>cr.payloadType===parseInt(Q,10));ht?ht.rtpMap=Re:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtpMap:Re,rtcpFeedbacks:[]})}parsePtime(P){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(P,this.consumeTill)}parseMaxPtime(P){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(P,this.consumeTill)}parseDirection(P){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=P.attField}parseSSRC(P){let Q=this.extractOneOrMore(P,E);this.consumeAttributeSpace(P);let re=this.extract(P,this.consumeTill,":"),Re;this.peekChar(P)===":"&&(this.extract(P,this.consume,":"),Re=this.extract(P,this.consumeTill));let ht=this.attributes.ssrcs.find(cr=>cr.ssrcId===parseInt(Q,10));ht?ht.attributes[re]=Re:this.attributes.ssrcs.push({ssrcId:parseInt(Q,10),attributes:{[re]:Re}})}parseFmtp(P){let Q=this.extract(P,this.consumeTill,m);this.consumeAttributeSpace(P);let re=this.extract(P,this.consumeTill),Re={};re.split(";").forEach(cr=>{let[$r,Oi]=cr.split("=");$r=Ks($r).call($r);let ua=typeof Oi=="string"?Ks(Oi).call(Oi):null;typeof $r=="string"&&$r.length>0&&(Re[$r]=ua)});let ht=this.attributes.payloads.find(cr=>cr.payloadType===parseInt(Q,10));ht?ht.fmtp={parameters:Re}:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[],fmtp:{parameters:Re}})}parseFmtParameters(P){let Q={},re=this.extract(P,this.consumeTill,"=");P._cur++;let Re=this.extract(P,this.consumeTill,";");for(Q[re]=Re;P.attValue[P._cur]===";";){let ht=this.extract(P,this.consumeTill,"=");P._cur++;let cr=this.extract(P,this.consumeTill,";");Q[ht]=cr}return Q}parseRtcpFb(P){let Q="";Q=this.peekChar(P)==="*"?this.extract(P,this.consume,"*"):this.extract(P,this.consumeTill,m),this.consumeAttributeSpace(P);let re=this.extract(P,this.consumeTill,m),Re;if(re==="trr-int")Re={type:re,interval:this.extract(P,this.consumeTill)};else{let ht={type:re};this.peekChar(P)===m&&(this.consumeAttributeSpace(P),ht.parameter=this.extract(P,this.consumeToken),this.peekChar(P)===m&&(ht.additional=this.extract(P,this.consumeTill))),Re=ht}if(Q==="*")this.attributes.rtcpFeedbackWildcards.push(Re);else{let ht=this.attributes.payloads.find(cr=>cr.payloadType===parseInt(Q,10));ht?ht.rtcpFeedbacks.push(Re):this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[Re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(P){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let Q={port:this.extract(P,this.consumePort)};this.peekChar(P)===m&&(this.consumeAttributeSpace(P),Q.netType=this.extractOneOrMore(P,C),this.consumeAttributeSpace(P),Q.addressType=this.extractOneOrMore(P,C),this.consumeAttributeSpace(P),Q.address=this.extract(P,this.consumeAddress)),this.attributes.rtcp=Q}parseMsid(P){let Q={id:this.extractOneOrMore(P,C,[1,64])};this.peekChar(P)===m&&(this.consumeAttributeSpace(P),Q.appdata=this.extractOneOrMore(P,C,[1,64])),this.attributes.msids.push(Q)}parseImageAttr(P){this.attributes.imageattr.push(P.attValue)}parseRid(P){let Q=this.extractOneOrMore(P,Re=>k(Re)||E(Re)||Re==="_"||Re==="-");this.consumeAttributeSpace(P);let re={id:Q,direction:this.extract(P,this.consumeToken),params:[]};if(this.peekChar(P)===m){if(this.consumeAttributeSpace(P),this.peek(P,"pt=")){this.extract(P,this.consume,"pt=");let Re=[];for(;;){let ht=this.extract(P,this.consumeToken);Re.push(ht);try{this.extract(P,this.consume,",")}catch{break}}re.payloads=Re,this.peekChar(P)===m&&this.extract(P,this.consume,m)}for(;;){let Re=this.extract(P,this.consumeToken);switch(Re){case"depend":{let ht={type:Re,rids:this.extract(P,this.consume,"=").split(",")};re.params.push(ht);break}default:{let ht={type:Re};this.peekChar(P)==="="&&(this.extract(P,this.consume,"="),ht.val=this.extract(P,this.consumeTill,";")),re.params.push(ht)}}try{this.extract(P,this.consume,";")}catch{break}}}this.attributes.rids.push(re)}parseSimulcast(P){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=P.attValue,this.extract(P,this.consumeTill)}parseSctpPort(P){this.attributes.sctpPort=this.extractOneOrMore(P,E,[1,5])}parseMaxMessageSize(P){this.attributes.maxMessageSize=this.extractOneOrMore(P,E,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(P){this.attributes.mid=this.extract(P,this.consumeToken)}parseSSRCGroup(P){let Q=this.extract(P,this.consumeToken),re=[];for(;;)try{this.consumeAttributeSpace(P);let Re=this.extract(P,this.consumeInteger);re.push(parseInt(Re,10))}catch{break}this.attributes.ssrcGroups.push({semantic:Q,ssrcIds:re})}}function at(we,P,Q){return P in we?Object.defineProperty(we,P,{value:Q,enumerable:!0,configurable:!0,writable:!0}):we[P]=Q,we}class Vt{constructor(){at(this,"eol",p)}print(P,Q){let re="";return Q&&(this.eol=Q),re+=this.printVersion(P.version),re+=this.printOrigin(P.origin),re+=this.printSessionName(P.sessionName),re+=this.printInformation(P.information),re+=this.printUri(P.uri),re+=this.printEmail(P.emails),re+=this.printPhone(P.phones),re+=this.printConnection(P.connection),re+=this.printBandwidth(P.bandwidths),re+=this.printTimeFields(P.timeFields),re+=this.printKey(P.key),re+=this.printSessionAttributes(P.attributes),re+=this.printMediaDescription(P.mediaDescriptions),re}printVersion(P){return"v=".concat(P).concat(this.eol)}printOrigin(P){return"o=".concat(P.username," ").concat(P.sessId," ").concat(P.sessVersion," ").concat(P.nettype," ").concat(P.addrtype," ").concat(P.unicastAddress).concat(this.eol)}printSessionName(P){return P?"s=".concat(P).concat(this.eol):""}printInformation(P){return P?"i=".concat(P).concat(this.eol):""}printUri(P){return P?"u=".concat(P).concat(this.eol):""}printEmail(P){let Q="";for(let re of P)Q+="e=".concat(re).concat(this.eol);return Q}printPhone(P){let Q="";for(let re of P)Q+="e=".concat(re).concat(this.eol);return Q}printConnection(P){return P?"c=".concat(P.nettype," ").concat(P.addrtype," ").concat(P.address).concat(this.eol):""}printBandwidth(P){let Q="";for(let re of P)Q+="b=".concat(re.bwtype,":").concat(re.bandwidth).concat(this.eol);return Q}printTimeFields(P){let Q="";for(let re of P){Q+="t=".concat(re.time.startTime," ").concat(re.time.startTime).concat(this.eol);for(let Re of re.repeats)Q+="r=".concat(Re.repeatInterval," ").concat(Re.typedTimes.join(" ")).concat(this.eol);re.zoneAdjustments&&(Q+="z=",Q+="z=".concat(re.zoneAdjustments.map(Re=>"".concat(Re.time," ").concat(Re.back?"-":""," ").concat(Re.typedTime)).join(" ")).concat(this.eol),Q+=this.eol)}return Q}printKey(P){return P?"k=".concat(P).concat(this.eol):""}printAttributes(P){let Q="";for(let re of P)Q+="a=".concat(re.attField).concat(re.attValue?":".concat(re.attValue):"").concat(this.eol);return Q}printMediaDescription(P){let Q="";for(let re of P)Q+=this.printMedia(re.media),Q+=this.printInformation(re.information),Q+=this.printConnections(re.connections),Q+=this.printBandwidth(re.bandwidths),Q+=this.printKey(re.key),Q+=this.printMediaAttributes(re);return Q}printConnections(P){let Q="";for(let re of P)Q+=this.printConnection(re);return Q}printMedia(P){return"m=".concat(P.mediaType," ").concat(P.port," ").concat(P.protos.join("/")," ").concat(P.fmts.join(" ")).concat(this.eol)}printSessionAttributes(P){return new js(this.eol).print(P)}printMediaAttributes(P){return new ge(this.eol).print(P)}}class Mt{constructor(P){at(this,"eol",void 0),this.eol=P}printIceUfrag(P){return P===void 0?"":"a=ice-ufrag:".concat(P).concat(this.eol)}printIcePwd(P){return P===void 0?"":"a=ice-pwd:".concat(P).concat(this.eol)}printIceOptions(P){return P===void 0?"":"a=ice-options:".concat(P.join(m)).concat(this.eol)}printFingerprints(P){return P.length>0?P.map(Q=>"a=fingerprint:".concat(Q.hashFunction).concat(m).concat(Q.fingerprint)).join(this.eol)+this.eol:""}printExtmap(P){return P.map(Q=>"a=extmap:".concat(Q.entry).concat(Q.direction?"/".concat(Q.direction):"").concat(m).concat(Q.extensionName).concat(Q.extensionAttributes?"".concat(m).concat(Q.extensionAttributes):"").concat(this.eol)).join("")}printSetup(P){return P===void 0?"":"a=setup:".concat(P).concat(this.eol)}printUnrecognized(P){return P.map(Q=>"a=".concat(Q.attField).concat(Q.attValue?":".concat(Q.attValue):"").concat(this.eol)).join("")}}class js extends Mt{print(P){let Q="";return Q+=this.printGroups(P.groups),Q+=this.printMsidSemantic(P.msidSemantic),Q+=this.printIceLite(P.iceLite),Q+=this.printIceUfrag(P.iceUfrag),Q+=this.printIcePwd(P.icePwd),Q+=this.printIceOptions(P.iceOptions),Q+=this.printFingerprints(P.fingerprints),Q+=this.printSetup(P.setup),Q+=this.printTlsId(P.tlsId),Q+=this.printIdentity(P.identities),Q+=this.printExtmap(P.extmaps),Q+=this.printUnrecognized(P.unrecognized),Q}printGroups(P){let Q="";return P.length>0&&(Q+=P.map(re=>"a=group:".concat(re.semantic).concat(re.identificationTag.map(Re=>"".concat(m).concat(Re)).join("")).concat(this.eol)).join("")),Q}printIceLite(P){return P===void 0?"":"a=ice-lite"+this.eol}printTlsId(P){return P?"a=tls-id:".concat(P).concat(this.eol):""}printIdentity(P){return P.length===0?"":P.map(Q=>"a=identity:".concat(Q.assertionValue).concat(Q.extensions.map(re=>"".concat(m).concat(re.name).concat(re.value?"=".concat(re.value):"")))).join(this.eol)+this.eol}printMsidSemantic(P){if(!P)return"";let Q="a=msid-semantic:".concat(P.semantic);return P.applyForAll?Q+="".concat(m,"*"):P.identifierList.length>0&&(Q+=P.identifierList.map(re=>"".concat(m).concat(re))),Q+this.eol}}class ge extends Mt{print(P){let Q=P.attributes,re="";return re+=this.printRTCP(Q.rtcp),re+=this.printIceUfrag(Q.iceUfrag),re+=this.printIcePwd(Q.icePwd),re+=this.printIceOptions(Q.iceOptions),re+=this.printCandidates(Q.candidates),re+=this.printRemoteCandidatesList(Q.remoteCandidatesList),re+=this.printEndOfCandidates(Q.endOfCandidates),re+=this.printFingerprints(Q.fingerprints),re+=this.printSetup(Q.setup),re+=this.printMid(Q.mid),re+=this.printExtmap(Q.extmaps),re+=this.printRTPRelated(Q),re+=this.printPtime(Q.ptime),re+=this.printMaxPtime(Q.maxPtime),re+=this.printDirection(Q.direction),re+=this.printSSRCGroups(Q.ssrcGroups),re+=this.printSSRC(Q.ssrcs),re+=this.printRTCPMux(Q.rtcpMux),re+=this.printRTCPMuxOnly(Q.rtcpMuxOnly),re+=this.printRTCPRsize(Q.rtcpRsize),re+=this.printMSId(Q.msids),re+=this.printImageattr(Q.imageattr),re+=this.printRid(Q.rids),re+=this.printSimulcast(Q.simulcast),re+=this.printSCTPPort(Q.sctpPort),re+=this.printMaxMessageSize(Q.maxMessageSize),re+=this.printUnrecognized(Q.unrecognized),re}printCandidates(P){return P.map(Q=>"a=candidate:".concat(Q.foundation).concat(m).concat(Q.componentId).concat(m).concat(Q.transport).concat(m).concat(Q.priority).concat(m).concat(Q.connectionAddress).concat(m).concat(Q.port).concat(m,"typ").concat(m).concat(Q.type).concat(Q.relAddr?"".concat(m,"raddr").concat(m).concat(Q.relAddr):"").concat(Q.relPort?"".concat(m,"rport").concat(m).concat(Q.relPort):"").concat(Object.keys(Q.extension).map(re=>"".concat(m).concat(re).concat(m).concat(Q.extension[re])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(P){return P.map(Q=>"a=remote-candidates:".concat(Q.join(m)).concat(this.eol)).join("")}printEndOfCandidates(P){return P===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(P){if(!P.payloads)return"";let Q=P.payloads,re="";re+=P.rtcpFeedbackWildcards.map(Re=>this.printRTCPFeedback("*",Re)).join("");for(let Re of Q)re+=this.printRtpMap(Re.payloadType,Re.rtpMap),re+=this.printFmtp(Re.payloadType,Re.fmtp),re+=Re.rtcpFeedbacks.map(ht=>this.printRTCPFeedback(Re.payloadType,ht)).join("");return re}printFmtp(P,Q){if(!Q)return"";let re=Object.keys(Q.parameters);return re.length===1&&Q.parameters[re[0]]===null?"a=fmtp:".concat(P).concat(m).concat(re[0]).concat(this.eol):"a=fmtp:".concat(P).concat(m).concat(Object.keys(Q.parameters).map(Re=>"".concat(Re,"=").concat(Q.parameters[Re])).join(";")).concat(this.eol)}printRtpMap(P,Q){return Q?"a=rtpmap:".concat(P).concat(m).concat(Q.encodingName,"/").concat(Q.clockRate).concat(Q.encodingParameters?"/".concat(Q.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(P,Q){let re="a=rtcp-fb:".concat(P).concat(m),Re=Q;return Re.type==="trr-int"?re+="ttr-int".concat(m).concat(Re.interval):(re+="".concat(Re.type),Re.parameter&&(re+="".concat(m).concat(Re.parameter),Re.additional&&(re+="".concat(m).concat(Re.additional)))),re+this.eol}printPtime(P){return P===void 0?"":"a=ptime:".concat(P).concat(this.eol)}printMaxPtime(P){return P===void 0?"":"a=maxptime:".concat(P).concat(this.eol)}printDirection(P){return P===void 0?"":"a=".concat(P).concat(this.eol)}printSSRC(P){return P.map(Q=>Object.keys(Q.attributes).map(re=>"a=ssrc:".concat(Q.ssrcId.toString(10)).concat(m).concat(re).concat(Q.attributes[re]?":".concat(Q.attributes[re]):"").concat(this.eol)).join("")).join("")}printRTCPMux(P){return P===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(P){return P===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(P){return P===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(P){if(P===void 0)return"";let Q="a=rtcp:".concat(P.port);return P.netType&&(Q+="".concat(m).concat(P.netType)),P.addressType&&(Q+="".concat(m).concat(P.addressType)),P.address&&(Q+="".concat(m).concat(P.address)),Q+this.eol}printMSId(P){return P.map(Q=>"a=msid:".concat(Q.id).concat(Q.appdata?"".concat(m).concat(Q.appdata):"").concat(this.eol)).join("")}printImageattr(P){return P.map(Q=>"a=imageattr:".concat(Q).concat(this.eol)).join("")}printRid(P){return P.map(Q=>{let re="a=rid:".concat(Q.id).concat(m).concat(Q.direction);return Q.payloads&&(re+="".concat(m,"pt=").concat(Q.payloads.join(","))),Q.params.length>0&&(re+="".concat(m).concat(Q.params.map(Re=>Re.type==="depend"?"depend=".concat(Re.rids.join(",")):"".concat(Re.type,"=").concat(Re.val)).join(";"))),re+this.eol}).join("")}printSimulcast(P){return P===void 0?"":"a=simulcast:".concat(P).concat(this.eol)}printSCTPPort(P){return P===void 0?"":"a=sctp-port:".concat(P).concat(this.eol)}printMaxMessageSize(P){return P===void 0?"":"a=max-message-size:".concat(P).concat(this.eol)}printMid(P){return P===void 0?"":"a=mid:".concat(P).concat(this.eol)}printSSRCGroups(P){return P.map(Q=>"a=ssrc-group:".concat(Q.semantic).concat(Q.ssrcIds.map(re=>"".concat(m).concat(re.toString(10))).join("")).concat(this.eol)).join("")}}function Ie(we){return new xe().parse(we)}function Ve(we,P){return new Vt().print(we,P)}}},t={};function r(i){if(t[i])return t[i].exports;var c=t[i]={exports:{}};return e[i](c,c.exports,r),c.exports}return r.d=(i,c)=>{for(var d in c)r.o(c,d)&&!r.o(i,d)&&Object.defineProperty(i,d,{enumerable:!0,get:c[d]})},r.o=(i,c)=>Object.prototype.hasOwnProperty.call(i,c),r.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},r(8)})();function yn(e){return k2.parse(e)}function Vc(e,t){return k2.print(e,t)}var sie=Hi("Array","keys"),nie=Ac,iie=Us,aie=I,oie=sie,F0=Array.prototype,cie={DOMTokenList:!0,NodeList:!0},lie=function(e){var t=e.keys;return e===F0||aie(F0,e)&&t===F0.keys||iie(cie,nie(e))?oie:t},xn=u(lie);function Tr(e,t,r){return(t=function(i){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var m=p.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(i);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function mt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j2(Object(r),!0).forEach(function(i){Tr(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j2(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let L2=new class extends br{constructor(){super(...arguments),Tr(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class die{constructor(t){Tr(this,"logger",void 0),Tr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function U0(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function M2(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let wi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},VE=Date.now(),Wf=e=>{for(let t in wi)if(Object.prototype.hasOwnProperty.call(wi,t)&&wi[t]===e)return t;return"DEFAULT"},N=new class{constructor(){Tr(this,"proxyServerURL",void 0),Tr(this,"logLevel",wi.DEBUG),Tr(this,"uploadState","collecting"),Tr(this,"uploadLogWaitingList",[]),Tr(this,"uploadLogUploadingList",[]),Tr(this,"uploadErrorCount",0),Tr(this,"currentLogID",0),Tr(this,"url",void 0),Tr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[wi.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[wi.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[wi.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[wi.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[wi.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){$t("UPLOAD_LOG",!0)}disableLogUpload(){$t("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new die(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-VE<100)return void setTimeout(()=>{this.log(...t)},Date.now()-VE);let i=Math.max(0,Math.min(4,t[0]));if(t[0]=U0()+" Agora-SDK [".concat(Wf(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;let c=U0()+" %cAgora-SDK [".concat(Wf(i),"]:"),d=[];if(!Y("USE_NEW_LOG"))switch(i){case wi.DEBUG:d=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,d);break;case wi.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,d);break;case wi.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,d);break;case wi.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-VE<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-VE);let i=Math.max(0,Math.min(4,t[0]));t[0]=U0()+" Agora-SDK [".concat(Wf(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!Y("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];Array.isArray(r[0])?r[0][0]=M2()+" Agora-SDK [".concat(Wf(e),"]:"):r[0]=M2()+" Agora-SDK [".concat(Wf(e),"]:");let c="";r.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:bi,process_id:Y("PROCESS_ID"),payload:JSON.stringify(e)};return La(async()=>{let r=await dn.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Y("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Y("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){let i=new Error("unexpected upload log response");throw i.response=r,i}},()=>(this.uploadLogUploadingList=[],!1),r=>{let i={status:-1,message:r.message,errorRange:e.map(c=>c.log_item_id)};return r.response?(i.status=r.response.status,i.data=r.response.data,i.headers=r.response.headers):r.request&&(i.status=r.request.status),L2.reportLogUploadError(i),!0},{timeout:Y("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Y("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Y("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Y("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Y("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Y("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var F2;function uie(e){return us(e.reportId,"params.reportId",0,100,!1),us(e.category,"params.category",0,100,!1),us(e.event,"params.event",0,100,!1),us(e.label,"params.label",0,100,!1),Qt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(F2={}).FREE="free",F2.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let hie={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Qr=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),_r=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let pie=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function st(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,i){let c=i.value;if(typeof c=="function"){let d=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var h,p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];let E=m;if(e.argsMap)try{E=e.argsMap(this,...m)}catch(b){N.warning(b),E=[]}try{JSON.stringify(E)}catch{N.warning("arguments for method ".concat(d,".").concat(String(r)," not serializable for apiInvoke.")),E=[]}let x=(e.report||ze).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(r)),options:E,tag:Er.TRACER,reportResult:e.reportResult},e.throttleTime);try{let b=c.apply(this,m);return b instanceof je?b.then(C=>(x.onSuccess(e.reportResult&&C),C)).catch(C=>{throw x.onError(C),C}):(x.onSuccess(e.reportResult&&b),b)}catch(b){throw x.onError(b),b}}}return i}}let ze=new class{constructor(){Tr(this,"baseInfoMap",new Map),Tr(this,"proxyServer",void 0),Tr(this,"eventUploadTimer",void 0),Tr(this,"setSessionIdTimer",void 0),Tr(this,"url",void 0),Tr(this,"sids",new Set),Tr(this,"backupUrl",void 0),Tr(this,"_appId",void 0),Tr(this,"_aid",0),Tr(this,"keyEventUploadPendingItems",[]),Tr(this,"normalEventUploadPendingItems",[]),Tr(this,"apiInvokeUploadPendingItems",[]),Tr(this,"apiInvokeCount",0),Tr(this,"apiInvokeLoggedCount",0),Tr(this,"ltsList",[]),Tr(this,"lastSendNormalEventTime",Date.now()),Tr(this,"customReportCounterTimer",void 0),Tr(this,"customReportCount",0),Tr(this,"extApiInvoke",async e=>{for(let t of e){let r=mt(mt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Er.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Y("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Y("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[r,i]=t;return r+i}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let i=Date.now();this.apiInvokeCount+=1;let c=this.apiInvokeCount,d=!!Y("SHOW_REPORT_INVOKER_LOG"),h=!!Y("SHOW_REPORT_USER_INVOKER_LOG"),p=d||h&&t.id;p&&(this.apiInvokeLoggedCount+=1);let m=this.apiInvokeLoggedCount;function _(C,U){if(p){let k="[apiInvoke-".concat(m,"]");if(t.id&&(k+="[".concat(t.id,"]")),t.name&&(k+="[".concat(t.name,"]"),t.name===Or.JOIN))return N.info("".concat(k," ").concat(C));N.info("".concat(k," ").concat(C),C==="start"?t.options:U||"")}}let E=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});_("start");let x=!1;hs(t.timeout).then(()=>{x||(this.sendApiInvoke(mt(mt({},E()),{},{error:z.API_INVOKE_TIMEOUT,success:!1})),_("timeout"))});let b=new he(z.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:C=>{let U=()=>{if(x)throw b;return x=!0,this.sendApiInvoke(mt(mt({},E()),{},{success:!0},t.reportResult&&{result:C})),_("onSuccess"),C};return r?_2(U,t.name+"Success",r,()=>x=!0):U()},onError:C=>{let U=()=>{if(x)throw C;x=!0,this.sendApiInvoke(mt(mt({},E()),{},{success:!1,error:C})),_("onFailure",C.toString())};return r?_2(U,t.name+"Error",r,()=>x=!0):U()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let r=Date.now(),i=this.createBaseInfo(e,r);i.cname=t.cname;let c=Object.assign({},{willUploadConsoleLog:Y("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:k0?"global":"oversea",areas:Y("AREAS")&&Y("AREAS").join(",")},t.extend),{stringUid:d,channelProfile:h,channelMode:p,isABTestSuccess:m,lsid:_,clientRole:E}=t,x=Date.now(),b=mt(mt({},i),{},{eventType:Qr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:L0,lts:x,elapse:x-r,extend:JSON.stringify(c),mode:t.mode,process:Y("PROCESS_ID"),appType:Y("APP_TYPE"),success:!0,version:bi,stringUid:d,channelProfile:h,channelMode:p,isABTestSuccess:m,lsid:_,clientType:Ae(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:E,serviceId:Y("PROCESS_ID"),extensionID:Y("PLUGIN_INFO").join(",")||""});var C;this.send({type:_r.SESSION,data:b},!0)}joinChooseServer(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt({},i),{},{role:t.role,eventType:Qr.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:_r.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt({},i),{},{eventType:Qr.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-r.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:_r.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;let c=Date.now(),{firstSuccess:d,addr:h,isProxy:p}=t,m=c-r.startTime,_=mt(mt({},i),{},{eventType:Qr.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:m,eventElapse:c-t.lts,firstSuccess:d,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:P0(),isABTestSuccess:t.isABTestSuccess?1:0}),E=_.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=c),d)this.send({type:_r.JOIN_GATEWAY,data:_},!0);else{let x;if(h)if(p){let C=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=h.match(/p=[0-9]{1,6}/g);x={isSuccess:E,gatewayIp:C&&C.length?C[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:p?1:0}}else{let C=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=h.match(/(:|p=)[0-9]{1,6}/g);x={isSuccess:E,gatewayIp:C&&C.length?C[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:p?1:0}}else x={isSuccess:E,gatewayIp:"",port:"",isProxy:p?1:0};delete _.success,delete _.eventType,delete _.firstSuccess,_.vid=Number(_.vid);let b=Object.assign({},_,x,{eventType:Qr.REJOIN_GATEWAY});this.send({type:_r.RE_JOIN_GATEWAY,data:b},!0)}}joinChannelTimeout(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=Date.now(),c=mt(mt({},r.info),{},{lts:i,timeout:t,elapse:i-r.startTime});this.send({type:_r.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt({},i),{},{eventType:Qr.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:_r.PUBLISH,data:d},!0)}subscribe(e,t,r){let i=this.baseInfoMap.get(e);if(!i)return;let c=i.info,d=Date.now(),h=mt(mt({},c),{},{eventType:Qr.SUBSCRIBE,lts:d,eventElapse:t.eventElapse,elapse:d-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?h.peerSuid=t.peerid:h.peer=t.peerid,this.send({type:_r.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var t;let r=[...xn(t=this.baseInfoMap).call(t)],i=r.length?r[0]:"UnableToGetSid",c=this.baseInfoMap.get(i);if(!c)return;let d=c.info,h=Date.now(),p=mt(mt({},d),{},{eventType:Qr.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:_r.WS_COMPRESSOR_INIT,data:p},!0)}firstXLAPeerFirstVideoFrame(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=t.peerPubStatusMs-(r.lastJoinSuccessTime||c),h=mt(mt({},i),{},{elapse:c-r.startTime,eventType:Qr.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>d?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:_r.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(e,t,r,i){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=mt(mt(mt({},d),i),{},{elapse:h-c.startTime,eventType:t,lts:h,firstDecodeFrame:Math.max((i.firstFrame||h)-c.startTime,0),apEnd:Math.max(i.apEnd-c.startTime,0),apStart:Math.max(i.apStart-c.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-c.startTime,0),joinGwStart:Math.max(i.joinGwStart-c.startTime,0),pcEnd:Math.max(i.pcEnd-c.startTime,0),pcStart:Math.max(i.pcStart-c.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-c.startTime,0),subscriberStart:Math.max(i.subscriberStart-c.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-c.startTime,0)});this.send({type:r,data:p},!0)}firstRemoteFrame(e,t,r,i){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=mt(mt(mt({},d),i),{},{elapse:h-c.startTime,eventType:t,lts:h});this.send({type:r,data:p},!0)}abTest(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt(mt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:c-r.startTime,eventType:Qr.AB_TEST,lts:c});this.send({type:_r.AB_TEST,data:d},!0)}pcStats(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt(mt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:c-r.startTime,eventType:Qr.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:_r.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(e,t){if(e){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt(mt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Qr.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:_r.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(e,t,r,i){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=mt(mt(mt({},d),i),{},{eventType:t,lts:h});this.send({type:r,data:p},!0)}streamSwitch(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt({},i),{},{eventType:Qr.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-r.startTime,success:t.succ});this.send({type:_r.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt({},i),{},{eventType:Qr.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:_r.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt({},i),{},{eventType:Qr.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:_r.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(e){this.proxyServer=e,e?N.debug("reportProxyServerurl: ".concat(e)):N.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-r.startTime,joinChannelSuccessElapse:c-(r.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:_r.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now();(function(d,h,p){let m=d[h];if(!m||typeof m!="string")return[d];d[h]="";let _=Eo(JSON.stringify(d)),E=0,x=[],b=0;for(let C=0;C<m.length;C++)b+=m.charCodeAt(C)<=127?1:3,b<=p-_||(x[x.length]=Ce(Ce({},d),{},{[h]:m.substring(E,C)}),E=C,b=m.charCodeAt(C)<=127?1:3);return E!==m.length-1&&(x[x.length]=Ce(Ce({},d),{},{[h]:m.substring(E)})),x})(mt(mt(mt({},i),t),{},{elapse:c-r.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:_r.WORKER_EVENT,data:d},!0))}apworkerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt(mt({},i),t),{},{elapse:c-r.startTime,lts:c});this.send({type:_r.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt(mt({},i),t),{},{elapse:c-r.startTime,lts:c,extend:t.extend||void 0});this.send({type:_r.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),d=mt(mt(mt({},i),t),{},{elapse:c-r.startTime,lts:c});this.send({type:_r.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>Y("CUSTOM_REPORT_LIMIT"))throw new he(z.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let r=Date.now(),i=t.map(c=>({type:_r.USER_ANALYTICS,data:mt(mt({sid:e},c),{},{lts:r})}));try{Y("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(c){throw N.error("send custom report message failed",c.toString()),new he(z.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){let t=Y("NOT_REPORT_EVENT");if(e.tag&&Ae(t)&&Ae(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:i,uid:c,cid:d}=r.info,h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof he){let{code:m,message:_}=e.error;h=m||_||e.error.toString()}else h=e.error.toString();let p={invokeId:e.invokeId,sid:e.sid,cname:i,cid:d,uid:c,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:_r.API_INVOKE,data:p},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(r=>r!==null);t&&e.forEach(r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Y("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let r=[],i=[];for(;e.length;){let d=e.shift();r.length<20?r.push(d):i.push(d)}e.push(...i);for(let d of[...r]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),Ql(c=this.ltsList).call(c,(h,p)=>h-p))}return t||(this.lastSendNormalEventTime=Date.now()),Y("ENABLE_EVENT_REPORT")&&r.length&&(Y("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((d=>h=>{Y("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>Y("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Y("NORMAL_EVENT_QUEUE_CAPACITY")),N.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){Mr.networkState===Un.OFFLINE&&await je.race([Mr.onlineWaiter,hs(2*Gr.maxRetryTimeout)]);let t=c=>{let d=new Uint8Array;return c.forEach(h=>{let p=x0(JSON.stringify(h.data)),m=new ArrayBuffer(5),_=(x=>{let b=0;return Object.entries(_r).forEach(C=>{let[U,k]=C;k===x.type&&(b=pie[U])}),b})(h),E=new DataView(m);E.setUint16(0,p.byteLength,!0),E.setUint8(2,255&_),E.setUint8(3,_>>>8&255),E.setUint8(4,_>>>16&255),d=c2(d,new Uint8Array(m)),d=c2(d,p)}),d},r="event",i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Y("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(Y("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let c=0;c<2;c+=1){c===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Y("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(Y("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await N0(i,{timeout:1e4,data:t(e),headers:mt(mt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=(p=>{let m=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return m&&m.info.vid&&+m.info.vid||0})(e[0]),i=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(p=>JSON.stringify(p)),vid:r,aid:i};Mr.networkState===Un.OFFLINE&&await je.race([Mr.onlineWaiter,hs(2*Gr.maxRetryTimeout)]);let d=t?"/events/proto-raws":"/events/messages",h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Y("EVENT_REPORT_DOMAIN"),"&p=").concat(Y("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(Y("EVENT_REPORT_DOMAIN"),":").concat(Y("STATS_COLLECTOR_PORT")).concat(d));for(let p=0;p<2;p+=1){p===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Y("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Y("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(Y("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Y("STATS_COLLECTOR_PORT")).concat(d)));try{t?await Qne(h,{timeout:1e4,data:c}):await N0(h,{timeout:1e4,data:c})}catch(m){if(p===1)throw m;continue}return}}createBaseInfo(e,t){let r=Object.assign({},hie);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){let r=performance.getEntriesByName(e),i=r[r.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:Er.TRACER}).onSuccess()}};L2.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Mr.networkState,ze.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Er.TRACER}).onSuccess("logUploadError")});class le extends he{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Tr(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,N)}throw(){super.throw(N)}}let ps={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Dt(){return ps}function U2(){return"setSinkId"in HTMLAudioElement.prototype&&(!Y("RESTRICTION_SET_PLAYBACK_DEVICE")||(Zo()||XL())&&!E0())}function BE(){return!ps.supportUnifiedPlan||Y("CHROME_FORCE_PLAN_B")&&ec()}function V0(e){return!(Sr()||JL(87)||BE()||!Y("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||Y("FORCE_DISABLE_AUTO_SUB")))}function V2(e){return!!Y("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||Y("FORCE_DISABLE_AUTO_SUB"))}let fs=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function nh(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function Pt(e,t,r,i,c){return{width:e,height:t,frameRate:r,bitrateMin:i,bitrateMax:c}}function ea(e,t,r,i,c){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:i,bitrateMax:c}}function B0(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let fie={"90p":Pt(160,90),"90p_1":Pt(160,90),"120p":Pt(160,120,15,30,65),"120p_1":Pt(160,120,15,30,65),"120p_3":Pt(120,120,15,30,50),"120p_4":Pt(212,120),"180p":Pt(320,180,15,30,140),"180p_1":Pt(320,180,15,30,140),"180p_3":Pt(180,180,15,30,100),"180p_4":Pt(240,180,15,30,120),"240p":Pt(320,240,15,40,200),"240p_1":Pt(320,240,15,40,200),"240p_3":Pt(240,240,15,40,140),"240p_4":Pt(424,240,15,40,220),"360p":Pt(640,360,15,80,400),"360p_1":Pt(640,360,15,80,400),"360p_3":Pt(360,360,15,80,260),"360p_4":Pt(640,360,30,80,600),"360p_6":Pt(360,360,30,80,400),"360p_7":Pt(480,360,15,80,320),"360p_8":Pt(480,360,30,80,490),"360p_9":Pt(640,360,15,80,800),"360p_10":Pt(640,360,24,80,800),"360p_11":Pt(640,360,24,80,1e3),"480p":Pt(640,480,15,100,500),"480p_1":Pt(640,480,15,100,500),"480p_2":Pt(640,480,30,100,1e3),"480p_3":Pt(480,480,15,100,400),"480p_4":Pt(640,480,30,100,750),"480p_6":Pt(480,480,30,100,600),"480p_8":Pt(848,480,15,100,610),"480p_9":Pt(848,480,30,100,930),"480p_10":Pt(640,480,10,100,400),"720p":Pt(1280,720,15,120,1130),"720p_auto":Pt(1280,720,30,900,3e3),"720p_1":Pt(1280,720,15,120,1130),"720p_2":Pt(1280,720,30,120,2e3),"720p_3":Pt(1280,720,30,120,1710),"720p_5":Pt(960,720,15,120,910),"720p_6":Pt(960,720,30,120,1380),"1080p":Pt(1920,1080,15,120,2080),"1080p_1":Pt(1920,1080,15,120,2080),"1080p_2":Pt(1920,1080,30,120,3e3),"1080p_3":Pt(1920,1080,30,120,3150),"1080p_5":Pt(1920,1080,60,120,4780),"1440p":Pt(2560,1440,30,120,4850),"1440p_1":Pt(2560,1440,30,120,4850),"1440p_2":Pt(2560,1440,60,120,7350),"4k":Pt(3840,2160,30,120,8910),"4k_1":Pt(3840,2160,30,120,8910),"4k_3":Pt(3840,2160,60,120,13500)},mie={"480p":ea(640,480,5),"480p_1":ea(640,480,5),"480p_2":ea(640,480,30),"480p_3":ea(640,480,15),"720p":ea(1280,720,5),"720p_auto":Pt(1280,720,30,900,3e3),"720p_1":ea(1280,720,5),"720p_2":ea(1280,720,30),"720p_3":ea(1280,720,15),"1080p":ea(1920,1080,5),"1080p_1":ea(1920,1080,5),"1080p_2":ea(1920,1080,30),"1080p_3":ea(1920,1080,15)},gie={"1SL1TL":B0(1,1),"3SL3TL":B0(3,3),"2SL3TL":B0(2,3)};function ta(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},fie[e]):e}function W0(e){return typeof e=="string"?Object.assign({},mie[e]):e}function WE(e){return typeof e=="string"?Object.assign({},gie[e]):e}let _ie={speech_low_quality:nh(16e3,!1),speech_standard:nh(32e3,!1,18),music_standard:nh(48e3,!1),standard_stereo:nh(48e3,!0,56),high_quality:nh(48e3,!1,128),high_quality_stereo:nh(48e3,!0,192)};function GE(e){return typeof e=="string"?Object.assign({},_ie[e]):e}let ih=[];function B2(e){return Jr(e,"mediaSource",["screen","window","application"]),!0}let Be=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Zt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),ah=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Eie=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),vie=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),dd=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),oh=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Si=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),ch=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),ni=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let G0={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},H0={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},W2={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},yie={uplinkNetworkQuality:0,downlinkNetworkQuality:0},G2={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},en=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),ii=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Gf=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),ud=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Os=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),yo=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),z0={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},HE=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Tt(e,t,r,i,c){var d,h,p={};return Object.keys(i).forEach(function(m){p[m]=i[m]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=zi(d=NO(h=r.slice()).call(h)).call(d,function(m,_){return _(e,t,m)||m},p),c&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(c):void 0,p.initializer=void 0),p.initializer===void 0?(Object.defineProperty(e,t,p),null):p}function oe(e,t,r){return(t=function(i){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var m=p.call(d,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(i);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function nr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H2(Object(r),!0).forEach(function(i){oe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H2(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class z2 extends br{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(dd.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),oe(this,"trackMediaType",void 0),oe(this,"_ID",void 0),oe(this,"_rtpTransceiver",void 0),oe(this,"_lowRtpTransceiver",void 0),oe(this,"_hints",[]),oe(this,"_isClosed",!1),oe(this,"_originMediaStreamTrack",void 0),oe(this,"mediaStreamTrack",void 0),oe(this,"_external",{}),this._ID=r||tr(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){Ae(ih).call(ih,i)||ih.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Fc(()=>{var r;ze.reportApiInvoke(null,{name:Or.GET_MEDIA_STREAM_TRACK,options:[],tag:Er.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===ah.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){let r=ih.indexOf(t);r!==-1&&ih.splice(r,1)}(this),this.emit(oh.CLOSED),this.removeAllListeners(dd.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===ah.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(dd.TRANSCEIVER_UPDATED,t,r)}}class lh extends z2{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),oe(this,"_enabled",!0),oe(this,"_muted",!1),oe(this,"_isExternalTrack",!1),oe(this,"_isClosed",!1),oe(this,"_enabledMutex",void 0),oe(this,"processor",void 0),oe(this,"_processorContext",void 0),oe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Is("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,N.debug("[".concat(this.getTrackId(),"] close")),this.emit(Be.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,Be.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}stateCheck(t,r){if(N.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),ja(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new he(z.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",N);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new he(z.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",N)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():je.resolve([])}}let K2=window.AudioContext||window.webkitAudioContext,ai=null,Xt=new class extends br{constructor(){super(...arguments),oe(this,"prevState",void 0),oe(this,"curState",void 0),oe(this,"currentTime",void 0),oe(this,"currentTimeStuckAt",void 0),oe(this,"interruptDetectorTrack",void 0),oe(this,"onLocalAudioTrackMute",()=>{N.info("ios15-interruption-start"),this.emit(fs.IOS_15_16_INTERRUPTION_START)}),oe(this,"onLocalAudioTrackUnmute",async()=>{N.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?N.info("ios15-interruption-end-canceled"):(ai&&await ai.suspend(),this.emit(fs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){N.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){N.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function dh(){if(!ai){if(function(){if(!K2)return void N.error("your browser is not support web audio");N.info("create audio context");let e=nr({},Y("WEBAUDIO_INIT_OPTIONS"));N.debug("audio context init option:",JSON.stringify(e)),ai=new K2(e),Xt.curState=ai.state,ai.onstatechange=()=>{Xt.prevState=Xt.curState,Xt.curState=ai?ai.state:void 0;let{prevState:t,curState:r}=Xt,i=r==="running",c=r==="interrupted",d=t==="running",h=t==="suspended",p=t==="interrupted",m=Rt().osVersion;(Bs()||Qi())&&d&&c&&(N.info("ios".concat(m,"-interruption-start")),Xt.emit(fs.IOS_INTERRUPTION_START)),(Bs()||Qi())&&(h||p)&&i&&(N.info("ios".concat(m,"-interruption-end")),Xt.emit(fs.IOS_INTERRUPTION_END)),t!==r&&Xt.emit(fs.STATE_CHANGE,r,t)},setInterval(()=>{var t;let r=(t=ai)===null||t===void 0?void 0:t.currentTime;Xt.currentTime!==r?(Xt.currentTimeStuckAt&&(N.debug("AudioContext current time resume at ".concat(r)),Xt.currentTimeStuckAt=void 0),Xt.currentTime=r):(r!==Xt.currentTimeStuckAt&&(ze.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Er.TRACER}).onSuccess(),N.warning("AudioContext current time stuck at ".concat(r))),Xt.currentTimeStuckAt=r)},5e3),async function(t){let r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],i,c=!1,d=!1,h=!1;function p(k){t.state==="running"?m(!1):Bs()||Qi()?t.state==="suspended"&&(m(!0),k&&t.resume().then(_,_)):t.state!=="closed"&&(m(!0),k&&t.resume().then(_,_))}function m(k){if(c!==k){c=k;for(let M=0,H=r;M<H.length;M+=1){let K=H[M];k?window.addEventListener(K,E,{capture:!0,passive:!0}):window.removeEventListener(K,E,{capture:!0,passive:!0})}}}function _(){p(!1)}function E(){p(!0)}function x(k){if(!h)if(i.paused)if(k){let M;b(!1),h=!0;try{M=i.play(),M?M.then(C,C):(i.addEventListener("playing",C),i.addEventListener("abort",C),i.addEventListener("error",C))}catch{C()}}else b(!0);else b(!1)}function b(k){if(d!==k){d=k;for(let M=0,H=r;M<H.length;M++){let K=H[M];k?window.addEventListener(K,U,{capture:!0,passive:!0}):window.removeEventListener(K,U,{capture:!0,passive:!0})}}}function C(){i.removeEventListener("playing",C),i.removeEventListener("abort",C),i.removeEventListener("error",C),h=!1,x(!1)}function U(){x(!0)}if(Bs()){let k=t.createMediaStreamDestination(),M=document.createElement("div");M.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=M.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=k.stream,x(!0)}Xt.on(fs.STATE_CHANGE,function(){p(!0)}),p(!1)}(ai)}(),!ai)throw new he(z.NOT_SUPPORTED,"can not create audio context");return ai}return ai}function hd(e){if(function(){if(K0!==null)return K0;let i=dh(),c=i.createBufferSource(),d=i.createGain(),h=i.createGain();c.connect(d),c.connect(h),c.disconnect(d);let p=!1;try{c.disconnect(d)}catch{p=!0}return c.disconnect(),K0=p,p}())return;let t=e.connect,r=e.disconnect;e.connect=(i,c,d)=>{var h;return e._inputNodes||(e._inputNodes=[]),Ae(h=e._inputNodes).call(h,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,c,d)):t.call(e,i,c)),e},e.disconnect=(i,c,d)=>{r.call(e),i?PE(e._inputNodes,i):e._inputNodes=[];for(let h of e._inputNodes)t.call(e,h)}}let K0=null;function q0(e,t){let r=!1,i=1/t;if(Y("DISABLE_WEBAUDIO")){let c=window.setInterval(()=>{r?window.clearInterval(c):e(performance.now()/1e3)},1e3*i)}else{let c=dh(),d=c.createGain();d.gain.value=0,d.connect(c.destination);let h=()=>{if(r)return void(d=null);let p=c.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(c.currentTime+i),e(c.currentTime)};h()}return()=>{r=!0}}class q2{constructor(){oe(this,"context",void 0),oe(this,"analyserNode",void 0),oe(this,"sourceNode",void 0),this.context=dh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Bs()||Qi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let c=0;c<t.length;++c)t[c]=i[c]/128-1}let r=zi(t).call(t,(i,c)=>i+c*c,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{N.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Y2 extends br{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),oe(this,"outputNode",void 0),oe(this,"outputTrack",void 0),oe(this,"isPlayed",!1),oe(this,"sourceNode",void 0),oe(this,"context",void 0),oe(this,"audioBufferNode",void 0),oe(this,"destNode",void 0),oe(this,"audioOutputLevel",0),oe(this,"volumeLevelAnalyser",void 0),oe(this,"_processedNode",void 0),oe(this,"playNode",void 0),oe(this,"isDestroyed",!1),oe(this,"onNoAudioInput",void 0),oe(this,"isNoAudioInput",!1),oe(this,"_noAudioInputCount",0),this.context=dh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),hd(this.outputNode),this.volumeLevelAnalyser=new q2}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(ni.ON_AUDIO_BUFFER,function(i){for(let c=0;c<i.outputBuffer.numberOfChannels;c+=1){let d=i.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return i.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Dt().webAudioMediaStreamDest)throw new he(z.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&kE(()=>{Xt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Bs()||Qi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let r=this.volumeLevelAnalyser.getAnalyserNode(),i;r.getFloatTimeDomainData?(i=new Float32Array(r.fftSize),r.getFloatTimeDomainData(i)):(i=new Uint8Array(r.fftSize),r.getByteTimeDomainData(i));let c=!1;for(let d=0;d<i.length;d++)i[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await hs(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class $2 extends Y2{get isFreeze(){return!1}constructor(t,r,i){var c;if(super(),oe(this,"sourceNode",void 0),oe(this,"track",void 0),oe(this,"clonedTrack",void 0),oe(this,"audioElement",void 0),oe(this,"isCurrentTrackCloned",!1),oe(this,"isRemoteTrack",!1),oe(this,"originVolumeLevelAnalyser",void 0),oe(this,"rebuildWebAudio",async()=>{if(N.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void N.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>N.info("resume success")),N.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let p=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?p.stop():this.isCurrentTrackCloned=!0;let m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),hd(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let _=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(_,this.context.currentTime),hd(this.outputNode),this.emit(ni.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new he(z.UNEXPECTED_ERROR);this.track=t;let d=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(d),hd(this.sourceNode),i){let p=i.clone();p.enabled=!0,this.clonedTrack=p,N.debug("create an unmuted track ".concat(p.id," from the original track ").concat(i.id," to get the volume"));let m=this.context.createMediaStreamSource(new MediaStream([p]));hd(m),this.originVolumeLevelAnalyser=new q2,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;let h=Rt();r&&h.os===ts.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Xt.on(fs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(p=>{p||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),hd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ni.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Xt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),N.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));let i=this.context.createMediaStreamSource(new MediaStream([r]));hd(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function X2(e,t,r){let i=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function xie(e,t){let r=await J2(e.mediaSource),{sourceId:i,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new je((p,m)=>{let _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let x=document.createElement("div");x.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",x.setAttribute("style","height: 12%;");let b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let U=document.createElement("button");U.innerHTML="cancel",U.setAttribute("style","width: 85px;"),U.onclick=()=>{document.body.removeChild(H);let K=new Error("NotAllowedError");K.name="NotAllowedError",m(K)};let k=h,M=document.createElement("div");if(h){let K=document.createElement("input");K.setAttribute("type","checkbox");let X=document.createElement("span");K.setAttribute("style","margin-right: 6px;"),X.innerText="Share audio",K.checked=k,K.onchange=()=>{k=K.checked},M.appendChild(K),M.appendChild(X)}C.appendChild(M),C.appendChild(U),E.appendChild(x),E.appendChild(b),E.appendChild(C);let H=document.createElement("div");H.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),H.appendChild(_),H.appendChild(E),document.body.appendChild(H),d.map(K=>{if(K.id){let X=document.createElement("div");X.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let se=K.thumbnail;try{let{width:te}=se.getSize();te>1920&&(se=se.resize({width:1920}))}catch(te){throw te&&te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),te}X.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+se.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+K.name.replace(/[\u00A0-\u9999<>\&]/g,function(te){return"&#"+te.charCodeAt(0)+";"})+"</span>",X.onclick=()=>{document.body.removeChild(H),p({sourceId:K.id,audio:k})},b.appendChild(X)}})})}(r,t);return await X2(i,e,c)}async function J2(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let r=l2();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new he(z.ELECTRON_IS_NULL);let i=null;try{var c;i=((c=r.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new je((d,h)=>{r.desktopCapturer.getSources({types:t},(p,m)=>{p?h(p):d(m)})}));try{return await i}catch(d){throw new he(z.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}let Y0=new Is("safari"),Q2=!1,Z2=!1;async function oi(e,t){let r=0,i=null;for(;r<2;)try{i=await bie(e,t,r>0);break}catch(c){if(c instanceof he)throw N.error("[".concat(t,"] ").concat(c.toString())),c;let d=zE(c.name||c.code||c,c.message);if(d.code===z.MEDIA_OPTION_INVALID){N.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await hs(500);continue}throw N.error("[".concat(t,"] ").concat(d.toString())),d}if(!i)throw new he(z.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function bie(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new he(z.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let i=Dt(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return N.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(l2())e.screen.sourceId?uh(c,await X2(e.screen.sourceId,e.screen,!!e.screenAudio)):uh(c,await xie(e.screen,!!e.screenAudio));else if(Zo()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new he(z.NOT_SUPPORTED,"This browser does not support screen sharing");N.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let b=await(h=e.screen.extensionId,p=t,new je((C,U)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},k=>{if(!k||!k.streamId)return N.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),k),void U(new he(z.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(k.streamId)})}catch(k){N.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),k.toString()),U(new he(z.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=b,uh(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var d;e.screen.mediaSource&&B2(e.screen.mediaSource);let b={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(d=e.screen.displaySurface)!==null&&d!==void 0?d:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:U,systemAudio:k,preferCurrentTab:M}=e.screen,H={selfBrowserSurface:C,surfaceSwitching:U,systemAudio:k,preferCurrentTab:M};!C&&delete H.selfBrowserSurface,!U&&delete H.surfaceSwitching,!k&&delete H.systemAudio,!M&&delete H.preferCurrentTab,N.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:b,audio:e.screenAudio,controls:H})),uh(c,await navigator.mediaDevices.getDisplayMedia(nr({video:b,audio:e.screenAudio},H)))}else{if(!Sr())throw N.error("[".concat(t,"] This browser does not support screenSharing")),new he(z.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&B2(e.screen.mediaSource);let b={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};N.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(b))),uh(c,await navigator.mediaDevices.getUserMedia(b))}}var h,p;if(!e.video&&!e.audio)return c;let m={video:e.video,audio:e.audio},_=Y("MEDIA_DEVICE_CONSTRAINTS");if(_)try{typeof _=="string"&&(_=JSON.parse(_)),m=S0(m,_)}catch{}N.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),Rt();let E,x=null;(bs()||Bs()||OE())&&(x=await Y0.lock());try{E=await navigator.mediaDevices.getUserMedia(m)}catch(b){throw x&&x(),b}return m.audio&&(Q2=!0),m.video&&(Z2=!0),uh(c,E),x&&x(),c}function zE(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new he(z.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new he(z.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new he(z.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new he(z.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new he(z.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new he(z.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return N.error("getUserMedia unexpected error",e),new he(z.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function uh(e,t){let r=e.getVideoTracks()[0],i=e.getAudioTracks()[0],c=t.getVideoTracks()[0],d=t.getAudioTracks()[0];d&&(i&&e.removeTrack(i),e.addTrack(d)),c&&(r&&e.removeTrack(r),e.addTrack(c))}let ci=new class extends br{get state(){return this._state}set state(e){e!==this._state&&(this.emit(ud.STATE_CHANGE,e),this._state=e)}constructor(){super(),oe(this,"_state",Gf.IDLE),oe(this,"isAccessMicrophonePermission",!1),oe(this,"isAccessCameraPermission",!1),oe(this,"lastAccessMicrophonePermission",!1),oe(this,"lastAccessCameraPermission",!1),oe(this,"checkdeviceMatched",!1),oe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Y("ENUMERATE_DEVICES_INTERVAL")||(DE()||IE()===ts.HARMONY_OS)&&ec())&&this.updateDevicesInfo()},Y("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>N.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new he(z.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let i=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(i),d=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;c.audio&&(d=!1),c.video&&(h=!1);let p=null,m=null,_=null;if(!r&&(d||h)){if(Y0.isLocked&&(N.debug("[device manager] wait GUM lock"),(await Y0.lock())(),N.debug("[device manager] GUM unlock")),Q2&&(d=!1,this.isAccessMicrophonePermission=!0),Z2&&(h=!1,this.isAccessCameraPermission=!0),N.debug("[device manager] check media device permissions",e,t,d,h),d&&h){try{_=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(E){let x=zE(E.name||E.code||E,E.message);if(x.code===z.PERMISSION_DENIED)throw x;N.warning("getUserMedia failed in getDevices",x)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({audio:e})}catch(E){let x=zE(E.name||E.code||E,E.message);if(x.code===z.PERMISSION_DENIED)throw x;N.warning("getUserMedia failed in getDevices",x)}this.isAccessMicrophonePermission=!0}else if(h){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(E){let x=zE(E.name||E.code||E,E.message);if(x.code===z.PERMISSION_DENIED)throw x;N.warning("getUserMedia failed in getDevices",x)}this.isAccessCameraPermission=!0}N.debug("[device manager] mic permission",e,"cam permission",t)}try{let E=await navigator.mediaDevices.enumerateDevices();return p&&p.getTracks().forEach(x=>x.stop()),m&&m.getTracks().forEach(x=>x.stop()),_&&_.getTracks().forEach(x=>x.stop()),p=null,m=null,_=null,E}catch(E){return p&&p.getTracks().forEach(x=>x.stop()),m&&m.getTracks().forEach(x=>x.stop()),_&&_.getTracks().forEach(x=>x.stop()),p=null,m=null,_=null,new he(z.ENUMERATE_DEVICES_FAILED,E.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new he(z.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Gf.INITING;try{await this.updateDevicesInfo(),this.state=Gf.INITEND}catch(e){throw N.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Gf.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new he(z.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?N.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):N.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):N.debug("[device-check] default input or output not found")}let i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;let d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){let h={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),r.push(h)}d&&(d.updateAt=t)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",r.push(c))}),this.state!==Gf.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ud.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ud.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ud.PLAYOUT_DEVICE_CHANGED,c)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(c=>c.kind==="audioinput"),r=e.filter(c=>c.kind==="videoinput"),i={audio:!1,video:!1};for(let c of t)if(c.label&&c.deviceId){i.audio=!0;break}for(let c of r)if(c.label&&c.deviceId){i.video=!0;break}return i}},$0=!1,li=new class extends br{constructor(){super(...arguments),oe(this,"onAutoplayFailed",void 0),oe(this,"onAudioAutoplayFailed",void 0)}};function eM(){if(Rt(),!$0){let e=t=>{t.preventDefault(),$0=!1,Pf()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};$0=!0,Pf()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),N.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),li.onAutoplayFailed?li.onAutoplayFailed():li.onAudioAutoplayFailed?N.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):N.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),li.emit("autoplay-failed")}}function tM(e,t,r,i){if(!e)return;let c=ze.getBaseInfoBySessionId(e);if(!c)return;let d=c.info,h=Date.now(),p=nr(nr({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:li.onAutoplayFailed||li.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:i,extend:void 0});ze.send({type:_r.AUTOPLAY_FAILED,data:p},!0)}let wie=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],un=new class{constructor(){oe(this,"onAutoplayFailed",void 0),oe(this,"elementMap",new Map),oe(this,"elementStateMap",new Map),oe(this,"elementsNeedToResume",[]),oe(this,"sinkIdMap",new Map),oe(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t,c=this.elementStateMap.get(r),d=i.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(N.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return i.pause(),void i.play();if(Xt.curState==="running")return Ju()?(i.pause(),void i.play()):void(c&&c==="paused"&&i.play())}})}),oe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e,i=r.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(N.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Xt.on(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xt.on(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Xt.on(fs.STATE_CHANGE,()=>{Bs()&&Xt.prevState==="suspended"&&Xt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(i){throw new he(z.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,r,i){if(this.elementMap.has(t))return;let c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,Os.INIT),this.setVolume(t,r);let d=this.sinkIdMap.get(t);if(d)try{c.setSinkId(d).catch(p=>{N.warning("[".concat(t,"] set sink id failed"),p.toString())})}catch(p){N.warning("[".concat(t,"] set sink id failed"),p.toString())}let h=c.play();h&&h.then&&h.catch(p=>{i&&tM(i,"audio",p.message,t),N.warning("audio element play warning",p.toString()),this.elementMap.has(t)&&p.name==="NotAllowedError"&&(N.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),kE(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),eM()}))})}updateTrack(e,t){let r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){wie.forEach(r=>{t.addEventListener(r,i=>{let c=this.elementStateMap.get(e),d=i.type==="pause"?"paused":i.type;if(N.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(d)),i.type==="error"){let h=t==null?void 0:t.error;h&&N.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,d)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{N.debug("Auto resume audio element success")}).catch(r=>{N.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new je(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Pf()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Nr(){return function(e,t,r){let i=r.value;return typeof i=="function"&&(r.value=function(){this._isClosed&&new he(z.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",N);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];let p=i.apply(this,d);return p instanceof je?new je((m,_)=>{p.then(m).catch(_)}):p}),r}}class rM extends br{constructor(t){super(),oe(this,"name","VideoProcessorDestination"),oe(this,"ID","0"),oe(this,"_source",void 0),oe(this,"videoContext",void 0),oe(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new he(z.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new he(z.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(en.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(en.ON_TRACK,void 0)}}class sM extends br{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),oe(this,"constraintsMap",new Map),oe(this,"statsRegistry",[]),oe(this,"usageRegistry",[]),oe(this,"trackId",void 0),oe(this,"direction",void 0),oe(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await Ss(this,ii.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var i;return N.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),er(this,ii.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ln(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return N.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),er(this,ii.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ln(r=this.constraintsMap).call(r)))}registerStats(t,r,i){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:i})}unregisterStats(t,r){let i=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let t=[];for(let{processorID:r,processorName:i,type:c,cb:d}of this.statsRegistry)try{let h=d();t.push({processorID:r,processorName:i,type:c,stats:h})}catch(h){N.error(new he(z.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){let r=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let i=r();i instanceof je&&(i=await i),t.push(nr(nr({},i),{},{direction:this.direction}))}catch(i){N.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class nM extends br{constructor(t){super(),oe(this,"name","AudioProcessorDestination"),oe(this,"ID","0"),oe(this,"inputTrack",void 0),oe(this,"inputNode",void 0),oe(this,"audioProcessorContext",void 0),oe(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new he(z.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new he(z.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(en.ON_TRACK,void 0),this.emit(en.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(en.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(en.ON_NODE,this.inputNode))}}class iM extends br{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,i){super(),oe(this,"constraintsMap",new Map),oe(this,"statsRegistry",[]),oe(this,"audioContext",void 0),oe(this,"trackId",void 0),oe(this,"direction",void 0),oe(this,"usageRegistry",[]),oe(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=i}async getConstraints(){return Ss(this,ii.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var i;return N.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),er(this,ii.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ln(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),er(this,ii.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ln(r=this.constraintsMap).call(r)))}registerStats(t,r,i){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:i})}unregisterStats(t,r){let i=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let t=[];for(let{processorID:r,processorName:i,type:c,cb:d}of this.statsRegistry)try{let h=d();t.push({processorID:r,processorName:i,type:c,stats:h})}catch(h){N.error(new he(z.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){let r=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let i=r();i instanceof je&&(i=await i),t.push(nr(nr({},i),{},{direction:this.direction}))}catch(i){N.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class X0 extends br{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),oe(this,"context",void 0),oe(this,"processSourceNode",void 0),oe(this,"outputTrack",void 0),oe(this,"processedNode",void 0),oe(this,"clonedTrack",void 0),oe(this,"outputNode",void 0),this.outputNode=new Sie}setVolume(){}createOutputTrack(){throw new he(z.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Sie{disconnect(){}connect(){}}function aM(e){return new je((t,r)=>{let i=!1,c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);let d=Bs()?"canplay":"playing";c.addEventListener(d,()=>{let h=c.videoWidth,p=c.videoHeight;!h&&Sr()||(i=!0,c.srcObject=null,c.remove(),t([h,p]))}),c.srcObject=new MediaStream([e]),c.play().catch(jE),setTimeout(()=>{i||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function KE(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let r=ta(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!n2()&&r.frameRate&&(t.frameRate=r.frameRate),XL()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Sr()&&(t.frameRate={ideal:30,max:30}),t}function oM(e){let t={};return n2()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Zo()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function cM(e){let t=oM(e);if(e.encoderConfig){let r=GE(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),DE()&&(t.sampleRate=void 0),t}let Cie=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:r,width:i,height:c}=e.getMediaStreamTrackSettings(),{frameRate:d=r,width:h=i,height:p=c}=t;if(!d||!h||!p)return;h=eh(h),p=eh(p),d=eh(d);let{max:m,min:_}=function(C,U,k){let M=200*Math.pow(k/15,.6)*Math.pow(C*U/640/360,.75);return{min:Math.floor(M),max:Math.floor(4*M)}}(h,p,d),{bitrateMax:E,bitrateMin:x}=t||{};E||N.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(p,", fps: ").concat(d,"] => [brMax: ").concat(E,", brMin: ").concat(x,"]"));let{maxFramerate:b}=Y("ENCODER_CONFIG_LIMIT");return b&&typeof b=="number"&&(d=Math.min(d,b)),{frameRate:d,bitrateMax:E||m,bitrateMin:x||_,scaleResolutionDownBy:1,scale:0}},lM=async(e,t,r)=>await(async(i,c,d)=>{let h=function(_){let E=[];for(let x=0;x<_.length;x+=2)E.push(parseInt(_.slice(x,x+2),16));return Uint8Array.from(E)}(y2(""+c+d)).slice(0,16),p=h.slice(0,12),m=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},m,i))})(e.buffer,t,r),J0=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new je((r,i)=>{t.toBlob(async c=>{if(t.remove(),c){let d=await dM(c);r({buffer:d,width:t.width,height:t.height})}else i(new he(z.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},dM=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var uM,hM,pM,fM,mM,gM,_M,EM,vM,yM,xM,bM,wM,SM,CM,TM,RM,NM,wr,AM,IM,OM,DM,PM,kM,xo,jM,LM,MM,FM,UM,VM,BM,WM,GM,HM,zM,KM,qM,Ts;let Ar=(uM=st({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),hM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),pM=Nr(),fM=th("LocalAudioTrack","_enabledMutex"),mM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),gM=Nr(),_M=th("LocalAudioTrack","_enabledMutex"),EM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),vM=Nr(),yM=Nr(),xM=Nr(),bM=st({argsMap:e=>[e.getTrackId()]}),wM=Nr(),SM=st({argsMap:e=>[e.getTrackId()]}),CM=Nr(),TM=st({argsMap:e=>[e.getTrackId()]}),RM=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),NM=st({argsMap:e=>[e.getTrackId()]}),Tt((wr=class extends lh{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?un.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,i){super(e,r),oe(this,"trackMediaType",ch.AUDIO),oe(this,"_encoderConfig",void 0),oe(this,"_trackSource",void 0),oe(this,"metadata",[]),oe(this,"_enabled",!0),oe(this,"_volume",100),oe(this,"_useAudioElement",!0),oe(this,"_bypassWebAudio",!1),oe(this,"processor",void 0),oe(this,"_processorContext",void 0),oe(this,"_processorDestination",void 0),oe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new X0,Y("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Y("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),bs()&&!ai?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Qt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&un.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void N.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,er(this,Be.NEED_REPLACE_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{N.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!U2())throw new he(z.NOT_SUPPORTED,"your browser does not support setting the audio output device");await un.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await er(this,Be.NEED_ENABLE_TRACK,this),N.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw r||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await er(this,Be.NEED_DISABLE_TRACK,this)}catch(i){throw r||(this._enabled=!0),N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await er(this,Be.NEED_MUTE_TRACK,this):await er(this,Be.NEED_UNMUTE_TRACK,this))}getStats(){return Fc(()=>{N.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ri(this,Be.GET_STATS)||nr({},G0)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ni.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ni.ON_AUDIO_BUFFER),this._source.on(ni.ON_AUDIO_BUFFER,r=>e(r))}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] start audio playback in element")),un.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?un.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&un.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,Be.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return je.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new he(z.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new he(z.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(en.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await er(this,Be.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,Be.NEED_REPLACE_TRACK,this))}),e.on(en.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(en.ON_TRACK),e.removeAllListeners(en.ON_NODE)}bindProcessorContextEvents(e){e.on(ii.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(ii.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof X0&&(this._trackSource=new $2(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new iM(this._source.context,this.getTrackId(),"local"),t=new nM(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ni.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(un.stop(this.getTrackId()),this._source.play()),er(this,Be.NEED_REPLACE_MIXING_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{N.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[uM],Object.getOwnPropertyDescriptor(wr.prototype,"setVolume"),wr.prototype),Tt(wr.prototype,"setPlaybackDevice",[hM,pM],Object.getOwnPropertyDescriptor(wr.prototype,"setPlaybackDevice"),wr.prototype),Tt(wr.prototype,"setEnabled",[fM,mM,gM],Object.getOwnPropertyDescriptor(wr.prototype,"setEnabled"),wr.prototype),Tt(wr.prototype,"setMuted",[_M,EM,vM],Object.getOwnPropertyDescriptor(wr.prototype,"setMuted"),wr.prototype),Tt(wr.prototype,"getStats",[yM],Object.getOwnPropertyDescriptor(wr.prototype,"getStats"),wr.prototype),Tt(wr.prototype,"setAudioFrameCallback",[xM],Object.getOwnPropertyDescriptor(wr.prototype,"setAudioFrameCallback"),wr.prototype),Tt(wr.prototype,"play",[bM,wM],Object.getOwnPropertyDescriptor(wr.prototype,"play"),wr.prototype),Tt(wr.prototype,"stop",[SM,CM],Object.getOwnPropertyDescriptor(wr.prototype,"stop"),wr.prototype),Tt(wr.prototype,"close",[TM],Object.getOwnPropertyDescriptor(wr.prototype,"close"),wr.prototype),Tt(wr.prototype,"pipe",[RM],Object.getOwnPropertyDescriptor(wr.prototype,"pipe"),wr.prototype),Tt(wr.prototype,"unpipe",[NM],Object.getOwnPropertyDescriptor(wr.prototype,"unpipe"),wr.prototype),wr),Hf=(AM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),IM=Nr(),OM=th("MicrophoneAudioTrack","_enabledMutex"),DM=st({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),PM=Nr(),kM=st({argsMap:e=>[e.getTrackId()]}),Tt((xo=class extends Ar{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,i){super(e,t.encoderConfig?GE(t.encoderConfig):{},i,Y("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),oe(this,"_config",void 0),oe(this,"_deviceName","default"),oe(this,"_constraints",void 0),oe(this,"_originalConstraints",void 0),oe(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Ju()||_0())&&Xt.bindInterruptDetectorTrack(this)}async setDevice(e){if(N.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await ci.getDeviceById(e),r={};r.audio=nr({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await oi(r,this.getTrackId())}catch(c){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),i=await oi({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await ci.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}N.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return N.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Y("AUTO_RESET_AUDIO_ROUTE")&&(Bs()||Qi())){let h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),r||(this._enabled=!1);try{await er(this,Be.NEED_DISABLE_TRACK,this)}catch(h){throw N.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}let c=nr({},this._constraints),d=ci.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{r||(this._enabled=!0);let h=await oi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await er(this,Be.NEED_ENABLE_TRACK,this)}catch(h){throw r||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}N.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ju()||_0())&&Xt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Bs()||Qi())&&this._enabled&&!this._isClosed&&Xt.duringInterruption){let e=async()=>{Xt.off(fs.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Xt.on(fs.IOS_INTERRUPTION_END,e)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=ci.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let i=await oi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(ii.REQUEST_UPDATE_CONSTRAINTS,async(t,r,i)=>{try{let c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){i(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(ii.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[AM,IM],Object.getOwnPropertyDescriptor(xo.prototype,"setDevice"),xo.prototype),Tt(xo.prototype,"setEnabled",[OM,DM,PM],Object.getOwnPropertyDescriptor(xo.prototype,"setEnabled"),xo.prototype),Tt(xo.prototype,"close",[kM],Object.getOwnPropertyDescriptor(xo.prototype,"close"),xo.prototype),xo),Tie=(jM=st({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),LM=Nr(),MM=st({argsMap:e=>[e.getTrackId()]}),FM=Nr(),UM=st({argsMap:e=>[e.getTrackId()]}),VM=Nr(),BM=st({argsMap:e=>[e.getTrackId()]}),WM=Nr(),GM=st({argsMap:e=>[e.getTrackId()]}),HM=Nr(),zM=st({argsMap:e=>[e.getTrackId()]}),KM=st({argsMap:e=>[e.getTrackId()]}),qM=Nr(),Tt((Ts=class extends Ar{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,i){super(t.createOutputTrack(),r,i),oe(this,"source",void 0),oe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ni.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(oh.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Qt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[jM,LM],Object.getOwnPropertyDescriptor(Ts.prototype,"startProcessAudioBuffer"),Ts.prototype),Tt(Ts.prototype,"pauseProcessAudioBuffer",[MM,FM],Object.getOwnPropertyDescriptor(Ts.prototype,"pauseProcessAudioBuffer"),Ts.prototype),Tt(Ts.prototype,"seekAudioBuffer",[UM,VM],Object.getOwnPropertyDescriptor(Ts.prototype,"seekAudioBuffer"),Ts.prototype),Tt(Ts.prototype,"resumeProcessAudioBuffer",[BM,WM],Object.getOwnPropertyDescriptor(Ts.prototype,"resumeProcessAudioBuffer"),Ts.prototype),Tt(Ts.prototype,"stopProcessAudioBuffer",[GM,HM],Object.getOwnPropertyDescriptor(Ts.prototype,"stopProcessAudioBuffer"),Ts.prototype),Tt(Ts.prototype,"close",[zM],Object.getOwnPropertyDescriptor(Ts.prototype,"close"),Ts.prototype),Tt(Ts.prototype,"setAudioBufferPlaybackSpeed",[KM,qM],Object.getOwnPropertyDescriptor(Ts.prototype,"setAudioBufferPlaybackSpeed"),Ts.prototype),Ts);class qr extends Ar{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=dh().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,tr(8,"track-mix-")),oe(this,"trackList",void 0),oe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(N.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):N.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){N.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}PE(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof qr?r.emit(dd.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class Rie extends Y2{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ni.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),oe(this,"audioBuffer",void 0),oe(this,"sourceNode",void 0),oe(this,"startPlayTime",0),oe(this,"startPlayOffset",0),oe(this,"pausePlayTime",0),oe(this,"options",void 0),oe(this,"currentLoopCount",0),oe(this,"currentPlaybackSpeed",100),oe(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):N.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let YM=new Map;function $M(e,t){if(e.length===0||t.length===0)return 1/0;let r=C0(e),i=C0(t);return Math.floor(i/r)}class Q0{get rendFrameRate(){let t=Math.max(1,$M(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Os.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(N.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){oe(this,"trackId",void 0),oe(this,"config",void 0),oe(this,"onFirstVideoFrameDecoded",void 0),oe(this,"onFirstVideoFrameRender",void 0),oe(this,"onVideoStateChanged",void 0),oe(this,"freezeTimeCounterList",[]),oe(this,"renderFreezeAccTime",0),oe(this,"renderFreezeAccTime2",0),oe(this,"isKeepLastFrame",!1),oe(this,"isDestroyed",!1),oe(this,"timeUpdatedCount",0),oe(this,"freezeTime",0),oe(this,"playbackTime",0),oe(this,"lastTimeUpdatedTime",0),oe(this,"autoplayFailed",!1),oe(this,"videoTrack",void 0),oe(this,"videoElement",void 0),oe(this,"cacheVideoElement",void 0),oe(this,"internal",!1),oe(this,"_render_interframe_delays",[]),oe(this,"_render_interframe_delays_sizes",[]),oe(this,"_videoState",yo.VideoStateStopped),oe(this,"videoElementCheckInterval",void 0),oe(this,"videoElementFreezeTimeout",void 0),oe(this,"_videoElementStatus",Os.NONE),oe(this,"_isInPage",!0),oe(this,"isGettingVideoDimensions",!1),oe(this,"startGetVideoDimensions",()=>{let r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return N.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),oe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Xt.curState==="running"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(YL())),r2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),oe(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":r.type==="play"&&N.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Os.PLAYING;break;case"loadeddata":if(this.videoState=yo.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Os.CANPLAY;break;case"stalled":this.videoElementStatus=Os.STALLED;break;case"suspend":this.videoElementStatus=Os.SUSPEND;break;case"pause":this.videoElementStatus=Os.PAUSED,Bs()||Qi()||bs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Os.WAITING;break;case"abort":this.videoElementStatus=Os.ABORT;break;case"ended":this.videoElementStatus=Os.ENDED;break;case"emptied":this.videoElementStatus=Os.EMPTIED;break;case"error":{let i=this.videoElement.error;i&&(this.videoElementStatus=Os.ERROR,N.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{let i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);let c=i-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,bo.lastVisibleTime<bo.lastHiddenTime||d<bo.lastHiddenTime||d<bo.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>Y("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;let h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),oe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(YL())),r2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Xt.on(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xt.on(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let r=this.videoElement.play();r&&r.catch&&r.catch(c=>{t&&tM(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(N.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):N.warning("[".concat(this.trackId,"] play warning: "),c)});let i=Rt();if((i.name==="Safari"&&Number(i.version)===15||Ju())&&r&&r.then){let c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(c).catch(c)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let r=t.getContext("2d");if(!r)return N.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);let i=r.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;let c=i.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,i.width,i.height),new je((d,h)=>{i.toBlob(async p=>{if(i.remove(),p){let m=await dM(p);d({buffer:m,width:i.width,height:i.height})}else h(new he(z.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await J0(t)}destroy(){this.isDestroyed=!0,Xt.off(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xt.off(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=yo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Os.INIT,!this.videoElementCheckInterval&&(XM.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(d){return d!==document.body&&document.body.contains(d)}(this.videoElement)},1e3),Y("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let d,h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(p,Y("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===yo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=yo.VideoStateFrozen:document.addEventListener("visibilitychange",h))},m=(_,E)=>{if(this.videoElementStatus===Os.PLAYING){if(d){let C=E.presentationTime-d.presentationTime,U=E.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(U),this._render_interframe_delays.push(C);let k=C0(this._render_interframe_delays_sizes),M=k-this._render_interframe_delays_sizes[0];if(k>30&&M>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===yo.VideoStateStarting&&(this.videoState=yo.VideoStateDecoding),this.videoState===yo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,Y("VIDEO_FREEZE_DURATION"))),C<Y("VIDEO_FREEZE_DURATION")&&this.videoState===yo.VideoStateFrozen&&(this.videoState=yo.VideoStateDecoding),C>Y("VIDEO_FREEZE_DURATION")&&bo.lastVisibleTime>=bo.lastHiddenTime&&d.timestamp>bo.lastVisibleTime&&d.timestamp>bo.lastHiddenTime){let H=Math.min(66,$M(this._render_interframe_delays_sizes,this._render_interframe_delays)),K=Math.max(0,C-(U-1)*H);this.renderFreezeAccTime2+=K>H?K:0,this.renderFreezeAccTime+=C}}d=nr(nr({},E),{},{timestamp:_})}else this.isSkipCalcRenderFreezeTime()&&(d=nr(nr({},E),{},{timestamp:_}));var x,b;Y("ENABLE_VIDEO_FRAME_CALLBACK")&&((x=(b=this.videoElement).requestVideoFrameCallback)===null||x===void 0||x.call(b,m))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),DE()&&!Y("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let i=Rt();i.name==="Safari"&&Number(i.version)===15||Ju()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Sr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Sr()&&this.videoElement.load());let c=this.videoElement.play();c!==void 0&&c.catch(d=>{N.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){XM.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Os.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Os.DESTROYED||this.internal}handleAutoPlayFailed(){let t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{N.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{N.error(i)}),this.autoplayFailed=!1,Pf()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Pf()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),eM()}}let XM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Z0 extends Q0{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),oe(this,"container",void 0),oe(this,"slot",void 0),this.slot=t.element,this.internal=r,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let r=t.element;var i;!this.internal||this.slot?(r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()):(this.slot=r,r&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await J0(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Y("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var JM,QM,ZM,eF,tF,rF,sF,nF,iF,aF,oF,cF,lF,dF,uF,hF,pF,fF,mF,gF,_F,EF,vF,yF,xF,bF,wF,SF,xt,CF,TF,RF,NF,AF,IF,OF,DF,di;let ar=(JM=st({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),QM=Nr(),ZM=st({argsMap:e=>[e.getTrackId()]}),eF=th("LocalVideoTrack","_enabledMutex"),tF=st({argsMap:(e,t)=>[e.getTrackId(),t]}),rF=Nr(),sF=th("LocalVideoTrack","_enabledMutex"),nF=st({argsMap:(e,t)=>[e.getTrackId(),t]}),iF=Nr(),aF=st({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),oF=Nr(),cF=st({argsMap:(e,t)=>[e.getTrackId(),t]}),lF=Nr(),dF=Nr(),uF=st({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),hF=Nr(),pF=Nr(),fF=Nr(),mF=st({argsMap:e=>[e.getTrackId()]}),gF=Nr(),_F=Nr(),EF=Nr(),vF=Nr(),yF=Nr(),xF=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),bF=st({argsMap:e=>[e.getTrackId()]}),wF=st({argsMap:e=>[e.getTrackId()]}),SF=st({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),xt=class JH extends lh{get videoHeight(){if(bs()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(bs()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Os.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,i,c,d,h){if(super(t,d),oe(this,"trackMediaType",ch.VIDEO),oe(this,"_player",void 0),oe(this,"isUseScaleResolutionDownBy",!1),oe(this,"_videoVisibleTimer",null),oe(this,"_previousVideoVisibleStatus",void 0),oe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oe(this,"_encoderConfig",void 0),oe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),oe(this,"_optimizationMode",void 0),oe(this,"_saveEncodeBitrateRatio",1),oe(this,"_videoHeight",void 0),oe(this,"_videoWidth",void 0),oe(this,"_forceBitrateLimit",void 0),oe(this,"_enabled",!0),oe(this,"_processorDestination",void 0),oe(this,"_processorContext",void 0),bs()){let{width:p,height:m}=t.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=c,this._hints=h||[],r&&this._hints.indexOf(Zt.CUSTOM_TRACK)!==-1?this._encoderConfig=vr(r):this._encoderConfig=r,this._hints.indexOf(Zt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(h0(Lt.CHROME,115)&&IE().indexOf("Windows")!==-1){let p=function(m,_){if("VideoFrame"in window&&"TransformStream"in window&&Dt().supportWebRTCInsertableStream){let E=new MediaStreamTrackProcessor(m),x=new MediaStreamTrackGenerator({kind:"video"}),b,C,U=Date.now(),k=()=>{M&&(clearInterval(M),M=void 0),b&&(b.close(),b=void 0),m.stop(),C=void 0,x.removeEventListener("ended",k)},M=window.setInterval(()=>{if(C&&b&&Date.now()-U>1e3)try{x.readyState==="live"?C.enqueue(b.clone()):k()}catch{k()}},1e3),H=new TransformStream({transform:(K,X)=>{x.readyState==="live"?(C=X,U=Date.now(),b===void 0?(b=K,X.enqueue(K.clone())):(X.enqueue(b),b=K)):K.close()}});return x.addEventListener("ended",k),E.readable.pipeThrough(H).pipeTo(x.writable),x}}(t);p&&(N.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}r&&this._hints.indexOf(Zt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new sM(this.getTrackId(),"local"),this._processorDestination=new rM(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let c=document.getElementById(t);c?t=c:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));let i=nr(nr(nr({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new Q0(i):this._player=new Z0(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let c=this.getVideoElementVisibleStatus();this.safeEmit(oh.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},Y("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await er(this,Be.NEED_DISABLE_TRACK,this)}catch(i){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return r||(this._enabled=!1),void N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await er(this,Be.NEED_ENABLE_TRACK,this)}catch(i){throw N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await er(this,Be.NEED_MUTE_TRACK,this):await er(this,Be.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),N.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await er(this,Be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(N)}}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new he(z.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=ta(t),Y("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let i=KE({encoderConfig:t});(bs()||Bs()||Qi())&&(i.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(c){let d=new he(z.UNEXPECTED_ERROR,c.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,Be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(N)}}getStats(){return Fc(()=>{N.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ri(this,Be.GET_STATS)||nr({},H0)}async setBeautyEffect(t){N.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await J0(t)}async findClosestProfile(){let{width:t,height:r,frameRate:i}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},p=eh(this._videoWidth||t||c||0),m=eh(this._videoHeight||r||d||0),_=function(E,x,b){if(!Array.isArray(Y("VIDEO_ENCODER_CONFIG_LIST"))||Y("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let C=Math.min(E,x);return!(C>=480)&&nr(nr({},Y("VIDEO_ENCODER_CONFIG_LIST").find(U=>U.height>C)),{},{frameRate:b})}(p,m,eh(i||h||15));if(_)return N.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(p,"x").concat(m," => ").concat(JSON.stringify(_))),this.setEncoderConfiguration(_)}async setBitrateLimit(t){N.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void N.error(z.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let r=this._optimizationMode;try{this._optimizationMode=t,await er(this,Be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=r,N.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}N.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return N.error(z.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,N.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){aM(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(jE)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new he(z.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");N.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=ta(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,Be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(N)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:r,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!r||!i)return;let{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){let{max:h,min:p}=function(m,_,E,x,b){let C=Y("BITRATE_ADAPTER_TYPE");if(C==="DEFAULT_BITRATE")return{min:x,max:b};if(b===void 0){let U=Math.floor(200*Math.pow(E/15,.6)*Math.pow(m*_/640/360,.75));b=C==="STANDARD_BITRATE"?4*U:2*U,x=x??U}else x=x??Math.floor(b/10);return{min:x,max:b}}(t,r,i,d,c);if(this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=h,Y("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){let[m,_]=function(E,x,b){let C=4*Math.floor(2e5*Math.pow(b/15,.6)*Math.pow(E*x/230400,.75)),U=E*x,k=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),M=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),H=Ln(k).call(k).next().value,K=1;if(k.has(U))H=k.get(U);else{var X;let Te=Ql(X=Array.from(k.entries())).call(X,(vt,at)=>{let[Vt]=vt,[Mt]=at;return Vt-Mt}),_t=Te.find(vt=>{let[at]=vt;return at>U});if(_t){let vt=Te.indexOf(_t);if(vt>0){let at=Te[vt-1],Vt=(U-at[0])/(_t[0]-at[0]);H=at[1]+Vt*(_t[1]-at[1])}else H=_t[1]}else H=Te[Te.length-1][1]}if(M.has(U))K=M.get(U);else{var se;let Te=Ql(se=Array.from(M.entries())).call(se,(vt,at)=>{let[Vt]=vt,[Mt]=at;return Vt-Mt}),_t=Te.find(vt=>{let[at]=vt;return at>U});if(_t){let vt=Te.indexOf(_t);if(vt>0){let at=Te[vt-1],Vt=(U-at[0])/(_t[0]-at[0]);K=at[1]+Vt*(_t[1]-at[1])}else K=_t[1]}else K=Te[Te.length-1][1]}let te=Y("VIDEO_NEW_BITRATE_RATIO");te&&te>0&&(H=te/100);let Z=Math.floor(C*H),ce=Math.floor(65e4*Math.pow(E*x/230400,.5)*Math.pow(b/15,.69)),fe=Z,xe=Y("VIDEO_STANDARD_BITRATE_VERSION");return xe&&xe>0&&(xe===1?fe=C:xe===2?fe=Z:xe===3&&(fe=ce)),[Math.floor(fe/1e3),K]}(t,r,i);this._encoderConfig.bitrateMax=m,this._encoderConfig.bitrateMin=p?Math.min(p,m):m,this._saveEncodeBitrateRatio=_,N.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else N.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(i,"] => [brMax: ").concat(h,", brMin: ").concat(p,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,r;let i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){let p=o2.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;let _=ze.reportApiInvoke(null,{tag:Er.TRACER,name:Or.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new he(z.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new he(z.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=nr(nr({},i),ta(t))),i=ad(i);let c=tr(8,"track-video-cloned-"),d=new JH(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,ad(this._scalabilityMode),this._optimizationMode,c,ad(this._hints));return t&&i&&d.setEncoderConfiguration(i),N.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),d}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new he(z.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new he(z.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Fc(()=>{ze.reportApiInvoke(null,{name:Or.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Er.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Y("ENABLE_VIDEO_SEI")||!Y("ENABLE_ENCODED_TRANSFORM"))return void N.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new he(z.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let r=this.getRTCRtpTransceiver();if(!r)return void N.warning("Video track is not published, SEI can not be send");let i=r.sender.getParameters();if(i.codecs.length===0)return;let c=i.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",t):N.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(en.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await er(this,Be.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,Be.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(en.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ii.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ii.REQUEST_CONSTRAINTS)}},Tt(xt.prototype,"play",[JM,QM],Object.getOwnPropertyDescriptor(xt.prototype,"play"),xt.prototype),Tt(xt.prototype,"stop",[ZM],Object.getOwnPropertyDescriptor(xt.prototype,"stop"),xt.prototype),Tt(xt.prototype,"setEnabled",[eF,tF,rF],Object.getOwnPropertyDescriptor(xt.prototype,"setEnabled"),xt.prototype),Tt(xt.prototype,"setMuted",[sF,nF,iF],Object.getOwnPropertyDescriptor(xt.prototype,"setMuted"),xt.prototype),Tt(xt.prototype,"setSaveEncodeBitrateRatio",[aF,oF],Object.getOwnPropertyDescriptor(xt.prototype,"setSaveEncodeBitrateRatio"),xt.prototype),Tt(xt.prototype,"setEncoderConfiguration",[cF,lF],Object.getOwnPropertyDescriptor(xt.prototype,"setEncoderConfiguration"),xt.prototype),Tt(xt.prototype,"getStats",[dF],Object.getOwnPropertyDescriptor(xt.prototype,"getStats"),xt.prototype),Tt(xt.prototype,"setBeautyEffect",[uF,hF],Object.getOwnPropertyDescriptor(xt.prototype,"setBeautyEffect"),xt.prototype),Tt(xt.prototype,"getCurrentFrameData",[pF],Object.getOwnPropertyDescriptor(xt.prototype,"getCurrentFrameData"),xt.prototype),Tt(xt.prototype,"getCurrentFrameImage",[fF],Object.getOwnPropertyDescriptor(xt.prototype,"getCurrentFrameImage"),xt.prototype),Tt(xt.prototype,"findClosestProfile",[mF,gF],Object.getOwnPropertyDescriptor(xt.prototype,"findClosestProfile"),xt.prototype),Tt(xt.prototype,"setBitrateLimit",[_F],Object.getOwnPropertyDescriptor(xt.prototype,"setBitrateLimit"),xt.prototype),Tt(xt.prototype,"setOptimizationMode",[EF],Object.getOwnPropertyDescriptor(xt.prototype,"setOptimizationMode"),xt.prototype),Tt(xt.prototype,"setScalabiltyMode",[vF],Object.getOwnPropertyDescriptor(xt.prototype,"setScalabiltyMode"),xt.prototype),Tt(xt.prototype,"updateMediaStreamTrackResolution",[yF],Object.getOwnPropertyDescriptor(xt.prototype,"updateMediaStreamTrackResolution"),xt.prototype),Tt(xt.prototype,"pipe",[xF],Object.getOwnPropertyDescriptor(xt.prototype,"pipe"),xt.prototype),Tt(xt.prototype,"unpipe",[bF],Object.getOwnPropertyDescriptor(xt.prototype,"unpipe"),xt.prototype),Tt(xt.prototype,"close",[wF],Object.getOwnPropertyDescriptor(xt.prototype,"close"),xt.prototype),Tt(xt.prototype,"replaceTrack",[SF],Object.getOwnPropertyDescriptor(xt.prototype,"replaceTrack"),xt.prototype),xt),qE=(CF=st({argsMap:(e,t)=>[e.getTrackId(),t]}),TF=Nr(),RF=th("CameraVideoTrack","_enabledMutex"),NF=st({argsMap:(e,t)=>[e.getTrackId(),t]}),AF=Nr(),IF=st({argsMap:(e,t)=>[e.getTrackId(),t]}),OF=Nr(),DF=st({argsMap:e=>[e.getTrackId()]}),di=class QH extends ar{get __className__(){return"CameraVideoTrack"}constructor(t,r,i,c,d,h){super(t,ta(r.encoderConfig),c,d,h),oe(this,"_config",void 0),oe(this,"_originalConstraints",void 0),oe(this,"_constraints",void 0),oe(this,"_enabled",!0),oe(this,"_deviceName","default"),oe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ju()||_0())&&!function(){let p=Rt();if(p.os!==ts.IOS||!p.osVersion)return!1;let m=p.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&s2()&&this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=ta(this._config.encoderConfig),Xt.on(fs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Xt.on(fs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(N.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let r=await ci.getDeviceById(t),i={};i.video=nr({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await oi(i,this.getTrackId())}catch(d){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await oi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{let r=await ci.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}N.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){N.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let r={video:nr(nr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await oi(r,this.getTrackId())}catch(c){throw N.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),i=await oi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=nr({},r.video),N.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let i=await oi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await er(this,Be.NEED_ENABLE_TRACK,this)}catch(i){throw N.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await er(this,Be.NEED_DISABLE_TRACK,this)}catch(i){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new he(z.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=ta(t),Y("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let i=vr(this._config);i.encoderConfig=t;let c=KE(i);(bs()||Bs()||Qi())&&(c.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){let h=new he(z.UNEXPECTED_ERROR,d.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=i,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,Be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(N)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Bs()||Qi())&&this._enabled&&!this._isClosed&&Xt.duringInterruption){let t=async()=>{Xt.off(fs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Xt.on(fs.IOS_INTERRUPTION_END,t)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}async renewMediaStreamTrack(t){let r=t||this._constraints,i=ci.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId={exact:i}),this._enabled){let c=await oi({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Xt.off(fs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Xt.off(fs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=nr(nr({},i),ta(t))),i=ad(i);let c=tr(8,"track-cam-cloned-"),d=new QH(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,ad(nr(nr({},this._config),{},{encoderConfig:i})),ad(this._constraints),ad(this._scalabilityMode),this._optimizationMode,c);return t&&i&&d.setEncoderConfiguration(i),N.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),d}bindProcessorContextEvents(){this.processorContext.on(ii.REQUEST_UPDATE_CONSTRAINTS,async(t,r,i)=>{try{let c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){i(c)}}),this.processorContext.on(ii.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Tt(di.prototype,"setDevice",[CF,TF],Object.getOwnPropertyDescriptor(di.prototype,"setDevice"),di.prototype),Tt(di.prototype,"setEnabled",[RF,NF,AF],Object.getOwnPropertyDescriptor(di.prototype,"setEnabled"),di.prototype),Tt(di.prototype,"setEncoderConfiguration",[IF,OF],Object.getOwnPropertyDescriptor(di.prototype,"setEncoderConfiguration"),di.prototype),Tt(di.prototype,"close",[DF],Object.getOwnPropertyDescriptor(di.prototype,"close"),di.prototype),di);function eC(e,t,r,i){r.optimizationMode&&(i&&i.width&&i.height?(r.encoderConfig=nr(nr({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?N.debug("[".concat(e,"] set content hint to"),r.optimizationMode):N.debug("[".concat(e,"] set content hint failed")))):N.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var PF,kF,jF,LF,Ci,MF,FF,UF,VF,BF,WF,qs;class GF extends z2{getUserId(){return this._userId}constructor(t,r,i,c){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(c.clientId,"_").concat(tr(5,""))),oe(this,"_userId",void 0),oe(this,"_uintId",void 0),oe(this,"_isDestroyed",!1),oe(this,"store",void 0),oe(this,"processor",void 0),oe(this,"processorContext",void 0),this._userId=r,this._uintId=i,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,N.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let hh=(PF=st({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),kF=st({argsMap:e=>[e.getTrackId()]}),jF=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),LF=st({argsMap:e=>[e.getTrackId()]}),Tt((Ci=class extends GF{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Os.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,i,c){super(e,t,r,i),oe(this,"_videoVisibleTimer",null),oe(this,"_previousVideoVisibleStatus",void 0),oe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oe(this,"trackMediaType",ch.VIDEO),oe(this,"_videoWidth",void 0),oe(this,"_videoHeight",void 0),oe(this,"_player",void 0),oe(this,"_prePlayer",void 0),oe(this,"processorDestination",void 0),oe(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new sM(this.getTrackId(),"remote"),this.processorDestination=new rM(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Fc(()=>{N.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ri(this,Be.GET_STATS)||nr({},G2)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Si.PLAY_START),typeof e=="string"){let i=document.getElementById(e);i?e=i:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=nr(nr({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(r);else{let i=!1,c=!1;e instanceof HTMLVideoElement?(this._player=new Q0(r),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(r)):this._player=new Z0(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Si.FIRST_FRAME_DECODED),c&&this.safeEmit(Si.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Si.VIDEO_STATE_CHANGED,d)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i=this.getVideoElementVisibleStatus();this.safeEmit(Si.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},Y("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Si.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){aM(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(jE)}_updatePlayerSource(){N.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:c,slot:d}=i;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){let h=o2.checkOneElementVisible(c),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;let m=ze.reportApiInvoke(null,{tag:Er.TRACER,name:Or.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(r){throw new he(z.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new he(z.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(en.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(en.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(dd.SEI_RECEIVED,e)}}).prototype,"play",[PF],Object.getOwnPropertyDescriptor(Ci.prototype,"play"),Ci.prototype),Tt(Ci.prototype,"stop",[kF],Object.getOwnPropertyDescriptor(Ci.prototype,"stop"),Ci.prototype),Tt(Ci.prototype,"pipe",[jF],Object.getOwnPropertyDescriptor(Ci.prototype,"pipe"),Ci.prototype),Tt(Ci.prototype,"unpipe",[LF],Object.getOwnPropertyDescriptor(Ci.prototype,"unpipe"),Ci.prototype),Ci),ph=(MF=st({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),FF=st({argsMap:(e,t)=>[e.getTrackId(),t]}),UF=st({argsMap:e=>[e.getTrackId()]}),VF=st({argsMap:e=>[e.getTrackId()]}),BF=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),WF=st({argsMap:e=>[e.getTrackId()]}),Tt((qs=class extends GF{get isPlaying(){return this._useAudioElement?un.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,i){super(e,t,r,i),oe(this,"trackMediaType",ch.AUDIO),oe(this,"_source",void 0),oe(this,"_useAudioElement",!0),oe(this,"_volume",100),oe(this,"processorContext",void 0),oe(this,"processorDestination",void 0),oe(this,"_played",!1),oe(this,"_bypassWebAudio",!1),Y("DISABLE_WEBAUDIO")?(this._source=new X0,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new $2(e,!0),Y("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ni.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Si.FIRST_FRAME_DECODED)}),this.processorContext=new iM(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new nM(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ni.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ni.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ni.ON_AUDIO_BUFFER),this._source.on(ni.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?un.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!U2())throw new he(z.NOT_SUPPORTED,"your browser does not support setting the audio output device");await un.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Fc(()=>{N.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ri(this,Be.GET_STATS)||nr({},W2)}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] use audio element to play")),un.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?un.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&un.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new he(z.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new he(z.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new he(z.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(en.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(en.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(en.ON_TRACK),this.processorDestination.removeAllListeners(en.ON_NODE)}}).prototype,"setVolume",[MF],Object.getOwnPropertyDescriptor(qs.prototype,"setVolume"),qs.prototype),Tt(qs.prototype,"setPlaybackDevice",[FF],Object.getOwnPropertyDescriptor(qs.prototype,"setPlaybackDevice"),qs.prototype),Tt(qs.prototype,"play",[UF],Object.getOwnPropertyDescriptor(qs.prototype,"play"),qs.prototype),Tt(qs.prototype,"stop",[VF],Object.getOwnPropertyDescriptor(qs.prototype,"stop"),qs.prototype),Tt(qs.prototype,"pipe",[BF],Object.getOwnPropertyDescriptor(qs.prototype,"pipe"),qs.prototype),Tt(qs.prototype,"unpipe",[WF],Object.getOwnPropertyDescriptor(qs.prototype,"unpipe"),qs.prototype),qs),bo=new class extends br{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),oe(this,"_lastHiddenTime",0),oe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),N.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class HF extends br{constructor(t,r){super(),oe(this,"trackMediaType",ch.DATA),oe(this,"_version",1),oe(this,"_type",3),oe(this,"_config",void 0),oe(this,"_originDataChannel",void 0),oe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),oe(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),oe(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Y("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new je((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let i=setTimeout(()=>{var c;r(new he(z.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new he(z.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new he(z.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[HE.OPEN,HE.CLOSE,HE.ERROR].forEach(r=>{let i=()=>{this.emit(r)};this._datachannelEventMap.set(r,i),t.addEventListener(r,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[i,c]=r;t.removeEventListener(i,c)}),this._datachannelEventMap.clear()}}class Nie extends HF{constructor(t){super(t),oe(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let i=r.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(i).getUint8(3);if(c!==this.id)return void(Y("SHOW_DATASTREAM2_LOG")&&N.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=r.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(HE.MESSAGE,d)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Aie extends HF{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);let i=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function YE(){let e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>q_.revokeObjectURL(e),0),new Worker(q_.createObjectURL(e))}let zF=71,tC=1,rC=2,sC=1,KF=2;var Bc=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Bc||{});function nC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=e.getUint8(0);if(r!==zF)return;let i=e.getUint16(1),c=tC+rC+i,d=new Uint8Array(e.byteLength-c);d.set(new Uint8Array(e.buffer,c,e.byteLength-c));let h={m:r,tlvLen:i,tlv:[],frame:d},p=tC+rC;for(;p<c;){let m=e.getUint8(p),_=e.getUint16(p+sC),E=sC+KF;if(m===Bc.AUDIO_LEVEL){let x=e.getUint8(p+E);for(let b=1;b<_;b++)x=x<<8|e.getUint8(p+E+b);h.tlv.push({tag:m,length:_,value:t?127^x>>1:127&x})}else if(m===Bc.METADATA||m===Bc.AUDIO_64_BIT_PTS){let x=new Uint8Array(_);for(let b=0;b<_;b++)x[b]=e.getUint8(p+E+b);h.tlv.push({tag:m,length:_,value:x})}p+=E+_}return h}let $E=new Map,XE=127,pd=1e-10,iC=139/13,JE=new Map;function aC(e,t,r){let i="".concat(e,"-").concat(t,"-").concat(r),c=0;return JE.has(i)?c=JE.get(i):(c=Math.log(function(d,h){let p=d-h;h<p&&(h=p);let m=1;for(let _=d,E=1;_>h;_--,E++)m=m*_/E;return m}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,JE.set(i,c)),c<pd&&(c=pd),c}function qF(e,t,r){let i=t.length,c=e.length/i,d=!1;for(let h=0,p=0;h<i;h++){let m=0;for(let _=p+c;p<_;p++)e[p]>r&&m++;t[h]!==m&&(t[h]=m,d=!0)}return d}window.cache=JE;let Iie=0;class YF{constructor(t){oe(this,"id",void 0),oe(this,"immediates",[]),oe(this,"lastNonSilence",-1),oe(this,"immediateSpeechActivityScore",pd),oe(this,"lastLevelChangedTime",Date.now()),oe(this,"levels",[]),oe(this,"longs",[]),oe(this,"longSpeechActivityScore",pd),oe(this,"mediums",[]),oe(this,"mediumSpeechActivityScore",pd),oe(this,"minLevel",0),oe(this,"nextMinLevel",0),oe(this,"nextMinLevelWindowLength",0),oe(this,"energyScore",0),this.id=t||"".concat(Iie++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,r=this.levels,i=this.minLevel+iC,c=!1;for(let d=0;d<t.length;++d){let h=r[d];h<i&&(h=0);let p=Math.floor(h/iC);t[d]!==p&&(t[d]=p,c=!0)}return c}computeLongs(){return qF(this.mediums,this.longs,4)}computeMediums(){return qF(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=aC(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=aC(this.longs[0],10,47),this.longSpeechActivityScore>pd&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=aC(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(NO(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let i=t;return t<0&&(i=0),t>XE&&(i=XE),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+iC?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>XE&&(r=XE),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Oie{constructor(t){oe(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class oC{constructor(t,r,i){oe(this,"isDominant",void 0),oe(this,"energyRanking",void 0),oe(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=i}}class Die extends br{constructor(t){super(),oe(this,"dominantId",null),oe(this,"lastDecisionTime",0),oe(this,"lastLevelChangedTime",0),oe(this,"lastLevelIdleTime",0),oe(this,"relativeSpeechActivities",[]),oe(this,"speakers",new Map),oe(this,"enableSilence",!1),oe(this,"timeoutToSilenceInterval",0),oe(this,"decisionMaker",null),oe(this,"loudest",[]),oe(this,"numLoudestToTrack",3),oe(this,"energyExpireTimeMs",250),oe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(r=>r.id===t)}levelChanged(t,r){let i=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());let d=c.levelChanged(r,i);return this.updateLoudestList(c,d,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)})}removeSpeakers(t){t.forEach(r=>{this.speakers.delete(r.id)})}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new YF(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,i){let c=t.id===this.dominantId;if(r<0){let m=0;for(;m<this.loudest.length&&this.loudest[m]!==t;)++m;return new oC(c,m,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new oC(c,0,t.energyScore);let d=i-this.energyExpireTimeMs,h=0;for(;h<this.loudest.length;){let m=this.loudest[h];if(m.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(m.id!==t.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let p=0;for(;p<this.loudest.length&&!(this.loudest[p].energyScore<t.energyScore);)++p;return p<this.numLoudestToTrack&&(this.loudest.splice(p,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new oC(c,p,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Oie(this),this.decisionMaker.execute())}makeDecision(t){let r=null,i=null,c=this.speakers.size,d=null;if(c===0)d=null;else if(c===1){var h;let p=Ln(h=this.speakers).call(h).next().value;this.enableSilence&&p&&(d=p.id,p.evaluateSpeechActivityScores(t),t-p.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let p=this.dominantId==null?null:this.speakers.get(this.dominantId);if(p==null){let E=this.speakers.entries().next();E.value&&(d=E.value[0],p=E.value[1])}else d=p.id;p==null||p.evaluateSpeechActivityScores(t);let m=this.relativeSpeechActivities,_=2;for(let E of this.speakers.entries()){let[x,b]=E;if(b===p)continue;b.evaluateSpeechActivityScores(t);for(let M=0;M<m.length;++M){let H=p==null?pd:p.getSpeechActivityScore(M);m[M]=Math.log(b.getSpeechActivityScore(M)/H)}let C=m[0],U=m[1],k=m[2];C>3&&U>2&&k>0&&U>_&&(_=U,d=x)}this.enableSilence&&p!=null&&d===p.id&&t-p.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(r=this.dominantId,this.dominantId=d,i=this.dominantId),i==null&&!this.enableSilence||i===r||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){let t=Date.now(),r=300-(t-this.lastLevelIdleTime),i=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=r;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&i>c&&(i=c),i}timeoutIdleLevels(t){let r=[];for(let c of Ln(i=this.speakers).call(i)){var i;let d=t-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?r.push(c.id):300<d&&c.levelTimedOut()}r.forEach(c=>this.speakers.delete(c))}}let fh=new Map,Fa=null,QE=null,$F=3,fd=[],Ua=new Map,ZE=new Map;class Pie{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){oe(this,"id",void 0),oe(this,"track",void 0),oe(this,"score",0),oe(this,"active",!0),oe(this,"muted",!1),oe(this,"timer",0),oe(this,"actives",0),oe(this,"inactives",0),this.id=t,this.track=r,this.setActive(Ua.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:r,inactives:i}=function(){let c=[],d=[];return Array.from(Ln(Ua).call(Ua)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(r.length>3){let c;r.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(r.length<3&&i.length>0){let c;i.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=function(r){let i;return Array.from(Ln(Ua).call(Ua)).forEach(c=>{!c.active||c.id===r||c.samples<40||(!i||c.score<i.score)&&(i=c)}),i}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=function(r){let i;return Array.from(Ln(Ua).call(Ua)).forEach(c=>{c.active||c.id===r||c.samples<40||(!i||c.score>i.score)&&(i=c)}),i}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let ev;function XF(e){let t=Ua.get(e);t&&(Ua.delete(e),t.clearTimer())}let tv=new Map,kie=new Map,cC="video/h264",lC="video/h265";function JF(e,t,r){let i=new Uint8Array(e,t,r),c=[],d=0;for(;c.length<r;)d+3<r&&i[d]===0&&i[d+1]===0&&i[d+2]===3&&(i[d+3]===0||i[d+3]===1||i[d+3]===2||i[d+3]===3)?(c.push(i[d],i[d+1],i[d+3]),d+=4):(c.push(i[d]),d++);return new Uint8Array(c)}function QF(e){let t=e.length,r=[],i=0;for(;i<t;)i+2<t&&e[i]===0&&e[i+1]===0&&(e[i+2]===0||e[i+2]===1||e[i+2]===2||e[i+2]===3)?(r.push(e[i],e[i+1],3,e[i+2]),i+=3):(r.push(e[i]),i++);return new Uint8Array(r)}function ZF(e){if(e.length<5)return"";let t=-1;for(let c=0;c<e.length-3;c++){if(e[c]===0&&e[c+1]===0&&e[c+2]===1){t=c;break}if(c<e.length-4&&e[c]===0&&e[c+1]===0&&e[c+2]===0&&e[c+3]===1){t=c;break}}if(t===-1)return"";let r=t+(e[t+2]===0?4:3);if(r>=e.length)return"";let i=e[r];return 128&i?"":(i>>1&63)>=32||r+1<e.length&&!(248&e[r+1])?lC:(31&i)<=31?cC:""}let rv=new Map,zf=new Map;(function(){let e=Rt();ps.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ps.getStreamFromExtension=e.name===Lt.CHROME&&Number(e.version)>34,ps.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),ps.supportMinBitrate=e.name===Lt.CHROME||e.name===Lt.EDGE,ps.supportSetRtpSenderParameters=function(){let t=Rt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ec()||!(!bs()&&!OE())||t.name===Lt.FIREFOX&&Number(t.version)>=64)}(),e.name===Lt.SAFARI&&(Number(e.version)>=14?ps.supportDualStream=!0:ps.supportDualStream=!1),ps.webAudioMediaStreamDest=function(){let t=Rt();return!(t.name===Lt.SAFARI&&Number(t.version)<12)}(),ps.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ps.supportWebGL=typeof WebGLRenderingContext<"u",ps.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ec()||(ps.webAudioWithAEC=!0),ps.supportShareAudio=function(){let t=Rt();return(t.os===ts.WIN_10||t.os===ts.WIN_81||t.os===ts.WIN_7||t.os===ts.LINUX||t.os===ts.MAC_OS||t.os===ts.CHROMIUM_OS)&&t.name===Lt.CHROME&&Number(t.version)>=74}(),ps.supportDataChannel=!!(Xu(76)||f0(68)||QL(14)),ps.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!Sr()&&!!t&&t.prototype.setConfiguration instanceof Function}(),ps.supportWebRTCEncodedTransform=Xu(87)||$L()||f0(117),ps.supportWebRTCInsertableStream=function(){let t=Rt();return(t.name===Lt.CHROME||t.name===Lt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ps.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ps.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,kE(()=>{ps.supportDualStreamEncoding=function(){let t=Rt();return!!Y("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&Y("CHROME_DUAL_STREAM_USE_ENCODING"))}(),N.debug("browser ua: ",navigator.userAgent),N.info("browser info: ",e),N.info("browser compatibility: ",ps)})})();let jie=["CHINA","GLOBAL"],eU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],md=[],mh=[];function gd(e,t){return!!t&&md.some(r=>r.uid===e&&r.channelName===t)}function dC(){return mh.length>0}var Lie=fj.forEach,tU=i_("forEach")?[].forEach:function(e){return Lie(this,e,arguments.length>1?arguments[1]:void 0)};qt({target:"Array",proto:!0,forced:[].forEach!==tU},{forEach:tU});var Mie=Hi("Array","forEach"),Fie=Ac,Uie=Us,Vie=I,Bie=Mie,uC=Array.prototype,Wie={DOMTokenList:!0,NodeList:!0},Gie=function(e){var t=e.forEach;return e===uC||Vie(uC,e)&&t===uC.forEach||Uie(Wie,Fie(e))?Bie:t},Hie=u(Gie),zie=ho,rU=u_;qt({target:"Object",stat:!0,forced:f(function(){rU(1)})},{keys:function(e){return rU(zie(e))}});var Kie=u(Pr.Object.keys),qie=u(CO),Yie=u(RO),$ie=qt,sU=tf,Xie=C_,Jie=jt,nU=Ob,Qie=Nc,Zie=ft,eae=$w,tae=Kr,rae=Oc,sae=ij("slice"),nae=tae("species"),hC=Array,iae=Math.max;$ie({target:"Array",proto:!0,forced:!sae},{slice:function(e,t){var r,i,c,d=Zie(this),h=Qie(d),p=nU(e,h),m=nU(t===void 0?h:t,h);if(sU(d)&&(r=d.constructor,(Xie(r)&&(r===hC||sU(r.prototype))||Jie(r)&&(r=r[nae])===null)&&(r=void 0),r===hC||r===void 0))return rae(d,p,m);for(i=new(r===void 0?hC:r)(iae(m-p,0)),c=0;p<m;p++,c++)p in d&&eae(i,c,d[p]);return i.length=c,i}});var aae=Hi("Array","slice"),oae=I,cae=aae,pC=Array.prototype,lae=function(e){var t=e.slice;return e===pC||oae(pC,e)&&t===pC.slice?cae:t},dae=u(lae);function Ge(e,t,r,i,c){var d,h,p,m={};return Hie(d=Kie(i)).call(d,function(_){m[_]=i[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=qie(h=Yie(p=dae(r).call(r)).call(p)).call(h,function(_,E){return E(e,t,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(tj(e,t,m),null):m}let sv=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),fC=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ra=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),tn=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),tt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),ir=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ot=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),it=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Kf=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),St=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),rn=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),pt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function nv(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw N.error("Invalid Channel Name ".concat(e)),new le(z.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function iv(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||a2(e,1,255)))throw new le(z.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&N.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let rc=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),uae={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},mC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function gC(e,t){us(e.url,"".concat(t,".url"),1,1e3,!1),Cr(e.x)||Qt(e.x,"".concat(t,".x"),0,1e4),Cr(e.y)||Qt(e.y,"".concat(t,".y"),0,1e4),Cr(e.width)||Qt(e.width,"".concat(t,".width"),0,1e4),Cr(e.height)||Qt(e.height,"".concat(t,".height"),0,1e4),Cr(e.zOrder)||Qt(e.zOrder,"".concat(t,".zOrder"),0,255),Cr(e.alpha)||Qt(e.alpha,"".concat(t,".alpha"),0,1,!1)}let hae={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Wc=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),_C=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Yr=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function iU(e){if(!e.channelName)throw new le(z.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new le(z.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&us(e.token,"info.token",1,2047),iv(e.uid),nv(e.channelName),!0}let sn=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),sc=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),bn=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),gh=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),zt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),is=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),av=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),rs=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Ft=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),aU=[Ft.AFRICA,Ft.ASIA,Ft.CHINA,Ft.EUROPE,Ft.GLOBAL,Ft.INDIA,Ft.JAPAN,Ft.NORTH_AMERICA,Ft.OCEANIA,Ft.OVERSEA,Ft.SOUTH_AMERICA],Ds=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),ov={CHINA:{},ASIA:{CODE:Ds.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ds.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ds.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ds.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ds.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ds.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ds.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ds.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ds.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ds.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ds.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ds.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ds.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};k0&&(ov.CHINA={CODE:Ds.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let qf=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function oU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class cU extends br{constructor(t,r){super(),W(this,"onICEConnectionStateChange",void 0),W(this,"onConnectionStateChange",void 0),W(this,"onDTLSTransportStateChange",void 0),W(this,"onDTLSTransportError",void 0),W(this,"onICETransportStateChange",void 0),W(this,"onFirstAudioReceived",void 0),W(this,"onFirstVideoReceived",void 0),W(this,"onFirstAudioDecoded",void 0),W(this,"onFirstVideoDecoded",void 0),W(this,"onFirstVideoRender",void 0),W(this,"onFirstVideoDecodedTimeout",void 0),W(this,"onSelectedLocalCandidateChanged",void 0),W(this,"onSelectedRemoteCandidateChanged",void 0),W(this,"onICECandidateError",void 0),W(this,"getLocalVideoStats",void 0)}}class lU extends cU{constructor(t,r){super(t,r),W(this,"establishPromise",void 0)}}let Fe=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ps=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),nc=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),dU=["disconnected","failed"],Se=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Gt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Je=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),sa=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),na=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),as=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),uU=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),wo=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Ti=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Va=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),_h=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),kr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Eh=function(e){return e.ABORT="abort",e}({}),Gc=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),pae=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),fae={[sv.ACCESS_POINT]:{[tn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[tn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[tn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[tn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[tn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[tn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[sv.UNILBS]:{[ra.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ra.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ra.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ra.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ra.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ra.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ra.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ra.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ra.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ra.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ra.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ra.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[sv.STRING_UID_ALLOCATOR]:{[fC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[fC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[fC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function vh(e){let t=fae[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===sv.ACCESS_POINT){let i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}let mae={[tt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[tt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[tt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[tt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[tt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[tt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[tt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[tt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[tt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[tt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[tt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[tt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[tt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[tt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[tt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[tt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[tt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[tt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[tt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[tt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[tt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[tt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[tt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[tt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[tt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[tt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[tt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[tt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[tt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[tt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[tt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[tt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[tt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[tt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[tt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[tt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[tt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[tt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[tt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[tt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[tt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[tt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[tt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[tt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[tt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[tt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[tt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[tt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[tt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[tt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[tt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[tt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[tt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[tt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[tt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[tt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[tt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[tt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[tt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[tt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[tt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[tt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[tt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[tt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Yf(e){return mae[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function hU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function EC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hU(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function vC(e,t){if(typeof e=="string")return e;let{proxy:r,host:i,port:c}=e;if(t){let d=Y("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(i,"/ws/?p=").concat(Number(c)+150):"wss://".concat(i,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(i,"&p=").concat(c):"wss://".concat(i,":").concat(c)}let gae=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,_ae=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Eae=/wss:\/\/(.+):([0-9]+)\/?/,vae=/wss:\/\/(.[^\/]+)\/?/,yae=0;class xae{constructor(t,r){W(this,"id",0),W(this,"store",void 0),W(this,"recordIndex",void 0),W(this,"websockets",[]),W(this,"try443PortDuration",2e3),W(this,"forceCloseWSDuration",5e3),W(this,"try443PortTimeout",null),W(this,"forceCloseTimeout",null),W(this,"isTry443PortFailed",!1),W(this,"isNormalPortFailed",!1),W(this,"useDoubleDomain",!1),W(this,"useProxy",!1),W(this,"startTime",Date.now()),this.id=++yae,this.try443PortDuration=Y("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let r=Date.now()-this.startTime;for(var i=arguments.length,c=new Array(i),d=0;d<i;d++)c[d]=arguments[d];N.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...c)}createWebSocket(t,r,i){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:i});let c=Y("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=c.find(b=>{var C;return Ae(C=t.host).call(C,b)});p||(this.useDoubleDomain=!1);let m=[];if(this.useDoubleDomain)c.forEach(b=>{m.push(vC(EC(EC({},t),{},{host:t.host.replace(p,b)}),r))});else{let b=EC({},t);if(r&&p){let C=c.find(U=>U!==p);C&&(b.host=b.host.replace(p,C))}m.push(vC(b,r))}try{m.forEach(b=>{let C=new WebSocket(b);C.binaryType="arraybuffer",h.push(C),this.logger("ws is connecting:",C.url)})}catch(b){if(this.logger("ws create failed"),h.forEach(C=>C.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,i);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new le(z.WS_ERR,"init websocket failed! Error: ".concat(b.toString()))}let _=Df();this.store&&this.store.recordJoinChannelService({urls:h.map(b=>b.url),service:"gateway"},this.recordIndex),h.forEach(b=>{b.onopen=()=>{this.logger("onopen: ws ".concat(b.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(C=>{C!==b&&(C.onopen=null,C.onclose=null,C.onmessage=null,C.close(),this.logger("close backup websocket: ".concat(C.url)))}),this.websockets.length=0,_.resolve(b)},b.onclose=C=>{this.logger("onclose: ws ".concat(b.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(b.readyState));let U=h.every(k=>k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING);this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(U)),U&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(C.reason)),_.reject({code:C.code,reason:av.A_ROUND_WS_FAILED})):!r&&U&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),x()),r?this.isTry443PortFailed=U:this.isNormalPortFailed=U},b.onmessage=C=>this.logger("".concat(b.url," onmessage: ").concat(C.data))}),this.websockets.push(...h);let E=()=>{this.websockets.forEach(b=>b.readyState!==WebSocket.OPEN&&b.close())},x=()=>{if(_.isResolved)return E();Rt().os===ts.MAC_OS&&Sr()&&E(),this.createWebSocket(t,!0,!0).then(b=>{_.resolve(b)}).catch(b=>{this.isNormalPortFailed&&_.reject(b),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.forceCloseTimeout=null,E()},this.forceCloseWSDuration)};return i||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,E()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",_.isResolved),this.try443PortTimeout=null,x()},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(t,r,i,c){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=function(d){let h,p,m;return[,h,p,m]=d.match(gae)||[],h||([,p,m]=d.match(_ae)||[]),p&&m||([,p,m]=d.match(Eae)||[]),p&&m||([,p]=d.match(vae)||[]),p||N.warning("un-destructible url: ",d),{proxy:h,host:p,port:m||"443"}}(t)),this.recordIndex=c,this.useProxy=!!t.proxy,i&&this.useProxy&&(N.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function pU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}class fU extends br{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;Ae(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(pt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pt.CONNECTED):this._state==="closed"?this.emit(pt.CLOSED):this._state==="failed"&&this.emit(pt.FAILED))}resetReconnectCount(t){N.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),W(this,"_websocketUrl",null),W(this,"connectionID",0),W(this,"currentURLIndex",0),W(this,"urls",[]),W(this,"_reconnectMode","tryNext"),W(this,"reconnectReason",void 0),W(this,"_initMutex",void 0),W(this,"name",void 0),W(this,"_state","closed"),W(this,"reconnectInterrupter",void 0),W(this,"websocket",void 0),W(this,"retryConfig",void 0),W(this,"reconnectCount",0),W(this,"forceCloseTimeout",5e3),W(this,"onlineReconnectListener",void 0),W(this,"useCompress",void 0),W(this,"tryDoubleDomain",!1),W(this,"use443PortOnly",!1),W(this,"wsInflateLength",0),W(this,"wsDeflateLength",0),W(this,"closeEstablishingWs",()=>{}),W(this,"store",void 0),W(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=t,this.retryConfig=function(x){for(var b=1;b<arguments.length;b++){var C=arguments[b]!=null?arguments[b]:{};b%2?pU(Object(C),!0).forEach(function(U){W(x,U,C[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(C)):pU(Object(C)).forEach(function(U){Object.defineProperty(x,U,Object.getOwnPropertyDescriptor(C,U))})}return x}({},r),this.useCompress=i,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Is("websocket",h?h.clientId:void 0);let{timeout:p,timeoutFactor:m}=r,_=Math.max(300,Math.floor(3*p/5)),E=Math.max(1.2,Math.floor(8*m)/10);Un.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=E),Mr.on(Qu.NETWORK_STATE_CHANGE,(x,b)=>{x!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(x)),x===Un.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{var c;let d=Df(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(p){return!(BE()||Y("USE_NEW_TOKEN")||!Y("ENABLE_PREALLOC_PC")&&(p==null||!p.autoSubscribe||Y("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(uU.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(pt.CLOSED,()=>{d.reject(new he(z.WS_DISCONNECT))}),this.once(pt.CONNECTED,d.resolve),await d.promise}catch{}finally{i()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let i=this.websocket;r?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void N.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),N.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);let i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new he(z.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new he(z.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;let i=Df();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let c=E=>{var x;(x=this.store)===null||x===void 0||x.signalChannelOpen(),N.debug("[".concat(this.name,"] websocket opened:"),E),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},d=async E=>{var x;if(N.debug("[".concat(this.name,"] websocket close ").concat((x=this.websocket)===null||x===void 0?void 0:x.url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new he(z.WS_DISCONNECT,"websocket close: ".concat(E.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");let b=ri(this,pt.WILL_RECONNECT,this.reconnectMode,E.reason)||this.reconnectMode,C=await this.reconnectWithAction(b);if(this.state==="closed")return void N.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!C)return i.reject(new he(z.WS_DISCONNECT,"websocket reconnect failed: ".concat(E.code))),this.close(!0);i.resolve()}},h=E=>{this.emit(pt.ON_MESSAGE,E)},p=E=>{N.warn("[".concat(this.connectionID,"] ws open error ").concat(E))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Y("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=Y("GATEWAY_WSS_ADDRESS")),N.debug("[".concat(this.name,"] start connect, url:"),t);let m=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var _;this._websocketUrl=vC(t);let E=await this.chooseBestWebsocketConnection(t);this.websocket=E,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=p,(_=this.store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(E){let x=this.state==="closed",b=E instanceof he,C=b&&E.code===z.WS_ABORT,U=b&&E.code===z.WS_ERR,k=b?E.message:E&&(E.reason||E.toString());N.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(k)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:C?"aborted":"error",errors:[E]},m),x||U?(i.reject(x?new he(z.WS_DISCONNECT,"websocket is closed: ".concat(k)):new he(z.WS_ERR,"init websocket failed: ".concat(k))),U&&N.error("[".concat(this.name,"] init websocket failed: ").concat(k))):d&&d(E)}return i.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;N.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Mr.isOnline||!Mr.onlineWaiter||(this.onlineReconnectListener=Mr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,r){let h=T0(this.reconnectCount,this.retryConfig);N.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(t)),await je.race([hs(h),this.onlineReconnectListener||new je(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;let c=async(h,p)=>{this.emit(pt.RECONNECT_CREATE_CONNECTION,p),await this.createWebSocketConnection(h)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);N.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(N.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Ss(this,pt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(h){var d;N.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));let p=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(p)&&Ae(p).call(p,"dynamic key expired")?(this.emit(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class yC extends fU{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){let i=Df(),c=function(h,p){return new xae(h,p)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),i.reject(new he(z.WS_ABORT,"choose best websocket aborted"))};let d=Y("GATEWAY_DOMAINS");return N.debug("[choose-best-ws] currentDomain: ",t,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class $f extends fU{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new je((i,c)=>{let d=!1,h=[];this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),h.forEach(U=>{U.onclose=null,U.onopen=null,U.onmessage=null,U.close()}),c(new he(z.WS_ABORT,"choose best websocket aborted"))};let p=Y("GATEWAY_DOMAINS"),m,_=t.indexOf("?h="),E=p.find(U=>_!==-1?Ae(t).call(t,U,_):Ae(t).call(t,U));N.debug("[choose-best-ws] currentDomain: ",E,", domains: ",p);let x=!this.tryDoubleDomain||!E;if(!x&&E){var b;let U=Date.now();try{p.forEach(k=>{let M=_===-1?t.replace(E,k):t.substr(0,_)+t.substr(_).replace(E,k),H=new WebSocket(M);H.binaryType="arraybuffer",h.push(H),N.debug("[choose-best-ws] ws is connecting:",H.url)})}catch{for(N.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(k=>k.close());h.length;)h.pop();x=!0}(b=this.store)===null||b===void 0||b.recordJoinChannelService({urls:h.map(k=>k.url),service:"gateway"},r),h.forEach(k=>{k.onopen=()=>{if(d)return;let M=Date.now()-U;N.debug("[choose-best-ws] ws open cost ".concat(M,"ms")),h.filter(H=>H!==k).forEach(H=>{N.debug("[choose-best-ws]close backup websocket: ".concat(H.url)),H.close()}),d=!0,i(k)},k.onclose=M=>{m=M,!d&&(h.find(H=>!(H.readyState===WebSocket.CLOSED||H.readyState===WebSocket.CLOSING))||(N.debug("[choose-best-ws] all websocket is closed"),d=!0,c(m)))},k.onmessage=M=>{N.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(M.data))}}),hs(this.forceCloseTimeout).then(()=>{h.forEach(k=>{k.readyState!==WebSocket.OPEN&&k.close()})})}if(x){var C;let U;N.debug("[choose-best-ws] use single url: ",t),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[t],service:"gateway"},r);try{U=new WebSocket(t),h.push(U),U.binaryType="arraybuffer"}catch(k){let M=new he(z.WS_ERR,"init websocket failed! Error: ".concat(k.toString()));return N.error("[".concat(this.name,"]").concat(M)),void c(M)}U.onopen=()=>{i(U)},U.onclose=k=>{c(k)},U.onmessage=k=>{N.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(k.data))},hs(this.forceCloseTimeout).then(()=>{U&&U.readyState!==WebSocket.OPEN&&U.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class bae extends br{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ir.CONNECTED?this.emit(ot.WS_CONNECTED):t===ir.RECONNECTING?this.emit(ot.WS_RECONNECTING,this._websocketReconnectReason):t===ir.CLOSED&&this.emit(ot.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),W(this,"_disconnectedReason",void 0),W(this,"_websocketReconnectReason",void 0),W(this,"_connectionState",ir.CLOSED),W(this,"reconnectToken",void 0),W(this,"websocket",void 0),W(this,"openConnectionTime",void 0),W(this,"clientId",void 0),W(this,"lastMsgTime",Date.now()),W(this,"uploadCache",[]),W(this,"uploadCacheInterval",void 0),W(this,"rttRolling",new b2(5)),W(this,"pingpongTimer",void 0),W(this,"wsInflateDataTimer",void 0),W(this,"pingpongTimeoutCount",0),W(this,"ortc",void 0),W(this,"joinResponse",void 0),W(this,"multiIpOption",void 0),W(this,"initError",void 0),W(this,"spec",void 0),W(this,"store",void 0),W(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ot.ON_BINARY_DATA,i.data);let c=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===St.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===St.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Wt.UID_BANNED);break;case 15:this.close(Wt.IP_BANNED);break;case 16:this.close(Wt.CHANNEL_BANNED)}if(c._type===St.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case tt.ERR_LICENSE_MISSING:this.close(Wt.LICENSE_MISSING);break;case tt.ERR_LICENSE_EXPIRED:this.close(Wt.LICENSE_EXPIRED);break;case tt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Wt.LICENSE_MINUTES_EXCEEDED);break;case tt.ERR_LICENSE_PERIOD_INVALID:this.close(Wt.LICENSE_PERIOD_INVALID);break;case tt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Wt.LICENSE_MULTIPLE_SDK_SERVICE);break;case tt.ERR_LICENSE_ILLEGAL:this.close(Wt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new yC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Y("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Y("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ir.CONNECTED&&this.reconnect("retry",ws.OFFLINE)})}async request(t,r,i,c){let d=tr(6,""),h={_id:d,_type:t,_message:r},p=this.websocket.connectionID,m=()=>new je((U,k)=>{if(this.connectionState===ir.CONNECTED)return U();let M=()=>{this.off(ot.WS_CLOSED,H),U()},H=()=>{this.off(ot.WS_CONNECTED,M),k(new le(z.WS_ABORT))};this.once(ot.WS_CONNECTED,M),this.once(ot.WS_CLOSED,H),t!==it.PUBLISH&&t!==it.PUBLISH_DATASTREAM&&t!==it.SUBSCRIBE&&t!==it.SUBSCRIBE_DATASTREAM&&t!==it.UNSUBSCRIBE&&t!==it.UNSUBSCRIBE_DATASTREAM&&t!==it.UNPUBLISH&&t!==it.UNPUBLISH_DATASTREAM&&t!==it.CONTROL&&t!==it.RESTART_ICE||this.once(ot.DISCONNECT_P2P,()=>{k(new le(z.DISCONNECT_P2P))}),t!==it.PUBLISH&&t!==it.RESTART_ICE||this.once(ot.ABORT_P2P_EXECUTION,()=>{k(new le(z.DISCONNECT_P2P))})});if(this.connectionState!==ir.CONNECTING&&this.connectionState!==ir.RECONNECTING||t===it.JOIN||t===it.REJOIN||await m(),this.websocket.sendMessage(h,!0),c)return;let _=new je((U,k)=>{let M=!1,H=(X,se)=>{M=!0,U({isSuccess:X==="success",message:se||{}}),this.off(ot.WS_CLOSED,K),this.off(ot.WS_RECONNECTING,K),this.emit(ot.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(d),H);let K=()=>{k(new le(z.WS_ABORT,"type: ".concat(t))),this.off(ot.WS_CLOSED,K),this.off(ot.WS_RECONNECTING,K),this.off("res-@".concat(d),H)};this.once(ot.WS_CLOSED,K),this.once(ot.WS_RECONNECTING,K),hs(Y("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||M||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ot.REQUEST_TIMEOUT,t,r))})}),E=null;try{E=await _}catch(U){if(this.connectionState===ir.CLOSED||t===it.LEAVE)throw new le(z.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?U.throw():t===it.JOIN||t===it.REJOIN?null:(await m(),await this.request(t,r))}if(E.isSuccess)return E.message;let x=Number(E.message.error_code||E.message.code),b=Yf(x),C=new le(z.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(E.message.error_str),{code:x,data:E.message,desc:b.desc});return b.action==="success"?E.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(x,", message: ").concat(b.desc,", action: ").concat(b.action)),x===tt.ERR_TOO_MANY_BROADCASTERS?((t===it.JOIN||t===it.REJOIN)&&(this.initError=C,this.close()),C.throw()):b.action==="failed"?C.throw():b.action==="quit"?(this.initError=C,this.close(),C.throw()):(x===tt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ws.MULTI_IP)):this.reconnect(b.action,ws.SERVER_ERROR),t===it.JOIN||t===it.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new je(i=>{let c=d=>{(!r||r(d))&&(this.off(t,c),i(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Kf.WRTC_STATS,r)}upload(t,r){let i={_type:t,_message:r};try{this.websocket.sendMessage(i)}catch{let c=Y("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ir.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},Y("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let i={_type:t,_message:r};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new je((r,i)=>{this.once(ot.WS_CONNECTED,()=>r(this.joinResponse)),this.once(ot.WS_CLOSED,c=>i(this.initError||new le(z.WS_ABORT,c))),this.connectionState=ir.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Wt.LEAVE,this.connectionState=ir.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ot.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await Ss(this,ot.REQUEST_JOIN_INFO);this.store.joinReq();let r=await this.request(it.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!r)return this.emit(ot.REPORT_JOIN_GATEWAY,av.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(ot.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ir.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new le(z.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=Mf(this,ot.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let r=await this.request(it.REJOIN,t);return!!r&&(this.connectionState=ir.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(i=>{this.emit(St.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(St.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(St.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(St.MUTE_AUDIO,{uid:i.uid}):this.emit(St.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(St.MUTE_VIDEO,{uid:i.uid}):this.emit(St.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(St.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(St.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(St.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(St.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(St.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){if(!this.ortc)return!1;let r={downgrade_codec:t,ortc:this.ortc};return!!await this.request(it.DOWNGRADE_CODEC,r)}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);let r=Yf(t.code);if(t.code===28&&"detail"in t&&(N.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ot.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Wt.UID_BANNED),void this.close()):void this.reconnect(r.action,ws.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=Y("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>Y("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ws.TIMEOUT):this.request(it.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-r;this.rttRolling.add(i),Y("REPORT_STATS")&&this.send(it.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(Kf.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(pt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ot.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(pt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pt.CLOSED,()=>{this.connectionState=ir.CLOSED}),this.websocket.on(pt.FAILED,()=>{this._disconnectedReason=Wt.NETWORK_ERROR,this.connectionState=ir.CLOSED}),this.websocket.on(pt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ir.CONNECTED?this.connectionState=ir.RECONNECTING:this.connectionState=ir.CONNECTING}),this.websocket.on(pt.WILL_RECONNECT,(t,r,i)=>{let c=Mf(this,ot.IS_P2P_DISCONNECTED),d=c||t!=="retry";c&&t==="retry"&&(N.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=av.P2P_DISCONNECTED),d&&(N.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ot.REPORT_JOIN_GATEWAY,r||av.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ot.DISCONNECT_P2P)),i(t)}),this.websocket.on(pt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{N.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ws.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ot.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof le){if(t.code===z.UNEXPECTED_RESPONSE&&t.data.code===tt.ERR_NO_AUTHORIZED)return this.initError=new le(z.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Wt.TOKEN_EXPIRE);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ws.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(pt.REQUEST_NEW_URLS,(t,r)=>{Ss(this,ot.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(uU.PRE_CONNECT_PC,()=>{this.emit(ot.PRE_CONNECT_PC)})}}let wae=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Fr=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function mU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function cv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mU(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Hc(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Y("TURN_DOMAIN")):(N.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function lv(e){try{let t=Y("GATEWAY_DOMAINS").concat(Y("TURN_DOMAIN")).find(r=>Ae(e).call(e,r));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return N.debug("serverUrlToIp error, fallback to url",e),e}}function xC(e,t){e.addresses||(e.addresses=[]);let r=function(p,m){if(Y("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return p.map(x=>{let{ip:b,port:C}=x;return{address:"".concat(b,":").concat(C)}});let _=Y("GATEWAY_DOMAINS"),E=_[1]&&Ae(m).call(m,_[1])?1:0;return p.map(x=>{let{domain_prefix:b,port:C,ip:U}=x;if(b)return{address:"".concat(b,".").concat(_[E++%_.length],":").concat(C)};let k=/^[\.\:\d]+$/.test(U),M=k?"".concat(U.replace(/[^\d]/g,"-"),".").concat(_[E++%_.length],":").concat(C):"".concat(U,":").concat(C);return k||N.debug("Cannot recognized as ip address: ".concat(U,", use as host3")),{ip:U,port:C,address:M}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){let p=i.split(";");for(let m=0;m<p.length;m++){var c;let _=Ks(c=p[m]).call(c);r[m]&&_&&(r[m].ip6=_)}}let d=e.detail&&e.detail.candidate,h;if(d){let[p,m]=d.split(":");p&&m&&(h={port:Number(m),ip:p,address:"".concat(p,":").concat(m)})}return{gatewayAddrs:r,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Vn(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function gU(e){let t=e._encoderConfig;if(!t)return{};let r={resolution:t.width&&t.height?"".concat(Vn(t.width),"x").concat(Vn(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function _U(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Xf(e,t){let r,i,c;switch(t){case Fr.CHOOSE_SERVER:i=4096,c="choose server";break;case Fr.CLOUD_PROXY:i=1048576,c="proxy";break;case Fr.CLOUD_PROXY_5:i=4194304,c="proxy5";break;case Fr.CLOUD_PROXY_FALLBACK:i=4194310,c="proxy fallback";break;default:throw new le(z.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(d=>{d.buffer&&d.buffer.flag===i&&(r={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>cv(cv({},h),{},{ticket:d.buffer.cert})),server_ts:e.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:cv(cv({},d.buffer.detail),e.detail),flag:d.buffer.flag,opid:e.opid,cert:d.buffer.cert})}),!r)throw new le(z.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function EU(e,t){return await je.all(e.addresses.map(async r=>({address:Hc(r.ip),tcpport:r.port,udpport:r.port,username:t&&Y("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Cs.username,password:t&&Y("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await b0(t.toString()):Cs.password})))}function bC(e,t){let r=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||r.height,c=t.videoWidth||r.width;return i&&c?Math.max(Math.min(i,c)/Math.min(Vn(e.height),Vn(e.width)),1):(N.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function zc(e){let{candidateType:t,relayProtocol:r,type:i,address:c,port:d,protocol:h}=e,p={candidateType:t,relayProtocol:r,protocol:h};if(i!=="local-candidate"){let m=c.split(".");m.length>=4&&(m[1]="*",m[2]="*"),p.address=m.join("."),p.port=d}return p}function _d(e){let t=e.split(":"),r=e.split(/[-.]/),i=Ae(e).call(e,"-")?"-":".",c=e;return t.length>1?r.length>1?(r[1]="**",c=r[0]+i+"**:"+t[t.length-1]):c=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:r.length>1&&(c=r[0]+i+"**"),c}function dv(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Y("SVC_MODE");if(Y("ENABLE_SVC"))return function(t){return t in FE}(e)?e:FE.L1T3}let vU={[Fe.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Fe.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function uv(e,t,r){t.forEach(i=>{var c;let d=vU[e].find(p=>{var m;let{key:_}=p;return Ae(m=i.extensionName).call(m,_)});if(!d)return;let h=r.find(p=>{let{extensionName:m}=p;return Ae(m).call(m,d.key)});h&&Ae(c=h.extensionName).call(c,"gdpr_forbidden")&&(i.extensionName=h.extensionName)})}function yh(e,t){t.forEach(r=>{var i;let c=vU[e].find(d=>{var h;let{key:p}=d;return Ae(h=r.extensionName).call(h,p)});Ae(i=r.extensionName).call(i,"gdpr_forbidden")&&c&&(r.extensionName=c.extensionName)})}function yU(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ae(e).call(e,"abs-send-time")}function hv(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ae(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function xU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function bU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xU(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Jf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m,unsupportedVideoUplinkCodec:_,unsupportedVideoDownlinkCodec:E}=t,{useXR:x}=r,b=[],C=[],U=[],k=[],M=!1,H=!1;if(yn(e).mediaDescriptions.forEach(X=>{i&&i!==X.attributes.direction||(X.media.mediaType!=="video"||M||(C=X.attributes.payloads,k=X.attributes.extmaps,M=!0),X.media.mediaType!=="audio"||H||(b=X.attributes.payloads,U=X.attributes.extmaps,H=!0))}),!k||C.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!U||b.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(C.forEach(X=>{var se;(se=X.rtpMap)!==null&&se!==void 0&&se.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),x&&X.rtcpFeedbacks.push({type:"rrtr"})}),b.forEach(X=>{var se;(se=X.rtpMap)!==null&&se!==void 0&&se.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),x&&X.rtcpFeedbacks.push({type:"rrtr"})}),c&&(b=b.filter(X=>{var se;return((se=X.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())!=="rtx"}),C=C.filter(X=>{var se;return((se=X.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())!=="rtx"})),d){let X=C.filter(Z=>{var ce;return/(red)|(ulpfec)|(flexfec)/i.test(((ce=Z.rtpMap)===null||ce===void 0?void 0:ce.encodingName)||"")}),se=qc(X,C).map(Z=>Z.payloadType),te=[...X.map(Z=>Z.payloadType),...se];C=C.filter(Z=>!Ae(te).call(te,Z.payloadType))}if(h&&(b=b.filter(X=>{var se;return!/(red)|(ulpfec)|(flexfec)/i.test(((se=X.rtpMap)===null||se===void 0?void 0:se.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(b=b.filter(X=>{var se;return Ae(p).call(p,((se=X.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){let X=C.filter(se=>{var te;return Ae(m).call(m,((te=se.rtpMap)===null||te===void 0?void 0:te.encodingName.toLowerCase())||"")});C=X.concat(c?[]:qc(X,C))}let K=Y("UNSUPPORTED_VIDEO_CODEC");if(K&&K.length>0){let X=C.filter(Z=>Z.rtpMap&&Ae(K).call(K,Z.rtpMap.encodingName.toLowerCase())),se=qc(X,C),te=X.concat(se).map(Z=>Z.payloadType);C=C.filter(Z=>!Ae(te).call(te,Z.payloadType)),N.debug("unsupportedVideoCodec: ".concat(K,", toBeRemoved: ").concat(te))}if(_&&_.length>0&&i==="sendonly"){let X=C.filter(Z=>Z.rtpMap&&Ae(_).call(_,Z.rtpMap.encodingName.toLowerCase())),se=qc(X,C),te=X.concat(se).map(Z=>Z.payloadType);C=C.filter(Z=>!Ae(te).call(te,Z.payloadType)),N.debug("unsupportedVideoUplinkCodec: ".concat(_,", toBeRemoved: ").concat(te))}if(E&&E.length>0&&i==="recvonly"){let X=C.filter(Z=>Z.rtpMap&&Ae(E).call(E,Z.rtpMap.encodingName.toLowerCase())),se=qc(X,C),te=X.concat(se).map(Z=>Z.payloadType);C=C.filter(Z=>!Ae(te).call(te,Z.payloadType)),N.debug("unsupportedVideoDownlinkCodec: ".concat(E,", toBeRemoved: ").concat(te))}return{audioCodecs:b,videoCodecs:C,audioExtensions:U,videoExtensions:k}}function Kc(e){let t=yn(e),r,i;for(let c of t.mediaDescriptions){if(!r){let d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:d,icePwd:h}}if(!i){let d=c.attributes.fingerprints;d.length>0&&(i={fingerprints:d})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:i}}function wU(e,t){let r=[],i=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var p;let m=(p=i.find(_=>_.ssrcIds[0]===h))===null||p===void 0?void 0:p.ssrcIds[1];r.push({ssrcId:h,rtx:t?m:void 0})});else if(i.length>0){let h=i[0].ssrcIds[0],p=i[0].ssrcIds[1];r.push({ssrcId:h,rtx:t?p:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:d[0].ssrcId})}return r}function SU(e,t,r){let{cname:i}=e,c=[];t&&(c=CU(t)),c.length===0&&(c=e.iceParameters.candidates.map(E=>({foundation:E.foundation,componentId:"1",transport:E.protocol,priority:E.priority.toString(),connectionAddress:E.ip,port:E.port.toString(),type:E.type,extension:{}})),N.debug("Using candidates from gateway."));let d={fingerprints:e.dtlsParameters.fingerprints.map(E=>({hashFunction:E.algorithm,fingerprint:E.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},p;switch(e.dtlsParameters.role){case"server":p="passive";break;case"client":p="active";break;case"auto":p="actpass"}let m=fv(e.rtpCapabilities),_=[];return Array.isArray(r)&&r.length>0&&r.forEach(E=>{_.push({kind:Fe.VIDEO,ssrcMsg:[{ssrcId:E.v,rtx:E.v_rtx}],mslabel:"".concat(E.v,"_").concat(E.a)},{kind:Fe.AUDIO,ssrcMsg:[{ssrcId:E.a}],mslabel:"".concat(E.v,"_").concat(E.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:m,setup:p,cname:i,preSSRCs:_}}function CU(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],N.debug("Using remote candidate from AP ".concat(_d(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),N.debug("Using IPV6 remote candidate from AP ".concat(_d(e.ip6),":").concat(e.port)))),t}function Qf(e,t,r){let i=[],c=[];return e.forEach(d=>{let{ssrcId:h,rtx:p}=d,m=tr(8,"track-"),_={ssrcId:h,attributes:bU({label:m,mslabel:r=r||tr(10,""),msid:"".concat(r," ").concat(m)},t&&{cname:t})};if(i.push(_),p!==void 0){let E={ssrcId:p,attributes:bU({label:m,mslabel:r,msid:"".concat(r," ").concat(m)},t&&{cname:t})};i.push(E),c.push({semantic:"FID",ssrcIds:[h,p]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:i,ssrcGroups:c}}function xh(e,t){t instanceof Ar&&e.attributes.payloads.forEach(r=>{var i;let c=(i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),c==="opus"&&typeof Y("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=Y("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";let d=t._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!Sr()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),t instanceof Hf&&c==="opus"&&t._config.DTX&&(r.fmtp.parameters.usedtx="1"))})}function wC(e){let t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function SC(e,t){var r;if(!(t instanceof ar&&t._encoderConfig&&t._hints.indexOf(Zt.SCREEN_TRACK)===-1))return;let i=t._encoderConfig;Dt().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(c=>{var d,h;Ae(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Dt().supportMinBitrate&&!Ae(r=t._hints).call(r,Zt.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(c=>{var d,h;Ae(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(Y("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function TU(e){if(e.media.mediaType!=="video")return;let t=Rt();if(t.name!==Lt.SAFARI&&t.os!==ts.IOS)return;let r=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function pv(e,t,r){if(!t)return;let i,c;if(e.media.mediaType==="video"?(i=r.videoExtensions,c=r.videoCodecs):(i=r.audioExtensions,c=r.audioCodecs),t.twcc===!0){let d=i.find(h=>hv(h.extensionName));if(d){let h=d.extensionName;e.attributes.extmaps.find(p=>hv(p.extensionName))||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(p,m){return m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(x=>x.type==="transport-cc")))}(c,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>m.type==="transport-cc")||p.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let d=e.attributes.extmaps.findIndex(h=>hv(h.extensionName));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach(h=>{let p=h.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}if(t.remb===!0){let d=i.find(h=>yU(h.extensionName));if(d){let h=d.extensionName;e.attributes.extmaps.find(p=>p.extensionName===h)||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(p,m){return m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(x=>x.type==="goog-remb")))}(c,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>m.type==="goog-remb")||p.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let d=e.attributes.extmaps.findIndex(h=>yU(h.extensionName));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach(h=>{let p=h.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}}function RU(e,t,r){if(Sr()||e.media.mediaType!=="video"||!(t instanceof ar)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!Y("SIMULCAST")||r==="vp9"&&Y("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let i=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],d=e.attributes.ssrcGroups.find(p=>p.semantic==="FID"&&p.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let p=1;p<i;p++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+p,attributes:vr(c.attributes)}),h.ssrcIds.push(c.ssrcId+p),d&&(e.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:vr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+p,d.ssrcIds[1]+p]}));e.attributes.ssrcGroups.unshift(h)}async function NU(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});let i=(await r.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0,E=Jf(_,p,m,"sendonly"),x=Jf(_,p,m,"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ia(E,x,"videoExtensions",b,C,U),ia(E,x,"videoCodecs",b,C,U),ia(E,x,"audioExtensions",b,C,U),ia(E,x,"audioCodecs",b,C,U),Y("RAISE_H264_BASELINE_PRIORITY")){let k=[],M=[];if(U.videoCodecs.forEach((H,K)=>{var X;if(((X=H.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"){var se,te;let Z=U.videoCodecs[K+1],ce=Z&&PU(H,Z),fe=(se=H.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"],xe=(te=H.fmtp)===null||te===void 0?void 0:te.parameters["packetization-mode"];!fe||fe!==Y("FIRST_H264_PROFILE_LEVEL_ID")||Y("FIRST_PACKETIZATION_MODE")&&xe!==Y("FIRST_PACKETIZATION_MODE")?ce?M.push([H,Z]):M.push([H]):ce?k.push([H,Z]):k.push([H])}}),k.length>0&&M.length>0){N.debug("raising H264 baseline profile priority"),U.videoCodecs.forEach((K,X)=>{var se;if(((se=K.rtpMap)===null||se===void 0?void 0:se.encodingName.toLocaleLowerCase())==="h264"){let te=PU(K,U.videoCodecs[X+1]),Z=k.shift()||M.shift()||[];Z.length>0&&(te?U.videoCodecs.splice(X,2,...Z):U.videoCodecs.splice(X,1,...Z))}});let H=C.videoCodecs.filter(K=>{var X,se;return((X=K.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((se=K.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"])!==Y("FIRST_H264_PROFILE_LEVEL_ID")});if(H.length>0){let K=qc(H,C.videoCodecs).map(se=>se.payloadType),X=[...H.map(se=>se.payloadType),...K];C.videoCodecs=C.videoCodecs.filter(se=>!Ae(X).call(X,se.payloadType))}Y("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(K=>{var X,se;return!(((X=K.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((se=K.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"])!==Y("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:b,recv:C,sendrecv:U}}return{send:b,recv:C,sendrecv:U}}(e,t,i);try{r.close()}catch{}return{send:c,recv:d,sendrecv:h}}function AU(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Jf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ia(e,t,"videoExtensions",r,i,c),ia(e,t,"videoCodecs",r,i,c),ia(e,t,"audioExtensions",r,i,c),ia(e,t,"audioCodecs",r,i,c),Y("RAISE_H264_BASELINE_PRIORITY")){let d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){let h=c.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){N.debug("raising H264 baseline profile priority");let p=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,p)}h!==-1&&(i.videoCodecs=i.videoCodecs.filter(p=>!(p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:i,sendrecv:c}}function ia(e,t,r,i,c,d){if(r==="videoExtensions"||r==="audioExtensions"){let h=[];return e[r].forEach(p=>{t[r].some((m,_)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(_),!0})?d[r].push(p):i[r].push(p)}),void t[r].forEach((p,m)=>{h.indexOf(m)===-1&&c[r].push(p)})}if(r==="videoCodecs"||r==="audioCodecs"){let h=[];return e[r].forEach(p=>{t[r].some((m,_)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(_),!0})?d[r].push(p):i[r].push(p)}),void t[r].forEach((p,m)=>{h.indexOf(m)===-1&&c[r].push(p)})}}function fv(e){let{send:t,recv:r,sendrecv:i}=e;if(!i){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let c,d;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...i.audioCodecs],c.videoCodecs=[...t.videoCodecs,...i.videoCodecs],c.audioExtensions=[...t.audioExtensions,...i.audioExtensions],c.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):c=i,r?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...r.audioCodecs,...i.audioCodecs],d.videoCodecs=[...r.videoCodecs,...i.videoCodecs],d.audioExtensions=[...r.audioExtensions,...i.audioExtensions],d.videoExtensions=[...r.videoExtensions,...i.videoExtensions]):d=i,{send:c,recv:d}}function bh(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Zf(e,t,r,i){let c=[];if(e===Fe.VIDEO){if(Y("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(c=t.videoCodecs.filter(d=>{var h;return Ae(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,i)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===Y("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[],h=[],p=[],m=[];if(r.videoCodecs.forEach(_=>{let E=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"";Ae(E).call(E,i)?d.push(_):Ae(E).call(E,"vp9")?h.push(_):Ae(E).call(E,"vp8")?p.push(_):Ae(E).call(E,"h264")&&m.push(_)}),d.length===0){let _="";h.length!==0?(d=h,_="vp9"):p.length!==0?(d=p,_="vp8"):m.length!==0&&(d=m,_="h264"),N.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(_))}d.length!==0&&(c=t.videoCodecs.filter(_=>d.some(E=>E.payloadType===_.payloadType)))}if(c.length===0&&(N.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),Y("USE_PUB_RTX")||Y("USE_SUB_RTX")){let d=qc(c,t.videoCodecs);c=[...c,...d]}}else{c=t.audioCodecs.filter(h=>{var p;return Ae(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,i)});let d=t.audioCodecs.filter(h=>{var p;return Ae(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"red")});c.length===0&&(N.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter(h=>{var p;return Ae(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"opus")})),Y("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function qc(e,t){let r=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&Ae(r).call(r,i.fmtp&&i.fmtp.parameters.apt))}async function Yc(e,t,r){let i=t.toString(),c=OU(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});let d=await e.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=IU(h,r||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function IU(e,t,r){let i=yn(e),{useXR:c}=t;return i.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(r)&&!Ae(r).call(r,d.attributes.mid)||(d.media.mediaType==="audio"&&bh(d),c&&Ae(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(p=>{p.rtcpFeedbacks.findIndex(m=>m.type==="rrtr")===-1&&p.rtcpFeedbacks.push({type:"rrtr"})})))}),Vc(i)}function OU(e,t,r,i){if(Y("SDP_LOGGING"))return N.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?c=>{OU(c,"answer",r==="local"?"remote":"local",i)}:void 0}function DU(e){let t=Y("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(r=>Ae(e).call(e,r))}function PU(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function kU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function ui(e,t){return typeof Y(e)===t?Y(e):void 0}function Sae(){try{let e=Y("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?kU(Object(i),!0).forEach(function(c){W(t,c,i[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):kU(Object(i)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(i,c))})}return t}({},e)}catch(e){return N.debug("handle gateway attributes failed: ",e),{}}}let jU={};function $c(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&N.debug("install service ".concat(e.name)),jU[e.name]=e}function ic(e){let t=jU[e];if(!t)throw new he(z.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function LU(e,t){return ic("DataStream").create(e,t)}function mv(){return ic("InterceptFrame").create()}function MU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Ws(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MU(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let CC=new Map;class Cae extends br{get state(){return this._state}set state(t){if(t===this._state)return;let r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(is.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(is.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){N.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var i,c,d;super(),W(this,"store",void 0),W(this,"joinInfo",void 0),W(this,"key",void 0),W(this,"ntpOffset",0),W(this,"signal",void 0),W(this,"role",void 0),W(this,"isPreallocation",void 0),W(this,"isPreSub",void 0),W(this,"inChannelInfo",{joinAt:null,duration:0}),W(this,"spec",void 0),W(this,"_state","DISCONNECTED"),W(this,"_statsCollector",void 0),W(this,"_disconnectedReason",void 0),W(this,"isSignalRecover",!1),W(this,"hasChangeBGPAddress",!1),W(this,"trafficStatsInterval",void 0),W(this,"networkQualityInterval",void 0),W(this,"_joinGatewayStartTime",0),W(this,"_signalTimeout",!1),W(this,"_clientRoleOptions",void 0),W(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(i={spec:Ws(Ws({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(c=(d=ic("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,i)):new bae(Ws(Ws({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,i){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let c=Date.now(),d=CC.get(t.cname);if(d||(d=new Map,CC.set(t.cname,d)),this._isProactiveJoin=!0,d.has(t.uid)){let _=new le(z.UID_CONFLICT);throw ze.joinGateway(t.sid,{lts:c,succ:!1,ec:_.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),_}d.set(t.uid,!0),this.joinInfo=t,this.key=r;let h=0;this.joinGatewayStartTime=c;let p=t.proxyServer;try{N.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));let _=t.gatewayAddrs.map(E=>{let{address:x}=E,[b,C]=x.split(":"),U={host:b,port:C};return t.proxyServer&&(U.proxy=t.proxyServer),U});h=(await this.signal.init(_)).uid,N.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var m;throw N.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),ze.joinGateway(t.sid,{lts:c,succ:!1,ec:((m=_.data)===null||m===void 0?void 0:m.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!p,signalChannel:"0",preload:t.preload}),d.delete(t.uid),this.signal.close(),_}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),N.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{N.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(is.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(is.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(is.NETWORK_QUALITY,{uplinkNetworkQuality:_U(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:_U(this._statsCollector.trafficStats.B_dnq)}):this.emit(is.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==Wt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==ir.CONNECTED||await function(i,c){return c===1/0?i:je.race([i,Xne(c)])}(this.signal.request(it.LEAVE,void 0,!0),3e3)}catch(i){N.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(r),r!==Wt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let c={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:Y("PUB_EXTEND"),twcc:!!Y("PUBLISH_TWCC"),rtx:!!Y("USE_PUB_RTX")};try{return(await this.signal.request(it.PUBLISH,c,!0))._message}catch(d){if(i&&d.data&&d.data.code===tt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw d}}async publishDataChannel(t,r,i){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let d={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(c=r.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(it.PUBLISH_DATASTREAM,d,!0)}catch(h){if(i&&h.data&&h.data.code===tt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw h}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(it.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(i){N.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await je.all(t.map(r=>this.signal.request(it.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){N.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let c={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Y("SUBSCRIBE_TWCC"),rtx:!!Y("USE_SUB_RTX")||void 0,extend:Y("SUB_EXTEND"),svc:Array.isArray(Y("SVC"))&&Y("SVC").length!==0?Y("SVC"):void 0};try{return await this.signal.request(it.PRE_SUBSCRIBE,c,!0)}catch(d){if(i&&d.data&&d.data.code===tt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(t,r,!1);throw d}}async subscribe(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let c={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Y("SUBSCRIBE_TWCC"),rtx:!!Y("USE_SUB_RTX"),extend:Y("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(Y("SVC"))&&Y("SVC").length!==0?Y("SVC"):void 0};try{return(await this.signal.request(it.SUBSCRIBE,c,!0))._message}catch(d){if(i&&d.data&&d.data.code===tt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw d}}async subscribeDataChannel(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let c={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(it.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(i&&d.data&&d.data.code===tt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw d}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!Y("USE_SUB_RTX"),twcc:!!Y("SUBSCRIBE_TWCC"),svc:Array.isArray(Y("SVC"))&&Y("SVC").length!==0?Y("SVC"):void 0};try{return await this.signal.request(it.SUBSCRIBE_STREAMS,i,!0)}catch(c){if(r&&c.data&&c.data.code===tt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){let r=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let c=i.frameRate,d=i.width,h=i.height,p=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(p=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(p=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(p=!1)),p?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(r)return this.signal.request(it.SET_VIDEO_PROFILE,r);N.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(it.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(i){N.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await je.all(t.map(i=>this.signal.request(it.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:r},!0)))}catch(i){N.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(it.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){N.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){let{iceParameters:r,dtlsParameters:i,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(it.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(it.GATEWAY_INFO)}async renewToken(t){await this.signal.request(it.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),Y("CLIENT_ROLE_OPTIONS")&&(N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Y("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Y("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),Y("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Y("CLIENT_ROLE_OPTIONS")),N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Y("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;let d=Object.assign({},r);delete d.delay,delete d.level,await this.signal.request(it.SET_CLIENT_ROLE,Ws(Ws({role:t,level:c,delay:i},d),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(it.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(it.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(it.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(it.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(it.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Ws({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(it.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=CC.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=function(r){let i;return i=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Cs.username,password:Cs.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ws(Ws({},Cs),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(it.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{let i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===r.peer_uid);i&&i.B_st!==r.B_st&&kE(()=>{this.emit(is.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var r,i;if(!this.joinInfo||!this.key)throw new le(z.UNEXPECTED_ERROR,"can not generate join message, no join info");let c=Object.assign({},this.joinInfo.apResponse),d=Y("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var h;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(is.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,Ae(mh).call(mh,h)||mh.push(h);let p=V0(this.store),m=!((r=this.isPreallocation)===null||r===void 0||!r.call(this)),_=V2(this.store),E=Sae(),x=Xu(87)||$L()||f0(117),b=(function(){let U=Rt();if(U.name!==Lt.SAFARI||!U.browserVersion)return!1;let k=U.browserVersion.split(".");return Number(k[0])>18||Number(k[0])===18&&Number(k[1])>=4}()||ZL(18,4,!1))&&m0(18,6,!0)&&this.spec.codec==="h264"&&Y("ENABLE_ABSSENDTIME_AS_SENTTS"),C=Ws({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:bi,browser:navigator.userAgent,process_id:Y("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:Y("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:Ws(Ws({enableEncodedTransform:(!!Y("ENABLE_AUDIO_METADATA")||!!Y("ENABLE_AUDIO_PTS"))&&x||!!Y("ENABLE_AUDIO_TOPN")&&h0(Lt.CHROME,87,116)||void 0,enableAudioMetadata:!!Y("ENABLE_AUDIO_METADATA")&&x,enableAudioPts:!!Y("ENABLE_AUDIO_PTS")&&x,topnSmoothLevel:Y("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Y("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Y("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Y("TOPN_AUDIO_GAIN"),enablePublishedUserList:Y("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Y("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:ui("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:ui("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:ui("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Y("USE_PUB_RTX")===!0||Y("USE_SUB_RTX")===!0||void 0,disableFEC:Y("DISABLE_FEC"),enableNTPReport:!!Y("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:_,enableFulllinkAvSync:!!Y("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ui("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Y("FORCE_ENABLE_AUT_CC")||!BE()&&(!!Y("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Y("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ui("USE_XR","boolean"),enableLossbasedBwe:ui("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Y("FORCE_ENABLE_AUT_CC")||!BE()&&(!!Y("ENABLE_AUT_CC")||void 0),enableCCFallback:ui("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:m,preSubNum:p?ui("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ui("PUBLISH_TWCC","boolean"),enableSubTWCC:ui("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ui("USE_PUB_RTX","boolean"),enableSubRTX:ui("USE_SUB_RTX","boolean"),enableSubSVC:Y("ENABLE_SVC")?Y("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Y("SVC"))&&Y("SVC").length!==0?Y("SVC"):void 0,enableSvcExtended:Y("ENABLE_SVC")&&Array.isArray(Y("SVC_EXTENDED"))&&Y("SVC_EXTENDED").length!==0?Y("SVC_EXTENDED"):void 0},E),{},{audioDuplicate:ui("ENABLE_AUDIO_RED","boolean")?(i=ui("AUDIO_DUPLICATE_NUM","number"))!==null&&i!==void 0?i:2:void 0,senttsUsesAbsSendTime:!!b||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(C.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(C.aes_mode=this.joinInfo.aesmode,Y("ENCRYPT_AES")?(C.aes_secret=this.joinInfo.aespassword,C.aes_encrypt=!0):C.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(C.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(C.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(C.default_video_stream=this.joinInfo.defaultVideoStream),C}getRejoinMessage(){if(!this.joinInfo)throw new le(z.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ot.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ot.WS_RECONNECTING,t=>{this.joinInfo&&ze.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||ws.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ze.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ot.WS_CLOSED,t=>{let r;switch(t){case Wt.LEAVE:r=ws.LEAVE;break;case Wt.UID_BANNED:case Wt.IP_BANNED:case Wt.CHANNEL_BANNED:case Wt.SERVER_ERROR:r=ws.SERVER_ERROR;break;case Wt.FALLBACK:r=ws.FALLBACK;break;case Wt.LICENSE_MISSING:case Wt.LICENSE_EXPIRED:case Wt.LICENSE_MINUTES_EXCEEDED:case Wt.LICENSE_PERIOD_INVALID:case Wt.LICENSE_MULTIPLE_SDK_SERVICE:case Wt.LICENSE_ILLEGAL:case Wt.TOKEN_EXPIRE:r=t;break;default:r=ws.NETWORK_ERROR}N.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+ws.NETWORK_ERROR)),this.joinInfo&&ze.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Wt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==Wt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ot.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=Y("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(N.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(ze.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void N.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));$t("EVENT_REPORT_DOMAIN",t[1]),$t("EVENT_REPORT_BACKUP_DOMAIN",t[1]),$t("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(St.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ot.REQUEST_RECOVER,(t,r,i)=>{if(!this.joinInfo)return i(new le(z.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ss(this,is.REQUEST_NEW_GATEWAY_LIST).then(r).catch(i)}),this.signal.on(ot.REQUEST_JOIN_INFO,async(t,r,i)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let p=vr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(Y("NEW_TURN_MODE")&&p&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var m;let b=p.servers.map(k=>"turnServerURL"in k&&Y("USE_TURN_IP")?Ws(Ws({},k),{},{turnServerURL:lv(k.turnServerURL)}):k),C=(m=p.serversFromGateway)===null||m===void 0?void 0:m.map(k=>Y("USE_TURN_IP")?Ws(Ws({},k),{},{turnServerURL:lv(k.turnServerURL)}):k),U=this.signal.currentURLIndex;b.length>0&&(b=[b[U%b.length]],p.servers=b),Array.isArray(C)&&C.length>0&&(C=[C[0]],p.serversFromGateway=C),N.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(U))}let{iceParameters:_,dtlsParameters:E,rtpCapabilities:x}=await Ss(this,is.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:p,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:_,dtlsParameters:E,rtpCapabilities:x,version:"2"}}))}catch(b){r(b)}}),this.signal.on(ot.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ot.REPORT_JOIN_GATEWAY,(t,r)=>{if(!this.joinInfo)return;let i,c="";var d;t instanceof le?(i=((d=t.data)===null||d===void 0?void 0:d.desc)||t.code,c=t.message):i=t,ze.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:c,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ot.IS_P2P_DISCONNECTED,t=>{t(Mf(this,is.IS_P2P_DISCONNECTED))}),this.signal.on(ot.DISCONNECT_P2P,()=>{this.emit(is.DISCONNECT_P2P)}),this.signal.on(ot.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ot.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ot.JOIN_RESPONSE,t=>{let r=this.getCurrentGatewayAddress();this.emit(is.JOIN_RESPONSE,t,r)}),this.signal.on(ot.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,r;this.updateTurnConfigFromSignal();let c=this.getCurrentGatewayAddress(),d=vr((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(Y("NEW_TURN_MODE")&&d&&((r=this.joinInfo)===null||r===void 0?void 0:r.cloudProxyServer)==="disabled"){var i;let p=d.servers.map(E=>"turnServerURL"in E&&Y("USE_TURN_IP")?Ws(Ws({},E),{},{turnServerURL:lv(E.turnServerURL)}):E),m=(i=d.serversFromGateway)===null||i===void 0?void 0:i.map(E=>Y("USE_TURN_IP")?Ws(Ws({},E),{},{turnServerURL:lv(E.turnServerURL)}):E),_=this.signal.currentURLIndex;p.length>0&&(p=[p[_%p.length]],d.servers=p),Array.isArray(m)&&m.length>0&&(m=[m[0]],d.serversFromGateway=m),N.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(_,",in pre pc"))}let h=Y("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){let p=CU(c);this.emit(is.PRE_CONNECT_PC,{candidates:p,fingerprint:h,turnServer:d})}}}),this.signal.on(ot.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof Y("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Y("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(it.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(it.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(i){throw N.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(it.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(it.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(i){throw N.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){let r={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(it.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,r){let i={action:t.find(c=>c.stream_type===zt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(it.CONTROL,i,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,r){let i={action:t.find(c=>c.stream_type===zt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(it.CONTROL,i,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,r){let i={action:t===Fe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(it.CONTROL,i,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,r){let i={action:t===Fe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(it.CONTROL,i,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(it.RESTART_ICE,r,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||ws.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!Y("GATEWAY_WSS_ADDRESS"))return Y("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(N.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(it.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let gv=0,TC=0;function Ba(e,t,r,i){return new je((c,d)=>{t.timeout=t.timeout||Y("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),gv+=Eo(t.data)):r&&(t.data.size?gv+=t.data.size:t.data instanceof FormData?gv+=m2(t.data):gv+=Eo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,dn.request(t).then(h=>{typeof h.data=="string"?TC+=Eo(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?TC+=h.data.byteLength:TC+=Eo(JSON.stringify(h.data)),i&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{dn.isCancel(h)?d(new le(z.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new le(z.NETWORK_TIMEOUT,h.message)):h.response?d(new le(z.NETWORK_RESPONSE_ERROR,h.response.status)):d(new le(z.NETWORK_ERROR,h.message))})})}(function(){var e;function t(ge){var Ie=0;return function(){return Ie<ge.length?{done:!1,value:ge[Ie++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(ge,Ie,Ve){return ge==Array.prototype||ge==Object.prototype||(ge[Ie]=Ve.value),ge},i,c=function(ge){ge=[typeof globalThis=="object"&&globalThis,ge,typeof window=="object"&&window,typeof self=="object"&&self,typeof l=="object"&&l];for(var Ie=0;Ie<ge.length;++Ie){var Ve=ge[Ie];if(Ve&&Ve.Math==Math)return Ve}throw Error("Cannot find global object")}(this);function d(ge,Ie){if(Ie)e:{var Ve=c;ge=ge.split(".");for(var we=0;we<ge.length-1;we++){var P=ge[we];if(!(P in Ve))break e;Ve=Ve[P]}(Ie=Ie(we=Ve[ge=ge[ge.length-1]]))!=we&&Ie!=null&&r(Ve,ge,{configurable:!0,writable:!0,value:Ie})}}function h(ge){return(ge={next:ge})[Symbol.iterator]=function(){return this},ge}function p(ge){var Ie=typeof Symbol<"u"&&Symbol.iterator&&ge[Symbol.iterator];return Ie?Ie.call(ge):{next:t(ge)}}if(d("Symbol",function(ge){function Ie(P,Q){this.A=P,r(this,"description",{configurable:!0,writable:!0,value:Q})}if(ge)return ge;Ie.prototype.toString=function(){return this.A};var Ve="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",we=0;return function P(Q){if(this instanceof P)throw new TypeError("Symbol is not a constructor");return new Ie(Ve+(Q||"")+"_"+we++,Q)}}),d("Symbol.iterator",function(ge){if(ge)return ge;ge=Symbol("Symbol.iterator");for(var Ie="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ve=0;Ve<Ie.length;Ve++){var we=c[Ie[Ve]];typeof we=="function"&&typeof we.prototype[ge]!="function"&&r(we.prototype,ge,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return ge}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch{}m=!1}i=m?function(ge,Ie){if(ge.__proto__=Ie,ge.__proto__!==Ie)throw new TypeError(ge+" is not extensible");return ge}:null}var E=i;function x(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(ge){if(ge.m)throw new TypeError("Generator is already running");ge.m=!0}function C(ge,Ie){return ge.h=3,{value:Ie}}function U(ge){this.g=new x,this.G=ge}function k(ge,Ie,Ve,we){try{var P=Ie.call(ge.g.j,Ve);if(!(P instanceof Object))throw new TypeError("Iterator result "+P+" is not an object");if(!P.done)return ge.g.m=!1,P;var Q=P.value}catch(re){return ge.g.j=null,ge.g.s(re),M(ge)}return ge.g.j=null,we.call(ge.g,Q),M(ge)}function M(ge){for(;ge.g.h;)try{var Ie=ge.G(ge.g);if(Ie)return ge.g.m=!1,{value:Ie.value,done:!1}}catch(Ve){ge.g.v=void 0,ge.g.s(Ve)}if(ge.g.m=!1,ge.g.l){if(Ie=ge.g.l,ge.g.l=null,Ie.F)throw Ie.D;return{value:Ie.return,done:!0}}return{value:void 0,done:!0}}function H(ge){this.next=function(Ie){return ge.o(Ie)},this.throw=function(Ie){return ge.s(Ie)},this.return=function(Ie){return function(Ve,we){b(Ve.g);var P=Ve.g.j;return P?k(Ve,"return"in P?P.return:function(Q){return{value:Q,done:!0}},we,Ve.g.return):(Ve.g.return(we),M(Ve))}(ge,Ie)},this[Symbol.iterator]=function(){return this}}function K(ge,Ie){return Ie=new H(new U(Ie)),E&&ge.prototype&&E(Ie,ge.prototype),Ie}if(x.prototype.o=function(ge){this.v=ge},x.prototype.s=function(ge){this.l={D:ge,F:!0},this.h=this.C||this.u},x.prototype.return=function(ge){this.l={return:ge},this.h=this.u},U.prototype.o=function(ge){return b(this.g),this.g.j?k(this,this.g.j.next,ge,this.g.o):(this.g.o(ge),M(this))},U.prototype.s=function(ge){return b(this.g),this.g.j?k(this,this.g.j.throw,ge,this.g.o):(this.g.s(ge),M(this))},d("Array.prototype.entries",function(ge){return ge||function(){return function(Ie,Ve){Ie instanceof String&&(Ie+="");var we=0,P=!1,Q={next:function(){if(!P&&we<Ie.length){var re=we++;return{value:Ve(re,Ie[re]),done:!1}}return P=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q}(this,function(Ie,Ve){return[Ie,Ve]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var X=function(ge,Ie){for(var Ve=0;Ve<ge.length;Ve++)Ie(ge[Ve])},se=function(ge){return ge.replace(/\r?\n|\r/g,`\r
`)},te=function(ge,Ie,Ve){return Ie instanceof Blob?(Ve=Ve!==void 0?Ve+"":typeof Ie.name=="string"?Ie.name:"blob",Ie.name===Ve&&Object.prototype.toString.call(Ie)!=="[object Blob]"||(Ie=new File([Ie],Ve)),[String(ge),Ie]):[String(ge),String(Ie)]},Z=function(ge,Ie){if(ge.length<Ie)throw new TypeError(Ie+" argument required, but only "+ge.length+" present.")},ce=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,fe=ce.FormData,xe=ce.XMLHttpRequest&&ce.XMLHttpRequest.prototype.send,Te=ce.Request&&ce.fetch,_t=ce.navigator&&ce.navigator.sendBeacon,vt=ce.Element&&ce.Element.prototype,at=ce.Symbol&&Symbol.toStringTag;at&&(Blob.prototype[at]||(Blob.prototype[at]="Blob"),"File"in ce&&!File.prototype[at]&&(File.prototype[at]="File"));try{new File([],"")}catch{ce.File=function(ge,Ie,Ve){return ge=new Blob(ge,Ve||{}),Object.defineProperties(ge,{name:{value:Ie},lastModified:{value:+(Ve&&Ve.lastModified!==void 0?new Date(Ve.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),at&&Object.defineProperty(ge,at,{value:"File"}),ge}}var Vt=function(ge){return ge.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Mt=function(ge){this.i=[];var Ie=this;ge&&X(ge.elements,function(Ve){if(Ve.name&&!Ve.disabled&&Ve.type!=="submit"&&Ve.type!=="button"&&!Ve.matches("form fieldset[disabled] *"))if(Ve.type==="file"){var we=Ve.files&&Ve.files.length?Ve.files:[new File([],"",{type:"application/octet-stream"})];X(we,function(P){Ie.append(Ve.name,P)})}else Ve.type==="select-multiple"||Ve.type==="select-one"?X(Ve.options,function(P){!P.disabled&&P.selected&&Ie.append(Ve.name,P.value)}):Ve.type==="checkbox"||Ve.type==="radio"?Ve.checked&&Ie.append(Ve.name,Ve.value):(we=Ve.type==="textarea"?se(Ve.value):Ve.value,Ie.append(Ve.name,we))})};if((e=Mt.prototype).append=function(ge,Ie,Ve){Z(arguments,2),this.i.push(te(ge,Ie,Ve))},e.delete=function(ge){Z(arguments,1);var Ie=[];ge=String(ge),X(this.i,function(Ve){Ve[0]!==ge&&Ie.push(Ve)}),this.i=Ie},e.entries=function ge(){var Ie,Ve=this;return K(ge,function(we){if(we.h==1&&(Ie=0),we.h!=3)return Ie<Ve.i.length?we=C(we,Ve.i[Ie]):(we.h=0,we=void 0),we;Ie++,we.h=2})},e.forEach=function(ge,Ie){Z(arguments,1);for(var Ve=p(this),we=Ve.next();!we.done;we=Ve.next()){var P=p(we.value);we=P.next().value,P=P.next().value,ge.call(Ie,P,we,this)}},e.get=function(ge){Z(arguments,1);var Ie=this.i;ge=String(ge);for(var Ve=0;Ve<Ie.length;Ve++)if(Ie[Ve][0]===ge)return Ie[Ve][1];return null},e.getAll=function(ge){Z(arguments,1);var Ie=[];return ge=String(ge),X(this.i,function(Ve){Ve[0]===ge&&Ie.push(Ve[1])}),Ie},e.has=function(ge){Z(arguments,1),ge=String(ge);for(var Ie=0;Ie<this.i.length;Ie++)if(this.i[Ie][0]===ge)return!0;return!1},e.keys=function ge(){var Ie,Ve,we,P,Q=this;return K(ge,function(re){if(re.h==1&&(Ie=p(Q),Ve=Ie.next()),re.h!=3)return Ve.done?void(re.h=0):(we=Ve.value,P=p(we),C(re,P.next().value));Ve=Ie.next(),re.h=2})},e.set=function(ge,Ie,Ve){Z(arguments,2),ge=String(ge);var we=[],P=te(ge,Ie,Ve),Q=!0;X(this.i,function(re){re[0]===ge?Q&&(Q=!we.push(P)):we.push(re)}),Q&&we.push(P),this.i=we},e.values=function ge(){var Ie,Ve,we,P,Q=this;return K(ge,function(re){if(re.h==1&&(Ie=p(Q),Ve=Ie.next()),re.h!=3)return Ve.done?void(re.h=0):(we=Ve.value,(P=p(we)).next(),C(re,P.next().value));Ve=Ie.next(),re.h=2})},Mt.prototype._asNative=function(){for(var ge=new fe,Ie=p(this),Ve=Ie.next();!Ve.done;Ve=Ie.next()){var we=p(Ve.value);Ve=we.next().value,we=we.next().value,ge.append(Ve,we)}return ge},Mt.prototype._blob=function(){var ge="----formdata-polyfill-"+Math.random(),Ie=[],Ve="--"+ge+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(we,P){return typeof we=="string"?Ie.push(Ve+Vt(se(P))+`"\r
\r
`+se(we)+`\r
`):Ie.push(Ve+Vt(se(P))+'"; filename="'+Vt(we.name)+`"\r
Content-Type: `+(we.type||"application/octet-stream")+`\r
\r
`,we,`\r
`)}),Ie.push("--"+ge+"--"),new Blob(Ie,{type:"multipart/form-data; boundary="+ge})},Mt.prototype[Symbol.iterator]=function(){return this.entries()},Mt.prototype.toString=function(){return"[object FormData]"},vt&&!vt.matches&&(vt.matches=vt.matchesSelector||vt.mozMatchesSelector||vt.msMatchesSelector||vt.oMatchesSelector||vt.webkitMatchesSelector||function(ge){for(var Ie=(ge=(this.document||this.ownerDocument).querySelectorAll(ge)).length;0<=--Ie&&ge.item(Ie)!==this;);return-1<Ie}),at&&(Mt.prototype[at]="FormData"),xe){var js=ce.XMLHttpRequest.prototype.setRequestHeader;ce.XMLHttpRequest.prototype.setRequestHeader=function(ge,Ie){js.call(this,ge,Ie),ge.toLowerCase()==="content-type"&&(this.B=!0)},ce.XMLHttpRequest.prototype.send=function(ge){ge instanceof Mt?(ge=ge._blob(),this.B||this.setRequestHeader("Content-Type",ge.type),xe.call(this,ge)):xe.call(this,ge)}}Te&&(ce.fetch=function(ge,Ie){return Ie&&Ie.body&&Ie.body instanceof Mt&&(Ie.body=Ie.body._blob()),Te.call(this,ge,Ie)}),_t&&(ce.navigator.sendBeacon=function(ge,Ie){return Ie instanceof Mt&&(Ie=Ie._asNative()),_t.call(this,ge,Ie)}),ce.FormData=Mt}})();let em=()=>{let e=Y("AREAS");return e.length===0&&e.push(Ft.GLOBAL),zi(e).call(e,(t,r,i)=>{let c=FU(r);return c?i===0?c:"".concat(t,",").concat(c):t},"")},FU=e=>e===Ft.OVERSEA?"".concat(Ds.ASIA,",").concat(Ds.EUROPE,",").concat(Ds.AFRICA,",").concat(Ds.NORTH_AMERICA,",").concat(Ds.SOUTH_AMERICA,",").concat(Ds.OCEANIA):Ds[e],Tae=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{let i=ov[r],c=Object.keys(i);c&&c.map(d=>{d!=="CODE"&&(t[d]=t[d].concat(i[d]))})}),t},_v={GLOBAL:{ASIA:[Ft.CHINA,Ft.JAPAN,Ft.INDIA,Ft.KOREA,Ft.HKMC],EUROPE:[],NORTH_AMERICA:[Ft.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Ev=Object.keys(_v[Ft.GLOBAL]),RC=[Ft.CHINA,Ft.NORTH_AMERICA,Ft.EUROPE,Ft.ASIA,Ft.JAPAN,Ft.INDIA,Ft.OCEANIA,Ft.SOUTH_AMERICA,Ft.AFRICA,Ft.KOREA,Ft.HKMC,Ft.US],Rae=function(e,t){let r=[];if(Ae(e).call(e,Ft.GLOBAL)){let d=[Ft.GLOBAL,Ft.OVERSEA],h=Object.keys(ov);if(t===Ft.GLOBAL)throw new le(z.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Ft.CHINA)r=[Ft.OVERSEA];else if(c=t,Ae(Ev).call(Ev,c)){let p=(i=t,_v[Ft.GLOBAL][i]||[]),m=[...d,t,...p];r=h.filter(_=>!Ae(m).call(m,_))}else if(function(p){let m=!1;return Ev.forEach(_=>{var E;Ae(E=_v[Ft.GLOBAL][_]).call(E,p)&&(m=!0)}),m}(t)){let p=function(_){let E;return Ev.forEach(x=>{var b;Ae(b=_v[Ft.GLOBAL][x]).call(b,_)&&(E=x)}),E}(t),m=[...d,p,t];r=h.filter(_=>!Ae(m).call(m,_))}else r=e;r=function(p){let m=[];return RC.forEach(_=>{Ae(p).call(p,_)&&m.push(_)}),m.concat(p.filter(_=>!Ae(RC).call(RC,_)))}(r)}else r=e;var i,c;return r};function UU(e){var t,r;if(!e&&Ae(t=Y("AREAS")).call(t,Ft.EXTENSIONS))return N.debug("update area from ap : reset"),void NC(jie,!0);if(!Ae(r=Y("AREAS")).call(r,Ft.GLOBAL)||!e)return;let i=ov.EXTENSIONS;i&&(i={CODE:FU(Ft.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},N.debug("update area from ap success: ".concat(e,",config is "),i),$t("AREAS",[Ft.EXTENSIONS],!0),Object.keys(i).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?$t(c,i[c][0]):$t(c,i[c])}))}function NC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=ze.reportApiInvoke(null,{name:Or.SET_AREA,options:e,tag:Er.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(d=>{if(!Ae(aU).call(aU,d))throw new le(z.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:d,excludedArea:h}=e;if(!d)throw new le(z.INVALID_PARAMS,"area code is needed");let p=d;typeof d=="string"&&(p=[d]),i=h?Rae(p,h):p}if(!t){if(Ma.AREAS){let d=new le(z.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(d),void N.warning("setArea is prohibited because of config-distribute")}if(Ae(i).call(i,Ft.GLOBAL)&&Y("AREAS")===Ft.EXTENSIONS){let d=new le(z.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(d),void N.warning("setArea is prohibited because of ap extensions")}}$t("AREAS",i,t);let c=Tae(i);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?$t(d,c[d][0]):$t(d,c[d])}),N.debug("set area success:",i.join(","))}catch(i){throw r.onError(i),i}r.onSuccess()}function VU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function So(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VU(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let AC=1;function Nae(e,t,r,i,c){AC+=1;let d={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:AC,requestId:AC,version:bi,cname:r.cname},h={service_name:t,json_body:JSON.stringify(d)},p,m,_=e[0];return La(async()=>{p=Date.now();let E=await Ba(_,{data:h,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,E.code!==0){let C=new le(z.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw N.error(C.toString()),C}let x=JSON.parse(E.json_body);if(x.code!==200){let C=new le(z.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(x.code,", reason: ").concat(x.reason),{code:x.code,responseTime:m});throw N.error(C.toString()),C}if(!x.servers||x.servers.length===0){let C=new le(z.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:x.code,responseTime:m});throw N.error(C.toString()),C}let b=function(C,U){return{addressList:C.servers.map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat(Y("WORKER_DOMAIN"),":").concat(k.wss,"?serviceName=").concat(encodeURIComponent(U))),workerToken:C.workerToken,vid:C.vid}}(x,t);return Y("LIVE_STREAMING_ADDRESS")&&(b.addressList=Y("LIVE_STREAMING_ADDRESS")instanceof Array?Y("LIVE_STREAMING_ADDRESS"):[Y("LIVE_STREAMING_ADDRESS")]),So(So({},b),{},{responseTime:m})},(E,x)=>(ze.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(E.addressList),firstSuccess:x===0,responseTime:m,serverIp:e[x%e.length]}),!1),(E,x)=>(ze.apworkerEvent(r.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:t,responseTime:m,serverIp:e[x%e.length]}),!!(E.code!==z.OPERATION_ABORTED&&E.code!==z.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(_=e[(x+1)%e.length],!0)),c)}let IC=1;function BU(e,t,r,i){let{url:c,areaCode:d}=e,{clientId:h,sid:p}=t,m=Date.now(),_,E=t.role,[x,b]=DC(t,d,[Fr.CHOOSE_SERVER]),C=Mr.networkState;return La(async()=>{C&&Mr.networkState===Un.OFFLINE&&Mr.onlineWaiter&&await je.race([Mr.onlineWaiter,hs(i&&i.maxRetryTimeout||Gr.maxRetryTimeout)]),C=Mr.networkState;let{data:U,headers:k}=await Ba(c,{data:x,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=k.http3==="1"?1:-1,ze.reportResourceTiming(c,p),GU(U,c,t,m,[Fr.CHOOSE_SERVER],_);let M=Xf(U,Fr.CHOOSE_SERVER);return OC(M),xC(M,c)},U=>(U&&ze.joinChooseServer(p,{role:E,lts:m,succ:!0,csAddr:c,opid:b,serverList:U.gatewayAddrs.map(k=>k.address),ec:null,cid:U.cid.toString(),uid:U.uid.toString(),csIp:U.csIp,unilbsServerIds:[Fr.CHOOSE_SERVER].toString(),isHttp3:_,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:U.res.detail&&U.res.detail[38]}),!1),U=>U.code!==z.OPERATION_ABORTED&&(U.code===z.CAN_NOT_GET_GATEWAY_SERVER?U.data.retry:(ze.joinChooseServer(p,{role:E,lts:m,succ:!1,csAddr:c,serverList:null,opid:b,ec:U.code,csIp:U.data&&U.data.csIp,unilbsServerIds:[Fr.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:C}),isHttp3:_,corssRegionTagReq:t.apRequestDetail}),N.warning("[".concat(h||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),U),!0)),i)}function WU(e,t,r,i){let c,{url:d,areaCode:h,serviceIds:p}=e,m=Date.now(),_=t.role,[E,x]=DC(t,h,p),b;return La(async()=>{b&&Mr.networkState===Un.OFFLINE&&Mr.onlineWaiter&&await je.race([Mr.onlineWaiter,hs(i&&i.maxRetryTimeout||Gr.maxRetryTimeout)]),b=Mr.networkState;let{data:C,headers:U}=await Ba(d,{data:E,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=U.http3==="1"?1:-1,ze.reportResourceTiming(d,t.sid),GU(C,d,t,m,p,c);let k=Xf(C,Fr.CHOOSE_SERVER),M=Xf(C,t.cloudProxyServer==="proxy5"?Fr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Fr.CLOUD_PROXY:Fr.CLOUD_PROXY_FALLBACK),H=performance.getEntriesByName(d),K=H[H.length-1],X;return K&&(X={name:K.name,protocol:"nextHopProtocol"in K?K.nextHopProtocol:"",dnscost:"domainLookupEnd"in K&&"domainLookupStart"in K&&typeof K.domainLookupEnd=="number"&&typeof K.domainLookupStart=="number"?K.domainLookupEnd-K.domainLookupStart:-1,tcpTlsCost:"connectEnd"in K&&"connectStart"in K&&typeof K.connectEnd=="number"&&typeof K.connectStart=="number"?K.connectEnd-K.connectStart:-1,reqCost:"requestStart"in K&&typeof K.requestStart=="number"&&"responseEnd"in K&&typeof K.responseEnd=="number"?K.responseEnd-K.requestStart:-1,handleCost:"leave_ts"in C&&"enter_ts"in C&&typeof C.leave_ts=="number"&&typeof C.enter_ts=="number"?C.leave_ts-C.enter_ts:-1}),OC(k),{gatewayInfo:xC(k,d),proxyInfo:M,url:d,resourceTimingInfo:X}},C=>(C.gatewayInfo&&ze.joinChooseServer(t.sid,{role:_,lts:m,succ:!0,csAddr:d,serverList:C.gatewayInfo.gatewayAddrs.map(U=>U.address),ec:null,opid:x,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:C.gatewayInfo.res.detail&&C.gatewayInfo.res.detail[38],resourceTimingInfo:C.resourceTimingInfo?JSON.stringify(C.resourceTimingInfo):void 0}),C.proxyInfo&&ze.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:C.proxyInfo.addresses.map(U=>U.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:p.toString()}),!1),C=>C.code!==z.OPERATION_ABORTED&&(C.code===z.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(ze.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:C.code,eventType:t.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:b})}),N.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),C),!0)),i)}let GU=(e,t,r,i,c,d)=>{let{sid:h,clientId:p,cloudProxyServer:m}=r,_=[],E=x=>{x.flag===4096?ze.joinChooseServer(h,{role:r.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:x.error.message,csIp:x.error.data&&x.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:r.apRequestDetail}):x.flag!==1048576&&x.flag!==4194304&&x.flag!==4194310||ze.joinWebProxyAP(h,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:x.error.code,eventType:m,unilbsServerIds:c.toString()})};if(e.response_body.forEach(x=>{let b=x.buffer.code;if(x.uri===23&&b===0&&!x.buffer.edges_services)if(x.buffer.flag===4194310)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),x.buffer.edges_services=[];else{let C={error:new le(z.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:x.buffer.flag};_.push(C),E(C)}if(b!==0){let C=vh(b),U={error:new le(z.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:e.detail[502]}),flag:x.buffer.flag};x.buffer.flag===4194310?N.warning(U.error.toString()):_.push(U),E(U)}}),_.length)throw N.warning("[".concat(p||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(_.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message,", retry: ").concat(x.error.data.retry)).join(" | "))),new le(z.CAN_NOT_GET_GATEWAY_SERVER,_.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message)).join(" | "),{retry:!!_.find(x=>x.error.data.retry),csIp:e.detail[502],desc:[...new Set(_.map(x=>{var b;return x==null||(b=x.error)===null||b===void 0||(b=b.data)===null||b===void 0?void 0:b.desc}).filter(x=>!!x))]})},OC=e=>{var t,r,i,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new le(z.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Y("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?UU(e.detail[23].toLowerCase()):UU()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){let h=e.detail[19],p=h==null?void 0:h.split(";");for(let m=0;m<p.length;m++){var d;let _=Ks(d=p[m]).call(d);e.addresses[m]&&p&&(e.addresses[m].fingerprint=_)}}if(Y("GATEWAY_ADDRESS")&&Y("GATEWAY_ADDRESS").length>0){N.debug("assign gateway address to",Y("GATEWAY_ADDRESS"));let h=Y("GATEWAY_ADDRESS").map(p=>{var m,_;let E=(m=(_=e.addresses.find(x=>x.ip===p.ip&&x.port===p.port))===null||_===void 0?void 0:_.fingerprint)!==null&&m!==void 0?m:"";return{ip:p.ip,port:p.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:E}});e.addresses=h}},Aae=(e,t)=>{if(e.response_body&&e.response_body.length){let r=e.response_body[0];if(r.buffer.code!==0){let i=vh(r.buffer.code);throw new le(z.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return r.buffer.ticket}throw N.debug("update ticket request received ap response without response body:",t),new le(z.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},DC=(e,t,r)=>{let i=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,d={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:So(So(So({6:e.stringUid,11:t,12:Y("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};d.request_bodies.forEach(p=>{e.multiIP&&e.multiIP.gateway_ip&&(p.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let h=new FormData;return h.append("request",JSON.stringify(d)),[h,i]},Iae=(e,t)=>{let r=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(i)),[c,r]},wh=0;function Sh(e){return je.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}let tm=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:i,allFailedhandler:c,promisesCollector:d}=e,h=0,p=t,m,_=0,E=async()=>{let x=(()=>{let b=h*p,C=b+p;return r.slice(b,C).map(i)})();d&&d.push(...x);try{m=await Sh(x)}catch(b){if(_+=p,h++,!(_>=r.length))return void await E();c(b)}x.forEach(b=>b.cancel())};return await E(),m},HU=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:i}=e,c=t.length,d=0,h=async()=>{let p=r(t.shift());try{return await p}catch(m){if(d++,d>=c||i!=null&&i(m))throw m;return h()}};return h()};async function Oae(){if(typeof VideoDecoder>"u")return!0;let e,t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new je((p,m)=>{let _;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:x=>{x.close(),clearTimeout(_),p(!0)},error:x=>{clearTimeout(_),p(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();let E=[t,r,i,c,d,h];for(let x=0;x<E.length;x++){let b=new EncodedVideoChunk({type:x==0?"key":"delta",timestamp:33333*x,duration:33333,data:new Uint8Array(E[x])});try{await e.decode(b)}catch{return void p(!1)}}})(),_=setTimeout(()=>{p(!1)},5e3)})}async function PC(e,t,r,i){return{gatewayInfo:await async function(c,d,h,p){let m=null,_=[],E=async()=>{let b=Y("WEBCS_DOMAIN").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map(k=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:em()})),C=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(k=>k.url)}),U=await tm({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:k=>(N.debug("[".concat(c.clientId,"] Connect to choose_server:"),k.url),BU(k,c,d,h)),allFailedhandler:k=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},C),k[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},C),U},x=async()=>{if(await hs(1e3),m!==null)return m;let b=Y("WEBCS_DOMAIN_BACKUP_LIST").map(k=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:em()})),C=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(k=>k.url)}),U=await tm({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:k=>(N.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),k.url),BU(k,c,d,h)),allFailedhandler:k=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},C),k[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},C),U};try{return m=await Sh([E(),x()]),_.length&&_.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),m}catch(b){throw b[0]}}(e,t,r,i)}}async function zU(e,t,r,i,c){let d=e.cloudProxyServer;if(d==="disabled"){if(e.useLocalAccessPoint)return await PC(e,t,r,c);if(Y("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:b,proxyInfo:C}=await YU(e,t,r,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:b};let U=C.map(k=>({turnServerURL:k.address,tcpport:k.tcpport||Cs.tcpport,udpport:k.udpport||Cs.udpport,username:k.username||Cs.username,password:k.password||Cs.password,forceturn:!1,security:!0}));if(c.useP2P){var h;let k=(h=e.uid)!==null&&h!==void 0?h:b.uid,M="glb:".concat(k.toString()),H=await b0(M),K=C.map(X=>({turnServerURL:X.address,tcpport:X.tcpport||Cs.tcpport,udpport:X.udpport||Cs.udpport,username:M,password:H,forceturn:!1,security:!0}));U.push(...K)}return e.turnServer={mode:"manual",servers:U},{gatewayInfo:b}}return await PC(e,t,r,c)}let{proxyInfo:p,gatewayInfo:m}=await YU(e,t,r,c),_={gatewayInfo:m},E=p.map(b=>({turnServerURL:b.address,tcpport:d==="proxy3"?void 0:b.tcpport?b.tcpport:Cs.tcpport,udpport:d==="proxy4"?void 0:b.udpport?b.udpport:Cs.udpport,username:b.username||Cs.username,password:b.password||Cs.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var x;let b=(x=e.uid)!==null&&x!==void 0?x:m.uid,C="glb:".concat(b.toString()),U=await b0(C),k=p.map(M=>({turnServerURL:M.address,tcpport:d==="proxy3"?void 0:M.tcpport||Cs.tcpport,udpport:d==="proxy4"?void 0:M.udpport||Cs.udpport,username:C,password:U,forceturn:d!=="proxy4",security:d==="proxy5"}));E.push(...k)}return e.turnServer={mode:"manual",servers:E},N.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(d)),_}async function KU(e,t,r,i,c){let d=Y("ACCOUNT_REGISTER").slice(0,Y("AJAX_REQUEST_CONCURRENT")),h=[];h=t.proxyServer?d.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):d.map(m=>"https://".concat(m,"/api/v1"));let p=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{let m=await async function(_,E,x,b,C){let U=Date.now(),k={sid:x.sid,opid:10,appid:x.appId,string_uid:E},M=_[0],H=await La(()=>Ba(M+"".concat(M.indexOf("?")===-1?"?":"&","action=stringuid"),{data:k,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(K,X)=>{if(K.code===0){if(K.uid<=0||K.uid>=Math.pow(2,32))throw N.error("Invalid Uint Uid ".concat(E," => ").concat(K.uid),K),ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:M,stringUid:k.string_uid,uid:K.uid,errorCode:z.INVALID_UINT_UID_FROM_STRING_UID,extend:k}),new le(z.INVALID_UINT_UID_FROM_STRING_UID);return ze.reqUserAccount(k.sid,{lts:U,success:!0,serverAddr:M,stringUid:k.string_uid,uid:K.uid,errorCode:null,extend:k}),!1}let se=vh(K.code);return se.retry&&(M=_[(X+1)%_.length]),ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:M,stringUid:k.string_uid,uid:K.uid,errorCode:se.desc,extend:k}),se.retry},(K,X)=>K.code!==z.OPERATION_ABORTED&&(ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:M,stringUid:k.string_uid,uid:null,errorCode:K.code,extend:k}),M=_[(X+1)%_.length],!0),C);if(H.code!==0){let K=vh(H.code);throw new le(z.UNEXPECTED_RESPONSE,K.desc)}return H}(h,e,t,r,i);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}}async function Dae(e,t,r){let i=Y("ACCOUNT_REGISTER"),c=[];c=t.proxyServer?i.map(d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1")):i.map(d=>"https://".concat(d,"/api/v1"));try{return await HU({referenceList:c,asyncMapHandler:d=>async function(h,p,m,_){let E=Date.now(),x={sid:m.sid,opid:10,appid:m.appId,string_uid:p};try{let b=await Ba(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:x,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(b.code!==0){let C=vh(b.code);throw new le(z.UNEXPECTED_RESPONSE,"preload sua error:".concat(C.desc),C)}if(b.uid<=0||b.uid>=Math.pow(2,32))throw new le(z.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:h,req:x,uid:b.uid,elapse:Date.now()-E}}catch(b){throw b}}(d,e,t,r),closeFn:d=>d.code===z.OPERATION_ABORTED||d.code===z.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(d){throw d}}async function Pae(e,t,r){let i=Y("CDS_AP").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),c=i.map(m=>function(_,E,x,b){let C=Rt(),U={flag:64,cipher_method:0,features:So(So(So(So(So({install_id:P0(),device:C.name,system:C.os,system_general:navigator.userAgent,vendor:E.appId,version:bi,cname:E.cname,session_id:E.sid,proxyServer:E.proxyServer,sdk_type:wae.WEB_RTC,browser_name:C.name,browser_version:C.version,user_agent:navigator.userAgent,channel_name:E.cname},E.stringUid&&{string_uid:E.stringUid}),E.uid&&{uid:E.uid+""}),C.os&&{os_name:C.os}),C.osVersion&&{os_version:C.osVersion}),{},{detail:""})};return La(()=>Ba(_,{data:U,timeout:1e3,cancelToken:x,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,k=>k.code!==z.OPERATION_ABORTED,b)}(m,e,t,r)),d=null,h=null,p={};try{d=await Sh(c)}catch(m){if(m.code===z.OPERATION_ABORTED)throw m;h=m}if(c.forEach(m=>m.cancel()),ze.reportApiInvoke(e.sid,{name:Or.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{p=function(m){if(!m.test_tags)return{};let _=m.test_tags,E=Object.keys(_),x={};return E.forEach(b=>{var C;let U=Ks(C=b.slice(4)).call(C),k=JSON.parse(_[b]),M=k[1];x[U]={tag:k[0]||"",value:M}}),x}(d)}catch{}return p}async function qU(e,t){let r=Y("WEBCS_DOMAIN").concat(Y("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:em(),serviceIds:[Fr.CHOOSE_SERVER,Fr.CLOUD_PROXY_FALLBACK]}));try{return await HU({referenceList:r,asyncMapHandler:i=>async function(c,d,h){let p,{url:m,areaCode:_,serviceIds:E}=c,x=Date.now(),[b,C]=DC(d,_,E),U=Mr.networkState;try{U&&Mr.networkState===Un.OFFLINE&&Mr.onlineWaiter&&await je.race([Mr.onlineWaiter,hs(Gr.maxRetryTimeout)]),U=Mr.networkState;let{data:k,headers:M}=await Ba(m,{data:b,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=M.http3==="1"?1:-1,(X=>{let se=[];if(X.response_body.forEach(te=>{let Z=te.buffer.code;if(te.uri===23&&Z===0&&!te.buffer.edges_services)if(te.buffer.flag===4194310)te.buffer.edges_services=[];else{let ce={error:new le(z.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:X.detail[502]}),flag:te.buffer.flag};se.push(ce)}if(Z!==0){let ce=vh(Z),fe={error:new le(z.CAN_NOT_GET_GATEWAY_SERVER,ce.desc,{desc:ce.desc,retry:ce.retry,csIp:X.detail[502]}),flag:te.buffer.flag};te.buffer.flag===4194310?N.warning(fe.error.toString()):se.push(fe)}}),se.length)throw new le(z.CAN_NOT_GET_GATEWAY_SERVER,se.map(te=>"flag: ".concat(te.flag,", message: ").concat(te.error.message)).join(" | "),{retry:!!se.find(te=>te.error.data.retry),csIp:X.detail[502],desc:[...new Set(se.map(te=>{var Z;return te==null||(Z=te.error)===null||Z===void 0||(Z=Z.data)===null||Z===void 0?void 0:Z.desc}).filter(te=>!!te))]})})(k);let H=Xf(k,Fr.CHOOSE_SERVER),K=Xf(k,Fr.CLOUD_PROXY_FALLBACK);return OC(H),{gatewayInfo:xC(H,m),proxyInfo:K,opid:C,requestTime:x,url:m,isHttp3:p,elapse:Date.now()-x}}catch(k){throw k}}(i,e,t),closeFn:i=>i.code===z.OPERATION_ABORTED||i.code===z.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(i){throw i}}async function YU(e,t,r,i){let c=Y("PROXY_SERVER_TYPE3"),d=(C,U,k)=>{let M=k||c;return Array.isArray(M)&&(M=U%2==0&&c[1]||c[0]),"https://".concat(M,"/ap/?url=").concat(C)},h=null,p=[],m=async()=>{let C=Y("WEBCS_DOMAIN").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map((M,H)=>{let K;return K=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(M,"/api/v2/transpond/webrtc?v=2"),H,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):d("".concat(M,"/api/v2/transpond/webrtc?v=2"),H),{url:K,areaCode:em(),serviceIds:[Fr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Fr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Fr.CLOUD_PROXY:Fr.CLOUD_PROXY_FALLBACK]}}),U=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(M=>M.url)}),k=await tm({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:M=>(N.debug("[".concat(e.clientId,"] Connect to choose_server:"),M.url),WU(M,e,t,r)),allFailedhandler:M=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},U),M[0]},promisesCollector:p});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},_=async()=>{if(await hs(1e3),h!==null)return h;let C=Y("WEBCS_DOMAIN_BACKUP_LIST").map((M,H)=>{let K;return K=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(M,"/api/v2/transpond/webrtc?v=2"),H,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):d("".concat(M,"/api/v2/transpond/webrtc?v=2"),H),{url:K,areaCode:em(),serviceIds:[Fr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Fr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Fr.CLOUD_PROXY:Fr.CLOUD_PROXY_FALLBACK]}}),U=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(M=>M.url)}),k=await tm({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:M=>(N.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),M.url),WU(M,e,t,r)),allFailedhandler:M=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},U),M[0]},promisesCollector:p});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},E,x,b;try{({gatewayInfo:E,proxyInfo:x,url:b}=await Sh([m(),_()]))}catch(C){throw C[0]}if(p.length&&p.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),!E||!x)throw new le(z.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=b,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&b){let C=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];Ae(c).call(c,C)&&(e.proxyServer=C,N.setProxyServer(C),ze.setProxyServer(C))}return h={gatewayInfo:E,proxyInfo:await EU(x,E.uid)},h}async function kae(e,t,r){let i=Y("UAP_AP").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=i.map(d=>function(h,p,m,_){let E={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:bi,cname:p.cname,uid:p.uid.toString(),requestId:IC,seq:IC};IC+=1;let x={service_name:"tele_channel",json_body:JSON.stringify(E)};return La(async()=>{let b=await Ba(h,{data:x,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(b.code!==0){let U=new le(z.UNEXPECTED_RESPONSE,"cross channel ap error, code"+b.code,{retry:!0});throw N.error(U.toString()),U}let C=JSON.parse(b.json_body);if(C.code!==200){let U=new le(z.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw N.error(U.toString()),U}if(!C.servers||C.servers.length===0){let U=new le(z.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw N.error(U.toString()),U}return{vid:C.vid,workerToken:C.workerToken,addressList:(Y("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(Y("WORKER_DOMAIN"),":").concat(U.wss))}},void 0,b=>!!(b.code!==z.OPERATION_ABORTED&&b.code!==z.UNEXPECTED_RESPONSE||b.data&&b.data.retry),_)}(d,e,t,r));try{let d=await Sh(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function jae(e,t,r){let i=null,c=[],d=async h=>{let p=Y(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return h&&(await hs(1e3),i!==null)?i:await tm({fragementLength:Y("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:m=>(N.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),m),function(_,E,x,b){let[C]=Iae(E,[Fr.CHOOSE_SERVER]),U=Mr.networkState;return La(async()=>{U&&Mr.networkState===Un.OFFLINE&&Mr.onlineWaiter&&await je.race([Mr.onlineWaiter,hs(b&&b.maxRetryTimeout||Gr.maxRetryTimeout)]),U=Mr.networkState;let k=await Ba(_,{data:C,cancelToken:x,headers:{"Content-Type":"multipart/form-data;"}},!0);return Aae(k,_)},()=>!1,k=>k.code!==z.OPERATION_ABORTED&&(k.code===z.UPDATE_TICKET_FAILED?k.data.retry:(N.warning("[".concat(E.clientId,"] update ticket network error, retry"),k),!0)),b)}(m,e,t,r)),allFailedhandler:m=>{throw m[0]},promisesCollector:c})};try{return i=await Sh([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),i}catch(h){throw h[0]}}function $U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function kC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$U(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$U(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class Lae extends br{get isSuccess(){return!!this.configs}constructor(t,r){super(),W(this,"configs",void 0),W(this,"store",void 0),W(this,"joinInfo",void 0),W(this,"cancelToken",void 0),W(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),W(this,"interval",void 0),W(this,"mutex",void 0),W(this,"mutableParamsRead",!1),W(this,"configCache",{}),W(this,"limit_bitrate",void 0),this.mutex=new Is("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),Y("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Y("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ze.reportApiInvoke(null,{options:void 0,name:Or.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Er.TRACER}).onSuccess(JSON.stringify(Ma))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void N.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,r=await this.mutex.lock();try{t=await Pae(this.joinInfo,this.cancelToken,this.retryConfig),N.debug("[config-distribute] get config distribute",JSON.stringify(t));let i=function(c){var d;let h=Ql(d=Object.keys(c).filter(_=>/^webrtc_ng_global_parameter/.test(_))).call(d);for(let _=0;_<h.length;_++)for(let E=h.length-1;E>_;E--){let x=h[E],b=c[x].value;if(typeof b.__priority=="number"){let C=b.__priority,U=h[E-1],k=c[U].value;if(typeof k.__priority=="number"){if(!(C>k.__priority))continue;{let M=x;h[E]=h[E-1],h[E-1]=M}}else{let M=x;h[E]=h[E-1],h[E-1]=M}}}let p=Date.now(),m={};return h.forEach(_=>{let E=c[_].value.__expires;E&&E<=p||(m[_]=c[_])}),m}(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){let c=new le(z.NETWORK_RESPONSE_ERROR,i);N.warning("[config-distribute] ".concat(c.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){oU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(qf.UPDATE_BITRATE_LIMIT,t):this.emit(qf.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&kC({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let r={},i=Object.keys(t),c=[];i.forEach(d=>{let h=t[d].value;r[d]=h;let p=h.__id;if(p&&this.configCache[d]&&this.configCache[d].__id===p)return;let m=h.__type,_=t[d].value,E=t[d].tag,x=0;m?m===O2.REALTIME&&(x=1):Object.keys(_).some(b=>Object.prototype.hasOwnProperty.call(M0,b)||!dC()&&Object.prototype.hasOwnProperty.call(UE,b)?(x=1,!0):void 0),c.push({tag:E,isApplied:x,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:p,params:m,isApplied:_}=d;this.store.sessionId&&ze.abTest(this.store.sessionId,{intSucc:1,isApplied:_,tag:h,feature:p,params:m,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=r}catch(r){N.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){let r=function(c){let d={};return Object.keys(c).forEach(h=>{let p=c[h].value,m=p.__expires,_=p.__type;Object.keys(p).forEach(E=>{E==="__id"||E==="__type"||E==="__priority"||E==="__expires"||Object.prototype.hasOwnProperty.call(d,E)||(d[E]=kC(kC({value:p[E]},m&&{expires:m}),_&&{type:_}))})}),d}(t);try{var i;let c=(i=r.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete r.LIMIT_BITRATE,c&&oU(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),function(p){try{let m=Date.now();Object.keys(p).forEach(_=>{let{value:E,type:x,expires:b}=p[_];b&&b<=m||((x===O2.REALTIME||Object.prototype.hasOwnProperty.call(M0,_))&&(Ma[_]=E,gr[_]=E,N.debug("Update realtime parameters from config distribute",_,E)),x||dC()||!Object.prototype.hasOwnProperty.call(UE,_)||(Ma[_]=E,gr[_]=E,N.debug("Update gateway parameters from config distribute",_,E)))})}catch(m){N.error("Error update config immediately: ".concat(p),m.message)}}(r);let d=JSON.stringify(r),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),N.debug("Caching global parameters ".concat(d))}catch(c){N.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{let r=Date.now();Object.keys(t).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(gr,i)){let{value:c,expires:d}=t[i];if(d&&d<=r)return;(function(h,p){try{return typeof h=="object"&&typeof p=="object"&&JSON.stringify(h)===JSON.stringify(p)}catch{return!1}})(gr[i],c)||(Ma[i]=c,gr[i]=c,this.emit(qf.UPDATE_CLIENT_ROLE_OPTIONS,c),N.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(r){N.error("Error handling global parameter config:",r.message)}}}class Mae extends br{constructor(){super(...arguments),W(this,"resultStorage",new Map)}setLocalAudioStats(t,r,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,r))}setLocalVideoStats(t,r,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i)),!r.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(i))}setRemoteAudioStats(t,r){let i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){let i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(r))}record(t,r,i){if(Y("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let c=this.resultStorage.get(t);if(!c)return;c.result.push(i);let d=t==="VIDEO_ENCODE_FAILED"?Y("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;let p=Ae(h=c.result).call(h,!0);c.isPrevNormal&&!p&&this.emit("exception",jC[t],t,r),!c.isPrevNormal&&p&&this.emit("exception",jC[t]+2e3,t+"_RECOVER",r),c.isPrevNormal=p,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof qr&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let i=null;r._encoderConfig&&r._encoderConfig.frameRate&&(i=Vn(r._encoderConfig.frameRate));let c=t.captureFrameRate;return!i||!c||!(i>10&&c<5||i<10&&i>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var r;return!(!t.codecType||Ae(r=Y("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(r,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof qr&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let jC={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ks=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){let i=r[r.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){let i=r[r.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function XU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Ed(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XU(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class rm{constructor(t){W(this,"store",void 0),W(this,"onStatsException",void 0),W(this,"onUploadPublishDuration",void 0),W(this,"onStatsChanged",void 0),W(this,"onVideoCodecChanged",void 0),W(this,"localStats",new Map),W(this,"remoteStats",new Map),W(this,"updateStatsInterval",void 0),W(this,"trafficStats",void 0),W(this,"trafficStatsPeerList",[]),W(this,"uplinkStats",void 0),W(this,"exceptionMonitor",void 0),W(this,"p2pChannel",void 0),W(this,"scalabilityMode",FE.L1T1),W(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Mae,this.exceptionMonitor.on("exception",(r,i,c)=>{this.onStatsException&&this.onStatsException(r,i,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Se.LocalAudioTrack)||Ed({},G0)}getLocalVideoTrackStats(){return this.localStats.get(Se.LocalVideoTrack)||Ed({},H0)}getRemoteAudioTrackStats(t){let r=(d,h)=>{if(!this.trafficStats)return h;let p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},i={};if(t){var c;let d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;d&&(i[t]=r(t,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(i[h]=r(h,p))});return i}getRemoteNetworkQualityStats(t){let r={};if(t){var i;let c=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;c&&(r[t]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(r[d]=h)});return r}getRemoteVideoTrackStats(t){let r=(d,h)=>{if(!this.trafficStats)return h;let p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},i={};if(t){var c;let d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;d&&(i[t]=r(t,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(i[h]=r(h,p))});return i}getRTCStats(){let t=0,r=0,i=0,c=0,d=this.localStats.get(Se.LocalAudioTrack);d&&(t+=d.sendBytes,r+=d.sendBitrate);let h=this.localStats.get(Se.LocalVideoTrack);h&&(t+=h.sendBytes,r+=h.sendBitrate);let p=this.localStats.get(Se.LocalVideoLowTrack);p&&(t+=p.sendBytes,r+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:E,videoStats:x}=_;E&&(i+=E.receiveBytes,c+=E.receiveBitrate),x&&(i+=x.receiveBytes,c+=x.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:r,SendBytes:t,RecvBytes:i,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var i;let c=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(r.peer_uid),d=c!=null&&c.videoSSRC?ks.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?ks.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&N.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,i){if(!t)return!1;let c=!!i&&r.framesDecodeFreezeTime>i.framesDecodeFreezeTime,d=!i||r.framesDecodeCount>i.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[i,c]=r;switch(i){case Se.LocalVideoTrack:case Se.LocalVideoLowTrack:{let p=c,m=Ed({},H0),_=t.getStats(),E=t.getLocalMedia(i);if(_){let x=_.videoSend.find(b=>b.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(x){let b=t.getLocalVideoSize(),C=t.getEncoderConfig(Se.LocalVideoTrack);var d;(x.codec==="H264"||x.codec==="H265"||x.codec==="VP8"||x.codec==="VP9"||x.codec==="AV1X"||x.codec==="AV1")&&(m.codecType=x.codec,(p==null?void 0:p.codecType)!==x.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,x.codec.toLocaleLowerCase()))),m.sendBytes=x.bytes,m.sendBitrate=p?8*Math.max(0,m.sendBytes-p.sendBytes):0,x.inputFrame?(m.captureFrameRate=x.inputFrame.frameRate,m.captureResolutionHeight=x.inputFrame.height,m.captureResolutionWidth=x.inputFrame.width):b&&(m.captureResolutionWidth=b.width,m.captureResolutionHeight=b.height),x.sentFrame?(m.sendFrameRate=x.sentFrame.frameRate,m.sendResolutionHeight=x.sentFrame.height,m.sendResolutionWidth=x.sentFrame.width):b&&(m.sendResolutionWidth=b.width,m.sendResolutionHeight=b.height),x.avgEncodeMs&&(m.encodeDelay=x.avgEncodeMs),C&&C.bitrateMax?m.targetSendBitrate=1e3*C.bitrateMax:x.targetBitrate&&(m.targetSendBitrate=x.targetBitrate),m.sendPackets=x.packets,m.sendPacketsLost=x.packetsLost,m.sendJitterMs=x.jitterMs,m.sendRttMs=x.rttMs,m.totalDuration=p?p.totalDuration+1:1,m.totalFreezeTime=p?p.totalFreezeTime:0,this.isLocalVideoFreeze(x)&&(m.totalFreezeTime+=1),x.scalabilityMode&&this.scalabilityMode!==x.scalabilityMode&&(N.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(x.scalabilityMode)),this.scalabilityMode=x.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(i,m),((p==null?void 0:p.sendResolutionWidth)!==m.sendResolutionWidth||(p==null?void 0:p.sendResolutionHeight)!==m.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,m);break}case Se.LocalAudioTrack:{let p=c,m=Ed({},G0),_=t.getStats(),E=t.getLocalMedia(i);if(_){let x=_.audioSend.find(b=>b.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(x){if(x.codec!=="opus"&&x.codec!=="aac"&&x.codec!=="PCMU"&&x.codec!=="PCMA"&&x.codec!=="G722"||(m.codecType=x.codec),x.inputLevel)m.sendVolumeLevel=Math.round(32767*x.inputLevel);else{let b=t.getLocalAudioVolume();b&&(m.sendVolumeLevel=Math.round(32767*b))}m.sendBytes=x.bytes,m.sendPackets=x.packets,m.sendPacketsLost=x.packetsLost,m.sendJitterMs=x.jitterMs,m.sendRttMs=x.rttMs,m.sendBitrate=p?8*Math.max(0,m.sendBytes-p.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Se.LocalAudioTrack,m),m&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,m);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var i,c;let[d,{videoStats:h,audioStats:p,videoPcStats:m}]=r,_=p,E=h,x=m,b=Ed({},W2),C=Ed({},G2),U=Ed({},yie),{audioTrack:k,videoTrack:M,audioSSRC:H,videoSSRC:K}=t.getRemoteMedia(d),X;X=this.store.useP2P?t.getStats(!0):t.getStats();let se=(i=X)===null||i===void 0?void 0:i.audioRecv.find(fe=>fe.ssrc===H),te=(c=X)===null||c===void 0?void 0:c.videoRecv.find(fe=>fe.ssrc===K),Z=this.trafficStats&&this.trafficStats.peer_delay.find(fe=>fe.peer_uid===d);if(se&&(se.codec!=="opus"&&se.codec!=="aac"&&se.codec!=="PCMU"&&se.codec!=="PCMA"&&se.codec!=="G722"||(b.codecType=se.codec),se.outputLevel?b.receiveLevel=Math.round(32767*se.outputLevel):k&&(b.receiveLevel=Math.round(32767*k.getVolumeLevel())),b.receiveBytes=se.bytes,b.receivePackets=se.packets,b.receivePacketsLost=se.packetsLost,b.receivePacketsDiscarded=se.packetsDiscarded,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost),b.receiveBitrate=_?8*Math.max(0,b.receiveBytes-_.receiveBytes):0,b.totalDuration=_?_.totalDuration+1:1,b.totalFreezeTime=_?_.totalFreezeTime:0,b.freezeRate=b.totalFreezeTime/b.totalDuration,b.receiveDelay=se.jitterBufferMs,b.totalDuration>10&&rm.isRemoteAudioFreeze(k)&&(b.totalFreezeTime+=1)),te){var ce;te.codec!=="H264"&&te.codec!=="H265"&&te.codec!=="VP8"&&te.codec!=="VP9"&&te.codec!=="AV1X"&&te.codec!=="AV1"||(C.codecType=te.codec),C.receiveBytes=te.bytes,C.receiveBitrate=E?8*Math.max(0,C.receiveBytes-E.receiveBytes):0,C.decodeFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,C.renderFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,te.outputFrame&&(C.renderFrameRate=te.outputFrame.frameRate),te.receivedFrame?(C.receiveFrameRate=te.receivedFrame.frameRate,C.receiveResolutionHeight=te.receivedFrame.height,C.receiveResolutionWidth=te.receivedFrame.width):M&&(C.receiveResolutionHeight=M._videoHeight||0,C.receiveResolutionWidth=M._videoWidth||0),te.framesRateFirefox!==void 0&&(C.receiveFrameRate=Math.round(te.framesRateFirefox)),C.receivePackets=te.packets,C.receivePacketsLost=te.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost);let fe=E?E.totalFreezeTime:0,xe=E?E.totalDuration:0;C.totalDuration=E?E.totalDuration+1:1,C.totalFreezeTime=(ce=te.totalFreezesDuration)!==null&&ce!==void 0?ce:fe||0,C.receiveDelay=te.jitterBufferMs||0;let Te=!!K&&t.getRemoteVideoIsReady(K);te.totalFreezesDuration===void 0&&M&&Te&&rm.isRemoteVideoFreeze(M,te,x)&&(C.totalFreezeTime+=1),C.freezeRate=Math.max(0,Math.min((C.totalFreezeTime-fe)/(C.totalDuration-xe),1))}Z&&(b.end2EndDelay=Z.B_ad,C.end2EndDelay=Z.B_vd,b.transportDelay=Z.B_ed,C.transportDelay=Z.B_ed,b.currentPacketLossRate=Z.B_ealr4/100,C.currentPacketLossRate=Z.B_evlr4/100,U.uplinkNetworkQuality=Z.B_punq?Z.B_punq:0,U.downlinkNetworkQuality=Z.B_pdnq?Z.B_pdnq:0),this.remoteStats.set(d,{audioStats:b,videoStats:C,videoPcStats:te,networkStats:U}),k&&this.exceptionMonitor.setRemoteAudioStats(k,b),M&&this.exceptionMonitor.setRemoteVideoStats(M,C)})}}class JU{constructor(){W(this,"destChannelMediaInfos",new Map),W(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){iU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){iU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){nv(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QU(e){if(!(e instanceof JU))return new le(z.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new le(z.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new le(z.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Xc{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){W(this,"uid",void 0),W(this,"_uintid",void 0),W(this,"_trust_in_room_",!0),W(this,"_trust_audio_enabled_state_",!0),W(this,"_trust_video_enabled_state_",!0),W(this,"_trust_audio_mute_state_",!0),W(this,"_trust_video_mute_state_",!0),W(this,"_audio_muted_",!1),W(this,"_video_muted_",!1),W(this,"_audio_enabled_",!0),W(this,"_video_enabled_",!0),W(this,"_audio_added_",!1),W(this,"_video_added_",!1),W(this,"_is_pre_created",!1),W(this,"_video_pre_subscribed",!1),W(this,"_audio_pre_subscribed",!1),W(this,"_trust_video_stream_added_state_",!0),W(this,"_trust_audio_stream_added_state_",!0),W(this,"_audioTrack",void 0),W(this,"_videoTrack",void 0),W(this,"_dataChannels",[]),W(this,"_audioSSRC",void 0),W(this,"_videoSSRC",void 0),W(this,"_audioOrtc",void 0),W(this,"_videoOrtc",void 0),W(this,"_cname",void 0),W(this,"_rtxSsrcId",void 0),W(this,"_videoMid",void 0),W(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function ZU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function LC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZU(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let vv="9",MC=2e4,yv=4e4;function e5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function ac(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e5(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Ch=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Ch||{});let xv=new Map;function t5(e,t,r,i){let{scale:c}=e;if(c===0&&i===Ch.UP||c>=t.length-1&&i===Ch.DOWN)return e;let d=ac(ac({},e),{},{scale:i===Ch.DOWN?++c:--c});switch(r){case"maintain-framerate":d=ac(ac({},d),t[c].motion);break;case"maintain-resolution":d=ac(ac({},d),t[c].detail);break;case"balanced":d=ac(ac({},d),t[c].balanced)}return d}function r5(e,t){if(t){let r={overUse:0,underUse:0,adaptationList:s5(t)};xv.set(e,r)}else xv.delete(e)}function s5(e){let t=ac({},e),{bitrateMax:r,frameRate:i,scaleResolutionDownBy:c,bitrateMin:d}=t,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:_,BITRATE_MAX_THRESHOLD:E,BWE_SCALE_UP_THRESHOLD:x,BWE_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:U,BALANCE_BITRATE_FACTOR:k,BALANCE_FRAMERATE_FACTOR:M,BALANCE_RESOLUTION_FACTOR:H,MOTION_RESOLUTION_FACTOR:K,MOTION_BITRATE_FACTOR:X,DETAIL_FRAMERATE_FACTOR:se,DETAIL_BITRATE_FACTOR:te}=j0,Z=Math.min(t.frameRate,p),ce=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(b,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(C,1)*Z),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:d}}];for(let fe=1;fe<=m;fe++){let xe={bwe_up:Math.round(Math.pow(x,fe)*r),bwe_down:Math.round(Math.pow(b,fe+1)*r),fps_up:Math.round(Math.pow(U,fe)*Z),fps_down:Math.round(Math.pow(C,fe+1)*Z)},Te={scaleResolutionDownBy:c/Math.pow(H,fe),frameRate:Math.max(Math.round(Math.pow(M,fe)*i),h),bitrateMax:Math.max(Math.round(Math.pow(k,fe)*r),E),bitrateMin:Math.max(Math.round(Math.pow(k,fe)*d),_)},_t={scaleResolutionDownBy:c/Math.pow(K,fe),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(X,fe)*r),E),bitrateMin:Math.max(Math.round(Math.pow(X,fe)*d),_)},vt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(se,fe)*i),h),bitrateMax:Math.max(Math.round(Math.pow(te,fe)*r),E),bitrateMin:Math.max(Math.round(Math.pow(te,fe)*d),_)};ce.push({scale:fe,threshold:xe,balanced:Te,motion:_t,detail:vt})}return ce}function Fae(e,t,r,i,c,d){let h=xv.get(e)||{overUse:0,underUse:0,adaptationList:s5(c)},{adaptationList:p}=h;xv.set(e,h);let{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:_}=j0,{scale:E}=i,x,b;return typeof t=="number"&&t>0&&function(C,U,k,M){if(U>=k.length)return!1;let{threshold:{fps_down:H}}=k[U];return Y("FORCE_AG_HIGH_FRAMERATE")&&M==="maintain-framerate"&&(H=k[0].threshold.fps_down),C<H}(t,E,p,d)&&(h.overUse++,b=Uf.CPU,h.overUse>m)||typeof r=="number"&&r>0&&function(C,U,k){if(U>=k.length)return!1;let{threshold:{bwe_down:M}}=k[U];return C<M}(r,E,p)&&(h.overUse++,b=Uf.BANDWIDTH,h.overUse>m)?(h.overUse=0,h.underUse=0,x=t5(i,p,d,Ch.DOWN),[x,b]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(C,U,k,M){if(U===0)return;let{threshold:{fps_up:H}}=k[U];return Y("FORCE_AG_HIGH_FRAMERATE")&&M==="maintain-framerate"&&(H=k[1].threshold.fps_up),C>H}(t,E,p,d)&&function(C,U,k){if(U===0)return;let{threshold:{bwe_up:M}}=k[U];return C>M}(r,E,p)&&(h.underUse++,h.underUse>_&&(h.overUse=0,h.underUse=0,x=t5(i,p,d,Ch.UP),x.scale===0&&(b=Uf.NONE))),[x,b])}function n5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function FC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n5(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let bv=new Map;function wv(e,t){let r=bv.get(e);if(r){let{timer:i}=r;window.clearTimeout(i),bv.delete(e)}t.qualityLimitationReason=Uf.NONE,r5(e)}function Uae(e,t){var r;let i;switch(t){case Se.LocalAudioTrack:i=zt.Audio;break;case Se.LocalVideoTrack:i=Ae(r=e._hints).call(r,Zt.SCREEN_TRACK)?zt.Screen:zt.High;break;case Se.LocalVideoLowTrack:i=zt.Low}return i}function UC(e){let t=Dt();if(e.some(r=>r._bypassWebAudio))throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function VC(e,t){UC(e);let r=new qr;return e.forEach(i=>r.addAudioTrack(i)),r}let Vae=!Dt().supportUnifiedPlan||Y("CHROME_FORCE_PLAN_B")&&ec();function Sv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;return Vae?(r={spec:t,store:e},ic("PlanBConnection").create(r)):new Ri(t,e)}function BC(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function i5(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Lf(e.turnServer.servers))return!1;if(Y("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Nt;function a5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Wa(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?a5(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Ri=(Nt=class Bd extends lU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Ae(r=Object.keys(Bf)).call(r,t)}))]}constructor(t,r){super(t,r),W(this,"id",tr(5,"connection-")),W(this,"store",void 0),W(this,"peerConnection",void 0),W(this,"forceTurn",!1),W(this,"remoteSDP",void 0),W(this,"initialOffer",void 0),W(this,"transportEventReceiver",void 0),W(this,"statsFilter",void 0),W(this,"extension",{useXR:Y("USE_XR")}),W(this,"localCapabilities",void 0),W(this,"remoteCodecs",void 0),W(this,"localCandidateCount",0),W(this,"allCandidatesReceived",!1),W(this,"isPreallocation",!1),W(this,"preMediaMap",new Map),W(this,"dataStreamChannelMap",new Map),W(this,"establishPromise",void 0),W(this,"recoveredDataChannelIds",[]),W(this,"currentDataChannelId",1),W(this,"supportAV1RtpSpec",!1),W(this,"mutex",void 0),W(this,"qualityLimitationReason",Uf.NONE),W(this,"isFirstConnected",!1),this.store=r,this.forceTurn=i5(t),this.mutex=new Is("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Bd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=D0(this.peerConnection,Y("STATS_UPDATE_INTERVAL"),void 0,Sr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void N.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){let i=await this.peerConnection.createOffer(),c=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else N.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let c=Kc(i.sdp),d=await NU({filterRTX:!Y("USE_PUB_RTX")&&!Y("USE_SUB_RTX"),filterVideoFec:Y("FILTER_VIDEO_FEC"),filterAudioFec:Y("FILTER_AUDIO_FEC"),filterVideoCodec:Y("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:Y("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:Y("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=fv(d),this.initialOffer=i,Y("ENABLE_SVC")&&this.store.codec=="av1"){let p=await async function(){try{let m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:FE.L1T3}]});let _=await m.createOffer();if(!_.sdp)return void m.close();let E=yn(_.sdp).mediaDescriptions[0];if(!E)return;let x=E.attributes.extmaps.find(b=>b.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return m.close(),x}catch{return}}();var t;p&&(this.supportAV1RtpSpec=!0,(t=d.send)===null||t===void 0||t.videoExtensions.push(p))}let h;return i.sdp&&DU(i.sdp)&&(h=vr(d),(r=h).send&&(yh(Fe.VIDEO,r.send.videoExtensions),yh(Fe.AUDIO,r.send.audioExtensions)),r.recv&&(yh(Fe.VIDEO,r.recv.videoExtensions),yh(Fe.AUDIO,r.recv.audioExtensions)),r.sendrecv&&(yh(Fe.VIDEO,r.sendrecv.videoExtensions),yh(Fe.AUDIO,r.sendrecv.audioExtensions))),Wa(Wa({},c),{},{rtpCapabilities:h||d,offerSDP:i.sdp})}catch(i){throw new he(z.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var r}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&DU(this.initialOffer.sdp)&&(r=t.rtpCapabilities,i=this.localCapabilities,r.send&&(uv(Fe.VIDEO,r.send.videoExtensions,i.send.videoExtensions),uv(Fe.AUDIO,r.send.audioExtensions,i.send.audioExtensions)),r.recv&&(uv(Fe.VIDEO,r.recv.videoExtensions,i.recv.videoExtensions),uv(Fe.AUDIO,r.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return vr(this._localCapabilities)}get rtpCapabilities(){return vr(this._rtpCapabilities)}get candidates(){return vr(this._candidates)}get iceParameters(){return vr(this._iceParameters)}get dtlsParameters(){return vr(this._dtlsParameters)}constructor(m){let _=arguments.length>1&&arguments[1]!==void 0&&arguments[1],E=arguments.length>2&&arguments[2]!==void 0&&arguments[2];W(this,"sessionDesc",void 0),W(this,"_localCapabilities",void 0),W(this,"_rtpCapabilities",void 0),W(this,"_candidates",void 0),W(this,"_originCandidates",void 0),W(this,"_iceParameters",void 0),W(this,"_isUseExtmapAllowMixed",void 0),W(this,"_isUseLocalCodecs",void 0),W(this,"_dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname",void 0),W(this,"useLocalCodecsMids",[]),W(this,"preloadSsrcs",[]),W(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=_,this._isUseLocalCodecs=E,m=vr(m);let{iceParameters:x,dtlsParameters:b,candidates:C,rtpCapabilities:U,setup:k,localCapabilities:M,cname:H}=m;this._rtpCapabilities=U,this._candidates=C,this._originCandidates=vr(C),this._iceParameters=x,this._dtlsParameters=b,this._localCapabilities=M,this.setup=k,this.cname=H,[this.sessionDesc]=this.updateRemoteRTPCapabilities(U),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(m){return m.length===this.preloadSsrcs.length&&m.every(_=>{var E;return Ae(E=this.preloadSsrcs).call(E,_)})}preloadRemoteMedia(m){let _=0,E=[],x=[];for(;m>0;){let b=[LC({ssrcId:yv+_},Y("USE_SUB_RTX")?{rtx:yv+_+1}:{})],C="".concat(yv+_,"_").concat(MC+_),{ssrcs:U,ssrcGroups:k}=Qf(b,this.cname,Y("SYNC_GROUP")?C:void 0),M=this.preCreateOrRecycleSendMedia("video",U,k,void 0),H=[{ssrcId:MC+_}],K="".concat(yv+_,"_").concat(MC+_),{ssrcs:X,ssrcGroups:se}=Qf(H,this.cname,Y("SYNC_GROUP")?K:void 0),te=this.preCreateOrRecycleSendMedia("audio",X,se,void 0);m--,_+=2,E.push(M,te),x.push(U[0].ssrcId,X[0].ssrcId)}return this.useLocalCodecsMids.push(...E),this.preloadSsrcs=x,{mids:E,preSSRCs:x,isAvailable:!0}}preCreateOrRecycleSendMedia(m,_,E,x){let b=this.rtpCapabilities.send.videoCodecs,C=this._isUseLocalCodecs||b.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;N.debug("create or recycle send media without remote rtp capabilities, ssrcs ",_[0].ssrcId);let U=m===Fe.VIDEO?C.videoCodecs:C.audioCodecs,k=m===Fe.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;let M="".concat(this.currentMidIndex),H={media:{mediaType:m,port:vv,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(K=>K.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:k,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(M)}};return H=this.mungSendMediaDesc(H,x),this.sessionDesc.mediaDescriptions.push(H),this.updateBundleMids(),M}toString(){return Vc(this.sessionDesc)}send(m,_,E,x){let{ssrcs:b,ssrcGroups:C}=Qf(_,this.cname,Y("SYNC_GROUP")?E:void 0),U=this.findPreloadMediaDesc(b);if(U){if(Sr()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,U.attributes.mid),x&&(x.twcc||x.remb)){let k=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[k]=this.mungSendMediaDesc(U,x),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{let k=this.findAvailableMediaIndex(m,b),M;return k===-1||k===1&&(bs()||function(){let H=Rt();return!(H.name!==Lt.CHROME||!H.osVersion)&&Number(H.version)<=90}()||Y("ENABLE_ENCODED_TRANSFORM")&&Zo())||k===0&&!function(H){let K=Rt();return!(K.name!==Lt.FIREFOX||!K.osVersion)&&Number(K.version)===H}(138)&&Y("USE_SUB_RTX")||t2()?(M=this.createOrRecycleSendMedia(m,b,C,"sendonly",x),this.updateBundleMids()):(M=vr(this.sessionDesc.mediaDescriptions[k]),M.attributes.direction="sendonly",M.attributes.ssrcs=b,M.attributes.ssrcGroups=C,this.sessionDesc.mediaDescriptions[k]=this.mungSendMediaDesc(M,x)),Sr()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,M.attributes.mid),{mid:M.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:m,needExchangeSDP:_}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:m.attributes.mid,needExchangeSDP:_}}batchSend(m){let _=m.map(b=>{let{kind:C,ssrcMsg:U,mslabel:k}=b;return this.send(C,U,k)}),E=[],x=!1;return _.forEach(b=>{let{mid:C,needExchangeSDP:U}=b;U&&(x=!0),E.push(C)}),{mids:E,needExchangeSDP:x}}stopSending(m){let _=this.sessionDesc.mediaDescriptions.filter(E=>E.attributes.mid&&m.indexOf(E.attributes.mid)!==-1);if(_.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");_.forEach(E=>{E.attributes.mid==="0"||Sr()||t2()?E.attributes.ssrcs=[]:(E.attributes.ssrcs=[],E.attributes.direction="inactive",E.media.port="0")}),this.updateBundleMids()}mute(m){let _=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===m);if(!_)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.mute."));_.attributes.direction="inactive"}unmute(m){let _=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===m);if(!_)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.unmute."));_.attributes.direction="sendonly"}muteRemote(m){let _=this.sessionDesc.mediaDescriptions.filter(E=>Ae(m).call(m,E.attributes.mid||""));if(_.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_.forEach(E=>{E.attributes.direction="inactive"})}unmuteRemote(m){let _=this.sessionDesc.mediaDescriptions.filter(E=>Ae(m).call(m,E.attributes.mid||""));if(_.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_.forEach(E=>{E.attributes.direction="recvonly"})}receive(m,_,E,x){m.forEach((b,C)=>{this.createOrRecycleRecvMedia(b,[],"recvonly",_,E,x[C])}),this.updateBundleMids()}stopReceiving(m){let _=this.sessionDesc.mediaDescriptions.filter(E=>m.indexOf(E.attributes.mid)!==-1);if(_.length!==m.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");_.forEach(E=>{E.media.port="0",E.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(m){let _=this.sessionDesc||yn((E=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(E?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var E;this._rtpCapabilities=m;let x=!1,b=this.rtpCapabilities.send,C=this.localCapabilities.send,U=this.localCapabilities.recv,k=U.videoCodecs,M=U.audioCodecs,H=U.videoExtensions,K=U.audioExtensions;for(let Z of _.mediaDescriptions){var X;if(Z.attributes.direction!=="sendonly"||typeof Z.attributes.mid!="string"||!Ae(X=this.useLocalCodecsMids).call(X,Z.attributes.mid)){if(x=!0,Z.attributes.iceUfrag=this._iceParameters.iceUfrag,Z.attributes.icePwd=this._iceParameters.icePwd,Z.attributes.fingerprints=this._dtlsParameters.fingerprints,Z.attributes.candidates=this._candidates,Z.attributes.setup=this.setup,Z.media.mediaType==="application"&&(Z.attributes.sctpPort="5000"),Z.media.mediaType==="video")if(this._isUseLocalCodecs&&Z.attributes.direction==="sendonly"){var se;Z.media.fmts=k.map(fe=>fe.payloadType.toString(10)),Z.attributes.payloads=k,Z.attributes.extmaps=H;let ce=Z.attributes.mid;typeof ce!="string"||Ae(se=this.useLocalCodecsMids).call(se,ce)||this.useLocalCodecsMids.push(ce)}else if(b.videoCodecs.length===0){let ce=C.videoCodecs.filter(fe=>{var xe,Te;return(xe=fe.rtpMap)===null||xe===void 0?void 0:Ae(Te=xe.encodingName.toLowerCase()).call(Te,"vp8")})||[C.videoCodecs[0]];Z.media.fmts=ce.map(fe=>fe.payloadType.toString(10)),Z.attributes.payloads=ce,Z.attributes.extmaps=[]}else Z.media.fmts=b.videoCodecs.map(ce=>ce.payloadType.toString(10)),Z.attributes.payloads=b.videoCodecs,Z.attributes.extmaps=b.videoExtensions;if(Z.media.mediaType==="audio")if(this._isUseLocalCodecs&&Z.attributes.direction==="sendonly"){var te;Z.media.fmts=M.map(fe=>fe.payloadType.toString(10)),Z.attributes.payloads=M,Z.attributes.extmaps=K;let ce=Z.attributes.mid;typeof ce!="string"||Ae(te=this.useLocalCodecsMids).call(te,ce)||this.useLocalCodecsMids.push(ce)}else if(b.audioCodecs.length===0){let ce=C.audioCodecs.filter(fe=>{var xe,Te;return(xe=fe.rtpMap)===null||xe===void 0?void 0:Ae(Te=xe.encodingName.toLowerCase()).call(Te,"opus")})||[C.audioCodecs[0]];Z.media.fmts=ce.map(fe=>fe.payloadType.toString(10)),Z.attributes.payloads=ce,Z.attributes.extmaps=[]}else Z.media.fmts=b.audioCodecs.map(ce=>ce.payloadType.toString(10)),Z.attributes.payloads=b.audioCodecs,Z.attributes.extmaps=b.audioExtensions,bh(Z)}}return this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1,[this.sessionDesc,x]}updateCandidates(m){let _=this._originCandidates.filter(x=>x.transport==="udp"),E=[];if(_.forEach(x=>{E.push(LC(LC({},x),{},{foundation:"tcpcandidate",priority:Number(x.priority)-1+"",transport:"tcp",port:Number(x.port)+90+""}))}),_.length!==0){switch(m){case Ps.TCP_RELAY:this._candidates=E;break;case Ps.UDP_TCP_RELAY:case Ps.RELAY:this._candidates=[..._,...E];break;default:this._candidates=_}for(let x of this.sessionDesc.mediaDescriptions)x.attributes.candidates=this.candidates}}restartICE(m){m=vr(m),this._iceParameters=m,this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.iceUfrag=m.iceUfrag,_.attributes.icePwd=m.icePwd})}predictReceivingMids(m){let _=[];for(let E=0;E<m;E++)_.push((this.currentMidIndex+E+1).toString(10));return _}findAvailableMediaIndex(m,_){return this.sessionDesc.mediaDescriptions.findIndex(E=>{let x=E.media.mediaType===m&&E.media.port!=="0"&&(E.attributes.direction==="sendonly"||E.attributes.direction==="sendrecv")&&E.attributes.ssrcs.length===0;if(Sr()){if(x){let b=this.firefoxSsrcMidMap.get(_[0].ssrcId);return!(b||E.attributes.mid!=="0"&&E.attributes.mid!=="1")||!(!b||b!==E.attributes.mid)}return!1}return x})}createOrRecycleDataChannel(){for(let E of this.sessionDesc.mediaDescriptions)if(E.media.mediaType==="application")return{mediaDesc:E,needExchangeSDP:!1};this.currentMidIndex+=1;let m="".concat(this.currentMidIndex),_={media:{mediaType:"application",port:vv,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(m),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(_),{mediaDesc:_,needExchangeSDP:!0}}createOrRecycleRecvMedia(m,_,E,x,b,C){let U=m._mediaStreamTrack.kind,k=this.rtpCapabilities.recv,M=Zf(U,k,this.localCapabilities.send,U===Fe.VIDEO?x:b),H=U===Fe.VIDEO?k.videoExtensions:k.audioExtensions;this.currentMidIndex+=1;let K="".concat(this.currentMidIndex),X={media:{mediaType:U,port:vv,protos:["UDP","TLS","RTP","SAVPF"],fmts:M.map(te=>te.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:H,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:M,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};X=this.mungRecvMediaDsec(X,m,C);let se=this.findFirstClosedMedia(U);if(se){let te=this.sessionDesc.mediaDescriptions.indexOf(se);this.sessionDesc.mediaDescriptions[te]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}updateRemoteDtlsParameters(m){let _=new Set(this._dtlsParameters.fingerprints.map(b=>b.fingerprint)),E=new Set(m.map(b=>b.fingerprint)),x=!1;_.size!==E.size&&(x=!0);for(let b of _)E.has(b)||(x=!0);return x}updateRemoteCodec(m,_,E){let x=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(X=>X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||"").filter(X=>{var se;return Ae(se=Object.keys(Bf)).call(se,X)}))],b=new Set(_);if(x.every(X=>b.has(X)))return N.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(_)),!1;let C=this._rtpCapabilities.recv.videoCodecs.filter(X=>_.some(se=>{var te;return Ae(te=X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||"").call(te,se)}));if(C.length===0)return N.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(x," codecs: ").concat(_)),!1;let U=[...new Set(C.map(X=>X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||""))],k;if(N.debug("updateRemoteCodec, from ".concat(x," to ").concat(U)),m.length===0)k=this.sessionDesc.mediaDescriptions.filter(X=>X.media.mediaType==="video"&&X.attributes.direction==="recvonly");else if(k=this.sessionDesc.mediaDescriptions.filter(X=>X.attributes.mid&&X.media.mediaType==="video"&&Ae(m).call(m,X.attributes.mid)&&X.attributes.direction==="recvonly"),k.length!==m.length)return N.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(m,", codecs: ").concat(_)),!1;if(Y("USE_PUB_RTX")||Y("USE_SUB_RTX")){let X=qc(C,this.rtpCapabilities.recv.videoCodecs);C.push(...X)}this._rtpCapabilities.recv.videoCodecs=C;let M=this.localCapabilities.send,H=this.rtpCapabilities.recv,K=Zf(Fe.VIDEO,H,M,E);return k.forEach(X=>{let se=K.map(te=>te.payloadType.toString(10));N.debug("updateRemoteCodec mid: ".concat(X.attributes.mid,", from"),X.attributes.payloads,"to",K),X.attributes.payloads=K,X.media.fmts=se}),!0}createOrRecycleSendMedia(m,_,E,x,b){let C=this.rtpCapabilities.send.videoCodecs,U=this._isUseLocalCodecs||C.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,k=m===Fe.VIDEO?U.videoCodecs:U.audioCodecs,M=m===Fe.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;let H="".concat(this.currentMidIndex),K={media:{mediaType:m,port:vv,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(se=>se.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:M,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:x,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(H)}};K=this.mungSendMediaDesc(K,b);let X=this.findFirstClosedMedia(m);if(X){let se=this.sessionDesc.mediaDescriptions.indexOf(X);this.sessionDesc.mediaDescriptions[se]=K}else this.sessionDesc.mediaDescriptions.push(K);return K}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(m=>m.media.port!=="0").map(m=>m.attributes.mid)}mungRecvMediaDsec(m,_,E){let x=vr(m);return wC(x),xh(x,_),SC(x,_),TU(x),pv(x,E,this.localCapabilities.send),x}mungSendMediaDesc(m,_){let E=vr(m);return pv(E,_,this.localCapabilities.recv),bh(E),E}updateRecvMedia(m,_){let E=this.sessionDesc.mediaDescriptions.findIndex(x=>x.attributes.mid===m);if(E!==-1){let x=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[E],_);this.sessionDesc.mediaDescriptions[E]=x}}bumpMid(m){this.currentMidIndex+=m}findFirstClosedMedia(m){return this.sessionDesc.mediaDescriptions.find(_=>Sr()?_.media.port==="0"&&_.media.mediaType===m:_.media.port==="0")}findPreloadMediaDesc(m){return this.sessionDesc.mediaDescriptions.find(_=>{var E;return((E=_.attributes)===null||E===void 0||(E=E.ssrcs[0])===null||E===void 0?void 0:E.ssrcId)===m[0].ssrcId})}getSSRC(m){var _;return(_=this.sessionDesc.mediaDescriptions.find(E=>E.attributes.mid===m))===null||_===void 0?void 0:_.attributes.ssrcs}}(Wa(Wa({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!Y("ENABLE_PRE_SUB_WITH_PRE_PC")||!Y("PRE_USE_LOCAL_CODECS"))&&V0(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let c=this.remoteSDP.toString(),d=IU(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});let p=this.peerConnection.getTransceivers()[0];if(p!=null&&p.receiver&&this.tryBindTransportEvents(p.receiver),V0(this.store))if(t.preallocation&&Y("ENABLE_PRE_SUB_WITH_PRE_PC")){let m=Y("PRE_SUB_NUM"),{mids:_,preSSRCs:E}=this.remoteSDP.preloadRemoteMedia(m);await Yc(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(E)),this.presetMedia(_,E)}else{let{preSSRCs:m=[]}=t,_=m.map(x=>x.ssrcMsg[0].ssrcId);if(m.length===0)return;let{mids:E}=this.remoteSDP.batchSend(m.map(x=>Object.assign({},x)));await Yc(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(_)),this.presetMedia(E,_)}}catch(c){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var r,i}presetMedia(t,r){t.forEach((i,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&i===d.mid&&d.receiver.track){let h=d.receiver.track,p;h.kind==="video"&&Y("ENABLE_PRE_RENDER")&&(p=new Z0({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(tr(5,""))},!0),p.updateVideoTrack(h),p.onFirstVideoFrameRender=()=>{var m;let _=this.preMediaMap.get(r[c]);_&&(_.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,r[c])},p.play(this.store.sessionId||void 0)),this.preMediaMap.set(r[c],{mid:i,track:h,player:p,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let r=!1,{rtpCapabilities:i}=t;if([,r]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);r=r||h}let{preSSRCs:c=[]}=t,d=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){let h=[],p=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[_,{mid:E,player:x,track:b}]=m;return h.push(E),p.push(_),this.preMediaMap.delete(_),x&&x.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await Yc(this.peerConnection,this.remoteSDP,this.extension),N.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(p)),ze.reportApiInvoke(this.store.sessionId,{name:Or.PRELOAD_MEDIA_FAILED,options:[c,p],tag:Er.TRACER}).onSuccess()),c.length>0){let{mids:m}=this.remoteSDP.batchSend(c.map(_=>Object.assign({},_)));await Yc(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(m,d)}}r?(await Yc(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):N.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,i){var c=this;return xi(function*(){let d=yield Ot(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let h=[],p=dv();t.forEach(M=>{let H=c.peerConnection.addTransceiver(M._mediaStreamTrack,Wa({direction:"sendonly"},M.trackMediaType==="video"&&c.supportAV1RtpSpec&&p?{sendEncodings:[{scalabilityMode:p}]}:{}));h.push(H),M._updateRtpTransceiver(H)}),Sr()&&Y("SIMULCAST")===!0&&(yield Ot(c.applySimulcastForFirefox(h,t)));let m=yield Ot(c.peerConnection.createOffer()),_=c.remoteSDP.predictReceivingMids(t.length),E=c.mungSendOfferSDP(m.sdp,t,_),x=yn(E),b=_.map(M=>{let H=x.mediaDescriptions.find(K=>K.attributes.mid===M);if(!H)throw new Error("Cannot extract ssrc from mediaDescription.");return wU(H,Y("USE_PUB_RTX"))}),C;try{C=yield b}catch(M){C=[],c.remoteSDP.receive(t,r,i,C);let H=c.remoteSDP.toString();throw yield Ot(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ot(c.peerConnection.setRemoteDescription({type:"answer",sdp:H})),yield Ot(c.stopSending(_,!0)),M}c.remoteSDP.receive(t,r,i,C);let U=c.remoteSDP.toString(),k=c.logSDPExchange(E,"offer","local","send");return yield Ot(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ot(c.applySimulcastEncodings(h,t)),yield Ot(c.applySendEncodings(h,t)),k==null||k(U),yield Ot(c.peerConnection.setRemoteDescription({type:"answer",sdp:U})),h.map((M,H)=>{let K=_[H];return{localSSRC:b[H],id:K,transceiver:M}})}catch(h){throw h instanceof he?h:new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")N.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:Y("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}r.forEach(d=>{d._updateOriginDataChannel(i)});let{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){let d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),N.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else N.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof he?i:new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{let r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof he?r:new he(z.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){let i=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(m=>{var _;wv(this.id+m.mid,this),m.direction="inactive",(_=m.stop)===null||_===void 0||_.call(m)});let d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);let p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{i&&i()}}async receive(t,r,i,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,i,c);h&&(await Yc(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let p=this.peerConnection.getTransceivers().find(m=>m.mid===d);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:d,transceiver:p}}catch(d){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:r,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await Yc(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(c=>{let d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(d=>{Array.from(this.preMediaMap.entries()).some(h=>{let[p,{mid:m,player:_}]=h;if(m===d)return this.preMediaMap.delete(p),_&&_.destroy(),!0})}),this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();i==null||i(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();i==null||i(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();i==null||i(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(h=>{h.direction="inactive"});let i=await this.peerConnection.createOffer(),c=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(h,p)=>{h.direction="sendonly"});let i=await this.peerConnection.createOffer(),c=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return xi(function*(){let i=yield Ot(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=Dt().supportPCSetConfiguration,d=Y("FORCE_TURN_TCP")||r.forceTurn;if(t===Ps.RELAY&&!c)return;if(c&&!d){let x=t===Ps.RELAY?"relay":"all",b=r.peerConnection.getConfiguration();b.iceTransportPolicy!==x&&(N.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(b.iceTransportPolicy,"] to [").concat(x,"]")),b.iceTransportPolicy=x,r.peerConnection.setConfiguration(b))}r.remoteSDP.updateCandidates(t);let h=yield Ot(r.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let p=Kc(h.sdp),{remoteIceParameters:m}=yield p.iceParameters;r.remoteSDP.restartICE(m);let _=r.remoteSDP.toString(),E=r.logSDPExchange(h.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Ot(r.peerConnection.setLocalDescription(h)),E==null||E(_),yield Ot(r.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){N.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ps.TCP_RELAY),await Yc(this.peerConnection,this.remoteSDP,this.extension)}catch(r){N.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{wv(this.id+r.mid,this)}),this.preMediaMap.forEach(r=>{let{player:i}=r;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Wa(Wa({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(i.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new he(z.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getTransceivers().filter(c=>c.mid===t);i.length===1&&(this.isVP8Simulcast(r)?Sr()||await this.applySimulcastEncodings(i,[r]):await this.applySendEncodings(i,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getTransceivers().find(c=>c.mid===r);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:i,remote:c}=r.getSelectedCandidatePair();return{local:Wa(Wa({},vo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Wa(Wa({},vo),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;let i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"",d=_d(t.url||"");N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(d||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Y("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(Lf(t.turnServer.servers)?r.iceServers=t.turnServer.servers:Y("NEW_TURN_MODE")&&r.iceServers&&i==="disabled"?(Y("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...Bd.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...Bd.newTurnServerConfigToIceServers(t.turnServer.servers)),Y("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...Bd.turnServerConfigToIceServers(t.turnServer.servers)),Y("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Bd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Y("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),Y("ENABLE_ENCODED_TRANSFORM")&&Dt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{i.security?i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Hc(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!Y("FORCE_TURN_TCP")&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{let c=Y("NEW_TURN_MODE");c===1?r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Hc(i.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Hc(i.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){let r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};let i=r.iceTransport;i&&(i.onstatechange=()=>{let c=r==null?void 0:r.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:c,remote:d}=i.getSelectedCandidatePair()||{};if(c&&d){let h=c.address+":"+c.port,p=d.address+":"+d.port;N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(_d(h)),", remote ").concat(JSON.stringify(_d(p))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var i,c;if(r||(r=this.peerConnection.getSenders().find(k=>k.track===t._mediaStreamTrack)),!r)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Dt().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let d={},h={};switch(t._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}let p=function(k,M){return k.getTransceivers().find(H=>H.sender.track===M||H.receiver.track===M)}(this.peerConnection,t._mediaStreamTrack),m=Cie(t);if(function(k){var M;return!(!Y("ENABLE_AG_ADAPTATION")||!(k instanceof qE||Ae(M=k._hints).call(M,Zt.CUSTOM_TRACK))||!Y("FORCE_SUPPORT_AG_ADAPTATION")&&!(ZL(14,0,!1)&&e2(17,4)||QL(14)&&m0(17,4,!0)))}(t)&&p&&r&&m&&this.getLocalVideoStats&&Ae(i=["vp8","vp9"]).call(i,this.store.codec)){var _;let k=d.degradationPreference||(Ae(_=t._hints).call(_,Zt.CUSTOM_TRACK)?Y("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(M,H,K,X,se,te){if(wv(M,K),se(H),X!=="balanced"&&X!=="maintain-framerate"&&X!=="maintain-resolution")return;let Z=-1;r5(M,H);let ce=window.setInterval(()=>{let xe=bv.get(M);if(!Y("ENABLE_AG_ADAPTATION")||!xe)return wv(M,K),void se(H);let Te=te();if(Te.sendPackets>0&&Te.OutgoingAvailableBandwidth>0){if(Z===-1)return void(Z=Date.now());if(Date.now()-Z<1e3)return;let _t=Te.sendFrameRate,vt=Te.OutgoingAvailableBandwidth,[at,Vt]=Fae(M,_t,vt,xe.adaptationConfig,H,X);Vt&&(K.qualityLimitationReason=Vt),at&&xe.adaptationConfig.scale!==at.scale&&(N.debug("[".concat(M,"] applyAdaptation: ").concat(K.qualityLimitationReason,`
           sendFps `).concat(_t,", bwe ").concat(vt,", switch from ").concat(xe.adaptationConfig.scale," to ").concat(at.scale," ")),xe.adaptationConfig=FC(FC({},xe.adaptationConfig),at),se(at))}},Y("CHECK_LOCAL_STATS_INTERVAL")),fe=FC({},H);bv.set(M,{timer:ce,adaptationConfig:fe,originConfig:H,adaptationFunc:se}),N.debug("[".concat(M,"] start adaptation, originConfig: ").concat(JSON.stringify(H),", degradationPreference: ").concat(X))})(this.id+p.mid,m,this,k,M=>{r&&this.updateAdaptation(r,M)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var E;let{bitrateMax:k,frameRate:M,scaleResolutionDownBy:H}=t._encoderConfig;k&&(h.maxBitrate=1e3*k),(Ae(E=t._hints).call(E,Zt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(M&&(h.maxFramerate=Vn(M)),H&&H>=1&&(h.scaleResolutionDownBy=H))}let{maxFramerate:x}=Y("ENCODER_CONFIG_LIMIT");if(x&&typeof x=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,x):x),Y("DSCP_TYPE")&&ec()){var b;let k=Y("DSCP_TYPE");Ae(b=["very-low","low","medium","high"]).call(b,k)&&(h.networkPriority=k)}let C=r.getParameters(),U=(c=C.encodings)===null||c===void 0?void 0:c[0];Sr()&&!U&&(d.encodings=[h]),U&&Object.assign(U,h),Object.assign(C,d),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await r.setParameters(C),await async function(k,M,H){try{var K;if(!Dt().supportSetRtpSenderParameters||!function(ce){return ce==="vp9"||ce==="av1"}(k)||!Y("ENABLE_SVC"))return;let X={},se={},te=M.getParameters(),Z=(K=te.encodings)===null||K===void 0?void 0:K[0];se.scalabilityMode=dv(H),Z&&Object.assign(Z,se),Object.assign(te,X),await M.setParameters(te),N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(te.encodings)))}catch(X){N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",X)}}(this.store.codec,r,Y("SVC_MODE"))}async updateAdaptation(t,r){var i,c;if(!t)return N.debug("[updateAdaptation] no rtpSender found");if(!Dt().supportSetRtpSenderParameters)return N.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let d={},{bitrateMax:h,frameRate:p,scaleResolutionDownBy:m}=r;h&&(d.maxBitrate=1e3*h),p&&(d.maxFramerate=Vn(p)),m&&m>=1&&Ae(i=["vp8","vp9"]).call(i,this.store.codec)&&(d.scaleResolutionDownBy=m);let _=t.getParameters(),E=(c=_.encodings)===null||c===void 0?void 0:c[0];E&&Object.assign(E,d),Object.assign(_,{});try{await t.setParameters(_),N.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(_.encodings)))}catch(x){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?N.debug("[updateAdaptation] peerConnection not connected}"):N.debug("[updateAdaptation] updateRtpSenderEncodings failed",x):N.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!Dt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let c=t[i],d=r[i];d instanceof ar&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,i){let c=yn(t);return r.forEach((d,h)=>{let p=i[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(xh(m,d),RU(m,d,this.store.codec))}),Vc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let m=0;m<t.length;m++){var i,c,d,h,p;let _=t[m],E=r[m];if(E instanceof ar&&!Ae(i=E._hints).call(i,Zt.LOW_STREAM)&&(c=E._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=E._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=E._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){let x={},b={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};x.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let C=_.sender.getParameters();await _.sender.setParameters(Object.assign(C,x))}}}async applySimulcastEncodings(t,r){if(!Sr()&&t.length===r.length)for(let i=0;i<t.length;i++){let c=r[i];if(c instanceof ar&&this.isVP8Simulcast(c)){let d=t[i],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];let m=d.sender.getParameters();await d.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(t){var r,i,c,d,h;return!!(t instanceof ar&&Y("SIMULCAST")&&this.store.codec==="vp8"&&!Ae(r=t._hints).call(r,Zt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,i,c){if(Y("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?d=>{this.logSDPExchange(d,"answer",i==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(Dt().supportPCSetConfiguration){let r=Bd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}t.isPreallocation&&(this.isPreallocation=!0)}},Ge(Nt.prototype,"updateRemoteRTPCapabilities",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"updateRemoteRTPCapabilities"),Nt.prototype),Ge(Nt.prototype,"connect",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"connect"),Nt.prototype),Ge(Nt.prototype,"updateRemoteConnect",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"updateRemoteConnect"),Nt.prototype),Ge(Nt.prototype,"createDataChannels",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"createDataChannels"),Nt.prototype),Ge(Nt.prototype,"receive",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"receive"),Nt.prototype),Ge(Nt.prototype,"batchReceive",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"batchReceive"),Nt.prototype),Ge(Nt.prototype,"stopReceiving",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"stopReceiving"),Nt.prototype),Ge(Nt.prototype,"muteRemote",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"muteRemote"),Nt.prototype),Ge(Nt.prototype,"unmuteRemote",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"unmuteRemote"),Nt.prototype),Ge(Nt.prototype,"muteLocal",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"muteLocal"),Nt.prototype),Ge(Nt.prototype,"unmuteLocal",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"unmuteLocal"),Nt.prototype),Ge(Nt.prototype,"close",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"close"),Nt.prototype),Ge(Nt.prototype,"updateEncoderConfig",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"updateEncoderConfig"),Nt.prototype),Ge(Nt.prototype,"updateSendParameters",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"updateSendParameters"),Nt.prototype),Ge(Nt.prototype,"replaceTrack",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"replaceTrack"),Nt.prototype),Ge(Nt.prototype,"updateAdaptation",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"updateAdaptation"),Nt.prototype),Ge(Nt.prototype,"getRemoteSSRC",[hn],Object.getOwnPropertyDescriptor(Nt.prototype,"getRemoteSSRC"),Nt.prototype),Nt);function hn(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{d()}},r}function WC(e,t){let r=document.createElement("video"),i=document.createElement("canvas");r.setAttribute("style","display:none"),i.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),i.width=Vn(t.width),i.height=Vn(t.height);let c=Vn(t.framerate||15);document.body.append(r),document.body.append(i);let d=e._mediaStreamTrack;r.srcObject=new MediaStream([d]),r.play();let h=i.getContext("2d");if(!h)throw new le(z.UNEXPECTED_ERROR,"can not get canvas context");let p=Dt(),m=i.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0];m.canvas||(m.canvas=i),i.startCapture=()=>{if(!r)return i.stopCapture&&i.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){let E=r.videoWidth,x=r.videoHeight/E,b=i.width*x;Math.abs(b-i.height)>=2&&(N.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(b)),i.height=b)}h.drawImage(r,0,0,i.width,i.height),m.requestFrame&&m.requestFrame(),d!==e._mediaStreamTrack&&(d=e._mediaStreamTrack,r.srcObject=new MediaStream([d]))},i.stopCapture=q0(()=>i.startCapture&&i.startCapture(),c);let _=m.stop;return m.stop=()=>{_.call(m),r&&(r.remove(),r.srcObject=null,r=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),N.debug("clean low stream renderer")},m}var o5=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(o5||{}),Ga=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Ga||{}),dt=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(dt||{}),ms=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(ms||{}),pn=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(pn||{}),Cv=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(Cv||{});let vd=1e3,Tv=6,sm=3,Bae=Math.max(Tv,sm,60);function rt(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function c5(e){let t={[pn.CONN_TYPE]:0,[pn.RTT]:e.rtt,[pn.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[pn.CONN_TYPE]=1),r==="tcp"&&(t[pn.CONN_TYPE]=3),r==="tls"&&(t[pn.CONN_TYPE]=4);break}case"srflx":t[pn.CONN_TYPE]=2;break;case"unknown":t[pn.CONN_TYPE]=5;break;default:t[pn.CONN_TYPE]=0}return t}function l5(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class d5 extends br{constructor(t){super(),W(this,"store",void 0),W(this,"uploadWRTCStatsTimer",void 0),W(this,"uploadOutboundDenoiserStatsTimer",void 0),W(this,"uploadExtStatsTimer",void 0),W(this,"uploadExtUsageStatsTimer",void 0),W(this,"uploadInboundExtStatsTimer",void 0),W(this,"requestStats",void 0),W(this,"requestTransportStats",void 0),W(this,"requestLocalMedia",void 0),W(this,"requestRemoteMedia",void 0),W(this,"requestAllTracks",void 0),W(this,"requestVideoIsReady",void 0),W(this,"requestUploadStats",void 0),W(this,"requestUpload",void 0),W(this,"uploadOutboundStarted",!1),W(this,"uploadInboundStarted",!1),W(this,"uploadTransportStarted",!1),W(this,"uploadBaseStatsStarted",!1),W(this,"uploadExtensionUsageStarted",!1),W(this,"lastRecvStats",void 0),W(this,"lastSendStats",void 0),W(this,"lastRefRecvStats",void 0),W(this,"lastRefSendStats",void 0),W(this,"lastNormalRecvStats",void 0),W(this,"lastNormalSendStats",void 0),W(this,"lastExtendStats",{}),W(this,"needUploadStats",{}),W(this,"needUploadRenderFreezeTime",!0),W(this,"lastUploadCompensateTime",-1),W(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let r=t%sm==0,i=t%Tv==0,c=t%60==0,d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var p;let m={};if(this.uploadTransportStarted&&d){let E=this.getTransportStats(d,h,r);E&&(m.misc=[E])}if(this.uploadOutboundStarted&&d){let E=this.getOutboundStats(d,i?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats,c);E&&(m.outbound=[E])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(t);let E=this.getInboundStats(h,i?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);E&&(m.inbound=E)}let _=(p=this.requestTransportStats)===null||p===void 0?void 0:p.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[Cv.RTC_PEER_CONNECTION_STATE]=O0[_]):m.misc=[{addition:{[Cv.RTC_PEER_CONNECTION_STATE]:O0[_]}}]),this.needUploadStats.sendType&&(Array.isArray(m.outbound)&&m.outbound[0]&&m.outbound[0].high&&(m.outbound[0].high[o5.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(m)}this.lastRecvStats=h,this.lastSendStats=d,i&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),r&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,i;let c=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(c&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Cv.RTC_PEER_CONNECTION_STATE]:O0[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Bae+1&&(t=1)},vd)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let r=t%sm==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;let d=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let h={};if(this.uploadInboundStarted&&d){let p=this.requestRemoteMedia()||[],m=[];p.forEach(_=>{let[E,x]=_,b={peer:E.uid};if(E._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(E._videoSSRC)&&x.has(Fe.VIDEO)&&E.videoTrack){let C=function(U,k,M){if(!k.videoRecv.find(K=>K.ssrc===U))return;let H={};if(M&&M._player){let K=M._player,{renderFreezeAccTime2:X,videoElementStatus:se}=K;if(bo.visibility==="visible"&&se===Os.PLAYING&&Dt().supportRequestVideoFrameCallback){let te=Math.min(6e3,X);K.renderFreezeAccTime2=Math.max(0,X-te),rt(H,Ga.Video_Render_Freeze_Time_Render2,te),Y("USE_NEW_RENDER_FREEZE_TIME")&&rt(H,Ga.Video_Render_Freeze_Time_Render,te)}}return H}(E._videoSSRC,d,E.videoTrack);C&&(b.video=C)}b.video&&m.push(b)}),m.length>0&&(h.inbound=m,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,r,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[pn.RTT]:t.rtt,[pn.CONN_TYPE]:void 0,[pn.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let c=c5(t);if(this.store.useP2P){if(r){let d=c5(r);c[pn.CONN_TYPE]+=d[pn.CONN_TYPE]<<3}c[pn.CONN_TYPE]+=110}else c[pn.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(t,r,i,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;let h=this.requestLocalMedia();if(!h||h.length===0)return;let p,m,_;return h.forEach(E=>{let[x,{track:b,ssrcs:C}]=E;switch(x){case Se.LocalVideoLowTrack:case Se.LocalVideoTrack:if(x===Se.LocalVideoTrack){var U;let k=function(X,se,te,Z,ce,fe){let xe=se.videoSend.find(at=>at.ssrc===X);if(!xe)return;let Te={},{sentFrame:_t,inputFrame:vt}=xe;if(Z&&(rt(Te,Ga.Video_Send_Qp_Sum,xe.qpSumPerFrame),vt&&_t)){let at=vt.frameRate,Vt=_t.frameRate;Te[Ga.Video_Send_Freeze]=function(Mt,js){let ge=!0;return ge=!(Mt<=5)&&(Mt<=10?js<3:Mt<=20?js<4:js<5),ge}(at,Vt)?1:0}if(ce){switch(_t&&(rt(Te,dt.Video_Send_Height,_t.height),rt(Te,dt.Video_Send_Width,_t.width),rt(Te,dt.Video_Send_Frame_Rate,_t.frameRate)),Te[dt.Video_Send_Disabled]=te._originMediaStreamTrack&&!te._originMediaStreamTrack.enabled||te._mediaStreamTrack&&!te._mediaStreamTrack.enabled?1:0,xe.adaptionChangeReason){case"none":Te[dt.Video_Send_Adaptation]=0;break;case"cpu":Te[dt.Video_Send_Adaptation]=1;break;case"bandwidth":Te[dt.Video_Send_Adaptation]=2;break;case"other":Te[dt.Video_Send_Adaptation]=3}let at=0;xe.adaptionChangeReason&&(at+=l5(xe.adaptionChangeReason)),se.qualityLimitationReason&&(at+=l5(se.qualityLimitationReason)<<3),Te[dt.Video_Send_Adaptation]=at,Te[dt.Video_Send_Player_Status]=z0[te._player?te._player.videoElementStatus:"uninit"],rt(Te,dt.Video_Send_Nacks,xe.nacksCount),rt(Te,dt.Video_Send_Plis,xe.plisCount),rt(Te,dt.Video_Send_Firs,xe.firsCount),rt(Te,dt.Video_Send_Avg_Encode,xe.avgEncodeMs),rt(Te,dt.Video_Send_Huge_Frame_Sent,xe.hugeFramesSent),rt(Te,dt.Video_Send_Bytes_Retransmit,xe.retransmittedBytesSent),rt(Te,dt.Video_Send_Packages_Retransmit,xe.retransmittedPacketsSent),rt(Te,dt.Video_Send_Key_Frames_Encoded,xe.keyFramesEncoded);let Vt=ce.videoSend.find(Mt=>Mt.ssrc===X);if(Vt){let Mt=vd*sm;Vt.timestamp&&xe.timestamp&&(Mt=xe.timestamp-Vt.timestamp),Vt.packets!=null&&xe.packets!=null&&rt(Te,dt.Video_Send_Package_Rate,1e3*(xe.packets-Vt.packets)/Mt),xe.packetsLost!=null&&Vt.packetsLost!=null&&rt(Te,dt.Video_Send_Package_Lost,xe.packetsLost-Vt.packetsLost),Vt.bytes!=null&&xe.bytes!=null&&rt(Te,dt.Video_Send_Bitrate,8*(xe.bytes-Vt.bytes)/Mt)}}return Te}(C[0].ssrcId,t,b,r,i),M=b.__className__==="CameraVideoTrack"?3:Ae(U=b._hints).call(U,Zt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==M||d)&&(this.needUploadStats={sendType:M},this.lastExtendStats.sendType=M);let H=b&&function(X,se,te,Z){let ce=se.videoSend.find(xe=>xe.ssrc===X);if(!ce)return null;let fe={};if(Z){let xe=ce.inputFrame,Te=xe&&xe.height||te.videoHeight||0,_t=xe&&xe.width||te.videoWidth||0,vt=xe&&xe.frameRate||0;rt(fe,dt.Video_Capture_Height,Te),rt(fe,dt.Video_Capture_Width,_t),rt(fe,dt.Video_Capture_Frame_Rate,vt)}return fe}(C[0].ssrcId,t,b,!!i),K=function(X,se){let te={};return se&&(rt(te,dt.Video_Send_Retransmit,X.bitrate.retransmit),rt(te,dt.Video_Send_Target_Encoded,X.bitrate.targetEncoded),rt(te,dt.Video_Send_Actual_Encoded,X.bitrate.actualEncoded),rt(te,dt.Video_Send_Transmit,X.bitrate.transmit),rt(te,dt.Video_Send_Bandwidth,X.sendBandwidth)),te}(t,!!i);m=Object.assign({},k,H,K)}else _=function(k,M,H,K,X){let se=M.videoSend.find(Z=>Z.ssrc===k);if(!se)return;let te={};if(K){let Z=se.sentFrame;Z&&(rt(te,dt.Video_Send_Low_Height,Z.height),rt(te,dt.Video_Send_Low_Width,Z.width),rt(te,dt.Video_Send_Low_Frame_Rate,Z.frameRate));let ce=K.videoSend.find(fe=>fe.ssrc===k);if(ce){let fe=vd*Tv;ce.timestamp&&se.timestamp&&(fe=se.timestamp-ce.timestamp),ce.packets!=null&&se.packets!=null&&rt(te,dt.Video_Send_Low_Package_Rate,1e3*(se.packets-ce.packets)/fe),se.packetsLost!=null&&ce.packetsLost!=null&&rt(te,dt.Video_Send_Low_Package_Lost,se.packetsLost-ce.packetsLost),ce.bytes!=null&&se.bytes!=null&&rt(te,dt.Video_Send_Low_Bitrate,8*(se.bytes-ce.bytes)/fe)}}return te}(C[0].ssrcId,t,0,i);break;case Se.LocalAudioTrack:p=b&&function(k,M,H,K,X,se){let te=M.audioSend.find(ce=>ce.ssrc===k);if(!te)return;let Z={};if(X){Z[dt.Audio_Send_Disabled]=H._originMediaStreamTrack&&!H._originMediaStreamTrack.enabled||H._mediaStreamTrack&&!H._mediaStreamTrack.enabled?1:0;let ce=100*H._source.getAccurateVolumeLevel(),fe=te.inputLevel;if(fe!=null){let Te=Math.ceil(50*Math.log10(100*fe+1));rt(Z,dt.Audio_Send_Level,Te)}rt(Z,dt.Audio_Capture_PCM_Level,ce),rt(Z,dt.Audio_Send_AEC_Return_Loss,te.aecReturnLoss),rt(Z,dt.Audio_Send_AEC_Return_Loss_Enhancement,te.aecReturnLossEnhancement),rt(Z,dt.Audio_Send_Bytes_Retransmit,te.retransmittedBytesSent),rt(Z,dt.Audio_Send_Packages_Retransmit,te.retransmittedPacketsSent),Z[dt.Audio_Send_Freeze]=0;let xe=X.audioSend.find(Te=>Te.ssrc===k);if(xe){let Te=vd*Tv;xe.timestamp&&te.timestamp&&(Te=te.timestamp-xe.timestamp),xe.bytes!=null&&te.bytes!=null&&rt(Z,dt.Audio_Send_Bitrate,8*(te.bytes-xe.bytes)/Te),xe.packets!=null&&te.packets!=null&&rt(Z,dt.Audio_Send_Package_Rate,1e3*(te.packets-xe.packets)/Te)}}return Z}(C[0].ssrcId,t,b,0,i)}}),{high:m,low:_,audio:p}}getInboundStats(t,r,i,c){if(!this.requestRemoteMedia)return;let d=this.requestRemoteMedia()||[],h=[];return d.forEach(p=>{let[m,_]=p,E={peer:m.uid};if(_.has(Fe.VIDEO)&&m.videoTrack){let x=m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)||!1,b=m.videoTrack?function(C,U,k,M,H,K,X,se){let te=U.videoRecv.find(at=>at.ssrc===C);if(!te)return;let Z={},{receivedFrame:ce,outputFrame:fe,decodeFrameRate:xe}=te;rt(Z,ms.Video_Render_Frame_Rate_Decode,xe),te.framesRateFirefox&&rt(Z,ms.Video_Recv_Frame_Rate,te.framesRateFirefox),ce&&rt(Z,ms.Video_Recv_Frame_Rate,ce.frameRate),rt(Z,ms.Video_Recv_Frame_Dropped,te.framesDroppedCount),rt(Z,ms.Video_Recv_Bytes_Retransmit,te.retransmittedBytesReceived),rt(Z,ms.Video_Recv_Packages_Retransmit,te.retransmittedPacketsReceived),rt(Z,ms.Video_Recv_Packages_Discarded,te.packetsDiscarded),rt(Z,ms.Video_Recv_Avg_Decode,te.avgDecodeMs),rt(Z,ms.Video_Recv_Avg_Processing_Delay,te.avgProcessingDelayMs),rt(Z,ms.Video_Recv_Avg_Assembly_Time,te.avgFramesAssembledFromMultiplePacketsMs),rt(Z,ms.Video_Recv_Avg_Inter_Frame_Delay,te.avgInterFrameDelayMs),rt(Z,ms.Video_Recv_Key_Frames_Decoded,te.keyFramesDecoded);let Te=se&&se.videoRecv.find(at=>at.ssrc===C);if(Te){let at=U.timestamp-se.timestamp||vd;te.packetsLost!=null&&Te.packetsLost!=null&&rt(Z,ms.Video_Recv_Package_Lost,te.packetsLost-Te.packetsLost),Te.bytes!=null&&te.bytes!=null&&rt(Z,ms.Video_Recv_Bitrate,8*(te.bytes-Te.bytes)/at),Te.packets!=null&&te.packets!=null&&rt(Z,ms.Video_Recv_Package_Rate,1e3*(te.packets-Te.packets)/at)}let _t=K&&K.videoRecv.find(at=>at.ssrc===C);if(_t&&(rt(Z,Ga.Video_Recv_Qp_Sum,te.qpSumPerFrame),Z[Ga.Video_Recv_Freeze]=M&&rm.isRemoteVideoFreeze(k,te,_t)?1:0),X){var vt;let at=X.videoRecv.find(Mt=>Mt.ssrc===C);ce?(rt(Z,dt.Video_Recv_Height,ce.height),rt(Z,dt.Video_Recv_Width,ce.width)):k&&(rt(Z,dt.Video_Recv_Height,k._videoHeight||0),rt(Z,dt.Video_Recv_Width,k._videoWidth||0)),fe&&rt(Z,dt.Video_Recv_Frame_Rate_Output,fe.frameRate);let Vt=(vt=k._player)===null||vt===void 0?void 0:vt.rendFrameRate.toFixed(0);if(Vt&&rt(Z,dt.Video_Render_Frame_Rate_Render,+Vt),rt(Z,dt.Video_Recv_Jitter_Buffer,te.jitterBufferMs),rt(Z,dt.Video_Recv_Current_Delay,te.currentDelayMs),rt(Z,dt.Video_Recv_Firs,te.firsCount),rt(Z,dt.Video_Recv_Nacks,te.nacksCount),rt(Z,dt.Video_Recv_Plis,te.plisCount),k){Z[dt.Video_Recv_Disabled]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1;let Mt=k._player;if(Mt){let{freezeTimeCounterList:js,renderFreezeAccTime:ge,renderFreezeAccTime2:Ie,videoElementStatus:Ve}=Mt;if(js&&js.length>0&&rt(Z,Ga.Video_Render_Freeze_Time,js.splice(0,1)[0]),H&&bo.visibility==="visible"&&Ve===Os.PLAYING&&Dt().supportRequestVideoFrameCallback){let we=Math.min(6e3,Ie);Mt.renderFreezeAccTime2=Math.max(0,Ie-we),rt(Z,Ga.Video_Render_Freeze_Time_Render2,we);let P=Math.min(6e3,ge);Mt.renderFreezeAccTime=Math.max(0,ge-P),rt(Z,Ga.Video_Render_Freeze_Time_Render,Y("USE_NEW_RENDER_FREEZE_TIME")?we:P)}if(typeof te.totalFreezesDuration=="number"){let we=at&&at.totalFreezesDuration?te.totalFreezesDuration-at.totalFreezesDuration:te.totalFreezesDuration;rt(Z,dt.Video_Render_Freeze_Duration,1e3*we)}}}if(Z[dt.Video_Recv_Player_Status]=z0[k._player?k._player.videoElementStatus:"uninit"],at&&te.totalInterFrameDelay!==void 0&&te.totalSquaredInterFrameDelay!==void 0&&at.totalInterFrameDelay!==void 0&&at.totalSquaredInterFrameDelay!==void 0){let Mt=te.totalInterFrameDelay-at.totalInterFrameDelay,js=te.totalSquaredInterFrameDelay-at.totalSquaredInterFrameDelay,ge=te.framesDecodeCount-at.framesDecodeCount,Ie=Mt/ge*1e3,Ve=Math.round(1e3*Math.sqrt((js-Math.pow(Mt,2)/ge)/ge));!isNaN(Ve)&&Ie+Ve>Math.max(3*Ie,Ie+150)&&(Z[dt.Video_Recv_I_Frame_Delay]=Ve)}}return Z}(m._videoSSRC,t,m.videoTrack,x===!0,this.needUploadRenderFreezeTime,r,i,c):void 0;b&&(E.video=b)}if(_.has(Fe.AUDIO)&&m.audioTrack){let x=m.audioTrack?function(b,C,U,k,M,H){let K=C.audioRecv.find(Z=>Z.ssrc===b);if(!K)return;let X={};rt(X,ms.Audio_Recv_Jitter,K.jitterMs),rt(X,ms.Audio_Recv_Bytes_Retransmit,K.retransmittedBytesReceived),rt(X,ms.Audio_Recv_Packages_Retransmit,K.retransmittedPacketsReceived),rt(X,ms.Audio_Recv_Packages_Discarded,K.packetsDiscarded),rt(X,ms.Audio_Recv_Avg_Processing_Delay,K.avgProcessingDelayMs);let se=H&&H.audioRecv.find(Z=>Z.ssrc===b);if(se){let Z=vd;K.packets!=null&&se.packets!=null&&rt(X,ms.Audio_Recv_Package_Rate,1e3*(K.packets-se.packets)/Z),K.packetsLost!=null&&se.packetsLost!=null&&rt(X,ms.Audio_Recv_Package_Lost,K.packetsLost-se.packetsLost)}if(k){let{receivedFrames:Z,droppedFrames:ce}=K;Z!=null&&ce!=null&&(X[Ga.Audio_Recv_Freeze]=(te=Z)===0||100*ce/te>20?1:0)}var te;if(M){let Z=100*U._source.getAccurateVolumeLevel(),ce=K.outputLevel;if(ce!=null){let xe=Math.ceil(50*Math.log10(100*ce+1));rt(X,dt.Audio_Render_Level,xe)}rt(X,dt.Audio_Recv_PCM_Level,Z),U&&(X[dt.Audio_Recv_Disabled]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),rt(X,dt.Audio_Recv_Jitter_Buffer,K.jitterBufferMs),rt(X,dt.Audio_Recv_Current_Delay,K.jitterBufferMs),X[dt.Audio_Recv_Player_Status]=z0[un.getPlayerState(U.getTrackId())];let fe=M.audioRecv.find(xe=>xe.ssrc===b);if(fe){fe.bytes!=null&&K.bytes!=null&&rt(X,dt.Audio_Recv_Bitrate,8*(K.bytes-fe.bytes)/(vd*sm));let xe=K.concealedSamples-fe.concealedSamples;xe>0&&rt(X,dt.Audio_Recv_Concealed_Samples,xe);let Te=K.totalSamplesReceived-fe.totalSamplesReceived;Te>0&&rt(X,dt.Audio_Recv_Total_Samples_Received,Te);let _t=K.freezeSamples80-fe.freezeSamples80;_t>0&&rt(X,dt.Audio_Render_Freeze_Samples_80ms,_t);let vt=K.freezeSamples200-fe.freezeSamples200;vt>0&&rt(X,dt.Audio_Render_Freeze_Samples_200ms,vt);let at=K.freezeMs80-fe.freezeMs80;rt(X,dt.Audio_Render_Freeze_Time_80ms,at<0?0:at);let Vt=K.freezeMs200-fe.freezeMs200;rt(X,dt.Audio_Render_Freeze_Time_200ms,Vt<0?0:Vt)}}return X}(m._audioSSRC,t,m.audioTrack,r,i,c):void 0;x&&(E.audio=x)}(E.video||E.audio)&&h.push(E)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(r=>r instanceof Hf);if(t&&t._external.getDenoiserStats){let r=t._external.getDenoiserStats();r&&this.requestUpload(Kf.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,i]=t;i.has(Fe.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),i.has(Fe.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let r=Date.now(),i={connectionInterval:Y("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r},c=[],d=this.requestAllTracks&&this.requestAllTracks()||[];for(let _ of d)!_.muted&&_.enabled&&(c=c.concat(await _.getProcessorUsage()));let h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[_,E]of h)E.has(Fe.VIDEO)&&_.videoTrack&&(c=c.concat(await _.videoTrack.getProcessorUsage())),E.has(Fe.AUDIO)&&_.audioTrack&&(c=c.concat(await _.audioTrack.getProcessorUsage()));if(c.length===0)return;i.details=function(_,E){let x={};for(let{id:k,value:M,level:H,direction:K}of _){var b;let X=(b=E.get(k))!==null&&b!==void 0?b:0,se=M===2?X+Y("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:X;var C,U;E.set(k,se),x[k]?(M===2&&(x[k].value=M),H>x[k].level&&(x[k].level=H),K==="remote"&&(x[k].remoteUidCount+=1),x[k].totalTs=(C=E.get(k))!==null&&C!==void 0?C:0):x[k]={value:M,level:H,remoteUidCount:K==="local"?0:1,totalTs:(U=E.get(k))!==null&&U!==void 0?U:0}}return Object.keys(x).map(k=>{let{level:M,value:H,totalTs:K}=x[k];return{id:k,level:M,value:H,totalTs:K}})}(c,t);let p=Date.now(),m=p>r?p:r+1;this.requestUpload&&this.requestUpload(Kf.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:m})},Y("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let Wae=Y("ICE_RESTART_INTERVAL"),Rv=new Map,Th=new Map,Jc=[Ps.UDP_TCP_RELAY,Ps.TCP_RELAY,Ps.RELAY],GC=Y("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Dt().supportPCSetConfiguration;function u5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=Rv.get(e.id);r&&(window.clearTimeout(r),Rv.delete(e.id));let i=Th.get(e.id);t&&i&&i.index===Jc.length-1&&(N.debug("[".concat(e.id,"] reset ICE restart policy")),Th.delete(e.id))}function h5(e,t,r){if(Rv.size===0&&Th.size===0&&(Array.isArray(Y("RESTART_SEQUENCE"))&&Y("RESTART_SEQUENCE").length>0&&!function(p,m){if(p.length!==m.length)return!1;for(let _=0;_<p.length;_+=1){let E=p[_];if(p.filter(x=>x===E).length!==m.filter(x=>x===E).length)return!1}return!0}(Jc,Y("RESTART_SEQUENCE"))&&(Jc=Y("RESTART_SEQUENCE").filter(p=>{var m;if(Ae(m=Object.values(Ps)).call(m,p))return!0}),N.debug("use reconnection policy from config distribution, queues: ".concat(Jc.join(" => ")))),GC=Y("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Dt().supportPCSetConfiguration),Jc.length===0)return void r();let i,{index:c=0,type:d}=Th.get(e.id)||{};if(GC&&d===Ps.RELAY)return void r();let h=d&&c>=Jc.length-1;if(GC)d=Ps.RELAY;else{if(h)return void r();d?(c++,d=Jc[c]):(d=Jc[0],c=0)}N.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),t(d),Th.set(e.id,{index:c,type:d}),i=window.setTimeout(()=>h5(e,t,r),Wae),Rv.set(e.id,i)}var bt;function p5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Co(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?p5(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function f5(e){var t,r,i,c=2;for(typeof Symbol<"u"&&(r=n0,i=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new Nv(t.call(e));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Nv(e){function t(r){if(Object(r)!==r)return je.reject(new TypeError(r+" is not an object."));var i=r.done;return je.resolve(r.value).then(function(c){return{value:c,done:i}})}return Nv=function(r){this.s=r,this.n=r.next},Nv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?je.resolve({value:r,done:!0}):t(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?je.reject(r):t(i.apply(this.s,arguments))}},new Nv(e)}let nm=(bt=class extends br{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Je.StateChange,t,this._state)}constructor(e,t){super(),W(this,"isPlanB",void 0),W(this,"store",void 0),W(this,"statsUploader",void 0),W(this,"connection",void 0),W(this,"localTrackMap",new Map),W(this,"remoteUserMap",new Map),W(this,"localDataChannels",[]),W(this,"remoteDataChannelMap",new Map),W(this,"pendingLocalTracks",[]),W(this,"pendingRemoteTracks",[]),W(this,"pendingLocalDataChannels",[]),W(this,"pendingRemoteDataChannels",[]),W(this,"statsCollector",void 0),W(this,"shouldForwardP2PCreation",void 0),W(this,"iceFailedCount",0),W(this,"dtlsFailedCount",0),W(this,"mutex",void 0),W(this,"_state",Gt.Disconnected),W(this,"_pcStatsUploadType",Y("NEW_ICE_RESTART")?nc.FIRST_CONNECTION:nc.OLD_FIRST_CONNECTION),W(this,"_isStartRestartIce",!1),W(this,"_restartTimer",void 0),W(this,"_isTryConnecting",!1),W(this,"_iceError",null),W(this,"_forceTurn",!1),W(this,"_isWaitPcToRePub",!1),W(this,"handleMuteLocalTrack",async(r,i,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Gt.Connected)return void c(new he(z.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let h=this.filterTobeMutedTracks(r);if(h.length===0)return void i();let p=h.find(_=>_[0]==="videoLowTrack");if(p){let _=p[1];this.store.enableInstantMuteRestore?(_.track._originMediaStreamTrack.enabled=!1,N.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):_.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?N.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(_=>{let[,{id:E}]=_;return E}));let m=this.createMuteMessage(h);await er(this,Je.RequestMuteLocal,m),i()}catch(h){c(h)}finally{d()}}),W(this,"handleUnmuteLocalTrack",async(r,i,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Gt.Connected)return void c(new he(z.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void i();let p=h.find(_=>_[0]==="videoLowTrack");if(p){let _=p[1];if(this.store.enableInstantMuteRestore)_.track._originMediaStreamTrack.enabled=!0,N.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(_.track._originMediaStreamTrack.stop(),!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dt().supportDualStreamEncoding){let E=r._mediaStreamTrack.clone();_.track._mediaStreamTrack=E,_.track._originMediaStreamTrack=E}else{let E=WC(r,Mf(this,Je.RequestLowStreamParameter));_.track._mediaStreamTrack=E,_.track._originMediaStreamTrack=E}await new je((E,x)=>{this.handleReplaceTrack(_.track,E,x,!0)})}}this.store.enableInstantMuteRestore?N.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(_=>{let[,{id:E}]=_;return E}));let m=this.createUnmuteMessage(h);await er(this,Je.RequestUnmuteLocal,m),i()}catch(h){c(h)}finally{d()}}),W(this,"handleUpdateVideoEncoder",async(r,i,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let m=this.localTrackMap.get(Se.LocalVideoTrack);if(!this.connection||!m||m.track!==r||this.state!==Gt.Connected)return void i();let{id:_,track:E}=m;await this.connection.updateSendParameters(_,E),await this.connection.updateEncoderConfig(_,E),this.emit(Je.UpdateVideoEncoder,E),i()}catch(m){c(m)}finally{var p;(p=h)===null||p===void 0||p()}}),W(this,"handleUpdateVideoSendParameters",async(r,i,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let h=this.localTrackMap.get(Se.LocalVideoTrack);if(!this.connection||!h||h.track!==r||this.state!==Gt.Connected)return void i();let{id:p,track:m}=h;await this.connection.updateSendParameters(p,m),i()}catch(h){c(h)}finally{d()}}),W(this,"handleReplaceMixingTrack",async(r,i,c,d)=>{if(!this.connection||this.state!==Gt.Connected)return void i();let h=VC([r]),p;N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(p=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,h),i()}catch(_){c(_)}finally{var m;(m=p)===null||m===void 0||m()}}),W(this,"handleReplaceTrack",async(r,i,c,d)=>{let h;N.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var p;let _=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:x}]=E;return r===x});if(!this.connection||!_||this.state!==Gt.Connected)return void i();if(await((p=this.connection)===null||p===void 0?void 0:p.replaceTrack(r,_[1].id)),this.isPlanB){let E=_[1];E.id=r._mediaStreamTrack.id,this.localTrackMap.set(_[0],E)}if(_[0]===Se.LocalVideoTrack&&!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dt().supportDualStreamEncoding){let E=this.localTrackMap.get(Se.LocalVideoLowTrack);if(E){let x=r._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=x,E.track._originMediaStreamTrack=x,await new je((b,C)=>{this.handleReplaceTrack(E.track,b,C,!0)})}}i()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),W(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),W(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),W(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),W(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),W(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new d5(this.store),this.bindStatsUploaderEvents(),this.mutex=new Is("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Dt().supportUnifiedPlan||Y("CHROME_FORCE_PLAN_B")&&ec(),this.shouldForwardP2PCreation=Y("FORWARD_P2P_CREATION")&&Dt().supportPCSetConfiguration&&E0(),this.shouldForwardP2PCreation&&(this.connection=Sv(this.store),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var r;this.state=Gt.New,this._forceTurn=i5(e),N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Sv(this.store,e),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new he(z.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Y("NEW_ICE_RESTART")?nc.FIRST_CONNECTION:nc.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new he(z.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Gt.Connected){if(this.connection instanceof Ri&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),ze.reportApiInvoke(this.store.sessionId,{name:Or.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Er.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Je.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Gt.Connected}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return Ae(d=[Se.LocalVideoLowTrack,Se.LocalVideoTrack]).call(d,h)}),r=t.map(c=>{let[,{id:d}]=c;return d}),i=t.map(c=>{let[d]=c;return d});if(this.connection instanceof Ri){if(ze.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ae(e).call(e,this.store.codec)){let c=["vp9","vp8","h264"].find(d=>Ae(e).call(e,d));c&&(this.store.codec=c,N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ri&&this.connection.peerConnectionState!=="closed"&&Ae(e=[Gt.New,Gt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Gt.Connected){if(this.state===Gt.Disconnected)throw new he(z.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var i;Ae(i=this.pendingLocalDataChannels).call(i,r)||this.pendingLocalDataChannels.push(r)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{let i=Date.now();this.store.publish(r.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);let i=Date.now();this.store.publish(r.id+"","datachannel",void 0,i)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var i=this;return xi(function*(){let c=yield Ot(i.mutex.lock("From P2PChannel.publish"));try{var d;let h=i.connection&&Ae(d=["disconnected","failed"]).call(d,i.connection.peerConnectionState);if(!i.connection||i.state!==Gt.Connected||h){if(i.state===Gt.Disconnected)throw new he(z.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);let m=e.filter(_=>i.pendingLocalTracks.indexOf(_)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(m),void(h&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,ks.markPublishStart(i.store.clientId,i.store.pubId);let p=i.filterTobePublishedTracks(e,t,r);if(p.length===0)return void(yield Ot(i.tryToUnmuteAudio(e)));yield*yE(f5(i.doPublish(i.connection,p)))}finally{c()}})()}doPublish(e,t){var r=this;return xi(function*(){t.forEach(b=>{let{track:C,type:U}=b,k=Date.now();r.store.publish(C.getTrackId(),U===Se.LocalAudioTrack?"audio":"video",k)}),r.bindLocalTrackEvents(t);let i=t.map(b=>{let{track:C}=b;return C}),c=yield Ot(e.send(i,r.store.codec,r.store.audioCodec)),d=(yield Ot(c.next())).value,h=r.createGatewayPublishMessage(t,d),p;try{p=yield h}catch(b){throw c.throw(b),(b==null?void 0:b.code)===z.WS_ABORT&&t.forEach(C=>{let{track:U}=C;r.pendingLocalTracks.indexOf(U)===-1&&r.pendingLocalTracks.push(U)}),r.unbindLocalTrackEvents(t),b}let m=r.mapPubResToRemoteConfig(h,p,i),_=(yield Ot(c.next(m))).value;if(r.state===Gt.Disconnected)throw new he(z.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Y("ENABLE_VIDEO_SEI");let E=Y("ENABLE_ENCODED_TRANSFORM"),x=Y("ENABLE_AUDIO_METADATA");i.forEach(async b=>{let C=b.getRTCRtpTransceiver();if(!C||!E)return;let{interceptLocalVideoFrame:U,interceptLocalAudioFrame:k}=mv();b.trackMediaType===Fe.VIDEO?await U(C.sender,b):b.trackMediaType===Fe.AUDIO&&await k(C.sender,{metadata:x?()=>{let M=b.metadata.shift();return M&&M.value}:void 0})}),t.forEach(b=>{let{type:C}=b;r.statsCollector.addLocalStats(C)}),r.assignLocalTracks(t,_),r.statsUploader.startUploadOutboundStats(),t.forEach(b=>{let{track:C,type:U}=b,k=Date.now();r.store.publish(C.getTrackId(),U===Se.LocalAudioTrack?"audio":"video",void 0,k)})})()}async updateVideoStreamParameter(e,t){let r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof ar))return N.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:i}=r,c=function(d,h){let p={};return d.height&&d.width&&(p.scaleResolutionDownBy=bC(d,h)),p.maxFramerate=d.framerate?Vn(d.framerate):void 0,p.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,p}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==Se.LocalVideoLowTrack||!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dt().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{let d=i._originMediaStreamTrack;if(!d.canvas)return N.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(h,p){let m=h.canvas;p.width&&(m.width=Vn(p.width)),p.height&&(m.height=Vn(p.height)),p.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=q0(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},Vn(p.framerate)))})(d,e)}c.maxBitrate!=null&&(i._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=c.maxFramerate:i._encoderConfig.frameRate={max:c.maxFramerate}),N.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return xi(function*(){if(!t.connection||t.state!==Gt.Connected)return;let r=yield Ot(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let c=t.localTrackMap.get(Se.LocalVideoTrack);if(!c)throw new he(z.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Se.LocalVideoLowTrack))throw new he(z.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let d=[{track:t.getLowVideoTrack(c.track,e),type:Se.LocalVideoLowTrack}];if(yield*yE(f5(t.doPublish(t.connection,d))),c.track.muted||!c.track.enabled){var i;let h=(i=t.localTrackMap.get(Se.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;h!==void 0&&(yield Ot(t.connection.muteLocal([h])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ss(this,Je.RequestRePublish,this.pendingLocalTracks),this.emit(Je.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(N.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ss(this,Je.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:r,kind:i}=this.pendingRemoteTracks[t];(i!==Fe.AUDIO||r._audio_added_&&r._audioSSRC)&&(i!==Fe.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Ss(this,Je.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===Fe.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(Je.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Gt.Connected)return void e.forEach(i=>{let c=this.pendingLocalTracks.indexOf(i);c!==-1&&this.pendingLocalTracks.splice(c,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(i=>i[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Gt.Connected)return void e.forEach(r=>{let i=this.pendingLocalDataChannels.indexOf(r);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{let i=this.localDataChannels.indexOf(r);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Gt.Connected)return;let e=this.localTrackMap.get(Se.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[Se.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:c}]=i;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[c,{track:d}]=i;return{type:c,track:d}})),t.forEach(i=>{let[c]=i;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Gt.Connected)throw new he(z.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r=t.filter(i=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(i.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(i=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));let d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:p,id:m}=h;return p.uid===e.uid&&m===i.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),r.map(i=>i.id)}async subscribe(e,t,r,i,c){var d;if(!this.connection||this.state!==Gt.Connected)throw new he(z.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(e))!==null&&d!==void 0&&d.has(t))return;let h,p,m,_,E=this.connection.getPreMedia(r);if(E)N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),m=E.transceiver,h=E.track,p=E.mid,_=E.player,E.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:E.firstVideoRender});else if(c){let C=c.find(k=>{let{stream_type:M}=k;return M===t});if(!C)throw new he(z.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let U=await this.connection.receive(t,C.ssrcs,String(e._uintid),C.attributes);this.connection instanceof Ri&&(m=U.transceiver),h=U.track,p=U.id}else{let C=await this.connection.receive(t,[{ssrcId:r,rtx:i}],String(e._uintid),void 0);this.connection instanceof Ri&&(m=C.transceiver),h=C.track,p=C.id}if(t===Fe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new ph(h,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new hh(h,e.uid,e._uintid,this.store,_),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Si.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Si.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),_?e._videoTrack.once(Si.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Si.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),m&&Y("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:U}=mv();t==Fe.VIDEO?await C(m.receiver,{onSei:Y("ENABLE_VIDEO_SEI")&&(k=>{var M;return(M=e._videoTrack)===null||M===void 0?void 0:M._onSei(k)})}):t==Fe.AUDIO&&await U(m.receiver,{enableTopn:!!Y("ENABLE_AUDIO_TOPN"),enableMetadata:!!Y("ENABLE_AUDIO_METADATA"),enablePts:!!Y("ENABLE_AUDIO_PTS"),onMetadata:k=>{this.safeEmit(Je.AudioMetadata,k)},onPts:k=>{this.safeEmit(Je.AudioPts,k)}})}let x=this.remoteUserMap.get(e);x?x.set(t,p):this.remoteUserMap.set(e,new Map([[t,p]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let b=this.pendingRemoteTracks.findIndex(C=>{let{user:U,kind:k}=C;return U.uid===e.uid&&t===k});b!==-1&&(this.pendingRemoteTracks.splice(b,1),this.emit(Je.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Gt.Connected)throw new he(z.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var d;let{user:h,mediaType:p}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(p))});let t=[],r=new Map;e.forEach(c=>{if(!this.connection)return;let d=this.connection.getPreMedia(c.ssrcId);if(d){let{track:h,mid:p,transceiver:m,player:_}=d;r.set(c.ssrcId,{track:h,id:p,transceiver:m,player:_})}else t.push(c)});let i=await this.connection.batchReceive(t.map(c=>{let{user:d,mediaType:h,ssrcId:p,rtxSsrcId:m}=c;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(d._uintid)}}));t.forEach((c,d)=>{r.set(c.ssrcId,i[d])});for(let{user:c,mediaType:d,ssrcId:h}of e){let p=r.get(h);if(!p)return void N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));let{track:m,id:_,transceiver:E,player:x}=p;if(E&&Y("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:k}=mv();d==Fe.VIDEO?await U(E.receiver,{onSei:Y("ENABLE_VIDEO_SEI")&&(M=>{var H;return(H=c._videoTrack)===null||H===void 0?void 0:H._onSei(M)})}):d==Fe.AUDIO&&await k(E.receiver,{enableTopn:!!Y("ENABLE_AUDIO_TOPN"),enableMetadata:!!Y("ENABLE_AUDIO_METADATA"),enablePts:!!Y("ENABLE_AUDIO_PTS"),onMetadata:M=>{this.safeEmit(Je.AudioMetadata,M)},onPts:M=>{this.safeEmit(Je.AudioPts,M)}})}if(d===Fe.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(m):(c._audioTrack=new ph(m,c.uid,c._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),E&&c._audioTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(m):(c._videoTrack=new hh(m,c.uid,c._uintid,this.store,x),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),E&&c._videoTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(c,c._videoTrack)),Y("ENABLE_VIDEO_SEI")&&E){let{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:k}=mv();d==Fe.VIDEO?await U(E.receiver,{onSei:M=>{var H;(H=c._videoTrack)===null||H===void 0||H._onSei(M)}}):d==Fe.AUDIO&&await k(E.receiver)}let b=this.remoteUserMap.get(c);b?b.set(d,_):this.remoteUserMap.set(c,new Map([[d,_]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();let C=this.pendingRemoteTracks.findIndex(U=>{let{user:k,kind:M}=U;return k.uid===c.uid&&d===M});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(Je.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:m}=h;return t!==void 0?p.uid===e.uid&&t===m:p.uid===e.uid});if(i.forEach(h=>{let p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),this.connection&&this.state===Gt.Connected||r||i.forEach(h=>{let{kind:p}=h;var m;if(p===Fe.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(p===Fe.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Gt.Connected)return;let c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:p}]=h;return p}));let d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[p,{kind:m}]=h;var _,E;if(m===Fe.VIDEO&&p._videoSSRC&&((_=this.connection)===null||_===void 0||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===Fe.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),r||((E=p._videoTrack)===null||E===void 0||E._destroy(),p._videoTrack=void 0);else if(m===Fe.AUDIO){var x;this.unbindRemoteTrackEvents(p._audioTrack),!r&&((x=p._audioTrack)===null||x===void 0||x._destroy(),p._audioTrack=void 0)}}),d}async unsubscribeDataChannel(e,t){if(t.forEach(c=>{let d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;let r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(c=>{c._close()});let i=this.remoteDataChannelMap.get(e);return r.forEach(c=>{i&&i.delete(c.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:c,mediaType:d}of e){let h=this.pendingRemoteTracks.filter(p=>{let{user:m,kind:_}=p;return d!==void 0?m.uid===c.uid&&d===_:m.uid===c.uid});h.forEach(p=>{let m=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(h)}if(!this.connection||this.state!==Gt.Connected)return void t.forEach(c=>{let{user:d,kind:h}=c;var p;if(h===Fe.AUDIO)(p=d._audioTrack)===null||p===void 0||p._destroy(),d._audioTrack=void 0;else if(h===Fe.VIDEO){var m;(m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0}});let r=zi(e).call(e,(c,d)=>{let{user:h,mediaType:p}=d,m=this.filterTobeUnSubscribedTracks(h,p);return c.concat(m)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:d}]=c;return d}));let i=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[d,{kind:h}]=c;var p,m;if(h===Fe.VIDEO&&d._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===Fe.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0;else if(h===Fe.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),(_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==Gt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===Fe.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(Se.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(Se.LocalAudioTrack);if((t==null?void 0:t.track)instanceof qr){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[c]=i;return c!==Se.LocalAudioTrack}).filter(i=>{let[c]=i;return!(e&&c===Se.LocalVideoLowTrack)}).map(i=>{let[,{track:c}]=i;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return!(e&&i===Se.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,i,c){if(e){let h=this.localTrackMap.get(Se.LocalAudioTrack),p=i?this.localTrackMap.get(Se.LocalVideoLowTrack):this.localTrackMap.get(Se.LocalVideoTrack);ze.publish(this.store.sessionId,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(Zt.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;r||(r=[]);let h=r.find(m=>m instanceof Ar),p=i?(d=this.localTrackMap.get(Se.LocalVideoTrack))===null||d===void 0?void 0:d.track:r.find(m=>m instanceof ar);ze.publish(this.store.sessionId,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(Zt.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,i){let c=i===Fe.VIDEO?r._videoSSRC:r._audioSSRC;c&&ze.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Fe.VIDEO,audio:i===Fe.AUDIO,peerid:r.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:ks.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Is("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Sv(this.store),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Se.LocalAudioTrack);if((e==null?void 0:e.track)instanceof qr){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Gt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Se.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Se.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof ar||t&&t.track instanceof Ar?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(xn(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[i]=r;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Se.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ql(e).call(e,(r,i)=>r.level-i.level),e}async disconnectForReconnect(){this.connection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Gt.Reconnecting,Y("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Sv(this.store),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:i}]=e;switch(r){case Se.LocalVideoTrack:Ae(t=i._hints).call(t,Zt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case Se.LocalAudioTrack:i instanceof qr?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case Se.LocalVideoLowTrack:}}),this.emit(Je.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(xn(r).call(r)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Je.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(xn(r).call(r)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let r of this.pendingRemoteDataChannels){let{user:i,id:c}=r;if((e instanceof Xc?e.uid:e)===i.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:c}=r;if((e instanceof Xc?e.uid:e)===i.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return xi(function*(){if(!t.connection||t.state!==Gt.Connected)return;let r=yield Ot(t.mutex.lock("From P2PChannel.restartICE")),i;try{i=yield Ot(t.connection.restartICE(e));let d=yield Ot(i.next());if(d.done)return;let h=d.value,p=yield h;switch(BC(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Ps.UDP_TCP_RELAY:t._pcStatsUploadType=nc.UDP_TCP_RESTART;break;case Ps.TCP_RELAY:t._pcStatsUploadType=nc.TCP_RESTART;break;case Ps.RELAY:t._pcStatsUploadType=nc.RELAY_RESTART;break;default:t._pcStatsUploadType=nc.OLD_RESTART}t._isTryConnecting=!0,i.next(p)}catch(d){var c;(c=i)===null||c===void 0||c.throw(d)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(Se.LocalVideoTrack),r=this.localTrackMap.get(Se.LocalAudioTrack),i=e.videoSend.find(C=>C.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),c=e.audioSend.find(C=>C.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId));if(!i||!c)return 1;let d=ri(this,Je.NeedSignalRTT),h=i?i.rttMs:void 0,p=c?c.rttMs:void 0,m=h&&p?(h+p)/2:h||p,_=(m&&d?(m+d)/2:m||d)||0,E=100*e.sendPacketLossRate*.7/50+.3*_/1500,x=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,b=t==null?void 0:t.track;if(b&&b._encoderConfig&&b._hints.indexOf(Zt.SCREEN_TRACK)===-1){let C=b._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(C&&U){let k=(1e3*C-U)/(1e3*C);return eU[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][x]}}return x}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,c=i._audioSSRC,d=i._videoSSRC,h=e.audioRecv.find(U=>U.ssrc===c),p=e.videoRecv.find(U=>U.ssrc===d);if(!h&&!p)return void(t+=1);let m=ri(this,Je.NeedSignalRTT),_=e.rtt,E=(_&&m?(_+m)/2:_||m)||0,x=h?h.jitterMs:void 0,b=e.recvPacketLossRate,C=.7*b*100/50+.3*E/1500;x&&(C=.6*b*100/50+.2*E/1500+.2*x/400),t+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new je((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(N.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Gt.Connected)return;let i=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return e===h});if(!i)return;let c=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),i[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,i[1].id)),this.isPlanB){let d=i[1];d.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Se.LocalVideoTrack&&!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dt().supportDualStreamEncoding){let d=this.localTrackMap.get(Se.LocalVideoLowTrack);if(d){let h=e._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new je((p,m)=>{this.handleReplaceTrack(d.track,p,m,!0)})}}}filterTobePublishedTracks(e,t,r){let i=[],c=this.getAllTracks();e=Zu(e=e.filter(m=>c.indexOf(m)===-1));let d,h=!1,p=this.localTrackMap.get(Se.LocalAudioTrack);for(let m of e){if(m instanceof ar&&(this.localTrackMap.has(Se.LocalVideoTrack)||h?new he(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:m,type:Se.LocalVideoTrack}),h=!0),t)){let _=this.getLowVideoTrack(m,r);i.push({track:_,type:Se.LocalVideoLowTrack})}if(m instanceof Ar)if(p){let _=p.track;if(_ instanceof qr)UC([m]),_.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{let E=VC([_,m]);N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(E.getTrackId(),"]")),this.replaceTrack(_,E)}}else d instanceof qr?(UC([m]),d.addAudioTrack(m)):d||!m._useAudioElement&&Dt().webAudioMediaStreamDest&&!m._bypassWebAudio?d=VC(d?[m,d]:[m]):d=m}return d&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),i.push({track:d,type:Se.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=Zu(e=e.filter(i=>r.indexOf(i)!==-1));for(let i of e){if(i instanceof Ar){let c=this.localTrackMap.get(Se.LocalAudioTrack);if(!c)continue;c.track instanceof qr?(c.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),c.track.trackList.length===0&&(t.push([Se.LocalAudioTrack,c]),c.track.close())):t.push([Se.LocalAudioTrack,c])}if(i instanceof ar){let c=this.localTrackMap.get(Se.LocalVideoTrack);if(!c)continue;t.push([Se.LocalVideoTrack,c]);let d=this.localTrackMap.get(Se.LocalVideoLowTrack);d&&t.push([Se.LocalVideoLowTrack,d])}}return t}filterTobePublishedDataChannels(e){return e=(e=Zu(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Zu(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:i}=t;switch(i){case Se.LocalVideoTrack:r.addListener(Be.GET_STATS,this.handleGetLocalVideoStats),r.addListener(Be.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(Be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Se.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Se.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof qr?e.trackList.forEach(r=>{r.addListener(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Be.GET_STATS,this.handleGetLocalAudioStats),r.addListener(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Be.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Be.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:i}]=t;return{track:i,type:r}})),e.forEach(t=>{let{track:r,type:i}=t;switch(i){case Se.LocalVideoTrack:r.off(Be.GET_STATS,this.handleGetLocalVideoStats),r.off(Be.GET_RTC_STATS,this.handleGetRTCStats),r.off(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(Be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Se.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Se.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof qr?e.trackList.forEach(t=>{t.off(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Be.GET_STATS,this.handleGetLocalAudioStats),t.off(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Be.GET_STATS,this.handleGetLocalAudioStats),e.off(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Be.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof hh&&t.addListener(Be.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof ph&&t.addListener(Be.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Be.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Fe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Fe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,i)=>{var c;let d,h,{track:p,type:m}=r;switch(m){case Se.LocalAudioTrack:d=zt.Audio,h={dtx:p instanceof Hf&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Se.LocalVideoTrack:d=Ae(c=p._hints).call(c,Zt.SCREEN_TRACK)?zt.Screen:zt.High,h=Co(Co({},gU(p)),{},{codec:this.store.codec,svc_mode:dv()});break;case Se.LocalVideoLowTrack:d=zt.Low,h=Co(Co({},gU(p)),{},{codec:this.store.codec,svc_mode:dv()})}return{stream_type:d,attributes:h,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let i,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Se.LocalVideoTrack:i=Ae(r=d._hints).call(r,Zt.SCREEN_TRACK)?zt.Screen:zt.High;break;case Se.LocalAudioTrack:i=zt.Audio;break;case Se.LocalVideoLowTrack:i=zt.Low}return{stream_type:i,ssrcs:h,mid:p}})}assignLocalTracks(e,t){e.forEach((r,i)=>{let{track:c,type:d}=r;this.localTrackMap.set(d,{track:c,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Je.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ri&&!Sr()&&Y("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},Y("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ri&&u5(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=nc.DISCONNECTED_OR_FAILED,ri(this,Je.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let r=this.pendingLocalTracks.map(c=>c.getTrackId()),i=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));ze.reportApiInvoke(this.store.sessionId,{name:Or.REPUB_AFTER_PC_CONNECTED,options:r.concat(i),tag:Er.TRACER}).onSuccess(),this.republish()}if(Y("NEW_ICE_RESTART")&&e instanceof Ri&&!Sr()&&!this._forceTurn){if(Ae(dU).call(dU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let r=c=>{BC(e)&&(N.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),ri(this,Je.QueryClientConnectionState)==="CONNECTED"&&this.emit(Je.RequestRestartICE,c))},i=()=>{BC(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),N.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Je.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{h5(e,r,i)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Y("ICE_RESTART")&&ri(this,Je.QueryClientConnectionState)==="CONNECTED"&&this.emit(Je.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Je.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Je.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ze.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Er.TRACER}).onSuccess(),this.emit(Je.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(d=>d._audioSSRC===t);var c;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(c=i.audioTrack)===null||c===void 0||c.emit(Si.FIRST_FRAME_DECODED),ze.firstRemoteFrame(this.store.sessionId,Qr.FIRST_AUDIO_DECODE,_r.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);i&&ze.firstRemoteFrame(this.store.sessionId,Qr.FIRST_AUDIO_RECEIVED,_r.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,i)=>{var c;let d=Array.from(xn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,r,i)},e.onFirstVideoRender=t=>{var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i))},e.onFirstVideoReceived=t=>{var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),ze.firstRemoteFrame(this.store.sessionId,Qr.FIRST_VIDEO_RECEIVED,_r.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,r)=>{let i=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&i===c||this.emit(Je.ConnectionTypeChange,i),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(zc(r))," -> ").concat(JSON.stringify(zc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(zc(r))," -> ").concat(JSON.stringify(zc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Co(Co({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Ri&&function(t){Th.delete(t.id),u5(t)}(e),e.close(),this.emit(Je.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(Se.LocalAudioTrack);if(e instanceof Ar&&(r==null?void 0:r.track)instanceof qr)return r.track.isActive||t.push([Se.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(i&&(t.push(i),i[0]===Se.LocalVideoTrack)){let c=this.localTrackMap.get(Se.LocalVideoLowTrack);c&&t.push([Se.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(Se.LocalAudioTrack);if(e instanceof Ar&&(r==null?void 0:r.track)instanceof qr)return r.track.isActive&&t.push([Se.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(i)if(i[0]===Se.LocalVideoTrack){t.push(i);let c=this.localTrackMap.get(Se.LocalVideoLowTrack);c&&t.push([Se.LocalVideoLowTrack,c])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var r;let i,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Se.LocalAudioTrack:i=zt.Audio;break;case Se.LocalVideoTrack:i=Ae(r=d._hints).call(r,Zt.SCREEN_TRACK)?zt.Screen:zt.High;break;case Se.LocalVideoLowTrack:i=zt.Low}return{stream_type:i,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var r;let i,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Se.LocalAudioTrack:i=zt.Audio;break;case Se.LocalVideoTrack:i=Ae(r=d._hints).call(r,Zt.SCREEN_TRACK)?zt.Screen:zt.High;break;case Se.LocalVideoLowTrack:i=zt.Low}return{stream_type:i,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let c=i.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(i.entries()).forEach(c=>{let[d,h]=c;r.push([e,{kind:d,id:h}])});return r}filterTobeUnSubscribedDataChannels(e,t){let r=[];return t.forEach(i=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(i.id)&&r.push(i)}),r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[i,{kind:c,id:d}]=r;switch(c){case Fe.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Fe.VIDEO,ssrcId:i._videoSSRC}));case Fe.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Fe.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(r=>{let[i,{kind:c}]=r;if(t.has(i)){let d=t.get(i);c===Fe.VIDEO?d|=rs.Video:d|=rs.Audio,t.set(i,d)}else c===Fe.VIDEO?t.set(i,rs.Video):t.set(i,rs.Audio)}),{users:Array.from(t.entries()).map(r=>{let[i,c]=r;return{stream_id:i.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:i}]=t,c=this.remoteUserMap.get(r);c&&(c.delete(i),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Se.LocalVideoTrack),r=this.localTrackMap.get(Se.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new je((i,c)=>{this.handleUpdateVideoEncoder(t.track,i,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new je((i,c)=>{this.handleUpdateVideoEncoder(r.track,i,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Ri&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Ri&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,r){return e.map((i,c)=>{var d;let{stream_type:h}=i,p=(d=t.find(m=>{let{stream_type:_}=m;return h===_}))===null||d===void 0?void 0:d.attributes;if(p&&Y("DISABLE_SCREEN_SHARE_REMB")){let m=r[c]._hints;(Ae(m).call(m,Zt.SCREEN_TRACK)||Ae(m).call(m,Zt.SCREEN_LOW_TRACK))&&(p.remb=!1,N.debug("disable remb for screen share, hints:",m))}return p})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Ar){var t;let i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(d=>{let[,{id:h}]=d;return h})));let c=this.createUnmuteMessage(i);return void await er(this,Je.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Je.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Je.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await hs(T0(this.dtlsFailedCount,Gr)),this.emit(Je.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Ss(this,Je.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Je.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Se.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ar)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof ar).length>1)throw new he(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ar).length>1&&(e.some(t=>t instanceof Ar&&t._bypassWebAudio)||!Dt().webAudioMediaStreamDest))throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof ar&&this.pendingLocalTracks.some(r=>r instanceof ar))throw new he(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ar&&this.pendingLocalTracks.some(r=>r instanceof Ar)&&(!Dt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Ar&&r._bypassWebAudio)))throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;let i=!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dt().supportDualStreamEncoding,c=Co(Co({},{width:160,height:120,framerate:15,bitrate:50}),t),d;d=i?e._mediaStreamTrack.clone():WC(e,c);let h=tr(8,"track-low-"),p=new ar(d,Co(Co({},i&&{scaleResolutionDownBy:bC(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(dd.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,ah.LOW_STREAM)}),p._hints.push(Zt.LOW_STREAM),Ae(r=e._hints).call(r,Zt.SCREEN_TRACK)&&p._hints.push(Zt.SCREEN_LOW_TRACK),e.on("sei-to-send",m=>{p.emit("sei-to-send",m)}),e.addListener(Be.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ri){var c,d,h,p;let m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_,dtlsTransportState:E,peerConnectionState:x}=this.connection,{local:b,remote:C}=await this.connection.getSelectedCandidatePair();ze.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:_,dtlsstate:E,connectionstate:x,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(c=b==null?void 0:b.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=b.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(b.address,":").concat(b.port),selectedRemoteCandidateProtocol:(h=C.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(p=C.candidateType)!==null&&p!==void 0?p:"",selectedRemoteCandidateAddress:"".concat(C.address,":").concat(C.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){let t=this.store.keyMetrics,r=t.firstVideoFrameDecoded.find(E=>E.userId===e.uid);if(!r)return;let{isInternalUpload:i,isExternalUpload:c}=r;if(i&&c)return;let{subscribeEnd:d,firstPreRender:h,peerPublishDuration:p,peerPubStatusMs:m}=r,{firstRender:_=0}=r;if(d&&(_||h)&&p&&m){r.isInternalUpload=!0;let{playEnd:E}=r;E&&(r.isExternalUpload=!0);let{firstPreRender:x=0}=r;_=x||_;let b=e.videoTrack,C={peer:e._uintid,width:(b==null?void 0:b._videoWidth)||0,height:(b==null?void 0:b._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:p,peerPubStatusMs:m,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:r.userJoinNotify||0,videoAddNotify:r.videoAddNotify||0,subscribeStart:r.subscribeStart||0,subscribeEnd:r.subscribeEnd||0,firstReceived:r.firstReceived||0,firstDecoded:r.firstDecoded||0,firstPreRender:x||0,firstRender:E?Math.max(_,E):Math.max(_,d),playStart:r.playStart||0,playEnd:r.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:V2(this.store)};ze.firstXLAPeerFirstVideoFrame(this.store.sessionId,C)}}reportVideoFirstFrameDecoded(e,t,r,i){var c;let d=Array.from(xn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(d){i||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());let h=this.store.keyMetrics,p=h.subscribe.find(m=>m.userId===d.uid&&m.type==="video");ze.firstRemoteVideoDecode(this.store.sessionId,Qr.FIRST_VIDEO_DECODE,_r.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:r,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:i?1:0,firstFrame:(p==null?void 0:p.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let c=i.get(t);if(!c)return!1;let d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Se.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,ah.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Ge(bt.prototype,"startP2PConnection",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"startP2PConnection"),bt.prototype),Ge(bt.prototype,"connect",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"connect"),bt.prototype),Ge(bt.prototype,"updateRemoteRTPCapabilities",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"updateRemoteRTPCapabilities"),bt.prototype),Ge(bt.prototype,"publishDataChannel",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"publishDataChannel"),bt.prototype),Ge(bt.prototype,"unpublish",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"unpublish"),bt.prototype),Ge(bt.prototype,"unpublishDataChannel",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"unpublishDataChannel"),bt.prototype),Ge(bt.prototype,"unpublishLowStream",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"unpublishLowStream"),bt.prototype),Ge(bt.prototype,"subscribeDataChannel",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"subscribeDataChannel"),bt.prototype),Ge(bt.prototype,"subscribe",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"subscribe"),bt.prototype),Ge(bt.prototype,"massSubscribe",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"massSubscribe"),bt.prototype),Ge(bt.prototype,"unsubscribe",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"unsubscribe"),bt.prototype),Ge(bt.prototype,"unsubscribeDataChannel",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"unsubscribeDataChannel"),bt.prototype),Ge(bt.prototype,"massUnsubscribe",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"massUnsubscribe"),bt.prototype),Ge(bt.prototype,"muteRemote",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"muteRemote"),bt.prototype),Ge(bt.prototype,"unmuteRemote",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"unmuteRemote"),bt.prototype),Ge(bt.prototype,"hasRemoteMediaWithLock",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"hasRemoteMediaWithLock"),bt.prototype),Ge(bt.prototype,"disconnectForReconnect",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"disconnectForReconnect"),bt.prototype),Ge(bt.prototype,"updateBitrateLimit",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"updateBitrateLimit"),bt.prototype),Ge(bt.prototype,"remoteMediaSsrcChanged",[Ys],Object.getOwnPropertyDescriptor(bt.prototype,"remoteMediaSsrcChanged"),bt.prototype),bt);function Ys(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,d=await c.lock("From P2PChannel.".concat(t));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{d()}},r}function m5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function g5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m5(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Gae=Date.now(),Hae=20,HC=new Map,Av=new Map;async function _5(e){let t=HC.get(e),r=Array.isArray(t)&&t[t.length-1],i=Av.get(e);if(!r)return void(i.isSyncing=!1);let c={uid:r.uid,payload:r.payload};i.firstRecvTs===0&&(i.firstRecvTs=r.recvTs,i.firstSendTs=r.sendTs);let d=r.sendTs-i.firstSendTs,h=d-(Date.now()-i.firstRecvTs);h>0&&(i.firstRecvTs=Date.now()-d);let p=r.mediaDelay+h;p<=0?(t.pop(),E5(r.context,c),p=0):p=Math.min(p,Hae),setTimeout(()=>t.length&&_5(e),p)}function E5(e,t){e.safeEmit(wt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function zae(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return E5(r,{uid:e.uid,payload:e.payload});let i="".concat(r.id,"-").concat(e.uid),c=HC.get(i)||[],d=c.findIndex(_=>e.sendTs>=_.sendTs),h=g5(g5({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),HC.set(i,c);let p=!1;var m;Av.has(i)?p=!((m=Av.get(i))===null||m===void 0||!m.isSyncing):Av.set(i,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||_5(i)}let Kae=Rt().name;function v5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function y5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v5(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Rh="websdk_ng_cache_parameter",qae=Y("MAX_PRELOAD_ASYNC_LENGTH"),Yae=1e4,yd=new Map,xd=[],zC=null,KC=0,qC=0,Iv=new Map,$ae=function(e,t){let r=[],i=0,c=async()=>{let d=r.shift();d&&await d(),r.length>0&&i<t?c():i--};return async function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return new je(async(m,_)=>{r.push(async()=>{try{let E=await e(...h);m(E)}catch(E){_(E)}}),i<t&&(i++,c())})}}(x5,qae),YC=dn.CancelToken.source();async function x5(e,t,r,i,c,d){try{if(!Y("ENABLE_PRELOAD"))return;if(!Dt().supportWebCrypto)return void Fc(()=>{N.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new he(z.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&us(r,"token",1,2047),us(e,"appid",1,2047),nv(t),i&&iv(i);let h=cd();N.debug("preload channel ".concat(t,", uid is ").concat(i));let p={appId:e,cname:t,token:r||e,uid:typeof i!="string"?i:null,sid:h,proxyServer:c},m,_;typeof i=="string"?(p.stringUid=i,[_,m]=await je.all([Dae(i,{sid:h,appId:e},YC.token),qU(y5(y5({},p),{},{token:r||e,uid:0}),YC.token)]),p.uid=_.uid,m.gatewayInfo.uid=p.uid,m.gatewayInfo.res.uid=p.uid):(d&&(p.stringUid=d),m=await qU(p,YC.token));let E={sid:h,appId:e,cname:t,token:r||e,uid:p.stringUid||i,intUid:p.uid||m.gatewayInfo.uid,stringUid:p.stringUid,ts:Date.now(),sua:_,ap:m};await async function(x){let b;try{x.uid&&w5({appId:x.appId,cname:x.cname,token:x.token,uid:x.uid,stringUid:x.stringUid});let C=R5(x),U=await async function(M,H){try{let K=await window.crypto.subtle.importKey("raw",p2(H),"AES-GCM",!1,["encrypt"]),X=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},K,od(window.btoa(JSON.stringify(M))));return Uc(new Uint8Array(X))}catch{return}}(x,x.token||x.appId);if(!U)return;b=T5(Rh);let k=b?JSON.parse(b):[];k.push({[C]:U}),k.length>Y("AP_CACHE_NUM")&&k.shift(),Ov(Rh,JSON.stringify(k))}catch(C){N.warn("Error caching server parameters:",C.message),Ov(Rh,"")}}(E),KC++}catch(h){throw qC++,function(p){zC||(zC=window.setTimeout(()=>{let _="";Iv.forEach((E,x)=>{_+="".concat(x,": ").concat(E," ;")}),ze.reportApiInvoke(null,{name:Or.PRELOAD,options:{success:KC,failed:qC,err:_}}).onError(p),KC=0,qC=0,Iv.clear(),zC=null},Yae));let m=Iv.get(p.code)||0;Iv.set(p.code,m+1)}(h),h}}async function b5(e){try{if(Y("AP_REQUEST_DETAIL")||Y("ENABLE_ROLE_SELECT_EDGE"))return;let t=w5(e);if(!t||e.cloudProxyServer!=="disabled")return;let r=await async function(i,c){try{let d=await window.crypto.subtle.importKey("raw",p2(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,od(i));return JSON.parse(window.atob(Uc(new Uint8Array(h))))}catch{return}}(t,e.token||e.appId);if(!r||!function(i,c){return i.cname===c.cname&&i.appId===c.appId&&i.token===c.token?c.stringUid?i.stringUid===c.stringUid:typeof c.uid=="number"?i.uid===c.uid:i.uid==c.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<Y("AP_CACHE_LIFETIME"))return r}catch(t){N.warn("Error get preloadInfo",t.message)}}function w5(e){let t;try{if(t=T5(Rh),!t)return;let r=JSON.parse(t),i=R5(e),c=function(h,p){for(let m=h.length-1;m>=0;m--)if(p(h[m]))return m;return-1}(r,h=>i in h);if(c===-1)return;let d=r.splice(c,1)[0];return Ov(Rh,JSON.stringify(r)),d[i]}catch(r){N.warn("Error delete preload info: ".concat(t),r.message),Ov(Rh,"")}}function $C(e){if(e){let t=yd.get(e);t&&(window.clearTimeout(t),t=null,yd.delete(e)),Ae(xd).call(xd,e)||e.cloudProxyServer!=="disabled"||xd.push(e)}if(yd.size<Y("AP_CACHE_NUM")&&xd.length>0){let t=xd.shift();yd.set(t,window.setTimeout(async()=>{let{appId:r,cname:i,token:c,stringUid:d,uid:h,proxyServer:p}=t;try{await $ae(r,i,c,h,p,d),yd.has(t)&&$C(t)}catch(m){N.warn("update preload failed",m.message),S5(t)}},Y("AP_UPDATE_INTERVAL")))}}function S5(e){let t=xd.indexOf(e);t!==-1&&xd.splice(t,1);let r=yd.get(e);r&&(window.clearTimeout(r),r=null,yd.delete(e),$C())}function C5(e,t){let r=e.sua,i=e.ap;t&&r&&ze.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),ze.reportResourceTiming(e.ap.url,e.sid),ze.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Fr.CHOOSE_SERVER,Fr.CLOUD_PROXY_FALLBACK].toString()}),ze.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Fr.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function T5(e){return window.atob(window.localStorage.getItem(e)||"")}function Ov(e,t){window.localStorage.setItem(e,window.btoa(t))}function R5(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),y2(t)}function Xae(e){let t=function(){let r=Zae.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,i){let c=r.appId;c!==void 0&&(Ur(i,10),Qc(i,c));let d=r.cid;d!==void 0&&(Ur(i,16),Ur(i,d));let h=r.cname;h!==void 0&&(Ur(i,26),Qc(i,h));let p=r.deviceId;p!==void 0&&(Ur(i,34),Qc(i,p));let m=r.elapse;m!==void 0&&(Ur(i,40),Zc(i,m));let _=r.fileSize;_!==void 0&&(Ur(i,48),Zc(i,Nh(_)));let E=r.height;E!==void 0&&(Ur(i,56),Zc(i,Nh(E)));let x=r.jpg;x!==void 0&&(Ur(i,66),Ur(i,x.length),A5(i,x));let b=r.networkType;b!==void 0&&(Ur(i,72),Zc(i,Nh(b)));let C=r.osType;C!==void 0&&(Ur(i,80),Zc(i,Nh(C)));let U=r.requestId;U!==void 0&&(Ur(i,90),Qc(i,U));let k=r.sdkVersion;k!==void 0&&(Ur(i,98),Qc(i,k));let M=r.sequence;M!==void 0&&(Ur(i,104),Zc(i,Nh(M)));let H=r.sid;H!==void 0&&(Ur(i,114),Qc(i,H));let K=r.timestamp;K!==void 0&&(Ur(i,120),Zc(i,K));let X=r.uid;X!==void 0&&(Ur(i,128),Ur(i,X));let se=r.vid;se!==void 0&&(Ur(i,136),Ur(i,se));let te=r.width;te!==void 0&&(Ur(i,144),Zc(i,Nh(te)));let Z=r.service;Z!==void 0&&(Ur(i,152),Ur(i,Z));let ce=r.callbackData;ce!==void 0&&(Ur(i,162),Ur(i,ce.length),A5(i,ce));let fe=r.ticket;fe!==void 0&&(Ur(i,170),Qc(i,fe));let xe=r.vendorConfigs;xe!==void 0&&(Ur(i,178),Qc(i,xe))}(e,t),function(r){let i=r.bytes,c=r.limit;return i.length===c?i:i.subarray(0,c)}(t)}function Jae(e){return function(r){let i={};e:for(;!eoe(r);){let c=im(r);switch(c>>>3){case 0:break e;case 1:i.code=im(r);break;case 2:i.msg=I5(r,im(r));break;case 3:i.requestId=I5(r,im(r));break;case 4:i.timestamp=toe(r,!1);break;default:Qae(r,7&c)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Qae(e,t){switch(t){case 0:for(;128&aa(e););break;case 2:XC(e,im(e));break;case 5:XC(e,4);break;case 1:XC(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Nh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Zae=[];function XC(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function eoe(e){return e.offset>=e.limit}function Dv(e,t){let r=e.bytes,i=e.offset,c=e.limit,d=i+t;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),i}function N5(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function A5(e,t){let r=Dv(e,t.length);e.bytes.set(t,r)}function I5(e,t){let r=N5(e,t),i=String.fromCharCode,c=e.bytes,d="",h="";for(let p=0;p<t;p++){let m,_,E,x,b=c[p+r];128&b?(224&b)==192?p+1>=t?h+=d:(m=c[p+r+1],(192&m)!=128?h+=d:(x=(31&b)<<6|63&m,x<128?h+=d:(h+=i(x),p++))):(240&b)==224?p+2>=t?h+=d:(m=c[p+r+1],_=c[p+r+2],(49344&(m|_<<8))!=32896?h+=d:(x=(15&b)<<12|(63&m)<<6|63&_,x<2048||x>=55296&&x<=57343?h+=d:(h+=i(x),p+=2))):(248&b)==240?p+3>=t?h+=d:(m=c[p+r+1],_=c[p+r+2],E=c[p+r+3],(12632256&(m|_<<8|E<<16))!=8421504?h+=d:(x=(7&b)<<18|(63&m)<<12|(63&_)<<6|63&E,x<65536||x>1114111?h+=d:(x-=65536,h+=i(55296+(x>>10),56320+(1023&x)),p+=3))):h+=d:h+=i(b)}return h}function Qc(e,t){let r=t.length,i=0;for(let h=0;h<r;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+t.charCodeAt(++h)-56613888),i+=p<128?1:p<2048?2:p<65536?3:4}Ur(e,i);let c=Dv(e,i),d=e.bytes;for(let h=0;h<r;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+t.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function aa(e){return e.bytes[N5(e,1)]}function O5(e,t){let r=Dv(e,1);e.bytes[r]=t}function im(e){let t,r=0,i=0;do t=aa(e),r<32&&(i|=(127&t)<<r),r+=7;while(128&t);return i}function Ur(e,t){for(t>>>=0;t>=128;)O5(e,127&t|128),t>>>=7;O5(e,t)}function toe(e,t){let r,i=0,c=0,d=0;return r=aa(e),i=127&r,128&r&&(r=aa(e),i|=(127&r)<<7,128&r&&(r=aa(e),i|=(127&r)<<14,128&r&&(r=aa(e),i|=(127&r)<<21,128&r&&(r=aa(e),c=127&r,128&r&&(r=aa(e),c|=(127&r)<<7,128&r&&(r=aa(e),c|=(127&r)<<14,128&r&&(r=aa(e),c|=(127&r)<<21,128&r&&(r=aa(e),d=127&r,128&r&&(r=aa(e),d|=(127&r)<<7))))))))),{low:i|c<<28,high:c>>>4|d<<24,unsigned:t}}function Zc(e,t){let r=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?i===0?r<16384?r<128?1:2:r<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:c<128?9:10,h=Dv(e,d),p=e.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=d!==9?128|c:127&c;case 8:p[h+7]=d!==8?i>>>21|128:i>>>21&127;case 7:p[h+6]=d!==7?i>>>14|128:i>>>14&127;case 6:p[h+5]=d!==6?i>>>7|128:i>>>7&127;case 5:p[h+4]=d!==5?128|i:127&i;case 4:p[h+3]=d!==4?r>>>21|128:r>>>21&127;case 3:p[h+2]=d!==3?r>>>14|128:r>>>14&127;case 2:p[h+1]=d!==2?r>>>7|128:r>>>7&127;case 1:p[h]=d!==1?128|r:127&r}}let D5={},P5={},Pv=4294967296,roe=Pv*Pv,soe=roe/2;j5(0,!0);let k5=j5(0),noe=am(0,-2147483648,!1),ioe=am(-1,2147483647,!1);function j5(e,t){let r,i,c;return t?(c=0<=(e>>>=0)&&e<256)&&(i=P5[e],i)?i:(r=am(e,0,!0),c&&(P5[e]=r),r):(c=-128<=(e|=0)&&e<128)&&(i=D5[e],i)?i:(r=am(e,e<0?-1:0,!1),c&&(D5[e]=r),r)}function am(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function L5(e,t){if(isNaN(e))return k5;{if(e<=-9223372036854776e3)return noe;if(e+1>=soe)return ioe}return e<0?k5:am(e%Pv|0,e/Pv|0,t)}function M5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}class JC extends br{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(Va.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),W(this,"name","AgoraRTCImageModeration"),W(this,"_connectionState",Ti.CONNECTING),W(this,"_sequence",0),W(this,"_moderationStartTime",void 0),W(this,"_workerConnection",void 0),W(this,"_workerMessageLengthLimit",void 0),W(this,"_qualityRatio",void 0),W(this,"_connectInfo",void 0),W(this,"_cancelTokenSource",dn.CancelToken.source()),W(this,"_retryConfig",void 0),W(this,"_moderationInterval",void 0),W(this,"_moderationTimer",null),W(this,"_moderationMode",1),W(this,"_quality",1),W(this,"_qualityTimer",null),W(this,"_ticket",void 0),W(this,"_moderationIntervalMinimum",void 0),W(this,"_uploadFailedNum",0),W(this,"_uploadNum",0),W(this,"_uploadTimer",null),W(this,"_extraInfo",void 0),W(this,"_vendor",""),W(this,"_encoder",new TextEncoder),W(this,"_moderationId",void 0),W(this,"inspectImage",()=>{if(this.connectionState!==Ti.CONNECTED)throw new le(z.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ti.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=tr(5,"image-moderation-"),this._workerMessageLengthLimit=Y("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Y("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=Y("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new $f("worker-"+this._moderationId,Gr),this.on(Va.STATE_CHANGE,(i,c)=>{N.debug("[".concat(this._moderationId,"] Moderation operation :").concat(_h[i]," ").concat(c||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(Va.STATE_CHANGE,_h.CONNECT_AP),this._connectInfo=t;let i=this._cancelTokenSource.token;return this._retryConfig=r,new je((c,d)=>{this.on(Va.CONNECTION_STATE_CHANGE,(h,p)=>{h===Ti.CONNECTED&&c()}),this.requestAP(t,i,r).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),N.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Ti.CONNECTED&&this.inspectImage()}async requestAP(t,r,i){let c=Y("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,_,E,x){let{appId:b,areaCode:C,cname:U,sid:k,token:M,uid:H}=_;wh++;let K="moderation_plugin",X={service_name:K,json_body:JSON.stringify({appId:b,areaCode:C,cname:U,command:"allocateEdge",requestId:wh,seq:wh,sid:k,appToken:M,ts:Date.now(),uid:H+""})},se,te,Z=m[0];return La(async()=>{se=Date.now();let ce=await Ba(Z,{data:X,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(te=Date.now()-se,ce.code!==0){let Te=new le(z.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ce.code,{retry:!0,responseTime:te});throw N.error(Te.toString()),Te}let fe=JSON.parse(ce.json_body);if(fe.code!==200){let Te=new le(z.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(fe.code,", reason: ").concat(fe.reason),{code:fe.code,responseTime:te});throw N.error(Te.toString()),Te}if(!fe.servers||!Array.isArray(fe.servers)||fe.servers.length===0){let Te=new le(z.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:fe.code,responseTime:te});throw N.error(Te.toString()),Te}if(!fe.servers.some(Te=>!!Te.wss)){let Te=new le(z.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:fe.code,responseTime:te});throw N.error(Te.toString()),Te}let xe=Y("IMAGE_MODERATION_WORKER_HOST");return{addressList:fe.servers.map(Te=>{let{address:_t,wss:vt}=Te;if(_t&&vt)return"wss://".concat(_t.replace(/\./g,"-"),".").concat(xe,":").concat(vt,"/moderation")}).filter(Te=>!!Te),workerToken:fe.workerToken,vid:fe.vid,ticket:fe.appTicket,responseTime:te}},(ce,fe)=>(ze.apworkerEvent(k,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(ce.addressList),firstSuccess:fe===0,responseTime:te,serverIp:m[fe%m.length]}),!1),(ce,fe)=>(ze.apworkerEvent(k,{success:!1,sc:ce.data&&ce.data.code||200,serviceName:K,responseTime:te,serverIp:m[fe%m.length]}),!!(ce.code!==z.OPERATION_ABORTED&&ce.code!==z.UNEXPECTED_RESPONSE||ce.data&&ce.data.retry)&&(Z=m[(fe+1)%m.length],!0)),x)}(c,t,r,i);this.emit(Va.STATE_CHANGE,_h.AP_CONNECTED);let{addressList:h,ticket:p}=d;return this._ticket=p,h}async connectWorker(t){this.emit(Va.STATE_CHANGE,_h.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(pt.CONNECTED,async()=>{this.emit(Va.STATE_CHANGE,_h.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ti.CONNECTED}),this._workerConnection.on(pt.CLOSED,()=>{this.connectionState=Ti.CLOSED}),this._workerConnection.on(pt.FAILED,()=>{this.connectionState=Ti.CLOSED}),this._workerConnection.on(pt.RECONNECTING,()=>{this.connectionState=this.connectionState===Ti.CONNECTED?Ti.RECONNECTING:Ti.CONNECTING}),this._workerConnection.on(pt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let r=Jae(new Uint8Array(t.data));Y("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,N.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{ze.reportApiInvoke(this._connectInfo.sid||null,{name:Or.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:Er.TRACER}).onError(new le(z.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},Y("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else N.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(pt.WILL_RECONNECT,(t,r,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(pt.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=ri(this,Va.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(Y("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being played can be inspected"));this._sequence++;let i=await this.generateRequestData(t,r);this._workerConnection.sendMessage(i,!0,!0)}else Y("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:i,cname:c,cid:d,vid:h,sid:p,uid:m}=r,_=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),x=await lM(E,i,c),b=this._sequence+"-"+d+"-"+m+"-"+_+"-"+tr(12,""),C={appId:i,cid:d,cname:c,deviceId:"",elapse:JC.intToLong(Number(_-this._moderationStartTime)),fileSize:E.buffer.byteLength,height:E.height,width:E.width,jpg:x,networkType:6,osType:7,requestId:b,sdkVersion:"4.24.0",sequence:this._sequence,sid:p,timestamp:L5(_),uid:m,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete C.callbackData;let U=Xae(C);if(U.byteLength<this._workerMessageLengthLimit){if(Y("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let k=function(M){for(var H=1;H<arguments.length;H++){var K=arguments[H]!=null?arguments[H]:{};H%2?M5(Object(K),!0).forEach(function(X){W(M,X,K[X])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(K)):M5(Object(K)).forEach(function(X){Object.defineProperty(M,X,Object.getOwnPropertyDescriptor(K,X))})}return M}({},C);delete k.jpg,N.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(k))}return U}{let k=this.quality*this._qualityRatio;return this.quality=k,await this.generateRequestData(t,{appId:i,cname:c,cid:d,vid:h,sid:p,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=dn.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ti.CLOSED,this.emit(Va.STATE_CHANGE,_h.CLOSED)}}function F5(e){if(Qt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new le(z.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new le(z.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let aoe={name:"ImageModeration",create:function(e){let{config:t}=e;return F5(t),new JC(t)}};var U5,V5,B5,W5,G5,H5,z5,K5,q5,Y5,$5,X5,J5,Q5,Z5,eV,tV,rV,sV,nV,iV,aV,oV,cV,lV,dV,uV,hV,pV,fV,mV,gV,_V,EV,vV,yV,xV,bV,wV,SV,CV,Me;function TV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function oa(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TV(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}Is.setLogger(N);let ooe=(U5=st(),V5=st({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof lh))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),B5=st({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==ch.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),W5=st({argsMap:(e,t,r,i)=>[typeof t=="object"?t.uid:t,r,i]}),G5=st({argsMap:(e,t,r)=>[t,r]}),H5=st({argsMap:(e,t)=>t.map(r=>{let{user:i,mediaType:c}=r;return[i==null?void 0:i.uid,c]})}),z5=st({argsMap:(e,t,r,i)=>[typeof t=="object"?t.uid:t,r,i]}),K5=st({argsMap:(e,t)=>t.map(r=>{let{user:i,mediaType:c}=r;return{uid:i==null?void 0:i.uid,mediaType:c}})}),q5=st(),Y5=st(),$5=st(),X5=st(),J5=st(),Q5=st(),Z5=st(),eV=st(),tV=st(),rV=st(),sV=st(),nV=st(),iV=st(),aV=st(),oV=st(),cV=st({argsMap:(e,t)=>[t]}),lV=st(),dV=st(),uV=st(),hV=st(),pV=st(),fV=st(),mV=st(),gV=st(),_V=st({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),EV=st(),vV=st(),yV=st(),xV=st(),bV=st(),wV=st(),SV=st({reportResult:!0}),CV=st(),Me=class extends br{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),W(this,"store",void 0),W(this,"_uid",void 0),W(this,"_channelName",void 0),W(this,"_uintUid",void 0),W(this,"_users",[]),W(this,"_config",void 0),W(this,"_clientId",void 0),W(this,"_appId",void 0),W(this,"_sessionId",null),W(this,"_key",void 0),W(this,"_rtmConfig",{}),W(this,"_joinInfo",void 0),W(this,"_gateway",void 0),W(this,"_statsCollector",void 0),W(this,"_configDistribute",void 0),W(this,"_leaveMutex",void 0),W(this,"_publishMutex",void 0),W(this,"_renewTokenMutex",void 0),W(this,"_subscribeMutex",void 0),W(this,"_encryptionMode","none"),W(this,"_encryptionSecret",null),W(this,"_encryptionSalt",null),W(this,"_encryptDataStream",!1),W(this,"_encryptDataStreamKey",null),W(this,"_encryptDataStreamIv",null),W(this,"_proxyServer",void 0),W(this,"_turnServer",{servers:[],mode:"auto"}),W(this,"_cloudProxyServerMode","disabled"),W(this,"_isDualStreamEnabled",!1),W(this,"_defaultStreamFallbackType",void 0),W(this,"_lowStreamParameter",void 0),W(this,"_streamFallbackTypeCacheMap",new Map),W(this,"_remoteStreamTypeCacheMap",new Map),W(this,"_axiosCancelSource",dn.CancelToken.source()),W(this,"_audioVolumeIndicationInterval",void 0),W(this,"_networkQualityInterval",void 0),W(this,"_userOfflineTimeout",void 0),W(this,"_streamRemovedTimeout",void 0),W(this,"_liveTranscodeStreamingClient",void 0),W(this,"_liveRawStreamingClient",void 0),W(this,"_channelMediaRelayClient",void 0),W(this,"_networkQualitySensitivity","normal"),W(this,"_p2pChannel",void 0),W(this,"_useLocalAccessPoint",!1),W(this,"_setLocalAPVersion",void 0),W(this,"_joinAndNotLeaveYet",!1),W(this,"_numberOfJoinCount",0),W(this,"_joinResponse",null),W(this,"_remoteDefaultVideoStreamType",void 0),W(this,"_inspect",void 0),W(this,"_moderation",void 0),W(this,"_license",void 0),W(this,"_pendingPublishedUsers",[]),W(this,"ntpAlignErrorCount",0),W(this,"remoteInboundOffset",0),W(this,"_peerConnectionState",void 0),W(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),W(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),W(this,"_handleUserOnline",c=>{if(Y("BLOCK_LOCAL_CLIENT")&&gd(c.uid,this.channelName))return void N.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&N.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(wt.USER_JOINED,d));else{let h=new Xc(c.uid,c.uint_id||c.uid);this._users.push(h),N.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(wt.USER_JOINED,h)}}),W(this,"_handleUserOffline",c=>{if(Y("BLOCK_LOCAL_CLIENT")&&gd(c.uid,this.channelName))return;let d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:PE(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),N.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(wt.USER_LEAVED,d,c.reason))}),W(this,"_handleAddAudioOrVideoStream",(c,d,h,p,m,_,E,x)=>{if(Y("BLOCK_LOCAL_CLIENT")&&gd(d,this.channelName))return;let b=this._users.find(U=>U.uid===d);if(!b)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(b.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(b.uid,{videoAddNotify:Date.now()});let C=c==="audio"?b.hasAudio:b.hasVideo;if(b._uintid||(b._uintid=_||d),c==="audio"?b._trust_audio_stream_added_state_=!0:b._trust_video_stream_added_state_=!0,c==="audio"?(b._audio_added_=!0,h!==void 0&&(b._audioSSRC=h),p!==void 0&&(b._cname=p),E&&(b._audioOrtc=E)):(b._video_added_=!0,h!==void 0&&(b._videoSSRC=h),p!==void 0&&(b._cname=p),x!==void 0&&(b._rtxSsrcId=x),E&&(b._videoOrtc=E)),(c==="audio"?b.hasAudio:b.hasVideo)&&!C&&(N.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published ").concat(c)),this.safeEmit(wt.USER_PUBLISHED,b,c)),c==="video"?ze.onGatewayStream(this._sessionId,Qr.ON_ADD_VIDEO_STREAM,_r.ON_ADD_VIDEO_STREAM,{peer:_||d,ssrc:b._videoSSRC}):ze.onGatewayStream(this._sessionId,Qr.ON_ADD_AUDIO_STREAM,_r.ON_ADD_AUDIO_STREAM,{peer:_||d,ssrc:b._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(b,c,h).then(U=>{if(U&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(b.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof nm))return this._p2pChannel.unsubscribe(b,c,!0).then(()=>this._subscribe(b,c,!0).catch(k=>{N.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(b,c)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(b.uid," after reconnect.")),this._subscribe(b,c,!0).catch(U=>{N.error("[".concat(this._clientId,"] resubscribe error"),U.toString())})),c==="video"&&!bs()&&!Bs()){let U=this._getEncodingName(m);(U==null?void 0:U.toLocaleLowerCase())==Bf.av1&&Oae().then(k=>{k||this._gateway.downgradeCodec(U)})}}),W(this,"_handleRemoveStream",c=>{if(Y("BLOCK_LOCAL_CLIENT")&&gd(c.uid,this.channelName))return;let d=this._users.find(p=>p.uid===c.uid);if(!d)return void N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));N.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(wt.USER_UNPUBLISHED,d,"audio"),N.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(wt.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(wt.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(wt.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof nm&&this._p2pChannel.unsubscribe(d).then(p=>{if(p)return this._gateway.unsubscribe(p,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),ze.onGatewayStream(this._sessionId,Qr.ON_REMOVE_STREAM,_r.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),W(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(Y("BLOCK_LOCAL_CLIENT")&&gd(d,this.channelName))return;let p=this._users.find(E=>E.uid===d);if(!p)return void N.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));N.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));let m=c==="audio"?p.hasAudio:p.hasVideo;if(c==="audio"){p._trust_audio_enabled_state_=!0;let E=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===E)return;{let x=p._audio_enabled_?"enable-local-audio":"disable-local-audio";N.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(x)),this.safeEmit(wt.USER_INFO_UPDATED,d,x)}}else{p._trust_video_enabled_state_=!0;let E=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===E)return;{let x=p._video_enabled_?"enable-local-video":"disable-local-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(x)),this.safeEmit(wt.USER_INFO_UPDATED,d,x)}}let _=c==="audio"?p.hasAudio:p.hasVideo;return m!==_?!m&&_?(N.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(wt.USER_PUBLISHED,p,c)):(c==="video"&&p._videoTrack&&p._videoTrack._destroy(),c==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,c),N.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(wt.USER_UNPUBLISHED,p,c)):void 0}),W(this,"_handleMuteStream",(c,d,h)=>{if(Y("BLOCK_LOCAL_CLIENT")&&gd(c,this.channelName))return;N.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);let p=this._users.find(E=>E.uid===c);if(!p)return void N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));let m=d==="audio"?p.hasAudio:p.hasVideo;if(d==="audio"){p._trust_audio_mute_state_=!0;let E=p._audio_muted_;if(p._audio_muted_=h,p._audio_muted_===E)return;{let x=p._audio_muted_?"mute-audio":"unmute-audio";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(x)),this.safeEmit(wt.USER_INFO_UPDATED,c,x)}}else{p._trust_video_mute_state_=!0;let E=p._video_muted_;if(p._video_muted_=h,p._video_muted_===E)return;{let x=p._video_muted_?"mute-video":"unmute-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(x)),this.safeEmit(wt.USER_INFO_UPDATED,c,x)}}let _=d==="audio"?p.hasAudio:p.hasVideo;if(m!==_){if(!m&&_)return(d==="audio"?p._audioSSRC:p._videoSSRC)?(N.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(wt.USER_PUBLISHED,p,d)):void N.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),d==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,d),N.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(wt.USER_UNPUBLISHED,p,d)}}),W(this,"_handleP2PLost",async c=>{N.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():N.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),W(this,"_handleTokenWillExpire",()=>{N.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(wt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),W(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),N.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),W(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(wt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(wt.NETWORK_QUALITY,c)}),W(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,p)=>{let m=this._users.find(E=>E.uid===d);if(!m)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(m.uid,c,void 0,void 0,void 0,Date.now());let _=c==="audio"?m.hasAudio:m.hasVideo;c==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,c==="audio"?(m._audio_added_=!0,h!==void 0&&(m._audioSSRC=h),p!==void 0&&(m._audioMid=p)):(m._video_added_=!0,h!==void 0&&(m._videoSSRC=h),p!==void 0&&(m._videoMid=p)),(c==="audio"?m.hasAudio:m.hasVideo)&&!_&&(N.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(c)),this.safeEmit(wt.USER_PUBLISHED,m,c)),this._p2pChannel.hasPendingRemoteMedia(m,c)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,c,!0).catch(E=>{N.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),this._config=e,this._clientId=t||tr(5,"client-"),this.store=new class{constructor(c,d,h,p){ct(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:p,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ld.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case lt.SET_SESSION_ID:return Ce(Ce({},d),{},{sessionId:h.sessionId});case lt.SET_P2P_ID:return Ce(Ce({},d),{},{p2pId:h.p2pId});case lt.SET_UID:return Ce(Ce({},d),{},{uid:h.uid});case lt.SET_INT_UID:return Ce(Ce({},d),{},{intUid:h.intUid});case lt.SET_PUB_ID:return Ce(Ce({},d),{},{pubId:h.pubId});case lt.KEY_METRIC_CLIENT_CREATED:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{clientCreated:h.metric})});case lt.KEY_METRIC_JOIN_START:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{joinStart:h.metric})});case lt.KEY_METRIC_PRELOAD_START:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{preloadStart:h.metric})});case lt.KEY_METRIC_PRELOAD_END:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{preloadEnd:h.metric})});case lt.KEY_METRIC_JOIN_END:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{joinEnd:h.metric})});case lt.KEY_METRIC_REQUEST_AP_START:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{requestAPStart:h.metric})});case lt.KEY_METRIC_REQUEST_AP_END:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{requestAPEnd:h.metric})});case lt.KEY_METRIC_REQUEST_SUA_END:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case lt.KEY_METRIC_BEFORE_CONNECT:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{beforeConnect:h.metric})});case lt.KEY_METRIC_PEER_RECEIVER:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{peerReceiver:h.metric})});case lt.KEY_METRIC_SIGNAL_CONNECTED:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{signalConnected:h.metric})});case lt.KEY_METRIC_JOIN_REQ:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{joinReq:h.metric})});case lt.KEY_METRIC_JOIN_REP:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{joinRep:h.metric})});case lt.KEY_METRIC_JOIN_GATEWAY_START:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case lt.KEY_METRIC_JOIN_GATEWAY_END:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case lt.KEY_METRIC_PEER_CONNECTION_START:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case lt.KEY_METRIC_PEER_CONNECTION_END:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case lt.KEY_METRIC_DESCRIPTION_START:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{descriptionStart:h.metric})});case lt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case lt.KEY_METRIC_ICE_CONNECTION_END:return Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case lt.KEY_METRIC_PUBLISH:{let p=d.keyMetrics.publish,m=p.findIndex(_=>_.trackId===h.metric.trackId);return m!==-1?(p[m]=Ce(Ce({},p[m]),h.metric),Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{publish:[...p]})})):Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case lt.KEY_METRIC_SUBSCRIBE:{let p=d.keyMetrics.subscribe,m=p.findIndex(_=>_.userId===h.metric.userId&&_.type===h.metric.type);return m!==-1?(p[m]=Ce(Ce({},p[m]),h.metric),Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{subscribe:[...p]})})):Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case lt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let p=d.keyMetrics.firstVideoFrameDecoded,m=p.findIndex(_=>_.userId===h.metric.userId);return m!==-1?(p[m]=Ce(Ce({},p[m]),h.metric),Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{firstVideoFrameDecoded:[...p]})})):Ce(Ce({},d),{},{keyMetrics:Ce(Ce({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case lt.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case lt.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case lt.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=Ce(Ce({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case lt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case lt.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case lt.SET_USE_P2P:return Ce(Ce({},d),{},{useP2P:h.val});case lt.SET_TRANSPORT_TYPE:return Ce(Ce({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:lt.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:lt.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:lt.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:lt.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:lt.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:lt.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:lt.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:lt.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:lt.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:lt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:lt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:lt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:lt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:lt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:lt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:lt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:lt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:lt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:lt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:lt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:lt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:lt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:lt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:lt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:lt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:lt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:lt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Ce({userId:c},d)})}descriptionStart(){this.dispatch({type:lt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:lt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:lt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,p){this.dispatch({type:lt.KEY_METRIC_PUBLISH,metric:Ce(Ce({trackId:c,type:d},h&&{publishStart:h}),p&&{publishEnd:p})})}subscribe(c,d,h,p,m,_,E){this.dispatch({type:lt.KEY_METRIC_SUBSCRIBE,metric:Ce(Ce(Ce(Ce(Ce({userId:c,type:d},h&&{subscribeStart:h}),p&&{subscribeEnd:p}),m&&{firstFrame:m}),_&&{streamAdded:_}),E&&{firstDecoded:E})})}massSubscribe(c,d,h,p){c.forEach(m=>{this.dispatch({type:lt.KEY_METRIC_SUBSCRIBE,metric:Ce(Ce(Ce({userId:m.userId,type:m.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),p&&{firstFrame:p})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:lt.RECORD_JOIN_CHANNEL_SERVICE,record:Ce(Ce({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:lt.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:lt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:lt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:lt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Is("client-leave",this._clientId),this._publishMutex=new Is("client-publish",this._clientId),this._renewTokenMutex=new Is("client-renewtoken",this._clientId),this._subscribeMutex=new Is("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),N.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(bi," build: ").concat(L0,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{w0(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(c){N.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var i;this._statsCollector=new rm(this.store),this._statsCollector.onStatsException=(c,d,h)=>{N.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===jC.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(p=>{p instanceof qE&&Y("ENABLE_ENCODE_EXCEPTION")&&p.findClosestProfile()}),this.safeEmit(wt.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,p)=>{let m=this._users.find(_=>_.uid===c);m&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(m._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(m)),ze.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(Y("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){let d=this.localTracks.find(h=>h instanceof ar);d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?Y("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Cae(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Gr,httpRetryConfig:e.httpRetryConfig||Gr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new Lae(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},ic("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new nm(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,i,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];$t("JOIN_GATEWAY_USE_443PORT_ONLY",d),$t("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);let p=this._gateway.signal.websocket;return p instanceof yC&&(p.use443PortOnly=d,p.tryDoubleDomain=h),async function(m,_,E){NE.get(m)||NE.set(m,[]),AE.get(m)||AE.set(m,_),_o.get(m)||_o.set(m,0);let x=NE.get(m),b=AE.get(m);if(!x||!b)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(_o.get(m)===b){let H=Df();x.push(H),await H.promise}_o.set(m,_o.get(m)+1);for(var C=arguments.length,U=new Array(C>3?C-3:0),k=3;k<C;k++)U[k-3]=arguments[k];let M=await E(...U);return _o.set(m,_o.get(m)-1),_o.get(m)===b-1&&x.length>0&&(x[0].resolve(),x.shift()),_o.get(m)===0&&(NE.set(m,[]),AE.set(m,0),_o.set(m,0)),M}("client.join",Y("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,i,c)}async join(e,t,r,i,c){let d=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);let h=(LE||LE||(LE=(window.location.protocol.split(":")[0]||"").toUpperCase(),LE))==="HTTPS",p=w2()?window.isSecureContext:"Browser Not Support";(!w2()&&!h||!window.isSecureContext)&&N.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let m;ze.setAppId(e);try{if(!r&&r!==null)throw new le(z.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));if(r&&us(r,"token",1,2047),us(e,"appid",1,2047),nv(t),i&&iv(i),c)if(typeof c=="string")us(c,"optionalInfo",1,256),m=c;else{if(typeof c!="object")throw new le(z.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:M,enableInstantMuteRestore:H}=c;M&&(ja(M,"autoSubscribe"),N.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(M)),this.store.autoSubscribe=M),H&&(ja(H,"enableInstantMuteRestore"),N.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(H)),this.store.enableInstantMuteRestore=H)}}}catch(M){throw ze.reportApiInvoke(cd(),{name:Or.JOIN,options:[e,t,r,i],states:{isHttps:h,isSecureContext:p},tag:Er.TRACER}).onError(M),M}if(this._leaveMutex.isLocked&&(N.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),N.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let M=new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ze.reportApiInvoke(cd(),{name:Or.JOIN,options:[e,t,r,i],states:{isHttps:h,isSecureContext:p},tag:Er.TRACER}).onError(M),M}this._gateway.state="CONNECTING",this.store.preloadStart();let _=await b5({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let E=(_==null?void 0:_.sid)||cd();N.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(d)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);let x=ze.reportApiInvoke(E,{id:this._clientId,name:Or.JOIN,options:[e,t,r,i],states:{isHttps:h,isSecureContext:p},tag:Er.TRACER}),b=oa(oa(oa({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:m,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Y("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(b.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(b.stringUid=i,this._uintUid?(b.uid=this._uintUid,this._uintUid=void 0):b.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(b.aesmode=this._encryptionMode,b.aespassword=await(async M=>{let H=function(te){let Z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ce=new Uint8Array(new ArrayBuffer(Z.length));for(let fe=0;fe<Z.length;fe+=1)ce[fe]=Z.charCodeAt(fe);return ce}(),K=await window.crypto.subtle.importKey("spki",H,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),X=x0(M),se=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},K,X);return function(te){let Z="";for(let ce=0;ce<te.length;ce+=1)Z+=String.fromCharCode(te[ce]);return window.btoa(Z)}(new Uint8Array(se))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(b.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let M=new TextEncoder,H=Y("USE_PURE_ENCRYPTION_MASTER_KEY")?M.encode(b.appId+this._encryptionSecret+this._encryptionSecret):M.encode(b.appId+b.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(K,X,se){let te=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=K==="aes-128-gcm2"?128:256,ce=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:P2,hash:"SHA-256",salt:se},te,Z+tie);return new Uint8Array(ce).subarray(Z/8)}(this._encryptionMode,H,od(this._encryptionSalt)),this._encryptDataStreamKey=await async function(K,X,se){let te=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=K==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:P2,hash:"SHA-256",salt:se},te,{name:"AES-GCM",length:Z},!0,["encrypt","decrypt"])}(this._encryptionMode,H,od(this._encryptionSalt))}else p?N.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):N.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,N.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:b.stringUid});let C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&ze.joinChannelTimeout(this._sessionId,5)},5e3);try{var U;let M,H=b.cloudProxyServer;if(Ae(U=["proxy3","proxy4","proxy5"]).call(U,H)){let Z=Y("PROXY_SERVER_TYPE3");Array.isArray(Z)?b.proxyServer=Z[0]:b.proxyServer=Z}if(ze.setProxyServer(b.proxyServer),N.setProxyServer(b.proxyServer),this.store.requestAPStart(),_){if(N.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(b.stringUid?", ".concat(b.stringUid," => ").concat(_.intUid):""," ")),b.stringUid&&!b.uid&&(b.uid=_.intUid),M={gatewayInfo:_.ap.gatewayInfo},Y("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&b.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let Z=(await EU(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(ce=>({turnServerURL:ce.address,tcpport:ce.tcpport||Cs.tcpport,udpport:ce.udpport||Cs.udpport,username:ce.username||Cs.username,password:ce.password||Cs.password,forceturn:!1,security:!0}));b.turnServer={mode:"manual",servers:Z}}C5(_,b.stringUid)}else{if(b.stringUid&&!b.uid){let Z;[Z,M]=await je.all([KU(b.stringUid,b,this._axiosCancelSource.token,this._config.httpRetryConfig||Gr,this.store).finally(()=>{this.store.requestSUAEnd()}),zU(b,this._axiosCancelSource.token,this._config.httpRetryConfig||Gr,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),N.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(Z)),b.uid=Z,M.gatewayInfo.uid=Z,M.gatewayInfo.res.uid=Z}else M=await zU(b,this._axiosCancelSource.token,this._config.httpRetryConfig||Gr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(b,this._axiosCancelSource.token),this._configDistribute.on(qf.UPDATE_BITRATE_LIMIT,Z=>{this._p2pChannel.updateBitrateLimit(Z)}),this._configDistribute.on(qf.UPDATE_CLIENT_ROLE_OPTIONS,Z=>{this._setClientRoleOptions(Z)})},0),this._key=r||e;let K=M.gatewayInfo,X=b.uid?b.uid:K.uid;this._joinInfo=oa(oa({},b),{},{cid:K.cid,uid:X,vid:K.vid,apResponse:K.res,apGatewayAddress:K.apGatewayAddress,uni_lbs_ip:K.uni_lbs_ip,gatewayAddrs:K.gatewayAddrs}),this.store.intUid=X,this.store.cid=K.cid;let se=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));x.onSuccess(se),this._appId=e,this._channelName=b.cname,this._uid=se,this.store.uid=se,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(bs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let te=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(this._uid);return N.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(te)),setTimeout(()=>{N.startUpload()},5e3),this.store.joinEnd(),k=this,Ae(md).call(md,k)||md.push(k),this._cloudProxyServerMode==="disabled"&&Dt().supportWebCrypto&&Y("ENABLE_PRELOAD")&&$C(this._joinInfo),se}catch(M){let H=Array.isArray(M)?M[0]:M;throw H&&H.code===z.OPERATION_ABORTED?N.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),H):N.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),H),H.code!==z.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),x.onError(H),H}var k}_joinGateway(){if(!this._joinInfo||!this._key)throw new le(z.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Y("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){N.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(bs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let r=md.indexOf(t);r!==-1&&md.splice(r,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return N.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Wt.LEAVE),N.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof lh))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new le(z.INVALID_PARAMS,"param list is empty");let r=e;if(this._gateway.role==="audience")throw new le(z.INVALID_OPERATION,"audience can not publish stream");for(let c of r){if(!(c instanceof lh))throw new le(z.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new le(z.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}N.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))));let i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(c=>{let d=this._configDistribute.getBitrateLimit();c instanceof ar&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(r),N.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw N.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{i()}}async _publishDataChannel(e){if(e==null)throw new le(z.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Qt(e.id,"id",0,65535,!0),ja(e.ordered,"ordered"),us(e.metadata,"metadata",0,512),N.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new le(z.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new le(z.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Y("FORCE_TURN")&&!Y("TURN_ENABLE_TCP")&&!Y("TURN_ENABLE_UDP"))throw new le(z.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let r=function(c){return LU(c,!1)}(e),i=await this._p2pChannel.publishDataChannel([r]);if(i.length>0){if(typeof r._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new le(z.CREATE_DATACHANNEL_ERROR);try{await je.all(i.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await r._waitTillOpen()}catch(c){if(c.code!==z.DISCONNECT_P2P)throw c}}return N.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw N.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new le(z.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof lh))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);N.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));let r=await this._publishMutex.lock();try{if(this.store.useP2P){let i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(kr.UNPUBLISH,{unpubMsg:i},!0)}else{let i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),N.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(c=>"".concat(c.getTrackId()))))}}catch(i){throw N.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),N.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));let t=await this._publishMutex.lock();try{let r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),N.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(r){throw N.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof Xc)){let i=this.remoteUsers.find(c=>c.uid===e);if(!i)throw new le(z.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(Jr(t,"mediaType",["audio","video"]),this.store.useP2P)throw new le(z.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new le(z.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r=t===Fe.AUDIO,i=t===Fe.VIDEO,c=await this._subscribeMutex.lock();try{let{ssrcId:d,ortc:h,rtxSsrcId:p,cname:m,uint_id:_}=await this._gateway.presubscribe(e,t,!0);if(d==null)throw new le(z.UNEXPECTED_RESPONSE,"no ssrc id");let E=this._users.find(b=>b.uid===e);E||(E=new Xc(e,_||e),E._is_pre_created=!0,this._users.push(E)),m&&(E._cname=m),E._uintid||(E._uintid=_||e),r&&(E._audioSSRC=d,E._audio_pre_subscribed=!0,h&&(E._audioOrtc=h)),i&&(E._videoSSRC=d,E._video_pre_subscribed=!0,h&&(E._videoOrtc=h),p!=null&&(E._rtxSsrcId=p)),N.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(E,t,d,p,h);let x=r?E._audioTrack:E._videoTrack;if(!x)throw new le(z.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(E._trust_audio_stream_added_state_=!0,E._audio_added_=!0),i&&(E._trust_video_stream_added_state_=!0,E._video_added_=!0),x}catch(d){throw N.error("[".concat(this._clientId,"] presub user ").concat(e," error"),d),d}finally{c()}}async _subscribeDataChannel(e,t){var r;if(Qt(t,"channelId",0,65535,!0),!this._joinInfo)throw new le(z.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new le(z.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new le(z.INVALID_REMOTE_USER,"user is not published");let i=(r=e._dataChannels)===null||r===void 0?void 0:r.find(h=>h.id===t);if(!i)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new le(z.REMOTE_USER_IS_NOT_PUBLISHED);let c=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let h=await this._p2pChannel.subscribeDataChannel(e,[i]);if(h&&Ae(h).call(h,i.id))try{var d;if(typeof i._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new le(z.CREATE_DATACHANNEL_ERROR);let p={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(d=i.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(e.uid,p,!0),await i._waitTillOpen()}catch(p){if((p==null?void 0:p.code)!==z.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),p;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{c()}}async _p2pSubscribe(e,t,r){if(Jr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new le(z.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){let c=new le(z.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){let c=new le(z.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let c=new le(z.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}let i=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let d=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,d,h)}catch(d){throw d}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});let c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new le(z.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{i()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Jr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new le(z.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e)){let m=new le(z.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),m}if(!e.hasAudio&&!e.hasVideo){let m=new le(z.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),m}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let m=new le(z.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),m}let i=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?Fe.AUDIO:Fe.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});let p=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let _=t==="audio"?e._audioSSRC:e._videoSSRC;_!==void 0&&_!==i&&(i=_,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?Fe.AUDIO:Fe.VIDEO,ssrcId:i}),ks.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,d,c);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,h,!0)}catch(E){if((E==null?void 0:E.code)!==z.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),E;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,e,t),_}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(_=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});let m=t==="audio"?e._audioTrack:e._videoTrack;if(!m)throw new le(z.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),m}catch(m){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),m),m}finally{p()}}async massSubscribe(e){if(tc(e,"subscribeList"),!this._joinInfo)throw new le(z.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),r=new Map,i=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(p=>{let{user:m,mediaType:_}=p;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(_)}).join("; ")));let c=(e=[...e]).map(p=>{let{user:m,mediaType:_}=p;return{user:m,mediaType:_}}),d=await this._p2pChannel.globalLock();try{var h;for(let m=e.length-1;m>=0;m--){let _=e[m],{user:E,mediaType:x}=_;if(Jr(x,"mediaType",["audio","video"]),!E){let U=new le(z.INVALID_PARAMS,"user property does not exist in subscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===E)){let U=new le(z.INVALID_REMOTE_USER,"user is not in the channel");N.error("[".concat(this._clientId,"] can not massSubscribe ").concat(E.uid,", this user is not in the channel")),c[m].error=U,e.splice(m,1);continue}if(x==="audio"&&(!E.hasAudio||E._audioSSRC===void 0)||x==="video"&&(!E.hasVideo||E._videoSSRC===void 0)){let U=new le(z.REMOTE_USER_IS_NOT_PUBLISHED);N.error("[".concat(this._clientId,"] can not subscribe ").concat(E.uid," with mediaType ").concat(x,", remote user is not published")),c[m].error=U,e.splice(m,1);continue}let b=rs.Video|rs.LwoVideo,C=r.get(E);if(C){if(x==="video"?C&b:C&rs.Audio){e.splice(m,1),N.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(E.uid,", mediaType:").concat(x," twice"));continue}r.set(E,C|(x==="video"?b:rs.Audio))}else r.set(E,x==="video"?b:rs.Audio)}for(let m=e.length-1;m>=0;m--){let _=e[m],{user:E,mediaType:x}=_,b=rs.Video|rs.LwoVideo;if(this._p2pChannel.hasRemoteMedia(E,x)){await this._p2pChannel.unmuteRemoteNoLock(E,x);let C=r.get(E);r.set(E,x==="video"?C^b:C^rs.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let p=zi(h=Array.from(r.entries())).call(h,(m,_)=>{let[E,x]=_;if(x===0)return m;let b={stream_id:E.uid,stream_type:x};return x&rs.Audio&&(b.audio_ssrc=E._audioSSRC),x&rs.Video&&(b.video_ssrc=E._videoSSRC),m.push(b),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(_=>{let{user:E,mediaType:x}=_;return{user:E,mediaType:x,ssrcId:x===Fe.VIDEO?E._videoSSRC:E._audioSSRC,rtxSsrcId:x===Fe.VIDEO?E._rtxSsrcId:void 0}}));let m=new Map;if(p=p.filter(_=>_.video_ssrc&&!this._p2pChannel.isPreSubScribe(_.video_ssrc)||_.audio_ssrc&&!this._p2pChannel.isPreSubScribe(_.audio_ssrc)||!_.video_ssrc&&!_.audio_ssrc),p.length>0){let _=await this._gateway.subscribeAll(p,!0);((_==null?void 0:_.users)||[]).forEach(E=>{let{stream_id:x,video_error_code:b,audio_error_code:C,error_code:U}=E;(b||C||U)&&m.set(x,{video_error_code:b,audio_error_code:C,error_code:U})})}if(Array.from(m.entries()).length>0){let _=[];Array.from(m.entries()).forEach(E=>{let[x,b]=E,C=this.remoteUsers.find(U=>U.uid===x);if(C){let U;b.error_code||b.video_error_code&&b.audio_error_code?U=void 0:b.video_error_code?U=Fe.VIDEO:b.audio_error_code&&(U=Fe.AUDIO),_.push({user:C,mediaType:U})}}),_.length>0&&await this._p2pChannel.massUnsubscribeNoLock(_)}for(let _ of c){let E=m.get(_.user.uid);if(E){let x=E.error_code||_.mediaType==="audio"&&E.audio_error_code||_.mediaType==="video"&&E.video_error_code;if(x){let b=Yf(x);N.error("user:".concat(_.user.uid," mediaType:").concat(_.mediaType," has massSubscribe error ").concat(b.desc)),_.error=new le(z.SUBSCRIBE_FAILED,"code ".concat(x,": ").concat(b.desc))}}_.error||(_.mediaType==="video"?_.track=_.user.videoTrack:_.track=_.user.audioTrack)}return this.store.massSubscribe(c.filter(_=>!_.error).map(_=>({userId:_.user.uid,type:_.mediaType})),void 0,Date.now()),c.forEach(_=>{var E;ze.subscribe(this.store.sessionId,{succ:!!_.error,ec:((E=_.error)===null||E===void 0?void 0:E.code)||null,video:_.mediaType===Fe.VIDEO,audio:_.mediaType===Fe.AUDIO,peerid:_.user.uid,subscribeRequestid:_.mediaType===Fe.VIDEO?_.user._videoSSRC:_.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(_.user._videoSSRC)},!0)}),N.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(_=>{let{user:E,mediaType:x}=_;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(x)}).join("; "))),c}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{d(),i()}}async unsubscribe(e,t,r){if(!(e instanceof Xc)){let c=this.remoteUsers.find(d=>d.uid===e);if(!c)throw new le(z.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&Jr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new le(z.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){let c=new le(z.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let c=await this._p2pChannel.unsubscribe(e,t);c&&await this._gateway.unsubscribe(c,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&PE(this._users,e),N.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===z.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&Qt(t,"id",0,65535,!0),!this._joinInfo)throw new le(z.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){let i=new le(z.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){let i=e._dataChannels.find(c=>c.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){let i=new le(z.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{let i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),N.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===z.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(tc(e,"unsubscribeList"),!this._joinInfo)throw new le(z.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");N.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:i,mediaType:c}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:i,mediaType:c}=e[r];if(!i){let h=new le(z.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(Jr(c,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===i)){N.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(r,1);continue}let d=rs.Video|rs.LwoVideo;if(t.has(i)){let h=t.get(i),p;switch(c){case"video":p=h&d;break;case"audio":p=h&rs.Audio;break;default:p=h&(rs.Audio|d)}if(p){N.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(c," twice.")),e.splice(r,1);continue}c?c==="audio"?t.set(i,h|rs.Audio):c==="video"&&t.set(i,h|d):t.set(i,h|rs.Audio|d)}else c?c==="audio"?t.set(i,rs.Audio):c==="video"&&t.set(i,d):t.set(i,rs.Audio|d)}try{let r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),N.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:c,mediaType:d}=i;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(r){if(r.code===z.DISCONNECT_P2P)return void N.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw N.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new he(z.INVALID_PARAMS);Cr(r.width)||v0(r.width,"streamParameter.width"),Cr(r.height)||v0(r.height,"streamParameter.height"),Cr(r.framerate)||v0(r.framerate,"streamParameter.framerate"),Cr(r.bitrate)||Qt(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&N.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),N.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Se.LocalVideoLowTrack)}async enableDualStream(){if(!Dt().supportDualStream)throw ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new le(z.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new le(z.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),N.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new le(z.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Se.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),N.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){Jr(i,"role",["audience","host"])}(e),t&&w0(t),this.mode==="rtc"||this.mode==="p2p")throw N.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new le(z.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new le(z.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new le(z.INVALID_OPERATION,"can not set client role to audience when publishing stream");let r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&Y("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",ws.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),N.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&w0(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{N.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(us(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new le(z.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new le(z.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ze.setProxyServer(this._proxyServer),N.setProxyServer(this._proxyServer),N.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new le(z.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new le(z.INVALID_OPERATION,"You have already set the proxy")}if(Lf(e))return this._turnServer={servers:e,mode:"original-manual"},void N.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>u2(r)),this._turnServer={servers:e,mode:"manual"},N.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new le(z.INVALID_OPERATION,"you should set license before join channel");if(us(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new le(z.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,N.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new le(z.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new le(z.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new le(z.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new le(z.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new le(z.INVALID_OPERATION,"Stop proxy server after leave channel");ze.setProxyServer(),N.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new le(z.INVALID_PARAMS,"accessPoints is required.");tc(e.accessPoints.serverList,"accessPoints.serverList"),us(e.accessPoints.domain,"accessPoints.domain");let t=(b,C)=>{Qt(b,C,0,65535,!0)},r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new le(z.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Y("CLOSE_AFB_FOR_LOCAL_AP")&&($t("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),$t("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,d=e.accessPoints.serverList.map(b=>i.test(b)?"".concat(b.replace(/\./g,"-"),".").concat(c):b),h=d.map(b=>"".concat(b,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,$t("WEBCS_DOMAIN",h),$t("WEBCS_DOMAIN_BACKUP_LIST",h),$t("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(tc(e.report.hostname,"report.hostname"),$t("EVENT_REPORT_DOMAIN",e.report.hostname[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):($t("EVENT_REPORT_DOMAIN",d[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let p=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),p=e.report.port),$t("STATS_COLLECTOR_PORT",p),e.report?$t("ENABLE_EVENT_REPORT",!0):$t("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(tc(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=d[0];let _=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),_=e.log.port),$t("LOG_UPLOAD_SERVER","".concat(m,":").concat(_));let E=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(tc(e.cds.hostname,"cds.hostname"),E=e.cds.hostname):E=d;let x=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),x=e.cds.port),$t("CDS_AP",E.map(b=>"".concat(b,":").concat(x))),e.cds?$t("ENABLE_CONFIG_DISTRIBUTE",!0):$t("ENABLE_CONFIG_DISTRIBUTE",!1),N.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(tc(e,"serverList"),us(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new le(z.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>r.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,$t("WEBCS_DOMAIN",e),$t("WEBCS_DOMAIN_BACKUP_LIST",e),$t("GATEWAY_DOMAINS",[t]),$t("EVENT_REPORT_DOMAIN",e[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),$t("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),N.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Jr(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw N.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else N.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Jr(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let r=this._users.find(i=>i.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw N.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}N.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Jr(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw N.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}N.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,i){(function(d){Jr(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),us(t,"secret");let c=["aes-128-gcm2","aes-256-gcm2"];if(Ae(c).call(c,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new le(z.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new le(z.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(ja(i,"encryptDataStream"),!Ae(c).call(c,e))throw new le(z.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||N.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=Uc(r))}async renewToken(e){if(us(e,"token",1,2047),!this._key||!this._joinInfo)throw new le(z.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let r=await this._renewTokenMutex.lock();try{if(Y("USE_NEW_TOKEN")){N.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let i=await jae(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Gr);N.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else N.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});N.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,N.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?N.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(wt.VOLUME_INDICATOR,e)},Y("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new le(z.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new le(z.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new le(z.LIVE_STREAMING_TASK_CONFLICT);let r=t?rc.TRANSCODE:rc.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(rc.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new le(z.INVALID_PARAMS,"can not find live streaming url to stop");await je.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QU(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QU(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof nm&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new le(z.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let c=new TextEncoder;e.payload=c.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ae(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(c,d,h){var p;let m=zi(p=Array.from(h)).call(p,(k,M)=>k+M,0),_={serverTs:0,seq:rie++,length:h.length,checkSum:m},E=new Uint8Array(v2(m,2)),x=new ArrayBuffer(sh),b=new DataView(x);b.setUint32(0,_.serverTs),b.setUint16(4,_.seq),b.setUint16(6,_.length),b.setUint16(8,_.checkSum);let C=16-h.length%16;h=f2(h,new Uint8Array(C));let U=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:D2,additionalData:E},d,h);return f2(new Uint8Array(x),new Uint8Array(U))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new le(z.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(it.DATA_STREAM,{payload:Uc(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Gae},!r)}sendMetadata(e){if(!this._joinInfo)throw new le(z.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new le(z.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(it.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Uc(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(uie),!this._joinInfo)throw new le(z.INVALID_OPERATION,"can not send custom report, not joined");await ze.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let e=this._statsCollector.getRemoteNetworkQualityStats();if(Y("DELETE_NEQ_AFTER_USER_LEAVE")){let t=this._users.map(r=>r.uid+"");Object.keys(e).forEach(r=>{Ae(t).call(t,r)||delete e[r]})}return e}async pickSVCLayer(e,t){Jr(t.spatialLayer,"spatialLayer",[0,1,2,3]),Jr(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw N.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:r}=e;if(ja(t,"apRTM"),Qt(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,N.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(N.debug("[".concat(this._clientId,"] reset client")),function(e){let t=mh.indexOf(e);t!==-1&&mh.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=dn.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&S5(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ze.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Is("client-publish",this._clientId),this._subscribeMutex=new Is("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;let i=e||cd();e?N.debug("[".concat(this._clientId,"] new Session ").concat(i)):N.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));let c=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,ze.addSid(i);let d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};ze.sessionInit(this._sessionId,oa({cname:t.channel,appid:t.appId},d)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new le(z.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Y("FORCE_TURN")&&!Y("TURN_ENABLE_TCP")&&!Y("TURN_ENABLE_UDP"))throw new le(z.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");N.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let i=(await r.next()).value;if(i){try{await this._gateway.sendExtensionMessage(kr.PUBLISH,i,!0)}catch(c){throw r.throw(c),c}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let i=(await r.next()).value;if(i){var t;let c;try{c=await this._gateway.publish(this._uid,i,!0)}catch(d){if(d.code!==z.DISCONNECT_P2P)throw r.throw(d),d}await r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let c of e)c instanceof ar&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{N.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===z.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new le(z.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new le(z.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));N.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await r.next()).value;if(i){var t;let c;try{c=await this._gateway.publish(this._uid,i,!0)}catch(d){if(d.code!==z.DISCONNECT_P2P)throw r.throw(d),d}r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===z.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new le(z.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let r=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ic("LiveStreaming").create(i));var i;return r.onLiveStreamError=(c,d)=>{ze.reportApiInvoke(this._sessionId,{name:Or.ON_LIVE_STREAM_ERROR,options:[c,d],tag:Er.TRACER}).onSuccess(),this.safeEmit(wt.LIVE_STREAMING_ERROR,c,d)},r.onLiveStreamWarning=(c,d)=>{ze.reportApiInvoke(this._sessionId,{name:Or.ON_LIVE_STREAM_WARNING,options:[c,d],tag:Er.TRACER}).onSuccess(),this.safeEmit(wt.LIVE_STREAMING_WARNING,c,d)},r.on(_C.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new le(z.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(p,m,_,E){let x=Y("UAP_AP").slice(0,Y("AJAX_REQUEST_CONCURRENT")).map(b=>m.proxyServer?"https://".concat(m.proxyServer,"/ap/?url=").concat(b+"/api/v1?action=uap"):"https://".concat(b,"/api/v1?action=uap"));return await Nae(x,p,m,_,E)})(c,this._joinInfo,this._axiosCancelSource.token,Gr).then(d).catch(h)}),r};return e===rc.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new le(z.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},ic("ChannelMediaRelay").create(e));i.on("state",c=>{c===bn.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(wt.CHANNEL_MEDIA_RELAY_STATE,c)}),i.on("event",c=>{this.safeEmit(wt.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:r,deleted:i}=e,c=[];if(t){let d=[];this._users.forEach(h=>{h._dataChannels.forEach(p=>{r.every(m=>m.uid!==h._uintid||m.stream_id!==p.id)&&d.push({uid:h._uintid,stream_id:p.id,ordered:p.ordered,max_retrans_times:p.maxRetransmits,metadata:p.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(r)&&r.length>0&&r.forEach(d=>{let{uid:h,stream_id:p,ordered:m,max_retrans_times:_,metadata:E}=d,x=this._users.find(b=>b._uintid===h);if(!x)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(N.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),Ae(c).call(c,x)||c.push(x),x._uintid||(x._uintid=h),x._dataChannels.findIndex(b=>b.id===d.stream_id)===-1){let b={id:p,ordered:!!m,maxRetransmits:_,metadata:E},C=function(U){return LU(U,!0)}(b);x._dataChannels.push(C),N.info("[".concat(this._clientId,"] remote user ").concat(x.uid," published datachannel")),t||this.safeEmit(wt.USER_PUBLISHED,x,"datachannel",b)}this._p2pChannel.hasPendingRemoteDataChannel(x,d.stream_id)&&(N.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(x.uid," after reconnect.")),this._subscribeDataChannel(x,d.stream_id).catch(b=>{N.error("[".concat(this._clientId,"] resubscribe datachannel error"),b.toString())}))}),t&&(this.safeEmit(wt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(d=>{let{uid:h,stream_id:p}=d,m=this._users.find(E=>E._uintid===h);if(!m)return void N.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let _=m._dataChannels.find(E=>E.id===d.stream_id);_&&(N.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(m,[_]).then(E=>{if(m._dataChannels=m._dataChannels.filter(x=>x!==_),E)return this._gateway.unsubscribeDataChannel(E,m.uid)}),N.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(_.id)),this.safeEmit(wt.USER_UNPUBLISHED,m,"datachannel",_._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;let r=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(r)for(let c of r){var i;if(c.payloadType===e)return c==null||(i=c.rtpMap)===null||i===void 0?void 0:i.encodingName}}_handleRemoveDataChannels(e){let t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){N.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let r=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(wt.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),r()}}else N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(is.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void N.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(i=>{let{value:c,type:d,expires:h}=t[i];h&&h<=r||d||dC()||!Object.prototype.hasOwnProperty.call(UE,i)||(Ma[i]=c,gr[i]=c,N.debug("Update gateway parameters from config distribute",i,c))})}catch(t){N.error("Error update config from local cache",t.message)}})()}),this._gateway.on(is.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(is.CONNECTION_STATE_CHANGE,(e,t,r)=>{var i;if(r===Wt.FALLBACK)return;let c=()=>{this.safeEmit(wt.CONNECTION_STATE_CHANGE,e,t,r)};if(ze.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Or.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:Er.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),N.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,p)=>{this._gateway.setStreamFallbackOption(p,h).catch(m=>{N.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((h,p)=>{this._gateway.setRemoteVideoStreamType(p,h).catch(m=>{N.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{N.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{N.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{N.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Fe.AUDIO,!1)),h._trust_video_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Fe.VIDEO,!1)),h._trust_audio_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(N.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(is.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new le(z.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r,i=await b5(oa(oa({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(r=i.ap,C5(i),this._joinInfo.preload=!0):(r=await PC(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Gr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);let c=[];r.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d,[p,m]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:p,port:m}):c.push({host:p,port:m})}),e(c)}catch(r){t(r)}}),this._gateway.on(is.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(wt.NETWORK_QUALITY,e)}),this._gateway.on(is.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(wt.STREAM_TYPE_CHANGED,e,t),ze.reportApiInvoke(this._sessionId,{name:Or.STREAM_TYPE_CHANGE,options:[e,t],tag:Er.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(is.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(is.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){r(i)}}),this._gateway.on(is.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r;this._joinResponse=e,e.attributes?r=e.attributes.userAttributes.preSubSsrcs:N.debug("no attributes in joinResponse");let i=SU(e.ortc,t,r);this._p2pChannel.connect(i)}),this._gateway.on(is.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:r,turnServer:i}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){let{cert:d,cid:h}=this._joinInfo.apResponse,p="".concat(h,"_").concat(d);if(p.length<4||p.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(d),icePwd:"".concat(h,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=Y("FINGERPRINT"))!==null&&c!==void 0?c:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(m){m.code&&m.code===z.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(St.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(St.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(St.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(St.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(St.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(St.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(St.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(St.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(St.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Fe.AUDIO,!0)),this._gateway.signal.on(St.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Fe.AUDIO,!1)),this._gateway.signal.on(St.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Fe.VIDEO,!0)),this._gateway.signal.on(St.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Fe.VIDEO,!1)),this._gateway.signal.on(St.RECEIVE_METADATA,e=>{let t=od(e.metadata);this.safeEmit(wt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(St.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=od(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ae(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<sh)throw new le(z.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(sh));r=await async function(c,d,h){let p=h.subarray(0,sh),m=p.slice(8,sh),_=(m[0]<<8)+m[1],E=(p[6]<<8)+p[7],x=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:D2,additionalData:new Uint8Array(v2(_,2))},d,h.subarray(sh));return new Uint8Array(x).subarray(0,E)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let i=0;if(e.ordered||e.syncWithAudio){let c=this._p2pChannel.getStats(),d=this.remoteUsers.find(p=>p.uid===e.uid),h=c==null?void 0:c.audioRecv.find(p=>p.ssrc===(d==null?void 0:d._audioSSRC));i=h==null?void 0:h.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),zae(oa(oa({},e),{},{payload:r}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(St.ON_CRYPT_ERROR,()=>{Fc(()=>{N.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(wt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(St.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{N.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Wt.TOKEN_EXPIRE),this.safeEmit(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(St.ON_STREAM_FALLBACK_UPDATE,e=>{N.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(wt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(St.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),N.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(St.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(St.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ot.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case it.PUBLISH:{if(!t)return;let c=t.ortc;if(c){var r,i;let d=c.some(m=>{let{stream_type:_}=m;return _===zt.Audio}),h=c.some(m=>{let{stream_type:_}=m;return _!==zt.Audio}),p=c.some(m=>{let{stream_type:_}=m;return _===zt.Screen||_===zt.ScreenLow});t.state==="offer"&&ze.publish(this._joinInfo.sid,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:z.TIMEOUT,audio:d,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:d?(r=c.find(m=>{let{stream_type:_}=m;return _===zt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:h?(i=c.find(m=>{let{stream_type:_}=m;return _!==zt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case it.SUBSCRIBE:t&&ze.subscribe(this._joinInfo.sid,{succ:!1,ec:z.TIMEOUT,audio:t.stream_type===Fe.AUDIO,video:t.stream_type===Fe.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ks.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(St.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(St.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Y("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!gd(i.string_id||i.stream_id,this.channelName)));let t=[],r=[];for(let i of e.users){let c=this._users.find(E=>E._uintid===i.stream_id);c?c._trust_in_room_=!0:(c=new Xc(i.string_id||i.stream_id,i.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(wt.PUBLISHED_USER_LIST).length===0&&(N.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(wt.USER_JOINED,c)));let d=rs.Audio&i.stream_type,h=(rs.Video|rs.LwoVideo)&i.stream_type,p=(65280&i.stream_type)!=0,m=d&&c.hasAudio,_=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=i.video_ssrc,c._rtxSsrcId=i.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=i.audio_ssrc),d&&!m&&this.getListeners(wt.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(wt.USER_PUBLISHED,c,"audio")),h&&!_&&this.getListeners(wt.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(wt.USER_PUBLISHED,c,"video")),(d&&!m||h&&!_||p)&&t.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&r.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&r.push({user:c,mediaType:"audio"})}r.length>0&&(N.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(i=>{N.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(wt.PUBLISHED_USER_LIST).length>0?Y("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(N.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(wt.PUBLISHED_USER_LIST,t)):N.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(St.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof nm&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var i;return Ae(i=Object.keys(Bf)).call(i,r)}))})}_handleP2PEvents(){this._gateway.signal.on(St.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(kr.PUBLISH,(e,t,r)=>{let{uid:i}=e;e.forEach(c=>{let{kind:d,ssrcs:h,mid:p,isMuted:m}=c;this._handleP2PAddAudioOrVideoStream(d,i,h[0].ssrcId,p);let _=this._users.find(E=>E.uid===i);return _&&this.store.useP2P?this._p2pChannel.mockSubscribe(_,d,h[0].ssrcId,p).then(()=>{t()}).catch(r):t(),this._handleMuteStream(i,d,!!m)})}),this._gateway.signal.on(kr.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(c){r(c)}}),this._gateway.signal.on(ot.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(kr.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){let{unpubMsg:i,uid:c}=e,d=this._users.find(h=>h.uid===c);if(!d)return N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{i.forEach(async h=>{let{stream_type:p}=h,m=p===zt.Audio?Fe.AUDIO:Fe.VIDEO;await this._p2pChannel.unsubscribe(d,m),this._handleMuteStream(c,m,!0)}),t()}catch(h){r(h)}}}),this._gateway.signal.on(kr.CONTROL,async(e,t)=>{let{action:r}=e;switch(r){case Gc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Fe.VIDEO,!0);break;case Gc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Fe.AUDIO,!0);break;case Gc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Fe.VIDEO,!1);break;case Gc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Fe.AUDIO,!1)}}),this._gateway.signal.on(kr.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{let{direction:i,iceParameter:c}=e;i!==rn.SEND_ONLY||c?t(await this._p2pChannel.restartICE(i,c)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){r(i)}}),this._gateway.signal.on(kr.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(Je.RequestP2PRestartICE,async(e,t,r)=>{try{let{direction:i}=e;t(await this._gateway.sendExtensionMessage(kr.RESTART_ICE,e,i===rn.SEND_ONLY))}catch(i){r(i)}}),this._p2pChannel.on(Je.LocalCandidate,e=>{this._gateway.sendExtensionMessage(kr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Je.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(kr.CONTROL,e,!0),t()}catch(i){r(i)}}),this._p2pChannel.on(Je.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===z.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(Je.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===z.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(Je.StateChange,(e,t)=>{t===Gt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Je.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(wt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Je.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===z.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(Je.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===z.DISCONNECT_P2P?t():r(i)}else t()}),this._p2pChannel.on(Je.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(Je.RequestRePublishDataChannel,(e,t,r)=>{je.all(e.map(async i=>{let c=await this._p2pChannel.publishDataChannel([i]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==z.DISCONNECT_P2P)throw d}})).then(t).catch(r)}),this._p2pChannel.on(Je.RequestReSubscribe,async(e,t,r)=>{try{for(let{user:i,kind:c}of e)c===Fe.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){r(i)}}),this._p2pChannel.on(Je.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Je.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Je.MediaReconnectStart,e=>{this.safeEmit(wt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Je.MediaReconnectEnd,e=>{this.safeEmit(wt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Je.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Je.RequestRestartICE,async e=>{if(this.store.useP2P)return;let t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;let i=r.value,c;try{c=await this._gateway.restartICE({iceParameters:i})}catch(h){return void t.throw(h)}let{iceParameters:d}=function(h){let p=h.iceParameters;return{iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd}}}(c);await t.next({remoteIceParameters:d})}),this._p2pChannel.on(Je.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Je.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:i}),h=SU(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Je.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(Je.P2PLost,()=>{this.safeEmit(wt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Je.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Je.ConnectionTypeChange,e=>{this.safeEmit(wt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Je.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Je.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Je.AudioMetadata,e=>{this.safeEmit(wt.AUDIO_METADATA,e)}),this._p2pChannel.on(Je.AudioPts,e=>{this.safeEmit(wt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let r=(t={config:e},ic("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);let{appId:i,cname:c,sid:d,token:h,uid:p,cid:m,vid:_}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:c,sid:d,token:h,uid:p,cid:m,vid:_?Number(_):0},Gr)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(as.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(wt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===sa.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(wt.CONTENT_INSPECT_ERROR,new le(z.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(as.INSPECT_RESULT,(t,r)=>{var i;if((r==null?void 0:r.code)===z.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return N.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(wt.CONTENT_INSPECT_RESULT,t,r)}),e.on(as.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(ja(e,"enabled"),e){if(!t)throw new le(z.INVALID_PARAMS,"config is required");if(F5(t),!this._joinInfo)throw new le(z.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let i=(r={config:t},ic("ImageModeration").create(r));this._moderation=i,this.handleImageModerationEvents(i);let{appId:c,cname:d,sid:h,token:p,uid:m,cid:_,vid:E}=this._joinInfo;await i.init({appId:c,areaCode:"",cname:d,sid:h,token:p,uid:m,cid:_,vid:E?Number(E):0},Gr)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var r;if(!this._moderation)throw new le(z.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(Va.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(wt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===Ti.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new le(z.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Va.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Jr(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new le(z.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,N.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return N.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ja(e,"enabled"),$t("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ge(Me.prototype,"leave",[U5],Object.getOwnPropertyDescriptor(Me.prototype,"leave"),Me.prototype),Ge(Me.prototype,"publish",[V5],Object.getOwnPropertyDescriptor(Me.prototype,"publish"),Me.prototype),Ge(Me.prototype,"unpublish",[B5],Object.getOwnPropertyDescriptor(Me.prototype,"unpublish"),Me.prototype),Ge(Me.prototype,"subscribe",[W5],Object.getOwnPropertyDescriptor(Me.prototype,"subscribe"),Me.prototype),Ge(Me.prototype,"presubscribe",[G5],Object.getOwnPropertyDescriptor(Me.prototype,"presubscribe"),Me.prototype),Ge(Me.prototype,"massSubscribe",[H5],Object.getOwnPropertyDescriptor(Me.prototype,"massSubscribe"),Me.prototype),Ge(Me.prototype,"unsubscribe",[z5],Object.getOwnPropertyDescriptor(Me.prototype,"unsubscribe"),Me.prototype),Ge(Me.prototype,"massUnsubscribe",[K5],Object.getOwnPropertyDescriptor(Me.prototype,"massUnsubscribe"),Me.prototype),Ge(Me.prototype,"setLowStreamParameter",[q5],Object.getOwnPropertyDescriptor(Me.prototype,"setLowStreamParameter"),Me.prototype),Ge(Me.prototype,"enableDualStream",[Y5],Object.getOwnPropertyDescriptor(Me.prototype,"enableDualStream"),Me.prototype),Ge(Me.prototype,"disableDualStream",[$5],Object.getOwnPropertyDescriptor(Me.prototype,"disableDualStream"),Me.prototype),Ge(Me.prototype,"setClientRole",[X5],Object.getOwnPropertyDescriptor(Me.prototype,"setClientRole"),Me.prototype),Ge(Me.prototype,"_setClientRoleOptions",[J5],Object.getOwnPropertyDescriptor(Me.prototype,"_setClientRoleOptions"),Me.prototype),Ge(Me.prototype,"setProxyServer",[Q5],Object.getOwnPropertyDescriptor(Me.prototype,"setProxyServer"),Me.prototype),Ge(Me.prototype,"setTurnServer",[Z5],Object.getOwnPropertyDescriptor(Me.prototype,"setTurnServer"),Me.prototype),Ge(Me.prototype,"setLicense",[eV],Object.getOwnPropertyDescriptor(Me.prototype,"setLicense"),Me.prototype),Ge(Me.prototype,"startProxyServer",[tV],Object.getOwnPropertyDescriptor(Me.prototype,"startProxyServer"),Me.prototype),Ge(Me.prototype,"stopProxyServer",[rV],Object.getOwnPropertyDescriptor(Me.prototype,"stopProxyServer"),Me.prototype),Ge(Me.prototype,"setLocalAccessPointsV2",[sV],Object.getOwnPropertyDescriptor(Me.prototype,"setLocalAccessPointsV2"),Me.prototype),Ge(Me.prototype,"setLocalAccessPoints",[nV],Object.getOwnPropertyDescriptor(Me.prototype,"setLocalAccessPoints"),Me.prototype),Ge(Me.prototype,"setRemoteDefaultVideoStreamType",[iV],Object.getOwnPropertyDescriptor(Me.prototype,"setRemoteDefaultVideoStreamType"),Me.prototype),Ge(Me.prototype,"setRemoteVideoStreamType",[aV],Object.getOwnPropertyDescriptor(Me.prototype,"setRemoteVideoStreamType"),Me.prototype),Ge(Me.prototype,"setStreamFallbackOption",[oV],Object.getOwnPropertyDescriptor(Me.prototype,"setStreamFallbackOption"),Me.prototype),Ge(Me.prototype,"setEncryptionConfig",[cV],Object.getOwnPropertyDescriptor(Me.prototype,"setEncryptionConfig"),Me.prototype),Ge(Me.prototype,"renewToken",[lV],Object.getOwnPropertyDescriptor(Me.prototype,"renewToken"),Me.prototype),Ge(Me.prototype,"enableAudioVolumeIndicator",[dV],Object.getOwnPropertyDescriptor(Me.prototype,"enableAudioVolumeIndicator"),Me.prototype),Ge(Me.prototype,"startLiveStreaming",[uV],Object.getOwnPropertyDescriptor(Me.prototype,"startLiveStreaming"),Me.prototype),Ge(Me.prototype,"setLiveTranscoding",[hV],Object.getOwnPropertyDescriptor(Me.prototype,"setLiveTranscoding"),Me.prototype),Ge(Me.prototype,"stopLiveStreaming",[pV],Object.getOwnPropertyDescriptor(Me.prototype,"stopLiveStreaming"),Me.prototype),Ge(Me.prototype,"startChannelMediaRelay",[fV],Object.getOwnPropertyDescriptor(Me.prototype,"startChannelMediaRelay"),Me.prototype),Ge(Me.prototype,"updateChannelMediaRelay",[mV],Object.getOwnPropertyDescriptor(Me.prototype,"updateChannelMediaRelay"),Me.prototype),Ge(Me.prototype,"stopChannelMediaRelay",[gV],Object.getOwnPropertyDescriptor(Me.prototype,"stopChannelMediaRelay"),Me.prototype),Ge(Me.prototype,"sendCustomReportMessage",[_V],Object.getOwnPropertyDescriptor(Me.prototype,"sendCustomReportMessage"),Me.prototype),Ge(Me.prototype,"pickSVCLayer",[EV],Object.getOwnPropertyDescriptor(Me.prototype,"pickSVCLayer"),Me.prototype),Ge(Me.prototype,"setRTMConfig",[vV],Object.getOwnPropertyDescriptor(Me.prototype,"setRTMConfig"),Me.prototype),Ge(Me.prototype,"enableContentInspect",[yV],Object.getOwnPropertyDescriptor(Me.prototype,"enableContentInspect"),Me.prototype),Ge(Me.prototype,"disableContentInspect",[xV],Object.getOwnPropertyDescriptor(Me.prototype,"disableContentInspect"),Me.prototype),Ge(Me.prototype,"setImageModeration",[bV],Object.getOwnPropertyDescriptor(Me.prototype,"setImageModeration"),Me.prototype),Ge(Me.prototype,"setP2PTransport",[wV],Object.getOwnPropertyDescriptor(Me.prototype,"setP2PTransport"),Me.prototype),Ge(Me.prototype,"getJoinChannelServiceRecords",[SV],Object.getOwnPropertyDescriptor(Me.prototype,"getJoinChannelServiceRecords"),Me.prototype),Ge(Me.prototype,"setPublishAudioFilterEnabled",[CV],Object.getOwnPropertyDescriptor(Me.prototype,"setPublishAudioFilterEnabled"),Me.prototype),Me);class om{constructor(t,r){W(this,"id",0),W(this,"element",void 0),W(this,"peerPair",void 0),W(this,"context",void 0),W(this,"audioPlayerElement",void 0),W(this,"audioTrack",void 0),om.count+=1,this.id=om.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;let t=async(i,c)=>{let d=c==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(d),i.iceGatheringState==="complete"?i.localDescription:new je(h=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&h(i.localDescription)}})},r=async(i,c)=>await i.setRemoteDescription(c);try{let i=await t(this.peerPair[0],"offer");await r(this.peerPair[1],i);let c=await t(this.peerPair[1],"answer");await r(this.peerPair[0],c)}catch(i){throw new le(z.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(c){throw new le(z.LOCAL_AEC_ERROR,c.toString()).print()}if(!r)throw new le(z.LOCAL_AEC_ERROR,"no dest node when local aec").print();let i=r.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){N.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var RV,kv;W(om,"count",0);let coe=window.AudioContext||window.webkitAudioContext,loe=new(RV=st({report:ze}),Ge((kv=class{constructor(){W(this,"units",[]),W(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return N.debug("the system does not need to process local aec"),-1;this.context||(this.context=new coe);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new om(e,this.context),this.units.push(t)),t.startEchoCancellation(),N.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Rt().name!==Lt.SAFARI}}).prototype,"processExternalMediaAEC",[RV],Object.getOwnPropertyDescriptor(kv.prototype,"processExternalMediaAEC"),kv.prototype),kv);function NV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function AV(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NV(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let QC=window||document;function IV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!QC)return;let r=Hr._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);let i=c=>{if(!(c&&c.blockedURI&&(Hr.onSecurityPolicyViolation||Hr.getListeners(wo.SECURITY_POLICY_VIOLATION).length>0)))return;let d=c.blockedURI;Y("CSP_DETECTED_HOSTNAME_LIST").some(h=>Ae(d).call(d,h))&&(Hr.onSecurityPolicyViolation&&typeof Hr.onSecurityPolicyViolation=="function"&&Hr.onSecurityPolicyViolation(c),Hr.getListeners(wo.SECURITY_POLICY_VIOLATION).length>0&&Hr.safeEmit(wo.SECURITY_POLICY_VIOLATION,c))};r&&QC.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||Hr.getListeners(wo.SECURITY_POLICY_VIOLATION).length>0)&&QC.addEventListener("securitypolicyviolation",i),Hr._cspEventHandlerPointer=i}var doe=I,uoe=hL,OV=RegExp.prototype,hoe=function(e){return e===OV||doe(OV,e)?uoe(e):e.flags},$s=u(hoe);function Ah(e){let t=e.length;for(;--t>=0;)e[t]=0}let ZC=256,DV=286,cm=30,lm=15,eT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),jv=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),poe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),PV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),oc=new Array(576);Ah(oc);let dm=new Array(60);Ah(dm);let um=new Array(512);Ah(um);let hm=new Array(256);Ah(hm);let tT=new Array(29);Ah(tT);let Lv=new Array(cm);function rT(e,t,r,i,c){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=c,this.has_stree=e&&e.length}let kV,jV,LV;function sT(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ah(Lv);let MV=e=>e<256?um[e]:um[256+(e>>>7)],pm=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},hi=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,pm(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},To=(e,t,r)=>{hi(e,r[2*t],r[2*t+1])},FV=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},UV=(e,t,r)=>{let i=new Array(16),c,d,h=0;for(c=1;c<=lm;c++)h=h+r[c-1]<<1,i[c]=h;for(d=0;d<=t;d++){let p=e[2*d+1];p!==0&&(e[2*d]=FV(i[p]++,p))}},VV=e=>{let t;for(t=0;t<DV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<cm;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},BV=e=>{e.bi_valid>8?pm(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},WV=(e,t,r,i)=>{let c=2*t,d=2*r;return e[c]<e[d]||e[c]===e[d]&&i[t]<=i[r]},nT=(e,t,r)=>{let i=e.heap[r],c=r<<1;for(;c<=e.heap_len&&(c<e.heap_len&&WV(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!WV(t,i,e.heap[c],e.depth));)e.heap[r]=e.heap[c],r=c,c<<=1;e.heap[r]=i},GV=(e,t,r)=>{let i,c,d,h,p=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+p++],i+=(255&e.pending_buf[e.sym_buf+p++])<<8,c=e.pending_buf[e.sym_buf+p++],i===0?To(e,c,t):(d=hm[c],To(e,d+ZC+1,t),h=eT[d],h!==0&&(c-=tT[d],hi(e,c,h)),i--,d=MV(i),To(e,d,r),h=jv[d],h!==0&&(i-=Lv[d],hi(e,i,h)));while(p<e.sym_next);To(e,256,t)},iT=(e,t)=>{let r=t.dyn_tree,i=t.stat_desc.static_tree,c=t.stat_desc.has_stree,d=t.stat_desc.elems,h,p,m,_=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<d;h++)r[2*h]!==0?(e.heap[++e.heap_len]=_=h,e.depth[h]=0):r[2*h+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=_<2?++_:0,r[2*m]=1,e.depth[m]=0,e.opt_len--,c&&(e.static_len-=i[2*m+1]);for(t.max_code=_,h=e.heap_len>>1;h>=1;h--)nT(e,r,h);m=d;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],nT(e,r,1),p=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=p,r[2*m]=r[2*h]+r[2*p],e.depth[m]=(e.depth[h]>=e.depth[p]?e.depth[h]:e.depth[p])+1,r[2*h+1]=r[2*p+1]=m,e.heap[1]=m++,nT(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((E,x)=>{let b=x.dyn_tree,C=x.max_code,U=x.stat_desc.static_tree,k=x.stat_desc.has_stree,M=x.stat_desc.extra_bits,H=x.stat_desc.extra_base,K=x.stat_desc.max_length,X,se,te,Z,ce,fe,xe=0;for(Z=0;Z<=lm;Z++)E.bl_count[Z]=0;for(b[2*E.heap[E.heap_max]+1]=0,X=E.heap_max+1;X<573;X++)se=E.heap[X],Z=b[2*b[2*se+1]+1]+1,Z>K&&(Z=K,xe++),b[2*se+1]=Z,se>C||(E.bl_count[Z]++,ce=0,se>=H&&(ce=M[se-H]),fe=b[2*se],E.opt_len+=fe*(Z+ce),k&&(E.static_len+=fe*(U[2*se+1]+ce)));if(xe!==0){do{for(Z=K-1;E.bl_count[Z]===0;)Z--;E.bl_count[Z]--,E.bl_count[Z+1]+=2,E.bl_count[K]--,xe-=2}while(xe>0);for(Z=K;Z!==0;Z--)for(se=E.bl_count[Z];se!==0;)te=E.heap[--X],te>C||(b[2*te+1]!==Z&&(E.opt_len+=(Z-b[2*te+1])*b[2*te],b[2*te+1]=Z),se--)}})(e,t),UV(r,_,e.bl_count)},HV=(e,t,r)=>{let i,c,d=-1,h=t[1],p=0,m=7,_=4;for(h===0&&(m=138,_=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)c=h,h=t[2*(i+1)+1],++p<m&&c===h||(p<_?e.bl_tree[2*c]+=p:c!==0?(c!==d&&e.bl_tree[2*c]++,e.bl_tree[32]++):p<=10?e.bl_tree[34]++:e.bl_tree[36]++,p=0,d=c,h===0?(m=138,_=3):c===h?(m=6,_=3):(m=7,_=4))},zV=(e,t,r)=>{let i,c,d=-1,h=t[1],p=0,m=7,_=4;for(h===0&&(m=138,_=3),i=0;i<=r;i++)if(c=h,h=t[2*(i+1)+1],!(++p<m&&c===h)){if(p<_)do To(e,c,e.bl_tree);while(--p!=0);else c!==0?(c!==d&&(To(e,c,e.bl_tree),p--),To(e,16,e.bl_tree),hi(e,p-3,2)):p<=10?(To(e,17,e.bl_tree),hi(e,p-3,3)):(To(e,18,e.bl_tree),hi(e,p-11,7));p=0,d=c,h===0?(m=138,_=3):c===h?(m=6,_=3):(m=7,_=4)}},KV=!1,qV=(e,t,r,i)=>{hi(e,0+(i?1:0),3),BV(e),pm(e,r),pm(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var foe=e=>{KV||((()=>{let t,r,i,c,d,h=new Array(16);for(i=0,c=0;c<28;c++)for(tT[c]=i,t=0;t<1<<eT[c];t++)hm[i++]=c;for(hm[i-1]=c,d=0,c=0;c<16;c++)for(Lv[c]=d,t=0;t<1<<jv[c];t++)um[d++]=c;for(d>>=7;c<cm;c++)for(Lv[c]=d<<7,t=0;t<1<<jv[c]-7;t++)um[256+d++]=c;for(r=0;r<=lm;r++)h[r]=0;for(t=0;t<=143;)oc[2*t+1]=8,t++,h[8]++;for(;t<=255;)oc[2*t+1]=9,t++,h[9]++;for(;t<=279;)oc[2*t+1]=7,t++,h[7]++;for(;t<=287;)oc[2*t+1]=8,t++,h[8]++;for(UV(oc,287,h),t=0;t<cm;t++)dm[2*t+1]=5,dm[2*t]=FV(t,5);kV=new rT(oc,eT,257,DV,lm),jV=new rT(dm,jv,0,cm,lm),LV=new rT(new Array(0),poe,0,19,7)})(),KV=!0),e.l_desc=new sT(e.dyn_ltree,kV),e.d_desc=new sT(e.dyn_dtree,jV),e.bl_desc=new sT(e.bl_tree,LV),e.bi_buf=0,e.bi_valid=0,VV(e)},moe=(e,t,r,i)=>{let c,d,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(p=>{let m,_=4093624447;for(m=0;m<=31;m++,_>>>=1)if(1&_&&p.dyn_ltree[2*m]!==0)return 0;if(p.dyn_ltree[18]!==0||p.dyn_ltree[20]!==0||p.dyn_ltree[26]!==0)return 1;for(m=32;m<ZC;m++)if(p.dyn_ltree[2*m]!==0)return 1;return 0})(e)),iT(e,e.l_desc),iT(e,e.d_desc),h=(p=>{let m;for(HV(p,p.dyn_ltree,p.l_desc.max_code),HV(p,p.dyn_dtree,p.d_desc.max_code),iT(p,p.bl_desc),m=18;m>=3&&p.bl_tree[2*PV[m]+1]===0;m--);return p.opt_len+=3*(m+1)+5+5+4,m})(e),c=e.opt_len+3+7>>>3,d=e.static_len+3+7>>>3,d<=c&&(c=d)):c=d=r+5,r+4<=c&&t!==-1?qV(e,t,r,i):e.strategy===4||d===c?(hi(e,2+(i?1:0),3),GV(e,oc,dm)):(hi(e,4+(i?1:0),3),((p,m,_,E)=>{let x;for(hi(p,m-257,5),hi(p,_-1,5),hi(p,E-4,4),x=0;x<E;x++)hi(p,p.bl_tree[2*PV[x]+1],3);zV(p,p.dyn_ltree,m-1),zV(p,p.dyn_dtree,_-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),GV(e,e.dyn_ltree,e.dyn_dtree)),VV(e),i&&BV(e)},goe=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(hm[r]+ZC+1)]++,e.dyn_dtree[2*MV(t)]++),e.sym_next===e.sym_end),_oe=e=>{hi(e,2,3),To(e,256,oc),(t=>{t.bi_valid===16?(pm(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Eoe={_tr_init:foe,_tr_stored_block:qV,_tr_flush_block:moe,_tr_tally:goe,_tr_align:_oe},fm=(e,t,r,i)=>{let c=65535&e|0,d=e>>>16&65535|0,h=0;for(;r!==0;){h=r>2e3?2e3:r,r-=h;do c=c+t[i++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};let voe=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var nn=(e,t,r,i)=>{let c=voe,d=i+r;e^=-1;for(let h=i;h<d;h++)e=e>>>8^c[255&(e^t[h])];return-1^e},bd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Mv={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:yoe,_tr_stored_block:aT,_tr_flush_block:xoe,_tr_tally:el,_tr_align:boe}=Eoe,{Z_NO_FLUSH:tl,Z_PARTIAL_FLUSH:woe,Z_FULL_FLUSH:Soe,Z_FINISH:ca,Z_BLOCK:YV,Z_OK:fn,Z_STREAM_END:$V,Z_STREAM_ERROR:Ro,Z_DATA_ERROR:Coe,Z_BUF_ERROR:oT,Z_DEFAULT_COMPRESSION:Toe,Z_FILTERED:Roe,Z_HUFFMAN_ONLY:Fv,Z_RLE:Noe,Z_FIXED:Aoe,Z_DEFAULT_STRATEGY:Ioe,Z_UNKNOWN:Ooe,Z_DEFLATED:Uv}=Mv,cT=286,Doe=30,Poe=19,koe=2*cT+1,joe=15,wd=258,No=262,Ih=42,Sd=113,mm=666,Cd=(e,t)=>(e.msg=bd[t],t),XV=e=>2*e-(e>4?9:0),rl=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Loe=e=>{let t,r,i,c=e.w_size;t=e.hash_size,i=t;do r=e.head[--i],e.head[i]=r>=c?r-c:0;while(--t);t=c,i=t;do r=e.prev[--i],e.prev[i]=r>=c?r-c:0;while(--t)},sl=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,Ni=e=>{let t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Ai=(e,t)=>{xoe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ni(e.strm)},Dr=(e,t)=>{e.pending_buf[e.pending++]=t},gm=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},lT=(e,t,r,i)=>{let c=e.avail_in;return c>i&&(c=i),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),r),e.state.wrap===1?e.adler=fm(e.adler,t,c,r):e.state.wrap===2&&(e.adler=nn(e.adler,t,c,r)),e.next_in+=c,e.total_in+=c,c)},JV=(e,t)=>{let r,i,c=e.max_chain_length,d=e.strstart,h=e.prev_length,p=e.nice_match,m=e.strstart>e.w_size-No?e.strstart-(e.w_size-No):0,_=e.window,E=e.w_mask,x=e.prev,b=e.strstart+wd,C=_[d+h-1],U=_[d+h];e.prev_length>=e.good_match&&(c>>=2),p>e.lookahead&&(p=e.lookahead);do if(r=t,_[r+h]===U&&_[r+h-1]===C&&_[r]===_[d]&&_[++r]===_[d+1]){d+=2,r++;do;while(_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&d<b);if(i=wd-(b-d),d=b-wd,i>h){if(e.match_start=t,h=i,i>=p)break;C=_[d+h-1],U=_[d+h]}}while((t=x[t&E])>m&&--c!=0);return h<=e.lookahead?h:e.lookahead},Oh=e=>{let t=e.w_size,r,i,c;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-No)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Loe(e),i+=t),e.strm.avail_in===0)break;if(r=lT(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=sl(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=sl(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<No&&e.strm.avail_in!==0)},QV=(e,t)=>{let r,i,c,d=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,p=e.strm.avail_in;do{if(r=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,i=e.strstart-e.block_start,r>i+e.strm.avail_in&&(r=i+e.strm.avail_in),r>c&&(r=c),r<d&&(r===0&&t!==ca||t===tl||r!==i+e.strm.avail_in)))break;h=t===ca&&r===i+e.strm.avail_in?1:0,aT(e,0,0,h),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Ni(e.strm),i&&(i>r&&(i=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,r-=i),r&&(lT(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(h===0);return p-=e.strm.avail_in,p&&(p>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=p&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-p,e.strm.next_in),e.strstart),e.strstart+=p,e.insert+=p>e.w_size-e.insert?e.w_size-e.insert:p),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:t!==tl&&t!==ca&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(lT(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,d=c>e.w_size?e.w_size:c,i=e.strstart-e.block_start,(i>=d||(i||t===ca)&&t!==tl&&e.strm.avail_in===0&&i<=c)&&(r=i>c?c:i,h=t===ca&&e.strm.avail_in===0&&r===i?1:0,aT(e,e.block_start,r,h),e.block_start+=r,Ni(e.strm)),h?3:1)},dT=(e,t)=>{let r,i;for(;;){if(e.lookahead<No){if(Oh(e),e.lookahead<No&&t===tl)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=sl(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-No&&(e.match_length=JV(e,r)),e.match_length>=3)if(i=el(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=sl(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=sl(e,e.ins_h,e.window[e.strstart+1]);else i=el(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Ai(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ca?(Ai(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ai(e,!1),e.strm.avail_out===0)?1:2},Dh=(e,t)=>{let r,i,c;for(;;){if(e.lookahead<No){if(Oh(e),e.lookahead<No&&t===tl)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=sl(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-No&&(e.match_length=JV(e,r),e.match_length<=5&&(e.strategy===Roe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,i=el(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=sl(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Ai(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=el(e,0,e.window[e.strstart-1]),i&&Ai(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=el(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ca?(Ai(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ai(e,!1),e.strm.avail_out===0)?1:2};function Ao(e,t,r,i,c){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=c}let _m=[new Ao(0,0,0,0,QV),new Ao(4,4,8,4,dT),new Ao(4,5,16,8,dT),new Ao(4,6,32,32,dT),new Ao(4,4,16,16,Dh),new Ao(8,16,32,32,Dh),new Ao(8,16,128,128,Dh),new Ao(8,32,128,256,Dh),new Ao(32,128,258,1024,Dh),new Ao(32,258,258,4096,Dh)];function Moe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Uv,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*koe),this.dyn_dtree=new Uint16Array(2*(2*Doe+1)),this.bl_tree=new Uint16Array(2*(2*Poe+1)),rl(this.dyn_ltree),rl(this.dyn_dtree),rl(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(joe+1),this.heap=new Uint16Array(2*cT+1),rl(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*cT+1),rl(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let Em=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Ih&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Sd&&t.status!==mm?1:0},ZV=e=>{if(Em(e))return Cd(e,Ro);e.total_in=e.total_out=0,e.data_type=Ooe;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Ih:Sd,e.adler=t.wrap===2?0:1,t.last_flush=-2,yoe(t),fn},e3=e=>{let t=ZV(e);return t===fn&&(r=>{r.window_size=2*r.w_size,rl(r.head),r.max_lazy_match=_m[r.level].max_lazy,r.good_match=_m[r.level].good_length,r.nice_match=_m[r.level].nice_length,r.max_chain_length=_m[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},t3=(e,t,r,i,c,d)=>{if(!e)return Ro;let h=1;if(t===Toe&&(t=6),i<0?(h=0,i=-i):i>15&&(h=2,i-=16),c<1||c>9||r!==Uv||i<8||i>15||t<0||t>9||d<0||d>Aoe||i===8&&h!==1)return Cd(e,Ro);i===8&&(i=9);let p=new Moe;return e.state=p,p.strm=e,p.status=Ih,p.wrap=h,p.gzhead=null,p.w_bits=i,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=c+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<c+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=t,p.strategy=d,p.method=r,e3(e)};var Foe=(e,t)=>{if(Em(e)||t>YV||t<0)return e?Cd(e,Ro):Ro;let r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===mm&&t!==ca)return Cd(e,e.avail_out===0?oT:Ro);let i=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Ni(e),e.avail_out===0)return r.last_flush=-1,fn}else if(e.avail_in===0&&XV(t)<=XV(i)&&t!==ca)return Cd(e,oT);if(r.status===mm&&e.avail_in!==0)return Cd(e,oT);if(r.status===Ih&&r.wrap===0&&(r.status=Sd),r.status===Ih){let c=Uv+(r.w_bits-8<<4)<<8,d=-1;if(d=r.strategy>=Fv||r.level<2?0:r.level<6?1:r.level===6?2:3,c|=d<<6,r.strstart!==0&&(c|=32),c+=31-c%31,gm(r,c),r.strstart!==0&&(gm(r,e.adler>>>16),gm(r,65535&e.adler)),e.adler=1,r.status=Sd,Ni(e),r.pending!==0)return r.last_flush=-1,fn}if(r.status===57){if(e.adler=0,Dr(r,31),Dr(r,139),Dr(r,8),r.gzhead)Dr(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Dr(r,255&r.gzhead.time),Dr(r,r.gzhead.time>>8&255),Dr(r,r.gzhead.time>>16&255),Dr(r,r.gzhead.time>>24&255),Dr(r,r.level===9?2:r.strategy>=Fv||r.level<2?4:0),Dr(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Dr(r,255&r.gzhead.extra.length),Dr(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=nn(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Dr(r,0),Dr(r,0),Dr(r,0),Dr(r,0),Dr(r,0),Dr(r,r.level===9?2:r.strategy>=Fv||r.level<2?4:0),Dr(r,3),r.status=Sd,Ni(e),r.pending!==0)return r.last_flush=-1,fn}if(r.status===69){if(r.gzhead.extra){let c=r.pending,d=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+d>r.pending_buf_size;){let p=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+p),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>c&&(e.adler=nn(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex+=p,Ni(e),r.pending!==0)return r.last_flush=-1,fn;c=0,d-=p}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+d),r.pending),r.pending+=d,r.gzhead.hcrc&&r.pending>c&&(e.adler=nn(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let c,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(e.adler=nn(e.adler,r.pending_buf,r.pending-d,d)),Ni(e),r.pending!==0)return r.last_flush=-1,fn;d=0}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Dr(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>d&&(e.adler=nn(e.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let c,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(e.adler=nn(e.adler,r.pending_buf,r.pending-d,d)),Ni(e),r.pending!==0)return r.last_flush=-1,fn;d=0}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Dr(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>d&&(e.adler=nn(e.adler,r.pending_buf,r.pending-d,d))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Ni(e),r.pending!==0))return r.last_flush=-1,fn;Dr(r,255&e.adler),Dr(r,e.adler>>8&255),e.adler=0}if(r.status=Sd,Ni(e),r.pending!==0)return r.last_flush=-1,fn}if(e.avail_in!==0||r.lookahead!==0||t!==tl&&r.status!==mm){let c=r.level===0?QV(r,t):r.strategy===Fv?((d,h)=>{let p;for(;;){if(d.lookahead===0&&(Oh(d),d.lookahead===0)){if(h===tl)return 1;break}if(d.match_length=0,p=el(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(Ai(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===ca?(Ai(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Ai(d,!1),d.strm.avail_out===0)?1:2})(r,t):r.strategy===Noe?((d,h)=>{let p,m,_,E,x=d.window;for(;;){if(d.lookahead<=wd){if(Oh(d),d.lookahead<=wd&&h===tl)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(_=d.strstart-1,m=x[_],m===x[++_]&&m===x[++_]&&m===x[++_])){E=d.strstart+wd;do;while(m===x[++_]&&m===x[++_]&&m===x[++_]&&m===x[++_]&&m===x[++_]&&m===x[++_]&&m===x[++_]&&m===x[++_]&&_<E);d.match_length=wd-(E-_),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=el(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=el(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(Ai(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===ca?(Ai(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Ai(d,!1),d.strm.avail_out===0)?1:2})(r,t):_m[r.level].func(r,t);if(c!==3&&c!==4||(r.status=mm),c===1||c===3)return e.avail_out===0&&(r.last_flush=-1),fn;if(c===2&&(t===woe?boe(r):t!==YV&&(aT(r,0,0,!1),t===Soe&&(rl(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Ni(e),e.avail_out===0))return r.last_flush=-1,fn}return t!==ca?fn:r.wrap<=0?$V:(r.wrap===2?(Dr(r,255&e.adler),Dr(r,e.adler>>8&255),Dr(r,e.adler>>16&255),Dr(r,e.adler>>24&255),Dr(r,255&e.total_in),Dr(r,e.total_in>>8&255),Dr(r,e.total_in>>16&255),Dr(r,e.total_in>>24&255)):(gm(r,e.adler>>>16),gm(r,65535&e.adler)),Ni(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?fn:$V)},Uoe=(e,t)=>{let r=t.length;if(Em(e))return Ro;let i=e.state,c=i.wrap;if(c===2||c===1&&i.status!==Ih||i.lookahead)return Ro;if(c===1&&(e.adler=fm(e.adler,t,r,0)),i.wrap=0,r>=i.w_size){c===0&&(rl(i.head),i.strstart=0,i.block_start=0,i.insert=0);let m=new Uint8Array(i.w_size);m.set(t.subarray(r-i.w_size,r),0),t=m,r=i.w_size}let d=e.avail_in,h=e.next_in,p=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Oh(i);i.lookahead>=3;){let m=i.strstart,_=i.lookahead-2;do i.ins_h=sl(i,i.ins_h,i.window[m+3-1]),i.prev[m&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=m,m++;while(--_);i.strstart=m,i.lookahead=2,Oh(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=h,e.input=p,e.avail_in=d,i.wrap=c,fn},vm={deflateInit:(e,t)=>t3(e,t,Uv,15,8,Ioe),deflateInit2:t3,deflateReset:e3,deflateResetKeep:ZV,deflateSetHeader:(e,t)=>Em(e)||e.state.wrap!==2?Ro:(e.state.gzhead=t,fn),deflate:Foe,deflateEnd:e=>{if(Em(e))return Ro;let t=e.state.status;return e.state=null,t===Sd?Cd(e,Coe):fn},deflateSetDictionary:Uoe,deflateInfo:"pako deflate (from Nodeca project)"};let Voe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Vv={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let i in r)Voe(r,i)&&(e[i]=r[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,c=e.length;i<c;i++)t+=e[i].length;let r=new Uint8Array(t);for(let i=0,c=0,d=e.length;i<d;i++){let h=e[i];r.set(h,c),c+=h.length}return r}};let r3=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r3=!1}let ym=new Uint8Array(256);for(let e=0;e<256;e++)ym[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ym[254]=ym[254]=1;var xm={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,i,c,d,h=e.length,p=0;for(c=0;c<h;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<h&&(i=e.charCodeAt(c+1),(64512&i)==56320&&(r=65536+(r-55296<<10)+(i-56320),c++)),p+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(p),d=0,c=0;d<p;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<h&&(i=e.charCodeAt(c+1),(64512&i)==56320&&(r=65536+(r-55296<<10)+(i-56320),c++)),r<128?t[d++]=r:r<2048?(t[d++]=192|r>>>6,t[d++]=128|63&r):r<65536?(t[d++]=224|r>>>12,t[d++]=128|r>>>6&63,t[d++]=128|63&r):(t[d++]=240|r>>>18,t[d++]=128|r>>>12&63,t[d++]=128|r>>>6&63,t[d++]=128|63&r);return t},buf2string:(e,t)=>{let r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,c,d=new Array(2*r);for(c=0,i=0;i<r;){let h=e[i++];if(h<128){d[c++]=h;continue}let p=ym[h];if(p>4)d[c++]=65533,i+=p-1;else{for(h&=p===2?31:p===3?15:7;p>1&&i<r;)h=h<<6|63&e[i++],p--;p>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&r3)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let _=0;_<p;_++)m+=String.fromCharCode(h[_]);return m})(d,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+ym[e[r]]>t?r:t}},s3=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let n3=Object.prototype.toString,{Z_NO_FLUSH:Boe,Z_SYNC_FLUSH:Woe,Z_FULL_FLUSH:Goe,Z_FINISH:Hoe,Z_OK:Bv,Z_STREAM_END:zoe,Z_DEFAULT_COMPRESSION:Koe,Z_DEFAULT_STRATEGY:qoe,Z_DEFLATED:Yoe}=Mv;function Wv(e){this.options=Vv.assign({level:Koe,method:Yoe,chunkSize:16384,windowBits:15,memLevel:8,strategy:qoe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s3,this.strm.avail_out=0;let r=vm.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Bv)throw new Error(bd[r]);if(t.header&&vm.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?xm.string2buf(t.dictionary):n3.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=vm.deflateSetDictionary(this.strm,i),r!==Bv)throw new Error(bd[r]);this._dict_set=!0}}function $oe(e,t){let r=new Wv(t);if(r.push(e,!0),r.err)throw r.msg||bd[r.err];return r.result}Wv.prototype.push=function(e,t){let r=this.strm,i=this.options.chunkSize,c,d;if(this.ended)return!1;for(d=t===~~t?t:t===!0?Hoe:Boe,typeof e=="string"?r.input=xm.string2buf(e):n3.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(d===Woe||d===Goe)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(c=vm.deflate(r,d),c===zoe)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),c=vm.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===Bv;if(r.avail_out!==0){if(d>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},Wv.prototype.onData=function(e){this.chunks.push(e)},Wv.prototype.onEnd=function(e){e===Bv&&(this.result=Vv.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Xoe={deflate:$oe};let Gv=16209;var Joe=function(e,t){let r,i,c,d,h,p,m,_,E,x,b,C,U,k,M,H,K,X,se,te,Z,ce,fe,xe,Te=e.state;r=e.next_in,fe=e.input,i=r+(e.avail_in-5),c=e.next_out,xe=e.output,d=c-(t-e.avail_out),h=c+(e.avail_out-257),p=Te.dmax,m=Te.wsize,_=Te.whave,E=Te.wnext,x=Te.window,b=Te.hold,C=Te.bits,U=Te.lencode,k=Te.distcode,M=(1<<Te.lenbits)-1,H=(1<<Te.distbits)-1;e:do{C<15&&(b+=fe[r++]<<C,C+=8,b+=fe[r++]<<C,C+=8),K=U[b&M];t:for(;;){if(X=K>>>24,b>>>=X,C-=X,X=K>>>16&255,X===0)xe[c++]=65535&K;else{if(!(16&X)){if(!(64&X)){K=U[(65535&K)+(b&(1<<X)-1)];continue t}if(32&X){Te.mode=16191;break e}e.msg="invalid literal/length code",Te.mode=Gv;break e}se=65535&K,X&=15,X&&(C<X&&(b+=fe[r++]<<C,C+=8),se+=b&(1<<X)-1,b>>>=X,C-=X),C<15&&(b+=fe[r++]<<C,C+=8,b+=fe[r++]<<C,C+=8),K=k[b&H];r:for(;;){if(X=K>>>24,b>>>=X,C-=X,X=K>>>16&255,!(16&X)){if(!(64&X)){K=k[(65535&K)+(b&(1<<X)-1)];continue r}e.msg="invalid distance code",Te.mode=Gv;break e}if(te=65535&K,X&=15,C<X&&(b+=fe[r++]<<C,C+=8,C<X&&(b+=fe[r++]<<C,C+=8)),te+=b&(1<<X)-1,te>p){e.msg="invalid distance too far back",Te.mode=Gv;break e}if(b>>>=X,C-=X,X=c-d,te>X){if(X=te-X,X>_&&Te.sane){e.msg="invalid distance too far back",Te.mode=Gv;break e}if(Z=0,ce=x,E===0){if(Z+=m-X,X<se){se-=X;do xe[c++]=x[Z++];while(--X);Z=c-te,ce=xe}}else if(E<X){if(Z+=m+E-X,X-=E,X<se){se-=X;do xe[c++]=x[Z++];while(--X);if(Z=0,E<se){X=E,se-=X;do xe[c++]=x[Z++];while(--X);Z=c-te,ce=xe}}}else if(Z+=E-X,X<se){se-=X;do xe[c++]=x[Z++];while(--X);Z=c-te,ce=xe}for(;se>2;)xe[c++]=ce[Z++],xe[c++]=ce[Z++],xe[c++]=ce[Z++],se-=3;se&&(xe[c++]=ce[Z++],se>1&&(xe[c++]=ce[Z++]))}else{Z=c-te;do xe[c++]=xe[Z++],xe[c++]=xe[Z++],xe[c++]=xe[Z++],se-=3;while(se>2);se&&(xe[c++]=xe[Z++],se>1&&(xe[c++]=xe[Z++]))}break}}break}}while(r<i&&c<h);se=C>>3,r-=se,C-=se<<3,b&=(1<<C)-1,e.next_in=r,e.next_out=c,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=c<h?h-c+257:257-(c-h),Te.hold=b,Te.bits=C};let Hv=15,Qoe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Zoe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ece=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),tce=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var bm=(e,t,r,i,c,d,h,p)=>{let m=p.bits,_,E,x,b,C,U,k=0,M=0,H=0,K=0,X=0,se=0,te=0,Z=0,ce=0,fe=0,xe=null,Te=new Uint16Array(16),_t=new Uint16Array(16),vt,at,Vt,Mt=null;for(k=0;k<=Hv;k++)Te[k]=0;for(M=0;M<i;M++)Te[t[r+M]]++;for(X=m,K=Hv;K>=1&&Te[K]===0;K--);if(X>K&&(X=K),K===0)return c[d++]=20971520,c[d++]=20971520,p.bits=1,0;for(H=1;H<K&&Te[H]===0;H++);for(X<H&&(X=H),Z=1,k=1;k<=Hv;k++)if(Z<<=1,Z-=Te[k],Z<0)return-1;if(Z>0&&(e===0||K!==1))return-1;for(_t[1]=0,k=1;k<Hv;k++)_t[k+1]=_t[k]+Te[k];for(M=0;M<i;M++)t[r+M]!==0&&(h[_t[t[r+M]]++]=M);if(e===0?(xe=Mt=h,U=20):e===1?(xe=Qoe,Mt=Zoe,U=257):(xe=ece,Mt=tce,U=0),fe=0,M=0,k=H,C=d,se=X,te=0,x=-1,ce=1<<X,b=ce-1,e===1&&ce>852||e===2&&ce>592)return 1;for(;;){vt=k-te,h[M]+1<U?(at=0,Vt=h[M]):h[M]>=U?(at=Mt[h[M]-U],Vt=xe[h[M]-U]):(at=96,Vt=0),_=1<<k-te,E=1<<se,H=E;do E-=_,c[C+(fe>>te)+E]=vt<<24|at<<16|Vt|0;while(E!==0);for(_=1<<k-1;fe&_;)_>>=1;if(_!==0?(fe&=_-1,fe+=_):fe=0,M++,--Te[k]==0){if(k===K)break;k=t[r+h[M]]}if(k>X&&(fe&b)!==x){for(te===0&&(te=X),C+=H,se=k-te,Z=1<<se;se+te<K&&(Z-=Te[se+te],!(Z<=0));)se++,Z<<=1;if(ce+=1<<se,e===1&&ce>852||e===2&&ce>592)return 1;x=fe&b,c[x]=X<<24|se<<16|C-d|0}}return fe!==0&&(c[C+fe]=k-te<<24|64<<16|0),p.bits=X,0};let{Z_FINISH:i3,Z_BLOCK:rce,Z_TREES:zv,Z_OK:Td,Z_STREAM_END:sce,Z_NEED_DICT:nce,Z_STREAM_ERROR:la,Z_DATA_ERROR:a3,Z_MEM_ERROR:o3,Z_BUF_ERROR:ice,Z_DEFLATED:c3}=Mv,Kv=16180,qv=16190,cc=16191,uT=16192,hT=16194,Yv=16199,$v=16200,pT=16206,os=16209,l3=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function ace(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Rd=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<Kv||t.mode>16211?1:0},d3=e=>{if(Rd(e))return la;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Kv,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Td},u3=e=>{if(Rd(e))return la;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,d3(e)},h3=(e,t)=>{let r;if(Rd(e))return la;let i=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?la:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,u3(e))},p3=(e,t)=>{if(!e)return la;let r=new ace;e.state=r,r.strm=e,r.window=null,r.mode=Kv;let i=h3(e,t);return i!==Td&&(e.state=null),i},fT,mT,f3=!0,oce=e=>{if(f3){fT=new Int32Array(512),mT=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(bm(1,e.lens,0,288,fT,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;bm(2,e.lens,0,32,mT,0,e.work,{bits:5}),f3=!1}e.lencode=fT,e.lenbits=9,e.distcode=mT,e.distbits=5},m3=(e,t,r,i)=>{let c,d=e.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),i>=d.wsize?(d.window.set(t.subarray(r-d.wsize,r),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>i&&(c=i),d.window.set(t.subarray(r-i,r-i+c),d.wnext),(i-=c)?(d.window.set(t.subarray(r-i,r),0),d.wnext=i,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var cce=(e,t)=>{let r,i,c,d,h,p,m,_,E,x,b,C,U,k,M,H,K,X,se,te,Z,ce,fe=0,xe=new Uint8Array(4),Te,_t,vt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Rd(e)||!e.output||!e.input&&e.avail_in!==0)return la;r=e.state,r.mode===cc&&(r.mode=uT),h=e.next_out,c=e.output,m=e.avail_out,d=e.next_in,i=e.input,p=e.avail_in,_=r.hold,E=r.bits,x=p,b=m,ce=Td;e:for(;;)switch(r.mode){case Kv:if(r.wrap===0){r.mode=uT;break}for(;E<16;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(2&r.wrap&&_===35615){r.wbits===0&&(r.wbits=15),r.check=0,xe[0]=255&_,xe[1]=_>>>8&255,r.check=nn(r.check,xe,2,0),_=0,E=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",r.mode=os;break}if((15&_)!==c3){e.msg="unknown compression method",r.mode=os;break}if(_>>>=4,E-=4,Z=8+(15&_),r.wbits===0&&(r.wbits=Z),Z>15||Z>r.wbits){e.msg="invalid window size",r.mode=os;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&_?16189:cc,_=0,E=0;break;case 16181:for(;E<16;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(r.flags=_,(255&$s(r))!==c3){e.msg="unknown compression method",r.mode=os;break}if(57344&$s(r)){e.msg="unknown header flags set",r.mode=os;break}r.head&&(r.head.text=_>>8&1),512&$s(r)&&4&r.wrap&&(xe[0]=255&_,xe[1]=_>>>8&255,r.check=nn(r.check,xe,2,0)),_=0,E=0,r.mode=16182;case 16182:for(;E<32;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}r.head&&(r.head.time=_),512&$s(r)&&4&r.wrap&&(xe[0]=255&_,xe[1]=_>>>8&255,xe[2]=_>>>16&255,xe[3]=_>>>24&255,r.check=nn(r.check,xe,4,0)),_=0,E=0,r.mode=16183;case 16183:for(;E<16;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}r.head&&(r.head.xflags=255&_,r.head.os=_>>8),512&$s(r)&&4&r.wrap&&(xe[0]=255&_,xe[1]=_>>>8&255,r.check=nn(r.check,xe,2,0)),_=0,E=0,r.mode=16184;case 16184:if(1024&$s(r)){for(;E<16;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}r.length=_,r.head&&(r.head.extra_len=_),512&$s(r)&&4&r.wrap&&(xe[0]=255&_,xe[1]=_>>>8&255,r.check=nn(r.check,xe,2,0)),_=0,E=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&$s(r)&&(C=r.length,C>p&&(C=p),C&&(r.head&&(Z=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(i.subarray(d,d+C),Z)),512&$s(r)&&4&r.wrap&&(r.check=nn(r.check,i,C,d)),p-=C,d+=C,r.length-=C),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&$s(r)){if(p===0)break e;C=0;do Z=i[d+C++],r.head&&Z&&r.length<65536&&(r.head.name+=String.fromCharCode(Z));while(Z&&C<p);if(512&$s(r)&&4&r.wrap&&(r.check=nn(r.check,i,C,d)),p-=C,d+=C,Z)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&$s(r)){if(p===0)break e;C=0;do Z=i[d+C++],r.head&&Z&&r.length<65536&&(r.head.comment+=String.fromCharCode(Z));while(Z&&C<p);if(512&$s(r)&&4&r.wrap&&(r.check=nn(r.check,i,C,d)),p-=C,d+=C,Z)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&$s(r)){for(;E<16;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(4&r.wrap&&_!==(65535&r.check)){e.msg="header crc mismatch",r.mode=os;break}_=0,E=0}r.head&&(r.head.hcrc=$s(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=cc;break;case 16189:for(;E<32;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}e.adler=r.check=l3(_),_=0,E=0,r.mode=qv;case qv:if(r.havedict===0)return e.next_out=h,e.avail_out=m,e.next_in=d,e.avail_in=p,r.hold=_,r.bits=E,nce;e.adler=r.check=1,r.mode=cc;case cc:if(t===rce||t===zv)break e;case uT:if(r.last){_>>>=7&E,E-=7&E,r.mode=pT;break}for(;E<3;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}switch(r.last=1&_,_>>>=1,E-=1,3&_){case 0:r.mode=16193;break;case 1:if(oce(r),r.mode=Yv,t===zv){_>>>=2,E-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=os}_>>>=2,E-=2;break;case 16193:for(_>>>=7&E,E-=7&E;E<32;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",r.mode=os;break}if(r.length=65535&_,_=0,E=0,r.mode=hT,t===zv)break e;case hT:r.mode=16195;case 16195:if(C=r.length,C){if(C>p&&(C=p),C>m&&(C=m),C===0)break e;c.set(i.subarray(d,d+C),h),p-=C,d+=C,m-=C,h+=C,r.length-=C;break}r.mode=cc;break;case 16196:for(;E<14;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(r.nlen=257+(31&_),_>>>=5,E-=5,r.ndist=1+(31&_),_>>>=5,E-=5,r.ncode=4+(15&_),_>>>=4,E-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=os;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;E<3;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}r.lens[vt[r.have++]]=7&_,_>>>=3,E-=3}for(;r.have<19;)r.lens[vt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Te={bits:r.lenbits},ce=bm(0,r.lens,0,19,r.lencode,0,r.work,Te),r.lenbits=Te.bits,ce){e.msg="invalid code lengths set",r.mode=os;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;fe=r.lencode[_&(1<<r.lenbits)-1],M=fe>>>24,H=fe>>>16&255,K=65535&fe,!(M<=E);){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(K<16)_>>>=M,E-=M,r.lens[r.have++]=K;else{if(K===16){for(_t=M+2;E<_t;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(_>>>=M,E-=M,r.have===0){e.msg="invalid bit length repeat",r.mode=os;break}Z=r.lens[r.have-1],C=3+(3&_),_>>>=2,E-=2}else if(K===17){for(_t=M+3;E<_t;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}_>>>=M,E-=M,Z=0,C=3+(7&_),_>>>=3,E-=3}else{for(_t=M+7;E<_t;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}_>>>=M,E-=M,Z=0,C=11+(127&_),_>>>=7,E-=7}if(r.have+C>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=os;break}for(;C--;)r.lens[r.have++]=Z}}if(r.mode===os)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=os;break}if(r.lenbits=9,Te={bits:r.lenbits},ce=bm(1,r.lens,0,r.nlen,r.lencode,0,r.work,Te),r.lenbits=Te.bits,ce){e.msg="invalid literal/lengths set",r.mode=os;break}if(r.distbits=6,r.distcode=r.distdyn,Te={bits:r.distbits},ce=bm(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Te),r.distbits=Te.bits,ce){e.msg="invalid distances set",r.mode=os;break}if(r.mode=Yv,t===zv)break e;case Yv:r.mode=$v;case $v:if(p>=6&&m>=258){e.next_out=h,e.avail_out=m,e.next_in=d,e.avail_in=p,r.hold=_,r.bits=E,Joe(e,b),h=e.next_out,c=e.output,m=e.avail_out,d=e.next_in,i=e.input,p=e.avail_in,_=r.hold,E=r.bits,r.mode===cc&&(r.back=-1);break}for(r.back=0;fe=r.lencode[_&(1<<r.lenbits)-1],M=fe>>>24,H=fe>>>16&255,K=65535&fe,!(M<=E);){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(H&&!(240&H)){for(X=M,se=H,te=K;fe=r.lencode[te+((_&(1<<X+se)-1)>>X)],M=fe>>>24,H=fe>>>16&255,K=65535&fe,!(X+M<=E);){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}_>>>=X,E-=X,r.back+=X}if(_>>>=M,E-=M,r.back+=M,r.length=K,H===0){r.mode=16205;break}if(32&H){r.back=-1,r.mode=cc;break}if(64&H){e.msg="invalid literal/length code",r.mode=os;break}r.extra=15&H,r.mode=16201;case 16201:if(r.extra){for(_t=r.extra;E<_t;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}r.length+=_&(1<<r.extra)-1,_>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;fe=r.distcode[_&(1<<r.distbits)-1],M=fe>>>24,H=fe>>>16&255,K=65535&fe,!(M<=E);){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(!(240&H)){for(X=M,se=H,te=K;fe=r.distcode[te+((_&(1<<X+se)-1)>>X)],M=fe>>>24,H=fe>>>16&255,K=65535&fe,!(X+M<=E);){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}_>>>=X,E-=X,r.back+=X}if(_>>>=M,E-=M,r.back+=M,64&H){e.msg="invalid distance code",r.mode=os;break}r.offset=K,r.extra=15&H,r.mode=16203;case 16203:if(r.extra){for(_t=r.extra;E<_t;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}r.offset+=_&(1<<r.extra)-1,_>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=os;break}r.mode=16204;case 16204:if(m===0)break e;if(C=b-m,r.offset>C){if(C=r.offset-C,C>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=os;break}C>r.wnext?(C-=r.wnext,U=r.wsize-C):U=r.wnext-C,C>r.length&&(C=r.length),k=r.window}else k=c,U=h-r.offset,C=r.length;C>m&&(C=m),m-=C,r.length-=C;do c[h++]=k[U++];while(--C);r.length===0&&(r.mode=$v);break;case 16205:if(m===0)break e;c[h++]=r.length,m--,r.mode=$v;break;case pT:if(r.wrap){for(;E<32;){if(p===0)break e;p--,_|=i[d++]<<E,E+=8}if(b-=m,e.total_out+=b,r.total+=b,4&r.wrap&&b&&(e.adler=r.check=$s(r)?nn(r.check,c,b,h-b):fm(r.check,c,b,h-b)),b=m,4&r.wrap&&($s(r)?_:l3(_))!==r.check){e.msg="incorrect data check",r.mode=os;break}_=0,E=0}r.mode=16207;case 16207:if(r.wrap&&$s(r)){for(;E<32;){if(p===0)break e;p--,_+=i[d++]<<E,E+=8}if(4&r.wrap&&_!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=os;break}_=0,E=0}r.mode=16208;case 16208:ce=sce;break e;case os:ce=a3;break e;case 16210:return o3;default:return la}return e.next_out=h,e.avail_out=m,e.next_in=d,e.avail_in=p,r.hold=_,r.bits=E,(r.wsize||b!==e.avail_out&&r.mode<os&&(r.mode<pT||t!==i3))&&m3(e,e.output,e.next_out,b-e.avail_out),x-=e.avail_in,b-=e.avail_out,e.total_in+=x,e.total_out+=b,r.total+=b,4&r.wrap&&b&&(e.adler=r.check=$s(r)?nn(r.check,c,b,e.next_out-b):fm(r.check,c,b,e.next_out-b)),e.data_type=r.bits+(r.last?64:0)+(r.mode===cc?128:0)+(r.mode===Yv||r.mode===hT?256:0),(x===0&&b===0||t===i3)&&ce===Td&&(ce=ice),ce},lc={inflateReset:u3,inflateReset2:h3,inflateResetKeep:d3,inflateInit:e=>p3(e,15),inflateInit2:p3,inflate:cce,inflateEnd:e=>{if(Rd(e))return la;let t=e.state;return t.window&&(t.window=null),e.state=null,Td},inflateGetHeader:(e,t)=>{if(Rd(e))return la;let r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,Td):la},inflateSetDictionary:(e,t)=>{let r=t.length,i,c,d;return Rd(e)?la:(i=e.state,i.wrap!==0&&i.mode!==qv?la:i.mode===qv&&(c=1,c=fm(c,t,r,0),c!==i.check)?a3:(d=m3(e,t,r,r),d?(i.mode=16210,o3):(i.havedict=1,Td)))},inflateInfo:"pako inflate (from Nodeca project)"},lce=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let g3=Object.prototype.toString,{Z_NO_FLUSH:dce,Z_FINISH:uce,Z_OK:wm,Z_STREAM_END:gT,Z_NEED_DICT:_T,Z_STREAM_ERROR:hce,Z_DATA_ERROR:_3,Z_MEM_ERROR:pce}=Mv;function Xv(e){this.options=Vv.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s3,this.strm.avail_out=0;let r=lc.inflateInit2(this.strm,t.windowBits);if(r!==wm)throw new Error(bd[r]);if(this.header=new lce,lc.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=xm.string2buf(t.dictionary):g3.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=lc.inflateSetDictionary(this.strm,t.dictionary),r!==wm)))throw new Error(bd[r])}function fce(e,t){let r=new Xv(t);if(r.push(e),r.err)throw r.msg||bd[r.err];return r.result}Xv.prototype.push=function(e,t){let r=this.strm,i=this.options.chunkSize,c=this.options.dictionary,d,h,p;if(this.ended)return!1;for(h=t===~~t?t:t===!0?uce:dce,g3.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),d=lc.inflate(r,h),d===_T&&c&&(d=lc.inflateSetDictionary(r,c),d===wm?d=lc.inflate(r,h):d===_3&&(d=_T));r.avail_in>0&&d===gT&&r.state.wrap>0&&e[r.next_in]!==0;)lc.inflateReset(r),d=lc.inflate(r,h);switch(d){case hce:case _3:case _T:case pce:return this.onEnd(d),this.ended=!0,!1}if(p=r.avail_out,r.next_out&&(r.avail_out===0||d===gT))if(this.options.to==="string"){let m=xm.utf8border(r.output,r.next_out),_=r.next_out-m,E=xm.buf2string(r.output,m);r.next_out=_,r.avail_out=i-_,_&&r.output.set(r.output.subarray(m,m+_),0),this.onData(E)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(d!==wm||p!==0){if(d===gT)return d=lc.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},Xv.prototype.onData=function(e){this.chunks.push(e)},Xv.prototype.onEnd=function(e){e===wm&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Vv.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var mce={inflate:fce};let{deflate:gce}=Xoe,{inflate:_ce}=mce;var Ece=gce,vce=_ce,E3=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(E3||{});class yce{constructor(){W(this,"_sequence",0),W(this,"_startTime",Date.now()),W(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let p=new Uint8Array(4);p.set([1,0,0,0]);let m={id:0,length:4,data:p.buffer},_={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};r.commonPacketHeader.extension=1,r.extension=_,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;Y("SHOW_DATASTREAM2_LOG")&&N.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));let i=new ArrayBuffer(r.commonPacketHeader.length),c=new Uint8Array(i),d=new DataView(i),h=0;if(d.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,d.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){let p=this.serializeExtension(r.extension);c.set(new Uint8Array(p),h),h+=p.byteLength}if(c.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let r=new DataView(t),i=0,c=r.getUint16(i,!0);i+=2;let d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:r.getUint16(i+2,!0)<<16|r.getUint16(i,!0)},h,p;if(i+=4,Y("SHOW_DATASTREAM2_LOG")&&N.debug("receive data header: ".concat(JSON.stringify(d))),r.getUint16(i,!0),i+=2,d.extension){p=this.deserializeExtension(t.slice(i)),i+=2+p.length,h=t.slice(i);let m=!1;if(p.datas.length>0){let _=p.datas.find(E=>E.id===0);_&&(m=(1&new DataView(_.data).getUint32(0,!0))==1)}h=m?this.decompress(h):h}else h=t.slice(8);return h}serializeExtension(t){let{profile:r,length:i,datas:c}=t,d=new ArrayBuffer(i+2),h=new Uint8Array(d),p=new DataView(d),m=0;if(p.setUint8(m++,r),p.setUint8(m++,i),c.forEach(_=>{r?(p.setUint8(m++,_.id),p.setUint8(m++,_.length),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength):(p.setUint8(m++,_.id|_.length<<4),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength)}),m!==i+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(i+2));return d}deserializeExtension(t){let r=new DataView(t),i=0,c=r.getUint8(i);i++;let d=r.getUint8(i);i++;let h=c===E3.TWO_BYTE,p=[],m=new DataView(t,2),_=0;for(;_<d;){let E=0,x=0,b=new ArrayBuffer(0);h?(E=m.getUint8(_),_++,x=m.getUint8(_),_++):(E=15&m.getUint8(_),x=m.getUint8(_)>>4,_++),x>0&&(b=m.buffer.slice(_+2,_+2+x),_+=b.byteLength),p.push({id:E,length:x,data:b})}if(_!==d)throw Error("parse error");return{profile:c,length:d,datas:p}}decompress(t){return vce(new Uint8Array(t))}compress(t){return Ece(new Uint8Array(t))}}let xce={name:"DataStream",create:(e,t)=>{let r=t?new Nie(e):new Aie(e);return r.useDataStream(new yce),r}};class bce extends br{constructor(t,r,i){super(),W(this,"ws",void 0),W(this,"requestId",1),W(this,"heartBeatTimer",void 0),W(this,"joinInfo",void 0),W(this,"clientId",void 0),W(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),W(this,"onClose",c=>{this.emit("close"),this.dispose()}),W(this,"onMessage",c=>{let d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=t,this.clientId=r,this.ws=new $f("cross-channel-".concat(this.clientId),i),this.ws.on(pt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(pt.CONNECTED,this.onOpen),this.ws.on(pt.ON_MESSAGE,this.onMessage),this.ws.on(pt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new je((r,i)=>{let c=window.setTimeout(()=>{i(new le(z.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,d=>{window.clearTimeout(c),d.state&&d.state!==0?i(new le(z.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),i(new le(z.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new le(z.WS_DISCONNECT);let r=()=>new je((h,p)=>{this.ws.once(pt.CLOSED,()=>p(new le(z.WS_ABORT))),this.ws.once(pt.CONNECTED,h)});this.ws.state!=="connected"&&await r();let i=this.sendMessage(t),c=new je((h,p)=>{let m=()=>{p(new le(z.WS_ABORT))};this.ws.once(pt.RECONNECTING,m),this.ws.once(pt.CLOSED,m),this.once("req_".concat(i),h),hs(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(pt.RECONNECTING,m),this.ws.off(pt.CLOSED,m),p(new le(z.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new le(z.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(t){this.ws.removeAllListeners(pt.REQUEST_NEW_URLS),this.ws.on(pt.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class wce extends br{set state(t){t!==this._state&&(t!==bn.RELAY_STATE_FAILURE&&(this.errorCode=gh.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,i,c,d){super(),W(this,"joinInfo",void 0),W(this,"sid",void 0),W(this,"clientId",void 0),W(this,"cancelToken",dn.CancelToken.source()),W(this,"workerToken",void 0),W(this,"requestId",0),W(this,"signal",void 0),W(this,"prevChannelMediaConfig",void 0),W(this,"httpRetryConfig",void 0),W(this,"_resolution",void 0),W(this,"_state",bn.RELAY_STATE_IDLE),W(this,"errorCode",gh.RELAY_OK),W(this,"onStatus",h=>{N.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",sc.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",sc.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=gh.SRC_TOKEN_EXPIRED,this.state=bn.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=gh.DEST_TOKEN_EXPIRED,this.state=bn.RELAY_STATE_FAILURE))}),W(this,"onReconnect",async()=>{N.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",sc.NETWORK_DISCONNECTED),this.state=bn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==bn.RELAY_STATE_IDLE&&(N.error("auto restart channel media relay failed",h.toString()),this.errorCode=gh.SERVER_CONNECTION_LOST,this.state=bn.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=cd(),this.signal=new bce(this.joinInfo,this.clientId,i),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(t){if(this.state!==bn.RELAY_STATE_IDLE)throw new le(z.INVALID_OPERATION);this.state=bn.RELAY_STATE_CONNECTING,await this.connect(),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new le(z.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new le(z.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new le(z.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==bn.RELAY_STATE_RUNNING)throw new le(z.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==bn.RELAY_STATE_RUNNING)throw new le(z.INVALID_OPERATION);let r=this.genMessage(sn.SetVideoProfile);await this.signal.request(r),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),N.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=bn.RELAY_STATE_IDLE,this.dispose()}dispose(){N.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=dn.CancelToken.source(),this.state=bn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await kae(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",sc.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let r=this.genMessage(sn.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let i=this.genMessage(sn.SetSdkProfile,t);await this.signal.request(i),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let c=this.genMessage(sn.SetSourceChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",sc.PACKET_JOINED_SRC_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let d=this.genMessage(sn.SetSourceUserId,t);await this.signal.request(d),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let h=this.genMessage(sn.SetDestChannel,t);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",sc.PACKET_JOINED_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let p=this.genMessage(sn.StartPacketTransfer,t);await this.signal.request(p),this.emit("event",sc.PACKET_SENT_TO_DEST_CHANNEL),this.state=bn.RELAY_STATE_RUNNING,N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let r=this.genMessage(sn.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",sc.PACKET_UPDATE_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(sn.StopPacketTransfer);await this.signal.request(t),N.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){let i=[],c=[],d=[];this.requestId+=1;let h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:bi,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(t){case sn.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case sn.SetSourceChannel:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new le(z.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case sn.SetSourceUserId:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new le(z.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case sn.SetDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new le(z.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{i.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:i,uid:c,token:d},h;case sn.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case sn.Reconnect:return h.clientRequest={command:"Reconnect"},h;case sn.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case sn.UpdateDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new le(z.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{i.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:i,uid:c,token:d},h;case sn.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}let Sce={name:"ChannelMediaRelay",create:function(e){return new wce(e.joinInfo,e.clientId,e.websocketRetryConfig||Gr,e.httpRetryConfig||Gr,e.resolution)}};function v3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Sm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v3(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v3(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class Cce extends br{constructor(t,r,i,c){super(),W(this,"spec",void 0),W(this,"token",void 0),W(this,"websocket",void 0),W(this,"pingpongTimer",void 0),W(this,"reconnectMode","retry"),W(this,"serviceMode",void 0),W(this,"reqId",0),W(this,"commandReqId",0),W(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),W(this,"handleWebSocketMessage",d=>{if(!d.data)return;let h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(ze.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===rc.TRANSCODE?1:2}),this.emit(Wc.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=t,this.serviceMode=c,this.websocket=new $f("live-streaming",i),this.websocket.on(pt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pt.REQUEST_NEW_URLS,(d,h)=>{Ss(this,Wc.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(pt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,i,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new le(z.UNEXPECTED_ERROR);let p=Sm({command:t,sdkVersion:bi==="4.24.0"?"0.0.1":bi,seq:h,requestId:h,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new le(z.WS_DISCONNECT);let m=()=>new je((b,C)=>{this.websocket.once(pt.CLOSED,()=>C(new le(z.WS_ABORT))),this.websocket.once(pt.CONNECTED,b)});this.websocket.state!=="connected"&&await m(),p.clientRequest&&(p.clientRequest.workerToken=this.token);let _=new je((b,C)=>{let U=()=>{C(new le(z.WS_ABORT))};this.websocket.once(pt.RECONNECTING,U),this.websocket.once(pt.CLOSED,U),this.once("@".concat(h,"-").concat(this.spec.sid),k=>{b(k)})});c&&ze.workerEvent(this.spec.sid,Sm(Sm({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));let E=Date.now();this.websocket.sendMessage(p);let x=null;try{x=await _}catch(b){if(this.websocket.state==="closed")throw b;return await m(),await this.request(t,r,i)}return c&&ze.workerEvent(this.spec.sid,Sm(Sm({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(x.serverResponse),serverCode:x.code,success:x.code===200,responseTime:Date.now()-E})),x.code!==200&&this.handleResponseError(x),x}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=bi==="4.24.0"?"0.0.1":bi;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Yr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void N.warning("live stream response already exists stream");case Yr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Yr.LIVE_STREAM_RESPONSE_BAD_STREAM:case Yr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new le(z.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Yr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new le(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Yr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new le(z.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Yr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let r=new le(z.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Wc.WARNING,r,t.serverResponse.url)}case Yr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let r=new le(z.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Wc.WARNING,r,t.serverResponse.url)}case Yr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new le(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Yr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new le(z.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Yr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let r=new le(z.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Wc.WARNING,r,t.serverResponse.url)}case Yr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new le(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Yr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new le(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Yr.LIVE_STREAM_RESPONSE_WORKER_LOST:case Yr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new le(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Yr.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new le(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new le(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Yr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Yr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Yr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Yr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new le(z.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(jE)},6e3)}}function y3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function wn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y3(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y3(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class Tce extends br{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gr,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Gr;super(),W(this,"onLiveStreamWarning",void 0),W(this,"onLiveStreamError",void 0),W(this,"spec",void 0),W(this,"retryTimeout",1e4),W(this,"connection",void 0),W(this,"httpRetryConfig",void 0),W(this,"wsRetryConfig",void 0),W(this,"streamingTasks",new Map),W(this,"isStartingStreamingTask",!1),W(this,"taskMutex",new Is("live-streaming")),W(this,"cancelToken",dn.CancelToken.source()),W(this,"transcodingConfig",void 0),W(this,"uapResponse",void 0),W(this,"lastTaskId",1),W(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=r}async setTranscodingConfig(t){let r=wn(wn({},hae),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(N.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(h=>wn(wn(wn({},uae),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Cr(h.width)||Qt(h.width,"config.width",0,1e4),Cr(h.height)||Qt(h.height,"config.height",0,1e4),Cr(h.videoBitrate)||Qt(h.videoBitrate,"config.videoBitrate",1,1e6),Cr(h.videoFrameRate)||Qt(h.videoFrameRate,"config.videoFrameRate"),Cr(h.lowLatency)||ja(h.lowLatency,"config.lowLatency"),Cr(h.audioSampleRate)||Jr(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Cr(h.audioBitrate)||Qt(h.audioBitrate,"config.audioBitrate",1,128),Cr(h.audioChannels)||Jr(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Cr(h.videoGop)||Qt(h.videoGop,"config.videoGop"),Cr(h.videoCodecProfile)||Jr(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Cr(h.userCount)||Qt(h.userCount,"config.userCount",0,17),Cr(h.backgroundColor)||Qt(h.backgroundColor,"config.backgroundColor",0,16777215),Cr(h.userConfigExtraInfo)||us(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Cr(h.transcodingUsers)&&(tc(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((p,m)=>{iv(p.uid),Cr(p.x)||Qt(p.x,"transcodingUser[".concat(m,"].x"),0,1e4),Cr(p.y)||Qt(p.y,"transcodingUser[".concat(m,"].y"),0,1e4),Cr(p.width)||Qt(p.width,"transcodingUser[".concat(m,"].width"),0,1e4),Cr(p.height)||Qt(p.height,"transcodingUser[".concat(m,"].height"),0,1e4),Cr(p.zOrder)||Qt(p.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),Cr(p.alpha)||Qt(p.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),Cr(h.watermark)||gC(h.watermark,"watermark"),Cr(h.backgroundImage)||gC(h.backgroundImage,"backgroundImage"),h.images&&!Cr(h.images)&&(tc(h.images,"config.images"),h.images.forEach((p,m)=>{gC(p,"images[".concat(m,"]"))}))}(r);let i=[];r.images&&i.push(...r.images.map(h=>wn(wn(wn({},mC),h),{},{zOrder:255}))),r.backgroundImage&&(i.push(wn(wn(wn({},mC),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(i.push(wn(wn(wn({},mC),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=i,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(h=>wn({},h)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);let c=(r.userConfigs||[]).map(h=>typeof h.uid=="number"?je.resolve(h.uid):KU(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await je.all(c)).forEach((h,p)=>{r.userConfigs&&r.userConfigs[p]&&(r.userConfigs[p].uid=h)}),this.transcodingConfig=r,this.connection)try{var d;let h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ln(d=this.streamingTasks).call(d)).map(p=>p.taskId).join("#")});N.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(p=>{N.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,h).then(()=>{N.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(p.url," success"))}).catch(m=>{N.error("[".concat(this.spec.clientId,"] live streaming republish failed"),p.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)})})}}async startLiveStreamingTask(t,r,i){if(!this.transcodingConfig&&r===rc.TRANSCODE)throw new le(z.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};N.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));let d=await this.taskMutex.lock();if(!this.connection&&i)return void d();if(this.streamingTasks.get(t)&&!i)return d(),new le(z.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(p){throw d(),p}switch(r){case rc.TRANSCODE:c.transcodingConfig=wn({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let h=this.lastTaskId++;try{let p=new je((_,E)=>{hs(this.retryTimeout).then(()=>{if(i)return E(i);let x=this.statusError.get(t);return x?(this.statusError.delete(t),E(x)):void 0})}),m=await je.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:r===rc.TRANSCODE?1:2,requestByUser:!i,tid:h.toString()}),p]);this.isStartingStreamingTask=!1,N.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:c,mode:r,url:t,taskId:h}),d()}catch(p){if(d(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||i)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,p)):await this.startLiveStreamingTask(t,r,p)}}stopLiveStreamingTask(t){return new je((r,i)=>{let c=this.streamingTasks.get(t);if(!c||!this.connection)return new le(z.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let d=c.mode;c.abortTask=()=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:d===rc.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(i)})}resetAllTask(){var t;let r=Array.from(Ln(t=this.streamingTasks).call(t));this.terminate();for(let i of r)this.startLiveStreamingTask(i.url,i.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=dn.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new le(z.UNEXPECTED_ERROR,"live streaming connection has already connected");let r=await Ss(this,_C.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new Cce(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Wc.WARNING,(i,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,i)),this.connection.on(Wc.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Wc.REQUEST_NEW_ADDRESS,(i,c)=>{if(!this.connection)return c(new le(z.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ss(this,_C.REQUEST_WORKER_MANAGER_LIST,t).then(d=>{this.uapResponse=d,i(d.addressList)}).catch(c)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){let r=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(r),c=t.reason;switch(t.code){case Yr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Yr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Yr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Yr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let h=new le(z.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return N.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case Yr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let h=new le(z.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case Yr.LIVE_STREAM_RESPONSE_WORKER_LOST:case Yr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();let h=Array.from(Ln(d=this.streamingTasks).call(d));for(let p of h)p.abortTask?p.abortTask():(N.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new le(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{N.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{N.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let Rce={name:"LiveStreaming",create:function(e){return new Tce(e.joinInfo,e.websocketRetryConfig||Gr,e.httpRetryConfig||Gr)}};function Nce(e){let t=w3();return function(r,i){let c=r.appId;c!==void 0&&(Yt(i,10),Io(i,c));let d=r.cid;d!==void 0&&(Yt(i,16),Yt(i,d));let h=r.cname;h!==void 0&&(Yt(i,26),Io(i,h));let p=r.deviceId;p!==void 0&&(Yt(i,34),Io(i,p));let m=r.elapse;m!==void 0&&(Yt(i,40),nl(i,m));let _=r.fileSize;_!==void 0&&(Yt(i,48),nl(i,Ph(_)));let E=r.height;E!==void 0&&(Yt(i,56),nl(i,Ph(E)));let x=r.jpg;x!==void 0&&(Yt(i,66),Yt(i,x.length),function(js,ge){let Ie=kh(js,ge.length);js.bytes.set(ge,Ie)}(i,x));let b=r.networkType;b!==void 0&&(Yt(i,72),nl(i,Ph(b)));let C=r.osType;C!==void 0&&(Yt(i,80),nl(i,Ph(C)));let U=r.requestId;U!==void 0&&(Yt(i,90),Io(i,U));let k=r.sdkVersion;k!==void 0&&(Yt(i,98),Io(i,k));let M=r.sequence;M!==void 0&&(Yt(i,104),nl(i,Ph(M)));let H=r.sid;H!==void 0&&(Yt(i,114),Io(i,H));let K=r.timestamp;K!==void 0&&(Yt(i,120),nl(i,K));let X=r.uid;X!==void 0&&(Yt(i,128),Yt(i,X));let se=r.vid;se!==void 0&&(Yt(i,136),Yt(i,se));let te=r.width;te!==void 0&&(Yt(i,144),nl(i,Ph(te)));let Z=r.service;Z!==void 0&&(Yt(i,152),Yt(i,Z));let ce=r.callbackData;ce!==void 0&&(Yt(i,162),Io(i,ce));let fe=r.jpgEncryption;fe!==void 0&&(Yt(i,168),Yt(i,fe));let xe=r.requestType;xe!==void 0&&(Yt(i,176),Yt(i,xe));let Te=r.scorePorn;Te!==void 0&&(Yt(i,185),bT(i,Te));let _t=r.scoreSexy;_t!==void 0&&(Yt(i,193),bT(i,_t));let vt=r.scoreNeutral;vt!==void 0&&(Yt(i,201),bT(i,vt));let at=r.scene;at!==void 0&&(Yt(i,208),Yt(i,at));let Vt=r.ossFilePrefix;Vt!==void 0&&(Yt(i,218),Io(i,Vt));let Mt=r.serviceVendor;if(Mt!==void 0)for(let js of Mt){Yt(i,226);let ge=w3();Oce(js,ge),Yt(i,ge.limit),jce(i,ge),kce(ge)}}(e,t),function(r){let i=r.bytes,c=r.limit;return i.length===c?i:i.subarray(0,c)}(t)}function Ace(e){return function(r){let i={};e:for(;!S3(r);){let c=Oo(r);switch(c>>>3){case 0:break e;case 1:i.code=Oo(r);break;case 2:i.msg=C3(r,Oo(r));break;case 3:{let d=Dce(r);i.data=Ice(r),r.limit=d;break}default:x3(r,7&c)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Ice(e){let t={};e:for(;!S3(e);){let r=Oo(e);switch(r>>>3){case 0:break e;case 1:t.requestId=C3(e,Oo(e));break;case 2:t.requestType=Oo(e)>>>0;break;case 3:t.scorePorn=xT(e);break;case 4:t.scoreSexy=xT(e);break;case 5:t.scoreNeutral=xT(e);break;case 6:t.requestScene=Oo(e)>>>0;break;case 7:t.scene=Oo(e)>>>0;break;default:x3(e,7&r)}}return t}function Oce(e,t){let r=e.service;r!==void 0&&(Yt(t,8),Yt(t,r));let i=e.vendor;i!==void 0&&(Yt(t,16),Yt(t,i));let c=e.token;c!==void 0&&(Yt(t,26),Io(t,c));let d=e.callbackUrl;d!==void 0&&(Yt(t,34),Io(t,d))}function Dce(e){let t=Oo(e),r=e.limit;return e.limit=e.offset+t,r}function x3(e,t){switch(t){case 0:for(;128&T3(e););break;case 2:vT(e,Oo(e));break;case 5:vT(e,4);break;case 1:vT(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Pce=new Float32Array(1);new Uint8Array(Pce.buffer);let ET=new Float64Array(1),Sn=new Uint8Array(ET.buffer);function Ph(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let b3=[];function w3(){let e=b3.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function kce(e){b3.push(e)}function vT(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function S3(e){return e.offset>=e.limit}function kh(e,t){let r=e.bytes,i=e.offset,c=e.limit,d=i+t;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),i}function yT(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function C3(e,t){let r=yT(e,t),i=String.fromCharCode,c=e.bytes,d="",h="";for(let p=0;p<t;p++){let m,_,E,x,b=c[p+r];128&b?(224&b)==192?p+1>=t?h+=d:(m=c[p+r+1],(192&m)!=128?h+=d:(x=(31&b)<<6|63&m,x<128?h+=d:(h+=i(x),p++))):(240&b)==224?p+2>=t?h+=d:(m=c[p+r+1],_=c[p+r+2],(49344&(m|_<<8))!=32896?h+=d:(x=(15&b)<<12|(63&m)<<6|63&_,x<2048||x>=55296&&x<=57343?h+=d:(h+=i(x),p+=2))):(248&b)==240?p+3>=t?h+=d:(m=c[p+r+1],_=c[p+r+2],E=c[p+r+3],(12632256&(m|_<<8|E<<16))!=8421504?h+=d:(x=(7&b)<<18|(63&m)<<12|(63&_)<<6|63&E,x<65536||x>1114111?h+=d:(x-=65536,h+=i(55296+(x>>10),56320+(1023&x)),p+=3))):h+=d:h+=i(b)}return h}function Io(e,t){let r=t.length,i=0;for(let h=0;h<r;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+t.charCodeAt(++h)-56613888),i+=p<128?1:p<2048?2:p<65536?3:4}Yt(e,i);let c=kh(e,i),d=e.bytes;for(let h=0;h<r;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+t.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function jce(e,t){let r=kh(e,t.limit),i=e.bytes,c=t.bytes;for(let d=0,h=t.limit;d<h;d++)i[d+r]=c[d]}function T3(e){return e.bytes[yT(e,1)]}function R3(e,t){let r=kh(e,1);e.bytes[r]=t}function xT(e){let t=yT(e,8),r=e.bytes;return Sn[0]=r[t++],Sn[1]=r[t++],Sn[2]=r[t++],Sn[3]=r[t++],Sn[4]=r[t++],Sn[5]=r[t++],Sn[6]=r[t++],Sn[7]=r[t++],ET[0]}function bT(e,t){let r=kh(e,8),i=e.bytes;ET[0]=t,i[r++]=Sn[0],i[r++]=Sn[1],i[r++]=Sn[2],i[r++]=Sn[3],i[r++]=Sn[4],i[r++]=Sn[5],i[r++]=Sn[6],i[r++]=Sn[7]}function Oo(e){let t,r=0,i=0;do t=T3(e),r<32&&(i|=(127&t)<<r),r+=7;while(128&t);return i}function Yt(e,t){for(t>>>=0;t>=128;)R3(e,127&t|128),t>>>=7;R3(e,t)}function nl(e,t){let r=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?i===0?r<16384?r<128?1:2:r<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:c<128?9:10,h=kh(e,d),p=e.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=d!==9?128|c:127&c;case 8:p[h+7]=d!==8?i>>>21|128:i>>>21&127;case 7:p[h+6]=d!==7?i>>>14|128:i>>>14&127;case 6:p[h+5]=d!==6?i>>>7|128:i>>>7&127;case 5:p[h+4]=d!==5?128|i:127&i;case 4:p[h+3]=d!==4?r>>>21|128:r>>>21&127;case 3:p[h+2]=d!==3?r>>>14|128:r>>>14&127;case 2:p[h+1]=d!==2?r>>>7|128:r>>>7&127;case 1:p[h]=d!==1?128|r:127&r}}function N3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}let Lce=new Map([["moderation",1],["supervise",2]]);class Mce extends br{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(as.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=zi(r=t.map(i=>Lce.get(i)||0)).call(r,(i,c)=>i+c),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),W(this,"name","AgoraRTCVideoContentInspect"),W(this,"_connectionState",sa.CONNECTING),W(this,"_innerConnectionState",void 0),W(this,"sequence",0),W(this,"inspectStartTime",void 0),W(this,"workerManagerConnection",void 0),W(this,"workerConnection",void 0),W(this,"workerMessageLengthLimit",void 0),W(this,"inspectIntervalMinimum",void 0),W(this,"qualityRatio",void 0),W(this,"_connectInfo",void 0),W(this,"_cancelTokenSource",dn.CancelToken.source()),W(this,"_retryConfig",void 0),W(this,"wmSequence",0),W(this,"inspectInterval",void 0),W(this,"inspectTimer",null),W(this,"ossFilePrefix",void 0),W(this,"extraInfo",void 0),W(this,"_inspectType",void 0),W(this,"_inspectMode",void 0),W(this,"_quality",1),W(this,"qualityTimer",null),W(this,"_inspectId",void 0),W(this,"_needWorkUrlOnly",!1),W(this,"inspectImage",()=>{if(this.connectionState!==sa.CONNECTED)throw new le(z.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===sa.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=tr(5,"inspect-"),this.workerMessageLengthLimit=Y("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Y("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Y("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new $f("worker-manager-"+this._inspectId,Gr),this.on(as.STATE_CHANGE,(r,i)=>{this._innerConnectionState=r,N.debug("[".concat(this._inspectId,"] Inspect operation :").concat(na[r]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new $f("worker-"+this._inspectId,Gr),this.handleWorkerEvents()}async init(t,r){this.emit(as.STATE_CHANGE,na.CONNECT_AP),this._connectInfo=t;let i=this._cancelTokenSource.token;return this._retryConfig=r,new je((c,d)=>{this.on(as.CONNECTION_STATE_CHANGE,(h,p)=>{p===sa.CONNECTED&&c()}),this.requestAP(t,i,r).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(t,r,i){let c=Y("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),d=await function(p,m,_,E){let{appId:x,areaCode:b,cname:C,sid:U,token:k,uid:M}=m;wh++;let H="image_moderation_api",K={service_name:H,json_body:JSON.stringify({appId:x,areaCode:b,cname:C,command:"allocateEdge",requestId:wh,seq:wh,sid:U,token:k,ts:Date.now(),uid:M+""})},X,se,te=p[0];return La(async()=>{X=Date.now();let Z=await Ba(te,{data:K,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(se=Date.now()-X,Z.code!==0){let Te=new le(z.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Z.code,{retry:!0,responseTime:se});throw N.error(Te.toString()),Te}let ce=JSON.parse(Z.json_body);if(ce.code!==200){let Te=new le(z.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ce.code,", reason: ").concat(ce.reason),{code:ce.code,responseTime:se});throw N.error(Te.toString()),Te}if(!ce.servers||!Array.isArray(ce.servers)||ce.servers.length===0){let Te=new le(z.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ce.code,responseTime:se});throw N.error(Te.toString()),Te}let fe=Y("VIDEO_INSPECT_WORKER_MANAGER_HOST"),xe=Y("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ce.servers.map(Te=>{let{address:_t,wss:vt}=Te;if(_t&&vt)return"wss://".concat(_t.replace(/\./g,"-"),".").concat(fe,":").concat(xe||vt)}).filter(Te=>!!Te),workerToken:ce.workerToken,vid:ce.vid,responseTime:se}},(Z,ce)=>(ze.apworkerEvent(U,{success:!0,sc:200,serviceName:H,responseDetail:JSON.stringify(Z.addressList),firstSuccess:ce===0,responseTime:se,serverIp:p[ce%p.length]}),!1),(Z,ce)=>(ze.apworkerEvent(U,{success:!1,sc:Z.data&&Z.data.code||200,serviceName:H,responseTime:se,serverIp:p[ce%p.length]}),!!(Z.code!==z.OPERATION_ABORTED&&Z.code!==z.UNEXPECTED_RESPONSE||Z.data&&Z.data.retry)&&(te=p[(ce+1)%p.length],!0)),E)}(c,t,r,i);this.emit(as.STATE_CHANGE,na.AP_CONNECTED);let{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(as.STATE_CHANGE,na.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(pt.CONNECTED,async()=>{this.emit(as.STATE_CHANGE,na.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(pt.CLOSED,()=>{this._innerConnectionState<na.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(pt.FAILED,()=>{this._innerConnectionState<na.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(pt.RECONNECTING,()=>{this._innerConnectionState<na.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(pt.ON_MESSAGE,async t=>{this.emit(as.STATE_CHANGE,na.GET_WORKER_MANAGER_RESPONSE);let r=this.workerManagerConnection.url;this.workerManagerConnection.close();let i=JSON.parse(t.data);if(i.code!==200)throw N.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new le(z.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&r))throw N.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new le(z.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{let c=Y("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,d=r.replace(/:\d+\/?$/,":".concat(c));this.emit(as.STATE_CHANGE,na.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(as.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(pt.WILL_RECONNECT,(t,r,i)=>{i(t)}),this.workerManagerConnection.on(pt.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(pt.CONNECTED,async()=>{this.emit(as.STATE_CHANGE,na.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=sa.CONNECTED}),this.workerConnection.on(pt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let i=Ace(new Uint8Array(t.data));if(Y("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&N.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(as.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var r;let c={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},d=zi(r=Object.keys(c)).call(r,(p,m)=>c[p]>c[m]?p:m,"porn"),h=Object.keys(c).find(p=>p===d);this.emit(as.INSPECT_RESULT,h)}else this.emit(as.INSPECT_RESULT,void 0,new le(z.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(as.INSPECT_RESULT,void 0,new le(z.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else N.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(as.INSPECT_RESULT,void 0,new le(z.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(pt.CLOSED,()=>{this.connectionState=sa.CLOSED}),this.workerConnection.on(pt.FAILED,()=>{this.connectionState=sa.CLOSED}),this.workerConnection.on(pt.RECONNECTING,()=>{this.connectionState=this.connectionState===sa.CONNECTED?sa.RECONNECTING:sa.CONNECTING}),this.workerConnection.on(pt.WILL_RECONNECT,(t,r,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(pt.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(as.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{r(i)})})}async requestToInspectImage(){this.sequence++;let t=ri(this,as.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(as.INSPECT_RESULT,void 0,new le(z.INVALID_OPERATION,"Only the track being played can be inspected"));let i=await this.generateRequestData(t,r);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(as.INSPECT_RESULT,void 0,new le(z.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:i,cname:c,cid:d,vid:h,sid:p,uid:m}=r,_=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),x=await lM(E,i,c),b=this.sequence+"-"+d+"-"+m+"-"+_+"-"+tr(12,""),C={appId:i,cid:d,cname:c,deviceId:"",elapse:(U=Number(_-this.inspectStartTime),{low:U|=0,high:U>>31,unsigned:U>=0}),fileSize:x.byteLength,jpgEncryption:2,height:E.height,width:E.width,jpg:x,networkType:6,osType:7,requestId:b,sdkVersion:"4.24.0",sequence:this.sequence,sid:p,timestamp:L5(_),uid:m,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var U;this.extraInfo===void 0&&delete C.callbackData,this.ossFilePrefix===void 0&&delete C.ossFilePrefix;let k=Nce(C);if(k.byteLength<this.workerMessageLengthLimit){if(Y("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let M=function(H){for(var K=1;K<arguments.length;K++){var X=arguments[K]!=null?arguments[K]:{};K%2?N3(Object(X),!0).forEach(function(se){W(H,se,X[se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(X)):N3(Object(X)).forEach(function(se){Object.defineProperty(H,se,Object.getOwnPropertyDescriptor(X,se))})}return H}({},C);delete M.jpg,N.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(M))}return k}{let M=this.quality*this.qualityRatio;return this.quality=M,await this.generateRequestData(t,{appId:i,cname:c,cid:d,vid:h,sid:p,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=dn.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=sa.CLOSED,this.emit(as.STATE_CHANGE,na.CLOSED)}}let Fce={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new le(z.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new le(z.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let i=[...new Set(r.inspectType)];i.forEach(c=>{var d;if(!Ae(d=["supervise","moderation"]).call(d,c))throw new le(z.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),r.inspectType=i}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new le(z.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Mce(t)}};var A3=u(Pr.Object.getOwnPropertySymbols),Uce=qt,Vce=Db.indexOf,Bce=i_,wT=ne([].indexOf),I3=!!wT&&1/wT([1],1,-0)<0;Uce({target:"Array",proto:!0,forced:I3||!Bce("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return I3?wT(this,e,t)||0:Vce(this,e,t)}});var Wce=Hi("Array","indexOf"),Gce=I,Hce=Wce,ST=Array.prototype,zce=function(e){var t=e.indexOf;return e===ST||Gce(ST,e)&&t===ST.indexOf?Hce:t},O3=u(zce);function Kce(e,t){if(e==null)return{};var r,i,c=function(h,p){if(h==null)return{};var m={};for(var _ in h)if({}.hasOwnProperty.call(h,_)){if(O3(p).call(p,_)!==-1)continue;m[_]=h[_]}return m}(e,t);if(A3){var d=A3(e);for(i=0;i<d.length;i++)r=d[i],O3(t).call(t,r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(c[r]=e[r])}return c}let D3=class{get localCapabilities(){return vr(this._localCapabilities)}get rtpCapabilities(){return vr(this._rtpCapabilities)}get candidates(){return vr(this._candidates)}get iceParameters(){return vr(this._iceParameters)}get dtlsParameters(){return vr(this._dtlsParameters)}constructor(e){W(this,"sessionDesc",void 0),W(this,"_localCapabilities",void 0),W(this,"_rtpCapabilities",void 0),W(this,"_candidates",void 0),W(this,"_iceParameters",void 0),W(this,"_dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname","o/i14u9pJrxRKAsu"),W(this,"firefoxSsrcMidMap",new Map),e=vr(e);let{remoteIceParameters:t,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:p,videoCodec:m,audioCodec:_}=e,E;this.setup=p,E=h===rn.RECEIVE_ONLY?yn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):yn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=i,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=d;let x=h===rn.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,b=h===rn.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=h===rn.RECEIVE_ONLY?c.send.videoCodecs:Zf(Fe.VIDEO,x,b,m),U=h===rn.RECEIVE_ONLY?c.send.audioCodecs:Zf(Fe.AUDIO,x,b,_);for(let k of E.mediaDescriptions)k.attributes.iceUfrag=t.iceUfrag,k.attributes.icePwd=t.icePwd,k.attributes.fingerprints=r.fingerprints,k.attributes.candidates=i,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video"&&(k.media.fmts=C.map(M=>M.payloadType.toString(10)),k.attributes.payloads=C,k.attributes.extmaps=x.videoExtensions),k.media.mediaType==="audio"&&(k.media.fmts=U.map(M=>M.payloadType.toString(10)),k.attributes.payloads=U,k.attributes.extmaps=x.audioExtensions,bh(k));this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Vc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,i,c){r=r.replace(/ /g,"-");let{ssrcs:d,ssrcGroups:h}=Qf(t,this.cname,Y("SYNC_GROUP")?r:void 0),p=this.findPreloadMediaDesc(d);if(p){if(Sr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),c&&(c.twcc||c.remb)){let m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{let m=this.findAvailableMediaIndex(e,d,i),_;return m===-1?(_=this.createOrRecycleSendMedia(e,d,h,"sendonly",i,c),this.updateBundleMids()):(_=vr(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,c)),Sr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{needExchangeSDP:!0,mid:_.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){let i=[];return e.forEach(c=>{let d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d),p,m=!1;h===-1?(m=!0,p=this.createOrRecycleRecvMedia(c,[],"recvonly",t,r),this.updateBundleMids()):(p=vr(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="recvonly"),i.push({mid:p.attributes.mid,needCreateTransceiver:m})}),i}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:r,address:i,port:c,type:d,relatedAddress:h,relatedPort:p,priority:m}=new RTCIceCandidate(e),_={foundation:t??"",componentId:"1",transport:r??"",priority:m?m+"":"",connectionAddress:i??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:p?p+"":"",extension:{}};this.candidates.some(E=>E.priority===_.priority&&E.connectionAddress===_.connectionAddress&&E.port===_.port)||(this._candidates.push(_),this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,i,c){let d=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=Zf(d,h,this.localCapabilities.send,d===Fe.AUDIO?c:i),m=d===Fe.VIDEO?h.videoExtensions:h.audioExtensions,_="".concat(++this.currentMidIndex),E={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};E=this.mungRecvMediaDsec(E,e);let x=this.findFirstClosedMedia(d);if(x){let b=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[b]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>Ae(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>Ae(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{let c=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Sr()){if(c){let d=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(d||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!d||d!==i.attributes.mid)}return!1}return c&&i.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=vr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,i,c,d){let h=this.rtpCapabilities.send,p=e===Fe.VIDEO?h.videoCodecs:h.audioCodecs,m=e===Fe.VIDEO?h.videoExtensions:h.audioExtensions;Sr()&&(c="".concat(++this.currentMidIndex));let _={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(x=>x.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:c}};_=this.mungSendMediaDesc(_,d);let E=this.findFirstClosedMedia(e);if(E){let x=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[x]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}mungRecvMediaDsec(e,t,r){let i=vr(e);return wC(i),xh(i,t),SC(i,t),TU(i),pv(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,t){let r=vr(e);return pv(r,t,this.localCapabilities.recv),bh(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(r!==-1){let i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Sr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},qce=["sdp"];var or;function P3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function il(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P3(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P3(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let k3=(or=class Gh extends cU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,i){super(t,r),W(this,"direction",void 0),W(this,"name",void 0),W(this,"store",void 0),W(this,"spec",void 0),W(this,"peerConnection",void 0),W(this,"initialOffer",void 0),W(this,"transport",void 0),W(this,"statsFilter",void 0),W(this,"localCandidateCount",0),W(this,"_isInRestartIce",!1),W(this,"mutex",void 0),W(this,"onLocalCandidate",void 0),W(this,"remoteSDP",void 0),W(this,"pendingCandidates",[]),W(this,"localCapabilities",void 0),W(this,"isReady",!1),W(this,"restartCnt",0),W(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new Is("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Gh.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??rn.SEND_ONLY,this.name=this.direction===rn.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=D0(this.peerConnection,Y("STATS_UPDATE_INTERVAL"),void 0,Sr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let r=await NU();if(this.localCapabilities=fv(r),t){let{sdp:i}=t,c=Kce(t,qce),d=function(){let E={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},x=Jf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ia(x,E,"videoExtensions",b,C,U),ia(x,E,"videoCodecs",b,C,U),ia(x,E,"audioExtensions",b,C,U),ia(x,E,"audioCodecs",b,C,U),Y("RAISE_H264_BASELINE_PRIORITY")){let k=U.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]==="42001f");if(k!==-1){let M=U.videoCodecs.findIndex(H=>H.rtpMap&&H.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(M<k){N.debug("raising H264 baseline profile priority");let H=U.videoCodecs[k];U.videoCodecs.splice(k,1),U.videoCodecs.splice(M,0,H)}M!==-1&&Y("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(H=>!(H.rtpMap&&H.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&H.fmtp&&H.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:b,recv:C,sendrecv:U}}({},{},i);this.remoteSDP=new D3({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let p=Kc(h.sdp);await this.peerConnection.setLocalDescription(h);let m=await AU({},{},h.sdp);this.localCapabilities=fv(m);let _=this.peerConnection.getTransceivers()[0];return _!=null&&_.receiver&&_.receiver.transport&&this.tryBindTransportEvents(_.receiver.transport),il(il({},p),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let c=Kc(i.sdp);return this.initialOffer=i,il(il({},c),{},{sdp:i.sdp})}}catch(r){throw new he(z.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:r,iceParameters:i,dtlsParameters:c}=t,d=await AU({},{},r);this.remoteSDP=new D3({remoteIceParameters:i,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new he(z.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,i){var c=this;return xi(function*(){let d=yield Ot(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let h=[],p=c.remoteSDP.receive(t,r,i);t.forEach((M,H)=>{if(p[H].needCreateTransceiver){let K=c.peerConnection.addTransceiver(M._mediaStreamTrack,{direction:"sendonly"});h.push(K),M._updateRtpTransceiver(K)}else{let K=c.peerConnection.getTransceivers().find(X=>X.mid===p[H].mid);if(!K)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[H].mid));h.push(K),M._updateRtpTransceiver(K)}}),Sr()&&Y("SIMULCAST")===!0&&(yield Ot(c.applySimulcastForFirefox(h,t)));let m=p.map(M=>M.mid),_=yield Ot(c.peerConnection.createOffer()),E=c.mungSendOfferSDP(_.sdp,t,m),x=yn(E),b=m.map(M=>{let H=x.mediaDescriptions.find(K=>K.attributes.mid===M);if(!H)throw new Error("Cannot extract ssrc from mediaDescription.");return wU(H,Y("USE_PUB_RTX"))}),C=h.map((M,H)=>{let K=m[H];return{localSSRC:b[H],id:K}});yield Ot(c.peerConnection.setLocalDescription({type:"offer",sdp:E}));try{yield C}catch(M){let H=c.remoteSDP.toString();throw yield Ot(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ot(c.peerConnection.setRemoteDescription({type:"answer",sdp:H})),yield Ot(c.stopSending(m,!0)),M}yield Ot(c.applySimulcastEncodings(h,t)),yield Ot(c.applySendEncodings(h,t));let U=c.remoteSDP.toString(),k=c.logSDPExchange(E,"offer","local","send");return k==null||k(U),yield Ot(c.setRemoteDescription({type:"answer",sdp:U})),h.map((M,H)=>{let K=m[H];return{localSSRC:b[H],id:K}})}catch(h){throw h instanceof he?h:new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(t,r){let i=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map(m=>{var _;m.direction="inactive",(_=m.stop)===null||_===void 0||_.call(m)});let d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);let p=this.remoteSDP.toString();h==null||h(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{i&&i()}}async receive(t,r,i,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,i,c);if(h){let m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});let E=await this.peerConnection.createAnswer(),x=this.mungReceiveAnswerSDP(E.sdp,d,t);_==null||_(x||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:x}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let p=this.peerConnection.getTransceivers().find(m=>m.mid===d);if(!p||p.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,transceiver:p}}catch(d){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(t,r,i,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,i,c);if(h){let p=this.remoteSDP.toString(),m=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});let _=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(_.sdp,d,t);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(d){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();i==null||i(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===ld.Auto&&(this.store.p2pTransport=ld.SdRtn,Dt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Gh.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Dt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Gh.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:i}=Kc(r.sdp);return this.store.descriptionStart(),this.direction===rn.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===rn.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:i}=Kc(r.sdp);return await this.peerConnection.setLocalDescription(r),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(i.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new he(z.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getTransceivers().filter(c=>c.mid===t);i.length===1&&(this.isVP8Simulcast(r)?Sr()||await this.applySimulcastEncodings(i,[r]):await this.applySendEncodings(i,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getTransceivers().find(c=>c.mid===r);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:i,remote:c}=r.getSelectedCandidatePair();return{local:il(il({},vo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:il(il({},vo),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;Ae(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c={iceServers:[]};var d;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Lf(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...Gh.turnServerConfigToIceServers(t.turnServer.servers,r,i)),Y("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...Gh.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,i)),Ae(d=[ld.Relay,ld.SdRtn]).call(d,r)&&(c.iceTransportPolicy="relay"),Y("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),Y("ENABLE_ENCODED_TRANSFORM")&&Dt().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),N.debug("P2PConnection p2pTransport is ".concat(r)),c}static turnServerConfigToIceServers(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=[],d=t.filter(p=>p.tcpport);N.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(i));let h=d.length>i?d[i]:d[0];switch(r){case ld.SdRtn:let p=t.filter(_=>{var E;return Ae(E=_.username).call(E,"glb:")&&_.turnServerURL==_.turnServerURL}),m=p.length>i?p[i]:p[0];m&&(c.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(Hc(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),c.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(Hc(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case ld.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Hc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Hc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in i?i.error:i)};let r=t.iceTransport;r&&(r.onstatechange=()=>{let i=t==null?void 0:t.iceTransport.state;var c;i&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:i,remote:c}=r.getSelectedCandidatePair()||{};if(i&&c){let d=i.address+":"+i.port,h=c.address+":"+c.port;N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(_d(d)),", remote ").concat(JSON.stringify(_d(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var i;if(r||(r=this.peerConnection.getSenders().find(E=>E.track===t._mediaStreamTrack)),!r)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Dt().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var h;let{bitrateMax:E,frameRate:x,scaleResolutionDownBy:b}=t._encoderConfig;E&&(d.maxBitrate=1e3*E),Ae(h=t._hints).call(h,Zt.LOW_STREAM)&&(x&&(d.maxFramerate=Vn(x)),b&&b>=1&&(d.scaleResolutionDownBy=b))}if(Y("DSCP_TYPE")&&ec()){var p;let E=Y("DSCP_TYPE");Ae(p=["very-low","low","medium","high"]).call(p,E)&&(d.networkPriority=E)}let m=r.getParameters(),_=(i=m.encodings)===null||i===void 0?void 0:i[0];Sr()&&!_&&(c.encodings=[d]),_&&Object.assign(_,d),Object.assign(m,c),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await r.setParameters(m)}async applySendEncodings(t,r){try{if(!Dt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let c=t[i],d=r[i];d instanceof ar&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,i){let c=yn(t);return r.forEach((d,h)=>{let p=i[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(xh(m,d),RU(m,d,this.store.codec))}),Vc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let m=0;m<t.length;m++){var i,c,d,h,p;let _=t[m],E=r[m];if(E instanceof ar&&!Ae(i=E._hints).call(i,Zt.LOW_STREAM)&&(c=E._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=E._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=E._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){let x={},b={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};x.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let C=_.sender.getParameters();await _.sender.setParameters(Object.assign(C,x))}}}async applySimulcastEncodings(t,r){if(!Sr()&&t.length===r.length)for(let i=0;i<t.length;i++){let c=r[i];if(c instanceof ar&&this.isVP8Simulcast(c)){let d=t[i],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];let m=d.sender.getParameters();await d.sender.setParameters(Object.assign(m,h))}}}isVP8Simulcast(t){var r,i,c,d,h;return!!(t instanceof ar&&Y("SIMULCAST")&&this.store.codec==="vp8"&&!Ae(r=t._hints).call(r,Zt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,i,c){if(Y("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?d=>{this.logSDPExchange(d,"answer",i==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(h=>{h.direction="inactive"});let i=await this.peerConnection.createOffer(),c=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async h=>{h.direction="sendonly"});let i=await this.peerConnection.createOffer(),c=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var i;if(r=r??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var c;let d=(c=yn(r).mediaDescriptions.find(h=>h.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),Ae(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,i){let c=yn(t),d=c.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&i===Fe.AUDIO&&d.media.mediaType==="audio"&&bh(d),Vc(c)}},Ge(or.prototype,"establish",[da],Object.getOwnPropertyDescriptor(or.prototype,"establish"),or.prototype),Ge(or.prototype,"connect",[da],Object.getOwnPropertyDescriptor(or.prototype,"connect"),or.prototype),Ge(or.prototype,"receive",[da],Object.getOwnPropertyDescriptor(or.prototype,"receive"),or.prototype),Ge(or.prototype,"mockReceive",[da],Object.getOwnPropertyDescriptor(or.prototype,"mockReceive"),or.prototype),Ge(or.prototype,"stopReceiving",[da],Object.getOwnPropertyDescriptor(or.prototype,"stopReceiving"),or.prototype),Ge(or.prototype,"restartICE",[da],Object.getOwnPropertyDescriptor(or.prototype,"restartICE"),or.prototype),Ge(or.prototype,"close",[da],Object.getOwnPropertyDescriptor(or.prototype,"close"),or.prototype),Ge(or.prototype,"updateEncoderConfig",[da],Object.getOwnPropertyDescriptor(or.prototype,"updateEncoderConfig"),or.prototype),Ge(or.prototype,"updateSendParameters",[da],Object.getOwnPropertyDescriptor(or.prototype,"updateSendParameters"),or.prototype),Ge(or.prototype,"replaceTrack",[da],Object.getOwnPropertyDescriptor(or.prototype,"replaceTrack"),or.prototype),Ge(or.prototype,"muteLocal",[da],Object.getOwnPropertyDescriptor(or.prototype,"muteLocal"),or.prototype),Ge(or.prototype,"unmuteLocal",[da],Object.getOwnPropertyDescriptor(or.prototype,"unmuteLocal"),or.prototype),or);function da(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{d()}},r}let Ha=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var j3,L3,M3,F3,U3,V3,B3,W3,G3,H3,z3,yr;function K3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Jv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?K3(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K3(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Yce=(j3=za(Ha.SEND_ONLY),L3=za(Ha.SEND_ONLY),M3=za(),F3=za(Ha.RECEIVE_ONLY),U3=za(Ha.RECEIVE_ONLY),V3=za(Ha.RECEIVE_ONLY),B3=za(Ha.RECEIVE_ONLY),W3=za(Ha.RECEIVE_ONLY),G3=za(Ha.RECEIVE_ONLY),H3=za(),z3=za(Ha.RECEIVE_ONLY),yr=class extends br{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Je.StateChange,t,this._state)}constructor(e,t){super(),W(this,"isPlanB",!1),W(this,"store",void 0),W(this,"statsUploader",void 0),W(this,"sendConnection",void 0),W(this,"recvConnection",void 0),W(this,"localTrackMap",new Map),W(this,"remoteUserMap",new Map),W(this,"localDataChannels",[]),W(this,"pendingLocalTracks",[]),W(this,"pendingRemoteTracks",[]),W(this,"statsCollector",void 0),W(this,"dtlsFailedCount",0),W(this,"sendMutex",void 0),W(this,"recvMutex",void 0),W(this,"_state",Gt.Disconnected),W(this,"_restartStates",["disconnected","failed"]),W(this,"reconnectInterval",void 0),W(this,"uploadUnplinkStarted",!1),W(this,"uploadDownlinkStarted",!1),W(this,"uplinkStateUploadInterval",void 0),W(this,"downlinkStatsUploadInterval",void 0),W(this,"handleMuteLocalTrack",async(r,i,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Gt.Connected)return void c(new he(z.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let m=this.filterTobeMutedTracks(r);if(m.length===0)return void i();let _=m.find(C=>C[0]==="videoLowTrack");_&&_[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(C=>{let[,{id:U}]=C;return U}));let E=!1;var h,p;r.trackMediaType==="video"?E=!((h=this.localTrackMap.get(Se.LocalAudioTrack))===null||h===void 0||!h.track._muted):E=((p=this.localTrackMap.get(Se.LocalVideoTrack))===null||p===void 0?void 0:p.id)===void 0;let x=this.createMuteMessage(m);await er(this,Je.RequestMuteLocal,x);let b=r.trackMediaType==="video"?Gc.MUTE_LOCAL_VIDEO:Gc.MUTE_LOCAL_AUDIO;await er(this,Je.RequestP2PMuteLocal,{action:b,message:x,isMuteAll:E}),i()}catch(m){c(m)}finally{d()}}),W(this,"handleUnmuteLocalTrack",async(r,i,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Gt.Connected)return void c(new he(z.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void i();await this.sendConnection.unmuteLocal(h.map(_=>{let[,{id:E}]=_;return E}));let p=this.createUnmuteMessage(h),m=r.trackMediaType==="video"?Gc.UNMUTE_LOCAL_VIDEO:Gc.UNMUTE_LOCAL_AUDIO;await er(this,Je.RequestP2PMuteLocal,{action:m,message:p}),i()}catch(h){c(h)}finally{d()}}),W(this,"handleUpdateVideoEncoder",async(r,i,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let m=this.localTrackMap.get(Se.LocalVideoTrack);if(!this.sendConnection||!m||m.track!==r||this.state!==Gt.Connected)return void i();let{id:_,track:E}=m;_&&(await this.sendConnection.updateSendParameters(_,E),await this.sendConnection.updateEncoderConfig(_,E),this.emit(Je.UpdateVideoEncoder,E)),i()}catch(m){c(m)}finally{var p;(p=h)===null||p===void 0||p()}}),W(this,"handleUpdateVideoSendParameters",async(r,i,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let h=this.localTrackMap.get(Se.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==r||this.state!==Gt.Connected)return void i();let{id:p,track:m}=h;p&&await this.sendConnection.updateSendParameters(p,m),i()}catch(h){c(h)}finally{d()}}),W(this,"handleReplaceTrack",async(r,i,c,d)=>{let h;N.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var p;let _=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:x}]=E;return r===x});if(!this.sendConnection||!_||_[1].id===void 0||this.state!==Gt.Connected)return void i();if(await((p=this.sendConnection)===null||p===void 0?void 0:p.replaceTrack(r,_[1].id)),_[0]===Se.LocalVideoTrack&&Dt().supportDualStreamEncoding){let E=this.localTrackMap.get(Se.LocalVideoLowTrack);if(E){let x=r._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=x,E.track._originMediaStreamTrack=x,await new je((b,C)=>{this.handleReplaceTrack(E.track,b,C,!0)})}}i()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),W(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),W(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),W(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),W(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new d5(e),this.bindStatsUploaderEvents(),this.sendMutex=new Is("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Is("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},Y("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new he(z.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new he(z.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new k3(e,this.store,rn.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Gt.New,this.sendConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new k3(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new he(z.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Gt.Connected}async addRemoteCandidate(e,t){if(t===rn.RECEIVE_ONLY){if(!this.sendConnection)throw new he(z.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new he(z.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var i=this;return xi(function*(){let c=yield Ot(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Gt.Connected){i.throwIfTrackTypeNotMatch(e);let _=e.filter(E=>i.pendingLocalTracks.indexOf(E)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(_))}i.store.pubId=i.store.pubId+1,ks.markPublishStart(i.store.clientId,i.store.pubId);let d=i.filterTobePublishedTracks(e,t,r);if(d.length===0)return void(yield Ot(i.tryToUnmuteAudio(e)));d.forEach(_=>{let{track:E,type:x}=_,b=Date.now();i.store.publish(E.getTrackId(),x===Se.LocalAudioTrack?"audio":"video",b)}),i.bindLocalTrackEvents(d);let h=yield Ot(i.sendConnection.send(d.map(_=>{let{track:E}=_;return E}),i.store.codec,i.store.audioCodec)),p=(yield Ot(h.next())).value,m=i.createGatewayPublishMessage(d,p);try{yield m}catch(_){throw h.throw(_),(_==null?void 0:_.code)===z.WS_ABORT&&d.forEach(E=>{let{track:x}=E;i.pendingLocalTracks.indexOf(x)===-1&&i.pendingLocalTracks.push(x)}),i.unbindLocalTrackEvents(d),_}yield Ot(h.next()),d.forEach(_=>{let{type:E}=_;i.statsCollector.addLocalStats(E)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(d,p),d.forEach(_=>{let{track:E,type:x}=_,b=Date.now();i.store.publish(E.getTrackId(),x===Se.LocalAudioTrack?"audio":"video",void 0,b)}),i.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Gt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!Ae(e).call(e,c)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(c=>c[0]==="videoLowTrack");r&&r[1].track.close();let i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),t.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Gt.Connected)return r&&r[1].track.close(),i;e.forEach(c=>{let d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[c,{track:d,ssrcs:h}]=i,p={stream_type:Uae(d,c),ssrcs:h};d._muted||!d._enabled?t.push(p):r.push(p)}),t.length>0&&t.forEach(i=>{er(this,Je.RequestMuteLocal,[i])}),r.length>0&&r.forEach(i=>{er(this,Je.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return xi(function*(){throw new he(z.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ss(this,Je.RequestRePublish,this.pendingLocalTracks),this.emit(Je.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new he(z.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,i){var c;if(!this.recvConnection)throw new he(z.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let{track:d,mid:h,transceiver:p}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),i);t===Fe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new ph(d,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new hh(d,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack));let m=this.remoteUserMap.get(e);m?m.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let _=this.pendingRemoteTracks.findIndex(E=>{let{user:x,kind:b}=E;return x.uid===e.uid&&t===b});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Je.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,i){if(!this.recvConnection)throw new he(z.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),i)}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:p}=d;return t!==void 0?h.uid===e.uid&&t===p:h.uid===e.uid});if(i.forEach(d=>{let h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||r||i.forEach(d=>{let{kind:h}=d;var p;if(h===Fe.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===Fe.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:p}]=d;var m,_;if(p===Fe.VIDEO&&h._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===Fe.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),r||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(p===Fe.AUDIO){var E;this.unbindRemoteTrackEvents(h._audioTrack),!r&&((E=h._audioTrack)===null||E===void 0||E._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;er(this,Je.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[Fe.VIDEO,Fe.AUDIO].forEach(i=>{r.has(i)?er(this,Je.RequestP2PUnmuteRemote,i):er(this,Je.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new he(z.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new he(z.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new he(z.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new he(z.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===Fe.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(Se.LocalAudioTrack);if((t==null?void 0:t.track)instanceof qr){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[c]=i;return c!==Se.LocalAudioTrack}).filter(i=>{let[c]=i;return!(e&&c===Se.LocalVideoLowTrack)}).map(i=>{let[,{track:c}]=i;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return!(e&&i===Se.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i})}reportPublishEvent(e,t,r,i,c){if(e){let h=this.localTrackMap.get(Se.LocalAudioTrack),p=i?this.localTrackMap.get(Se.LocalVideoLowTrack):this.localTrackMap.get(Se.LocalVideoTrack);ze.publish(this.store.sessionId,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(Zt.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;r||(r=[]);let h=r.find(m=>m instanceof Ar),p=i?(d=this.localTrackMap.get(Se.LocalVideoTrack))===null||d===void 0?void 0:d.track:r.find(m=>m instanceof ar);ze.publish(this.store.sessionId,{eventElapse:ks.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(Zt.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,i){let c=i===Fe.VIDEO?r._videoSSRC:r._audioSSRC;c&&ze.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Fe.VIDEO,audio:i===Fe.AUDIO,peerid:r.uid,subscribeRequestid:i===Fe.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:ks.measureFromSubscribeStart(this.store.clientId,c)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Is("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Is("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Se.LocalAudioTrack);if((e==null?void 0:e.track)instanceof qr){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Gt.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Se.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Se.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof ar||t&&t.track instanceof Ar?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(xn(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[i]=r;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Se.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ql(e).call(e,(r,i)=>r.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Gt.Reconnecting,Y("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:i}]=e;switch(r){case Se.LocalVideoTrack:Ae(t=i._hints).call(t,Zt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case Se.LocalAudioTrack:i instanceof qr?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case Se.LocalVideoLowTrack:}}),this.emit(Je.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(xn(r).call(r)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Je.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:c}=r;if((e instanceof Xc?e.uid:e)===i.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,i;if(e===rn.SEND_ONLY){if(!this.sendConnection)throw new he(z.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new he(z.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){let c=await i.restartICE(t);return i.isInRestartIce=!1,c}{let c=await i.restartICE();if(c){let d=await Ss(this,Je.RequestP2PRestartICE,{direction:rn.RECEIVE_ONLY,iceParameter:c});await i.restartICE(d),i.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(Se.LocalVideoTrack),r=this.localTrackMap.get(Se.LocalAudioTrack),i=e.videoSend.find(C=>{var U;return C.ssrc===(t==null||(U=t.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)}),c=e.audioSend.find(C=>{var U;return C.ssrc===(r==null||(U=r.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)});if(!i||!c)return 1;let d=ri(this,Je.NeedSignalRTT),h=i?i.rttMs:void 0,p=c?c.rttMs:void 0,m=h&&p?(h+p)/2:h||p,_=(m&&d?(m+d)/2:m||d)||0,E=100*e.sendPacketLossRate*.7/50+.3*_/1500,x=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,b=t==null?void 0:t.track;if(b&&b._encoderConfig&&b._hints.indexOf(Zt.SCREEN_TRACK)===-1){let C=b._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(C&&U){let k=(1e3*C-U)/(1e3*C);return eU[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][x]}}return x}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,c=i._audioSSRC,d=i._videoSSRC,h=e.audioRecv.find(U=>U.ssrc===c),p=e.videoRecv.find(U=>U.ssrc===d);if(!h&&!p)return void(t+=1);let m=ri(this,Je.NeedSignalRTT),_=e.rtt,E=(_&&m?(_+m)/2:_||m)||0,x=h?h.jitterMs:void 0,b=e.recvPacketLossRate,C=.7*b*100/50+.3*E/1500;x&&(C=.6*b*100/50+.2*E/1500+.2*x/400),t+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new je((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){let i=[],c=Dt(),d=this.getAllTracks();e=Zu(e=e.filter(m=>d.indexOf(m)===-1));let h=!1,p=!1;for(let m of e){if(m instanceof ar&&(this.localTrackMap.has(Se.LocalVideoTrack)||h?new he(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:m,type:Se.LocalVideoTrack}),h=!0),t)){let _=this.getLowVideoTrack(m,r);i.push({track:_,type:Se.LocalVideoLowTrack})}if(m instanceof Ar){let _=this.localTrackMap.get(Se.LocalAudioTrack);if(_){if(!(_.track instanceof qr))throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(p){let E=i.find(x=>{let{type:b}=x;return b===Se.LocalAudioTrack});if(!(E.track instanceof qr))throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(m)}else{if(!c.webAudioMediaStreamDest||m instanceof qr||m._bypassWebAudio)i.push({track:m,type:Se.LocalAudioTrack});else{let E=new qr;E.addAudioTrack(m),i.push({track:E,type:Se.LocalAudioTrack})}p=!0}}}return i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=Zu(e=e.filter(i=>r.indexOf(i)!==-1));for(let i of e){if(i instanceof Ar){let c=this.localTrackMap.get(Se.LocalAudioTrack);if(!c)continue;c.track instanceof qr?(c.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),c.track.trackList.length===0&&(t.push([Se.LocalAudioTrack,c]),c.track.close())):t.push([Se.LocalAudioTrack,c])}if(i instanceof ar){let c=this.localTrackMap.get(Se.LocalVideoTrack);if(!c)continue;t.push([Se.LocalVideoTrack,c]);let d=this.localTrackMap.get(Se.LocalVideoLowTrack);d&&t.push([Se.LocalVideoLowTrack,d])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:i}=t;switch(i){case Se.LocalVideoTrack:r.addListener(Be.GET_STATS,this.handleGetLocalVideoStats),r.addListener(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(Be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Se.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Se.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof qr?e.trackList.forEach(r=>{r.addListener(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(Be.GET_STATS,this.handleGetLocalAudioStats),r.addListener(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Be.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:i}]=t;return{track:i,type:r}})),e.forEach(t=>{let{track:r,type:i}=t;switch(i){case Se.LocalVideoTrack:r.off(Be.GET_STATS,this.handleGetLocalVideoStats),r.off(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(Be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Se.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Se.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof qr?e.trackList.forEach(t=>{t.off(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Be.GET_STATS,this.handleGetLocalAudioStats),t.off(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Be.GET_STATS,this.handleGetLocalAudioStats),e.off(Be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof hh&&t.addListener(Be.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof ph&&t.addListener(Be.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Be.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Fe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Fe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,i)=>{var c;let d,{track:h,type:p}=r;switch(p){case Se.LocalAudioTrack:d=zt.Audio;break;case Se.LocalVideoTrack:d=Ae(c=h._hints).call(c,Zt.SCREEN_TRACK)?zt.Screen:zt.High;break;case Se.LocalVideoLowTrack:d=zt.Low}return{kind:p===Se.LocalAudioTrack?Fe.AUDIO:Fe.VIDEO,stream_type:d,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let i,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Se.LocalVideoTrack:i=Ae(r=d._hints).call(r,Zt.SCREEN_TRACK)?zt.Screen:zt.High;break;case Se.LocalAudioTrack:i=zt.Audio;break;case Se.LocalVideoLowTrack:i=zt.Low}return{stream_type:i,ssrcs:h,mid:p}})}assignLocalTracks(e,t){e.forEach((r,i)=>{let{track:c,type:d}=r;this.localTrackMap.set(d,{track:c,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Je.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ae(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await hs(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ze.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Er.TRACER}).onSuccess(),this.emit(Je.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(d=>d._audioSSRC===t);var c;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(c=i.audioTrack)===null||c===void 0||c.emit(Si.FIRST_FRAME_DECODED),ze.firstRemoteFrame(this.store.sessionId,Qr.FIRST_AUDIO_DECODE,_r.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);i&&ze.firstRemoteFrame(this.store.sessionId,Qr.FIRST_AUDIO_RECEIVED,_r.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,i)=>{this.reportVideoFirstFrameDecoded(t,r,i)},e.onFirstVideoReceived=t=>{var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);i&&ze.firstRemoteFrame(this.store.sessionId,Qr.FIRST_VIDEO_RECEIVED,_r.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let i=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&i===c||this.emit(Je.ConnectionTypeChange,i),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(zc(r))," -> ").concat(JSON.stringify(zc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(zc(r))," -> ").concat(JSON.stringify(zc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Je.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===rn.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,N.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===rn.SEND_ONLY?this.restartICE(e):Ss(this,Je.RequestP2PRestartICE,{direction:rn.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(Se.LocalAudioTrack);if(e instanceof Ar&&(r==null?void 0:r.track)instanceof qr)return r.track.isActive||t.push([Se.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(i&&(t.push(i),i[0]===Se.LocalVideoTrack)){let c=this.localTrackMap.get(Se.LocalVideoLowTrack);c&&t.push([Se.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(Se.LocalAudioTrack);if(e instanceof Ar&&(r==null?void 0:r.track)instanceof qr)return r.track.isActive&&t.push([Se.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(i)if(i[0]===Se.LocalVideoTrack){t.push(i);let c=this.localTrackMap.get(Se.LocalVideoLowTrack);c&&t.push([Se.LocalVideoLowTrack,c])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var r;let i,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Se.LocalAudioTrack:i=zt.Audio;break;case Se.LocalVideoTrack:i=Ae(r=d._hints).call(r,Zt.SCREEN_TRACK)?zt.Screen:zt.High;break;case Se.LocalVideoLowTrack:i=zt.Low}return{stream_type:i,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var r;let i,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Se.LocalAudioTrack:i=zt.Audio;break;case Se.LocalVideoTrack:i=Ae(r=d._hints).call(r,Zt.SCREEN_TRACK)?zt.Screen:zt.High;break;case Se.LocalVideoLowTrack:i=zt.Low}return{stream_type:i,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let c=i.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(i.entries()).forEach(c=>{let[d,h]=c;r.push([e,{kind:d,id:h}])});return r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[i,{kind:c,id:d}]=r;switch(c){case Fe.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Fe.VIDEO,ssrcId:i._videoSSRC}));case Fe.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Fe.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:i}]=t,c=this.remoteUserMap.get(r);c&&(c.delete(i),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Se.LocalVideoTrack),r=this.localTrackMap.get(Se.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new je((i,c)=>{this.handleUpdateVideoEncoder(t.track,i,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new je((i,c)=>{this.handleUpdateVideoEncoder(r.track,i,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Ar){let r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;let i=this.createUnmuteMessage(r);return void await er(this,Je.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Je.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Je.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await hs(T0(this.dtlsFailedCount,Gr)),this.emit(Je.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Se.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ar)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof ar).length>1)throw new he(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ar).length>1&&(e.some(t=>t instanceof Ar&&t._bypassWebAudio)||!Dt().webAudioMediaStreamDest))throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof ar&&this.pendingLocalTracks.some(r=>r instanceof ar))throw new he(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ar&&this.pendingLocalTracks.some(r=>r instanceof Ar)&&(!Dt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Ar&&r._bypassWebAudio)))throw new he(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!Y("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dt().supportDualStreamEncoding,i=Jv(Jv({},{width:160,height:120,framerate:15,bitrate:50}),t),c;c=r?e._mediaStreamTrack.clone():WC(e,i);let d=tr(8,"track-low-"),h=new ar(c,Jv(Jv({},r&&{scaleResolutionDownBy:bC(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,d);return h.on(dd.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,ah.LOW_STREAM)}),h._hints.push(Zt.LOW_STREAM),e.addListener(Be.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,i){var c;let d=Array.from(xn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(d){i||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());let h=this.store.keyMetrics,p=h.subscribe.find(m=>m.userId===d.uid&&m.type==="video");ze.firstRemoteVideoDecode(this.store.sessionId,Qr.FIRST_VIDEO_DECODE,_r.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:r,subscribeElapse:ks.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let c=i.get(t);if(!c)return!1;let d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new he(z.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new he(z.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new he(z.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new he(z.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new he(z.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new he(z.NOT_SUPPORTED)}async preConnect(e){throw new he(z.NOT_SUPPORTED)}getEstablishParams(){throw new he(z.NOT_SUPPORTED)}async reSubscribe(e){throw new he(z.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new he(z.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Se.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,ah.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Ge(yr.prototype,"p2pConnect",[j3],Object.getOwnPropertyDescriptor(yr.prototype,"p2pConnect"),yr.prototype),Ge(yr.prototype,"unpublish",[L3],Object.getOwnPropertyDescriptor(yr.prototype,"unpublish"),yr.prototype),Ge(yr.prototype,"unpublishLowStream",[M3],Object.getOwnPropertyDescriptor(yr.prototype,"unpublishLowStream"),yr.prototype),Ge(yr.prototype,"subscribe",[F3],Object.getOwnPropertyDescriptor(yr.prototype,"subscribe"),yr.prototype),Ge(yr.prototype,"mockSubscribe",[U3],Object.getOwnPropertyDescriptor(yr.prototype,"mockSubscribe"),yr.prototype),Ge(yr.prototype,"unsubscribe",[V3],Object.getOwnPropertyDescriptor(yr.prototype,"unsubscribe"),yr.prototype),Ge(yr.prototype,"muteRemote",[B3],Object.getOwnPropertyDescriptor(yr.prototype,"muteRemote"),yr.prototype),Ge(yr.prototype,"unmuteRemote",[W3],Object.getOwnPropertyDescriptor(yr.prototype,"unmuteRemote"),yr.prototype),Ge(yr.prototype,"hasRemoteMediaWithLock",[G3],Object.getOwnPropertyDescriptor(yr.prototype,"hasRemoteMediaWithLock"),yr.prototype),Ge(yr.prototype,"disconnectForReconnect",[H3],Object.getOwnPropertyDescriptor(yr.prototype,"disconnectForReconnect"),yr.prototype),Ge(yr.prototype,"remoteMediaSsrcChanged",[z3],Object.getOwnPropertyDescriptor(yr.prototype,"remoteMediaSsrcChanged"),yr.prototype),yr);function za(e){return function(t,r,i){let c=t[r];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(e){case Ha.SEND_ONLY:{let m=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{m()}}case Ha.RECEIVE_ONLY:{let m=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{m()}}default:{let m=await this.sendMutex.lock("From P2PChannel2.".concat(r)),_=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{m(),_()}}}},i}}class Nd extends br{constructor(t,r){super(),W(this,"signal",void 0),W(this,"token",void 0),W(this,"tokenTimeout",void 0),W(this,"tokenInterval",void 0),W(this,"_sequence",0),W(this,"userMap",new Map),W(this,"encoder",new TextEncoder),this.signal=t,this.token=r;let i=()=>{this.signal.connectionState===ir.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*Y("P2P_TOKEN_INTERVAL"))};i()}async send(t,r,i,c,d){var h;if(this.userMap.size===0)return;let p=Array.from(Ln(h=this.userMap).call(h))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),c=c??tr(6,""),d=d??this._sequence++;let m={_id:c,_type:t,_seq:d,_message:r,token:"".concat(this.token,"_").concat(p)};Y("SHOW_P2P_LOG")&&N.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(E=>{this.signal.request(it.DATA_STREAM,{payload:Uc(this.encoder.encode(E))})});let _=new je((E,x)=>{let b=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),k),this.off(Eh.ABORT,U),N.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?x(new he(z.INVALID_REMOTE_USER)):x(new he(z.TIMEOUT))},Y("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{b&&window.clearTimeout(b),this.off(Eh.ABORT,U),i&&E()},U=()=>{b&&window.clearTimeout(b),this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),k),x(new he(z.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(Eh.ABORT,U),this.once("res-@".concat(c,"_ack"),C);let k=(H,K)=>{M=!0,b&&window.clearTimeout(b),this.off("res-@".concat(c,"_ack"),C),this.off(Eh.ABORT,U),H==="success"?E(K):x(new he(z.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))},M=!1;i||(this.once("res-@".concat(c),k),hs(Y("SIGNAL_REQUEST_TIMEOUT")).then(()=>{M||N.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(m))}))});try{return await _}catch(E){if(E.code===z.TIMEOUT)return await this.send(t,r,i,c,d);throw E}}onMessage(t){var r;let{_uid:i}=t,c,d=this.userMap.get(i);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==kr.CHECK)return;let{token:_}=t;c=new Map,d={uid:i,isStart:!0,token:_,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,d),this.signal.emit(St.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var h;let{id:_,total:E}=t,x=(h=c.get(_))!==null&&h!==void 0?h:[];if(x.push(t),c.has(_)||c.set(_,x),x.length!==E)return;{let b=Ql(x).call(x,(C,U)=>C.index-U.index).map(C=>C.payload).join("");c.delete(_),(t=JSON.parse(b))._uid=i}}let{_type:p,token:m}=t;if(Ae(r=[kr.ACK,kr.CHECK]).call(r,p))return p===kr.CHECK&&this.handleCheckToken(d,m),void this.receiveMessage(t);m==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(t):N.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(d.token,"_").concat(this.token),t)}check(){let t={_id:tr(6,""),token:this.token,_type:kr.CHECK};Y("SHOW_P2P_LOG")&&N.debug("send message",t),this.signal.request(it.DATA_STREAM,{payload:Uc(this.encoder.encode(JSON.stringify(t)))})}ack(t){let r={_id:t,_type:kr.ACK,token:this.token};Y("SHOW_P2P_LOG")&&N.debug("send message",r),this.signal.request(it.DATA_STREAM,{payload:Uc(this.encoder.encode(JSON.stringify(r)))})}response(t,r,i){this.send(kr.RESPONSE,JSON.stringify({success:!i,message:r}),!0,t)}handleReceivedMessage(t){let r=()=>{this.userMap.forEach(_=>{let{receivedMessagesMap:E,nextExpectedSequenceNumber:x}=_;for(;E.has(x);){let b=E.get(x);E.delete(x),this.receiveMessage(b),_.nextExpectedSequenceNumber++}})};if(!t)return void r();let{_uid:i,_seq:c}=t,d=this.userMap.get(i),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=d;if(c<m)return this.ack(t._id),void N.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));h.set(c,t),p&&c===m&&(this.receiveMessage(t),h.delete(m),d.nextExpectedSequenceNumber++,r())}receiveMessage(t){let{_id:r,_type:i,_message:c,_uid:d}=t;if(Y("SHOW_P2P_LOG")&&N.debug("receive message",t),r){let h;switch(t._type!==kr.ACK&&(c&&(h=JSON.parse(c)),this.ack(t._id)),t._type){case kr.CANDIDATE:case kr.CONTROL:this.signal.emit(i,h,d);break;case kr.PUBLISH:case kr.UNPUBLISH:case kr.RESTART_ICE:case kr.CALL:h.uid=d,Ss(this.signal,i,h).then(p=>{this.response(t._id,p)}).catch(()=>{this.response(t._id,void 0,!0)});break;case kr.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case kr.RESPONSE:{let{success:p,message:m}=h;this.emit("res-@".concat(r),p?"success":"failed",m);break}}}}splitMessage(t){if(t.length<Nd.MAX_MESSAGE_SIZE)return[t];let r=[],{remoteToken:i}=JSON.parse(t),c=tr(6,""),d=0,h=800,p=Math.ceil(t.length/h);for(;t.length>0;){d++;let m={id:c,index:d,total:p,payload:t.slice(0,h),token:"".concat(this.token,"_").concat(i)};JSON.stringify(m).length>Nd.MAX_MESSAGE_SIZE?h-=50:(r.push(m),t=t.slice(h))}return r.map(m=>JSON.stringify(m))}handleCheckToken(t,r){return t.token!==r?(N.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{N.debug("token timeout, ".concat(r)),this.reset(t.uid)},Y("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await Ss(this.signal,kr.CALL,void 0),r=await this.send(kr.CALL,t);this.signal.emit(ot.P2P_CONNECTION,r,!0)}async reset(t,r){let i=this.userMap.get(t);i&&(this.emit(Eh.ABORT),this.signal.emit(St.ON_USER_OFFLINE,{uid:i.uid,reason:pae.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(N.debug("change local token from ".concat(r," to ").concat(r)),this.token=tr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Eh.ABORT)}}W(Nd,"MAX_SIZE",1),W(Nd,"MAX_MESSAGE_SIZE",1024);class $ce extends br{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ir.CONNECTED?this.emit(ot.WS_CONNECTED):t===ir.RECONNECTING?this.emit(ot.WS_RECONNECTING,this._websocketReconnectReason):t===ir.CLOSED&&this.emit(ot.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),W(this,"_disconnectedReason",void 0),W(this,"_websocketReconnectReason",void 0),W(this,"_connectionState",ir.CLOSED),W(this,"reconnectToken",void 0),W(this,"p2pToken",void 0),W(this,"websocket",void 0),W(this,"openConnectionTime",void 0),W(this,"clientId",void 0),W(this,"lastMsgTime",Date.now()),W(this,"uploadCache",[]),W(this,"uploadCacheInterval",void 0),W(this,"rttRolling",new b2(5)),W(this,"pingpongTimer",void 0),W(this,"pingpongTimeoutCount",0),W(this,"joinResponse",void 0),W(this,"multiIpOption",void 0),W(this,"initError",void 0),W(this,"spec",void 0),W(this,"store",void 0),W(this,"_external_signal",void 0),W(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ot.ON_BINARY_DATA,i.data);let c=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case St.ON_DATA_STREAM:return void this.handleDataStream(c._message);case St.MUTE_AUDIO:case St.MUTE_VIDEO:case St.ON_P2P_LOST:case St.ON_USER_ONLINE:return;case St.ON_USER_OFFLINE:let{uid:d}=c._message;return N.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===St.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===St.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Wt.UID_BANNED);break;case 15:this.close(Wt.IP_BANNED);break;case 16:this.close(Wt.CHANNEL_BANNED)}if(c._type===St.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case tt.ERR_LICENSE_MISSING:this.close(Wt.LICENSE_MISSING);break;case tt.ERR_LICENSE_EXPIRED:this.close(Wt.LICENSE_EXPIRED);break;case tt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Wt.LICENSE_MINUTES_EXCEEDED);break;case tt.ERR_LICENSE_PERIOD_INVALID:this.close(Wt.LICENSE_PERIOD_INVALID);break;case tt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Wt.LICENSE_MULTIPLE_SDK_SERVICE);break;case tt.ERR_LICENSE_ILLEGAL:this.close(Wt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new yC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Y("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Y("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ir.CONNECTED&&this.reconnect("retry",ws.OFFLINE)}),this.p2pToken=tr(6,""),this._external_signal=new Nd(this,this.p2pToken)}async request(t,r,i,c){let d=tr(6,""),h={_id:d,_type:t,_message:r},p=this.websocket.connectionID,m=()=>new je((U,k)=>{if(this.connectionState===ir.CONNECTED)return U();let M=()=>{this.off(ot.WS_CLOSED,H),U()},H=()=>{this.off(ot.WS_CONNECTED,M),k(new he(z.WS_ABORT))};this.once(ot.WS_CONNECTED,M),this.once(ot.WS_CLOSED,H)});if(this.connectionState!==ir.CONNECTING&&this.connectionState!==ir.RECONNECTING||t===it.JOIN||t===it.REJOIN||await m(),this.websocket.sendMessage(h,!0),c)return;let _=new je((U,k)=>{let M=!1,H=(X,se)=>{M=!0,U({isSuccess:X==="success",message:se||{}}),this.off(ot.WS_CLOSED,K),this.off(ot.WS_RECONNECTING,K),this.emit(ot.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(d),H);let K=()=>{k(new he(z.WS_ABORT,"type: ".concat(t))),this.off(ot.WS_CLOSED,K),this.off(ot.WS_RECONNECTING,K),this.off("res-@".concat(d),H)};this.once(ot.WS_CLOSED,K),this.once(ot.WS_RECONNECTING,K),hs(Y("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||M||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ot.REQUEST_TIMEOUT,t,r))})}),E=null;try{E=await _}catch(U){if(this.connectionState===ir.CLOSED||t===it.LEAVE)throw new he(z.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?U.throw():t===it.JOIN||t===it.REJOIN?null:(await m(),await this.request(t,r))}if(E.isSuccess)return E.message;let x=Number(E.message.error_code||E.message.code),b=Yf(x),C=new he(z.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(E.message.error_str),{code:x,data:E.message,desc:b.desc});return b.action==="success"?E.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(x,", message: ").concat(b.desc,", action: ").concat(b.action)),x===tt.ERR_TOO_MANY_BROADCASTERS?((t===it.JOIN||t===it.REJOIN)&&(this.initError=C,this.close()),C.throw()):b.action==="failed"?C.throw():b.action==="quit"?(this.initError=C,this.close(),C.throw()):(x===tt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ws.MULTI_IP)):this.reconnect(b.action,ws.SERVER_ERROR),t===it.JOIN||t===it.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new je(i=>{let c=d=>{(!r||r(d))&&(this.off(t,c),i(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Kf.WRTC_STATS,r)}upload(t,r){let i={_type:t,_message:r};try{this.websocket.sendMessage(i)}catch{let c=Y("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ir.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},Y("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let i={_type:t,_message:r};this.websocket.sendMessage(i)}async sendExtensionMessage(t,r,i){return await this._external_signal.send(t,r,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new je((r,i)=>{this.once(ot.WS_CONNECTED,()=>r(this.joinResponse)),this.once(ot.WS_CLOSED,()=>i(this.initError||new he(z.WS_ABORT))),this.connectionState=ir.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Wt.LEAVE,this.connectionState=ir.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=tr(6,""),this._external_signal.clear(),this._external_signal=new Nd(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ot.ABORT_P2P_EXECUTION);let t=await Ss(this,ot.REQUEST_JOIN_INFO),r=await this.request(it.JOIN,t);if(!r)return this.emit(ot.REPORT_JOIN_GATEWAY,z.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(ot.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ir.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){return!1}handleDataStream(t){try{var r;let i=od(t.payload),c=new TextDecoder().decode(i),d=JSON.parse(c);"total"in d&&"id"in d||Ae(r=Object.values(kr)).call(r,d._type)?(d._uid=t.uid,this._external_signal.onMessage(d)):this.emit(St.ON_DATA_STREAM,t)}catch{this.emit(St.ON_DATA_STREAM,t)}}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);let r=Yf(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Wt.UID_BANNED),void this.close()):void this.reconnect(r.action,ws.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=Y("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>Y("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ws.TIMEOUT):this.request(it.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-r;this.rttRolling.add(i),Y("REPORT_STATS")&&this.send(it.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(pt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ot.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(pt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pt.CLOSED,()=>{this.connectionState=ir.CLOSED}),this.websocket.on(pt.FAILED,()=>{this._disconnectedReason=Wt.NETWORK_ERROR,this.connectionState=ir.CLOSED}),this.websocket.on(pt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ir.CONNECTED?this.connectionState=ir.RECONNECTING:this.connectionState=ir.CONNECTING}),this.websocket.on(pt.WILL_RECONNECT,(t,r,i)=>{t!=="retry"?(N.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):N.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(pt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ot.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof he&&t.code===z.UNEXPECTED_RESPONSE&&t.data.code===tt.ERR_NO_AUTHORIZED)return N.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ws.SERVER_ERROR);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ws.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(pt.REQUEST_NEW_URLS,(t,r)=>{Ss(this,ot.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let Xce={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new Yce(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new $ce(r,t)}};function q3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Y3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q3(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q3(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}class Jce{constructor(t){W(this,"sessionDesc",void 0),W(this,"localCapabilities",void 0),W(this,"rtpCapabilities",void 0),W(this,"candidates",void 0),W(this,"_originCandidates",void 0),W(this,"iceParameters",void 0),W(this,"dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname",void 0),t=vr(t);let{iceParameters:r,dtlsParameters:i,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:p,sdkCodec:m,cname:_}=t,E=yn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=vr(c),this.iceParameters=r,this.dtlsParameters=i,this.setup=h,this.localCapabilities=p,this.cname=_;for(let x=0;x<E.mediaDescriptions.length;x++){let b=E.mediaDescriptions[x];if(b.attributes.iceUfrag=r.iceUfrag,b.attributes.icePwd=r.icePwd,b.attributes.fingerprints=i.fingerprints,b.attributes.candidates=c,b.attributes.setup=h,b.media.mediaType==="video"){b.media.fmts=d.videoCodecs.map(k=>k.payloadType.toString(10));let C=d.videoCodecs.filter(k=>{var M,H;return(M=k.rtpMap)===null||M===void 0?void 0:Ae(H=M.encodingName.toLowerCase()).call(H,m)}),U=d.videoCodecs.filter(k=>!Ae(C).call(C,k));b.attributes.payloads=[...C,...U],b.attributes.extmaps=d.videoExtensions}b.media.mediaType==="audio"&&(b.media.fmts=d.audioCodecs.map(C=>C.payloadType.toString(10)),b.attributes.payloads=d.audioCodecs,b.attributes.extmaps=d.audioExtensions),E.mediaDescriptions[x]=this.mungMediaDesc(b)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Vc(this.sessionDesc)}send(t,r,i){let{ssrcs:c,ssrcGroups:d}=Qf(r,this.cname),h=this.sessionDesc.mediaDescriptions.find(_=>t===Fe.VIDEO?_.media.mediaType==="video":_.media.mediaType==="audio"),p=c[0].attributes.label,m=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:p,mslabel:m}}batchSend(t){return t.map(r=>{let{kind:i,ssrcMsg:c}=r;return this.send(i,c,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(r=>{let i=[],c=[],d=[];r.attributes.ssrcs.forEach(h=>{Ae(t).call(t,h.attributes.label||"")?d.push(h):i.push(h)}),r.attributes.ssrcGroups.forEach(h=>{var p;Ae(p=d.map(m=>m.ssrcId)).call(p,h.ssrcIds[0])||c.push(h)}),r.attributes.ssrcs=i,r.attributes.ssrcGroups=c})}mute(t){let r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){let r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,i){t.forEach((c,d)=>{let h=c._mediaStreamTrack,p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===h.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],c);this.sessionDesc.mediaDescriptions[p]=m})}stopReceiving(t){}updateCandidates(t){let r=this._originCandidates.filter(c=>c.transport==="udp"),i=[];if(r.forEach(c=>{i.push(Y3(Y3({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),r.length!==0){switch(t){case Ps.TCP_RELAY:this.candidates=i;break;case Ps.UDP_TCP_RELAY:case Ps.RELAY:this.candidates=[...r,...i];break;default:this.candidates=r}for(let c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=vr(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}mungRecvMediaDsec(t,r){let i=vr(t);return xh(i,r),SC(i,r),i}updateRecvMedia(t,r){let i=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===t);if(i!==-1){let c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,i){let c=this.sessionDesc.mediaDescriptions.find(h=>t===Fe.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){let h=c.attributes.ssrcs.find(p=>p.attributes.label===r);var d;h&&(h.attributes.label=i,(d=h.attributes.msid)===null||d===void 0||d.replace(r,i))}}mungMediaDesc(t){let r=vr(t);return wC(r),function(i){let c=i.attributes.extmaps.find(d=>hv(d.extensionName));c&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(c),1),i.attributes.payloads.forEach(d=>{let h=d.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(r),r}getSSRC(t){for(let r of this.sessionDesc.mediaDescriptions)for(let i of r.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var rr;function $3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Qv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$3(Object(r),!0).forEach(function(i){W(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$3(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}let Qce=(rr=class Ym extends lU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Ae(r=Object.keys(Bf)).call(r,t)}))]}constructor(t,r){super(t,r),W(this,"store",void 0),W(this,"peerConnection",void 0),W(this,"remoteSDP",void 0),W(this,"initialOffer",void 0),W(this,"statsFilter",void 0),W(this,"useRTX",!1),W(this,"localCapabilities",void 0),W(this,"localCandidateCount",0),W(this,"allCandidatesReceived",!1),W(this,"establishPromise",void 0),W(this,"mutex",void 0),this.store=r,this.mutex=new Is("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Ym.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=D0(this.peerConnection,Y("STATS_UPDATE_INTERVAL"),void 0,Sr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=Kc(t.sdp),i=Jf(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:Y("FILTER_VIDEO_FEC"),filterAudioFec:Y("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,Qv(Qv({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new he(z.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Jce(Qv(Qv({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new he(z.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var i=this;return xi(function*(){let c=yield Ot(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=t.map(b=>i.peerConnection.addTrack(b._mediaStreamTrack)),h=yield Ot(i.peerConnection.createOffer()),p=yn(h.sdp),m=t.map(b=>{let C=b._mediaStreamTrack,U=p.mediaDescriptions.find(k=>k.attributes.mid===C.kind);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return function(k,M,H){let K=k.attributes.ssrcs.filter(se=>se.attributes.label===M),X=k.attributes.ssrcGroups;if(K.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(X&&K.length>1){let se=X.find(te=>te.ssrcIds.indexOf(K[0].ssrcId)!==-1);return se?[{ssrcId:se.ssrcIds[0],rtx:H?se.ssrcIds[1]:void 0}]:[{ssrcId:K[0].ssrcId}]}return[{ssrcId:K[0].ssrcId}]}(U,C.id,i.useRTX)}),_;try{_=yield m}catch(b){throw d.forEach(C=>{bs()&&C.replaceTrack(null),i.peerConnection.removeTrack(C)}),b}let E=i.mungSendOfferSDP(h.sdp,t);i.remoteSDP.receive(t,r,_);let x=i.remoteSDP.toString();return yield Ot(i.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Ot(i.applySendEncodings(d,t)),yield Ot(i.peerConnection.setRemoteDescription({type:"answer",sdp:x})),t.map((b,C)=>{let U=b._mediaStreamTrack.id;return{localSSRC:m[C],id:U}})}catch(d){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getSenders().filter(d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{bs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});let i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,i,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:d,mslabel:h}=this.remoteSDP.send(t,r,c),p=new je((E,x)=>{let b=setTimeout(()=>{x(new Error("Cannot receive track, id: ".concat(d)))},1e4),C=U=>{let k=Rt();if((k.name==="Safari"&&Number(k.version)===11||Bs())&&U.track.id!==d&&U.streams[0].id===h){var M;let H=U.streams[0].getTracks()[0];return(M=this.remoteSDP)===null||M===void 0||M.updateTrackLabel(t,d,U.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(b),void E(H)}if(U.track.id===d)return this.peerConnection.removeEventListener("track",C),clearTimeout(b),void E(U.track)};this.peerConnection.addEventListener("track",C)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});let _=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(_),{track:await p,id:d}}catch(d){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(i=>{var c;return t.indexOf(((c=i.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(i=>{if(bs()&&i.track)i.track.enabled=!1;else{let c=i.getParameters();c.encodings.forEach(d=>d.active=!1),i.setParameters(c)}})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async d=>{if(bs()&&d.track)d.track.enabled=!0;else{let h=d.getParameters();h.encodings.forEach(p=>p.active=!0),await d.setParameters(h)}});let i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return xi(function*(){let i=yield Ot(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=Dt().supportPCSetConfiguration;if(t===Ps.RELAY&&!c)return;if(c){let _=r.peerConnection.getConfiguration(),E=t===Ps.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(N.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,r.peerConnection.setConfiguration(_))}t!==Ps.RELAY&&r.remoteSDP.updateCandidates(t);let d=yield Ot(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let h=Kc(d.sdp),{remoteIceParameters:p}=yield h.iceParameters;r.remoteSDP.restartICE(p);let m=r.remoteSDP.toString();yield Ot(r.peerConnection.setLocalDescription(d)),yield Ot(r.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(c){N.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let i=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(i.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);let d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new he(z.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){let i=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===t});i.length===1&&await this.applySendEncodings(i,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let i=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new he(z.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new he(z.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Y("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Lf(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Ym.turnServerConfigToIceServers(t.turnServer.servers)),Y("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Ym.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(i=>{i.security?i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var i;if(r||(r=this.peerConnection.getSenders().find(_=>{var E;return((E=_.track)===null||E===void 0?void 0:E.id)===t._mediaStreamTrack.id})),!r)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Dt().supportSetRtpSenderParameters)return N.warn("Browser not support set rtp-sender parameters");let c={},d={};if(t instanceof ar)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(Y("DSCP_TYPE")&&ec()){var h;let _=Y("DSCP_TYPE");Ae(h=["very-low","low","medium","high"]).call(h,_)&&(d.networkPriority=_)}let p=r.getParameters(),m=(i=p.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,d),Object.assign(p,c),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await r.setParameters(p)}async applySendEncodings(t,r){try{if(!Dt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let i=0;i<t.length;i++){let c=t[i],d=r[i];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){let i=yn(t);return r.forEach((c,d)=>{let h=c._mediaStreamTrack,p=i.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&xh(p,c)}),Vc(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let r=this.remoteSDP.batchSend(t).map((d,h)=>{let{id:p,mslabel:m}=d,{kind:_}=t[h];return new je((E,x)=>{let b=setTimeout(()=>{x(new Error("Cannot receive track, id: ".concat(p)))},1e4),C=U=>{let k=Rt();if(k.name==="Safari"&&Number(k.version)===11&&U.track.id!==p&&U.streams[0].id===m){var M;let H=U.streams[0].getTracks()[0];return(M=this.remoteSDP)===null||M===void 0||M.updateTrackLabel(_,p,U.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(b),void E({track:H,id:p})}if(U.track.id===p)return this.peerConnection.removeEventListener("track",C),clearTimeout(b),void E({track:U.track,id:p})};this.peerConnection.addEventListener("track",C)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await je.all(r)}catch(r){throw new he(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(Dt().supportPCSetConfiguration){let r=Ym.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},Ge(rr.prototype,"connect",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"connect"),rr.prototype),Ge(rr.prototype,"stopSending",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"stopSending"),rr.prototype),Ge(rr.prototype,"receive",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"receive"),rr.prototype),Ge(rr.prototype,"stopReceiving",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"stopReceiving"),rr.prototype),Ge(rr.prototype,"muteRemote",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"muteRemote"),rr.prototype),Ge(rr.prototype,"unmuteRemote",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteRemote"),rr.prototype),Ge(rr.prototype,"muteLocal",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"muteLocal"),rr.prototype),Ge(rr.prototype,"unmuteLocal",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteLocal"),rr.prototype),Ge(rr.prototype,"close",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"close"),rr.prototype),Ge(rr.prototype,"updateEncoderConfig",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"updateEncoderConfig"),rr.prototype),Ge(rr.prototype,"updateSendParameters",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"updateSendParameters"),rr.prototype),Ge(rr.prototype,"replaceTrack",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"replaceTrack"),rr.prototype),Ge(rr.prototype,"getRemoteSSRC",[Ii],Object.getOwnPropertyDescriptor(rr.prototype,"getRemoteSSRC"),rr.prototype),rr);function Ii(e,t,r){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return await i.apply(this,p)}finally{d()}},r}let Zce={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new Qce(r,t)}},ele={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dt().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if($E.has(e)||!e.track)return;let r={track:e.track};if(Zo()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void N.error("create audio-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){r.controller||(r.controller=p),e.track&&e.track.id!==r.track.id&&(N.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let m=t.metadata&&t.metadata();m?function(_,E){let{chunk:x,controller:b}=E,C=Bc.METADATA;x.data=function(U,k,M){let H=M.byteLength,K=H+sC+KF,X=tC+rC+K,se=new ArrayBuffer(U.byteLength+X),te=new DataView(se);te.setUint8(0,zF),te.setUint16(1,K),te.setUint8(3,k),te.setUint16(4,H);for(let ce=0;ce<H;ce++)te.setUint8(6+ce,M[ce]);let Z=new Uint8Array(te.buffer);return Z.set(new Uint8Array(U),X),Z.buffer}(x.data,C,_),b.enqueue(x)}(m,{chunk:h,controller:p}):p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(bs()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");let c=YE(),d=new MessageChannel;await new je(p=>c.onmessage=m=>{m.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);e.transform=h,await new je(p=>c.onmessage=m=>{m.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var m;if(p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==r.track.id)N.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i);else if(p.data.getMetadata){let _=t.metadata&&t.metadata();_&&d.port1.postMessage({metadata:_})}},r.worker=c}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let c=$E.get(e);if(c){$E.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){N.warning(p&&p.message)}}}$E.set(e,r),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dt().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(tv.has(e))return;let r={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(Zo()&&!Bs()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");h0(Lt.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void N.error("create audio-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){r.controller||(r.controller=p),e.track&&e.track.id!==r.track.id&&(N.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i)),t.enableTopn?function(m,_,E){var x;let b=nC(new DataView(_.data));if(!b)return E.enqueue(_);let C=m.track.id;kie.set(C,m.track);let U=(x=b.tlv.find(se=>se.tag===Bc.AUDIO_LEVEL))===null||x===void 0?void 0:x.value,k=0;typeof U=="number"&&(k=127-U);let M=Math.round(Math.pow(10,k/60)-1),{selected:H,speaker:K}=function(se,te){let Z=fh.get(se);if(Z||(Z=function(ce){let fe=new YF;return fh.set(ce,fe),Fa||(Fa=new Die(Y("TOPN_SILENCE_THRESHOLD")||500),Fa.on("ActiveSpeakerChanged",xe=>{xe!=null&&(QE=xe)})),Fa.addSpeakers([fe]),fe}(se)),fh.size<=$F)return{selected:!0,speaker:Z};if(!Fa)throw new Error("no active speaker detector");return Fa.levelChanged(Z.id,te),fd=Fa.loudest.map(ce=>ce.id),QE&&!Ae(fd).call(fd,QE)&&fd.length>=$F&&fd.pop(),{selected:Ae(fd).call(fd,Z.id)||Z.id===QE,speaker:Z}}(m,M),X=function(se,te,Z){let ce=Ua.get(se)||new Pie(se,te);return ce.score=Z,Ua.set(se,ce),function(fe){if(ZE.set(fe,!0),!ev)return void(ev=Date.now());let xe=Date.now();xe-ev>1e3&&(ZE.get(fe)?ZE.set(fe,!1):(XF(fe),ZE.delete(fe)),ev=xe)}(se),ce}(C,m.track,K.energyScore);X.addSample(H),X.active&&(_.data=b.frame.buffer,E.enqueue(_))}(e,h,p):t.enableMetadata||t.enablePts?function(m,_,E,x){let b=new DataView(m.data),C=b.getUint8(0),U;if(128&C&&C!==71){let H=function(K){if(K.byteLength<=0)return[];let X=[],se=0;for(;se<K.byteLength;){let Z=(128&K.getUint8(se))>>7,ce=127&K.getUint8(se);if(!(Z&&se+4<=K.byteLength)){se++;break}{let fe=K.getUint32(se,!1),xe=(16776192&fe)>>10,Te=1023&fe;X.push({pt:ce,ts_offset:xe,length:Te,data:new Uint8Array}),se+=4}}let te=K.byteLength-se;for(let Z of X){if(Z.length>te)return console.warn("Broken red payload"),[];Z.length>0&&(Z.data=new Uint8Array(K.buffer,K.byteOffset+se,Z.length),se+=Z.length,te-=Z.length)}if(te>0){let Z={pt:X.length>0?X[X.length-1].pt:0,ts_offset:0,length:te,data:new Uint8Array(K.buffer,K.byteOffset+se,te)};X.push(Z)}return X}(b);if(H.length>0){let K=function(X){let se=0;for(let ce=0;ce<X.length;ce++)se+=ce<X.length-1?4:1,se+=X[ce].length;let te=new Uint8Array(se),Z=0;for(let ce=0;ce<X.length;ce++)if(ce<X.length-1){let fe=(2147483648|(127&X[ce].pt)<<24|(262143&X[ce].ts_offset)<<10|1023&X[ce].length)>>>0;te[Z++]=fe>>24&255,te[Z++]=fe>>16&255,te[Z++]=fe>>8&255,te[Z++]=255&fe}else te[Z++]=127&X[ce].pt;for(let ce of X)te.set(ce.data,Z),Z+=ce.length;return te}(H.map(X=>{let se=new Uint8Array(X.length);se.set(X.data);let te=nC(new DataView(se.buffer));return te!=null&&te.frame&&(X.data=te==null?void 0:te.frame),U=te,X}));m.data=K.buffer}}else U=nC(b),U&&(m.data=U.frame.buffer);if(_.enqueue(m),!U)return;let k=U.tlv.find(H=>H.tag===Bc.METADATA);k&&E&&k.value instanceof Uint8Array&&E(k.value);let M=U.tlv.find(H=>H.tag===Bc.AUDIO_64_BIT_PTS);M&&x&&M.value instanceof Uint8Array&&M.value.length==8&&x(new DataView(M.value.buffer).getBigUint64(0,!0))}(h,p,t.onMetadata,t.onPts):p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");let c=YE(),d=new MessageChannel;await new je(p=>c.onmessage=m=>{m.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);e.transform=h,await new je(p=>c.onmessage=m=>{m.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var m;p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==r.track.id?(N.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i)):p.data.metadata&&r.onMetadata?r.onMetadata(p.data.metadata):p.data.pts&&r.onPts&&r.onPts(p.data.pts)},r.worker=c}function i(){e.track.removeEventListener("ended",i),function(c){let d=tv.get(c);if(d){(function(m){let _=fh.get(m);_&&(fh.delete(m),Fa&&(Fa.removeSpeakers([_]),fh.size===0&&(Fa.destroy(),Fa=null)))})(c),XF(c.track.id),tv.delete(c);try{var h,p;(h=d.controller)===null||h===void 0||h.terminate(),(p=d.worker)===null||p===void 0||p.terminate()}catch(m){N.warning(m&&m.message)}}}(e)}tv.set(e,r),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!Dt().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(rv.has(e)||!e.track)return;let r={track:e.track};if(Zo()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(p){return void N.error("create video-encoded-streams error",p&&p.message)}let d=[];t.on("sei-to-send",p=>{d.push(p)});let h=new TransformStream({transform(p,m){r.controller||(r.controller=m),e.track&&e.track.id!==r.track.id&&(N.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let _=ZF(new Uint8Array(p.data)),E=d.shift();if(E){let x=function(b,C,U){switch(U){case cC:return function(k,M){let H=QF(M),K=H.length,X=Math.floor(K/255),se=K%255,te=new Uint8Array(6+X+1+K+k.byteLength);te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=6,te[5]=101;let Z=0;for(;Z<X;)te[6+Z]=255,Z++;return te[6+Z]=se,Z++,te.set(H,6+Z),te.set(new Uint8Array(k),6+Z+K),te.buffer}(b,C);case lC:return function(k,M){let H=QF(M),K=H.length,X=Math.floor(K/255),se=K%255,te=new Uint8Array(7+X+1+K+1+k.byteLength);te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=78,te[5]=1,te[6]=101;let Z=0;for(;Z<X;)te[7+Z]=255,Z++;return te[7+Z]=se,Z++,te.set(H,7+Z),Z+=K,te[7+Z]=128,Z++,te.set(new Uint8Array(k),7+Z),te.buffer}(b,C);default:return null}}(p.data,E,_);x&&(p.data=x)}m.enqueue(p)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!bs())return;{if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");let c=YE(),d=new MessageChannel;await new je(p=>c.onmessage=m=>{m.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);e.transform=h,await new je(p=>c.onmessage=m=>{m.data==="started"&&p(void 0)}),t.on("sei-to-send",p=>{d.port1.postMessage({sei:p})}),d.port1.onmessage=p=>{var m;p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==r.track.id&&(N.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i))},r.worker=c}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let c=rv.get(e);if(c){rv.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){N.warning(p&&p.message)}}}rv.set(e,r),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dt().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(!e.track)return;if(zf.has(e)){let c=zf.get(e);return void(c&&(c.onSei=t.onSei))}let r={track:e.track,onSei:t.onSei};if(Zo()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void N.error("create video-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){r.controller||(r.controller=p),e.track&&e.track.id!==r.track.id&&(N.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let m=function(_,E){switch(E){case cC:return function(x){let b=new DataView(x.data),C=0;for(;C+4<x.data.byteLength;){if(b.getUint8(C+0)===0&&b.getUint8(C+1)===0&&b.getUint8(C+2)===0&&b.getUint8(C+3)===1&&b.getUint8(C+4)===6){let U=C+6,k=0,M=0;for(;(M=b.getUint8(U++))===255;)k+=255;k+=M;let H=JF(x.data,U,k);return new Uint8Array(H)}C++}return null}(_);case lC:return function(x){let b=new DataView(x.data),C=0;for(;C+5<x.data.byteLength;){if(b.getUint8(C+0)===0&&b.getUint8(C+1)===0&&b.getUint8(C+2)===0&&b.getUint8(C+3)===1&&b.getUint8(C+4)===78&&b.getUint8(C+5)===1&&b.getUint8(C+6)===101){let U=C+7,k=0,M=0;for(;(M=b.getUint8(U++))===255;)k+=255;k+=M;let H=JF(x.data,U,k);return new Uint8Array(H)}C++}return null}(_);default:return null}}(h,ZF(new Uint8Array(h.data)));m&&r.onSei&&r.onSei(m),p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(bs()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");let c=YE(),d=new MessageChannel;await new je(p=>c.onmessage=m=>{m.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);e.transform=h,await new je(p=>c.onmessage=m=>{m.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var m;p.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==r.track.id?(N.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i)):p.data.sei&&r.onSei&&r.onSei(p.data.sei)},r.worker=c}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(c){let d=zf.get(c);if(d){zf.delete(c);try{var h,p;(h=d.controller)===null||h===void 0||h.terminate(),(p=d.worker)===null||p===void 0||p.terminate()}catch(m){N.warning(m&&m.message)}}})(e)}zf.set(e,r),e.track.addEventListener("ended",i)}},tle={name:"InterceptFrame",create:()=>ele};P0(),$t("PROCESS_ID","process-".concat(tr(8,""),"-").concat(tr(4,""),"-").concat(tr(4,""),"-").concat(tr(4,""),"-").concat(tr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void N.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();N.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(gr,i)){let{value:c,expires:d}=t[i];if(d&&d<=r)return;Ma[i]=c,gr[i]=c}})}catch(t){N.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Ma.AREAS)&&Ma.AREAS.length>0&&NC(Ma.AREAS,!0);let X3=(e,t,r)=>{N.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),$t(e,t,r)};$c(Sce,!1),$c(Rce,!1),$c(aoe,!1),$c(Fce,!1),$c(xce,!1),$c(Xce,!1),$c(Zce,!1),$c(tle,!1);let Hr=function(e){let t=new br,r=e,i={getListeners:t.getListeners.bind(t),on:(c,d)=>(function(h,p){h===wo.SECURITY_POLICY_VIOLATION&&IV(p,!0)}(c,d),t.on.bind(t)(c,d)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return AV(AV({},r),i)}({__TRACK_LIST__:ih,VERSION:bi,BUILD:L0,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:X3,getParameter:Y,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,r=await async function(i){let c;return Dt().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),c=(await i.createOffer()).sdp):c=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(t);if(!r)return e;t.close(),t=null,e=function(i){let c={video:[],audio:[]};return i.match(/ VP8/i)&&c.video.push("VP8"),i.match(/ VP9/i)&&c.video.push("VP9"),i.match(/ AV1/i)&&c.video.push("AV1"),i.match(/ H264/i)&&c.video.push("H264"),i.match(/ H265/i)&&c.video.push("H265"),i.match(/ opus/i)&&c.audio.push("OPUS"),i.match(/ PCMU/i)&&c.audio.push("PCMU"),i.match(/ PCMA/i)&&c.audio.push("PCMA"),i.match(/ G722/i)&&c.audio.push("G722"),c}(r)}catch(t){throw new le(z.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=ze.reportApiInvoke(null,{name:Or.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Er.TRACER}),t=!1;try{let d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;t=!!(d&&h&&p),t&&E0()&&JL(75)&&new d().close()}catch(d){return N.error("check system requirement failed: ",d),!1}let r=!1,i=Rt();i.name===Lt.CHROME&&Number(i.version)>=58&&(ka.engine.name!=="WebKit"||function(){let d=Rt();if(OE()){if(d.os===ts.MAC_OS)return!0;if(d.os===ts.IOS){let h=ka.os.version&&ka.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(r=!0),(i.name===Lt.FIREFOX&&Number(i.version)>=56||i.name===Lt.OPERA&&Number(i.version)>=45||i.name===Lt.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(Bs()||Qi())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||s2()||Rt().name===Lt.QQ)&&(r=!0),N.debug("checkSystemRequirements, api:",t,"browser",r);let c=t&&r;return e.onSuccess(c),c},getDevices:function(e){return ci.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return ci.getRecordingDevices(e)},getCameras:function(e){return ci.getCamerasDevices(e)},getElectronScreenSources:J2,getPlaybackDevices:function(e){return ci.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},r=tr(5,"client-"),i=ze.reportApiInvoke(null,{id:r,name:Or.CREATE_CLIENT,options:[t],tag:Er.TRACER});try{(function(c){Jr(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Jr(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Jr(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&us(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&u2(c.turnServer),c.httpRetryConfig!==void 0&&d2(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&d2(c.websocketRetryConfig)})(t)}catch(c){throw i.onError(c),c}return(e2(16,0)||m0(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",N.debug("browser not support vp9, force use vp8")),$t("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new ooe(oa(oa({forceWaitGatewayResponse:!0},t),{},{role:Ae(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Y("CAMERA_CAPTURE_CONFIG"),r=tr(8,"track-cam-"),i=ze.reportApiInvoke(null,{id:r,tag:Er.TRACER,name:Or.CREATE_CAM_VIDEO_TRACK,options:[nr({},e),t]});t&&(e.encoderConfig=t);let c=KE(e),d=null;N.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{d=(await oi({video:c},r)).getVideoTracks()[0]||null}catch(p){throw i.onError(p),p}if(!d){let p=new he(z.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(p),p.throw(N)}if(e.optimizationMode&&eC(r,d,e,ta(e.encoderConfig)),Y("USE_STANDARD_BITRATE_DEFAULT")){let p=ta(e.encoderConfig);e.encoderConfig=p,delete p.bitrateMax,delete p.bitrateMin}let h=new qE(d,e,c,e.scalabiltyMode?WE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return i.onSuccess(h.getTrackId()),N.info("create camera video success, trackId:",r),h},createCustomVideoTrack:function(e){let t=tr(8,"track-cus-"),r=ze.reportApiInvoke(null,{id:t,tag:Er.TRACER,name:Or.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});Y("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);let i=new ar(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?WE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Zt.CUSTOM_TRACK]);return r.onSuccess(i.getTrackId()),N.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",r=typeof t=="object"?function(b){return oM(b)}(t):void 0;r&&(t="auto");let i=tr(8,"track-scr-v-"),c=ze.reportApiInvoke(null,{id:i,tag:Er.TRACER,name:Or.CREATE_SCREEN_VIDEO_TRACK,options:[nr({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let d=function(b){let C={};b.screenSourceType&&(C.mediaSource=b.screenSourceType),b.extensionId&&Zo()&&(C.extensionId=b.extensionId);let{displaySurface:U,selfBrowserSurface:k,surfaceSwitching:M,systemAudio:H,preferCurrentTab:K}=b;(Xu(107)||p0(107)||g0(93))&&(U&&(Jr(U,"displaySurface",["browser","window","monitor"]),C.displaySurface=U),k?(Jr(k,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=k):C.selfBrowserSurface="include",M&&(Jr(M,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=M)),(Xu(105)||p0(105)||g0(91))&&H&&(Jr(H,"systemAudio",["exclude","include"]),C.systemAudio=H),(Xu(94)||p0(94)||g0(80))&&K&&(C.preferCurrentTab=!0),b.electronScreenSourceId&&(C.sourceId=b.electronScreenSourceId);let X=b.encoderConfig?W0(b.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:X?X.width:void 0,maxHeight:X?X.height:void 0},X&&(X.frameRate&&(typeof X.frameRate=="number"?(C.mandatory.maxFrameRate=X.frameRate,C.mandatory.minFrameRate=X.frameRate):(C.mandatory.maxFrameRate=X.frameRate.max||X.frameRate.ideal||X.frameRate.exact||void 0,C.mandatory.minFrameRate=X.frameRate.min||X.frameRate.ideal||X.frameRate.exact||void 0),C.frameRate=X.frameRate),X.width&&(C.width=X.width),X.height&&(C.height=X.height)),C}(e),h=null,p=null,m=Dt();if(!m.supportShareAudio&&t==="enable"){let b=new he(z.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(b),b.throw(N)}N.info("start create screen video track with config",e,"withAudio",t,"trackId",i);let _=m.supportShareAudio&&t!=="disable";try{let b=await oi({screen:d,screenAudio:_?r||!0:void 0},i);h=b.getVideoTracks()[0]||null,p=b.getAudioTracks()[0]||null}catch(b){throw c.onError(b),b}if(!h){let b=new he(z.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(b),b.throw(N)}if(!p&&t==="enable"){h&&h.stop();let b=new he(z.SHARE_AUDIO_NOT_ALLOWED);return c.onError(b),b.throw(N)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(eC(i,h,e,e.encoderConfig&&W0(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let E=new ar(h,e.encoderConfig?W0(e.encoderConfig):{},e.scalabiltyMode?WE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[Zt.SCREEN_TRACK]);if(!p)return c.onSuccess(E.getTrackId()),N.info("create screen video track success","video:",E.getTrackId()),E;let x=new Ar(p,void 0,tr(8,"track-scr-a-"),!1);return c.onSuccess([E.getTrackId(),x.getTrackId()]),N.info("create screen video track success","video:",E.getTrackId(),"audio:",x.getTrackId()),[E,x]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Y("CAMERA_CAPTURE_CONFIG"),i=tr(8,"track-mic-"),c=tr(8,"track-cam-"),d=ze.reportApiInvoke(null,{id:"".concat(i,"-").concat(c),tag:Er.TRACER,name:Or.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);let h=KE(t),p=cM(e),m=null,_=null;N.info("start create camera video track(".concat(c,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let b=await oi({audio:p,video:h},"".concat(i,"-").concat(c));m=b.getAudioTracks()[0],_=b.getVideoTracks()[0]}catch(b){throw d.onError(b),b}if(!m||!_){let b=new he(z.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(b),b.throw(N)}if(t.optimizationMode&&eC(c,_,t,ta(t.encoderConfig)),Y("USE_STANDARD_BITRATE_DEFAULT")){let b=ta(t.encoderConfig);t.encoderConfig=b,delete b.bitrateMax,delete b.bitrateMin}let E=new Hf(m,e,p,i),x=new qE(_,t,h,t.scalabiltyMode?WE(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return d.onSuccess([E.getTrackId(),x.getTrackId()]),N.info("create camera video track(".concat(c,") and microphone audio track(").concat(i,") success")),[E,x]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=tr(8,"track-mic-"),r=ze.reportApiInvoke(null,{id:t,tag:Er.TRACER,name:Or.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=cM(e),c=null;N.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await oi({audio:i},t)).getAudioTracks()[0]||null}catch(h){throw r.onError(h),h}if(!c){let h=new he(z.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(h),h.throw(N)}let d=new Hf(c,e,i,t);return r.onSuccess(d.getTrackId()),N.info("create microphone audio track success, trackId:",t),d},createCustomAudioTrack:function(e){let t=tr(8,"track-cus-"),r=ze.reportApiInvoke(null,{id:t,tag:Er.TRACER,name:Or.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Ar(e.mediaStreamTrack,e.encoderConfig?GE(e.encoderConfig):{},t,!1);return N.info("create custom audio track success with config",e,"trackId",i.getTrackId()),r.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:r,encoderConfig:i}=e,{source:c}=e,d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:r,encoderConfig:i},h=tr(8,"track-buf-"),p=ze.reportApiInvoke(null,{id:h,tag:Er.TRACER,name:Or.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(Y("DISABLE_WEBAUDIO"))throw new he(z.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");N.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);let m=c;if(!(c instanceof AudioBuffer))try{c=await async function(x,b){let C=null;if(typeof x=="string"){let k=YM.get(x);if(k)return N.debug("use cached audio resource: ",x),k;try{C=(await La(()=>dn.get(x,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(M){throw new he(z.FETCH_AUDIO_FILE_FAILED,M.toString())}}else C=await new je((k,M)=>{let H=new FileReader;H.onload=K=>{K.target?k(K.target.result):M(new he(z.READ_LOCAL_AUDIO_FILE_ERROR))},H.onerror=()=>{M(new he(z.READ_LOCAL_AUDIO_FILE_ERROR))},H.readAsArrayBuffer(x)});let U=await function(k){let M=dh();return new je((H,K)=>{M.decodeAudioData(k,X=>{H(X)},X=>{K(new he(z.DECODE_AUDIO_FILE_FAILED,X.toString()))})})}(C);return typeof x=="string"&&b&&YM.set(x,U),U}(c,r)}catch(x){return p.onError(x),x.throw(N)}let _=new Rie(c),E=new Tie(m,_,i?GE(i):{},h);return N.info("create buffer source audio track success, trackId:",h),p.onSuccess(E.getTrackId()),E},setAppType:function(e){if(N.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw N.debug("Invalid appType"),new le(z.INVALID_PARAMS,"invalid app type",e);$t("APP_TYPE",Math.floor(e))},setLogLevel:function(e){N.setLogLevel(e)},enableLogUpload:function(){Y("USE_NEW_LOG")?$t("UPLOAD_LOG",!0):N.enableLogUpload()},disableLogUpload:function(){Y("USE_NEW_LOG")?$t("UPLOAD_LOG",!1):N.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new JU},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=ze.reportApiInvoke(null,{tag:Er.TRACER,name:Or.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ar||e instanceof ph)){let m=new le(z.INVALID_TRACK,"the parameter is not a audio track");return r.onError(m),m.throw()}t&&t<1e3&&(t=1e3);let i=e instanceof Ar?e.getTrackLabel():"remote_track",c=e.getVolumeLevel(),d=c,h=c,p=Date.now();return new je(m=>{let _=setInterval(()=>{let E=e.getVolumeLevel();d=E>d?E:d,h=E<h?E:h;let x=d-h>1e-4,b=Date.now()-p;if(x||b>t){clearInterval(_);let C=x,U={duration:b,deviceLabel:i,maxVolumeLevel:d,result:C};N.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(U))),r.onSuccess(U),m(C)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=ze.reportApiInvoke(null,{tag:Er.TRACER,name:Or.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof ar||e instanceof hh)){let x=new le(z.INVALID_TRACK,"the parameter is not a video track");return r.onError(x),x.throw()}t&&t<1e3&&(t=1e3);let i=e instanceof ar?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(bs()||OE())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();let h=document.createElement("canvas");h.width=160,h.height=120;let p=0,m=0;try{let x=Date.now();p=await function(b,C,U,k){let M,H=0,K=null;return new je((X,se)=>{function te(){H>k&&M&&(M(),X(H));let Z=U.getContext("2d");if(!Z){let xe=new le(z.UNEXPECTED_ERROR,"can not get canvas 2d context.");return N.error(xe.toString()),void se(xe)}Z.drawImage(b,0,0,160,120);let ce=Z.getImageData(0,0,U.width,U.height),fe=Math.floor(ce.data.length/3);if(K){for(let xe=0;xe<fe;xe+=3)if(ce.data[xe]!==K[xe])return H+=1,void(K=ce.data);K=ce.data}else K=ce.data}setTimeout(()=>{M&&(M(),X(H))},C),M=q0(()=>{te()},30)})}(d,t,h,4),m=Date.now()-x}catch(x){throw r.onError(x),x}Kae===Lt.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;let _=p>4,E={duration:m,changedPicNum:p,deviceLabel:i,result:_};return N.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),r.onSuccess(E),_},setArea:NC,audioElementPlayCenter:un,resumeAudioContext:function(){un.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){loe.processExternalMediaAEC(e)},registerExtensions:function(e){let t=Y("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!Ae(t).call(t,r.name)&&t.push(r.name);let i=r;i.__registered__=!0,i.logger.hookLog=N.extLog,i.reporter.hookApiInvoke=ze.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(c=>{i.parameters[c]=Y(c)})}),X3("PLUGIN_INFO",t)},ChannelMediaRelayError:gh,ChannelMediaRelayEvent:sc,ChannelMediaRelayState:bn,RemoteStreamFallbackType:vie,RemoteStreamType:Eie,ConnectionDisconnectedReason:Wt,AudienceLatencyLevelType:$ne,AREAS:Ft,preload:async function(e,t,r,i){return x5(e,t,r,i)}});return Object.defineProperties(Hr,{onAudioAutoplayFailed:{get:()=>li.onAudioAutoplayFailed,set:e=>{li.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>li.onAutoplayFailed,set:e=>{li.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Hr._onSecurityPolicyViolation,set(e){Hr._onSecurityPolicyViolation=e,IV(e)}},__CLIENT_LIST__:{get:()=>Y("SHOW_GLOBAL_CLIENT_LIST")?md:[]}}),ci.on(ud.CAMERA_DEVICE_CHANGED,e=>{N.info("camera device changed",JSON.stringify(e)),Hr.onCameraChanged&&Hr.onCameraChanged(e),Hr.safeEmit(wo.CAMERA_CHANGED,e)}),ci.on(ud.RECORDING_DEVICE_CHANGED,e=>{N.info("microphone device changed",JSON.stringify(e)),Hr.onMicrophoneChanged&&Hr.onMicrophoneChanged(e),Hr.safeEmit(wo.MICROPHONE_CHANGED,e)}),ci.on(ud.PLAYOUT_DEVICE_CHANGED,e=>{N.debug("playout device changed",JSON.stringify(e)),Hr.onPlaybackDeviceChanged&&Hr.onPlaybackDeviceChanged(e),Hr.safeEmit(wo.PLAYBACK_DEVICE_CHANGED,e)}),un.onAutoplayFailed=()=>{N.info("detect audio element autoplay failed"),li.onAudioAutoplayFailed&&li.onAudioAutoplayFailed()},Xt.on("autoplay-failed",()=>{N.info("detect webaudio autoplay failed"),li.onAudioAutoplayFailed&&li.onAudioAutoplayFailed(),Hr.safeEmit(wo.AUTOPLAY_FAILED)}),Xt.on(fs.STATE_CHANGE,(e,t)=>{N.info("audio context state changed: ".concat(t," => ").concat(e)),Hr.onAudioContextStateChanged&&Hr.onAudioContextStateChanged(e,t),Hr.safeEmit(wo.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Mr.on(Qu.NETWORK_STATE_CHANGE,(e,t)=>{N.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Hr),Hr})}),ZH={};a0e(ZH,{AgoraRTCProvider:()=>rz,AgoraRTCReactError:()=>Kn,AgoraRTCScreenShareProvider:()=>_0e,LocalAudioTrack:()=>lz,LocalUser:()=>fz,LocalVideoTrack:()=>hz,RemoteAudioTrack:()=>mz,RemoteUser:()=>_z,RemoteVideoTrack:()=>gz,TrackBoundary:()=>O0e,VERSION:()=>L0e,default:()=>Ez,useAutoPlayAudioTrack:()=>JI,useAutoPlayVideoTrack:()=>XI,useClientEvent:()=>f0e,useConnectionState:()=>v0e,useCurrentUID:()=>y0e,useIsConnected:()=>Xp,useJoin:()=>nz,useLocalCameraTrack:()=>oz,useLocalMicrophoneTrack:()=>az,useLocalScreenTrack:()=>A0e,useNetworkQuality:()=>x0e,usePublish:()=>iz,useRTCClient:()=>co,useRTCScreenShareClient:()=>E0e,useRemoteAudioTracks:()=>T0e,useRemoteUserTrack:()=>iA,useRemoteUsers:()=>cz,useRemoteVideoTracks:()=>R0e,useTrackEvent:()=>m0e,useVolumeLevel:()=>w0e});var c0e=pu(fu());function Pn(s,n,a){return s.on(n,a),()=>s.off(n,a)}function l0e(s){try{return s()}catch(n){console.error(n)}}function mu(s){return()=>s.forEach(l0e)}function d0e(s,n){let a=setInterval(s,n);return()=>clearInterval(a)}function mb(s,n){let a=setTimeout(s,n);return()=>clearTimeout(a)}function YI(){let s,n,a;function l(){if(n){let w=n;n=void 0,w()}}async function u(){if(a){let w=a;a=void 0;try{await w()}catch(T){console.error(T)}}}async function f(w){s=!0,await u();try{a=await w()}catch(T){console.error(T)}s=!1,l()}async function g(){s=!0,await u(),s=!1,l()}function v(w){s?n=()=>f(w):f(w)}function y(){s?n=g:g()}return{run:v,dispose:y}}var gb=typeof document<"u"?L.useLayoutEffect:L.useEffect;function u0e(s){return s!=null&&typeof s.then=="function"}function zl(){let s=L.useRef(!1);return L.useEffect(()=>(s.current=!1,()=>{s.current=!0}),[]),s}function h0e(){let s=zl();function n(a,l){return new Promise(async(u,f)=>{try{let g=await a;s.current||u(g)}catch(g){s.current?l&&l(g):f(g)}})}return L.useCallback(n,[s])}function ez(s){let n=h0e(),[a,l]=L.useState();return gb(()=>{u0e(s)?n(s).then(l):l(s)},[s,n]),a}function gu(s,n){let a=L.useRef();L.useEffect(()=>{let{run:l,dispose:u}=a.current||(a.current=YI());return l(s),u},n)}function p0e(s,n){let a=s.split("."),l=n.split("."),u=Math.max(a.length,l.length);for(let f=0;f<u;f++){let g=parseInt(a[f]||"0"),v=parseInt(l[f]||"0");if(g>v)return 1;if(g<v)return-1}return 0}function f0e(s,n,a){let l=L.useRef(a);gb(()=>{l.current=a},[a]),L.useEffect(()=>{if(s)return Pn(s,n,(...u)=>{l.current&&l.current(...u)})},[n,s])}function m0e(s,n,a){let l=L.useRef(a);gb(()=>{l.current=a},[a]),L.useEffect(()=>{if(s)return Pn(s,n,(...u)=>{l.current&&l.current(...u)})},[n,s])}var tz=L.createContext(null);function rz({client:s,children:n}){return o.jsx(tz.Provider,{value:s,children:n})}function g0e(s){let n=L.useContext(tz);return s||n}function co(s){let n=g0e(s);if(!n)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return n}var sz=L.createContext(null);function _0e({client:s,children:n}){return o.jsx(sz.Provider,{value:s,children:n})}function E0e(s){let n=L.useContext(sz);return s||n}function v0e(s){let n=co(s),[a,l]=L.useState(n?n.connectionState:"DISCONNECTED");return L.useEffect(()=>{if(n){l(n.connectionState);let u;return mu([Pn(n,"connection-state-change",f=>{u==null||u(),f==="CONNECTED"?u=mb(()=>l(f),0):l(f)}),()=>u==null?void 0:u()])}else l("DISCONNECTED")},[n]),a}function Xp(s){let n=co(s),[a,l]=L.useState(n?n.connectionState==="CONNECTED":!1);return L.useEffect(()=>{if(n){l(n.connectionState==="CONNECTED");let u;return mu([Pn(n,"connection-state-change",f=>{u==null||u(),u=mb(()=>l(f==="CONNECTED"),0)}),()=>u==null?void 0:u()])}else l(!1)},[n]),a}function y0e(s){let n=co(s),[a,l]=L.useState(n==null?void 0:n.uid);return L.useEffect(()=>{if(n)return Pn(n,"connection-state-change",u=>{if(u==="CONNECTED")return mb(()=>l(n.uid),0);u==="DISCONNECTED"&&l(void 0)})},[n]),a}var Kn=class extends Error{constructor(n,a){var s=(...JCe)=>(super(...JCe),Tm(this,"rtcMethod"),Tm(this,"rtcError"),Tm(this,"name","AgoraRTCReactException"),this);s(typeof a=="string"?a:a.message),this.rtcMethod=n,this.rtcError=a}log(n){console[n](this)}};function nz(s,n=!0,a){let l=co(a),u=Xp(a),f=L.useRef(),[g,v]=L.useState(!1),[y,w]=L.useState(0),[T,S]=L.useState(null),I=zl();return gu(async()=>{if(I.current||(S(null),w(0),v(!1)),n&&l){try{I.current||v(!0);let{appid:B,channel:A,token:F,uid:D}=typeof s=="function"?await s():s,R=await l.join(B,A,F,D);I.current||w(R)}catch(B){console.error(B),I.current||S(new Kn("IAgoraRTCClient.join",B))}I.current||v(!1);let j=f.current||(f.current=YI());return mu([()=>{j.dispose()},()=>{j.run(()=>l.unpublish(l.localTracks))},()=>{for(let B of l.localTracks)B.isPlaying&&B.stop(),B.close();j.run(()=>l.leave())}])}},[n,a]),{data:y,isLoading:g,isConnected:u,error:T}}var S7=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function x0e(s){let n=co(s),[a,l]=L.useState(S7);return L.useEffect(()=>{if(n)return Pn(n,"network-quality",u=>l({uplinkNetworkQuality:u.uplinkNetworkQuality,downlinkNetworkQuality:u.downlinkNetworkQuality,delay:n.getRTCStats().RTT??0}));l(S7())},[n]),a}var b0e=pu(fu());function iz(s,n=!0,a){let l=co(a),u=Xp(a),f=L.useRef([]),[g,v]=L.useState(!1),[y,w]=L.useState(null),T=zl();return gu(async()=>{if(T.current||(v(!1),w(null)),!l||!u||!n)return;let S=s.filter(Boolean),I=A=>{let F=p0e(b0e.default.VERSION,"4.18.2")>=0;return F||new Kn("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),F?l.mode!=="live"||l.role!=="audience":!0},j=A=>f.current.some(F=>F&&F.getTrackId()===A.getTrackId()),B=A=>I()&&A.enabled&&n&&!j(A);for(let A=0;A<S.length;A++){let F=S[A];if(F&&B(F)){await l.unpublish(f.current.filter(D=>(D==null?void 0:D.trackMediaType)===F.trackMediaType));try{T.current||v(!0),await l.publish(F)}catch(D){console.error(D),T.current||w(new Kn("IAgoraRTCClient.publish",D))}T.current||v(!1)}}f.current=S},[u,n,l,s]),{isLoading:g,error:y}}function w0e(s){let[n,a]=L.useState(0);return L.useEffect(()=>{if(s)return d0e(()=>{a(s.getVolumeLevel())},1e3)},[s]),n}var S0e=pu(fu());function az(s=!0,n={ANS:!0,AEC:!0}){let[a,l]=L.useState(null),[u,f]=L.useState(!1),[g,v]=L.useState(null),y=zl();return gu(async()=>{if(y.current||(f(!1),v(null)),s&&!a){try{y.current||f(!0);let w=await S0e.default.createMicrophoneAudioTrack(n);y.current||l(w)}catch(w){console.error(w),y.current||v(new Kn("IAgoraRTC.createMicrophoneAudioTrack",w))}y.current||f(!1)}},[s]),{localMicrophoneTrack:a,isLoading:u,error:g}}var C0e=pu(fu());function oz(s=!0,n){let[a,l]=L.useState(null),[u,f]=L.useState(!1),[g,v]=L.useState(null),y=zl();return gu(async()=>{if(y.current||(f(!1),v(null)),s&&!a){try{y.current||f(!0);let w=await C0e.default.createCameraVideoTrack(n);y.current||l(w)}catch(w){console.error(w),y.current||v(new Kn("IAgoraRTC.createCameraVideoTrack",w))}y.current||f(!1)}},[s]),{localCameraTrack:a,isLoading:u,error:g}}function T0e(s,n){let a=co(n),[l,u]=L.useState([]),f=Xp(),g=L.useRef([]),[v,y]=L.useState(!1),[w,T]=L.useState(null),S=zl();return gu(async()=>{if(S.current||T(null),!Array.isArray(s)||!f)return;let I=async A=>{if(!A.audioTrack&&s.some(({uid:F})=>A.uid===F)){try{S.current||y(!0),await a.subscribe(A,"audio")}catch(F){console.error(F),S.current||T(new Kn("IAgoraRTCClient.subscribe",F))}A.audioTrack&&!g.current.some(F=>F.getUserId()===A.uid)&&g.current.push(A.audioTrack),g.current=g.current.map(F=>A.audioTrack&&F.getUserId()===A.uid&&F.getTrackId()!==A.audioTrack.getTrackId()?A.audioTrack:F),S.current||(u([...g.current]),y(!1))}},j=async A=>{if(s.some(({uid:F})=>A.uid===F)){S.current||(g.current=g.current.filter(F=>F.getUserId()!==A.uid),u([...g.current]));try{S.current||y(!0),await a.unsubscribe(A,"audio")}catch(F){console.error(F),S.current||T(new Kn("IAgoraRTCClient.unsubscribe",F))}S.current||y(!1)}};s.map(A=>{!A.audioTrack&&A.hasAudio&&I(A)});let B=[];for(let A=0;A<g.current.length;A++){let F=g.current[A];if(!s.some(D=>D.uid===F.getUserId())){let D=a.remoteUsers.find(R=>R.uid===F.getUserId());D&&B.push({user:D,mediaType:"audio"}),g.current.splice(A,1),A--}}if(B.length>0){try{S.current||y(!0),await a.massUnsubscribe(B)}catch(A){console.error(A),S.current||T(new Kn("IAgoraRTCClient.massUnsubscribe",A))}S.current||(u(g.current.slice()),y(!1))}return mu([Pn(a,"user-published",(A,F)=>{s.find(D=>D.uid===A.uid)&&F==="audio"&&I(A)}),Pn(a,"user-unpublished",(A,F)=>{s.find(D=>D.uid===A.uid)&&F==="audio"&&j(A)})])},[f,a,s]),{audioTracks:l,isLoading:v,error:w}}function R0e(s,n){let a=co(n),[l,u]=L.useState([]),f=Xp(),g=L.useRef([]),[v,y]=L.useState(!1),[w,T]=L.useState(null),S=zl();return gu(async()=>{if(S.current||T(null),!Array.isArray(s)||!f)return;let I=async A=>{if(!A.videoTrack&&s.some(({uid:F})=>A.uid===F)){try{S.current||y(!0),await a.subscribe(A,"video")}catch(F){console.error(F),S.current||T(new Kn("IAgoraRTCClient.subscribe",F))}A.videoTrack&&!g.current.some(F=>F.getUserId()===A.uid)&&g.current.push(A.videoTrack),g.current=g.current.map(F=>A.videoTrack&&F.getUserId()===A.uid&&F.getTrackId()!==A.videoTrack.getTrackId()?A.videoTrack:F),S.current||(u([...g.current]),y(!1))}},j=async A=>{if(s.some(({uid:F})=>A.uid===F)){S.current||(g.current=g.current.filter(F=>F.getUserId()!==A.uid),u([...g.current]));try{S.current||y(!0),await a.unsubscribe(A,"video")}catch(F){console.error(F),S.current||T(new Kn("IAgoraRTCClient.unsubscribe",F))}S.current||y(!1)}};s.map(A=>{!A.videoTrack&&A.hasVideo&&I(A)});let B=[];for(let A=0;A<g.current.length;A++){let F=g.current[A];if(!s.some(D=>D.uid===F.getUserId())){let D=a.remoteUsers.find(R=>R.uid===F.getUserId());D&&B.push({user:D,mediaType:"video"}),g.current.splice(A,1),A--}}if(B.length>0){try{S.current||y(!0),await a.massUnsubscribe(B)}catch(A){console.error(A),S.current||T(new Kn("IAgoraRTCClient.massUnsubscribe",A))}S.current||(u(g.current.slice()),y(!1))}return mu([Pn(a,"user-published",(A,F)=>{s.find(D=>D.uid===A.uid)&&F==="video"&&I(A)}),Pn(a,"user-unpublished",(A,F)=>{s.find(D=>D.uid===A.uid)&&F==="video"&&j(A)})])},[f,a,s]),{videoTracks:l,isLoading:v,error:w}}function iA(s,n,a){let l=co(a),u=n==="audio"?"audioTrack":"videoTrack",[f,g]=L.useState(s&&s[u]),v=Xp(),y=L.useRef(),[w,T]=L.useState(!1),[S,I]=L.useState(null);return L.useEffect(()=>{if(!s||!v)return;let j=!1;j||I(null);let B=n==="audio"?"hasAudio":"hasVideo",A=s.uid,F=async(O,V)=>{if(O[u]&&l.remoteUsers.some(({uid:G})=>O.uid===G))try{j||T(!0),await l.unsubscribe(O,V)}catch(G){j||I(new Kn("IAgoraRTCClient.unsubscribe",G)),console.error(G)}j||(g(void 0),T(!1))},D=async(O,V)=>{try{!O[u]&&l.remoteUsers.some(({uid:G})=>O.uid===G)&&(j||T(!0),await l.subscribe(O,V)),j||g(O[u])}catch(G){j||I(new Kn("IAgoraRTCClient.subscribe",G)),console.error(G)}j||T(!1)},R=y.current||(y.current=YI());return!s[u]&&s[B]?R.run(()=>D(s,n)):g(s[u]),mu([()=>{j=!0,R.dispose()},Pn(l,"user-published",(O,V)=>{O.uid===A&&V===n&&R.run(()=>D(O,n))}),Pn(l,"user-unpublished",(O,V)=>{O.uid===A&&V===n&&R.run(()=>F(O,n))})])},[v,l,s,n,u]),{track:f,isLoading:w,error:S}}function cz(s){let n=co(s),[a,l]=L.useState(n?n.remoteUsers:[]);return L.useEffect(()=>{if(n){let u=()=>l(n.remoteUsers.slice());return mu([Pn(n,"user-joined",u),Pn(n,"user-left",u),Pn(n,"user-published",u),Pn(n,"user-unpublished",u)])}},[n]),a}var N0e=pu(fu());function A0e(s=!0,n,a){let[l,u]=L.useState(null),[f,g]=L.useState(!1),[v,y]=L.useState(null),w=zl();return gu(async()=>{if(w.current||(g(!1),y(null)),s&&!l){try{w.current||g(!0);let T=await N0e.default.createScreenVideoTrack(n,a);w.current||u(T)}catch(T){console.error(T),w.current||y(new Kn("IAgoraRTC.createScreenVideoTrack",T))}w.current||g(!1)}},[s]),{screenTrack:l,isLoading:f,error:v}}function I0e(){let s=new Map,n=1500;return{onMount:a=>{let l=s.get(a);l&&(l(),s.delete(a))},onUnmount:a=>{let l=s.get(a);l&&l(),s.set(a,mb(()=>{a.isPlaying&&a.stop(),s.delete(a)},n))},dispose:()=>{for(let[a,l]of s)a.isPlaying&&a.stop(),l&&l();s.clear()}}}var $I=L.createContext(void 0);function O0e({children:s}){let[n]=L.useState(I0e);return L.useEffect(()=>n.dispose,[n]),o.jsx($I.Provider,{value:n,children:s})}function XI(s,n,a,l){let u=L.useContext($I);L.useEffect(()=>{if(s)return l&&n?s.play(l,a||void 0):s.stop(),u?(u.onMount(s),()=>u.onUnmount(s)):()=>{s.isPlaying&&s.stop()}},[s,l,n,u,a])}function JI(s,n){let a=L.useContext($I);gb(()=>{if(s)return n?s.play():s.stop(),a?(a.onMount(s),()=>a.onUnmount(s)):()=>{s.isPlaying&&s.stop()}},[s,n,a])}function lz({track:s,play:n=!1,volume:a,disabled:l,muted:u,children:f}){let g=ez(s);return JI(g,n),L.useEffect(()=>{g&&a!=null&&g.setVolume(a)},[g,a]),L.useEffect(()=>{g&&l!=null&&g.setEnabled(!l).catch(console.warn)},[l,g]),L.useEffect(()=>{g&&u!=null&&g.setMuted(u).catch(console.warn)},[u,g]),f?o.jsx(o.Fragment,{children:f}):null}var dz={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},uz={width:"100%",height:"100%"},QI={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},_b=(s,n)=>L.useMemo(()=>({...s,...n}),[s,n]);function hz({track:s,play:n,disabled:a,muted:l,style:u,videoPlayerConfig:f,...g}){let v=_b(uz,u),[y,w]=L.useState(null),T=ez(s);return XI(T,n,f,y),L.useEffect(()=>{T&&a!=null&&T.setEnabled(!a).catch(console.warn)},[a,T]),L.useEffect(()=>{T&&l!=null&&T.setMuted(l).catch(console.warn)},[l,T]),o.jsx("div",{...g,ref:w,style:v})}var D0e={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},P0e={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function pz({cover:s}){return o.jsx("div",{style:QI,children:typeof s=="string"?o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{...D0e,backgroundImage:`url(${s})`}}),o.jsx("img",{src:s,style:P0e})]}):s()})}function fz({micOn:s,cameraOn:n,audioTrack:a,videoTrack:l,playAudio:u,playVideo:f,volume:g,cover:v,children:y,style:w,...T}){let S=_b(dz,w);return f=f??!!n,u=u??!!s,o.jsxs("div",{...T,style:S,children:[o.jsx(hz,{disabled:!n,play:f,track:l}),o.jsx(lz,{disabled:!s,play:u,track:a,volume:g}),v&&!n&&o.jsx(pz,{cover:v}),o.jsx("div",{style:QI,children:y})]})}function mz({track:s,play:n=!1,playbackDeviceId:a,volume:l,children:u}){return JI(s,n),L.useEffect(()=>{s&&a!=null&&s.setPlaybackDevice(a).catch(console.warn)},[s,a]),L.useEffect(()=>{s&&l!=null&&s.setVolume(l)},[s,l]),u?o.jsx(o.Fragment,{children:u}):null}function gz({track:s,play:n,style:a,videoPlayerConfig:l,...u}){let f=_b(uz,a),[g,v]=L.useState(null);return XI(s,n,l,g),o.jsx("div",{...u,ref:v,style:f})}function _z({user:s,playVideo:n,playAudio:a,playbackDeviceId:l,volume:u,cover:f,style:g,children:v,videoPlayerConfig:y,...w}){let T=_b(dz,g),{track:S}=iA(s,"video"),{track:I}=iA(s,"audio");return n=n??(s==null?void 0:s.hasVideo),a=a??(s==null?void 0:s.hasAudio),o.jsxs("div",{...w,style:T,children:[o.jsx(gz,{play:n,track:S,videoPlayerConfig:y}),o.jsx(mz,{play:a,playbackDeviceId:l,track:I,volume:u}),f&&!n&&o.jsx(pz,{cover:f}),o.jsx("div",{style:QI,children:v})]})}var k0e=pu(fu()),j0e=class{constructor(){Tm(this,"appType",1001);k0e.default.setAppType(this.appType)}};new j0e;var L0e="2.5.0";o0e(ZH,pu(fu()));var Ez=c0e.default;async function Vg(s,n,a={}){const{error:l}=await ie.from("meeting_event_logs").insert({meet_id:s,event_type:n,timestamp:new Date().toISOString(),metadata:a});l&&console.error(`Error logging meeting event ${n}:`,l)}async function Eb(s){const{data:n,error:a}=await ie.from("meets").select("*").eq("id",s).single();return a||!n?(console.error("Error fetching meeting:",a),null):{id:n.id,status:n.status,scheduledAt:n.scheduled_at,durationMinutes:n.duration_minutes,creatorId:n.creator_id,fanId:n.fan_id,creatorStartedAt:n.creator_started_at,creatorJoinedAt:n.creator_joined_at,fanJoinedAt:n.fan_joined_at,recordingStartedAt:n.recording_started_at,recordingStoppedAt:n.recording_stopped_at}}async function C7(s){const{data:n,error:a}=await ie.from("meets").select("*").ilike("meeting_link",`%${s}%`).single();return a||!n?(console.error("Error fetching meeting by link:",a),null):{id:n.id,status:n.status,scheduledAt:n.scheduled_at,durationMinutes:n.duration_minutes,creatorId:n.creator_id,fanId:n.fan_id,creatorStartedAt:n.creator_started_at,creatorJoinedAt:n.creator_joined_at,fanJoinedAt:n.fan_joined_at,recordingStartedAt:n.recording_started_at,recordingStoppedAt:n.recording_stopped_at}}async function M0e(s){console.log(" onCreatorStreamStarted called with meetId:",s);const n=new Date,a=await Eb(s);if(!a)return console.error(" Meeting not found for id:",s),{success:!1,error:"Meeting not found"};if(console.log(" Meeting found:",{id:a.id,status:a.status,scheduledAt:a.scheduledAt}),a.status!=="scheduled"&&a.status!=="live")return console.error(" Meeting not in startable state:",a.status),{success:!1,error:`Meeting is not in a startable state (current: ${a.status})`};if(a.status==="live")return console.log(" Meeting already live, returning success"),{success:!0};const l=new Date(a.scheduledAt),u=new Date(a.scheduledAt);if(u.setMinutes(u.getMinutes()+a.durationMinutes),n>=u)return console.error(" Meeting past end time"),{success:!1,error:"Cannot start meeting after scheduled end time"};const f=n<l,g=f?Math.floor((l.getTime()-n.getTime())/1e3):-Math.floor((n.getTime()-l.getTime())/1e3);console.log(" Attempting to update meeting to live...");const{error:v,data:y}=await ie.from("meets").update({status:"live",creator_started_at:n.toISOString()}).eq("id",s).select();return v?(console.error(" Error updating meeting status:",v),{success:!1,error:`Failed to update meeting: ${v.message}`}):(console.log(" Update result:",y),await Vg(s,"CREATOR_STREAM_STARTED",{started_at:n.toISOString(),scheduled_start:a.scheduledAt,started_early:f,seconds_from_scheduled:g}),console.log(" onCreatorStreamStarted completed successfully"),{success:!0})}async function F0e(s,n){const a=new Date,l=await Eb(s);if(!l)return{success:!1,error:"Meeting not found"};if(l.creatorId!==n)return{success:!1,error:"User is not the creator of this meeting"};const{error:u}=await ie.from("meets").update({creator_joined_at:a.toISOString()}).eq("id",s);return u?(console.error("Error updating creator joined time:",u),{success:!1,error:"Failed to update meeting"}):(await Vg(s,"CREATOR_JOINED",{creator_id:n,joined_at:a.toISOString()}),await vz(s),{success:!0})}async function NR(s,n){const a=new Date,l=await Eb(s);if(!l)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting not found"};if(l.fanId!==n)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"User is not the fan for this meeting"};if(l.status==="cancelled_no_show_creator"||l.status==="cancelled")return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting has been cancelled",meetingEnded:!0};if(l.status==="completed")return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting has already ended",meetingEnded:!0};const u=new Date(l.scheduledAt);if(u.setMinutes(u.getMinutes()+l.durationMinutes),a>=u)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting time has ended",meetingEnded:!0};if(l.status==="scheduled")return await Vg(s,"FAN_WAITING_ROOM",{fan_id:n,attempted_at:a.toISOString()}),{success:!0,showWaitingRoom:!0,canJoin:!1};if(l.status==="live"){if(!l.fanJoinedAt){const{error:f}=await ie.from("meets").update({fan_joined_at:a.toISOString()}).eq("id",s);f&&console.error("Error updating fan joined time:",f),await Vg(s,"FAN_JOINED",{fan_id:n,joined_at:a.toISOString(),scheduled_start:l.scheduledAt,joined_late_by_seconds:a>new Date(l.scheduledAt)?Math.floor((a.getTime()-new Date(l.scheduledAt).getTime())/1e3):0}),await vz(s)}return{success:!0,showWaitingRoom:!1,canJoin:!0}}return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Unknown meeting state"}}async function vz(s){const n=await Eb(s);if(n&&n.status==="live"&&!n.recordingStartedAt&&n.creatorStartedAt&&n.fanJoinedAt){const a=new Date().toISOString(),{error:l}=await ie.from("meets").update({recording_started_at:a}).eq("id",s);if(l){console.error("Error updating recording start time:",l);return}await Vg(s,"RECORDING_STARTED",{started_at:a}),console.log(`Recording started for meeting ${s}`)}}function AR(s){const n=new Date,a=new Date(s.scheduledAt);a.setMinutes(a.getMinutes()+s.durationMinutes);const l=a.getTime()-n.getTime();return Math.max(0,Math.floor(l/1e3))}function yz(s){const n=new Date,a=new Date(s.scheduledAt),l=new Date(s.scheduledAt);l.setMinutes(l.getMinutes()+s.durationMinutes);const u=Math.floor((a.getTime()-n.getTime())/1e3),f=Math.floor((l.getTime()-n.getTime())/1e3);return{beforeStart:n<a,duringMeeting:n>=a&&n<l,afterEnd:n>=l,secondsUntilStart:u,secondsUntilEnd:f}}const IR={},xz=(IR==null?void 0:IR.VITE_AGORA_APP_ID)||"4cc829c3ab144792a3f65fea1f905671";console.log(" Agora APP_ID:",xz);const U0e=()=>{const{meetId:s}=nI(),n=Fs(),{user:a}=mr(),l=L.useMemo(()=>Ez.createClient({mode:"rtc",codec:"vp8"}),[]),u=L.useCallback(()=>(a==null?void 0:a.role)==="creator"?"/creator/meets":(a==null?void 0:a.role)==="fan"?"/fan/meets":"/",[a==null?void 0:a.role]);return s?a?o.jsx(rz,{client:l,children:o.jsx(V0e,{user:a,meetId:s,onLeave:()=>n(u())})}):o.jsx(Dx,{message:"Please log in to join the meeting",onBack:()=>n("/login")}):o.jsx(Dx,{message:"Invalid Meeting Link",onBack:()=>n("/")})};function V0e({user:s,meetId:n,onLeave:a}){const[l,u]=L.useState("loading"),[f,g]=L.useState(null),[v,y]=L.useState(!1),[w,T]=L.useState(null),[S,I]=L.useState(null),j=L.useRef(null),B=L.useRef(null),A=()=>{j.current&&(clearInterval(j.current),j.current=null)},F=()=>{B.current&&(console.log(" Cleaning up Realtime subscription"),ie.removeChannel(B.current),B.current=null)},D=O=>{if(B.current)return;console.log(" Setting up Supabase Realtime for meeting:",O);const V=ie.channel(`meeting-${O}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"meets",filter:`id=eq.${O}`},async G=>{console.log(" Realtime update received:",G.new);const J=G.new;if(g($=>$?{...$,status:J.status,creatorStartedAt:J.creator_started_at,creatorJoinedAt:J.creator_joined_at,fanJoinedAt:J.fan_joined_at}:null),J.status==="live"&&J.creator_started_at&&(console.log(" Creator started meeting! (Realtime)"),A(),(await NR(O,s.id)).canJoin)){u("live");const q=new Date(J.scheduled_at);q.setMinutes(q.getMinutes()+J.duration_minutes);const ee=Math.max(0,Math.floor((q.getTime()-Date.now())/1e3));T(ee)}(J.status==="cancelled_no_show_creator"||J.status==="cancelled")&&(console.log(" Meeting cancelled (Realtime)"),A(),u("cancelled")),J.status==="completed"&&(console.log(" Meeting completed (Realtime)"),u("ended")),J.fan_joined_at&&console.log(" Fan joined the meeting! (Realtime)")}).subscribe(G=>{console.log(" Realtime subscription status:",G)});B.current=V},R=O=>{j.current||(console.log(" Starting polling + Realtime for meeting updates..."),D(O),j.current=setInterval(async()=>{const V=await C7(n);V&&(V.status==="live"&&V.creatorStartedAt&&(console.log(" Creator started! (Polling)"),A(),(await NR(V.id,s.id)).canJoin&&(g(V),u("live"),T(AR(V)))),V.status==="cancelled_no_show_creator"&&(console.log(" Meeting cancelled (Polling)"),A(),u("cancelled")))},3e3))};return L.useEffect(()=>{async function O(){const V=await C7(n);if(!V){I("Meeting not found"),u("error");return}g(V);const G=V.creatorId===s.id,J=V.fanId===s.id;if(y(G),!G&&!J){I("You are not a participant of this meeting"),u("error");return}if(V.status==="cancelled_no_show_creator"||V.status==="cancelled"){u("cancelled");return}if(V.status==="completed"){u("ended");return}if(yz(V).afterEnd){u("ended");return}if(G)D(V.id),u("live"),T(AR(V));else if(V.status==="live"&&V.creatorStartedAt){const q=await NR(V.id,s.id);q.canJoin?(u("live"),T(AR(V))):q.meetingEnded?u("ended"):(u("waiting_room"),R(V.id))}else u("waiting_room"),R(V.id)}return O(),()=>{A(),F()}},[n,s.id]),L.useEffect(()=>{if(l!=="live"||w===null)return;const O=setInterval(()=>{T(V=>V===null||V<=1?(clearInterval(O),u("ended"),0):V-1)},1e3);return()=>clearInterval(O)},[l,w]),l==="loading"?o.jsx(B0e,{}):l==="error"?o.jsx(Dx,{message:S||"An error occurred",onBack:a}):l==="cancelled"?o.jsx(W0e,{isCreator:v,onBack:a}):l==="ended"?o.jsx(G0e,{onBack:a}):l==="waiting_room"&&f?o.jsx(H0e,{meeting:f,onBack:a}):l==="live"&&f?o.jsx(z0e,{user:s,meeting:f,meetId:n,isCreator:v,timeLeft:w,onLeave:a}):o.jsx(Dx,{message:"Unknown state",onBack:a})}function B0e(){return o.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:o.jsxs("div",{className:"text-center text-white",children:[o.jsx("div",{className:"mb-4 text-4xl",children:""}),o.jsx("p",{className:"text-lg",children:"Loading meeting..."})]})})}function Dx({message:s,onBack:n}){return o.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:o.jsxs(pe,{className:"max-w-md bg-gray-800 p-8 text-center",children:[o.jsx("div",{className:"mb-4 text-4xl",children:""}),o.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Error"}),o.jsx("p",{className:"mb-6 text-gray-400",children:s}),o.jsx(ue,{onClick:n,children:"Go Back"})]})})}function W0e({isCreator:s,onBack:n}){return o.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:o.jsxs(pe,{className:"max-w-md bg-gray-800 p-8 text-center",children:[o.jsx("div",{className:"mb-4 text-4xl",children:""}),o.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Meeting Cancelled"}),o.jsx("p",{className:"mb-6 text-gray-400",children:s?"This meeting was cancelled because you did not start before the scheduled time.":"This meeting was cancelled because the creator did not show up. A refund has been issued."}),o.jsx(ue,{onClick:n,children:"Go Back"})]})})}function G0e({onBack:s}){return o.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:o.jsxs(pe,{className:"max-w-md bg-gray-800 p-8 text-center",children:[o.jsx("div",{className:"mb-4 text-4xl",children:""}),o.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Meeting Ended"}),o.jsx("p",{className:"mb-6 text-gray-400",children:"This meeting has ended. Thank you for participating!"}),o.jsx(ue,{onClick:s,children:"Go Back"})]})})}function H0e({meeting:s,onBack:n}){const a=yz(s),l=new Date(s.scheduledAt).toLocaleString();return o.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:o.jsxs(pe,{className:"max-w-lg bg-gray-800 p-8 text-center",children:[o.jsx("div",{className:"mb-4 text-6xl",children:""}),o.jsx("h2",{className:"mb-2 text-2xl font-semibold text-white",children:"Waiting Room"}),o.jsx("p",{className:"mb-4 text-gray-400",children:"The creator hasn't started the meeting yet. Please wait..."}),o.jsxs("div",{className:"mb-6 rounded-lg bg-gray-700 p-4",children:[o.jsxs("p",{className:"text-sm text-gray-300",children:[o.jsx("strong",{children:"Scheduled Start:"})," ",l]}),o.jsxs("p",{className:"text-sm text-gray-300",children:[o.jsx("strong",{children:"Duration:"})," ",s.durationMinutes," minutes"]}),a.beforeStart&&o.jsxs("p",{className:"mt-2 text-sm text-yellow-400",children:[" Meeting starts in ",Math.ceil(a.secondsUntilStart/60)," minutes"]})]}),o.jsxs("div",{className:"mb-4 flex items-center justify-center gap-2",children:[o.jsx("div",{className:"h-3 w-3 animate-pulse rounded-full bg-yellow-500"}),o.jsx("span",{className:"text-sm text-yellow-400",children:"Waiting for creator to start..."})]}),o.jsx("p",{className:"mb-6 text-xs text-gray-500",children:"You'll automatically join when the creator starts the meeting."}),o.jsx(ue,{variant:"secondary",onClick:n,children:"Leave Waiting Room"})]})})}function z0e({user:s,meeting:n,meetId:a,isCreator:l,timeLeft:u,onLeave:f}){const[g,v]=L.useState(!1),[y,w]=L.useState(!1),[T,S]=L.useState(null),[I,j]=L.useState(!0),B=n.id;console.log(" Agora channel name:",B,"(meeting.id, not URL param)"),L.useEffect(()=>{console.log(" Testing mode - using null token for channel:",B),j(!1),v(!0)},[B]);const{isConnected:A}=nz({appid:xz,channel:B,token:null},g),{localMicrophoneTrack:F}=az(g),{localCameraTrack:D}=oz(g);iz([F,D]);const R=cz();L.useEffect(()=>{console.log(" Agora connection status:",A?"CONNECTED":"DISCONNECTED"),console.log(" Remote users count:",R.length),R.length>0&&console.log(" Remote users:",R.map(V=>V.uid))},[A,R]),L.useEffect(()=>{l&&!y&&(w(!0),console.log(" Creator entered LiveCall view, marking meeting as LIVE immediately"),console.log(" Meeting ID:",n.id),M0e(n.id).then(V=>{V.success?console.log(" Meeting marked as LIVE in database - fan can now join"):console.error(" Failed to mark meeting as LIVE:",V.error)}).catch(V=>{console.error(" Error calling onCreatorStreamStarted:",V)}),F0e(n.id,s.id).catch(V=>{console.error("Error in onCreatorJoined:",V)}))},[l,y,n.id,s.id]);const O=V=>{const G=Math.floor(V/60),J=V%60;return`${G}:${J.toString().padStart(2,"0")}`};return o.jsxs("div",{className:"flex h-screen w-full flex-col bg-gray-900 text-white",children:[o.jsxs("div",{className:"flex items-center justify-between bg-gray-800 px-6 py-4 shadow-md",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("h1",{className:"text-lg font-semibold",children:"FanMeet Call"}),o.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs ${l?"bg-purple-600":"bg-blue-600"}`,children:l?"Creator":"Fan"})]}),o.jsx("div",{className:`rounded-full px-4 py-1 text-sm font-bold ${u!==null&&u<60?"bg-red-500":"bg-gray-700"}`,children:u!==null?O(u):"Loading..."}),o.jsx(ue,{variant:"secondary",size:"sm",onClick:f,children:"Leave Call"})]}),o.jsxs("div",{className:"flex flex-1 items-center justify-center gap-4 p-4",children:[o.jsxs("div",{className:"relative aspect-video h-full max-h-[400px] w-full max-w-[600px] overflow-hidden rounded-xl bg-gray-800 shadow-lg",children:[o.jsx(fz,{audioTrack:F,videoTrack:D,cameraOn:!0,micOn:!0,playAudio:!1,playVideo:!0,className:"h-full w-full object-cover"}),o.jsxs("div",{className:"absolute bottom-4 left-4 rounded-md bg-black/50 px-2 py-1 text-sm",children:["You (",(s==null?void 0:s.username)||"Me",")"]})]}),R.map(V=>o.jsxs("div",{className:"relative aspect-video h-full max-h-[400px] w-full max-w-[600px] overflow-hidden rounded-xl bg-gray-800 shadow-lg",children:[o.jsx(_z,{user:V,className:"h-full w-full object-cover"}),o.jsx("div",{className:"absolute bottom-4 left-4 rounded-md bg-black/50 px-2 py-1 text-sm",children:l?"Fan":"Creator"})]},V.uid)),R.length===0&&o.jsx("div",{className:"flex aspect-video h-full max-h-[400px] w-full max-w-[600px] items-center justify-center rounded-xl bg-gray-800 text-gray-400",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"mb-2 text-4xl",children:""}),o.jsxs("p",{children:["Waiting for ",l?"fan":"creator"," to join..."]})]})})]}),o.jsxs("div",{className:"flex items-center justify-center gap-4 bg-gray-800 py-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[o.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500 animate-pulse"}),o.jsx("span",{children:"Recording"})]}),o.jsx("span",{className:"text-gray-600",children:"|"}),o.jsx("span",{className:"text-sm text-gray-400",children:"Call ends automatically at scheduled time. No extensions."})]})]})}const OR=({allowedRoles:s,children:n})=>{const{isAuthenticated:a,user:l,isLoading:u}=mr(),f=Tc();if(u)return null;if(!a||!l){const g=encodeURIComponent(f.pathname+f.search);return o.jsx(rp,{to:`/auth?redirect=${g}`,replace:!0})}if(s&&!s.includes(l.role)){const g={fan:"/fan",creator:"/creator",admin:"/admin"};return o.jsx(rp,{to:g[l.role],replace:!0})}return o.jsx(o.Fragment,{children:n})},K0e=()=>o.jsx("div",{className:"flex h-full w-full items-center justify-center",children:o.jsxs("div",{className:"flex flex-col items-center gap-3 text-[#6C757D]",children:[o.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-[#FFE5D9] border-l-[#FF6B35]"}),o.jsx("span",{children:"Loading"})]})});function q0e(){return o.jsx(L.Suspense,{fallback:o.jsx(K0e,{}),children:o.jsx(fme,{children:o.jsx(ybe,{children:o.jsx(twe,{children:o.jsx(gme,{children:o.jsxs(Khe,{children:[o.jsx(ut,{path:"meet/:meetId",element:o.jsx(U0e,{})}),o.jsxs(ut,{element:o.jsx(mme,{}),children:[o.jsx(ut,{index:!0,element:o.jsx(mbe,{})}),o.jsx(ut,{path:"auth",element:o.jsx(_be,{})}),o.jsx(ut,{path:"fanmeet/admin/superadmin",element:o.jsx(Ebe,{})}),o.jsx(ut,{path:"browse-events",element:o.jsx(xbe,{})}),o.jsx(ut,{path:"how-it-works",element:o.jsx(bbe,{})}),o.jsx(ut,{path:"for-creators",element:o.jsx(Sbe,{})}),o.jsx(ut,{path:"events/:eventId",element:o.jsx(ZSe,{})}),o.jsx(ut,{path:":username",element:o.jsx(YSe,{})})]}),o.jsxs(ut,{path:"fan",element:o.jsx(OR,{allowedRoles:["fan"],children:o.jsx(cR,{role:"fan"})}),children:[o.jsx(ut,{index:!0,element:o.jsx(Rbe,{})}),o.jsx(ut,{path:"all-events",element:o.jsx(Hbe,{})}),o.jsx(ut,{path:"bids",element:o.jsx(Nbe,{})}),o.jsx(ut,{path:"meets",element:o.jsx(Ibe,{})}),o.jsx(ut,{path:"wallet",element:o.jsx(Obe,{})}),o.jsx(ut,{path:"following",element:o.jsx(Dbe,{})}),o.jsx(ut,{path:"history",element:o.jsx(kbe,{})}),o.jsx(ut,{path:"messages",element:o.jsx(Ube,{})}),o.jsx(ut,{path:"notifications",element:o.jsx(jbe,{})}),o.jsx(ut,{path:"settings",element:o.jsx(Lbe,{})}),o.jsx(ut,{path:"support",element:o.jsx(Bbe,{})}),o.jsx(ut,{path:"*",element:o.jsx(rp,{to:".",replace:!0})})]}),o.jsxs(ut,{path:"creator",element:o.jsx(OR,{allowedRoles:["creator"],children:o.jsx(cR,{role:"creator"})}),children:[o.jsx(ut,{index:!0,element:o.jsx($be,{})}),o.jsx(ut,{path:"events",element:o.jsx(Xbe,{})}),o.jsx(ut,{path:"events/new",element:o.jsx(Zbe,{})}),o.jsx(ut,{path:"profile-setup",element:o.jsx(rwe,{})}),o.jsx(ut,{path:"earnings",element:o.jsx(iwe,{})}),o.jsx(ut,{path:"withdrawals",element:o.jsx(dwe,{})}),o.jsx(ut,{path:"meets",element:o.jsx(pwe,{})}),o.jsx(ut,{path:"followers",element:o.jsx(fwe,{})}),o.jsx(ut,{path:"messages",element:o.jsx($we,{})}),o.jsx(ut,{path:"notifications",element:o.jsx(mwe,{})}),o.jsx(ut,{path:"settings",element:o.jsx(vwe,{})}),o.jsx(ut,{path:"support",element:o.jsx(Jwe,{})}),o.jsx(ut,{path:"*",element:o.jsx(rp,{to:".",replace:!0})})]}),o.jsxs(ut,{path:"admin",element:o.jsx(OR,{allowedRoles:["admin"],children:o.jsx(cR,{role:"admin"})}),children:[o.jsx(ut,{index:!0,element:o.jsx(Qwe,{})}),o.jsx(ut,{path:"users",element:o.jsx(tSe,{})}),o.jsx(ut,{path:"creators",element:o.jsx(sSe,{})}),o.jsx(ut,{path:"fans",element:o.jsx(iSe,{})}),o.jsx(ut,{path:"events",element:o.jsx(oSe,{})}),o.jsx(ut,{path:"featured",element:o.jsx(cSe,{})}),o.jsx(ut,{path:"announcements",element:o.jsx(dSe,{})}),o.jsx(ut,{path:"payments",element:o.jsx(hSe,{})}),o.jsx(ut,{path:"withdrawals",element:o.jsx(pSe,{})}),o.jsx(ut,{path:"refunds",element:o.jsx(mSe,{})}),o.jsx(ut,{path:"revenue-analytics",element:o.jsx(gSe,{})}),o.jsx(ut,{path:"platform-commission",element:o.jsx(_Se,{})}),o.jsx(ut,{path:"business-analytics",element:o.jsx(ESe,{})}),o.jsx(ut,{path:"user-analytics",element:o.jsx(vSe,{})}),o.jsx(ut,{path:"revenue-reports",element:o.jsx(ySe,{})}),o.jsx(ut,{path:"event-analytics",element:o.jsx(xSe,{})}),o.jsx(ut,{path:"audit-logs",element:o.jsx(wSe,{})}),o.jsx(ut,{path:"support-tickets",element:o.jsx(TSe,{})}),o.jsx(ut,{path:"reports-flags",element:o.jsx(NSe,{})}),o.jsx(ut,{path:"disputes",element:o.jsx(ISe,{})}),o.jsx(ut,{path:"settings/general",element:o.jsx(OSe,{})}),o.jsx(ut,{path:"settings/pricing",element:o.jsx(DSe,{})}),o.jsx(ut,{path:"settings/email-templates",element:o.jsx(kSe,{})}),o.jsx(ut,{path:"settings/notifications",element:o.jsx(MSe,{})}),o.jsx(ut,{path:"settings/security",element:o.jsx(FSe,{})}),o.jsx(ut,{path:"system/logs",element:o.jsx(USe,{})}),o.jsx(ut,{path:"system/bulk-actions",element:o.jsx(BSe,{})}),o.jsx(ut,{path:"system/backup",element:o.jsx(WSe,{})}),o.jsx(ut,{path:"debug/meets",element:o.jsx(KSe,{})}),o.jsx(ut,{path:"meeting-logs",element:o.jsx(qSe,{})}),o.jsx(ut,{path:"profile",element:o.jsx(zSe,{})}),o.jsx(ut,{path:"*",element:o.jsx(rp,{to:".",replace:!0})})]}),o.jsx(ut,{path:"*",element:o.jsx(rp,{to:"/",replace:!0})})]})})})})})})}const Y0e=new ehe;DR.createRoot(document.getElementById("root")).render(o.jsx(dA.StrictMode,{children:o.jsx(rhe,{client:Y0e,children:o.jsx(tpe,{children:o.jsx(q0e,{})})})}));export{k7 as g};
