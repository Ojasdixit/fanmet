var ale=Object.defineProperty;var Q4=r=>{throw TypeError(r)};var ole=(r,n,o)=>n in r?ale(r,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[n]=o;var Tf=(r,n,o)=>ole(r,typeof n!="symbol"?n+"":n,o),ST=(r,n,o)=>n.has(r)||Q4("Cannot "+o);var et=(r,n,o)=>(ST(r,n,"read from private field"),o?o.call(r):n.get(r)),Ms=(r,n,o)=>n.has(r)?Q4("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(r):n.set(r,o),rs=(r,n,o,l)=>(ST(r,n,"write to private field"),l?l.call(r,o):n.set(r,o),o),Nn=(r,n,o)=>(ST(r,n,"access private method"),o);var ty=(r,n,o,l)=>({set _(u){rs(r,n,u,o)},get _(){return et(r,n,l)}});function cle(r,n){for(var o=0;o<n.length;o++){const l=n[o];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in r)){const m=Object.getOwnPropertyDescriptor(l,u);m&&Object.defineProperty(r,u,m.get?m:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const g of m.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function o(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(u){if(u.ep)return;u.ep=!0;const m=o(u);fetch(u.href,m)}})();var wa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U7(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function lle(r){if(r.__esModule)return r;var n=r.default;if(typeof n=="function"){var o=function l(){return this instanceof l?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};o.prototype=n.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(r).forEach(function(l){var u=Object.getOwnPropertyDescriptor(r,l);Object.defineProperty(o,l,u.get?u:{enumerable:!0,get:function(){return r[l]}})}),o}var V7={exports:{}},Ox={},B7={exports:{}},ms={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gg=Symbol.for("react.element"),dle=Symbol.for("react.portal"),ule=Symbol.for("react.fragment"),hle=Symbol.for("react.strict_mode"),ple=Symbol.for("react.profiler"),mle=Symbol.for("react.provider"),fle=Symbol.for("react.context"),gle=Symbol.for("react.forward_ref"),_le=Symbol.for("react.suspense"),vle=Symbol.for("react.memo"),Ele=Symbol.for("react.lazy"),Z4=Symbol.iterator;function yle(r){return r===null||typeof r!="object"?null:(r=Z4&&r[Z4]||r["@@iterator"],typeof r=="function"?r:null)}var W7={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},G7=Object.assign,H7={};function Fp(r,n,o){this.props=r,this.context=n,this.refs=H7,this.updater=o||W7}Fp.prototype.isReactComponent={};Fp.prototype.setState=function(r,n){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,n,"setState")};Fp.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function z7(){}z7.prototype=Fp.prototype;function aA(r,n,o){this.props=r,this.context=n,this.refs=H7,this.updater=o||W7}var oA=aA.prototype=new z7;oA.constructor=aA;G7(oA,Fp.prototype);oA.isPureReactComponent=!0;var e3=Array.isArray,K7=Object.prototype.hasOwnProperty,cA={current:null},q7={key:!0,ref:!0,__self:!0,__source:!0};function Y7(r,n,o){var l,u={},m=null,g=null;if(n!=null)for(l in n.ref!==void 0&&(g=n.ref),n.key!==void 0&&(m=""+n.key),n)K7.call(n,l)&&!q7.hasOwnProperty(l)&&(u[l]=n[l]);var E=arguments.length-2;if(E===1)u.children=o;else if(1<E){for(var y=Array(E),x=0;x<E;x++)y[x]=arguments[x+2];u.children=y}if(r&&r.defaultProps)for(l in E=r.defaultProps,E)u[l]===void 0&&(u[l]=E[l]);return{$$typeof:Gg,type:r,key:m,ref:g,props:u,_owner:cA.current}}function xle(r,n){return{$$typeof:Gg,type:r.type,key:n,ref:r.ref,props:r.props,_owner:r._owner}}function lA(r){return typeof r=="object"&&r!==null&&r.$$typeof===Gg}function ble(r){var n={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(o){return n[o]})}var t3=/\/+/g;function CT(r,n){return typeof r=="object"&&r!==null&&r.key!=null?ble(""+r.key):n.toString(36)}function Dy(r,n,o,l,u){var m=typeof r;(m==="undefined"||m==="boolean")&&(r=null);var g=!1;if(r===null)g=!0;else switch(m){case"string":case"number":g=!0;break;case"object":switch(r.$$typeof){case Gg:case dle:g=!0}}if(g)return g=r,u=u(g),r=l===""?"."+CT(g,0):l,e3(u)?(o="",r!=null&&(o=r.replace(t3,"$&/")+"/"),Dy(u,n,o,"",function(x){return x})):u!=null&&(lA(u)&&(u=xle(u,o+(!u.key||g&&g.key===u.key?"":(""+u.key).replace(t3,"$&/")+"/")+r)),n.push(u)),1;if(g=0,l=l===""?".":l+":",e3(r))for(var E=0;E<r.length;E++){m=r[E];var y=l+CT(m,E);g+=Dy(m,n,o,y,u)}else if(y=yle(r),typeof y=="function")for(r=y.call(r),E=0;!(m=r.next()).done;)m=m.value,y=l+CT(m,E++),g+=Dy(m,n,o,y,u);else if(m==="object")throw n=String(r),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return g}function sy(r,n,o){if(r==null)return r;var l=[],u=0;return Dy(r,l,"","",function(m){return n.call(o,m,u++)}),l}function wle(r){if(r._status===-1){var n=r._result;n=n(),n.then(function(o){(r._status===0||r._status===-1)&&(r._status=1,r._result=o)},function(o){(r._status===0||r._status===-1)&&(r._status=2,r._result=o)}),r._status===-1&&(r._status=0,r._result=n)}if(r._status===1)return r._result.default;throw r._result}var Yn={current:null},Oy={transition:null},Sle={ReactCurrentDispatcher:Yn,ReactCurrentBatchConfig:Oy,ReactCurrentOwner:cA};function $7(){throw Error("act(...) is not supported in production builds of React.")}ms.Children={map:sy,forEach:function(r,n,o){sy(r,function(){n.apply(this,arguments)},o)},count:function(r){var n=0;return sy(r,function(){n++}),n},toArray:function(r){return sy(r,function(n){return n})||[]},only:function(r){if(!lA(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};ms.Component=Fp;ms.Fragment=ule;ms.Profiler=ple;ms.PureComponent=aA;ms.StrictMode=hle;ms.Suspense=_le;ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sle;ms.act=$7;ms.cloneElement=function(r,n,o){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var l=G7({},r.props),u=r.key,m=r.ref,g=r._owner;if(n!=null){if(n.ref!==void 0&&(m=n.ref,g=cA.current),n.key!==void 0&&(u=""+n.key),r.type&&r.type.defaultProps)var E=r.type.defaultProps;for(y in n)K7.call(n,y)&&!q7.hasOwnProperty(y)&&(l[y]=n[y]===void 0&&E!==void 0?E[y]:n[y])}var y=arguments.length-2;if(y===1)l.children=o;else if(1<y){E=Array(y);for(var x=0;x<y;x++)E[x]=arguments[x+2];l.children=E}return{$$typeof:Gg,type:r.type,key:u,ref:m,props:l,_owner:g}};ms.createContext=function(r){return r={$$typeof:fle,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:mle,_context:r},r.Consumer=r};ms.createElement=Y7;ms.createFactory=function(r){var n=Y7.bind(null,r);return n.type=r,n};ms.createRef=function(){return{current:null}};ms.forwardRef=function(r){return{$$typeof:gle,render:r}};ms.isValidElement=lA;ms.lazy=function(r){return{$$typeof:Ele,_payload:{_status:-1,_result:r},_init:wle}};ms.memo=function(r,n){return{$$typeof:vle,type:r,compare:n===void 0?null:n}};ms.startTransition=function(r){var n=Oy.transition;Oy.transition={};try{r()}finally{Oy.transition=n}};ms.unstable_act=$7;ms.useCallback=function(r,n){return Yn.current.useCallback(r,n)};ms.useContext=function(r){return Yn.current.useContext(r)};ms.useDebugValue=function(){};ms.useDeferredValue=function(r){return Yn.current.useDeferredValue(r)};ms.useEffect=function(r,n){return Yn.current.useEffect(r,n)};ms.useId=function(){return Yn.current.useId()};ms.useImperativeHandle=function(r,n,o){return Yn.current.useImperativeHandle(r,n,o)};ms.useInsertionEffect=function(r,n){return Yn.current.useInsertionEffect(r,n)};ms.useLayoutEffect=function(r,n){return Yn.current.useLayoutEffect(r,n)};ms.useMemo=function(r,n){return Yn.current.useMemo(r,n)};ms.useReducer=function(r,n,o){return Yn.current.useReducer(r,n,o)};ms.useRef=function(r){return Yn.current.useRef(r)};ms.useState=function(r){return Yn.current.useState(r)};ms.useSyncExternalStore=function(r,n,o){return Yn.current.useSyncExternalStore(r,n,o)};ms.useTransition=function(){return Yn.current.useTransition()};ms.version="18.3.1";B7.exports=ms;var O=B7.exports;const dA=U7(O),Cle=cle({__proto__:null,default:dA},[O]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tle=O,Nle=Symbol.for("react.element"),Rle=Symbol.for("react.fragment"),Ale=Object.prototype.hasOwnProperty,Ile=Tle.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Dle={key:!0,ref:!0,__self:!0,__source:!0};function X7(r,n,o){var l,u={},m=null,g=null;o!==void 0&&(m=""+o),n.key!==void 0&&(m=""+n.key),n.ref!==void 0&&(g=n.ref);for(l in n)Ale.call(n,l)&&!Dle.hasOwnProperty(l)&&(u[l]=n[l]);if(r&&r.defaultProps)for(l in n=r.defaultProps,n)u[l]===void 0&&(u[l]=n[l]);return{$$typeof:Nle,type:r,key:m,ref:g,props:u,_owner:Ile.current}}Ox.Fragment=Rle;Ox.jsx=X7;Ox.jsxs=X7;V7.exports=Ox;var i=V7.exports,DN={},J7={exports:{}},Bi={},Q7={exports:{}},Z7={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function n(ae,be){var We=ae.length;ae.push(be);e:for(;0<We;){var it=We-1>>>1,Ge=ae[it];if(0<u(Ge,be))ae[it]=be,ae[We]=Ge,We=it;else break e}}function o(ae){return ae.length===0?null:ae[0]}function l(ae){if(ae.length===0)return null;var be=ae[0],We=ae.pop();if(We!==be){ae[0]=We;e:for(var it=0,Ge=ae.length,pt=Ge>>>1;it<pt;){var Ze=2*(it+1)-1,Me=ae[Ze],Ue=Ze+1,ke=ae[Ue];if(0>u(Me,We))Ue<Ge&&0>u(ke,Me)?(ae[it]=ke,ae[Ue]=We,it=Ue):(ae[it]=Me,ae[Ze]=We,it=Ze);else if(Ue<Ge&&0>u(ke,We))ae[it]=ke,ae[Ue]=We,it=Ue;else break e}}return be}function u(ae,be){var We=ae.sortIndex-be.sortIndex;return We!==0?We:ae.id-be.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;r.unstable_now=function(){return m.now()}}else{var g=Date,E=g.now();r.unstable_now=function(){return g.now()-E}}var y=[],x=[],S=1,C=null,N=3,M=!1,G=!1,I=!1,P=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function D(ae){for(var be=o(x);be!==null;){if(be.callback===null)l(x);else if(be.startTime<=ae)l(x),be.sortIndex=be.expirationTime,n(y,be);else break;be=o(x)}}function V(ae){if(I=!1,D(ae),!G)if(o(y)!==null)G=!0,Le(W);else{var be=o(x);be!==null&&fe(V,be.startTime-ae)}}function W(ae,be){G=!1,I&&(I=!1,L(J),J=-1),M=!0;var We=N;try{for(D(be),C=o(y);C!==null&&(!(C.expirationTime>be)||ae&&!pe());){var it=C.callback;if(typeof it=="function"){C.callback=null,N=C.priorityLevel;var Ge=it(C.expirationTime<=be);be=r.unstable_now(),typeof Ge=="function"?C.callback=Ge:C===o(y)&&l(y),D(be)}else l(y);C=o(y)}if(C!==null)var pt=!0;else{var Ze=o(x);Ze!==null&&fe(V,Ze.startTime-be),pt=!1}return pt}finally{C=null,N=We,M=!1}}var q=!1,H=null,J=-1,ee=5,ne=-1;function pe(){return!(r.unstable_now()-ne<ee)}function Ee(){if(H!==null){var ae=r.unstable_now();ne=ae;var be=!0;try{be=H(!0,ae)}finally{be?ge():(q=!1,H=null)}}else q=!1}var ge;if(typeof R=="function")ge=function(){R(Ee)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,le=he.port2;he.port1.onmessage=Ee,ge=function(){le.postMessage(null)}}else ge=function(){P(Ee,0)};function Le(ae){H=ae,q||(q=!0,ge())}function fe(ae,be){J=P(function(){ae(r.unstable_now())},be)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(ae){ae.callback=null},r.unstable_continueExecution=function(){G||M||(G=!0,Le(W))},r.unstable_forceFrameRate=function(ae){0>ae||125<ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<ae?Math.floor(1e3/ae):5},r.unstable_getCurrentPriorityLevel=function(){return N},r.unstable_getFirstCallbackNode=function(){return o(y)},r.unstable_next=function(ae){switch(N){case 1:case 2:case 3:var be=3;break;default:be=N}var We=N;N=be;try{return ae()}finally{N=We}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(ae,be){switch(ae){case 1:case 2:case 3:case 4:case 5:break;default:ae=3}var We=N;N=ae;try{return be()}finally{N=We}},r.unstable_scheduleCallback=function(ae,be,We){var it=r.unstable_now();switch(typeof We=="object"&&We!==null?(We=We.delay,We=typeof We=="number"&&0<We?it+We:it):We=it,ae){case 1:var Ge=-1;break;case 2:Ge=250;break;case 5:Ge=1073741823;break;case 4:Ge=1e4;break;default:Ge=5e3}return Ge=We+Ge,ae={id:S++,callback:be,priorityLevel:ae,startTime:We,expirationTime:Ge,sortIndex:-1},We>it?(ae.sortIndex=We,n(x,ae),o(y)===null&&ae===o(x)&&(I?(L(J),J=-1):I=!0,fe(V,We-it))):(ae.sortIndex=Ge,n(y,ae),G||M||(G=!0,Le(W))),ae},r.unstable_shouldYield=pe,r.unstable_wrapCallback=function(ae){var be=N;return function(){var We=N;N=be;try{return ae.apply(this,arguments)}finally{N=We}}}})(Z7);Q7.exports=Z7;var Ole=Q7.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jle=O,Vi=Ole;function rt(r){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+r,o=1;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+r+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var e9=new Set,hg={};function du(r,n){Cp(r,n),Cp(r+"Capture",n)}function Cp(r,n){for(hg[r]=n,r=0;r<n.length;r++)e9.add(n[r])}var yc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ON=Object.prototype.hasOwnProperty,Ple=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,s3={},r3={};function kle(r){return ON.call(r3,r)?!0:ON.call(s3,r)?!1:Ple.test(r)?r3[r]=!0:(s3[r]=!0,!1)}function Lle(r,n,o,l){if(o!==null&&o.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return l?!1:o!==null?!o.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Mle(r,n,o,l){if(n===null||typeof n>"u"||Lle(r,n,o,l))return!0;if(l)return!1;if(o!==null)switch(o.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function $n(r,n,o,l,u,m,g){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=l,this.attributeNamespace=u,this.mustUseProperty=o,this.propertyName=r,this.type=n,this.sanitizeURL=m,this.removeEmptyString=g}var _n={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){_n[r]=new $n(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var n=r[0];_n[n]=new $n(n,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){_n[r]=new $n(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){_n[r]=new $n(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){_n[r]=new $n(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){_n[r]=new $n(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){_n[r]=new $n(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){_n[r]=new $n(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){_n[r]=new $n(r,5,!1,r.toLowerCase(),null,!1,!1)});var uA=/[\-:]([a-z])/g;function hA(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var n=r.replace(uA,hA);_n[n]=new $n(n,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var n=r.replace(uA,hA);_n[n]=new $n(n,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var n=r.replace(uA,hA);_n[n]=new $n(n,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){_n[r]=new $n(r,1,!1,r.toLowerCase(),null,!1,!1)});_n.xlinkHref=new $n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){_n[r]=new $n(r,1,!1,r.toLowerCase(),null,!0,!0)});function pA(r,n,o,l){var u=_n.hasOwnProperty(n)?_n[n]:null;(u!==null?u.type!==0:l||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(Mle(n,o,u,l)&&(o=null),l||u===null?kle(n)&&(o===null?r.removeAttribute(n):r.setAttribute(n,""+o)):u.mustUseProperty?r[u.propertyName]=o===null?u.type===3?!1:"":o:(n=u.attributeName,l=u.attributeNamespace,o===null?r.removeAttribute(n):(u=u.type,o=u===3||u===4&&o===!0?"":""+o,l?r.setAttributeNS(l,n,o):r.setAttribute(n,o))))}var Cc=jle.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ry=Symbol.for("react.element"),Gh=Symbol.for("react.portal"),Hh=Symbol.for("react.fragment"),mA=Symbol.for("react.strict_mode"),jN=Symbol.for("react.profiler"),t9=Symbol.for("react.provider"),s9=Symbol.for("react.context"),fA=Symbol.for("react.forward_ref"),PN=Symbol.for("react.suspense"),kN=Symbol.for("react.suspense_list"),gA=Symbol.for("react.memo"),ml=Symbol.for("react.lazy"),r9=Symbol.for("react.offscreen"),n3=Symbol.iterator;function Nf(r){return r===null||typeof r!="object"?null:(r=n3&&r[n3]||r["@@iterator"],typeof r=="function"?r:null)}var xr=Object.assign,TT;function Wf(r){if(TT===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);TT=n&&n[1]||""}return`
`+TT+r}var NT=!1;function RT(r,n){if(!r||NT)return"";NT=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(x){var l=x}Reflect.construct(r,[],n)}else{try{n.call()}catch(x){l=x}r.call(n.prototype)}else{try{throw Error()}catch(x){l=x}r()}}catch(x){if(x&&l&&typeof x.stack=="string"){for(var u=x.stack.split(`
`),m=l.stack.split(`
`),g=u.length-1,E=m.length-1;1<=g&&0<=E&&u[g]!==m[E];)E--;for(;1<=g&&0<=E;g--,E--)if(u[g]!==m[E]){if(g!==1||E!==1)do if(g--,E--,0>E||u[g]!==m[E]){var y=`
`+u[g].replace(" at new "," at ");return r.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",r.displayName)),y}while(1<=g&&0<=E);break}}}finally{NT=!1,Error.prepareStackTrace=o}return(r=r?r.displayName||r.name:"")?Wf(r):""}function Fle(r){switch(r.tag){case 5:return Wf(r.type);case 16:return Wf("Lazy");case 13:return Wf("Suspense");case 19:return Wf("SuspenseList");case 0:case 2:case 15:return r=RT(r.type,!1),r;case 11:return r=RT(r.type.render,!1),r;case 1:return r=RT(r.type,!0),r;default:return""}}function LN(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Hh:return"Fragment";case Gh:return"Portal";case jN:return"Profiler";case mA:return"StrictMode";case PN:return"Suspense";case kN:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case s9:return(r.displayName||"Context")+".Consumer";case t9:return(r._context.displayName||"Context")+".Provider";case fA:var n=r.render;return r=r.displayName,r||(r=n.displayName||n.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case gA:return n=r.displayName||null,n!==null?n:LN(r.type)||"Memo";case ml:n=r._payload,r=r._init;try{return LN(r(n))}catch{}}return null}function Ule(r){var n=r.type;switch(r.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=n.render,r=r.displayName||r.name||"",n.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return LN(n);case 8:return n===mA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Ml(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function n9(r){var n=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Vle(r){var n=n9(r)?"checked":"value",o=Object.getOwnPropertyDescriptor(r.constructor.prototype,n),l=""+r[n];if(!r.hasOwnProperty(n)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var u=o.get,m=o.set;return Object.defineProperty(r,n,{configurable:!0,get:function(){return u.call(this)},set:function(g){l=""+g,m.call(this,g)}}),Object.defineProperty(r,n,{enumerable:o.enumerable}),{getValue:function(){return l},setValue:function(g){l=""+g},stopTracking:function(){r._valueTracker=null,delete r[n]}}}}function ny(r){r._valueTracker||(r._valueTracker=Vle(r))}function i9(r){if(!r)return!1;var n=r._valueTracker;if(!n)return!0;var o=n.getValue(),l="";return r&&(l=n9(r)?r.checked?"true":"false":r.value),r=l,r!==o?(n.setValue(r),!0):!1}function $y(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function MN(r,n){var o=n.checked;return xr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??r._wrapperState.initialChecked})}function i3(r,n){var o=n.defaultValue==null?"":n.defaultValue,l=n.checked!=null?n.checked:n.defaultChecked;o=Ml(n.value!=null?n.value:o),r._wrapperState={initialChecked:l,initialValue:o,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function a9(r,n){n=n.checked,n!=null&&pA(r,"checked",n,!1)}function FN(r,n){a9(r,n);var o=Ml(n.value),l=n.type;if(o!=null)l==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+o):r.value!==""+o&&(r.value=""+o);else if(l==="submit"||l==="reset"){r.removeAttribute("value");return}n.hasOwnProperty("value")?UN(r,n.type,o):n.hasOwnProperty("defaultValue")&&UN(r,n.type,Ml(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(r.defaultChecked=!!n.defaultChecked)}function a3(r,n,o){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var l=n.type;if(!(l!=="submit"&&l!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+r._wrapperState.initialValue,o||n===r.value||(r.value=n),r.defaultValue=n}o=r.name,o!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,o!==""&&(r.name=o)}function UN(r,n,o){(n!=="number"||$y(r.ownerDocument)!==r)&&(o==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+o&&(r.defaultValue=""+o))}var Gf=Array.isArray;function cp(r,n,o,l){if(r=r.options,n){n={};for(var u=0;u<o.length;u++)n["$"+o[u]]=!0;for(o=0;o<r.length;o++)u=n.hasOwnProperty("$"+r[o].value),r[o].selected!==u&&(r[o].selected=u),u&&l&&(r[o].defaultSelected=!0)}else{for(o=""+Ml(o),n=null,u=0;u<r.length;u++){if(r[u].value===o){r[u].selected=!0,l&&(r[u].defaultSelected=!0);return}n!==null||r[u].disabled||(n=r[u])}n!==null&&(n.selected=!0)}}function VN(r,n){if(n.dangerouslySetInnerHTML!=null)throw Error(rt(91));return xr({},n,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function o3(r,n){var o=n.value;if(o==null){if(o=n.children,n=n.defaultValue,o!=null){if(n!=null)throw Error(rt(92));if(Gf(o)){if(1<o.length)throw Error(rt(93));o=o[0]}n=o}n==null&&(n=""),o=n}r._wrapperState={initialValue:Ml(o)}}function o9(r,n){var o=Ml(n.value),l=Ml(n.defaultValue);o!=null&&(o=""+o,o!==r.value&&(r.value=o),n.defaultValue==null&&r.defaultValue!==o&&(r.defaultValue=o)),l!=null&&(r.defaultValue=""+l)}function c3(r){var n=r.textContent;n===r._wrapperState.initialValue&&n!==""&&n!==null&&(r.value=n)}function c9(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function BN(r,n){return r==null||r==="http://www.w3.org/1999/xhtml"?c9(n):r==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var iy,l9=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,o,l,u){MSApp.execUnsafeLocalFunction(function(){return r(n,o,l,u)})}:r}(function(r,n){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=n;else{for(iy=iy||document.createElement("div"),iy.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=iy.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;n.firstChild;)r.appendChild(n.firstChild)}});function pg(r,n){if(n){var o=r.firstChild;if(o&&o===r.lastChild&&o.nodeType===3){o.nodeValue=n;return}}r.textContent=n}var $f={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ble=["Webkit","ms","Moz","O"];Object.keys($f).forEach(function(r){Ble.forEach(function(n){n=n+r.charAt(0).toUpperCase()+r.substring(1),$f[n]=$f[r]})});function d9(r,n,o){return n==null||typeof n=="boolean"||n===""?"":o||typeof n!="number"||n===0||$f.hasOwnProperty(r)&&$f[r]?(""+n).trim():n+"px"}function u9(r,n){r=r.style;for(var o in n)if(n.hasOwnProperty(o)){var l=o.indexOf("--")===0,u=d9(o,n[o],l);o==="float"&&(o="cssFloat"),l?r.setProperty(o,u):r[o]=u}}var Wle=xr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function WN(r,n){if(n){if(Wle[r]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(rt(137,r));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(rt(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(rt(61))}if(n.style!=null&&typeof n.style!="object")throw Error(rt(62))}}function GN(r,n){if(r.indexOf("-")===-1)return typeof n.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var HN=null;function _A(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var zN=null,lp=null,dp=null;function l3(r){if(r=Kg(r)){if(typeof zN!="function")throw Error(rt(280));var n=r.stateNode;n&&(n=Mx(n),zN(r.stateNode,r.type,n))}}function h9(r){lp?dp?dp.push(r):dp=[r]:lp=r}function p9(){if(lp){var r=lp,n=dp;if(dp=lp=null,l3(r),n)for(r=0;r<n.length;r++)l3(n[r])}}function m9(r,n){return r(n)}function f9(){}var AT=!1;function g9(r,n,o){if(AT)return r(n,o);AT=!0;try{return m9(r,n,o)}finally{AT=!1,(lp!==null||dp!==null)&&(f9(),p9())}}function mg(r,n){var o=r.stateNode;if(o===null)return null;var l=Mx(o);if(l===null)return null;o=l[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(r=r.type,l=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!l;break e;default:r=!1}if(r)return null;if(o&&typeof o!="function")throw Error(rt(231,n,typeof o));return o}var KN=!1;if(yc)try{var Rf={};Object.defineProperty(Rf,"passive",{get:function(){KN=!0}}),window.addEventListener("test",Rf,Rf),window.removeEventListener("test",Rf,Rf)}catch{KN=!1}function Gle(r,n,o,l,u,m,g,E,y){var x=Array.prototype.slice.call(arguments,3);try{n.apply(o,x)}catch(S){this.onError(S)}}var Xf=!1,Xy=null,Jy=!1,qN=null,Hle={onError:function(r){Xf=!0,Xy=r}};function zle(r,n,o,l,u,m,g,E,y){Xf=!1,Xy=null,Gle.apply(Hle,arguments)}function Kle(r,n,o,l,u,m,g,E,y){if(zle.apply(this,arguments),Xf){if(Xf){var x=Xy;Xf=!1,Xy=null}else throw Error(rt(198));Jy||(Jy=!0,qN=x)}}function uu(r){var n=r,o=r;if(r.alternate)for(;n.return;)n=n.return;else{r=n;do n=r,n.flags&4098&&(o=n.return),r=n.return;while(r)}return n.tag===3?o:null}function _9(r){if(r.tag===13){var n=r.memoizedState;if(n===null&&(r=r.alternate,r!==null&&(n=r.memoizedState)),n!==null)return n.dehydrated}return null}function d3(r){if(uu(r)!==r)throw Error(rt(188))}function qle(r){var n=r.alternate;if(!n){if(n=uu(r),n===null)throw Error(rt(188));return n!==r?null:r}for(var o=r,l=n;;){var u=o.return;if(u===null)break;var m=u.alternate;if(m===null){if(l=u.return,l!==null){o=l;continue}break}if(u.child===m.child){for(m=u.child;m;){if(m===o)return d3(u),r;if(m===l)return d3(u),n;m=m.sibling}throw Error(rt(188))}if(o.return!==l.return)o=u,l=m;else{for(var g=!1,E=u.child;E;){if(E===o){g=!0,o=u,l=m;break}if(E===l){g=!0,l=u,o=m;break}E=E.sibling}if(!g){for(E=m.child;E;){if(E===o){g=!0,o=m,l=u;break}if(E===l){g=!0,l=m,o=u;break}E=E.sibling}if(!g)throw Error(rt(189))}}if(o.alternate!==l)throw Error(rt(190))}if(o.tag!==3)throw Error(rt(188));return o.stateNode.current===o?r:n}function v9(r){return r=qle(r),r!==null?E9(r):null}function E9(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var n=E9(r);if(n!==null)return n;r=r.sibling}return null}var y9=Vi.unstable_scheduleCallback,u3=Vi.unstable_cancelCallback,Yle=Vi.unstable_shouldYield,$le=Vi.unstable_requestPaint,Fr=Vi.unstable_now,Xle=Vi.unstable_getCurrentPriorityLevel,vA=Vi.unstable_ImmediatePriority,x9=Vi.unstable_UserBlockingPriority,Qy=Vi.unstable_NormalPriority,Jle=Vi.unstable_LowPriority,b9=Vi.unstable_IdlePriority,jx=null,Bo=null;function Qle(r){if(Bo&&typeof Bo.onCommitFiberRoot=="function")try{Bo.onCommitFiberRoot(jx,r,void 0,(r.current.flags&128)===128)}catch{}}var io=Math.clz32?Math.clz32:tde,Zle=Math.log,ede=Math.LN2;function tde(r){return r>>>=0,r===0?32:31-(Zle(r)/ede|0)|0}var ay=64,oy=4194304;function Hf(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Zy(r,n){var o=r.pendingLanes;if(o===0)return 0;var l=0,u=r.suspendedLanes,m=r.pingedLanes,g=o&268435455;if(g!==0){var E=g&~u;E!==0?l=Hf(E):(m&=g,m!==0&&(l=Hf(m)))}else g=o&~u,g!==0?l=Hf(g):m!==0&&(l=Hf(m));if(l===0)return 0;if(n!==0&&n!==l&&!(n&u)&&(u=l&-l,m=n&-n,u>=m||u===16&&(m&4194240)!==0))return n;if(l&4&&(l|=o&16),n=r.entangledLanes,n!==0)for(r=r.entanglements,n&=l;0<n;)o=31-io(n),u=1<<o,l|=r[o],n&=~u;return l}function sde(r,n){switch(r){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rde(r,n){for(var o=r.suspendedLanes,l=r.pingedLanes,u=r.expirationTimes,m=r.pendingLanes;0<m;){var g=31-io(m),E=1<<g,y=u[g];y===-1?(!(E&o)||E&l)&&(u[g]=sde(E,n)):y<=n&&(r.expiredLanes|=E),m&=~E}}function YN(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function w9(){var r=ay;return ay<<=1,!(ay&4194240)&&(ay=64),r}function IT(r){for(var n=[],o=0;31>o;o++)n.push(r);return n}function Hg(r,n,o){r.pendingLanes|=n,n!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,n=31-io(n),r[n]=o}function nde(r,n){var o=r.pendingLanes&~n;r.pendingLanes=n,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=n,r.mutableReadLanes&=n,r.entangledLanes&=n,n=r.entanglements;var l=r.eventTimes;for(r=r.expirationTimes;0<o;){var u=31-io(o),m=1<<u;n[u]=0,l[u]=-1,r[u]=-1,o&=~m}}function EA(r,n){var o=r.entangledLanes|=n;for(r=r.entanglements;o;){var l=31-io(o),u=1<<l;u&n|r[l]&n&&(r[l]|=n),o&=~u}}var Gs=0;function S9(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var C9,yA,T9,N9,R9,$N=!1,cy=[],Rl=null,Al=null,Il=null,fg=new Map,gg=new Map,_l=[],ide="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function h3(r,n){switch(r){case"focusin":case"focusout":Rl=null;break;case"dragenter":case"dragleave":Al=null;break;case"mouseover":case"mouseout":Il=null;break;case"pointerover":case"pointerout":fg.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":gg.delete(n.pointerId)}}function Af(r,n,o,l,u,m){return r===null||r.nativeEvent!==m?(r={blockedOn:n,domEventName:o,eventSystemFlags:l,nativeEvent:m,targetContainers:[u]},n!==null&&(n=Kg(n),n!==null&&yA(n)),r):(r.eventSystemFlags|=l,n=r.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),r)}function ade(r,n,o,l,u){switch(n){case"focusin":return Rl=Af(Rl,r,n,o,l,u),!0;case"dragenter":return Al=Af(Al,r,n,o,l,u),!0;case"mouseover":return Il=Af(Il,r,n,o,l,u),!0;case"pointerover":var m=u.pointerId;return fg.set(m,Af(fg.get(m)||null,r,n,o,l,u)),!0;case"gotpointercapture":return m=u.pointerId,gg.set(m,Af(gg.get(m)||null,r,n,o,l,u)),!0}return!1}function A9(r){var n=Gd(r.target);if(n!==null){var o=uu(n);if(o!==null){if(n=o.tag,n===13){if(n=_9(o),n!==null){r.blockedOn=n,R9(r.priority,function(){T9(o)});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){r.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}r.blockedOn=null}function jy(r){if(r.blockedOn!==null)return!1;for(var n=r.targetContainers;0<n.length;){var o=XN(r.domEventName,r.eventSystemFlags,n[0],r.nativeEvent);if(o===null){o=r.nativeEvent;var l=new o.constructor(o.type,o);HN=l,o.target.dispatchEvent(l),HN=null}else return n=Kg(o),n!==null&&yA(n),r.blockedOn=o,!1;n.shift()}return!0}function p3(r,n,o){jy(r)&&o.delete(n)}function ode(){$N=!1,Rl!==null&&jy(Rl)&&(Rl=null),Al!==null&&jy(Al)&&(Al=null),Il!==null&&jy(Il)&&(Il=null),fg.forEach(p3),gg.forEach(p3)}function If(r,n){r.blockedOn===n&&(r.blockedOn=null,$N||($N=!0,Vi.unstable_scheduleCallback(Vi.unstable_NormalPriority,ode)))}function _g(r){function n(u){return If(u,r)}if(0<cy.length){If(cy[0],r);for(var o=1;o<cy.length;o++){var l=cy[o];l.blockedOn===r&&(l.blockedOn=null)}}for(Rl!==null&&If(Rl,r),Al!==null&&If(Al,r),Il!==null&&If(Il,r),fg.forEach(n),gg.forEach(n),o=0;o<_l.length;o++)l=_l[o],l.blockedOn===r&&(l.blockedOn=null);for(;0<_l.length&&(o=_l[0],o.blockedOn===null);)A9(o),o.blockedOn===null&&_l.shift()}var up=Cc.ReactCurrentBatchConfig,ex=!0;function cde(r,n,o,l){var u=Gs,m=up.transition;up.transition=null;try{Gs=1,xA(r,n,o,l)}finally{Gs=u,up.transition=m}}function lde(r,n,o,l){var u=Gs,m=up.transition;up.transition=null;try{Gs=4,xA(r,n,o,l)}finally{Gs=u,up.transition=m}}function xA(r,n,o,l){if(ex){var u=XN(r,n,o,l);if(u===null)VT(r,n,l,tx,o),h3(r,l);else if(ade(u,r,n,o,l))l.stopPropagation();else if(h3(r,l),n&4&&-1<ide.indexOf(r)){for(;u!==null;){var m=Kg(u);if(m!==null&&C9(m),m=XN(r,n,o,l),m===null&&VT(r,n,l,tx,o),m===u)break;u=m}u!==null&&l.stopPropagation()}else VT(r,n,l,null,o)}}var tx=null;function XN(r,n,o,l){if(tx=null,r=_A(l),r=Gd(r),r!==null)if(n=uu(r),n===null)r=null;else if(o=n.tag,o===13){if(r=_9(n),r!==null)return r;r=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;r=null}else n!==r&&(r=null);return tx=r,null}function I9(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xle()){case vA:return 1;case x9:return 4;case Qy:case Jle:return 16;case b9:return 536870912;default:return 16}default:return 16}}var Cl=null,bA=null,Py=null;function D9(){if(Py)return Py;var r,n=bA,o=n.length,l,u="value"in Cl?Cl.value:Cl.textContent,m=u.length;for(r=0;r<o&&n[r]===u[r];r++);var g=o-r;for(l=1;l<=g&&n[o-l]===u[m-l];l++);return Py=u.slice(r,1<l?1-l:void 0)}function ky(r){var n=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&n===13&&(r=13)):r=n,r===10&&(r=13),32<=r||r===13?r:0}function ly(){return!0}function m3(){return!1}function Wi(r){function n(o,l,u,m,g){this._reactName=o,this._targetInst=u,this.type=l,this.nativeEvent=m,this.target=g,this.currentTarget=null;for(var E in r)r.hasOwnProperty(E)&&(o=r[E],this[E]=o?o(m):m[E]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?ly:m3,this.isPropagationStopped=m3,this}return xr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=ly)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=ly)},persist:function(){},isPersistent:ly}),n}var Up={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wA=Wi(Up),zg=xr({},Up,{view:0,detail:0}),dde=Wi(zg),DT,OT,Df,Px=xr({},zg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:SA,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Df&&(Df&&r.type==="mousemove"?(DT=r.screenX-Df.screenX,OT=r.screenY-Df.screenY):OT=DT=0,Df=r),DT)},movementY:function(r){return"movementY"in r?r.movementY:OT}}),f3=Wi(Px),ude=xr({},Px,{dataTransfer:0}),hde=Wi(ude),pde=xr({},zg,{relatedTarget:0}),jT=Wi(pde),mde=xr({},Up,{animationName:0,elapsedTime:0,pseudoElement:0}),fde=Wi(mde),gde=xr({},Up,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),_de=Wi(gde),vde=xr({},Up,{data:0}),g3=Wi(vde),Ede={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yde={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xde={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bde(r){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(r):(r=xde[r])?!!n[r]:!1}function SA(){return bde}var wde=xr({},zg,{key:function(r){if(r.key){var n=Ede[r.key]||r.key;if(n!=="Unidentified")return n}return r.type==="keypress"?(r=ky(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?yde[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:SA,charCode:function(r){return r.type==="keypress"?ky(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ky(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Sde=Wi(wde),Cde=xr({},Px,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_3=Wi(Cde),Tde=xr({},zg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:SA}),Nde=Wi(Tde),Rde=xr({},Up,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ade=Wi(Rde),Ide=xr({},Px,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Dde=Wi(Ide),Ode=[9,13,27,32],CA=yc&&"CompositionEvent"in window,Jf=null;yc&&"documentMode"in document&&(Jf=document.documentMode);var jde=yc&&"TextEvent"in window&&!Jf,O9=yc&&(!CA||Jf&&8<Jf&&11>=Jf),v3=" ",E3=!1;function j9(r,n){switch(r){case"keyup":return Ode.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function P9(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var zh=!1;function Pde(r,n){switch(r){case"compositionend":return P9(n);case"keypress":return n.which!==32?null:(E3=!0,v3);case"textInput":return r=n.data,r===v3&&E3?null:r;default:return null}}function kde(r,n){if(zh)return r==="compositionend"||!CA&&j9(r,n)?(r=D9(),Py=bA=Cl=null,zh=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return O9&&n.locale!=="ko"?null:n.data;default:return null}}var Lde={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function y3(r){var n=r&&r.nodeName&&r.nodeName.toLowerCase();return n==="input"?!!Lde[r.type]:n==="textarea"}function k9(r,n,o,l){h9(l),n=sx(n,"onChange"),0<n.length&&(o=new wA("onChange","change",null,o,l),r.push({event:o,listeners:n}))}var Qf=null,vg=null;function Mde(r){K9(r,0)}function kx(r){var n=Yh(r);if(i9(n))return r}function Fde(r,n){if(r==="change")return n}var L9=!1;if(yc){var PT;if(yc){var kT="oninput"in document;if(!kT){var x3=document.createElement("div");x3.setAttribute("oninput","return;"),kT=typeof x3.oninput=="function"}PT=kT}else PT=!1;L9=PT&&(!document.documentMode||9<document.documentMode)}function b3(){Qf&&(Qf.detachEvent("onpropertychange",M9),vg=Qf=null)}function M9(r){if(r.propertyName==="value"&&kx(vg)){var n=[];k9(n,vg,r,_A(r)),g9(Mde,n)}}function Ude(r,n,o){r==="focusin"?(b3(),Qf=n,vg=o,Qf.attachEvent("onpropertychange",M9)):r==="focusout"&&b3()}function Vde(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return kx(vg)}function Bde(r,n){if(r==="click")return kx(n)}function Wde(r,n){if(r==="input"||r==="change")return kx(n)}function Gde(r,n){return r===n&&(r!==0||1/r===1/n)||r!==r&&n!==n}var oo=typeof Object.is=="function"?Object.is:Gde;function Eg(r,n){if(oo(r,n))return!0;if(typeof r!="object"||r===null||typeof n!="object"||n===null)return!1;var o=Object.keys(r),l=Object.keys(n);if(o.length!==l.length)return!1;for(l=0;l<o.length;l++){var u=o[l];if(!ON.call(n,u)||!oo(r[u],n[u]))return!1}return!0}function w3(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function S3(r,n){var o=w3(r);r=0;for(var l;o;){if(o.nodeType===3){if(l=r+o.textContent.length,r<=n&&l>=n)return{node:o,offset:n-r};r=l}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=w3(o)}}function F9(r,n){return r&&n?r===n?!0:r&&r.nodeType===3?!1:n&&n.nodeType===3?F9(r,n.parentNode):"contains"in r?r.contains(n):r.compareDocumentPosition?!!(r.compareDocumentPosition(n)&16):!1:!1}function U9(){for(var r=window,n=$y();n instanceof r.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch{o=!1}if(o)r=n.contentWindow;else break;n=$y(r.document)}return n}function TA(r){var n=r&&r.nodeName&&r.nodeName.toLowerCase();return n&&(n==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||n==="textarea"||r.contentEditable==="true")}function Hde(r){var n=U9(),o=r.focusedElem,l=r.selectionRange;if(n!==o&&o&&o.ownerDocument&&F9(o.ownerDocument.documentElement,o)){if(l!==null&&TA(o)){if(n=l.start,r=l.end,r===void 0&&(r=n),"selectionStart"in o)o.selectionStart=n,o.selectionEnd=Math.min(r,o.value.length);else if(r=(n=o.ownerDocument||document)&&n.defaultView||window,r.getSelection){r=r.getSelection();var u=o.textContent.length,m=Math.min(l.start,u);l=l.end===void 0?m:Math.min(l.end,u),!r.extend&&m>l&&(u=l,l=m,m=u),u=S3(o,m);var g=S3(o,l);u&&g&&(r.rangeCount!==1||r.anchorNode!==u.node||r.anchorOffset!==u.offset||r.focusNode!==g.node||r.focusOffset!==g.offset)&&(n=n.createRange(),n.setStart(u.node,u.offset),r.removeAllRanges(),m>l?(r.addRange(n),r.extend(g.node,g.offset)):(n.setEnd(g.node,g.offset),r.addRange(n)))}}for(n=[],r=o;r=r.parentNode;)r.nodeType===1&&n.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<n.length;o++)r=n[o],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var zde=yc&&"documentMode"in document&&11>=document.documentMode,Kh=null,JN=null,Zf=null,QN=!1;function C3(r,n,o){var l=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;QN||Kh==null||Kh!==$y(l)||(l=Kh,"selectionStart"in l&&TA(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Zf&&Eg(Zf,l)||(Zf=l,l=sx(JN,"onSelect"),0<l.length&&(n=new wA("onSelect","select",null,n,o),r.push({event:n,listeners:l}),n.target=Kh)))}function dy(r,n){var o={};return o[r.toLowerCase()]=n.toLowerCase(),o["Webkit"+r]="webkit"+n,o["Moz"+r]="moz"+n,o}var qh={animationend:dy("Animation","AnimationEnd"),animationiteration:dy("Animation","AnimationIteration"),animationstart:dy("Animation","AnimationStart"),transitionend:dy("Transition","TransitionEnd")},LT={},V9={};yc&&(V9=document.createElement("div").style,"AnimationEvent"in window||(delete qh.animationend.animation,delete qh.animationiteration.animation,delete qh.animationstart.animation),"TransitionEvent"in window||delete qh.transitionend.transition);function Lx(r){if(LT[r])return LT[r];if(!qh[r])return r;var n=qh[r],o;for(o in n)if(n.hasOwnProperty(o)&&o in V9)return LT[r]=n[o];return r}var B9=Lx("animationend"),W9=Lx("animationiteration"),G9=Lx("animationstart"),H9=Lx("transitionend"),z9=new Map,T3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vl(r,n){z9.set(r,n),du(n,[r])}for(var MT=0;MT<T3.length;MT++){var FT=T3[MT],Kde=FT.toLowerCase(),qde=FT[0].toUpperCase()+FT.slice(1);Vl(Kde,"on"+qde)}Vl(B9,"onAnimationEnd");Vl(W9,"onAnimationIteration");Vl(G9,"onAnimationStart");Vl("dblclick","onDoubleClick");Vl("focusin","onFocus");Vl("focusout","onBlur");Vl(H9,"onTransitionEnd");Cp("onMouseEnter",["mouseout","mouseover"]);Cp("onMouseLeave",["mouseout","mouseover"]);Cp("onPointerEnter",["pointerout","pointerover"]);Cp("onPointerLeave",["pointerout","pointerover"]);du("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));du("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));du("onBeforeInput",["compositionend","keypress","textInput","paste"]);du("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));du("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));du("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yde=new Set("cancel close invalid load scroll toggle".split(" ").concat(zf));function N3(r,n,o){var l=r.type||"unknown-event";r.currentTarget=o,Kle(l,n,void 0,r),r.currentTarget=null}function K9(r,n){n=(n&4)!==0;for(var o=0;o<r.length;o++){var l=r[o],u=l.event;l=l.listeners;e:{var m=void 0;if(n)for(var g=l.length-1;0<=g;g--){var E=l[g],y=E.instance,x=E.currentTarget;if(E=E.listener,y!==m&&u.isPropagationStopped())break e;N3(u,E,x),m=y}else for(g=0;g<l.length;g++){if(E=l[g],y=E.instance,x=E.currentTarget,E=E.listener,y!==m&&u.isPropagationStopped())break e;N3(u,E,x),m=y}}}if(Jy)throw r=qN,Jy=!1,qN=null,r}function nr(r,n){var o=n[rR];o===void 0&&(o=n[rR]=new Set);var l=r+"__bubble";o.has(l)||(q9(n,r,2,!1),o.add(l))}function UT(r,n,o){var l=0;n&&(l|=4),q9(o,r,l,n)}var uy="_reactListening"+Math.random().toString(36).slice(2);function yg(r){if(!r[uy]){r[uy]=!0,e9.forEach(function(o){o!=="selectionchange"&&(Yde.has(o)||UT(o,!1,r),UT(o,!0,r))});var n=r.nodeType===9?r:r.ownerDocument;n===null||n[uy]||(n[uy]=!0,UT("selectionchange",!1,n))}}function q9(r,n,o,l){switch(I9(n)){case 1:var u=cde;break;case 4:u=lde;break;default:u=xA}o=u.bind(null,n,o,r),u=void 0,!KN||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),l?u!==void 0?r.addEventListener(n,o,{capture:!0,passive:u}):r.addEventListener(n,o,!0):u!==void 0?r.addEventListener(n,o,{passive:u}):r.addEventListener(n,o,!1)}function VT(r,n,o,l,u){var m=l;if(!(n&1)&&!(n&2)&&l!==null)e:for(;;){if(l===null)return;var g=l.tag;if(g===3||g===4){var E=l.stateNode.containerInfo;if(E===u||E.nodeType===8&&E.parentNode===u)break;if(g===4)for(g=l.return;g!==null;){var y=g.tag;if((y===3||y===4)&&(y=g.stateNode.containerInfo,y===u||y.nodeType===8&&y.parentNode===u))return;g=g.return}for(;E!==null;){if(g=Gd(E),g===null)return;if(y=g.tag,y===5||y===6){l=m=g;continue e}E=E.parentNode}}l=l.return}g9(function(){var x=m,S=_A(o),C=[];e:{var N=z9.get(r);if(N!==void 0){var M=wA,G=r;switch(r){case"keypress":if(ky(o)===0)break e;case"keydown":case"keyup":M=Sde;break;case"focusin":G="focus",M=jT;break;case"focusout":G="blur",M=jT;break;case"beforeblur":case"afterblur":M=jT;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":M=f3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":M=hde;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":M=Nde;break;case B9:case W9:case G9:M=fde;break;case H9:M=Ade;break;case"scroll":M=dde;break;case"wheel":M=Dde;break;case"copy":case"cut":case"paste":M=_de;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":M=_3}var I=(n&4)!==0,P=!I&&r==="scroll",L=I?N!==null?N+"Capture":null:N;I=[];for(var R=x,D;R!==null;){D=R;var V=D.stateNode;if(D.tag===5&&V!==null&&(D=V,L!==null&&(V=mg(R,L),V!=null&&I.push(xg(R,V,D)))),P)break;R=R.return}0<I.length&&(N=new M(N,G,null,o,S),C.push({event:N,listeners:I}))}}if(!(n&7)){e:{if(N=r==="mouseover"||r==="pointerover",M=r==="mouseout"||r==="pointerout",N&&o!==HN&&(G=o.relatedTarget||o.fromElement)&&(Gd(G)||G[xc]))break e;if((M||N)&&(N=S.window===S?S:(N=S.ownerDocument)?N.defaultView||N.parentWindow:window,M?(G=o.relatedTarget||o.toElement,M=x,G=G?Gd(G):null,G!==null&&(P=uu(G),G!==P||G.tag!==5&&G.tag!==6)&&(G=null)):(M=null,G=x),M!==G)){if(I=f3,V="onMouseLeave",L="onMouseEnter",R="mouse",(r==="pointerout"||r==="pointerover")&&(I=_3,V="onPointerLeave",L="onPointerEnter",R="pointer"),P=M==null?N:Yh(M),D=G==null?N:Yh(G),N=new I(V,R+"leave",M,o,S),N.target=P,N.relatedTarget=D,V=null,Gd(S)===x&&(I=new I(L,R+"enter",G,o,S),I.target=D,I.relatedTarget=P,V=I),P=V,M&&G)t:{for(I=M,L=G,R=0,D=I;D;D=Lh(D))R++;for(D=0,V=L;V;V=Lh(V))D++;for(;0<R-D;)I=Lh(I),R--;for(;0<D-R;)L=Lh(L),D--;for(;R--;){if(I===L||L!==null&&I===L.alternate)break t;I=Lh(I),L=Lh(L)}I=null}else I=null;M!==null&&R3(C,N,M,I,!1),G!==null&&P!==null&&R3(C,P,G,I,!0)}}e:{if(N=x?Yh(x):window,M=N.nodeName&&N.nodeName.toLowerCase(),M==="select"||M==="input"&&N.type==="file")var W=Fde;else if(y3(N))if(L9)W=Wde;else{W=Vde;var q=Ude}else(M=N.nodeName)&&M.toLowerCase()==="input"&&(N.type==="checkbox"||N.type==="radio")&&(W=Bde);if(W&&(W=W(r,x))){k9(C,W,o,S);break e}q&&q(r,N,x),r==="focusout"&&(q=N._wrapperState)&&q.controlled&&N.type==="number"&&UN(N,"number",N.value)}switch(q=x?Yh(x):window,r){case"focusin":(y3(q)||q.contentEditable==="true")&&(Kh=q,JN=x,Zf=null);break;case"focusout":Zf=JN=Kh=null;break;case"mousedown":QN=!0;break;case"contextmenu":case"mouseup":case"dragend":QN=!1,C3(C,o,S);break;case"selectionchange":if(zde)break;case"keydown":case"keyup":C3(C,o,S)}var H;if(CA)e:{switch(r){case"compositionstart":var J="onCompositionStart";break e;case"compositionend":J="onCompositionEnd";break e;case"compositionupdate":J="onCompositionUpdate";break e}J=void 0}else zh?j9(r,o)&&(J="onCompositionEnd"):r==="keydown"&&o.keyCode===229&&(J="onCompositionStart");J&&(O9&&o.locale!=="ko"&&(zh||J!=="onCompositionStart"?J==="onCompositionEnd"&&zh&&(H=D9()):(Cl=S,bA="value"in Cl?Cl.value:Cl.textContent,zh=!0)),q=sx(x,J),0<q.length&&(J=new g3(J,r,null,o,S),C.push({event:J,listeners:q}),H?J.data=H:(H=P9(o),H!==null&&(J.data=H)))),(H=jde?Pde(r,o):kde(r,o))&&(x=sx(x,"onBeforeInput"),0<x.length&&(S=new g3("onBeforeInput","beforeinput",null,o,S),C.push({event:S,listeners:x}),S.data=H))}K9(C,n)})}function xg(r,n,o){return{instance:r,listener:n,currentTarget:o}}function sx(r,n){for(var o=n+"Capture",l=[];r!==null;){var u=r,m=u.stateNode;u.tag===5&&m!==null&&(u=m,m=mg(r,o),m!=null&&l.unshift(xg(r,m,u)),m=mg(r,n),m!=null&&l.push(xg(r,m,u))),r=r.return}return l}function Lh(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function R3(r,n,o,l,u){for(var m=n._reactName,g=[];o!==null&&o!==l;){var E=o,y=E.alternate,x=E.stateNode;if(y!==null&&y===l)break;E.tag===5&&x!==null&&(E=x,u?(y=mg(o,m),y!=null&&g.unshift(xg(o,y,E))):u||(y=mg(o,m),y!=null&&g.push(xg(o,y,E)))),o=o.return}g.length!==0&&r.push({event:n,listeners:g})}var $de=/\r\n?/g,Xde=/\u0000|\uFFFD/g;function A3(r){return(typeof r=="string"?r:""+r).replace($de,`
`).replace(Xde,"")}function hy(r,n,o){if(n=A3(n),A3(r)!==n&&o)throw Error(rt(425))}function rx(){}var ZN=null,eR=null;function tR(r,n){return r==="textarea"||r==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var sR=typeof setTimeout=="function"?setTimeout:void 0,Jde=typeof clearTimeout=="function"?clearTimeout:void 0,I3=typeof Promise=="function"?Promise:void 0,Qde=typeof queueMicrotask=="function"?queueMicrotask:typeof I3<"u"?function(r){return I3.resolve(null).then(r).catch(Zde)}:sR;function Zde(r){setTimeout(function(){throw r})}function BT(r,n){var o=n,l=0;do{var u=o.nextSibling;if(r.removeChild(o),u&&u.nodeType===8)if(o=u.data,o==="/$"){if(l===0){r.removeChild(u),_g(n);return}l--}else o!=="$"&&o!=="$?"&&o!=="$!"||l++;o=u}while(o);_g(n)}function Dl(r){for(;r!=null;r=r.nextSibling){var n=r.nodeType;if(n===1||n===3)break;if(n===8){if(n=r.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return r}function D3(r){r=r.previousSibling;for(var n=0;r;){if(r.nodeType===8){var o=r.data;if(o==="$"||o==="$!"||o==="$?"){if(n===0)return r;n--}else o==="/$"&&n++}r=r.previousSibling}return null}var Vp=Math.random().toString(36).slice(2),Vo="__reactFiber$"+Vp,bg="__reactProps$"+Vp,xc="__reactContainer$"+Vp,rR="__reactEvents$"+Vp,eue="__reactListeners$"+Vp,tue="__reactHandles$"+Vp;function Gd(r){var n=r[Vo];if(n)return n;for(var o=r.parentNode;o;){if(n=o[xc]||o[Vo]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(r=D3(r);r!==null;){if(o=r[Vo])return o;r=D3(r)}return n}r=o,o=r.parentNode}return null}function Kg(r){return r=r[Vo]||r[xc],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Yh(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(rt(33))}function Mx(r){return r[bg]||null}var nR=[],$h=-1;function Bl(r){return{current:r}}function ir(r){0>$h||(r.current=nR[$h],nR[$h]=null,$h--)}function tr(r,n){$h++,nR[$h]=r.current,r.current=n}var Fl={},kn=Bl(Fl),vi=Bl(!1),ru=Fl;function Tp(r,n){var o=r.type.contextTypes;if(!o)return Fl;var l=r.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===n)return l.__reactInternalMemoizedMaskedChildContext;var u={},m;for(m in o)u[m]=n[m];return l&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=n,r.__reactInternalMemoizedMaskedChildContext=u),u}function Ei(r){return r=r.childContextTypes,r!=null}function nx(){ir(vi),ir(kn)}function O3(r,n,o){if(kn.current!==Fl)throw Error(rt(168));tr(kn,n),tr(vi,o)}function Y9(r,n,o){var l=r.stateNode;if(n=n.childContextTypes,typeof l.getChildContext!="function")return o;l=l.getChildContext();for(var u in l)if(!(u in n))throw Error(rt(108,Ule(r)||"Unknown",u));return xr({},o,l)}function ix(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Fl,ru=kn.current,tr(kn,r),tr(vi,vi.current),!0}function j3(r,n,o){var l=r.stateNode;if(!l)throw Error(rt(169));o?(r=Y9(r,n,ru),l.__reactInternalMemoizedMergedChildContext=r,ir(vi),ir(kn),tr(kn,r)):ir(vi),tr(vi,o)}var fc=null,Fx=!1,WT=!1;function $9(r){fc===null?fc=[r]:fc.push(r)}function sue(r){Fx=!0,$9(r)}function Wl(){if(!WT&&fc!==null){WT=!0;var r=0,n=Gs;try{var o=fc;for(Gs=1;r<o.length;r++){var l=o[r];do l=l(!0);while(l!==null)}fc=null,Fx=!1}catch(u){throw fc!==null&&(fc=fc.slice(r+1)),y9(vA,Wl),u}finally{Gs=n,WT=!1}}return null}var Xh=[],Jh=0,ax=null,ox=0,_a=[],va=0,nu=null,_c=1,vc="";function Ld(r,n){Xh[Jh++]=ox,Xh[Jh++]=ax,ax=r,ox=n}function X9(r,n,o){_a[va++]=_c,_a[va++]=vc,_a[va++]=nu,nu=r;var l=_c;r=vc;var u=32-io(l)-1;l&=~(1<<u),o+=1;var m=32-io(n)+u;if(30<m){var g=u-u%5;m=(l&(1<<g)-1).toString(32),l>>=g,u-=g,_c=1<<32-io(n)+u|o<<u|l,vc=m+r}else _c=1<<m|o<<u|l,vc=r}function NA(r){r.return!==null&&(Ld(r,1),X9(r,1,0))}function RA(r){for(;r===ax;)ax=Xh[--Jh],Xh[Jh]=null,ox=Xh[--Jh],Xh[Jh]=null;for(;r===nu;)nu=_a[--va],_a[va]=null,vc=_a[--va],_a[va]=null,_c=_a[--va],_a[va]=null}var Ui=null,Fi=null,lr=!1,so=null;function J9(r,n){var o=ya(5,null,null,0);o.elementType="DELETED",o.stateNode=n,o.return=r,n=r.deletions,n===null?(r.deletions=[o],r.flags|=16):n.push(o)}function P3(r,n){switch(r.tag){case 5:var o=r.type;return n=n.nodeType!==1||o.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(r.stateNode=n,Ui=r,Fi=Dl(n.firstChild),!0):!1;case 6:return n=r.pendingProps===""||n.nodeType!==3?null:n,n!==null?(r.stateNode=n,Ui=r,Fi=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(o=nu!==null?{id:_c,overflow:vc}:null,r.memoizedState={dehydrated:n,treeContext:o,retryLane:1073741824},o=ya(18,null,null,0),o.stateNode=n,o.return=r,r.child=o,Ui=r,Fi=null,!0):!1;default:return!1}}function iR(r){return(r.mode&1)!==0&&(r.flags&128)===0}function aR(r){if(lr){var n=Fi;if(n){var o=n;if(!P3(r,n)){if(iR(r))throw Error(rt(418));n=Dl(o.nextSibling);var l=Ui;n&&P3(r,n)?J9(l,o):(r.flags=r.flags&-4097|2,lr=!1,Ui=r)}}else{if(iR(r))throw Error(rt(418));r.flags=r.flags&-4097|2,lr=!1,Ui=r}}}function k3(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Ui=r}function py(r){if(r!==Ui)return!1;if(!lr)return k3(r),lr=!0,!1;var n;if((n=r.tag!==3)&&!(n=r.tag!==5)&&(n=r.type,n=n!=="head"&&n!=="body"&&!tR(r.type,r.memoizedProps)),n&&(n=Fi)){if(iR(r))throw Q9(),Error(rt(418));for(;n;)J9(r,n),n=Dl(n.nextSibling)}if(k3(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(rt(317));e:{for(r=r.nextSibling,n=0;r;){if(r.nodeType===8){var o=r.data;if(o==="/$"){if(n===0){Fi=Dl(r.nextSibling);break e}n--}else o!=="$"&&o!=="$!"&&o!=="$?"||n++}r=r.nextSibling}Fi=null}}else Fi=Ui?Dl(r.stateNode.nextSibling):null;return!0}function Q9(){for(var r=Fi;r;)r=Dl(r.nextSibling)}function Np(){Fi=Ui=null,lr=!1}function AA(r){so===null?so=[r]:so.push(r)}var rue=Cc.ReactCurrentBatchConfig;function Of(r,n,o){if(r=o.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(rt(309));var l=o.stateNode}if(!l)throw Error(rt(147,r));var u=l,m=""+r;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===m?n.ref:(n=function(g){var E=u.refs;g===null?delete E[m]:E[m]=g},n._stringRef=m,n)}if(typeof r!="string")throw Error(rt(284));if(!o._owner)throw Error(rt(290,r))}return r}function my(r,n){throw r=Object.prototype.toString.call(n),Error(rt(31,r==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":r))}function L3(r){var n=r._init;return n(r._payload)}function Z9(r){function n(L,R){if(r){var D=L.deletions;D===null?(L.deletions=[R],L.flags|=16):D.push(R)}}function o(L,R){if(!r)return null;for(;R!==null;)n(L,R),R=R.sibling;return null}function l(L,R){for(L=new Map;R!==null;)R.key!==null?L.set(R.key,R):L.set(R.index,R),R=R.sibling;return L}function u(L,R){return L=kl(L,R),L.index=0,L.sibling=null,L}function m(L,R,D){return L.index=D,r?(D=L.alternate,D!==null?(D=D.index,D<R?(L.flags|=2,R):D):(L.flags|=2,R)):(L.flags|=1048576,R)}function g(L){return r&&L.alternate===null&&(L.flags|=2),L}function E(L,R,D,V){return R===null||R.tag!==6?(R=$T(D,L.mode,V),R.return=L,R):(R=u(R,D),R.return=L,R)}function y(L,R,D,V){var W=D.type;return W===Hh?S(L,R,D.props.children,V,D.key):R!==null&&(R.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===ml&&L3(W)===R.type)?(V=u(R,D.props),V.ref=Of(L,R,D),V.return=L,V):(V=Wy(D.type,D.key,D.props,null,L.mode,V),V.ref=Of(L,R,D),V.return=L,V)}function x(L,R,D,V){return R===null||R.tag!==4||R.stateNode.containerInfo!==D.containerInfo||R.stateNode.implementation!==D.implementation?(R=XT(D,L.mode,V),R.return=L,R):(R=u(R,D.children||[]),R.return=L,R)}function S(L,R,D,V,W){return R===null||R.tag!==7?(R=eu(D,L.mode,V,W),R.return=L,R):(R=u(R,D),R.return=L,R)}function C(L,R,D){if(typeof R=="string"&&R!==""||typeof R=="number")return R=$T(""+R,L.mode,D),R.return=L,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case ry:return D=Wy(R.type,R.key,R.props,null,L.mode,D),D.ref=Of(L,null,R),D.return=L,D;case Gh:return R=XT(R,L.mode,D),R.return=L,R;case ml:var V=R._init;return C(L,V(R._payload),D)}if(Gf(R)||Nf(R))return R=eu(R,L.mode,D,null),R.return=L,R;my(L,R)}return null}function N(L,R,D,V){var W=R!==null?R.key:null;if(typeof D=="string"&&D!==""||typeof D=="number")return W!==null?null:E(L,R,""+D,V);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case ry:return D.key===W?y(L,R,D,V):null;case Gh:return D.key===W?x(L,R,D,V):null;case ml:return W=D._init,N(L,R,W(D._payload),V)}if(Gf(D)||Nf(D))return W!==null?null:S(L,R,D,V,null);my(L,D)}return null}function M(L,R,D,V,W){if(typeof V=="string"&&V!==""||typeof V=="number")return L=L.get(D)||null,E(R,L,""+V,W);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case ry:return L=L.get(V.key===null?D:V.key)||null,y(R,L,V,W);case Gh:return L=L.get(V.key===null?D:V.key)||null,x(R,L,V,W);case ml:var q=V._init;return M(L,R,D,q(V._payload),W)}if(Gf(V)||Nf(V))return L=L.get(D)||null,S(R,L,V,W,null);my(R,V)}return null}function G(L,R,D,V){for(var W=null,q=null,H=R,J=R=0,ee=null;H!==null&&J<D.length;J++){H.index>J?(ee=H,H=null):ee=H.sibling;var ne=N(L,H,D[J],V);if(ne===null){H===null&&(H=ee);break}r&&H&&ne.alternate===null&&n(L,H),R=m(ne,R,J),q===null?W=ne:q.sibling=ne,q=ne,H=ee}if(J===D.length)return o(L,H),lr&&Ld(L,J),W;if(H===null){for(;J<D.length;J++)H=C(L,D[J],V),H!==null&&(R=m(H,R,J),q===null?W=H:q.sibling=H,q=H);return lr&&Ld(L,J),W}for(H=l(L,H);J<D.length;J++)ee=M(H,L,J,D[J],V),ee!==null&&(r&&ee.alternate!==null&&H.delete(ee.key===null?J:ee.key),R=m(ee,R,J),q===null?W=ee:q.sibling=ee,q=ee);return r&&H.forEach(function(pe){return n(L,pe)}),lr&&Ld(L,J),W}function I(L,R,D,V){var W=Nf(D);if(typeof W!="function")throw Error(rt(150));if(D=W.call(D),D==null)throw Error(rt(151));for(var q=W=null,H=R,J=R=0,ee=null,ne=D.next();H!==null&&!ne.done;J++,ne=D.next()){H.index>J?(ee=H,H=null):ee=H.sibling;var pe=N(L,H,ne.value,V);if(pe===null){H===null&&(H=ee);break}r&&H&&pe.alternate===null&&n(L,H),R=m(pe,R,J),q===null?W=pe:q.sibling=pe,q=pe,H=ee}if(ne.done)return o(L,H),lr&&Ld(L,J),W;if(H===null){for(;!ne.done;J++,ne=D.next())ne=C(L,ne.value,V),ne!==null&&(R=m(ne,R,J),q===null?W=ne:q.sibling=ne,q=ne);return lr&&Ld(L,J),W}for(H=l(L,H);!ne.done;J++,ne=D.next())ne=M(H,L,J,ne.value,V),ne!==null&&(r&&ne.alternate!==null&&H.delete(ne.key===null?J:ne.key),R=m(ne,R,J),q===null?W=ne:q.sibling=ne,q=ne);return r&&H.forEach(function(Ee){return n(L,Ee)}),lr&&Ld(L,J),W}function P(L,R,D,V){if(typeof D=="object"&&D!==null&&D.type===Hh&&D.key===null&&(D=D.props.children),typeof D=="object"&&D!==null){switch(D.$$typeof){case ry:e:{for(var W=D.key,q=R;q!==null;){if(q.key===W){if(W=D.type,W===Hh){if(q.tag===7){o(L,q.sibling),R=u(q,D.props.children),R.return=L,L=R;break e}}else if(q.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===ml&&L3(W)===q.type){o(L,q.sibling),R=u(q,D.props),R.ref=Of(L,q,D),R.return=L,L=R;break e}o(L,q);break}else n(L,q);q=q.sibling}D.type===Hh?(R=eu(D.props.children,L.mode,V,D.key),R.return=L,L=R):(V=Wy(D.type,D.key,D.props,null,L.mode,V),V.ref=Of(L,R,D),V.return=L,L=V)}return g(L);case Gh:e:{for(q=D.key;R!==null;){if(R.key===q)if(R.tag===4&&R.stateNode.containerInfo===D.containerInfo&&R.stateNode.implementation===D.implementation){o(L,R.sibling),R=u(R,D.children||[]),R.return=L,L=R;break e}else{o(L,R);break}else n(L,R);R=R.sibling}R=XT(D,L.mode,V),R.return=L,L=R}return g(L);case ml:return q=D._init,P(L,R,q(D._payload),V)}if(Gf(D))return G(L,R,D,V);if(Nf(D))return I(L,R,D,V);my(L,D)}return typeof D=="string"&&D!==""||typeof D=="number"?(D=""+D,R!==null&&R.tag===6?(o(L,R.sibling),R=u(R,D),R.return=L,L=R):(o(L,R),R=$T(D,L.mode,V),R.return=L,L=R),g(L)):o(L,R)}return P}var Rp=Z9(!0),e8=Z9(!1),cx=Bl(null),lx=null,Qh=null,IA=null;function DA(){IA=Qh=lx=null}function OA(r){var n=cx.current;ir(cx),r._currentValue=n}function oR(r,n,o){for(;r!==null;){var l=r.alternate;if((r.childLanes&n)!==n?(r.childLanes|=n,l!==null&&(l.childLanes|=n)):l!==null&&(l.childLanes&n)!==n&&(l.childLanes|=n),r===o)break;r=r.return}}function hp(r,n){lx=r,IA=Qh=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&n&&(fi=!0),r.firstContext=null)}function Sa(r){var n=r._currentValue;if(IA!==r)if(r={context:r,memoizedValue:n,next:null},Qh===null){if(lx===null)throw Error(rt(308));Qh=r,lx.dependencies={lanes:0,firstContext:r}}else Qh=Qh.next=r;return n}var Hd=null;function jA(r){Hd===null?Hd=[r]:Hd.push(r)}function t8(r,n,o,l){var u=n.interleaved;return u===null?(o.next=o,jA(n)):(o.next=u.next,u.next=o),n.interleaved=o,bc(r,l)}function bc(r,n){r.lanes|=n;var o=r.alternate;for(o!==null&&(o.lanes|=n),o=r,r=r.return;r!==null;)r.childLanes|=n,o=r.alternate,o!==null&&(o.childLanes|=n),o=r,r=r.return;return o.tag===3?o.stateNode:null}var fl=!1;function PA(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function s8(r,n){r=r.updateQueue,n.updateQueue===r&&(n.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Ec(r,n){return{eventTime:r,lane:n,tag:0,payload:null,callback:null,next:null}}function Ol(r,n,o){var l=r.updateQueue;if(l===null)return null;if(l=l.shared,Rs&2){var u=l.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),l.pending=n,bc(r,o)}return u=l.interleaved,u===null?(n.next=n,jA(l)):(n.next=u.next,u.next=n),l.interleaved=n,bc(r,o)}function Ly(r,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194240)!==0)){var l=n.lanes;l&=r.pendingLanes,o|=l,n.lanes=o,EA(r,o)}}function M3(r,n){var o=r.updateQueue,l=r.alternate;if(l!==null&&(l=l.updateQueue,o===l)){var u=null,m=null;if(o=o.firstBaseUpdate,o!==null){do{var g={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};m===null?u=m=g:m=m.next=g,o=o.next}while(o!==null);m===null?u=m=n:m=m.next=n}else u=m=n;o={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:m,shared:l.shared,effects:l.effects},r.updateQueue=o;return}r=o.lastBaseUpdate,r===null?o.firstBaseUpdate=n:r.next=n,o.lastBaseUpdate=n}function dx(r,n,o,l){var u=r.updateQueue;fl=!1;var m=u.firstBaseUpdate,g=u.lastBaseUpdate,E=u.shared.pending;if(E!==null){u.shared.pending=null;var y=E,x=y.next;y.next=null,g===null?m=x:g.next=x,g=y;var S=r.alternate;S!==null&&(S=S.updateQueue,E=S.lastBaseUpdate,E!==g&&(E===null?S.firstBaseUpdate=x:E.next=x,S.lastBaseUpdate=y))}if(m!==null){var C=u.baseState;g=0,S=x=y=null,E=m;do{var N=E.lane,M=E.eventTime;if((l&N)===N){S!==null&&(S=S.next={eventTime:M,lane:0,tag:E.tag,payload:E.payload,callback:E.callback,next:null});e:{var G=r,I=E;switch(N=n,M=o,I.tag){case 1:if(G=I.payload,typeof G=="function"){C=G.call(M,C,N);break e}C=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=I.payload,N=typeof G=="function"?G.call(M,C,N):G,N==null)break e;C=xr({},C,N);break e;case 2:fl=!0}}E.callback!==null&&E.lane!==0&&(r.flags|=64,N=u.effects,N===null?u.effects=[E]:N.push(E))}else M={eventTime:M,lane:N,tag:E.tag,payload:E.payload,callback:E.callback,next:null},S===null?(x=S=M,y=C):S=S.next=M,g|=N;if(E=E.next,E===null){if(E=u.shared.pending,E===null)break;N=E,E=N.next,N.next=null,u.lastBaseUpdate=N,u.shared.pending=null}}while(!0);if(S===null&&(y=C),u.baseState=y,u.firstBaseUpdate=x,u.lastBaseUpdate=S,n=u.shared.interleaved,n!==null){u=n;do g|=u.lane,u=u.next;while(u!==n)}else m===null&&(u.shared.lanes=0);au|=g,r.lanes=g,r.memoizedState=C}}function F3(r,n,o){if(r=n.effects,n.effects=null,r!==null)for(n=0;n<r.length;n++){var l=r[n],u=l.callback;if(u!==null){if(l.callback=null,l=o,typeof u!="function")throw Error(rt(191,u));u.call(l)}}}var qg={},Wo=Bl(qg),wg=Bl(qg),Sg=Bl(qg);function zd(r){if(r===qg)throw Error(rt(174));return r}function kA(r,n){switch(tr(Sg,n),tr(wg,r),tr(Wo,qg),r=n.nodeType,r){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:BN(null,"");break;default:r=r===8?n.parentNode:n,n=r.namespaceURI||null,r=r.tagName,n=BN(n,r)}ir(Wo),tr(Wo,n)}function Ap(){ir(Wo),ir(wg),ir(Sg)}function r8(r){zd(Sg.current);var n=zd(Wo.current),o=BN(n,r.type);n!==o&&(tr(wg,r),tr(Wo,o))}function LA(r){wg.current===r&&(ir(Wo),ir(wg))}var _r=Bl(0);function ux(r){for(var n=r;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break;for(;n.sibling===null;){if(n.return===null||n.return===r)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var GT=[];function MA(){for(var r=0;r<GT.length;r++)GT[r]._workInProgressVersionPrimary=null;GT.length=0}var My=Cc.ReactCurrentDispatcher,HT=Cc.ReactCurrentBatchConfig,iu=0,Er=null,Xr=null,on=null,hx=!1,eg=!1,Cg=0,nue=0;function Rn(){throw Error(rt(321))}function FA(r,n){if(n===null)return!1;for(var o=0;o<n.length&&o<r.length;o++)if(!oo(r[o],n[o]))return!1;return!0}function UA(r,n,o,l,u,m){if(iu=m,Er=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,My.current=r===null||r.memoizedState===null?cue:lue,r=o(l,u),eg){m=0;do{if(eg=!1,Cg=0,25<=m)throw Error(rt(301));m+=1,on=Xr=null,n.updateQueue=null,My.current=due,r=o(l,u)}while(eg)}if(My.current=px,n=Xr!==null&&Xr.next!==null,iu=0,on=Xr=Er=null,hx=!1,n)throw Error(rt(300));return r}function VA(){var r=Cg!==0;return Cg=0,r}function Lo(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return on===null?Er.memoizedState=on=r:on=on.next=r,on}function Ca(){if(Xr===null){var r=Er.alternate;r=r!==null?r.memoizedState:null}else r=Xr.next;var n=on===null?Er.memoizedState:on.next;if(n!==null)on=n,Xr=r;else{if(r===null)throw Error(rt(310));Xr=r,r={memoizedState:Xr.memoizedState,baseState:Xr.baseState,baseQueue:Xr.baseQueue,queue:Xr.queue,next:null},on===null?Er.memoizedState=on=r:on=on.next=r}return on}function Tg(r,n){return typeof n=="function"?n(r):n}function zT(r){var n=Ca(),o=n.queue;if(o===null)throw Error(rt(311));o.lastRenderedReducer=r;var l=Xr,u=l.baseQueue,m=o.pending;if(m!==null){if(u!==null){var g=u.next;u.next=m.next,m.next=g}l.baseQueue=u=m,o.pending=null}if(u!==null){m=u.next,l=l.baseState;var E=g=null,y=null,x=m;do{var S=x.lane;if((iu&S)===S)y!==null&&(y=y.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),l=x.hasEagerState?x.eagerState:r(l,x.action);else{var C={lane:S,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};y===null?(E=y=C,g=l):y=y.next=C,Er.lanes|=S,au|=S}x=x.next}while(x!==null&&x!==m);y===null?g=l:y.next=E,oo(l,n.memoizedState)||(fi=!0),n.memoizedState=l,n.baseState=g,n.baseQueue=y,o.lastRenderedState=l}if(r=o.interleaved,r!==null){u=r;do m=u.lane,Er.lanes|=m,au|=m,u=u.next;while(u!==r)}else u===null&&(o.lanes=0);return[n.memoizedState,o.dispatch]}function KT(r){var n=Ca(),o=n.queue;if(o===null)throw Error(rt(311));o.lastRenderedReducer=r;var l=o.dispatch,u=o.pending,m=n.memoizedState;if(u!==null){o.pending=null;var g=u=u.next;do m=r(m,g.action),g=g.next;while(g!==u);oo(m,n.memoizedState)||(fi=!0),n.memoizedState=m,n.baseQueue===null&&(n.baseState=m),o.lastRenderedState=m}return[m,l]}function n8(){}function i8(r,n){var o=Er,l=Ca(),u=n(),m=!oo(l.memoizedState,u);if(m&&(l.memoizedState=u,fi=!0),l=l.queue,BA(c8.bind(null,o,l,r),[r]),l.getSnapshot!==n||m||on!==null&&on.memoizedState.tag&1){if(o.flags|=2048,Ng(9,o8.bind(null,o,l,u,n),void 0,null),cn===null)throw Error(rt(349));iu&30||a8(o,n,u)}return u}function a8(r,n,o){r.flags|=16384,r={getSnapshot:n,value:o},n=Er.updateQueue,n===null?(n={lastEffect:null,stores:null},Er.updateQueue=n,n.stores=[r]):(o=n.stores,o===null?n.stores=[r]:o.push(r))}function o8(r,n,o,l){n.value=o,n.getSnapshot=l,l8(n)&&d8(r)}function c8(r,n,o){return o(function(){l8(n)&&d8(r)})}function l8(r){var n=r.getSnapshot;r=r.value;try{var o=n();return!oo(r,o)}catch{return!0}}function d8(r){var n=bc(r,1);n!==null&&ao(n,r,1,-1)}function U3(r){var n=Lo();return typeof r=="function"&&(r=r()),n.memoizedState=n.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tg,lastRenderedState:r},n.queue=r,r=r.dispatch=oue.bind(null,Er,r),[n.memoizedState,r]}function Ng(r,n,o,l){return r={tag:r,create:n,destroy:o,deps:l,next:null},n=Er.updateQueue,n===null?(n={lastEffect:null,stores:null},Er.updateQueue=n,n.lastEffect=r.next=r):(o=n.lastEffect,o===null?n.lastEffect=r.next=r:(l=o.next,o.next=r,r.next=l,n.lastEffect=r)),r}function u8(){return Ca().memoizedState}function Fy(r,n,o,l){var u=Lo();Er.flags|=r,u.memoizedState=Ng(1|n,o,void 0,l===void 0?null:l)}function Ux(r,n,o,l){var u=Ca();l=l===void 0?null:l;var m=void 0;if(Xr!==null){var g=Xr.memoizedState;if(m=g.destroy,l!==null&&FA(l,g.deps)){u.memoizedState=Ng(n,o,m,l);return}}Er.flags|=r,u.memoizedState=Ng(1|n,o,m,l)}function V3(r,n){return Fy(8390656,8,r,n)}function BA(r,n){return Ux(2048,8,r,n)}function h8(r,n){return Ux(4,2,r,n)}function p8(r,n){return Ux(4,4,r,n)}function m8(r,n){if(typeof n=="function")return r=r(),n(r),function(){n(null)};if(n!=null)return r=r(),n.current=r,function(){n.current=null}}function f8(r,n,o){return o=o!=null?o.concat([r]):null,Ux(4,4,m8.bind(null,n,r),o)}function WA(){}function g8(r,n){var o=Ca();n=n===void 0?null:n;var l=o.memoizedState;return l!==null&&n!==null&&FA(n,l[1])?l[0]:(o.memoizedState=[r,n],r)}function _8(r,n){var o=Ca();n=n===void 0?null:n;var l=o.memoizedState;return l!==null&&n!==null&&FA(n,l[1])?l[0]:(r=r(),o.memoizedState=[r,n],r)}function v8(r,n,o){return iu&21?(oo(o,n)||(o=w9(),Er.lanes|=o,au|=o,r.baseState=!0),n):(r.baseState&&(r.baseState=!1,fi=!0),r.memoizedState=o)}function iue(r,n){var o=Gs;Gs=o!==0&&4>o?o:4,r(!0);var l=HT.transition;HT.transition={};try{r(!1),n()}finally{Gs=o,HT.transition=l}}function E8(){return Ca().memoizedState}function aue(r,n,o){var l=Pl(r);if(o={lane:l,action:o,hasEagerState:!1,eagerState:null,next:null},y8(r))x8(n,o);else if(o=t8(r,n,o,l),o!==null){var u=Kn();ao(o,r,l,u),b8(o,n,l)}}function oue(r,n,o){var l=Pl(r),u={lane:l,action:o,hasEagerState:!1,eagerState:null,next:null};if(y8(r))x8(n,u);else{var m=r.alternate;if(r.lanes===0&&(m===null||m.lanes===0)&&(m=n.lastRenderedReducer,m!==null))try{var g=n.lastRenderedState,E=m(g,o);if(u.hasEagerState=!0,u.eagerState=E,oo(E,g)){var y=n.interleaved;y===null?(u.next=u,jA(n)):(u.next=y.next,y.next=u),n.interleaved=u;return}}catch{}finally{}o=t8(r,n,u,l),o!==null&&(u=Kn(),ao(o,r,l,u),b8(o,n,l))}}function y8(r){var n=r.alternate;return r===Er||n!==null&&n===Er}function x8(r,n){eg=hx=!0;var o=r.pending;o===null?n.next=n:(n.next=o.next,o.next=n),r.pending=n}function b8(r,n,o){if(o&4194240){var l=n.lanes;l&=r.pendingLanes,o|=l,n.lanes=o,EA(r,o)}}var px={readContext:Sa,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useInsertionEffect:Rn,useLayoutEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useMutableSource:Rn,useSyncExternalStore:Rn,useId:Rn,unstable_isNewReconciler:!1},cue={readContext:Sa,useCallback:function(r,n){return Lo().memoizedState=[r,n===void 0?null:n],r},useContext:Sa,useEffect:V3,useImperativeHandle:function(r,n,o){return o=o!=null?o.concat([r]):null,Fy(4194308,4,m8.bind(null,n,r),o)},useLayoutEffect:function(r,n){return Fy(4194308,4,r,n)},useInsertionEffect:function(r,n){return Fy(4,2,r,n)},useMemo:function(r,n){var o=Lo();return n=n===void 0?null:n,r=r(),o.memoizedState=[r,n],r},useReducer:function(r,n,o){var l=Lo();return n=o!==void 0?o(n):n,l.memoizedState=l.baseState=n,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:n},l.queue=r,r=r.dispatch=aue.bind(null,Er,r),[l.memoizedState,r]},useRef:function(r){var n=Lo();return r={current:r},n.memoizedState=r},useState:U3,useDebugValue:WA,useDeferredValue:function(r){return Lo().memoizedState=r},useTransition:function(){var r=U3(!1),n=r[0];return r=iue.bind(null,r[1]),Lo().memoizedState=r,[n,r]},useMutableSource:function(){},useSyncExternalStore:function(r,n,o){var l=Er,u=Lo();if(lr){if(o===void 0)throw Error(rt(407));o=o()}else{if(o=n(),cn===null)throw Error(rt(349));iu&30||a8(l,n,o)}u.memoizedState=o;var m={value:o,getSnapshot:n};return u.queue=m,V3(c8.bind(null,l,m,r),[r]),l.flags|=2048,Ng(9,o8.bind(null,l,m,o,n),void 0,null),o},useId:function(){var r=Lo(),n=cn.identifierPrefix;if(lr){var o=vc,l=_c;o=(l&~(1<<32-io(l)-1)).toString(32)+o,n=":"+n+"R"+o,o=Cg++,0<o&&(n+="H"+o.toString(32)),n+=":"}else o=nue++,n=":"+n+"r"+o.toString(32)+":";return r.memoizedState=n},unstable_isNewReconciler:!1},lue={readContext:Sa,useCallback:g8,useContext:Sa,useEffect:BA,useImperativeHandle:f8,useInsertionEffect:h8,useLayoutEffect:p8,useMemo:_8,useReducer:zT,useRef:u8,useState:function(){return zT(Tg)},useDebugValue:WA,useDeferredValue:function(r){var n=Ca();return v8(n,Xr.memoizedState,r)},useTransition:function(){var r=zT(Tg)[0],n=Ca().memoizedState;return[r,n]},useMutableSource:n8,useSyncExternalStore:i8,useId:E8,unstable_isNewReconciler:!1},due={readContext:Sa,useCallback:g8,useContext:Sa,useEffect:BA,useImperativeHandle:f8,useInsertionEffect:h8,useLayoutEffect:p8,useMemo:_8,useReducer:KT,useRef:u8,useState:function(){return KT(Tg)},useDebugValue:WA,useDeferredValue:function(r){var n=Ca();return Xr===null?n.memoizedState=r:v8(n,Xr.memoizedState,r)},useTransition:function(){var r=KT(Tg)[0],n=Ca().memoizedState;return[r,n]},useMutableSource:n8,useSyncExternalStore:i8,useId:E8,unstable_isNewReconciler:!1};function Ja(r,n){if(r&&r.defaultProps){n=xr({},n),r=r.defaultProps;for(var o in r)n[o]===void 0&&(n[o]=r[o]);return n}return n}function cR(r,n,o,l){n=r.memoizedState,o=o(l,n),o=o==null?n:xr({},n,o),r.memoizedState=o,r.lanes===0&&(r.updateQueue.baseState=o)}var Vx={isMounted:function(r){return(r=r._reactInternals)?uu(r)===r:!1},enqueueSetState:function(r,n,o){r=r._reactInternals;var l=Kn(),u=Pl(r),m=Ec(l,u);m.payload=n,o!=null&&(m.callback=o),n=Ol(r,m,u),n!==null&&(ao(n,r,u,l),Ly(n,r,u))},enqueueReplaceState:function(r,n,o){r=r._reactInternals;var l=Kn(),u=Pl(r),m=Ec(l,u);m.tag=1,m.payload=n,o!=null&&(m.callback=o),n=Ol(r,m,u),n!==null&&(ao(n,r,u,l),Ly(n,r,u))},enqueueForceUpdate:function(r,n){r=r._reactInternals;var o=Kn(),l=Pl(r),u=Ec(o,l);u.tag=2,n!=null&&(u.callback=n),n=Ol(r,u,l),n!==null&&(ao(n,r,l,o),Ly(n,r,l))}};function B3(r,n,o,l,u,m,g){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(l,m,g):n.prototype&&n.prototype.isPureReactComponent?!Eg(o,l)||!Eg(u,m):!0}function w8(r,n,o){var l=!1,u=Fl,m=n.contextType;return typeof m=="object"&&m!==null?m=Sa(m):(u=Ei(n)?ru:kn.current,l=n.contextTypes,m=(l=l!=null)?Tp(r,u):Fl),n=new n(o,m),r.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Vx,r.stateNode=n,n._reactInternals=r,l&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=u,r.__reactInternalMemoizedMaskedChildContext=m),n}function W3(r,n,o,l){r=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,l),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,l),n.state!==r&&Vx.enqueueReplaceState(n,n.state,null)}function lR(r,n,o,l){var u=r.stateNode;u.props=o,u.state=r.memoizedState,u.refs={},PA(r);var m=n.contextType;typeof m=="object"&&m!==null?u.context=Sa(m):(m=Ei(n)?ru:kn.current,u.context=Tp(r,m)),u.state=r.memoizedState,m=n.getDerivedStateFromProps,typeof m=="function"&&(cR(r,n,m,o),u.state=r.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(n=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),n!==u.state&&Vx.enqueueReplaceState(u,u.state,null),dx(r,o,u,l),u.state=r.memoizedState),typeof u.componentDidMount=="function"&&(r.flags|=4194308)}function Ip(r,n){try{var o="",l=n;do o+=Fle(l),l=l.return;while(l);var u=o}catch(m){u=`
Error generating stack: `+m.message+`
`+m.stack}return{value:r,source:n,stack:u,digest:null}}function qT(r,n,o){return{value:r,source:null,stack:o??null,digest:n??null}}function dR(r,n){try{console.error(n.value)}catch(o){setTimeout(function(){throw o})}}var uue=typeof WeakMap=="function"?WeakMap:Map;function S8(r,n,o){o=Ec(-1,o),o.tag=3,o.payload={element:null};var l=n.value;return o.callback=function(){fx||(fx=!0,yR=l),dR(r,n)},o}function C8(r,n,o){o=Ec(-1,o),o.tag=3;var l=r.type.getDerivedStateFromError;if(typeof l=="function"){var u=n.value;o.payload=function(){return l(u)},o.callback=function(){dR(r,n)}}var m=r.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(o.callback=function(){dR(r,n),typeof l!="function"&&(jl===null?jl=new Set([this]):jl.add(this));var g=n.stack;this.componentDidCatch(n.value,{componentStack:g!==null?g:""})}),o}function G3(r,n,o){var l=r.pingCache;if(l===null){l=r.pingCache=new uue;var u=new Set;l.set(n,u)}else u=l.get(n),u===void 0&&(u=new Set,l.set(n,u));u.has(o)||(u.add(o),r=Cue.bind(null,r,n,o),n.then(r,r))}function H3(r){do{var n;if((n=r.tag===13)&&(n=r.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return r;r=r.return}while(r!==null);return null}function z3(r,n,o,l,u){return r.mode&1?(r.flags|=65536,r.lanes=u,r):(r===n?r.flags|=65536:(r.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(n=Ec(-1,1),n.tag=2,Ol(o,n,1))),o.lanes|=1),r)}var hue=Cc.ReactCurrentOwner,fi=!1;function Gn(r,n,o,l){n.child=r===null?e8(n,null,o,l):Rp(n,r.child,o,l)}function K3(r,n,o,l,u){o=o.render;var m=n.ref;return hp(n,u),l=UA(r,n,o,l,m,u),o=VA(),r!==null&&!fi?(n.updateQueue=r.updateQueue,n.flags&=-2053,r.lanes&=~u,wc(r,n,u)):(lr&&o&&NA(n),n.flags|=1,Gn(r,n,l,u),n.child)}function q3(r,n,o,l,u){if(r===null){var m=o.type;return typeof m=="function"&&!XA(m)&&m.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(n.tag=15,n.type=m,T8(r,n,m,l,u)):(r=Wy(o.type,null,l,n,n.mode,u),r.ref=n.ref,r.return=n,n.child=r)}if(m=r.child,!(r.lanes&u)){var g=m.memoizedProps;if(o=o.compare,o=o!==null?o:Eg,o(g,l)&&r.ref===n.ref)return wc(r,n,u)}return n.flags|=1,r=kl(m,l),r.ref=n.ref,r.return=n,n.child=r}function T8(r,n,o,l,u){if(r!==null){var m=r.memoizedProps;if(Eg(m,l)&&r.ref===n.ref)if(fi=!1,n.pendingProps=l=m,(r.lanes&u)!==0)r.flags&131072&&(fi=!0);else return n.lanes=r.lanes,wc(r,n,u)}return uR(r,n,o,l,u)}function N8(r,n,o){var l=n.pendingProps,u=l.children,m=r!==null?r.memoizedState:null;if(l.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},tr(ep,Mi),Mi|=o;else{if(!(o&1073741824))return r=m!==null?m.baseLanes|o:o,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:r,cachePool:null,transitions:null},n.updateQueue=null,tr(ep,Mi),Mi|=r,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=m!==null?m.baseLanes:o,tr(ep,Mi),Mi|=l}else m!==null?(l=m.baseLanes|o,n.memoizedState=null):l=o,tr(ep,Mi),Mi|=l;return Gn(r,n,u,o),n.child}function R8(r,n){var o=n.ref;(r===null&&o!==null||r!==null&&r.ref!==o)&&(n.flags|=512,n.flags|=2097152)}function uR(r,n,o,l,u){var m=Ei(o)?ru:kn.current;return m=Tp(n,m),hp(n,u),o=UA(r,n,o,l,m,u),l=VA(),r!==null&&!fi?(n.updateQueue=r.updateQueue,n.flags&=-2053,r.lanes&=~u,wc(r,n,u)):(lr&&l&&NA(n),n.flags|=1,Gn(r,n,o,u),n.child)}function Y3(r,n,o,l,u){if(Ei(o)){var m=!0;ix(n)}else m=!1;if(hp(n,u),n.stateNode===null)Uy(r,n),w8(n,o,l),lR(n,o,l,u),l=!0;else if(r===null){var g=n.stateNode,E=n.memoizedProps;g.props=E;var y=g.context,x=o.contextType;typeof x=="object"&&x!==null?x=Sa(x):(x=Ei(o)?ru:kn.current,x=Tp(n,x));var S=o.getDerivedStateFromProps,C=typeof S=="function"||typeof g.getSnapshotBeforeUpdate=="function";C||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(E!==l||y!==x)&&W3(n,g,l,x),fl=!1;var N=n.memoizedState;g.state=N,dx(n,l,g,u),y=n.memoizedState,E!==l||N!==y||vi.current||fl?(typeof S=="function"&&(cR(n,o,S,l),y=n.memoizedState),(E=fl||B3(n,o,E,l,N,y,x))?(C||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(n.flags|=4194308)):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=l,n.memoizedState=y),g.props=l,g.state=y,g.context=x,l=E):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),l=!1)}else{g=n.stateNode,s8(r,n),E=n.memoizedProps,x=n.type===n.elementType?E:Ja(n.type,E),g.props=x,C=n.pendingProps,N=g.context,y=o.contextType,typeof y=="object"&&y!==null?y=Sa(y):(y=Ei(o)?ru:kn.current,y=Tp(n,y));var M=o.getDerivedStateFromProps;(S=typeof M=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(E!==C||N!==y)&&W3(n,g,l,y),fl=!1,N=n.memoizedState,g.state=N,dx(n,l,g,u);var G=n.memoizedState;E!==C||N!==G||vi.current||fl?(typeof M=="function"&&(cR(n,o,M,l),G=n.memoizedState),(x=fl||B3(n,o,x,l,N,G,y)||!1)?(S||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(l,G,y),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(l,G,y)),typeof g.componentDidUpdate=="function"&&(n.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof g.componentDidUpdate!="function"||E===r.memoizedProps&&N===r.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&N===r.memoizedState||(n.flags|=1024),n.memoizedProps=l,n.memoizedState=G),g.props=l,g.state=G,g.context=y,l=x):(typeof g.componentDidUpdate!="function"||E===r.memoizedProps&&N===r.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||E===r.memoizedProps&&N===r.memoizedState||(n.flags|=1024),l=!1)}return hR(r,n,o,l,m,u)}function hR(r,n,o,l,u,m){R8(r,n);var g=(n.flags&128)!==0;if(!l&&!g)return u&&j3(n,o,!1),wc(r,n,m);l=n.stateNode,hue.current=n;var E=g&&typeof o.getDerivedStateFromError!="function"?null:l.render();return n.flags|=1,r!==null&&g?(n.child=Rp(n,r.child,null,m),n.child=Rp(n,null,E,m)):Gn(r,n,E,m),n.memoizedState=l.state,u&&j3(n,o,!0),n.child}function A8(r){var n=r.stateNode;n.pendingContext?O3(r,n.pendingContext,n.pendingContext!==n.context):n.context&&O3(r,n.context,!1),kA(r,n.containerInfo)}function $3(r,n,o,l,u){return Np(),AA(u),n.flags|=256,Gn(r,n,o,l),n.child}var pR={dehydrated:null,treeContext:null,retryLane:0};function mR(r){return{baseLanes:r,cachePool:null,transitions:null}}function I8(r,n,o){var l=n.pendingProps,u=_r.current,m=!1,g=(n.flags&128)!==0,E;if((E=g)||(E=r!==null&&r.memoizedState===null?!1:(u&2)!==0),E?(m=!0,n.flags&=-129):(r===null||r.memoizedState!==null)&&(u|=1),tr(_r,u&1),r===null)return aR(n),r=n.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(n.mode&1?r.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(g=l.children,r=l.fallback,m?(l=n.mode,m=n.child,g={mode:"hidden",children:g},!(l&1)&&m!==null?(m.childLanes=0,m.pendingProps=g):m=Gx(g,l,0,null),r=eu(r,l,o,null),m.return=n,r.return=n,m.sibling=r,n.child=m,n.child.memoizedState=mR(o),n.memoizedState=pR,r):GA(n,g));if(u=r.memoizedState,u!==null&&(E=u.dehydrated,E!==null))return pue(r,n,g,l,E,u,o);if(m){m=l.fallback,g=n.mode,u=r.child,E=u.sibling;var y={mode:"hidden",children:l.children};return!(g&1)&&n.child!==u?(l=n.child,l.childLanes=0,l.pendingProps=y,n.deletions=null):(l=kl(u,y),l.subtreeFlags=u.subtreeFlags&14680064),E!==null?m=kl(E,m):(m=eu(m,g,o,null),m.flags|=2),m.return=n,l.return=n,l.sibling=m,n.child=l,l=m,m=n.child,g=r.child.memoizedState,g=g===null?mR(o):{baseLanes:g.baseLanes|o,cachePool:null,transitions:g.transitions},m.memoizedState=g,m.childLanes=r.childLanes&~o,n.memoizedState=pR,l}return m=r.child,r=m.sibling,l=kl(m,{mode:"visible",children:l.children}),!(n.mode&1)&&(l.lanes=o),l.return=n,l.sibling=null,r!==null&&(o=n.deletions,o===null?(n.deletions=[r],n.flags|=16):o.push(r)),n.child=l,n.memoizedState=null,l}function GA(r,n){return n=Gx({mode:"visible",children:n},r.mode,0,null),n.return=r,r.child=n}function fy(r,n,o,l){return l!==null&&AA(l),Rp(n,r.child,null,o),r=GA(n,n.pendingProps.children),r.flags|=2,n.memoizedState=null,r}function pue(r,n,o,l,u,m,g){if(o)return n.flags&256?(n.flags&=-257,l=qT(Error(rt(422))),fy(r,n,g,l)):n.memoizedState!==null?(n.child=r.child,n.flags|=128,null):(m=l.fallback,u=n.mode,l=Gx({mode:"visible",children:l.children},u,0,null),m=eu(m,u,g,null),m.flags|=2,l.return=n,m.return=n,l.sibling=m,n.child=l,n.mode&1&&Rp(n,r.child,null,g),n.child.memoizedState=mR(g),n.memoizedState=pR,m);if(!(n.mode&1))return fy(r,n,g,null);if(u.data==="$!"){if(l=u.nextSibling&&u.nextSibling.dataset,l)var E=l.dgst;return l=E,m=Error(rt(419)),l=qT(m,l,void 0),fy(r,n,g,l)}if(E=(g&r.childLanes)!==0,fi||E){if(l=cn,l!==null){switch(g&-g){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(l.suspendedLanes|g)?0:u,u!==0&&u!==m.retryLane&&(m.retryLane=u,bc(r,u),ao(l,r,u,-1))}return $A(),l=qT(Error(rt(421))),fy(r,n,g,l)}return u.data==="$?"?(n.flags|=128,n.child=r.child,n=Tue.bind(null,r),u._reactRetry=n,null):(r=m.treeContext,Fi=Dl(u.nextSibling),Ui=n,lr=!0,so=null,r!==null&&(_a[va++]=_c,_a[va++]=vc,_a[va++]=nu,_c=r.id,vc=r.overflow,nu=n),n=GA(n,l.children),n.flags|=4096,n)}function X3(r,n,o){r.lanes|=n;var l=r.alternate;l!==null&&(l.lanes|=n),oR(r.return,n,o)}function YT(r,n,o,l,u){var m=r.memoizedState;m===null?r.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:l,tail:o,tailMode:u}:(m.isBackwards=n,m.rendering=null,m.renderingStartTime=0,m.last=l,m.tail=o,m.tailMode=u)}function D8(r,n,o){var l=n.pendingProps,u=l.revealOrder,m=l.tail;if(Gn(r,n,l.children,o),l=_r.current,l&2)l=l&1|2,n.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=n.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&X3(r,o,n);else if(r.tag===19)X3(r,o,n);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break e;for(;r.sibling===null;){if(r.return===null||r.return===n)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}l&=1}if(tr(_r,l),!(n.mode&1))n.memoizedState=null;else switch(u){case"forwards":for(o=n.child,u=null;o!==null;)r=o.alternate,r!==null&&ux(r)===null&&(u=o),o=o.sibling;o=u,o===null?(u=n.child,n.child=null):(u=o.sibling,o.sibling=null),YT(n,!1,u,o,m);break;case"backwards":for(o=null,u=n.child,n.child=null;u!==null;){if(r=u.alternate,r!==null&&ux(r)===null){n.child=u;break}r=u.sibling,u.sibling=o,o=u,u=r}YT(n,!0,o,null,m);break;case"together":YT(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Uy(r,n){!(n.mode&1)&&r!==null&&(r.alternate=null,n.alternate=null,n.flags|=2)}function wc(r,n,o){if(r!==null&&(n.dependencies=r.dependencies),au|=n.lanes,!(o&n.childLanes))return null;if(r!==null&&n.child!==r.child)throw Error(rt(153));if(n.child!==null){for(r=n.child,o=kl(r,r.pendingProps),n.child=o,o.return=n;r.sibling!==null;)r=r.sibling,o=o.sibling=kl(r,r.pendingProps),o.return=n;o.sibling=null}return n.child}function mue(r,n,o){switch(n.tag){case 3:A8(n),Np();break;case 5:r8(n);break;case 1:Ei(n.type)&&ix(n);break;case 4:kA(n,n.stateNode.containerInfo);break;case 10:var l=n.type._context,u=n.memoizedProps.value;tr(cx,l._currentValue),l._currentValue=u;break;case 13:if(l=n.memoizedState,l!==null)return l.dehydrated!==null?(tr(_r,_r.current&1),n.flags|=128,null):o&n.child.childLanes?I8(r,n,o):(tr(_r,_r.current&1),r=wc(r,n,o),r!==null?r.sibling:null);tr(_r,_r.current&1);break;case 19:if(l=(o&n.childLanes)!==0,r.flags&128){if(l)return D8(r,n,o);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),tr(_r,_r.current),l)break;return null;case 22:case 23:return n.lanes=0,N8(r,n,o)}return wc(r,n,o)}var O8,fR,j8,P8;O8=function(r,n){for(var o=n.child;o!==null;){if(o.tag===5||o.tag===6)r.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};fR=function(){};j8=function(r,n,o,l){var u=r.memoizedProps;if(u!==l){r=n.stateNode,zd(Wo.current);var m=null;switch(o){case"input":u=MN(r,u),l=MN(r,l),m=[];break;case"select":u=xr({},u,{value:void 0}),l=xr({},l,{value:void 0}),m=[];break;case"textarea":u=VN(r,u),l=VN(r,l),m=[];break;default:typeof u.onClick!="function"&&typeof l.onClick=="function"&&(r.onclick=rx)}WN(o,l);var g;o=null;for(x in u)if(!l.hasOwnProperty(x)&&u.hasOwnProperty(x)&&u[x]!=null)if(x==="style"){var E=u[x];for(g in E)E.hasOwnProperty(g)&&(o||(o={}),o[g]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(hg.hasOwnProperty(x)?m||(m=[]):(m=m||[]).push(x,null));for(x in l){var y=l[x];if(E=u!=null?u[x]:void 0,l.hasOwnProperty(x)&&y!==E&&(y!=null||E!=null))if(x==="style")if(E){for(g in E)!E.hasOwnProperty(g)||y&&y.hasOwnProperty(g)||(o||(o={}),o[g]="");for(g in y)y.hasOwnProperty(g)&&E[g]!==y[g]&&(o||(o={}),o[g]=y[g])}else o||(m||(m=[]),m.push(x,o)),o=y;else x==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,E=E?E.__html:void 0,y!=null&&E!==y&&(m=m||[]).push(x,y)):x==="children"?typeof y!="string"&&typeof y!="number"||(m=m||[]).push(x,""+y):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(hg.hasOwnProperty(x)?(y!=null&&x==="onScroll"&&nr("scroll",r),m||E===y||(m=[])):(m=m||[]).push(x,y))}o&&(m=m||[]).push("style",o);var x=m;(n.updateQueue=x)&&(n.flags|=4)}};P8=function(r,n,o,l){o!==l&&(n.flags|=4)};function jf(r,n){if(!lr)switch(r.tailMode){case"hidden":n=r.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?r.tail=null:o.sibling=null;break;case"collapsed":o=r.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?n||r.tail===null?r.tail=null:r.tail.sibling=null:l.sibling=null}}function An(r){var n=r.alternate!==null&&r.alternate.child===r.child,o=0,l=0;if(n)for(var u=r.child;u!==null;)o|=u.lanes|u.childLanes,l|=u.subtreeFlags&14680064,l|=u.flags&14680064,u.return=r,u=u.sibling;else for(u=r.child;u!==null;)o|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=r,u=u.sibling;return r.subtreeFlags|=l,r.childLanes=o,n}function fue(r,n,o){var l=n.pendingProps;switch(RA(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(n),null;case 1:return Ei(n.type)&&nx(),An(n),null;case 3:return l=n.stateNode,Ap(),ir(vi),ir(kn),MA(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(r===null||r.child===null)&&(py(n)?n.flags|=4:r===null||r.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,so!==null&&(wR(so),so=null))),fR(r,n),An(n),null;case 5:LA(n);var u=zd(Sg.current);if(o=n.type,r!==null&&n.stateNode!=null)j8(r,n,o,l,u),r.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!l){if(n.stateNode===null)throw Error(rt(166));return An(n),null}if(r=zd(Wo.current),py(n)){l=n.stateNode,o=n.type;var m=n.memoizedProps;switch(l[Vo]=n,l[bg]=m,r=(n.mode&1)!==0,o){case"dialog":nr("cancel",l),nr("close",l);break;case"iframe":case"object":case"embed":nr("load",l);break;case"video":case"audio":for(u=0;u<zf.length;u++)nr(zf[u],l);break;case"source":nr("error",l);break;case"img":case"image":case"link":nr("error",l),nr("load",l);break;case"details":nr("toggle",l);break;case"input":i3(l,m),nr("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!m.multiple},nr("invalid",l);break;case"textarea":o3(l,m),nr("invalid",l)}WN(o,m),u=null;for(var g in m)if(m.hasOwnProperty(g)){var E=m[g];g==="children"?typeof E=="string"?l.textContent!==E&&(m.suppressHydrationWarning!==!0&&hy(l.textContent,E,r),u=["children",E]):typeof E=="number"&&l.textContent!==""+E&&(m.suppressHydrationWarning!==!0&&hy(l.textContent,E,r),u=["children",""+E]):hg.hasOwnProperty(g)&&E!=null&&g==="onScroll"&&nr("scroll",l)}switch(o){case"input":ny(l),a3(l,m,!0);break;case"textarea":ny(l),c3(l);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(l.onclick=rx)}l=u,n.updateQueue=l,l!==null&&(n.flags|=4)}else{g=u.nodeType===9?u:u.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=c9(o)),r==="http://www.w3.org/1999/xhtml"?o==="script"?(r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof l.is=="string"?r=g.createElement(o,{is:l.is}):(r=g.createElement(o),o==="select"&&(g=r,l.multiple?g.multiple=!0:l.size&&(g.size=l.size))):r=g.createElementNS(r,o),r[Vo]=n,r[bg]=l,O8(r,n,!1,!1),n.stateNode=r;e:{switch(g=GN(o,l),o){case"dialog":nr("cancel",r),nr("close",r),u=l;break;case"iframe":case"object":case"embed":nr("load",r),u=l;break;case"video":case"audio":for(u=0;u<zf.length;u++)nr(zf[u],r);u=l;break;case"source":nr("error",r),u=l;break;case"img":case"image":case"link":nr("error",r),nr("load",r),u=l;break;case"details":nr("toggle",r),u=l;break;case"input":i3(r,l),u=MN(r,l),nr("invalid",r);break;case"option":u=l;break;case"select":r._wrapperState={wasMultiple:!!l.multiple},u=xr({},l,{value:void 0}),nr("invalid",r);break;case"textarea":o3(r,l),u=VN(r,l),nr("invalid",r);break;default:u=l}WN(o,u),E=u;for(m in E)if(E.hasOwnProperty(m)){var y=E[m];m==="style"?u9(r,y):m==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&l9(r,y)):m==="children"?typeof y=="string"?(o!=="textarea"||y!=="")&&pg(r,y):typeof y=="number"&&pg(r,""+y):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(hg.hasOwnProperty(m)?y!=null&&m==="onScroll"&&nr("scroll",r):y!=null&&pA(r,m,y,g))}switch(o){case"input":ny(r),a3(r,l,!1);break;case"textarea":ny(r),c3(r);break;case"option":l.value!=null&&r.setAttribute("value",""+Ml(l.value));break;case"select":r.multiple=!!l.multiple,m=l.value,m!=null?cp(r,!!l.multiple,m,!1):l.defaultValue!=null&&cp(r,!!l.multiple,l.defaultValue,!0);break;default:typeof u.onClick=="function"&&(r.onclick=rx)}switch(o){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return An(n),null;case 6:if(r&&n.stateNode!=null)P8(r,n,r.memoizedProps,l);else{if(typeof l!="string"&&n.stateNode===null)throw Error(rt(166));if(o=zd(Sg.current),zd(Wo.current),py(n)){if(l=n.stateNode,o=n.memoizedProps,l[Vo]=n,(m=l.nodeValue!==o)&&(r=Ui,r!==null))switch(r.tag){case 3:hy(l.nodeValue,o,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&hy(l.nodeValue,o,(r.mode&1)!==0)}m&&(n.flags|=4)}else l=(o.nodeType===9?o:o.ownerDocument).createTextNode(l),l[Vo]=n,n.stateNode=l}return An(n),null;case 13:if(ir(_r),l=n.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(lr&&Fi!==null&&n.mode&1&&!(n.flags&128))Q9(),Np(),n.flags|=98560,m=!1;else if(m=py(n),l!==null&&l.dehydrated!==null){if(r===null){if(!m)throw Error(rt(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(rt(317));m[Vo]=n}else Np(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;An(n),m=!1}else so!==null&&(wR(so),so=null),m=!0;if(!m)return n.flags&65536?n:null}return n.flags&128?(n.lanes=o,n):(l=l!==null,l!==(r!==null&&r.memoizedState!==null)&&l&&(n.child.flags|=8192,n.mode&1&&(r===null||_r.current&1?Jr===0&&(Jr=3):$A())),n.updateQueue!==null&&(n.flags|=4),An(n),null);case 4:return Ap(),fR(r,n),r===null&&yg(n.stateNode.containerInfo),An(n),null;case 10:return OA(n.type._context),An(n),null;case 17:return Ei(n.type)&&nx(),An(n),null;case 19:if(ir(_r),m=n.memoizedState,m===null)return An(n),null;if(l=(n.flags&128)!==0,g=m.rendering,g===null)if(l)jf(m,!1);else{if(Jr!==0||r!==null&&r.flags&128)for(r=n.child;r!==null;){if(g=ux(r),g!==null){for(n.flags|=128,jf(m,!1),l=g.updateQueue,l!==null&&(n.updateQueue=l,n.flags|=4),n.subtreeFlags=0,l=o,o=n.child;o!==null;)m=o,r=l,m.flags&=14680066,g=m.alternate,g===null?(m.childLanes=0,m.lanes=r,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=g.childLanes,m.lanes=g.lanes,m.child=g.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=g.memoizedProps,m.memoizedState=g.memoizedState,m.updateQueue=g.updateQueue,m.type=g.type,r=g.dependencies,m.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),o=o.sibling;return tr(_r,_r.current&1|2),n.child}r=r.sibling}m.tail!==null&&Fr()>Dp&&(n.flags|=128,l=!0,jf(m,!1),n.lanes=4194304)}else{if(!l)if(r=ux(g),r!==null){if(n.flags|=128,l=!0,o=r.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),jf(m,!0),m.tail===null&&m.tailMode==="hidden"&&!g.alternate&&!lr)return An(n),null}else 2*Fr()-m.renderingStartTime>Dp&&o!==1073741824&&(n.flags|=128,l=!0,jf(m,!1),n.lanes=4194304);m.isBackwards?(g.sibling=n.child,n.child=g):(o=m.last,o!==null?o.sibling=g:n.child=g,m.last=g)}return m.tail!==null?(n=m.tail,m.rendering=n,m.tail=n.sibling,m.renderingStartTime=Fr(),n.sibling=null,o=_r.current,tr(_r,l?o&1|2:o&1),n):(An(n),null);case 22:case 23:return YA(),l=n.memoizedState!==null,r!==null&&r.memoizedState!==null!==l&&(n.flags|=8192),l&&n.mode&1?Mi&1073741824&&(An(n),n.subtreeFlags&6&&(n.flags|=8192)):An(n),null;case 24:return null;case 25:return null}throw Error(rt(156,n.tag))}function gue(r,n){switch(RA(n),n.tag){case 1:return Ei(n.type)&&nx(),r=n.flags,r&65536?(n.flags=r&-65537|128,n):null;case 3:return Ap(),ir(vi),ir(kn),MA(),r=n.flags,r&65536&&!(r&128)?(n.flags=r&-65537|128,n):null;case 5:return LA(n),null;case 13:if(ir(_r),r=n.memoizedState,r!==null&&r.dehydrated!==null){if(n.alternate===null)throw Error(rt(340));Np()}return r=n.flags,r&65536?(n.flags=r&-65537|128,n):null;case 19:return ir(_r),null;case 4:return Ap(),null;case 10:return OA(n.type._context),null;case 22:case 23:return YA(),null;case 24:return null;default:return null}}var gy=!1,On=!1,_ue=typeof WeakSet=="function"?WeakSet:Set,xt=null;function Zh(r,n){var o=r.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(l){Ir(r,n,l)}else o.current=null}function gR(r,n,o){try{o()}catch(l){Ir(r,n,l)}}var J3=!1;function vue(r,n){if(ZN=ex,r=U9(),TA(r)){if("selectionStart"in r)var o={start:r.selectionStart,end:r.selectionEnd};else e:{o=(o=r.ownerDocument)&&o.defaultView||window;var l=o.getSelection&&o.getSelection();if(l&&l.rangeCount!==0){o=l.anchorNode;var u=l.anchorOffset,m=l.focusNode;l=l.focusOffset;try{o.nodeType,m.nodeType}catch{o=null;break e}var g=0,E=-1,y=-1,x=0,S=0,C=r,N=null;t:for(;;){for(var M;C!==o||u!==0&&C.nodeType!==3||(E=g+u),C!==m||l!==0&&C.nodeType!==3||(y=g+l),C.nodeType===3&&(g+=C.nodeValue.length),(M=C.firstChild)!==null;)N=C,C=M;for(;;){if(C===r)break t;if(N===o&&++x===u&&(E=g),N===m&&++S===l&&(y=g),(M=C.nextSibling)!==null)break;C=N,N=C.parentNode}C=M}o=E===-1||y===-1?null:{start:E,end:y}}else o=null}o=o||{start:0,end:0}}else o=null;for(eR={focusedElem:r,selectionRange:o},ex=!1,xt=n;xt!==null;)if(n=xt,r=n.child,(n.subtreeFlags&1028)!==0&&r!==null)r.return=n,xt=r;else for(;xt!==null;){n=xt;try{var G=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var I=G.memoizedProps,P=G.memoizedState,L=n.stateNode,R=L.getSnapshotBeforeUpdate(n.elementType===n.type?I:Ja(n.type,I),P);L.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var D=n.stateNode.containerInfo;D.nodeType===1?D.textContent="":D.nodeType===9&&D.documentElement&&D.removeChild(D.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(rt(163))}}catch(V){Ir(n,n.return,V)}if(r=n.sibling,r!==null){r.return=n.return,xt=r;break}xt=n.return}return G=J3,J3=!1,G}function tg(r,n,o){var l=n.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var u=l=l.next;do{if((u.tag&r)===r){var m=u.destroy;u.destroy=void 0,m!==void 0&&gR(n,o,m)}u=u.next}while(u!==l)}}function Bx(r,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&r)===r){var l=o.create;o.destroy=l()}o=o.next}while(o!==n)}}function _R(r){var n=r.ref;if(n!==null){var o=r.stateNode;switch(r.tag){case 5:r=o;break;default:r=o}typeof n=="function"?n(r):n.current=r}}function k8(r){var n=r.alternate;n!==null&&(r.alternate=null,k8(n)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(n=r.stateNode,n!==null&&(delete n[Vo],delete n[bg],delete n[rR],delete n[eue],delete n[tue])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function L8(r){return r.tag===5||r.tag===3||r.tag===4}function Q3(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||L8(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function vR(r,n,o){var l=r.tag;if(l===5||l===6)r=r.stateNode,n?o.nodeType===8?o.parentNode.insertBefore(r,n):o.insertBefore(r,n):(o.nodeType===8?(n=o.parentNode,n.insertBefore(r,o)):(n=o,n.appendChild(r)),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=rx));else if(l!==4&&(r=r.child,r!==null))for(vR(r,n,o),r=r.sibling;r!==null;)vR(r,n,o),r=r.sibling}function ER(r,n,o){var l=r.tag;if(l===5||l===6)r=r.stateNode,n?o.insertBefore(r,n):o.appendChild(r);else if(l!==4&&(r=r.child,r!==null))for(ER(r,n,o),r=r.sibling;r!==null;)ER(r,n,o),r=r.sibling}var fn=null,eo=!1;function ol(r,n,o){for(o=o.child;o!==null;)M8(r,n,o),o=o.sibling}function M8(r,n,o){if(Bo&&typeof Bo.onCommitFiberUnmount=="function")try{Bo.onCommitFiberUnmount(jx,o)}catch{}switch(o.tag){case 5:On||Zh(o,n);case 6:var l=fn,u=eo;fn=null,ol(r,n,o),fn=l,eo=u,fn!==null&&(eo?(r=fn,o=o.stateNode,r.nodeType===8?r.parentNode.removeChild(o):r.removeChild(o)):fn.removeChild(o.stateNode));break;case 18:fn!==null&&(eo?(r=fn,o=o.stateNode,r.nodeType===8?BT(r.parentNode,o):r.nodeType===1&&BT(r,o),_g(r)):BT(fn,o.stateNode));break;case 4:l=fn,u=eo,fn=o.stateNode.containerInfo,eo=!0,ol(r,n,o),fn=l,eo=u;break;case 0:case 11:case 14:case 15:if(!On&&(l=o.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){u=l=l.next;do{var m=u,g=m.destroy;m=m.tag,g!==void 0&&(m&2||m&4)&&gR(o,n,g),u=u.next}while(u!==l)}ol(r,n,o);break;case 1:if(!On&&(Zh(o,n),l=o.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=o.memoizedProps,l.state=o.memoizedState,l.componentWillUnmount()}catch(E){Ir(o,n,E)}ol(r,n,o);break;case 21:ol(r,n,o);break;case 22:o.mode&1?(On=(l=On)||o.memoizedState!==null,ol(r,n,o),On=l):ol(r,n,o);break;default:ol(r,n,o)}}function Z3(r){var n=r.updateQueue;if(n!==null){r.updateQueue=null;var o=r.stateNode;o===null&&(o=r.stateNode=new _ue),n.forEach(function(l){var u=Nue.bind(null,r,l);o.has(l)||(o.add(l),l.then(u,u))})}}function Ya(r,n){var o=n.deletions;if(o!==null)for(var l=0;l<o.length;l++){var u=o[l];try{var m=r,g=n,E=g;e:for(;E!==null;){switch(E.tag){case 5:fn=E.stateNode,eo=!1;break e;case 3:fn=E.stateNode.containerInfo,eo=!0;break e;case 4:fn=E.stateNode.containerInfo,eo=!0;break e}E=E.return}if(fn===null)throw Error(rt(160));M8(m,g,u),fn=null,eo=!1;var y=u.alternate;y!==null&&(y.return=null),u.return=null}catch(x){Ir(u,n,x)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)F8(n,r),n=n.sibling}function F8(r,n){var o=r.alternate,l=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Ya(n,r),Po(r),l&4){try{tg(3,r,r.return),Bx(3,r)}catch(I){Ir(r,r.return,I)}try{tg(5,r,r.return)}catch(I){Ir(r,r.return,I)}}break;case 1:Ya(n,r),Po(r),l&512&&o!==null&&Zh(o,o.return);break;case 5:if(Ya(n,r),Po(r),l&512&&o!==null&&Zh(o,o.return),r.flags&32){var u=r.stateNode;try{pg(u,"")}catch(I){Ir(r,r.return,I)}}if(l&4&&(u=r.stateNode,u!=null)){var m=r.memoizedProps,g=o!==null?o.memoizedProps:m,E=r.type,y=r.updateQueue;if(r.updateQueue=null,y!==null)try{E==="input"&&m.type==="radio"&&m.name!=null&&a9(u,m),GN(E,g);var x=GN(E,m);for(g=0;g<y.length;g+=2){var S=y[g],C=y[g+1];S==="style"?u9(u,C):S==="dangerouslySetInnerHTML"?l9(u,C):S==="children"?pg(u,C):pA(u,S,C,x)}switch(E){case"input":FN(u,m);break;case"textarea":o9(u,m);break;case"select":var N=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!m.multiple;var M=m.value;M!=null?cp(u,!!m.multiple,M,!1):N!==!!m.multiple&&(m.defaultValue!=null?cp(u,!!m.multiple,m.defaultValue,!0):cp(u,!!m.multiple,m.multiple?[]:"",!1))}u[bg]=m}catch(I){Ir(r,r.return,I)}}break;case 6:if(Ya(n,r),Po(r),l&4){if(r.stateNode===null)throw Error(rt(162));u=r.stateNode,m=r.memoizedProps;try{u.nodeValue=m}catch(I){Ir(r,r.return,I)}}break;case 3:if(Ya(n,r),Po(r),l&4&&o!==null&&o.memoizedState.isDehydrated)try{_g(n.containerInfo)}catch(I){Ir(r,r.return,I)}break;case 4:Ya(n,r),Po(r);break;case 13:Ya(n,r),Po(r),u=r.child,u.flags&8192&&(m=u.memoizedState!==null,u.stateNode.isHidden=m,!m||u.alternate!==null&&u.alternate.memoizedState!==null||(KA=Fr())),l&4&&Z3(r);break;case 22:if(S=o!==null&&o.memoizedState!==null,r.mode&1?(On=(x=On)||S,Ya(n,r),On=x):Ya(n,r),Po(r),l&8192){if(x=r.memoizedState!==null,(r.stateNode.isHidden=x)&&!S&&r.mode&1)for(xt=r,S=r.child;S!==null;){for(C=xt=S;xt!==null;){switch(N=xt,M=N.child,N.tag){case 0:case 11:case 14:case 15:tg(4,N,N.return);break;case 1:Zh(N,N.return);var G=N.stateNode;if(typeof G.componentWillUnmount=="function"){l=N,o=N.return;try{n=l,G.props=n.memoizedProps,G.state=n.memoizedState,G.componentWillUnmount()}catch(I){Ir(l,o,I)}}break;case 5:Zh(N,N.return);break;case 22:if(N.memoizedState!==null){tB(C);continue}}M!==null?(M.return=N,xt=M):tB(C)}S=S.sibling}e:for(S=null,C=r;;){if(C.tag===5){if(S===null){S=C;try{u=C.stateNode,x?(m=u.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(E=C.stateNode,y=C.memoizedProps.style,g=y!=null&&y.hasOwnProperty("display")?y.display:null,E.style.display=d9("display",g))}catch(I){Ir(r,r.return,I)}}}else if(C.tag===6){if(S===null)try{C.stateNode.nodeValue=x?"":C.memoizedProps}catch(I){Ir(r,r.return,I)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===r)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===r)break e;for(;C.sibling===null;){if(C.return===null||C.return===r)break e;S===C&&(S=null),C=C.return}S===C&&(S=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Ya(n,r),Po(r),l&4&&Z3(r);break;case 21:break;default:Ya(n,r),Po(r)}}function Po(r){var n=r.flags;if(n&2){try{e:{for(var o=r.return;o!==null;){if(L8(o)){var l=o;break e}o=o.return}throw Error(rt(160))}switch(l.tag){case 5:var u=l.stateNode;l.flags&32&&(pg(u,""),l.flags&=-33);var m=Q3(r);ER(r,m,u);break;case 3:case 4:var g=l.stateNode.containerInfo,E=Q3(r);vR(r,E,g);break;default:throw Error(rt(161))}}catch(y){Ir(r,r.return,y)}r.flags&=-3}n&4096&&(r.flags&=-4097)}function Eue(r,n,o){xt=r,U8(r)}function U8(r,n,o){for(var l=(r.mode&1)!==0;xt!==null;){var u=xt,m=u.child;if(u.tag===22&&l){var g=u.memoizedState!==null||gy;if(!g){var E=u.alternate,y=E!==null&&E.memoizedState!==null||On;E=gy;var x=On;if(gy=g,(On=y)&&!x)for(xt=u;xt!==null;)g=xt,y=g.child,g.tag===22&&g.memoizedState!==null?sB(u):y!==null?(y.return=g,xt=y):sB(u);for(;m!==null;)xt=m,U8(m),m=m.sibling;xt=u,gy=E,On=x}eB(r)}else u.subtreeFlags&8772&&m!==null?(m.return=u,xt=m):eB(r)}}function eB(r){for(;xt!==null;){var n=xt;if(n.flags&8772){var o=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:On||Bx(5,n);break;case 1:var l=n.stateNode;if(n.flags&4&&!On)if(o===null)l.componentDidMount();else{var u=n.elementType===n.type?o.memoizedProps:Ja(n.type,o.memoizedProps);l.componentDidUpdate(u,o.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var m=n.updateQueue;m!==null&&F3(n,m,l);break;case 3:var g=n.updateQueue;if(g!==null){if(o=null,n.child!==null)switch(n.child.tag){case 5:o=n.child.stateNode;break;case 1:o=n.child.stateNode}F3(n,g,o)}break;case 5:var E=n.stateNode;if(o===null&&n.flags&4){o=E;var y=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&o.focus();break;case"img":y.src&&(o.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var x=n.alternate;if(x!==null){var S=x.memoizedState;if(S!==null){var C=S.dehydrated;C!==null&&_g(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(rt(163))}On||n.flags&512&&_R(n)}catch(N){Ir(n,n.return,N)}}if(n===r){xt=null;break}if(o=n.sibling,o!==null){o.return=n.return,xt=o;break}xt=n.return}}function tB(r){for(;xt!==null;){var n=xt;if(n===r){xt=null;break}var o=n.sibling;if(o!==null){o.return=n.return,xt=o;break}xt=n.return}}function sB(r){for(;xt!==null;){var n=xt;try{switch(n.tag){case 0:case 11:case 15:var o=n.return;try{Bx(4,n)}catch(y){Ir(n,o,y)}break;case 1:var l=n.stateNode;if(typeof l.componentDidMount=="function"){var u=n.return;try{l.componentDidMount()}catch(y){Ir(n,u,y)}}var m=n.return;try{_R(n)}catch(y){Ir(n,m,y)}break;case 5:var g=n.return;try{_R(n)}catch(y){Ir(n,g,y)}}}catch(y){Ir(n,n.return,y)}if(n===r){xt=null;break}var E=n.sibling;if(E!==null){E.return=n.return,xt=E;break}xt=n.return}}var yue=Math.ceil,mx=Cc.ReactCurrentDispatcher,HA=Cc.ReactCurrentOwner,ba=Cc.ReactCurrentBatchConfig,Rs=0,cn=null,Hr=null,gn=0,Mi=0,ep=Bl(0),Jr=0,Rg=null,au=0,Wx=0,zA=0,sg=null,mi=null,KA=0,Dp=1/0,mc=null,fx=!1,yR=null,jl=null,_y=!1,Tl=null,gx=0,rg=0,xR=null,Vy=-1,By=0;function Kn(){return Rs&6?Fr():Vy!==-1?Vy:Vy=Fr()}function Pl(r){return r.mode&1?Rs&2&&gn!==0?gn&-gn:rue.transition!==null?(By===0&&(By=w9()),By):(r=Gs,r!==0||(r=window.event,r=r===void 0?16:I9(r.type)),r):1}function ao(r,n,o,l){if(50<rg)throw rg=0,xR=null,Error(rt(185));Hg(r,o,l),(!(Rs&2)||r!==cn)&&(r===cn&&(!(Rs&2)&&(Wx|=o),Jr===4&&vl(r,gn)),yi(r,l),o===1&&Rs===0&&!(n.mode&1)&&(Dp=Fr()+500,Fx&&Wl()))}function yi(r,n){var o=r.callbackNode;rde(r,n);var l=Zy(r,r===cn?gn:0);if(l===0)o!==null&&u3(o),r.callbackNode=null,r.callbackPriority=0;else if(n=l&-l,r.callbackPriority!==n){if(o!=null&&u3(o),n===1)r.tag===0?sue(rB.bind(null,r)):$9(rB.bind(null,r)),Qde(function(){!(Rs&6)&&Wl()}),o=null;else{switch(S9(l)){case 1:o=vA;break;case 4:o=x9;break;case 16:o=Qy;break;case 536870912:o=b9;break;default:o=Qy}o=q8(o,V8.bind(null,r))}r.callbackPriority=n,r.callbackNode=o}}function V8(r,n){if(Vy=-1,By=0,Rs&6)throw Error(rt(327));var o=r.callbackNode;if(pp()&&r.callbackNode!==o)return null;var l=Zy(r,r===cn?gn:0);if(l===0)return null;if(l&30||l&r.expiredLanes||n)n=_x(r,l);else{n=l;var u=Rs;Rs|=2;var m=W8();(cn!==r||gn!==n)&&(mc=null,Dp=Fr()+500,Zd(r,n));do try{wue();break}catch(E){B8(r,E)}while(!0);DA(),mx.current=m,Rs=u,Hr!==null?n=0:(cn=null,gn=0,n=Jr)}if(n!==0){if(n===2&&(u=YN(r),u!==0&&(l=u,n=bR(r,u))),n===1)throw o=Rg,Zd(r,0),vl(r,l),yi(r,Fr()),o;if(n===6)vl(r,l);else{if(u=r.current.alternate,!(l&30)&&!xue(u)&&(n=_x(r,l),n===2&&(m=YN(r),m!==0&&(l=m,n=bR(r,m))),n===1))throw o=Rg,Zd(r,0),vl(r,l),yi(r,Fr()),o;switch(r.finishedWork=u,r.finishedLanes=l,n){case 0:case 1:throw Error(rt(345));case 2:Md(r,mi,mc);break;case 3:if(vl(r,l),(l&130023424)===l&&(n=KA+500-Fr(),10<n)){if(Zy(r,0)!==0)break;if(u=r.suspendedLanes,(u&l)!==l){Kn(),r.pingedLanes|=r.suspendedLanes&u;break}r.timeoutHandle=sR(Md.bind(null,r,mi,mc),n);break}Md(r,mi,mc);break;case 4:if(vl(r,l),(l&4194240)===l)break;for(n=r.eventTimes,u=-1;0<l;){var g=31-io(l);m=1<<g,g=n[g],g>u&&(u=g),l&=~m}if(l=u,l=Fr()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*yue(l/1960))-l,10<l){r.timeoutHandle=sR(Md.bind(null,r,mi,mc),l);break}Md(r,mi,mc);break;case 5:Md(r,mi,mc);break;default:throw Error(rt(329))}}}return yi(r,Fr()),r.callbackNode===o?V8.bind(null,r):null}function bR(r,n){var o=sg;return r.current.memoizedState.isDehydrated&&(Zd(r,n).flags|=256),r=_x(r,n),r!==2&&(n=mi,mi=o,n!==null&&wR(n)),r}function wR(r){mi===null?mi=r:mi.push.apply(mi,r)}function xue(r){for(var n=r;;){if(n.flags&16384){var o=n.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var l=0;l<o.length;l++){var u=o[l],m=u.getSnapshot;u=u.value;try{if(!oo(m(),u))return!1}catch{return!1}}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===r)break;for(;n.sibling===null;){if(n.return===null||n.return===r)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function vl(r,n){for(n&=~zA,n&=~Wx,r.suspendedLanes|=n,r.pingedLanes&=~n,r=r.expirationTimes;0<n;){var o=31-io(n),l=1<<o;r[o]=-1,n&=~l}}function rB(r){if(Rs&6)throw Error(rt(327));pp();var n=Zy(r,0);if(!(n&1))return yi(r,Fr()),null;var o=_x(r,n);if(r.tag!==0&&o===2){var l=YN(r);l!==0&&(n=l,o=bR(r,l))}if(o===1)throw o=Rg,Zd(r,0),vl(r,n),yi(r,Fr()),o;if(o===6)throw Error(rt(345));return r.finishedWork=r.current.alternate,r.finishedLanes=n,Md(r,mi,mc),yi(r,Fr()),null}function qA(r,n){var o=Rs;Rs|=1;try{return r(n)}finally{Rs=o,Rs===0&&(Dp=Fr()+500,Fx&&Wl())}}function ou(r){Tl!==null&&Tl.tag===0&&!(Rs&6)&&pp();var n=Rs;Rs|=1;var o=ba.transition,l=Gs;try{if(ba.transition=null,Gs=1,r)return r()}finally{Gs=l,ba.transition=o,Rs=n,!(Rs&6)&&Wl()}}function YA(){Mi=ep.current,ir(ep)}function Zd(r,n){r.finishedWork=null,r.finishedLanes=0;var o=r.timeoutHandle;if(o!==-1&&(r.timeoutHandle=-1,Jde(o)),Hr!==null)for(o=Hr.return;o!==null;){var l=o;switch(RA(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&nx();break;case 3:Ap(),ir(vi),ir(kn),MA();break;case 5:LA(l);break;case 4:Ap();break;case 13:ir(_r);break;case 19:ir(_r);break;case 10:OA(l.type._context);break;case 22:case 23:YA()}o=o.return}if(cn=r,Hr=r=kl(r.current,null),gn=Mi=n,Jr=0,Rg=null,zA=Wx=au=0,mi=sg=null,Hd!==null){for(n=0;n<Hd.length;n++)if(o=Hd[n],l=o.interleaved,l!==null){o.interleaved=null;var u=l.next,m=o.pending;if(m!==null){var g=m.next;m.next=u,l.next=g}o.pending=l}Hd=null}return r}function B8(r,n){do{var o=Hr;try{if(DA(),My.current=px,hx){for(var l=Er.memoizedState;l!==null;){var u=l.queue;u!==null&&(u.pending=null),l=l.next}hx=!1}if(iu=0,on=Xr=Er=null,eg=!1,Cg=0,HA.current=null,o===null||o.return===null){Jr=1,Rg=n,Hr=null;break}e:{var m=r,g=o.return,E=o,y=n;if(n=gn,E.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var x=y,S=E,C=S.tag;if(!(S.mode&1)&&(C===0||C===11||C===15)){var N=S.alternate;N?(S.updateQueue=N.updateQueue,S.memoizedState=N.memoizedState,S.lanes=N.lanes):(S.updateQueue=null,S.memoizedState=null)}var M=H3(g);if(M!==null){M.flags&=-257,z3(M,g,E,m,n),M.mode&1&&G3(m,x,n),n=M,y=x;var G=n.updateQueue;if(G===null){var I=new Set;I.add(y),n.updateQueue=I}else G.add(y);break e}else{if(!(n&1)){G3(m,x,n),$A();break e}y=Error(rt(426))}}else if(lr&&E.mode&1){var P=H3(g);if(P!==null){!(P.flags&65536)&&(P.flags|=256),z3(P,g,E,m,n),AA(Ip(y,E));break e}}m=y=Ip(y,E),Jr!==4&&(Jr=2),sg===null?sg=[m]:sg.push(m),m=g;do{switch(m.tag){case 3:m.flags|=65536,n&=-n,m.lanes|=n;var L=S8(m,y,n);M3(m,L);break e;case 1:E=y;var R=m.type,D=m.stateNode;if(!(m.flags&128)&&(typeof R.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(jl===null||!jl.has(D)))){m.flags|=65536,n&=-n,m.lanes|=n;var V=C8(m,E,n);M3(m,V);break e}}m=m.return}while(m!==null)}H8(o)}catch(W){n=W,Hr===o&&o!==null&&(Hr=o=o.return);continue}break}while(!0)}function W8(){var r=mx.current;return mx.current=px,r===null?px:r}function $A(){(Jr===0||Jr===3||Jr===2)&&(Jr=4),cn===null||!(au&268435455)&&!(Wx&268435455)||vl(cn,gn)}function _x(r,n){var o=Rs;Rs|=2;var l=W8();(cn!==r||gn!==n)&&(mc=null,Zd(r,n));do try{bue();break}catch(u){B8(r,u)}while(!0);if(DA(),Rs=o,mx.current=l,Hr!==null)throw Error(rt(261));return cn=null,gn=0,Jr}function bue(){for(;Hr!==null;)G8(Hr)}function wue(){for(;Hr!==null&&!Yle();)G8(Hr)}function G8(r){var n=K8(r.alternate,r,Mi);r.memoizedProps=r.pendingProps,n===null?H8(r):Hr=n,HA.current=null}function H8(r){var n=r;do{var o=n.alternate;if(r=n.return,n.flags&32768){if(o=gue(o,n),o!==null){o.flags&=32767,Hr=o;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Jr=6,Hr=null;return}}else if(o=fue(o,n,Mi),o!==null){Hr=o;return}if(n=n.sibling,n!==null){Hr=n;return}Hr=n=r}while(n!==null);Jr===0&&(Jr=5)}function Md(r,n,o){var l=Gs,u=ba.transition;try{ba.transition=null,Gs=1,Sue(r,n,o,l)}finally{ba.transition=u,Gs=l}return null}function Sue(r,n,o,l){do pp();while(Tl!==null);if(Rs&6)throw Error(rt(327));o=r.finishedWork;var u=r.finishedLanes;if(o===null)return null;if(r.finishedWork=null,r.finishedLanes=0,o===r.current)throw Error(rt(177));r.callbackNode=null,r.callbackPriority=0;var m=o.lanes|o.childLanes;if(nde(r,m),r===cn&&(Hr=cn=null,gn=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||_y||(_y=!0,q8(Qy,function(){return pp(),null})),m=(o.flags&15990)!==0,o.subtreeFlags&15990||m){m=ba.transition,ba.transition=null;var g=Gs;Gs=1;var E=Rs;Rs|=4,HA.current=null,vue(r,o),F8(o,r),Hde(eR),ex=!!ZN,eR=ZN=null,r.current=o,Eue(o),$le(),Rs=E,Gs=g,ba.transition=m}else r.current=o;if(_y&&(_y=!1,Tl=r,gx=u),m=r.pendingLanes,m===0&&(jl=null),Qle(o.stateNode),yi(r,Fr()),n!==null)for(l=r.onRecoverableError,o=0;o<n.length;o++)u=n[o],l(u.value,{componentStack:u.stack,digest:u.digest});if(fx)throw fx=!1,r=yR,yR=null,r;return gx&1&&r.tag!==0&&pp(),m=r.pendingLanes,m&1?r===xR?rg++:(rg=0,xR=r):rg=0,Wl(),null}function pp(){if(Tl!==null){var r=S9(gx),n=ba.transition,o=Gs;try{if(ba.transition=null,Gs=16>r?16:r,Tl===null)var l=!1;else{if(r=Tl,Tl=null,gx=0,Rs&6)throw Error(rt(331));var u=Rs;for(Rs|=4,xt=r.current;xt!==null;){var m=xt,g=m.child;if(xt.flags&16){var E=m.deletions;if(E!==null){for(var y=0;y<E.length;y++){var x=E[y];for(xt=x;xt!==null;){var S=xt;switch(S.tag){case 0:case 11:case 15:tg(8,S,m)}var C=S.child;if(C!==null)C.return=S,xt=C;else for(;xt!==null;){S=xt;var N=S.sibling,M=S.return;if(k8(S),S===x){xt=null;break}if(N!==null){N.return=M,xt=N;break}xt=M}}}var G=m.alternate;if(G!==null){var I=G.child;if(I!==null){G.child=null;do{var P=I.sibling;I.sibling=null,I=P}while(I!==null)}}xt=m}}if(m.subtreeFlags&2064&&g!==null)g.return=m,xt=g;else e:for(;xt!==null;){if(m=xt,m.flags&2048)switch(m.tag){case 0:case 11:case 15:tg(9,m,m.return)}var L=m.sibling;if(L!==null){L.return=m.return,xt=L;break e}xt=m.return}}var R=r.current;for(xt=R;xt!==null;){g=xt;var D=g.child;if(g.subtreeFlags&2064&&D!==null)D.return=g,xt=D;else e:for(g=R;xt!==null;){if(E=xt,E.flags&2048)try{switch(E.tag){case 0:case 11:case 15:Bx(9,E)}}catch(W){Ir(E,E.return,W)}if(E===g){xt=null;break e}var V=E.sibling;if(V!==null){V.return=E.return,xt=V;break e}xt=E.return}}if(Rs=u,Wl(),Bo&&typeof Bo.onPostCommitFiberRoot=="function")try{Bo.onPostCommitFiberRoot(jx,r)}catch{}l=!0}return l}finally{Gs=o,ba.transition=n}}return!1}function nB(r,n,o){n=Ip(o,n),n=S8(r,n,1),r=Ol(r,n,1),n=Kn(),r!==null&&(Hg(r,1,n),yi(r,n))}function Ir(r,n,o){if(r.tag===3)nB(r,r,o);else for(;n!==null;){if(n.tag===3){nB(n,r,o);break}else if(n.tag===1){var l=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(jl===null||!jl.has(l))){r=Ip(o,r),r=C8(n,r,1),n=Ol(n,r,1),r=Kn(),n!==null&&(Hg(n,1,r),yi(n,r));break}}n=n.return}}function Cue(r,n,o){var l=r.pingCache;l!==null&&l.delete(n),n=Kn(),r.pingedLanes|=r.suspendedLanes&o,cn===r&&(gn&o)===o&&(Jr===4||Jr===3&&(gn&130023424)===gn&&500>Fr()-KA?Zd(r,0):zA|=o),yi(r,n)}function z8(r,n){n===0&&(r.mode&1?(n=oy,oy<<=1,!(oy&130023424)&&(oy=4194304)):n=1);var o=Kn();r=bc(r,n),r!==null&&(Hg(r,n,o),yi(r,o))}function Tue(r){var n=r.memoizedState,o=0;n!==null&&(o=n.retryLane),z8(r,o)}function Nue(r,n){var o=0;switch(r.tag){case 13:var l=r.stateNode,u=r.memoizedState;u!==null&&(o=u.retryLane);break;case 19:l=r.stateNode;break;default:throw Error(rt(314))}l!==null&&l.delete(n),z8(r,o)}var K8;K8=function(r,n,o){if(r!==null)if(r.memoizedProps!==n.pendingProps||vi.current)fi=!0;else{if(!(r.lanes&o)&&!(n.flags&128))return fi=!1,mue(r,n,o);fi=!!(r.flags&131072)}else fi=!1,lr&&n.flags&1048576&&X9(n,ox,n.index);switch(n.lanes=0,n.tag){case 2:var l=n.type;Uy(r,n),r=n.pendingProps;var u=Tp(n,kn.current);hp(n,o),u=UA(null,n,l,r,u,o);var m=VA();return n.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Ei(l)?(m=!0,ix(n)):m=!1,n.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,PA(n),u.updater=Vx,n.stateNode=u,u._reactInternals=n,lR(n,l,r,o),n=hR(null,n,l,!0,m,o)):(n.tag=0,lr&&m&&NA(n),Gn(null,n,u,o),n=n.child),n;case 16:l=n.elementType;e:{switch(Uy(r,n),r=n.pendingProps,u=l._init,l=u(l._payload),n.type=l,u=n.tag=Aue(l),r=Ja(l,r),u){case 0:n=uR(null,n,l,r,o);break e;case 1:n=Y3(null,n,l,r,o);break e;case 11:n=K3(null,n,l,r,o);break e;case 14:n=q3(null,n,l,Ja(l.type,r),o);break e}throw Error(rt(306,l,""))}return n;case 0:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ja(l,u),uR(r,n,l,u,o);case 1:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ja(l,u),Y3(r,n,l,u,o);case 3:e:{if(A8(n),r===null)throw Error(rt(387));l=n.pendingProps,m=n.memoizedState,u=m.element,s8(r,n),dx(n,l,null,o);var g=n.memoizedState;if(l=g.element,m.isDehydrated)if(m={element:l,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},n.updateQueue.baseState=m,n.memoizedState=m,n.flags&256){u=Ip(Error(rt(423)),n),n=$3(r,n,l,o,u);break e}else if(l!==u){u=Ip(Error(rt(424)),n),n=$3(r,n,l,o,u);break e}else for(Fi=Dl(n.stateNode.containerInfo.firstChild),Ui=n,lr=!0,so=null,o=e8(n,null,l,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Np(),l===u){n=wc(r,n,o);break e}Gn(r,n,l,o)}n=n.child}return n;case 5:return r8(n),r===null&&aR(n),l=n.type,u=n.pendingProps,m=r!==null?r.memoizedProps:null,g=u.children,tR(l,u)?g=null:m!==null&&tR(l,m)&&(n.flags|=32),R8(r,n),Gn(r,n,g,o),n.child;case 6:return r===null&&aR(n),null;case 13:return I8(r,n,o);case 4:return kA(n,n.stateNode.containerInfo),l=n.pendingProps,r===null?n.child=Rp(n,null,l,o):Gn(r,n,l,o),n.child;case 11:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ja(l,u),K3(r,n,l,u,o);case 7:return Gn(r,n,n.pendingProps,o),n.child;case 8:return Gn(r,n,n.pendingProps.children,o),n.child;case 12:return Gn(r,n,n.pendingProps.children,o),n.child;case 10:e:{if(l=n.type._context,u=n.pendingProps,m=n.memoizedProps,g=u.value,tr(cx,l._currentValue),l._currentValue=g,m!==null)if(oo(m.value,g)){if(m.children===u.children&&!vi.current){n=wc(r,n,o);break e}}else for(m=n.child,m!==null&&(m.return=n);m!==null;){var E=m.dependencies;if(E!==null){g=m.child;for(var y=E.firstContext;y!==null;){if(y.context===l){if(m.tag===1){y=Ec(-1,o&-o),y.tag=2;var x=m.updateQueue;if(x!==null){x=x.shared;var S=x.pending;S===null?y.next=y:(y.next=S.next,S.next=y),x.pending=y}}m.lanes|=o,y=m.alternate,y!==null&&(y.lanes|=o),oR(m.return,o,n),E.lanes|=o;break}y=y.next}}else if(m.tag===10)g=m.type===n.type?null:m.child;else if(m.tag===18){if(g=m.return,g===null)throw Error(rt(341));g.lanes|=o,E=g.alternate,E!==null&&(E.lanes|=o),oR(g,o,n),g=m.sibling}else g=m.child;if(g!==null)g.return=m;else for(g=m;g!==null;){if(g===n){g=null;break}if(m=g.sibling,m!==null){m.return=g.return,g=m;break}g=g.return}m=g}Gn(r,n,u.children,o),n=n.child}return n;case 9:return u=n.type,l=n.pendingProps.children,hp(n,o),u=Sa(u),l=l(u),n.flags|=1,Gn(r,n,l,o),n.child;case 14:return l=n.type,u=Ja(l,n.pendingProps),u=Ja(l.type,u),q3(r,n,l,u,o);case 15:return T8(r,n,n.type,n.pendingProps,o);case 17:return l=n.type,u=n.pendingProps,u=n.elementType===l?u:Ja(l,u),Uy(r,n),n.tag=1,Ei(l)?(r=!0,ix(n)):r=!1,hp(n,o),w8(n,l,u),lR(n,l,u,o),hR(null,n,l,!0,r,o);case 19:return D8(r,n,o);case 22:return N8(r,n,o)}throw Error(rt(156,n.tag))};function q8(r,n){return y9(r,n)}function Rue(r,n,o,l){this.tag=r,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ya(r,n,o,l){return new Rue(r,n,o,l)}function XA(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Aue(r){if(typeof r=="function")return XA(r)?1:0;if(r!=null){if(r=r.$$typeof,r===fA)return 11;if(r===gA)return 14}return 2}function kl(r,n){var o=r.alternate;return o===null?(o=ya(r.tag,n,r.key,r.mode),o.elementType=r.elementType,o.type=r.type,o.stateNode=r.stateNode,o.alternate=r,r.alternate=o):(o.pendingProps=n,o.type=r.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=r.flags&14680064,o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,n=r.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=r.sibling,o.index=r.index,o.ref=r.ref,o}function Wy(r,n,o,l,u,m){var g=2;if(l=r,typeof r=="function")XA(r)&&(g=1);else if(typeof r=="string")g=5;else e:switch(r){case Hh:return eu(o.children,u,m,n);case mA:g=8,u|=8;break;case jN:return r=ya(12,o,n,u|2),r.elementType=jN,r.lanes=m,r;case PN:return r=ya(13,o,n,u),r.elementType=PN,r.lanes=m,r;case kN:return r=ya(19,o,n,u),r.elementType=kN,r.lanes=m,r;case r9:return Gx(o,u,m,n);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case t9:g=10;break e;case s9:g=9;break e;case fA:g=11;break e;case gA:g=14;break e;case ml:g=16,l=null;break e}throw Error(rt(130,r==null?r:typeof r,""))}return n=ya(g,o,n,u),n.elementType=r,n.type=l,n.lanes=m,n}function eu(r,n,o,l){return r=ya(7,r,l,n),r.lanes=o,r}function Gx(r,n,o,l){return r=ya(22,r,l,n),r.elementType=r9,r.lanes=o,r.stateNode={isHidden:!1},r}function $T(r,n,o){return r=ya(6,r,null,n),r.lanes=o,r}function XT(r,n,o){return n=ya(4,r.children!==null?r.children:[],r.key,n),n.lanes=o,n.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},n}function Iue(r,n,o,l,u){this.tag=n,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=IT(0),this.expirationTimes=IT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=IT(0),this.identifierPrefix=l,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function JA(r,n,o,l,u,m,g,E,y){return r=new Iue(r,n,o,E,y),n===1?(n=1,m===!0&&(n|=8)):n=0,m=ya(3,null,null,n),r.current=m,m.stateNode=r,m.memoizedState={element:l,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},PA(m),r}function Due(r,n,o){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gh,key:l==null?null:""+l,children:r,containerInfo:n,implementation:o}}function Y8(r){if(!r)return Fl;r=r._reactInternals;e:{if(uu(r)!==r||r.tag!==1)throw Error(rt(170));var n=r;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Ei(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(rt(171))}if(r.tag===1){var o=r.type;if(Ei(o))return Y9(r,o,n)}return n}function $8(r,n,o,l,u,m,g,E,y){return r=JA(o,l,!0,r,u,m,g,E,y),r.context=Y8(null),o=r.current,l=Kn(),u=Pl(o),m=Ec(l,u),m.callback=n??null,Ol(o,m,u),r.current.lanes=u,Hg(r,u,l),yi(r,l),r}function Hx(r,n,o,l){var u=n.current,m=Kn(),g=Pl(u);return o=Y8(o),n.context===null?n.context=o:n.pendingContext=o,n=Ec(m,g),n.payload={element:r},l=l===void 0?null:l,l!==null&&(n.callback=l),r=Ol(u,n,g),r!==null&&(ao(r,u,g,m),Ly(r,u,g)),g}function vx(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function iB(r,n){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var o=r.retryLane;r.retryLane=o!==0&&o<n?o:n}}function QA(r,n){iB(r,n),(r=r.alternate)&&iB(r,n)}function Oue(){return null}var X8=typeof reportError=="function"?reportError:function(r){console.error(r)};function ZA(r){this._internalRoot=r}zx.prototype.render=ZA.prototype.render=function(r){var n=this._internalRoot;if(n===null)throw Error(rt(409));Hx(r,n,null,null)};zx.prototype.unmount=ZA.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var n=r.containerInfo;ou(function(){Hx(null,r,null,null)}),n[xc]=null}};function zx(r){this._internalRoot=r}zx.prototype.unstable_scheduleHydration=function(r){if(r){var n=N9();r={blockedOn:null,target:r,priority:n};for(var o=0;o<_l.length&&n!==0&&n<_l[o].priority;o++);_l.splice(o,0,r),o===0&&A9(r)}};function eI(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Kx(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function aB(){}function jue(r,n,o,l,u){if(u){if(typeof l=="function"){var m=l;l=function(){var x=vx(g);m.call(x)}}var g=$8(n,l,r,0,null,!1,!1,"",aB);return r._reactRootContainer=g,r[xc]=g.current,yg(r.nodeType===8?r.parentNode:r),ou(),g}for(;u=r.lastChild;)r.removeChild(u);if(typeof l=="function"){var E=l;l=function(){var x=vx(y);E.call(x)}}var y=JA(r,0,!1,null,null,!1,!1,"",aB);return r._reactRootContainer=y,r[xc]=y.current,yg(r.nodeType===8?r.parentNode:r),ou(function(){Hx(n,y,o,l)}),y}function qx(r,n,o,l,u){var m=o._reactRootContainer;if(m){var g=m;if(typeof u=="function"){var E=u;u=function(){var y=vx(g);E.call(y)}}Hx(n,g,r,u)}else g=jue(o,n,r,u,l);return vx(g)}C9=function(r){switch(r.tag){case 3:var n=r.stateNode;if(n.current.memoizedState.isDehydrated){var o=Hf(n.pendingLanes);o!==0&&(EA(n,o|1),yi(n,Fr()),!(Rs&6)&&(Dp=Fr()+500,Wl()))}break;case 13:ou(function(){var l=bc(r,1);if(l!==null){var u=Kn();ao(l,r,1,u)}}),QA(r,1)}};yA=function(r){if(r.tag===13){var n=bc(r,134217728);if(n!==null){var o=Kn();ao(n,r,134217728,o)}QA(r,134217728)}};T9=function(r){if(r.tag===13){var n=Pl(r),o=bc(r,n);if(o!==null){var l=Kn();ao(o,r,n,l)}QA(r,n)}};N9=function(){return Gs};R9=function(r,n){var o=Gs;try{return Gs=r,n()}finally{Gs=o}};zN=function(r,n,o){switch(n){case"input":if(FN(r,o),n=o.name,o.type==="radio"&&n!=null){for(o=r;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<o.length;n++){var l=o[n];if(l!==r&&l.form===r.form){var u=Mx(l);if(!u)throw Error(rt(90));i9(l),FN(l,u)}}}break;case"textarea":o9(r,o);break;case"select":n=o.value,n!=null&&cp(r,!!o.multiple,n,!1)}};m9=qA;f9=ou;var Pue={usingClientEntryPoint:!1,Events:[Kg,Yh,Mx,h9,p9,qA]},Pf={findFiberByHostInstance:Gd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kue={bundleType:Pf.bundleType,version:Pf.version,rendererPackageName:Pf.rendererPackageName,rendererConfig:Pf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Cc.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=v9(r),r===null?null:r.stateNode},findFiberByHostInstance:Pf.findFiberByHostInstance||Oue,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vy.isDisabled&&vy.supportsFiber)try{jx=vy.inject(kue),Bo=vy}catch{}}Bi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pue;Bi.createPortal=function(r,n){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eI(n))throw Error(rt(200));return Due(r,n,null,o)};Bi.createRoot=function(r,n){if(!eI(r))throw Error(rt(299));var o=!1,l="",u=X8;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onRecoverableError!==void 0&&(u=n.onRecoverableError)),n=JA(r,1,!1,null,null,o,!1,l,u),r[xc]=n.current,yg(r.nodeType===8?r.parentNode:r),new ZA(n)};Bi.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var n=r._reactInternals;if(n===void 0)throw typeof r.render=="function"?Error(rt(188)):(r=Object.keys(r).join(","),Error(rt(268,r)));return r=v9(n),r=r===null?null:r.stateNode,r};Bi.flushSync=function(r){return ou(r)};Bi.hydrate=function(r,n,o){if(!Kx(n))throw Error(rt(200));return qx(null,r,n,!0,o)};Bi.hydrateRoot=function(r,n,o){if(!eI(r))throw Error(rt(405));var l=o!=null&&o.hydratedSources||null,u=!1,m="",g=X8;if(o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(g=o.onRecoverableError)),n=$8(n,null,r,1,o??null,u,!1,m,g),r[xc]=n.current,yg(r),l)for(r=0;r<l.length;r++)o=l[r],u=o._getVersion,u=u(o._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[o,u]:n.mutableSourceEagerHydrationData.push(o,u);return new zx(n)};Bi.render=function(r,n,o){if(!Kx(n))throw Error(rt(200));return qx(null,r,n,!1,o)};Bi.unmountComponentAtNode=function(r){if(!Kx(r))throw Error(rt(40));return r._reactRootContainer?(ou(function(){qx(null,null,r,!1,function(){r._reactRootContainer=null,r[xc]=null})}),!0):!1};Bi.unstable_batchedUpdates=qA;Bi.unstable_renderSubtreeIntoContainer=function(r,n,o,l){if(!Kx(o))throw Error(rt(200));if(r==null||r._reactInternals===void 0)throw Error(rt(38));return qx(r,n,o,!1,l)};Bi.version="18.3.1-next-f1338f8080-20240426";function J8(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(J8)}catch(r){console.error(r)}}J8(),J7.exports=Bi;var Lue=J7.exports,oB=Lue;DN.createRoot=oB.createRoot,DN.hydrateRoot=oB.hydrateRoot;var Yx=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},$x=typeof window>"u"||"Deno"in globalThis;function Qa(){}function Mue(r,n){return typeof r=="function"?r(n):r}function Fue(r){return typeof r=="number"&&r>=0&&r!==1/0}function Uue(r,n){return Math.max(r+(n||0)-Date.now(),0)}function cB(r,n){return typeof r=="function"?r(n):r}function Vue(r,n){return typeof r=="function"?r(n):r}function lB(r,n){const{type:o="all",exact:l,fetchStatus:u,predicate:m,queryKey:g,stale:E}=r;if(g){if(l){if(n.queryHash!==tI(g,n.options))return!1}else if(!Ig(n.queryKey,g))return!1}if(o!=="all"){const y=n.isActive();if(o==="active"&&!y||o==="inactive"&&y)return!1}return!(typeof E=="boolean"&&n.isStale()!==E||u&&u!==n.state.fetchStatus||m&&!m(n))}function dB(r,n){const{exact:o,status:l,predicate:u,mutationKey:m}=r;if(m){if(!n.options.mutationKey)return!1;if(o){if(Ag(n.options.mutationKey)!==Ag(m))return!1}else if(!Ig(n.options.mutationKey,m))return!1}return!(l&&n.state.status!==l||u&&!u(n))}function tI(r,n){return((n==null?void 0:n.queryKeyHashFn)||Ag)(r)}function Ag(r){return JSON.stringify(r,(n,o)=>SR(o)?Object.keys(o).sort().reduce((l,u)=>(l[u]=o[u],l),{}):o)}function Ig(r,n){return r===n?!0:typeof r!=typeof n?!1:r&&n&&typeof r=="object"&&typeof n=="object"?!Object.keys(n).some(o=>!Ig(r[o],n[o])):!1}function Q8(r,n){if(r===n)return r;const o=uB(r)&&uB(n);if(o||SR(r)&&SR(n)){const l=o?r:Object.keys(r),u=l.length,m=o?n:Object.keys(n),g=m.length,E=o?[]:{};let y=0;for(let x=0;x<g;x++){const S=o?x:m[x];(!o&&l.includes(S)||o)&&r[S]===void 0&&n[S]===void 0?(E[S]=void 0,y++):(E[S]=Q8(r[S],n[S]),E[S]===r[S]&&r[S]!==void 0&&y++)}return u===g&&y===u?r:E}return n}function uB(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function SR(r){if(!hB(r))return!1;const n=r.constructor;if(n===void 0)return!0;const o=n.prototype;return!(!hB(o)||!o.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function hB(r){return Object.prototype.toString.call(r)==="[object Object]"}function Bue(r){return new Promise(n=>{setTimeout(n,r)})}function Wue(r,n,o){return typeof o.structuralSharing=="function"?o.structuralSharing(r,n):o.structuralSharing!==!1?Q8(r,n):n}function Gue(r,n,o=0){const l=[...r,n];return o&&l.length>o?l.slice(1):l}function Hue(r,n,o=0){const l=[n,...r];return o&&l.length>o?l.slice(0,-1):l}var Z8=Symbol(),eW=(r,n)=>!r.queryFn&&(n!=null&&n.initialPromise)?()=>n.initialPromise:!r.queryFn||r.queryFn===Z8?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn,$d,yl,gp,D7,zue=(D7=class extends Yx{constructor(){super();Ms(this,$d);Ms(this,yl);Ms(this,gp);rs(this,gp,n=>{if(!$x&&window.addEventListener){const o=()=>n();return window.addEventListener("visibilitychange",o,!1),()=>{window.removeEventListener("visibilitychange",o)}}})}onSubscribe(){et(this,yl)||this.setEventListener(et(this,gp))}onUnsubscribe(){var n;this.hasListeners()||((n=et(this,yl))==null||n.call(this),rs(this,yl,void 0))}setEventListener(n){var o;rs(this,gp,n),(o=et(this,yl))==null||o.call(this),rs(this,yl,n(l=>{typeof l=="boolean"?this.setFocused(l):this.onFocus()}))}setFocused(n){et(this,$d)!==n&&(rs(this,$d,n),this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(o=>{o(n)})}isFocused(){var n;return typeof et(this,$d)=="boolean"?et(this,$d):((n=globalThis.document)==null?void 0:n.visibilityState)!=="hidden"}},$d=new WeakMap,yl=new WeakMap,gp=new WeakMap,D7),tW=new zue,_p,xl,vp,O7,Kue=(O7=class extends Yx{constructor(){super();Ms(this,_p,!0);Ms(this,xl);Ms(this,vp);rs(this,vp,n=>{if(!$x&&window.addEventListener){const o=()=>n(!0),l=()=>n(!1);return window.addEventListener("online",o,!1),window.addEventListener("offline",l,!1),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",l)}}})}onSubscribe(){et(this,xl)||this.setEventListener(et(this,vp))}onUnsubscribe(){var n;this.hasListeners()||((n=et(this,xl))==null||n.call(this),rs(this,xl,void 0))}setEventListener(n){var o;rs(this,vp,n),(o=et(this,xl))==null||o.call(this),rs(this,xl,n(this.setOnline.bind(this)))}setOnline(n){et(this,_p)!==n&&(rs(this,_p,n),this.listeners.forEach(l=>{l(n)}))}isOnline(){return et(this,_p)}},_p=new WeakMap,xl=new WeakMap,vp=new WeakMap,O7),Ex=new Kue;function que(r){return Math.min(1e3*2**r,3e4)}function sW(r){return(r??"online")==="online"?Ex.isOnline():!0}var rW=class{constructor(r){this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function JT(r){return r instanceof rW}function nW(r){let n=!1,o=0,l=!1,u,m,g;const E=new Promise((L,R)=>{m=L,g=R}),y=L=>{var R;l||(G(new rW(L)),(R=r.abort)==null||R.call(r))},x=()=>{n=!0},S=()=>{n=!1},C=()=>tW.isFocused()&&(r.networkMode==="always"||Ex.isOnline())&&r.canRun(),N=()=>sW(r.networkMode)&&r.canRun(),M=L=>{var R;l||(l=!0,(R=r.onSuccess)==null||R.call(r,L),u==null||u(),m(L))},G=L=>{var R;l||(l=!0,(R=r.onError)==null||R.call(r,L),u==null||u(),g(L))},I=()=>new Promise(L=>{var R;u=D=>{(l||C())&&L(D)},(R=r.onPause)==null||R.call(r)}).then(()=>{var L;u=void 0,l||(L=r.onContinue)==null||L.call(r)}),P=()=>{if(l)return;let L;const R=o===0?r.initialPromise:void 0;try{L=R??r.fn()}catch(D){L=Promise.reject(D)}Promise.resolve(L).then(M).catch(D=>{var J;if(l)return;const V=r.retry??($x?0:3),W=r.retryDelay??que,q=typeof W=="function"?W(o,D):W,H=V===!0||typeof V=="number"&&o<V||typeof V=="function"&&V(o,D);if(n||!H){G(D);return}o++,(J=r.onFail)==null||J.call(r,o,D),Bue(q).then(()=>C()?void 0:I()).then(()=>{n?G(D):P()})})};return{promise:E,cancel:y,continue:()=>(u==null||u(),E),cancelRetry:x,continueRetry:S,canStart:N,start:()=>(N()?P():I().then(P),E)}}function Yue(){let r=[],n=0,o=N=>{N()},l=N=>{N()},u=N=>setTimeout(N,0);const m=N=>{u=N},g=N=>{let M;n++;try{M=N()}finally{n--,n||x()}return M},E=N=>{n?r.push(N):u(()=>{o(N)})},y=N=>(...M)=>{E(()=>{N(...M)})},x=()=>{const N=r;r=[],N.length&&u(()=>{l(()=>{N.forEach(M=>{o(M)})})})};return{batch:g,batchCalls:y,schedule:E,setNotifyFunction:N=>{o=N},setBatchNotifyFunction:N=>{l=N},setScheduler:m}}var Hn=Yue(),Xd,j7,iW=(j7=class{constructor(){Ms(this,Xd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Fue(this.gcTime)&&rs(this,Xd,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??($x?1/0:5*60*1e3))}clearGcTimeout(){et(this,Xd)&&(clearTimeout(et(this,Xd)),rs(this,Xd,void 0))}},Xd=new WeakMap,j7),Ep,yp,ga,In,Bg,Jd,Za,pc,P7,$ue=(P7=class extends iW{constructor(n){super();Ms(this,Za);Ms(this,Ep);Ms(this,yp);Ms(this,ga);Ms(this,In);Ms(this,Bg);Ms(this,Jd);rs(this,Jd,!1),rs(this,Bg,n.defaultOptions),this.setOptions(n.options),this.observers=[],rs(this,ga,n.cache),this.queryKey=n.queryKey,this.queryHash=n.queryHash,rs(this,Ep,n.state||Jue(this.options)),this.state=et(this,Ep),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var n;return(n=et(this,In))==null?void 0:n.promise}setOptions(n){this.options={...et(this,Bg),...n},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&et(this,ga).remove(this)}setData(n,o){const l=Wue(this.state.data,n,this.options);return Nn(this,Za,pc).call(this,{data:l,type:"success",dataUpdatedAt:o==null?void 0:o.updatedAt,manual:o==null?void 0:o.manual}),l}setState(n,o){Nn(this,Za,pc).call(this,{type:"setState",state:n,setStateOptions:o})}cancel(n){var l,u;const o=(l=et(this,In))==null?void 0:l.promise;return(u=et(this,In))==null||u.cancel(n),o?o.then(Qa).catch(Qa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(et(this,Ep))}isActive(){return this.observers.some(n=>Vue(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(n=0){return this.state.isInvalidated||this.state.data===void 0||!Uue(this.state.dataUpdatedAt,n)}onFocus(){var o;const n=this.observers.find(l=>l.shouldFetchOnWindowFocus());n==null||n.refetch({cancelRefetch:!1}),(o=et(this,In))==null||o.continue()}onOnline(){var o;const n=this.observers.find(l=>l.shouldFetchOnReconnect());n==null||n.refetch({cancelRefetch:!1}),(o=et(this,In))==null||o.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),et(this,ga).notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(o=>o!==n),this.observers.length||(et(this,In)&&(et(this,Jd)?et(this,In).cancel({revert:!0}):et(this,In).cancelRetry()),this.scheduleGc()),et(this,ga).notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Nn(this,Za,pc).call(this,{type:"invalidate"})}fetch(n,o){var y,x,S;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(o!=null&&o.cancelRefetch))this.cancel({silent:!0});else if(et(this,In))return et(this,In).continueRetry(),et(this,In).promise}if(n&&this.setOptions(n),!this.options.queryFn){const C=this.observers.find(N=>N.options.queryFn);C&&this.setOptions(C.options)}const l=new AbortController,u=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(rs(this,Jd,!0),l.signal)})},m=()=>{const C=eW(this.options,o),N={queryKey:this.queryKey,meta:this.meta};return u(N),rs(this,Jd,!1),this.options.persister?this.options.persister(C,N,this):C(N)},g={fetchOptions:o,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:m};u(g),(y=this.options.behavior)==null||y.onFetch(g,this),rs(this,yp,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((x=g.fetchOptions)==null?void 0:x.meta))&&Nn(this,Za,pc).call(this,{type:"fetch",meta:(S=g.fetchOptions)==null?void 0:S.meta});const E=C=>{var N,M,G,I;JT(C)&&C.silent||Nn(this,Za,pc).call(this,{type:"error",error:C}),JT(C)||((M=(N=et(this,ga).config).onError)==null||M.call(N,C,this),(I=(G=et(this,ga).config).onSettled)==null||I.call(G,this.state.data,C,this)),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return rs(this,In,nW({initialPromise:o==null?void 0:o.initialPromise,fn:g.fetchFn,abort:l.abort.bind(l),onSuccess:C=>{var N,M,G,I;if(C===void 0){E(new Error(`${this.queryHash} data is undefined`));return}this.setData(C),(M=(N=et(this,ga).config).onSuccess)==null||M.call(N,C,this),(I=(G=et(this,ga).config).onSettled)==null||I.call(G,C,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:E,onFail:(C,N)=>{Nn(this,Za,pc).call(this,{type:"failed",failureCount:C,error:N})},onPause:()=>{Nn(this,Za,pc).call(this,{type:"pause"})},onContinue:()=>{Nn(this,Za,pc).call(this,{type:"continue"})},retry:g.options.retry,retryDelay:g.options.retryDelay,networkMode:g.options.networkMode,canRun:()=>!0})),et(this,In).start()}},Ep=new WeakMap,yp=new WeakMap,ga=new WeakMap,In=new WeakMap,Bg=new WeakMap,Jd=new WeakMap,Za=new WeakSet,pc=function(n){const o=l=>{switch(n.type){case"failed":return{...l,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...l,fetchStatus:"paused"};case"continue":return{...l,fetchStatus:"fetching"};case"fetch":return{...l,...Xue(l.data,this.options),fetchMeta:n.meta??null};case"success":return{...l,data:n.data,dataUpdateCount:l.dataUpdateCount+1,dataUpdatedAt:n.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const u=n.error;return JT(u)&&u.revert&&et(this,yp)?{...et(this,yp),fetchStatus:"idle"}:{...l,error:u,errorUpdateCount:l.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:l.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...l,isInvalidated:!0};case"setState":return{...l,...n.state}}};this.state=o(this.state),Hn.batch(()=>{this.observers.forEach(l=>{l.onQueryUpdate()}),et(this,ga).notify({query:this,type:"updated",action:n})})},P7);function Xue(r,n){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:sW(n.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function Jue(r){const n=typeof r.initialData=="function"?r.initialData():r.initialData,o=n!==void 0,l=o?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:n,dataUpdateCount:0,dataUpdatedAt:o?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:o?"success":"pending",fetchStatus:"idle"}}var Mo,k7,Que=(k7=class extends Yx{constructor(n={}){super();Ms(this,Mo);this.config=n,rs(this,Mo,new Map)}build(n,o,l){const u=o.queryKey,m=o.queryHash??tI(u,o);let g=this.get(m);return g||(g=new $ue({cache:this,queryKey:u,queryHash:m,options:n.defaultQueryOptions(o),state:l,defaultOptions:n.getQueryDefaults(u)}),this.add(g)),g}add(n){et(this,Mo).has(n.queryHash)||(et(this,Mo).set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const o=et(this,Mo).get(n.queryHash);o&&(n.destroy(),o===n&&et(this,Mo).delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){Hn.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return et(this,Mo).get(n)}getAll(){return[...et(this,Mo).values()]}find(n){const o={exact:!0,...n};return this.getAll().find(l=>lB(o,l))}findAll(n={}){const o=this.getAll();return Object.keys(n).length>0?o.filter(l=>lB(n,l)):o}notify(n){Hn.batch(()=>{this.listeners.forEach(o=>{o(n)})})}onFocus(){Hn.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){Hn.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},Mo=new WeakMap,k7),Fo,Wn,Qd,Uo,ll,L7,Zue=(L7=class extends iW{constructor(n){super();Ms(this,Uo);Ms(this,Fo);Ms(this,Wn);Ms(this,Qd);this.mutationId=n.mutationId,rs(this,Wn,n.mutationCache),rs(this,Fo,[]),this.state=n.state||ehe(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){et(this,Fo).includes(n)||(et(this,Fo).push(n),this.clearGcTimeout(),et(this,Wn).notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){rs(this,Fo,et(this,Fo).filter(o=>o!==n)),this.scheduleGc(),et(this,Wn).notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){et(this,Fo).length||(this.state.status==="pending"?this.scheduleGc():et(this,Wn).remove(this))}continue(){var n;return((n=et(this,Qd))==null?void 0:n.continue())??this.execute(this.state.variables)}async execute(n){var u,m,g,E,y,x,S,C,N,M,G,I,P,L,R,D,V,W,q,H;rs(this,Qd,nW({fn:()=>this.options.mutationFn?this.options.mutationFn(n):Promise.reject(new Error("No mutationFn found")),onFail:(J,ee)=>{Nn(this,Uo,ll).call(this,{type:"failed",failureCount:J,error:ee})},onPause:()=>{Nn(this,Uo,ll).call(this,{type:"pause"})},onContinue:()=>{Nn(this,Uo,ll).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>et(this,Wn).canRun(this)}));const o=this.state.status==="pending",l=!et(this,Qd).canStart();try{if(!o){Nn(this,Uo,ll).call(this,{type:"pending",variables:n,isPaused:l}),await((m=(u=et(this,Wn).config).onMutate)==null?void 0:m.call(u,n,this));const ee=await((E=(g=this.options).onMutate)==null?void 0:E.call(g,n));ee!==this.state.context&&Nn(this,Uo,ll).call(this,{type:"pending",context:ee,variables:n,isPaused:l})}const J=await et(this,Qd).start();return await((x=(y=et(this,Wn).config).onSuccess)==null?void 0:x.call(y,J,n,this.state.context,this)),await((C=(S=this.options).onSuccess)==null?void 0:C.call(S,J,n,this.state.context)),await((M=(N=et(this,Wn).config).onSettled)==null?void 0:M.call(N,J,null,this.state.variables,this.state.context,this)),await((I=(G=this.options).onSettled)==null?void 0:I.call(G,J,null,n,this.state.context)),Nn(this,Uo,ll).call(this,{type:"success",data:J}),J}catch(J){try{throw await((L=(P=et(this,Wn).config).onError)==null?void 0:L.call(P,J,n,this.state.context,this)),await((D=(R=this.options).onError)==null?void 0:D.call(R,J,n,this.state.context)),await((W=(V=et(this,Wn).config).onSettled)==null?void 0:W.call(V,void 0,J,this.state.variables,this.state.context,this)),await((H=(q=this.options).onSettled)==null?void 0:H.call(q,void 0,J,n,this.state.context)),J}finally{Nn(this,Uo,ll).call(this,{type:"error",error:J})}}finally{et(this,Wn).runNext(this)}}},Fo=new WeakMap,Wn=new WeakMap,Qd=new WeakMap,Uo=new WeakSet,ll=function(n){const o=l=>{switch(n.type){case"failed":return{...l,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...l,isPaused:!0};case"continue":return{...l,isPaused:!1};case"pending":return{...l,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...l,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...l,data:void 0,error:n.error,failureCount:l.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=o(this.state),Hn.batch(()=>{et(this,Fo).forEach(l=>{l.onMutationUpdate(n)}),et(this,Wn).notify({mutation:this,type:"updated",action:n})})},L7);function ehe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Li,Wg,M7,the=(M7=class extends Yx{constructor(n={}){super();Ms(this,Li);Ms(this,Wg);this.config=n,rs(this,Li,new Map),rs(this,Wg,Date.now())}build(n,o,l){const u=new Zue({mutationCache:this,mutationId:++ty(this,Wg)._,options:n.defaultMutationOptions(o),state:l});return this.add(u),u}add(n){const o=Ey(n),l=et(this,Li).get(o)??[];l.push(n),et(this,Li).set(o,l),this.notify({type:"added",mutation:n})}remove(n){var l;const o=Ey(n);if(et(this,Li).has(o)){const u=(l=et(this,Li).get(o))==null?void 0:l.filter(m=>m!==n);u&&(u.length===0?et(this,Li).delete(o):et(this,Li).set(o,u))}this.notify({type:"removed",mutation:n})}canRun(n){var l;const o=(l=et(this,Li).get(Ey(n)))==null?void 0:l.find(u=>u.state.status==="pending");return!o||o===n}runNext(n){var l;const o=(l=et(this,Li).get(Ey(n)))==null?void 0:l.find(u=>u!==n&&u.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}clear(){Hn.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}getAll(){return[...et(this,Li).values()].flat()}find(n){const o={exact:!0,...n};return this.getAll().find(l=>dB(o,l))}findAll(n={}){return this.getAll().filter(o=>dB(n,o))}notify(n){Hn.batch(()=>{this.listeners.forEach(o=>{o(n)})})}resumePausedMutations(){const n=this.getAll().filter(o=>o.state.isPaused);return Hn.batch(()=>Promise.all(n.map(o=>o.continue().catch(Qa))))}},Li=new WeakMap,Wg=new WeakMap,M7);function Ey(r){var n;return((n=r.options.scope)==null?void 0:n.id)??String(r.mutationId)}function she(r){return{onFetch:(n,o)=>{const l=async()=>{var G,I,P,L,R;const u=n.options,m=(P=(I=(G=n.fetchOptions)==null?void 0:G.meta)==null?void 0:I.fetchMore)==null?void 0:P.direction,g=((L=n.state.data)==null?void 0:L.pages)||[],E=((R=n.state.data)==null?void 0:R.pageParams)||[],y={pages:[],pageParams:[]};let x=!1;const S=D=>{Object.defineProperty(D,"signal",{enumerable:!0,get:()=>(n.signal.aborted?x=!0:n.signal.addEventListener("abort",()=>{x=!0}),n.signal)})},C=eW(n.options,n.fetchOptions),N=async(D,V,W)=>{if(x)return Promise.reject();if(V==null&&D.pages.length)return Promise.resolve(D);const q={queryKey:n.queryKey,pageParam:V,direction:W?"backward":"forward",meta:n.options.meta};S(q);const H=await C(q),{maxPages:J}=n.options,ee=W?Hue:Gue;return{pages:ee(D.pages,H,J),pageParams:ee(D.pageParams,V,J)}};let M;if(m&&g.length){const D=m==="backward",V=D?rhe:pB,W={pages:g,pageParams:E},q=V(u,W);M=await N(W,q,D)}else{M=await N(y,E[0]??u.initialPageParam);const D=r??g.length;for(let V=1;V<D;V++){const W=pB(u,M);M=await N(M,W)}}return M};n.options.persister?n.fetchFn=()=>{var u,m;return(m=(u=n.options).persister)==null?void 0:m.call(u,l,{queryKey:n.queryKey,meta:n.options.meta,signal:n.signal},o)}:n.fetchFn=l}}}function pB(r,{pages:n,pageParams:o}){const l=n.length-1;return r.getNextPageParam(n[l],n,o[l],o)}function rhe(r,{pages:n,pageParams:o}){var l;return(l=r.getPreviousPageParam)==null?void 0:l.call(r,n[0],n,o[0],o)}var Rr,bl,wl,xp,bp,Sl,wp,Sp,F7,nhe=(F7=class{constructor(r={}){Ms(this,Rr);Ms(this,bl);Ms(this,wl);Ms(this,xp);Ms(this,bp);Ms(this,Sl);Ms(this,wp);Ms(this,Sp);rs(this,Rr,r.queryCache||new Que),rs(this,bl,r.mutationCache||new the),rs(this,wl,r.defaultOptions||{}),rs(this,xp,new Map),rs(this,bp,new Map),rs(this,Sl,0)}mount(){ty(this,Sl)._++,et(this,Sl)===1&&(rs(this,wp,tW.subscribe(async r=>{r&&(await this.resumePausedMutations(),et(this,Rr).onFocus())})),rs(this,Sp,Ex.subscribe(async r=>{r&&(await this.resumePausedMutations(),et(this,Rr).onOnline())})))}unmount(){var r,n;ty(this,Sl)._--,et(this,Sl)===0&&((r=et(this,wp))==null||r.call(this),rs(this,wp,void 0),(n=et(this,Sp))==null||n.call(this),rs(this,Sp,void 0))}isFetching(r){return et(this,Rr).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return et(this,bl).findAll({...r,status:"pending"}).length}getQueryData(r){var o;const n=this.defaultQueryOptions({queryKey:r});return(o=et(this,Rr).get(n.queryHash))==null?void 0:o.state.data}ensureQueryData(r){const n=this.getQueryData(r.queryKey);if(n===void 0)return this.fetchQuery(r);{const o=this.defaultQueryOptions(r),l=et(this,Rr).build(this,o);return r.revalidateIfStale&&l.isStaleByTime(cB(o.staleTime,l))&&this.prefetchQuery(o),Promise.resolve(n)}}getQueriesData(r){return et(this,Rr).findAll(r).map(({queryKey:n,state:o})=>{const l=o.data;return[n,l]})}setQueryData(r,n,o){const l=this.defaultQueryOptions({queryKey:r}),u=et(this,Rr).get(l.queryHash),m=u==null?void 0:u.state.data,g=Mue(n,m);if(g!==void 0)return et(this,Rr).build(this,l).setData(g,{...o,manual:!0})}setQueriesData(r,n,o){return Hn.batch(()=>et(this,Rr).findAll(r).map(({queryKey:l})=>[l,this.setQueryData(l,n,o)]))}getQueryState(r){var o;const n=this.defaultQueryOptions({queryKey:r});return(o=et(this,Rr).get(n.queryHash))==null?void 0:o.state}removeQueries(r){const n=et(this,Rr);Hn.batch(()=>{n.findAll(r).forEach(o=>{n.remove(o)})})}resetQueries(r,n){const o=et(this,Rr),l={type:"active",...r};return Hn.batch(()=>(o.findAll(r).forEach(u=>{u.reset()}),this.refetchQueries(l,n)))}cancelQueries(r={},n={}){const o={revert:!0,...n},l=Hn.batch(()=>et(this,Rr).findAll(r).map(u=>u.cancel(o)));return Promise.all(l).then(Qa).catch(Qa)}invalidateQueries(r={},n={}){return Hn.batch(()=>{if(et(this,Rr).findAll(r).forEach(l=>{l.invalidate()}),r.refetchType==="none")return Promise.resolve();const o={...r,type:r.refetchType??r.type??"active"};return this.refetchQueries(o,n)})}refetchQueries(r={},n){const o={...n,cancelRefetch:(n==null?void 0:n.cancelRefetch)??!0},l=Hn.batch(()=>et(this,Rr).findAll(r).filter(u=>!u.isDisabled()).map(u=>{let m=u.fetch(void 0,o);return o.throwOnError||(m=m.catch(Qa)),u.state.fetchStatus==="paused"?Promise.resolve():m}));return Promise.all(l).then(Qa)}fetchQuery(r){const n=this.defaultQueryOptions(r);n.retry===void 0&&(n.retry=!1);const o=et(this,Rr).build(this,n);return o.isStaleByTime(cB(n.staleTime,o))?o.fetch(n):Promise.resolve(o.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(Qa).catch(Qa)}fetchInfiniteQuery(r){return r.behavior=she(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(Qa).catch(Qa)}resumePausedMutations(){return Ex.isOnline()?et(this,bl).resumePausedMutations():Promise.resolve()}getQueryCache(){return et(this,Rr)}getMutationCache(){return et(this,bl)}getDefaultOptions(){return et(this,wl)}setDefaultOptions(r){rs(this,wl,r)}setQueryDefaults(r,n){et(this,xp).set(Ag(r),{queryKey:r,defaultOptions:n})}getQueryDefaults(r){const n=[...et(this,xp).values()];let o={};return n.forEach(l=>{Ig(r,l.queryKey)&&(o={...o,...l.defaultOptions})}),o}setMutationDefaults(r,n){et(this,bp).set(Ag(r),{mutationKey:r,defaultOptions:n})}getMutationDefaults(r){const n=[...et(this,bp).values()];let o={};return n.forEach(l=>{Ig(r,l.mutationKey)&&(o={...o,...l.defaultOptions})}),o}defaultQueryOptions(r){if(r._defaulted)return r;const n={...et(this,wl).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return n.queryHash||(n.queryHash=tI(n.queryKey,n)),n.refetchOnReconnect===void 0&&(n.refetchOnReconnect=n.networkMode!=="always"),n.throwOnError===void 0&&(n.throwOnError=!!n.suspense),!n.networkMode&&n.persister&&(n.networkMode="offlineFirst"),n.enabled!==!0&&n.queryFn===Z8&&(n.enabled=!1),n}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...et(this,wl).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){et(this,Rr).clear(),et(this,bl).clear()}},Rr=new WeakMap,bl=new WeakMap,wl=new WeakMap,xp=new WeakMap,bp=new WeakMap,Sl=new WeakMap,wp=new WeakMap,Sp=new WeakMap,F7),ihe=O.createContext(void 0),ahe=({client:r,children:n})=>(O.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),i.jsx(ihe.Provider,{value:r,children:n}));/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dg(){return Dg=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(r[l]=o[l])}return r},Dg.apply(this,arguments)}var Nl;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Nl||(Nl={}));const mB="popstate";function ohe(r){r===void 0&&(r={});function n(l,u){let{pathname:m,search:g,hash:E}=l.location;return CR("",{pathname:m,search:g,hash:E},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function o(l,u){return typeof u=="string"?u:yx(u)}return lhe(n,o,null,r)}function yr(r,n){if(r===!1||r===null||typeof r>"u")throw new Error(n)}function aW(r,n){if(!r){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function che(){return Math.random().toString(36).substr(2,8)}function fB(r,n){return{usr:r.state,key:r.key,idx:n}}function CR(r,n,o,l){return o===void 0&&(o=null),Dg({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof n=="string"?Bp(n):n,{state:o,key:n&&n.key||l||che()})}function yx(r){let{pathname:n="/",search:o="",hash:l=""}=r;return o&&o!=="?"&&(n+=o.charAt(0)==="?"?o:"?"+o),l&&l!=="#"&&(n+=l.charAt(0)==="#"?l:"#"+l),n}function Bp(r){let n={};if(r){let o=r.indexOf("#");o>=0&&(n.hash=r.substr(o),r=r.substr(0,o));let l=r.indexOf("?");l>=0&&(n.search=r.substr(l),r=r.substr(0,l)),r&&(n.pathname=r)}return n}function lhe(r,n,o,l){l===void 0&&(l={});let{window:u=document.defaultView,v5Compat:m=!1}=l,g=u.history,E=Nl.Pop,y=null,x=S();x==null&&(x=0,g.replaceState(Dg({},g.state,{idx:x}),""));function S(){return(g.state||{idx:null}).idx}function C(){E=Nl.Pop;let P=S(),L=P==null?null:P-x;x=P,y&&y({action:E,location:I.location,delta:L})}function N(P,L){E=Nl.Push;let R=CR(I.location,P,L);x=S()+1;let D=fB(R,x),V=I.createHref(R);try{g.pushState(D,"",V)}catch(W){if(W instanceof DOMException&&W.name==="DataCloneError")throw W;u.location.assign(V)}m&&y&&y({action:E,location:I.location,delta:1})}function M(P,L){E=Nl.Replace;let R=CR(I.location,P,L);x=S();let D=fB(R,x),V=I.createHref(R);g.replaceState(D,"",V),m&&y&&y({action:E,location:I.location,delta:0})}function G(P){let L=u.location.origin!=="null"?u.location.origin:u.location.href,R=typeof P=="string"?P:yx(P);return R=R.replace(/ $/,"%20"),yr(L,"No window.location.(origin|href) available to create URL for href: "+R),new URL(R,L)}let I={get action(){return E},get location(){return r(u,g)},listen(P){if(y)throw new Error("A history only accepts one active listener");return u.addEventListener(mB,C),y=P,()=>{u.removeEventListener(mB,C),y=null}},createHref(P){return n(u,P)},createURL:G,encodeLocation(P){let L=G(P);return{pathname:L.pathname,search:L.search,hash:L.hash}},push:N,replace:M,go(P){return g.go(P)}};return I}var gB;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(gB||(gB={}));function dhe(r,n,o){return o===void 0&&(o="/"),uhe(r,n,o)}function uhe(r,n,o,l){let u=typeof n=="string"?Bp(n):n,m=Op(u.pathname||"/",o);if(m==null)return null;let g=oW(r);hhe(g);let E=null;for(let y=0;E==null&&y<g.length;++y){let x=whe(m);E=xhe(g[y],x)}return E}function oW(r,n,o,l){n===void 0&&(n=[]),o===void 0&&(o=[]),l===void 0&&(l="");let u=(m,g,E)=>{let y={relativePath:E===void 0?m.path||"":E,caseSensitive:m.caseSensitive===!0,childrenIndex:g,route:m};y.relativePath.startsWith("/")&&(yr(y.relativePath.startsWith(l),'Absolute route path "'+y.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),y.relativePath=y.relativePath.slice(l.length));let x=Ll([l,y.relativePath]),S=o.concat(y);m.children&&m.children.length>0&&(yr(m.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),oW(m.children,n,S,x)),!(m.path==null&&!m.index)&&n.push({path:x,score:Ehe(x,m.index),routesMeta:S})};return r.forEach((m,g)=>{var E;if(m.path===""||!((E=m.path)!=null&&E.includes("?")))u(m,g);else for(let y of cW(m.path))u(m,g,y)}),n}function cW(r){let n=r.split("/");if(n.length===0)return[];let[o,...l]=n,u=o.endsWith("?"),m=o.replace(/\?$/,"");if(l.length===0)return u?[m,""]:[m];let g=cW(l.join("/")),E=[];return E.push(...g.map(y=>y===""?m:[m,y].join("/"))),u&&E.push(...g),E.map(y=>r.startsWith("/")&&y===""?"/":y)}function hhe(r){r.sort((n,o)=>n.score!==o.score?o.score-n.score:yhe(n.routesMeta.map(l=>l.childrenIndex),o.routesMeta.map(l=>l.childrenIndex)))}const phe=/^:[\w-]+$/,mhe=3,fhe=2,ghe=1,_he=10,vhe=-2,_B=r=>r==="*";function Ehe(r,n){let o=r.split("/"),l=o.length;return o.some(_B)&&(l+=vhe),n&&(l+=fhe),o.filter(u=>!_B(u)).reduce((u,m)=>u+(phe.test(m)?mhe:m===""?ghe:_he),l)}function yhe(r,n){return r.length===n.length&&r.slice(0,-1).every((l,u)=>l===n[u])?r[r.length-1]-n[n.length-1]:0}function xhe(r,n,o){let{routesMeta:l}=r,u={},m="/",g=[];for(let E=0;E<l.length;++E){let y=l[E],x=E===l.length-1,S=m==="/"?n:n.slice(m.length)||"/",C=TR({path:y.relativePath,caseSensitive:y.caseSensitive,end:x},S),N=y.route;if(!C)return null;Object.assign(u,C.params),g.push({params:u,pathname:Ll([m,C.pathname]),pathnameBase:Nhe(Ll([m,C.pathnameBase])),route:N}),C.pathnameBase!=="/"&&(m=Ll([m,C.pathnameBase]))}return g}function TR(r,n){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[o,l]=bhe(r.path,r.caseSensitive,r.end),u=n.match(o);if(!u)return null;let m=u[0],g=m.replace(/(.)\/+$/,"$1"),E=u.slice(1);return{params:l.reduce((x,S,C)=>{let{paramName:N,isOptional:M}=S;if(N==="*"){let I=E[C]||"";g=m.slice(0,m.length-I.length).replace(/(.)\/+$/,"$1")}const G=E[C];return M&&!G?x[N]=void 0:x[N]=(G||"").replace(/%2F/g,"/"),x},{}),pathname:m,pathnameBase:g,pattern:r}}function bhe(r,n,o){n===void 0&&(n=!1),o===void 0&&(o=!0),aW(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let l=[],u="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,E,y)=>(l.push({paramName:E,isOptional:y!=null}),y?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(l.push({paramName:"*"}),u+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?u+="\\/*$":r!==""&&r!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,n?void 0:"i"),l]}function whe(r){try{return r.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return aW(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),r}}function Op(r,n){if(n==="/")return r;if(!r.toLowerCase().startsWith(n.toLowerCase()))return null;let o=n.endsWith("/")?n.length-1:n.length,l=r.charAt(o);return l&&l!=="/"?null:r.slice(o)||"/"}function She(r,n){n===void 0&&(n="/");let{pathname:o,search:l="",hash:u=""}=typeof r=="string"?Bp(r):r;return{pathname:o?o.startsWith("/")?o:Che(o,n):n,search:Rhe(l),hash:Ahe(u)}}function Che(r,n){let o=n.replace(/\/+$/,"").split("/");return r.split("/").forEach(u=>{u===".."?o.length>1&&o.pop():u!=="."&&o.push(u)}),o.length>1?o.join("/"):"/"}function QT(r,n,o,l){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function The(r){return r.filter((n,o)=>o===0||n.route.path&&n.route.path.length>0)}function sI(r,n){let o=The(r);return n?o.map((l,u)=>u===o.length-1?l.pathname:l.pathnameBase):o.map(l=>l.pathnameBase)}function rI(r,n,o,l){l===void 0&&(l=!1);let u;typeof r=="string"?u=Bp(r):(u=Dg({},r),yr(!u.pathname||!u.pathname.includes("?"),QT("?","pathname","search",u)),yr(!u.pathname||!u.pathname.includes("#"),QT("#","pathname","hash",u)),yr(!u.search||!u.search.includes("#"),QT("#","search","hash",u)));let m=r===""||u.pathname==="",g=m?"/":u.pathname,E;if(g==null)E=o;else{let C=n.length-1;if(!l&&g.startsWith("..")){let N=g.split("/");for(;N[0]==="..";)N.shift(),C-=1;u.pathname=N.join("/")}E=C>=0?n[C]:"/"}let y=She(u,E),x=g&&g!=="/"&&g.endsWith("/"),S=(m||g===".")&&o.endsWith("/");return!y.pathname.endsWith("/")&&(x||S)&&(y.pathname+="/"),y}const Ll=r=>r.join("/").replace(/\/\/+/g,"/"),Nhe=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Rhe=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Ahe=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function Ihe(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const lW=["post","put","patch","delete"];new Set(lW);const Dhe=["get",...lW];new Set(Dhe);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Og(){return Og=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(r[l]=o[l])}return r},Og.apply(this,arguments)}const Xx=O.createContext(null),dW=O.createContext(null),Tc=O.createContext(null),Jx=O.createContext(null),Ko=O.createContext({outlet:null,matches:[],isDataRoute:!1}),uW=O.createContext(null);function Ohe(r,n){let{relative:o}=n===void 0?{}:n;Wp()||yr(!1);let{basename:l,navigator:u}=O.useContext(Tc),{hash:m,pathname:g,search:E}=Qx(r,{relative:o}),y=g;return l!=="/"&&(y=g==="/"?l:Ll([l,g])),u.createHref({pathname:y,search:E,hash:m})}function Wp(){return O.useContext(Jx)!=null}function Nc(){return Wp()||yr(!1),O.useContext(Jx).location}function hW(r){O.useContext(Tc).static||O.useLayoutEffect(r)}function Ss(){let{isDataRoute:r}=O.useContext(Ko);return r?qhe():jhe()}function jhe(){Wp()||yr(!1);let r=O.useContext(Xx),{basename:n,future:o,navigator:l}=O.useContext(Tc),{matches:u}=O.useContext(Ko),{pathname:m}=Nc(),g=JSON.stringify(sI(u,o.v7_relativeSplatPath)),E=O.useRef(!1);return hW(()=>{E.current=!0}),O.useCallback(function(x,S){if(S===void 0&&(S={}),!E.current)return;if(typeof x=="number"){l.go(x);return}let C=rI(x,JSON.parse(g),m,S.relative==="path");r==null&&n!=="/"&&(C.pathname=C.pathname==="/"?n:Ll([n,C.pathname])),(S.replace?l.replace:l.push)(C,S.state,S)},[n,l,g,m,r])}const Phe=O.createContext(null);function khe(r){let n=O.useContext(Ko).outlet;return n&&O.createElement(Phe.Provider,{value:r},n)}function nI(){let{matches:r}=O.useContext(Ko),n=r[r.length-1];return n?n.params:{}}function Qx(r,n){let{relative:o}=n===void 0?{}:n,{future:l}=O.useContext(Tc),{matches:u}=O.useContext(Ko),{pathname:m}=Nc(),g=JSON.stringify(sI(u,l.v7_relativeSplatPath));return O.useMemo(()=>rI(r,JSON.parse(g),m,o==="path"),[r,g,m,o])}function Lhe(r,n){return Mhe(r,n)}function Mhe(r,n,o,l){Wp()||yr(!1);let{navigator:u}=O.useContext(Tc),{matches:m}=O.useContext(Ko),g=m[m.length-1],E=g?g.params:{};g&&g.pathname;let y=g?g.pathnameBase:"/";g&&g.route;let x=Nc(),S;if(n){var C;let P=typeof n=="string"?Bp(n):n;y==="/"||(C=P.pathname)!=null&&C.startsWith(y)||yr(!1),S=P}else S=x;let N=S.pathname||"/",M=N;if(y!=="/"){let P=y.replace(/^\//,"").split("/");M="/"+N.replace(/^\//,"").split("/").slice(P.length).join("/")}let G=dhe(r,{pathname:M}),I=Whe(G&&G.map(P=>Object.assign({},P,{params:Object.assign({},E,P.params),pathname:Ll([y,u.encodeLocation?u.encodeLocation(P.pathname).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?y:Ll([y,u.encodeLocation?u.encodeLocation(P.pathnameBase).pathname:P.pathnameBase])})),m,o,l);return n&&I?O.createElement(Jx.Provider,{value:{location:Og({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:Nl.Pop}},I):I}function Fhe(){let r=Khe(),n=Ihe(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),o=r instanceof Error?r.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return O.createElement(O.Fragment,null,O.createElement("h2",null,"Unexpected Application Error!"),O.createElement("h3",{style:{fontStyle:"italic"}},n),o?O.createElement("pre",{style:u},o):null,null)}const Uhe=O.createElement(Fhe,null);class Vhe extends O.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,o){return o.location!==n.location||o.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:o.error,location:o.location,revalidation:n.revalidation||o.revalidation}}componentDidCatch(n,o){console.error("React Router caught the following error during render",n,o)}render(){return this.state.error!==void 0?O.createElement(Ko.Provider,{value:this.props.routeContext},O.createElement(uW.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Bhe(r){let{routeContext:n,match:o,children:l}=r,u=O.useContext(Xx);return u&&u.static&&u.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=o.route.id),O.createElement(Ko.Provider,{value:n},l)}function Whe(r,n,o,l){var u;if(n===void 0&&(n=[]),o===void 0&&(o=null),l===void 0&&(l=null),r==null){var m;if(!o)return null;if(o.errors)r=o.matches;else if((m=l)!=null&&m.v7_partialHydration&&n.length===0&&!o.initialized&&o.matches.length>0)r=o.matches;else return null}let g=r,E=(u=o)==null?void 0:u.errors;if(E!=null){let S=g.findIndex(C=>C.route.id&&(E==null?void 0:E[C.route.id])!==void 0);S>=0||yr(!1),g=g.slice(0,Math.min(g.length,S+1))}let y=!1,x=-1;if(o&&l&&l.v7_partialHydration)for(let S=0;S<g.length;S++){let C=g[S];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(x=S),C.route.id){let{loaderData:N,errors:M}=o,G=C.route.loader&&N[C.route.id]===void 0&&(!M||M[C.route.id]===void 0);if(C.route.lazy||G){y=!0,x>=0?g=g.slice(0,x+1):g=[g[0]];break}}}return g.reduceRight((S,C,N)=>{let M,G=!1,I=null,P=null;o&&(M=E&&C.route.id?E[C.route.id]:void 0,I=C.route.errorElement||Uhe,y&&(x<0&&N===0?(Yhe("route-fallback"),G=!0,P=null):x===N&&(G=!0,P=C.route.hydrateFallbackElement||null)));let L=n.concat(g.slice(0,N+1)),R=()=>{let D;return M?D=I:G?D=P:C.route.Component?D=O.createElement(C.route.Component,null):C.route.element?D=C.route.element:D=S,O.createElement(Bhe,{match:C,routeContext:{outlet:S,matches:L,isDataRoute:o!=null},children:D})};return o&&(C.route.ErrorBoundary||C.route.errorElement||N===0)?O.createElement(Vhe,{location:o.location,revalidation:o.revalidation,component:I,error:M,children:R(),routeContext:{outlet:null,matches:L,isDataRoute:!0}}):R()},null)}var pW=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(pW||{}),mW=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(mW||{});function Ghe(r){let n=O.useContext(Xx);return n||yr(!1),n}function Hhe(r){let n=O.useContext(dW);return n||yr(!1),n}function zhe(r){let n=O.useContext(Ko);return n||yr(!1),n}function fW(r){let n=zhe(),o=n.matches[n.matches.length-1];return o.route.id||yr(!1),o.route.id}function Khe(){var r;let n=O.useContext(uW),o=Hhe(),l=fW();return n!==void 0?n:(r=o.errors)==null?void 0:r[l]}function qhe(){let{router:r}=Ghe(pW.UseNavigateStable),n=fW(mW.UseNavigateStable),o=O.useRef(!1);return hW(()=>{o.current=!0}),O.useCallback(function(u,m){m===void 0&&(m={}),o.current&&(typeof u=="number"?r.navigate(u):r.navigate(u,Og({fromRouteId:n},m)))},[r,n])}const vB={};function Yhe(r,n,o){vB[r]||(vB[r]=!0)}function tp(r){let{to:n,replace:o,state:l,relative:u}=r;Wp()||yr(!1);let{future:m,static:g}=O.useContext(Tc),{matches:E}=O.useContext(Ko),{pathname:y}=Nc(),x=Ss(),S=rI(n,sI(E,m.v7_relativeSplatPath),y,u==="path"),C=JSON.stringify(S);return O.useEffect(()=>x(JSON.parse(C),{replace:o,state:l,relative:u}),[x,C,u,o,l]),null}function gW(r){return khe(r.context)}function st(r){yr(!1)}function $he(r){let{basename:n="/",children:o=null,location:l,navigationType:u=Nl.Pop,navigator:m,static:g=!1,future:E}=r;Wp()&&yr(!1);let y=n.replace(/^\/*/,"/"),x=O.useMemo(()=>({basename:y,navigator:m,static:g,future:Og({v7_relativeSplatPath:!1},E)}),[y,E,m,g]);typeof l=="string"&&(l=Bp(l));let{pathname:S="/",search:C="",hash:N="",state:M=null,key:G="default"}=l,I=O.useMemo(()=>{let P=Op(S,y);return P==null?null:{location:{pathname:P,search:C,hash:N,state:M,key:G},navigationType:u}},[y,S,C,N,M,G,u]);return I==null?null:O.createElement(Tc.Provider,{value:x},O.createElement(Jx.Provider,{children:o,value:I}))}function Xhe(r){let{children:n,location:o}=r;return Lhe(NR(n),o)}new Promise(()=>{});function NR(r,n){n===void 0&&(n=[]);let o=[];return O.Children.forEach(r,(l,u)=>{if(!O.isValidElement(l))return;let m=[...n,u];if(l.type===O.Fragment){o.push.apply(o,NR(l.props.children,m));return}l.type!==st&&yr(!1),!l.props.index||!l.props.children||yr(!1);let g={id:l.props.id||m.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(g.children=NR(l.props.children,m)),o.push(g)}),o}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xx(){return xx=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(r[l]=o[l])}return r},xx.apply(this,arguments)}function _W(r,n){if(r==null)return{};var o={},l=Object.keys(r),u,m;for(m=0;m<l.length;m++)u=l[m],!(n.indexOf(u)>=0)&&(o[u]=r[u]);return o}function Jhe(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function Qhe(r,n){return r.button===0&&(!n||n==="_self")&&!Jhe(r)}function RR(r){return r===void 0&&(r=""),new URLSearchParams(typeof r=="string"||Array.isArray(r)||r instanceof URLSearchParams?r:Object.keys(r).reduce((n,o)=>{let l=r[o];return n.concat(Array.isArray(l)?l.map(u=>[o,u]):[[o,l]])},[]))}function Zhe(r,n){let o=RR(r);return n&&n.forEach((l,u)=>{o.has(u)||n.getAll(u).forEach(m=>{o.append(u,m)})}),o}const epe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],tpe=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],spe="6";try{window.__reactRouterVersion=spe}catch{}const rpe=O.createContext({isTransitioning:!1}),npe="startTransition",EB=Cle[npe];function ipe(r){let{basename:n,children:o,future:l,window:u}=r,m=O.useRef();m.current==null&&(m.current=ohe({window:u,v5Compat:!0}));let g=m.current,[E,y]=O.useState({action:g.action,location:g.location}),{v7_startTransition:x}=l||{},S=O.useCallback(C=>{x&&EB?EB(()=>y(C)):y(C)},[y,x]);return O.useLayoutEffect(()=>g.listen(S),[g,S]),O.createElement($he,{basename:n,children:o,location:E.location,navigationType:E.action,navigator:g,future:l})}const ape=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ope=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ro=O.forwardRef(function(n,o){let{onClick:l,relative:u,reloadDocument:m,replace:g,state:E,target:y,to:x,preventScrollReset:S,unstable_viewTransition:C}=n,N=_W(n,epe),{basename:M}=O.useContext(Tc),G,I=!1;if(typeof x=="string"&&ope.test(x)&&(G=x,ape))try{let D=new URL(window.location.href),V=x.startsWith("//")?new URL(D.protocol+x):new URL(x),W=Op(V.pathname,M);V.origin===D.origin&&W!=null?x=W+V.search+V.hash:I=!0}catch{}let P=Ohe(x,{relative:u}),L=lpe(x,{replace:g,state:E,target:y,preventScrollReset:S,relative:u,unstable_viewTransition:C});function R(D){l&&l(D),D.defaultPrevented||L(D)}return O.createElement("a",xx({},N,{href:G||P,onClick:I||m?l:R,ref:o,target:y}))}),dl=O.forwardRef(function(n,o){let{"aria-current":l="page",caseSensitive:u=!1,className:m="",end:g=!1,style:E,to:y,unstable_viewTransition:x,children:S}=n,C=_W(n,tpe),N=Qx(y,{relative:C.relative}),M=Nc(),G=O.useContext(dW),{navigator:I,basename:P}=O.useContext(Tc),L=G!=null&&dpe(N)&&x===!0,R=I.encodeLocation?I.encodeLocation(N).pathname:N.pathname,D=M.pathname,V=G&&G.navigation&&G.navigation.location?G.navigation.location.pathname:null;u||(D=D.toLowerCase(),V=V?V.toLowerCase():null,R=R.toLowerCase()),V&&P&&(V=Op(V,P)||V);const W=R!=="/"&&R.endsWith("/")?R.length-1:R.length;let q=D===R||!g&&D.startsWith(R)&&D.charAt(W)==="/",H=V!=null&&(V===R||!g&&V.startsWith(R)&&V.charAt(R.length)==="/"),J={isActive:q,isPending:H,isTransitioning:L},ee=q?l:void 0,ne;typeof m=="function"?ne=m(J):ne=[m,q?"active":null,H?"pending":null,L?"transitioning":null].filter(Boolean).join(" ");let pe=typeof E=="function"?E(J):E;return O.createElement(ro,xx({},C,{"aria-current":ee,className:ne,ref:o,style:pe,to:y,unstable_viewTransition:x}),typeof S=="function"?S(J):S)});var AR;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(AR||(AR={}));var yB;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(yB||(yB={}));function cpe(r){let n=O.useContext(Xx);return n||yr(!1),n}function lpe(r,n){let{target:o,replace:l,state:u,preventScrollReset:m,relative:g,unstable_viewTransition:E}=n===void 0?{}:n,y=Ss(),x=Nc(),S=Qx(r,{relative:g});return O.useCallback(C=>{if(Qhe(C,o)){C.preventDefault();let N=l!==void 0?l:yx(x)===yx(S);y(r,{replace:N,state:u,preventScrollReset:m,relative:g,unstable_viewTransition:E})}},[x,y,S,l,u,o,r,m,g,E])}function Gp(r){let n=O.useRef(RR(r)),o=O.useRef(!1),l=Nc(),u=O.useMemo(()=>Zhe(l.search,o.current?null:n.current),[l.search]),m=Ss(),g=O.useCallback((E,y)=>{const x=RR(typeof E=="function"?E(u):E);o.current=!0,m("?"+x,y)},[m,u]);return[u,g]}function dpe(r,n){n===void 0&&(n={});let o=O.useContext(rpe);o==null&&yr(!1);let{basename:l}=cpe(AR.useViewTransitionState),u=Qx(r,{relative:n.relative});if(!o.isTransitioning)return!1;let m=Op(o.currentLocation.pathname,l)||o.currentLocation.pathname,g=Op(o.nextLocation.pathname,l)||o.nextLocation.pathname;return TR(u.pathname,g)!=null||TR(u.pathname,m)!=null}function vW(r){var n,o,l="";if(typeof r=="string"||typeof r=="number")l+=r;else if(typeof r=="object")if(Array.isArray(r)){var u=r.length;for(n=0;n<u;n++)r[n]&&(o=vW(r[n]))&&(l&&(l+=" "),l+=o)}else for(o in r)r[o]&&(l&&(l+=" "),l+=o);return l}function Gl(){for(var r,n,o=0,l="",u=arguments.length;o<u;o++)(r=arguments[o])&&(n=vW(r))&&(l&&(l+=" "),l+=n);return l}const upe="inline-flex items-center justify-center rounded-[12px] font-semibold transition-transform duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:cursor-not-allowed",hpe={primary:"bg-[#050014] text-white shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)] hover:-translate-y-[1px] hover:bg-[#140423] active:brightness-110 disabled:bg-[#E9ECEF] disabled:text-[#6C757D]",secondary:"bg-white text-[#C045FF] border-2 border-[#C045FF] hover:bg-[#F4E6FF] hover:text-[#8B3FFF] active:bg-[#8B3FFF] active:text-white disabled:text-[#6C757D] disabled:border-[#E9ECEF] disabled:bg-transparent",ghost:"bg-transparent text-[#C045FF] hover:bg-[#F4E6FF] hover:text-[#8B3FFF] active:bg-[#8B3FFF] active:text-white disabled:text-[#6C757D]",danger:"bg-[#DC3545] text-white hover:bg-[#C82333] shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)] disabled:bg-[#E9ECEF] disabled:text-[#6C757D]"},ppe={md:"h-12 px-6 text-base",sm:"h-10 px-4 text-sm rounded-[8px]",lg:"h-14 px-8 text-lg",icon:"h-12 w-12 rounded-full"},oe=O.forwardRef(({variant:r="primary",size:n="md",leftIcon:o,rightIcon:l,className:u,children:m,...g},E)=>i.jsxs("button",{ref:E,className:Gl(upe,hpe[r],ppe[n],u),...g,children:[o&&i.jsx("span",{className:"mr-2 flex items-center text-lg",children:o}),m,l&&i.jsx("span",{className:"ml-2 flex items-center text-lg",children:l})]}));oe.displayName="Button";const EW="mb-2 block text-sm font-semibold text-[#212529]",yW="mt-1 text-sm text-[#6C757D]",xW="mt-1 text-sm text-[#E63946]",bW="w-full rounded-[8px] border-2 border-[#E9ECEF] bg-white px-4 py-3 text-base transition-colors focus:border-[#FF6B35] focus:shadow-[0_0_0_3px_rgba(255,107,53,0.1)] focus:outline-none disabled:cursor-not-allowed disabled:bg-[#F8F9FA]",nt=O.forwardRef(({label:r,helperText:n,error:o,requiredIndicator:l=!0,className:u,id:m,...g},E)=>{const y=m??g.name;return i.jsxs("div",{className:"flex w-full flex-col",children:[r&&i.jsxs("label",{className:EW,htmlFor:y,children:[r,g.required&&l?i.jsx("span",{className:"ml-1 text-[#E63946]",children:"*"}):null]}),i.jsx("input",{ref:E,id:y,className:Gl(bW,o&&"border-[#E63946] focus:shadow-none",u),...g}),o?i.jsx("span",{className:xW,children:o}):n?i.jsx("span",{className:yW,children:n}):null]})});nt.displayName="TextInput";const dr=O.forwardRef(({label:r,helperText:n,error:o,requiredIndicator:l=!0,className:u,id:m,rows:g=4,...E},y)=>{const x=m??E.name;return i.jsxs("div",{className:"flex w-full flex-col",children:[r&&i.jsxs("label",{className:EW,htmlFor:x,children:[r,E.required&&l?i.jsx("span",{className:"ml-1 text-[#E63946]",children:"*"}):null]}),i.jsx("textarea",{ref:y,id:x,rows:g,className:Gl(bW,"resize-y",o&&"border-[#E63946] focus:shadow-none",u),...E}),o?i.jsx("span",{className:xW,children:o}):n?i.jsx("span",{className:yW,children:n}):null]})});dr.displayName="TextArea";const me=({elevated:r=!1,className:n,...o})=>i.jsx("div",{className:Gl("rounded-[16px] border border-[#E9ECEF] bg-white p-6 transition-shadow",r?"shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)]":"shadow-[var(--shadow-sm)]",n),...o}),Ce=({title:r,subtitle:n,className:o,children:l,...u})=>i.jsxs("div",{className:Gl("mb-4 flex flex-col gap-1",o),...u,children:[r?i.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:r}):null,n?i.jsx("p",{className:"text-sm text-[#6C757D]",children:n}):null,l]}),ve=({className:r,...n})=>i.jsx("div",{className:Gl("flex flex-col gap-4",r),...n}),mpe={default:"bg-[#F8F9FA] text-[#6C757D]",primary:"bg-[#F4E6FF] text-[#C045FF]",success:"bg-[#D4EDDA] text-[#155724]",danger:"bg-[#F8D7DA] text-[#721C24]",warning:"bg-[#FFF3CD] text-[#856404]",live:"bg-[#DC3545] text-white animate-pulse"},$e=({variant:r="default",pill:n=!0,className:o,...l})=>i.jsx("span",{className:Gl("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-wide",n?"rounded-full":"rounded-[6px]",mpe[r],o),...l});O.createContext(void 0);const fpe={sm:"h-8 w-8 text-xs",md:"h-12 w-12 text-sm",lg:"h-16 w-16 text-base",xl:"h-20 w-20 text-lg"},gi=({src:r,alt:n,initials:o,size:l="md",className:u,badgeColor:m,...g})=>i.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[i.jsx("div",{className:Gl("flex items-center justify-center overflow-hidden rounded-full border-4 border-white bg-[#C045FF] font-semibold uppercase text-white shadow-[var(--shadow-sm)]",fpe[l],u),...g,children:r?i.jsx("img",{className:"h-full w-full object-cover",src:r,alt:n}):o??""}),m&&i.jsx("span",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-white",style:{backgroundColor:m}})]}),gpe="modulepreload",_pe=function(r){return"/"+r},xB={},jp=function(n,o,l){let u=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),E=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));u=Promise.allSettled(o.map(y=>{if(y=_pe(y),y in xB)return;xB[y]=!0;const x=y.endsWith(".css"),S=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${S}`))return;const C=document.createElement("link");if(C.rel=x?"stylesheet":gpe,x||(C.as="script"),C.crossOrigin="",C.href=y,E&&C.setAttribute("nonce",E),document.head.appendChild(C),x)return new Promise((N,M)=>{C.addEventListener("load",N),C.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${y}`)))})}))}function m(g){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=g,window.dispatchEvent(E),!E.defaultPrevented)throw g}return u.then(g=>{for(const E of g||[])E.status==="rejected"&&m(E.reason);return n().catch(m)})},vpe=r=>{let n;return r?n=r:typeof fetch>"u"?n=(...o)=>jp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...o)):n=fetch,(...o)=>n(...o)};class iI extends Error{constructor(n,o="FunctionsError",l){super(n),this.name=o,this.context=l}}class Epe extends iI{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}}class ype extends iI{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}}class xpe extends iI{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}}var IR;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(IR||(IR={}));var bpe=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};class wpe{constructor(n,{headers:o={},customFetch:l,region:u=IR.Any}={}){this.url=n,this.headers=o,this.region=u,this.fetch=vpe(l)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,o={}){var l;return bpe(this,void 0,void 0,function*(){try{const{headers:u,method:m,body:g}=o;let E={},{region:y}=o;y||(y=this.region),y&&y!=="any"&&(E["x-region"]=y);let x;g&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)&&(typeof Blob<"u"&&g instanceof Blob||g instanceof ArrayBuffer?(E["Content-Type"]="application/octet-stream",x=g):typeof g=="string"?(E["Content-Type"]="text/plain",x=g):typeof FormData<"u"&&g instanceof FormData?x=g:(E["Content-Type"]="application/json",x=JSON.stringify(g)));const S=yield this.fetch(`${this.url}/${n}`,{method:m||"POST",headers:Object.assign(Object.assign(Object.assign({},E),this.headers),u),body:x}).catch(G=>{throw new Epe(G)}),C=S.headers.get("x-relay-error");if(C&&C==="true")throw new ype(S);if(!S.ok)throw new xpe(S);let N=((l=S.headers.get("Content-Type"))!==null&&l!==void 0?l:"text/plain").split(";")[0].trim(),M;return N==="application/json"?M=yield S.json():N==="application/octet-stream"?M=yield S.blob():N==="text/event-stream"?M=S:N==="multipart/form-data"?M=yield S.formData():M=yield S.text(),{data:M,error:null}}catch(u){return{data:null,error:u}}})}}var Ea={},aI={},Zx={},Yg={},eb={},tb={},Spe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Pp=Spe();const Cpe=Pp.fetch,wW=Pp.fetch.bind(Pp),SW=Pp.Headers,Tpe=Pp.Request,Npe=Pp.Response,Hp=Object.freeze(Object.defineProperty({__proto__:null,Headers:SW,Request:Tpe,Response:Npe,default:wW,fetch:Cpe},Symbol.toStringTag,{value:"Module"})),Rpe=lle(Hp);var oI={};Object.defineProperty(oI,"__esModule",{value:!0});class Ape extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}oI.default=Ape;var CW=wa&&wa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(tb,"__esModule",{value:!0});const Ipe=CW(Rpe),Dpe=CW(oI);let Ope=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=Ipe.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(n,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const l=this.fetch;let u=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var g,E,y;let x=null,S=null,C=null,N=m.status,M=m.statusText;if(m.ok){if(this.method!=="HEAD"){const L=await m.text();L===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?S=L:S=JSON.parse(L))}const I=(g=this.headers.Prefer)===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),P=(E=m.headers.get("content-range"))===null||E===void 0?void 0:E.split("/");I&&P&&P.length>1&&(C=parseInt(P[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(S)&&(S.length>1?(x={code:"PGRST116",details:`Results contain ${S.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},S=null,C=null,N=406,M="Not Acceptable"):S.length===1?S=S[0]:S=null)}else{const I=await m.text();try{x=JSON.parse(I),Array.isArray(x)&&m.status===404&&(S=[],x=null,N=200,M="OK")}catch{m.status===404&&I===""?(N=204,M="No Content"):x={message:I}}if(x&&this.isMaybeSingle&&(!((y=x==null?void 0:x.details)===null||y===void 0)&&y.includes("0 rows"))&&(x=null,N=200,M="OK"),x&&this.shouldThrowOnError)throw new Dpe.default(x)}return{error:x,data:S,count:C,status:N,statusText:M}});return this.shouldThrowOnError||(u=u.catch(m=>{var g,E,y;return{error:{message:`${(g=m==null?void 0:m.name)!==null&&g!==void 0?g:"FetchError"}: ${m==null?void 0:m.message}`,details:`${(E=m==null?void 0:m.stack)!==null&&E!==void 0?E:""}`,hint:"",code:`${(y=m==null?void 0:m.code)!==null&&y!==void 0?y:""}`},data:null,count:null,status:0,statusText:""}})),u.then(n,o)}};tb.default=Ope;var jpe=wa&&wa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(eb,"__esModule",{value:!0});const Ppe=jpe(tb);let kpe=class extends Ppe.default{select(n){let o=!1;const l=(n??"*").split("").map(u=>/\s/.test(u)&&!o?"":(u==='"'&&(o=!o),u)).join("");return this.url.searchParams.set("select",l),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:o=!0,nullsFirst:l,foreignTable:u,referencedTable:m=u}={}){const g=m?`${m}.order`:"order",E=this.url.searchParams.get(g);return this.url.searchParams.set(g,`${E?`${E},`:""}${n}.${o?"asc":"desc"}${l===void 0?"":l?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:o,referencedTable:l=o}={}){const u=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(u,`${n}`),this}range(n,o,{foreignTable:l,referencedTable:u=l}={}){const m=typeof u>"u"?"offset":`${u}.offset`,g=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(m,`${n}`),this.url.searchParams.set(g,`${o-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:o=!1,settings:l=!1,buffers:u=!1,wal:m=!1,format:g="text"}={}){var E;const y=[n?"analyze":null,o?"verbose":null,l?"settings":null,u?"buffers":null,m?"wal":null].filter(Boolean).join("|"),x=(E=this.headers.Accept)!==null&&E!==void 0?E:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${g}; for="${x}"; options=${y};`,g==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};eb.default=kpe;var Lpe=wa&&wa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Yg,"__esModule",{value:!0});const Mpe=Lpe(eb);let Fpe=class extends Mpe.default{eq(n,o){return this.url.searchParams.append(n,`eq.${o}`),this}neq(n,o){return this.url.searchParams.append(n,`neq.${o}`),this}gt(n,o){return this.url.searchParams.append(n,`gt.${o}`),this}gte(n,o){return this.url.searchParams.append(n,`gte.${o}`),this}lt(n,o){return this.url.searchParams.append(n,`lt.${o}`),this}lte(n,o){return this.url.searchParams.append(n,`lte.${o}`),this}like(n,o){return this.url.searchParams.append(n,`like.${o}`),this}likeAllOf(n,o){return this.url.searchParams.append(n,`like(all).{${o.join(",")}}`),this}likeAnyOf(n,o){return this.url.searchParams.append(n,`like(any).{${o.join(",")}}`),this}ilike(n,o){return this.url.searchParams.append(n,`ilike.${o}`),this}ilikeAllOf(n,o){return this.url.searchParams.append(n,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(n,o){return this.url.searchParams.append(n,`ilike(any).{${o.join(",")}}`),this}is(n,o){return this.url.searchParams.append(n,`is.${o}`),this}in(n,o){const l=Array.from(new Set(o)).map(u=>typeof u=="string"&&new RegExp("[,()]").test(u)?`"${u}"`:`${u}`).join(",");return this.url.searchParams.append(n,`in.(${l})`),this}contains(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cs.{${o.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(o)}`),this}containedBy(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cd.{${o.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(o)}`),this}rangeGt(n,o){return this.url.searchParams.append(n,`sr.${o}`),this}rangeGte(n,o){return this.url.searchParams.append(n,`nxl.${o}`),this}rangeLt(n,o){return this.url.searchParams.append(n,`sl.${o}`),this}rangeLte(n,o){return this.url.searchParams.append(n,`nxr.${o}`),this}rangeAdjacent(n,o){return this.url.searchParams.append(n,`adj.${o}`),this}overlaps(n,o){return typeof o=="string"?this.url.searchParams.append(n,`ov.${o}`):this.url.searchParams.append(n,`ov.{${o.join(",")}}`),this}textSearch(n,o,{config:l,type:u}={}){let m="";u==="plain"?m="pl":u==="phrase"?m="ph":u==="websearch"&&(m="w");const g=l===void 0?"":`(${l})`;return this.url.searchParams.append(n,`${m}fts${g}.${o}`),this}match(n){return Object.entries(n).forEach(([o,l])=>{this.url.searchParams.append(o,`eq.${l}`)}),this}not(n,o,l){return this.url.searchParams.append(n,`not.${o}.${l}`),this}or(n,{foreignTable:o,referencedTable:l=o}={}){const u=l?`${l}.or`:"or";return this.url.searchParams.append(u,`(${n})`),this}filter(n,o,l){return this.url.searchParams.append(n,`${o}.${l}`),this}};Yg.default=Fpe;var Upe=wa&&wa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Zx,"__esModule",{value:!0});const kf=Upe(Yg);let Vpe=class{constructor(n,{headers:o={},schema:l,fetch:u}){this.url=n,this.headers=o,this.schema=l,this.fetch=u}select(n,{head:o=!1,count:l}={}){const u=o?"HEAD":"GET";let m=!1;const g=(n??"*").split("").map(E=>/\s/.test(E)&&!m?"":(E==='"'&&(m=!m),E)).join("");return this.url.searchParams.set("select",g),l&&(this.headers.Prefer=`count=${l}`),new kf.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:o,defaultToNull:l=!0}={}){const u="POST",m=[];if(this.headers.Prefer&&m.push(this.headers.Prefer),o&&m.push(`count=${o}`),l||m.push("missing=default"),this.headers.Prefer=m.join(","),Array.isArray(n)){const g=n.reduce((E,y)=>E.concat(Object.keys(y)),[]);if(g.length>0){const E=[...new Set(g)].map(y=>`"${y}"`);this.url.searchParams.set("columns",E.join(","))}}return new kf.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:o,ignoreDuplicates:l=!1,count:u,defaultToNull:m=!0}={}){const g="POST",E=[`resolution=${l?"ignore":"merge"}-duplicates`];if(o!==void 0&&this.url.searchParams.set("on_conflict",o),this.headers.Prefer&&E.push(this.headers.Prefer),u&&E.push(`count=${u}`),m||E.push("missing=default"),this.headers.Prefer=E.join(","),Array.isArray(n)){const y=n.reduce((x,S)=>x.concat(Object.keys(S)),[]);if(y.length>0){const x=[...new Set(y)].map(S=>`"${S}"`);this.url.searchParams.set("columns",x.join(","))}}return new kf.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:o}={}){const l="PATCH",u=[];return this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),this.headers.Prefer=u.join(","),new kf.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const o="DELETE",l=[];return n&&l.push(`count=${n}`),this.headers.Prefer&&l.unshift(this.headers.Prefer),this.headers.Prefer=l.join(","),new kf.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Zx.default=Vpe;var sb={},rb={};Object.defineProperty(rb,"__esModule",{value:!0});rb.version=void 0;rb.version="0.0.0-automated";Object.defineProperty(sb,"__esModule",{value:!0});sb.DEFAULT_HEADERS=void 0;const Bpe=rb;sb.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Bpe.version}`};var TW=wa&&wa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(aI,"__esModule",{value:!0});const Wpe=TW(Zx),Gpe=TW(Yg),Hpe=sb;let zpe=class NW{constructor(n,{headers:o={},schema:l,fetch:u}={}){this.url=n,this.headers=Object.assign(Object.assign({},Hpe.DEFAULT_HEADERS),o),this.schemaName=l,this.fetch=u}from(n){const o=new URL(`${this.url}/${n}`);return new Wpe.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new NW(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,o={},{head:l=!1,get:u=!1,count:m}={}){let g;const E=new URL(`${this.url}/rpc/${n}`);let y;l||u?(g=l?"HEAD":"GET",Object.entries(o).filter(([S,C])=>C!==void 0).map(([S,C])=>[S,Array.isArray(C)?`{${C.join(",")}}`:`${C}`]).forEach(([S,C])=>{E.searchParams.append(S,C)})):(g="POST",y=o);const x=Object.assign({},this.headers);return m&&(x.Prefer=`count=${m}`),new Gpe.default({method:g,url:E,headers:x,schema:this.schemaName,body:y,fetch:this.fetch,allowEmpty:!1})}};aI.default=zpe;var $g=wa&&wa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ea,"__esModule",{value:!0});Ea.PostgrestBuilder=Ea.PostgrestTransformBuilder=Ea.PostgrestFilterBuilder=Ea.PostgrestQueryBuilder=Ea.PostgrestClient=void 0;const RW=$g(aI);Ea.PostgrestClient=RW.default;const AW=$g(Zx);Ea.PostgrestQueryBuilder=AW.default;const IW=$g(Yg);Ea.PostgrestFilterBuilder=IW.default;const DW=$g(eb);Ea.PostgrestTransformBuilder=DW.default;const OW=$g(tb);Ea.PostgrestBuilder=OW.default;var Kpe=Ea.default={PostgrestClient:RW.default,PostgrestQueryBuilder:AW.default,PostgrestFilterBuilder:IW.default,PostgrestTransformBuilder:DW.default,PostgrestBuilder:OW.default};const{PostgrestClient:qpe,PostgrestQueryBuilder:BCe,PostgrestFilterBuilder:WCe,PostgrestTransformBuilder:GCe,PostgrestBuilder:HCe}=Kpe,Ype="2.10.2",$pe={"X-Client-Info":`realtime-js/${Ype}`},Xpe="1.0.0",jW=1e4,Jpe=1e3;var mp;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(mp||(mp={}));var ki;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(ki||(ki={}));var to;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(to||(to={}));var DR;(function(r){r.websocket="websocket"})(DR||(DR={}));var Wd;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Wd||(Wd={}));class Qpe{constructor(){this.HEADER_LENGTH=1}decode(n,o){return n.constructor===ArrayBuffer?o(this._binaryDecode(n)):o(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){const o=new DataView(n),l=new TextDecoder;return this._decodeBroadcast(n,o,l)}_decodeBroadcast(n,o,l){const u=o.getUint8(1),m=o.getUint8(2);let g=this.HEADER_LENGTH+2;const E=l.decode(n.slice(g,g+u));g=g+u;const y=l.decode(n.slice(g,g+m));g=g+m;const x=JSON.parse(l.decode(n.slice(g,n.byteLength)));return{ref:null,topic:E,event:y,payload:x}}}class PW{constructor(n,o){this.callback=n,this.timerCalc=o,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=o}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var er;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(er||(er={}));const bB=(r,n,o={})=>{var l;const u=(l=o.skipTypes)!==null&&l!==void 0?l:[];return Object.keys(n).reduce((m,g)=>(m[g]=Zpe(g,r,n,u),m),{})},Zpe=(r,n,o,l)=>{const u=n.find(E=>E.name===r),m=u==null?void 0:u.type,g=o[r];return m&&!l.includes(m)?kW(m,g):OR(g)},kW=(r,n)=>{if(r.charAt(0)==="_"){const o=r.slice(1,r.length);return rme(n,o)}switch(r){case er.bool:return eme(n);case er.float4:case er.float8:case er.int2:case er.int4:case er.int8:case er.numeric:case er.oid:return tme(n);case er.json:case er.jsonb:return sme(n);case er.timestamp:return nme(n);case er.abstime:case er.date:case er.daterange:case er.int4range:case er.int8range:case er.money:case er.reltime:case er.text:case er.time:case er.timestamptz:case er.timetz:case er.tsrange:case er.tstzrange:return OR(n);default:return OR(n)}},OR=r=>r,eme=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},tme=r=>{if(typeof r=="string"){const n=parseFloat(r);if(!Number.isNaN(n))return n}return r},sme=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(n){return console.log(`JSON parse error: ${n}`),r}return r},rme=(r,n)=>{if(typeof r!="string")return r;const o=r.length-1,l=r[o];if(r[0]==="{"&&l==="}"){let m;const g=r.slice(1,o);try{m=JSON.parse("["+g+"]")}catch{m=g?g.split(","):[]}return m.map(E=>kW(n,E))}return r},nme=r=>typeof r=="string"?r.replace(" ","T"):r,LW=r=>{let n=r;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};class ZT{constructor(n,o,l={},u=jW){this.channel=n,this.event=o,this.payload=l,this.timeout=u,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,o){var l;return this._hasReceived(n)&&o((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:n,callback:o}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const n=o=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=o,this._matchReceive(o)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,o){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:o})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:o}){this.recHooks.filter(l=>l.status===n).forEach(l=>l.callback(o))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}}var wB;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(wB||(wB={}));class ng{constructor(n,o){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=(o==null?void 0:o.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},u=>{const{onJoin:m,onLeave:g,onSync:E}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ng.syncState(this.state,u,m,g),this.pendingDiffs.forEach(y=>{this.state=ng.syncDiff(this.state,y,m,g)}),this.pendingDiffs=[],E()}),this.channel._on(l.diff,{},u=>{const{onJoin:m,onLeave:g,onSync:E}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(u):(this.state=ng.syncDiff(this.state,u,m,g),E())}),this.onJoin((u,m,g)=>{this.channel._trigger("presence",{event:"join",key:u,currentPresences:m,newPresences:g})}),this.onLeave((u,m,g)=>{this.channel._trigger("presence",{event:"leave",key:u,currentPresences:m,leftPresences:g})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,o,l,u){const m=this.cloneDeep(n),g=this.transformState(o),E={},y={};return this.map(m,(x,S)=>{g[x]||(y[x]=S)}),this.map(g,(x,S)=>{const C=m[x];if(C){const N=S.map(P=>P.presence_ref),M=C.map(P=>P.presence_ref),G=S.filter(P=>M.indexOf(P.presence_ref)<0),I=C.filter(P=>N.indexOf(P.presence_ref)<0);G.length>0&&(E[x]=G),I.length>0&&(y[x]=I)}else E[x]=S}),this.syncDiff(m,{joins:E,leaves:y},l,u)}static syncDiff(n,o,l,u){const{joins:m,leaves:g}={joins:this.transformState(o.joins),leaves:this.transformState(o.leaves)};return l||(l=()=>{}),u||(u=()=>{}),this.map(m,(E,y)=>{var x;const S=(x=n[E])!==null&&x!==void 0?x:[];if(n[E]=this.cloneDeep(y),S.length>0){const C=n[E].map(M=>M.presence_ref),N=S.filter(M=>C.indexOf(M.presence_ref)<0);n[E].unshift(...N)}l(E,S,y)}),this.map(g,(E,y)=>{let x=n[E];if(!x)return;const S=y.map(C=>C.presence_ref);x=x.filter(C=>S.indexOf(C.presence_ref)<0),n[E]=x,u(E,x,y),x.length===0&&delete n[E]}),n}static map(n,o){return Object.getOwnPropertyNames(n).map(l=>o(l,n[l]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((o,l)=>{const u=n[l];return"metas"in u?o[l]=u.metas.map(m=>(m.presence_ref=m.phx_ref,delete m.phx_ref,delete m.phx_ref_prev,m)):o[l]=u,o},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var SB;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(SB||(SB={}));var CB;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes"})(CB||(CB={}));var TB;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(TB||(TB={}));class cI{constructor(n,o={config:{}},l){this.topic=n,this.params=o,this.socket=l,this.bindings={},this.state=ki.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},o.config),this.timeout=this.socket.timeout,this.joinPush=new ZT(this,to.join,this.params,this.timeout),this.rejoinTimer=new PW(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ki.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(u=>u.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ki.closed,this.socket._remove(this)}),this._onError(u=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,u),this.state=ki.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ki.errored,this.rejoinTimer.scheduleTimeout())}),this._on(to.reply,{},(u,m)=>{this._trigger(this._replyEventName(m),u)}),this.presence=new ng(this),this.broadcastEndpointURL=LW(this.socket.endPoint)+"/api/broadcast"}subscribe(n,o=this.timeout){var l,u;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:m,presence:g,private:E}}=this.params;this._onError(S=>n&&n("CHANNEL_ERROR",S)),this._onClose(()=>n&&n("CLOSED"));const y={},x={broadcast:m,presence:g,postgres_changes:(u=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(S=>S.filter))!==null&&u!==void 0?u:[],private:E};this.socket.accessToken&&(y.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:x},y)),this.joinedOnce=!0,this._rejoin(o),this.joinPush.receive("ok",({postgres_changes:S})=>{var C;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),S===void 0){n&&n("SUBSCRIBED");return}else{const N=this.bindings.postgres_changes,M=(C=N==null?void 0:N.length)!==null&&C!==void 0?C:0,G=[];for(let I=0;I<M;I++){const P=N[I],{filter:{event:L,schema:R,table:D,filter:V}}=P,W=S&&S[I];if(W&&W.event===L&&W.schema===R&&W.table===D&&W.filter===V)G.push(Object.assign(Object.assign({},P),{id:W.id}));else{this.unsubscribe(),n&&n("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=G,n&&n("SUBSCRIBED");return}}).receive("error",S=>{n&&n("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{n&&n("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(n,o={}){return await this.send({type:"presence",event:"track",payload:n},o.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,o,l){return this._on(n,o,l)}async send(n,o={}){var l,u;if(!this._canPush()&&n.type==="broadcast"){const{event:m,payload:g}=n,E={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:m,payload:g}]})};try{const y=await this._fetchWithTimeout(this.broadcastEndpointURL,E,(l=o.timeout)!==null&&l!==void 0?l:this.timeout);return await((u=y.body)===null||u===void 0?void 0:u.cancel()),y.ok?"ok":"error"}catch(y){return y.name==="AbortError"?"timed out":"error"}}else return new Promise(m=>{var g,E,y;const x=this._push(n.type,n,o.timeout||this.timeout);n.type==="broadcast"&&!(!((y=(E=(g=this.params)===null||g===void 0?void 0:g.config)===null||E===void 0?void 0:E.broadcast)===null||y===void 0)&&y.ack)&&m("ok"),x.receive("ok",()=>m("ok")),x.receive("error",()=>m("error")),x.receive("timeout",()=>m("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=ki.leaving;const o=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(to.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(l=>{const u=new ZT(this,to.leave,{},n);u.receive("ok",()=>{o(),l("ok")}).receive("timeout",()=>{o(),l("timed out")}).receive("error",()=>{l("error")}),u.send(),this._canPush()||u.trigger("ok",{})})}async _fetchWithTimeout(n,o,l){const u=new AbortController,m=setTimeout(()=>u.abort(),l),g=await this.socket.fetch(n,Object.assign(Object.assign({},o),{signal:u.signal}));return clearTimeout(m),g}_push(n,o,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let u=new ZT(this,n,o,l);return this._canPush()?u.send():(u.startTimeout(),this.pushBuffer.push(u)),u}_onMessage(n,o,l){return o}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,o,l){var u,m;const g=n.toLocaleLowerCase(),{close:E,error:y,leave:x,join:S}=to;if(l&&[E,y,x,S].indexOf(g)>=0&&l!==this._joinRef())return;let N=this._onMessage(g,o,l);if(o&&!N)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(g)?(u=this.bindings.postgres_changes)===null||u===void 0||u.filter(M=>{var G,I,P;return((G=M.filter)===null||G===void 0?void 0:G.event)==="*"||((P=(I=M.filter)===null||I===void 0?void 0:I.event)===null||P===void 0?void 0:P.toLocaleLowerCase())===g}).map(M=>M.callback(N,l)):(m=this.bindings[g])===null||m===void 0||m.filter(M=>{var G,I,P,L,R,D;if(["broadcast","presence","postgres_changes"].includes(g))if("id"in M){const V=M.id,W=(G=M.filter)===null||G===void 0?void 0:G.event;return V&&((I=o.ids)===null||I===void 0?void 0:I.includes(V))&&(W==="*"||(W==null?void 0:W.toLocaleLowerCase())===((P=o.data)===null||P===void 0?void 0:P.type.toLocaleLowerCase()))}else{const V=(R=(L=M==null?void 0:M.filter)===null||L===void 0?void 0:L.event)===null||R===void 0?void 0:R.toLocaleLowerCase();return V==="*"||V===((D=o==null?void 0:o.event)===null||D===void 0?void 0:D.toLocaleLowerCase())}else return M.type.toLocaleLowerCase()===g}).map(M=>{if(typeof N=="object"&&"ids"in N){const G=N.data,{schema:I,table:P,commit_timestamp:L,type:R,errors:D}=G;N=Object.assign(Object.assign({},{schema:I,table:P,commit_timestamp:L,eventType:R,new:{},old:{},errors:D}),this._getPayloadRecords(G))}M.callback(N,l)})}_isClosed(){return this.state===ki.closed}_isJoined(){return this.state===ki.joined}_isJoining(){return this.state===ki.joining}_isLeaving(){return this.state===ki.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,o,l){const u=n.toLocaleLowerCase(),m={type:u,filter:o,callback:l};return this.bindings[u]?this.bindings[u].push(m):this.bindings[u]=[m],this}_off(n,o){const l=n.toLocaleLowerCase();return this.bindings[l]=this.bindings[l].filter(u=>{var m;return!(((m=u.type)===null||m===void 0?void 0:m.toLocaleLowerCase())===l&&cI.isEqual(u.filter,o))}),this}static isEqual(n,o){if(Object.keys(n).length!==Object.keys(o).length)return!1;for(const l in n)if(n[l]!==o[l])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(to.close,{},n)}_onError(n){this._on(to.error,{},o=>n(o))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ki.joining,this.joinPush.resend(n))}_getPayloadRecords(n){const o={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(o.new=bB(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(o.old=bB(n.columns,n.old_record)),o}}const ime=()=>{},ame=typeof WebSocket<"u";class ome{constructor(n,o){var l;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=$pe,this.params={},this.timeout=jW,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=ime,this.conn=null,this.sendBuffer=[],this.serializer=new Qpe,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=m=>{let g;return m?g=m:typeof fetch>"u"?g=(...E)=>jp(async()=>{const{default:y}=await Promise.resolve().then(()=>Hp);return{default:y}},void 0).then(({default:y})=>y(...E)):g=fetch,(...E)=>g(...E)},this.endPoint=`${n}/${DR.websocket}`,this.httpEndpoint=LW(n),o!=null&&o.transport?this.transport=o.transport:this.transport=null,o!=null&&o.params&&(this.params=o.params),o!=null&&o.headers&&(this.headers=Object.assign(Object.assign({},this.headers),o.headers)),o!=null&&o.timeout&&(this.timeout=o.timeout),o!=null&&o.logger&&(this.logger=o.logger),o!=null&&o.heartbeatIntervalMs&&(this.heartbeatIntervalMs=o.heartbeatIntervalMs);const u=(l=o==null?void 0:o.params)===null||l===void 0?void 0:l.apikey;u&&(this.accessToken=u,this.apiKey=u),this.reconnectAfterMs=o!=null&&o.reconnectAfterMs?o.reconnectAfterMs:m=>[1e3,2e3,5e3,1e4][m-1]||1e4,this.encode=o!=null&&o.encode?o.encode:(m,g)=>g(JSON.stringify(m)),this.decode=o!=null&&o.decode?o.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new PW(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(o==null?void 0:o.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(ame){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new cme(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),jp(async()=>{const{default:n}=await import("./browser-Cf6c1n2x.js").then(o=>o.b);return{default:n}},[]).then(({default:n})=>{this.conn=new n(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(n,o){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,o??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){const o=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),o}async removeAllChannels(){const n=await Promise.all(this.channels.map(o=>o.unsubscribe()));return this.disconnect(),n}log(n,o,l){this.logger(n,o,l)}connectionState(){switch(this.conn&&this.conn.readyState){case mp.connecting:return Wd.Connecting;case mp.open:return Wd.Open;case mp.closing:return Wd.Closing;default:return Wd.Closed}}isConnected(){return this.connectionState()===Wd.Open}channel(n,o={config:{}}){const l=new cI(`realtime:${n}`,o,this);return this.channels.push(l),l}push(n){const{topic:o,event:l,payload:u,ref:m}=n,g=()=>{this.encode(n,E=>{var y;(y=this.conn)===null||y===void 0||y.send(E)})};this.log("push",`${o} ${l} (${m})`,u),this.isConnected()?g():this.sendBuffer.push(g)}setAuth(n){this.accessToken=n,this.channels.forEach(o=>{n&&o.updateJoinPayload({access_token:n}),o.joinedOnce&&o._isJoined()&&o._push(to.access_token,{access_token:n})})}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let o=this.channels.find(l=>l.topic===n&&(l._isJoined()||l._isJoining()));o&&(this.log("transport",`leaving duplicate topic "${n}"`),o.unsubscribe())}_remove(n){this.channels=this.channels.filter(o=>o._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Xpe}))}_onConnMessage(n){this.decode(n.data,o=>{let{topic:l,event:u,payload:m,ref:g}=o;(g&&g===this.pendingHeartbeatRef||u===(m==null?void 0:m.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${m.status||""} ${l} ${u} ${g&&"("+g+")"||""}`,m),this.channels.filter(E=>E._isMember(l)).forEach(E=>E._trigger(u,m,g)),this.stateChangeCallbacks.message.forEach(E=>E(o))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(o=>o(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(o=>o(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(to.error))}_appendParams(n,o){if(Object.keys(o).length===0)return n;const l=n.match(/\?/)?"&":"?",u=new URLSearchParams(o);return`${n}${l}${u}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(Jpe,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class cme{constructor(n,o,l){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=mp.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=l.close}}class lI extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}}function Dn(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class lme extends lI{constructor(n,o){super(n),this.name="StorageApiError",this.status=o}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class NB extends lI{constructor(n,o){super(n),this.name="StorageUnknownError",this.originalError=o}}var dme=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};const MW=r=>{let n;return r?n=r:typeof fetch>"u"?n=(...o)=>jp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...o)):n=fetch,(...o)=>n(...o)},ume=()=>dme(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield jp(()=>Promise.resolve().then(()=>Hp),void 0)).Response:Response});var zp=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};const eN=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),hme=(r,n)=>zp(void 0,void 0,void 0,function*(){const o=yield ume();r instanceof o?r.json().then(l=>{n(new lme(eN(l),r.status||500))}).catch(l=>{n(new NB(eN(l),l))}):n(new NB(eN(r),r))}),pme=(r,n,o,l)=>{const u={method:r,headers:(n==null?void 0:n.headers)||{}};return r==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json"},n==null?void 0:n.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),o))};function nb(r,n,o,l,u,m){return zp(this,void 0,void 0,function*(){return new Promise((g,E)=>{r(o,pme(n,l,u,m)).then(y=>{if(!y.ok)throw y;return l!=null&&l.noResolveJson?y:y.json()}).then(y=>g(y)).catch(y=>hme(y,E))})})}function jR(r,n,o,l){return zp(this,void 0,void 0,function*(){return nb(r,"GET",n,o,l)})}function gl(r,n,o,l,u){return zp(this,void 0,void 0,function*(){return nb(r,"POST",n,l,u,o)})}function mme(r,n,o,l,u){return zp(this,void 0,void 0,function*(){return nb(r,"PUT",n,l,u,o)})}function FW(r,n,o,l,u){return zp(this,void 0,void 0,function*(){return nb(r,"DELETE",n,l,u,o)})}var pa=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};const fme={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},RB={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class gme{constructor(n,o={},l,u){this.url=n,this.headers=o,this.bucketId=l,this.fetch=MW(u)}uploadOrUpdate(n,o,l,u){return pa(this,void 0,void 0,function*(){try{let m;const g=Object.assign(Object.assign({},RB),u),E=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(g.upsert)});typeof Blob<"u"&&l instanceof Blob?(m=new FormData,m.append("cacheControl",g.cacheControl),m.append("",l)):typeof FormData<"u"&&l instanceof FormData?(m=l,m.append("cacheControl",g.cacheControl)):(m=l,E["cache-control"]=`max-age=${g.cacheControl}`,E["content-type"]=g.contentType);const y=this._removeEmptyFolders(o),x=this._getFinalPath(y),S=yield this.fetch(`${this.url}/object/${x}`,Object.assign({method:n,body:m,headers:E},g!=null&&g.duplex?{duplex:g.duplex}:{})),C=yield S.json();return S.ok?{data:{path:y,id:C.Id,fullPath:C.Key},error:null}:{data:null,error:C}}catch(m){if(Dn(m))return{data:null,error:m};throw m}})}upload(n,o,l){return pa(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,o,l)})}uploadToSignedUrl(n,o,l,u){return pa(this,void 0,void 0,function*(){const m=this._removeEmptyFolders(n),g=this._getFinalPath(m),E=new URL(this.url+`/object/upload/sign/${g}`);E.searchParams.set("token",o);try{let y;const x=Object.assign({upsert:RB.upsert},u),S=Object.assign(Object.assign({},this.headers),{"x-upsert":String(x.upsert)});typeof Blob<"u"&&l instanceof Blob?(y=new FormData,y.append("cacheControl",x.cacheControl),y.append("",l)):typeof FormData<"u"&&l instanceof FormData?(y=l,y.append("cacheControl",x.cacheControl)):(y=l,S["cache-control"]=`max-age=${x.cacheControl}`,S["content-type"]=x.contentType);const C=yield this.fetch(E.toString(),{method:"PUT",body:y,headers:S}),N=yield C.json();return C.ok?{data:{path:m,fullPath:N.Key},error:null}:{data:null,error:N}}catch(y){if(Dn(y))return{data:null,error:y};throw y}})}createSignedUploadUrl(n,o){return pa(this,void 0,void 0,function*(){try{let l=this._getFinalPath(n);const u=Object.assign({},this.headers);o!=null&&o.upsert&&(u["x-upsert"]="true");const m=yield gl(this.fetch,`${this.url}/object/upload/sign/${l}`,{},{headers:u}),g=new URL(this.url+m.url),E=g.searchParams.get("token");if(!E)throw new lI("No token returned by API");return{data:{signedUrl:g.toString(),path:n,token:E},error:null}}catch(l){if(Dn(l))return{data:null,error:l};throw l}})}update(n,o,l){return pa(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,o,l)})}move(n,o,l){return pa(this,void 0,void 0,function*(){try{return{data:yield gl(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:o,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers}),error:null}}catch(u){if(Dn(u))return{data:null,error:u};throw u}})}copy(n,o,l){return pa(this,void 0,void 0,function*(){try{return{data:{path:(yield gl(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:o,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers})).Key},error:null}}catch(u){if(Dn(u))return{data:null,error:u};throw u}})}createSignedUrl(n,o,l){return pa(this,void 0,void 0,function*(){try{let u=this._getFinalPath(n),m=yield gl(this.fetch,`${this.url}/object/sign/${u}`,Object.assign({expiresIn:o},l!=null&&l.transform?{transform:l.transform}:{}),{headers:this.headers});const g=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return m={signedUrl:encodeURI(`${this.url}${m.signedURL}${g}`)},{data:m,error:null}}catch(u){if(Dn(u))return{data:null,error:u};throw u}})}createSignedUrls(n,o,l){return pa(this,void 0,void 0,function*(){try{const u=yield gl(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:o,paths:n},{headers:this.headers}),m=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return{data:u.map(g=>Object.assign(Object.assign({},g),{signedUrl:g.signedURL?encodeURI(`${this.url}${g.signedURL}${m}`):null})),error:null}}catch(u){if(Dn(u))return{data:null,error:u};throw u}})}download(n,o){return pa(this,void 0,void 0,function*(){const u=typeof(o==null?void 0:o.transform)<"u"?"render/image/authenticated":"object",m=this.transformOptsToQueryString((o==null?void 0:o.transform)||{}),g=m?`?${m}`:"";try{const E=this._getFinalPath(n);return{data:yield(yield jR(this.fetch,`${this.url}/${u}/${E}${g}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(E){if(Dn(E))return{data:null,error:E};throw E}})}getPublicUrl(n,o){const l=this._getFinalPath(n),u=[],m=o!=null&&o.download?`download=${o.download===!0?"":o.download}`:"";m!==""&&u.push(m);const E=typeof(o==null?void 0:o.transform)<"u"?"render/image":"object",y=this.transformOptsToQueryString((o==null?void 0:o.transform)||{});y!==""&&u.push(y);let x=u.join("&");return x!==""&&(x=`?${x}`),{data:{publicUrl:encodeURI(`${this.url}/${E}/public/${l}${x}`)}}}remove(n){return pa(this,void 0,void 0,function*(){try{return{data:yield FW(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(o){if(Dn(o))return{data:null,error:o};throw o}})}list(n,o,l){return pa(this,void 0,void 0,function*(){try{const u=Object.assign(Object.assign(Object.assign({},fme),o),{prefix:n||""});return{data:yield gl(this.fetch,`${this.url}/object/list/${this.bucketId}`,u,{headers:this.headers},l),error:null}}catch(u){if(Dn(u))return{data:null,error:u};throw u}})}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const o=[];return n.width&&o.push(`width=${n.width}`),n.height&&o.push(`height=${n.height}`),n.resize&&o.push(`resize=${n.resize}`),n.format&&o.push(`format=${n.format}`),n.quality&&o.push(`quality=${n.quality}`),o.join("&")}}const _me="2.6.0",vme={"X-Client-Info":`storage-js/${_me}`};var Mh=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};class Eme{constructor(n,o={},l){this.url=n,this.headers=Object.assign(Object.assign({},vme),o),this.fetch=MW(l)}listBuckets(){return Mh(this,void 0,void 0,function*(){try{return{data:yield jR(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(Dn(n))return{data:null,error:n};throw n}})}getBucket(n){return Mh(this,void 0,void 0,function*(){try{return{data:yield jR(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(o){if(Dn(o))return{data:null,error:o};throw o}})}createBucket(n,o={public:!1}){return Mh(this,void 0,void 0,function*(){try{return{data:yield gl(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(Dn(l))return{data:null,error:l};throw l}})}updateBucket(n,o){return Mh(this,void 0,void 0,function*(){try{return{data:yield mme(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(Dn(l))return{data:null,error:l};throw l}})}emptyBucket(n){return Mh(this,void 0,void 0,function*(){try{return{data:yield gl(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(o){if(Dn(o))return{data:null,error:o};throw o}})}deleteBucket(n){return Mh(this,void 0,void 0,function*(){try{return{data:yield FW(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(o){if(Dn(o))return{data:null,error:o};throw o}})}}class yme extends Eme{constructor(n,o={},l){super(n,o,l)}from(n){return new gme(this.url,this.headers,n,this.fetch)}}const xme="2.45.1";let Kf="";typeof Deno<"u"?Kf="deno":typeof document<"u"?Kf="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Kf="react-native":Kf="node";const bme={"X-Client-Info":`supabase-js-${Kf}/${xme}`},wme={headers:bme},Sme={schema:"public"},Cme={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Tme={};var Nme=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};const Rme=r=>{let n;return r?n=r:typeof fetch>"u"?n=wW:n=fetch,(...o)=>n(...o)},Ame=()=>typeof Headers>"u"?SW:Headers,Ime=(r,n,o)=>{const l=Rme(o),u=Ame();return(m,g)=>Nme(void 0,void 0,void 0,function*(){var E;const y=(E=yield n())!==null&&E!==void 0?E:r;let x=new u(g==null?void 0:g.headers);return x.has("apikey")||x.set("apikey",r),x.has("Authorization")||x.set("Authorization",`Bearer ${y}`),l(m,Object.assign(Object.assign({},g),{headers:x}))})};var Dme=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};function Ome(r){return r.replace(/\/$/,"")}function jme(r,n){const{db:o,auth:l,realtime:u,global:m}=r,{db:g,auth:E,realtime:y,global:x}=n,S={db:Object.assign(Object.assign({},g),o),auth:Object.assign(Object.assign({},E),l),realtime:Object.assign(Object.assign({},y),u),global:Object.assign(Object.assign({},x),m),accessToken:()=>Dme(this,void 0,void 0,function*(){return""})};return r.accessToken?S.accessToken=r.accessToken:delete S.accessToken,S}const UW="2.64.4",Pme="http://localhost:9999",kme="supabase.auth.token",Lme={"X-Client-Info":`gotrue-js/${UW}`},AB=10,PR="X-Supabase-Api-Version",VW={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Mme(r){return Math.round(Date.now()/1e3)+r}function Fme(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const n=Math.random()*16|0;return(r=="x"?n:n&3|8).toString(16)})}const $a=()=>typeof document<"u",Dd={tested:!1,writable:!1},ig=()=>{if(!$a())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Dd.tested)return Dd.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Dd.tested=!0,Dd.writable=!0}catch{Dd.tested=!0,Dd.writable=!1}return Dd.writable};function tN(r){const n={},o=new URL(r);if(o.hash&&o.hash[0]==="#")try{new URLSearchParams(o.hash.substring(1)).forEach((u,m)=>{n[m]=u})}catch{}return o.searchParams.forEach((l,u)=>{n[u]=l}),n}const BW=r=>{let n;return r?n=r:typeof fetch>"u"?n=(...o)=>jp(async()=>{const{default:l}=await Promise.resolve().then(()=>Hp);return{default:l}},void 0).then(({default:l})=>l(...o)):n=fetch,(...o)=>n(...o)},Ume=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",WW=async(r,n,o)=>{await r.setItem(n,JSON.stringify(o))},yy=async(r,n)=>{const o=await r.getItem(n);if(!o)return null;try{return JSON.parse(o)}catch{return o}},sN=async(r,n)=>{await r.removeItem(n)};function Vme(r){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let o="",l,u,m,g,E,y,x,S=0;for(r=r.replace("-","+").replace("_","/");S<r.length;)g=n.indexOf(r.charAt(S++)),E=n.indexOf(r.charAt(S++)),y=n.indexOf(r.charAt(S++)),x=n.indexOf(r.charAt(S++)),l=g<<2|E>>4,u=(E&15)<<4|y>>2,m=(y&3)<<6|x,o=o+String.fromCharCode(l),y!=64&&u!=0&&(o=o+String.fromCharCode(u)),x!=64&&m!=0&&(o=o+String.fromCharCode(m));return o}class ib{constructor(){this.promise=new ib.promiseConstructor((n,o)=>{this.resolve=n,this.reject=o})}}ib.promiseConstructor=Promise;function IB(r){const n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,o=r.split(".");if(o.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!n.test(o[1]))throw new Error("JWT is not valid: payload is not in base64url format");const l=o[1];return JSON.parse(Vme(l))}async function Bme(r){return await new Promise(n=>{setTimeout(()=>n(null),r)})}function Wme(r,n){return new Promise((l,u)=>{(async()=>{for(let m=0;m<1/0;m++)try{const g=await r(m);if(!n(m,null,g)){l(g);return}}catch(g){if(!n(m,g)){u(g);return}}})()})}function Gme(r){return("0"+r.toString(16)).substr(-2)}function Hme(){const n=new Uint32Array(56);if(typeof crypto>"u"){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=o.length;let u="";for(let m=0;m<56;m++)u+=o.charAt(Math.floor(Math.random()*l));return u}return crypto.getRandomValues(n),Array.from(n,Gme).join("")}async function zme(r){const o=new TextEncoder().encode(r),l=await crypto.subtle.digest("SHA-256",o),u=new Uint8Array(l);return Array.from(u).map(m=>String.fromCharCode(m)).join("")}function Kme(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function qme(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const o=await zme(r);return Kme(o)}async function Fh(r,n,o=!1){const l=Hme();let u=l;o&&(u+="/PASSWORD_RECOVERY"),await WW(r,`${n}-code-verifier`,u);const m=await qme(l);return[m,l===m?"plain":"s256"]}const Yme=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $me(r){const n=r.headers.get(PR);if(!n||!n.match(Yme))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}class dI extends Error{constructor(n,o,l){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=o,this.code=l}}function ps(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Xme extends dI{constructor(n,o,l){super(n,o,l),this.name="AuthApiError",this.status=o,this.code=l}}function Jme(r){return ps(r)&&r.name==="AuthApiError"}class GW extends dI{constructor(n,o){super(n),this.name="AuthUnknownError",this.originalError=o}}class hu extends dI{constructor(n,o,l,u){super(n,l,u),this.name=o,this.status=l}}class Od extends hu{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class rN extends hu{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class xy extends hu{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}}class by extends hu{constructor(n,o=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class DB extends hu{constructor(n,o=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class kR extends hu{constructor(n,o){super(n,"AuthRetryableFetchError",o,void 0)}}function nN(r){return ps(r)&&r.name==="AuthRetryableFetchError"}class OB extends hu{constructor(n,o,l){super(n,"AuthWeakPasswordError",o,"weak_password"),this.reasons=l}}var Qme=function(r,n){var o={};for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&n.indexOf(l)<0&&(o[l]=r[l]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(r);u<l.length;u++)n.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(r,l[u])&&(o[l[u]]=r[l[u]]);return o};const Fd=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Zme=[502,503,504];async function jB(r){var n;if(!Ume(r))throw new kR(Fd(r),0);if(Zme.includes(r.status))throw new kR(Fd(r),r.status);let o;try{o=await r.json()}catch(m){throw new GW(Fd(m),m)}let l;const u=$me(r);if(u&&u.getTime()>=VW["2024-01-01"].timestamp&&typeof o=="object"&&o&&typeof o.code=="string"?l=o.code:typeof o=="object"&&o&&typeof o.error_code=="string"&&(l=o.error_code),l){if(l==="weak_password")throw new OB(Fd(o),r.status,((n=o.weak_password)===null||n===void 0?void 0:n.reasons)||[])}else if(typeof o=="object"&&o&&typeof o.weak_password=="object"&&o.weak_password&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.reasons.reduce((m,g)=>m&&typeof g=="string",!0))throw new OB(Fd(o),r.status,o.weak_password.reasons);throw new Xme(Fd(o),r.status||500,l)}const efe=(r,n,o,l)=>{const u={method:r,headers:(n==null?void 0:n.headers)||{}};return r==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n==null?void 0:n.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),o))};async function xs(r,n,o,l){var u;const m=Object.assign({},l==null?void 0:l.headers);m[PR]||(m[PR]=VW["2024-01-01"].name),l!=null&&l.jwt&&(m.Authorization=`Bearer ${l.jwt}`);const g=(u=l==null?void 0:l.query)!==null&&u!==void 0?u:{};l!=null&&l.redirectTo&&(g.redirect_to=l.redirectTo);const E=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",y=await tfe(r,n,o+E,{headers:m,noResolveJson:l==null?void 0:l.noResolveJson},{},l==null?void 0:l.body);return l!=null&&l.xform?l==null?void 0:l.xform(y):{data:Object.assign({},y),error:null}}async function tfe(r,n,o,l,u,m){const g=efe(n,l,u,m);let E;try{E=await r(o,Object.assign({},g))}catch(y){throw console.error(y),new kR(Fd(y),0)}if(E.ok||await jB(E),l!=null&&l.noResolveJson)return E;try{return await E.json()}catch(y){await jB(y)}}function ul(r){var n;let o=null;ife(r)&&(o=Object.assign({},r),r.expires_at||(o.expires_at=Mme(r.expires_in)));const l=(n=r.user)!==null&&n!==void 0?n:r;return{data:{session:o,user:l},error:null}}function PB(r){const n=ul(r);return!n.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((o,l)=>o&&typeof l=="string",!0)&&(n.data.weak_password=r.weak_password),n}function El(r){var n;return{data:{user:(n=r.user)!==null&&n!==void 0?n:r},error:null}}function sfe(r){return{data:r,error:null}}function rfe(r){const{action_link:n,email_otp:o,hashed_token:l,redirect_to:u,verification_type:m}=r,g=Qme(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),E={action_link:n,email_otp:o,hashed_token:l,redirect_to:u,verification_type:m},y=Object.assign({},g);return{data:{properties:E,user:y},error:null}}function nfe(r){return r}function ife(r){return r.access_token&&r.refresh_token&&r.expires_in}var afe=function(r,n){var o={};for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&n.indexOf(l)<0&&(o[l]=r[l]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(r);u<l.length;u++)n.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(r,l[u])&&(o[l[u]]=r[l[u]]);return o};class ofe{constructor({url:n="",headers:o={},fetch:l}){this.url=n,this.headers=o,this.fetch=BW(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,o="global"){try{return await xs(this.fetch,"POST",`${this.url}/logout?scope=${o}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(l){if(ps(l))return{data:null,error:l};throw l}}async inviteUserByEmail(n,o={}){try{return await xs(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:o.data},headers:this.headers,redirectTo:o.redirectTo,xform:El})}catch(l){if(ps(l))return{data:{user:null},error:l};throw l}}async generateLink(n){try{const{options:o}=n,l=afe(n,["options"]),u=Object.assign(Object.assign({},l),o);return"newEmail"in l&&(u.new_email=l==null?void 0:l.newEmail,delete u.newEmail),await xs(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:u,headers:this.headers,xform:rfe,redirectTo:o==null?void 0:o.redirectTo})}catch(o){if(ps(o))return{data:{properties:null,user:null},error:o};throw o}}async createUser(n){try{return await xs(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:El})}catch(o){if(ps(o))return{data:{user:null},error:o};throw o}}async listUsers(n){var o,l,u,m,g,E,y;try{const x={nextPage:null,lastPage:0,total:0},S=await xs(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(o=n==null?void 0:n.page)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:"",per_page:(m=(u=n==null?void 0:n.perPage)===null||u===void 0?void 0:u.toString())!==null&&m!==void 0?m:""},xform:nfe});if(S.error)throw S.error;const C=await S.json(),N=(g=S.headers.get("x-total-count"))!==null&&g!==void 0?g:0,M=(y=(E=S.headers.get("link"))===null||E===void 0?void 0:E.split(","))!==null&&y!==void 0?y:[];return M.length>0&&(M.forEach(G=>{const I=parseInt(G.split(";")[0].split("=")[1].substring(0,1)),P=JSON.parse(G.split(";")[1].split("=")[1]);x[`${P}Page`]=I}),x.total=parseInt(N)),{data:Object.assign(Object.assign({},C),x),error:null}}catch(x){if(ps(x))return{data:{users:[]},error:x};throw x}}async getUserById(n){try{return await xs(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:El})}catch(o){if(ps(o))return{data:{user:null},error:o};throw o}}async updateUserById(n,o){try{return await xs(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:o,headers:this.headers,xform:El})}catch(l){if(ps(l))return{data:{user:null},error:l};throw l}}async deleteUser(n,o=!1){try{return await xs(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:o},xform:El})}catch(l){if(ps(l))return{data:{user:null},error:l};throw l}}async _listFactors(n){try{const{data:o,error:l}=await xs(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:u=>({data:{factors:u},error:null})});return{data:o,error:l}}catch(o){if(ps(o))return{data:null,error:o};throw o}}async _deleteFactor(n){try{return{data:await xs(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(o){if(ps(o))return{data:null,error:o};throw o}}}const cfe={getItem:r=>ig()?globalThis.localStorage.getItem(r):null,setItem:(r,n)=>{ig()&&globalThis.localStorage.setItem(r,n)},removeItem:r=>{ig()&&globalThis.localStorage.removeItem(r)}};function kB(r={}){return{getItem:n=>r[n]||null,setItem:(n,o)=>{r[n]=o},removeItem:n=>{delete r[n]}}}function lfe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Uh={debug:!!(globalThis&&ig()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class HW extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}}class dfe extends HW{}async function ufe(r,n,o){Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,n);const l=new globalThis.AbortController;return n>0&&setTimeout(()=>{l.abort(),Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},n),await globalThis.navigator.locks.request(r,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async u=>{if(u){Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,u.name);try{return await o()}finally{Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,u.name)}}else{if(n===0)throw Uh.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new dfe(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Uh.debug)try{const m=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(m,null,"  "))}catch(m){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",m)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await o()}})}lfe();const hfe={url:Pme,storageKey:kme,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Lme,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Lf=30*1e3,LB=3;async function MB(r,n,o){return await o()}class jg{constructor(n){var o,l;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=jg.nextInstanceID,jg.nextInstanceID+=1,this.instanceID>0&&$a()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const u=Object.assign(Object.assign({},hfe),n);if(this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.persistSession=u.persistSession,this.storageKey=u.storageKey,this.autoRefreshToken=u.autoRefreshToken,this.admin=new ofe({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=BW(u.fetch),this.lock=u.lock||MB,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,u.lock?this.lock=u.lock:$a()&&(!((o=globalThis==null?void 0:globalThis.navigator)===null||o===void 0)&&o.locks)?this.lock=ufe:this.lock=MB,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?u.storage?this.storage=u.storage:ig()?this.storage=cfe:(this.memoryStorage={},this.storage=kB(this.memoryStorage)):(this.memoryStorage={},this.storage=kB(this.memoryStorage)),$a()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(m){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",m)}(l=this.broadcastChannel)===null||l===void 0||l.addEventListener("message",async m=>{this._debug("received broadcast notification from other tab or client",m),await this._notifyAllSubscribers(m.data.event,m.data.session,!1)})}this.initialize()}_debug(...n){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${UW}) ${new Date().toISOString()}`,...n),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const n=$a()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",n),n||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:o,error:l}=await this._getSessionFromURL(n);if(l)return this._debug("#_initialize()","error detecting session from URL",l),(l==null?void 0:l.message)==="Identity is already linked"||(l==null?void 0:l.message)==="Identity is already linked to another user"?{error:l}:(await this._removeSession(),{error:l});const{session:u,redirectType:m}=o;return this._debug("#_initialize()","detected session in URL",u,"redirect type",m),await this._saveSession(u),setTimeout(async()=>{m==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return ps(n)?{error:n}:{error:new GW("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(n){var o,l,u;try{const m=await xs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(o=n==null?void 0:n.options)===null||o===void 0?void 0:o.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(u=n==null?void 0:n.options)===null||u===void 0?void 0:u.captchaToken}},xform:ul}),{data:g,error:E}=m;if(E||!g)return{data:{user:null,session:null},error:E};const y=g.session,x=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(m){if(ps(m))return{data:{user:null,session:null},error:m};throw m}}async signUp(n){var o,l,u;try{let m;if("email"in n){const{email:S,password:C,options:N}=n;let M=null,G=null;this.flowType==="pkce"&&([M,G]=await Fh(this.storage,this.storageKey)),m=await xs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:N==null?void 0:N.emailRedirectTo,body:{email:S,password:C,data:(o=N==null?void 0:N.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:N==null?void 0:N.captchaToken},code_challenge:M,code_challenge_method:G},xform:ul})}else if("phone"in n){const{phone:S,password:C,options:N}=n;m=await xs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:S,password:C,data:(l=N==null?void 0:N.data)!==null&&l!==void 0?l:{},channel:(u=N==null?void 0:N.channel)!==null&&u!==void 0?u:"sms",gotrue_meta_security:{captcha_token:N==null?void 0:N.captchaToken}},xform:ul})}else throw new xy("You must provide either an email or phone number and a password");const{data:g,error:E}=m;if(E||!g)return{data:{user:null,session:null},error:E};const y=g.session,x=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(m){if(ps(m))return{data:{user:null,session:null},error:m};throw m}}async signInWithPassword(n){try{let o;if("email"in n){const{email:m,password:g,options:E}=n;o=await xs(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:m,password:g,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken}},xform:PB})}else if("phone"in n){const{phone:m,password:g,options:E}=n;o=await xs(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:m,password:g,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken}},xform:PB})}else throw new xy("You must provide either an email or phone number and a password");const{data:l,error:u}=o;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new rN}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:u})}catch(o){if(ps(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithOAuth(n){var o,l,u,m;return await this._handleProviderSignIn(n.provider,{redirectTo:(o=n.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=n.options)===null||l===void 0?void 0:l.scopes,queryParams:(u=n.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:(m=n.options)===null||m===void 0?void 0:m.skipBrowserRedirect})}async exchangeCodeForSession(n){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(n))}async _exchangeCodeForSession(n){const o=await yy(this.storage,`${this.storageKey}-code-verifier`),[l,u]=(o??"").split("/"),{data:m,error:g}=await xs(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:n,code_verifier:l},xform:ul});return await sN(this.storage,`${this.storageKey}-code-verifier`),g?{data:{user:null,session:null,redirectType:null},error:g}:!m||!m.session||!m.user?{data:{user:null,session:null,redirectType:null},error:new rN}:(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),{data:Object.assign(Object.assign({},m),{redirectType:u??null}),error:g})}async signInWithIdToken(n){try{const{options:o,provider:l,token:u,access_token:m,nonce:g}=n,E=await xs(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:u,access_token:m,nonce:g,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ul}),{data:y,error:x}=E;return x?{data:{user:null,session:null},error:x}:!y||!y.session||!y.user?{data:{user:null,session:null},error:new rN}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:y,error:x})}catch(o){if(ps(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithOtp(n){var o,l,u,m,g;try{if("email"in n){const{email:E,options:y}=n;let x=null,S=null;this.flowType==="pkce"&&([x,S]=await Fh(this.storage,this.storageKey));const{error:C}=await xs(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:E,data:(o=y==null?void 0:y.data)!==null&&o!==void 0?o:{},create_user:(l=y==null?void 0:y.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken},code_challenge:x,code_challenge_method:S},redirectTo:y==null?void 0:y.emailRedirectTo});return{data:{user:null,session:null},error:C}}if("phone"in n){const{phone:E,options:y}=n,{data:x,error:S}=await xs(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:E,data:(u=y==null?void 0:y.data)!==null&&u!==void 0?u:{},create_user:(m=y==null?void 0:y.shouldCreateUser)!==null&&m!==void 0?m:!0,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken},channel:(g=y==null?void 0:y.channel)!==null&&g!==void 0?g:"sms"}});return{data:{user:null,session:null,messageId:x==null?void 0:x.message_id},error:S}}throw new xy("You must provide either an email or phone number.")}catch(E){if(ps(E))return{data:{user:null,session:null},error:E};throw E}}async verifyOtp(n){var o,l;try{let u,m;"options"in n&&(u=(o=n.options)===null||o===void 0?void 0:o.redirectTo,m=(l=n.options)===null||l===void 0?void 0:l.captchaToken);const{data:g,error:E}=await xs(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},n),{gotrue_meta_security:{captcha_token:m}}),redirectTo:u,xform:ul});if(E)throw E;if(!g)throw new Error("An error occurred on token verification.");const y=g.session,x=g.user;return y!=null&&y.access_token&&(await this._saveSession(y),await this._notifyAllSubscribers(n.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",y)),{data:{user:x,session:y},error:null}}catch(u){if(ps(u))return{data:{user:null,session:null},error:u};throw u}}async signInWithSSO(n){var o,l,u;try{let m=null,g=null;return this.flowType==="pkce"&&([m,g]=await Fh(this.storage,this.storageKey)),await xs(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in n?{provider_id:n.providerId}:null),"domain"in n?{domain:n.domain}:null),{redirect_to:(l=(o=n.options)===null||o===void 0?void 0:o.redirectTo)!==null&&l!==void 0?l:void 0}),!((u=n==null?void 0:n.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:n.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:m,code_challenge_method:g}),headers:this.headers,xform:sfe})}catch(m){if(ps(m))return{data:null,error:m};throw m}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async n=>{const{data:{session:o},error:l}=n;if(l)throw l;if(!o)throw new Od;const{error:u}=await xs(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:o.access_token});return{data:{user:null,session:null},error:u}})}catch(n){if(ps(n))return{data:{user:null,session:null},error:n};throw n}}async resend(n){try{const o=`${this.url}/resend`;if("email"in n){const{email:l,type:u,options:m}=n,{error:g}=await xs(this.fetch,"POST",o,{headers:this.headers,body:{email:l,type:u,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},redirectTo:m==null?void 0:m.emailRedirectTo});return{data:{user:null,session:null},error:g}}else if("phone"in n){const{phone:l,type:u,options:m}=n,{data:g,error:E}=await xs(this.fetch,"POST",o,{headers:this.headers,body:{phone:l,type:u,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}}});return{data:{user:null,session:null,messageId:g==null?void 0:g.message_id},error:E}}throw new xy("You must provide either an email or phone number and a type")}catch(o){if(ps(o))return{data:{user:null,session:null},error:o};throw o}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async o=>o))}async _acquireLock(n,o){this._debug("#_acquireLock","begin",n);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),u=(async()=>(await l,await o()))();return this.pendingInLock.push((async()=>{try{await u}catch{}})()),u}return await this.lock(`lock:${this.storageKey}`,n,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=o();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const u=[...this.pendingInLock];await Promise.all(u),this.pendingInLock.splice(0,u.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(n){this._debug("#_useSession","begin");try{const o=await this.__loadSession();return await n(o)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let n=null;const o=await yy(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",o),o!==null&&(this._isValidSession(o)?n=o:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!n)return{data:{session:null},error:null};const l=n.expires_at?n.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",n.expires_at),!l){if(this.storage.isServer){let g=this.suppressGetSessionWarning;n=new Proxy(n,{get:(y,x,S)=>(!g&&x==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),g=!0,this.suppressGetSessionWarning=!0),Reflect.get(y,x,S))})}return{data:{session:n},error:null}}const{session:u,error:m}=await this._callRefreshToken(n.refresh_token);return m?{data:{session:null},error:m}:{data:{session:u},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(n){return n?await this._getUser(n):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(n){try{return n?await xs(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:n,xform:El}):await this._useSession(async o=>{var l,u,m;const{data:g,error:E}=o;if(E)throw E;return!(!((l=g.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Od}:await xs(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(m=(u=g.session)===null||u===void 0?void 0:u.access_token)!==null&&m!==void 0?m:void 0,xform:El})})}catch(o){if(ps(o))return{data:{user:null},error:o};throw o}}async updateUser(n,o={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(n,o))}async _updateUser(n,o={}){try{return await this._useSession(async l=>{const{data:u,error:m}=l;if(m)throw m;if(!u.session)throw new Od;const g=u.session;let E=null,y=null;this.flowType==="pkce"&&n.email!=null&&([E,y]=await Fh(this.storage,this.storageKey));const{data:x,error:S}=await xs(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:o==null?void 0:o.emailRedirectTo,body:Object.assign(Object.assign({},n),{code_challenge:E,code_challenge_method:y}),jwt:g.access_token,xform:El});if(S)throw S;return g.user=x.user,await this._saveSession(g),await this._notifyAllSubscribers("USER_UPDATED",g),{data:{user:g.user},error:null}})}catch(l){if(ps(l))return{data:{user:null},error:l};throw l}}_decodeJWT(n){return IB(n)}async setSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(n))}async _setSession(n){try{if(!n.access_token||!n.refresh_token)throw new Od;const o=Date.now()/1e3;let l=o,u=!0,m=null;const g=IB(n.access_token);if(g.exp&&(l=g.exp,u=l<=o),u){const{session:E,error:y}=await this._callRefreshToken(n.refresh_token);if(y)return{data:{user:null,session:null},error:y};if(!E)return{data:{user:null,session:null},error:null};m=E}else{const{data:E,error:y}=await this._getUser(n.access_token);if(y)throw y;m={access_token:n.access_token,refresh_token:n.refresh_token,user:E.user,token_type:"bearer",expires_in:l-o,expires_at:l},await this._saveSession(m),await this._notifyAllSubscribers("SIGNED_IN",m)}return{data:{user:m.user,session:m},error:null}}catch(o){if(ps(o))return{data:{session:null,user:null},error:o};throw o}}async refreshSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(n))}async _refreshSession(n){try{return await this._useSession(async o=>{var l;if(!n){const{data:g,error:E}=o;if(E)throw E;n=(l=g.session)!==null&&l!==void 0?l:void 0}if(!(n!=null&&n.refresh_token))throw new Od;const{session:u,error:m}=await this._callRefreshToken(n.refresh_token);return m?{data:{user:null,session:null},error:m}:u?{data:{user:u.user,session:u},error:null}:{data:{user:null,session:null},error:null}})}catch(o){if(ps(o))return{data:{user:null,session:null},error:o};throw o}}async _getSessionFromURL(n){try{if(!$a())throw new by("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new by("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!n)throw new DB("Not a valid PKCE flow url.");const o=tN(window.location.href);if(n){if(!o.code)throw new DB("No code detected.");const{data:R,error:D}=await this._exchangeCodeForSession(o.code);if(D)throw D;const V=new URL(window.location.href);return V.searchParams.delete("code"),window.history.replaceState(window.history.state,"",V.toString()),{data:{session:R.session,redirectType:null},error:null}}if(o.error||o.error_description||o.error_code)throw new by(o.error_description||"Error in URL with unspecified error_description",{error:o.error||"unspecified_error",code:o.error_code||"unspecified_code"});const{provider_token:l,provider_refresh_token:u,access_token:m,refresh_token:g,expires_in:E,expires_at:y,token_type:x}=o;if(!m||!E||!g||!x)throw new by("No session defined in URL");const S=Math.round(Date.now()/1e3),C=parseInt(E);let N=S+C;y&&(N=parseInt(y));const M=N-S;M*1e3<=Lf&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${M}s, should have been closer to ${C}s`);const G=N-C;S-G>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",G,N,S):S-G<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",G,N,S);const{data:I,error:P}=await this._getUser(m);if(P)throw P;const L={provider_token:l,provider_refresh_token:u,access_token:m,expires_in:C,expires_at:N,refresh_token:g,token_type:x,user:I.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:L,redirectType:o.type},error:null}}catch(o){if(ps(o))return{data:{session:null,redirectType:null},error:o};throw o}}_isImplicitGrantFlow(){const n=tN(window.location.href);return!!($a()&&(n.access_token||n.error_description))}async _isPKCEFlow(){const n=tN(window.location.href),o=await yy(this.storage,`${this.storageKey}-code-verifier`);return!!(n.code&&o)}async signOut(n={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(n))}async _signOut({scope:n}={scope:"global"}){return await this._useSession(async o=>{var l;const{data:u,error:m}=o;if(m)return{error:m};const g=(l=u.session)===null||l===void 0?void 0:l.access_token;if(g){const{error:E}=await this.admin.signOut(g,n);if(E&&!(Jme(E)&&(E.status===404||E.status===401||E.status===403)))return{error:E}}return n!=="others"&&(await this._removeSession(),await sN(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(n){const o=Fme(),l={id:o,callback:n,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",o),this.stateChangeEmitters.delete(o)}};return this._debug("#onAuthStateChange()","registered callback with id",o),this.stateChangeEmitters.set(o,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(o)})))(),{data:{subscription:l}}}async _emitInitialSession(n){return await this._useSession(async o=>{var l,u;try{const{data:{session:m},error:g}=o;if(g)throw g;await((l=this.stateChangeEmitters.get(n))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",m)),this._debug("INITIAL_SESSION","callback id",n,"session",m)}catch(m){await((u=this.stateChangeEmitters.get(n))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",n,"error",m),console.error(m)}})}async resetPasswordForEmail(n,o={}){let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Fh(this.storage,this.storageKey,!0));try{return await xs(this.fetch,"POST",`${this.url}/recover`,{body:{email:n,code_challenge:l,code_challenge_method:u,gotrue_meta_security:{captcha_token:o.captchaToken}},headers:this.headers,redirectTo:o.redirectTo})}catch(m){if(ps(m))return{data:null,error:m};throw m}}async getUserIdentities(){var n;try{const{data:o,error:l}=await this.getUser();if(l)throw l;return{data:{identities:(n=o.user.identities)!==null&&n!==void 0?n:[]},error:null}}catch(o){if(ps(o))return{data:null,error:o};throw o}}async linkIdentity(n){var o;try{const{data:l,error:u}=await this._useSession(async m=>{var g,E,y,x,S;const{data:C,error:N}=m;if(N)throw N;const M=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,n.provider,{redirectTo:(g=n.options)===null||g===void 0?void 0:g.redirectTo,scopes:(E=n.options)===null||E===void 0?void 0:E.scopes,queryParams:(y=n.options)===null||y===void 0?void 0:y.queryParams,skipBrowserRedirect:!0});return await xs(this.fetch,"GET",M,{headers:this.headers,jwt:(S=(x=C.session)===null||x===void 0?void 0:x.access_token)!==null&&S!==void 0?S:void 0})});if(u)throw u;return $a()&&!(!((o=n.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(l==null?void 0:l.url),{data:{provider:n.provider,url:l==null?void 0:l.url},error:null}}catch(l){if(ps(l))return{data:{provider:n.provider,url:null},error:l};throw l}}async unlinkIdentity(n){try{return await this._useSession(async o=>{var l,u;const{data:m,error:g}=o;if(g)throw g;return await xs(this.fetch,"DELETE",`${this.url}/user/identities/${n.identity_id}`,{headers:this.headers,jwt:(u=(l=m.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})})}catch(o){if(ps(o))return{data:null,error:o};throw o}}async _refreshAccessToken(n){const o=`#_refreshAccessToken(${n.substring(0,5)}...)`;this._debug(o,"begin");try{const l=Date.now();return await Wme(async u=>(u>0&&await Bme(200*Math.pow(2,u-1)),this._debug(o,"refreshing attempt",u),await xs(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:n},headers:this.headers,xform:ul})),(u,m)=>{const g=200*Math.pow(2,u);return m&&nN(m)&&Date.now()+g-l<Lf})}catch(l){if(this._debug(o,"error",l),ps(l))return{data:{session:null,user:null},error:l};throw l}finally{this._debug(o,"end")}}_isValidSession(n){return typeof n=="object"&&n!==null&&"access_token"in n&&"refresh_token"in n&&"expires_at"in n}async _handleProviderSignIn(n,o){const l=await this._getUrlForProvider(`${this.url}/authorize`,n,{redirectTo:o.redirectTo,scopes:o.scopes,queryParams:o.queryParams});return this._debug("#_handleProviderSignIn()","provider",n,"options",o,"url",l),$a()&&!o.skipBrowserRedirect&&window.location.assign(l),{data:{provider:n,url:l},error:null}}async _recoverAndRefresh(){var n;const o="#_recoverAndRefresh()";this._debug(o,"begin");try{const l=await yy(this.storage,this.storageKey);if(this._debug(o,"session from storage",l),!this._isValidSession(l)){this._debug(o,"session is not valid"),l!==null&&await this._removeSession();return}const u=Math.round(Date.now()/1e3),m=((n=l.expires_at)!==null&&n!==void 0?n:1/0)<u+AB;if(this._debug(o,`session has${m?"":" not"} expired with margin of ${AB}s`),m){if(this.autoRefreshToken&&l.refresh_token){const{error:g}=await this._callRefreshToken(l.refresh_token);g&&(console.error(g),nN(g)||(this._debug(o,"refresh failed with a non-retryable error, removing the session",g),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",l)}catch(l){this._debug(o,"error",l),console.error(l);return}finally{this._debug(o,"end")}}async _callRefreshToken(n){var o,l;if(!n)throw new Od;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const u=`#_callRefreshToken(${n.substring(0,5)}...)`;this._debug(u,"begin");try{this.refreshingDeferred=new ib;const{data:m,error:g}=await this._refreshAccessToken(n);if(g)throw g;if(!m.session)throw new Od;await this._saveSession(m.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",m.session);const E={session:m.session,error:null};return this.refreshingDeferred.resolve(E),E}catch(m){if(this._debug(u,"error",m),ps(m)){const g={session:null,error:m};return nN(m)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(o=this.refreshingDeferred)===null||o===void 0||o.resolve(g),g}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(m),m}finally{this.refreshingDeferred=null,this._debug(u,"end")}}async _notifyAllSubscribers(n,o,l=!0){const u=`#_notifyAllSubscribers(${n})`;this._debug(u,"begin",o,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:n,session:o});const m=[],g=Array.from(this.stateChangeEmitters.values()).map(async E=>{try{await E.callback(n,o)}catch(y){m.push(y)}});if(await Promise.all(g),m.length>0){for(let E=0;E<m.length;E+=1)console.error(m[E]);throw m[0]}}finally{this._debug(u,"end")}}async _saveSession(n){this._debug("#_saveSession()",n),this.suppressGetSessionWarning=!0,await WW(this.storage,this.storageKey,n)}async _removeSession(){this._debug("#_removeSession()"),await sN(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const n=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{n&&$a()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",n)}catch(o){console.error("removing visibilitychange callback failed",o)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const n=setInterval(()=>this._autoRefreshTokenTick(),Lf);this.autoRefreshTicker=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const n=this.autoRefreshTicker;this.autoRefreshTicker=null,n&&clearInterval(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const n=Date.now();try{return await this._useSession(async o=>{const{data:{session:l}}=o;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const u=Math.floor((l.expires_at*1e3-n)/Lf);this._debug("#_autoRefreshTokenTick()",`access token expires in ${u} ticks, a tick lasts ${Lf}ms, refresh threshold is ${LB} ticks`),u<=LB&&await this._callRefreshToken(l.refresh_token)})}catch(o){console.error("Auto refresh tick failed with error. This is likely a transient error.",o)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(n){if(n.isAcquireTimeout||n instanceof HW)this._debug("auto refresh token tick lock not available");else throw n}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!$a()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(n){console.error("_handleVisibilityChange",n)}}async _onVisibilityChanged(n){const o=`#_onVisibilityChanged(${n})`;this._debug(o,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),n||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(o,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(n,o,l){const u=[`provider=${encodeURIComponent(o)}`];if(l!=null&&l.redirectTo&&u.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l!=null&&l.scopes&&u.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[m,g]=await Fh(this.storage,this.storageKey),E=new URLSearchParams({code_challenge:`${encodeURIComponent(m)}`,code_challenge_method:`${encodeURIComponent(g)}`});u.push(E.toString())}if(l!=null&&l.queryParams){const m=new URLSearchParams(l.queryParams);u.push(m.toString())}return l!=null&&l.skipBrowserRedirect&&u.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${n}?${u.join("&")}`}async _unenroll(n){try{return await this._useSession(async o=>{var l;const{data:u,error:m}=o;return m?{data:null,error:m}:await xs(this.fetch,"DELETE",`${this.url}/factors/${n.factorId}`,{headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token})})}catch(o){if(ps(o))return{data:null,error:o};throw o}}async _enroll(n){try{return await this._useSession(async o=>{var l,u;const{data:m,error:g}=o;if(g)return{data:null,error:g};const{data:E,error:y}=await xs(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:n.friendlyName,factor_type:n.factorType,issuer:n.issuer},headers:this.headers,jwt:(l=m==null?void 0:m.session)===null||l===void 0?void 0:l.access_token});return y?{data:null,error:y}:(!((u=E==null?void 0:E.totp)===null||u===void 0)&&u.qr_code&&(E.totp.qr_code=`data:image/svg+xml;utf-8,${E.totp.qr_code}`),{data:E,error:null})})}catch(o){if(ps(o))return{data:null,error:o};throw o}}async _verify(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async o=>{var l;const{data:u,error:m}=o;if(m)return{data:null,error:m};const{data:g,error:E}=await xs(this.fetch,"POST",`${this.url}/factors/${n.factorId}/verify`,{body:{code:n.code,challenge_id:n.challengeId},headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token});return E?{data:null,error:E}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+g.expires_in},g)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",g),{data:g,error:E})})}catch(o){if(ps(o))return{data:null,error:o};throw o}})}async _challenge(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async o=>{var l;const{data:u,error:m}=o;return m?{data:null,error:m}:await xs(this.fetch,"POST",`${this.url}/factors/${n.factorId}/challenge`,{headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token})})}catch(o){if(ps(o))return{data:null,error:o};throw o}})}async _challengeAndVerify(n){const{data:o,error:l}=await this._challenge({factorId:n.factorId});return l?{data:null,error:l}:await this._verify({factorId:n.factorId,challengeId:o.id,code:n.code})}async _listFactors(){const{data:{user:n},error:o}=await this.getUser();if(o)return{data:null,error:o};const l=(n==null?void 0:n.factors)||[],u=l.filter(m=>m.factor_type==="totp"&&m.status==="verified");return{data:{all:l,totp:u},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async n=>{var o,l;const{data:{session:u},error:m}=n;if(m)return{data:null,error:m};if(!u)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const g=this._decodeJWT(u.access_token);let E=null;g.aal&&(E=g.aal);let y=E;((l=(o=u.user.factors)===null||o===void 0?void 0:o.filter(C=>C.status==="verified"))!==null&&l!==void 0?l:[]).length>0&&(y="aal2");const S=g.amr||[];return{data:{currentLevel:E,nextLevel:y,currentAuthenticationMethods:S},error:null}}))}}jg.nextInstanceID=0;const pfe=jg;class mfe extends pfe{constructor(n){super(n)}}var ffe=function(r,n,o,l){function u(m){return m instanceof o?m:new o(function(g){g(m)})}return new(o||(o=Promise))(function(m,g){function E(S){try{x(l.next(S))}catch(C){g(C)}}function y(S){try{x(l.throw(S))}catch(C){g(C)}}function x(S){S.done?m(S.value):u(S.value).then(E,y)}x((l=l.apply(r,n||[])).next())})};class gfe{constructor(n,o,l){var u,m,g;if(this.supabaseUrl=n,this.supabaseKey=o,!n)throw new Error("supabaseUrl is required.");if(!o)throw new Error("supabaseKey is required.");const E=Ome(n);this.realtimeUrl=`${E}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${E}/auth/v1`,this.storageUrl=`${E}/storage/v1`,this.functionsUrl=`${E}/functions/v1`;const y=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,x={db:Sme,realtime:Tme,auth:Object.assign(Object.assign({},Cme),{storageKey:y}),global:wme},S=jme(l??{},x);this.storageKey=(u=S.auth.storageKey)!==null&&u!==void 0?u:"",this.headers=(m=S.global.headers)!==null&&m!==void 0?m:{},S.accessToken?(this.accessToken=S.accessToken,this.auth=new Proxy({},{get:(C,N)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(N)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((g=S.auth)!==null&&g!==void 0?g:{},this.headers,S.global.fetch),this.fetch=Ime(o,this._getAccessToken.bind(this),S.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},S.realtime)),this.rest=new qpe(`${E}/rest/v1`,{headers:this.headers,schema:S.db.schema,fetch:this.fetch}),S.accessToken||this._listenForAuthEvents()}get functions(){return new wpe(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new yme(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,o={},l={}){return this.rest.rpc(n,o,l)}channel(n,o={config:{}}){return this.realtime.channel(n,o)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,o;return ffe(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:l}=yield this.auth.getSession();return(o=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:o,detectSessionInUrl:l,storage:u,storageKey:m,flowType:g,lock:E,debug:y},x,S){var C;const N={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new mfe({url:this.authUrl,headers:Object.assign(Object.assign({},N),x),storageKey:m,autoRefreshToken:n,persistSession:o,detectSessionInUrl:l,storage:u,flowType:g,lock:E,debug:y,fetch:S,hasCustomAuthorizationHeader:(C="Authorization"in this.headers)!==null&&C!==void 0?C:!1})}_initRealtimeClient(n){return new ome(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((o,l)=>{this._handleTokenChanged(o,"CLIENT",l==null?void 0:l.access_token)})}_handleTokenChanged(n,o,l){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==l?(this.realtime.setAuth(l??null),this.changedAccessToken=l):n==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),o=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const _fe=(r,n,o)=>new gfe(r,n,o),zW=typeof import.meta<"u"&&"https://iktldcrkyphkvxjwmxyb.supabase.co"||"",KW=typeof import.meta<"u"&&"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlrdGxkY3JreXBoa3Z4andteHliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTM4NTUsImV4cCI6MjA3ODYyOTg1NX0.ToXGJWTGBj0xaKp6EEHJY0H3hrqW122CE486oju4opI"||"";(!zW||!KW)&&console.warn("Supabase URL or anon key is not set. Auth will not work correctly until these env vars are configured.");const ie=_fe(zW,KW),qW=O.createContext(void 0),YW=r=>(r.split("@")[0]||"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()||"user",iN=(r,n)=>({id:r.id,email:r.email,role:r.role,username:(n==null?void 0:n.username)||YW(r.email),user_metadata:void 0,creatorProfileStatus:(n==null?void 0:n.creator_profile_status)||r.creator_profile_status}),vfe=({children:r})=>{const[n,o]=O.useState(null),[l,u]=O.useState(!0);O.useEffect(()=>{(async()=>{try{const{data:{user:G}}=await ie.auth.getUser();if(!G)return;const{data:I,error:P}=await ie.from("users").select("id,email,role,creator_profile_status").eq("id",G.id).maybeSingle();if(!P&&I){const{data:L}=await ie.from("profiles").select("username, creator_profile_status").eq("user_id",G.id).maybeSingle();o(iN(I,L))}}finally{u(!1)}})()},[]);const m=async({email:M,password:G})=>{const{data:I,error:P}=await ie.auth.signInWithPassword({email:M,password:G});if(P||!I.user)throw new Error("Invalid email or password.");if(!I.user.email_confirmed_at)throw await ie.auth.signOut(),new Error("Please verify your email before logging in.");const{data:L,error:R}=await ie.from("users").select("id,email,role,creator_profile_status").eq("id",I.user.id).maybeSingle();if(R||!L)throw new Error("No profile found for this account.");const{data:D}=await ie.from("profiles").select("username, creator_profile_status").eq("user_id",I.user.id).maybeSingle(),V=iN(L,D);return o(V),V},g=async({email:M,password:G,role:I})=>{const P=typeof window<"u"?`${window.location.origin}/auth/callback`:void 0,{data:L,error:R}=await ie.auth.signUp({email:M,password:G,options:{emailRedirectTo:P}});if(R||!L.user)throw new Error((R==null?void 0:R.message)??"Could not create account.");const D=L.user,{error:V}=await ie.from("users").insert({id:D.id,email:D.email,role:I});if(V)throw new Error(V.message??"Could not create profile.");const W=YW(M),q=W.charAt(0).toUpperCase()+W.slice(1),{error:H}=await ie.from("profiles").insert({user_id:D.id,username:W,display_name:q,creator_profile_status:I==="creator"?"pending":void 0});H&&console.error("Error creating public profile:",H);const J=iN({id:D.id,email:D.email??M,role:I},{username:W,creator_profile_status:I==="creator"?"pending":void 0});return D.email_confirmed_at&&o(J),J},E=async({email:M,redirectTo:G})=>{const I=G??(typeof window<"u"?`${window.location.origin}/auth/update-password`:void 0),{error:P}=await ie.auth.resetPasswordForEmail(M,{redirectTo:I});if(P)throw new Error(P.message||"Could not send password reset email.")},y=async({email:M,redirectTo:G})=>{const I=G??(typeof window<"u"?`${window.location.origin}/auth/callback`:void 0),P=ie.auth,{error:L}=await P.resend({type:"signup",email:M,options:{emailRedirectTo:I}});if(L)throw new Error(L.message||"Could not resend verification email.")},x=async()=>{try{await ie.auth.signOut()}finally{o(null)}},[S,C]=O.useState(new Set);O.useEffect(()=>{if(!n)return;const M=ie.channel("online-users");return M.on("presence",{event:"sync"},()=>{const G=M.presenceState(),I=new Set;Object.values(G).forEach(P=>{P.forEach(L=>{L.user_id&&I.add(L.user_id)})}),C(I)}).subscribe(async G=>{G==="SUBSCRIBED"&&await M.track({user_id:n.id,online_at:new Date().toISOString()})}),()=>{M.unsubscribe()}},[n]);const N=O.useMemo(()=>({user:n,isAuthenticated:!!n,isLoading:l,login:m,signup:g,sendPasswordResetEmail:E,resendVerificationEmail:y,logout:x,onlineUsers:S}),[l,n,S]);return i.jsx(qW.Provider,{value:N,children:r})},fs=()=>{const r=O.useContext(qW);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},Efe=[{title:"For Fans",links:[{label:"Browse Events",to:"/browse-events"},{label:"How It Works",to:"/how-it-works"},{label:"Pricing",to:"/pricing"},{label:"FAQs",to:"/faq"},{label:"Free Events",to:"/free-events"}]},{title:"For Creators",links:[{label:"Apply Now",to:"/apply"},{label:"Creator Guide",to:"/creator-guide"},{label:"Earnings Calculator",to:"/earnings-calculator"},{label:"Success Stories",to:"/success-stories"},{label:"Creator FAQs",to:"/faq"}]},{title:"Company",links:[{label:"About Us",to:"/about"},{label:"Our Team",to:"/team"},{label:"Press & Media",to:"/press"},{label:"Careers (We're Hiring!)",to:"/careers"},{label:"Blog",to:"/blog"}]},{title:"Support",links:[{label:"Help Center",to:"/help-center"},{label:"Contact Us",to:"/contact"},{label:"Terms of Service",to:"/terms-of-service"},{label:"Privacy Policy",to:"/privacy-policy"},{label:"Refund Policy",to:"/refund-policy"},{label:"Cancellation Policy",to:"/cancellation-policy"}]}];function yfe(){return i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-14 text-white md:px-12",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"grid gap-10 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,3fr)]",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"text-2xl font-bold text-[#C045FF]",children:"FanMeet"}),i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Connecting fans and creators, one call at a time."}),i.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-[#ADB5BD]",children:[i.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:"Razorpay"}),i.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:"UPI"}),i.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:"Visa"}),i.jsx("span",{className:"rounded-full border border-[#343A40] px-3 py-1",children:"Mastercard"})]})]}),i.jsx("div",{className:"grid gap-8 sm:grid-cols-2 lg:grid-cols-4",children:Efe.map(r=>i.jsxs("div",{children:[i.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:r.title}),i.jsx("ul",{className:"mt-3 space-y-2 text-sm text-[#ADB5BD]",children:r.links.map(n=>i.jsx("li",{children:i.jsx(ro,{className:"hover:text-white",to:n.to,children:n.label})},n.label))})]},r.title))})]}),i.jsxs("div",{className:"mt-10 border-t border-[#343A40] pt-6 text-center text-xs text-[#6C757D]",children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})]})})}const Vh=({isActive:r})=>`text-base font-medium transition-colors ${r?"text-[#C045FF]":"text-[#6C757D] hover:text-[#C045FF]"}`,xfe=()=>{const r=Ss(),n=Nc(),[o,l]=O.useState(!1),{isAuthenticated:u,user:m}=fs(),g=n.pathname==="/",E=()=>{(m==null?void 0:m.role)==="fan"?r("/fan"):(m==null?void 0:m.role)==="creator"?r("/creator"):(m==null?void 0:m.role)==="admin"&&r("/admin")};return i.jsxs("div",{className:"min-h-screen bg-[#FFFFFF]",children:[!g&&i.jsxs(i.Fragment,{children:[i.jsxs("header",{className:"sticky top-0 z-50 flex h-[70px] items-center justify-between border-b border-[#E9ECEF] bg-white px-6 md:px-12",children:[i.jsxs("div",{className:"flex items-center gap-6 md:gap-10",children:[i.jsx(dl,{to:"/",className:"flex items-center gap-2 text-2xl font-bold text-[#C045FF]",children:"FanMeet"}),i.jsxs("nav",{className:"hidden gap-6 md:flex",children:[i.jsx(dl,{to:"/browse-events",className:Vh,children:"Browse Events"}),i.jsx(dl,{to:"/how-it-works",className:Vh,children:"How It Works"}),i.jsx(dl,{to:"/for-creators",className:Vh,children:"For Creators"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"hidden items-center gap-3 md:flex",children:u?i.jsx(oe,{size:"sm",onClick:E,children:(m==null?void 0:m.role)==="fan"?" Fan Dashboard":(m==null?void 0:m.role)==="creator"?" Creator Dashboard":"Dashboard"}):i.jsxs(i.Fragment,{children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r("/auth"),children:"Login"}),i.jsx(oe,{size:"sm",onClick:()=>r("/auth"),children:"Get Started"})]})}),i.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-md border border-[#E9ECEF] p-2 text-[#343A40] md:hidden",onClick:()=>l(y=>!y),children:[i.jsx("span",{className:"sr-only",children:"Toggle navigation"}),i.jsxs("div",{className:"flex flex-col gap-[3px]",children:[i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"})]})]})]})]}),o&&i.jsx("div",{className:"border-b border-[#E9ECEF] bg-white px-6 py-3 md:hidden",children:i.jsxs("nav",{className:"flex flex-col gap-3",children:[i.jsx(dl,{to:"/browse-events",className:Vh,onClick:()=>l(!1),children:"Browse Events"}),i.jsx(dl,{to:"/how-it-works",className:Vh,onClick:()=>l(!1),children:"How It Works"}),i.jsx(dl,{to:"/for-creators",className:Vh,onClick:()=>l(!1),children:"For Creators"}),i.jsx("div",{className:"mt-2 flex flex-col gap-2",children:u?i.jsx(oe,{size:"sm",className:"w-full",onClick:()=>{l(!1),E()},children:(m==null?void 0:m.role)==="fan"?" Fan Dashboard":(m==null?void 0:m.role)==="creator"?" Creator Dashboard":"Dashboard"}):i.jsxs(i.Fragment,{children:[i.jsx(oe,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{l(!1),r("/auth")},children:"Login"}),i.jsx(oe,{size:"sm",className:"w-full",onClick:()=>{l(!1),r("/auth")},children:"Get Started"})]})})]})})]}),i.jsx("main",{className:"bg-gradient-to-b from-white to-[#FFE5D9]",children:i.jsx(gW,{})}),i.jsx(yfe,{})]})},Be=(r,n="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:n}).format(r),Mt=r=>new Intl.DateTimeFormat("en-IN",{dateStyle:"medium",timeStyle:"short"}).format(typeof r=="string"?new Date(r):r),Kd=(...r)=>r.filter(Boolean).join(" "),$W=O.createContext(void 0),bfe=({children:r})=>{const[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(!0),{user:E}=fs(),y=O.useMemo(()=>n.filter(D=>!D.read).length,[n]),x=O.useMemo(()=>l.filter(D=>!D.read&&D.receiver_id===(E==null?void 0:E.id)).length,[l,E]),S=async()=>{if(!E){o([]);return}const{data:D,error:V}=await ie.from("notifications").select("*").eq("user_id",E.id).order("created_at",{ascending:!1}).limit(50);V?console.error("Error fetching notifications:",V):o(D||[])},C=async()=>{if(!E){u([]);return}const{data:D,error:V}=await ie.from("messages").select("*").or(`sender_id.eq.${E.id},receiver_id.eq.${E.id}`).order("created_at",{ascending:!0});if(V){console.error("Error fetching messages:",V);return}if(D&&D.length>0){const W=[...new Set([...D.map(ee=>ee.sender_id),...D.map(ee=>ee.receiver_id)])],{data:q}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",W),H=new Map((q==null?void 0:q.map(ee=>[ee.user_id,ee]))||[]),J=D.map(ee=>{var ne,pe,Ee,ge;return{...ee,sender_username:(ne=H.get(ee.sender_id))==null?void 0:ne.username,sender_display_name:(pe=H.get(ee.sender_id))==null?void 0:pe.display_name,receiver_username:(Ee=H.get(ee.receiver_id))==null?void 0:Ee.username,receiver_display_name:(ge=H.get(ee.receiver_id))==null?void 0:ge.display_name}});u(J)}else u([])};O.useEffect(()=>{(async()=>{g(!0),await Promise.all([S(),C()]),g(!1)})()},[E]);const N=async D=>{const{error:V}=await ie.from("notifications").update({read:!0}).eq("id",D);V?console.error("Error marking notification as read:",V):o(W=>W.map(q=>q.id===D?{...q,read:!0}:q))},M=async()=>{if(!E)return;const{error:D}=await ie.from("notifications").update({read:!0}).eq("user_id",E.id).eq("read",!1);D?console.error("Error marking all notifications as read:",D):o(V=>V.map(W=>({...W,read:!0})))},G=async D=>{const{error:V}=await ie.from("messages").update({read:!0}).eq("id",D);V?console.error("Error marking message as read:",V):u(W=>W.map(q=>q.id===D?{...q,read:!0}:q))},I=async(D,V,W)=>{if(!E)throw new Error("User not logged in");const{error:q}=await ie.from("messages").insert({sender_id:E.id,receiver_id:D,message:V,meet_id:W||null});if(q)throw console.error("Error sending message:",q),q;await C()},P=async()=>{await S()},L=async()=>{await C()},R=O.useMemo(()=>({notifications:n,messages:l,unreadNotificationsCount:y,unreadMessagesCount:x,isLoading:m,markNotificationAsRead:N,markAllNotificationsAsRead:M,markMessageAsRead:G,sendMessage:I,refreshNotifications:P,refreshMessages:L}),[n,l,y,x,m]);return i.jsx($W.Provider,{value:R,children:r})},Xg=()=>{const r=O.useContext($W);if(!r)throw new Error("useNotifications must be used within a NotificationsProvider");return r};function bx(r){"@babel/helpers - typeof";return bx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},bx(r)}function cu(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}function Xn(r,n){if(n.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+n.length+" present")}function qo(r){Xn(1,arguments);var n=Object.prototype.toString.call(r);return r instanceof Date||bx(r)==="object"&&n==="[object Date]"?new Date(r.getTime()):typeof r=="number"||n==="[object Number]"?new Date(r):((typeof r=="string"||n==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function wfe(r,n){Xn(2,arguments);var o=qo(r).getTime(),l=cu(n);return new Date(o+l)}var Sfe={};function ab(){return Sfe}function Cfe(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}function Tfe(r){return Xn(1,arguments),r instanceof Date||bx(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function Nfe(r){if(Xn(1,arguments),!Tfe(r)&&typeof r!="number")return!1;var n=qo(r);return!isNaN(Number(n))}function Rfe(r,n){Xn(2,arguments);var o=cu(n);return wfe(r,-o)}var Afe=864e5;function Ife(r){Xn(1,arguments);var n=qo(r),o=n.getTime();n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0);var l=n.getTime(),u=o-l;return Math.floor(u/Afe)+1}function wx(r){Xn(1,arguments);var n=1,o=qo(r),l=o.getUTCDay(),u=(l<n?7:0)+l-n;return o.setUTCDate(o.getUTCDate()-u),o.setUTCHours(0,0,0,0),o}function XW(r){Xn(1,arguments);var n=qo(r),o=n.getUTCFullYear(),l=new Date(0);l.setUTCFullYear(o+1,0,4),l.setUTCHours(0,0,0,0);var u=wx(l),m=new Date(0);m.setUTCFullYear(o,0,4),m.setUTCHours(0,0,0,0);var g=wx(m);return n.getTime()>=u.getTime()?o+1:n.getTime()>=g.getTime()?o:o-1}function Dfe(r){Xn(1,arguments);var n=XW(r),o=new Date(0);o.setUTCFullYear(n,0,4),o.setUTCHours(0,0,0,0);var l=wx(o);return l}var Ofe=6048e5;function jfe(r){Xn(1,arguments);var n=qo(r),o=wx(n).getTime()-Dfe(n).getTime();return Math.round(o/Ofe)+1}function Sx(r,n){var o,l,u,m,g,E,y,x;Xn(1,arguments);var S=ab(),C=cu((o=(l=(u=(m=n==null?void 0:n.weekStartsOn)!==null&&m!==void 0?m:n==null||(g=n.locale)===null||g===void 0||(E=g.options)===null||E===void 0?void 0:E.weekStartsOn)!==null&&u!==void 0?u:S.weekStartsOn)!==null&&l!==void 0?l:(y=S.locale)===null||y===void 0||(x=y.options)===null||x===void 0?void 0:x.weekStartsOn)!==null&&o!==void 0?o:0);if(!(C>=0&&C<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var N=qo(r),M=N.getUTCDay(),G=(M<C?7:0)+M-C;return N.setUTCDate(N.getUTCDate()-G),N.setUTCHours(0,0,0,0),N}function JW(r,n){var o,l,u,m,g,E,y,x;Xn(1,arguments);var S=qo(r),C=S.getUTCFullYear(),N=ab(),M=cu((o=(l=(u=(m=n==null?void 0:n.firstWeekContainsDate)!==null&&m!==void 0?m:n==null||(g=n.locale)===null||g===void 0||(E=g.options)===null||E===void 0?void 0:E.firstWeekContainsDate)!==null&&u!==void 0?u:N.firstWeekContainsDate)!==null&&l!==void 0?l:(y=N.locale)===null||y===void 0||(x=y.options)===null||x===void 0?void 0:x.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(M>=1&&M<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var G=new Date(0);G.setUTCFullYear(C+1,0,M),G.setUTCHours(0,0,0,0);var I=Sx(G,n),P=new Date(0);P.setUTCFullYear(C,0,M),P.setUTCHours(0,0,0,0);var L=Sx(P,n);return S.getTime()>=I.getTime()?C+1:S.getTime()>=L.getTime()?C:C-1}function Pfe(r,n){var o,l,u,m,g,E,y,x;Xn(1,arguments);var S=ab(),C=cu((o=(l=(u=(m=n==null?void 0:n.firstWeekContainsDate)!==null&&m!==void 0?m:n==null||(g=n.locale)===null||g===void 0||(E=g.options)===null||E===void 0?void 0:E.firstWeekContainsDate)!==null&&u!==void 0?u:S.firstWeekContainsDate)!==null&&l!==void 0?l:(y=S.locale)===null||y===void 0||(x=y.options)===null||x===void 0?void 0:x.firstWeekContainsDate)!==null&&o!==void 0?o:1),N=JW(r,n),M=new Date(0);M.setUTCFullYear(N,0,C),M.setUTCHours(0,0,0,0);var G=Sx(M,n);return G}var kfe=6048e5;function Lfe(r,n){Xn(1,arguments);var o=qo(r),l=Sx(o,n).getTime()-Pfe(o,n).getTime();return Math.round(l/kfe)+1}function Bs(r,n){for(var o=r<0?"-":"",l=Math.abs(r).toString();l.length<n;)l="0"+l;return o+l}var cl={y:function(n,o){var l=n.getUTCFullYear(),u=l>0?l:1-l;return Bs(o==="yy"?u%100:u,o.length)},M:function(n,o){var l=n.getUTCMonth();return o==="M"?String(l+1):Bs(l+1,2)},d:function(n,o){return Bs(n.getUTCDate(),o.length)},a:function(n,o){var l=n.getUTCHours()/12>=1?"pm":"am";switch(o){case"a":case"aa":return l.toUpperCase();case"aaa":return l;case"aaaaa":return l[0];case"aaaa":default:return l==="am"?"a.m.":"p.m."}},h:function(n,o){return Bs(n.getUTCHours()%12||12,o.length)},H:function(n,o){return Bs(n.getUTCHours(),o.length)},m:function(n,o){return Bs(n.getUTCMinutes(),o.length)},s:function(n,o){return Bs(n.getUTCSeconds(),o.length)},S:function(n,o){var l=o.length,u=n.getUTCMilliseconds(),m=Math.floor(u*Math.pow(10,l-3));return Bs(m,o.length)}},Bh={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Mfe={G:function(n,o,l){var u=n.getUTCFullYear()>0?1:0;switch(o){case"G":case"GG":case"GGG":return l.era(u,{width:"abbreviated"});case"GGGGG":return l.era(u,{width:"narrow"});case"GGGG":default:return l.era(u,{width:"wide"})}},y:function(n,o,l){if(o==="yo"){var u=n.getUTCFullYear(),m=u>0?u:1-u;return l.ordinalNumber(m,{unit:"year"})}return cl.y(n,o)},Y:function(n,o,l,u){var m=JW(n,u),g=m>0?m:1-m;if(o==="YY"){var E=g%100;return Bs(E,2)}return o==="Yo"?l.ordinalNumber(g,{unit:"year"}):Bs(g,o.length)},R:function(n,o){var l=XW(n);return Bs(l,o.length)},u:function(n,o){var l=n.getUTCFullYear();return Bs(l,o.length)},Q:function(n,o,l){var u=Math.ceil((n.getUTCMonth()+1)/3);switch(o){case"Q":return String(u);case"QQ":return Bs(u,2);case"Qo":return l.ordinalNumber(u,{unit:"quarter"});case"QQQ":return l.quarter(u,{width:"abbreviated",context:"formatting"});case"QQQQQ":return l.quarter(u,{width:"narrow",context:"formatting"});case"QQQQ":default:return l.quarter(u,{width:"wide",context:"formatting"})}},q:function(n,o,l){var u=Math.ceil((n.getUTCMonth()+1)/3);switch(o){case"q":return String(u);case"qq":return Bs(u,2);case"qo":return l.ordinalNumber(u,{unit:"quarter"});case"qqq":return l.quarter(u,{width:"abbreviated",context:"standalone"});case"qqqqq":return l.quarter(u,{width:"narrow",context:"standalone"});case"qqqq":default:return l.quarter(u,{width:"wide",context:"standalone"})}},M:function(n,o,l){var u=n.getUTCMonth();switch(o){case"M":case"MM":return cl.M(n,o);case"Mo":return l.ordinalNumber(u+1,{unit:"month"});case"MMM":return l.month(u,{width:"abbreviated",context:"formatting"});case"MMMMM":return l.month(u,{width:"narrow",context:"formatting"});case"MMMM":default:return l.month(u,{width:"wide",context:"formatting"})}},L:function(n,o,l){var u=n.getUTCMonth();switch(o){case"L":return String(u+1);case"LL":return Bs(u+1,2);case"Lo":return l.ordinalNumber(u+1,{unit:"month"});case"LLL":return l.month(u,{width:"abbreviated",context:"standalone"});case"LLLLL":return l.month(u,{width:"narrow",context:"standalone"});case"LLLL":default:return l.month(u,{width:"wide",context:"standalone"})}},w:function(n,o,l,u){var m=Lfe(n,u);return o==="wo"?l.ordinalNumber(m,{unit:"week"}):Bs(m,o.length)},I:function(n,o,l){var u=jfe(n);return o==="Io"?l.ordinalNumber(u,{unit:"week"}):Bs(u,o.length)},d:function(n,o,l){return o==="do"?l.ordinalNumber(n.getUTCDate(),{unit:"date"}):cl.d(n,o)},D:function(n,o,l){var u=Ife(n);return o==="Do"?l.ordinalNumber(u,{unit:"dayOfYear"}):Bs(u,o.length)},E:function(n,o,l){var u=n.getUTCDay();switch(o){case"E":case"EE":case"EEE":return l.day(u,{width:"abbreviated",context:"formatting"});case"EEEEE":return l.day(u,{width:"narrow",context:"formatting"});case"EEEEEE":return l.day(u,{width:"short",context:"formatting"});case"EEEE":default:return l.day(u,{width:"wide",context:"formatting"})}},e:function(n,o,l,u){var m=n.getUTCDay(),g=(m-u.weekStartsOn+8)%7||7;switch(o){case"e":return String(g);case"ee":return Bs(g,2);case"eo":return l.ordinalNumber(g,{unit:"day"});case"eee":return l.day(m,{width:"abbreviated",context:"formatting"});case"eeeee":return l.day(m,{width:"narrow",context:"formatting"});case"eeeeee":return l.day(m,{width:"short",context:"formatting"});case"eeee":default:return l.day(m,{width:"wide",context:"formatting"})}},c:function(n,o,l,u){var m=n.getUTCDay(),g=(m-u.weekStartsOn+8)%7||7;switch(o){case"c":return String(g);case"cc":return Bs(g,o.length);case"co":return l.ordinalNumber(g,{unit:"day"});case"ccc":return l.day(m,{width:"abbreviated",context:"standalone"});case"ccccc":return l.day(m,{width:"narrow",context:"standalone"});case"cccccc":return l.day(m,{width:"short",context:"standalone"});case"cccc":default:return l.day(m,{width:"wide",context:"standalone"})}},i:function(n,o,l){var u=n.getUTCDay(),m=u===0?7:u;switch(o){case"i":return String(m);case"ii":return Bs(m,o.length);case"io":return l.ordinalNumber(m,{unit:"day"});case"iii":return l.day(u,{width:"abbreviated",context:"formatting"});case"iiiii":return l.day(u,{width:"narrow",context:"formatting"});case"iiiiii":return l.day(u,{width:"short",context:"formatting"});case"iiii":default:return l.day(u,{width:"wide",context:"formatting"})}},a:function(n,o,l){var u=n.getUTCHours(),m=u/12>=1?"pm":"am";switch(o){case"a":case"aa":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"});case"aaa":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return l.dayPeriod(m,{width:"narrow",context:"formatting"});case"aaaa":default:return l.dayPeriod(m,{width:"wide",context:"formatting"})}},b:function(n,o,l){var u=n.getUTCHours(),m;switch(u===12?m=Bh.noon:u===0?m=Bh.midnight:m=u/12>=1?"pm":"am",o){case"b":case"bb":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"});case"bbb":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return l.dayPeriod(m,{width:"narrow",context:"formatting"});case"bbbb":default:return l.dayPeriod(m,{width:"wide",context:"formatting"})}},B:function(n,o,l){var u=n.getUTCHours(),m;switch(u>=17?m=Bh.evening:u>=12?m=Bh.afternoon:u>=4?m=Bh.morning:m=Bh.night,o){case"B":case"BB":case"BBB":return l.dayPeriod(m,{width:"abbreviated",context:"formatting"});case"BBBBB":return l.dayPeriod(m,{width:"narrow",context:"formatting"});case"BBBB":default:return l.dayPeriod(m,{width:"wide",context:"formatting"})}},h:function(n,o,l){if(o==="ho"){var u=n.getUTCHours()%12;return u===0&&(u=12),l.ordinalNumber(u,{unit:"hour"})}return cl.h(n,o)},H:function(n,o,l){return o==="Ho"?l.ordinalNumber(n.getUTCHours(),{unit:"hour"}):cl.H(n,o)},K:function(n,o,l){var u=n.getUTCHours()%12;return o==="Ko"?l.ordinalNumber(u,{unit:"hour"}):Bs(u,o.length)},k:function(n,o,l){var u=n.getUTCHours();return u===0&&(u=24),o==="ko"?l.ordinalNumber(u,{unit:"hour"}):Bs(u,o.length)},m:function(n,o,l){return o==="mo"?l.ordinalNumber(n.getUTCMinutes(),{unit:"minute"}):cl.m(n,o)},s:function(n,o,l){return o==="so"?l.ordinalNumber(n.getUTCSeconds(),{unit:"second"}):cl.s(n,o)},S:function(n,o){return cl.S(n,o)},X:function(n,o,l,u){var m=u._originalDate||n,g=m.getTimezoneOffset();if(g===0)return"Z";switch(o){case"X":return UB(g);case"XXXX":case"XX":return Ud(g);case"XXXXX":case"XXX":default:return Ud(g,":")}},x:function(n,o,l,u){var m=u._originalDate||n,g=m.getTimezoneOffset();switch(o){case"x":return UB(g);case"xxxx":case"xx":return Ud(g);case"xxxxx":case"xxx":default:return Ud(g,":")}},O:function(n,o,l,u){var m=u._originalDate||n,g=m.getTimezoneOffset();switch(o){case"O":case"OO":case"OOO":return"GMT"+FB(g,":");case"OOOO":default:return"GMT"+Ud(g,":")}},z:function(n,o,l,u){var m=u._originalDate||n,g=m.getTimezoneOffset();switch(o){case"z":case"zz":case"zzz":return"GMT"+FB(g,":");case"zzzz":default:return"GMT"+Ud(g,":")}},t:function(n,o,l,u){var m=u._originalDate||n,g=Math.floor(m.getTime()/1e3);return Bs(g,o.length)},T:function(n,o,l,u){var m=u._originalDate||n,g=m.getTime();return Bs(g,o.length)}};function FB(r,n){var o=r>0?"-":"+",l=Math.abs(r),u=Math.floor(l/60),m=l%60;if(m===0)return o+String(u);var g=n;return o+String(u)+g+Bs(m,2)}function UB(r,n){if(r%60===0){var o=r>0?"-":"+";return o+Bs(Math.abs(r)/60,2)}return Ud(r,n)}function Ud(r,n){var o=n||"",l=r>0?"-":"+",u=Math.abs(r),m=Bs(Math.floor(u/60),2),g=Bs(u%60,2);return l+m+o+g}var VB=function(n,o){switch(n){case"P":return o.date({width:"short"});case"PP":return o.date({width:"medium"});case"PPP":return o.date({width:"long"});case"PPPP":default:return o.date({width:"full"})}},QW=function(n,o){switch(n){case"p":return o.time({width:"short"});case"pp":return o.time({width:"medium"});case"ppp":return o.time({width:"long"});case"pppp":default:return o.time({width:"full"})}},Ffe=function(n,o){var l=n.match(/(P+)(p+)?/)||[],u=l[1],m=l[2];if(!m)return VB(n,o);var g;switch(u){case"P":g=o.dateTime({width:"short"});break;case"PP":g=o.dateTime({width:"medium"});break;case"PPP":g=o.dateTime({width:"long"});break;case"PPPP":default:g=o.dateTime({width:"full"});break}return g.replace("{{date}}",VB(u,o)).replace("{{time}}",QW(m,o))},Ufe={p:QW,P:Ffe},Vfe=["D","DD"],Bfe=["YY","YYYY"];function Wfe(r){return Vfe.indexOf(r)!==-1}function Gfe(r){return Bfe.indexOf(r)!==-1}function BB(r,n,o){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(n,"`) for formatting years to the input `").concat(o,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(n,"`) for formatting years to the input `").concat(o,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(n,"`) for formatting days of the month to the input `").concat(o,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(n,"`) for formatting days of the month to the input `").concat(o,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Hfe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},zfe=function(n,o,l){var u,m=Hfe[n];return typeof m=="string"?u=m:o===1?u=m.one:u=m.other.replace("{{count}}",o.toString()),l!=null&&l.addSuffix?l.comparison&&l.comparison>0?"in "+u:u+" ago":u};function aN(r){return function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=n.width?String(n.width):r.defaultWidth,l=r.formats[o]||r.formats[r.defaultWidth];return l}}var Kfe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},qfe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Yfe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},$fe={date:aN({formats:Kfe,defaultWidth:"full"}),time:aN({formats:qfe,defaultWidth:"full"}),dateTime:aN({formats:Yfe,defaultWidth:"full"})},Xfe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Jfe=function(n,o,l,u){return Xfe[n]};function Mf(r){return function(n,o){var l=o!=null&&o.context?String(o.context):"standalone",u;if(l==="formatting"&&r.formattingValues){var m=r.defaultFormattingWidth||r.defaultWidth,g=o!=null&&o.width?String(o.width):m;u=r.formattingValues[g]||r.formattingValues[m]}else{var E=r.defaultWidth,y=o!=null&&o.width?String(o.width):r.defaultWidth;u=r.values[y]||r.values[E]}var x=r.argumentCallback?r.argumentCallback(n):n;return u[x]}}var Qfe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Zfe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ege={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},tge={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},sge={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},rge={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},nge=function(n,o){var l=Number(n),u=l%100;if(u>20||u<10)switch(u%10){case 1:return l+"st";case 2:return l+"nd";case 3:return l+"rd"}return l+"th"},ige={ordinalNumber:nge,era:Mf({values:Qfe,defaultWidth:"wide"}),quarter:Mf({values:Zfe,defaultWidth:"wide",argumentCallback:function(n){return n-1}}),month:Mf({values:ege,defaultWidth:"wide"}),day:Mf({values:tge,defaultWidth:"wide"}),dayPeriod:Mf({values:sge,defaultWidth:"wide",formattingValues:rge,defaultFormattingWidth:"wide"})};function Ff(r){return function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=o.width,u=l&&r.matchPatterns[l]||r.matchPatterns[r.defaultMatchWidth],m=n.match(u);if(!m)return null;var g=m[0],E=l&&r.parsePatterns[l]||r.parsePatterns[r.defaultParseWidth],y=Array.isArray(E)?oge(E,function(C){return C.test(g)}):age(E,function(C){return C.test(g)}),x;x=r.valueCallback?r.valueCallback(y):y,x=o.valueCallback?o.valueCallback(x):x;var S=n.slice(g.length);return{value:x,rest:S}}}function age(r,n){for(var o in r)if(r.hasOwnProperty(o)&&n(r[o]))return o}function oge(r,n){for(var o=0;o<r.length;o++)if(n(r[o]))return o}function cge(r){return function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=n.match(r.matchPattern);if(!l)return null;var u=l[0],m=n.match(r.parsePattern);if(!m)return null;var g=r.valueCallback?r.valueCallback(m[0]):m[0];g=o.valueCallback?o.valueCallback(g):g;var E=n.slice(u.length);return{value:g,rest:E}}}var lge=/^(\d+)(th|st|nd|rd)?/i,dge=/\d+/i,uge={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},hge={any:[/^b/i,/^(a|c)/i]},pge={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},mge={any:[/1/i,/2/i,/3/i,/4/i]},fge={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},gge={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},_ge={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},vge={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Ege={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},yge={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},xge={ordinalNumber:cge({matchPattern:lge,parsePattern:dge,valueCallback:function(n){return parseInt(n,10)}}),era:Ff({matchPatterns:uge,defaultMatchWidth:"wide",parsePatterns:hge,defaultParseWidth:"any"}),quarter:Ff({matchPatterns:pge,defaultMatchWidth:"wide",parsePatterns:mge,defaultParseWidth:"any",valueCallback:function(n){return n+1}}),month:Ff({matchPatterns:fge,defaultMatchWidth:"wide",parsePatterns:gge,defaultParseWidth:"any"}),day:Ff({matchPatterns:_ge,defaultMatchWidth:"wide",parsePatterns:vge,defaultParseWidth:"any"}),dayPeriod:Ff({matchPatterns:Ege,defaultMatchWidth:"any",parsePatterns:yge,defaultParseWidth:"any"})},bge={code:"en-US",formatDistance:zfe,formatLong:$fe,formatRelative:Jfe,localize:ige,match:xge,options:{weekStartsOn:0,firstWeekContainsDate:1}},wge=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Sge=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Cge=/^'([^]*?)'?$/,Tge=/''/g,Nge=/[a-zA-Z]/;function lu(r,n,o){var l,u,m,g,E,y,x,S,C,N,M,G,I,P;Xn(2,arguments);var L=String(n),R=ab(),D=(l=(u=void 0)!==null&&u!==void 0?u:R.locale)!==null&&l!==void 0?l:bge,V=cu((m=(g=(E=(y=void 0)!==null&&y!==void 0?y:void 0)!==null&&E!==void 0?E:R.firstWeekContainsDate)!==null&&g!==void 0?g:(x=R.locale)===null||x===void 0||(S=x.options)===null||S===void 0?void 0:S.firstWeekContainsDate)!==null&&m!==void 0?m:1);if(!(V>=1&&V<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var W=cu((C=(N=(M=(G=void 0)!==null&&G!==void 0?G:void 0)!==null&&M!==void 0?M:R.weekStartsOn)!==null&&N!==void 0?N:(I=R.locale)===null||I===void 0||(P=I.options)===null||P===void 0?void 0:P.weekStartsOn)!==null&&C!==void 0?C:0);if(!(W>=0&&W<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!D.localize)throw new RangeError("locale must contain localize property");if(!D.formatLong)throw new RangeError("locale must contain formatLong property");var q=qo(r);if(!Nfe(q))throw new RangeError("Invalid time value");var H=Cfe(q),J=Rfe(q,H),ee={firstWeekContainsDate:V,weekStartsOn:W,locale:D,_originalDate:q},ne=L.match(Sge).map(function(pe){var Ee=pe[0];if(Ee==="p"||Ee==="P"){var ge=Ufe[Ee];return ge(pe,D.formatLong)}return pe}).join("").match(wge).map(function(pe){if(pe==="''")return"'";var Ee=pe[0];if(Ee==="'")return Rge(pe);var ge=Mfe[Ee];if(ge)return Gfe(pe)&&BB(pe,n,String(r)),Wfe(pe)&&BB(pe,n,String(r)),ge(J,pe,D.localize,ee);if(Ee.match(Nge))throw new RangeError("Format string contains an unescaped latin alphabet character `"+Ee+"`");return pe}).join("");return ne}function Rge(r){var n=r.match(Cge);return n?n[1].replace(Tge,"'"):r}const Age={fan:{title:"Fan Dashboard",menu:[{type:"link",to:"/fan",label:"Browse Events",icon:""},{type:"link",to:"/fan/following",label:"Following",icon:""},{type:"link",to:"/fan/bids",label:"My Bids",icon:""},{type:"link",to:"/fan/meets",label:"Upcoming Meets",icon:""},{type:"link",to:"/fan/history",label:"History",icon:""},{type:"link",to:"/fan/wallet",label:"Payment History",icon:""},{type:"link",to:"/fan/messages",label:"Messages",icon:""},{type:"link",to:"/fan/notifications",label:"Notifications",icon:""},{type:"link",to:"/fan/settings",label:"Settings",icon:""},{type:"link",to:"/fan/support",label:"Help & Support",icon:""}]},creator:{title:"Creator Control Room",menu:[{type:"link",to:"/creator",label:"Overview",icon:""},{type:"link",to:"/creator/events",label:"My Events",icon:""},{type:"link",to:"/creator/events/new",label:"Create Event",icon:""},{type:"link",to:"/creator/profile-setup",label:"Profile Setup",icon:""},{type:"link",to:"/creator/followers",label:"Followers",icon:""},{type:"link",to:"/creator/earnings",label:"Earnings",icon:""},{type:"link",to:"/creator/withdrawals",label:"Withdrawals",icon:""},{type:"link",to:"/creator/meets",label:"Upcoming Meets",icon:""},{type:"link",to:"/creator/messages",label:"Messages",icon:""},{type:"link",to:"/creator/notifications",label:"Notifications",icon:""},{type:"link",to:"/creator/settings",label:"Settings",icon:""},{type:"link",to:"/creator/support",label:"Help & Support",icon:""}]},admin:{title:"Admin Command Center",menu:[{type:"link",to:"/admin",label:"Dashboard",icon:""},{type:"section",label:"USER MANAGEMENT"},{type:"link",to:"/admin/users",label:"All Users",icon:""},{type:"link",to:"/admin/creators",label:"Creators Management",icon:""},{type:"link",to:"/admin/fans",label:"Fans Management",icon:""},{type:"section",label:"CONTENT MANAGEMENT"},{type:"link",to:"/admin/events",label:"Events Management",icon:""},{type:"link",to:"/admin/featured",label:"Featured Creators",icon:""},{type:"link",to:"/admin/announcements",label:"Announcements",icon:""},{type:"section",label:"FINANCIAL"},{type:"link",to:"/admin/payments",label:"Payments & Transactions",icon:""},{type:"link",to:"/admin/withdrawals",label:"Withdrawal Requests",icon:""},{type:"link",to:"/admin/refunds",label:"Refunds Management",icon:""},{type:"link",to:"/admin/revenue-analytics",label:"Revenue Analytics",icon:""},{type:"link",to:"/admin/platform-commission",label:"Platform Commission",icon:""},{type:"section",label:"REPORTS & ANALYTICS"},{type:"link",to:"/admin/business-analytics",label:"Business Analytics",icon:""},{type:"link",to:"/admin/user-analytics",label:"User Analytics",icon:""},{type:"link",to:"/admin/revenue-reports",label:"Revenue Reports",icon:""},{type:"link",to:"/admin/event-analytics",label:"Event Analytics",icon:""},{type:"link",to:"/admin/audit-logs",label:"Audit Logs",icon:""},{type:"section",label:"SUPPORT & MODERATION"},{type:"link",to:"/admin/support-tickets",label:"Support Tickets",icon:""},{type:"link",to:"/admin/reports-flags",label:"Reports & Flags",icon:""},{type:"link",to:"/admin/disputes",label:"Dispute Management",icon:""},{type:"section",label:"PLATFORM SETTINGS"},{type:"link",to:"/admin/settings/general",label:"General Settings",icon:""},{type:"link",to:"/admin/settings/pricing",label:"Pricing & Commission",icon:""},{type:"link",to:"/admin/settings/email-templates",label:"Email Templates",icon:""},{type:"link",to:"/admin/settings/notifications",label:"Notification Settings",icon:""},{type:"link",to:"/admin/settings/security",label:"Security & Access",icon:""},{type:"section",label:"SYSTEM"},{type:"link",to:"/admin/system/logs",label:"System Logs",icon:""},{type:"link",to:"/admin/system/bulk-actions",label:"Bulk Actions",icon:""},{type:"link",to:"/admin/system/backup",label:"Database Backup",icon:""},{type:"section",label:"ACCOUNT"},{type:"link",to:"/admin/profile",label:"My Profile",icon:""}]}},oN=({role:r})=>{var Ze,Me;const n=Age[r],o=Ss(),{logout:l,user:u}=fs(),{notifications:m,unreadNotificationsCount:g,unreadMessagesCount:E,markAllNotificationsAsRead:y}=Xg(),x=r==="creator"&&u&&u.creatorProfileStatus!=="approved",S=(u==null?void 0:u.creatorProfileStatus)==="pending";u==null||u.creatorProfileStatus;const C=u!=null&&u.username?u.username.substring(0,2).toUpperCase():((Ze=u==null?void 0:u.email)==null?void 0:Ze.substring(0,2).toUpperCase())||"U",N=u!=null&&u.username?u.username.charAt(0).toUpperCase()+u.username.slice(1):((Me=u==null?void 0:u.email)==null?void 0:Me.split("@")[0])||"User",M=O.useMemo(()=>`/${r}`,[r]),[G,I]=O.useState(!1),[P,L]=O.useState(!1),[R,D]=O.useState(320),[V,W]=O.useState(!1),[q,H]=O.useState("none"),[J,ee]=O.useState(""),[ne,pe]=O.useState(!1),[Ee,ge]=O.useState(!1),[he,le]=O.useState(!1),[Le,fe]=O.useState(!0),[ae,be]=O.useState({bank_account_name:"",bank_account_number:"",confirm_bank_account_number:"",bank_ifsc:"",upi_id:""});O.useEffect(()=>{if(r!=="creator"||!u)return;(async()=>{ge(!0);try{const{data:ke}=await ie.from("profiles").select("bank_account_name, bank_account_number, bank_ifsc, upi_id, razorpay_fund_account_id").eq("user_id",u.id).maybeSingle(),Ie=!!(ke!=null&&ke.razorpay_fund_account_id||ke!=null&&ke.bank_account_number||ke!=null&&ke.upi_id);fe(Ie),ke&&be({bank_account_name:ke.bank_account_name||"",bank_account_number:ke.bank_account_number||"",confirm_bank_account_number:ke.bank_account_number||"",bank_ifsc:ke.bank_ifsc||"",upi_id:ke.upi_id||""})}finally{ge(!1)}})()},[r,u]);const We=async()=>{if(!u)return;const Ue=!!ae.upi_id,ke=!!ae.bank_account_number;if(!Ue&&!ke){alert("Please provide either Bank Account details or a UPI ID.");return}if(ke){if(!ae.bank_account_name){alert("Please enter the Account Holder Name.");return}if(!ae.bank_ifsc||ae.bank_ifsc.length!==11){alert("Please enter a valid 11-character IFSC code.");return}if(ae.bank_account_number!==ae.confirm_bank_account_number){alert("Account numbers do not match. Please re-enter.");return}}le(!0);try{const Ie={name:ae.bank_account_name,ifsc:ae.bank_ifsc,account_number:ae.bank_account_number,upi_id:ae.upi_id},{data:Xe,error:ye}=await ie.functions.invoke("create-razorpay-fund-account",{body:Ie});if(ye){console.error("Edge function error:",ye),alert(`Verification failed: ${ye.message||"Unknown error"}`),le(!1);return}const{confirm_bank_account_number:Oe,...qe}=ae,Ct={...qe};Xe!=null&&Xe.fund_account_id&&(Ct.razorpay_fund_account_id=Xe.fund_account_id);const{error:Ft}=await ie.from("profiles").update(Ct).eq("user_id",u.id);if(Ft)throw Ft;fe(!0),pe(!1),alert("Payout details saved successfully!")}catch(Ie){console.error("Error updating payout details:",Ie),alert("Failed to update payout details.")}finally{le(!1)}},it=()=>{l(),o("/auth")};O.useEffect(()=>{if(!V)return;const Ue=Ie=>{const Oe=Math.min(420,Math.max(220,Ie.clientX));D(Oe)},ke=()=>{W(!1)};return window.addEventListener("mousemove",Ue),window.addEventListener("mouseup",ke),()=>{window.removeEventListener("mousemove",Ue),window.removeEventListener("mouseup",ke)}},[V]);const Ge=Ue=>n.menu.map(ke=>{if("type"in ke&&ke.type==="section")return i.jsx("div",{className:"mt-4 mb-1 text-xs font-semibold uppercase tracking-[0.2em] text-white/60",children:ke.label},ke.label);const Ie=ke,Xe=!!Ie.disabled,ye=Ie.to===M;let Oe=0;return Ie.label==="Notifications"?Oe=g:Ie.label==="Messages"&&(Oe=E),i.jsxs(dl,{to:Ie.to,end:ye,onClick:qe=>{if(Xe){qe.preventDefault(),qe.stopPropagation();return}Ue!=null&&Ue.closeOnSelect&&I(!1)},className:({isActive:qe})=>Kd("flex items-center gap-3 rounded-[12px] border border-transparent px-5 py-3 text-base transition-all",Xe?"cursor-not-allowed text-white/40 opacity-60":qe?"bg-white/10 text-white font-semibold shadow-[0_18px_45px_rgba(0,0,0,0.65)]":"text-white/75 hover:bg-white/5 hover:text-white"),children:[i.jsx("span",{className:Kd("flex-1",r==="admin"?"font-semibold tracking-wide":"",P?"hidden":""),children:Ie.label}),!Xe&&Oe>0?i.jsx($e,{variant:"danger",children:Oe}):null]},Ie.to)}),pt=()=>q==="notifications"?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between border-b border-[#E9ECEF] px-5 py-4",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Notifications"}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Latest updates on your bids and meets."})]}),i.jsx(oe,{variant:"secondary",size:"sm",className:"border-none bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>y(),children:"Mark all read"})]}),i.jsx("div",{className:"flex-1 space-y-3 overflow-y-auto px-5 py-4",children:m.length===0?i.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No notifications yet."}):m.slice(0,5).map(Ue=>i.jsxs("div",{className:"rounded-[12px] bg-white/90 p-3 shadow-sm",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:Ue.title}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:Ue.message}),i.jsx("div",{className:"mt-1 text-[10px] text-[#ADB5BD]",children:lu(new Date(Ue.created_at),"MMM d, h:mm a")})]},Ue.id))}),i.jsx("div",{className:"border-t border-[#E9ECEF] p-4",children:i.jsx(oe,{variant:"secondary",size:"sm",className:"w-full border-none bg-white text-[#050014] hover:bg-[#F8F9FA]",onClick:()=>o(`/${r}/notifications`),children:"View all notifications"})})]}):q==="profile"?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-3 border-b border-[#E9ECEF] px-5 py-4",children:[i.jsx(gi,{initials:C,size:"md"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:N}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:[r.charAt(0).toUpperCase()+r.slice(1)," account  Premium"]})]})]}),i.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4",children:[i.jsxs("div",{className:"rounded-[12px] bg-white/90 p-3 shadow-sm",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:"Payment Info"}),i.jsx("div",{className:"mt-1 text-sm font-semibold text-[#212529]",children:"Auto-refund enabled"}),i.jsx("div",{className:"mt-1 text-xs text-[#6C757D]",children:"90% refund for unsuccessful bids"})]}),i.jsxs("div",{className:"grid gap-2 text-sm text-[#343A40]",children:[i.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>o(`/${r}/wallet`),children:[i.jsx("span",{children:"Payment history"}),i.jsx("span",{children:""})]}),i.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>o(`/${r}/meets`),children:[i.jsx("span",{children:"Upcoming meets"}),i.jsx("span",{children:""})]}),i.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-[10px] bg-white/90 px-3 py-2 text-left shadow-sm hover:bg-[#F8F9FA]",onClick:()=>o(`/${r}/settings`),children:[i.jsx("span",{children:"Profile & settings"}),i.jsx("span",{children:""})]})]})]}),i.jsx("div",{className:"border-t border-[#E9ECEF] p-4",children:i.jsx(oe,{variant:"secondary",size:"sm",className:"w-full border-none bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>{it()},children:"Switch account"})})]}):null;return i.jsxs("div",{className:"flex min-h-screen bg-[#F8F9FA]",children:[ne&&i.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsxs("div",{className:"mx-4 w-full max-w-xl rounded-2xl bg-white p-6 shadow-2xl",children:[i.jsxs("div",{className:"flex items-start justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:"Add payout method"}),i.jsx("div",{className:"mt-1 text-sm text-[#6C757D]",children:"Add bank account OR UPI to enable withdrawals. Your details will be verified."})]}),i.jsx("button",{type:"button",className:"rounded-md border border-[#E9ECEF] px-3 py-1 text-sm text-[#343A40] hover:bg-[#F8F9FA]",onClick:()=>pe(!1),disabled:he,children:""})]}),i.jsxs("div",{className:"mt-5 flex flex-col gap-4",children:[i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] p-4",children:[i.jsx("div",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Bank Transfer (NEFT/IMPS)"}),i.jsx(nt,{label:"Beneficiary Name",placeholder:"Name as per bank records",value:ae.bank_account_name,onChange:Ue=>be(ke=>({...ke,bank_account_name:Ue.target.value}))}),i.jsxs("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[i.jsx(nt,{label:"Account Number",placeholder:"e.g. 1234567890",type:"password",value:ae.bank_account_number,onChange:Ue=>be(ke=>({...ke,bank_account_number:Ue.target.value}))}),i.jsx(nt,{label:"Confirm Account Number",placeholder:"Re-enter account number",value:ae.confirm_bank_account_number,onChange:Ue=>be(ke=>({...ke,confirm_bank_account_number:Ue.target.value}))})]}),i.jsx("div",{className:"mt-3",children:i.jsx(nt,{label:"IFSC Code",placeholder:"e.g. HDFC0001234",value:ae.bank_ifsc,maxLength:11,onChange:Ue=>be(ke=>({...ke,bank_ifsc:Ue.target.value.toUpperCase()}))})})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"}),i.jsx("span",{className:"text-sm font-medium text-[#6C757D]",children:"OR"}),i.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] p-4",children:[i.jsx("div",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"UPI ID (VPA)"}),i.jsx(nt,{label:"UPI ID",placeholder:"e.g. username@oksbi",value:ae.upi_id,onChange:Ue=>be(ke=>({...ke,upi_id:Ue.target.value}))})]}),i.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:[i.jsx(oe,{variant:"secondary",size:"lg",className:"w-full border-none bg-white text-[#050014] hover:bg-[#F8F9FA]",onClick:()=>pe(!1),disabled:he,children:"Cancel"}),i.jsx(oe,{size:"lg",className:"w-full",onClick:We,disabled:he,children:he?"Verifying & Saving...":"Save payout method"})]})]})]})}),x&&i.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:i.jsxs("div",{className:"mx-4 max-w-md rounded-2xl bg-white p-8 text-center shadow-2xl",children:[i.jsx("div",{className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-gradient-to-br from-[#F4E6FF] to-[#E9D5FF]",children:i.jsx("span",{className:"text-4xl",children:S?"":""})}),i.jsx("h2",{className:"mb-2 text-2xl font-bold text-[#212529]",children:S?"Account Pending Verification":"Account Not Approved"}),i.jsx("p",{className:"mb-6 text-[#6C757D]",children:S?"Your creator account is currently under review. Our team will verify your profile within 24-48 hours. You will receive a notification once approved.":"Unfortunately, your creator application was not approved. Please contact our support team for more information or to reapply."}),i.jsxs("div",{className:"flex flex-col gap-3",children:[S&&i.jsxs("div",{className:"rounded-xl bg-[#F4E6FF]/60 p-4 text-left",children:[i.jsx("p",{className:"text-sm font-medium text-[#7B2CBF]",children:"While you wait:"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-[#6C757D]",children:[i.jsx("li",{children:" Complete your profile setup"}),i.jsx("li",{children:" Add your bank details for payouts"}),i.jsx("li",{children:" Link your social media accounts"})]})]}),i.jsx(oe,{onClick:()=>o("/creator/profile-setup"),className:"w-full",children:S?"Complete Profile Setup":"Update Profile"}),i.jsx(oe,{variant:"secondary",onClick:()=>o("/creator/support"),className:"w-full",children:"Contact Support"}),i.jsx("button",{type:"button",onClick:it,className:"mt-2 text-sm text-[#6C757D] underline hover:text-[#212529]",children:"Logout and switch account"})]})]})}),i.jsxs("aside",{className:"sticky top-0 hidden h-screen max-h-screen flex-shrink-0 border-r border-[#1F2933] bg-gradient-to-b from-[#050014] via-[#050014] to-[#140423] text-white md:flex md:flex-col relative",style:{width:P?80:R},children:[i.jsxs("div",{className:Kd("flex flex-1 flex-col overflow-y-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden py-8",P?"px-3":"px-6"),children:[i.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[i.jsx(gi,{initials:C,size:"lg"}),i.jsxs("div",{className:Kd("text-lg font-semibold text-white",P?"hidden":""),children:["Hey, ",N,"!"]}),P?null:i.jsx($e,{variant:"primary",children:"Premium"})]}),i.jsx("nav",{className:"mt-8 flex flex-1 flex-col gap-1",children:Ge()})]}),i.jsx("button",{type:"button",onClick:()=>L(Ue=>!Ue),className:"absolute -right-3 top-24 hidden h-7 w-7 items-center justify-center rounded-full border border-white/30 bg-[#050014] text-xs text-white shadow-md transition hover:bg-white hover:text-[#050014] md:flex",children:P?"":""}),i.jsx("div",{className:"absolute right-0 top-0 hidden h-full w-1 cursor-col-resize md:block",onMouseDown:()=>W(!0)}),i.jsx("div",{className:"px-6 pb-6",children:i.jsx("button",{type:"button",className:"inline-flex h-10 w-full items-center justify-start rounded-[8px] bg-black px-4 text-sm font-semibold text-white transition-colors hover:bg-black/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:it,children:"Logout"})})]}),G&&i.jsxs("div",{className:"fixed inset-0 z-40 flex md:hidden",children:[i.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:()=>I(!1)}),i.jsxs("div",{className:"relative z-10 flex h-full w-[260px] flex-col border-r border-[#1F2933] bg-gradient-to-b from-[#050014] via-[#050014] to-[#140423] text-white",children:[i.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 px-4 py-3",children:[i.jsx("span",{className:"text-sm font-semibold text-white",children:n.title}),i.jsx("button",{type:"button",className:"rounded-md border border-white/30 p-1 text-white",onClick:()=>I(!1),children:""})]}),i.jsxs("div",{className:"flex flex-1 flex-col overflow-y-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden px-4 py-4",children:[i.jsx("nav",{className:"flex flex-1 flex-col gap-1",children:Ge({closeOnSelect:!0})}),i.jsx("div",{className:"mt-4",children:i.jsx("button",{type:"button",className:"inline-flex h-10 w-full items-center justify-start rounded-[8px] bg-black px-4 text-sm font-semibold text-white transition-colors hover:bg-black/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2",onClick:it,children:"Logout"})})]})]})]}),q!=="none"&&i.jsx("div",{className:"fixed inset-y-0 right-0 z-30 hidden w-80 flex-col border-l border-[#E9ECEF] bg-gradient-to-b from-[#FFF7FF] via-[#F4E6FF] to-[#F5F0FF] shadow-[0_0_45px_rgba(15,23,42,0.25)] backdrop-blur-xl md:flex",onMouseLeave:()=>H("none"),children:pt()}),i.jsxs("div",{className:"flex w-full flex-col",children:[i.jsxs("header",{className:"sticky top-0 z-40 flex h-[70px] items-center justify-between border-b border-[#E9ECEF] bg-white px-6 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-md border border-[#E9ECEF] p-2 text-[#343A40] md:hidden",onClick:()=>I(Ue=>!Ue),children:[i.jsx("span",{className:"sr-only",children:"Open sidebar"}),i.jsxs("div",{className:"flex flex-col gap-[3px]",children:[i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"}),i.jsx("span",{className:"h-[2px] w-4 bg-[#343A40]"})]})]}),i.jsx("div",{className:"text-xl font-semibold text-[#212529]",children:n.title})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[r==="creator"&&!Ee&&!Le&&i.jsx(oe,{size:"lg",className:"bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>{o("/creator/settings#payouts"),setTimeout(()=>{const Ue=document.querySelector("#payouts");Ue==null||Ue.scrollIntoView({behavior:"smooth",block:"start"})},50)},children:"Add bank account"}),i.jsxs("div",{className:"relative hidden md:block",children:[i.jsx("input",{className:"h-11 rounded-[12px] border-2 border-[#E9ECEF] px-4 pr-10 text-sm focus:border-[#FF6B35] focus:shadow-[0_0_0_3px_rgba(255,107,53,0.1)]",placeholder:"Search events, creators",value:J,onChange:Ue=>ee(Ue.target.value),onKeyDown:Ue=>{Ue.key==="Enter"&&o(`${r==="fan"?"/fan":"/browse-events"}?q=${encodeURIComponent(J)}`)}}),i.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-lg text-[#6C757D]",children:""})]}),i.jsx("div",{className:"hidden md:block",onMouseEnter:()=>H("notifications"),children:i.jsxs(oe,{variant:"secondary",size:"icon",className:"bg-black text-white border-none hover:bg-black/90 relative",children:["",g>0&&i.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white",children:g})]})}),i.jsx("div",{className:"hidden md:block",onMouseEnter:()=>H("profile"),children:i.jsx(gi,{initials:C,size:"sm"})}),i.jsxs("div",{className:"flex items-center gap-2 md:hidden",children:[i.jsxs(oe,{variant:"secondary",size:"icon",className:"bg-black text-white border-none hover:bg-black/90 relative",onClick:()=>H(q==="notifications"?"none":"notifications"),children:["",g>0&&i.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white",children:g})]}),i.jsx(gi,{initials:C,size:"sm"})]})]})]}),i.jsx("main",{className:"flex-1 overflow-x-hidden px-4 py-6 md:px-12 md:py-10",children:i.jsx(gW,{})})]})]})},uI=O.createContext({});function Kp(r){const n=O.useRef(null);return n.current===null&&(n.current=r()),n.current}const hI=typeof window<"u",ob=hI?O.useLayoutEffect:O.useEffect,cb=O.createContext(null);function pI(r,n){r.indexOf(n)===-1&&r.push(n)}function mI(r,n){const o=r.indexOf(n);o>-1&&r.splice(o,1)}const zo=(r,n,o)=>o>n?n:o<r?r:o;let Pg=()=>{};const Sc={},ZW=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function eG(r){return typeof r=="object"&&r!==null}const tG=r=>/^0[^.\s]+$/u.test(r);function fI(r){let n;return()=>(n===void 0&&(n=r()),n)}const xi=r=>r,Ige=(r,n)=>o=>n(r(o)),Jg=(...r)=>r.reduce(Ige),kp=(r,n,o)=>{const l=n-r;return l===0?1:(o-r)/l};class gI{constructor(){this.subscriptions=[]}add(n){return pI(this.subscriptions,n),()=>mI(this.subscriptions,n)}notify(n,o,l){const u=this.subscriptions.length;if(u)if(u===1)this.subscriptions[0](n,o,l);else for(let m=0;m<u;m++){const g=this.subscriptions[m];g&&g(n,o,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Go=r=>r*1e3,xa=r=>r/1e3;function _I(r,n){return n?r*(1e3/n):0}const sG=(r,n,o)=>(((1-3*o+3*n)*r+(3*o-6*n))*r+3*n)*r,Dge=1e-7,Oge=12;function jge(r,n,o,l,u){let m,g,E=0;do g=n+(o-n)/2,m=sG(g,l,u)-r,m>0?o=g:n=g;while(Math.abs(m)>Dge&&++E<Oge);return g}function Qg(r,n,o,l){if(r===n&&o===l)return xi;const u=m=>jge(m,0,1,r,o);return m=>m===0||m===1?m:sG(u(m),n,l)}const rG=r=>n=>n<=.5?r(2*n)/2:(2-r(2*(1-n)))/2,nG=r=>n=>1-r(1-n),iG=Qg(.33,1.53,.69,.99),vI=nG(iG),aG=rG(vI),oG=r=>(r*=2)<1?.5*vI(r):.5*(2-Math.pow(2,-10*(r-1))),EI=r=>1-Math.sin(Math.acos(r)),cG=nG(EI),lG=rG(EI),Pge=Qg(.42,0,1,1),kge=Qg(0,0,.58,1),dG=Qg(.42,0,.58,1),Lge=r=>Array.isArray(r)&&typeof r[0]!="number",uG=r=>Array.isArray(r)&&typeof r[0]=="number",Mge={linear:xi,easeIn:Pge,easeInOut:dG,easeOut:kge,circIn:EI,circInOut:lG,circOut:cG,backIn:vI,backInOut:aG,backOut:iG,anticipate:oG},Fge=r=>typeof r=="string",WB=r=>{if(uG(r)){Pg(r.length===4);const[n,o,l,u]=r;return Qg(n,o,l,u)}else if(Fge(r))return Mge[r];return r},wy=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Uge(r,n){let o=new Set,l=new Set,u=!1,m=!1;const g=new WeakSet;let E={delta:0,timestamp:0,isProcessing:!1};function y(S){g.has(S)&&(x.schedule(S),r()),S(E)}const x={schedule:(S,C=!1,N=!1)=>{const G=N&&u?o:l;return C&&g.add(S),G.has(S)||G.add(S),S},cancel:S=>{l.delete(S),g.delete(S)},process:S=>{if(E=S,u){m=!0;return}u=!0,[o,l]=[l,o],o.forEach(y),o.clear(),u=!1,m&&(m=!1,x.process(S))}};return x}const Vge=40;function hG(r,n){let o=!1,l=!0;const u={delta:0,timestamp:0,isProcessing:!1},m=()=>o=!0,g=wy.reduce((D,V)=>(D[V]=Uge(m),D),{}),{setup:E,read:y,resolveKeyframes:x,preUpdate:S,update:C,preRender:N,render:M,postRender:G}=g,I=()=>{const D=Sc.useManualTiming?u.timestamp:performance.now();o=!1,Sc.useManualTiming||(u.delta=l?1e3/60:Math.max(Math.min(D-u.timestamp,Vge),1)),u.timestamp=D,u.isProcessing=!0,E.process(u),y.process(u),x.process(u),S.process(u),C.process(u),N.process(u),M.process(u),G.process(u),u.isProcessing=!1,o&&n&&(l=!1,r(I))},P=()=>{o=!0,l=!0,u.isProcessing||r(I)};return{schedule:wy.reduce((D,V)=>{const W=g[V];return D[V]=(q,H=!1,J=!1)=>(o||P(),W.schedule(q,H,J)),D},{}),cancel:D=>{for(let V=0;V<wy.length;V++)g[wy[V]].cancel(D)},state:u,steps:g}}const{schedule:Ws,cancel:co,state:an,steps:cN}=hG(typeof requestAnimationFrame<"u"?requestAnimationFrame:xi,!0);let Gy;function Bge(){Gy=void 0}const _i={now:()=>(Gy===void 0&&_i.set(an.isProcessing||Sc.useManualTiming?an.timestamp:performance.now()),Gy),set:r=>{Gy=r,queueMicrotask(Bge)}},pG=r=>n=>typeof n=="string"&&n.startsWith(r),yI=pG("--"),Wge=pG("var(--"),xI=r=>Wge(r)?Gge.test(r.split("/*")[0].trim()):!1,Gge=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,qp={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},kg={...qp,transform:r=>zo(0,1,r)},Sy={...qp,default:1},ag=r=>Math.round(r*1e5)/1e5,bI=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Hge(r){return r==null}const zge=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,wI=(r,n)=>o=>!!(typeof o=="string"&&zge.test(o)&&o.startsWith(r)||n&&!Hge(o)&&Object.prototype.hasOwnProperty.call(o,n)),mG=(r,n,o)=>l=>{if(typeof l!="string")return l;const[u,m,g,E]=l.match(bI);return{[r]:parseFloat(u),[n]:parseFloat(m),[o]:parseFloat(g),alpha:E!==void 0?parseFloat(E):1}},Kge=r=>zo(0,255,r),lN={...qp,transform:r=>Math.round(Kge(r))},qd={test:wI("rgb","red"),parse:mG("red","green","blue"),transform:({red:r,green:n,blue:o,alpha:l=1})=>"rgba("+lN.transform(r)+", "+lN.transform(n)+", "+lN.transform(o)+", "+ag(kg.transform(l))+")"};function qge(r){let n="",o="",l="",u="";return r.length>5?(n=r.substring(1,3),o=r.substring(3,5),l=r.substring(5,7),u=r.substring(7,9)):(n=r.substring(1,2),o=r.substring(2,3),l=r.substring(3,4),u=r.substring(4,5),n+=n,o+=o,l+=l,u+=u),{red:parseInt(n,16),green:parseInt(o,16),blue:parseInt(l,16),alpha:u?parseInt(u,16)/255:1}}const LR={test:wI("#"),parse:qge,transform:qd.transform},Zg=r=>({test:n=>typeof n=="string"&&n.endsWith(r)&&n.split(" ").length===1,parse:parseFloat,transform:n=>`${n}${r}`}),hl=Zg("deg"),Ho=Zg("%"),Bt=Zg("px"),Yge=Zg("vh"),$ge=Zg("vw"),GB={...Ho,parse:r=>Ho.parse(r)/100,transform:r=>Ho.transform(r*100)},sp={test:wI("hsl","hue"),parse:mG("hue","saturation","lightness"),transform:({hue:r,saturation:n,lightness:o,alpha:l=1})=>"hsla("+Math.round(r)+", "+Ho.transform(ag(n))+", "+Ho.transform(ag(o))+", "+ag(kg.transform(l))+")"},Gr={test:r=>qd.test(r)||LR.test(r)||sp.test(r),parse:r=>qd.test(r)?qd.parse(r):sp.test(r)?sp.parse(r):LR.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?qd.transform(r):sp.transform(r),getAnimatableNone:r=>{const n=Gr.parse(r);return n.alpha=0,Gr.transform(n)}},Xge=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Jge(r){var n,o;return isNaN(r)&&typeof r=="string"&&(((n=r.match(bI))==null?void 0:n.length)||0)+(((o=r.match(Xge))==null?void 0:o.length)||0)>0}const fG="number",gG="color",Qge="var",Zge="var(",HB="${}",e_e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Lg(r){const n=r.toString(),o=[],l={color:[],number:[],var:[]},u=[];let m=0;const E=n.replace(e_e,y=>(Gr.test(y)?(l.color.push(m),u.push(gG),o.push(Gr.parse(y))):y.startsWith(Zge)?(l.var.push(m),u.push(Qge),o.push(y)):(l.number.push(m),u.push(fG),o.push(parseFloat(y))),++m,HB)).split(HB);return{values:o,split:E,indexes:l,types:u}}function _G(r){return Lg(r).values}function vG(r){const{split:n,types:o}=Lg(r),l=n.length;return u=>{let m="";for(let g=0;g<l;g++)if(m+=n[g],u[g]!==void 0){const E=o[g];E===fG?m+=ag(u[g]):E===gG?m+=Gr.transform(u[g]):m+=u[g]}return m}}const t_e=r=>typeof r=="number"?0:Gr.test(r)?Gr.getAnimatableNone(r):r;function s_e(r){const n=_G(r);return vG(r)(n.map(t_e))}const Ul={test:Jge,parse:_G,createTransformer:vG,getAnimatableNone:s_e};function dN(r,n,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?r+(n-r)*6*o:o<1/2?n:o<2/3?r+(n-r)*(2/3-o)*6:r}function r_e({hue:r,saturation:n,lightness:o,alpha:l}){r/=360,n/=100,o/=100;let u=0,m=0,g=0;if(!n)u=m=g=o;else{const E=o<.5?o*(1+n):o+n-o*n,y=2*o-E;u=dN(y,E,r+1/3),m=dN(y,E,r),g=dN(y,E,r-1/3)}return{red:Math.round(u*255),green:Math.round(m*255),blue:Math.round(g*255),alpha:l}}function Cx(r,n){return o=>o>0?n:r}const vr=(r,n,o)=>r+(n-r)*o,uN=(r,n,o)=>{const l=r*r,u=o*(n*n-l)+l;return u<0?0:Math.sqrt(u)},n_e=[LR,qd,sp],i_e=r=>n_e.find(n=>n.test(r));function zB(r){const n=i_e(r);if(!n)return!1;let o=n.parse(r);return n===sp&&(o=r_e(o)),o}const KB=(r,n)=>{const o=zB(r),l=zB(n);if(!o||!l)return Cx(r,n);const u={...o};return m=>(u.red=uN(o.red,l.red,m),u.green=uN(o.green,l.green,m),u.blue=uN(o.blue,l.blue,m),u.alpha=vr(o.alpha,l.alpha,m),qd.transform(u))},MR=new Set(["none","hidden"]);function a_e(r,n){return MR.has(r)?o=>o<=0?r:n:o=>o>=1?n:r}function o_e(r,n){return o=>vr(r,n,o)}function SI(r){return typeof r=="number"?o_e:typeof r=="string"?xI(r)?Cx:Gr.test(r)?KB:d_e:Array.isArray(r)?EG:typeof r=="object"?Gr.test(r)?KB:c_e:Cx}function EG(r,n){const o=[...r],l=o.length,u=r.map((m,g)=>SI(m)(m,n[g]));return m=>{for(let g=0;g<l;g++)o[g]=u[g](m);return o}}function c_e(r,n){const o={...r,...n},l={};for(const u in o)r[u]!==void 0&&n[u]!==void 0&&(l[u]=SI(r[u])(r[u],n[u]));return u=>{for(const m in l)o[m]=l[m](u);return o}}function l_e(r,n){const o=[],l={color:0,var:0,number:0};for(let u=0;u<n.values.length;u++){const m=n.types[u],g=r.indexes[m][l[m]],E=r.values[g]??0;o[u]=E,l[m]++}return o}const d_e=(r,n)=>{const o=Ul.createTransformer(n),l=Lg(r),u=Lg(n);return l.indexes.var.length===u.indexes.var.length&&l.indexes.color.length===u.indexes.color.length&&l.indexes.number.length>=u.indexes.number.length?MR.has(r)&&!u.values.length||MR.has(n)&&!l.values.length?a_e(r,n):Jg(EG(l_e(l,u),u.values),o):Cx(r,n)};function yG(r,n,o){return typeof r=="number"&&typeof n=="number"&&typeof o=="number"?vr(r,n,o):SI(r)(r,n)}const u_e=r=>{const n=({timestamp:o})=>r(o);return{start:(o=!0)=>Ws.update(n,o),stop:()=>co(n),now:()=>an.isProcessing?an.timestamp:_i.now()}},xG=(r,n,o=10)=>{let l="";const u=Math.max(Math.round(n/o),2);for(let m=0;m<u;m++)l+=Math.round(r(m/(u-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},Tx=2e4;function CI(r){let n=0;const o=50;let l=r.next(n);for(;!l.done&&n<Tx;)n+=o,l=r.next(n);return n>=Tx?1/0:n}function h_e(r,n=100,o){const l=o({...r,keyframes:[0,n]}),u=Math.min(CI(l),Tx);return{type:"keyframes",ease:m=>l.next(u*m).value/n,duration:xa(u)}}const p_e=5;function bG(r,n,o){const l=Math.max(n-p_e,0);return _I(o-r(l),n-l)}const Ar={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},hN=.001;function m_e({duration:r=Ar.duration,bounce:n=Ar.bounce,velocity:o=Ar.velocity,mass:l=Ar.mass}){let u,m,g=1-n;g=zo(Ar.minDamping,Ar.maxDamping,g),r=zo(Ar.minDuration,Ar.maxDuration,xa(r)),g<1?(u=x=>{const S=x*g,C=S*r,N=S-o,M=FR(x,g),G=Math.exp(-C);return hN-N/M*G},m=x=>{const C=x*g*r,N=C*o+o,M=Math.pow(g,2)*Math.pow(x,2)*r,G=Math.exp(-C),I=FR(Math.pow(x,2),g);return(-u(x)+hN>0?-1:1)*((N-M)*G)/I}):(u=x=>{const S=Math.exp(-x*r),C=(x-o)*r+1;return-hN+S*C},m=x=>{const S=Math.exp(-x*r),C=(o-x)*(r*r);return S*C});const E=5/r,y=g_e(u,m,E);if(r=Go(r),isNaN(y))return{stiffness:Ar.stiffness,damping:Ar.damping,duration:r};{const x=Math.pow(y,2)*l;return{stiffness:x,damping:g*2*Math.sqrt(l*x),duration:r}}}const f_e=12;function g_e(r,n,o){let l=o;for(let u=1;u<f_e;u++)l=l-r(l)/n(l);return l}function FR(r,n){return r*Math.sqrt(1-n*n)}const __e=["duration","bounce"],v_e=["stiffness","damping","mass"];function qB(r,n){return n.some(o=>r[o]!==void 0)}function E_e(r){let n={velocity:Ar.velocity,stiffness:Ar.stiffness,damping:Ar.damping,mass:Ar.mass,isResolvedFromDuration:!1,...r};if(!qB(r,v_e)&&qB(r,__e))if(r.visualDuration){const o=r.visualDuration,l=2*Math.PI/(o*1.2),u=l*l,m=2*zo(.05,1,1-(r.bounce||0))*Math.sqrt(u);n={...n,mass:Ar.mass,stiffness:u,damping:m}}else{const o=m_e(r);n={...n,...o,mass:Ar.mass},n.isResolvedFromDuration=!0}return n}function Nx(r=Ar.visualDuration,n=Ar.bounce){const o=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:n}:r;let{restSpeed:l,restDelta:u}=o;const m=o.keyframes[0],g=o.keyframes[o.keyframes.length-1],E={done:!1,value:m},{stiffness:y,damping:x,mass:S,duration:C,velocity:N,isResolvedFromDuration:M}=E_e({...o,velocity:-xa(o.velocity||0)}),G=N||0,I=x/(2*Math.sqrt(y*S)),P=g-m,L=xa(Math.sqrt(y/S)),R=Math.abs(P)<5;l||(l=R?Ar.restSpeed.granular:Ar.restSpeed.default),u||(u=R?Ar.restDelta.granular:Ar.restDelta.default);let D;if(I<1){const W=FR(L,I);D=q=>{const H=Math.exp(-I*L*q);return g-H*((G+I*L*P)/W*Math.sin(W*q)+P*Math.cos(W*q))}}else if(I===1)D=W=>g-Math.exp(-L*W)*(P+(G+L*P)*W);else{const W=L*Math.sqrt(I*I-1);D=q=>{const H=Math.exp(-I*L*q),J=Math.min(W*q,300);return g-H*((G+I*L*P)*Math.sinh(J)+W*P*Math.cosh(J))/W}}const V={calculatedDuration:M&&C||null,next:W=>{const q=D(W);if(M)E.done=W>=C;else{let H=W===0?G:0;I<1&&(H=W===0?Go(G):bG(D,W,q));const J=Math.abs(H)<=l,ee=Math.abs(g-q)<=u;E.done=J&&ee}return E.value=E.done?g:q,E},toString:()=>{const W=Math.min(CI(V),Tx),q=xG(H=>V.next(W*H).value,W,30);return W+"ms "+q},toTransition:()=>{}};return V}Nx.applyToOptions=r=>{const n=h_e(r,100,Nx);return r.ease=n.ease,r.duration=Go(n.duration),r.type="keyframes",r};function UR({keyframes:r,velocity:n=0,power:o=.8,timeConstant:l=325,bounceDamping:u=10,bounceStiffness:m=500,modifyTarget:g,min:E,max:y,restDelta:x=.5,restSpeed:S}){const C=r[0],N={done:!1,value:C},M=J=>E!==void 0&&J<E||y!==void 0&&J>y,G=J=>E===void 0?y:y===void 0||Math.abs(E-J)<Math.abs(y-J)?E:y;let I=o*n;const P=C+I,L=g===void 0?P:g(P);L!==P&&(I=L-C);const R=J=>-I*Math.exp(-J/l),D=J=>L+R(J),V=J=>{const ee=R(J),ne=D(J);N.done=Math.abs(ee)<=x,N.value=N.done?L:ne};let W,q;const H=J=>{M(N.value)&&(W=J,q=Nx({keyframes:[N.value,G(N.value)],velocity:bG(D,J,N.value),damping:u,stiffness:m,restDelta:x,restSpeed:S}))};return H(0),{calculatedDuration:null,next:J=>{let ee=!1;return!q&&W===void 0&&(ee=!0,V(J),H(J)),W!==void 0&&J>=W?q.next(J-W):(!ee&&V(J),N)}}}function y_e(r,n,o){const l=[],u=o||Sc.mix||yG,m=r.length-1;for(let g=0;g<m;g++){let E=u(r[g],r[g+1]);if(n){const y=Array.isArray(n)?n[g]||xi:n;E=Jg(y,E)}l.push(E)}return l}function TI(r,n,{clamp:o=!0,ease:l,mixer:u}={}){const m=r.length;if(Pg(m===n.length),m===1)return()=>n[0];if(m===2&&n[0]===n[1])return()=>n[1];const g=r[0]===r[1];r[0]>r[m-1]&&(r=[...r].reverse(),n=[...n].reverse());const E=y_e(n,l,u),y=E.length,x=S=>{if(g&&S<r[0])return n[0];let C=0;if(y>1)for(;C<r.length-2&&!(S<r[C+1]);C++);const N=kp(r[C],r[C+1],S);return E[C](N)};return o?S=>x(zo(r[0],r[m-1],S)):x}function x_e(r,n){const o=r[r.length-1];for(let l=1;l<=n;l++){const u=kp(0,n,l);r.push(vr(o,1,u))}}function wG(r){const n=[0];return x_e(n,r.length-1),n}function b_e(r,n){return r.map(o=>o*n)}function w_e(r,n){return r.map(()=>n||dG).splice(0,r.length-1)}function og({duration:r=300,keyframes:n,times:o,ease:l="easeInOut"}){const u=Lge(l)?l.map(WB):WB(l),m={done:!1,value:n[0]},g=b_e(o&&o.length===n.length?o:wG(n),r),E=TI(g,n,{ease:Array.isArray(u)?u:w_e(n,u)});return{calculatedDuration:r,next:y=>(m.value=E(y),m.done=y>=r,m)}}const S_e=r=>r!==null;function NI(r,{repeat:n,repeatType:o="loop"},l,u=1){const m=r.filter(S_e),E=u<0||n&&o!=="loop"&&n%2===1?0:m.length-1;return!E||l===void 0?m[E]:l}const C_e={decay:UR,inertia:UR,tween:og,keyframes:og,spring:Nx};function SG(r){typeof r.type=="string"&&(r.type=C_e[r.type])}class RI{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(n=>{this.resolve=n})}notifyFinished(){this.resolve()}then(n,o){return this.finished.then(n,o)}}const T_e=r=>r/100;class AI extends RI{constructor(n){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var l,u;const{motionValue:o}=this.options;o&&o.updatedAt!==_i.now()&&this.tick(_i.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(u=(l=this.options).onStop)==null||u.call(l))},this.options=n,this.initAnimation(),this.play(),n.autoplay===!1&&this.pause()}initAnimation(){const{options:n}=this;SG(n);const{type:o=og,repeat:l=0,repeatDelay:u=0,repeatType:m,velocity:g=0}=n;let{keyframes:E}=n;const y=o||og;y!==og&&typeof E[0]!="number"&&(this.mixKeyframes=Jg(T_e,yG(E[0],E[1])),E=[0,100]);const x=y({...n,keyframes:E});m==="mirror"&&(this.mirroredGenerator=y({...n,keyframes:[...E].reverse(),velocity:-g})),x.calculatedDuration===null&&(x.calculatedDuration=CI(x));const{calculatedDuration:S}=x;this.calculatedDuration=S,this.resolvedDuration=S+u,this.totalDuration=this.resolvedDuration*(l+1)-u,this.generator=x}updateTime(n){const o=Math.round(n-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=o}tick(n,o=!1){const{generator:l,totalDuration:u,mixKeyframes:m,mirroredGenerator:g,resolvedDuration:E,calculatedDuration:y}=this;if(this.startTime===null)return l.next(0);const{delay:x=0,keyframes:S,repeat:C,repeatType:N,repeatDelay:M,type:G,onUpdate:I,finalKeyframe:P}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,n):this.speed<0&&(this.startTime=Math.min(n-u/this.speed,this.startTime)),o?this.currentTime=n:this.updateTime(n);const L=this.currentTime-x*(this.playbackSpeed>=0?1:-1),R=this.playbackSpeed>=0?L<0:L>u;this.currentTime=Math.max(L,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let D=this.currentTime,V=l;if(C){const J=Math.min(this.currentTime,u)/E;let ee=Math.floor(J),ne=J%1;!ne&&J>=1&&(ne=1),ne===1&&ee--,ee=Math.min(ee,C+1),!!(ee%2)&&(N==="reverse"?(ne=1-ne,M&&(ne-=M/E)):N==="mirror"&&(V=g)),D=zo(0,1,ne)*E}const W=R?{done:!1,value:S[0]}:V.next(D);m&&(W.value=m(W.value));let{done:q}=W;!R&&y!==null&&(q=this.playbackSpeed>=0?this.currentTime>=u:this.currentTime<=0);const H=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&q);return H&&G!==UR&&(W.value=NI(S,this.options,P,this.speed)),I&&I(W.value),H&&this.finish(),W}then(n,o){return this.finished.then(n,o)}get duration(){return xa(this.calculatedDuration)}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+xa(n)}get time(){return xa(this.currentTime)}set time(n){var o;n=Go(n),this.currentTime=n,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=n:this.driver&&(this.startTime=this.driver.now()-n/this.playbackSpeed),(o=this.driver)==null||o.start(!1)}get speed(){return this.playbackSpeed}set speed(n){this.updateTime(_i.now());const o=this.playbackSpeed!==n;this.playbackSpeed=n,o&&(this.time=xa(this.currentTime))}play(){var u,m;if(this.isStopped)return;const{driver:n=u_e,startTime:o}=this.options;this.driver||(this.driver=n(g=>this.tick(g))),(m=(u=this.options).onPlay)==null||m.call(u);const l=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=l):this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime||(this.startTime=o??l),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(_i.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var n,o;this.notifyFinished(),this.teardown(),this.state="finished",(o=(n=this.options).onComplete)==null||o.call(n)}cancel(){var n,o;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(o=(n=this.options).onCancel)==null||o.call(n)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(n){return this.startTime=0,this.tick(n,!0)}attachTimeline(n){var o;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(o=this.driver)==null||o.stop(),n.observe(this)}}function N_e(r){for(let n=1;n<r.length;n++)r[n]??(r[n]=r[n-1])}const Yd=r=>r*180/Math.PI,VR=r=>{const n=Yd(Math.atan2(r[1],r[0]));return BR(n)},R_e={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:VR,rotateZ:VR,skewX:r=>Yd(Math.atan(r[1])),skewY:r=>Yd(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},BR=r=>(r=r%360,r<0&&(r+=360),r),YB=VR,$B=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),XB=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),A_e={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:$B,scaleY:XB,scale:r=>($B(r)+XB(r))/2,rotateX:r=>BR(Yd(Math.atan2(r[6],r[5]))),rotateY:r=>BR(Yd(Math.atan2(-r[2],r[0]))),rotateZ:YB,rotate:YB,skewX:r=>Yd(Math.atan(r[4])),skewY:r=>Yd(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function WR(r){return r.includes("scale")?1:0}function GR(r,n){if(!r||r==="none")return WR(n);const o=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,u;if(o)l=A_e,u=o;else{const E=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=R_e,u=E}if(!u)return WR(n);const m=l[n],g=u[1].split(",").map(D_e);return typeof m=="function"?m(g):g[m]}const I_e=(r,n)=>{const{transform:o="none"}=getComputedStyle(r);return GR(o,n)};function D_e(r){return parseFloat(r.trim())}const Yp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],$p=new Set(Yp),JB=r=>r===qp||r===Bt,O_e=new Set(["x","y","z"]),j_e=Yp.filter(r=>!O_e.has(r));function P_e(r){const n=[];return j_e.forEach(o=>{const l=r.getValue(o);l!==void 0&&(n.push([o,l.get()]),l.set(o.startsWith("scale")?1:0))}),n}const tu={width:({x:r},{paddingLeft:n="0",paddingRight:o="0"})=>r.max-r.min-parseFloat(n)-parseFloat(o),height:({y:r},{paddingTop:n="0",paddingBottom:o="0"})=>r.max-r.min-parseFloat(n)-parseFloat(o),top:(r,{top:n})=>parseFloat(n),left:(r,{left:n})=>parseFloat(n),bottom:({y:r},{top:n})=>parseFloat(n)+(r.max-r.min),right:({x:r},{left:n})=>parseFloat(n)+(r.max-r.min),x:(r,{transform:n})=>GR(n,"x"),y:(r,{transform:n})=>GR(n,"y")};tu.translateX=tu.x;tu.translateY=tu.y;const su=new Set;let HR=!1,zR=!1,KR=!1;function CG(){if(zR){const r=Array.from(su).filter(l=>l.needsMeasurement),n=new Set(r.map(l=>l.element)),o=new Map;n.forEach(l=>{const u=P_e(l);u.length&&(o.set(l,u),l.render())}),r.forEach(l=>l.measureInitialState()),n.forEach(l=>{l.render();const u=o.get(l);u&&u.forEach(([m,g])=>{var E;(E=l.getValue(m))==null||E.set(g)})}),r.forEach(l=>l.measureEndState()),r.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}zR=!1,HR=!1,su.forEach(r=>r.complete(KR)),su.clear()}function TG(){su.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(zR=!0)})}function k_e(){KR=!0,TG(),CG(),KR=!1}class II{constructor(n,o,l,u,m,g=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...n],this.onComplete=o,this.name=l,this.motionValue=u,this.element=m,this.isAsync=g}scheduleResolve(){this.state="scheduled",this.isAsync?(su.add(this),HR||(HR=!0,Ws.read(TG),Ws.resolveKeyframes(CG))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:n,name:o,element:l,motionValue:u}=this;if(n[0]===null){const m=u==null?void 0:u.get(),g=n[n.length-1];if(m!==void 0)n[0]=m;else if(l&&o){const E=l.readValue(o,g);E!=null&&(n[0]=E)}n[0]===void 0&&(n[0]=g),u&&m===void 0&&u.set(n[0])}N_e(n)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(n=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,n),su.delete(this)}cancel(){this.state==="scheduled"&&(su.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const L_e=r=>r.startsWith("--");function M_e(r,n,o){L_e(n)?r.style.setProperty(n,o):r.style[n]=o}const NG=fI(()=>window.ScrollTimeline!==void 0),F_e={};function U_e(r,n){const o=fI(r);return()=>F_e[n]??o()}const RG=U_e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),qf=([r,n,o,l])=>`cubic-bezier(${r}, ${n}, ${o}, ${l})`,QB={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:qf([0,.65,.55,1]),circOut:qf([.55,0,1,.45]),backIn:qf([.31,.01,.66,-.59]),backOut:qf([.33,1.53,.69,.99])};function AG(r,n){if(r)return typeof r=="function"?RG()?xG(r,n):"ease-out":uG(r)?qf(r):Array.isArray(r)?r.map(o=>AG(o,n)||QB.easeOut):QB[r]}function V_e(r,n,o,{delay:l=0,duration:u=300,repeat:m=0,repeatType:g="loop",ease:E="easeOut",times:y}={},x=void 0){const S={[n]:o};y&&(S.offset=y);const C=AG(E,u);Array.isArray(C)&&(S.easing=C);const N={delay:l,duration:u,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:m+1,direction:g==="reverse"?"alternate":"normal"};return x&&(N.pseudoElement=x),r.animate(S,N)}function IG(r){return typeof r=="function"&&"applyToOptions"in r}function B_e({type:r,...n}){return IG(r)&&RG()?r.applyToOptions(n):(n.duration??(n.duration=300),n.ease??(n.ease="easeOut"),n)}class W_e extends RI{constructor(n){if(super(),this.finishedTime=null,this.isStopped=!1,!n)return;const{element:o,name:l,keyframes:u,pseudoElement:m,allowFlatten:g=!1,finalKeyframe:E,onComplete:y}=n;this.isPseudoElement=!!m,this.allowFlatten=g,this.options=n,Pg(typeof n.type!="string");const x=B_e(n);this.animation=V_e(o,l,u,x,m),x.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!m){const S=NI(u,this.options,E,this.speed);this.updateMotionValue?this.updateMotionValue(S):M_e(o,l,S),this.animation.cancel()}y==null||y(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var n,o;(o=(n=this.animation).finish)==null||o.call(n)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:n}=this;n==="idle"||n==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,o;this.isPseudoElement||(o=(n=this.animation).commitStyles)==null||o.call(n)}get duration(){var o,l;const n=((l=(o=this.animation.effect)==null?void 0:o.getComputedTiming)==null?void 0:l.call(o).duration)||0;return xa(Number(n))}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+xa(n)}get time(){return xa(Number(this.animation.currentTime)||0)}set time(n){this.finishedTime=null,this.animation.currentTime=Go(n)}get speed(){return this.animation.playbackRate}set speed(n){n<0&&(this.finishedTime=null),this.animation.playbackRate=n}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(n){this.animation.startTime=n}attachTimeline({timeline:n,observe:o}){var l;return this.allowFlatten&&((l=this.animation.effect)==null||l.updateTiming({easing:"linear"})),this.animation.onfinish=null,n&&NG()?(this.animation.timeline=n,xi):o(this)}}const DG={anticipate:oG,backInOut:aG,circInOut:lG};function G_e(r){return r in DG}function H_e(r){typeof r.ease=="string"&&G_e(r.ease)&&(r.ease=DG[r.ease])}const ZB=10;class z_e extends W_e{constructor(n){H_e(n),SG(n),super(n),n.startTime&&(this.startTime=n.startTime),this.options=n}updateMotionValue(n){const{motionValue:o,onUpdate:l,onComplete:u,element:m,...g}=this.options;if(!o)return;if(n!==void 0){o.set(n);return}const E=new AI({...g,autoplay:!1}),y=Go(this.finishedTime??this.time);o.setWithVelocity(E.sample(y-ZB).value,E.sample(y).value,ZB),E.stop()}}const e6=(r,n)=>n==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(Ul.test(r)||r==="0")&&!r.startsWith("url("));function K_e(r){const n=r[0];if(r.length===1)return!0;for(let o=0;o<r.length;o++)if(r[o]!==n)return!0}function q_e(r,n,o,l){const u=r[0];if(u===null)return!1;if(n==="display"||n==="visibility")return!0;const m=r[r.length-1],g=e6(u,n),E=e6(m,n);return!g||!E?!1:K_e(r)||(o==="spring"||IG(o))&&l}function qR(r){r.duration=0,r.type="keyframes"}const Y_e=new Set(["opacity","clipPath","filter","transform"]),$_e=fI(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function X_e(r){var S;const{motionValue:n,name:o,repeatDelay:l,repeatType:u,damping:m,type:g}=r;if(!(((S=n==null?void 0:n.owner)==null?void 0:S.current)instanceof HTMLElement))return!1;const{onUpdate:y,transformTemplate:x}=n.owner.getProps();return $_e()&&o&&Y_e.has(o)&&(o!=="transform"||!x)&&!y&&!l&&u!=="mirror"&&m!==0&&g!=="inertia"}const J_e=40;class Q_e extends RI{constructor({autoplay:n=!0,delay:o=0,type:l="keyframes",repeat:u=0,repeatDelay:m=0,repeatType:g="loop",keyframes:E,name:y,motionValue:x,element:S,...C}){var G;super(),this.stop=()=>{var I,P;this._animation&&(this._animation.stop(),(I=this.stopTimeline)==null||I.call(this)),(P=this.keyframeResolver)==null||P.cancel()},this.createdAt=_i.now();const N={autoplay:n,delay:o,type:l,repeat:u,repeatDelay:m,repeatType:g,name:y,motionValue:x,element:S,...C},M=(S==null?void 0:S.KeyframeResolver)||II;this.keyframeResolver=new M(E,(I,P,L)=>this.onKeyframesResolved(I,P,N,!L),y,x,S),(G=this.keyframeResolver)==null||G.scheduleResolve()}onKeyframesResolved(n,o,l,u){this.keyframeResolver=void 0;const{name:m,type:g,velocity:E,delay:y,isHandoff:x,onUpdate:S}=l;this.resolvedAt=_i.now(),q_e(n,m,g,E)||((Sc.instantAnimations||!y)&&(S==null||S(NI(n,l,o))),n[0]=n[n.length-1],qR(l),l.repeat=0);const N={startTime:u?this.resolvedAt?this.resolvedAt-this.createdAt>J_e?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:o,...l,keyframes:n},M=!x&&X_e(N)?new z_e({...N,element:N.motionValue.owner.current}):new AI(N);M.finished.then(()=>this.notifyFinished()).catch(xi),this.pendingTimeline&&(this.stopTimeline=M.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=M}get finished(){return this._animation?this.animation.finished:this._finished}then(n,o){return this.finished.finally(n).then(()=>{})}get animation(){var n;return this._animation||((n=this.keyframeResolver)==null||n.resume(),k_e()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(n){this.animation.time=n}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(n){this.animation.speed=n}get startTime(){return this.animation.startTime}attachTimeline(n){return this._animation?this.stopTimeline=this.animation.attachTimeline(n):this.pendingTimeline=n,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var n;this._animation&&this.animation.cancel(),(n=this.keyframeResolver)==null||n.cancel()}}const Z_e=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function eve(r){const n=Z_e.exec(r);if(!n)return[,];const[,o,l,u]=n;return[`--${o??l}`,u]}function OG(r,n,o=1){const[l,u]=eve(r);if(!l)return;const m=window.getComputedStyle(n).getPropertyValue(l);if(m){const g=m.trim();return ZW(g)?parseFloat(g):g}return xI(u)?OG(u,n,o+1):u}function DI(r,n){return(r==null?void 0:r[n])??(r==null?void 0:r.default)??r}const jG=new Set(["width","height","top","left","right","bottom",...Yp]),tve={test:r=>r==="auto",parse:r=>r},PG=r=>n=>n.test(r),kG=[qp,Bt,Ho,hl,$ge,Yge,tve],t6=r=>kG.find(PG(r));function sve(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||tG(r):!0}const rve=new Set(["brightness","contrast","saturate","opacity"]);function nve(r){const[n,o]=r.slice(0,-1).split("(");if(n==="drop-shadow")return r;const[l]=o.match(bI)||[];if(!l)return r;const u=o.replace(l,"");let m=rve.has(n)?1:0;return l!==o&&(m*=100),n+"("+m+u+")"}const ive=/\b([a-z-]*)\(.*?\)/gu,YR={...Ul,getAnimatableNone:r=>{const n=r.match(ive);return n?n.map(nve).join(" "):r}},s6={...qp,transform:Math.round},ave={rotate:hl,rotateX:hl,rotateY:hl,rotateZ:hl,scale:Sy,scaleX:Sy,scaleY:Sy,scaleZ:Sy,skew:hl,skewX:hl,skewY:hl,distance:Bt,translateX:Bt,translateY:Bt,translateZ:Bt,x:Bt,y:Bt,z:Bt,perspective:Bt,transformPerspective:Bt,opacity:kg,originX:GB,originY:GB,originZ:Bt},OI={borderWidth:Bt,borderTopWidth:Bt,borderRightWidth:Bt,borderBottomWidth:Bt,borderLeftWidth:Bt,borderRadius:Bt,radius:Bt,borderTopLeftRadius:Bt,borderTopRightRadius:Bt,borderBottomRightRadius:Bt,borderBottomLeftRadius:Bt,width:Bt,maxWidth:Bt,height:Bt,maxHeight:Bt,top:Bt,right:Bt,bottom:Bt,left:Bt,padding:Bt,paddingTop:Bt,paddingRight:Bt,paddingBottom:Bt,paddingLeft:Bt,margin:Bt,marginTop:Bt,marginRight:Bt,marginBottom:Bt,marginLeft:Bt,backgroundPositionX:Bt,backgroundPositionY:Bt,...ave,zIndex:s6,fillOpacity:kg,strokeOpacity:kg,numOctaves:s6},ove={...OI,color:Gr,backgroundColor:Gr,outlineColor:Gr,fill:Gr,stroke:Gr,borderColor:Gr,borderTopColor:Gr,borderRightColor:Gr,borderBottomColor:Gr,borderLeftColor:Gr,filter:YR,WebkitFilter:YR},LG=r=>ove[r];function MG(r,n){let o=LG(r);return o!==YR&&(o=Ul),o.getAnimatableNone?o.getAnimatableNone(n):void 0}const cve=new Set(["auto","none","0"]);function lve(r,n,o){let l=0,u;for(;l<r.length&&!u;){const m=r[l];typeof m=="string"&&!cve.has(m)&&Lg(m).values.length&&(u=r[l]),l++}if(u&&o)for(const m of n)r[m]=MG(o,u)}class dve extends II{constructor(n,o,l,u,m){super(n,o,l,u,m,!0)}readKeyframes(){const{unresolvedKeyframes:n,element:o,name:l}=this;if(!o||!o.current)return;super.readKeyframes();for(let y=0;y<n.length;y++){let x=n[y];if(typeof x=="string"&&(x=x.trim(),xI(x))){const S=OG(x,o.current);S!==void 0&&(n[y]=S),y===n.length-1&&(this.finalKeyframe=x)}}if(this.resolveNoneKeyframes(),!jG.has(l)||n.length!==2)return;const[u,m]=n,g=t6(u),E=t6(m);if(g!==E)if(JB(g)&&JB(E))for(let y=0;y<n.length;y++){const x=n[y];typeof x=="string"&&(n[y]=parseFloat(x))}else tu[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:n,name:o}=this,l=[];for(let u=0;u<n.length;u++)(n[u]===null||sve(n[u]))&&l.push(u);l.length&&lve(n,l,o)}measureInitialState(){const{element:n,unresolvedKeyframes:o,name:l}=this;if(!n||!n.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=tu[l](n.measureViewportBox(),window.getComputedStyle(n.current)),o[0]=this.measuredOrigin;const u=o[o.length-1];u!==void 0&&n.getValue(l,u).jump(u,!1)}measureEndState(){var E;const{element:n,name:o,unresolvedKeyframes:l}=this;if(!n||!n.current)return;const u=n.getValue(o);u&&u.jump(this.measuredOrigin,!1);const m=l.length-1,g=l[m];l[m]=tu[o](n.measureViewportBox(),window.getComputedStyle(n.current)),g!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=g),(E=this.removedTransforms)!=null&&E.length&&this.removedTransforms.forEach(([y,x])=>{n.getValue(y).set(x)}),this.resolveNoneKeyframes()}}function FG(r,n,o){if(r instanceof EventTarget)return[r];if(typeof r=="string"){const u=document.querySelectorAll(r);return u?Array.from(u):[]}return Array.from(r)}const UG=(r,n)=>n&&typeof r=="number"?n.transform(r):r;function jI(r){return eG(r)&&"offsetHeight"in r}const r6=30,uve=r=>!isNaN(parseFloat(r)),cg={current:void 0};class hve{constructor(n,o={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{var m;const u=_i.now();if(this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&((m=this.events.change)==null||m.notify(this.current),this.dependents))for(const g of this.dependents)g.dirty()},this.hasAnimated=!1,this.setCurrent(n),this.owner=o.owner}setCurrent(n){this.current=n,this.updatedAt=_i.now(),this.canTrackVelocity===null&&n!==void 0&&(this.canTrackVelocity=uve(this.current))}setPrevFrameValue(n=this.current){this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt}onChange(n){return this.on("change",n)}on(n,o){this.events[n]||(this.events[n]=new gI);const l=this.events[n].add(o);return n==="change"?()=>{l(),Ws.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const n in this.events)this.events[n].clear()}attach(n,o){this.passiveEffect=n,this.stopPassiveEffect=o}set(n){this.passiveEffect?this.passiveEffect(n,this.updateAndNotify):this.updateAndNotify(n)}setWithVelocity(n,o,l){this.set(o),this.prev=void 0,this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt-l}jump(n,o=!0){this.updateAndNotify(n),this.prev=n,this.prevUpdatedAt=this.prevFrameValue=void 0,o&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var n;(n=this.events.change)==null||n.notify(this.current)}addDependent(n){this.dependents||(this.dependents=new Set),this.dependents.add(n)}removeDependent(n){this.dependents&&this.dependents.delete(n)}get(){return cg.current&&cg.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const n=_i.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||n-this.updatedAt>r6)return 0;const o=Math.min(this.updatedAt-this.prevUpdatedAt,r6);return _I(parseFloat(this.current)-parseFloat(this.prevFrameValue),o)}start(n){return this.stop(),new Promise(o=>{this.hasAnimated=!0,this.animation=n(o),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var n,o;(n=this.dependents)==null||n.clear(),(o=this.events.destroy)==null||o.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function no(r,n){return new hve(r,n)}const{schedule:PI}=hG(queueMicrotask,!1),Xa={x:!1,y:!1};function VG(){return Xa.x||Xa.y}function pve(r){return r==="x"||r==="y"?Xa[r]?null:(Xa[r]=!0,()=>{Xa[r]=!1}):Xa.x||Xa.y?null:(Xa.x=Xa.y=!0,()=>{Xa.x=Xa.y=!1})}function BG(r,n){const o=FG(r),l=new AbortController,u={passive:!0,...n,signal:l.signal};return[o,u,()=>l.abort()]}function n6(r){return!(r.pointerType==="touch"||VG())}function mve(r,n,o={}){const[l,u,m]=BG(r,o),g=E=>{if(!n6(E))return;const{target:y}=E,x=n(y,E);if(typeof x!="function"||!y)return;const S=C=>{n6(C)&&(x(C),y.removeEventListener("pointerleave",S))};y.addEventListener("pointerleave",S,u)};return l.forEach(E=>{E.addEventListener("pointerenter",g,u)}),m}const WG=(r,n)=>n?r===n?!0:WG(r,n.parentElement):!1,kI=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,fve=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function gve(r){return fve.has(r.tagName)||r.tabIndex!==-1}const Hy=new WeakSet;function i6(r){return n=>{n.key==="Enter"&&r(n)}}function pN(r,n){r.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}const _ve=(r,n)=>{const o=r.currentTarget;if(!o)return;const l=i6(()=>{if(Hy.has(o))return;pN(o,"down");const u=i6(()=>{pN(o,"up")}),m=()=>pN(o,"cancel");o.addEventListener("keyup",u,n),o.addEventListener("blur",m,n)});o.addEventListener("keydown",l,n),o.addEventListener("blur",()=>o.removeEventListener("keydown",l),n)};function a6(r){return kI(r)&&!VG()}function vve(r,n,o={}){const[l,u,m]=BG(r,o),g=E=>{const y=E.currentTarget;if(!a6(E))return;Hy.add(y);const x=n(y,E),S=(M,G)=>{window.removeEventListener("pointerup",C),window.removeEventListener("pointercancel",N),Hy.has(y)&&Hy.delete(y),a6(M)&&typeof x=="function"&&x(M,{success:G})},C=M=>{S(M,y===window||y===document||o.useGlobalTarget||WG(y,M.target))},N=M=>{S(M,!1)};window.addEventListener("pointerup",C,u),window.addEventListener("pointercancel",N,u)};return l.forEach(E=>{(o.useGlobalTarget?window:E).addEventListener("pointerdown",g,u),jI(E)&&(E.addEventListener("focus",x=>_ve(x,u)),!gve(E)&&!E.hasAttribute("tabindex")&&(E.tabIndex=0))}),m}function LI(r){return eG(r)&&"ownerSVGElement"in r}const zy=new WeakMap;let pl;const GG=(r,n,o)=>(l,u)=>u&&u[0]?u[0][r+"Size"]:LI(l)&&"getBBox"in l?l.getBBox()[n]:l[o],Eve=GG("inline","width","offsetWidth"),yve=GG("block","height","offsetHeight");function xve({target:r,borderBoxSize:n}){var o;(o=zy.get(r))==null||o.forEach(l=>{l(r,{get width(){return Eve(r,n)},get height(){return yve(r,n)}})})}function bve(r){r.forEach(xve)}function wve(){typeof ResizeObserver>"u"||(pl=new ResizeObserver(bve))}function Sve(r,n){pl||wve();const o=FG(r);return o.forEach(l=>{let u=zy.get(l);u||(u=new Set,zy.set(l,u)),u.add(n),pl==null||pl.observe(l)}),()=>{o.forEach(l=>{const u=zy.get(l);u==null||u.delete(n),u!=null&&u.size||pl==null||pl.unobserve(l)})}}const Ky=new Set;let rp;function Cve(){rp=()=>{const r={get width(){return window.innerWidth},get height(){return window.innerHeight}};Ky.forEach(n=>n(r))},window.addEventListener("resize",rp)}function Tve(r){return Ky.add(r),rp||Cve(),()=>{Ky.delete(r),!Ky.size&&typeof rp=="function"&&(window.removeEventListener("resize",rp),rp=void 0)}}function Nve(r,n){return typeof r=="function"?Tve(r):Sve(r,n)}function HG(r,n){let o;const l=()=>{const{currentTime:u}=n,g=(u===null?0:u.value)/100;o!==g&&r(g),o=g};return Ws.preUpdate(l,!0),()=>co(l)}function Rve(r){return LI(r)&&r.tagName==="svg"}function Ave(...r){const n=!Array.isArray(r[0]),o=n?0:-1,l=r[0+o],u=r[1+o],m=r[2+o],g=r[3+o],E=TI(u,m,g);return n?E(l):E}const jn=r=>!!(r&&r.getVelocity),Ive=[...kG,Gr,Ul],Dve=r=>Ive.find(PG(r)),lb=O.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function o6(r,n){if(typeof r=="function")return r(n);r!=null&&(r.current=n)}function Ove(...r){return n=>{let o=!1;const l=r.map(u=>{const m=o6(u,n);return!o&&typeof m=="function"&&(o=!0),m});if(o)return()=>{for(let u=0;u<l.length;u++){const m=l[u];typeof m=="function"?m():o6(r[u],null)}}}}function jve(...r){return O.useCallback(Ove(...r),r)}class Pve extends O.Component{getSnapshotBeforeUpdate(n){const o=this.props.childRef.current;if(o&&n.isPresent&&!this.props.isPresent){const l=o.offsetParent,u=jI(l)&&l.offsetWidth||0,m=this.props.sizeRef.current;m.height=o.offsetHeight||0,m.width=o.offsetWidth||0,m.top=o.offsetTop,m.left=o.offsetLeft,m.right=u-m.width-m.left}return null}componentDidUpdate(){}render(){return this.props.children}}function kve({children:r,isPresent:n,anchorX:o,root:l}){const u=O.useId(),m=O.useRef(null),g=O.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:E}=O.useContext(lb),y=jve(m,r==null?void 0:r.ref);return O.useInsertionEffect(()=>{const{width:x,height:S,top:C,left:N,right:M}=g.current;if(n||!m.current||!x||!S)return;const G=o==="left"?`left: ${N}`:`right: ${M}`;m.current.dataset.motionPopId=u;const I=document.createElement("style");E&&(I.nonce=E);const P=l??document.head;return P.appendChild(I),I.sheet&&I.sheet.insertRule(`
          [data-motion-pop-id="${u}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${S}px !important;
            ${G}px !important;
            top: ${C}px !important;
          }
        `),()=>{P.contains(I)&&P.removeChild(I)}},[n]),i.jsx(Pve,{isPresent:n,childRef:m,sizeRef:g,children:O.cloneElement(r,{ref:y})})}const Lve=({children:r,initial:n,isPresent:o,onExitComplete:l,custom:u,presenceAffectsLayout:m,mode:g,anchorX:E,root:y})=>{const x=Kp(Mve),S=O.useId();let C=!0,N=O.useMemo(()=>(C=!1,{id:S,initial:n,isPresent:o,custom:u,onExitComplete:M=>{x.set(M,!0);for(const G of x.values())if(!G)return;l&&l()},register:M=>(x.set(M,!1),()=>x.delete(M))}),[o,x,l]);return m&&C&&(N={...N}),O.useMemo(()=>{x.forEach((M,G)=>x.set(G,!1))},[o]),O.useEffect(()=>{!o&&!x.size&&l&&l()},[o]),g==="popLayout"&&(r=i.jsx(kve,{isPresent:o,anchorX:E,root:y,children:r})),i.jsx(cb.Provider,{value:N,children:r})};function Mve(){return new Map}function zG(r=!0){const n=O.useContext(cb);if(n===null)return[!0,null];const{isPresent:o,onExitComplete:l,register:u}=n,m=O.useId();O.useEffect(()=>{if(r)return u(m)},[r]);const g=O.useCallback(()=>r&&l&&l(m),[m,l,r]);return!o&&l?[!1,g]:[!0]}const Cy=r=>r.key||"";function c6(r){const n=[];return O.Children.forEach(r,o=>{O.isValidElement(o)&&n.push(o)}),n}const l6=({children:r,custom:n,initial:o=!0,onExitComplete:l,presenceAffectsLayout:u=!0,mode:m="sync",propagate:g=!1,anchorX:E="left",root:y})=>{const[x,S]=zG(g),C=O.useMemo(()=>c6(r),[r]),N=g&&!x?[]:C.map(Cy),M=O.useRef(!0),G=O.useRef(C),I=Kp(()=>new Map),[P,L]=O.useState(C),[R,D]=O.useState(C);ob(()=>{M.current=!1,G.current=C;for(let q=0;q<R.length;q++){const H=Cy(R[q]);N.includes(H)?I.delete(H):I.get(H)!==!0&&I.set(H,!1)}},[R,N.length,N.join("-")]);const V=[];if(C!==P){let q=[...C];for(let H=0;H<R.length;H++){const J=R[H],ee=Cy(J);N.includes(ee)||(q.splice(H,0,J),V.push(J))}return m==="wait"&&V.length&&(q=V),D(c6(q)),L(C),null}const{forceRender:W}=O.useContext(uI);return i.jsx(i.Fragment,{children:R.map(q=>{const H=Cy(q),J=g&&!x?!1:C===R||N.includes(H),ee=()=>{if(I.has(H))I.set(H,!0);else return;let ne=!0;I.forEach(pe=>{pe||(ne=!1)}),ne&&(W==null||W(),D(G.current),g&&(S==null||S()),l&&l())};return i.jsx(Lve,{isPresent:J,initial:!M.current||o?void 0:!1,custom:n,presenceAffectsLayout:u,mode:m,root:y,onExitComplete:J?void 0:ee,anchorX:E,children:q},H)})})},KG=O.createContext({strict:!1}),d6={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Lp={};for(const r in d6)Lp[r]={isEnabled:n=>d6[r].some(o=>!!n[o])};function Fve(r){for(const n in r)Lp[n]={...Lp[n],...r[n]}}const Uve=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Rx(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||Uve.has(r)}let qG=r=>!Rx(r);function Vve(r){typeof r=="function"&&(qG=n=>n.startsWith("on")?!Rx(n):r(n))}try{Vve(require("@emotion/is-prop-valid").default)}catch{}function Bve(r,n,o){const l={};for(const u in r)u==="values"&&typeof r.values=="object"||(qG(u)||o===!0&&Rx(u)||!n&&!Rx(u)||r.draggable&&u.startsWith("onDrag"))&&(l[u]=r[u]);return l}const db=O.createContext({});function ub(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function Mg(r){return typeof r=="string"||Array.isArray(r)}const MI=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],FI=["initial",...MI];function hb(r){return ub(r.animate)||FI.some(n=>Mg(r[n]))}function YG(r){return!!(hb(r)||r.variants)}function Wve(r,n){if(hb(r)){const{initial:o,animate:l}=r;return{initial:o===!1||Mg(o)?o:void 0,animate:Mg(l)?l:void 0}}return r.inherit!==!1?n:{}}function Gve(r){const{initial:n,animate:o}=Wve(r,O.useContext(db));return O.useMemo(()=>({initial:n,animate:o}),[u6(n),u6(o)])}function u6(r){return Array.isArray(r)?r.join(" "):r}const Fg={};function Hve(r){for(const n in r)Fg[n]=r[n],yI(n)&&(Fg[n].isCSSVariable=!0)}function $G(r,{layout:n,layoutId:o}){return $p.has(r)||r.startsWith("origin")||(n||o!==void 0)&&(!!Fg[r]||r==="opacity")}const zve={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Kve=Yp.length;function qve(r,n,o){let l="",u=!0;for(let m=0;m<Kve;m++){const g=Yp[m],E=r[g];if(E===void 0)continue;let y=!0;if(typeof E=="number"?y=E===(g.startsWith("scale")?1:0):y=parseFloat(E)===0,!y||o){const x=UG(E,OI[g]);if(!y){u=!1;const S=zve[g]||g;l+=`${S}(${x}) `}o&&(n[g]=x)}}return l=l.trim(),o?l=o(n,u?"":l):u&&(l="none"),l}function UI(r,n,o){const{style:l,vars:u,transformOrigin:m}=r;let g=!1,E=!1;for(const y in n){const x=n[y];if($p.has(y)){g=!0;continue}else if(yI(y)){u[y]=x;continue}else{const S=UG(x,OI[y]);y.startsWith("origin")?(E=!0,m[y]=S):l[y]=S}}if(n.transform||(g||o?l.transform=qve(n,r.transform,o):l.transform&&(l.transform="none")),E){const{originX:y="50%",originY:x="50%",originZ:S=0}=m;l.transformOrigin=`${y} ${x} ${S}`}}const VI=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function XG(r,n,o){for(const l in n)!jn(n[l])&&!$G(l,o)&&(r[l]=n[l])}function Yve({transformTemplate:r},n){return O.useMemo(()=>{const o=VI();return UI(o,n,r),Object.assign({},o.vars,o.style)},[n])}function $ve(r,n){const o=r.style||{},l={};return XG(l,o,r),Object.assign(l,Yve(r,n)),l}function Xve(r,n){const o={},l=$ve(r,n);return r.drag&&r.dragListener!==!1&&(o.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(o.tabIndex=0),o.style=l,o}const Jve={offset:"stroke-dashoffset",array:"stroke-dasharray"},Qve={offset:"strokeDashoffset",array:"strokeDasharray"};function Zve(r,n,o=1,l=0,u=!0){r.pathLength=1;const m=u?Jve:Qve;r[m.offset]=Bt.transform(-l);const g=Bt.transform(n),E=Bt.transform(o);r[m.array]=`${g} ${E}`}function JG(r,{attrX:n,attrY:o,attrScale:l,pathLength:u,pathSpacing:m=1,pathOffset:g=0,...E},y,x,S){if(UI(r,E,x),y){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:C,style:N}=r;C.transform&&(N.transform=C.transform,delete C.transform),(N.transform||C.transformOrigin)&&(N.transformOrigin=C.transformOrigin??"50% 50%",delete C.transformOrigin),N.transform&&(N.transformBox=(S==null?void 0:S.transformBox)??"fill-box",delete C.transformBox),n!==void 0&&(C.x=n),o!==void 0&&(C.y=o),l!==void 0&&(C.scale=l),u!==void 0&&Zve(C,u,m,g,!1)}const QG=()=>({...VI(),attrs:{}}),ZG=r=>typeof r=="string"&&r.toLowerCase()==="svg";function eEe(r,n,o,l){const u=O.useMemo(()=>{const m=QG();return JG(m,n,ZG(l),r.transformTemplate,r.style),{...m.attrs,style:{...m.style}}},[n]);if(r.style){const m={};XG(m,r.style,r),u.style={...m,...u.style}}return u}const tEe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function BI(r){return typeof r!="string"||r.includes("-")?!1:!!(tEe.indexOf(r)>-1||/[A-Z]/u.test(r))}function sEe(r,n,o,{latestValues:l},u,m=!1){const E=(BI(r)?eEe:Xve)(n,l,u,r),y=Bve(n,typeof r=="string",m),x=r!==O.Fragment?{...y,...E,ref:o}:{},{children:S}=n,C=O.useMemo(()=>jn(S)?S.get():S,[S]);return O.createElement(r,{...x,children:C})}function h6(r){const n=[{},{}];return r==null||r.values.forEach((o,l)=>{n[0][l]=o.get(),n[1][l]=o.getVelocity()}),n}function WI(r,n,o,l){if(typeof n=="function"){const[u,m]=h6(l);n=n(o!==void 0?o:r.custom,u,m)}if(typeof n=="string"&&(n=r.variants&&r.variants[n]),typeof n=="function"){const[u,m]=h6(l);n=n(o!==void 0?o:r.custom,u,m)}return n}function qy(r){return jn(r)?r.get():r}function rEe({scrapeMotionValuesFromProps:r,createRenderState:n},o,l,u){return{latestValues:nEe(o,l,u,r),renderState:n()}}function nEe(r,n,o,l){const u={},m=l(r,{});for(const N in m)u[N]=qy(m[N]);let{initial:g,animate:E}=r;const y=hb(r),x=YG(r);n&&x&&!y&&r.inherit!==!1&&(g===void 0&&(g=n.initial),E===void 0&&(E=n.animate));let S=o?o.initial===!1:!1;S=S||g===!1;const C=S?E:g;if(C&&typeof C!="boolean"&&!ub(C)){const N=Array.isArray(C)?C:[C];for(let M=0;M<N.length;M++){const G=WI(r,N[M]);if(G){const{transitionEnd:I,transition:P,...L}=G;for(const R in L){let D=L[R];if(Array.isArray(D)){const V=S?D.length-1:0;D=D[V]}D!==null&&(u[R]=D)}for(const R in I)u[R]=I[R]}}}return u}const eH=r=>(n,o)=>{const l=O.useContext(db),u=O.useContext(cb),m=()=>rEe(r,n,l,u);return o?m():Kp(m)};function GI(r,n,o){var m;const{style:l}=r,u={};for(const g in l)(jn(l[g])||n.style&&jn(n.style[g])||$G(g,r)||((m=o==null?void 0:o.getValue(g))==null?void 0:m.liveStyle)!==void 0)&&(u[g]=l[g]);return u}const iEe=eH({scrapeMotionValuesFromProps:GI,createRenderState:VI});function tH(r,n,o){const l=GI(r,n,o);for(const u in r)if(jn(r[u])||jn(n[u])){const m=Yp.indexOf(u)!==-1?"attr"+u.charAt(0).toUpperCase()+u.substring(1):u;l[m]=r[u]}return l}const aEe=eH({scrapeMotionValuesFromProps:tH,createRenderState:QG}),oEe=Symbol.for("motionComponentSymbol");function np(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function cEe(r,n,o){return O.useCallback(l=>{l&&r.onMount&&r.onMount(l),n&&(l?n.mount(l):n.unmount()),o&&(typeof o=="function"?o(l):np(o)&&(o.current=l))},[n])}const HI=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),lEe="framerAppearId",sH="data-"+HI(lEe),rH=O.createContext({});function dEe(r,n,o,l,u){var I,P;const{visualElement:m}=O.useContext(db),g=O.useContext(KG),E=O.useContext(cb),y=O.useContext(lb).reducedMotion,x=O.useRef(null);l=l||g.renderer,!x.current&&l&&(x.current=l(r,{visualState:n,parent:m,props:o,presenceContext:E,blockInitialAnimation:E?E.initial===!1:!1,reducedMotionConfig:y}));const S=x.current,C=O.useContext(rH);S&&!S.projection&&u&&(S.type==="html"||S.type==="svg")&&uEe(x.current,o,u,C);const N=O.useRef(!1);O.useInsertionEffect(()=>{S&&N.current&&S.update(o,E)});const M=o[sH],G=O.useRef(!!M&&!((I=window.MotionHandoffIsComplete)!=null&&I.call(window,M))&&((P=window.MotionHasOptimisedAnimation)==null?void 0:P.call(window,M)));return ob(()=>{S&&(N.current=!0,window.MotionIsMounted=!0,S.updateFeatures(),S.scheduleRenderMicrotask(),G.current&&S.animationState&&S.animationState.animateChanges())}),O.useEffect(()=>{S&&(!G.current&&S.animationState&&S.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{var L;(L=window.MotionHandoffMarkAsComplete)==null||L.call(window,M)}),G.current=!1),S.enteringChildren=void 0)}),S}function uEe(r,n,o,l){const{layoutId:u,layout:m,drag:g,dragConstraints:E,layoutScroll:y,layoutRoot:x,layoutCrossfade:S}=n;r.projection=new o(r.latestValues,n["data-framer-portal-id"]?void 0:nH(r.parent)),r.projection.setOptions({layoutId:u,layout:m,alwaysMeasureLayout:!!g||E&&np(E),visualElement:r,animationType:typeof m=="string"?m:"both",initialPromotionConfig:l,crossfade:S,layoutScroll:y,layoutRoot:x})}function nH(r){if(r)return r.options.allowProjection!==!1?r.projection:nH(r.parent)}function mN(r,{forwardMotionProps:n=!1}={},o,l){o&&Fve(o);const u=BI(r)?aEe:iEe;function m(E,y){let x;const S={...O.useContext(lb),...E,layoutId:hEe(E)},{isStatic:C}=S,N=Gve(E),M=u(E,C);if(!C&&hI){pEe();const G=mEe(S);x=G.MeasureLayout,N.visualElement=dEe(r,M,S,l,G.ProjectionNode)}return i.jsxs(db.Provider,{value:N,children:[x&&N.visualElement?i.jsx(x,{visualElement:N.visualElement,...S}):null,sEe(r,E,cEe(M,N.visualElement,y),M,C,n)]})}m.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const g=O.forwardRef(m);return g[oEe]=r,g}function hEe({layoutId:r}){const n=O.useContext(uI).id;return n&&r!==void 0?n+"-"+r:r}function pEe(r,n){O.useContext(KG).strict}function mEe(r){const{drag:n,layout:o}=Lp;if(!n&&!o)return{};const l={...n,...o};return{MeasureLayout:n!=null&&n.isEnabled(r)||o!=null&&o.isEnabled(r)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function fEe(r,n){if(typeof Proxy>"u")return mN;const o=new Map,l=(m,g)=>mN(m,g,r,n),u=(m,g)=>l(m,g);return new Proxy(u,{get:(m,g)=>g==="create"?l:(o.has(g)||o.set(g,mN(g,void 0,r,n)),o.get(g))})}function iH({top:r,left:n,right:o,bottom:l}){return{x:{min:n,max:o},y:{min:r,max:l}}}function gEe({x:r,y:n}){return{top:n.min,right:r.max,bottom:n.max,left:r.min}}function _Ee(r,n){if(!n)return r;const o=n({x:r.left,y:r.top}),l=n({x:r.right,y:r.bottom});return{top:o.y,left:o.x,bottom:l.y,right:l.x}}function fN(r){return r===void 0||r===1}function $R({scale:r,scaleX:n,scaleY:o}){return!fN(r)||!fN(n)||!fN(o)}function Vd(r){return $R(r)||aH(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function aH(r){return p6(r.x)||p6(r.y)}function p6(r){return r&&r!=="0%"}function Ax(r,n,o){const l=r-o,u=n*l;return o+u}function m6(r,n,o,l,u){return u!==void 0&&(r=Ax(r,u,l)),Ax(r,o,l)+n}function XR(r,n=0,o=1,l,u){r.min=m6(r.min,n,o,l,u),r.max=m6(r.max,n,o,l,u)}function oH(r,{x:n,y:o}){XR(r.x,n.translate,n.scale,n.originPoint),XR(r.y,o.translate,o.scale,o.originPoint)}const f6=.999999999999,g6=1.0000000000001;function vEe(r,n,o,l=!1){const u=o.length;if(!u)return;n.x=n.y=1;let m,g;for(let E=0;E<u;E++){m=o[E],g=m.projectionDelta;const{visualElement:y}=m.options;y&&y.props.style&&y.props.style.display==="contents"||(l&&m.options.layoutScroll&&m.scroll&&m!==m.root&&ap(r,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),g&&(n.x*=g.x.scale,n.y*=g.y.scale,oH(r,g)),l&&Vd(m.latestValues)&&ap(r,m.latestValues))}n.x<g6&&n.x>f6&&(n.x=1),n.y<g6&&n.y>f6&&(n.y=1)}function ip(r,n){r.min=r.min+n,r.max=r.max+n}function _6(r,n,o,l,u=.5){const m=vr(r.min,r.max,u);XR(r,n,o,m,l)}function ap(r,n){_6(r.x,n.x,n.scaleX,n.scale,n.originX),_6(r.y,n.y,n.scaleY,n.scale,n.originY)}function cH(r,n){return iH(_Ee(r.getBoundingClientRect(),n))}function EEe(r,n,o){const l=cH(r,o),{scroll:u}=n;return u&&(ip(l.x,u.offset.x),ip(l.y,u.offset.y)),l}const v6=()=>({translate:0,scale:1,origin:0,originPoint:0}),op=()=>({x:v6(),y:v6()}),E6=()=>({min:0,max:0}),Mr=()=>({x:E6(),y:E6()}),JR={current:null},lH={current:!1};function yEe(){if(lH.current=!0,!!hI)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),n=()=>JR.current=r.matches;r.addEventListener("change",n),n()}else JR.current=!1}const xEe=new WeakMap;function bEe(r,n,o){for(const l in n){const u=n[l],m=o[l];if(jn(u))r.addValue(l,u);else if(jn(m))r.addValue(l,no(u,{owner:r}));else if(m!==u)if(r.hasValue(l)){const g=r.getValue(l);g.liveStyle===!0?g.jump(u):g.hasAnimated||g.set(u)}else{const g=r.getStaticValue(l);r.addValue(l,no(g!==void 0?g:u,{owner:r}))}}for(const l in o)n[l]===void 0&&r.removeValue(l);return n}const y6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class wEe{scrapeMotionValuesFromProps(n,o,l){return{}}constructor({parent:n,props:o,presenceContext:l,reducedMotionConfig:u,blockInitialAnimation:m,visualState:g},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=II,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const N=_i.now();this.renderScheduledAt<N&&(this.renderScheduledAt=N,Ws.render(this.render,!1,!0))};const{latestValues:y,renderState:x}=g;this.latestValues=y,this.baseTarget={...y},this.initialValues=o.initial?{...y}:{},this.renderState=x,this.parent=n,this.props=o,this.presenceContext=l,this.depth=n?n.depth+1:0,this.reducedMotionConfig=u,this.options=E,this.blockInitialAnimation=!!m,this.isControllingVariants=hb(o),this.isVariantNode=YG(o),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(n&&n.current);const{willChange:S,...C}=this.scrapeMotionValuesFromProps(o,{},this);for(const N in C){const M=C[N];y[N]!==void 0&&jn(M)&&M.set(y[N])}}mount(n){var o;this.current=n,xEe.set(n,this),this.projection&&!this.projection.instance&&this.projection.mount(n),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((l,u)=>this.bindToMotionValue(u,l)),lH.current||yEe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:JR.current,(o=this.parent)==null||o.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var n;this.projection&&this.projection.unmount(),co(this.notifyUpdate),co(this.render),this.valueSubscriptions.forEach(o=>o()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(n=this.parent)==null||n.removeChild(this);for(const o in this.events)this.events[o].clear();for(const o in this.features){const l=this.features[o];l&&(l.unmount(),l.isMounted=!1)}this.current=null}addChild(n){this.children.add(n),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(n)}removeChild(n){this.children.delete(n),this.enteringChildren&&this.enteringChildren.delete(n)}bindToMotionValue(n,o){this.valueSubscriptions.has(n)&&this.valueSubscriptions.get(n)();const l=$p.has(n);l&&this.onBindTransform&&this.onBindTransform();const u=o.on("change",g=>{this.latestValues[n]=g,this.props.onUpdate&&Ws.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let m;window.MotionCheckAppearSync&&(m=window.MotionCheckAppearSync(this,n,o)),this.valueSubscriptions.set(n,()=>{u(),m&&m(),o.owner&&o.stop()})}sortNodePosition(n){return!this.current||!this.sortInstanceNodePosition||this.type!==n.type?0:this.sortInstanceNodePosition(this.current,n.current)}updateFeatures(){let n="animation";for(n in Lp){const o=Lp[n];if(!o)continue;const{isEnabled:l,Feature:u}=o;if(!this.features[n]&&u&&l(this.props)&&(this.features[n]=new u(this)),this.features[n]){const m=this.features[n];m.isMounted?m.update():(m.mount(),m.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Mr()}getStaticValue(n){return this.latestValues[n]}setStaticValue(n,o){this.latestValues[n]=o}update(n,o){(n.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=n,this.prevPresenceContext=this.presenceContext,this.presenceContext=o;for(let l=0;l<y6.length;l++){const u=y6[l];this.propEventSubscriptions[u]&&(this.propEventSubscriptions[u](),delete this.propEventSubscriptions[u]);const m="on"+u,g=n[m];g&&(this.propEventSubscriptions[u]=this.on(u,g))}this.prevMotionValues=bEe(this,this.scrapeMotionValuesFromProps(n,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(n){return this.props.variants?this.props.variants[n]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(n){const o=this.getClosestVariantNode();if(o)return o.variantChildren&&o.variantChildren.add(n),()=>o.variantChildren.delete(n)}addValue(n,o){const l=this.values.get(n);o!==l&&(l&&this.removeValue(n),this.bindToMotionValue(n,o),this.values.set(n,o),this.latestValues[n]=o.get())}removeValue(n){this.values.delete(n);const o=this.valueSubscriptions.get(n);o&&(o(),this.valueSubscriptions.delete(n)),delete this.latestValues[n],this.removeValueFromRenderState(n,this.renderState)}hasValue(n){return this.values.has(n)}getValue(n,o){if(this.props.values&&this.props.values[n])return this.props.values[n];let l=this.values.get(n);return l===void 0&&o!==void 0&&(l=no(o===null?void 0:o,{owner:this}),this.addValue(n,l)),l}readValue(n,o){let l=this.latestValues[n]!==void 0||!this.current?this.latestValues[n]:this.getBaseTargetFromProps(this.props,n)??this.readValueFromInstance(this.current,n,this.options);return l!=null&&(typeof l=="string"&&(ZW(l)||tG(l))?l=parseFloat(l):!Dve(l)&&Ul.test(o)&&(l=MG(n,o)),this.setBaseTarget(n,jn(l)?l.get():l)),jn(l)?l.get():l}setBaseTarget(n,o){this.baseTarget[n]=o}getBaseTarget(n){var m;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const g=WI(this.props,o,(m=this.presenceContext)==null?void 0:m.custom);g&&(l=g[n])}if(o&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,n);return u!==void 0&&!jn(u)?u:this.initialValues[n]!==void 0&&l===void 0?void 0:this.baseTarget[n]}on(n,o){return this.events[n]||(this.events[n]=new gI),this.events[n].add(o)}notify(n,...o){this.events[n]&&this.events[n].notify(...o)}scheduleRenderMicrotask(){PI.render(this.render)}}class dH extends wEe{constructor(){super(...arguments),this.KeyframeResolver=dve}sortInstanceNodePosition(n,o){return n.compareDocumentPosition(o)&2?1:-1}getBaseTargetFromProps(n,o){return n.style?n.style[o]:void 0}removeValueFromRenderState(n,{vars:o,style:l}){delete o[n],delete l[n]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:n}=this.props;jn(n)&&(this.childSubscription=n.on("change",o=>{this.current&&(this.current.textContent=`${o}`)}))}}function uH(r,{style:n,vars:o},l,u){const m=r.style;let g;for(g in n)m[g]=n[g];u==null||u.applyProjectionStyles(m,l);for(g in o)m.setProperty(g,o[g])}function SEe(r){return window.getComputedStyle(r)}class CEe extends dH{constructor(){super(...arguments),this.type="html",this.renderInstance=uH}readValueFromInstance(n,o){var l;if($p.has(o))return(l=this.projection)!=null&&l.isProjecting?WR(o):I_e(n,o);{const u=SEe(n),m=(yI(o)?u.getPropertyValue(o):u[o])||0;return typeof m=="string"?m.trim():m}}measureInstanceViewportBox(n,{transformPagePoint:o}){return cH(n,o)}build(n,o,l){UI(n,o,l.transformTemplate)}scrapeMotionValuesFromProps(n,o,l){return GI(n,o,l)}}const hH=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function TEe(r,n,o,l){uH(r,n,void 0,l);for(const u in n.attrs)r.setAttribute(hH.has(u)?u:HI(u),n.attrs[u])}class NEe extends dH{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Mr}getBaseTargetFromProps(n,o){return n[o]}readValueFromInstance(n,o){if($p.has(o)){const l=LG(o);return l&&l.default||0}return o=hH.has(o)?o:HI(o),n.getAttribute(o)}scrapeMotionValuesFromProps(n,o,l){return tH(n,o,l)}build(n,o,l){JG(n,o,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(n,o,l,u){TEe(n,o,l,u)}mount(n){this.isSVGTag=ZG(n.tagName),super.mount(n)}}const REe=(r,n)=>BI(r)?new NEe(n):new CEe(n,{allowProjection:r!==O.Fragment});function fp(r,n,o){const l=r.getProps();return WI(l,n,o!==void 0?o:l.custom,r)}const QR=r=>Array.isArray(r);function AEe(r,n,o){r.hasValue(n)?r.getValue(n).set(o):r.addValue(n,no(o))}function IEe(r){return QR(r)?r[r.length-1]||0:r}function DEe(r,n){const o=fp(r,n);let{transitionEnd:l={},transition:u={},...m}=o||{};m={...m,...l};for(const g in m){const E=IEe(m[g]);AEe(r,g,E)}}function OEe(r){return!!(jn(r)&&r.add)}function ZR(r,n){const o=r.getValue("willChange");if(OEe(o))return o.add(n);if(!o&&Sc.WillChange){const l=new Sc.WillChange("auto");r.addValue("willChange",l),l.add(n)}}function pH(r){return r.props[sH]}const jEe=r=>r!==null;function PEe(r,{repeat:n,repeatType:o="loop"},l){const u=r.filter(jEe),m=n&&o!=="loop"&&n%2===1?0:u.length-1;return u[m]}const kEe={type:"spring",stiffness:500,damping:25,restSpeed:10},LEe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),MEe={type:"keyframes",duration:.8},FEe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},UEe=(r,{keyframes:n})=>n.length>2?MEe:$p.has(r)?r.startsWith("scale")?LEe(n[1]):kEe:FEe;function VEe({when:r,delay:n,delayChildren:o,staggerChildren:l,staggerDirection:u,repeat:m,repeatType:g,repeatDelay:E,from:y,elapsed:x,...S}){return!!Object.keys(S).length}const zI=(r,n,o,l={},u,m)=>g=>{const E=DI(l,r)||{},y=E.delay||l.delay||0;let{elapsed:x=0}=l;x=x-Go(y);const S={keyframes:Array.isArray(o)?o:[null,o],ease:"easeOut",velocity:n.getVelocity(),...E,delay:-x,onUpdate:N=>{n.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{g(),E.onComplete&&E.onComplete()},name:r,motionValue:n,element:m?void 0:u};VEe(E)||Object.assign(S,UEe(r,S)),S.duration&&(S.duration=Go(S.duration)),S.repeatDelay&&(S.repeatDelay=Go(S.repeatDelay)),S.from!==void 0&&(S.keyframes[0]=S.from);let C=!1;if((S.type===!1||S.duration===0&&!S.repeatDelay)&&(qR(S),S.delay===0&&(C=!0)),(Sc.instantAnimations||Sc.skipAnimations)&&(C=!0,qR(S),S.delay=0),S.allowFlatten=!E.type&&!E.ease,C&&!m&&n.get()!==void 0){const N=PEe(S.keyframes,E);if(N!==void 0){Ws.update(()=>{S.onUpdate(N),S.onComplete()});return}}return E.isSync?new AI(S):new Q_e(S)};function BEe({protectedKeys:r,needsAnimating:n},o){const l=r.hasOwnProperty(o)&&n[o]!==!0;return n[o]=!1,l}function mH(r,n,{delay:o=0,transitionOverride:l,type:u}={}){let{transition:m=r.getDefaultTransition(),transitionEnd:g,...E}=n;l&&(m=l);const y=[],x=u&&r.animationState&&r.animationState.getState()[u];for(const S in E){const C=r.getValue(S,r.latestValues[S]??null),N=E[S];if(N===void 0||x&&BEe(x,S))continue;const M={delay:o,...DI(m||{},S)},G=C.get();if(G!==void 0&&!C.isAnimating&&!Array.isArray(N)&&N===G&&!M.velocity)continue;let I=!1;if(window.MotionHandoffAnimation){const L=pH(r);if(L){const R=window.MotionHandoffAnimation(L,S,Ws);R!==null&&(M.startTime=R,I=!0)}}ZR(r,S),C.start(zI(S,C,N,r.shouldReduceMotion&&jG.has(S)?{type:!1}:M,r,I));const P=C.animation;P&&y.push(P)}return g&&Promise.all(y).then(()=>{Ws.update(()=>{g&&DEe(r,g)})}),y}function fH(r,n,o,l=0,u=1){const m=Array.from(r).sort((x,S)=>x.sortNodePosition(S)).indexOf(n),g=r.size,E=(g-1)*l;return typeof o=="function"?o(m,g):u===1?m*l:E-m*l}function eA(r,n,o={}){var y;const l=fp(r,n,o.type==="exit"?(y=r.presenceContext)==null?void 0:y.custom:void 0);let{transition:u=r.getDefaultTransition()||{}}=l||{};o.transitionOverride&&(u=o.transitionOverride);const m=l?()=>Promise.all(mH(r,l,o)):()=>Promise.resolve(),g=r.variantChildren&&r.variantChildren.size?(x=0)=>{const{delayChildren:S=0,staggerChildren:C,staggerDirection:N}=u;return WEe(r,n,x,S,C,N,o)}:()=>Promise.resolve(),{when:E}=u;if(E){const[x,S]=E==="beforeChildren"?[m,g]:[g,m];return x().then(()=>S())}else return Promise.all([m(),g(o.delay)])}function WEe(r,n,o=0,l=0,u=0,m=1,g){const E=[];for(const y of r.variantChildren)y.notify("AnimationStart",n),E.push(eA(y,n,{...g,delay:o+(typeof l=="function"?0:l)+fH(r.variantChildren,y,l,u,m)}).then(()=>y.notify("AnimationComplete",n)));return Promise.all(E)}function GEe(r,n,o={}){r.notify("AnimationStart",n);let l;if(Array.isArray(n)){const u=n.map(m=>eA(r,m,o));l=Promise.all(u)}else if(typeof n=="string")l=eA(r,n,o);else{const u=typeof n=="function"?fp(r,n,o.custom):n;l=Promise.all(mH(r,u,o))}return l.then(()=>{r.notify("AnimationComplete",n)})}function gH(r,n){if(!Array.isArray(n))return!1;const o=n.length;if(o!==r.length)return!1;for(let l=0;l<o;l++)if(n[l]!==r[l])return!1;return!0}const HEe=FI.length;function _H(r){if(!r)return;if(!r.isControllingVariants){const o=r.parent?_H(r.parent)||{}:{};return r.props.initial!==void 0&&(o.initial=r.props.initial),o}const n={};for(let o=0;o<HEe;o++){const l=FI[o],u=r.props[l];(Mg(u)||u===!1)&&(n[l]=u)}return n}const zEe=[...MI].reverse(),KEe=MI.length;function qEe(r){return n=>Promise.all(n.map(({animation:o,options:l})=>GEe(r,o,l)))}function YEe(r){let n=qEe(r),o=x6(),l=!0;const u=y=>(x,S)=>{var N;const C=fp(r,S,y==="exit"?(N=r.presenceContext)==null?void 0:N.custom:void 0);if(C){const{transition:M,transitionEnd:G,...I}=C;x={...x,...I,...G}}return x};function m(y){n=y(r)}function g(y){const{props:x}=r,S=_H(r.parent)||{},C=[],N=new Set;let M={},G=1/0;for(let P=0;P<KEe;P++){const L=zEe[P],R=o[L],D=x[L]!==void 0?x[L]:S[L],V=Mg(D),W=L===y?R.isActive:null;W===!1&&(G=P);let q=D===S[L]&&D!==x[L]&&V;if(q&&l&&r.manuallyAnimateOnMount&&(q=!1),R.protectedKeys={...M},!R.isActive&&W===null||!D&&!R.prevProp||ub(D)||typeof D=="boolean")continue;const H=$Ee(R.prevProp,D);let J=H||L===y&&R.isActive&&!q&&V||P>G&&V,ee=!1;const ne=Array.isArray(D)?D:[D];let pe=ne.reduce(u(L),{});W===!1&&(pe={});const{prevResolvedValues:Ee={}}=R,ge={...Ee,...pe},he=fe=>{J=!0,N.has(fe)&&(ee=!0,N.delete(fe)),R.needsAnimating[fe]=!0;const ae=r.getValue(fe);ae&&(ae.liveStyle=!1)};for(const fe in ge){const ae=pe[fe],be=Ee[fe];if(M.hasOwnProperty(fe))continue;let We=!1;QR(ae)&&QR(be)?We=!gH(ae,be):We=ae!==be,We?ae!=null?he(fe):N.add(fe):ae!==void 0&&N.has(fe)?he(fe):R.protectedKeys[fe]=!0}R.prevProp=D,R.prevResolvedValues=pe,R.isActive&&(M={...M,...pe}),l&&r.blockInitialAnimation&&(J=!1);const le=q&&H;J&&(!le||ee)&&C.push(...ne.map(fe=>{const ae={type:L};if(typeof fe=="string"&&l&&!le&&r.manuallyAnimateOnMount&&r.parent){const{parent:be}=r,We=fp(be,fe);if(be.enteringChildren&&We){const{delayChildren:it}=We.transition||{};ae.delay=fH(be.enteringChildren,r,it)}}return{animation:fe,options:ae}}))}if(N.size){const P={};if(typeof x.initial!="boolean"){const L=fp(r,Array.isArray(x.initial)?x.initial[0]:x.initial);L&&L.transition&&(P.transition=L.transition)}N.forEach(L=>{const R=r.getBaseTarget(L),D=r.getValue(L);D&&(D.liveStyle=!0),P[L]=R??null}),C.push({animation:P})}let I=!!C.length;return l&&(x.initial===!1||x.initial===x.animate)&&!r.manuallyAnimateOnMount&&(I=!1),l=!1,I?n(C):Promise.resolve()}function E(y,x){var C;if(o[y].isActive===x)return Promise.resolve();(C=r.variantChildren)==null||C.forEach(N=>{var M;return(M=N.animationState)==null?void 0:M.setActive(y,x)}),o[y].isActive=x;const S=g(y);for(const N in o)o[N].protectedKeys={};return S}return{animateChanges:g,setActive:E,setAnimateFunction:m,getState:()=>o,reset:()=>{o=x6()}}}function $Ee(r,n){return typeof n=="string"?n!==r:Array.isArray(n)?!gH(n,r):!1}function jd(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function x6(){return{animate:jd(!0),whileInView:jd(),whileHover:jd(),whileTap:jd(),whileDrag:jd(),whileFocus:jd(),exit:jd()}}class Hl{constructor(n){this.isMounted=!1,this.node=n}update(){}}class XEe extends Hl{constructor(n){super(n),n.animationState||(n.animationState=YEe(n))}updateAnimationControlsSubscription(){const{animate:n}=this.node.getProps();ub(n)&&(this.unmountControls=n.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:n}=this.node.getProps(),{animate:o}=this.node.prevProps||{};n!==o&&this.updateAnimationControlsSubscription()}unmount(){var n;this.node.animationState.reset(),(n=this.unmountControls)==null||n.call(this)}}let JEe=0;class QEe extends Hl{constructor(){super(...arguments),this.id=JEe++}update(){if(!this.node.presenceContext)return;const{isPresent:n,onExitComplete:o}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||n===l)return;const u=this.node.animationState.setActive("exit",!n);o&&!n&&u.then(()=>{o(this.id)})}mount(){const{register:n,onExitComplete:o}=this.node.presenceContext||{};o&&o(this.id),n&&(this.unmount=n(this.id))}unmount(){}}const ZEe={animation:{Feature:XEe},exit:{Feature:QEe}};function Ug(r,n,o,l={passive:!0}){return r.addEventListener(n,o,l),()=>r.removeEventListener(n,o)}function e_(r){return{point:{x:r.pageX,y:r.pageY}}}const eye=r=>n=>kI(n)&&r(n,e_(n));function lg(r,n,o,l){return Ug(r,n,eye(o),l)}const vH=1e-4,tye=1-vH,sye=1+vH,EH=.01,rye=0-EH,nye=0+EH;function zn(r){return r.max-r.min}function iye(r,n,o){return Math.abs(r-n)<=o}function b6(r,n,o,l=.5){r.origin=l,r.originPoint=vr(n.min,n.max,r.origin),r.scale=zn(o)/zn(n),r.translate=vr(o.min,o.max,r.origin)-r.originPoint,(r.scale>=tye&&r.scale<=sye||isNaN(r.scale))&&(r.scale=1),(r.translate>=rye&&r.translate<=nye||isNaN(r.translate))&&(r.translate=0)}function dg(r,n,o,l){b6(r.x,n.x,o.x,l?l.originX:void 0),b6(r.y,n.y,o.y,l?l.originY:void 0)}function w6(r,n,o){r.min=o.min+n.min,r.max=r.min+zn(n)}function aye(r,n,o){w6(r.x,n.x,o.x),w6(r.y,n.y,o.y)}function S6(r,n,o){r.min=n.min-o.min,r.max=r.min+zn(n)}function ug(r,n,o){S6(r.x,n.x,o.x),S6(r.y,n.y,o.y)}function fa(r){return[r("x"),r("y")]}const yH=({current:r})=>r?r.ownerDocument.defaultView:null,C6=(r,n)=>Math.abs(r-n);function oye(r,n){const o=C6(r.x,n.x),l=C6(r.y,n.y);return Math.sqrt(o**2+l**2)}class xH{constructor(n,o,{transformPagePoint:l,contextWindow:u=window,dragSnapToOrigin:m=!1,distanceThreshold:g=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const N=_N(this.lastMoveEventInfo,this.history),M=this.startEvent!==null,G=oye(N.offset,{x:0,y:0})>=this.distanceThreshold;if(!M&&!G)return;const{point:I}=N,{timestamp:P}=an;this.history.push({...I,timestamp:P});const{onStart:L,onMove:R}=this.handlers;M||(L&&L(this.lastMoveEvent,N),this.startEvent=this.lastMoveEvent),R&&R(this.lastMoveEvent,N)},this.handlePointerMove=(N,M)=>{this.lastMoveEvent=N,this.lastMoveEventInfo=gN(M,this.transformPagePoint),Ws.update(this.updatePoint,!0)},this.handlePointerUp=(N,M)=>{this.end();const{onEnd:G,onSessionEnd:I,resumeAnimation:P}=this.handlers;if(this.dragSnapToOrigin&&P&&P(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=_N(N.type==="pointercancel"?this.lastMoveEventInfo:gN(M,this.transformPagePoint),this.history);this.startEvent&&G&&G(N,L),I&&I(N,L)},!kI(n))return;this.dragSnapToOrigin=m,this.handlers=o,this.transformPagePoint=l,this.distanceThreshold=g,this.contextWindow=u||window;const E=e_(n),y=gN(E,this.transformPagePoint),{point:x}=y,{timestamp:S}=an;this.history=[{...x,timestamp:S}];const{onSessionStart:C}=o;C&&C(n,_N(y,this.history)),this.removeListeners=Jg(lg(this.contextWindow,"pointermove",this.handlePointerMove),lg(this.contextWindow,"pointerup",this.handlePointerUp),lg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(n){this.handlers=n}end(){this.removeListeners&&this.removeListeners(),co(this.updatePoint)}}function gN(r,n){return n?{point:n(r.point)}:r}function T6(r,n){return{x:r.x-n.x,y:r.y-n.y}}function _N({point:r},n){return{point:r,delta:T6(r,bH(n)),offset:T6(r,cye(n)),velocity:lye(n,.1)}}function cye(r){return r[0]}function bH(r){return r[r.length-1]}function lye(r,n){if(r.length<2)return{x:0,y:0};let o=r.length-1,l=null;const u=bH(r);for(;o>=0&&(l=r[o],!(u.timestamp-l.timestamp>Go(n)));)o--;if(!l)return{x:0,y:0};const m=xa(u.timestamp-l.timestamp);if(m===0)return{x:0,y:0};const g={x:(u.x-l.x)/m,y:(u.y-l.y)/m};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}function dye(r,{min:n,max:o},l){return n!==void 0&&r<n?r=l?vr(n,r,l.min):Math.max(r,n):o!==void 0&&r>o&&(r=l?vr(o,r,l.max):Math.min(r,o)),r}function N6(r,n,o){return{min:n!==void 0?r.min+n:void 0,max:o!==void 0?r.max+o-(r.max-r.min):void 0}}function uye(r,{top:n,left:o,bottom:l,right:u}){return{x:N6(r.x,o,u),y:N6(r.y,n,l)}}function R6(r,n){let o=n.min-r.min,l=n.max-r.max;return n.max-n.min<r.max-r.min&&([o,l]=[l,o]),{min:o,max:l}}function hye(r,n){return{x:R6(r.x,n.x),y:R6(r.y,n.y)}}function pye(r,n){let o=.5;const l=zn(r),u=zn(n);return u>l?o=kp(n.min,n.max-l,r.min):l>u&&(o=kp(r.min,r.max-u,n.min)),zo(0,1,o)}function mye(r,n){const o={};return n.min!==void 0&&(o.min=n.min-r.min),n.max!==void 0&&(o.max=n.max-r.min),o}const tA=.35;function fye(r=tA){return r===!1?r=0:r===!0&&(r=tA),{x:A6(r,"left","right"),y:A6(r,"top","bottom")}}function A6(r,n,o){return{min:I6(r,n),max:I6(r,o)}}function I6(r,n){return typeof r=="number"?r:r[n]||0}const gye=new WeakMap;class _ye{constructor(n){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Mr(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=n}start(n,{snapToCursor:o=!1,distanceThreshold:l}={}){const{presenceContext:u}=this.visualElement;if(u&&u.isPresent===!1)return;const m=C=>{const{dragSnapToOrigin:N}=this.getProps();N?this.pauseAnimation():this.stopAnimation(),o&&this.snapToCursor(e_(C).point)},g=(C,N)=>{const{drag:M,dragPropagation:G,onDragStart:I}=this.getProps();if(M&&!G&&(this.openDragLock&&this.openDragLock(),this.openDragLock=pve(M),!this.openDragLock))return;this.latestPointerEvent=C,this.latestPanInfo=N,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),fa(L=>{let R=this.getAxisMotionValue(L).get()||0;if(Ho.test(R)){const{projection:D}=this.visualElement;if(D&&D.layout){const V=D.layout.layoutBox[L];V&&(R=zn(V)*(parseFloat(R)/100))}}this.originPoint[L]=R}),I&&Ws.postRender(()=>I(C,N)),ZR(this.visualElement,"transform");const{animationState:P}=this.visualElement;P&&P.setActive("whileDrag",!0)},E=(C,N)=>{this.latestPointerEvent=C,this.latestPanInfo=N;const{dragPropagation:M,dragDirectionLock:G,onDirectionLock:I,onDrag:P}=this.getProps();if(!M&&!this.openDragLock)return;const{offset:L}=N;if(G&&this.currentDirection===null){this.currentDirection=vye(L),this.currentDirection!==null&&I&&I(this.currentDirection);return}this.updateAxis("x",N.point,L),this.updateAxis("y",N.point,L),this.visualElement.render(),P&&P(C,N)},y=(C,N)=>{this.latestPointerEvent=C,this.latestPanInfo=N,this.stop(C,N),this.latestPointerEvent=null,this.latestPanInfo=null},x=()=>fa(C=>{var N;return this.getAnimationState(C)==="paused"&&((N=this.getAxisMotionValue(C).animation)==null?void 0:N.play())}),{dragSnapToOrigin:S}=this.getProps();this.panSession=new xH(n,{onSessionStart:m,onStart:g,onMove:E,onSessionEnd:y,resumeAnimation:x},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:S,distanceThreshold:l,contextWindow:yH(this.visualElement)})}stop(n,o){const l=n||this.latestPointerEvent,u=o||this.latestPanInfo,m=this.isDragging;if(this.cancel(),!m||!u||!l)return;const{velocity:g}=u;this.startAnimation(g);const{onDragEnd:E}=this.getProps();E&&Ws.postRender(()=>E(l,u))}cancel(){this.isDragging=!1;const{projection:n,animationState:o}=this.visualElement;n&&(n.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:l}=this.getProps();!l&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),o&&o.setActive("whileDrag",!1)}updateAxis(n,o,l){const{drag:u}=this.getProps();if(!l||!Ty(n,u,this.currentDirection))return;const m=this.getAxisMotionValue(n);let g=this.originPoint[n]+l[n];this.constraints&&this.constraints[n]&&(g=dye(g,this.constraints[n],this.elastic[n])),m.set(g)}resolveConstraints(){var m;const{dragConstraints:n,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(m=this.visualElement.projection)==null?void 0:m.layout,u=this.constraints;n&&np(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&l?this.constraints=uye(l.layoutBox,n):this.constraints=!1,this.elastic=fye(o),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&fa(g=>{this.constraints!==!1&&this.getAxisMotionValue(g)&&(this.constraints[g]=mye(l.layoutBox[g],this.constraints[g]))})}resolveRefConstraints(){const{dragConstraints:n,onMeasureDragConstraints:o}=this.getProps();if(!n||!np(n))return!1;const l=n.current,{projection:u}=this.visualElement;if(!u||!u.layout)return!1;const m=EEe(l,u.root,this.visualElement.getTransformPagePoint());let g=hye(u.layout.layoutBox,m);if(o){const E=o(gEe(g));this.hasMutatedConstraints=!!E,E&&(g=iH(E))}return g}startAnimation(n){const{drag:o,dragMomentum:l,dragElastic:u,dragTransition:m,dragSnapToOrigin:g,onDragTransitionEnd:E}=this.getProps(),y=this.constraints||{},x=fa(S=>{if(!Ty(S,o,this.currentDirection))return;let C=y&&y[S]||{};g&&(C={min:0,max:0});const N=u?200:1e6,M=u?40:1e7,G={type:"inertia",velocity:l?n[S]:0,bounceStiffness:N,bounceDamping:M,timeConstant:750,restDelta:1,restSpeed:10,...m,...C};return this.startAxisValueAnimation(S,G)});return Promise.all(x).then(E)}startAxisValueAnimation(n,o){const l=this.getAxisMotionValue(n);return ZR(this.visualElement,n),l.start(zI(n,l,0,o,this.visualElement,!1))}stopAnimation(){fa(n=>this.getAxisMotionValue(n).stop())}pauseAnimation(){fa(n=>{var o;return(o=this.getAxisMotionValue(n).animation)==null?void 0:o.pause()})}getAnimationState(n){var o;return(o=this.getAxisMotionValue(n).animation)==null?void 0:o.state}getAxisMotionValue(n){const o=`_drag${n.toUpperCase()}`,l=this.visualElement.getProps(),u=l[o];return u||this.visualElement.getValue(n,(l.initial?l.initial[n]:void 0)||0)}snapToCursor(n){fa(o=>{const{drag:l}=this.getProps();if(!Ty(o,l,this.currentDirection))return;const{projection:u}=this.visualElement,m=this.getAxisMotionValue(o);if(u&&u.layout){const{min:g,max:E}=u.layout.layoutBox[o];m.set(n[o]-vr(g,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:n,dragConstraints:o}=this.getProps(),{projection:l}=this.visualElement;if(!np(o)||!l||!this.constraints)return;this.stopAnimation();const u={x:0,y:0};fa(g=>{const E=this.getAxisMotionValue(g);if(E&&this.constraints!==!1){const y=E.get();u[g]=pye({min:y,max:y},this.constraints[g])}});const{transformTemplate:m}=this.visualElement.getProps();this.visualElement.current.style.transform=m?m({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),fa(g=>{if(!Ty(g,n,null))return;const E=this.getAxisMotionValue(g),{min:y,max:x}=this.constraints[g];E.set(vr(y,x,u[g]))})}addListeners(){if(!this.visualElement.current)return;gye.set(this.visualElement,this);const n=this.visualElement.current,o=lg(n,"pointerdown",y=>{const{drag:x,dragListener:S=!0}=this.getProps();x&&S&&this.start(y)}),l=()=>{const{dragConstraints:y}=this.getProps();np(y)&&y.current&&(this.constraints=this.resolveRefConstraints())},{projection:u}=this.visualElement,m=u.addEventListener("measure",l);u&&!u.layout&&(u.root&&u.root.updateScroll(),u.updateLayout()),Ws.read(l);const g=Ug(window,"resize",()=>this.scalePositionWithinConstraints()),E=u.addEventListener("didUpdate",({delta:y,hasLayoutChanged:x})=>{this.isDragging&&x&&(fa(S=>{const C=this.getAxisMotionValue(S);C&&(this.originPoint[S]+=y[S].translate,C.set(C.get()+y[S].translate))}),this.visualElement.render())});return()=>{g(),o(),m(),E&&E()}}getProps(){const n=this.visualElement.getProps(),{drag:o=!1,dragDirectionLock:l=!1,dragPropagation:u=!1,dragConstraints:m=!1,dragElastic:g=tA,dragMomentum:E=!0}=n;return{...n,drag:o,dragDirectionLock:l,dragPropagation:u,dragConstraints:m,dragElastic:g,dragMomentum:E}}}function Ty(r,n,o){return(n===!0||n===r)&&(o===null||o===r)}function vye(r,n=10){let o=null;return Math.abs(r.y)>n?o="y":Math.abs(r.x)>n&&(o="x"),o}class Eye extends Hl{constructor(n){super(n),this.removeGroupControls=xi,this.removeListeners=xi,this.controls=new _ye(n)}mount(){const{dragControls:n}=this.node.getProps();n&&(this.removeGroupControls=n.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||xi}unmount(){this.removeGroupControls(),this.removeListeners()}}const D6=r=>(n,o)=>{r&&Ws.postRender(()=>r(n,o))};class yye extends Hl{constructor(){super(...arguments),this.removePointerDownListener=xi}onPointerDown(n){this.session=new xH(n,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:yH(this.node)})}createPanHandlers(){const{onPanSessionStart:n,onPanStart:o,onPan:l,onPanEnd:u}=this.node.getProps();return{onSessionStart:D6(n),onStart:D6(o),onMove:l,onEnd:(m,g)=>{delete this.session,u&&Ws.postRender(()=>u(m,g))}}}mount(){this.removePointerDownListener=lg(this.node.current,"pointerdown",n=>this.onPointerDown(n))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Yy={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function O6(r,n){return n.max===n.min?0:r/(n.max-n.min)*100}const Uf={correct:(r,n)=>{if(!n.target)return r;if(typeof r=="string")if(Bt.test(r))r=parseFloat(r);else return r;const o=O6(r,n.target.x),l=O6(r,n.target.y);return`${o}% ${l}%`}},xye={correct:(r,{treeScale:n,projectionDelta:o})=>{const l=r,u=Ul.parse(r);if(u.length>5)return l;const m=Ul.createTransformer(r),g=typeof u[0]!="number"?1:0,E=o.x.scale*n.x,y=o.y.scale*n.y;u[0+g]/=E,u[1+g]/=y;const x=vr(E,y,.5);return typeof u[2+g]=="number"&&(u[2+g]/=x),typeof u[3+g]=="number"&&(u[3+g]/=x),m(u)}};let vN=!1;class bye extends O.Component{componentDidMount(){const{visualElement:n,layoutGroup:o,switchLayoutGroup:l,layoutId:u}=this.props,{projection:m}=n;Hve(wye),m&&(o.group&&o.group.add(m),l&&l.register&&u&&l.register(m),vN&&m.root.didUpdate(),m.addEventListener("animationComplete",()=>{this.safeToRemove()}),m.setOptions({...m.options,onExitComplete:()=>this.safeToRemove()})),Yy.hasEverUpdated=!0}getSnapshotBeforeUpdate(n){const{layoutDependency:o,visualElement:l,drag:u,isPresent:m}=this.props,{projection:g}=l;return g&&(g.isPresent=m,vN=!0,u||n.layoutDependency!==o||o===void 0||n.isPresent!==m?g.willUpdate():this.safeToRemove(),n.isPresent!==m&&(m?g.promote():g.relegate()||Ws.postRender(()=>{const E=g.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:n}=this.props.visualElement;n&&(n.root.didUpdate(),PI.postRender(()=>{!n.currentAnimation&&n.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:n,layoutGroup:o,switchLayoutGroup:l}=this.props,{projection:u}=n;vN=!0,u&&(u.scheduleCheckAfterUnmount(),o&&o.group&&o.group.remove(u),l&&l.deregister&&l.deregister(u))}safeToRemove(){const{safeToRemove:n}=this.props;n&&n()}render(){return null}}function wH(r){const[n,o]=zG(),l=O.useContext(uI);return i.jsx(bye,{...r,layoutGroup:l,switchLayoutGroup:O.useContext(rH),isPresent:n,safeToRemove:o})}const wye={borderRadius:{...Uf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Uf,borderTopRightRadius:Uf,borderBottomLeftRadius:Uf,borderBottomRightRadius:Uf,boxShadow:xye};function Sye(r,n,o){const l=jn(r)?r:no(r);return l.start(zI("",l,n,o)),l.animation}const Cye=(r,n)=>r.depth-n.depth;class Tye{constructor(){this.children=[],this.isDirty=!1}add(n){pI(this.children,n),this.isDirty=!0}remove(n){mI(this.children,n),this.isDirty=!0}forEach(n){this.isDirty&&this.children.sort(Cye),this.isDirty=!1,this.children.forEach(n)}}function Nye(r,n){const o=_i.now(),l=({timestamp:u})=>{const m=u-o;m>=n&&(co(l),r(m-n))};return Ws.setup(l,!0),()=>co(l)}const SH=["TopLeft","TopRight","BottomLeft","BottomRight"],Rye=SH.length,j6=r=>typeof r=="string"?parseFloat(r):r,P6=r=>typeof r=="number"||Bt.test(r);function Aye(r,n,o,l,u,m){u?(r.opacity=vr(0,o.opacity??1,Iye(l)),r.opacityExit=vr(n.opacity??1,0,Dye(l))):m&&(r.opacity=vr(n.opacity??1,o.opacity??1,l));for(let g=0;g<Rye;g++){const E=`border${SH[g]}Radius`;let y=k6(n,E),x=k6(o,E);if(y===void 0&&x===void 0)continue;y||(y=0),x||(x=0),y===0||x===0||P6(y)===P6(x)?(r[E]=Math.max(vr(j6(y),j6(x),l),0),(Ho.test(x)||Ho.test(y))&&(r[E]+="%")):r[E]=x}(n.rotate||o.rotate)&&(r.rotate=vr(n.rotate||0,o.rotate||0,l))}function k6(r,n){return r[n]!==void 0?r[n]:r.borderRadius}const Iye=CH(0,.5,cG),Dye=CH(.5,.95,xi);function CH(r,n,o){return l=>l<r?0:l>n?1:o(kp(r,n,l))}function L6(r,n){r.min=n.min,r.max=n.max}function ma(r,n){L6(r.x,n.x),L6(r.y,n.y)}function M6(r,n){r.translate=n.translate,r.scale=n.scale,r.originPoint=n.originPoint,r.origin=n.origin}function F6(r,n,o,l,u){return r-=n,r=Ax(r,1/o,l),u!==void 0&&(r=Ax(r,1/u,l)),r}function Oye(r,n=0,o=1,l=.5,u,m=r,g=r){if(Ho.test(n)&&(n=parseFloat(n),n=vr(g.min,g.max,n/100)-g.min),typeof n!="number")return;let E=vr(m.min,m.max,l);r===m&&(E-=n),r.min=F6(r.min,n,o,E,u),r.max=F6(r.max,n,o,E,u)}function U6(r,n,[o,l,u],m,g){Oye(r,n[o],n[l],n[u],n.scale,m,g)}const jye=["x","scaleX","originX"],Pye=["y","scaleY","originY"];function V6(r,n,o,l){U6(r.x,n,jye,o?o.x:void 0,l?l.x:void 0),U6(r.y,n,Pye,o?o.y:void 0,l?l.y:void 0)}function B6(r){return r.translate===0&&r.scale===1}function TH(r){return B6(r.x)&&B6(r.y)}function W6(r,n){return r.min===n.min&&r.max===n.max}function kye(r,n){return W6(r.x,n.x)&&W6(r.y,n.y)}function G6(r,n){return Math.round(r.min)===Math.round(n.min)&&Math.round(r.max)===Math.round(n.max)}function NH(r,n){return G6(r.x,n.x)&&G6(r.y,n.y)}function H6(r){return zn(r.x)/zn(r.y)}function z6(r,n){return r.translate===n.translate&&r.scale===n.scale&&r.originPoint===n.originPoint}class Lye{constructor(){this.members=[]}add(n){pI(this.members,n),n.scheduleRender()}remove(n){if(mI(this.members,n),n===this.prevLead&&(this.prevLead=void 0),n===this.lead){const o=this.members[this.members.length-1];o&&this.promote(o)}}relegate(n){const o=this.members.findIndex(u=>n===u);if(o===0)return!1;let l;for(let u=o;u>=0;u--){const m=this.members[u];if(m.isPresent!==!1){l=m;break}}return l?(this.promote(l),!0):!1}promote(n,o){const l=this.lead;if(n!==l&&(this.prevLead=l,this.lead=n,n.show(),l)){l.instance&&l.scheduleRender(),n.scheduleRender(),n.resumeFrom=l,o&&(n.resumeFrom.preserveOpacity=!0),l.snapshot&&(n.snapshot=l.snapshot,n.snapshot.latestValues=l.animationValues||l.latestValues),n.root&&n.root.isUpdating&&(n.isLayoutDirty=!0);const{crossfade:u}=n.options;u===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(n=>{const{options:o,resumingFrom:l}=n;o.onExitComplete&&o.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(n=>{n.instance&&n.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Mye(r,n,o){let l="";const u=r.x.translate/n.x,m=r.y.translate/n.y,g=(o==null?void 0:o.z)||0;if((u||m||g)&&(l=`translate3d(${u}px, ${m}px, ${g}px) `),(n.x!==1||n.y!==1)&&(l+=`scale(${1/n.x}, ${1/n.y}) `),o){const{transformPerspective:x,rotate:S,rotateX:C,rotateY:N,skewX:M,skewY:G}=o;x&&(l=`perspective(${x}px) ${l}`),S&&(l+=`rotate(${S}deg) `),C&&(l+=`rotateX(${C}deg) `),N&&(l+=`rotateY(${N}deg) `),M&&(l+=`skewX(${M}deg) `),G&&(l+=`skewY(${G}deg) `)}const E=r.x.scale*n.x,y=r.y.scale*n.y;return(E!==1||y!==1)&&(l+=`scale(${E}, ${y})`),l||"none"}const EN=["","X","Y","Z"],Fye=1e3;let Uye=0;function yN(r,n,o,l){const{latestValues:u}=n;u[r]&&(o[r]=u[r],n.setStaticValue(r,0),l&&(l[r]=0))}function RH(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:n}=r.options;if(!n)return;const o=pH(n);if(window.MotionHasOptimisedAnimation(o,"transform")){const{layout:u,layoutId:m}=r.options;window.MotionCancelOptimisedAnimation(o,"transform",Ws,!(u||m))}const{parent:l}=r;l&&!l.hasCheckedOptimisedAppear&&RH(l)}function AH({attachResizeListener:r,defaultParent:n,measureScroll:o,checkIsScrollRoot:l,resetTransform:u}){return class{constructor(g={},E=n==null?void 0:n()){this.id=Uye++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Wye),this.nodes.forEach(Kye),this.nodes.forEach(qye),this.nodes.forEach(Gye)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=g,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let y=0;y<this.path.length;y++)this.path[y].shouldResetTransform=!0;this.root===this&&(this.nodes=new Tye)}addEventListener(g,E){return this.eventHandlers.has(g)||this.eventHandlers.set(g,new gI),this.eventHandlers.get(g).add(E)}notifyListeners(g,...E){const y=this.eventHandlers.get(g);y&&y.notify(...E)}hasListeners(g){return this.eventHandlers.has(g)}mount(g){if(this.instance)return;this.isSVG=LI(g)&&!Rve(g),this.instance=g;const{layoutId:E,layout:y,visualElement:x}=this.options;if(x&&!x.current&&x.mount(g),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(y||E)&&(this.isLayoutDirty=!0),r){let S,C=0;const N=()=>this.root.updateBlockedByResize=!1;Ws.read(()=>{C=window.innerWidth}),r(g,()=>{const M=window.innerWidth;M!==C&&(C=M,this.root.updateBlockedByResize=!0,S&&S(),S=Nye(N,250),Yy.hasAnimatedSinceResize&&(Yy.hasAnimatedSinceResize=!1,this.nodes.forEach(Y6)))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&x&&(E||y)&&this.addEventListener("didUpdate",({delta:S,hasLayoutChanged:C,hasRelativeLayoutChanged:N,layout:M})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||x.getDefaultTransition()||Qye,{onLayoutAnimationStart:I,onLayoutAnimationComplete:P}=x.getProps(),L=!this.targetLayout||!NH(this.targetLayout,M),R=!C&&N;if(this.options.layoutRoot||this.resumeFrom||R||C&&(L||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const D={...DI(G,"layout"),onPlay:I,onComplete:P};(x.shouldReduceMotion||this.options.layoutRoot)&&(D.delay=0,D.type=!1),this.startAnimation(D),this.setAnimationOrigin(S,R)}else C||Y6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=M})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const g=this.getStack();g&&g.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),co(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Yye),this.animationId++)}getTransformTemplate(){const{visualElement:g}=this.options;return g&&g.getProps().transformTemplate}willUpdate(g=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&RH(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let S=0;S<this.path.length;S++){const C=this.path[S];C.shouldResetTransform=!0,C.updateScroll("snapshot"),C.options.layoutRoot&&C.willUpdate(!1)}const{layoutId:E,layout:y}=this.options;if(E===void 0&&!y)return;const x=this.getTransformTemplate();this.prevTransformTemplateValue=x?x(this.latestValues,""):void 0,this.updateSnapshot(),g&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(K6);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(q6);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(zye),this.nodes.forEach(Vye),this.nodes.forEach(Bye)):this.nodes.forEach(q6),this.clearAllSnapshots();const E=_i.now();an.delta=zo(0,1e3/60,E-an.timestamp),an.timestamp=E,an.isProcessing=!0,cN.update.process(an),cN.preRender.process(an),cN.render.process(an),an.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,PI.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Hye),this.sharedNodes.forEach($ye)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ws.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ws.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!zn(this.snapshot.measuredBox.x)&&!zn(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let y=0;y<this.path.length;y++)this.path[y].updateScroll();const g=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Mr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,g?g.layoutBox:void 0)}updateScroll(g="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===g&&(E=!1),E&&this.instance){const y=l(this.instance);this.scroll={animationId:this.root.animationId,phase:g,isRoot:y,offset:o(this.instance),wasRoot:this.scroll?this.scroll.isRoot:y}}}resetTransform(){if(!u)return;const g=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!TH(this.projectionDelta),y=this.getTransformTemplate(),x=y?y(this.latestValues,""):void 0,S=x!==this.prevTransformTemplateValue;g&&this.instance&&(E||Vd(this.latestValues)||S)&&(u(this.instance,x),this.shouldResetTransform=!1,this.scheduleRender())}measure(g=!0){const E=this.measurePageBox();let y=this.removeElementScroll(E);return g&&(y=this.removeTransform(y)),Zye(y),{animationId:this.root.animationId,measuredBox:E,layoutBox:y,latestValues:{},source:this.id}}measurePageBox(){var x;const{visualElement:g}=this.options;if(!g)return Mr();const E=g.measureViewportBox();if(!(((x=this.scroll)==null?void 0:x.wasRoot)||this.path.some(exe))){const{scroll:S}=this.root;S&&(ip(E.x,S.offset.x),ip(E.y,S.offset.y))}return E}removeElementScroll(g){var y;const E=Mr();if(ma(E,g),(y=this.scroll)!=null&&y.wasRoot)return E;for(let x=0;x<this.path.length;x++){const S=this.path[x],{scroll:C,options:N}=S;S!==this.root&&C&&N.layoutScroll&&(C.wasRoot&&ma(E,g),ip(E.x,C.offset.x),ip(E.y,C.offset.y))}return E}applyTransform(g,E=!1){const y=Mr();ma(y,g);for(let x=0;x<this.path.length;x++){const S=this.path[x];!E&&S.options.layoutScroll&&S.scroll&&S!==S.root&&ap(y,{x:-S.scroll.offset.x,y:-S.scroll.offset.y}),Vd(S.latestValues)&&ap(y,S.latestValues)}return Vd(this.latestValues)&&ap(y,this.latestValues),y}removeTransform(g){const E=Mr();ma(E,g);for(let y=0;y<this.path.length;y++){const x=this.path[y];if(!x.instance||!Vd(x.latestValues))continue;$R(x.latestValues)&&x.updateSnapshot();const S=Mr(),C=x.measurePageBox();ma(S,C),V6(E,x.latestValues,x.snapshot?x.snapshot.layoutBox:void 0,S)}return Vd(this.latestValues)&&V6(E,this.latestValues),E}setTargetDelta(g){this.targetDelta=g,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(g){this.options={...this.options,...g,crossfade:g.crossfade!==void 0?g.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==an.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(g=!1){var N;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const y=!!this.resumingFrom||this!==E;if(!(g||y&&this.isSharedProjectionDirty||this.isProjectionDirty||(N=this.parent)!=null&&N.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:S,layoutId:C}=this.options;if(!(!this.layout||!(S||C))){if(this.resolvedRelativeTargetAt=an.timestamp,!this.targetDelta&&!this.relativeTarget){const M=this.getClosestProjectingParent();M&&M.layout&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Mr(),this.relativeTargetOrigin=Mr(),ug(this.relativeTargetOrigin,this.layout.layoutBox,M.layout.layoutBox),ma(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Mr(),this.targetWithTransforms=Mr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),aye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ma(this.target,this.layout.layoutBox),oH(this.target,this.targetDelta)):ma(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const M=this.getClosestProjectingParent();M&&!!M.resumingFrom==!!this.resumingFrom&&!M.options.layoutScroll&&M.target&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Mr(),this.relativeTargetOrigin=Mr(),ug(this.relativeTargetOrigin,this.target,M.target),ma(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||$R(this.parent.latestValues)||aH(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var G;const g=this.getLead(),E=!!this.resumingFrom||this!==g;let y=!0;if((this.isProjectionDirty||(G=this.parent)!=null&&G.isProjectionDirty)&&(y=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(y=!1),this.resolvedRelativeTargetAt===an.timestamp&&(y=!1),y)return;const{layout:x,layoutId:S}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(x||S))return;ma(this.layoutCorrected,this.layout.layoutBox);const C=this.treeScale.x,N=this.treeScale.y;vEe(this.layoutCorrected,this.treeScale,this.path,E),g.layout&&!g.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(g.target=g.layout.layoutBox,g.targetWithTransforms=Mr());const{target:M}=g;if(!M){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(M6(this.prevProjectionDelta.x,this.projectionDelta.x),M6(this.prevProjectionDelta.y,this.projectionDelta.y)),dg(this.projectionDelta,this.layoutCorrected,M,this.latestValues),(this.treeScale.x!==C||this.treeScale.y!==N||!z6(this.projectionDelta.x,this.prevProjectionDelta.x)||!z6(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",M))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(g=!0){var E;if((E=this.options.visualElement)==null||E.scheduleRender(),g){const y=this.getStack();y&&y.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=op(),this.projectionDelta=op(),this.projectionDeltaWithTransform=op()}setAnimationOrigin(g,E=!1){const y=this.snapshot,x=y?y.latestValues:{},S={...this.latestValues},C=op();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=Mr(),M=y?y.source:void 0,G=this.layout?this.layout.source:void 0,I=M!==G,P=this.getStack(),L=!P||P.members.length<=1,R=!!(I&&!L&&this.options.crossfade===!0&&!this.path.some(Jye));this.animationProgress=0;let D;this.mixTargetDelta=V=>{const W=V/1e3;$6(C.x,g.x,W),$6(C.y,g.y,W),this.setTargetDelta(C),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ug(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Xye(this.relativeTarget,this.relativeTargetOrigin,N,W),D&&kye(this.relativeTarget,D)&&(this.isProjectionDirty=!1),D||(D=Mr()),ma(D,this.relativeTarget)),I&&(this.animationValues=S,Aye(S,x,this.latestValues,W,R,L)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=W},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(g){var E,y,x;this.notifyListeners("animationStart"),(E=this.currentAnimation)==null||E.stop(),(x=(y=this.resumingFrom)==null?void 0:y.currentAnimation)==null||x.stop(),this.pendingAnimation&&(co(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ws.update(()=>{Yy.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=no(0)),this.currentAnimation=Sye(this.motionValue,[0,1e3],{...g,velocity:0,isSync:!0,onUpdate:S=>{this.mixTargetDelta(S),g.onUpdate&&g.onUpdate(S)},onStop:()=>{},onComplete:()=>{g.onComplete&&g.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const g=this.getStack();g&&g.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Fye),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const g=this.getLead();let{targetWithTransforms:E,target:y,layout:x,latestValues:S}=g;if(!(!E||!y||!x)){if(this!==g&&this.layout&&x&&IH(this.options.animationType,this.layout.layoutBox,x.layoutBox)){y=this.target||Mr();const C=zn(this.layout.layoutBox.x);y.x.min=g.target.x.min,y.x.max=y.x.min+C;const N=zn(this.layout.layoutBox.y);y.y.min=g.target.y.min,y.y.max=y.y.min+N}ma(E,y),ap(E,S),dg(this.projectionDeltaWithTransform,this.layoutCorrected,E,S)}}registerSharedNode(g,E){this.sharedNodes.has(g)||this.sharedNodes.set(g,new Lye),this.sharedNodes.get(g).add(E);const x=E.options.initialPromotionConfig;E.promote({transition:x?x.transition:void 0,preserveFollowOpacity:x&&x.shouldPreserveFollowOpacity?x.shouldPreserveFollowOpacity(E):void 0})}isLead(){const g=this.getStack();return g?g.lead===this:!0}getLead(){var E;const{layoutId:g}=this.options;return g?((E=this.getStack())==null?void 0:E.lead)||this:this}getPrevLead(){var E;const{layoutId:g}=this.options;return g?(E=this.getStack())==null?void 0:E.prevLead:void 0}getStack(){const{layoutId:g}=this.options;if(g)return this.root.sharedNodes.get(g)}promote({needsReset:g,transition:E,preserveFollowOpacity:y}={}){const x=this.getStack();x&&x.promote(this,y),g&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const g=this.getStack();return g?g.relegate(this):!1}resetSkewAndRotation(){const{visualElement:g}=this.options;if(!g)return;let E=!1;const{latestValues:y}=g;if((y.z||y.rotate||y.rotateX||y.rotateY||y.rotateZ||y.skewX||y.skewY)&&(E=!0),!E)return;const x={};y.z&&yN("z",g,x,this.animationValues);for(let S=0;S<EN.length;S++)yN(`rotate${EN[S]}`,g,x,this.animationValues),yN(`skew${EN[S]}`,g,x,this.animationValues);g.render();for(const S in x)g.setStaticValue(S,x[S]),this.animationValues&&(this.animationValues[S]=x[S]);g.scheduleRender()}applyProjectionStyles(g,E){if(!this.instance||this.isSVG)return;if(!this.isVisible){g.visibility="hidden";return}const y=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,g.visibility="",g.opacity="",g.pointerEvents=qy(E==null?void 0:E.pointerEvents)||"",g.transform=y?y(this.latestValues,""):"none";return}const x=this.getLead();if(!this.projectionDelta||!this.layout||!x.target){this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=qy(E==null?void 0:E.pointerEvents)||""),this.hasProjected&&!Vd(this.latestValues)&&(g.transform=y?y({},""):"none",this.hasProjected=!1);return}g.visibility="";const S=x.animationValues||x.latestValues;this.applyTransformsToTarget();let C=Mye(this.projectionDeltaWithTransform,this.treeScale,S);y&&(C=y(S,C)),g.transform=C;const{x:N,y:M}=this.projectionDelta;g.transformOrigin=`${N.origin*100}% ${M.origin*100}% 0`,x.animationValues?g.opacity=x===this?S.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:S.opacityExit:g.opacity=x===this?S.opacity!==void 0?S.opacity:"":S.opacityExit!==void 0?S.opacityExit:0;for(const G in Fg){if(S[G]===void 0)continue;const{correct:I,applyTo:P,isCSSVariable:L}=Fg[G],R=C==="none"?S[G]:I(S[G],x);if(P){const D=P.length;for(let V=0;V<D;V++)g[P[V]]=R}else L?this.options.visualElement.renderState.vars[G]=R:g[G]=R}this.options.layoutId&&(g.pointerEvents=x===this?qy(E==null?void 0:E.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(g=>{var E;return(E=g.currentAnimation)==null?void 0:E.stop()}),this.root.nodes.forEach(K6),this.root.sharedNodes.clear()}}}function Vye(r){r.updateLayout()}function Bye(r){var o;const n=((o=r.resumeFrom)==null?void 0:o.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&n&&r.hasListeners("didUpdate")){const{layoutBox:l,measuredBox:u}=r.layout,{animationType:m}=r.options,g=n.source!==r.layout.source;m==="size"?fa(C=>{const N=g?n.measuredBox[C]:n.layoutBox[C],M=zn(N);N.min=l[C].min,N.max=N.min+M}):IH(m,n.layoutBox,l)&&fa(C=>{const N=g?n.measuredBox[C]:n.layoutBox[C],M=zn(l[C]);N.max=N.min+M,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[C].max=r.relativeTarget[C].min+M)});const E=op();dg(E,l,n.layoutBox);const y=op();g?dg(y,r.applyTransform(u,!0),n.measuredBox):dg(y,l,n.layoutBox);const x=!TH(E);let S=!1;if(!r.resumeFrom){const C=r.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:N,layout:M}=C;if(N&&M){const G=Mr();ug(G,n.layoutBox,N.layoutBox);const I=Mr();ug(I,l,M.layoutBox),NH(G,I)||(S=!0),C.options.layoutRoot&&(r.relativeTarget=I,r.relativeTargetOrigin=G,r.relativeParent=C)}}}r.notifyListeners("didUpdate",{layout:l,snapshot:n,delta:y,layoutDelta:E,hasLayoutChanged:x,hasRelativeLayoutChanged:S})}else if(r.isLead()){const{onExitComplete:l}=r.options;l&&l()}r.options.transition=void 0}function Wye(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function Gye(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function Hye(r){r.clearSnapshot()}function K6(r){r.clearMeasurements()}function q6(r){r.isLayoutDirty=!1}function zye(r){const{visualElement:n}=r.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),r.resetTransform()}function Y6(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function Kye(r){r.resolveTargetDelta()}function qye(r){r.calcProjection()}function Yye(r){r.resetSkewAndRotation()}function $ye(r){r.removeLeadSnapshot()}function $6(r,n,o){r.translate=vr(n.translate,0,o),r.scale=vr(n.scale,1,o),r.origin=n.origin,r.originPoint=n.originPoint}function X6(r,n,o,l){r.min=vr(n.min,o.min,l),r.max=vr(n.max,o.max,l)}function Xye(r,n,o,l){X6(r.x,n.x,o.x,l),X6(r.y,n.y,o.y,l)}function Jye(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const Qye={duration:.45,ease:[.4,0,.1,1]},J6=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),Q6=J6("applewebkit/")&&!J6("chrome/")?Math.round:xi;function Z6(r){r.min=Q6(r.min),r.max=Q6(r.max)}function Zye(r){Z6(r.x),Z6(r.y)}function IH(r,n,o){return r==="position"||r==="preserve-aspect"&&!iye(H6(n),H6(o),.2)}function exe(r){var n;return r!==r.root&&((n=r.scroll)==null?void 0:n.wasRoot)}const txe=AH({attachResizeListener:(r,n)=>Ug(r,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),xN={current:void 0},DH=AH({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!xN.current){const r=new txe({});r.mount(window),r.setOptions({layoutScroll:!0}),xN.current=r}return xN.current},resetTransform:(r,n)=>{r.style.transform=n!==void 0?n:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),sxe={pan:{Feature:yye},drag:{Feature:Eye,ProjectionNode:DH,MeasureLayout:wH}};function e7(r,n,o){const{props:l}=r;r.animationState&&l.whileHover&&r.animationState.setActive("whileHover",o==="Start");const u="onHover"+o,m=l[u];m&&Ws.postRender(()=>m(n,e_(n)))}class rxe extends Hl{mount(){const{current:n}=this.node;n&&(this.unmount=mve(n,(o,l)=>(e7(this.node,l,"Start"),u=>e7(this.node,u,"End"))))}unmount(){}}class nxe extends Hl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let n=!1;try{n=this.node.current.matches(":focus-visible")}catch{n=!0}!n||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Jg(Ug(this.node.current,"focus",()=>this.onFocus()),Ug(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function t7(r,n,o){const{props:l}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&l.whileTap&&r.animationState.setActive("whileTap",o==="Start");const u="onTap"+(o==="End"?"":o),m=l[u];m&&Ws.postRender(()=>m(n,e_(n)))}class ixe extends Hl{mount(){const{current:n}=this.node;n&&(this.unmount=vve(n,(o,l)=>(t7(this.node,l,"Start"),(u,{success:m})=>t7(this.node,u,m?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const sA=new WeakMap,bN=new WeakMap,axe=r=>{const n=sA.get(r.target);n&&n(r)},oxe=r=>{r.forEach(axe)};function cxe({root:r,...n}){const o=r||document;bN.has(o)||bN.set(o,{});const l=bN.get(o),u=JSON.stringify(n);return l[u]||(l[u]=new IntersectionObserver(oxe,{root:r,...n})),l[u]}function lxe(r,n,o){const l=cxe(n);return sA.set(r,o),l.observe(r),()=>{sA.delete(r),l.unobserve(r)}}const dxe={some:0,all:1};class uxe extends Hl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:n={}}=this.node.getProps(),{root:o,margin:l,amount:u="some",once:m}=n,g={root:o?o.current:void 0,rootMargin:l,threshold:typeof u=="number"?u:dxe[u]},E=y=>{const{isIntersecting:x}=y;if(this.isInView===x||(this.isInView=x,m&&!x&&this.hasEnteredView))return;x&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",x);const{onViewportEnter:S,onViewportLeave:C}=this.node.getProps(),N=x?S:C;N&&N(y)};return lxe(this.node.current,g,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:n,prevProps:o}=this.node;["amount","margin","root"].some(hxe(n,o))&&this.startObserver()}unmount(){}}function hxe({viewport:r={}},{viewport:n={}}={}){return o=>r[o]!==n[o]}const pxe={inView:{Feature:uxe},tap:{Feature:ixe},focus:{Feature:nxe},hover:{Feature:rxe}},mxe={layout:{ProjectionNode:DH,MeasureLayout:wH}},fxe={...ZEe,...pxe,...sxe,...mxe},gc=fEe(fxe,REe),gxe=50,s7=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),_xe=()=>({time:0,x:s7(),y:s7()}),vxe={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function r7(r,n,o,l){const u=o[n],{length:m,position:g}=vxe[n],E=u.current,y=o.time;u.current=r[`scroll${g}`],u.scrollLength=r[`scroll${m}`]-r[`client${m}`],u.offset.length=0,u.offset[0]=0,u.offset[1]=u.scrollLength,u.progress=kp(0,u.scrollLength,u.current);const x=l-y;u.velocity=x>gxe?0:_I(u.current-E,x)}function Exe(r,n,o){r7(r,"x",n,o),r7(r,"y",n,o),n.time=o}function yxe(r,n){const o={x:0,y:0};let l=r;for(;l&&l!==n;)if(jI(l))o.x+=l.offsetLeft,o.y+=l.offsetTop,l=l.offsetParent;else if(l.tagName==="svg"){const u=l.getBoundingClientRect();l=l.parentElement;const m=l.getBoundingClientRect();o.x+=u.left-m.left,o.y+=u.top-m.top}else if(l instanceof SVGGraphicsElement){const{x:u,y:m}=l.getBBox();o.x+=u,o.y+=m;let g=null,E=l.parentNode;for(;!g;)E.tagName==="svg"&&(g=E),E=l.parentNode;l=g}else break;return o}const rA={start:0,center:.5,end:1};function n7(r,n,o=0){let l=0;if(r in rA&&(r=rA[r]),typeof r=="string"){const u=parseFloat(r);r.endsWith("px")?l=u:r.endsWith("%")?r=u/100:r.endsWith("vw")?l=u/100*document.documentElement.clientWidth:r.endsWith("vh")?l=u/100*document.documentElement.clientHeight:r=u}return typeof r=="number"&&(l=n*r),o+l}const xxe=[0,0];function bxe(r,n,o,l){let u=Array.isArray(r)?r:xxe,m=0,g=0;return typeof r=="number"?u=[r,r]:typeof r=="string"&&(r=r.trim(),r.includes(" ")?u=r.split(" "):u=[r,rA[r]?r:"0"]),m=n7(u[0],o,l),g=n7(u[1],n),m-g}const wxe={All:[[0,0],[1,1]]},Sxe={x:0,y:0};function Cxe(r){return"getBBox"in r&&r.tagName!=="svg"?r.getBBox():{width:r.clientWidth,height:r.clientHeight}}function Txe(r,n,o){const{offset:l=wxe.All}=o,{target:u=r,axis:m="y"}=o,g=m==="y"?"height":"width",E=u!==r?yxe(u,r):Sxe,y=u===r?{width:r.scrollWidth,height:r.scrollHeight}:Cxe(u),x={width:r.clientWidth,height:r.clientHeight};n[m].offset.length=0;let S=!n[m].interpolate;const C=l.length;for(let N=0;N<C;N++){const M=bxe(l[N],x[g],y[g],E[m]);!S&&M!==n[m].interpolatorOffsets[N]&&(S=!0),n[m].offset[N]=M}S&&(n[m].interpolate=TI(n[m].offset,wG(l),{clamp:!1}),n[m].interpolatorOffsets=[...n[m].offset]),n[m].progress=zo(0,1,n[m].interpolate(n[m].current))}function Nxe(r,n=r,o){if(o.x.targetOffset=0,o.y.targetOffset=0,n!==r){let l=n;for(;l&&l!==r;)o.x.targetOffset+=l.offsetLeft,o.y.targetOffset+=l.offsetTop,l=l.offsetParent}o.x.targetLength=n===r?n.scrollWidth:n.clientWidth,o.y.targetLength=n===r?n.scrollHeight:n.clientHeight,o.x.containerLength=r.clientWidth,o.y.containerLength=r.clientHeight}function Rxe(r,n,o,l={}){return{measure:u=>{Nxe(r,l.target,o),Exe(r,o,u),(l.offset||l.target)&&Txe(r,o,l)},notify:()=>n(o)}}const Vf=new WeakMap,i7=new WeakMap,wN=new WeakMap,a7=r=>r===document.scrollingElement?window:r;function OH(r,{container:n=document.scrollingElement,...o}={}){if(!n)return xi;let l=wN.get(n);l||(l=new Set,wN.set(n,l));const u=_xe(),m=Rxe(n,r,u,o);if(l.add(m),!Vf.has(n)){const E=()=>{for(const C of l)C.measure(an.timestamp);Ws.preUpdate(y)},y=()=>{for(const C of l)C.notify()},x=()=>Ws.read(E);Vf.set(n,x);const S=a7(n);window.addEventListener("resize",x,{passive:!0}),n!==document.documentElement&&i7.set(n,Nve(n,x)),S.addEventListener("scroll",x,{passive:!0}),x()}const g=Vf.get(n);return Ws.read(g,!1,!0),()=>{var x;co(g);const E=wN.get(n);if(!E||(E.delete(m),E.size))return;const y=Vf.get(n);Vf.delete(n),y&&(a7(n).removeEventListener("scroll",y),(x=i7.get(n))==null||x(),window.removeEventListener("resize",y))}}const o7=new Map;function Axe(r){const n={value:0},o=OH(l=>{n.value=l[r.axis].progress*100},r);return{currentTime:n,cancel:o}}function jH({source:r,container:n,...o}){const{axis:l}=o;r&&(n=r);const u=o7.get(n)??new Map;o7.set(n,u);const m=o.target??"self",g=u.get(m)??{},E=l+(o.offset??[]).join(",");return g[E]||(g[E]=!o.target&&NG()?new ScrollTimeline({source:n,axis:l}):Axe({container:n,...o})),g[E]}function Ixe(r,n){const o=jH(n);return r.attachTimeline({timeline:n.target?void 0:o,observe:l=>(l.pause(),HG(u=>{l.time=l.iterationDuration*u},o))})}function Dxe(r){return r.length===2}function Oxe(r,n){return Dxe(r)?OH(o=>{r(o[n.axis].progress,o)},n):HG(r,jH(n))}function jxe(r,{axis:n="y",container:o=document.scrollingElement,...l}={}){if(!o)return xi;const u={axis:n,container:o,...l};return typeof r=="function"?Oxe(r,u):Ixe(r,u)}const Pxe=()=>({scrollX:no(0),scrollY:no(0),scrollXProgress:no(0),scrollYProgress:no(0)}),Ny=r=>r?!r.current:!1;function kxe({container:r,target:n,...o}={}){const l=Kp(Pxe),u=O.useRef(null),m=O.useRef(!1),g=O.useCallback(()=>(u.current=jxe((E,{x:y,y:x})=>{l.scrollX.set(y.current),l.scrollXProgress.set(y.progress),l.scrollY.set(x.current),l.scrollYProgress.set(x.progress)},{...o,container:(r==null?void 0:r.current)||void 0,target:(n==null?void 0:n.current)||void 0}),()=>{var E;(E=u.current)==null||E.call(u)}),[r,n,JSON.stringify(o.offset)]);return ob(()=>{if(m.current=!1,Ny(r)||Ny(n)){m.current=!0;return}else return g()},[g]),O.useEffect(()=>{if(m.current)return Pg(!Ny(r)),Pg(!Ny(n)),g()},[g]),l}function Lxe(r){const n=Kp(()=>no(r)),{isStatic:o}=O.useContext(lb);if(o){const[,l]=O.useState(r);O.useEffect(()=>n.on("change",l),[])}return n}function PH(r,n){const o=Lxe(n()),l=()=>o.set(n());return l(),ob(()=>{const u=()=>Ws.preRender(l,!1,!0),m=r.map(g=>g.on("change",u));return()=>{m.forEach(g=>g()),co(l)}}),o}function Mxe(r){cg.current=[],r();const n=PH(cg.current,r);return cg.current=void 0,n}function SN(r,n,o,l){if(typeof r=="function")return Mxe(r);const u=typeof n=="function"?n:Ave(n,o,l);return Array.isArray(r)?c7(r,u):c7([r],([m])=>u(m))}function c7(r,n){const o=Kp(()=>[]);return PH(r,()=>{o.length=0;const l=r.length;for(let u=0;u<l;u++)o[u]=r[u].get();return n(o)})}const ko={degreesToRadians:r=>r*(Math.PI/180),radiansToDegrees:r=>r*(180/Math.PI),sphericalToCartesian:(r,n,o)=>({x:r*Math.sin(o)*Math.cos(n),y:r*Math.cos(o),z:r*Math.sin(o)*Math.sin(n)}),calculateDistance:(r,n={x:0,y:0,z:0})=>{const o=r.x-n.x,l=r.y-n.y,u=r.z-n.z;return Math.sqrt(o*o+l*l+u*u)},normalizeAngle:r=>{for(;r>180;)r-=360;for(;r<-180;)r+=360;return r}},Fxe=({images:r=[],containerSize:n=400,sphereRadius:o=200,dragSensitivity:l=.5,momentumDecay:u=.95,maxRotationSpeed:m=5,baseImageScale:g=.12,hoverScale:E=1.2,perspective:y=1e3,autoRotate:x=!1,autoRotateSpeed:S=.3,className:C=""})=>{const[N,M]=O.useState(!1),[G,I]=O.useState({x:15,y:15,z:0}),[P,L]=O.useState({x:0,y:0}),[R,D]=O.useState(!1),[V,W]=O.useState(null),[q,H]=O.useState([]),[J,ee]=O.useState(null),ne=O.useRef(null),pe=O.useRef({x:0,y:0}),Ee=O.useRef(null),ge=o||n*.5,he=n*g,le=O.useCallback(()=>{const Ie=[],Xe=r.length,ye=(1+Math.sqrt(5))/2,Oe=2*Math.PI/ye;for(let qe=0;qe<Xe;qe++){const Ct=qe/Xe,Ft=Math.acos(1-2*Ct),zt=Oe*qe;let vt=Ft*180/Math.PI,ds=zt*180/Math.PI%360;const kt=Math.pow(Math.abs(vt-90)/90,.6)*35;vt<90?vt=Math.max(5,vt-kt):vt=Math.min(175,vt+kt),vt=15+vt/180*150;const Ps=(Math.random()-.5)*20;ds=(ds+Ps)%360,vt=Math.max(0,Math.min(180,vt+(Math.random()-.5)*10)),Ie.push({theta:ds,phi:vt,radius:ge})}return Ie},[r.length,ge]),Le=O.useCallback(()=>{const Xe=[...q.map((ye,Oe)=>{const qe=ko.degreesToRadians(ye.theta),Ct=ko.degreesToRadians(ye.phi),Ft=ko.degreesToRadians(G.x),zt=ko.degreesToRadians(G.y);let vt=ye.radius*Math.sin(Ct)*Math.cos(qe),ds=ye.radius*Math.cos(Ct),kt=ye.radius*Math.sin(Ct)*Math.sin(qe);const Ps=vt*Math.cos(zt)+kt*Math.sin(zt),Jn=-vt*Math.sin(zt)+kt*Math.cos(zt);vt=Ps,kt=Jn;const $o=ds*Math.cos(Ft)-kt*Math.sin(Ft),uo=ds*Math.sin(Ft)+kt*Math.cos(Ft);ds=$o,kt=uo;const Qr={x:vt,y:ds,z:kt},br=-10,ho=-30,Kl=Qr.z>ho;let ln=1;Qr.z<=br&&(ln=Math.max(0,(Qr.z-ho)/(br-ho)));const us=ye.phi<30||ye.phi>150,Ds=Math.sqrt(Qr.x*Qr.x+Qr.y*Qr.y),hs=Math.min(Ds/ge,1),_u=Math.max(.3,1-hs*(us?.4:.7)),Ta=(Qr.z+ge)/(2*ge),vu=_u*Math.max(.5,.8+Ta*.3);return{...Qr,scale:vu,zIndex:Math.round(1e3+Qr.z),isVisible:Kl,fadeOpacity:ln,originalIndex:Oe}})];for(let ye=0;ye<Xe.length;ye++){const Oe=Xe[ye];if(!Oe.isVisible)continue;let qe=Oe.scale;const Ct=he*qe;for(let Ft=0;Ft<Xe.length;Ft++){if(ye===Ft)continue;const zt=Xe[Ft];if(!zt.isVisible)continue;const vt=he*zt.scale,ds=Oe.x-zt.x,kt=Oe.y-zt.y,Ps=Math.sqrt(ds*ds+kt*kt),Jn=(Ct+vt)/2+25;if(Ps<Jn&&Ps>0){const $o=Jn-Ps,uo=Math.max(.4,1-$o/Jn*.6);qe=Math.min(qe,qe*uo)}}Xe[ye]={...Oe,scale:Math.max(.25,qe)}}return Xe},[q,G,ge,he]),fe=O.useCallback(Ie=>Math.max(-m,Math.min(m,Ie)),[m]),ae=O.useCallback(()=>{R||(L(Ie=>{const Xe={x:Ie.x*u,y:Ie.y*u};return!x&&Math.abs(Xe.x)<.01&&Math.abs(Xe.y)<.01?{x:0,y:0}:Xe}),I(Ie=>{let Xe=Ie.y;return x&&(Xe+=S),Xe+=fe(P.y),{x:ko.normalizeAngle(Ie.x+fe(P.x)),y:ko.normalizeAngle(Xe),z:Ie.z}}))},[R,u,P,fe,x,S]),be=O.useCallback(Ie=>{Ie.preventDefault(),D(!0),L({x:0,y:0}),pe.current={x:Ie.clientX,y:Ie.clientY}},[]),We=O.useCallback(Ie=>{if(!R)return;const Xe=Ie.clientX-pe.current.x,Oe={x:-(Ie.clientY-pe.current.y)*l,y:Xe*l};I(qe=>({x:ko.normalizeAngle(qe.x+fe(Oe.x)),y:ko.normalizeAngle(qe.y+fe(Oe.y)),z:qe.z})),L({x:fe(Oe.x),y:fe(Oe.y)}),pe.current={x:Ie.clientX,y:Ie.clientY}},[R,l,fe]),it=O.useCallback(()=>{D(!1)},[]),Ge=O.useCallback(Ie=>{Ie.preventDefault();const Xe=Ie.touches[0];D(!0),L({x:0,y:0}),pe.current={x:Xe.clientX,y:Xe.clientY}},[]),pt=O.useCallback(Ie=>{if(!R)return;Ie.preventDefault();const Xe=Ie.touches[0],ye=Xe.clientX-pe.current.x,qe={x:-(Xe.clientY-pe.current.y)*l,y:ye*l};I(Ct=>({x:ko.normalizeAngle(Ct.x+fe(qe.x)),y:ko.normalizeAngle(Ct.y+fe(qe.y)),z:Ct.z})),L({x:fe(qe.x),y:fe(qe.y)}),pe.current={x:Xe.clientX,y:Xe.clientY}},[R,l,fe]),Ze=O.useCallback(()=>{D(!1)},[]);O.useEffect(()=>{M(!0)},[]),O.useEffect(()=>{H(le())},[le]),O.useEffect(()=>{const Ie=()=>{ae(),Ee.current=requestAnimationFrame(Ie)};return N&&(Ee.current=requestAnimationFrame(Ie)),()=>{Ee.current&&cancelAnimationFrame(Ee.current)}},[N,ae]),O.useEffect(()=>{if(!(!N||!ne.current))return document.addEventListener("mousemove",We),document.addEventListener("mouseup",it),document.addEventListener("touchmove",pt,{passive:!1}),document.addEventListener("touchend",Ze),()=>{document.removeEventListener("mousemove",We),document.removeEventListener("mouseup",it),document.removeEventListener("touchmove",pt),document.removeEventListener("touchend",Ze)}},[N,We,it,pt,Ze]);const Me=Le(),Ue=O.useCallback((Ie,Xe)=>{const ye=Me[Xe];if(!ye||!ye.isVisible)return null;he*ye.scale;const qe=J===Xe?Math.min(E,E/ye.scale):1;return i.jsx("div",{className:"absolute cursor-pointer select-none transition-transform duration-200 ease-out",style:{width:`${he/n*100}%`,height:`${he/n*100}%`,left:`${50+ye.x/n*100}%`,top:`${50+ye.y/n*100}%`,opacity:ye.fadeOpacity,transform:`translate(-50%, -50%) scale(${qe})`,zIndex:ye.zIndex},onMouseEnter:()=>ee(Xe),onMouseLeave:()=>ee(null),onClick:()=>W(Ie),children:i.jsx("div",{className:"relative w-full h-full rounded-full overflow-hidden shadow-lg border-2 border-white/20",children:i.jsx("img",{src:Ie.src,alt:Ie.alt,className:"w-full h-full object-cover",draggable:!1,loading:Xe<3?"eager":"lazy"})})},Ie.id)},[Me,he,n,J,E]),ke=()=>V?i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/30",onClick:()=>W(null),style:{animation:"fadeIn 0.3s ease-out"},children:i.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full overflow-hidden",onClick:Ie=>Ie.stopPropagation(),style:{animation:"scaleIn 0.3s ease-out"},children:[i.jsxs("div",{className:"relative aspect-square",children:[i.jsx("img",{src:V.src,alt:V.alt,className:"w-full h-full object-cover"}),i.jsx("button",{onClick:()=>W(null),className:"absolute top-2 right-2 w-8 h-8 bg-black bg-opacity-50 rounded-full text-white flex items-center justify-center hover:bg-opacity-70 transition-all cursor-pointer",children:i.jsx("span",{className:"text-sm leading-none",children:""})})]}),(V.title||V.description)&&i.jsxs("div",{className:"p-6",children:[V.title&&i.jsx("h3",{className:"text-xl font-bold mb-2",children:V.title}),V.description&&i.jsx("p",{className:"text-gray-600",children:V.description})]})]})}):null;return N?r.length?i.jsxs(i.Fragment,{children:[i.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes scaleIn {
          from { transform: scale(0.8); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
      `}),i.jsx("div",{ref:ne,className:`relative select-none cursor-grab active:cursor-grabbing w-full h-full max-w-[250px] max-h-[250px] md:max-w-[420px] md:max-h-[420px] ${C}`,style:{perspective:`${y}px`},onMouseDown:be,onTouchStart:Ge,children:i.jsx("div",{className:"relative w-full h-full",style:{zIndex:10},children:r.map((Ie,Xe)=>Ue(Ie,Xe))})}),ke()]}):i.jsx("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center",style:{width:n,height:n},children:i.jsxs("div",{className:"text-gray-400 text-center",children:[i.jsx("p",{children:"No images provided"}),i.jsx("p",{className:"text-sm",children:"Add images to the images prop"})]})}):i.jsx("div",{className:"bg-gray-100 rounded-lg animate-pulse flex items-center justify-center",style:{width:n,height:n},children:i.jsx("div",{className:"text-gray-400",children:"Loading..."})})},Uxe="/assets/Ready-to-Share%20Social%20Media%20Posts%20to%20Amplify%20Your%20Brand%20on%20Pinterest-DaRwwLah.jpeg";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vxe=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kH=(...r)=>r.filter((n,o,l)=>!!n&&n.trim()!==""&&l.indexOf(n)===o).join(" ").trim();/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Bxe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wxe=O.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:u="",children:m,iconNode:g,...E},y)=>O.createElement("svg",{ref:y,...Bxe,width:n,height:n,stroke:r,strokeWidth:l?Number(o)*24/Number(n):o,className:kH("lucide",u),...E},[...g.map(([x,S])=>O.createElement(x,S)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=(r,n)=>{const o=O.forwardRef(({className:l,...u},m)=>O.createElement(Wxe,{ref:m,iconNode:n,className:kH(`lucide-${Vxe(r)}`,l),...u}));return o.displayName=`${r}`,o};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gxe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],LH=vn("Bell",Gxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hxe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],MH=vn("Check",Hxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zxe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Kxe=vn("ChevronLeft",zxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qxe=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Yxe=vn("ChevronRight",qxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $xe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],FH=vn("Copy",$xe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xxe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],UH=vn("EllipsisVertical",Xxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jxe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],VH=vn("Ellipsis",Jxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qxe=[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]],BH=vn("Flag",Qxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zxe=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],ebe=vn("MicOff",Zxe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tbe=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],sbe=vn("Mic",tbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rbe=[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]],nbe=vn("PhoneOff",rbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ibe=[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]],WH=vn("Reply",ibe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const abe=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],GH=vn("Settings",abe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const obe=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],HH=vn("Trash2",obe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cbe=[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 19h-6",key:"vcuq98"}]],zH=vn("UserRoundMinus",cbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lbe=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],dbe=vn("VideoOff",lbe);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ube=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],hbe=vn("Video",ube),pbe=({testimonials:r,autoplay:n=!1,className:o=""})=>{const[l,u]=O.useState(0),m=()=>{u(S=>(S+1)%r.length)},g=()=>{u(S=>(S-1+r.length)%r.length)};O.useEffect(()=>{if(!n)return;const S=setInterval(m,5e3);return()=>clearInterval(S)},[n]);const E=S=>S===l,y=()=>Math.floor(Math.random()*21)-10,x=r[l];return i.jsx("div",{className:`max-w-sm md:max-w-4xl mx-auto px-4 md:px-8 lg:px-12 py-12 md:py-20 ${o}`,children:i.jsxs("div",{className:"relative grid grid-cols-1 gap-12 md:grid-cols-2 md:gap-20",children:[i.jsx("div",{children:i.jsx("div",{className:"relative h-72 w-full md:h-80",children:i.jsx(l6,{children:r.map((S,C)=>i.jsx(gc.div,{initial:{opacity:0,scale:.9,z:-100,rotate:y()},animate:{opacity:E(C)?1:.7,scale:E(C)?1:.95,z:E(C)?0:-100,rotate:E(C)?0:y(),zIndex:E(C)?999:r.length+2-C,y:E(C)?[0,-40,0]:0},exit:{opacity:0,scale:.9,z:100,rotate:y()},transition:{duration:.4,ease:"easeInOut"},className:"absolute inset-0 origin-bottom overflow-hidden rounded-3xl border border-[#E9ECEF] bg-white shadow-[var(--shadow-lg)]",children:i.jsx("img",{src:S.src,alt:S.name,draggable:!1,className:"h-full w-full object-cover object-center"})},S.src))})})}),i.jsxs("div",{className:"flex flex-col justify-between py-2",children:[i.jsx(l6,{mode:"wait",children:i.jsxs(gc.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:-20,opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[i.jsx("h3",{className:"text-2xl font-bold text-[#212529]",children:x.name}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:x.designation}),i.jsx("p",{className:"mt-6 text-base text-[#343A40] md:text-lg",children:x.quote})]},l)}),i.jsxs("div",{className:"mt-8 flex gap-4 md:mt-12",children:[i.jsx("button",{type:"button",onClick:g,className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#F1F3F5] text-[#212529] shadow-sm transition-transform duration-300 hover:-translate-x-0.5",children:i.jsx(Kxe,{className:"h-4 w-4"})}),i.jsx("button",{type:"button",onClick:m,className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#F1F3F5] text-[#212529] shadow-sm transition-transform duration-300 hover:translate-x-0.5",children:i.jsx(Yxe,{className:"h-4 w-4"})})]})]})]})})},Ix=[{name:"Priya Sharma",category:" Gamer",followers:"52K followers",priceRange:"120-360",avatar:"PS",highlight:"Speedruns & strategy coaching"},{name:"Rohan Gupta",category:" Chef",followers:"68K followers",priceRange:"90-280",avatar:"RG",highlight:"Teaches restaurant-style recipes"},{name:"Amit Singh",category:" Artist",followers:"74K followers",priceRange:"150-400",avatar:"AS",highlight:"Live sketching + portfolio reviews"},{name:"Neha Kapoor",category:" Life Coach",followers:"38K followers",priceRange:"200-420",avatar:"NK",highlight:"Career clarity & confidence boosts"},{name:"Arjun Mehta",category:" Musician",followers:"81K followers",priceRange:"110-300",avatar:"AM",highlight:"Song breakdowns + songwriting tips"},{name:"Sana Rao",category:" Fitness",followers:"46K followers",priceRange:"95-260",avatar:"SR",highlight:"At-home workouts & accountability"}],l7=["https://api.dicebear.com/7.x/personas/svg?seed=Priya%20Sharma&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Rohan%20Gupta&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Amit%20Singh&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Neha%20Kapoor&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Arjun%20Mehta&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Sana%20Rao&backgroundColor=f4e6ff"],mbe=Array.from({length:32}).map((r,n)=>{const o=Ix[n%Ix.length],l=l7[n%l7.length];return{id:`featured-${n}`,src:l,alt:o.name,title:o.name,description:`${o.category}  ${o.highlight}`}}),fbe=[{icon:"",title:"Pick Your Creator",description:"Find someone you want to meet. Could be a YouTuber, chef, gamer, or anyone awesome!",step:"1"},{icon:"",title:"Bid (It's Like an Auction)",description:"Place a bid to win a video call. The highest bid wins! Don't worry - if you lose, you get most of your money back!",step:"2"},{icon:"",title:"Meet Them on Video Call",description:"If you win, you get 5-10 minutes to chat one-on-one. How cool is that?!",step:"3"}],gbe=[{value:"1,247",label:"Happy Fans Joined"},{value:"200",label:"Video Meets Completed"},{value:"95%",label:"Success Rate (Fans Win)"}],_be=[{value:"89",label:"Creators Active Now"},{value:"4.5L",label:"Total Money Creators Earned"},{value:"10",label:"Minutes Average Meeting Time"},{value:"2-10",label:"Minutes Call Length Options"}],vbe=[{name:"Priya Sharma  Content Creator  52K followers",quote:"I've done brand deals, sponsorships, everything. But FanMeet is different. I actually get to TALK to my supporters. I earned 45,000 last month and it helps fund new content!",duration:"60 sec clip"},{name:"Rohan Verma  Gaming Streamer  48K followers",quote:"My fans are the reason I do this. FanMeet lets me give back. These 10-minute calls remind me why I started. Plus, the extra income upgrades my setup. Win-win!",duration:"75 sec clip"}],d7=[{id:"photo-1",quote:"Dreams come true! ",context:"Got cooking tips from Chef Amit!"},{id:"photo-2",quote:"Best birthday surprise ever ",context:"He sang my favourite song live!"},{id:"photo-3",quote:"She remembered my username!! ",context:"Finally spoke to my art icon"},{id:"photo-4",quote:"Career clarity in 10 minutes",context:"Life coach gave me a plan"},{id:"photo-5",quote:"We geeked out over anime ",context:"Felt like chatting with a friend"},{id:"photo-6",quote:"He reviewed my vlog setup ",context:"Got technical tips + motivation"}],u7=["https://api.dicebear.com/7.x/initials/svg?seed=Priya%20%7C%20Mumbai&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Rahul%20%7C%20Delhi&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Sneha%20%7C%20Bangalore&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Pooja%20%7C%20Pune&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Harsh%20%7C%20Ahmedabad&backgroundColor=050014&textColor=f4e6ff","https://api.dicebear.com/7.x/initials/svg?seed=Neeraj%20%7C%20India&backgroundColor=050014&textColor=f4e6ff"],h7=[{quote:"I've been following Chef Amit for 2 years on YouTube and never thought I'd get to talk to him personally. FanMeet made it possible! He gave me tips on starting my own food blog and even shared his secret recipe. Best 350 I ever spent. Thank you FanMeet! ",name:"Neha Kapoor, 26  Food Blogger  Mumbai",met:"Met: Chef Amit Gupta"},{quote:"As an introvert, I was scared to bid. But I really wanted career advice from Aditi. I won at 280. The call was so comfortable! She answered all my questions and even followed up with resources via email. Worth every rupee.",name:"Anonymous Fan, 23  Software Engineer",met:"Met: Aditi Sharma (Career Coach)"},{quote:"Booked a FanMeet for my little brother with his favourite tech creator. They both nerded out about gadgets for 10 minutes. He's still smiling a week later. 300 very well spent!",name:"Pooja Malhotra, 27  Pune",met:"Met: Tech with Raj"},{quote:"I used FanMeet to get feedback on my indie game from a gaming creator I admire. He gave me 3 actionable tips and shared my demo with his Discord server. Instant confidence boost!",name:"Harsh Patel, 21  Game Developer  Ahmedabad",met:"Met: Rohan Live"}],Ebe=[{icon:"",title:"Secure Payments",bullets:["All payments encrypted via Razorpay","Your card details never touch our servers","Same security as Amazon & Flipkart"],badge:"Razorpay Partner"},{icon:"",title:"Safe Refunds",bullets:["Get 90% back if you do not win","Instant & automatic  no forms to fill","1.2 lakh refunded with 98.5% success rate"],badge:"90% Refund Guarantee"},{icon:"",title:"Verified Creators",bullets:["Every creator manually approved by our team","Identity + social media checks","No fake accounts allowed"],badge:"Human Verified"},{icon:"",title:"24/7 Support",bullets:["Real humans reply within 2.3 hours","Email, chat, or call anytime","We stay with you till the call ends"],badge:"Always On"}],ybe=[{title:"Paid Events (Bidding)",description:"Highest bid wins a 5-10 minute one-on-one call.",highlights:["Starting bids at 50 or 100","If you lose, 90% is refunded automatically","Average winning bid 250-400"],story:"I bid 250 for a 10-minute call with my favourite YouTuber. I won! The other 22 bidders got 225 back. Losing would cost only 25  cheaper than a coffee!  Rahul, College Student, Delhi",cta:"Browse Paid Events"},{title:"Free Events (Lucky Draw)",description:"Zero cost entries for surprise video calls.",highlights:["0 entry  completely free","Random winner chosen, no risk at all","Calls last 5-10 minutes just like paid events"],story:"I joined a free draw for Chef Amit and actually got picked! No money spent, just pure luck.  Priya, Food Blogger, Mumbai",cta:"Join Free Draws"}],xbe=[{name:"Arjun Singh",role:"Founder",bio:"I once drove 8 hours to meet my favourite musician. Worth it. Now I help others meet their heroes from the couch!",funFact:"Biggest fan of Samay Raina"},{name:"Priya Mehta",role:"Co-Founder",bio:"Former food blogger (15K followers). I know both sides of the fan-creator equation. We built this for YOU.",funFact:"Made 47 prototypes before the final design"},{name:"Rahul Verma",role:"Tech Lead",bio:"I make sure calls never lag and payments stay secure. Boring? Yes. Important? Also yes.",funFact:"Fixed a bug at 3 AM while eating Maggi"},{name:"Neha Kapoor",role:"Customer Support",bio:"I reply to every email personally. Got a question? I am on it!",funFact:"Fastest typer in the team (110 WPM)"},{name:"Amit Gupta",role:"Marketing",bio:"I find awesome creators, make memes, and keep the community buzzing.",funFact:"Binged 200 YouTube channels for research"},{name:"Sneha Sharma",role:"Operations",bio:"I approve creator applications and keep every event running smooth.",funFact:"Interviewed 89 creators personally"}],p7=["https://api.dicebear.com/7.x/personas/svg?seed=Arjun%20Singh&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Priya%20Mehta&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Rahul%20Verma&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Neha%20Kapoor%20Support&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Amit%20Gupta%20Marketing&backgroundColor=f4e6ff","https://api.dicebear.com/7.x/personas/svg?seed=Sneha%20Sharma%20Ops&backgroundColor=f4e6ff"],bbe=xbe.map((r,n)=>({quote:r.bio,name:r.name,designation:r.role,src:p7[n%p7.length]})),wbe=[{category:"Fans",question:"What if I don't win the bid?",answer:"You automatically get 90% of your money back within 5-7 business days. If you bid 200, you only risk 20  less than a movie ticket!"},{category:"Fans",question:"How do I know creators are real?",answer:"Every creator is manually verified by our team. We check social media, identity, and test their video setup. No fake accounts allowed."},{category:"Fans",question:"What can I talk about in the call?",answer:"Anything! Ask questions, get advice, request shoutouts, share your story. It's your 10 minutes. Just be kind and respectful."},{category:"Fans",question:"What if my internet is bad?",answer:"Our video software works on 3G/4G. If there is a technical issue on our end, you get 100% refund or a reschedule  your choice."},{category:"Creators",question:"How do payouts work?",answer:"You keep 90% of the winning bid. Withdraw anytime via UPI or bank transfer. We process payouts within 2-3 business days."},{category:"Creators",question:"What if a fan is rude?",answer:"End the call immediately. We ban that user and you still keep your earnings. Your safety comes first."},{category:"Creators",question:"Do I need lots of followers?",answer:"If you have 1,000+ followers or a unique skill people want to learn, you are good to go. Smaller creators often get more bids!"},{category:"General",question:"Is FanMeet available outside India?",answer:"Right now we are India-only, but the waitlist is open. Drop your email and we will notify you when we expand."},{category:"General",question:"How is this different from Cameo?",answer:"Cameo is pre-recorded videos. FanMeet is live, two-way conversations. Ask follow-ups, share screens, and build a real connection."}],Sbe=[{type:"press",name:"YourStory",quote:"FanMeet is building Indias most intimate creator-fan marketplace.",url:"#"},{type:"press",name:"Inc42",quote:"A refreshing take on live interactions. Fans are bidding for moments, not merch.",url:"#"},{type:"social",name:"@creatorsneha",quote:"Just wrapped my third FanMeet. Tears, laughs, and a fan who wants to start creating again. ",url:"#"},{type:"social",name:"@chefamit",quote:"FanMeet calls feel like cooking with friends. 25 bids last night!",url:"#"}],Cbe=[{feature:"Real-time interaction",fanmeet:" Yes",social:" One-way comments",cameo:" Pre-recorded"},{feature:"Two-way conversation",fanmeet:" Talk & listen",social:" No",cameo:" No"},{feature:"Length of experience",fanmeet:"5-10 minutes",social:"Few seconds",cameo:"30-60 seconds"},{feature:"Ask follow-up questions",fanmeet:" Unlimited",social:" Maybe answered",cameo:" No"},{feature:"Typical price",fanmeet:"50-400",social:"Free (ignored)",cameo:"500-5000"},{feature:"Refund if you do not win",fanmeet:" 90-100%",social:"N/A",cameo:" No"}],Tbe=[{title:"From Fan to Friend",before:"Rahul followed gaming creator Rohan for 3 years without a single reply.",during:"He won a 320 bid and spent 10 minutes discussing streaming tips.",after:"Rohan now recognizes Rahul in chat and they exchange DMs about upcoming games. Confidence boosted x100."},{title:"Career-Changing Advice",before:"Priya was torn between UX design and product management.",during:"She paid 400 to chat with a career coach creator who mapped a 90-day plan.",after:"Priya launched her own service studio within two months. Her first paying client came from that creators recommendation."},{title:"Gift That Made Her Cry",before:"Amit wanted a meaningful birthday surprise for his partner, an art lover.",during:"He booked a FanMeet with her favourite illustrator who live-sketched her while they talked.",after:"She cried happy tears and the sketch now hangs in their living room."}],Nbe=({titleComponent:r,children:n})=>{const o=O.useRef(null),{scrollYProgress:l}=kxe({target:o}),[u,m]=O.useState(!1);O.useEffect(()=>{const S=()=>{typeof window<"u"&&m(window.innerWidth<=768)};return S(),window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}},[]);const g=u?[.9,1]:[1.05,1],E=SN(l,[0,1],[20,0]),y=SN(l,[0,1],g),x=SN(l,[0,1],[0,-80]);return i.jsx("div",{className:"h-[38rem] md:h-[49rem] flex justify-center relative px-2 md:px-16",ref:o,children:i.jsxs("div",{className:"py-5 md:py-8 w-full relative",style:{perspective:"1000px"},children:[i.jsx(Rbe,{translate:x,titleComponent:r}),i.jsx(Abe,{rotate:E,scale:y,children:n})]})})},Rbe=({translate:r,titleComponent:n})=>i.jsx(gc.div,{style:{translateY:r},className:"max-w-5xl mx-auto text-center mb-6 md:mb-8",children:n}),Abe=({rotate:r,scale:n,children:o})=>i.jsx(gc.div,{style:{rotateX:r,scale:n,boxShadow:"0 0 #0000004d, 0 9px 20px #0000004a, 0 37px 37px #00000042, 0 84px 50px #00000026, 0 149px 60px #0000000a, 0 233px 65px #00000003"},className:"max-w-5xl mx-auto h-[28rem] md:h-[38rem] w-full border-4 border-[#6C6C6C] p-3 md:p-6 bg-[#222222] rounded-[30px] shadow-2xl",children:i.jsx("div",{className:"h-full w-full overflow-hidden rounded-2xl bg-gray-100 dark:bg-zinc-900 flex",children:o})});function Ibe(){const r=Ss(),[n,o]=O.useState("All"),[l,u]=O.useState(!1),[m,g]=O.useState(!1),E=n==="All"?Ix:Ix.filter(y=>y.category.toLowerCase().includes(n.toLowerCase()));return i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("section",{className:"relative overflow-hidden bg-[#050014] text-white",children:[i.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(0,213,255,0.32)_0,_transparent_55%),radial-gradient(circle_at_bottom,_rgba(236,72,153,0.32)_0,_transparent_55%)]"}),i.jsxs("div",{className:"relative z-10 mx-auto flex max-w-none flex-col px-2 pb-4 pt-6 md:max-w-7xl md:px-8 md:pb-6 md:pt-8",children:[i.jsxs("div",{className:"flex items-center justify-between text-white",children:[i.jsxs("div",{className:"flex items-center gap-6 md:gap-10",children:[i.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold md:text-xl",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] shadow-[0_0_25px_rgba(192,69,255,0.6)]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsxs("nav",{className:"hidden items-center gap-6 text-sm font-medium text-white/80 md:flex",children:[i.jsx("button",{type:"button",onClick:()=>r("/browse-events"),className:"transition-colors hover:text-white",children:"Browse Events"}),i.jsx("button",{type:"button",onClick:()=>r("/how-it-works"),className:"transition-colors hover:text-white",children:"How It Works"}),i.jsx("button",{type:"button",onClick:()=>r("/for-creators"),className:"transition-colors hover:text-white",children:"For Creators"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{type:"button",className:"hidden rounded-full border border-white/30 bg-black/40 px-4 py-1.5 text-xs font-medium text-white shadow-lg backdrop-blur-xl transition-all hover:-translate-y-0.5 hover:border-white hover:bg-black/60 hover:shadow-[0_0_25px_rgba(255,255,255,0.6)] md:inline-flex",onClick:()=>r("/auth"),children:"Log in"}),i.jsx("button",{type:"button",className:"hidden rounded-full border-2 border-transparent bg-gradient-to-r from-[#A78BFA] via-[#C084FC] to-[#E0E7FF] bg-clip-border px-4 py-1.5 text-xs font-semibold text-[#050014] shadow-lg transition-all hover:-translate-y-0.5 hover:shadow-[0_0_35px_rgba(167,139,250,0.5)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#E6FF00] md:inline-flex",style:{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"},onClick:()=>r("/auth"),children:"Sign up"}),i.jsxs("button",{type:"button",className:"flex items-center justify-center rounded-full border border-white/40 bg-black/40 p-2 text-white shadow-md backdrop-blur-xl transition-colors md:hidden",onClick:()=>g(y=>!y),children:[i.jsx("span",{className:"sr-only",children:"Toggle navigation"}),i.jsxs("div",{className:"flex flex-col gap-[3px]",children:[i.jsx("span",{className:"h-[2px] w-4 bg-white"}),i.jsx("span",{className:"h-[2px] w-4 bg-white"}),i.jsx("span",{className:"h-[2px] w-4 bg-white"})]})]})]})]}),m&&i.jsxs("div",{className:"mt-3 flex flex-col gap-2 rounded-2xl border border-white/20 bg-black/70 p-4 text-sm md:hidden",children:[i.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),r("/browse-events")},children:"Browse Events"}),i.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),r("/how-it-works")},children:"How It Works"}),i.jsx("button",{type:"button",className:"w-full rounded-full bg-white/10 px-4 py-2 text-left font-medium text-white hover:bg-white/20",onClick:()=>{g(!1),r("/for-creators")},children:"For Creators"}),i.jsxs("div",{className:"mt-1 flex flex-col gap-2",children:[i.jsx("button",{type:"button",className:"w-full rounded-full border border-white/40 bg-black/60 px-4 py-2 text-center text-xs font-medium text-white hover:bg-black/80",onClick:()=>{g(!1),r("/auth")},children:"Log in"}),i.jsx("button",{type:"button",className:"w-full rounded-full border-2 border-transparent px-4 py-2 text-center text-xs font-semibold text-[#050014] shadow-md hover:shadow-[0_0_25px_rgba(167,139,250,0.5)]",style:{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"},onClick:()=>{g(!1),r("/auth")},children:"Sign up"})]})]}),i.jsxs(gc.div,{className:"mt-6 flex flex-col gap-8 md:mt-12 md:flex-row md:items-stretch",initial:{opacity:0,y:32},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[i.jsxs("div",{className:"flex w-full flex-col md:w-1/2 lg:w-3/5",children:[i.jsxs("div",{className:"max-w-xl space-y-6",children:[i.jsx("p",{className:"inline-block text-xl font-normal text-white/90 drop-shadow-[0_8px_30px_rgba(0,0,0,0.8)] sm:text-2xl",style:{fontFamily:"cursive"},children:"meet your favourite creators on fanmet"}),i.jsxs("h1",{className:"text-4xl font-extrabold leading-tight sm:text-5xl lg:text-6xl",children:["Live 1:1 video calls",i.jsx("span",{className:"block text-[#FACC15]",children:"with the people you actually care about."})]}),i.jsx("div",{className:"h-1 w-24 rounded-full bg-gradient-to-r from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("p",{className:"max-w-lg text-sm text-white/80 sm:text-base",children:"Bid in tiny live auctions to win 510 minute video hangs with creators, gamers, chefs, coaches and other internet favourites. If you don't win, you get most of your money back."}),i.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[i.jsx("button",{type:"button",onClick:()=>r("/fan"),className:"inline-flex items-center justify-center rounded-full border-2 border-transparent px-7 py-3 text-sm font-semibold text-[#050014] shadow-[0_18px_50px_rgba(0,0,0,0.7)] transition-transform duration-200 hover:-translate-y-1 hover:shadow-[0_24px_70px_rgba(167,139,250,0.6)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#E6FF00] focus-visible:ring-offset-2",style:{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"},children:"Explore live meets"}),i.jsxs("button",{type:"button",onClick:()=>{const y=document.getElementById("how-it-works");y&&y.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center justify-center rounded-full border border-white/40 bg-black/40 px-5 py-2.5 text-sm font-medium text-white shadow-md backdrop-blur-xl transition-transform duration-200 hover:-translate-y-0.5 hover:bg-black/70",children:[i.jsx("span",{className:"mr-2 text-base",children:""}),"How FanMeet works"]})]})]}),i.jsxs("div",{className:"mt-4 grid gap-4 text-xs text-white/80 sm:grid-cols-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#22C55E]/20 text-sm",children:""}),i.jsx("span",{children:"90% refund if you don't win the bid."})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#00D5FF]/20 text-sm",children:""}),i.jsx("span",{children:"Verified creators, safe payments, no fake profiles."})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-[#EC4899]/20 text-sm",children:""}),i.jsx("span",{children:"Built in India for Indian fans & creators."})]})]})]}),i.jsx(gc.div,{className:"hidden w-full h-[280px] md:block md:h-[440px] md:w-1/2 lg:h-[530px] lg:w-2/5",initial:{clipPath:"polygon(100% 0, 100% 0, 100% 100%, 100% 100%)"},animate:{clipPath:"polygon(25% 0, 100% 0, 100% 100%, 0% 100%)"},transition:{duration:1.2,ease:"circOut"},children:i.jsxs("div",{className:"h-full w-full overflow-hidden rounded-[32px] shadow-[0_28px_80px_rgba(0,0,0,0.85)]",children:[i.jsx("img",{src:Uxe,alt:"FanMeet colourful hero",className:"h-full w-full object-cover"}),i.jsx("div",{className:"hidden h-full w-full rounded-[32px] bg-gradient-to-t from-black/60 via-black/10 to-transparent md:block"})]})})]})]})]}),i.jsx("section",{id:"how-it-works",className:"bg-white px-6 py-16 md:px-16 md:py-24",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#140423]",children:"Scroll through how FanMeet works"}),i.jsx("p",{className:"mt-2 text-base text-[#4A3B78]",children:"Cards stack as you scroll, revealing every piece of the fan-meet journey  from bidding to posting your own events."})]}),i.jsxs("div",{className:"mt-8 grid gap-6 md:grid-cols-3",children:[i.jsx(gc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#FF6B9D] via-[#FFC46B] to-[#E6FF00] p-[1px] shadow-[0_18px_45px_rgba(255,107,157,0.55)]",whileHover:{y:-12,rotateX:3,rotateY:-3},transition:{type:"spring",stiffness:220,damping:20},children:i.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#C045FF]",children:"Step 1"}),i.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"How it works"}),i.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Browse upcoming events, pick your creator, and place a bid to win a live 1:1 video call."}),i.jsx("ul",{className:"mt-4 space-y-2 text-sm text-[#4A3B78]",children:fbe.map(y=>i.jsxs("li",{className:"flex gap-2",children:[i.jsx("span",{className:"mt-0.5 text-base",children:y.icon}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-[#140423]",children:y.title}),i.jsx("p",{className:"text-xs text-[#6C5A9C]",children:y.description})]})]},y.step))})]})}),i.jsx(gc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#FFE66B] via-[#E6FF00] to-[#00F0FF] p-[1px] shadow-[0_18px_45px_rgba(0,240,255,0.45)]",whileHover:{y:-12,rotateX:3,rotateY:3},transition:{type:"spring",stiffness:220,damping:20},children:i.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#00A3FF]",children:"Step 2"}),i.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"Featured creators"}),i.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Discover creators across categories. Tap a chip to filter the grid."}),i.jsx("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:["All","Beauty","Cosplay","Fitness","Music","Sports","Gaming"].map(y=>i.jsx("button",{type:"button",onClick:()=>o(y),className:"rounded-full px-3 py-1 font-medium transition-colors "+(n===y?"bg-[#140423] text-white":"bg-white/80 text-[#4A3B78] hover:bg-white"),children:y},y))}),i.jsx("div",{className:"mt-4 grid gap-3 text-xs text-[#4A3B78] md:grid-cols-2",children:E.slice(0,4).map(y=>i.jsxs("div",{className:"flex items-center gap-2 rounded-2xl bg-[#F8F5FF] px-3 py-2",children:[i.jsx(gi,{initials:y.avatar,size:"sm"}),i.jsxs("div",{className:"min-w-0",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[i.jsx("p",{className:"text-xs font-semibold text-[#140423]",children:y.name}),i.jsx($e,{variant:"primary",className:"px-2 py-0.5 text-[9px] leading-tight",children:"Verified"})]}),i.jsxs("p",{className:"text-[11px] text-[#6C5A9C]",children:[y.category,"  ",y.followers]}),i.jsxs("p",{className:"text-[11px] text-[#C045FF]",children:["From ",y.priceRange]})]})]},y.name))})]})}),i.jsx(gc.article,{className:"relative w-full overflow-hidden rounded-3xl bg-gradient-to-br from-[#00F0FF] via-[#6B6BFF] to-[#C045FF] p-[1px] shadow-[0_18px_45px_rgba(107,107,255,0.55)]",whileHover:{y:-12,rotateX:-3,rotateY:3},transition:{type:"spring",stiffness:220,damping:20},children:i.jsxs("div",{className:"flex h-full flex-col rounded-[26px] bg-white/95 p-5 text-left",children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-[0.16em] text-[#C045FF]",children:"Step 3"}),i.jsx("h3",{className:"text-lg font-semibold text-[#140423]",children:"Get verified as a creator"}),i.jsx("p",{className:"mt-2 text-sm text-[#4A3B78]",children:"Apply once, get verified, and start hosting paid or free fan meets from anywhere."}),i.jsxs("ul",{className:"mt-4 space-y-2 text-sm text-[#4A3B78]",children:[i.jsx("li",{children:" 1K+ followers or a unique skill people want to learn"}),i.jsx("li",{children:" Simple KYC & social verification by our team"}),i.jsx("li",{children:" 90% payout on every winning bid  no hidden fees"})]}),i.jsx("button",{type:"button",onClick:()=>r("/creator"),className:"mt-4 inline-flex items-center justify-center rounded-full bg-white px-4 py-2 text-xs font-semibold text-[#140423] shadow-md transition-transform hover:-translate-y-0.5",children:"Apply to get verified"})]})})]})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"featured",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl flex-col items-center gap-10",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Who Can You Meet on FanMeet?"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"We have creators from every field!"})]}),i.jsx("div",{className:"flex w-full flex-col items-center justify-center",children:i.jsx("div",{className:"w-[250px] h-[250px] md:w-[420px] md:h-[420px] flex items-center justify-center",children:i.jsx(Fxe,{images:mbe,containerSize:280,sphereRadius:130,autoRotate:!0,autoRotateSpeed:.35,dragSensitivity:.7,className:"mx-auto"})})})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#00D5FF_0,_#050014_50%),radial-gradient(circle_at_bottom,_#F97316_0,_#050014_55%)] px-6 py-16 md:px-16",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-12 text-center",children:[i.jsx("h2",{className:"mb-4 text-3xl font-bold text-white",children:"Join Thousands of Happy Fans! "}),i.jsx("p",{className:"text-lg text-[#ADB5BD]",children:"Real numbers from real people having real conversations"})]}),i.jsx("div",{className:"grid gap-8 md:grid-cols-2 lg:grid-cols-4",children:gbe.map(y=>i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"mb-2 text-4xl font-bold text-[#FACC15]",children:y.value}),i.jsx("div",{className:"text-sm text-[#ADB5BD]",children:y.label})]},y.label))}),i.jsx("div",{className:"mt-8 grid gap-8 md:grid-cols-2 lg:grid-cols-4",children:_be.map(y=>i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"mb-2 text-4xl font-bold text-[#22C55E]",children:y.value}),i.jsx("div",{className:"text-sm text-[#ADB5BD]",children:y.label})]},y.label))})]})}),i.jsxs("section",{className:"relative overflow-hidden bg-[#050014] px-6 py-16 text-white md:px-16 md:py-24",children:[i.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(0,213,255,0.32)_0,_transparent_55%),radial-gradient(circle_at_bottom,_rgba(236,72,153,0.32)_0,_transparent_55%)]"}),i.jsxs("div",{className:"relative z-10 mx-auto flex max-w-6xl flex-col gap-10 md:grid md:grid-cols-[minmax(0,1.1fr)_minmax(0,1.1fr)] md:items-center",children:[i.jsxs("div",{className:"space-y-4 text-left text-white",children:[i.jsx("p",{className:"inline-flex items-center rounded-full bg-white/10 px-3 py-1 text-xs font-medium uppercase tracking-[0.16em] text-[#E6FF00] backdrop-blur-md",children:"LIVE DEMO"}),i.jsx("h2",{className:"text-3xl font-extrabold leading-tight sm:text-4xl lg:text-[2.6rem]",children:"See how a real FanMeet feels in under 2 minutes"}),i.jsx("p",{className:"max-w-xl text-sm text-white/80 sm:text-base",children:"Watch a real fan bid, win, and jump into a live video call with their favourite creator. No scripts, no actors  just genuine reactions."}),i.jsxs("ul",{className:"mt-4 space-y-2 text-sm text-white/80",children:[i.jsx("li",{children:" What the bidding screen looks like in action"}),i.jsx("li",{children:" How we keep calls safe, timed, and high-quality"}),i.jsx("li",{children:" The moment a fan realises their call is actually happening"})]})]}),i.jsx("div",{className:"relative mx-auto w-full max-w-3xl",children:i.jsx("div",{className:"relative overflow-hidden rounded-[28px] bg-black/40 p-[2px] shadow-[0_20px_60px_rgba(5,0,20,0.7)]",children:i.jsx("div",{className:"relative aspect-video w-full overflow-hidden rounded-[24px] bg-black",children:l?i.jsx("iframe",{className:"h-full w-full",src:"https://www.youtube.com/embed/S5IQtZlgNC8?autoplay=1&rel=0&modestbranding=1",title:"FanMeet overview video",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):i.jsxs("button",{type:"button",onClick:()=>u(!0),className:"group relative h-full w-full",children:[i.jsx("img",{src:"https://cdn.prod.website-files.com/62c48d78ef34931f8a604ef5/67630876396363c467036ede_video-poster.webp",alt:"FanMeet overview video preview",className:"h-full w-full object-cover opacity-90 transition-opacity group-hover:opacity-100"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"}),i.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 text-center text-white",children:[i.jsxs("div",{className:"inline-flex items-center gap-3 rounded-full bg-white/10 px-4 py-2 text-xs font-medium backdrop-blur-md",children:[i.jsx("span",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-white text-sm font-semibold text-[#C045FF] shadow-lg",children:""}),i.jsx("span",{className:"text-xs sm:text-sm",children:"Play 2 min overview"})]}),i.jsx("p",{className:"max-w-md text-xs text-white/80 sm:text-sm",children:'"This feels like a private show with your favourite creator. I forgot we were on camera."  real fan'})]})]})})})})]})]}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",children:i.jsxs("div",{className:"mx-auto max-w-5xl",children:[i.jsxs("div",{className:"mb-12 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Creators Love FanMeet Too"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Hear how meaningful conversations boost their community and income"})]}),i.jsx("div",{className:"grid gap-8 md:grid-cols-2",children:vbe.map(y=>i.jsxs(me,{elevated:!0,className:"overflow-hidden border border-[#E9ECEF]",children:[i.jsx("div",{className:"relative aspect-[16/9] bg-gradient-to-br from-[#212529] via-[#343A40] to-[#212529]",children:i.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i.jsxs("span",{className:"rounded-full bg-white px-4 py-2 text-sm font-semibold text-[#C045FF] shadow",children:[" ",y.duration]})})}),i.jsxs(ve,{className:"flex flex-col gap-4 p-6",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:y.name}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["",y.quote,""]})]})]},y.name))})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-16 md:px-16",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Real FanMeets"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Real moments and reactions captured from live FanMeet calls."})]}),i.jsx("div",{className:"flex flex-col gap-6 md:gap-8",children:Array.from({length:6}).map((y,x)=>{const S=d7[x%d7.length],C=h7[x%h7.length],N=u7[x%u7.length];return i.jsx(Nbe,{titleComponent:i.jsxs("div",{className:"mt-6 md:mt-0",children:[i.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:["Real FanMeet #",x+1]}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:S.context})]}),children:i.jsx("div",{className:"flex h-full",children:i.jsxs("div",{className:"flex h-full flex-col md:flex-row gap-4 rounded-2xl bg-white p-3 md:p-4 shadow-md border border-[#F1F3F5] w-full",children:[i.jsx("div",{className:"w-full md:w-1/2",children:i.jsx("div",{className:"h-full w-full overflow-hidden rounded-xl",children:i.jsx("img",{src:N,alt:S.context,className:"h-full w-full object-cover"})})}),i.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:"Full Review"}),i.jsxs("p",{className:"mt-2 text-sm font-semibold text-[#212529]",children:["",C.quote,""]})]}),i.jsxs("div",{className:"mt-3 flex flex-col gap-1 text-xs text-[#6C757D]",children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:C.name}),i.jsx("span",{children:C.met}),i.jsxs("span",{className:"text-[11px] text-[#868E96]",children:["Moment: ",S.context]}),i.jsx("span",{className:"flex items-center gap-1 text-[#C045FF]",children:"".split("").map((M,G)=>i.jsx("span",{children:M},`${S.id}-star-${G}`))})]})]})]})})},`${S.id}-scroll-${x}`)})})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"trust",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Trust Comes First"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"We built FanMeet to be safe, secure, and fan-friendly from day one."})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-4",children:Ebe.map(y=>i.jsx(me,{elevated:!0,className:"h-full border border-[#F1F3F5]",children:i.jsxs(ve,{className:"flex h-full flex-col gap-4 p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 text-[#C045FF]",children:[i.jsx("span",{className:"text-2xl",children:y.icon}),i.jsx("span",{className:"text-sm font-semibold uppercase tracking-wide text-[#6C757D]",children:y.badge})]}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.title}),i.jsx("ul",{className:"space-y-2 text-sm text-[#6C757D]",children:y.bullets.map(x=>i.jsxs("li",{className:"flex gap-2",children:[i.jsx("span",{className:"text-[#C045FF]",children:""}),i.jsx("span",{children:x})]},x))})]})},y.title))})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#ECFEFF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"pricing",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-12 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Two Ways to Meet Your Heroes"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Whether you want to bid or try your luck, FanMeet keeps it fair and transparent."})]}),i.jsx("div",{className:"grid gap-8 md:grid-cols-2",children:ybe.map(y=>i.jsxs(me,{elevated:!0,className:"border border-[#E9ECEF] bg-white",children:[i.jsx(Ce,{title:y.title,subtitle:y.description,className:"border-b border-[#F1F3F5]"}),i.jsxs(ve,{className:"flex flex-col gap-4 p-6",children:[i.jsx("ul",{className:"space-y-3 text-sm text-[#212529]",children:y.highlights.map(x=>i.jsxs("li",{className:"flex gap-2",children:[i.jsx("span",{className:"text-[#C045FF]",children:""}),i.jsx("span",{children:x})]},x))}),i.jsx("p",{className:"rounded-[14px] bg-[#FFF3ED] p-4 text-sm text-[#6C757D]",children:y.story}),i.jsx(oe,{className:"mt-2 w-full",variant:"secondary",children:y.cta})]})]},y.title))})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#ECFEFF_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"team",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsx("div",{className:"mb-8 text-center",children:i.jsx("h2",{className:"text-3xl font-bold tracking-[0.25em] text-[#212529]",children:"ABOUT US"})}),i.jsx(pbe,{testimonials:bbe,autoplay:!0})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"faq",children:i.jsxs("div",{className:"mx-auto max-w-5xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Questions? We Already Answered Them."}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Everything fans and creators ask before hitting that Bid or Apply button."})]}),i.jsx("div",{className:"flex flex-col gap-4",children:wbe.map(y=>i.jsxs("details",{className:"group rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between gap-4 text-left text-sm font-semibold text-[#212529]",children:[i.jsxs("span",{className:"text-[#C045FF]",children:["[",y.category,"]"]}),i.jsx("span",{className:"flex-1 text-[#212529]",children:y.question}),i.jsx("span",{className:"text-[#ADB5BD] transition-transform group-open:rotate-45",children:"+"})]}),i.jsx("p",{className:"mt-3 text-sm text-[#6C757D]",children:y.answer})]},`${y.category}-${y.question}`))})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#00D5FF_0,_#050014_50%),radial-gradient(circle_at_bottom,_#EC4899_0,_#050014_55%)] px-6 py-20 text-white md:px-16",id:"press",children:i.jsxs("div",{className:"mx-auto max-w-6xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold",children:"People Are Talking About FanMeet"}),i.jsx("p",{className:"mt-2 text-base text-[#CED4DA]",children:"Press features, creator shoutouts, and community buzz."})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:Sbe.map(y=>i.jsx(me,{className:"border border-[#343A40] bg-[#2C3036]",children:i.jsxs(ve,{className:"flex flex-col gap-3 p-6",children:[i.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#C045FF]",children:y.type==="press"?"As Seen In":"From the Community"}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.name}),i.jsx("p",{className:"text-sm text-[#212529]",children:y.quote}),i.jsx(oe,{variant:"ghost",className:"self-start px-0 text-sm text-[#C045FF]",children:"Read more "})]})},`${y.type}-${y.name}`))})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#ECFEFF_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",id:"comparison",children:i.jsxs("div",{className:"mx-auto max-w-5xl",children:[i.jsxs("div",{className:"mb-8 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Why FanMeet Beats DMs and Cameo"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"The only place for real, two-way conversations with creators you admire."})]}),i.jsx("div",{className:"overflow-x-auto rounded-[18px] border border-[#E9ECEF]",children:i.jsxs("table",{className:"min-w-full divide-y divide-[#E9ECEF]",children:[i.jsx("thead",{className:"bg-[#F8F9FA] text-sm uppercase tracking-wide text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-4 py-3 text-left",children:"Feature"}),i.jsx("th",{className:"px-4 py-3 text-left text-[#C045FF]",children:"FanMeet"}),i.jsx("th",{className:"px-4 py-3 text-left",children:"Commenting"}),i.jsx("th",{className:"px-4 py-3 text-left",children:"Paid Shoutouts"})]})}),i.jsx("tbody",{className:"divide-y divide-[#F1F3F5] text-sm text-[#212529]",children:Cbe.map(y=>i.jsxs("tr",{className:"bg-white",children:[i.jsx("td",{className:"px-4 py-3 font-medium text-[#212529]",children:y.feature}),i.jsx("td",{className:"px-4 py-3 text-[#20C997]",children:y.fanmeet}),i.jsx("td",{className:"px-4 py-3 text-[#6C757D]",children:y.social}),i.jsx("td",{className:"px-4 py-3 text-[#6C757D]",children:y.cameo})]},y.feature))})]})}),i.jsx("p",{className:"mt-6 text-center text-sm text-[#6C757D]",children:"FanMeet is the only place to have a REAL conversation with creators you admire."})]})}),i.jsx("section",{className:"hidden bg-[radial-gradient(circle_at_top,_#FDF4FF_0,_#F8F9FA_55%),radial-gradient(circle_at_bottom,_#FFF7ED_0,_#F8F9FA_55%)] px-6 py-20 md:px-16",id:"success-stories",children:i.jsxs("div",{className:"mx-auto max-w-5xl",children:[i.jsxs("div",{className:"mb-10 text-center",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Three Stories You Will Brag About Later"}),i.jsx("p",{className:"mt-2 text-base text-[#6C757D]",children:"Real transformations from fans who hit Bid and never looked back."})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:Tbe.map(y=>i.jsx(me,{elevated:!0,className:"border border-[#E9ECEF]",children:i.jsxs(ve,{className:"flex h-full flex-col gap-3 p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:y.title}),i.jsxs("div",{className:"space-y-2 text-sm text-[#6C757D]",children:[i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"Before:"})," ",y.before]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"During:"})," ",y.during]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"After:"})," ",y.after]})]})]})},y.title))})]})}),i.jsx("section",{className:"bg-[radial-gradient(circle_at_top,_#FFF7ED_0,_#FFFFFF_55%),radial-gradient(circle_at_bottom,_#FDF4FF_0,_#FFFFFF_55%)] px-6 py-20 md:px-16",children:i.jsxs("div",{className:"mx-auto max-w-4xl rounded-[24px] border border-[#F1F3F5] bg-[radial-gradient(circle_at_top,_#FDF2EC_0,_#FFFFFF_70%)] p-10 text-center shadow-[var(--shadow-lg)]",children:[i.jsx("h2",{className:"text-3xl font-bold text-[#212529]",children:"Ready to Meet Your Hero?"}),i.jsx("p",{className:"mt-3 text-base text-[#6C757D]",children:"Join 1,247 people who already had life-changing conversations."}),i.jsxs("div",{className:"mt-6 flex flex-wrap justify-center gap-4",children:[i.jsx(oe,{size:"lg",className:"px-8 text-base",children:"Browse Events & Start Bidding "}),i.jsx(oe,{size:"lg",variant:"secondary",className:"px-8 text-base",children:"Apply to Become a Creator "})]}),i.jsxs("div",{className:"mt-6 grid gap-3 md:grid-cols-2",children:[i.jsx("div",{className:"rounded-[16px] bg-white p-4 text-sm text-[#6C757D]",children:"I bid 280, won the call, and my creator remembered me on stream a week later.  Neeraj, Pune"}),i.jsx("div",{className:"rounded-[16px] bg-white p-4 text-sm text-[#6C757D]",children:"Applications took 2 minutes. I now run weekly coaching calls and finally understand my fans.  Ananya, Creator"})]}),i.jsxs("div",{className:"mt-6 flex flex-wrap justify-center gap-4 text-xs text-[#6C757D]",children:[i.jsx("span",{children:" 90% Refund Guarantee"}),i.jsx("span",{children:" Verified Creators Only"}),i.jsx("span",{children:" Secure Payments"}),i.jsx("span",{children:" 24/7 Support"})]})]})})]})}const Dbe=[{title:"300+ creators onboarded",description:"Host exclusive AMA sessions, workshops, and meet & greets."},{title:"10k+ fan requests",description:"Fans are lining up for authentic, small-group interactions."}];function Obe(){const[r,n]=O.useState("login"),[o,l]=O.useState("fan"),[u,m]=O.useState(""),[g,E]=O.useState(""),[y,x]=O.useState(""),[S,C]=O.useState(""),[N,M]=O.useState(!1),[G,I]=O.useState(!1),[P,L]=O.useState({instagram:"",youtube:"",twitter:""}),R=Ss(),[D]=Gp(),{login:V,signup:W,resendVerificationEmail:q,isAuthenticated:H,user:J}=fs();O.useEffect(()=>{H&&J&&R({fan:"/fan",creator:"/creator",admin:"/admin"}[J.role],{replace:!0})},[H,J,R]);const ee=Object.values(P).some(ge=>ge.trim().length>0),ne=()=>{L({instagram:"",youtube:"",twitter:""})};O.useEffect(()=>{r==="login"&&ne()},[r]);const pe=async ge=>{if(ge.preventDefault(),!u.trim()||!g.trim()){x("Please enter both email and password.");return}if(r==="signup"&&!ee){x("Share at least one social media link so fans can verify you.");return}x(""),C(""),M(!0);try{const he={fan:"/fan",creator:"/creator",admin:"/admin"},le=r==="signup"?await W({email:u,password:g,role:o}):await V({email:u,password:g});if(r==="signup"&&await ie.from("profiles").update({instagram_url:P.instagram.trim()||null,youtube_url:P.youtube.trim()||null,twitter_url:P.twitter.trim()||null}).eq("user_id",le.id),r==="signup"){C("Account created. Please check your email to verify your account before logging in.");return}const Le=D.get("redirect"),fe=he[le.role],ae=Le&&Le.trim().length>0?Le:fe;R(ae,{replace:!0})}catch(he){let le="Something went wrong. Please try again.";he instanceof Error&&(le=he.message,(/already\s+(registered|exists)/i.test(le)||/user\s+already/i.test(le))&&I(!0)),x(le)}finally{M(!1)}},Ee=async()=>{if(x(""),C(""),!u.trim()){x("Enter your email first, then click resend.");return}M(!0);try{await q({email:u.trim()}),C("Verification email sent. Please check your inbox.")}catch(ge){x(ge instanceof Error?ge.message:"Could not resend verification email.")}finally{M(!1)}};return i.jsxs(i.Fragment,{children:[G&&i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4 py-10",children:i.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-6 text-center shadow-2xl",children:[i.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-[#F4E6FF] text-3xl",children:""}),i.jsx("h3",{className:"text-xl font-semibold text-[#050014]",children:"Account already exists"}),i.jsxs("p",{className:"mt-2 text-sm text-[#6C757D]",children:["Looks like ",u||"this email"," is already registered. Try logging in, or use another email to create a new account."]}),i.jsxs("div",{className:"mt-5 flex flex-col gap-2",children:[i.jsx(oe,{onClick:()=>{n("login"),I(!1)},children:"Go to login"}),i.jsx(oe,{variant:"secondary",onClick:()=>I(!1),children:"Use a different email"})]})]})}),i.jsxs("div",{className:"grid min-h-[calc(100vh-70px)] grid-cols-1 bg-gradient-to-b from-white to-[#F8F0FF] md:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]",children:[i.jsxs("section",{className:"relative hidden h-full w-full items-start justify-start bg-gradient-to-br from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] px-10 py-9 text-[#050014] md:flex",children:[i.jsxs("div",{className:"relative z-10 mx-auto flex max-w-xl flex-col gap-6",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-4 py-1 text-sm font-medium tracking-wide text-[#C045FF]",children:[i.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"})," LIVE MOMENTS  REAL CONNECTIONS"]}),i.jsx("h1",{className:"text-2xl font-bold leading-tight text-[#050014] md:text-3xl lg:text-4xl",children:"Bring creators and fans together through premium digital meetups"}),i.jsx("p",{className:"text-xs text-[#4B445F] md:text-sm lg:text-base",children:"Secure bidding, curated events, and rich creator tooling packaged in one vibrant platform."})]}),i.jsxs("div",{className:"hidden xl:flex xl:flex-col xl:gap-4",children:[i.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:Dbe.map(ge=>i.jsx(me,{className:"bg-white/10 backdrop-blur-md transition hover:bg-white/20",elevated:!0,children:i.jsxs("div",{className:"flex flex-col gap-2 p-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-[#050014]",children:ge.title}),i.jsx("p",{className:"text-sm text-[#4B445F]",children:ge.description})]})},ge.title))}),i.jsxs("div",{className:"relative mt-2",children:[i.jsx("img",{src:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=1200&q=80",alt:"Creators collaborating",className:"h-36 w-full rounded-3xl object-cover shadow-2xl shadow-[#C045FF]/40"}),i.jsx("div",{className:"absolute bottom-2 left-1/2 w-[85%] -translate-x-1/2 rounded-2xl bg-white/95 p-3 shadow-xl shadow-[#C045FF]/15",children:i.jsxs("div",{className:"flex items-center gap-2.5",children:[i.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-[#C045FF]/10 text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide text-[#C045FF]",children:"Creator Spotlight"}),i.jsx("p",{className:"text-sm text-[#212529]",children:"My fans love our micro-meet sessionsit feels personal and seamless."})]})]})})]})]})]}),i.jsx("div",{className:"absolute right-0 top-0 h-full w-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"})]}),i.jsx("section",{className:"flex items-start justify-center px-4 py-4 md:px-6 md:py-4",children:i.jsxs("div",{className:"flex w-full max-w-md flex-col gap-4 md:gap-3.5",children:[i.jsxs("div",{className:"flex flex-col gap-1.5 text-center md:text-left",children:[i.jsx(ro,{to:"/",className:"text-sm font-semibold text-[#C045FF]",children:" Back to home"}),i.jsx("h2",{className:"text-2xl font-bold text-[#212529] md:text-3xl",children:r==="login"?"Welcome back":"Create your FanMeet account"}),i.jsx("p",{className:"hidden text-sm text-[#6C757D] lg:block",children:r==="login"?"Sign in to manage your events, track bids, and stay close to your community.":"Sign up once to access your fan or creator dashboard and manage all your sessions."})]}),i.jsxs("form",{className:"flex flex-col gap-3",onSubmit:pe,children:[i.jsxs("div",{className:"flex items-center justify-between rounded-full bg-[#F1F3F5] p-1 text-xs font-medium text-[#495057]",children:[i.jsx("button",{type:"button",onClick:()=>{n("login"),x("")},className:Kd("flex-1 rounded-full px-3 py-1.5 transition-all",r==="login"?"bg-white text-[#212529] shadow-sm":"bg-transparent"),children:"Log in"}),i.jsx("button",{type:"button",onClick:()=>{n("signup"),x("")},className:Kd("flex-1 rounded-full px-3 py-1.5 transition-all",r==="signup"?"bg-white text-[#212529] shadow-sm":"bg-transparent"),children:"Sign up"})]}),i.jsx("div",{className:"flex flex-col gap-1.5",children:r==="signup"&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"text-sm font-medium text-[#212529]",children:"Sign up as"}),i.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"Fan",value:"fan",emoji:""},{label:"Creator",value:"creator",emoji:""}].map(ge=>i.jsxs("button",{type:"button",onClick:()=>l(ge.value),className:Kd("flex items-center gap-2.5 rounded-[14px] border-2 px-3.5 py-2.5 text-left transition-all","shadow-[var(--shadow-sm)] hover:shadow-[var(--shadow-md)]",o===ge.value?"border-[#C045FF] bg-[#F4E6FF] text-[#212529]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"),children:[i.jsx("span",{className:"text-lg",children:ge.emoji}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[13px] font-semibold",children:ge.label}),i.jsxs("p",{className:"text-[11px] text-[#6C757D]",children:[ge.value==="fan"&&"Bid, join meets, and manage your sessions.",ge.value==="creator"&&"Host immersive experiences and track earnings."]})]})]},ge.value))})]})}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx(nt,{label:"Email",placeholder:"you@example.com",type:"email",required:!0,value:u,onChange:ge=>m(ge.target.value)}),i.jsx(nt,{label:"Password",placeholder:"Enter your password",type:"password",required:!0,value:g,onChange:ge=>E(ge.target.value)}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("label",{className:"flex items-center gap-2 text-[#6C757D]",children:[i.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Remember me"]}),i.jsx(ro,{to:"/auth/forgot-password",className:"font-medium text-[#C045FF] hover:text-[#8B3FFF]",children:"Forgot password?"})]})]}),r==="signup"&&i.jsxs("div",{className:"rounded-2xl border border-[#E9ECEF] bg-white/80 p-4",children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:"Social proof (required)"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Add at least one link so fans can verify you."})]}),i.jsx($e,{variant:ee?"primary":"default",children:ee?"Ready":"Pending"})]}),i.jsxs("div",{className:"mt-4 grid gap-3",children:[i.jsx(nt,{label:"Instagram",placeholder:"https://instagram.com/yourhandle",value:P.instagram,onChange:ge=>L(he=>({...he,instagram:ge.target.value}))}),i.jsx(nt,{label:"YouTube",placeholder:"https://youtube.com/@yourchannel",value:P.youtube,onChange:ge=>L(he=>({...he,youtube:ge.target.value}))}),i.jsx(nt,{label:"Twitter / X",placeholder:"https://twitter.com/yourhandle",value:P.twitter,onChange:ge=>L(he=>({...he,twitter:ge.target.value}))}),!ee&&i.jsx("p",{className:"text-[11px] font-medium text-[#DC3545]",children:"Share at least one link to continue."})]})]}),y?i.jsx("p",{className:"text-[11px] font-medium text-[#DC3545]",children:y}):null,S?i.jsx("p",{className:"text-[11px] font-medium text-[#198754]",children:S}):null,i.jsx(oe,{type:"submit",size:"md",className:"h-9 text-[13px]",disabled:N||r==="signup"&&!ee,children:"Continue with email"}),r==="login"?i.jsx("button",{type:"button",className:"text-left text-[12px] font-medium text-[#C045FF] hover:text-[#8B3FFF]",onClick:Ee,disabled:N,children:"Resend verification email"}):null,i.jsxs("div",{className:"flex items-center gap-2.5",children:[i.jsx("span",{className:"h-px flex-1 bg-[#E9ECEF]"}),i.jsx("span",{className:"text-sm font-medium text-[#6C757D]",children:"or"}),i.jsx("span",{className:"h-px flex-1 bg-[#E9ECEF]"})]}),i.jsxs("div",{className:"grid gap-2",children:[i.jsx(oe,{variant:"secondary",size:"md",className:"h-9 text-[13px]",children:"Continue with Google"}),i.jsx(oe,{variant:"ghost",size:"md",className:"h-9 text-[13px]",children:"Continue with Apple"})]})]}),i.jsxs("p",{className:"hidden text-xs text-[#ADB5BD] lg:block",children:["By continuing, you agree to our"," ",i.jsx(ro,{to:"#",className:"font-medium text-[#C045FF]",children:"Terms of Service"})," ","and"," ",i.jsx(ro,{to:"#",className:"font-medium text-[#C045FF]",children:"Privacy Policy"}),"."]})]})})]})]})}function jbe(){const r=Ss(),[n,o]=O.useState(""),[l,u]=O.useState("idle"),[m,g]=O.useState(""),E=O.useMemo(()=>typeof window>"u"?"":`${window.location.origin}/auth/update-password`,[]),y=async x=>{if(x.preventDefault(),g(""),!n.trim()){g("Please enter your email.");return}u("sending");const{error:S}=await ie.auth.resetPasswordForEmail(n.trim(),{redirectTo:E});if(S){g(S.message||"Could not send reset email."),u("idle");return}u("sent")};return i.jsxs("div",{className:"mx-auto flex max-w-md flex-col gap-4 px-4 py-10",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(ro,{to:"/auth",className:"text-sm font-semibold text-[#C045FF]",children:" Back to login"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r("/"),children:"Home"})]}),i.jsxs(me,{elevated:!0,className:"p-5",children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Reset your password"}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"Enter your email and well send you a link to set a new password."}),i.jsxs("form",{className:"mt-4 flex flex-col gap-3",onSubmit:y,children:[i.jsx(nt,{label:"Email",type:"email",placeholder:"you@example.com",value:n,onChange:x=>o(x.target.value),required:!0}),m?i.jsx("p",{className:"text-xs font-medium text-[#DC3545]",children:m}):null,l==="sent"?i.jsx("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-3 text-sm text-[#6C757D]",children:"Reset link sent. Please check your inbox (and spam folder)."}):null,i.jsx(oe,{type:"submit",disabled:l==="sending",children:l==="sending"?"Sending":"Send reset link"})]})]})]})}function Pbe(){const r=Ss(),[n,o]=O.useState(""),[l,u]=O.useState(""),[m,g]=O.useState(""),[E,y]=O.useState("checking");O.useEffect(()=>{(async()=>{const{data:C}=await ie.auth.getSession();if(!C.session){y("idle"),g("This reset link is invalid or expired. Please request a new one.");return}y("ready")})()},[]);const x=async S=>{if(S.preventDefault(),g(""),!n.trim()||n.length<8){g("Password must be at least 8 characters.");return}if(n!==l){g("Passwords do not match.");return}y("saving");const{error:C}=await ie.auth.updateUser({password:n});if(C){g(C.message||"Could not update password."),y("ready");return}y("saved"),setTimeout(()=>r("/auth",{replace:!0}),800)};return i.jsxs("div",{className:"mx-auto flex max-w-md flex-col gap-4 px-4 py-10",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(ro,{to:"/auth",className:"text-sm font-semibold text-[#C045FF]",children:" Back to login"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r("/"),children:"Home"})]}),i.jsxs(me,{elevated:!0,className:"p-5",children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Set a new password"}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"Choose a strong password you havent used before."}),m?i.jsx("p",{className:"mt-3 text-xs font-medium text-[#DC3545]",children:m}):null,E==="idle"?i.jsx("div",{className:"mt-4",children:i.jsx(oe,{onClick:()=>r("/auth/forgot-password"),children:"Request new reset link"})}):i.jsxs("form",{className:"mt-4 flex flex-col gap-3",onSubmit:x,children:[i.jsx(nt,{label:"New password",type:"password",value:n,onChange:S=>o(S.target.value),placeholder:"At least 8 characters",required:!0}),i.jsx(nt,{label:"Confirm password",type:"password",value:l,onChange:S=>u(S.target.value),required:!0}),i.jsx(oe,{type:"submit",disabled:E!=="ready",children:E==="saving"?"Saving":E==="saved"?"Saved":"Update password"})]})]})]})}function kbe(){const r=Ss(),[n]=Gp(),[o,l]=O.useState("loading"),[u,m]=O.useState("Finishing sign-in");return O.useEffect(()=>{(async()=>{try{const E=n.get("code");if(E){const{error:x}=await ie.auth.exchangeCodeForSession(E);if(x){l("error"),m(x.message||"Could not complete authentication.");return}}const{data:y}=await ie.auth.getSession();if(!y.session){l("error"),m("No session found. Please try logging in again.");return}l("success"),m("Success! Redirecting"),setTimeout(()=>r("/auth",{replace:!0}),800)}catch{l("error"),m("Could not complete authentication.")}})()},[r,n]),i.jsx("div",{className:"mx-auto flex max-w-md flex-col gap-4 px-4 py-10",children:i.jsxs(me,{elevated:!0,className:"p-5",children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Auth Callback"}),i.jsx("p",{className:"mt-2 text-sm text-[#6C757D]",children:u}),o==="error"?i.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[i.jsx(oe,{onClick:()=>r("/auth",{replace:!0}),children:"Go to login"}),i.jsx(oe,{variant:"secondary",onClick:()=>r("/",{replace:!0}),children:"Home"})]}):null]})})}function Lbe(){const{login:r,isAuthenticated:n,user:o,logout:l}=fs(),[u,m]=O.useState(""),[g,E]=O.useState(""),[y,x]=O.useState(""),[S,C]=O.useState(!1),N=Ss();O.useEffect(()=>{n&&(o==null?void 0:o.role)==="admin"&&N("/admin",{replace:!0})},[n,o,N]);const M=async G=>{if(G.preventDefault(),!u.trim()||!g.trim()){x("Please enter both email and password.");return}x(""),C(!0);try{if((await r({email:u,password:g})).role!=="admin"){x("This account is not an admin."),await l();return}N("/admin",{replace:!0})}catch(I){I instanceof Error?x(I.message):x("Something went wrong. Please try again.")}finally{C(!1)}};return i.jsxs("div",{className:"grid min-h-[calc(100vh-70px)] grid-cols-1 bg-gradient-to-b from-white to-[#F8F0FF] md:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]",children:[i.jsxs("section",{className:"relative hidden h-full w-full items-start justify-start bg-gradient-to-br from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] px-10 py-9 text-[#050014] md:flex",children:[i.jsx("div",{className:"relative z-10 mx-auto flex max-w-xl flex-col gap-6",children:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-4 py-1 text-sm font-medium tracking-wide text-[#C045FF]",children:[i.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"})," ADMIN ACCESS"]}),i.jsx("h1",{className:"text-2xl font-bold leading-tight text-[#050014] md:text-3xl lg:text-4xl",children:"Sign in to your FanMeet admin console"}),i.jsx("p",{className:"text-xs text-[#4B445F] md:text-sm lg:text-base",children:"Manage creators, fans, events, payouts, and platform settings from a single secure dashboard."})]})}),i.jsx("div",{className:"absolute right-0 top-0 h-full w-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"})]}),i.jsx("section",{className:"flex items-start justify-center px-4 py-4 md:px-6 md:py-4",children:i.jsxs("div",{className:"flex w-full max-w-md flex-col gap-4 md:gap-3.5",children:[i.jsxs("div",{className:"flex flex-col gap-1.5 text-center md:text-left",children:[i.jsx(ro,{to:"/",className:"text-sm font-semibold text-[#C045FF]",children:" Back to home"}),i.jsx("h2",{className:"text-2xl font-bold text-[#212529] md:text-3xl",children:"Admin sign in"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Use your admin credentials to access the platform controls."})]}),i.jsxs("form",{className:"flex flex-col gap-3",onSubmit:M,children:[i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx(nt,{label:"Admin email",placeholder:"you@company.com",type:"email",required:!0,value:u,onChange:G=>m(G.target.value)}),i.jsx(nt,{label:"Password",placeholder:"Enter your password",type:"password",required:!0,value:g,onChange:G=>E(G.target.value)})]}),y?i.jsx("p",{className:"text-[11px] font-medium text-[#DC3545]",children:y}):null,i.jsx(oe,{type:"submit",size:"md",className:"h-9 text-[13px]",disabled:S,children:S?"Signing in":"Sign in as admin"}),i.jsx(me,{className:"mt-2 border-[#FFE5D9] bg-[#FFF8F3] p-3 text-xs text-[#6C757D]",children:"Admin access is restricted. If you believe you should have access, contact the platform owner."})]})]})})]})}const KH=O.createContext(void 0);function Mbe(r,n){return!r&&!n?"":r?n?`${r}   ${n}`:r:n}const Fbe=({children:r})=>{const[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState([]),[E,y]=O.useState([]),[x,S]=O.useState(!0),{user:C}=fs();O.useEffect(()=>{(async()=>{const{data:J,error:ee}=await ie.from("events").select("*");if(ee){console.error("Error fetching events:",ee);return}if(!J)return;const{data:ne}=await ie.from("bids").select("*"),pe=J.map(le=>le.creator_id),{data:Ee}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",pe),ge=new Map((Ee==null?void 0:Ee.map(le=>[le.user_id,le]))||[]),he=J.map(le=>{const Le=(ne==null?void 0:ne.filter(Xe=>Xe.event_id===le.id))||[],fe=Le.length>0?Math.max(...Le.map(Xe=>Xe.amount)):0,ae=new Set(Le.map(Xe=>Xe.fan_id)).size,be=new Date(le.starts_at),We=new Date,Ge=(le.bidding_closes_at?new Date(le.bidding_closes_at):be).getTime()-We.getTime();let pt="Bidding Closed";if(Ge>0){const Xe=Math.floor(Ge/36e5);Xe>24?pt=`${Math.floor(Xe/24)} days left to bid`:Xe>0?pt=`${Xe} hours left to bid`:pt=`${Math.floor(Ge/6e4)} minutes left to bid`}const Ze=be.toLocaleDateString(),Me=be.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Ue=ge.get(le.creator_id),ke=((Ue==null?void 0:Ue.username)||`user${le.creator_id.substring(0,8)}`).toLowerCase();let Ie;return le.status==="completed"||le.status==="cancelled"?Ie="Completed":le.bidding_closes_at&&new Date(le.bidding_closes_at)>We?Ie="Accepting Bids":le.status==="live"?Ie="LIVE":Ie="Upcoming",{id:le.id,creatorUsername:ke,creatorDisplayName:(Ue==null?void 0:Ue.display_name)||"Unknown",title:le.title,description:le.description,category:le.category||"general",status:Ie,date:`${Ze} @ ${Me}`,duration:`${le.duration_minutes} minutes`,basePrice:le.base_price,currentBid:fe,participants:ae,endsIn:pt}});o(he),S(!1)})()},[]),O.useEffect(()=>{if(!C){u([]),g([]);return}(async()=>{const{data:J,error:ee}=await ie.from("bids").select("*").eq("fan_id",C.id);if(!ee&&J){const Ee=J.map(ae=>ae.event_id),{data:ge}=await ie.from("events").select("id, title, creator_id").in("id",Ee),he=new Map((ge==null?void 0:ge.map(ae=>[ae.id,ae]))||[]),le=Array.from(new Set((ge??[]).map(ae=>ae.creator_id).filter(Boolean))),{data:Le}=le.length?await ie.from("profiles").select("user_id, username").in("user_id",le):{data:null},fe=new Map((Le??[]).map(ae=>[ae.user_id,ae.username]));u(J.map(ae=>{const be=he.get(ae.event_id),We=be?fe.get(be.creator_id):void 0;return{id:ae.id,eventId:ae.event_id,amount:ae.amount,status:ae.status,createdAt:ae.created_at,eventTitle:be==null?void 0:be.title,creatorUsername:We}}))}else ee&&console.error("Error fetching bids:",ee);const{data:ne,error:pe}=await ie.from("meets").select("*").eq("fan_id",C.id).in("status",["scheduled","live","completed"]);if(!pe&&ne){const Ee=ne.map(le=>le.creator_id),{data:ge}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",Ee),he=new Map((ge==null?void 0:ge.map(le=>[le.user_id,le]))||[]);g(ne.map(le=>{const Le=he.get(le.creator_id);return{id:le.id,eventId:le.event_id,creatorId:le.creator_id,creatorUsername:(Le==null?void 0:Le.username)||"unknown",creatorDisplayName:(Le==null?void 0:Le.display_name)||"Unknown",scheduledAt:le.scheduled_at,durationMinutes:le.duration_minutes,meetingLink:le.meeting_link,status:le.status}}))}else pe&&console.error("Error fetching meets:",pe)})()},[C]);const N=async H=>{if(!C)throw new Error("User not logged in");const J=new Date(`${H.date}T${H.time}`).toISOString(),ee=new Date(`${H.biddingDeadlineDate}T${H.biddingDeadlineTime}`).toISOString(),ne=parseInt(H.duration.replace(/\D/g,""),10)||15,{data:pe,error:Ee}=await ie.from("events").insert({creator_id:C.id,title:H.title,description:H.description,status:"upcoming",starts_at:J,bidding_closes_at:ee,duration_minutes:ne,base_price:H.basePrice,is_paid:H.basePrice>0,meeting_link:H.meetingLink}).select().single();if(Ee)throw console.error("Error creating event:",Ee),Ee;const ge={id:pe.id,creatorUsername:C.username.toLowerCase(),creatorDisplayName:H.creatorDisplayName,title:pe.title,description:pe.description,status:"Upcoming",date:Mbe(H.date,H.time),duration:H.duration,basePrice:pe.base_price,currentBid:0,participants:0,endsIn:"Bid ding open"};return o(he=>[...he,ge]),ge},M=H=>{const J=H.trim().replace(/^@/,"").toLowerCase();return n.filter(ee=>ee.creatorUsername===J)},G=H=>{if(!C)return 0;const J=l.filter(ee=>ee.eventId===H&&ee.status==="active");return J.length===0?0:Math.max(...J.map(ee=>ee.amount))},I=async H=>{const{data:J,error:ee}=await ie.from("bids").select("id, fan_id, amount, created_at").eq("event_id",H).order("created_at",{ascending:!1}).limit(5);if(ee||!J)return console.error("Error fetching bid history:",ee),[];const ne=J.map(le=>le.fan_id),{data:pe}=await ie.from("profiles").select("user_id, username").in("user_id",ne),Ee=new Map((pe==null?void 0:pe.map(le=>[le.user_id,le.username]))||[]),ge=J.length>0?Math.max(...J.map(le=>le.amount)):0,he=J.map(le=>({id:le.id,fanId:le.fan_id,fanUsername:Ee.get(le.fan_id)||"Anonymous",amount:le.amount,createdAt:le.created_at,isCurrentLeader:le.amount===ge}));return y(he),he},P=async(H,J)=>{if(!J||Number.isNaN(J))return;if(!C)throw console.error("User must be logged in to bid"),new Error("Please log in to place a bid");const ee=50;if(J%ee!==0)throw new Error(`Bids must be in multiples of ${ee}.`);const{data:ne,error:pe}=await ie.from("events").select("id, base_price").eq("id",H).maybeSingle();if(pe||!ne)throw new Error("Could not load event for bidding.");const{data:Ee,error:ge}=await ie.from("bids").select("amount").eq("event_id",H).order("amount",{ascending:!1}).limit(1).maybeSingle();if(ge)throw new Error("Could not validate current bid.");const he=(Ee==null?void 0:Ee.amount)??0;if(he===0){if(J!==ne.base_price)throw new Error(`The first bid must be exactly ${ne.base_price}.`)}else if(J<he)throw new Error(`Your bid must be at least ${he}.`);const{error:le}=await ie.from("bids").insert({event_id:H,fan_id:C.id,amount:J,status:"active"});if(le)throw console.error("Error placing bid:",le),new Error("Failed to place bid. Please try again.");o(Le=>Le.map(fe=>{if(fe.id!==H)return fe;const ae=J>fe.currentBid?J:fe.currentBid;return{...fe,currentBid:ae,participants:fe.participants+1}})),await R(),await I(H)},L=async(H,J,ee)=>{if(!(!J||Number.isNaN(J)))throw C?new Error(`PAYMENT_REQUIRED:${J}:${H}`):new Error("Please log in to place a bid")},R=async()=>{if(!C)return;const{data:H}=await ie.from("bids").select("*").eq("fan_id",C.id);if(H){const J=H.map(he=>he.event_id),{data:ee}=await ie.from("events").select("id, title, creator_id").in("id",J),ne=new Map((ee==null?void 0:ee.map(he=>[he.id,he]))||[]),pe=Array.from(new Set((ee??[]).map(he=>he.creator_id).filter(Boolean))),{data:Ee}=pe.length?await ie.from("profiles").select("user_id, username").in("user_id",pe):{data:null},ge=new Map((Ee??[]).map(he=>[he.user_id,he.username]));u(H.map(he=>{const le=ne.get(he.event_id),Le=le?ge.get(le.creator_id):void 0;return{id:he.id,eventId:he.event_id,amount:he.amount,status:he.status,createdAt:he.created_at,eventTitle:le==null?void 0:le.title,creatorUsername:Le}}))}},D=async(H,J)=>{const{error:ee}=await ie.from("meets").update({status:J}).eq("id",H);if(ee)throw console.error("Error updating meet status:",ee),ee;await V()},V=async()=>{if(!C)return;const{data:H,error:J}=await ie.from("meets").select("*").eq("fan_id",C.id).in("status",["scheduled","live","completed"]);if(!J&&H){const ee=H.map(Ee=>Ee.creator_id),{data:ne}=await ie.from("profiles").select("user_id, username, display_name").in("user_id",ee),pe=new Map((ne==null?void 0:ne.map(Ee=>[Ee.user_id,Ee]))||[]);g(H.map(Ee=>{const ge=pe.get(Ee.creator_id);return{id:Ee.id,eventId:Ee.event_id,creatorId:Ee.creator_id,creatorUsername:(ge==null?void 0:ge.username)||"unknown",creatorDisplayName:(ge==null?void 0:ge.display_name)||"Unknown",scheduledAt:Ee.scheduled_at,durationMinutes:Ee.duration_minutes,meetingLink:Ee.meeting_link,status:Ee.status,creatorStartedAt:Ee.creator_started_at,creatorJoinedAt:Ee.creator_joined_at,fanJoinedAt:Ee.fan_joined_at,recordingStartedAt:Ee.recording_started_at,recordingStoppedAt:Ee.recording_stopped_at}}))}};O.useEffect(()=>{if(!C||C.role!=="fan")return;const H=ie.channel(`fan-meets-${C.id}`).on("postgres_changes",{event:"*",schema:"public",table:"meets",filter:`fan_id=eq.${C.id}`},J=>{console.log(" Realtime meets update for fan:",J),V()}).subscribe();return()=>{ie.removeChannel(H)}},[C]);const W=async H=>{if(!C)return;const{data:J,error:ee}=await ie.from("events").select("*").eq("id",H).single();if(ee||!J)throw console.error("Error fetching event to finalize:",ee),new Error("Event not found");const{data:ne,error:pe}=await ie.from("bids").select("*").eq("event_id",H).eq("status","active").order("amount",{ascending:!1}).limit(1);if(pe)throw console.error("Error fetching winning bid:",pe),new Error("Could not determine winner");const Ee=ne&&ne.length>0?ne[0]:null;if(!Ee&&J.is_paid&&console.log("No bids for event, closing without meet."),Ee){const{error:he}=await ie.from("meets").insert({event_id:H,creator_id:C.id,fan_id:Ee.fan_id,scheduled_at:J.starts_at,duration_minutes:J.duration_minutes,meeting_link:J.meeting_link,status:"scheduled"});if(he)throw console.error("Error creating meet:",he),new Error("Failed to create meet")}const{error:ge}=await ie.from("events").update({status:"completed"}).eq("id",H);ge&&console.error("Error updating event status:",ge),await V()},q=O.useMemo(()=>({events:n,myBids:l,myMeets:m,bidHistory:E,isLoading:x,createEvent:N,getEventsForCreator:M,placeBid:P,placeBidWithPayment:L,updateMeetStatus:D,refreshMeets:V,getBidHistory:I,getUserCurrentBidForEvent:G,finalizeEvent:W}),[n,l,m,E,x]);return O.useEffect(()=>{if(!C||C.role!=="creator")return;const H=async()=>{const{data:ee}=await ie.from("events").select("id, title").eq("creator_id",C.id).in("status",["upcoming","live"]).lt("bidding_closes_at",new Date().toISOString());if(ee&&ee.length>0){console.log(" Auto-finalizing expired events:",ee);for(const ne of ee)try{await W(ne.id),console.log(` Auto-finalized event: ${ne.title}`)}catch(pe){console.error(` Failed to auto-finalize event ${ne.id}:`,pe)}}},J=setInterval(H,3e4);return H(),()=>clearInterval(J)},[C]),O.useEffect(()=>{if(!C)return;const H=async()=>{const{data:ee,error:ne}=await ie.from("meets").select("id, scheduled_at, duration_minutes").eq("status","live");if(ne||!ee)return;const pe=new Date,Ee=ee.filter(ge=>{const he=new Date(new Date(ge.scheduled_at).getTime()+ge.duration_minutes*60*1e3);return pe>he});if(Ee.length>0){console.log(" Auto-completing expired meetings:",Ee.length);for(const ge of Ee)await ie.from("meets").update({status:"completed"}).eq("id",ge.id);V()}},J=setInterval(H,3e4);return H(),()=>clearInterval(J)},[C]),i.jsx(KH.Provider,{value:q,children:r})},Yo=()=>{const r=O.useContext(KH);if(!r)throw new Error("useEvents must be used within an EventProvider");return r},Ry=20;function Ube(){const r=Ss(),[n,o]=Gp(),{events:l,isLoading:u}=Yo(),m=n.get("q")||"",[g,E]=O.useState(parseInt(n.get("page")||"1",10)),y=O.useMemo(()=>{if(!m)return l;const I=m.toLowerCase();return l.filter(P=>{var L,R;return P.creatorDisplayName.toLowerCase().includes(I)||P.title.toLowerCase().includes(I)||((L=P.category)==null?void 0:L.toLowerCase().includes(I))||((R=P.description)==null?void 0:R.toLowerCase().includes(I))})},[l,m]),x=Math.ceil(y.length/Ry),S=(g-1)*Ry,C=y.slice(S,S+Ry),N=y.length>Ry,M=I=>{E(I);const P=new URLSearchParams(n);I>1?P.set("page",String(I)):P.delete("page"),o(P,{replace:!0}),window.scrollTo({top:0,behavior:"smooth"})},G=I=>{const P=new URLSearchParams;I&&P.set("q",I),o(P,{replace:!0}),E(1)};return u?i.jsx("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("p",{className:"text-[#6C757D]",children:"Loading events..."})]})}):i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-4",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Browse Events"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Explore live and upcoming FanMeet events."}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"This is a public browse page so fans can get a feel for the experience before creating an account. When you are ready to bid or join, you can sign up in a single step."})]}),i.jsx("section",{children:i.jsxs("div",{className:"relative max-w-md",children:[i.jsx("input",{type:"text",placeholder:"Search events or creators...",value:m,onChange:I=>G(I.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),i.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]})}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("p",{className:"text-sm text-[#6C757D]",children:[y.length," ",y.length===1?"event":"events"," found",N&&` (showing ${C.length} on page ${g})`]}),m&&i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>G(""),children:"Clear Search"})]}),i.jsx("section",{className:"grid gap-6 md:grid-cols-2",children:C.length>0?C.map(I=>i.jsxs(me,{elevated:!0,className:"flex h-full flex-col overflow-hidden p-0 cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>r(`/events/${I.id}`),children:[i.jsx("div",{className:"relative h-36 w-full flex-shrink-0 bg-gradient-to-br from-[#FCE7FF] via-white to-[#E5DEFF]"}),i.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-6 pb-6 pt-5",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{children:[I.status==="Accepting Bids"?i.jsx("div",{className:"mb-1 inline-block rounded-[8px] bg-[#1E4620] px-2 py-1",children:i.jsx("span",{className:"text-[11px] font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx($e,{variant:I.status==="LIVE"?"danger":"primary",className:"mb-1 text-[11px] uppercase tracking-wide",children:I.status==="LIVE"?" Live Now":I.status}),i.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:I.creatorDisplayName}),i.jsx("div",{className:"text-sm text-[#495057]",children:I.title}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:I.category||"General"})]}),i.jsxs("div",{className:"text-right text-xs text-[#6C757D]",children:[i.jsx("div",{children:I.duration}),i.jsxs("div",{className:"mt-1",children:["Base: ",Be(I.basePrice)]})]})]}),i.jsxs("div",{className:"rounded-[14px] border border-[#F4E6FF] bg-[#F8F9FA] p-4 text-sm text-[#343A40]",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Current highest bid"}),i.jsx("span",{className:"text-base font-semibold text-[#C045FF]",children:Be(I.currentBid)})]}),i.jsxs("div",{className:"mt-1 text-xs text-[#6C757D]",children:[I.participants," fans bidding"]})]}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:[" ",I.date,"   ",I.endsIn]}),i.jsx(oe,{className:"mt-auto w-full bg-[#050014] text-white hover:bg-[#140423]",size:"sm",children:"View event details "})]})]},I.id)):i.jsxs("div",{className:"col-span-full text-center py-12 text-[#6C757D]",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),m?i.jsxs("p",{children:['No events found matching "',m,'"']}):i.jsx("p",{children:"No events available at the moment. Check back soon!"})]})}),x>1&&i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>M(g-1),disabled:g===1,children:" Previous"}),i.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:x},(I,P)=>P+1).map(I=>{const P=I===1||I===x||Math.abs(I-g)<=1,L=I===2&&g>3||I===x-1&&g<x-2;return!P&&!L?null:L&&!P?i.jsx("span",{className:"px-2 text-[#6C757D]",children:"..."},I):i.jsx("button",{onClick:()=>M(I),className:`min-w-[36px] rounded-lg px-3 py-2 text-sm font-medium transition-all ${g===I?"bg-[#C045FF] text-white":"bg-[#F8F9FA] text-[#6C757D] hover:bg-[#E9ECEF]"}`,children:I},I)})}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>M(g+1),disabled:g===x,children:"Next "})]}),i.jsx("section",{children:i.jsxs(me,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx(Ce,{title:"Ready to bid or join a free event?",subtitle:"Create a fan account in less than 30 seconds and keep track of all your bids and meetings."}),i.jsxs(ve,{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Login or sign up from the top-right corner when you are ready. You can browse this page without an account."}),i.jsx(oe,{size:"sm",onClick:()=>r("/auth"),children:"Go to login / sign up"})]})]})})]})}function Vbe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-4",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"How It Works"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Simple 3-step flow for fans and creators."}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"This page gives a high-level explanation of FanMeet without requiring login. Use it from marketing, ads, or the header navigation to explain the product."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"1. Pick a creator",subtitle:"Browse public events and choose the creator you want to meet."}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:"Filter by category, price, and availability. Each event clearly shows duration, base price, and current winning bid."})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"2. Bid or join",subtitle:"Place a bid for paid events or join free lucky-draw sessions."}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:"Highest bid wins the call. If you do not win, you receive up to 90% of your money back automatically."})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"3. Meet on video",subtitle:"Enjoy a live 1:1 video call from your laptop or phone."}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:"Join directly from your FanMeet dashboard at the scheduled time. No extra apps needed."})]})]}),i.jsx("section",{children:i.jsxs(me,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx(Ce,{title:"For fans and creators",subtitle:"Fans get intimate access. Creators get a new revenue stream and deeper community."}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2 text-sm text-[#6C757D]",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Fans"}),i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Bid safely with transparent pricing and refund rules."}),i.jsx("li",{children:"Win 510 minute live calls with creators you truly care about."}),i.jsx("li",{children:"Ask questions, get advice, or just share a moment."})]})]}),i.jsxs("div",{children:[i.jsx("h2",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Creators"}),i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Host live micro-meets with your most engaged supporters."}),i.jsx("li",{children:"Set your own prices and schedule, we handle payments and refunds."}),i.jsx("li",{children:"Turn superfans into long-term community members."})]})]})]})]})})]})}const Bbe=[{label:"Typical monthly earnings",value:"30k50k",note:"for active mid-sized creators"},{label:"Refund handled by FanMeet",value:"90%",note:"we manage all payment flows"},{label:"Average call length",value:"510 min",note:"short, meaningful conversations"}];function Wbe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"For Creators"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Turn your audience into premium, live 1:1 experiences."}),i.jsx("p",{className:"max-w-xl text-sm text-[#6C757D] md:text-base",children:"This is a public overview page about the creator side of FanMeet. Share it with potential creators before they sign up."})]}),i.jsx($e,{variant:"primary",className:"self-start md:self-auto",children:"Early creator program open"})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:Bbe.map(r=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:r.label}),i.jsxs(ve,{className:"space-y-1 text-sm text-[#6C757D]",children:[i.jsx("div",{className:"text-xl font-semibold text-[#050014]",children:r.value}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:r.note})]})]},r.label))}),i.jsx("section",{children:i.jsxs(me,{elevated:!0,className:"bg-[#050014] text-white",children:[i.jsx(Ce,{title:"Why creators love FanMeet",subtitle:"You focus on the conversation. We handle everything else."}),i.jsxs(ve,{className:"grid gap-4 text-sm md:grid-cols-2",children:[i.jsxs("ul",{className:"space-y-1 list-disc pl-5 text-white/80",children:[i.jsx("li",{children:"Host paid or free events for superfans."}),i.jsx("li",{children:"Flexible schedule that fits around your content calendar."}),i.jsx("li",{children:"Dashboard to track bids, winners, and upcoming calls."})]}),i.jsxs("ul",{className:"space-y-1 list-disc pl-5 text-white/80",children:[i.jsx("li",{children:"Secure payments, refunds, and payouts managed by FanMeet."}),i.jsx("li",{children:"Human review of fans and clear safety controls for calls."}),i.jsx("li",{children:"Dedicated support team for you and your community."})]})]})]})}),i.jsx("section",{children:i.jsxs(me,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx(Ce,{title:"Interested in hosting events?",subtitle:"Start by creating a creator account. You can explore the dashboard before running your first event."}),i.jsxs(ve,{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Use the login / sign up button in the header when you are ready. Once you are in, switch to the creator panel from the role selector."}),i.jsx(oe,{size:"sm",children:"Login / Sign up"})]})]})})]})}function Gbe(){const r=Ss();return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Pricing"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Transparent pricing, low-risk bidding."}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"FanMeet uses a bidding model for paid events and a lucky draw model for free events. If you do not win a paid event, you receive an automatic refund as per our refund policy."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Paid Events (Bidding)",subtitle:"Highest bid wins a 1:1 video call."}),i.jsxs(ve,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Base prices typically start at 50 / 100."}),i.jsx("li",{children:"Winning bid gets the scheduled call."}),i.jsx("li",{children:"Non-winning bids get an automatic refund (typically 90%)."})]}),i.jsx(oe,{size:"sm",onClick:()=>r("/browse-events"),children:"Browse Paid Events"})]})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Free Events (Lucky Draw)",subtitle:"Join for 0 and get selected randomly."}),i.jsxs(ve,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"No payment required to participate."}),i.jsx("li",{children:"Winners are selected fairly after entry closes."}),i.jsx("li",{children:"Same 1:1 call experience as paid events."})]}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>r("/free-events"),children:"Explore Free Events"})]})]})]}),i.jsx("section",{children:i.jsxs(me,{elevated:!0,className:"border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx(Ce,{title:"Refunds",subtitle:"Built-in safety for fans."}),i.jsxs(ve,{className:"text-sm text-[#6C757D]",children:["Read the full policy at ",i.jsx("a",{className:"underline",href:"/refund-policy",children:"/refund-policy"}),"."]})]})})]})}const Hbe=[{category:"Fans",q:"What if I don't win the bid?",a:"You automatically receive a refund as per our Refund Policy. Typically non-winning bids receive 90% back."},{category:"Fans",q:"How do I join a call?",a:"If you win, you can join directly from your dashboard at the scheduled time. No extra apps needed."},{category:"Creators",q:"How do payouts work?",a:"Creators keep 90% of winning bids (platform fee 10%). Payouts are available after clearance and processed via bank/UPI."},{category:"Creators",q:"How do I get approved as a creator?",a:"Apply through the creator program. Our team verifies identity and social presence before approval."}];function zbe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-6 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"FAQs"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Frequently asked questions"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Answers for fans and creators. If your question isnt listed, visit Help Center or Contact Us."})]}),i.jsx("section",{className:"grid gap-4",children:Hbe.map(r=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:r.q,subtitle:r.category}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:r.a})]},`${r.category}-${r.q}`))})]})}function Kbe(){const r=Ss();return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Free Events"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"0 lucky draw events"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Join free creator events with zero payment. Winners are chosen randomly after entries close."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"How it works",subtitle:"Fair selection, simple participation."}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Select a free event and join the draw."}),i.jsx("li",{children:"Wait for entries to close."}),i.jsx("li",{children:"A winner is selected randomly and notified."}),i.jsx("li",{children:"If selected, you join the call at the scheduled time."})]})})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Want more chances?",subtitle:"Paid events are bidding-based."}),i.jsxs(ve,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsx("p",{children:"Paid events let you bid to increase your chance of winning."}),i.jsx(oe,{size:"sm",onClick:()=>r("/browse-events"),children:"Browse Events"})]})]})]})]})}function qbe(){const r=Ss();return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Apply Now"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Become a verified creator on FanMeet"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Submit your creator profile, complete verification, and start hosting paid or free events."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Eligibility",subtitle:"Who can apply?"}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Creators with a real audience (recommended 1,000+ followers) or a valuable skill."}),i.jsx("li",{children:"Valid identity verification (KYC) and a payout method (bank/UPI)."}),i.jsx("li",{children:"Willingness to follow safety and community guidelines."})]})})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"How to apply",subtitle:"It takes a few minutes."}),i.jsxs(ve,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsxs("ol",{className:"list-decimal space-y-1 pl-5",children:[i.jsx("li",{children:"Create an account."}),i.jsx("li",{children:"Select role: Creator."}),i.jsx("li",{children:"Complete profile setup and submit for approval."}),i.jsx("li",{children:"Wait for verification status."})]}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{size:"sm",onClick:()=>r("/auth"),children:"Sign up / Login"}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>r("/for-creators"),children:"Learn more"})]})]})]})]})]})}function Ybe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Creator Guide"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"How to run great FanMeet sessions"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"A simple guide to help creators deliver high-quality, safe, and consistent fan experiences."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Before your event"}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Ensure stable internet and a quiet environment."}),i.jsx("li",{children:"Confirm your event title, duration, and time."}),i.jsx("li",{children:"Set expectations in the description (topics, rules)."})]})})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"During the call"}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Start on time and keep the conversation friendly."}),i.jsx("li",{children:"Do not share personal contact details."}),i.jsx("li",{children:"End the call immediately if the fan is abusive."})]})})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"After the call"}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Mark the meet status correctly in the dashboard."}),i.jsx("li",{children:"Withdraw earnings after clearance (as applicable)."}),i.jsx("li",{children:"Report issues via Support."})]})})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Payout readiness"}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Complete profile approval (verified status)."}),i.jsx("li",{children:"Add bank/UPI details in Settings."}),i.jsx("li",{children:"Keep KYC details accurate to avoid payout delays."})]})})]})]})]})}function $be(){const[r,n]=O.useState("500"),[o]=O.useState(10),{gross:l,fee:u,net:m}=O.useMemo(()=>{const g=Math.max(parseInt(r||"0",10)||0,0),E=Math.floor(g*o/100),y=Math.max(g-E,0);return{gross:g,fee:E,net:y}},[o,r]);return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Earnings Calculator"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Estimate your creator earnings"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Estimate net earnings after the platform fee. This is a simple estimate and may not include payment gateway fees or taxes."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Calculator",subtitle:"Try different winning bid amounts."}),i.jsxs(ve,{className:"space-y-4",children:[i.jsx(nt,{label:"Winning bid amount ()",type:"number",min:0,value:r,onChange:g=>n(g.target.value)}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs($e,{variant:"primary",children:["Platform fee: ",o,"%"]}),i.jsxs($e,{variant:"success",children:["Net: ",m]})]}),i.jsxs("div",{className:"text-sm text-[#6C757D]",children:["Gross ",l,"  Fee ",u,"  Net ",m]})]})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Payout notes",subtitle:"When can creators withdraw?"}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:i.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[i.jsx("li",{children:"Creators must be approved (verified) to withdraw."}),i.jsx("li",{children:"Add bank/UPI details in Settings before withdrawal."}),i.jsx("li",{children:"Earnings may be released after meet completion and clearance window."})]})})]})]})]})}const Xbe=[{title:"From Fan to Friend",body:"A fan won a call, got streaming tips, and became a familiar face in the creators community."},{title:"Career-Changing Advice",body:"A short 10-minute call helped a fan gain clarity and take action with confidence."},{title:"A Gift That Made Her Cry",body:"A meaningful birthday call turned into a memory that lasted far longer than any material gift."}];function Jbe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Success Stories"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Stories from fans and creators"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Real outcomes from short conversations."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:Xbe.map(r=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:r.title}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:r.body})]},r.title))})]})}function Qbe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"About"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"About FanMeet"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"FanMeet is an India-first platform for live 1:1 video calls between fans and verified creators. We make it simple, safe, and transparent through auctions (paid events) and lucky draws (free events)."})]}),i.jsxs("section",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Our mission"}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:"Help fans build real connections with creators they admire, while helping creators earn fairly and grow stronger communities."})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Trust & safety"}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:"Creators are human-verified. Payments are secure via Razorpay. Refunds are automatic based on policy."})]})]})]})}const Zbe=[{name:"Arjun Singh",role:"Founder",initials:"AS"},{name:"Priya Mehta",role:"Co-Founder",initials:"PM"},{name:"Rahul Verma",role:"Tech Lead",initials:"RV"},{name:"Neha Kapoor",role:"Customer Support",initials:"NK"},{name:"Amit Gupta",role:"Marketing",initials:"AG"},{name:"Sneha Sharma",role:"Operations",initials:"SS"}];function ewe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Team"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Our Team"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Were a small team based in India building reliable creator-fan experiences."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:Zbe.map(r=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:r.name,subtitle:r.role}),i.jsxs(ve,{className:"flex items-center gap-3",children:[i.jsx(gi,{initials:r.initials,size:"md"}),i.jsx("div",{className:"text-sm text-[#6C757D]",children:"Building FanMeet"})]})]},r.name))})]})}const twe=[{title:"Press kit",desc:"Logos, screenshots, and basic product info.",href:"#"},{title:"Media inquiries",desc:"Write to press@fanmeet.live",href:"mailto:press@fanmeet.live"}];function swe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Press & Media"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Press & Media"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"For press inquiries and brand assets."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-2",children:twe.map(r=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:r.title,subtitle:r.desc}),i.jsx(ve,{children:i.jsx("a",{className:"inline-flex h-9 items-center justify-center rounded-[10px] border border-[#E9ECEF] bg-white px-4 text-sm font-semibold text-[#050014] hover:bg-[#F8F9FA]",href:r.href,children:"Open"})})]},r.title))})]})}const rwe=[{title:"Full-stack Engineer",location:"Remote / India",type:"Full-time"},{title:"Creator Partnerships",location:"Bangalore / Hybrid",type:"Full-time"},{title:"Support Associate",location:"Remote / India",type:"Part-time"}];function nwe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Careers"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Were hiring"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Join the team building Indias most trusted creator-fan marketplace."})]}),i.jsx("section",{className:"grid gap-4",children:rwe.map(r=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:r.title,subtitle:r.location}),i.jsxs(ve,{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsx($e,{variant:"primary",children:r.type}),i.jsx("a",{className:"inline-flex h-9 items-center justify-center rounded-[10px] bg-[#C045FF] px-4 text-sm font-semibold text-white hover:opacity-90",href:"mailto:careers@fanmeet.live?subject=Job%20Application",children:"Apply via Email"})]})]},r.title))})]})}const iwe=[{title:"Why live 1:1 beats DMs",date:"Dec 2024",excerpt:"Real conversations, real community."},{title:"Creator safety on FanMeet",date:"Dec 2024",excerpt:"How we review creators and protect fans."},{title:"Understanding our refund rules",date:"Dec 2024",excerpt:"Transparent refunds that keep bidding low-risk."}];function awe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Blog"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"FanMeet Blog"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Updates, guides, and product stories."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-2",children:iwe.map(r=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:r.title,subtitle:r.date}),i.jsx(ve,{className:"text-sm text-[#6C757D]",children:r.excerpt})]},r.title))})]})}const owe=[{title:"Payments & bids",desc:"How bidding works, charges, and refunds.",to:"/pricing"},{title:"Creator approval",desc:"Verification process and common issues.",to:"/apply"},{title:"Refund policy",desc:"Read the complete refund policy.",to:"/refund-policy"},{title:"Contact support",desc:"Reach us for unresolved issues.",to:"/contact"}];function cwe(){return i.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-8 md:px-0 md:py-10",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Help Center"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"Help Center"}),i.jsx("p",{className:"max-w-2xl text-sm text-[#6C757D] md:text-base",children:"Quick answers and support resources."})]}),i.jsx("section",{className:"grid gap-4 md:grid-cols-2",children:owe.map(r=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:r.title,subtitle:r.desc}),i.jsx(ve,{children:i.jsx("a",{className:"inline-flex h-9 items-center justify-center rounded-[10px] border border-[#E9ECEF] bg-white px-4 text-sm font-semibold text-[#050014] hover:bg-[#F8F9FA]",href:r.to,children:"Open"})})]},r.title))})]})}const lwe=[{value:"all",label:"All Events",emoji:""},{value:"entertainment",label:"Entertainment",emoji:""},{value:"music",label:"Music",emoji:""},{value:"education",label:"Education",emoji:""},{value:"fitness",label:"Fitness",emoji:""},{value:"gaming",label:"Gaming",emoji:""},{value:"lifestyle",label:"Lifestyle",emoji:""},{value:"general",label:"General",emoji:""}],dwe=[{value:"popular",label:"Most Popular"},{value:"ending-soon",label:"Ending Soon"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"},{value:"newest",label:"Newly Added"}];function uwe(){const r=Ss(),[n]=Gp(),{events:o,myBids:l}=Yo(),[u,m]=O.useState("all"),[g,E]=O.useState("popular"),[y,x]=O.useState(n.get("q")||"");O.useEffect(()=>{const I=n.get("q");I!==null&&I!==y&&x(I)},[n]);const S=O.useMemo(()=>[...o.filter(L=>{var R;if(u!=="all"&&L.category!==u)return!1;if(y){const D=y.toLowerCase();return L.title.toLowerCase().includes(D)||L.creatorDisplayName.toLowerCase().includes(D)||((R=L.description)==null?void 0:R.toLowerCase().includes(D))}return!0})].sort((L,R)=>{switch(g){case"popular":return R.participants-L.participants;case"price-low":return L.basePrice-R.basePrice;case"price-high":return R.basePrice-L.basePrice;case"newest":return R.id.localeCompare(L.id);case"ending-soon":const D=V=>V.includes("Closed")?999999:V.includes("days")?parseInt(V)*24*60:V.includes("hours")?parseInt(V)*60:V.includes("minutes")?parseInt(V):0;return D(L.endsIn)-D(R.endsIn);default:return 0}}),[o,u,g,y]),C=20,N=S.length>C,M=S.slice(0,C),G=O.useMemo(()=>{const I=l.length,P=l.filter(D=>D.status==="won").length,L=I>0?Math.round(P/I*100):0,R=l.filter(D=>D.status==="lost").reduce((D,V)=>D+Math.floor(V.amount*.9),0);return[{id:"stat-1",label:"Bids placed",value:String(I),hint:`${l.filter(D=>D.status==="active"||D.status==="outbid").length} active`},{id:"stat-2",label:"Win rate",value:`${L}%`,hint:`${P} wins out of ${I}`},{id:"stat-3",label:"Refunds received",value:Be(R),hint:"90% back on lost bids"},{id:"stat-4",label:"Meets completed",value:String(P),hint:`Across ${new Set(l.filter(D=>D.status==="won").map(D=>D.creatorUsername)).size} creators`}]},[l]);return i.jsxs("div",{className:"flex flex-col gap-8 overflow-x-hidden",children:[i.jsx(me,{elevated:!0,className:"overflow-hidden border-none bg-gradient-to-r from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] shadow-[0_24px_60px_rgba(160,64,255,0.18)]",children:i.jsxs("div",{className:"relative flex flex-col gap-6 px-4 py-6 md:flex-row md:items-center md:px-8 md:py-8",children:[i.jsxs("div",{className:"max-w-xl space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Browse Events"}),i.jsx("h1",{className:"text-xl font-semibold text-[#050014] md:text-3xl",children:"Find a live FanMeet that matches your vibe."}),i.jsx("p",{className:"text-sm text-[#4B445F]",children:"Browse, bid, and secure your spot with your favorite creators in small, exclusive meetups."})]}),i.jsx("div",{className:"flex-shrink-0 text-5xl md:text-7xl",children:""})]})}),i.jsx(me,{children:i.jsxs(ve,{className:"gap-6",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Search events or creators...",value:y,onChange:I=>x(I.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),i.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]}),i.jsxs("div",{className:"overflow-x-hidden",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Categories"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:lwe.map(I=>i.jsxs("button",{onClick:()=>m(I.value),className:`flex-shrink-0 rounded-full border-2 px-3 py-1.5 text-xs font-medium transition-all md:px-4 md:py-2 md:text-sm ${u===I.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:[i.jsx("span",{className:"mr-1",children:I.emoji}),I.label]},I.value))})]}),i.jsxs("div",{className:"overflow-x-hidden",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Sort By"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:dwe.map(I=>i.jsx("button",{onClick:()=>E(I.value),className:`flex-shrink-0 whitespace-nowrap rounded-full border-2 px-3 py-1.5 text-xs font-medium transition-all md:px-4 md:py-2 md:text-sm ${g===I.value?"border-[#C045FF] bg-[#C045FF] text-white":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:I.label},I.value))})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[i.jsxs("h2",{className:"text-xl font-semibold text-[#212529]",children:[S.length," ",S.length===1?"Event":"Events"," Found",N&&i.jsxs("span",{className:"ml-2 text-sm font-normal text-[#6C757D]",children:["(showing ",M.length,")"]})]}),N&&i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r("/fan/all-events"),children:"View All Events "})]}),M.length===0?i.jsx(me,{children:i.jsxs(ve,{className:"py-12 text-center",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),i.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Try adjusting your filters or search query"}),i.jsx(oe,{onClick:()=>{m("all"),x("")},children:"Clear Filters"})]})}):i.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:M.map(I=>i.jsx(me,{className:"group cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>r(`/events/${I.id}`),children:i.jsxs(ve,{className:"gap-4",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"mb-1 text-xs text-[#6C757D]",children:I.creatorDisplayName}),i.jsx("h3",{className:"text-base font-semibold text-[#212529] group-hover:text-[#C045FF]",children:I.title})]}),I.status==="Accepting Bids"?i.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:i.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx($e,{variant:I.status==="LIVE"?"danger":"primary",children:I.status})]}),I.description&&i.jsx("p",{className:"line-clamp-2 text-sm text-[#6C757D]",children:I.description}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Current Bid"}),i.jsx("div",{className:"font-semibold text-[#C045FF]",children:Be(I.currentBid)})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Base Price"}),i.jsx("div",{className:"font-semibold text-[#212529]",children:Be(I.basePrice)})]})]}),i.jsxs("div",{className:"flex items-center justify-between border-t border-[#E9ECEF] pt-3 text-xs text-[#6C757D]",children:[i.jsxs("span",{children:[" ",I.participants," bidding"]}),i.jsxs("span",{children:[" ",I.endsIn]})]}),i.jsx(oe,{className:"w-full",size:"sm",children:"View & Bid "})]})},I.id))}),N&&M.length>0&&i.jsx(me,{className:"mt-6 border-dashed border-2 border-[#C045FF]/30 bg-gradient-to-r from-[#FCE7FF]/50 via-white to-[#E5DEFF]/50",children:i.jsxs(ve,{className:"py-8 text-center",children:[i.jsx("div",{className:"text-4xl mb-3",children:""}),i.jsxs("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:[S.length-M.length," more events available"]}),i.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Explore all events to find the perfect creator meet for you"}),i.jsx(oe,{onClick:()=>r("/fan/all-events"),children:"Browse All Events "})]})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Your Activity",subtitle:"Track your bidding performance"}),i.jsx(ve,{children:i.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:G.map(I=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-gradient-to-br from-[#F8F9FA] to-white p-4",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:I.label}),i.jsx("div",{className:"mt-1 text-2xl font-bold text-[#212529]",children:I.value}),i.jsx("div",{className:"mt-1 text-xs text-[#6C757D]",children:I.hint})]},I.id))})})]})]})}function hwe(){const{myBids:r,events:n}=Yo(),o=Ss(),l=r.filter(g=>g.status==="active"||g.status==="outbid"),u=r.filter(g=>g.status==="won"||g.status==="lost"||g.status==="cancelled"),m=g=>n.find(E=>E.id===g);return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Bids"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track your bidding activity and results."})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Active Bids",subtitle:"Stay on top of the events you are currently bidding on"}),i.jsx(ve,{className:"gap-6",children:l.length===0?i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-8 text-center",children:[i.jsx("p",{className:"text-sm text-[#6C757D]",children:"You don't have any active bids."}),i.jsx(oe,{className:"mt-4",onClick:()=>o("/fan"),children:"Browse Events"})]}):l.map(g=>{const E=m(g.eventId),y=g.status==="outbid";return i.jsxs("div",{className:`grid gap-3 rounded-[16px] border p-4 md:grid-cols-[1.5fr_1fr_auto] md:items-center ${y?"border-[#FFC107] bg-[#FFF9E6]":"border-[#E9ECEF] bg-[#F8F9FA]"}`,children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-[#6C757D]",children:(E==null?void 0:E.creatorDisplayName)||"Unknown Creator"}),i.jsx("div",{className:"text-base font-semibold text-[#212529]",children:g.eventTitle||"Event"}),y&&i.jsx($e,{variant:"danger",className:"mt-1",children:" You've been outbid!"}),(E==null?void 0:E.status)==="Accepting Bids"&&!y&&i.jsx("div",{className:"mt-1 inline-flex rounded-[8px] bg-[#1E4620] px-2 py-0.5",children:i.jsx("span",{className:"text-[10px] font-semibold text-[#4ADE80]",children:" Accepting Bids"})})]}),i.jsxs("div",{className:"grid gap-1 text-sm text-[#6C757D] md:justify-items-end",children:[i.jsxs("span",{children:["Your Bid: ",i.jsx("strong",{className:"text-[#212529]",children:Be(g.amount)})]}),E&&i.jsxs(i.Fragment,{children:[i.jsxs("span",{children:["Current: ",i.jsx("strong",{className:"text-[#C045FF]",children:Be(E.currentBid)})]}),i.jsxs("span",{children:[" ",E.endsIn]})]})]}),i.jsxs("div",{className:"flex gap-2 md:justify-end",children:[i.jsx(oe,{size:"sm",variant:y?"primary":"secondary",onClick:()=>o(`/events/${g.eventId}`),children:y?"Increase Bid Now":"Increase Bid"}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>o(`/events/${g.eventId}`),children:"Details "})]})]},g.id)})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Bid Results"}),i.jsx(ve,{className:"overflow-x-auto",children:u.length===0?i.jsx("div",{className:"py-8 text-center text-sm text-[#6C757D]",children:"No past bid results yet."}):i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Your Bid"}),i.jsx("th",{className:"border-b border-[#E9ECEF] pb-3",children:"Result"})]})}),i.jsx("tbody",{className:"text-[#212529]",children:u.map(g=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:g.creatorUsername||"Unknown"}),i.jsx("td",{className:"py-3",children:g.eventTitle||"Event"}),i.jsx("td",{className:"py-3",children:Be(g.amount)}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:g.status==="won"?"success":"danger",children:g.status==="won"?" Won":g.status==="lost"?" Lost":"Cancelled"})})]},g.id))})]})})]})]})}function pwe(r){const n=new Date(r),o=new Date,l=n.getTime()-o.getTime();if(l<=0)return"Starting soon";const u=Math.floor(l/(1e3*60)),m=Math.floor(u/60),g=Math.floor(m/24),E=u%60;if(g>0){const y=m%24;return`${g} day${g>1?"s":""}${y>0?` ${y} hr${y>1?"s":""}`:""}`}return m>0?`${m} hr${m>1?"s":""}${E>0?` ${E} min`:""}`:`${E} min`}function mwe(){const{myMeets:r}=Yo(),n=Ss(),[o,l]=O.useState([]),[u,m]=O.useState(!0),g=r.filter(x=>x.status==="scheduled"||x.status==="live"||x.status==="completed"||x.status==="cancelled"||x.status==="cancelled_no_show_creator").sort((x,S)=>{if(x.status==="live"&&S.status!=="live")return-1;if(S.status==="live"&&x.status!=="live")return 1;const C=new Date,N=new Date(x.scheduledAt),M=new Date(S.scheduledAt),G=x.status==="scheduled"&&N.getTime()-C.getTime()<=24*60*60*1e3&&N>C,I=S.status==="scheduled"&&M.getTime()-C.getTime()<=24*60*60*1e3&&M>C;if(G&&!I)return-1;if(I&&!G)return 1;const P={live:0,scheduled:1,completed:2,cancelled:3,cancelled_no_show_creator:3},L=(P[x.status]||4)-(P[S.status]||4);return L!==0?L:N.getTime()-M.getTime()});g.filter(x=>x.status==="live"),g.filter(x=>x.status==="scheduled"),g.filter(x=>x.status==="completed"),O.useEffect(()=>{(async()=>{try{const{data:S,error:C}=await ie.from("events").select("id, title, status, starts_at, base_price, description").in("status",["upcoming","live","completed"]).order("starts_at",{ascending:!0});if(C){console.error("Error fetching events:",C),m(!1);return}if(S){const N=S.map(P=>P.id),{data:M}=await ie.from("bids").select("event_id").in("event_id",N),G=new Map;M==null||M.forEach(P=>G.set(P.event_id,!0));const I=S.filter(P=>!G.has(P.id));l(I)}}catch(S){console.error("Error fetching events with no bids:",S)}finally{m(!1)}})()},[]);const E=x=>{x&&navigator!=null&&navigator.clipboard&&navigator.clipboard.writeText(x)},y=x=>{x&&window.open(x,"_blank","noopener,noreferrer")};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Upcoming Meets"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Access your confirmed sessions and join on time."})]}),g.length===0?i.jsx(me,{elevated:!0,className:"grid min-h-[320px] place-items-center text-center",children:i.jsxs("div",{className:"flex flex-col items-center gap-3",children:[i.jsx("span",{className:"text-5xl",children:""}),i.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:"No meets yet"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Win an event to see your meeting details right here."}),i.jsx(oe,{children:"Browse Events "})]})}):i.jsxs(me,{elevated:!0,className:"border-l-4 border-[#28A745]",children:[i.jsx(Ce,{title:" You Won!",subtitle:"Get ready for your upcoming 1-on-1 session",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(ve,{className:"gap-6",children:g.map(x=>{const S=new Date,C=new Date(x.scheduledAt),N=x.status==="scheduled"&&C.getTime()-S.getTime()<=24*60*60*1e3&&C>S;return i.jsxs("div",{className:`grid gap-4 md:grid-cols-[auto_1fr] md:gap-6 ${N?"rounded-lg border-2 border-[#FF6B35] bg-[#FFF5F0] p-4 -mx-4":""}`,children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx($e,{variant:x.status==="live"?"success":x.status==="completed"?"default":x.status==="cancelled"||x.status==="cancelled_no_show_creator"?"danger":"primary",className:`w-fit px-4 py-2 text-sm ${x.status==="live"?"animate-pulse":""}`,children:x.status==="live"?" LIVE - Creator is waiting!":x.status==="completed"?" Completed":x.status==="cancelled_no_show_creator"?" Creator No-Show":x.status==="cancelled"?" Cancelled":"Scheduled"}),N&&i.jsx($e,{variant:"danger",className:"w-fit px-3 py-1 text-xs animate-pulse",children:" Starting Soon!"})]}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsxs("div",{children:[i.jsxs("h3",{className:"text-xl font-semibold text-[#212529]",children:["Meeting with ",x.creatorDisplayName||x.creatorUsername]}),i.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:[i.jsxs("div",{className:`flex items-center gap-2 rounded-lg px-3 py-2 ${N?"bg-[#FF6B35] text-white":"bg-[#F4E6FF] text-[#C045FF]"}`,children:[i.jsx("span",{className:"text-lg",children:""}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xs font-medium opacity-90",children:"Date & Time"}),i.jsx("span",{className:"text-sm font-bold",children:Mt(x.scheduledAt)})]})]}),i.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-[#E5DEFF] px-3 py-2 text-[#7B2CBF]",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xs font-medium opacity-90",children:"Duration"}),i.jsxs("span",{className:"text-sm font-bold",children:[x.durationMinutes," minutes"]})]})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{className:"flex flex-col gap-2 rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Meeting Link"}),i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx("span",{className:"break-all text-sm text-[#212529]",children:x.meetingLink||"Link not available yet"}),x.meetingLink&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>E(x.meetingLink),children:"Copy"})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[x.status!=="completed"&&x.status!=="cancelled"&&x.status!=="cancelled_no_show_creator"&&i.jsx(oe,{variant:"secondary",children:"Add to Calendar"}),i.jsx("button",{disabled:!x.meetingLink||x.status==="completed"||x.status==="cancelled"||x.status==="cancelled_no_show_creator",onClick:()=>y(x.meetingLink),className:`
                          relative rounded-full px-8 py-3 text-base font-semibold transition-all
                          ${!x.meetingLink||x.status==="completed"||x.status==="cancelled"||x.status==="cancelled_no_show_creator"?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white text-[#050014] shadow-lg hover:shadow-xl transform hover:scale-105"}
                        `,style:x.meetingLink&&x.status!=="completed"&&x.status!=="cancelled"&&x.status!=="cancelled_no_show_creator"?{background:"linear-gradient(white, white) padding-box, linear-gradient(135deg, #A78BFA, #C084FC, #E0E7FF) border-box",border:"2px solid transparent"}:void 0,children:x.status==="completed"?"Meeting Ended":x.status==="cancelled_no_show_creator"?"Creator No-Show":x.status==="cancelled"?"Meeting Cancelled":"Join Meeting "})]}),x.status!=="completed"&&x.status!=="cancelled"&&x.status!=="cancelled_no_show_creator"?i.jsxs("span",{className:`text-sm font-medium ${N?"text-[#FF6B35]":"text-[#6C757D]"}`,children:[" Starts in:"," ",i.jsx("strong",{className:N?"text-[#FF6B35]":"text-[#C045FF]",children:pwe(x.scheduledAt)})]}):x.status==="completed"?i.jsx("span",{className:"text-sm text-[#6C757D]",children:" This meeting has been completed"}):i.jsx("span",{className:"text-sm text-[#6C757D]",children:x.status==="cancelled_no_show_creator"?" Creator didn't show up - Full refund issued to your wallet":" This meeting was cancelled"})]})]})]},x.id)})})]}),u?i.jsx(me,{children:i.jsx(ve,{className:"py-8 text-center",children:i.jsx("div",{className:"text-sm text-[#6C757D]",children:"Loading events..."})})}):o.length>0?i.jsxs(me,{children:[i.jsx(Ce,{title:"Events with No Bids",subtitle:"Events that ended without any bids placed.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(ve,{className:"gap-4",children:[o.slice(0,10).map(x=>i.jsxs("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[#E9ECEF] bg-white p-4 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>x.status!=="completed"&&n(`/events/${x.id}`),children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:x.status==="completed"?"default":"primary",children:x.status==="completed"?" Completed - No Bids":" No Bids Yet"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[x.status==="completed"?"Ended":"Starts"," ",Mt(x.starts_at)]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:x.title}),x.description&&i.jsx("p",{className:"text-sm text-[#6C757D] mt-1 line-clamp-2",children:x.description})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Base Price"}),i.jsx("div",{className:"font-semibold text-[#C045FF]",children:Be(x.base_price)})]}),i.jsx(oe,{size:"sm",disabled:x.status==="completed",children:x.status==="completed"?"Event Ended":"View & Bid "})]})]},x.id)),o.length>10&&i.jsx("div",{className:"text-center",children:i.jsx(oe,{variant:"secondary",onClick:()=>n("/fan"),children:"View More Events "})})]})]}):null]})}function fwe(){const{user:r}=fs(),[n,o]=O.useState(!0),[l,u]=O.useState([]),[m,g]=O.useState({totalPaid:0,totalRefunded:0});O.useEffect(()=>{(async()=>{if(!r){u([]),o(!1);return}o(!0);try{const{data:x,error:S}=await ie.from("payments").select("id, amount, status, type, description, created_at").eq("user_id",r.id).order("created_at",{ascending:!1}).limit(50);S&&console.error("Error fetching payments:",S);const{data:C}=await ie.from("bids").select("id, amount, status, created_at, event_id").eq("fan_id",r.id).order("created_at",{ascending:!1}).limit(50),N=(C==null?void 0:C.map(R=>R.event_id))||[],{data:M}=N.length>0?await ie.from("events").select("id, title").in("id",N):{data:[]},G=new Map((M==null?void 0:M.map(R=>[R.id,R.title]))||[]),I=[];if(x)for(const R of x)I.push({id:R.id,date:new Date(R.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:R.description||(R.type==="refund"?"Refund":"Payment"),amount:R.amount,type:R.type==="refund"?"credit":"debit",status:R.status});if(C)for(const R of C){const D=G.get(R.event_id)||"Event",V=R.status==="refunded"||R.status==="lost";I.push({id:`bid-${R.id}`,date:new Date(R.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:`Bid on "${D}"`,amount:R.amount,type:"debit",status:R.status==="won"?"completed":R.status==="active"?"pending":"completed"}),V&&I.push({id:`refund-${R.id}`,date:new Date(R.created_at).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"}),description:`Refund for "${D}" (Auto-refund)`,amount:Math.floor(R.amount*.9),type:"credit",status:"refunded"})}I.sort((R,D)=>new Date(D.date).getTime()-new Date(R.date).getTime());const P=I.filter(R=>R.type==="debit"&&R.status!=="failed").reduce((R,D)=>R+D.amount,0),L=I.filter(R=>R.type==="credit").reduce((R,D)=>R+D.amount,0);u(I),g({totalPaid:P,totalRefunded:L})}finally{o(!1)}})()},[r]);const E=(y,x)=>{if(x==="credit")return i.jsx($e,{variant:"success",children:"Refunded"});switch(y){case"completed":return i.jsx($e,{variant:"success",children:"Completed"});case"pending":return i.jsx($e,{variant:"warning",children:"Pending"});case"failed":return i.jsx($e,{variant:"danger",children:"Failed"});default:return i.jsx($e,{variant:"primary",children:y})}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Payment History"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"View all your payments and refunds. Auto-refunds are processed for unsuccessful bids."})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 max-w-2xl",children:[i.jsx(me,{elevated:!0,children:i.jsxs(ve,{className:"p-4",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Paid"}),i.jsx("div",{className:"mt-1 text-2xl font-bold text-[#212529]",children:n?"...":Be(m.totalPaid)}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:"All-time bid payments"})]})}),i.jsx(me,{elevated:!0,children:i.jsxs(ve,{className:"p-4",children:[i.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunded"}),i.jsx("div",{className:"mt-1 text-2xl font-bold text-green-600",children:n?"...":Be(m.totalRefunded)}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Auto-refunds (90% of bid amount)"})]})})]}),i.jsx(me,{className:"max-w-2xl bg-[#F0FDF4] border-green-200",children:i.jsx(ve,{className:"p-4",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-xl",children:""}),i.jsxs("div",{children:[i.jsx("div",{className:"font-semibold text-green-800",children:"Auto-Refund System Active"}),i.jsx("div",{className:"text-sm text-green-700",children:"If you don't win an event, 90% of your bid amount is automatically refunded to your original payment method within 5-7 business days."})]})]})})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Transaction History",subtitle:"All payments and refunds"}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Date"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Description"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Type"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3 px-2",children:"Status"})]})}),i.jsx("tbody",{className:"text-[#212529]",children:n?i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-sm text-[#6C757D]",children:"Loading payment history..."})}):l.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-sm text-[#6C757D]",children:"No payments yet. Place a bid on an event to get started!"})}):l.map(y=>i.jsxs("tr",{className:"border-b border-[#E9ECEF] hover:bg-[#F8F9FA]",children:[i.jsx("td",{className:"py-3 px-2 whitespace-nowrap",children:y.date}),i.jsx("td",{className:"py-3 px-2",children:y.description}),i.jsx("td",{className:"py-3 px-2",children:i.jsxs("span",{className:y.type==="credit"?"text-green-600 font-semibold":"text-[#212529]",children:[y.type==="credit"?"+":"-",Be(y.amount)]})}),i.jsx("td",{className:"py-3 px-2",children:i.jsx($e,{variant:y.type==="credit"?"success":"primary",children:y.type==="credit"?"Credit":"Debit"})}),i.jsx("td",{className:"py-3 px-2",children:E(y.status,y.type)})]},y.id))})]})})]})]})}function gwe(){const{user:r}=fs(),n=Ss(),[o,l]=O.useState([]),[u,m]=O.useState(!0);return O.useEffect(()=>{async function g(){if(r)try{const{data:E,error:y}=await ie.from("creator_follows").select("creator_id").eq("fan_id",r.id);if(y)throw y;if(E&&E.length>0){const x=E.map(N=>N.creator_id),{data:S,error:C}=await ie.from("profiles").select("*").in("user_id",x);if(C)throw C;S&&l(S)}else l([])}catch(E){console.error("Error fetching following:",E)}finally{m(!1)}}g()},[r]),u?i.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading..."}):i.jsxs("div",{className:"mx-auto flex max-w-4xl flex-col gap-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Following"}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"Creators you follow. Join their upcoming events faster from here."})]}),i.jsxs("div",{className:"space-y-4",children:[o.map(g=>{var E,y;return i.jsx(me,{elevated:!0,className:"border-none bg-white/95",children:i.jsxs(ve,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[i.jsx("div",{className:"flex flex-col gap-1",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(gi,{src:g.avatar_url,initials:((E=g.display_name)==null?void 0:E.charAt(0))||((y=g.username)==null?void 0:y.charAt(0)),size:"md"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:g.display_name||g.username}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",g.username]})]})]})}),i.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[i.jsx($e,{variant:"primary",children:"Following"}),i.jsx("div",{className:"flex gap-2",children:i.jsx(oe,{size:"sm",className:"rounded-full",onClick:()=>n(`/${g.username}`),children:"View profile"})})]})]})},g.user_id)}),o.length===0&&i.jsx(me,{children:i.jsx(ve,{children:i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Youre not following any creators yet. Start by placing a bid or hitting follow on a creator profile."})})})]})]})}const _we={active:"primary",lost:"danger",won:"success"};function vwe(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(!0);return O.useEffect(()=>{(async()=>{if(r)try{const{data:y,error:x}=await ie.from("meets").select(`
            id,
            scheduled_at,
            status,
            event_id,
            creator_id
          `).eq("fan_id",r.id).eq("status","completed").order("scheduled_at",{ascending:!1});if(x)throw x;const S=await Promise.all((y||[]).map(async G=>{const{data:I}=await ie.from("events").select("title").eq("id",G.event_id).single(),{data:P}=await ie.from("profiles").select("display_name").eq("user_id",G.creator_id).single(),{data:L}=await ie.from("bids").select("amount").eq("event_id",G.event_id).eq("bidder_id",r.id).eq("status","won").single();return{id:G.id,creator_name:(P==null?void 0:P.display_name)||"Unknown Creator",event_title:(I==null?void 0:I.title)||"Unknown Event",scheduled_at:G.scheduled_at,amount:(L==null?void 0:L.amount)||0,status:G.status}}));o(S);const{data:C,error:N}=await ie.from("bids").select(`
            id,
            amount,
            status,
            created_at,
            event_id
          `).eq("bidder_id",r.id).eq("status","active").order("created_at",{ascending:!1});if(N)throw N;const M=await Promise.all((C||[]).map(async G=>{const{data:I}=await ie.from("events").select("title, creator_id").eq("id",G.event_id).single();let P="Unknown Creator";if(I!=null&&I.creator_id){const{data:L}=await ie.from("profiles").select("display_name").eq("user_id",I.creator_id).single();P=(L==null?void 0:L.display_name)||"Unknown Creator"}return{id:G.id,creator_name:P,event_title:(I==null?void 0:I.title)||"Unknown Event",created_at:G.created_at,amount:G.amount,status:G.status}}));u(M)}catch(y){console.error("Error fetching history:",y)}finally{g(!1)}})()},[r]),m?i.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading history..."}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"History"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Catch up on your past sessions and keep tabs on upcoming requests."})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Past Experiences",subtitle:"Rate your meets and revisit standout memories.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(ve,{className:"gap-6",children:n.length===0?i.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No past meets yet."}):n.map(E=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:"primary",children:E.creator_name}),i.jsx("span",{className:"text-sm text-[#6C757D]",children:Mt(new Date(E.scheduled_at))})]}),i.jsx("h3",{className:"mt-2 text-lg font-semibold text-[#212529]",children:E.event_title})]}),i.jsxs("div",{className:"flex flex-col items-end gap-2",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Winning Bid"}),i.jsx("span",{className:"text-xl font-semibold text-[#212529]",children:Be(E.amount)})]})]},E.id))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Pending Requests",subtitle:"Stay updated on events waiting for confirmation.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(ve,{className:"gap-4",children:[l.length===0?i.jsx("div",{className:"text-center text-sm text-[#6C757D] py-4",children:"No pending requests."}):l.map(E=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Requested on ",Mt(new Date(E.created_at))]}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:E.event_title}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",E.creator_name]})]}),i.jsxs("div",{className:"flex flex-col items-end gap-2",children:[i.jsx($e,{variant:_we[E.status]??"default",children:E.status}),i.jsxs("span",{className:"text-sm font-medium text-[#212529]",children:["Bid: ",Be(E.amount)]})]})]},E.id)),i.jsx(oe,{variant:"ghost",className:"self-start",children:"View all requests "})]})]})]})}function Ewe(){const{notifications:r,markNotificationAsRead:n,markAllNotificationsAsRead:o}=Xg();return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-[#111827]",children:"Notifications"}),i.jsx("p",{className:"text-[#6C757D]",children:"Manage your alerts and preferences"})]}),i.jsxs("button",{onClick:()=>o(),className:"flex items-center gap-2 text-sm font-medium text-[#FF6B35] hover:text-[#E85D2E]",children:[i.jsx(MH,{className:"h-4 w-4"}),"Mark all as read"]})]}),i.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[i.jsx("div",{className:"lg:col-span-2 space-y-4",children:i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[i.jsx("h2",{className:"mb-4 text-lg font-semibold text-[#111827]",children:"Latest alerts"}),i.jsx("div",{className:"space-y-4",children:r.length===0?i.jsx("div",{className:"text-center py-8 text-[#6C757D]",children:"No notifications yet"}):r.map(l=>i.jsxs("div",{className:`flex gap-4 rounded-lg border p-4 transition-colors cursor-pointer ${l.read?"border-transparent bg-white":"border-[#FFE5D9] bg-[#FFF5F2]"}`,onClick:()=>!l.read&&n(l.id),children:[i.jsx("div",{className:`mt-1 flex h-8 w-8 flex-none items-center justify-center rounded-full ${l.read?"bg-[#F8F9FA] text-[#6C757D]":"bg-[#FFE5D9] text-[#FF6B35]"}`,children:i.jsx(LH,{className:"h-4 w-4"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsx("h3",{className:`font-medium ${l.read?"text-[#111827]":"text-[#FF6B35]"}`,children:l.title}),i.jsx("span",{className:"whitespace-nowrap text-xs text-[#6C757D]",children:lu(new Date(l.created_at),"MMM d, h:mm a")})]}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:l.message})]}),!l.read&&i.jsx("div",{className:"mt-2 h-2 w-2 rounded-full bg-[#FF6B35]"})]},l.id))})]})}),i.jsx("div",{className:"space-y-6",children:i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[i.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[i.jsx(GH,{className:"h-5 w-5 text-[#6C757D]"}),i.jsx("h2",{className:"text-lg font-semibold text-[#111827]",children:"Preferences"})]}),i.jsx("div",{className:"space-y-4",children:["Email notifications","Push notifications","SMS alerts"].map(l=>i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm text-[#111827]",children:l}),i.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[i.jsx("input",{type:"checkbox",className:"peer sr-only",defaultChecked:!0}),i.jsx("div",{className:"peer h-6 w-11 rounded-full bg-[#E9ECEF] after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-[#FF6B35] peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#FFE5D9]"})]})]},l))})]})})]})]})}function ywe(){const{user:r}=fs(),[n,o]=O.useState(!1),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState(""),[C,N]=O.useState(""),[M,G]=O.useState(""),[I,P]=O.useState([]);O.useEffect(()=>{if(!r)return;(async()=>{o(!0);try{const{data:D,error:V}=await ie.from("profiles").select("display_name, username, bio, primary_language, timezone").eq("user_id",r.id).single();V?console.error("Error fetching profile:",V):D&&(g(D.display_name||""),y(D.username||""),S(D.bio||""),N(D.primary_language||""),G(D.timezone||""));const{data:W,error:q}=await ie.from("security_logs").select("*").eq("user_id",r.id).order("created_at",{ascending:!1}).limit(5);q?console.error("Error fetching security logs:",q):W&&P(W)}catch(D){console.error("Unexpected error fetching data:",D)}finally{o(!1)}})()},[r]);const L=async()=>{if(r){u(!0);try{if(E){const{data:D,error:V}=await ie.from("profiles").select("user_id").eq("username",E).neq("user_id",r.id).maybeSingle();if(V){console.error("Error checking username:",V),alert("Error checking username availability."),u(!1);return}if(D){alert("Username already taken. Please choose another one."),u(!1);return}}const{error:R}=await ie.from("profiles").update({display_name:m,username:E,bio:x,primary_language:C,timezone:M,updated_at:new Date().toISOString()}).eq("user_id",r.id);alert(R?"Error updating profile: "+R.message:"Profile updated successfully!")}catch(R){console.error("Error saving profile:",R),alert("Failed to save profile.")}finally{u(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Settings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Update your profile details, preferences, and review recent security activity."})]}),i.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,0.8fr)]",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Profile",subtitle:"Let creators know who theyre meeting."}),i.jsxs(ve,{className:"gap-5",children:[i.jsx(nt,{label:"Full name",placeholder:"Your Name",value:m,onChange:R=>g(R.target.value),disabled:n}),i.jsx(nt,{label:"Public username",placeholder:"@username",value:E,onChange:R=>y(R.target.value),disabled:n}),i.jsx(dr,{label:"About you",placeholder:"Share your interests, favorite creators, and background.",value:x,onChange:R=>S(R.target.value),rows:4,disabled:n}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Preferred language",placeholder:"English",value:C,onChange:R=>N(R.target.value),disabled:n}),i.jsx(nt,{label:"Timezone",placeholder:"IST",value:M,onChange:R=>G(R.target.value),disabled:n})]}),i.jsx(oe,{size:"lg",onClick:L,disabled:n||l,children:l?"Saving...":"Save profile"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Communication",subtitle:"Choose how we keep you informed."}),i.jsxs(ve,{className:"gap-4 text-sm text-[#212529]",children:[i.jsxs("label",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",defaultChecked:!0,className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Email me when Im outbid on an event"]}),i.jsxs("label",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",defaultChecked:!0,className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Remind me 24 hours before a meet"]}),i.jsxs("label",{className:"flex items-center gap-3",children:[i.jsx("input",{type:"checkbox",className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Send me creator spotlights and platform updates"]}),i.jsx(oe,{variant:"secondary",className:"self-start",children:"Save preferences"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Security activity",subtitle:"Recent actions that impact your account safety.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(ve,{className:"gap-4",children:[I.length===0?i.jsx("div",{className:"text-sm text-[#6C757D]",children:"No recent security activity found."}):I.map(R=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-semibold text-[#212529]",children:R.event_type}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:[new Date(R.created_at).toLocaleString(),"  ",R.location||"Unknown Location"]})]}),i.jsx($e,{variant:"default",children:"Logged"})]},R.id)),i.jsx(oe,{variant:"ghost",className:"self-start",children:"Review all security events "})]})]})]})}const xwe={online:"#22c55e",dnd:"#ef4444",offline:"#9ca3af"};function bwe({status:r}){return i.jsx("span",{"aria-label":r,className:"inline-block h-2.5 w-2.5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:xwe[r]}})}function wwe(){const[r,n]=O.useState(""),[o,l]=O.useState(null),{messages:u,sendMessage:m,markMessageAsRead:g}=Xg(),{user:E}=fs(),y=O.useMemo(()=>{if(!E||!u)return[];const N=new Map;return u.forEach(M=>{const G=M.sender_id===E.id?M.receiver_id:M.sender_id,I=M.sender_id===E.id?M.receiver_display_name:M.sender_display_name,P=M.sender_id===E.id?M.receiver_username:M.sender_username,L=N.get(G),R=!M.read&&M.receiver_id===E.id;L?(new Date(M.created_at)>new Date(L.lastTime)&&(L.lastMessage=M.message,L.lastTime=M.created_at),R&&(L.unread+=1)):N.set(G,{id:G,participant:{id:G,name:I||"Unknown User",username:P||"unknown",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${I||"User"}`,status:"offline"},lastMessage:M.message,lastTime:M.created_at,unread:R?1:0})}),Array.from(N.values()).sort((M,G)=>new Date(G.lastTime).getTime()-new Date(M.lastTime).getTime())},[u,E]),x=O.useMemo(()=>y.find(N=>N.id===o)||null,[y,o]),S=O.useMemo(()=>u.filter(N=>N.sender_id===(E==null?void 0:E.id)&&N.receiver_id===o||N.sender_id===o&&N.receiver_id===(E==null?void 0:E.id)),[u,E,o]);O.useEffect(()=>{o&&E&&S.filter(M=>!M.read&&M.receiver_id===E.id).forEach(M=>g(M.id))},[o,S,E,g]);const C=async N=>{if(N.preventDefault(),!(!r.trim()||!o))try{await m(o,r),n("")}catch(M){console.error("Failed to send message:",M)}};return i.jsxs("div",{className:"flex h-[calc(100vh-140px)] flex-col gap-4 md:flex-row",children:[i.jsxs("div",{className:`flex w-full flex-col gap-3 md:w-80 ${x?"hidden md:flex":"flex"}`,children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Messages"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Chat with creators after your meets."})]}),i.jsxs(me,{className:"flex h-full min-h-[260px] flex-col overflow-hidden",children:[i.jsx(Ce,{className:"flex flex-row items-center justify-between gap-2 border-b border-[#E9ECEF] pb-3",children:i.jsxs("div",{children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Conversations"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Tap a creator to open your chat."})]})}),i.jsx(ve,{className:"min-h-0 flex-1 gap-2 p-0",children:i.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[y.map(N=>{const M=N.id===o;return i.jsxs("button",{type:"button",onClick:()=>l(N.id),className:`mb-2 flex w-full items-center gap-3 rounded-[12px] border px-3 py-2 text-left text-sm transition-colors ${M?"border-[#C045FF] bg-[#F4E6FF] text-[#140423]":"border-[#E9ECEF] bg-white text-[#212529] hover:border-[#C045FF]/50 hover:bg-[#F8F5FF]"}`,children:[i.jsx(gi,{src:N.participant.avatar,alt:N.participant.name,initials:N.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsx("span",{className:"truncate text-[13px] font-semibold",children:N.participant.name}),i.jsx("span",{className:"whitespace-nowrap text-[11px] text-[#6C757D]",children:lu(new Date(N.lastTime),"h:mm a")})]}),i.jsx("span",{className:"mt-0.5 line-clamp-1 text-[12px] text-[#6C757D]",children:N.lastMessage})]}),N.unread>0&&i.jsx("span",{className:"ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-[#C045FF] px-1 text-[11px] font-semibold text-white",children:N.unread})]},N.id)}),y.length===0&&i.jsx("p",{className:"pt-4 text-center text-xs text-[#6C757D]",children:"No conversations yet. Join a FanMeet to start chatting with creators."})]})})]})]}),i.jsx(me,{elevated:!0,className:`flex h-full w-full flex-1 flex-col overflow-hidden ${x?"flex":"hidden md:flex"}`,children:x?i.jsxs(i.Fragment,{children:[i.jsxs(Ce,{className:"flex flex-row items-center justify-between gap-3 border-b border-[#E9ECEF] bg-white/80 py-3 backdrop-blur",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{type:"button",className:"flex h-8 w-8 items-center justify-center rounded-full border border-[#E9ECEF] bg-white text-sm text-[#343A40] md:hidden",onClick:()=>l(null),children:""}),i.jsx(gi,{src:x.participant.avatar,alt:x.participant.name,initials:x.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:x.participant.name}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#6C757D]",children:[x.participant.status&&i.jsx(bwe,{status:x.participant.status}),i.jsx("span",{children:x.participant.status==="online"?"Online now":"Offline"})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(oe,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:i.jsx(zH,{className:"h-4 w-4","aria-hidden":"true"})}),i.jsx(oe,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:i.jsx(UH,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),i.jsxs(ve,{className:"flex min-h-0 flex-1 flex-col p-0",children:[i.jsx("div",{className:"flex-1 space-y-4 overflow-y-auto bg-[#F8F9FA] p-4",children:S.map(N=>{var G;const M=N.sender_id===(E==null?void 0:E.id);return i.jsx("div",{className:`group my-2 flex gap-2 ${M?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`flex max-w-[80%] items-start gap-2 ${M?"flex-row-reverse":"flex-row"}`,children:[i.jsx(gi,{src:M?`https://api.dicebear.com/9.x/initials/svg?seed=${((G=E==null?void 0:E.user_metadata)==null?void 0:G.full_name)||"Me"}`:x.participant.avatar,alt:M?"Me":x.participant.name,initials:M?"Me":x.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{children:[i.jsx("div",{className:`rounded-2xl px-3 py-2 text-sm ${M?"border-2 border-transparent text-[#050014] shadow-[0_10px_30px_rgba(0,0,0,0.25)]":"border border-[#E9ECEF] bg-white text-[#212529]"}`,style:M?{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"}:void 0,children:N.message}),i.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-[#6C757D]",children:[i.jsx("time",{dateTime:N.created_at,children:lu(new Date(N.created_at),"h:mm a")}),i.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(WH,{className:"h-3 w-3","aria-hidden":"true"})}),i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(FH,{className:"h-3 w-3","aria-hidden":"true"})}),!M&&i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:i.jsx(BH,{className:"h-3 w-3","aria-hidden":"true"})}),M&&i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:i.jsx(HH,{className:"h-3 w-3","aria-hidden":"true"})}),i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(VH,{className:"h-3 w-3","aria-hidden":"true"})})]})]})]})]})},N.id)})}),i.jsx("div",{className:"border-t border-[#E9ECEF] bg-white p-3",children:i.jsxs("form",{onSubmit:C,className:"flex items-center gap-3",children:[i.jsx("input",{type:"text",value:r,onChange:N=>n(N.target.value),placeholder:"Type your message...",className:"h-11 flex-1 rounded-[12px] border-2 border-[#E9ECEF] bg-white px-4 text-sm text-[#212529] placeholder:text-[#ADB5BD] focus:border-[#C045FF] focus:shadow-[0_0_0_3px_rgba(192,69,255,0.18)] focus:outline-none"}),i.jsx(oe,{type:"submit",size:"md",disabled:!r.trim(),className:"px-5 text-sm",children:"Send"})]})})]})]}):i.jsx("div",{className:"flex h-full flex-1 items-center justify-center bg-[#F8F9FA] p-6 text-center text-sm text-[#6C757D]",children:i.jsx("p",{className:"max-w-xs",children:"Select a conversation to start messaging a creator. After your next FanMeet, their chat will appear here."})})})]})}const Swe={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"};function Cwe(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState(!1),[C,N]=O.useState(!0),[M,G]=O.useState(null),[I,P]=O.useState(""),[L,R]=O.useState(!1);O.useEffect(()=>{(async()=>{if(!r){N(!1);return}const{data:q,error:H}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at").eq("user_id",r.id).order("created_at",{ascending:!1});if(H||!q){console.error("Error fetching support tickets:",H),o([]),N(!1);return}o(q.map(J=>({id:J.id,subject:J.subject,description:J.description,status:J.status,createdAt:J.created_at,updatedAt:J.updated_at}))),N(!1)})()},[r]),O.useEffect(()=>{(async()=>{if(!M){u([]);return}const{data:q,error:H}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at").eq("ticket_id",M).order("created_at",{ascending:!0});if(H||!q){console.error("Error fetching replies:",H),u([]);return}u(q.map(J=>({id:J.id,message:J.message,isAdminReply:J.is_admin_reply,createdAt:J.created_at})))})()},[M]);const D=async()=>{if(!r||!M||!I.trim()){alert("Please enter a message.");return}R(!0);try{const{error:W}=await ie.from("ticket_replies").insert({ticket_id:M,user_id:r.id,message:I.trim(),is_admin_reply:!1});if(W){console.error("Error sending reply:",W),alert("Failed to send reply.");return}u(q=>[...q,{id:`temp-${Date.now()}`,message:I.trim(),isAdminReply:!1,createdAt:new Date().toISOString()}]),P(""),alert("Reply sent! Our support team will respond soon.")}finally{R(!1)}};n.find(W=>W.id===M);const V=async()=>{if(!r){alert("Please log in to raise a support ticket.");return}if(!m.trim()||!E.trim()){alert("Please enter a subject and description.");return}S(!0);try{const{data:W,error:q}=await ie.from("support_tickets").insert({user_id:r.id,subject:m.trim(),description:E.trim(),status:"open"}).select("id, subject, description, status, created_at, updated_at").single();if(q||!W){console.error("Error creating support ticket:",q),alert("Failed to create support ticket.");return}o(H=>[{id:W.id,subject:W.subject,description:W.description,status:W.status,createdAt:W.created_at,updatedAt:W.updated_at},...H]),g(""),y(""),alert("Support ticket created successfully. Our team will get back to you.")}finally{S(!1)}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs(me,{children:[i.jsx(Ce,{title:"Help & Support",subtitle:"Raise a ticket if you face issues with payments, meets, or your account."}),i.jsxs(ve,{className:"gap-4",children:[i.jsx(dr,{label:"Subject",rows:2,placeholder:"Briefly describe your issue",value:m,onChange:W=>g(W.target.value)}),i.jsx(dr,{label:"Details",rows:5,placeholder:"Share as many details as possible, including event names, creators, dates, and screenshots where relevant.",value:E,onChange:W=>y(W.target.value)}),i.jsx(oe,{onClick:V,disabled:x,children:x?"Submitting":"Submit Ticket"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Your Tickets",subtitle:"Click a ticket to view the conversation and reply."}),i.jsx(ve,{className:"flex flex-col gap-3",children:C?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading tickets"}):n.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"You have not raised any tickets yet."}):n.map(W=>i.jsxs("div",{children:[i.jsxs("button",{type:"button",onClick:()=>G(M===W.id?null:W.id),className:`w-full text-left rounded-[12px] border p-4 text-sm text-[#212529] transition-all ${M===W.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-white hover:border-[#C045FF]/50"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-semibold",children:W.subject}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Mt(W.createdAt)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($e,{variant:Swe[W.status],children:W.status.replace("_"," ")}),i.jsx("span",{className:"text-[#6C757D]",children:M===W.id?"":""})]})]}),i.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-[#6C757D] whitespace-pre-line",children:W.description})]}),M===W.id&&i.jsxs("div",{className:"mt-2 ml-4 border-l-2 border-[#C045FF] pl-4 space-y-4",children:[i.jsx("div",{className:"space-y-3",children:l.length===0?i.jsx("p",{className:"text-sm text-[#6C757D] py-2",children:"No replies yet. Our support team will respond soon."}):l.map(q=>i.jsxs("div",{className:`rounded-[10px] p-3 text-sm ${q.isAdminReply?"bg-[#F4E6FF] border-l-4 border-[#C045FF]":"bg-[#F8F9FA]"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[i.jsx("span",{className:`font-semibold ${q.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:q.isAdminReply?" Support Team":"You"}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Mt(q.createdAt)})]}),i.jsx("p",{className:"text-[#212529] whitespace-pre-line",children:q.message})]},q.id))}),W.status!=="closed"&&W.status!=="resolved"&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(dr,{label:"Reply to this ticket",rows:3,placeholder:"Type your message...",value:I,onChange:q=>P(q.target.value)}),i.jsx(oe,{size:"sm",onClick:D,disabled:L||!I.trim(),children:L?"Sending...":"Send Reply"})]}),(W.status==="closed"||W.status==="resolved")&&i.jsxs("p",{className:"text-sm text-[#6C757D] italic",children:["This ticket is ",W.status,". Create a new ticket if you need further assistance."]})]})]},W.id))})]})]})}const Twe=[{value:"all",label:"All Events",emoji:""},{value:"entertainment",label:"Entertainment",emoji:""},{value:"music",label:"Music",emoji:""},{value:"education",label:"Education",emoji:""},{value:"fitness",label:"Fitness",emoji:""},{value:"gaming",label:"Gaming",emoji:""},{value:"lifestyle",label:"Lifestyle",emoji:""},{value:"general",label:"General",emoji:""}],Nwe=[{value:"popular",label:"Most Popular"},{value:"ending-soon",label:"Ending Soon"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"},{value:"newest",label:"Newly Added"}],Ay=20;function Rwe(){const r=Ss(),[n,o]=Gp(),{events:l}=Yo(),[u,m]=O.useState(n.get("category")||"all"),[g,E]=O.useState(n.get("sort")||"popular"),[y,x]=O.useState(n.get("q")||""),[S,C]=O.useState(parseInt(n.get("page")||"1",10));O.useEffect(()=>{const L=new URLSearchParams;u!=="all"&&L.set("category",u),g!=="popular"&&L.set("sort",g),y&&L.set("q",y),S>1&&L.set("page",String(S)),o(L,{replace:!0})},[u,g,y,S]);const N=O.useMemo(()=>[...l.filter(D=>{var V;if(u!=="all"&&D.category!==u)return!1;if(y){const W=y.toLowerCase();return D.title.toLowerCase().includes(W)||D.creatorDisplayName.toLowerCase().includes(W)||((V=D.description)==null?void 0:V.toLowerCase().includes(W))}return!0})].sort((D,V)=>{switch(g){case"popular":return V.participants-D.participants;case"price-low":return D.basePrice-V.basePrice;case"price-high":return V.basePrice-D.basePrice;case"newest":return V.id.localeCompare(D.id);case"ending-soon":const W=q=>q.includes("Closed")?999999:q.includes("days")?parseInt(q)*24*60:q.includes("hours")?parseInt(q)*60:q.includes("minutes")?parseInt(q):0;return W(D.endsIn)-W(V.endsIn);default:return 0}}),[l,u,g,y]),M=Math.ceil(N.length/Ay),G=(S-1)*Ay,I=N.slice(G,G+Ay);O.useEffect(()=>{C(1)},[u,g,y]);const P=L=>{C(L),window.scrollTo({top:0,behavior:"smooth"})};return i.jsxs("div",{className:"flex flex-col gap-8 overflow-x-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"All Events"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Browse through all ",N.length," available events"]})]}),i.jsx(oe,{variant:"secondary",onClick:()=>r("/fan"),children:" Back to Dashboard"})]}),i.jsx(me,{children:i.jsxs(ve,{className:"gap-6",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Search events or creators...",value:y,onChange:L=>x(L.target.value),className:"w-full rounded-[12px] border-2 border-[#E9ECEF] px-4 py-3 pr-12 text-sm focus:border-[#C045FF] focus:outline-none"}),i.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xl",children:""})]}),i.jsxs("div",{className:"overflow-x-hidden",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Categories"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:Twe.map(L=>i.jsxs("button",{onClick:()=>m(L.value),className:`flex-shrink-0 rounded-full border-2 px-3 py-1.5 text-xs font-medium transition-all md:px-4 md:py-2 md:text-sm ${u===L.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:[i.jsx("span",{className:"mr-1",children:L.emoji}),L.label]},L.value))})]}),i.jsxs("div",{className:"overflow-x-hidden",children:[i.jsx("h3",{className:"mb-3 text-sm font-semibold text-[#212529]",children:"Sort By"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:Nwe.map(L=>i.jsx("button",{onClick:()=>E(L.value),className:`flex-shrink-0 whitespace-nowrap rounded-full border-2 px-3 py-1.5 text-xs font-medium transition-all md:px-4 md:py-2 md:text-sm ${g===L.value?"border-[#C045FF] bg-[#C045FF] text-white":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,children:L.label},L.value))})]})]})}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("h2",{className:"text-lg font-semibold text-[#212529]",children:[N.length," ",N.length===1?"Event":"Events",N.length>Ay&&i.jsxs("span",{className:"ml-2 text-sm font-normal text-[#6C757D]",children:["(Page ",S," of ",M,")"]})]}),(u!=="all"||y)&&i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>{m("all"),x("")},children:"Clear Filters"})]}),I.length===0?i.jsx(me,{children:i.jsxs(ve,{className:"py-12 text-center",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529] mb-2",children:"No events found"}),i.jsx("p",{className:"text-sm text-[#6C757D] mb-4",children:"Try adjusting your filters or search query"}),i.jsx(oe,{onClick:()=>{m("all"),x("")},children:"Clear Filters"})]})}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:I.map(L=>i.jsx(me,{className:"group cursor-pointer transition-all hover:shadow-[0_12px_30px_rgba(160,64,255,0.15)]",onClick:()=>r(`/events/${L.id}`),children:i.jsxs(ve,{className:"gap-4",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"mb-1 text-xs text-[#6C757D]",children:L.creatorDisplayName}),i.jsx("h3",{className:"text-base font-semibold text-[#212529] group-hover:text-[#C045FF]",children:L.title})]}),L.status==="Accepting Bids"?i.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:i.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx($e,{variant:L.status==="LIVE"?"danger":"primary",children:L.status})]}),L.description&&i.jsx("p",{className:"line-clamp-2 text-sm text-[#6C757D]",children:L.description}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Current Bid"}),i.jsx("div",{className:"font-semibold text-[#C045FF]",children:Be(L.currentBid)})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Base Price"}),i.jsx("div",{className:"font-semibold text-[#212529]",children:Be(L.basePrice)})]})]}),i.jsxs("div",{className:"flex items-center justify-between border-t border-[#E9ECEF] pt-3 text-xs text-[#6C757D]",children:[i.jsxs("span",{children:[" ",L.participants," bidding"]}),i.jsxs("span",{children:[" ",L.endsIn]})]}),i.jsx(oe,{className:"w-full",size:"sm",children:"View & Bid "})]})},L.id))}),M>1&&i.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>P(S-1),disabled:S===1,children:" Previous"}),i.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:M},(L,R)=>R+1).map(L=>{const R=L===1||L===M||Math.abs(L-S)<=1,D=L===2&&S>3||L===M-1&&S<M-2;return!R&&!D?null:D&&!R?i.jsx("span",{className:"px-2 text-[#6C757D]",children:"..."},L):i.jsx("button",{onClick:()=>P(L),className:`min-w-[36px] rounded-lg px-3 py-2 text-sm font-medium transition-all ${S===L?"bg-[#C045FF] text-white":"bg-[#F8F9FA] text-[#6C757D] hover:bg-[#E9ECEF]"}`,children:L},L)})}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>P(S+1),disabled:S===M,children:"Next "})]})]})]})}const m7="dvtdzotx2",f7="ml_default";function Awe(r){const n=typeof r=="string"?new Date(r):r,o=Date.now()-n.getTime(),l=Math.floor(o/1e3);if(l<60)return"Just now";const u=Math.floor(l/60);if(u<60)return`${u} min${u===1?"":"s"} ago`;const m=Math.floor(u/60);if(m<24)return`${m} hour${m===1?"":"s"} ago`;const g=Math.floor(m/24);if(g<7)return`${g} day${g===1?"":"s"} ago`;const E=Math.floor(g/7);return`${E} week${E===1?"":"s"} ago`}function Iwe(r){const n=r.trim();if(!n)return"";const o=n.split(/\s+/);return o.length===1?o[0].slice(0,2).toUpperCase():`${o[0][0]}${o[1][0]}`.toUpperCase()}function Dwe(){var le,Le,fe;const r=Ss(),{user:n}=fs(),{events:o}=Yo(),[l,u]=O.useState([]),[m,g]=O.useState(!1),[E,y]=O.useState(0),[x,S]=O.useState(0),[C,N]=O.useState(0),[M,G]=O.useState(void 0),[I,P]=O.useState([]),[L,R]=O.useState(!1),[D,V]=O.useState(null),[W,q]=O.useState(""),[H,J]=O.useState(!1),ee=O.useRef(null);O.useEffect(()=>{(async()=>{if(!n)return;const{data:be}=await ie.from("profiles").select("profile_photo_url, display_name").eq("user_id",n.id).single();be&&(V(be.profile_photo_url||null),q(be.display_name||""))})()},[n]);const ne=async ae=>{var We,it;const be=(We=ae.target.files)==null?void 0:We[0];if(!(!be||!n)){if(!be.type.startsWith("image/")){alert("Please select an image file.");return}if(be.size>5*1024*1024){alert("Image must be less than 5MB.");return}J(!0);try{const Ge=new FormData;Ge.append("file",be),Ge.append("upload_preset",f7),Ge.append("folder","fanmeet/profiles"),console.log(" Uploading to Cloudinary..."),console.log("Cloud Name:",m7),console.log("Upload Preset:",f7),console.log("File:",be.name,be.type,be.size);const pt=await fetch(`https://api.cloudinary.com/v1_1/${m7}/image/upload`,{method:"POST",body:Ge});console.log("Response status:",pt.status);const Ze=await pt.text();if(console.log("Response body:",Ze),!pt.ok){let Ue="Upload failed";try{const ke=JSON.parse(Ze);Ue=((it=ke.error)==null?void 0:it.message)||JSON.stringify(ke),console.error(" Cloudinary error:",ke)}catch{console.error(" Response text:",Ze)}throw new Error(Ue)}const Me=JSON.parse(Ze);console.log(" Upload successful:",Me.secure_url),await ie.from("profiles").update({profile_photo_url:Me.secure_url}).eq("user_id",n.id),V(Me.secure_url),alert("Profile photo updated!")}catch(Ge){console.error("Upload error:",Ge),alert(`Failed to upload photo: ${Ge instanceof Error?Ge.message:"Unknown error"}`)}finally{J(!1),ee.current&&(ee.current.value="")}}},pe=async()=>{if(!(!n||!confirm("Remove your profile photo?"))){J(!0);try{await ie.from("profiles").update({profile_photo_url:null}).eq("user_id",n.id),V(null),alert("Profile photo removed.")}catch{alert("Failed to remove photo.")}finally{J(!1)}}};O.useEffect(()=>{(async()=>{g(!0);try{const be=new Date,We=new Date(be.getFullYear(),be.getMonth(),1),it=new Date(be.getFullYear(),be.getMonth()+1,1),{data:Ge,error:pt}=await ie.from("bids").select("event_id, amount, status, created_at").eq("status","won").gte("created_at",We.toISOString()).lt("created_at",it.toISOString());if(pt||!Ge||Ge.length===0){u([]);return}const Ze=Array.from(new Set(Ge.map(Ft=>Ft.event_id)));if(Ze.length===0){u([]);return}const{data:Me,error:Ue}=await ie.from("events").select("id, creator_id").in("id",Ze);if(Ue||!Me||Me.length===0){u([]);return}const ke=new Map(Me.map(Ft=>[Ft.id,Ft.creator_id])),Ie=new Map;for(const Ft of Ge){const zt=ke.get(Ft.event_id);if(!zt)continue;const vt=Ie.get(zt)??0;Ie.set(zt,vt+(Ft.amount??0))}if(Ie.size===0){u([]);return}const Xe=Array.from(Ie.entries()).sort((Ft,zt)=>zt[1]-Ft[1]).slice(0,3),ye=Xe.map(([Ft])=>Ft),{data:Oe}=await ie.from("profiles").select("user_id, display_name, username, category").in("user_id",ye),qe=new Map((Oe??[]).map(Ft=>[Ft.user_id,Ft])),Ct=Xe.map(([Ft,zt])=>{const vt=qe.get(Ft),ds=(vt==null?void 0:vt.display_name)||(vt==null?void 0:vt.username)||"Creator",kt=vt!=null&&vt.username?`@${vt.username}`:"@creator",Ps=(vt==null?void 0:vt.category)||"general";return{id:Ft,displayName:ds,handle:kt,category:Ps,earnings:zt,initials:Iwe(ds)}});u(Ct)}finally{g(!1)}})()},[]),O.useEffect(()=>{(async()=>{if(!n){y(0),S(0),N(0),P([]),G(void 0);return}R(!0);try{let be=0,We=0,it;const{count:Ge}=await ie.from("meets").select("id",{count:"exact",head:!0}).eq("creator_id",n.id).eq("status","completed");N(typeof Ge=="number"?Ge:0);const{data:pt}=await ie.from("events").select("id, title").eq("creator_id",n.id),Ze=new Map((pt??[]).map(ye=>[ye.id,ye.title])),Me=Array.from(Ze.keys()),Ue=[];if(Me.length>0){const{data:ye}=await ie.from("bids").select("id, event_id, amount, status, created_at").in("event_id",Me).order("created_at",{ascending:!1}),Oe=(ye??[]).filter(qe=>qe.status==="won");if(Oe.length>0){const qe=new Date;be=Oe.reduce((ds,kt)=>ds+(kt.amount??0),0);const Ct=new Date(qe.getFullYear(),qe.getMonth(),1),Ft=new Date(qe.getFullYear(),qe.getMonth()-1,1),zt=Oe.filter(ds=>new Date(ds.created_at)>=Ct).reduce((ds,kt)=>ds+(kt.amount??0),0),vt=Oe.filter(ds=>{const kt=new Date(ds.created_at);return kt>=Ft&&kt<Ct}).reduce((ds,kt)=>ds+(kt.amount??0),0);if(vt>0){const ds=(zt-vt)/vt*100,kt=Math.round(ds);it=`${kt>=0?"+":""}${kt}% vs last month`}else zt>0?it="New this month":it=void 0}(ye??[]).forEach(qe=>{const Ct=Ze.get(qe.event_id)??"Event";Ue.push({id:`bid-${qe.id}`,description:`New bid of ${Be(qe.amount)} on ${Ct}`,createdAt:qe.created_at})})}const{data:ke}=await ie.from("withdrawal_requests").select("id, amount, status, requested_at").eq("creator_id",n.id).order("requested_at",{ascending:!1}).limit(10);let Ie=0;(ke??[]).forEach(ye=>{ye.status==="completed"&&(Ie+=ye.amount??0),Ue.push({id:`wd-${ye.id}`,description:`Withdrawal request of ${Be(ye.amount)} (${ye.status})`,createdAt:ye.requested_at})}),We=Math.max(be-Ie,0),y(be),S(We),G(it),Ue.sort((ye,Oe)=>new Date(Oe.createdAt).getTime()-new Date(ye.createdAt).getTime());const Xe=Ue.slice(0,10).map(ye=>({id:ye.id,description:ye.description,time:Awe(ye.createdAt)}));P(Xe)}finally{R(!1)}})()},[n]);const ge=(n?o.filter(ae=>ae.creatorUsername===n.username):[]).filter(ae=>ae.status==="LIVE"||ae.status==="Upcoming").length,he=[{id:"stat-1",icon:"",title:"Total Earnings",value:E,change:M},{id:"stat-2",icon:"",title:"Active Events",value:ge.toString(),caption:`${ge} upcoming or live`},{id:"stat-3",icon:"",title:"Pending Balance",value:x,action:"Withdraw ",actionLink:"/creator/withdrawals"},{id:"meets",icon:"",title:"Completed Meets",value:C.toString(),caption:"Happy fans across sessions"}];return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx(me,{elevated:!0,className:"border-none",children:i.jsx(ve,{className:"gap-4",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"relative",children:D?i.jsx("img",{src:D,alt:"Profile",className:"h-20 w-20 rounded-full object-cover ring-2 ring-[#C045FF]/30"}):i.jsx("div",{className:"h-20 w-20 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-2xl ring-2 ring-[#C045FF]/30",children:((le=W==null?void 0:W.charAt(0))==null?void 0:le.toUpperCase())||((fe=(Le=n==null?void 0:n.email)==null?void 0:Le.charAt(0))==null?void 0:fe.toUpperCase())||"?"})}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:W||"Creator"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:n==null?void 0:n.email})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{ref:ee,type:"file",accept:"image/*",onChange:ne,className:"hidden"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>{var ae;return(ae=ee.current)==null?void 0:ae.click()},disabled:H,children:H?"Uploading...":D?"Change Photo":"Add Photo"}),D&&i.jsx(oe,{variant:"ghost",size:"sm",onClick:pe,disabled:H,className:"text-red-500 hover:text-red-600",children:"Remove"})]})]})]})})}),i.jsx(me,{elevated:!0,className:"overflow-hidden border-none bg-gradient-to-r from-[#FCE7FF] via-[#F4E6FF] to-[#E5DEFF] shadow-[0_24px_60px_rgba(160,64,255,0.18)]",children:i.jsxs("div",{className:"relative flex flex-col gap-6 px-6 py-6 md:flex-row md:items-center md:px-8 md:py-8",children:[i.jsxs("div",{className:"max-w-xl space-y-3",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[#C045FF]",children:"Creator earnings"}),i.jsx("h1",{className:"text-2xl font-semibold text-[#050014] md:text-3xl",children:"See how top creators earn with FanMeet."}),i.jsx("p",{className:"text-sm text-[#6C757D] md:text-base",children:"Track your revenue, learn from other creators, and turn every 1:1 meet into predictable income."}),i.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:i.jsx("span",{className:"text-xs text-[#6C757D]",children:"Your personal earnings, events, and activity summary are updated live from your FanMeet account."})})]}),i.jsxs("div",{className:"mt-4 w-full max-w-md rounded-[20px] bg-white/90 p-4 shadow-[0_18px_45px_rgba(15,23,42,0.18)] md:ml-auto md:mt-0",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-[#6C757D]",children:"Top creators this month"})}),i.jsx("div",{className:"mt-3 space-y-3",children:m?i.jsx("div",{className:"text-xs text-[#6C757D]",children:"Loading top creators"}):l.length===0?i.jsx("div",{className:"text-xs text-[#6C757D]",children:"No earnings data yet this month."}):l.map(ae=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] bg-[#F8F9FA] px-3 py-2 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF] text-xs font-semibold text-white",children:ae.initials}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:ae.displayName}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[ae.handle,"  ",ae.category]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-sm font-bold text-[#050014]",children:Be(ae.earnings)}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:"This month"})]})]},ae.id))})]})]})}),i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-semibold text-[#212529]",children:"Overview"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"High-level snapshot of your performance."})]}),i.jsx(oe,{variant:"primary",className:"bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/creator/events/new"),children:"Create Event "})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-4",children:he.map(ae=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:ae.icon}),i.jsx("span",{children:ae.title})]})}),i.jsxs(ve,{className:"gap-2",children:[i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:typeof ae.value=="number"?Be(ae.value):ae.value}),ae.change?i.jsx($e,{variant:"success",className:"w-fit",children:ae.change}):null,ae.caption?i.jsx("p",{className:"text-sm text-[#6C757D]",children:ae.caption}):null,ae.action?i.jsx(oe,{variant:"primary",size:"sm",className:"mt-2 w-fit bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>ae.actionLink?r(ae.actionLink):void 0,children:ae.action}):null]})]},ae.id))}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Recent Activity",subtitle:"Latest updates from your events and fans"}),i.jsx(ve,{className:"gap-4",children:L&&I.length===0?i.jsx("div",{className:"text-sm text-[#6C757D]",children:"Loading activity"}):I.length===0?i.jsx("div",{className:"text-sm text-[#6C757D]",children:"No recent activity yet."}):I.map(ae=>i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[i.jsx("div",{children:ae.description}),i.jsx("div",{className:"text-xs text-[#6C757D]",children:ae.time})]},ae.id))})]})]})}function Owe(){const r=Ss(),{user:n}=fs(),{events:o,finalizeEvent:l}=Yo(),u=(n==null?void 0:n.role)==="creator"?n.username:null,m=u?o.filter(E=>E.creatorUsername===u):[],g=E=>{const y=`${window.location.origin}/events/${E}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(y).then(()=>{window.alert("Share link copied to clipboard. Send it to your fans to start receiving bids.")},()=>{window.prompt("Share this link with your fans:",y)}):window.prompt("Share this link with your fans:",y)};return(n==null?void 0:n.creatorProfileStatus)==="pending"?i.jsx("div",{className:"flex flex-col gap-8",children:i.jsxs("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 text-yellow-800",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Pending Approval"}),i.jsx("p",{children:"Your creator account is currently pending approval. Please wait for approval from an admin."})]})}):(n==null?void 0:n.creatorProfileStatus)==="rejected"?i.jsx("div",{className:"flex flex-col gap-8",children:i.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-red-800",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Application Rejected"}),i.jsx("p",{children:"Your creator account application was rejected by an admin."})]})}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Events"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage and monitor all of your scheduled sessions."})]}),i.jsx("div",{className:"flex gap-2",children:["All","Upcoming","Live","Completed"].map(E=>i.jsx(oe,{size:"sm",variant:E==="All"?"primary":"secondary",className:"rounded-full px-4",children:E},E))})]}),i.jsx("div",{className:"flex flex-col gap-6",children:u&&m.length>0?m.map(E=>i.jsxs(me,{elevated:!0,className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"flex-1 space-y-3",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:E.status==="LIVE"?"danger":"primary",children:E.status==="LIVE"?" LIVE":E.status}),i.jsx("span",{className:"text-sm text-[#6C757D]",children:E.date})]}),i.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:E.title}),i.jsxs("div",{className:"text-sm text-[#6C757D]",children:["Duration: ",E.duration,"  Base Price: ",Be(E.basePrice)]}),i.jsxs("div",{className:"grid gap-2 rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm",children:[i.jsxs("span",{children:[" Current Bid:"," ",i.jsx("strong",{className:"text-[#212529]",children:Be(E.currentBid)})]}),i.jsxs("span",{children:[" ",E.participants," participants"]}),i.jsxs("span",{children:[" ",E.endsIn]})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(oe,{variant:"secondary",children:"Edit"}),i.jsx(oe,{variant:"danger",children:"Delete"}),i.jsx(oe,{onClick:()=>g(E.id),children:"Copy Link"}),(E.status==="Accepting Bids"||E.status==="Upcoming")&&i.jsx(oe,{variant:"primary",className:"bg-green-600 hover:bg-green-700 text-white border-none",onClick:async()=>{if(window.confirm("Close bidding and generate meeting link for the highest bidder?"))try{await l(E.id),window.alert('Success! Meeting created. Check "My Meets" tab.')}catch{window.alert("Error finalizing event. Please try again.")}},children:"End Bidding & Create Meet"}),i.jsx(oe,{variant:"ghost",onClick:()=>r(`/events/${E.id}`),children:"View Details "})]})]},E.id)):i.jsx(me,{elevated:!0,className:"grid min-h-[220px] place-items-center text-center",children:i.jsxs(ve,{className:"flex flex-col items-center gap-3",children:[i.jsx("span",{className:"text-4xl",children:""}),i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:"No events yet"}),i.jsx("p",{className:"max-w-md text-sm text-[#6C757D]",children:"Create your first FanMeet event to start receiving bids. Once created, youll see it listed here and can share your public link with fans."})]})})})]})}const jwe=["50","100","150"],Pwe=["5 minutes","10 minutes","15 minutes"];function kwe(){const r=Ss(),{user:n}=fs(),{createEvent:o}=Yo(),[l,u]=O.useState(""),[m,g]=O.useState(""),[E,y]=O.useState(null),[x,S]=O.useState(""),[C,N]=O.useState(""),[M,G]=O.useState(""),[I,P]=O.useState(""),[L,R]=O.useState(""),[D,V]=O.useState(""),W=async()=>{if(!n||n.role!=="creator"){window.alert("Please login as a creator to create events."),r("/auth?redirect=/creator/events/new");return}if(n.creatorProfileStatus!=="approved"){const ne=n.creatorProfileStatus==="pending"?"Your creator profile is pending approval. Please wait for admin approval before creating events.":"Your creator profile has been rejected. Please contact support for more information.";window.alert(` ${ne}`);return}if(!l.trim()||E===null||!x||!C||!M||!I||!L){V("Please fill in all required fields before creating the event.");return}const J=50;if(E%J!==0){V(`Base price must be in multiples of ${J}.`);return}V("");const ee=n.email.split("@")[0]||n.username;try{const ne=await o({creatorUsername:n.username,creatorDisplayName:ee,title:l.trim(),description:m.trim()||void 0,basePrice:E,duration:x,date:C,time:M,biddingDeadlineDate:I,biddingDeadlineTime:L,meetingLink:`${window.location.origin}/meet/${crypto.randomUUID()}`}),pe=`${window.location.origin}/events/${ne.id}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(pe).then(()=>{window.alert("Event created! Share link copied to your clipboard.")},()=>{window.prompt("Event created! Share this link with your fans:",pe)}):window.prompt("Event created! Share this link with your fans:",pe),r("/creator/events")}catch(ne){console.error("Failed to create event:",ne),V("Failed to create event. Please try again.")}},q=(n==null?void 0:n.creatorProfileStatus)==="approved",H=(n==null?void 0:n.creatorProfileStatus)==="pending";return i.jsxs("div",{className:"flex flex-col gap-8",children:[n&&n.role==="creator"&&!q&&i.jsx("div",{className:`rounded-[12px] p-4 ${H?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"text-2xl",children:H?"":""}),i.jsxs("div",{children:[i.jsx("h3",{className:`font-semibold ${H?"text-yellow-800":"text-red-800"}`,children:H?"Profile Pending Approval":"Profile Not Approved"}),i.jsx("p",{className:`text-sm ${H?"text-yellow-700":"text-red-700"}`,children:H?"Your creator profile is being reviewed by our team. You cannot create events until approved.":"Your creator profile was not approved. Please contact support for more information."})]})]})}),i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Create New Event"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Set up a new live experience for your fans."})]}),i.jsx($e,{variant:"primary",className:"px-4 py-2 text-sm",children:"Preview updates in real time"})]}),i.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsxs(me,{elevated:!0,className:"p-0",children:[i.jsx(Ce,{title:"Event Details",subtitle:"Provide the basics so fans know what to expect",className:"border-b border-[#E9ECEF] px-8 py-6"}),i.jsxs(ve,{className:"gap-6 px-8 py-6",children:[i.jsx(nt,{label:"Event Title *",placeholder:"Give your event an exciting headline",required:!0,value:l,onChange:J=>u(J.target.value)}),i.jsx(dr,{label:"Description",placeholder:"Describe the experience, topics, or value fans will get.",rows:5,value:m,onChange:J=>g(J.target.value)}),i.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Base Price *"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"All creator events must be paid. Select a starting bid."}),i.jsx("div",{className:"flex flex-wrap gap-3",children:jwe.map(J=>{const ee=parseInt(J.replace(/[^0-9]/g,""),10)||0,ne=E===ee;return i.jsx(oe,{variant:ne?"primary":"secondary",size:"sm",className:"rounded-[8px]",onClick:()=>y(ee),children:J},J)})})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Duration *"}),i.jsx("div",{className:"flex flex-wrap gap-3",children:Pwe.map(J=>i.jsx(oe,{variant:x===J?"primary":"secondary",size:"sm",className:"rounded-[8px]",onClick:()=>S(J),children:J},J))})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{type:"date",label:"Event Date *",required:!0,value:C,onChange:J=>N(J.target.value)}),i.jsx(nt,{type:"time",label:"Event Time *",required:!0,value:M,onChange:J=>G(J.target.value)})]}),i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"mb-3 text-sm font-semibold text-[#212529]",children:" Bidding Window *"}),i.jsx("p",{className:"mb-4 text-xs text-[#6C757D]",children:"Set when bidding closes. Fans can bid until this time, and the highest bidder wins."}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{type:"date",label:"Bidding Closes Date *",required:!0,value:I,onChange:J=>P(J.target.value)}),i.jsx(nt,{type:"time",label:"Bidding Closes Time *",required:!0,value:L,onChange:J=>R(J.target.value)})]})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:"Cover Image (optional)"}),i.jsxs("div",{className:"flex h-44 flex-col items-center justify-center gap-3 rounded-[16px] border-2 border-dashed border-[#E9ECEF] bg-[#F8F9FA]",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsx("span",{className:"text-sm font-medium text-[#212529]",children:"Drag & Drop or click to upload"}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:"JPG, PNG, or WEBP up to 5MB"}),i.jsx(oe,{size:"sm",variant:"secondary",children:"Browse Files"})]})]}),D?i.jsx("p",{className:"text-sm font-medium text-[#DC3545]",children:D}):null]}),i.jsxs("div",{className:"flex justify-end gap-3 border-t border-[#E9ECEF] px-8 py-6",children:[i.jsx(oe,{variant:"secondary",children:"Cancel"}),i.jsx(oe,{onClick:W,children:"Create Event "})]})]}),i.jsxs(me,{className:"h-fit",children:[i.jsx(Ce,{title:"Preview",subtitle:"Fans will see this layout before bidding"}),i.jsxs(ve,{className:"gap-4",children:[i.jsx("div",{className:"h-32 rounded-[16px] bg-gradient-to-br from-[#FFE5D9] to-white"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h3",{className:"text-xl font-semibold text-[#212529]",children:"Meet & Greet - Q&A Session"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Jan 15  4:00 PM IST  10 minutes"})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:"danger",children:" LIVE SOON"}),i.jsx($e,{variant:"primary",children:"Base Price: 100"})]}),i.jsx("div",{className:"rounded-[12px] bg-[#F8F9FA] p-4 text-sm text-[#6C757D]",children:"Fans can view event info, schedule, and place their bids here."})]})]})]})]})}const qH=O.createContext(void 0),Lwe=()=>`${Date.now()}-${Math.random().toString(16).slice(2)}`,Mwe=({children:r})=>{const[n,o]=O.useState([]),[l,u]=O.useState([]),{user:m}=fs(),[g,E]=O.useState([]);O.useEffect(()=>{(async()=>{const{data:R,error:D}=await ie.from("profiles").select("username, display_name, bio, profile_photo_url, cover_photo_url");if(D){console.error("Error fetching profiles:",D);return}R&&o(R.map(V=>({username:V.username,displayName:V.display_name||"",bio:V.bio||"",profilePhotoUrl:V.profile_photo_url||void 0,cover_photo_url:V.cover_photo_url||void 0})))})()},[]),O.useEffect(()=>{if(!m){E([]);return}(async()=>{const{data:R,error:D}=await ie.from("creator_follows").select("creator_id").eq("fan_id",m.id);if(D){console.error("Error fetching following:",D);return}if(R&&R.length>0){const V=R.map(H=>H.creator_id),{data:W}=await ie.from("profiles").select("username").in("user_id",V),q=(W==null?void 0:W.map(H=>H.username).filter(Boolean))||[];E(q)}})()},[m]);const y=L=>n.find(R=>R.username===L),x=async({username:L,displayName:R,bio:D})=>{const V=n.find(q=>q.username===L),W={username:L,displayName:R,bio:D};if(o(V?q=>q.map(H=>H.username===L?W:H):q=>[...q,W]),m){const{error:q}=await ie.from("profiles").upsert({user_id:m.id,username:L,display_name:R,bio:D,updated_at:new Date().toISOString()});q&&console.error("Error updating profile:",q)}return W},S=async L=>{if(!m)return;E(V=>[...V,L]);const{data:R}=await ie.from("profiles").select("user_id").eq("username",L).single();if(!R)return;const{error:D}=await ie.from("creator_follows").insert({fan_id:m.id,creator_id:R.user_id});D&&(console.error("Error following creator:",D),E(V=>V.filter(W=>W!==L)))},C=async L=>{if(!m)return;E(V=>V.filter(W=>W!==L));const{data:R}=await ie.from("profiles").select("user_id").eq("username",L).single();if(!R)return;const{error:D}=await ie.from("creator_follows").delete().eq("fan_id",m.id).eq("creator_id",R.user_id);D&&(console.error("Error unfollowing creator:",D),E(V=>[...V,L]))},N=L=>l.filter(R=>R.username===L).sort((R,D)=>R.id<D.id?1:-1),M=({username:L,text:R})=>{const D=R.trim();if(!D)throw new Error("Post text cannot be empty");const V={id:Lwe(),username:L,text:D,createdAtLabel:"Just now"};return u(W=>[V,...W]),V},G=(L,R)=>{u(D=>D.map(V=>V.id===L?{...V,text:R.trim()}:V))},I=L=>{u(R=>R.filter(D=>D.id!==L))},P=O.useMemo(()=>({profiles:n,posts:l,following:g,getProfile:y,upsertProfile:x,followCreator:S,unfollowCreator:C,getPostsForCreator:N,addPost:M,updatePost:G,deletePost:I}),[n,l,g]);return i.jsx(qH.Provider,{value:P,children:r})},KI=()=>{const r=O.useContext(qH);if(!r)throw new Error("useCreatorProfiles must be used within a CreatorProfileProvider");return r};function Fwe(){const{user:r}=fs(),{getProfile:n,upsertProfile:o}=KI();if(!r||r.role!=="creator")return i.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Creator profile setup"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Please sign in as a creator to edit your public profile."})]});const l=n(r.username),u=(l==null?void 0:l.displayName)||r.email.split("@")[0]||r.username,m=(l==null?void 0:l.bio)||"Tell fans who you are, what you create, and what kind of micro-meets or AMAs they can expect.",[g,E]=O.useState(u),[y,x]=O.useState(m),[S,C]=O.useState(!1),N=async()=>{await o({username:r.username,displayName:g.trim(),bio:y.trim()}),C(!0),window.setTimeout(()=>C(!1),2e3)},M=()=>{const G=`${window.location.origin}/${r.username}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(G).then(()=>{window.alert("Profile link copied. Share it with your fans.")},()=>{window.prompt("Share this profile link with your fans:",G)}):window.prompt("Share this profile link with your fans:",G)};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Public profile setup"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Update what fans see on your public page."})]}),i.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.3fr)_minmax(0,0.7fr)]",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Profile details",subtitle:"These details are shown at the top of your public page."}),i.jsxs(ve,{className:"gap-5",children:[i.jsx(nt,{label:"Display name",placeholder:"Your public display name",value:g,onChange:G=>E(G.target.value)}),i.jsx(nt,{label:"Public username",value:`@${r.username}`,disabled:!0,helperText:"Your profile link uses this username."}),i.jsx(dr,{label:"Bio",rows:4,value:y,onChange:G=>x(G.target.value),placeholder:"Short description that appears on your public profile."}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(oe,{onClick:N,children:"Save profile"}),S&&i.jsx("span",{className:"text-xs font-medium text-[#28A745]",children:"Saved. Your public page is updated."})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Public page preview",subtitle:"Fans visiting your profile will see something like this."}),i.jsxs(ve,{className:"gap-4",children:[i.jsxs("div",{className:"rounded-[16px] bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] p-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"h-10 w-10 rounded-full bg-[#050014] text-center text-sm font-semibold leading-10 text-white",children:g.charAt(0).toUpperCase()}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:g}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",r.username]})]})]}),i.jsx("p",{className:"mt-3 text-xs text-[#6C757D]",children:y})]}),i.jsxs("div",{className:"flex items-center justify-between gap-3 text-xs text-[#6C757D]",children:[i.jsxs("p",{children:["Visit ",i.jsxs("span",{className:"font-mono font-semibold",children:["/",r.username]})," to see your public page in a new tab."]}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:M,children:"Share profile"})]})]})]})]})]})}const Uwe=10,Vwe=r=>Math.floor(r*(100-Uwe)/100);function Bwe(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(0),[E,y]=O.useState(0),[x,S]=O.useState(0),[C,N]=O.useState(!1);O.useEffect(()=>{(async()=>{if(!r){o([]),u([]),g(0),y(0),S(0);return}N(!0);try{const{data:R,error:D}=await ie.from("events").select("id, title, status, starts_at").eq("creator_id",r.id);if(D||!R||R.length===0){o([]),u([]),g(0),y(0),S(0);return}const V=R.map(Ge=>Ge.id),{data:W}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at").in("event_id",V),{data:q}=await ie.from("meets").select("event_id, status").in("event_id",V),H=Array.from(new Set((W??[]).map(Ge=>Ge.fan_id).filter(Boolean)));let J=null;if(H.length>0){const{data:Ge}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",H);J=Ge??[]}const ee=new Map((J??[]).map(Ge=>[Ge.user_id,Ge])),ne=new Map;for(const Ge of W??[]){const pt=ne.get(Ge.event_id)??[];pt.push(Ge),ne.set(Ge.event_id,pt)}const pe=new Map;for(const Ge of q??[]){const pt=pe.get(Ge.event_id)??[];pt.push(Ge),pe.set(Ge.event_id,pt)}const Ee=new Date,ge=new Date(Ee.getFullYear(),Ee.getMonth(),1),he=new Date(Ee);he.setDate(Ee.getDate()-29);let le=0,Le=0;const fe=new Map,ae=[];for(const Ge of R){const pt=ne.get(Ge.id)??[],Ze=pt.length,Me=pt.filter(zt=>zt.status==="won"),Ue=Me.length>0?Me.reduce((zt,vt)=>vt.amount>zt.amount?vt:zt,Me[0]):null,ke=(Ue==null?void 0:Ue.amount)??0,Ie=Vwe(ke);let Xe="-",ye=null;if(Ue){const zt=ee.get(Ue.fan_id);Xe=(zt==null?void 0:zt.display_name)||(zt==null?void 0:zt.username)||"Winner",ye=new Date(Ue.created_at)}else Ge.starts_at&&(ye=new Date(Ge.starts_at));if(Ie>0&&ye&&(le+=Ie,ye>=ge&&(Le+=Ie),ye>=he)){const zt=ye.toISOString().slice(0,10),vt=fe.get(zt)??0;fe.set(zt,vt+Ie)}const Ct=(pe.get(Ge.id)??[]).some(zt=>zt.status==="completed")?"Cleared":"Upcoming",Ft=ye?ye.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}):"-";ae.push({id:Ge.id,date:Ft,event:Ge.title,bids:Ze,winner:Xe,grossAmount:ke,earned:Ie,status:Ct})}const be=ae.filter(Ge=>Ge.earned>0).length,We=be>0?le/be:0,it=[];for(let Ge=0;Ge<30;Ge+=1){const pt=new Date(he);pt.setDate(he.getDate()+Ge);const Ze=pt.toISOString().slice(0,10),Me=fe.get(Ze)??0;it.push({dateKey:Ze,label:pt.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}),total:Me})}ae.sort((Ge,pt)=>Ge.date<pt.date?1:-1),o(ae),u(it),g(le),y(Le),S(We)}finally{N(!1)}})()},[r]);const M=()=>{if(!n.length){alert("No earnings to export yet.");return}const D=[["Date","Event","Bids","Winner","Earned","Status"].join(","),...n.map(H=>{const J=ee=>`"${ee.replace(/"/g,'""')}"`;return[J(H.date),J(H.event),H.bids.toString(),J(H.winner),H.earned.toString(),J(H.status)].join(",")})].join(`
`),V=new Blob([D],{type:"text/csv;charset=utf-8;"}),W=URL.createObjectURL(V),q=document.createElement("a");q.href=W,q.setAttribute("download","earnings.csv"),document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(W)},G=[{id:"sum-1",title:"Total Earned",value:m},{id:"sum-2",title:"This Month",value:E},{id:"sum-3",title:"Average/Event",value:x}],I=l.reduce((L,R)=>R.total>L?R.total:L,0),P={Cleared:"success",Upcoming:"primary"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Earnings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track revenue trends and payment history."})]}),i.jsx(oe,{variant:"secondary",onClick:M,children:"Export CSV"})]}),i.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:G.map(L=>i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:L.title}),i.jsx(ve,{children:i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:C?"":Be(L.value)})})]},L.id))}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Revenue (Last 30 days)",subtitle:"Visualize how your earnings have changed over time"}),i.jsx(ve,{children:i.jsx("div",{className:"flex h-64 items-end gap-1 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] px-4 py-4",children:l.every(L=>L.total===0)?i.jsx("div",{className:"m-auto text-sm text-[#6C757D]",children:"No earnings in the last 30 days."}):i.jsx("div",{className:"flex h-full w-full items-end gap-1",children:l.map(L=>i.jsxs("div",{className:"flex flex-1 flex-col items-center gap-1",children:[i.jsx("div",{className:"flex h-full w-full items-end",children:i.jsx("div",{className:"w-full rounded-t-md bg-[#FF6B35]",style:{height:I>0?`${Math.max(6,L.total/I*100)}%`:"6px"}})}),i.jsx("div",{className:"text-[10px] text-[#6C757D]",children:L.label})]},L.dateKey))})})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Earnings Breakdown"}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Winner"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Net Earnings"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),i.jsx("tbody",{className:"text-[#212529]",children:C&&n.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading earnings"})}):n.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#6C757D]",children:"No earnings yet."})}):n.map(L=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:L.date}),i.jsx("td",{className:"py-3",children:L.event}),i.jsx("td",{className:"py-3",children:L.bids}),i.jsx("td",{className:"py-3",children:L.winner}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-medium text-green-600",children:Be(L.earned)}),L.grossAmount>0&&i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["(Bid: ",Be(L.grossAmount)," - 10% fee)"]})]})}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:P[L.status]??"primary",children:L.status})})]},L.id))})]})})]})]})}const Wwe={completed:"success",in_review:"warning",pending:"primary",failed:"danger"},Gwe={completed:"Completed",in_review:"In review",pending:"Pending",failed:"Failed"},Hwe=10,zwe=r=>Math.floor(r*(100-Hwe)/100);function Kwe(){const{user:r}=fs(),n=Ss(),[o,l]=O.useState(0),[u,m]=O.useState(null),[g,E]=O.useState(0),[y,x]=O.useState(null),[S,C]=O.useState([]),[N,M]=O.useState(!1),[G,I]=O.useState(!1),[P,L]=O.useState(""),[R,D]=O.useState(""),[V,W]=O.useState(!1),[q,H]=O.useState("");O.useEffect(()=>{(async()=>{if(!r){l(0),E(0),x(null),C([]);return}M(!0);try{const{data:ne,error:pe}=await ie.from("users").select("role, account_status, creator_profile_status").eq("id",r.id).maybeSingle();if(pe||!ne){W(!0),H("We could not load your creator profile. Please contact support."),M(!1);return}if(ne.role!=="creator"){W(!0),H("Withdrawals are only available for creator accounts."),M(!1);return}if(ne.account_status&&ne.account_status!=="active"){W(!0),H("Your creator account is not active. Please contact support."),M(!1);return}if(ne.creator_profile_status&&ne.creator_profile_status!=="approved"){W(!0),H("Your creator profile is not approved yet. Once an admin approves you, withdrawals will be enabled."),M(!1);return}const{data:Ee}=await ie.from("profiles").select("bank_account_number, bank_ifsc, upi_id, razorpay_fund_account_id").eq("user_id",r.id).single();if(Ee){const Ze=!!(Ee.razorpay_fund_account_id||Ee.bank_account_number||Ee.upi_id);m(Ze);const Me=Ee.razorpay_fund_account_id?"Linked Payout Account":Ee.bank_account_number?`Bank Account ending in ${Ee.bank_account_number.slice(-4)}`:Ee.upi_id?`UPI: ${Ee.upi_id}`:"";Me&&D(Me)}else m(!1);const{data:ge}=await ie.from("events").select("id").eq("creator_id",r.id),he=(ge??[]).map(Ze=>Ze.id);let le=0,Le=0;if(he.length>0){const{data:Ze}=await ie.from("bids").select("event_id, amount, status, created_at").in("event_id",he).eq("status","won"),{data:Me}=await ie.from("meets").select("event_id, status, updated_at").in("event_id",he),Ue=new Map;for(const Xe of Me??[]){const ye=Ue.get(Xe.event_id)??[];ye.push(Xe),Ue.set(Xe.event_id,ye)}const ke=new Date,Ie=48*60*60*1e3;for(const Xe of Ze??[]){const ye=zwe(Xe.amount??0);le+=ye;const qe=(Ue.get(Xe.event_id)??[]).find(Ft=>Ft.status==="completed");qe&&qe.updated_at&&ke.getTime()-new Date(qe.updated_at).getTime()>Ie||(Le+=ye)}}const{data:fe}=await ie.from("withdrawal_requests").select("*").eq("creator_id",r.id).order("requested_at",{ascending:!1});let ae=0,be=0,We=null;const it=[];for(const Ze of fe??[])Ze.status==="completed"?(ae+=Ze.amount??0,!We&&Ze.processed_at&&(We={amount:Ze.amount,processedAt:new Date(Ze.processed_at)})):(Ze.status==="pending"||Ze.status==="in_review")&&(be+=Ze.amount??0),it.push({id:Ze.id,amount:Ze.amount,status:Ze.status,destination:Ze.destination||"Not specified",requestedAt:new Date(Ze.requested_at),processedAt:Ze.processed_at?new Date(Ze.processed_at):null});const Ge=le-Le,pt=Math.max(Ge-ae-be,0);l(pt),E(Le),x(We),C(it)}finally{M(!1)}})()},[r]);const J=async()=>{if(!r){alert("Please log in to request a withdrawal.");return}if(V){alert(q||"Withdrawals are currently unavailable for your account. Please contact support.");return}const ee=parseInt(P,10);if(isNaN(ee)||ee<=0){alert("Please enter a valid amount.");return}if(ee<500){alert("Minimum withdrawal amount is 500.");return}if(ee>o){alert(`You can only withdraw up to ${Be(o)}.`);return}if(!R.trim()){alert("Please enter a destination account.");return}I(!0);try{const{data:ne,error:pe}=await ie.from("withdrawal_requests").insert({creator_id:r.id,amount:ee,destination:R.trim(),status:"pending",requested_at:new Date().toISOString(),created_at:new Date().toISOString()}).select().single();if(pe||!ne){console.error("Error submitting withdrawal:",pe),alert("Failed to submit withdrawal request. Please try again.");return}ie.functions.invoke("trigger-payout",{body:{withdrawal_request_id:ne.id}}).then(({error:Ee})=>{Ee&&console.error("Auto-payout trigger failed:",Ee)}),alert(`Withdrawal request of ${Be(ee)} submitted successfully!`),L(""),D(""),l(Ee=>Ee-ee),C(Ee=>[{id:`temp-${Date.now()}`,amount:ee,status:"pending",destination:R.trim(),requestedAt:new Date,processedAt:null},...Ee])}finally{I(!1)}};return u===!1&&!N?i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Withdrawals"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track your payout requests, bank destinations, and release timelines."})]}),i.jsx(me,{elevated:!0,className:"max-w-2xl",children:i.jsx(ve,{className:"gap-6 py-12",children:i.jsxs("div",{className:"flex flex-col items-center text-center",children:[i.jsx("div",{className:"mb-4 flex h-24 w-24 items-center justify-center rounded-full bg-gradient-to-br from-[#F4E6FF] to-[#E9D5FF]",children:i.jsx("span",{className:"text-5xl",children:""})}),i.jsx("h2",{className:"mb-2 text-2xl font-bold text-[#212529]",children:"Add Your Bank Account"}),i.jsx("p",{className:"mb-6 max-w-md text-[#6C757D]",children:"Before you can withdraw your earnings, you need to link a bank account or UPI ID. This ensures your payouts are processed securely and quickly."}),i.jsxs("div",{className:"mb-6 w-full max-w-sm rounded-xl bg-[#F4E6FF]/60 p-4 text-left",children:[i.jsx("p",{className:"mb-2 text-sm font-semibold text-[#7B2CBF]",children:"Why add bank details?"}),i.jsxs("ul",{className:"space-y-2 text-sm text-[#6C757D]",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"Receive payouts directly to your account"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"Earnings available 48 hours after event completion"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500",children:""}),i.jsx("span",{children:"Secure & verified payout processing"})]})]})]}),i.jsx(oe,{size:"lg",onClick:()=>n("/creator/settings#payouts"),className:"w-full max-w-sm",children:" Add Bank Account / UPI"}),i.jsx("p",{className:"mt-3 text-xs text-[#6C757D]",children:"You'll be redirected to Settings to add your payout details."})]})})}),i.jsxs(me,{className:"max-w-2xl",children:[i.jsx(Ce,{title:"Your Earnings",subtitle:"Here's what you've earned so far."}),i.jsx(ve,{className:"gap-4",children:i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Available to withdraw"}),i.jsx("p",{className:"text-xl font-semibold text-[#C045FF]",children:Be(o)})]}),i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Pending clearance"}),i.jsx("p",{className:"text-xl font-semibold text-[#212529]",children:Be(g)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Available after 48 hours"})]})]})})]})]}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Withdrawals"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track your payout requests, bank destinations, and release timelines."})]}),i.jsxs("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Available Balance",subtitle:"Withdraw to your linked account any time."}),i.jsxs(ve,{className:"gap-6",children:[i.jsxs("div",{className:"rounded-[16px] bg-[#F4E6FF]/60 p-6",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Ready to withdraw"}),i.jsx("p",{className:"text-4xl font-bold text-[#C045FF]",children:N?"":Be(o)})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Pending clearance"}),i.jsx("p",{className:"text-xl font-semibold text-[#212529]",children:N?"":Be(g)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Net earnings (90%) after 10% platform fee. Available after 48 hours."})]}),i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Last payout"}),i.jsx("p",{className:"text-xl font-semibold text-[#212529]",children:N?"":y?Be(y.amount):""}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:y?`Processed ${Mt(y.processedAt)}`:"No payouts yet"})]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Request Withdrawal",subtitle:"Transfers typically arrive in 2-3 business days."}),i.jsxs(ve,{className:"gap-5",children:[V&&i.jsx("div",{className:"rounded-[12px] border border-[#FECACA] bg-[#FFF5F5] p-3 text-xs text-[#B91C1C]",children:q}),i.jsxs("div",{className:"grid gap-4",children:[i.jsx(nt,{label:"Amount",placeholder:"5,000",type:"number",min:500,step:100,value:P,onChange:ee=>L(ee.target.value)}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx(nt,{label:"Destination account",placeholder:"No linked account",value:R,disabled:!0,onChange:()=>{}}),!R&&i.jsxs("p",{className:"text-xs text-red-500",children:["Please ",i.jsx(ro,{to:"/creator/settings",className:"underline",children:"add your bank details"})," in settings to withdraw."]}),R&&i.jsxs("p",{className:"text-xs text-[#6C757D]",children:["To change this, go to ",i.jsx(ro,{to:"/creator/settings",className:"underline",children:"Settings"}),"."]})]})]}),i.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-4 text-sm text-[#6C757D]",children:["Note: We process withdrawals above 500. Ensure your KYC details are up to date for smoother payouts.",o>0&&i.jsxs("span",{className:"mt-1 block font-medium text-[#212529]",children:["Maximum available: ",Be(o)]})]}),i.jsx(oe,{size:"lg",onClick:J,disabled:G||o<500||V,children:G?"Submitting":"Submit request"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Payout History",subtitle:"A log of all recent withdrawal activity.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(ve,{className:"gap-4",children:N&&S.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading payout history"}):S.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No withdrawal requests yet."}):S.map(ee=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:Wwe[ee.status]??"default",children:Gwe[ee.status]??ee.status}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Requested ",Mt(ee.requestedAt)]})]}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Destination: ",ee.destination]})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1",children:[i.jsx("span",{className:"text-sm text-[#6C757D]",children:"Amount"}),i.jsx("span",{className:"text-xl font-semibold text-[#212529]",children:Be(ee.amount)}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:ee.processedAt?`Processed ${Mt(ee.processedAt)}`:"Awaiting processing"})]})]},ee.id))})]})]})}const qwe=["Review fan questions in advance to personalize the session.","Test your audio/video setup 15 minutes before the meet.","Keep exclusive content ready to reward high bidders.","Use the built-in timer to stay on schedule."],Ywe={scheduled:"success",live:"primary",completed:"primary",cancelled:"danger",cancelled_no_show_creator:"danger",no_show:"warning"};function $we(){const{user:r,onlineUsers:n}=fs(),o=Ss(),[l,u]=O.useState([]),[m,g]=O.useState([]),[E,y]=O.useState(!0),x=async()=>{if(!r)return;const{data:P,error:L}=await ie.from("meets").select(`
        *,
        events:event_id (title, base_price)
      `).eq("creator_id",r.id).order("scheduled_at",{ascending:!0});if(L){console.error("Error fetching meets:",L),y(!1);return}if(console.log(" Fetched meets for creator:",r.id),console.log(" Meets data:",P),console.log(" Number of meets:",(P==null?void 0:P.length)||0),P&&P.length>0){const V=[...new Set(P.map(ne=>ne.fan_id))],{data:W}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",V),q=new Map((W==null?void 0:W.map(ne=>[ne.user_id,ne]))||[]),H=[...new Set(P.map(ne=>ne.event_id))],{data:J}=await ie.from("bids").select("event_id, amount").in("event_id",H),ee=P.map(ne=>({...ne,fan_profile:q.get(ne.fan_id),bids:(J==null?void 0:J.filter(pe=>pe.event_id===ne.event_id))||[]}));u(ee)}else u(P||[]);const{data:R,error:D}=await ie.from("events").select("id, title, starts_at, base_price, status").eq("creator_id",r.id).order("starts_at",{ascending:!1});if(!D&&R){const V=new Set((P??[]).map(q=>q.event_id)),W=R.filter(q=>!V.has(q.id));g(W)}else D&&(console.error("Error fetching creator events:",D),g([]));y(!1)};O.useEffect(()=>{x()},[r]);const S=P=>{var L,R;return(L=P==null?void 0:P.bids)!=null&&L.length?Math.max(...P.bids.map(D=>D.amount||0)):((R=P==null?void 0:P.events)==null?void 0:R.base_price)||0},C=l.filter(P=>P.status==="scheduled"||P.status==="live"),N=l.filter(P=>P.status==="completed"),M=l.filter(P=>P.status==="cancelled"||P.status==="cancelled_no_show_creator"),G=l.filter(P=>P.status==="cancelled_no_show_creator"),I=G.reduce((P,L)=>P+S(L),0);return console.log(" Upcoming meets (scheduled):",C.length,C),console.log(" Completed meets:",N.length,N),console.log(" All meets:",l.length,l),E?i.jsx("div",{className:"p-8 text-center",children:"Loading meets..."}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"My Meets"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage your scheduled sessions and turn every meet into a wow moment."})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Session Prep Center",subtitle:"Best practices to deliver memorable fan experiences.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(ve,{className:"gap-3",children:qwe.map(P=>i.jsxs("div",{className:"flex items-start gap-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("span",{className:"mt-1 text-lg",children:""}),i.jsx("p",{className:"text-sm text-[#212529]",children:P})]},P))})]}),i.jsx("div",{className:"rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 p-4",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-blue-800",children:"Automatic Meeting System"}),i.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[i.jsx("strong",{children:"Important:"})," You must start your call ",i.jsx("strong",{children:"before"})," the scheduled time. If you don't join before the scheduled time, the meeting will be auto-cancelled and the fan will receive a full refund. Meetings automatically complete at the scheduled end time and your earnings (90%) will be credited to your wallet."]})]})]})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Upcoming Sessions",subtitle:"Start your call before the scheduled time to avoid no-show cancellation.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(ve,{className:"gap-4",children:[C.map(P=>{var R,D,V;const L=S(P);return i.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[#E9ECEF] bg-white p-4",children:i.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[i.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:Ywe[P.status]??"default",children:P.status}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Mt(P.scheduled_at),"  ",P.duration_minutes," mins"]}),i.jsxs("span",{className:"text-xs font-semibold text-[#28A745]",children:["Amount: ",Be(L)]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((R=P.events)==null?void 0:R.title)||"Untitled Event"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((D=P.fan_profile)==null?void 0:D.display_name)||((V=P.fan_profile)==null?void 0:V.username)||"Unknown Fan"]})]}),i.jsxs("div",{className:"text-sm text-[#6C757D]",children:[i.jsx("span",{className:"font-medium",children:"Meeting Link: "}),i.jsx("span",{className:"break-all",children:P.meeting_link||"No link yet"})]})]}),i.jsx("div",{className:"flex flex-col gap-2",children:P.meeting_link&&i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>navigator.clipboard.writeText(P.meeting_link),children:"Copy Link"}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>o(`/messages?chatWith=${P.fan_id}`),children:"Message Fan"})]}),(()=>{const W=new Date,q=new Date(P.scheduled_at),H=new Date(q.getTime()+P.duration_minutes*60*1e3),J=W>=new Date(q.getTime()-3e4),ee=W>=H||P.status==="completed"||P.status==="cancelled"||P.status==="cancelled_no_show_creator",ne=P.status==="live";return i.jsx(oe,{size:"sm",disabled:ee||!ne&&!n.has(P.fan_id)||!ne&&!J,variant:ee?"secondary":"primary",title:ee?"This meeting has ended":ne?"Rejoin your live call":n.has(P.fan_id)?J?"Start the call":`Call starts at ${Mt(P.scheduled_at)} (30s early buffer available)`:"Fan is offline. You cannot start the call.",onClick:()=>window.open(P.meeting_link,"_blank","noopener,noreferrer"),children:ee?" Completed":ne?"Rejoin Call":"Start Call"})})(),!n.has(P.fan_id)&&i.jsx("span",{className:"text-[10px] text-red-500",children:"Fan is offline"})]})})]})},P.id)}),C.length===0&&m.length===0&&i.jsx("p",{className:"text-sm text-[#6C757D]",children:"No upcoming meets scheduled."}),m.length>0&&i.jsxs("div",{className:"mt-6 flex flex-col gap-4 rounded-[14px] border border-dashed border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-semibold text-[#212529]",children:"Events without a scheduled meet"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"These events didn't generate a meeting yet. If no bid was placed, you can relaunch or share the event again."})]}),i.jsx("div",{className:"flex flex-col gap-3",children:m.slice(0,5).map(P=>i.jsxs("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-white p-3",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-[#6C757D]",children:[i.jsx("span",{className:"rounded-full bg-[#E9ECEF] px-2 py-0.5 uppercase tracking-wide",children:P.status.replace(/_/g," ")}),i.jsx("span",{children:Mt(P.starts_at)})]}),i.jsxs("div",{className:"mt-1 flex flex-wrap items-center justify-between gap-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:P.title}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:["Base price: ",Be(P.base_price??0)]})]}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>{var L;return(L=navigator.clipboard)==null?void 0:L.writeText(`${window.location.origin}/events/${P.id}`)},children:"Copy Event Link"})]}),i.jsx("p",{className:"mt-2 text-xs text-[#C045FF]",children:P.status==="completed"?"No winning bid was placed before bidding closed.":"Waiting for bids  share the link to secure a fan."})]},P.id))})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Completed Sessions",subtitle:"Your past meets and earnings.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(ve,{className:"gap-4",children:[N.map(P=>{var R,D,V;const L=S(P);return i.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[#28A745] bg-gradient-to-r from-green-50 to-white p-4",children:i.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:i.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:"success",children:" Completed"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Mt(P.scheduled_at),"  ",P.duration_minutes," mins"]}),i.jsx("div",{className:"flex items-center gap-2 rounded-full bg-[#28A745] px-3 py-1",children:i.jsxs("span",{className:"text-xs font-bold text-white",children:[" ",Be(L)]})})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((R=P.events)==null?void 0:R.title)||"Untitled Event"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((D=P.fan_profile)==null?void 0:D.display_name)||((V=P.fan_profile)==null?void 0:V.username)||"Unknown Fan"]})]})]})})},P.id)}),N.length===0&&i.jsx("p",{className:"text-sm text-[#6C757D]",children:"No completed meets yet."})]})]}),M.length>0&&i.jsxs(me,{children:[i.jsx(Ce,{title:"Cancelled Sessions",subtitle:"Meetings that were cancelled due to no-show.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsx(ve,{className:"gap-4",children:M.map(P=>{var L,R,D;return i.jsx("div",{className:"flex flex-col gap-4 rounded-[14px] border border-red-200 bg-gradient-to-r from-red-50 to-white p-4",children:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:"danger",children:P.status==="cancelled_no_show_creator"?" No-Show":" Cancelled"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Mt(P.scheduled_at),"  ",P.duration_minutes," mins"]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((L=P.events)==null?void 0:L.title)||"Untitled Event"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["with ",((R=P.fan_profile)==null?void 0:R.display_name)||((D=P.fan_profile)==null?void 0:D.username)||"Unknown Fan"]})]}),P.status==="cancelled_no_show_creator"&&i.jsx("p",{className:"text-xs text-red-600",children:" You did not start the call before the scheduled time. Fan received a full refund."})]})},P.id)})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Cancelled / No-Show Impact",subtitle:"These meetings were auto-cancelled because you didnt go live in time.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(ve,{className:"gap-4",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-[14px] border border-red-200 bg-red-50 p-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs uppercase tracking-wide text-red-600 font-semibold",children:"Total amount refunded"}),i.jsx("p",{className:"text-2xl font-bold text-red-700",children:Be(I)}),i.jsx("p",{className:"text-xs text-red-500",children:"100% of the winning bid is refunded to the fan when you miss the call."})]}),i.jsxs("div",{className:"ml-auto text-center",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"No-show instances"}),i.jsx("p",{className:"text-3xl font-bold text-red-600",children:G.length})]})]}),G.length===0?i.jsx("p",{className:"text-sm text-[#28A745]",children:"Great job! You havent missed any meets."}):G.map(P=>{var R,D,V;const L=S(P);return i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-red-200 bg-gradient-to-r from-red-50 to-white p-4",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[i.jsx($e,{variant:"danger",children:" Creator No-Show"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[Mt(P.scheduled_at),"  ",P.duration_minutes," mins"]}),i.jsxs("span",{className:"text-xs font-semibold text-red-600",children:["Lost: ",Be(L)]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:((R=P.events)==null?void 0:R.title)||"Untitled Event"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Fan: ",((D=P.fan_profile)==null?void 0:D.display_name)||((V=P.fan_profile)==null?void 0:V.username)||"Unknown Fan"]})]}),i.jsx("p",{className:"text-xs text-red-600",children:" Call never started. Fan was auto-refunded and the slot was marked as missed."})]},P.id)})]})]})]})}function Xwe(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState(!0);return O.useEffect(()=>{async function m(){if(r)try{const{data:g,error:E}=await ie.from("creator_follows").select("fan_id").eq("creator_id",r.id);if(E)throw E;if(g&&g.length>0){const y=g.map(C=>C.fan_id),{data:x,error:S}=await ie.from("profiles").select("*").in("user_id",y);if(S)throw S;x&&o(x)}else o([])}catch(g){console.error("Error fetching followers:",g)}finally{u(!1)}}m()},[r]),l?i.jsx("div",{className:"p-8 text-center text-[#6C757D]",children:"Loading..."}):i.jsxs("div",{className:"mx-auto flex max-w-4xl flex-col gap-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-semibold text-[#212529]",children:"Followers"}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:"People who follow you on FanMeet. Use this list to understand who shows up for your events most often."})]}),i.jsxs("div",{className:"space-y-4",children:[n.map(m=>{var g,E;return i.jsx(me,{elevated:!0,className:"border-none bg-white/95",children:i.jsxs(ve,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[i.jsx("div",{className:"flex flex-col gap-1",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(gi,{src:m.avatar_url,initials:((g=m.display_name)==null?void 0:g.charAt(0))||((E=m.username)==null?void 0:E.charAt(0)),size:"md"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-sm font-semibold text-[#212529]",children:m.display_name||m.username}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["@",m.username]})]})]})}),i.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[i.jsx($e,{variant:"primary",children:"Follower"}),i.jsx("div",{className:"flex gap-2",children:i.jsx(oe,{size:"sm",variant:"secondary",className:"rounded-full",children:"Message"})})]})]})},m.user_id)}),n.length===0&&i.jsx(me,{children:i.jsx(ve,{children:i.jsx("p",{className:"text-sm text-[#6C757D]",children:"You dont have any followers yet. Share your profile link and host a few events to start building your fan list."})})})]})]})}function Jwe(){const{notifications:r,markNotificationAsRead:n,markAllNotificationsAsRead:o}=Xg();return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-[#111827]",children:"Notifications"}),i.jsx("p",{className:"text-[#6C757D]",children:"Manage your alerts and preferences"})]}),i.jsxs("button",{onClick:()=>o(),className:"flex items-center gap-2 text-sm font-medium text-[#FF6B35] hover:text-[#E85D2E]",children:[i.jsx(MH,{className:"h-4 w-4"}),"Mark all as read"]})]}),i.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[i.jsx("div",{className:"lg:col-span-2 space-y-4",children:i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[i.jsx("h2",{className:"mb-4 text-lg font-semibold text-[#111827]",children:"Latest alerts"}),i.jsx("div",{className:"space-y-4",children:r.length===0?i.jsx("div",{className:"text-center py-8 text-[#6C757D]",children:"No notifications yet"}):r.map(l=>i.jsxs("div",{className:`flex gap-4 rounded-lg border p-4 transition-colors cursor-pointer ${l.read?"border-transparent bg-white":"border-[#FFE5D9] bg-[#FFF5F2]"}`,onClick:()=>!l.read&&n(l.id),children:[i.jsx("div",{className:`mt-1 flex h-8 w-8 flex-none items-center justify-center rounded-full ${l.read?"bg-[#F8F9FA] text-[#6C757D]":"bg-[#FFE5D9] text-[#FF6B35]"}`,children:i.jsx(LH,{className:"h-4 w-4"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsx("h3",{className:`font-medium ${l.read?"text-[#111827]":"text-[#FF6B35]"}`,children:l.title}),i.jsx("span",{className:"whitespace-nowrap text-xs text-[#6C757D]",children:lu(new Date(l.created_at),"MMM d, h:mm a")})]}),i.jsx("p",{className:"mt-1 text-sm text-[#6C757D]",children:l.message})]}),!l.read&&i.jsx("div",{className:"mt-2 h-2 w-2 rounded-full bg-[#FF6B35]"})]},l.id))})]})}),i.jsx("div",{className:"space-y-6",children:i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-6 shadow-sm",children:[i.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[i.jsx(GH,{className:"h-5 w-5 text-[#6C757D]"}),i.jsx("h2",{className:"text-lg font-semibold text-[#111827]",children:"Preferences"})]}),i.jsx("div",{className:"space-y-4",children:["Email notifications","Push notifications","SMS alerts"].map(l=>i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm text-[#111827]",children:l}),i.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[i.jsx("input",{type:"checkbox",className:"peer sr-only",defaultChecked:!0}),i.jsx("div",{className:"peer h-6 w-11 rounded-full bg-[#E9ECEF] after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-[#FF6B35] peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#FFE5D9]"})]})]},l))})]})})]})]})}const g7="dvtdzotx2",_7="ml_default",Qwe={Connected:"success","Reconnect required":"warning"};function Zwe(){var pt,Ze;const{user:r}=fs(),[n,o]=O.useState(!0),[l,u]=O.useState(!1),[m,g]=O.useState(!1),[E,y]=O.useState(!1),[x,S]=O.useState(!1),[C,N]=O.useState(!1),[M,G]=O.useState(null),[I,P]=O.useState(null),[L,R]=O.useState(!1),D=O.useRef(null),V=O.useRef(null),[W,q]=O.useState({display_name:"",username:"",bio:"",category:"",primary_language:""}),[H,J]=O.useState({bank_account_number:"",confirm_bank_account_number:"",bank_ifsc:"",bank_account_name:"",upi_id:""}),[ee,ne]=O.useState({contact_email:"",phone_number:"",sms_alerts:!1,share_calendar:!1}),[pe,Ee]=O.useState([]),[ge,he]=O.useState({instagram:"",youtube:"",twitter:"",linkedin:"",website:""});O.useEffect(()=>{async function Me(){if(r)try{const{data:Ue}=await ie.from("profiles").select("*").eq("user_id",r.id).single();Ue&&(q({display_name:Ue.display_name||"",username:Ue.username||"",bio:Ue.bio||"",category:Ue.category||"",primary_language:Ue.primary_language||""}),G(Ue.profile_photo_url||null),P(Ue.cover_photo_url||null),he({instagram:Ue.instagram_url||"",youtube:Ue.youtube_url||"",twitter:Ue.twitter_url||"",linkedin:Ue.linkedin_url||"",website:Ue.website_url||""}),J({bank_account_number:Ue.bank_account_number||"",confirm_bank_account_number:Ue.bank_account_number||"",bank_ifsc:Ue.bank_ifsc||"",bank_account_name:Ue.bank_account_name||"",upi_id:Ue.upi_id||""}));const{data:ke}=await ie.from("creator_settings").select("*").eq("user_id",r.id).maybeSingle();ke&&ne({contact_email:ke.contact_email||"",phone_number:ke.phone_number||"",sms_alerts:ke.sms_alerts||!1,share_calendar:ke.share_calendar||!1});const{data:Ie}=await ie.from("linked_channels").select("*").eq("user_id",r.id);Ie&&Ee(Ie)}catch(Ue){console.error("Error fetching settings:",Ue)}finally{o(!1)}}Me()},[r]);const le=async()=>{if(r){u(!0);try{const{error:Me}=await ie.from("profiles").update(W).eq("user_id",r.id);if(Me)throw Me;alert("Profile updated successfully!")}catch(Me){console.error("Error updating profile:",Me),alert("Failed to update profile.")}finally{u(!1)}}},Le=async Me=>{var ke;const Ue=(ke=Me.target.files)==null?void 0:ke[0];if(!(!Ue||!r)){if(!Ue.type.startsWith("image/")){alert("Please select an image file.");return}if(Ue.size>5*1024*1024){alert("Image must be less than 5MB.");return}N(!0);try{const Ie=new FormData;Ie.append("file",Ue),Ie.append("upload_preset",_7),Ie.append("folder","fanmeet/profiles");const Xe=await fetch(`https://api.cloudinary.com/v1_1/${g7}/image/upload`,{method:"POST",body:Ie});if(!Xe.ok)throw new Error("Failed to upload image");const Oe=(await Xe.json()).secure_url,{error:qe}=await ie.from("profiles").update({profile_photo_url:Oe}).eq("user_id",r.id);if(qe)throw qe;G(Oe),alert("Profile photo updated successfully!")}catch(Ie){console.error("Error uploading photo:",Ie),alert("Failed to upload photo. Please try again.")}finally{N(!1),D.current&&(D.current.value="")}}},fe=async()=>{if(r&&confirm("Are you sure you want to remove your profile photo?")){N(!0);try{const{error:Me}=await ie.from("profiles").update({profile_photo_url:null}).eq("user_id",r.id);if(Me)throw Me;G(null),alert("Profile photo removed.")}catch(Me){console.error("Error removing photo:",Me),alert("Failed to remove photo.")}finally{N(!1)}}},ae=async Me=>{var ke;const Ue=(ke=Me.target.files)==null?void 0:ke[0];if(!(!Ue||!r)){if(!Ue.type.startsWith("image/")){alert("Please select an image file.");return}if(Ue.size>5*1024*1024){alert("Image must be less than 5MB.");return}R(!0);try{const Ie=new FormData;Ie.append("file",Ue),Ie.append("upload_preset",_7),Ie.append("folder","fanmeet/covers");const Xe=await fetch(`https://api.cloudinary.com/v1_1/${g7}/image/upload`,{method:"POST",body:Ie});if(!Xe.ok)throw new Error("Upload failed");const ye=await Xe.json();await ie.from("profiles").update({cover_photo_url:ye.secure_url}).eq("user_id",r.id),P(ye.secure_url),alert("Cover photo updated!")}catch(Ie){console.error("Upload error:",Ie),alert("Failed to upload cover photo.")}finally{R(!1),V.current&&(V.current.value="")}}},be=async()=>{if(!(!r||!confirm("Remove your cover photo?"))){R(!0);try{await ie.from("profiles").update({cover_photo_url:null}).eq("user_id",r.id),P(null),alert("Cover photo removed.")}catch{alert("Failed to remove cover photo.")}finally{R(!1)}}},We=async()=>{if(r){S(!0);try{const{error:Me}=await ie.from("profiles").update({instagram_url:ge.instagram||null,youtube_url:ge.youtube||null,twitter_url:ge.twitter||null,linkedin_url:ge.linkedin||null,website_url:ge.website||null}).eq("user_id",r.id);if(Me)throw Me;alert("Social links updated successfully!")}catch(Me){console.error("Error updating social links:",Me),alert("Failed to update social links.")}finally{S(!1)}}},it=async()=>{if(r){g(!0);try{const{data:Me}=await ie.from("creator_settings").select("user_id").eq("user_id",r.id).single();let Ue;if(Me){const{error:ke}=await ie.from("creator_settings").update(ee).eq("user_id",r.id);Ue=ke}else{const{error:ke}=await ie.from("creator_settings").insert({...ee,user_id:r.id});Ue=ke}if(Ue)throw Ue;alert("Contact settings updated successfully!")}catch(Me){console.error("Error updating contact settings:",Me),alert("Failed to update contact settings.")}finally{g(!1)}}},Ge=async()=>{if(!r)return;const Me=!!H.upi_id,Ue=!!H.bank_account_number;if(!Me&&!Ue){alert("Please provide either Bank Account details or a UPI ID.");return}if(Ue){if(!H.bank_account_name){alert("Please enter the Account Holder Name.");return}if(!H.bank_ifsc||H.bank_ifsc.length!==11){alert("Please enter a valid 11-character IFSC code.");return}if(H.bank_account_number!==H.confirm_bank_account_number){alert("Account numbers do not match. Please re-enter.");return}}y(!0);try{const ke={name:H.bank_account_name,ifsc:H.bank_ifsc,account_number:H.bank_account_number,upi_id:H.upi_id},{data:Ie,error:Xe}=await ie.functions.invoke("create-razorpay-fund-account",{body:ke});if(Xe){console.error("Edge function error:",Xe),alert(`Verification failed: ${Xe.message||"Unknown error"}`),y(!1);return}const{confirm_bank_account_number:ye,...Oe}=H,qe={...Oe};Ie!=null&&Ie.fund_account_id&&(qe.razorpay_fund_account_id=Ie.fund_account_id);const{error:Ct}=await ie.from("profiles").update(qe).eq("user_id",r.id);if(Ct)throw Ct;alert("Bank details updated successfully! Your earnings will be available for withdrawal 48 hours after event completion.")}catch(ke){console.error("Error updating bank details:",ke),alert("Failed to update bank details.")}finally{y(!1)}};return n?i.jsx("div",{className:"p-8 text-center",children:"Loading settings..."}):i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Settings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Fine-tune your public profile, contact preferences, and streaming setup."})]}),i.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1.2fr)_minmax(0,0.8fr)]",children:[i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Profile information",subtitle:"Fans see these details before bidding."}),i.jsxs(ve,{className:"gap-5",children:[i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("label",{className:"text-sm font-medium text-[#212529]",children:"Profile Photo"}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"relative",children:M?i.jsx("img",{src:M,alt:"Profile",className:"h-24 w-24 rounded-full object-cover ring-2 ring-[#C045FF]/20"}):i.jsx("div",{className:"h-24 w-24 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-2xl ring-2 ring-[#C045FF]/20",children:((Ze=(pt=W.display_name)==null?void 0:pt.charAt(0))==null?void 0:Ze.toUpperCase())||"?"})}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("input",{ref:D,type:"file",accept:"image/*",onChange:Le,className:"hidden",id:"profile-photo-upload"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>{var Me;return(Me=D.current)==null?void 0:Me.click()},disabled:C,children:C?"Uploading...":M?"Change Photo":"Upload Photo"}),M&&i.jsx(oe,{variant:"ghost",size:"sm",onClick:fe,disabled:C,className:"text-red-500 hover:text-red-600",children:"Remove Photo"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"JPG, PNG, GIF. Max 5MB."})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx("label",{className:"text-sm font-medium text-[#212529]",children:"Cover Photo"}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsx("div",{className:"relative h-32 w-full overflow-hidden rounded-lg border-2 border-dashed border-[#E9ECEF]",children:I?i.jsx("img",{src:I,alt:"Cover",className:"h-full w-full object-cover"}):i.jsx("div",{className:"h-full w-full bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] flex items-center justify-center",children:i.jsx("span",{className:"text-sm text-[#6C757D]",children:"No cover photo"})})}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[i.jsx("input",{ref:V,type:"file",accept:"image/*",onChange:ae,className:"hidden",id:"cover-photo-upload"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>{var Me;return(Me=V.current)==null?void 0:Me.click()},disabled:L,children:L?"Uploading...":I?"Change Cover":"Upload Cover"}),I&&i.jsx(oe,{variant:"ghost",size:"sm",onClick:be,disabled:L,className:"text-red-500 hover:text-red-600",children:"Remove Cover"}),i.jsx("p",{className:"w-full text-xs text-[#6C757D]",children:"Recommended: 1200x300px. JPG, PNG, GIF. Max 5MB."})]})]})]}),i.jsx(nt,{label:"Display name",placeholder:"Your Name",value:W.display_name,onChange:Me=>q({...W,display_name:Me.target.value})}),i.jsx(nt,{label:"Public username",placeholder:"@username",value:W.username,onChange:Me=>q({...W,username:Me.target.value})}),i.jsx(dr,{label:"Bio",placeholder:"Tell your fans what to expect...",value:W.bio,onChange:Me=>q({...W,bio:Me.target.value}),rows:4}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Category",placeholder:"e.g. Music, Tech",value:W.category,onChange:Me=>q({...W,category:Me.target.value})}),i.jsx(nt,{label:"Primary language",placeholder:"e.g. English",value:W.primary_language,onChange:Me=>q({...W,primary_language:Me.target.value})})]}),i.jsx(oe,{size:"lg",onClick:le,disabled:l,children:l?"Saving...":"Save profile"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Contact settings",subtitle:"Well use this for payouts and urgent reminders."}),i.jsxs(ve,{className:"gap-4",children:[i.jsx(nt,{label:"Contact email",placeholder:"email@example.com",value:ee.contact_email,onChange:Me=>ne({...ee,contact_email:Me.target.value})}),i.jsx(nt,{label:"Phone number",placeholder:"+1 234 567 8900",value:ee.phone_number,onChange:Me=>ne({...ee,phone_number:Me.target.value})}),i.jsxs("label",{className:"flex items-center gap-3 text-sm text-[#212529]",children:[i.jsx("input",{type:"checkbox",checked:ee.sms_alerts,onChange:Me=>ne({...ee,sms_alerts:Me.target.checked}),className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Send SMS alerts for high-value bids"]}),i.jsxs("label",{className:"flex items-center gap-3 text-sm text-[#212529]",children:[i.jsx("input",{type:"checkbox",checked:ee.share_calendar,onChange:Me=>ne({...ee,share_calendar:Me.target.checked}),className:"h-5 w-5 rounded border-[#CBD5F5] text-[#C045FF] focus:ring-[#C045FF]"}),"Share calendar availability with FanMeet team"]}),i.jsx(oe,{variant:"secondary",className:"self-start",onClick:it,disabled:m,children:m?"Updating...":"Update contact info"})]})]})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Social Media Links",subtitle:"Add your social media profiles so fans can find and follow you."}),i.jsxs(ve,{className:"gap-5",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Instagram",placeholder:"https://instagram.com/yourhandle",value:ge.instagram,onChange:Me=>he({...ge,instagram:Me.target.value})}),i.jsx(nt,{label:"YouTube",placeholder:"https://youtube.com/@yourhandle",value:ge.youtube,onChange:Me=>he({...ge,youtube:Me.target.value})})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Twitter / X",placeholder:"https://twitter.com/yourhandle",value:ge.twitter,onChange:Me=>he({...ge,twitter:Me.target.value})}),i.jsx(nt,{label:"LinkedIn",placeholder:"https://linkedin.com/in/yourprofile",value:ge.linkedin,onChange:Me=>he({...ge,linkedin:Me.target.value})})]}),i.jsx(nt,{label:"Website",placeholder:"https://yourwebsite.com",value:ge.website,onChange:Me=>he({...ge,website:Me.target.value})}),i.jsx(oe,{size:"lg",onClick:We,disabled:x,children:x?"Saving...":"Save Social Links"})]})]}),i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Bank & Payout Details",subtitle:"Add your bank account or UPI for automatic withdrawals. Earnings are available 48 hours after event completion."}),i.jsxs(ve,{className:"gap-5",children:[i.jsx("div",{className:"rounded-[12px] bg-[#F4E6FF]/60 p-4",children:i.jsxs("p",{className:"text-sm text-[#6C757D]",children:[" ",i.jsx("strong",{children:"Auto-withdrawal:"})," Your earnings (90% after platform fee) become available for withdrawal 48 hours after each event ends. Add either bank account OR UPI details below."]})}),i.jsxs("div",{className:"flex flex-col gap-4 rounded-xl border border-[#E9ECEF] p-4",children:[i.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[i.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#E9ECEF] text-sm font-bold text-[#495057]",children:"1"}),i.jsx("h3",{className:"font-semibold text-[#212529]",children:"Bank Transfer (NEFT/IMPS)"})]}),i.jsx(nt,{label:"Beneficiary Name",placeholder:"Name as per bank records",value:H.bank_account_name,onChange:Me=>J({...H,bank_account_name:Me.target.value})}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Account Number",placeholder:"e.g. 1234567890",type:"password",value:H.bank_account_number,onChange:Me=>J({...H,bank_account_number:Me.target.value})}),i.jsx(nt,{label:"Confirm Account Number",placeholder:"Re-enter account number",value:H.confirm_bank_account_number,onChange:Me=>J({...H,confirm_bank_account_number:Me.target.value})})]}),i.jsx(nt,{label:"IFSC Code",placeholder:"e.g. HDFC0001234",value:H.bank_ifsc,onChange:Me=>J({...H,bank_ifsc:Me.target.value.toUpperCase()}),maxLength:11})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"}),i.jsx("span",{className:"text-sm font-medium text-[#6C757D]",children:"OR USE UPI"}),i.jsx("div",{className:"h-px flex-1 bg-[#E9ECEF]"})]}),i.jsxs("div",{className:"flex flex-col gap-4 rounded-xl border border-[#E9ECEF] p-4",children:[i.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[i.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-[#E9ECEF] text-sm font-bold text-[#495057]",children:"2"}),i.jsx("h3",{className:"font-semibold text-[#212529]",children:"UPI ID (VPA)"})]}),i.jsx(nt,{label:"UPI ID",placeholder:"e.g. username@oksbi",value:H.upi_id,onChange:Me=>J({...H,upi_id:Me.target.value})})]}),i.jsx(oe,{size:"lg",onClick:Ge,disabled:E,children:E?"Verifying & Saving...":"Save Payout Details"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Streaming & channel integrations",subtitle:"Connect tools to streamline your live experiences.",className:"border-b border-[#E9ECEF] pb-4"}),i.jsxs(ve,{className:"gap-4",children:[pe.map(Me=>i.jsxs("div",{className:"flex flex-col gap-3 rounded-[14px] border border-[#E9ECEF] bg-white p-4 md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:Me.platform}),i.jsx("span",{className:"text-sm text-[#6C757D]",children:Me.handle})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx($e,{variant:Qwe[Me.status]??"default",children:Me.status}),i.jsx(oe,{variant:"ghost",size:"sm",children:"Manage"})]})]},Me.id)),pe.length===0&&i.jsx("p",{className:"text-sm text-[#6C757D]",children:"No channels connected yet."}),i.jsx(oe,{variant:"ghost",className:"self-start",children:"+ Connect new channel"})]})]})]})}const eSe={},v7=r=>{let n;const o=new Set,l=(S,C)=>{const N=typeof S=="function"?S(n):S;if(!Object.is(N,n)){const M=n;n=C??(typeof N!="object"||N===null)?N:Object.assign({},n,N),o.forEach(G=>G(n,M))}},u=()=>n,y={setState:l,getState:u,getInitialState:()=>x,subscribe:S=>(o.add(S),()=>o.delete(S)),destroy:()=>{(eSe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},x=n=r(l,u,y);return y},tSe=r=>r?v7(r):v7;var YH={exports:{}},$H={},XH={exports:{}},JH={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mp=O;function sSe(r,n){return r===n&&(r!==0||1/r===1/n)||r!==r&&n!==n}var rSe=typeof Object.is=="function"?Object.is:sSe,nSe=Mp.useState,iSe=Mp.useEffect,aSe=Mp.useLayoutEffect,oSe=Mp.useDebugValue;function cSe(r,n){var o=n(),l=nSe({inst:{value:o,getSnapshot:n}}),u=l[0].inst,m=l[1];return aSe(function(){u.value=o,u.getSnapshot=n,CN(u)&&m({inst:u})},[r,o,n]),iSe(function(){return CN(u)&&m({inst:u}),r(function(){CN(u)&&m({inst:u})})},[r]),oSe(o),o}function CN(r){var n=r.getSnapshot;r=r.value;try{var o=n();return!rSe(r,o)}catch{return!0}}function lSe(r,n){return n()}var dSe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?lSe:cSe;JH.useSyncExternalStore=Mp.useSyncExternalStore!==void 0?Mp.useSyncExternalStore:dSe;XH.exports=JH;var uSe=XH.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pb=O,hSe=uSe;function pSe(r,n){return r===n&&(r!==0||1/r===1/n)||r!==r&&n!==n}var mSe=typeof Object.is=="function"?Object.is:pSe,fSe=hSe.useSyncExternalStore,gSe=pb.useRef,_Se=pb.useEffect,vSe=pb.useMemo,ESe=pb.useDebugValue;$H.useSyncExternalStoreWithSelector=function(r,n,o,l,u){var m=gSe(null);if(m.current===null){var g={hasValue:!1,value:null};m.current=g}else g=m.current;m=vSe(function(){function y(M){if(!x){if(x=!0,S=M,M=l(M),u!==void 0&&g.hasValue){var G=g.value;if(u(G,M))return C=G}return C=M}if(G=C,mSe(S,M))return G;var I=l(M);return u!==void 0&&u(G,I)?G:(S=M,C=I)}var x=!1,S,C,N=o===void 0?null:o;return[function(){return y(n())},N===null?void 0:function(){return y(N())}]},[n,o,l,u]);var E=fSe(r,m[0],m[1]);return _Se(function(){g.hasValue=!0,g.value=E},[E]),ESe(E),E};YH.exports=$H;var ySe=YH.exports;const xSe=U7(ySe),QH={},{useDebugValue:bSe}=dA,{useSyncExternalStoreWithSelector:wSe}=xSe;let E7=!1;const SSe=r=>r;function CSe(r,n=SSe,o){(QH?"production":void 0)!=="production"&&o&&!E7&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),E7=!0);const l=wSe(r.subscribe,r.getState,r.getServerState||r.getInitialState,n,o);return bSe(l),l}const y7=r=>{(QH?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof r=="function"?tSe(r):r,o=(l,u)=>CSe(n,l,u);return Object.assign(o,n),o},TSe=r=>r?y7(r):y7,ZH="fanmeet-demo-creator-dm-open",NSe=()=>typeof window>"u"?"open":window.localStorage.getItem(ZH)==="closed"?"closed":"open",RSe=TSe(r=>({creatorDmStatus:NSe(),setCreatorDmStatus:n=>{typeof window<"u"&&window.localStorage.setItem(ZH,n),r({creatorDmStatus:n})}}));function ASe(){const[r,n]=O.useState(""),{creatorDmStatus:o,setCreatorDmStatus:l}=RSe(),[u,m]=O.useState(null),{messages:g,sendMessage:E,markMessageAsRead:y}=Xg(),{user:x}=fs(),S=o==="open",C=O.useMemo(()=>{if(!x||!g)return[];const D=new Map;return g.forEach(V=>{const W=V.sender_id===x.id?V.receiver_id:V.sender_id,q=V.sender_id===x.id?V.receiver_display_name:V.sender_display_name,H=V.sender_id===x.id?V.receiver_username:V.sender_username,J=D.get(W),ee=!V.read&&V.receiver_id===x.id;J?(new Date(V.created_at)>new Date(J.lastTime)&&(J.lastMessage=V.message,J.lastTime=V.created_at),ee&&(J.unread+=1)):D.set(W,{id:W,participant:{id:W,name:q||"Unknown User",username:H||"unknown",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${q||"User"}`,status:"offline"},lastMessage:V.message,lastTime:V.created_at,unread:ee?1:0})}),Array.from(D.values()).sort((V,W)=>new Date(W.lastTime).getTime()-new Date(V.lastTime).getTime())},[g,x]),N=O.useMemo(()=>g.filter(D=>D.sender_id===(x==null?void 0:x.id)&&D.receiver_id===u||D.sender_id===u&&D.receiver_id===(x==null?void 0:x.id)),[g,x,u]);O.useEffect(()=>{u&&x&&N.filter(V=>!V.read&&V.receiver_id===x.id).forEach(V=>y(V.id))},[u,N,x,y]);const[M]=Gp(),[G,I]=O.useState(null);O.useEffect(()=>{const D=M.get("chatWith");D&&m(D)},[M]),O.useEffect(()=>{const D=C.some(V=>V.id===u);u&&!D&&(async()=>{if((G==null?void 0:G.id)===u)return;const{data:W}=await ie.from("profiles").select("user_id, display_name, username").eq("user_id",u).single();W&&I({id:W.user_id,participant:{id:W.user_id,name:W.display_name||W.username||"User",username:W.username||"user",avatar:`https://api.dicebear.com/9.x/initials/svg?seed=${W.display_name||W.username||"User"}`,status:"offline"},lastMessage:"",lastTime:new Date().toISOString(),unread:0})})()},[u,C,G]);const P=O.useMemo(()=>C.find(D=>D.id===u)||G,[C,u,G]),L=async D=>{if(D.preventDefault(),!(!r.trim()||!S||!u))try{await E(u,r),n("")}catch(V){console.error("Failed to send message:",V)}},R=()=>{l(S?"closed":"open")};return i.jsxs("div",{className:"flex h-[calc(100vh-140px)] flex-col gap-4 md:flex-row",children:[i.jsxs("div",{className:`flex w-full flex-col gap-3 md:w-80 ${P?"hidden md:flex":"flex"}`,children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Messages"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Chat with fans who have joined your FanMeets."})]}),i.jsxs(me,{className:"flex h-full min-h-[260px] flex-col overflow-hidden",children:[i.jsxs(Ce,{className:"flex flex-row items-center justify-between gap-2 border-b border-[#E9ECEF] pb-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Conversations"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Select a fan to view your chat."})]}),i.jsx(oe,{type:"button",size:"sm",variant:"secondary",className:"rounded-full px-3 text-[11px]",onClick:R,children:S?"Turn off DMs":"Turn on DMs"})]}),i.jsx(ve,{className:"min-h-0 flex-1 gap-2 p-0",children:i.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[C.map(D=>{const V=D.id===u;return i.jsxs("button",{type:"button",onClick:()=>m(D.id),className:`mb-2 flex w-full items-center gap-3 rounded-[12px] border px-3 py-2 text-left text-sm transition-colors ${V?"border-[#C045FF] bg-[#F4E6FF] text-[#140423]":"border-[#E9ECEF] bg-white text-[#212529] hover:border-[#C045FF]/50 hover:bg-[#F8F5FF]"}`,children:[i.jsx(gi,{src:D.participant.avatar,alt:D.participant.name,initials:D.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsx("span",{className:"truncate text-[13px] font-semibold",children:D.participant.name}),i.jsx("span",{className:"whitespace-nowrap text-[11px] text-[#6C757D]",children:lu(new Date(D.lastTime),"h:mm a")})]}),i.jsx("span",{className:"mt-0.5 line-clamp-1 text-[12px] text-[#6C757D]",children:D.lastMessage})]}),D.unread>0&&i.jsx("span",{className:"ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-[#C045FF] px-1 text-[11px] font-semibold text-white",children:D.unread})]},D.id)}),C.length===0&&i.jsx("p",{className:"pt-4 text-center text-xs text-[#6C757D]",children:"No fan conversations yet. Once a fan wins your FanMeet, their chat will appear here."})]})})]})]}),i.jsx(me,{elevated:!0,className:`flex h-full w-full flex-1 flex-col overflow-hidden ${P?"flex":"hidden md:flex"}`,children:P?i.jsxs(i.Fragment,{children:[i.jsxs(Ce,{className:"flex flex-row items-center justify-between gap-3 border-b border-[#E9ECEF] bg-white/80 py-3 backdrop-blur",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{type:"button",className:"flex h-8 w-8 items-center justify-center rounded-full border border-[#E9ECEF] bg-white text-sm text-[#343A40] md:hidden",onClick:()=>m(null),children:""}),i.jsx(gi,{src:P.participant.avatar,alt:P.participant.name,initials:P.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:P.participant.name}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#6C757D]",children:[i.jsx("span",{className:"h-2 w-2 rounded-full bg-[#C045FF]"}),i.jsx("span",{children:"Fan"})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(oe,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:i.jsx(zH,{className:"h-4 w-4","aria-hidden":"true"})}),i.jsx(oe,{variant:"ghost",size:"icon",className:"rounded-full border border-[#E9ECEF] bg-white text-[#6C757D]",children:i.jsx(UH,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),i.jsxs(ve,{className:"flex min-h-0 flex-1 flex-col p-0",children:[i.jsx("div",{className:"flex-1 space-y-4 overflow-y-auto bg-[#F8F9FA] p-4",children:N.map(D=>{var W;const V=D.sender_id===(x==null?void 0:x.id);return i.jsx("div",{className:`group my-2 flex gap-2 ${V?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`flex max-w-[80%] items-start gap-2 ${V?"flex-row-reverse":"flex-row"}`,children:[i.jsx(gi,{src:V?`https://api.dicebear.com/9.x/initials/svg?seed=${((W=x==null?void 0:x.user_metadata)==null?void 0:W.full_name)||"Me"}`:P.participant.avatar,alt:V?"Me":P.participant.name,initials:V?"Me":P.participant.name.charAt(0),size:"sm"}),i.jsxs("div",{children:[i.jsx("div",{className:`rounded-2xl px-3 py-2 text-sm ${V?"border-2 border-transparent text-[#050014] shadow-[0_10px_30px_rgba(0,0,0,0.25)]":"border border-[#E9ECEF] bg-white text-[#212529]"}`,style:V?{background:"linear-gradient(white, white) padding-box, linear-gradient(to right, #A78BFA, #C084FC, #E0E7FF) border-box"}:void 0,children:D.message}),i.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-[#6C757D]",children:[i.jsx("time",{dateTime:D.created_at,children:lu(new Date(D.created_at),"h:mm a")}),i.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(WH,{className:"h-3 w-3","aria-hidden":"true"})}),i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(FH,{className:"h-3 w-3","aria-hidden":"true"})}),!V&&i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:i.jsx(BH,{className:"h-3 w-3","aria-hidden":"true"})}),V&&i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#E63946] shadow-sm",children:i.jsx(HH,{className:"h-3 w-3","aria-hidden":"true"})}),i.jsx("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-[#6C757D] shadow-sm",children:i.jsx(VH,{className:"h-3 w-3","aria-hidden":"true"})})]})]})]})]})},D.id)})}),i.jsxs("div",{className:"border-t border-[#E9ECEF] bg-white p-3",children:[!S&&i.jsx("p",{className:"mb-2 text-xs font-medium text-[#E63946]",children:"You have turned off direct messages. Fans can still see past messages but cannot send you new DMs."}),i.jsxs("form",{onSubmit:L,className:"flex items-center gap-3",children:[i.jsx("input",{type:"text",value:r,onChange:D=>n(D.target.value),placeholder:S?"Type your message to this fan...":"DMs are currently turned off",disabled:!S,className:"h-11 flex-1 rounded-[12px] border-2 border-[#E9ECEF] bg-white px-4 text-sm text-[#212529] placeholder:text-[#ADB5BD] focus:border-[#C045FF] focus:shadow-[0_0_0_3px_rgba(192,69,255,0.18)] focus:outline-none disabled:cursor-not-allowed disabled:bg-[#F8F9FA]"}),i.jsx(oe,{type:"submit",size:"md",disabled:!S||!r.trim(),className:"px-5 text-sm",children:"Send"})]})]})]})]}):i.jsx("div",{className:"flex h-full flex-1 items-center justify-center bg-[#F8F9FA] p-6 text-center text-sm text-[#6C757D]",children:i.jsx("p",{className:"max-w-xs",children:"Select a fan conversation to start messaging. After your next FanMeet, their chat will appear here."})})})]})}const ISe={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"};function DSe(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState(!1),[C,N]=O.useState(!0),[M,G]=O.useState(null),[I,P]=O.useState(""),[L,R]=O.useState(!1);O.useEffect(()=>{(async()=>{if(!r){N(!1);return}const{data:q,error:H}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at").eq("user_id",r.id).order("created_at",{ascending:!1});if(H||!q){console.error("Error fetching support tickets:",H),o([]),N(!1);return}o(q.map(J=>({id:J.id,subject:J.subject,description:J.description,status:J.status,createdAt:J.created_at,updatedAt:J.updated_at}))),N(!1)})()},[r]),O.useEffect(()=>{(async()=>{if(!M){u([]);return}const{data:q,error:H}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at").eq("ticket_id",M).order("created_at",{ascending:!0});if(H||!q){console.error("Error fetching replies:",H),u([]);return}u(q.map(J=>({id:J.id,message:J.message,isAdminReply:J.is_admin_reply,createdAt:J.created_at})))})()},[M]);const D=async()=>{if(!r||!M||!I.trim()){alert("Please enter a message.");return}R(!0);try{const{error:W}=await ie.from("ticket_replies").insert({ticket_id:M,user_id:r.id,message:I.trim(),is_admin_reply:!1});if(W){console.error("Error sending reply:",W),alert("Failed to send reply.");return}u(q=>[...q,{id:`temp-${Date.now()}`,message:I.trim(),isAdminReply:!1,createdAt:new Date().toISOString()}]),P(""),alert("Reply sent! Our support team will respond soon.")}finally{R(!1)}},V=async()=>{if(!r){alert("Please log in to raise a support ticket.");return}if(!m.trim()||!E.trim()){alert("Please enter a subject and description.");return}S(!0);try{const{data:W,error:q}=await ie.from("support_tickets").insert({user_id:r.id,subject:m.trim(),description:E.trim(),status:"open"}).select("id, subject, description, status, created_at, updated_at").single();if(q||!W){console.error("Error creating support ticket:",q),alert("Failed to create support ticket.");return}o(H=>[{id:W.id,subject:W.subject,description:W.description,status:W.status,createdAt:W.created_at,updatedAt:W.updated_at},...H]),g(""),y(""),alert("Support ticket created successfully. Our team will get back to you.")}finally{S(!1)}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs(me,{children:[i.jsx(Ce,{title:"Creator Support",subtitle:"Raise a ticket for payout issues, events, or other account questions."}),i.jsxs(ve,{className:"gap-4",children:[i.jsx(dr,{label:"Subject",rows:2,placeholder:"Briefly describe your issue",value:m,onChange:W=>g(W.target.value)}),i.jsx(dr,{label:"Details",rows:5,placeholder:"Share as many details as possible, including event names, fans, dates, and screenshots where relevant.",value:E,onChange:W=>y(W.target.value)}),i.jsx(oe,{onClick:V,disabled:x,children:x?"Submitting":"Submit Ticket"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Your Tickets",subtitle:"Click a ticket to view the conversation and reply."}),i.jsx(ve,{className:"flex flex-col gap-3",children:C?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"Loading tickets"}):n.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"You have not raised any tickets yet."}):n.map(W=>i.jsxs("div",{children:[i.jsxs("button",{type:"button",onClick:()=>G(M===W.id?null:W.id),className:`w-full text-left rounded-[12px] border p-4 text-sm text-[#212529] transition-all ${M===W.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-white hover:border-[#C045FF]/50"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-semibold",children:W.subject}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Mt(W.createdAt)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($e,{variant:ISe[W.status],children:W.status.replace("_"," ")}),i.jsx("span",{className:"text-[#6C757D]",children:M===W.id?"":""})]})]}),i.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-[#6C757D] whitespace-pre-line",children:W.description})]}),M===W.id&&i.jsxs("div",{className:"mt-2 ml-4 border-l-2 border-[#C045FF] pl-4 space-y-4",children:[i.jsx("div",{className:"space-y-3",children:l.length===0?i.jsx("p",{className:"text-sm text-[#6C757D] py-2",children:"No replies yet. Our support team will respond soon."}):l.map(q=>i.jsxs("div",{className:`rounded-[10px] p-3 text-sm ${q.isAdminReply?"bg-[#F4E6FF] border-l-4 border-[#C045FF]":"bg-[#F8F9FA]"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[i.jsx("span",{className:`font-semibold ${q.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:q.isAdminReply?" Support Team":"You"}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Mt(q.createdAt)})]}),i.jsx("p",{className:"text-[#212529] whitespace-pre-line",children:q.message})]},q.id))}),W.status!=="closed"&&W.status!=="resolved"&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(dr,{label:"Reply to this ticket",rows:3,placeholder:"Type your message...",value:I,onChange:q=>P(q.target.value)}),i.jsx(oe,{size:"sm",onClick:D,disabled:L||!I.trim(),children:L?"Sending...":"Send Reply"})]}),(W.status==="closed"||W.status==="resolved")&&i.jsxs("p",{className:"text-sm text-[#6C757D] italic",children:["This ticket is ",W.status,". Create a new ticket if you need further assistance."]})]})]},W.id))})]})]})}function Iy(r){const n=new Date,o=new Date(r),l=n.getTime()-o.getTime(),u=Math.floor(l/6e4),m=Math.floor(u/60),g=Math.floor(m/24);return u<1?"just now":u<60?`${u} min${u>1?"s":""} ago`:m<24?`${m} hour${m>1?"s":""} ago`:`${g} day${g>1?"s":""} ago`}function OSe(){var D,V;const r=Ss(),[n,o]=O.useState(!0),[l,u]=O.useState(new Date),[m,g]=O.useState({totalUsers:0,activeEvents:0,liveNow:0,revenueThisMonth:0,commission:0,creators:0,fans:0,pendingWithdrawals:0,pendingWithdrawalsAmount:0,totalBids:0,bidsToday:0,refundsThisMonth:0}),[E,y]=O.useState({newFansToday:0,newCreatorsToday:0,activeMeetsNow:0,eventsEndingToday:0}),[x,S]=O.useState([]),[C,N]=O.useState([]),[M,G]=O.useState([]),[I,P]=O.useState([]),L=O.useCallback(async()=>{var W;o(!0);try{const q=new Date,H=new Date(q.getFullYear(),q.getMonth(),q.getDate()),J=new Date(q.getFullYear(),q.getMonth(),1),ee=new Date(q.getTime()+60*60*1e3),ne=new Date(q.getTime()-29*24*60*60*1e3),{count:pe}=await ie.from("users").select("*",{count:"exact",head:!0}),{count:Ee}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","creator"),{count:ge}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","fan"),{count:he}=await ie.from("events").select("*",{count:"exact",head:!0}).in("status",["live","upcoming"]),{count:le}=await ie.from("events").select("*",{count:"exact",head:!0}).eq("status","live"),{data:Le}=await ie.from("bids").select("amount, status, created_at").gte("created_at",J.toISOString()),fe=(Le??[]).filter(us=>us.status==="won"),ae=(Le??[]).filter(us=>us.status==="lost"),be=fe.reduce((us,Ds)=>us+(Ds.amount??0),0),We=[...fe,...ae].reduce((us,Ds)=>us+(Ds.amount??0),0),it=Math.round(We*.1),{data:Ge}=await ie.from("withdrawal_requests").select("amount").in("status",["pending","in_review"]),pt=(Ge==null?void 0:Ge.length)??0,Ze=(Ge??[]).reduce((us,Ds)=>us+(Ds.amount??0),0),{count:Me}=await ie.from("bids").select("*",{count:"exact",head:!0}),{count:Ue}=await ie.from("bids").select("*",{count:"exact",head:!0}).gte("created_at",H.toISOString()),{data:ke}=await ie.from("wallet_transactions").select("amount").eq("type","bid_refund").gte("created_at",J.toISOString()),Ie=(ke??[]).reduce((us,Ds)=>us+(Ds.amount??0),0);g({totalUsers:pe??0,activeEvents:he??0,liveNow:le??0,revenueThisMonth:be,commission:it,creators:Ee??0,fans:ge??0,pendingWithdrawals:pt,pendingWithdrawalsAmount:Ze,totalBids:Me??0,bidsToday:Ue??0,refundsThisMonth:Ie});const{count:Xe}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","fan").gte("created_at",H.toISOString()),{count:ye}=await ie.from("users").select("*",{count:"exact",head:!0}).eq("role","creator").gte("created_at",H.toISOString()),Oe=new Date(q.getTime()-30*60*1e3),qe=new Date(q.getTime()+60*60*1e3),{count:Ct}=await ie.from("meets").select("*",{count:"exact",head:!0}).eq("status","scheduled").gte("scheduled_at",Oe.toISOString()).lte("scheduled_at",qe.toISOString()),Ft=new Date(H.getTime()+24*60*60*1e3),{count:zt}=await ie.from("events").select("*",{count:"exact",head:!0}).gte("starts_at",H.toISOString()).lt("starts_at",Ft.toISOString());y({newFansToday:Xe??0,newCreatorsToday:ye??0,activeMeetsNow:Ct??0,eventsEndingToday:zt??0});const vt=[],{count:ds}=await ie.from("events").select("*",{count:"exact",head:!0}).gte("starts_at",q.toISOString()).lte("starts_at",ee.toISOString());(ds??0)>0&&vt.push({id:"events-soon",emoji:"",text:`${ds} event${ds===1?"":"s"} starting in the next hour`,count:ds??0}),pt>0&&vt.push({id:"pending-wd",emoji:"",text:`${pt} withdrawal request${pt===1?"":"s"} awaiting review`,count:pt});const{count:kt}=await ie.from("meets").select("*",{count:"exact",head:!0}).eq("status","completed").gte("updated_at",new Date(q.getTime()-24*60*60*1e3).toISOString());(kt??0)>0&&vt.push({id:"completed-meets",emoji:"",text:`${kt} meet${kt===1?"":"s"} completed in last 24h`,count:kt??0}),S(vt);const Ps=[],{data:Jn}=await ie.from("events").select("id, title, created_at, creator_id").order("created_at",{ascending:!1}).limit(3);if(Jn&&Jn.length>0){const us=Jn.map(hs=>hs.creator_id),{data:Ds}=await ie.from("profiles").select("user_id, username").in("user_id",us),En=new Map((Ds??[]).map(hs=>[hs.user_id,hs.username]));for(const hs of Jn){const Gi=En.get(hs.creator_id)||"creator";Ps.push({id:`event-${hs.id}`,emoji:"",text:`New event "${hs.title}" by @${Gi}`,time:Iy(hs.created_at)})}}const{data:$o}=await ie.from("users").select("id, email, role, created_at").order("created_at",{ascending:!1}).limit(3);for(const us of $o??[]){const Ds=((W=us.email)==null?void 0:W.split("@")[0])||"User";Ps.push({id:`user-${us.id}`,emoji:"",text:`New ${us.role} signup: ${Ds}`,time:Iy(us.created_at)})}const{data:uo}=await ie.from("withdrawal_requests").select("id, amount, requested_at, creator_id").order("requested_at",{ascending:!1}).limit(3);if(uo&&uo.length>0){const us=uo.map(hs=>hs.creator_id),{data:Ds}=await ie.from("profiles").select("user_id, username").in("user_id",us),En=new Map((Ds??[]).map(hs=>[hs.user_id,hs.username]));for(const hs of uo){const Gi=En.get(hs.creator_id)||"creator";Ps.push({id:`wd-${hs.id}`,emoji:"",text:`Withdrawal request: ${Be(hs.amount)} by @${Gi}`,time:Iy(hs.requested_at)})}}const{data:Qr}=await ie.from("meets").select("id, event_id, updated_at").eq("status","completed").order("updated_at",{ascending:!1}).limit(2);if(Qr&&Qr.length>0){const us=Qr.map(hs=>hs.event_id),{data:Ds}=await ie.from("events").select("id, title").in("id",us),En=new Map((Ds??[]).map(hs=>[hs.id,hs.title]));for(const hs of Qr){const Gi=En.get(hs.event_id)||"Event";Ps.push({id:`meet-${hs.id}`,emoji:"",text:`Meet completed: "${Gi}"`,time:Iy(hs.updated_at)})}}Ps.sort((us,Ds)=>0),N(Ps.slice(0,8));const{data:br}=await ie.from("bids").select("amount, created_at").eq("status","won").gte("created_at",ne.toISOString()),ho=new Map;for(const us of br??[]){const Ds=new Date(us.created_at).toISOString().slice(0,10),En=ho.get(Ds)??0;ho.set(Ds,En+(us.amount??0))}const Kl=[];for(let us=0;us<30;us++){const Ds=new Date(ne);Ds.setDate(ne.getDate()+us);const En=Ds.toISOString().slice(0,10);Kl.push({date:En,label:Ds.toLocaleDateString("en-IN",{month:"short",day:"2-digit"}),value:ho.get(En)??0})}G(Kl);const{data:ln}=await ie.from("bids").select("event_id, amount").eq("status","won").gte("created_at",J.toISOString());if(ln&&ln.length>0){const us=[...new Set(ln.map(zr=>zr.event_id))],{data:Ds}=await ie.from("events").select("id, creator_id").in("id",us),En=new Map((Ds??[]).map(zr=>[zr.id,zr.creator_id])),hs=new Map;for(const zr of ln){const Qn=En.get(zr.event_id);if(!Qn)continue;const Na=hs.get(Qn)??0;hs.set(Qn,Na+(zr.amount??0))}const Gi=Array.from(hs.entries()).sort((zr,Qn)=>Qn[1]-zr[1]).slice(0,10),_u=Gi.map(([zr])=>zr),{data:Ta}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",_u),vu=new Map((Ta??[]).map(zr=>[zr.user_id,zr])),vb=Gi.map(([zr,Qn])=>{const Na=vu.get(zr);return{id:zr,name:(Na==null?void 0:Na.display_name)||(Na==null?void 0:Na.username)||"Creator",earnings:Qn}});P(vb)}else P([]);u(new Date)}finally{o(!1)}},[]);O.useEffect(()=>{L();const W=setInterval(L,6e4);return()=>clearInterval(W)},[L]);const R=Math.max(...M.map(W=>W.value),1);return i.jsxs("div",{className:"flex flex-col gap-10",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx($e,{variant:"primary",pill:!1,className:"mb-2 w-fit",children:" Admin Control Center"}),i.jsx("h1",{className:"text-3xl font-semibold text-[#1B1C1F]",children:"Platform Overview"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Real-time glance at health, revenue, and moderation signals across FanMeet."})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1",children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:L,disabled:n,children:n?" Refreshing":" Refresh"}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Last updated: ",l.toLocaleTimeString()]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Total Users"}),className:"pb-2"}),i.jsxs(ve,{className:"gap-2",children:[i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.totalUsers.toLocaleString()}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[m.fans," fans  ",m.creators," creators"]})]})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Active Events"}),className:"pb-2"}),i.jsxs(ve,{className:"gap-2",children:[i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.activeEvents}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[m.liveNow," Live Now"]})]})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Winning Bid Volume (This Month)"}),className:"pb-2"}),i.jsx(ve,{className:"gap-2",children:i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":Be(m.revenueThisMonth)})})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Commission (10%)"}),className:"pb-2"}),i.jsx(ve,{className:"gap-2",children:i.jsx("span",{className:"text-3xl font-bold text-[#28A745]",children:n?"":Be(m.commission)})})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Creators"}),className:"pb-2"}),i.jsx(ve,{className:"gap-2",children:i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.creators})})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Pending Withdrawals"}),className:"pb-2"}),i.jsxs(ve,{className:"gap-2",children:[i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.pendingWithdrawals}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Be(m.pendingWithdrawalsAmount)})]})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Total Bids"}),className:"pb-2"}),i.jsxs(ve,{className:"gap-2",children:[i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":m.totalBids.toLocaleString()}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:["Today: ",m.bidsToday]})]})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:i.jsx("span",{className:"text-sm font-medium text-[#6C757D] uppercase tracking-wide",children:"Refunds (This Month)"}),className:"pb-2"}),i.jsx(ve,{className:"gap-2",children:i.jsx("span",{className:"text-3xl font-bold text-[#212529]",children:n?"":Be(m.refundsThisMonth)})})]})]})]}),i.jsxs("section",{className:"grid gap-4 lg:grid-cols-2",children:[i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:"Quick Stats",subtitle:"Operational health snapshots"}),i.jsxs(ve,{className:"gap-3",children:[i.jsxs("ul",{className:"flex flex-col gap-2 text-sm text-[#212529]",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),i.jsxs("span",{children:["New signups today: ",E.newFansToday," fans, ",E.newCreatorsToday," creators"]})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),i.jsxs("span",{children:["Active meets right now: ",E.activeMeetsNow]})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),i.jsxs("span",{children:["Events starting today: ",E.eventsEndingToday]})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"mt-1 text-[#C045FF]",children:""}),i.jsxs("span",{children:["Pending withdrawals: ",m.pendingWithdrawals]})]})]}),i.jsx(oe,{variant:"primary",className:"self-start bg-[#050014] text-white hover:bg-[#140423]",size:"sm",onClick:()=>r("/admin/business-analytics"),children:"View detailed reports "})]})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:"Alerts & Notifications",subtitle:"Attention-required items"}),i.jsxs(ve,{className:"gap-3",children:[i.jsx("div",{className:"flex flex-col gap-3",children:x.length===0?i.jsx("div",{className:"rounded-[12px] border border-[#E9ECEF] bg-[#F8F9FA] px-4 py-3 text-sm text-[#6C757D]",children:" No urgent alerts at this time"}):x.map(W=>i.jsxs("div",{className:"rounded-[12px] border border-[#F4E6FF] bg-[#F4E6FF]/60 px-4 py-3 text-sm text-[#C045FF]",children:[W.emoji," ",W.text]},W.id))}),i.jsx(oe,{variant:"primary",size:"sm",className:"self-start bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/withdrawals"),children:"Review withdrawals"})]})]})]}),i.jsxs("section",{className:"grid gap-4 xl:grid-cols-2",children:[i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:"Revenue Trend",subtitle:"Total Revenue  Last 30 days"}),i.jsxs(ve,{children:[i.jsx("div",{className:"flex h-48 items-end gap-1",children:M.map(W=>i.jsx("div",{className:"group relative flex-1",title:`${W.label}: ${Be(W.value)}`,children:i.jsx("div",{className:"w-full rounded-t bg-[#C045FF] transition-all hover:bg-[#A030DD]",style:{height:`${Math.max(W.value/R*100,2)}%`,minHeight:W.value>0?"4px":"2px"}})},W.date))}),i.jsxs("div",{className:"mt-2 flex justify-between text-xs text-[#6C757D]",children:[i.jsx("span",{children:(D=M[0])==null?void 0:D.label}),i.jsx("span",{children:(V=M[M.length-1])==null?void 0:V.label})]})]})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:"Top Creators by Revenue",subtitle:"Top 10 creators this month"}),i.jsx(ve,{children:I.length===0?i.jsx("div",{className:"flex h-48 items-center justify-center text-sm text-[#6C757D]",children:"No creator earnings this month yet"}):i.jsx("div",{className:"flex flex-col gap-2",children:I.map((W,q)=>i.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-[#E9ECEF] bg-white px-3 py-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-[#F4E6FF] text-xs font-bold text-[#C045FF]",children:q+1}),i.jsx("span",{className:"text-sm font-medium text-[#212529]",children:W.name})]}),i.jsx("span",{className:"text-sm font-semibold text-[#28A745]",children:Be(W.earnings)})]},W.id))})})]})]}),i.jsxs("section",{className:"grid gap-4 xl:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:"Recent Activity",subtitle:"Latest admin, user, and system events"}),i.jsx(ve,{className:"divide-y divide-[#F0F1F3]",children:C.length===0?i.jsx("div",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No recent activity"}):C.map(W=>i.jsx("div",{className:"flex items-center justify-between py-3 text-sm text-[#212529]",children:i.jsxs("span",{children:[W.emoji," ",W.text,i.jsxs("span",{className:"ml-2 text-xs text-[#6C757D]",children:["(",W.time,")"]})]})},W.id))})]}),i.jsxs(me,{className:"border-[#F0F1F3] bg-white",children:[i.jsx(Ce,{title:"Quick Actions",subtitle:"Jump to critical modules"}),i.jsxs(ve,{className:"gap-3",children:[i.jsx(oe,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/audit-logs"),children:" Review audit logs"}),i.jsx(oe,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/support-tickets"),children:" Open support queue"}),i.jsx(oe,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/withdrawals"),children:" Review withdrawals"}),i.jsx(oe,{variant:"primary",size:"sm",className:"justify-start gap-2 bg-[#050014] text-white hover:bg-[#140423]",onClick:()=>r("/admin/revenue-reports"),children:" Export revenue summary"})]})]})]})]})}function ez({currentPage:r,totalItems:n,itemsPerPage:o,onPageChange:l,onItemsPerPageChange:u}){const m=Math.ceil(n/o),g=(r-1)*o+1,E=Math.min(r*o,n),y=S=>{S>=1&&S<=m&&l(S)},x=()=>{const S=[];if(m<=5)for(let N=1;N<=m;N++)S.push(N);else if(r<=3){for(let N=1;N<=4;N++)S.push(N);S.push("..."),S.push(m)}else if(r>=m-2){S.push(1),S.push("...");for(let N=m-3;N<=m;N++)S.push(N)}else{S.push(1),S.push("...");for(let N=r-1;N<=r+1;N++)S.push(N);S.push("..."),S.push(m)}return S};return n===0?null:i.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between border-t border-[#E9ECEF] pt-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm text-[#6C757D]",children:[i.jsxs("span",{children:["Showing ",g," to ",E," of ",n," results"]}),i.jsx("span",{className:"mx-2",children:""}),i.jsxs("label",{htmlFor:"itemsPerPage",className:"flex items-center gap-2",children:[i.jsx("span",{children:"Show:"}),i.jsxs("select",{id:"itemsPerPage",value:o,onChange:S=>{u(Number(S.target.value)),l(1)},className:"rounded-[8px] border border-[#CED4DA] bg-white px-3 py-1.5 text-sm text-[#212529] focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",children:[i.jsx("option",{value:10,children:"10"}),i.jsx("option",{value:20,children:"20"}),i.jsx("option",{value:30,children:"30"}),i.jsx("option",{value:50,children:"50"})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>y(r-1),disabled:r===1,children:"Previous"}),i.jsx("div",{className:"flex items-center gap-1",children:x().map((S,C)=>typeof S=="number"?i.jsx("button",{onClick:()=>y(S),className:`h-8 min-w-[32px] rounded-[8px] px-2 text-sm font-medium transition-colors ${r===S?"bg-[#C045FF] text-white":"bg-white text-[#212529] hover:bg-[#F8F9FA] border border-[#E9ECEF]"}`,children:S},C):i.jsx("span",{className:"px-2 text-[#6C757D]",children:S},C))}),i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>y(r+1),disabled:r===m,children:"Next"})]})]})}const jSe=[{label:"All",value:"all"},{label:"Fans",value:"fan"},{label:"Creators",value:"creator"},{label:"Admins",value:"admin"}],PSe=[{label:"All",value:"all"},{label:"Active",value:"active"},{label:"Suspended",value:"suspended"},{label:"Banned",value:"banned"}];function kSe(){const[r,n]=O.useState([]),[o,l]=O.useState(!1),[u,m]=O.useState(""),[g,E]=O.useState("all"),[y,x]=O.useState("all"),[S,C]=O.useState(null),N=O.useRef(null),[M,G]=O.useState(1),[I,P]=O.useState(10),[L,R]=O.useState(""),[D,V]=O.useState(""),[W,q]=O.useState(""),[H,J]=O.useState(""),[ee,ne]=O.useState("all");O.useEffect(()=>{(async()=>{l(!0);try{const{data:Le,error:fe}=await ie.from("users").select("id, email, display_name, role, account_status, created_at, updated_at");if(fe||!Le){console.error("Error fetching users:",fe),n([]);return}const{data:ae}=await ie.from("bids").select("event_id, fan_id, amount, status").eq("status","won"),be=new Map;for(const Ze of ae??[]){const Me=be.get(Ze.fan_id)??0;be.set(Ze.fan_id,Me+(Ze.amount??0))}const{data:We}=await ie.from("events").select("id, creator_id"),it=new Map((We??[]).map(Ze=>[Ze.id,Ze.creator_id])),Ge=new Map;for(const Ze of ae??[]){const Me=it.get(Ze.event_id);if(!Me)continue;const Ue=Ge.get(Me)??0;Ge.set(Me,Ue+(Ze.amount??0))}const pt=Le.map(Ze=>{const Me=Ze.display_name||(Ze.email?Ze.email.split("@")[0]:"User"),Ue=Ze.role,ke=Ze.account_status??"active",Ie=be.get(Ze.id)??0,Xe=Ge.get(Ze.id)??0;return{id:Ze.id,email:Ze.email,displayName:Me,role:Ue,accountStatus:ke,joinedAt:Ze.created_at,lastActiveAt:Ze.updated_at,totalAmount:Ue==="fan"?Ie:Ue==="creator"?Xe:0}});n(pt),pt.length>0&&!S&&C(pt[0].id)}finally{l(!1)}})()},[S]);const pe=O.useMemo(()=>{const le=u.trim().toLowerCase();return r.filter(Le=>{if(g!=="all"&&Le.role!==g||y!=="all"&&Le.accountStatus!==y)return!1;if(L){const fe=new Date(Le.joinedAt),ae=new Date(L);if(fe<ae)return!1}if(D){const fe=new Date(Le.joinedAt),ae=new Date(D);if(ae.setHours(23,59,59,999),fe>ae)return!1}if(W&&Le.lastActiveAt){const fe=new Date(Le.lastActiveAt),ae=new Date(W);if(fe<ae)return!1}if(H&&Le.lastActiveAt){const fe=new Date(Le.lastActiveAt),ae=new Date(H);if(ae.setHours(23,59,59,999),fe>ae)return!1}return ee==="verified"&&!Le.lastActiveAt||ee==="unverified"&&Le.lastActiveAt?!1:le?Le.displayName.toLowerCase().includes(le)||Le.email.toLowerCase().includes(le)||Le.id.toLowerCase().includes(le):!0})},[r,u,g,y,L,D,W,H,ee]),Ee=O.useMemo(()=>{const le=(M-1)*I,Le=le+I;return pe.slice(le,Le)},[pe,M,I]),ge=O.useMemo(()=>r.find(le=>le.id===S)??null,[r,S]),he=async(le,Le)=>{const fe={active:"Activate",suspended:"Suspend",banned:"Ban"};if(window.confirm(`${fe[Le]} ${le.displayName}? This will update their account status.`)){l(!0);try{const{error:be}=await ie.from("users").update({account_status:Le}).eq("id",le.id);if(be){console.error("Error updating account status:",be),alert("Failed to update account status.");return}n(We=>We.map(it=>it.id===le.id?{...it,accountStatus:Le}:it))}finally{l(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"All Users"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Search, filter, and take bulk actions across the entire user base."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",disabled:!0,children:"Export CSV"}),i.jsx(oe,{disabled:!0,children:"Send Notification"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Filters",subtitle:"Refine the user list by role, status, or activity."}),i.jsxs(ve,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Search",placeholder:"Name, email, or ID",value:u,onChange:le=>m(le.target.value)}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{className:"text-xs font-semibold text-[#6C757D]",children:"Registration Date Range"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"date",value:L,onChange:le=>R(le.target.value),className:"flex-1 rounded-[12px] border border-[#CED4DA] px-3 py-2 text-sm focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",placeholder:"From"}),i.jsx("input",{type:"date",value:D,onChange:le=>V(le.target.value),className:"flex-1 rounded-[12px] border border-[#CED4DA] px-3 py-2 text-sm focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",placeholder:"To"})]})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{className:"text-xs font-semibold text-[#6C757D]",children:"Last Active Range"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("input",{type:"date",value:W,onChange:le=>q(le.target.value),className:"flex-1 rounded-[12px] border border-[#CED4DA] px-3 py-2 text-sm focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",placeholder:"From"}),i.jsx("input",{type:"date",value:H,onChange:le=>J(le.target.value),className:"flex-1 rounded-[12px] border border-[#CED4DA] px-3 py-2 text-sm focus:border-[#C045FF] focus:outline-none focus:ring-2 focus:ring-[#C045FF]/20",placeholder:"To"})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Roles"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:jSe.map(le=>i.jsx("button",{className:`rounded-full border px-3 py-1 text-xs font-medium ${g===le.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,type:"button",onClick:()=>E(le.value),children:le.label},le.value))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:PSe.map(le=>i.jsx("button",{className:`rounded-full border px-3 py-1 text-xs font-medium ${y===le.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,type:"button",onClick:()=>x(le.value),children:le.label},le.value))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Verification"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:[{label:"All",value:"all"},{label:"Verified",value:"verified"},{label:"Unverified",value:"unverified"}].map(le=>i.jsx("button",{className:`rounded-full border px-3 py-1 text-xs font-medium ${ee===le.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,type:"button",onClick:()=>ne(le.value),children:le.label},le.value))})]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Users",subtitle:"Bulk manage accounts and view key metrics."}),i.jsxs(ve,{className:"overflow-x-auto",children:[i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Select"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Name"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Email"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Role"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Joined"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Last Active"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent / Earned"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[Ee.map(le=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:i.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-[#CED4DA]"})}),i.jsx("td",{className:"py-3 text-[#212529]",children:le.displayName}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:le.email}),i.jsx("td",{className:"py-3 text-[#212529]",children:le.role}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:le.accountStatus==="active"?"success":le.accountStatus==="suspended"?"warning":"danger",children:le.accountStatus==="active"?"Active":le.accountStatus==="suspended"?"Suspended":"Banned"})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:Mt(le.joinedAt)}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:le.lastActiveAt?Mt(le.lastActiveAt):""}),i.jsx("td",{className:"py-3 text-[#212529]",children:le.totalAmount>0?Be(le.totalAmount):""}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>{C(le.id),setTimeout(()=>{var Le;(Le=N.current)==null||Le.scrollIntoView({behavior:"smooth",block:"start"})},100)},children:"View"}),le.accountStatus!=="banned"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>he(le,le.accountStatus==="suspended"?"active":"suspended"),children:le.accountStatus==="suspended"?"Unsuspend":"Suspend"}),le.accountStatus==="banned"?i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>he(le,"active"),children:"Unban"}):i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>he(le,"banned"),children:"Ban"})]})})]},le.id)),pe.length===0&&!o&&i.jsx("tr",{children:i.jsx("td",{colSpan:9,className:"py-6 text-center text-sm text-[#6C757D]",children:"No users match your filters."})})]})]}),i.jsx(ez,{currentPage:M,totalItems:pe.length,itemsPerPage:I,onPageChange:G,onItemsPerPageChange:P})]})]}),i.jsx("div",{ref:N,children:i.jsxs(me,{children:[i.jsx(Ce,{title:ge?`User Detail  ${ge.displayName}`:"User Detail",subtitle:"Full profile view for context and actions."}),i.jsx(ve,{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:ge?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsxs("div",{className:"grid gap-2 text-sm text-[#212529] md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Email"}),i.jsx("p",{children:ge.email})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Role"}),i.jsx($e,{variant:"primary",children:ge.role})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),i.jsx("p",{children:Mt(ge.joinedAt)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Last Active"}),i.jsx("p",{children:ge.lastActiveAt?Mt(ge.lastActiveAt):""})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Status"}),i.jsx($e,{variant:ge.accountStatus==="active"?"success":ge.accountStatus==="suspended"?"warning":"danger",children:ge.accountStatus==="active"?"Active":ge.accountStatus==="suspended"?"Suspended":"Banned"})]})]}),i.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:i.jsxs("div",{className:"rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:ge.role==="fan"?"Total Spent":ge.role==="creator"?"Total Earned":"Total Volume"}),i.jsx("p",{className:"text-xl font-semibold",children:ge.totalAmount>0?Be(ge.totalAmount):""})]})})]}),i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Admin Actions"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>he(ge,ge.accountStatus==="active"?"suspended":"active"),children:ge.accountStatus==="suspended"?"Unsuspend Account":"Suspend Account"}),i.jsx(oe,{variant:"danger",onClick:()=>he(ge,"banned"),children:"Ban Account"}),i.jsx(oe,{variant:"primary",className:"mt-2 bg-purple-600 hover:bg-purple-700",onClick:async()=>{if(confirm(`Are you sure you want to log in as ${ge.displayName}? You will be logged out of your admin account.`))try{l(!0);const{data:le,error:Le}=await ie.functions.invoke("admin-impersonate-user",{body:{targetUserId:ge.id}});if(Le)throw Le;if(le!=null&&le.actionLink)window.location.href=le.actionLink;else throw new Error("No login link returned")}catch(le){console.error("Impersonation failed:",le),alert("Failed to login as user: "+(le.message||"Unknown error"))}finally{l(!1)}},children:"Login as User"})]})]})]}):i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Select a user from the table above to view details."})})]})})]})}const LSe=[{label:"All",value:"all"},{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"}],x7={pending:"primary",approved:"success",rejected:"danger"},b7={pending:"Pending",approved:"Approved",rejected:"Rejected"};function MSe(){const[r,n]=O.useState([]),[o,l]=O.useState(!1),[u,m]=O.useState(""),[g,E]=O.useState("all"),[y,x]=O.useState(null),[S,C]=O.useState(1),[N,M]=O.useState(10),G=async()=>{l(!0);try{const{data:q,error:H}=await ie.from("users").select("id, email, display_name, role, creator_profile_status, created_at").eq("role","creator");if(H||!q||q.length===0){H&&console.error("Error fetching creators:",H),n([]);return}const J=q.map(ae=>ae.id);let ee=[];if(J.length>0){const{data:ae}=await ie.from("profiles").select("user_id, username, display_name, bio").in("user_id",J);ee=ae??[]}const ne=new Map(ee.map(ae=>[ae.user_id,ae]));let pe=[];if(J.length>0){const{data:ae}=await ie.from("creator_settings").select("user_id, phone_number").in("user_id",J);pe=ae??[]}const Ee=new Map(pe.map(ae=>[ae.user_id,ae]));let ge=[];if(J.length>0){const{data:ae}=await ie.from("linked_channels").select("user_id, platform, handle").in("user_id",J);ge=ae??[]}const he=new Map;for(const ae of ge){const be=he.get(ae.user_id)??{};ae.platform==="instagram"?be.instagram=ae.handle:ae.platform==="youtube"&&(be.youtube=ae.handle),he.set(ae.user_id,be)}let le=[];if(J.length>0){const{data:ae}=await ie.from("events").select("id, creator_id").in("creator_id",J);le=ae??[]}const Le=new Map;for(const ae of le){const be=ae.creator_id;Le.set(be,(Le.get(be)??0)+1)}const fe=q.map(ae=>{const be=ne.get(ae.id),We=Ee.get(ae.id),it=he.get(ae.id)??{},Ge=(be==null?void 0:be.display_name)||ae.display_name||(ae.email?ae.email.split("@")[0]:"Creator"),pt=be!=null&&be.username?`@${be.username}`:"@creator",Ze=ae.creator_profile_status??"pending";return{id:ae.id,name:Ge,username:pt,email:ae.email,joinedAt:ae.created_at,status:Ze,phone:(We==null?void 0:We.phone_number)??null,bio:(be==null?void 0:be.bio)??null,instagram:it.instagram??null,youtube:it.youtube??null,totalEvents:Le.get(ae.id)??0}});n(fe),x(ae=>{var be;return ae??((be=fe[0])==null?void 0:be.id)??null})}finally{l(!1)}};O.useEffect(()=>{G()},[]);const I=O.useMemo(()=>{const q=u.trim().toLowerCase();return r.filter(H=>g!=="all"&&H.status!==g?!1:q?H.name.toLowerCase().includes(q)||H.email.toLowerCase().includes(q)||H.username.toLowerCase().includes(q):!0)},[r,u,g]),P=O.useMemo(()=>I.filter(q=>q.status==="pending"),[I]),L=O.useMemo(()=>I.filter(q=>q.status==="approved"),[I]),R=O.useMemo(()=>{const q=(S-1)*N,H=q+N;return L.slice(q,H)},[L,S,N]),D=O.useMemo(()=>I.find(q=>q.id===y)??null,[I,y]),V=async(q,H)=>{if(window.confirm(`${H==="approved"?"Approve":"Reject"} ${q.name}?`)){l(!0);try{const{error:ee}=await ie.from("users").update({creator_profile_status:H}).eq("id",q.id);if(ee){console.error("Error updating creator status:",ee),alert("Failed to update creator status.");return}const{error:ne}=await ie.from("profiles").update({creator_profile_status:H}).eq("user_id",q.id);ne&&console.error("Error updating creator status on profile:",ne),n(pe=>pe.map(Ee=>Ee.id===q.id?{...Ee,status:H}:Ee))}finally{l(!1)}}},W=q=>{try{return new Date(q).toLocaleDateString("en-IN",{month:"short",day:"2-digit",year:"numeric"})}catch{return q}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Creator Approvals"}),i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Review new applications and manage existing creators."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",disabled:o,children:"Export"}),i.jsx(oe,{disabled:o,children:"Invite Creator"})]})]}),i.jsxs(me,{className:"bg-[#2C2F33] text-white",children:[i.jsx(Ce,{title:"Filters",subtitle:"Search and filter creators by status.",className:"border-b border-[#3A3D42]"}),i.jsxs(ve,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:i.jsx(nt,{label:"Search",placeholder:"Name, username, or email",value:u,onChange:q=>m(q.target.value)})}),i.jsx("div",{className:"flex flex-col gap-3",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#ADB5BD]",children:"Status"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:LSe.map(q=>i.jsx("button",{type:"button",onClick:()=>E(q.value),className:`rounded-full border px-3 py-1 font-medium ${g===q.value?"border-[#C045FF] bg-[#3A1B4D] text-[#F7E9FF]":"border-[#3A3D42] bg-[#1F2124] text-[#ADB5BD] hover:border-[#C045FF]/60"}`,children:q.label},q.value))})]})})]})]}),i.jsxs(me,{className:"bg-[#2C2F33] text-white",children:[i.jsx(Ce,{title:"Pending Approval",subtitle:"Creators awaiting manual review before onboarding",className:"border-b border-[#3A3D42]"}),i.jsx(ve,{className:"gap-6",children:o&&P.length===0?i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Loading pending creators"}):P.length===0?i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"No creators pending approval."}):P.map(q=>i.jsxs("div",{className:"rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-lg font-semibold",children:q.name}),i.jsx("div",{className:"text-sm text-[#ADB5BD]",children:q.username})]}),i.jsxs($e,{variant:"primary",children:["Joined ",W(q.joinedAt)]})]}),i.jsxs("div",{className:"mt-4 grid gap-3 text-sm text-[#ADB5BD] md:grid-cols-2",children:[i.jsxs("div",{children:["Email: ",q.email]}),i.jsxs("div",{children:["Phone: ",q.phone??"Not provided"]}),i.jsxs("div",{className:"md:col-span-2",children:["Bio: ",q.bio??"Not provided"]}),i.jsxs("div",{children:[" Instagram: ",q.instagram??"Not linked"]}),i.jsxs("div",{children:[" YouTube: ",q.youtube??"Not linked"]})]}),i.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[i.jsx(oe,{variant:"danger",onClick:()=>V(q,"rejected"),disabled:o,children:" Reject"}),i.jsx(oe,{onClick:()=>V(q,"approved"),disabled:o,children:" Approve"}),i.jsx(oe,{variant:"secondary",onClick:()=>x(q.id),disabled:o,children:"View details"})]})]},q.id))})]}),i.jsxs(me,{className:"bg-[#2C2F33] text-white",children:[i.jsx(Ce,{title:"Approved Creators"}),i.jsxs(ve,{className:"overflow-x-auto",children:[i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#ADB5BD]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Username"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Joined"}),i.jsx("th",{className:"border-b border-[#3A3D42] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[R.map(q=>i.jsxs("tr",{className:"border-b border-[#3A3D42]",children:[i.jsx("td",{className:"py-3 text-white",children:q.name}),i.jsx("td",{className:"py-3 text-[#ADB5BD]",children:q.username}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:x7[q.status],children:b7[q.status]})}),i.jsx("td",{className:"py-3 text-white",children:q.totalEvents}),i.jsx("td",{className:"py-3 text-[#ADB5BD]",children:W(q.joinedAt)}),i.jsx("td",{className:"py-3",children:i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>x(q.id),disabled:o,children:"View"})})]},q.id)),L.length===0&&!o&&i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-4 text-center text-sm text-[#ADB5BD]",children:"No approved creators yet."})})]})]}),i.jsx(ez,{currentPage:S,totalItems:L.length,itemsPerPage:N,onPageChange:C,onItemsPerPageChange:M})]})]}),i.jsxs(me,{className:"bg-[#2C2F33] text-white",children:[i.jsx(Ce,{title:D?`Creator Detail  ${D.name}`:"Creator Detail",subtitle:"Full profile view and admin actions for this creator.",className:"border-b border-[#3A3D42]"}),i.jsx(ve,{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:D?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid gap-4 rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6",children:[i.jsxs("div",{className:"grid gap-3 text-sm text-[#ADB5BD] md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Email"}),i.jsx("p",{className:"text-white",children:D.email})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Username"}),i.jsx("p",{className:"text-white",children:D.username})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Status"}),i.jsx($e,{variant:x7[D.status],children:b7[D.status]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),i.jsx("p",{className:"text-white",children:W(D.joinedAt)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Total Events"}),i.jsx("p",{className:"text-white",children:D.totalEvents})]})]}),i.jsxs("div",{className:"grid gap-3 text-sm text-[#ADB5BD]",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Phone"}),i.jsx("p",{className:"text-white",children:D.phone??"Not provided"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Instagram"}),i.jsx("p",{className:"text-white",children:D.instagram??"Not linked"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"YouTube"}),i.jsx("p",{className:"text-white",children:D.youtube??"Not linked"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Bio"}),i.jsx("p",{className:"text-white",children:D.bio??"Not provided"})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#3A3D42] bg-[#1F2124] p-6 text-sm text-white",children:[i.jsx("p",{className:"text-[#ADB5BD]",children:"Admin Actions"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[D.status!=="approved"&&i.jsx(oe,{onClick:()=>V(D,"approved"),disabled:o,children:"Approve Creator"}),D.status!=="rejected"&&i.jsx(oe,{variant:"danger",onClick:()=>V(D,"rejected"),disabled:o,children:"Reject Creator"}),i.jsx(oe,{variant:"primary",className:"mt-2 bg-purple-600 hover:bg-purple-700",onClick:async()=>{if(confirm(`Are you sure you want to log in as ${D.name}? You will be logged out of your admin account.`))try{l(!0);const{data:q,error:H}=await ie.functions.invoke("admin-impersonate-user",{body:{targetUserId:D.id}});if(H)throw H;if(q!=null&&q.actionLink)window.location.href=q.actionLink;else throw new Error("No login link returned")}catch(q){console.error("Impersonation failed:",q),alert("Failed to login as user: "+(q.message||"Unknown error"))}finally{l(!1)}},children:"Login as Creator"})]})]})]}):i.jsx("p",{className:"text-sm text-[#ADB5BD]",children:"Select a creator from the list above to view details."})})]})]})}const w7={segments:["High Spenders","Active Bidders","Inactive","Multiple Wins","Never Won","Refund Issues"],sortOptions:["Total Spent","Number of Bids","Wins Count","Join Date","Last Activity"]};function FSe(r){if(!r)return"No bids yet";const n=new Date(r),l=new Date().getTime()-n.getTime(),u=Math.floor(l/(1e3*60));if(u<1)return"Just now";if(u<60)return`${u} min ago`;const m=Math.floor(u/60);return m<24?`${m} h ago`:`${Math.floor(m/24)} d ago`}function S7(r,n,o,l){const u=n.find(P=>P.id===r);if(!u)return null;const m=o.filter(P=>P.fanId===r),g=m.length,E=m.reduce((P,L)=>P+(L.amount??0),0),y=m.reduce((P,L)=>Math.max(P,L.amount??0),0),x=m.filter(P=>P.status==="won").length,S=g>0?Math.round(x/g*100):0,C=m.filter(P=>P.status==="lost").reduce((P,L)=>P+Math.floor((L.amount??0)*.9),0),N=new Map;for(const P of m){const L=l[P.eventId],R=(L==null?void 0:L.category)||"General";N.set(R,(N.get(R)??0)+1)}const M=Array.from(N.entries()).sort((P,L)=>L[1]-P[1]).slice(0,3).map(([P])=>P),G=M.length>0?M.join(", "):"No data yet",I=m.slice().sort((P,L)=>new Date(L.createdAt).getTime()-new Date(P.createdAt).getTime()).slice(0,5).map(P=>{const L=l[P.eventId],D=new Date(P.createdAt).toLocaleDateString("en-IN",{month:"short",day:"2-digit"});let V;return P.status==="won"?V=" Won":P.status==="lost"?V=" Lost":P.status==="cancelled"?V="Cancelled":V=P.status,{date:D,event:(L==null?void 0:L.title)??"Event",amountLabel:Be(P.amount??0),resultLabel:V}});return{profile:{id:u.id,code:u.code,name:u.name,email:u.email,phone:null,joinDate:Mt(u.joinedAt),preferredEvents:G,status:u.status,isVip:u.isVip,isFlagged:u.isFlagged},spending:{averageBid:g>0?E/g:0,highestBid:y,winRate:S,refundsTotal:C},bidHistory:I}}function USe(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState({}),[g,E]=O.useState(null),[y,x]=O.useState(null),[S,C]=O.useState(!1),[N,M]=O.useState("");O.useEffect(()=>{(async()=>{var W;C(!0);try{const{data:q,error:H}=await ie.from("users").select("id, email, display_name, account_status, created_at, updated_at, is_vip, is_flagged_for_review").eq("role","fan");if(H||!q){console.error("Error fetching fans:",H),n([]),l([]),m({}),E(null),x(null);return}const{data:J}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at"),ee=(J??[]).map(ae=>({id:ae.id,fanId:ae.fan_id,eventId:ae.event_id,amount:ae.amount??0,status:ae.status,createdAt:ae.created_at})),ne=Array.from(new Set(ee.map(ae=>ae.eventId).filter(Boolean))),{data:pe}=ne.length?await ie.from("events").select("id, title, category").in("id",ne):{data:null},Ee={};for(const ae of pe??[])Ee[ae.id]={id:ae.id,title:ae.title,category:ae.category};const ge=new Map;for(const ae of ee){const be=ge.get(ae.fanId)??[];be.push(ae),ge.set(ae.fanId,be)}const he=new Date,le=q.map(ae=>{const be=ge.get(ae.id)??[],We=be.filter(Ie=>Ie.status==="won").reduce((Ie,Xe)=>Ie+(Xe.amount??0),0),it=be.length,Ge=be.filter(Ie=>Ie.status==="won").length,pt=be.reduce((Ie,Xe)=>Ie?new Date(Xe.createdAt)>new Date(Ie.createdAt)?Xe:Ie:Xe,null),Ze=pt?pt.createdAt:null;let Me="Inactive";if(!Ze)Me="Inactive";else{const Ie=(he.getTime()-new Date(Ze).getTime())/864e5;Ie<=7?Me="Active":Ie<=30?Me="At risk":Me="Inactive"}const Ue=`#F-${String(ae.id).slice(0,4).toUpperCase()}`,ke=ae.display_name||(ae.email?ae.email.split("@")[0]:"Fan");return{id:ae.id,code:Ue,name:ke,email:ae.email,totalSpent:We,bids:it,wins:Ge,lastBidAt:Ze,status:Me,joinedAt:ae.created_at,isVip:ae.is_vip??!1,isFlagged:ae.is_flagged_for_review??!1}});le.sort((ae,be)=>be.totalSpent-ae.totalSpent);const Le=((W=le[0])==null?void 0:W.id)??null,fe=Le?S7(Le,le,ee,Ee):null;n(le),l(ee),m(Ee),E(Le),x(fe)}finally{C(!1)}})()},[]);const G=O.useMemo(()=>{const V=N.trim().toLowerCase();let W=[...r];return V&&(W=W.filter(q=>q.name.toLowerCase().includes(V)||q.email.toLowerCase().includes(V)||q.code.toLowerCase().includes(V))),W.sort((q,H)=>H.totalSpent-q.totalSpent),W},[r,N]),I=V=>{E(V);const W=S7(V,r,o,u);x(W)},P=async(V,W)=>{const q=window.prompt(`Enter offer amount () to send to ${W}:`,"100");if(!q)return;const H=parseInt(q,10);if(isNaN(H)||H<=0){alert("Please enter a valid amount.");return}C(!0);try{const{error:J}=await ie.from("fan_offers").insert({fan_id:V,offer_type:"discount",offer_details:`${H} discount offer`,status:"pending",expires_at:new Date(Date.now()+6048e5).toISOString()});if(J){console.error("Error creating offer:",J),alert("Failed to send offer.");return}alert(`Offer of ${H} sent to ${W}!`)}finally{C(!1)}},L=async()=>{if(!g||!y)return;const V=window.prompt(`Enter loyalty reward amount () to add to ${y.profile.name}'s wallet:`,"500");if(!V)return;const W=parseInt(V,10);if(isNaN(W)||W<=0){alert("Please enter a valid amount.");return}C(!0);try{const{error:q}=await ie.from("loyalty_rewards").insert({fan_id:g,reward_type:"credits",amount:W,description:`Loyalty reward of ${W}`});if(q){console.error("Error creating loyalty reward:",q),alert("Failed to create loyalty reward record.");return}const{data:H}=await ie.from("wallets").select("id, balance").eq("user_id",g).maybeSingle();H?await ie.from("wallets").update({balance:(H.balance??0)+W}).eq("id",H.id):await ie.from("wallets").insert({user_id:g,balance:W}),alert(`Loyalty reward of ${W} added to ${y.profile.name}'s wallet!`)}finally{C(!1)}},R=async()=>{if(!g||!y)return;const V=y.profile.isVip,W=V?"remove VIP status from":"grant VIP status to";if(window.confirm(`${W} ${y.profile.name}?`)){C(!0);try{const{error:H}=await ie.from("users").update({is_vip:!V}).eq("id",g);if(H){console.error("Error updating VIP status:",H),alert("Failed to update VIP status.");return}n(J=>J.map(ee=>ee.id===g?{...ee,isVip:!V}:ee)),x(J=>J?{...J,profile:{...J.profile,isVip:!V}}:null),alert(`${y.profile.name} ${V?"removed from":"marked as"} VIP!`)}finally{C(!1)}}},D=async()=>{if(!g||!y)return;const V=y.profile.isFlagged;let W=null;if(V){if(!window.confirm(`Remove flag from ${y.profile.name}?`))return}else if(W=window.prompt("Enter reason for flagging this fan for review:"),W===null)return;C(!0);try{const{error:q}=await ie.from("users").update({is_flagged_for_review:!V,flagged_reason:V?null:W}).eq("id",g);if(q){console.error("Error updating flag status:",q),alert("Failed to update flag status.");return}n(H=>H.map(J=>J.id===g?{...J,isFlagged:!V}:J)),x(H=>H?{...H,profile:{...H.profile,isFlagged:!V}}:null),alert(`${y.profile.name} ${V?"unflagged":"flagged for review"}!`)}finally{C(!1)}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Fans Management"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Surface high-value fans, address churn risk, and track spending patterns."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",children:"Create Segment"}),i.jsx(oe,{children:"Send Campaign"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Filters",subtitle:"Mix and match segments to focus on specific fan cohorts."}),i.jsxs(ve,{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Search Fans",placeholder:"Name, email, or ID",value:N,onChange:V=>M(V.target.value)}),i.jsx(nt,{label:"Date Range",placeholder:"Last activity"}),i.jsx(nt,{label:"Total Spent",placeholder:"> 5,000"}),i.jsx(nt,{label:"Win Rate",placeholder:"> 20%"})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Segments"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:w7.segments.map(V=>i.jsx($e,{variant:"primary",children:V},V))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Sort By"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:w7.sortOptions.map(V=>i.jsx($e,{variant:"warning",children:V},V))})]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Fan Leaderboard",subtitle:"Compare engagement, wins, and spend at a glance."}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Fan"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Email"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Wins"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Last Bid"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsx("tbody",{children:G.map(V=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("span",{className:"font-medium",children:[V.name,V.isVip&&i.jsx("span",{className:"ml-1 text-xs text-[#FFD700]",children:" VIP"}),V.isFlagged&&i.jsx("span",{className:"ml-1 text-xs text-[#DC3545]",children:""})]}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:V.code})]})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:V.email}),i.jsx("td",{className:"py-3 text-[#212529]",children:Be(V.totalSpent)}),i.jsx("td",{className:"py-3 text-[#212529]",children:V.bids}),i.jsx("td",{className:"py-3 text-[#212529]",children:V.wins}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:FSe(V.lastBidAt)}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:V.status==="Active"?"success":V.status==="At risk"?"warning":"danger",children:V.status})}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>I(V.id),children:"View Profile"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>P(V.id,V.name),disabled:S,children:"Send Offer"})]})})]},V.id))})]})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Fan Detail",subtitle:"Deep dive into engagement and outcomes for a specific fan."}),i.jsx(ve,{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]",children:y?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Name / ID"}),i.jsx("p",{children:y.profile.name}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:y.profile.code})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Email"}),i.jsx("p",{children:y.profile.email})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Phone"}),i.jsx("p",{children:y.profile.phone??"Not provided"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Joined"}),i.jsx("p",{children:y.profile.joinDate})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Status"}),i.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.jsx($e,{variant:y.profile.status==="Active"?"success":y.profile.status==="At risk"?"warning":"danger",children:y.profile.status}),y.profile.isVip&&i.jsx($e,{variant:"warning",children:" VIP"}),y.profile.isFlagged&&i.jsx($e,{variant:"danger",children:" Flagged"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Preferences"}),i.jsx("p",{children:y.profile.preferredEvents})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Spending Pattern"}),i.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Average Bid"}),i.jsx("p",{className:"text-lg font-semibold",children:Be(y.spending.averageBid)})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Highest Bid"}),i.jsx("p",{className:"text-lg font-semibold",children:Be(y.spending.highestBid)})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Win Rate"}),i.jsxs("p",{className:"text-lg font-semibold",children:[y.spending.winRate,"%"]})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Refunds"}),i.jsx("p",{className:"text-lg font-semibold",children:Be(y.spending.refundsTotal)})]})]})]})]}),i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Recent Bid History"}),i.jsx("ul",{className:"mt-2 space-y-2",children:y.bidHistory.map(V=>i.jsxs("li",{className:"flex items-center justify-between rounded-[10px] bg-[#F8F9FA] px-3 py-2",children:[i.jsxs("span",{children:[i.jsx("strong",{children:V.date}),"  ",V.event]}),i.jsxs("span",{children:[V.amountLabel," ",V.resultLabel]})]},`${V.date}-${V.event}-${V.amountLabel}`))})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:L,disabled:S,children:" Send Loyalty Reward"}),i.jsx(oe,{variant:y.profile.isVip?"ghost":"primary",onClick:R,disabled:S,children:y.profile.isVip?" Remove VIP":" Mark as VIP"}),i.jsx(oe,{variant:y.profile.isFlagged?"secondary":"danger",onClick:D,disabled:S,children:y.profile.isFlagged?" Unflag":" Flag for Review"})]})]})]}):i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Select a fan from the leaderboard above to view detailed stats."})})]})]})}const VSe={live:{label:" LIVE",variant:"danger"},upcoming:{label:" Upcoming",variant:"primary"},completed:{label:" Completed",variant:"success"},cancelled:{label:" Cancelled",variant:"danger"},draft:{label:" Draft",variant:"warning"}};function BSe(){const[r,n]=O.useState([]),[o,l]=O.useState(null),[u,m]=O.useState(!1),[g,E]=O.useState(""),[y,x]=O.useState("all"),S=async()=>{m(!0);try{const{data:P,error:L}=await ie.from("events").select("id, creator_id, title, description, status, base_price, starts_at, duration_minutes, category, meeting_link").order("created_at",{ascending:!1});if(L||!P){console.error("Error fetching events:",L),n([]);return}const R=Array.from(new Set(P.map(J=>J.creator_id))),{data:D}=await ie.from("profiles").select("user_id, display_name, username").in("user_id",R),V=new Map;for(const J of D??[])V.set(J.user_id,{displayName:J.display_name||J.username||"Creator",username:J.username||"creator"});const{data:W}=await ie.from("bids").select("event_id, amount"),q=new Map;for(const J of W??[]){const ee=q.get(J.event_id)??{count:0,highest:0};q.set(J.event_id,{count:ee.count+1,highest:Math.max(ee.highest,J.amount??0)})}const H=P.map(J=>{const ee=V.get(J.creator_id),ne=q.get(J.id)??{count:0,highest:0};return{id:J.id,code:`#E-${J.id.slice(0,4).toUpperCase()}`,creatorId:J.creator_id,creatorName:(ee==null?void 0:ee.displayName)??"Unknown",title:J.title,status:J.status,bidsCount:ne.count,highestBid:ne.highest,basePrice:J.base_price??0,startsAt:J.starts_at,category:J.category??"general"}});n(H)}finally{m(!1)}};O.useEffect(()=>{S()},[]);const C=O.useMemo(()=>{let P=[...r];y!=="all"&&(P=P.filter(R=>R.status===y));const L=g.trim().toLowerCase();return L&&(P=P.filter(R=>R.title.toLowerCase().includes(L)||R.creatorName.toLowerCase().includes(L)||R.code.toLowerCase().includes(L))),P},[r,y,g]),N=async P=>{const L=r.find(V=>V.id===P);if(!L)return;const{data:R}=await ie.from("events").select("*").eq("id",P).single(),{data:D}=await ie.from("users").select("email").eq("id",L.creatorId).single();R&&l({id:R.id,code:`#E-${R.id.slice(0,4).toUpperCase()}`,title:R.title,description:R.description,creatorName:L.creatorName,creatorEmail:(D==null?void 0:D.email)??"N/A",status:R.status,category:R.category??"general",basePrice:R.base_price??0,highestBid:L.highestBid,bidsCount:L.bidsCount,startsAt:R.starts_at,durationMinutes:R.duration_minutes,meetingLink:R.meeting_link})},M=async P=>{if(window.confirm("Are you sure you want to cancel this event?")){m(!0);try{const{error:R}=await ie.from("events").update({status:"cancelled"}).eq("id",P);if(R){console.error("Error cancelling event:",R),alert("Failed to cancel event.");return}await S(),l(null),alert("Event cancelled successfully.")}finally{m(!1)}}},G=async P=>{if(window.confirm("Are you sure you want to DELETE this event? This cannot be undone.")){m(!0);try{await ie.from("bids").delete().eq("event_id",P);const{error:R}=await ie.from("events").delete().eq("id",P);if(R){console.error("Error deleting event:",R),alert("Failed to delete event.");return}await S(),l(null),alert("Event deleted successfully.")}finally{m(!1)}}},I=P=>VSe[P]??{label:P,variant:"secondary"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Events Management"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track live, upcoming, and completed events."})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:["all","live","upcoming","completed","cancelled"].map(P=>i.jsx(oe,{variant:y===P?"secondary":"ghost",size:"sm",onClick:()=>x(P),children:P==="all"?"All":P.charAt(0).toUpperCase()+P.slice(1)},P))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Events",subtitle:`${C.length} events found`}),i.jsxs(ve,{children:[i.jsx("div",{className:"mb-4",children:i.jsx(nt,{label:"Search Events",placeholder:"Search by title, creator, or ID...",value:g,onChange:P=>E(P.target.value)})}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event Title"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Highest Bid"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Starts At"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[C.map(P=>{const L=I(P.status);return i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:P.code}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:P.creatorName}),i.jsx("td",{className:"py-3 text-[#212529]",children:P.title}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:L.variant,children:L.label})}),i.jsx("td",{className:"py-3 text-[#212529]",children:P.bidsCount}),i.jsx("td",{className:"py-3 text-[#212529]",children:P.highestBid>0?Be(P.highestBid):Be(P.basePrice)}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:Mt(P.startsAt)}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>N(P.id),disabled:u,children:"View"}),P.status!=="cancelled"&&P.status!=="completed"&&i.jsx(oe,{variant:"danger",size:"sm",onClick:()=>M(P.id),disabled:u,children:"Cancel"})]})})]},P.id)}),C.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:8,className:"py-8 text-center text-[#6C757D]",children:u?"Loading events...":"No events found"})})]})]})})]})]}),o&&i.jsxs(me,{children:[i.jsx(Ce,{title:"Event Details",subtitle:o.code}),i.jsx(ve,{children:i.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-[#212529]",children:o.title}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:o.description||"No description"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Creator"}),i.jsx("p",{className:"font-medium",children:o.creatorName}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:o.creatorEmail})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Category"}),i.jsx("p",{className:"font-medium capitalize",children:o.category})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Base Price"}),i.jsx("p",{className:"font-medium",children:Be(o.basePrice)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Highest Bid"}),i.jsx("p",{className:"font-medium",children:Be(o.highestBid)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Total Bids"}),i.jsx("p",{className:"font-medium",children:o.bidsCount})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Duration"}),i.jsxs("p",{className:"font-medium",children:[o.durationMinutes," min"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Status"}),i.jsx($e,{variant:I(o.status).variant,children:I(o.status).label})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Starts At"}),i.jsx("p",{className:"font-medium",children:Mt(o.startsAt)})]})]}),o.meetingLink&&i.jsxs("div",{children:[i.jsx("p",{className:"text-[#6C757D]",children:"Meeting Link"}),i.jsx("a",{href:o.meetingLink,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 underline",children:o.meetingLink})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"font-semibold text-[#212529]",children:"Admin Actions"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[o.status!=="cancelled"&&o.status!=="completed"&&i.jsx(oe,{variant:"danger",onClick:()=>M(o.id),disabled:u,children:" Cancel Event"}),i.jsx(oe,{variant:"ghost",onClick:()=>G(o.id),disabled:u,children:" Delete Event Permanently"}),i.jsx(oe,{variant:"secondary",onClick:()=>l(null),children:"Close Details"})]})]})]})})]})]})}function WSe(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState(!1),g=async()=>{m(!0);try{const{data:C}=await ie.from("featured_creators").select("id, creator_id, display_order, featured_since, is_active").eq("is_active",!0).order("display_order",{ascending:!0}),N=(C??[]).map(ne=>ne.creator_id),{data:M}=await ie.from("users").select("id, email, display_name").eq("role","creator"),G=(M??[]).map(ne=>ne.id),{data:I}=await ie.from("profiles").select("user_id, display_name, username, category").in("user_id",G),P=new Map;for(const ne of I??[])P.set(ne.user_id,ne);const{data:L}=await ie.from("events").select("id, creator_id"),R=new Map;for(const ne of L??[])R.set(ne.creator_id,(R.get(ne.creator_id)??0)+1);const{data:D}=await ie.from("meets").select("creator_id, status").eq("status","completed"),V=new Map;for(const ne of D??[])V.set(ne.creator_id,(V.get(ne.creator_id)??0)+1);const{data:W}=await ie.from("bids").select("event_id, amount, status").eq("status","won"),q=new Map;for(const ne of L??[])q.set(ne.id,ne.creator_id);const H=new Map;for(const ne of W??[]){const pe=q.get(ne.event_id);pe&&H.set(pe,(H.get(pe)??0)+(ne.amount??0))}const J=(C??[]).map(ne=>{const pe=P.get(ne.creator_id);return{id:ne.id,creatorId:ne.creator_id,name:(pe==null?void 0:pe.display_name)||(pe==null?void 0:pe.username)||"Creator",username:pe!=null&&pe.username?`@${pe.username}`:"@creator",category:(pe==null?void 0:pe.category)||"general",totalEarnings:H.get(ne.creator_id)??0,eventsCount:R.get(ne.creator_id)??0,featuredSince:ne.featured_since,displayOrder:ne.display_order}}),ee=(M??[]).filter(ne=>!N.includes(ne.id)).map(ne=>{const pe=P.get(ne.id);return{id:ne.id,name:(pe==null?void 0:pe.display_name)||(pe==null?void 0:pe.username)||ne.display_name||"Creator",username:pe!=null&&pe.username?`@${pe.username}`:"@creator",category:(pe==null?void 0:pe.category)||"general",eventsCount:R.get(ne.id)??0,completedMeets:V.get(ne.id)??0,totalEarnings:H.get(ne.id)??0}}).sort((ne,pe)=>pe.totalEarnings-ne.totalEarnings);n(J),l(ee)}finally{m(!1)}};O.useEffect(()=>{g()},[]);const E=async(C,N)=>{if(window.confirm(`Add ${N} to featured creators?`)){m(!0);try{const G=r.reduce((P,L)=>Math.max(P,L.displayOrder),0),{error:I}=await ie.from("featured_creators").insert({creator_id:C,display_order:G+1,is_active:!0});if(I){console.error("Error featuring creator:",I),alert("Failed to feature creator.");return}await g(),alert(`${N} is now featured!`)}finally{m(!1)}}},y=async(C,N)=>{if(window.confirm(`Remove ${N} from featured creators?`)){m(!0);try{const{error:G}=await ie.from("featured_creators").update({is_active:!1}).eq("id",C);if(G){console.error("Error removing featured creator:",G),alert("Failed to remove featured creator.");return}await g(),alert(`${N} removed from featured.`)}finally{m(!1)}}},x=async(C,N)=>{if(!(N<=1)){m(!0);try{const M=r.find(G=>G.displayOrder===N-1);M&&await ie.from("featured_creators").update({display_order:N}).eq("id",M.id),await ie.from("featured_creators").update({display_order:N-1}).eq("id",C),await g()}finally{m(!1)}}},S=async(C,N)=>{const M=r.reduce((G,I)=>Math.max(G,I.displayOrder),0);if(!(N>=M)){m(!0);try{const G=r.find(I=>I.displayOrder===N+1);G&&await ie.from("featured_creators").update({display_order:N}).eq("id",G.id),await ie.from("featured_creators").update({display_order:N+1}).eq("id",C),await g()}finally{m(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Featured Creators"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control homepage placement, scheduling, and promotion of spotlighted creators."})]})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Featured Creators",subtitle:`${r.length} creators featured  Priority influences homepage carousel`}),i.jsxs(ve,{className:"space-y-4",children:[r.length===0&&!u&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No featured creators yet. Add creators from the candidate pool below."}),r.map((C,N)=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>x(C.id,C.displayOrder),disabled:u||N===0,children:""}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>S(C.id,C.displayOrder),disabled:u||N===r.length-1,children:""})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"text-sm text-[#6C757D]",children:["#",N+1]}),i.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:C.name}),i.jsx("div",{className:"text-sm text-[#6C757D]",children:C.username})]})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-[#6C757D]",children:[i.jsxs("div",{children:["Category ",i.jsx("span",{className:"font-semibold capitalize text-[#212529]",children:C.category})]}),i.jsxs("div",{children:["Events ",i.jsx("span",{className:"font-semibold text-[#212529]",children:C.eventsCount})]}),i.jsxs("div",{children:["Earned ",i.jsx("span",{className:"font-semibold text-[#212529]",children:Be(C.totalEarnings)})]}),i.jsxs($e,{variant:"primary",children:["Featured since ",new Date(C.featuredSince).toLocaleDateString("en-IN",{month:"short",day:"numeric",year:"numeric"})]})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:i.jsx(oe,{size:"sm",variant:"danger",onClick:()=>y(C.id,C.name),disabled:u,children:"Remove"})})]},C.id))]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Candidate Pool",subtitle:"High-performing creators eligible for featuring."}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Category"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Completed Meets"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Earnings"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[o.map(C=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-medium text-[#212529]",children:C.name}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:C.username})]})}),i.jsx("td",{className:"py-3 capitalize text-[#212529]",children:C.category}),i.jsx("td",{className:"py-3 text-[#212529]",children:C.eventsCount}),i.jsx("td",{className:"py-3 text-[#212529]",children:C.completedMeets}),i.jsx("td",{className:"py-3 text-[#212529]",children:Be(C.totalEarnings)}),i.jsx("td",{className:"py-3",children:i.jsx("div",{className:"flex gap-2 text-xs",children:i.jsx(oe,{size:"sm",variant:"primary",onClick:()=>E(C.id,C.name),disabled:u,children:" Feature"})})})]},C.id)),o.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-8 text-center text-[#6C757D]",children:u?"Loading creators...":"No candidates available"})})]})]})})]})]})}const Bf={all:"All Users",fans:"Fans Only",creators:"Creators Only"},GSe={notification:"In-App Notification",banner:"Banner",modal:"Modal",email:"Email"},C7={draft:"warning",active:"success",expired:"danger",cancelled:"danger"};function HSe(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState("all"),[C,N]=O.useState("notification"),[M,G]=O.useState(""),I=async()=>{u(!0);try{const{data:ee,error:ne}=await ie.from("admin_announcements").select("*").order("created_at",{ascending:!1});if(ne){console.error("Error fetching announcements:",ne),o([]);return}const pe=(ee??[]).map(Ee=>({id:Ee.id,title:Ee.title,message:Ee.message,targetAudience:Ee.target_audience,displayType:Ee.display_type,status:Ee.status,scheduledAt:Ee.scheduled_at,expiresAt:Ee.expires_at,viewsCount:Ee.views_count??0,clicksCount:Ee.clicks_count??0,createdAt:Ee.created_at}));o(pe)}finally{u(!1)}};O.useEffect(()=>{I()},[]);const P=()=>{g(""),y(""),S("all"),N("notification"),G("")},L=async()=>{if(!m.trim()||!E.trim()){alert("Please enter a title and message.");return}u(!0);try{const{error:ee}=await ie.from("admin_announcements").insert({title:m.trim(),message:E.trim(),target_audience:x,display_type:C,status:"draft",expires_at:M?new Date(M).toISOString():null,created_by:r==null?void 0:r.id});if(ee){console.error("Error saving draft:",ee),alert("Failed to save draft.");return}P(),await I(),alert("Draft saved successfully!")}finally{u(!1)}},R=async()=>{if(!m.trim()||!E.trim()){alert("Please enter a title and message.");return}const ee=Bf[x];if(window.confirm(`Publish announcement to ${ee}?

This will send notifications to all ${x==="all"?"users":x}.`)){u(!0);try{const{data:pe,error:Ee}=await ie.from("admin_announcements").insert({title:m.trim(),message:E.trim(),target_audience:x,display_type:C,status:"active",expires_at:M?new Date(M).toISOString():null,created_by:r==null?void 0:r.id}).select().single();if(Ee||!pe){console.error("Error creating announcement:",Ee),alert("Failed to create announcement.");return}let ge=ie.from("users").select("id");x==="fans"?ge=ge.eq("role","fan"):x==="creators"?ge=ge.eq("role","creator"):ge=ge.in("role",["fan","creator"]);const{data:he,error:le}=await ge;if(le&&console.error("Error fetching users:",le),he&&he.length>0){const Le=he.map(fe=>({user_id:fe.id,type:"announcement",title:m.trim(),message:E.trim(),announcement_id:pe.id,read:!1}));for(let fe=0;fe<Le.length;fe+=100){const ae=Le.slice(fe,fe+100);await ie.from("notifications").insert(ae)}}P(),await I(),alert(`Announcement published! Notifications sent to ${(he==null?void 0:he.length)??0} users.`)}finally{u(!1)}}},D=async ee=>{const ne=n.find(ge=>ge.id===ee);if(!ne)return;const pe=Bf[ne.targetAudience];if(window.confirm(`Publish "${ne.title}" to ${pe}?

This will send notifications to all ${ne.targetAudience==="all"?"users":ne.targetAudience}.`)){u(!0);try{await ie.from("admin_announcements").update({status:"active"}).eq("id",ee);let ge=ie.from("users").select("id");ne.targetAudience==="fans"?ge=ge.eq("role","fan"):ne.targetAudience==="creators"?ge=ge.eq("role","creator"):ge=ge.in("role",["fan","creator"]);const{data:he}=await ge;if(he&&he.length>0){const le=he.map(Le=>({user_id:Le.id,type:"announcement",title:ne.title,message:ne.message,announcement_id:ee,read:!1}));for(let Le=0;Le<le.length;Le+=100){const fe=le.slice(Le,Le+100);await ie.from("notifications").insert(fe)}}await I(),alert(`Announcement published! Notifications sent to ${(he==null?void 0:he.length)??0} users.`)}finally{u(!1)}}},V=async ee=>{if(window.confirm("Deactivate this announcement?")){u(!0);try{await ie.from("admin_announcements").update({status:"cancelled"}).eq("id",ee),await I(),alert("Announcement deactivated.")}finally{u(!1)}}},W=async ee=>{if(window.confirm("Delete this announcement permanently?")){u(!0);try{await ie.from("notifications").delete().eq("announcement_id",ee),await ie.from("admin_announcements").delete().eq("id",ee),await I(),alert("Announcement deleted.")}finally{u(!1)}}},q=n.filter(ee=>ee.status==="active"),H=n.filter(ee=>ee.status==="draft"),J=n.filter(ee=>ee.status==="expired"||ee.status==="cancelled");return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Announcements"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Publish platform-wide communications and send notifications to users."})]})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Composer",subtitle:"Create a new announcement with targeting options."}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Title",placeholder:"Announcement headline",value:m,onChange:ee=>g(ee.target.value)}),i.jsxs("div",{children:[i.jsx("label",{className:"mb-1 block text-sm font-medium text-[#212529]",children:"Target Audience"}),i.jsxs("select",{className:"w-full rounded-lg border border-[#E9ECEF] bg-white px-3 py-2 text-sm",value:x,onChange:ee=>S(ee.target.value),children:[i.jsx("option",{value:"all",children:" All Users (Fans + Creators)"}),i.jsx("option",{value:"fans",children:" Fans Only"}),i.jsx("option",{value:"creators",children:" Creators Only"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"mb-1 block text-sm font-medium text-[#212529]",children:"Display Type"}),i.jsxs("select",{className:"w-full rounded-lg border border-[#E9ECEF] bg-white px-3 py-2 text-sm",value:C,onChange:ee=>N(ee.target.value),children:[i.jsx("option",{value:"notification",children:" In-App Notification"}),i.jsx("option",{value:"banner",children:" Banner"}),i.jsx("option",{value:"modal",children:" Modal Popup"}),i.jsx("option",{value:"email",children:" Email"})]})]}),i.jsx(nt,{label:"Expiry Date (Optional)",type:"datetime-local",value:M,onChange:ee=>G(ee.target.value)}),i.jsx("div",{className:"md:col-span-2",children:i.jsx(dr,{label:"Message",rows:4,placeholder:"Write the announcement message here...",value:E,onChange:ee=>y(ee.target.value)})}),i.jsxs("div",{className:"flex flex-wrap gap-2 md:col-span-2",children:[i.jsx(oe,{variant:"secondary",onClick:L,disabled:l,children:" Save as Draft"}),i.jsx(oe,{onClick:R,disabled:l,children:" Publish & Send Notifications"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Active Announcements",subtitle:`${q.length} live announcements`}),i.jsxs(ve,{className:"space-y-4",children:[q.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No active announcements"}),q.map(ee=>i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:ee.title}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["Target: ",Bf[ee.targetAudience],"  Type: ",GSe[ee.displayType]]})]}),i.jsx($e,{variant:C7[ee.status],children:ee.status.charAt(0).toUpperCase()+ee.status.slice(1)})]}),i.jsx("p",{className:"text-sm text-[#212529]",children:ee.message}),i.jsxs("div",{className:"flex flex-wrap gap-6 text-sm text-[#6C757D]",children:[i.jsxs("span",{children:["Created: ",Mt(ee.createdAt)]}),ee.expiresAt&&i.jsxs("span",{children:["Expires: ",Mt(ee.expiresAt)]}),i.jsxs("span",{children:["Views: ",ee.viewsCount.toLocaleString()]})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:i.jsx(oe,{size:"sm",variant:"danger",onClick:()=>V(ee.id),disabled:l,children:"Deactivate"})})]},ee.id))]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Drafts",subtitle:`${H.length} drafts awaiting publish`}),i.jsxs(ve,{className:"space-y-3",children:[H.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No drafts"}),H.map(ee=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:ee.title}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:["Target: ",Bf[ee.targetAudience],"  Created: ",Mt(ee.createdAt)]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{size:"sm",variant:"primary",onClick:()=>D(ee.id),disabled:l,children:" Publish Now"}),i.jsx(oe,{size:"sm",variant:"danger",onClick:()=>W(ee.id),disabled:l,children:"Delete"})]})]},ee.id))]})]}),J.length>0&&i.jsxs(me,{children:[i.jsx(Ce,{title:"Past Announcements",subtitle:"Expired or cancelled announcements"}),i.jsx(ve,{className:"space-y-3",children:J.map(ee=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:ee.title}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:[Bf[ee.targetAudience],"  ",Mt(ee.createdAt)]})]}),i.jsx($e,{variant:C7[ee.status],children:ee.status.charAt(0).toUpperCase()+ee.status.slice(1)}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>W(ee.id),disabled:l,children:" Delete"})]},ee.id))})]})]})}const zSe={bid_authorization:"Bid",bid_refund:"Refund",bid_capture:"Capture",creator_earning:"Earning",creator_payout:"Payout",manual_adjustment:"Adjustment"};function KSe(){const[r,n]=O.useState([]),[o,l]=O.useState({totalProcessed:0,totalRefunded:0,pendingPayouts:0,totalCommission:0}),[u,m]=O.useState(!1),[g,E]=O.useState("all");O.useEffect(()=>{(async()=>{var S;m(!0);try{const{data:C}=await ie.from("wallet_transactions").select("id, wallet_id, type, direction, amount, reference_table, reference_id, description, created_at").order("created_at",{ascending:!1}).limit(100),N=Array.from(new Set((C??[]).map(he=>he.wallet_id))),{data:M}=N.length?await ie.from("wallets").select("id, user_id").in("id",N):{data:[]},G=new Map;for(const he of M??[])G.set(he.id,he.user_id);const I=Array.from(new Set(Array.from(G.values()))),{data:P}=I.length?await ie.from("users").select("id, display_name, email").in("id",I):{data:[]},L=new Map;for(const he of P??[])L.set(he.id,he.display_name||((S=he.email)==null?void 0:S.split("@")[0])||"User");const R=(C??[]).filter(he=>he.reference_table==="events"||he.reference_table==="bids").map(he=>he.reference_id).filter(Boolean),{data:D}=R.length?await ie.from("events").select("id, title").in("id",R):{data:[]},V=new Map;for(const he of D??[])V.set(he.id,he.title);const W=(C??[]).map(he=>{const le=G.get(he.wallet_id)??"",Le=new Date(he.created_at);return{id:he.id,date:Le.toLocaleDateString("en-IN",{month:"short",day:"numeric"}),time:Le.toLocaleTimeString("en-IN",{hour:"numeric",minute:"2-digit"}),userId:le,userName:L.get(le)??"Unknown",eventId:he.reference_id,eventTitle:V.get(he.reference_id)??he.description??"-",amount:he.amount??0,type:he.type,direction:he.direction,status:"Processed"}});n(W);const{data:q}=await ie.from("bids").select("amount, status"),H=(q??[]).filter(he=>he.status==="won"),J=(q??[]).filter(he=>he.status==="lost"),ee=H.reduce((he,le)=>he+(le.amount??0),0),ne=J.reduce((he,le)=>he+Math.floor((le.amount??0)*.9),0),pe=H.reduce((he,le)=>he+Math.floor((le.amount??0)*.1),0)+J.reduce((he,le)=>he+Math.floor((le.amount??0)*.1),0),{data:Ee}=await ie.from("withdrawal_requests").select("amount").eq("status","pending"),ge=(Ee??[]).reduce((he,le)=>he+(le.amount??0),0);l({totalProcessed:ee,totalRefunded:ne,pendingPayouts:ge,totalCommission:pe})}finally{m(!1)}})()},[]);const y=r.filter(x=>g==="all"?!0:g==="bids"?x.type==="bid_authorization"||x.type==="bid_capture":g==="refunds"?x.type==="bid_refund":g==="payouts"?x.type==="creator_payout"||x.type==="creator_earning":!0);return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Payments"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Review platform transactions, refunds, and commissions."})]}),i.jsx("div",{className:"flex gap-2",children:["all","bids","refunds","payouts"].map(x=>i.jsx(oe,{size:"sm",variant:g===x?"secondary":"ghost",onClick:()=>E(x),children:x.charAt(0).toUpperCase()+x.slice(1)},x))})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs(me,{children:[i.jsx(Ce,{title:"Total Processed"}),i.jsxs(ve,{children:[i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:Be(o.totalProcessed)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"From winning bids"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Amount Returned to Fans"}),i.jsxs(ve,{children:[i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:Be(o.totalRefunded)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"90% of lost bids (non-winners)"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Pending Payouts"}),i.jsxs(ve,{children:[i.jsx("div",{className:"text-3xl font-bold text-[#212529]",children:Be(o.pendingPayouts)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Awaiting approval"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Platform Commission"}),i.jsxs(ve,{children:[i.jsx("div",{className:"text-3xl font-bold text-[#28A745]",children:Be(o.totalCommission)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"10% from all bids"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Transactions",subtitle:`${y.length} transactions`}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Time"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Description"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Type"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Direction"})]})}),i.jsxs("tbody",{children:[y.map(x=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:x.date}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:x.time}),i.jsx("td",{className:"py-3 text-[#212529]",children:x.userName}),i.jsx("td",{className:"py-3 text-[#212529]",children:x.eventTitle}),i.jsx("td",{className:"py-3 text-[#212529]",children:Be(x.amount)}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:"primary",children:zSe[x.type]??x.type})}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:x.direction==="credit"?"success":"danger",children:x.direction==="credit"?" Credit":" Debit"})})]},x.id)),y.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:7,className:"py-8 text-center text-[#6C757D]",children:u?"Loading transactions...":"No transactions found"})})]})]})})]})]})}function qSe(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState(!1),[g,E]=O.useState({}),[y,x]=O.useState({}),S=async()=>{m(!0);try{const{data:I}=await ie.from("withdrawal_requests").select("*").order("requested_at",{ascending:!1}),P=Array.from(new Set((I??[]).map(pe=>pe.creator_id))),{data:L}=P.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",P):{data:[]},R=new Map;for(const pe of L??[])R.set(pe.user_id,{displayName:pe.display_name||pe.username||"Creator",username:pe.username?`@${pe.username}`:"@creator"});const{data:D}=await ie.from("bids").select("event_id, amount, status").eq("status","won"),{data:V}=await ie.from("events").select("id, creator_id"),W=new Map;for(const pe of V??[])W.set(pe.id,pe.creator_id);const q=new Map;for(const pe of D??[]){const Ee=W.get(pe.event_id);if(Ee){const ge=Math.floor((pe.amount??0)*.9);q.set(Ee,(q.get(Ee)??0)+ge)}}const H=new Map;for(const pe of I??[])pe.status==="completed"&&H.set(pe.creator_id,(H.get(pe.creator_id)??0)+(pe.amount??0));const J=(I??[]).map(pe=>{const Ee=R.get(pe.creator_id),ge=q.get(pe.creator_id)??0,he=H.get(pe.creator_id)??0;return{id:pe.id,code:`#WR-${pe.id.slice(0,4).toUpperCase()}`,creatorId:pe.creator_id,creatorName:(Ee==null?void 0:Ee.displayName)??"Unknown",creatorUsername:(Ee==null?void 0:Ee.username)??"@creator",amount:pe.amount??0,destination:pe.destination,status:pe.status,requestedAt:pe.requested_at,processedAt:pe.processed_at,adminNotes:pe.admin_notes,gatewayReference:pe.gateway_reference,rejectionReason:pe.rejection_reason,earnings:{total:ge,withdrawn:he,pending:ge-he}}}),ee=J.filter(pe=>pe.status==="pending"||pe.status==="in_review"),ne=J.filter(pe=>pe.status==="completed"||pe.status==="failed");n(ee),l(ne)}finally{m(!1)}};O.useEffect(()=>{S()},[]);const C=async I=>{const P=g[I]??{gatewayReference:"",adminNotes:""};if(!P.gatewayReference.trim()){alert("Please enter the gateway reference ID.");return}if(window.confirm("Confirm this payment has been processed?")){m(!0);try{const{error:R}=await ie.from("withdrawal_requests").update({status:"completed",processed_at:new Date().toISOString(),gateway_reference:P.gatewayReference.trim(),admin_notes:P.adminNotes.trim()||null}).eq("id",I);if(R){console.error("Error approving withdrawal:",R),alert("Failed to approve withdrawal.");return}await S(),E(D=>{const V={...D};return delete V[I],V}),alert("Withdrawal approved and marked as completed!")}finally{m(!1)}}},N=async I=>{const P=y[I]??{reason:"",message:""};if(!P.reason.trim()){alert("Please enter a rejection reason.");return}if(window.confirm("Reject this withdrawal request?")){m(!0);try{const{error:R}=await ie.from("withdrawal_requests").update({status:"failed",processed_at:new Date().toISOString(),rejection_reason:P.reason.trim(),admin_notes:P.message.trim()||null}).eq("id",I);if(R){console.error("Error rejecting withdrawal:",R),alert("Failed to reject withdrawal.");return}await S(),x(D=>{const V={...D};return delete V[I],V}),alert("Withdrawal request rejected.")}finally{m(!1)}}},M=I=>{const P=new Date(I),R=new Date().getTime()-P.getTime(),D=Math.floor(R/(1e3*60*60));return D<1?"Just now":D<24?`${D} hours ago`:`${Math.floor(D/24)} days ago`},G={pending:"warning",in_review:"primary",completed:"success",failed:"danger"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Withdrawal Requests"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Verify payouts, capture references, and keep the audit trail healthy."})]}),i.jsxs($e,{variant:"warning",children:[r.length," pending"]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Pending",subtitle:"Requests needing manual review or payment confirmation."}),i.jsxs(ve,{className:"space-y-4",children:[r.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:u?"Loading...":"No pending withdrawal requests"}),r.map(I=>{const P=g[I.id]??{gatewayReference:"",adminNotes:""},L=y[I.id]??{reason:"",message:""};return i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:I.creatorName}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:[I.creatorUsername,"  Requested ",M(I.requestedAt)]})]}),i.jsx($e,{variant:G[I.status]??"warning",children:I.status==="pending"?"Awaiting payout":I.status})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-2 text-sm text-[#212529]",children:[i.jsxs("p",{children:["Request ID: ",i.jsx("strong",{children:I.code})]}),i.jsxs("p",{children:["Amount: ",i.jsx("strong",{className:"text-lg",children:Be(I.amount)})]}),i.jsxs("p",{children:["Method: ",I.destination||"Not specified"]}),i.jsxs("p",{children:["Requested On: ",Mt(I.requestedAt)]})]}),i.jsxs("div",{className:"space-y-2 rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Creator Earnings Breakdown"}),i.jsxs("p",{children:["Total Earnings: ",i.jsx("strong",{children:Be(I.earnings.total)})]}),i.jsxs("p",{children:["Withdrawn: ",i.jsx("strong",{children:Be(I.earnings.withdrawn)})]}),i.jsxs("p",{children:["Available Balance: ",i.jsx("strong",{className:"text-[#28A745]",children:Be(I.earnings.pending)})]})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:" Mark as Paid"}),i.jsx(nt,{label:"Gateway Reference ID",placeholder:"pay_xyz123",value:P.gatewayReference,onChange:R=>E(D=>({...D,[I.id]:{...P,gatewayReference:R.target.value}}))}),i.jsx(dr,{label:"Admin Notes",rows:2,placeholder:"Optional note for audit log",value:P.adminNotes,onChange:R=>E(D=>({...D,[I.id]:{...P,adminNotes:R.target.value}}))}),i.jsx(oe,{size:"sm",onClick:()=>C(I.id),disabled:u,children:"Confirm Payment"})]}),i.jsxs("div",{className:"space-y-3 rounded-[12px] border border-[#E9ECEF] bg-white p-4",children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:" Reject Request"}),i.jsx(nt,{label:"Reason",placeholder:"Insufficient balance / pending dispute / ...",value:L.reason,onChange:R=>x(D=>({...D,[I.id]:{...L,reason:R.target.value}}))}),i.jsx(dr,{label:"Message to creator",rows:2,placeholder:"Explain next steps",value:L.message,onChange:R=>x(D=>({...D,[I.id]:{...L,message:R.target.value}}))}),i.jsx(oe,{size:"sm",variant:"danger",onClick:()=>N(I.id),disabled:u,children:"Reject Request"})]})]})]},I.id)})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"History",subtitle:"Resolved withdrawal requests across the platform."}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Method"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Processed"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Reference"})]})}),i.jsxs("tbody",{children:[o.map(I=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#6C757D]",children:I.code}),i.jsx("td",{className:"py-3 text-[#212529]",children:I.creatorName}),i.jsx("td",{className:"py-3 text-[#212529]",children:Be(I.amount)}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:I.destination||"-"}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:G[I.status]??"primary",children:I.status==="completed"?"Paid":"Rejected"})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:I.processedAt?Mt(I.processedAt):"-"}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:I.gatewayReference||I.rejectionReason||"-"})]},I.id)),o.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:7,className:"py-8 text-center text-[#6C757D]",children:u?"Loading...":"No withdrawal history"})})]})]})})]})]})}const YSe=[{id:"#RF-789",user:"Rahul Kumar",email:"rahul@email.com",event:"#342  Meet & Greet with Priya",amount:"270",type:"Auto 90%",status:"Processed",processedOn:"Jan 12, 2025"},{id:"#RF-788",user:"Priya Singh",email:"priya@email.com",event:"#341  Cooking Demo",amount:"180",type:"Auto 90%",status:"Processed",processedOn:"Jan 12, 2025"},{id:"#RF-787",user:"Amit Gupta",email:"amit@email.com",event:"#340  Productivity Masterclass",amount:"450",type:"Manual",status:"Pending Retry",processedOn:"Jan 11, 2025"},{id:"#RF-786",user:"Neha Kapoor",email:"neha@email.com",event:"#339  Cooking with Chef Rohan",amount:"320",type:"Auto 90%",status:"Failed",processedOn:"Jan 11, 2025"}],Pd={id:"#RF-786",reason:"Payment method expired / Bank account closed",gatewayError:"BAD_REQUEST_ERROR  Invalid account details",attempts:3,amount:"288 (90%)",originalBid:"320",user:"Neha Kumar (neha@email.com)"};function $Se(){return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Refunds Management"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track automatic and manual refunds, investigate failures, and trigger overrides."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",children:"Export Report"}),i.jsx(oe,{children:"Process Manual Refund"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Overview",subtitle:"Quick insight into refund volume and outcomes."}),i.jsx(ve,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[{label:"Refunds Today",value:"23,450  89 refunds"},{label:"This Week",value:"1,45,200  456 refunds"},{label:"This Month",value:"4,52,300  1,234 refunds"},{label:"Failed Pending",value:"12  3,400"}].map(r=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:r.label}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:r.value})]},r.label))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Refunds",subtitle:"Filter by status, type, or amount to focus investigation."}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"ID"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Type"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Processed"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsx("tbody",{children:YSe.map(r=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#6C757D]",children:r.id}),i.jsx("td",{className:"py-3 text-[#212529]",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-medium",children:r.user}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:r.email})]})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:r.event}),i.jsx("td",{className:"py-3 text-[#212529]",children:r.amount}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:r.type}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:r.status==="Processed"?"success":r.status==="Pending Retry"?"warning":"danger",children:r.status})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:r.processedOn}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[i.jsx(oe,{size:"sm",variant:"secondary",children:"View Details"}),i.jsx(oe,{size:"sm",variant:"ghost",children:"Retry"})]})})]},r.id))})]})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Failed Refunds Requiring Action",subtitle:"Resolve gateway failures with manual interventions."}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("p",{className:"font-semibold",children:["Refund ",Pd.id]}),i.jsx("p",{className:"mt-1 text-[#6C757D]",children:Pd.user}),i.jsxs("p",{className:"mt-4",children:["Original Bid: ",Pd.originalBid]}),i.jsxs("p",{children:["Refund Amount: ",Pd.amount]}),i.jsxs("p",{children:["Attempts: ",Pd.attempts]}),i.jsxs("p",{className:"mt-3 text-[#D9480F]",children:["Failure Reason: ",Pd.reason]}),i.jsxs("p",{className:"text-[#6C757D]",children:["Gateway Error: ",Pd.gatewayError]})]}),i.jsxs("div",{className:"space-y-3 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx(nt,{label:"Next Step",placeholder:"Retry via gateway / Manual transfer"}),i.jsx(dr,{label:"Notes",rows:3,placeholder:"Add context for audit trail"}),i.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[i.jsx(oe,{variant:"secondary",children:"Retry Refund"}),i.jsx(oe,{variant:"ghost",children:"Contact User"})]}),i.jsx(oe,{variant:"danger",children:"Mark as Resolved"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Manual Refund",subtitle:"Issue full or partial refunds outside the automatic flow."}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"User",placeholder:"Search by email / phone / ID"}),i.jsx(nt,{label:"Event (optional)",placeholder:"Search event"}),i.jsx(nt,{label:"Refund Amount",placeholder:""}),i.jsx(nt,{label:"Reason",placeholder:"Event cancelled / Technical issue / Gesture"}),i.jsx(dr,{label:"Additional Notes",rows:3,placeholder:"Context for support team"}),i.jsx("div",{className:"md:col-span-2",children:i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{variant:"secondary",children:"Preview Email"}),i.jsx(oe,{children:"Process Refund"})]})})]})]})]})}function XSe(){const[r,n]=O.useState("month"),[o,l]=O.useState({grossRevenue:0,netRevenue:0,platformCommission:0,creatorPayouts:0,avgEventRevenue:0,paidEventsCount:0,freeEventsCount:0,totalRefunds:0}),[u,m]=O.useState([]),[g,E]=O.useState([]),[y,x]=O.useState([]),[S,C]=O.useState([]),[N,M]=O.useState(!1),G=R=>{const D=new Date,V=new Date(D);let W=new Date(D);switch(R){case"today":W.setHours(0,0,0,0);break;case"7days":W.setDate(W.getDate()-7);break;case"30days":W.setDate(W.getDate()-30);break;case"month":W=new Date(D.getFullYear(),D.getMonth(),1);break;case"all":W=new Date(2020,0,1);break}return{start:W,end:V}};O.useEffect(()=>{(async()=>{M(!0);try{const{start:D,end:V}=G(r),{data:W}=await ie.from("bids").select("id, event_id, amount, status, created_at").gte("created_at",D.toISOString()).lte("created_at",V.toISOString()),q=Array.from(new Set((W??[]).map(Oe=>Oe.event_id))),{data:H}=q.length?await ie.from("events").select("id, creator_id, base_price, duration_minutes, is_paid, created_at").in("id",q):{data:[]},J=new Map;for(const Oe of H??[])J.set(Oe.id,Oe);const{data:ee}=await ie.from("events").select("id, is_paid, created_at").gte("created_at",D.toISOString()).lte("created_at",V.toISOString()),ne=(ee??[]).filter(Oe=>Oe.is_paid!==!1).length,pe=(ee??[]).filter(Oe=>Oe.is_paid===!1).length,Ee=Array.from(new Set((H??[]).map(Oe=>Oe.creator_id))),{data:ge}=Ee.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Ee):{data:[]},he=new Map;for(const Oe of ge??[])he.set(Oe.user_id,Oe.display_name||Oe.username||"Creator");const le=(W??[]).filter(Oe=>Oe.status==="won"),Le=(W??[]).filter(Oe=>Oe.status==="lost"),fe=[...le,...Le].reduce((Oe,qe)=>Oe+(qe.amount??0),0),ae=Math.floor(fe*.1),be=Le.reduce((Oe,qe)=>Oe+Math.floor((qe.amount??0)*.9),0),We=le.reduce((Oe,qe)=>Oe+Math.floor((qe.amount??0)*.9),0),it=fe,Ge=ae,pt=q.length>0?it/q.length:0;l({grossRevenue:it,netRevenue:Ge,platformCommission:ae,creatorPayouts:We,avgEventRevenue:pt,paidEventsCount:ne,freeEventsCount:pe,totalRefunds:be});const Ze=new Map;for(const Oe of W??[]){const qe=new Date(Oe.created_at).toLocaleDateString("en-IN",{month:"short",day:"numeric"}),Ct=Ze.get(qe)??{date:qe,eventsCount:0,bidsCount:0,revenue:0,commission:0,refunds:0};Ct.bidsCount++,Oe.status==="won"?(Ct.revenue+=Oe.amount??0,Ct.commission+=Math.floor((Oe.amount??0)*.1)):Oe.status==="lost"&&(Ct.refunds+=Math.floor((Oe.amount??0)*.9),Ct.commission+=Math.floor((Oe.amount??0)*.1)),Ze.set(qe,Ct)}for(const Oe of ee??[]){const qe=new Date(Oe.created_at).toLocaleDateString("en-IN",{month:"short",day:"numeric"}),Ct=Ze.get(qe);Ct&&Ct.eventsCount++}m(Array.from(Ze.values()).slice(0,10));const Me=new Map;for(const Oe of le){const qe=J.get(Oe.event_id);if(!qe)continue;const Ct=Me.get(qe.creator_id)??0;Me.set(qe.creator_id,Ct+(Oe.amount??0))}const Ue=Array.from(Me.entries()).map(([Oe,qe])=>({creatorId:Oe,name:he.get(Oe)??"Unknown",revenue:qe})).sort((Oe,qe)=>qe.revenue-Oe.revenue).slice(0,5);E(Ue);const ke=new Map;for(const Oe of le){const qe=J.get(Oe.event_id);if(!qe)continue;const Ct=(qe.base_price??0)<=50?"Paid Events  50 Base":(qe.base_price??0)<=100?"Paid Events  100 Base":"Paid Events  100+ Base";ke.set(Ct,(ke.get(Ct)??0)+(Oe.amount??0))}const Ie=Array.from(ke.entries()).map(([Oe,qe])=>({type:Oe,revenue:qe,percent:it>0?qe/it*100:0})).sort((Oe,qe)=>qe.revenue-Oe.revenue);x(Ie);const Xe=new Map;for(const Oe of le){const qe=J.get(Oe.event_id);if(!qe)continue;const Ct=(qe.duration_minutes??5)<=5?"5-minute events":(qe.duration_minutes??5)<=10?"10-minute events":"15+ minute events";Xe.set(Ct,(Xe.get(Ct)??0)+(Oe.amount??0))}const ye=Array.from(Xe.entries()).map(([Oe,qe])=>({duration:Oe,revenue:qe,percent:it>0?qe/it*100:0})).sort((Oe,qe)=>qe.revenue-Oe.revenue);C(ye)}finally{M(!1)}})()},[r]);const I=o.paidEventsCount+o.freeEventsCount,P=I>0?Math.round(o.paidEventsCount/I*100):0,L=I>0?Math.round(o.freeEventsCount/I*100):0;return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Revenue Analytics"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Monitor revenue flows, commission, and payouts with configurable time ranges."})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"today",label:"Today"},{key:"7days",label:"Last 7 Days"},{key:"30days",label:"Last 30 Days"},{key:"month",label:"This Month"},{key:"all",label:"All Time"}].map(R=>i.jsx(oe,{size:"sm",variant:r===R.key?"secondary":"ghost",onClick:()=>n(R.key),children:R.label},R.key))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Summary",subtitle:"Key financial metrics for the selected range."}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Gross Revenue"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Be(o.grossRevenue)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Net Revenue"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Be(o.netRevenue)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Platform Commission"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#28A745]",children:Be(o.platformCommission)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Creator Payouts"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Be(o.creatorPayouts)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Avg Event Revenue"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Be(o.avgEventRevenue)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Paid Events"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:[o.paidEventsCount," (",P,"%)"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Free Events"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:[o.freeEventsCount," (",L,"%)"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunds"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#DC3545]",children:Be(o.totalRefunds)})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Revenue Breakdown",subtitle:"Analyze by event type, duration, and top creators."}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Revenue by Event Type"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[y.length===0&&i.jsx("li",{children:"No data"}),y.map(R=>i.jsxs("li",{children:[R.type,"  ",R.percent.toFixed(0),"% (",Be(R.revenue),")"]},R.type))]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Top Revenue Creators"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[g.length===0&&i.jsx("li",{children:"No data"}),g.map(R=>i.jsxs("li",{children:[R.name,"  ",Be(R.revenue)]},R.creatorId))]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:"Revenue by Duration"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[S.length===0&&i.jsx("li",{children:"No data"}),S.map(R=>i.jsxs("li",{children:[R.duration,"  ",R.percent.toFixed(0),"% (",Be(R.revenue),")"]},R.duration))]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Revenue by Date",subtitle:"Daily breakdown for reporting."}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Date"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Revenue"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Commission"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Refunds"})]})}),i.jsxs("tbody",{children:[u.map(R=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:R.date}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:R.eventsCount}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:R.bidsCount}),i.jsx("td",{className:"py-3 text-[#212529]",children:Be(R.revenue)}),i.jsx("td",{className:"py-3 text-[#28A745]",children:Be(R.commission)}),i.jsx("td",{className:"py-3 text-[#DC3545]",children:Be(R.refunds)})]},R.date)),u.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-8 text-center text-[#6C757D]",children:N?"Loading...":"No revenue data available"})})]})]})})]})]})}function JSe(){const[r,n]=O.useState({total:0,fromWinners:0,fromNonWinners:0,eventsProcessed:0,avgPerEvent:0,yearlyProjection:0}),[o,l]=O.useState([]),[u,m]=O.useState([]),[g,E]=O.useState(!1);O.useEffect(()=>{(async()=>{E(!0);try{const{data:C}=await ie.from("bids").select("id, event_id, amount, status, created_at"),N=Array.from(new Set((C??[]).map(be=>be.event_id))),{data:M}=N.length?await ie.from("events").select("id, creator_id, base_price, status").in("id",N):{data:[]},G=new Map;for(const be of M??[])G.set(be.id,{creatorId:be.creator_id,basePrice:be.base_price??0});const I=Array.from(new Set((M??[]).map(be=>be.creator_id))),{data:P}=I.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",I):{data:[]},L=new Map;for(const be of P??[])L.set(be.user_id,be.display_name||be.username||"Creator");const R=(C??[]).filter(be=>be.status==="won"),D=(C??[]).filter(be=>be.status==="lost"),V=R.reduce((be,We)=>be+Math.floor((We.amount??0)*.1),0),W=D.reduce((be,We)=>be+Math.floor((We.amount??0)*.1),0),q=V+W,J=(M??[]).filter(be=>be.status==="completed").length||N.length,ee=J>0?q/J:0,ne=new Date,pe=new Date(ne.getFullYear(),ne.getMonth()+1,0).getDate(),Ee=ne.getDate(),he=(Ee>0?q/Ee*pe:q)*12;n({total:q,fromWinners:V,fromNonWinners:W,eventsProcessed:J,avgPerEvent:ee,yearlyProjection:he});const le=new Map;for(const be of C??[]){const We=G.get(be.event_id);if(!We)continue;const{creatorId:it}=We,Ge=le.get(it)??{events:new Set,revenue:0,commission:0};Ge.events.add(be.event_id),be.status==="won"?(Ge.revenue+=be.amount??0,Ge.commission+=Math.floor((be.amount??0)*.1)):be.status==="lost"&&(Ge.commission+=Math.floor((be.amount??0)*.1)),le.set(it,Ge)}const Le=Array.from(le.entries()).map(([be,We])=>({creatorId:be,creatorName:L.get(be)??"Unknown",eventsCount:We.events.size,totalRevenue:We.revenue,commission:We.commission,sharePercent:q>0?We.commission/q*100:0})).sort((be,We)=>We.commission-be.commission).slice(0,10);l(Le);const fe=new Map;for(const be of C??[]){if(be.status!=="won"&&be.status!=="lost")continue;const We=G.get(be.event_id);if(!We)continue;const it=We.basePrice<=50?"50 Base":We.basePrice<=100?"100 Base":"100+ Base",Ge=fe.get(it)??{commission:0};Ge.commission+=Math.floor((be.amount??0)*.1),fe.set(it,Ge)}const ae=Array.from(fe.entries()).map(([be,We])=>({basePrice:be,commission:We.commission,sharePercent:q>0?We.commission/q*100:0})).sort((be,We)=>We.commission-be.commission);m(ae)}finally{E(!1)}})()},[]);const y=r.total>0?Math.round(r.fromWinners/r.total*100):0,x=r.total>0?Math.round(r.fromNonWinners/r.total*100):0;return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Platform Commission"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Breakdown of commission collected across winners and non-winners plus projection insights."})]})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Summary",subtitle:"Current overview"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Commission"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#28A745]",children:Be(r.total)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"All event revenue combined"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"From Winners"}),i.jsxs("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:[Be(r.fromWinners)," (",y,"%)"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"10% cut from winning bids"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"From Non-winners"}),i.jsxs("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:[Be(r.fromNonWinners)," (",x,"%)"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Retained from 90% refunds"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Processed"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:r.eventsProcessed}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:["Average per event ",Be(r.avgPerEvent)]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Yearly Projection"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:Be(r.yearlyProjection)}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Based on current run rate"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Event Type Breakdown",subtitle:"Commission by pricing tier"}),i.jsxs(ve,{className:"space-y-3",children:[u.length===0&&!g&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No data available"}),u.map(S=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[i.jsx("span",{children:S.basePrice}),i.jsxs("span",{className:"text-[#6C757D]",children:[S.sharePercent.toFixed(1),"%"]}),i.jsx("span",{className:"font-semibold",children:Be(S.commission)})]},S.basePrice))]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Commission by Creator",subtitle:"Top contributors to platform revenue"}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Revenue"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Commission"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Share"})]})}),i.jsxs("tbody",{children:[o.map(S=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:S.creatorName}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:S.eventsCount}),i.jsx("td",{className:"py-3 text-[#212529]",children:Be(S.totalRevenue)}),i.jsx("td",{className:"py-3 font-semibold text-[#28A745]",children:Be(S.commission)}),i.jsxs("td",{className:"py-3 text-[#6C757D]",children:[S.sharePercent.toFixed(1),"%"]})]},S.creatorId)),o.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:g?"Loading...":"No commission data available"})})]})]})})]})]})}function QSe(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState([]),[g,E]=O.useState([]),[y,x]=O.useState(!1);return O.useEffect(()=>{(async()=>{x(!0);try{const{data:C}=await ie.from("users").select("id, role, created_at"),N=(C==null?void 0:C.length)??0,M=(C??[]).filter(ye=>ye.role==="fan").length,G=(C??[]).filter(ye=>ye.role==="creator").length,{data:I}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at"),P=(I==null?void 0:I.length)??0,L=(I??[]).filter(ye=>ye.status==="won"),R=new Set((I??[]).map(ye=>ye.fan_id)).size,D=P>0?(I??[]).reduce((ye,Oe)=>ye+(Oe.amount??0),0)/P:0,V=P>0?L.length/P*100:0,{data:W}=await ie.from("events").select("id, creator_id, status, base_price, is_paid, created_at"),q=(W==null?void 0:W.length)??0,H=(W??[]).filter(ye=>ye.status==="completed").length,J=q>0?H/q*100:0,{data:ee}=await ie.from("meets").select("id, status"),ne=(ee??[]).filter(ye=>ye.status==="completed").length,pe=L.reduce((ye,Oe)=>ye+(Oe.amount??0),0),Ee=M>0?pe/M:0,ge=N>0?R/N*100:0,he=new Date,le=new Date(he.getFullYear(),he.getMonth(),1),Le=new Date(he.getFullYear(),he.getMonth()-1,1),fe=new Date(he.getFullYear(),he.getMonth(),0),ae=(C??[]).filter(ye=>new Date(ye.created_at)>=le).length,be=(C??[]).filter(ye=>{const Oe=new Date(ye.created_at);return Oe>=Le&&Oe<=fe}).length,We=be>0?(ae-be)/be*100:0;n([{label:"Monthly Growth Rate",value:`${We>=0?"+":""}${We.toFixed(1)}%`,variant:We>=0?"success":"danger"},{label:"Conversion Rate",value:`${ge.toFixed(1)}%`,variant:ge>10?"success":"warning"},{label:"Avg Bid Amount",value:Be(D)},{label:"Win Rate",value:`${V.toFixed(1)}%`},{label:"Event Completion",value:`${J.toFixed(1)}%`,variant:J>90?"success":"warning"},{label:"ARPU",value:Be(Ee)},{label:"Total Revenue",value:Be(pe),variant:"success"},{label:"Active Creators",value:G.toString()}]),l([{stage:"Total Users",value:N,percentage:"100%"},{stage:"Fans (Potential Bidders)",value:M,percentage:N>0?`${(M/N*100).toFixed(1)}%`:"0%"},{stage:"Placed a Bid",value:R,percentage:N>0?`${(R/N*100).toFixed(1)}%`:"0%"},{stage:"Won an Event",value:L.length,percentage:N>0?`${(L.length/N*100).toFixed(1)}%`:"0%"},{stage:"Completed Meet",value:ne,percentage:N>0?`${(ne/N*100).toFixed(1)}%`:"0%"}]);const it=(W??[]).filter(ye=>(ye.base_price??0)<=50&&ye.is_paid!==!1),Ge=(W??[]).filter(ye=>(ye.base_price??0)>50&&(ye.base_price??0)<=100),pt=(W??[]).filter(ye=>ye.is_paid===!1),Ze=(ye,Oe)=>{const qe=ye.map(vt=>vt.id),Ct=(I??[]).filter(vt=>qe.includes(vt.event_id)),Ft=Ct.filter(vt=>vt.status==="won"),zt=ye.filter(vt=>vt.status==="completed").length;return{label:Oe,totalCreated:ye.length,avgParticipants:ye.length>0?Ct.length/ye.length:0,avgFinalBid:Ft.length>0?Ft.reduce((vt,ds)=>vt+(ds.amount??0),0)/Ft.length:0,completionRate:ye.length>0?zt/ye.length*100:0,avgCreatorRevenue:Ft.length>0?Ft.reduce((vt,ds)=>vt+(ds.amount??0),0)*.9/Ft.length:0}};m([Ze(it,"Paid Events (50 Base)"),Ze(Ge,"Paid Events (100 Base)"),Ze(pt,"Free Events")]);const{data:Me}=await ie.from("profiles").select("user_id, display_name, username"),Ue=new Map;for(const ye of Me??[])Ue.set(ye.user_id,ye.display_name||ye.username||"Creator");const ke=new Map;for(const ye of W??[])ke.set(ye.id,ye.creator_id);const Ie=new Map;for(const ye of L){const Oe=ke.get(ye.event_id);if(!Oe)continue;const qe=Ie.get(Oe)??{events:new Set,revenue:0};qe.events.add(ye.event_id),qe.revenue+=(ye.amount??0)*.9,Ie.set(Oe,qe)}const Xe=Array.from(Ie.entries()).map(([ye,Oe])=>({creatorId:ye,name:Ue.get(ye)??"Unknown",eventsCount:Oe.events.size,revenue:Oe.revenue})).sort((ye,Oe)=>Oe.revenue-ye.revenue).slice(0,5);E(Xe)}finally{x(!1)}})()},[]),i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Business Analytics"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"High-level KPIs, funnel health, and performance metrics."})]})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Key Performance Indicators",subtitle:"Current metrics overview"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[r.map(S=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:S.label}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:S.value}),S.variant&&i.jsx($e,{variant:S.variant,children:"Current"})]},S.label)),r.length===0&&y&&i.jsx("p",{className:"col-span-4 py-4 text-center text-sm text-[#6C757D]",children:"Loading..."})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Conversion Funnel",subtitle:"User journey from signup to completed meet"}),i.jsxs(ve,{className:"space-y-3",children:[o.map((S,C)=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm text-[#212529]",children:[i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-[#6C757D] text-xs text-white",children:C+1}),S.stage]}),i.jsx("span",{className:"text-[#6C757D]",children:S.percentage}),i.jsx("span",{className:"font-semibold",children:S.value.toLocaleString()})]},S.stage)),o.length===0&&!y&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:"No data available"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Event Performance",subtitle:"Compare paid vs free categories"}),i.jsx(ve,{className:"grid gap-4 md:grid-cols-3",children:u.map(S=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("h2",{className:"font-semibold",children:S.label}),i.jsxs("ul",{className:"mt-3 space-y-2 text-[#6C757D]",children:[i.jsxs("li",{children:["Total Created: ",i.jsx("strong",{children:S.totalCreated})]}),i.jsxs("li",{children:["Avg Participants: ",i.jsx("strong",{children:S.avgParticipants.toFixed(1)})]}),i.jsxs("li",{children:["Avg Final Bid: ",i.jsx("strong",{children:Be(S.avgFinalBid)})]}),i.jsxs("li",{children:["Completion: ",i.jsxs("strong",{children:[S.completionRate.toFixed(0),"%"]})]}),i.jsxs("li",{children:["Avg Creator Revenue: ",i.jsx("strong",{children:Be(S.avgCreatorRevenue)})]})]})]},S.label))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Top Creators by Revenue",subtitle:"Highest earning creators"}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rank"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Events"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Revenue"})]})}),i.jsxs("tbody",{children:[g.map((S,C)=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:i.jsxs($e,{variant:C===0?"success":C===1?"primary":"warning",children:["#",C+1]})}),i.jsx("td",{className:"py-3 text-[#212529]",children:S.name}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:S.eventsCount}),i.jsx("td",{className:"py-3 font-semibold text-[#28A745]",children:Be(S.revenue)})]},S.creatorId)),g.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:4,className:"py-8 text-center text-[#6C757D]",children:y?"Loading...":"No creator data available"})})]})]})})]})]})}function ZSe(){const[r,n]=O.useState({totalUsers:0,totalFans:0,totalCreators:0,activeLast24h:0,activeLast7d:0,activeLast30d:0,newUsersToday:0,newUsersThisWeek:0,newUsersThisMonth:0}),[o,l]=O.useState([]),[u,m]=O.useState({inactiveUsers:0,inactiveRate:"0%",usersNeverBid:0,usersNeverWon:0}),[g,E]=O.useState([]),[y,x]=O.useState(!1);O.useEffect(()=>{(async()=>{x(!0);try{const M=new Date,G=new Date(M.getFullYear(),M.getMonth(),M.getDate()),I=new Date(M.getTime()-7*24*60*60*1e3),P=new Date(M.getTime()-30*24*60*60*1e3),L=new Date(M.getFullYear(),M.getMonth(),1),{data:R}=await ie.from("users").select("id, role, created_at, account_status"),D=(R==null?void 0:R.length)??0,V=(R??[]).filter(ye=>ye.role==="fan").length,W=(R??[]).filter(ye=>ye.role==="creator").length,q=(R??[]).filter(ye=>new Date(ye.created_at)>=G).length,H=(R??[]).filter(ye=>new Date(ye.created_at)>=I).length,J=(R??[]).filter(ye=>new Date(ye.created_at)>=L).length,{data:ee}=await ie.from("bids").select("id, fan_id, amount, status, created_at"),ne=(ee??[]).filter(ye=>new Date(ye.created_at)>=G),pe=(ee??[]).filter(ye=>new Date(ye.created_at)>=I),Ee=(ee??[]).filter(ye=>new Date(ye.created_at)>=P),ge=new Set(ne.map(ye=>ye.fan_id)).size,he=new Set(pe.map(ye=>ye.fan_id)).size,le=new Set(Ee.map(ye=>ye.fan_id)).size;n({totalUsers:D,totalFans:V,totalCreators:W,activeLast24h:ge,activeLast7d:he,activeLast30d:le,newUsersToday:q,newUsersThisWeek:H,newUsersThisMonth:J});const Le=new Map;for(const ye of ee??[]){const Oe=Le.get(ye.fan_id)??{count:0,total:0,wins:0};Oe.count++,Oe.total+=ye.amount??0,ye.status==="won"&&Oe.wins++,Le.set(ye.fan_id,Oe)}const fe=(R??[]).filter(ye=>ye.role==="fan").map(ye=>ye.id),ae=fe.filter(ye=>Le.has(ye)),be=fe.length-ae.length,We=ae.filter(ye=>{var Oe;return(((Oe=Le.get(ye))==null?void 0:Oe.count)??0)>=5}),it=ae.filter(ye=>{var qe;const Oe=((qe=Le.get(ye))==null?void 0:qe.count)??0;return Oe>=2&&Oe<5}),Ge=ae.filter(ye=>{var qe;return(((qe=Le.get(ye))==null?void 0:qe.count)??0)===1}),pt=ae.filter(ye=>{var Oe;return(((Oe=Le.get(ye))==null?void 0:Oe.wins)??0)===0}).length,Ze=new Set(Ee.map(ye=>ye.fan_id)),Me=fe.filter(ye=>!Ze.has(ye)),Ue=fe.length>0?Me.length/fe.length*100:0;l([{name:"High Value Users",count:We.length,share:V>0?`${(We.length/V*100).toFixed(1)}%`:"0%",description:`5+ bids  Avg spend ${Be(We.reduce((ye,Oe)=>{var qe;return ye+(((qe=Le.get(Oe))==null?void 0:qe.total)??0)},0)/Math.max(We.length,1))}`,variant:"success"},{name:"Regular Users",count:it.length,share:V>0?`${(it.length/V*100).toFixed(1)}%`:"0%",description:`2-4 bids  Avg spend ${Be(it.reduce((ye,Oe)=>{var qe;return ye+(((qe=Le.get(Oe))==null?void 0:qe.total)??0)},0)/Math.max(it.length,1))}`,variant:"primary"},{name:"Occasional Users",count:Ge.length,share:V>0?`${(Ge.length/V*100).toFixed(1)}%`:"0%",description:`1 bid  Avg spend ${Be(Ge.reduce((ye,Oe)=>{var qe;return ye+(((qe=Le.get(Oe))==null?void 0:qe.total)??0)},0)/Math.max(Ge.length,1))}`,variant:"warning"},{name:"Inactive Users",count:Me.length,share:V>0?`${(Me.length/V*100).toFixed(1)}%`:"0%",description:"No activity in 30+ days  at-risk",variant:"danger"}]),m({inactiveUsers:Me.length,inactiveRate:`${Ue.toFixed(1)}%`,usersNeverBid:be,usersNeverWon:pt});const{data:ke}=await ie.from("profiles").select("user_id, display_name, username"),Ie=new Map;for(const ye of ke??[])Ie.set(ye.user_id,ye.display_name||ye.username||"Fan");const Xe=Array.from(Le.entries()).map(([ye,Oe])=>({fanId:ye,name:Ie.get(ye)??"Unknown",bidsCount:Oe.count,totalSpent:Oe.total,winsCount:Oe.wins})).sort((ye,Oe)=>Oe.totalSpent-ye.totalSpent).slice(0,5);E(Xe)}finally{x(!1)}})()},[]);const S=r.activeLast30d>0?(r.activeLast24h/r.activeLast30d*100).toFixed(1):"0",C=r.activeLast30d>0?(r.activeLast7d/r.activeLast30d*100).toFixed(1):"0";return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"User Analytics"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Understand who your users are and how they behave across the platform."})]})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"User Overview",subtitle:"Total user counts by role"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Users"}),i.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:r.totalUsers.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Fans"}),i.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:r.totalFans.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Creators"}),i.jsx("p",{className:"mt-2 text-2xl font-semibold text-[#212529]",children:r.totalCreators.toLocaleString()})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Activity Metrics",subtitle:"User engagement over different time periods"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Active Last 24h (DAU)"}),i.jsx("p",{className:"mt-2 text-lg font-semibold",children:r.activeLast24h.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Active Last 7 Days (WAU)"}),i.jsx("p",{className:"mt-2 text-lg font-semibold",children:r.activeLast7d.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Active Last 30 Days (MAU)"}),i.jsx("p",{className:"mt-2 text-lg font-semibold",children:r.activeLast30d.toLocaleString()})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"DAU/MAU Ratio"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold",children:[S,"%"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"WAU/MAU Ratio"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold",children:[C,"%"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"New Users This Month"}),i.jsx("p",{className:"mt-2 text-lg font-semibold",children:r.newUsersThisMonth.toLocaleString()})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"User Segments",subtitle:"Behavior-based clusters"}),i.jsx(ve,{className:"grid gap-4 md:grid-cols-2",children:o.map(N=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{className:"font-semibold",children:N.name}),i.jsxs($e,{variant:N.variant,children:[N.count," users (",N.share,")"]})]}),i.jsx("p",{className:"mt-3 text-[#6C757D]",children:N.description})]},N.name))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Churn & Risk Analysis",subtitle:"Keep an eye on at-risk users"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"Inactive Rate (30+ days)"}),i.jsx("p",{className:"text-3xl font-semibold text-[#DC3545]",children:u.inactiveRate}),i.jsxs("p",{className:"mt-3",children:["Inactive Users: ",i.jsx("strong",{children:u.inactiveUsers})]}),i.jsxs("p",{children:["Users Never Bid: ",i.jsx("strong",{children:u.usersNeverBid})]}),i.jsxs("p",{children:["Users Never Won: ",i.jsx("strong",{children:u.usersNeverWon})]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-[#6C757D]",children:"New User Growth"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-[#6C757D]",children:[i.jsxs("li",{className:"flex justify-between",children:[i.jsx("span",{children:"Today"}),i.jsxs($e,{variant:"success",children:["+",r.newUsersToday]})]}),i.jsxs("li",{className:"flex justify-between",children:[i.jsx("span",{children:"This Week"}),i.jsxs($e,{variant:"primary",children:["+",r.newUsersThisWeek]})]}),i.jsxs("li",{className:"flex justify-between",children:[i.jsx("span",{children:"This Month"}),i.jsxs($e,{variant:"warning",children:["+",r.newUsersThisMonth]})]})]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Top Fans by Spending",subtitle:"Most engaged users"}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rank"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Fan"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Total Spent"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Wins"})]})}),i.jsxs("tbody",{children:[g.map((N,M)=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3",children:i.jsxs($e,{variant:M===0?"success":M===1?"primary":"warning",children:["#",M+1]})}),i.jsx("td",{className:"py-3 text-[#212529]",children:N.name}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:N.bidsCount}),i.jsx("td",{className:"py-3 font-semibold text-[#212529]",children:Be(N.totalSpent)}),i.jsx("td",{className:"py-3",children:i.jsxs($e,{variant:N.winsCount>0?"success":"warning",children:[N.winsCount," wins"]})})]},N.fanId)),g.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:y?"Loading...":"No fan data available"})})]})]})})]})]})}function e0e(){var G;const[r,n]=O.useState("revenue"),[o,l]=O.useState("month"),[u,m]=O.useState({totalRevenue:0,totalCommission:0,totalRefunds:0,eventsCount:0,bidsCount:0,creatorsCount:0,withdrawalsCount:0}),[g,E]=O.useState(!1),[y,x]=O.useState(!1),S=I=>{const P=new Date,L=new Date(P);let R=new Date(P);switch(I){case"7days":R.setDate(R.getDate()-7);break;case"30days":R.setDate(R.getDate()-30);break;case"month":R=new Date(P.getFullYear(),P.getMonth(),1);break;case"all":R=new Date(2020,0,1);break}return{start:R,end:L}};O.useEffect(()=>{(async()=>{E(!0);try{const{start:P,end:L}=S(o),{data:R}=await ie.from("bids").select("amount, status, created_at").gte("created_at",P.toISOString()).lte("created_at",L.toISOString()),D=(R??[]).filter(Ee=>Ee.status==="won"),V=(R??[]).filter(Ee=>Ee.status==="lost"),W=[...D,...V].reduce((Ee,ge)=>Ee+(ge.amount??0),0),q=Math.floor(W*.1),H=q,J=V.reduce((Ee,ge)=>Ee+Math.floor((ge.amount??0)*.9),0),{data:ee}=await ie.from("events").select("id").gte("created_at",P.toISOString()).lte("created_at",L.toISOString()),{data:ne}=await ie.from("users").select("id").eq("role","creator"),{data:pe}=await ie.from("withdrawal_requests").select("id").gte("requested_at",P.toISOString()).lte("requested_at",L.toISOString());m({totalRevenue:H,totalCommission:q,totalRefunds:J,eventsCount:(ee==null?void 0:ee.length)??0,bidsCount:(R==null?void 0:R.length)??0,creatorsCount:(ne==null?void 0:ne.length)??0,withdrawalsCount:(pe==null?void 0:pe.length)??0})}finally{E(!1)}})()},[o]);const C=async()=>{x(!0);try{const{start:I,end:P}=S(o);let L="",R="";if(r==="revenue"||r==="bids"){const{data:q}=await ie.from("bids").select("id, event_id, fan_id, amount, status, created_at").gte("created_at",I.toISOString()).lte("created_at",P.toISOString()).order("created_at",{ascending:!1});L=`ID,Event ID,Fan ID,Amount,Status,Date
`;for(const H of q??[])L+=`${H.id},${H.event_id},${H.fan_id},${H.amount},${H.status},"${Mt(H.created_at)}"
`;R=`bids_report_${o}.csv`}else if(r==="events"){const{data:q}=await ie.from("events").select("id, creator_id, title, status, base_price, starts_at, created_at").gte("created_at",I.toISOString()).lte("created_at",P.toISOString()).order("created_at",{ascending:!1});L=`ID,Creator ID,Title,Status,Base Price,Starts At,Created At
`;for(const H of q??[])L+=`${H.id},${H.creator_id},"${H.title}",${H.status},${H.base_price},"${Mt(H.starts_at)}","${Mt(H.created_at)}"
`;R=`events_report_${o}.csv`}else if(r==="creators"){const{data:q}=await ie.from("profiles").select("user_id, display_name, username, category, created_at"),{data:H}=await ie.from("users").select("id, email").eq("role","creator"),J=new Map;for(const ee of H??[])J.set(ee.id,ee.email);L=`User ID,Display Name,Username,Email,Category,Created At
`;for(const ee of q??[]){const ne=J.get(ee.user_id)??"";ne&&(L+=`${ee.user_id},"${ee.display_name??""}",${ee.username??""},${ne},${ee.category??""},"${Mt(ee.created_at)}"
`)}R="creators_report.csv"}else if(r==="withdrawals"){const{data:q}=await ie.from("withdrawal_requests").select("id, creator_id, amount, destination, status, requested_at, processed_at").gte("requested_at",I.toISOString()).lte("requested_at",P.toISOString()).order("requested_at",{ascending:!1});L=`ID,Creator ID,Amount,Destination,Status,Requested At,Processed At
`;for(const H of q??[])L+=`${H.id},${H.creator_id},${H.amount},"${H.destination??""}",${H.status},"${Mt(H.requested_at)}","${H.processed_at?Mt(H.processed_at):""}"
`;R=`withdrawals_report_${o}.csv`}const D=new Blob([L],{type:"text/csv;charset=utf-8;"}),V=URL.createObjectURL(D),W=document.createElement("a");W.setAttribute("href",V),W.setAttribute("download",R),W.style.visibility="hidden",document.body.appendChild(W),W.click(),document.body.removeChild(W),alert(`Report exported: ${R}`)}finally{x(!1)}},N=[{key:"revenue",label:"Revenue Summary",icon:""},{key:"bids",label:"Bids Report",icon:""},{key:"events",label:"Events Report",icon:""},{key:"creators",label:"Creators Report",icon:""},{key:"withdrawals",label:"Withdrawals Report",icon:""}],M={"7days":"Last 7 Days","30days":"Last 30 Days",month:"This Month",all:"All Time"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Revenue Reports"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Generate and export financial reports from your platform data."})]})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Quick Stats",subtitle:`Overview for ${M[o]}`}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Revenue"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#212529]",children:Be(u.totalRevenue)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Platform Commission"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#28A745]",children:Be(u.totalCommission)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Total Refunds"}),i.jsx("p",{className:"mt-2 text-xl font-semibold text-[#DC3545]",children:Be(u.totalRefunds)})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Totals"}),i.jsxs("p",{className:"mt-2 text-sm text-[#212529]",children:[u.eventsCount," events  ",u.bidsCount," bids  ",u.creatorsCount," creators"]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Generate Report",subtitle:"Select report type and date range to export."}),i.jsxs(ve,{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("p",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Report Type"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(I=>i.jsxs(oe,{size:"sm",variant:r===I.key?"secondary":"ghost",onClick:()=>n(I.key),children:[I.icon," ",I.label]},I.key))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-2 text-sm font-semibold text-[#212529]",children:"Date Range"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:["7days","30days","month","all"].map(I=>i.jsx(oe,{size:"sm",variant:o===I?"secondary":"ghost",onClick:()=>l(I),children:M[I]},I))})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Report Configuration"}),i.jsxs("ul",{className:"mt-3 space-y-2 text-sm text-[#6C757D]",children:[i.jsxs("li",{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Report Type"}),i.jsx("span",{className:"font-medium text-[#212529]",children:(G=N.find(I=>I.key===r))==null?void 0:G.label})]}),i.jsxs("li",{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Date Range"}),i.jsx("span",{className:"font-medium text-[#212529]",children:M[o]})]}),i.jsxs("li",{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Format"}),i.jsx("span",{className:"font-medium text-[#212529]",children:"CSV"})]})]})]}),i.jsx(oe,{onClick:C,disabled:y||g,children:y?" Generating...":" Export CSV Report"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Available Reports",subtitle:"Quick export options for common reports."}),i.jsx(ve,{className:"space-y-3",children:N.map(I=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium text-[#212529]",children:[I.icon," ",I.label]}),i.jsxs("div",{className:"text-xs text-[#6C757D]",children:["Export ",I.key==="creators"?"all creators":`${M[o].toLowerCase()}`," data"]})]}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>{n(I.key),C()},disabled:y,children:"Export"})]},I.key))})]})]})}function t0e(){const[r,n]=O.useState({liveNow:0,eventsToday:0,eventsThisWeek:0,eventsThisMonth:0,completionRate:0,avgBidAmount:0,avgBidsPerEvent:0,totalRevenue:0}),[o,l]=O.useState([]),[u,m]=O.useState([]),[g,E]=O.useState([]),[y,x]=O.useState([]),[S,C]=O.useState(!1);O.useEffect(()=>{(async()=>{C(!0);try{const G=new Date,I=new Date(G.getFullYear(),G.getMonth(),G.getDate()),P=new Date(G.getTime()-7*24*60*60*1e3),L=new Date(G.getFullYear(),G.getMonth(),1),{data:R}=await ie.from("events").select("id, creator_id, title, status, category, base_price, starts_at, created_at"),D=(R==null?void 0:R.length)??0,V=(R??[]).filter(ke=>ke.status==="live").length,W=(R??[]).filter(ke=>new Date(ke.created_at)>=I).length,q=(R??[]).filter(ke=>new Date(ke.created_at)>=P).length,H=(R??[]).filter(ke=>new Date(ke.created_at)>=L).length,J=(R??[]).filter(ke=>ke.status==="completed").length,ee=D>0?J/D*100:0,{data:ne}=await ie.from("bids").select("id, event_id, amount, status"),pe=(ne==null?void 0:ne.length)??0,Ee=pe>0?(ne??[]).reduce((ke,Ie)=>ke+(Ie.amount??0),0)/pe:0,ge=D>0?pe/D:0,he=(ne??[]).filter(ke=>ke.status==="won"),le=he.reduce((ke,Ie)=>ke+(Ie.amount??0),0);n({liveNow:V,eventsToday:W,eventsThisWeek:q,eventsThisMonth:H,completionRate:ee,avgBidAmount:Ee,avgBidsPerEvent:ge,totalRevenue:le});const Le=new Map;for(const ke of R??[])Le.set(ke.status,(Le.get(ke.status)??0)+1);const fe=Array.from(Le.entries()).map(([ke,Ie])=>({status:ke,count:Ie,percentage:D>0?Ie/D*100:0})).sort((ke,Ie)=>Ie.count-ke.count);l(fe);const ae=new Map;for(const ke of R??[]){const Ie=ke.category||"general",Xe=ae.get(Ie)??{count:0,eventIds:[]};Xe.count++,Xe.eventIds.push(ke.id),ae.set(Ie,Xe)}const be=Array.from(ae.entries()).map(([ke,Ie])=>{const ye=he.filter(Oe=>Ie.eventIds.includes(Oe.event_id)).reduce((Oe,qe)=>Oe+(qe.amount??0),0);return{category:ke,count:Ie.count,revenue:ye}}).sort((ke,Ie)=>Ie.count-ke.count);m(be);const We=Array.from(new Set((R??[]).map(ke=>ke.creator_id))),{data:it}=We.length?await ie.from("profiles").select("user_id, display_name, username").in("user_id",We):{data:[]},Ge=new Map;for(const ke of it??[])Ge.set(ke.user_id,ke.display_name||ke.username||"Creator");const pt=new Map;for(const ke of ne??[]){const Ie=pt.get(ke.event_id)??{count:0,highest:0};Ie.count++,Ie.highest=Math.max(Ie.highest,ke.amount??0),pt.set(ke.event_id,Ie)}const Ze=(R??[]).map(ke=>{var Ie,Xe;return{id:ke.id,title:ke.title,creatorName:Ge.get(ke.creator_id)??"Unknown",bidsCount:((Ie=pt.get(ke.id))==null?void 0:Ie.count)??0,highestBid:((Xe=pt.get(ke.id))==null?void 0:Xe.highest)??0,status:ke.status}}),Me=[...Ze].sort((ke,Ie)=>Ie.bidsCount-ke.bidsCount).slice(0,5);E(Me);const Ue=[...Ze].sort((ke,Ie)=>{const Xe=(R??[]).find(Oe=>Oe.id===ke.id),ye=(R??[]).find(Oe=>Oe.id===Ie.id);return new Date((ye==null?void 0:ye.created_at)??0).getTime()-new Date((Xe==null?void 0:Xe.created_at)??0).getTime()}).slice(0,5);x(Ue)}finally{C(!1)}})()},[]);const N={live:"danger",upcoming:"primary",completed:"success",cancelled:"warning",draft:"warning"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Event Analytics"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Deep dive into event performance and engagement metrics."})]})}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Key Metrics",subtitle:"Real-time event snapshot"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Live Now"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#DC3545]",children:r.liveNow}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Currently active"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Events Today"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:r.eventsToday}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[r.eventsThisWeek," this week"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Completion Rate"}),i.jsxs("p",{className:"mt-2 text-lg font-semibold text-[#28A745]",children:[r.completionRate.toFixed(1),"%"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Events successfully completed"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Avg Bid Amount"}),i.jsx("p",{className:"mt-2 text-lg font-semibold text-[#212529]",children:Be(r.avgBidAmount)}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[r.avgBidsPerEvent.toFixed(1)," bids/event avg"]})]})]})]}),i.jsxs("div",{className:"grid gap-8 lg:grid-cols-2",children:[i.jsxs(me,{children:[i.jsx(Ce,{title:"Events by Status",subtitle:"Distribution across statuses"}),i.jsxs(ve,{className:"space-y-3",children:[o.map(M=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",children:[i.jsx("div",{className:"flex items-center gap-2",children:i.jsx($e,{variant:N[M.status]??"primary",children:M.status.charAt(0).toUpperCase()+M.status.slice(1)})}),i.jsxs("span",{className:"text-[#6C757D]",children:[M.percentage.toFixed(1),"%"]}),i.jsx("span",{className:"font-semibold text-[#212529]",children:M.count})]},M.status)),o.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:S?"Loading...":"No events data"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Events by Category",subtitle:"Revenue and count per category"}),i.jsxs(ve,{className:"space-y-3",children:[u.map(M=>i.jsxs("div",{className:"flex items-center justify-between rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",children:[i.jsx("span",{className:"text-[#212529] capitalize",children:M.category}),i.jsxs("span",{className:"text-[#6C757D]",children:[M.count," events"]}),i.jsx("span",{className:"font-semibold text-[#28A745]",children:Be(M.revenue)})]},M.category)),u.length===0&&i.jsx("p",{className:"py-4 text-center text-sm text-[#6C757D]",children:S?"Loading...":"No category data"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Top Events by Bids",subtitle:"Most popular events"}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Highest Bid"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),i.jsxs("tbody",{children:[g.map(M=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:M.title}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:M.creatorName}),i.jsx("td",{className:"py-3 font-semibold text-[#212529]",children:M.bidsCount}),i.jsx("td",{className:"py-3 text-[#28A745]",children:Be(M.highestBid)}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:N[M.status]??"primary",children:M.status})})]},M.id)),g.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:S?"Loading...":"No event data available"})})]})]})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Recent Events",subtitle:"Latest created events"}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Event"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Creator"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Bids"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"})]})}),i.jsx("tbody",{children:y.map(M=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529]",children:M.title}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:M.creatorName}),i.jsx("td",{className:"py-3 text-[#212529]",children:M.bidsCount}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:N[M.status]??"primary",children:M.status})})]},M.id))})]})})]})]})}const T7={login:"Login",logout:"Logout",signup:"Signup",event_created:"Event Created",event_updated:"Event Updated",event_cancelled:"Event Cancelled",event_completed:"Event Completed",bid_placed:"Bid Placed",bid_won:"Bid Won",bid_refunded:"Bid Refunded",withdrawal_requested:"Withdrawal Requested",withdrawal_approved:"Withdrawal Approved",withdrawal_rejected:"Withdrawal Rejected",user_suspended:"User Suspended",user_banned:"User Banned",user_unbanned:"User Unbanned",creator_approved:"Creator Approved",creator_rejected:"Creator Rejected",settings_updated:"Settings Updated",announcement_published:"Announcement Published",meet_scheduled:"Meet Scheduled",meet_completed:"Meet Completed",payment_processed:"Payment Processed",refund_processed:"Refund Processed",other:"Other"},s0e={system:"primary",admin:"danger",creator:"success",fan:"warning"};function r0e(){const[r,n]=O.useState([]),[o,l]=O.useState(!1),[u,m]=O.useState(""),[g,E]=O.useState(null),[y,x]=O.useState(null),S=async()=>{l(!0);try{let I=ie.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(100);g&&(I=I.eq("action_type",g)),y&&(I=I.eq("actor_type",y));const{data:P,error:L}=await I;if(L){console.error("Error fetching audit logs:",L),n([]);return}const R=(P??[]).map(D=>({id:D.id,actorId:D.actor_id,actorType:D.actor_type,actorName:D.actor_name,action:D.action,actionType:D.action_type,resourceType:D.resource_type,resourceId:D.resource_id,details:D.details,status:D.status,createdAt:D.created_at}));n(R)}finally{l(!1)}};O.useEffect(()=>{S()},[g,y]);const C=r.filter(I=>{var L;if(!u)return!0;const P=u.toLowerCase();return I.action.toLowerCase().includes(P)||I.id.toLowerCase().includes(P)||(((L=I.actorName)==null?void 0:L.toLowerCase().includes(P))??!1)}),N=["system","admin","creator","fan"],M={success:"success",warning:"warning",error:"danger"},G=()=>{const I=`ID,Time,Actor,Action,Type,Status
`+C.map(D=>`${D.id},"${Mt(D.createdAt)}","${D.actorName||D.actorType}","${D.action}",${D.actionType},${D.status}`).join(`
`),P=new Blob([I],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(P),R=document.createElement("a");R.setAttribute("href",L),R.setAttribute("download",`audit_logs_${new Date().toISOString().split("T")[0]}.csv`),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Audit Logs"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Immutable record of every critical action across the platform."})]}),i.jsx(oe,{variant:"secondary",onClick:G,children:" Export CSV"})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Filters",subtitle:"Filter logs by actor type and action type"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsx(nt,{label:"Search",placeholder:"ID, actor, action...",value:u,onChange:I=>m(I.target.value)}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Actor Type"}),i.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[i.jsx(oe,{size:"sm",variant:y===null?"secondary":"ghost",onClick:()=>x(null),children:"All"}),N.map(I=>i.jsx(oe,{size:"sm",variant:y===I?"secondary":"ghost",onClick:()=>x(I),children:I.charAt(0).toUpperCase()+I.slice(1)},I))]})]}),i.jsxs("div",{className:"md:col-span-2",children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Action Type"}),i.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[i.jsx(oe,{size:"sm",variant:g===null?"secondary":"ghost",onClick:()=>E(null),children:"All"}),["login","bid_placed","bid_won","bid_refunded","withdrawal_approved","event_created"].map(I=>i.jsx(oe,{size:"sm",variant:g===I?"secondary":"ghost",onClick:()=>E(I),children:T7[I]},I))]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Log Stream",subtitle:`${C.length} entries  Newest first`}),i.jsxs(ve,{className:"space-y-4",children:[C.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:o?"Loading logs...":"No audit logs found. Actions will appear here as they occur."}),C.map(I=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[i.jsx("div",{className:"font-semibold",children:I.action}),i.jsx($e,{variant:M[I.status]??"primary",children:I.status.charAt(0).toUpperCase()+I.status.slice(1)})]}),i.jsxs("p",{className:"mt-2 text-[#6C757D]",children:[Mt(I.createdAt)," "," ",i.jsx($e,{variant:s0e[I.actorType]??"primary",children:I.actorType}),I.actorName&&`  ${I.actorName}`]}),I.details&&Object.keys(I.details).length>0&&i.jsxs("p",{className:"mt-2 text-xs text-[#6C757D]",children:[JSON.stringify(I.details).slice(0,200),JSON.stringify(I.details).length>200&&"..."]}),i.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:[i.jsx($e,{variant:"primary",children:T7[I.actionType]??I.actionType}),I.resourceType&&i.jsx($e,{variant:"warning",children:I.resourceType})]})]},I.id))]})]})]})}const n0e=[{label:"All",value:"all"},{label:" Overdue",value:"overdue"},{label:"Open",value:"open"},{label:"In Progress",value:"in_progress"},{label:"Resolved",value:"resolved"},{label:"Closed",value:"closed"}],N7={open:"primary",in_progress:"warning",resolved:"success",closed:"danger"},i0e=(r,n,o)=>{if(o==="resolved"||o==="closed"||n)return!1;const l=new Date(r);return(new Date().getTime()-l.getTime())/(1e3*60*60)>=24};function a0e(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState([]),[m,g]=O.useState(!1),[E,y]=O.useState(""),[x,S]=O.useState("all"),[C,N]=O.useState(null),[M,G]=O.useState(""),[I,P]=O.useState(!1);O.useEffect(()=>{(async()=>{g(!0);try{const{data:q,error:H}=await ie.from("support_tickets").select("id, subject, description, status, created_at, updated_at, first_response_at, users:user_id (email, role, display_name)").order("created_at",{ascending:!0});if(H||!q){console.error("Error fetching support tickets:",H),o([]);return}const J=q.map(ee=>{const ne=ee.users,pe=(ne==null?void 0:ne.display_name)||(ne!=null&&ne.email?ne.email.split("@")[0]:"User"),Ee=i0e(ee.created_at,ee.first_response_at,ee.status);return{id:ee.id,subject:ee.subject,description:ee.description,status:ee.status,createdAt:ee.created_at,updatedAt:ee.updated_at,firstResponseAt:ee.first_response_at,userName:pe,userEmail:(ne==null?void 0:ne.email)??"",userRole:(ne==null?void 0:ne.role)??"",isOverdue:Ee}});J.sort((ee,ne)=>ee.isOverdue&&!ne.isOverdue?-1:!ee.isOverdue&&ne.isOverdue?1:new Date(ee.createdAt).getTime()-new Date(ne.createdAt).getTime()),o(J),J.length>0&&!C&&N(J[0].id)}finally{g(!1)}})()},[]),O.useEffect(()=>{(async()=>{if(!C){u([]);return}const{data:q,error:H}=await ie.from("ticket_replies").select("id, message, is_admin_reply, created_at, user_id").eq("ticket_id",C).order("created_at",{ascending:!0});if(H||!q){console.error("Error fetching replies:",H),u([]);return}const J=[...new Set(q.map(ne=>ne.user_id).filter(Boolean))];let ee={};if(J.length>0){const{data:ne}=await ie.from("users").select("id, display_name, email").in("id",J);ne&&(ee=Object.fromEntries(ne.map(pe=>{var Ee;return[pe.id,pe.display_name||((Ee=pe.email)==null?void 0:Ee.split("@")[0])||"User"]})))}u(q.map(ne=>({id:ne.id,message:ne.message,isAdminReply:ne.is_admin_reply,createdAt:ne.created_at,userName:ne.is_admin_reply?"Support Team":ee[ne.user_id]||"User"})))})()},[C]);const L=O.useMemo(()=>{const W=E.trim().toLowerCase();return n.filter(q=>{if(x==="overdue"){if(!q.isOverdue)return!1}else if(x!=="all"&&q.status!==x)return!1;return W?q.subject.toLowerCase().includes(W)||q.userName.toLowerCase().includes(W)||q.userEmail.toLowerCase().includes(W)||q.id.toLowerCase().includes(W):!0})},[n,E,x]),R=async()=>{if(!r||!C||!M.trim()){alert("Please enter a reply message.");return}P(!0);try{const{error:W}=await ie.from("ticket_replies").insert({ticket_id:C,user_id:r.id,message:M.trim(),is_admin_reply:!0});if(W){console.error("Error sending reply:",W),alert("Failed to send reply.");return}const q=n.find(H=>H.id===C);q&&!q.firstResponseAt&&(await ie.from("support_tickets").update({first_response_at:new Date().toISOString(),status:q.status==="open"?"in_progress":q.status}).eq("id",C),o(H=>H.map(J=>J.id===C?{...J,firstResponseAt:new Date().toISOString(),isOverdue:!1,status:J.status==="open"?"in_progress":J.status}:J))),u(H=>[...H,{id:`temp-${Date.now()}`,message:M.trim(),isAdminReply:!0,createdAt:new Date().toISOString(),userName:"Support Team"}]),G(""),alert("Reply sent successfully!")}finally{P(!1)}},D=O.useMemo(()=>n.find(W=>W.id===C)??null,[n,C]),V=async(W,q)=>{if(window.confirm(`Change status of ticket "${W.subject}" to ${q.replace("_"," ")}?`)){g(!0);try{const{error:J}=await ie.from("support_tickets").update({status:q}).eq("id",W.id);if(J){console.error("Error updating ticket:",J),alert("Failed to update ticket status.");return}o(ee=>ee.map(ne=>ne.id===W.id?{...ne,status:q}:ne))}finally{g(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Support Tickets"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Track customer issues, update their status, and maintain SLAs."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",disabled:!0,children:"View SLA Dashboard"}),i.jsx(oe,{disabled:!0,children:"Assign to Me"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Filters",subtitle:"Focus on critical tickets or specific owners."}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[i.jsx(nt,{label:"Search",placeholder:"Ticket ID, subject, user",value:E,onChange:W=>y(W.target.value)}),i.jsx(nt,{label:"Date Range",placeholder:"(coming soon)",disabled:!0}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:n0e.map(W=>i.jsx("button",{type:"button",className:`rounded-full border px-3 py-1 text-xs font-medium ${x===W.value?"border-[#C045FF] bg-[#F4E6FF] text-[#C045FF]":"border-[#E9ECEF] bg-white text-[#6C757D] hover:border-[#C045FF]/40"}`,onClick:()=>S(W.value),children:W.label},W.value))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Priority"}),i.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:[i.jsx($e,{variant:"danger",children:"Critical (coming soon)"}),i.jsx($e,{variant:"warning",children:"High (coming soon)"})]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Tickets",subtitle:"Oldest tickets shown first. Overdue tickets (24h+ no response) highlighted in red."}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Ticket"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"User"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Created"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"SLA"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[L.map(W=>i.jsxs("tr",{className:`border-b border-[#E9ECEF] ${W.isOverdue?"bg-red-50 hover:bg-red-100":C===W.id?"bg-[#F8F9FA]":""}`,children:[i.jsx("td",{className:"py-3 text-[#212529]",children:i.jsxs("button",{type:"button",className:"flex flex-col text-left",onClick:()=>N(W.id),children:[i.jsxs("div",{className:"flex items-center gap-2",children:[W.isOverdue&&i.jsx("span",{className:"text-red-500",children:""}),i.jsx("span",{className:"font-semibold",children:W.subject})]}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[W.id.slice(0,8),"..."]})]})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{children:W.userName}),i.jsx("span",{className:"text-xs",children:W.userEmail})]})}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:N7[W.status],children:W.status.replace("_"," ")})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:Mt(W.createdAt)}),i.jsx("td",{className:"py-3",children:W.isOverdue?i.jsx("span",{className:"font-semibold text-red-600",children:" OVERDUE"}):W.firstResponseAt?i.jsx("span",{className:"text-green-600",children:" Responded"}):i.jsx("span",{className:"text-yellow-600",children:"Awaiting"})}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[W.status!=="resolved"&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>V(W,"resolved"),children:"Mark Resolved"}),W.status!=="in_progress"&&W.status!=="resolved"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>V(W,"in_progress"),children:"In Progress"}),W.status!=="closed"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>V(W,"closed"),children:"Close"})]})})]},W.id)),L.length===0&&!m&&i.jsx("tr",{children:i.jsx("td",{colSpan:6,className:"py-6 text-center text-sm text-[#6C757D]",children:"No tickets match your filters."})})]})]})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Ticket Detail & Conversation",subtitle:"View ticket details and reply to the user."}),i.jsx(ve,{className:"flex flex-col gap-4",children:D?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[D.isOverdue&&i.jsx("span",{className:"text-red-500 text-lg",children:""}),i.jsx("h2",{className:"text-lg font-semibold",children:D.subject})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[D.isOverdue&&i.jsx($e,{variant:"danger",children:"OVERDUE 24h+"}),i.jsx($e,{variant:N7[D.status],children:D.status.replace("_"," ")})]})]}),i.jsxs("div",{className:"grid gap-2 text-[#6C757D] md:grid-cols-3",children:[i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"From:"})," ",D.userName," (",D.userEmail,")"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"Created:"})," ",Mt(D.createdAt)]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-semibold text-[#212529]",children:"Role:"})," ",D.userRole||"User"]})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Original Message"}),i.jsx("p",{className:"mt-2 whitespace-pre-line",children:D.description})]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6",children:[i.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-4",children:["Conversation (",l.length," ",l.length===1?"reply":"replies",")"]}),i.jsx("div",{className:"flex flex-col gap-3 max-h-[400px] overflow-y-auto",children:l.length===0?i.jsx("p",{className:"text-sm text-[#6C757D] text-center py-4",children:"No replies yet. Be the first to respond!"}):l.map(W=>i.jsxs("div",{className:`rounded-[12px] p-4 ${W.isAdminReply?"bg-[#F4E6FF] ml-8":"bg-[#F8F9FA] mr-8"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[i.jsxs("span",{className:`text-sm font-semibold ${W.isAdminReply?"text-[#C045FF]":"text-[#212529]"}`,children:[W.userName,W.isAdminReply&&" (Admin)"]}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:Mt(W.createdAt)})]}),i.jsx("p",{className:"text-sm text-[#212529] whitespace-pre-line",children:W.message})]},W.id))})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-6",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-3",children:"Send Reply"}),i.jsx(dr,{label:"",rows:4,placeholder:"Type your reply to the user...",value:M,onChange:W=>G(W.target.value)}),i.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[i.jsx(oe,{onClick:R,disabled:I||!M.trim(),children:I?"Sending...":"Send Reply"}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>D&&V(D,"resolved"),children:"Mark Resolved"}),i.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>D&&V(D,"in_progress"),children:"In Progress"}),i.jsx(oe,{variant:"danger",size:"sm",onClick:()=>D&&V(D,"closed"),children:"Close"})]})]})]}):i.jsx("p",{className:"text-sm text-[#6C757D] text-center py-8",children:"Select a ticket from the table above to view details and reply."})})]})]})}const o0e=["new","investigating","resolved","escalated","dismissed"];function c0e(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(null),[x,S]=O.useState(null),[C,N]=O.useState(""),M=async()=>{u(!0);try{const{data:R,error:D}=await ie.from("reports").select("*").order("created_at",{ascending:!1});if(D){console.error("Error fetching reports:",D);return}const V=new Set;for(const J of R??[])J.reporter_id&&V.add(J.reporter_id),J.reported_user_id&&V.add(J.reported_user_id);const{data:W}=V.size?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Array.from(V)):{data:[]},q=new Map;for(const J of W??[])q.set(J.user_id,J.display_name||J.username||"User");const H=(R??[]).map(J=>({id:J.id,reporterId:J.reporter_id,reporterName:q.get(J.reporter_id)??"System",reportedUserId:J.reported_user_id,reportedUserName:J.reported_user_id?q.get(J.reported_user_id)??"Unknown":null,reportedEventId:J.reported_event_id,reportType:J.report_type,resourceType:J.resource_type,title:J.title,description:J.description,severity:J.severity,status:J.status,createdAt:J.created_at}));o(H)}finally{u(!1)}};O.useEffect(()=>{M()},[]);const G=async(R,D)=>{if(window.confirm(`Update report status to "${D}"?`)){u(!0);try{const W={status:D,updated_at:new Date().toISOString()};(D==="resolved"||D==="dismissed")&&(W.resolved_at=new Date().toISOString(),W.resolved_by=r==null?void 0:r.id,C.trim()&&(W.resolution_notes=C.trim()));const{error:q}=await ie.from("reports").update(W).eq("id",R);if(q){console.error("Error updating report:",q),alert("Failed to update report");return}await M(),N(""),alert("Report updated successfully")}finally{u(!1)}}},I=n.filter(R=>{var D;if(E&&R.status!==E)return!1;if(m){const V=m.toLowerCase();return R.title.toLowerCase().includes(V)||R.reporterName.toLowerCase().includes(V)||(((D=R.reportedUserName)==null?void 0:D.toLowerCase().includes(V))??!1)||R.id.toLowerCase().includes(V)}return!0}),P={new:"primary",investigating:"warning",resolved:"success",escalated:"danger",dismissed:"warning"},L={low:"primary",medium:"warning",high:"warning",critical:"danger"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Reports & Flags"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Investigate community reports and moderate platform safety."})]}),i.jsxs($e,{variant:n.filter(R=>R.status==="new").length>0?"danger":"success",children:[n.filter(R=>R.status==="new").length," new reports"]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Filters",subtitle:"Narrow down by status or search"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Search",placeholder:"Report ID, title, reporter...",value:m,onChange:R=>g(R.target.value)}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{size:"sm",variant:E===null?"secondary":"ghost",onClick:()=>y(null),children:"All"}),o0e.map(R=>i.jsx(oe,{size:"sm",variant:E===R?"secondary":"ghost",onClick:()=>y(R),children:R.charAt(0).toUpperCase()+R.slice(1).replace("_"," ")},R))]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Flagged Items",subtitle:`${I.length} reports`}),i.jsxs(ve,{className:"space-y-4",children:[I.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No reports found"}),I.map(R=>i.jsxs("div",{className:`flex flex-col gap-4 rounded-[16px] border p-5 text-sm text-[#212529] ${(x==null?void 0:x.id)===R.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-[#F8F9FA]"}`,onClick:()=>S(R),children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold",children:R.title}),i.jsxs("p",{className:"text-[#6C757D]",children:[R.resourceType,"  ",R.reportType]})]}),i.jsx($e,{variant:P[R.status]??"primary",children:R.status.replace("_"," ")})]}),i.jsxs("div",{className:"grid gap-3 md:grid-cols-3 text-[#6C757D]",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Reporter"}),i.jsx("p",{children:R.reporterName})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Reported"}),i.jsx("p",{children:R.reportedUserName||"N/A"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Submitted"}),i.jsx("p",{children:Mt(R.createdAt)})]})]}),R.description&&i.jsx("p",{className:"text-[#6C757D]",children:R.description}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx($e,{variant:L[R.severity]??"primary",children:R.severity}),R.status==="new"&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>G(R.id,"investigating"),children:"Investigate"}),R.status==="investigating"&&i.jsxs(i.Fragment,{children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>G(R.id,"escalated"),children:"Escalate"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>G(R.id,"resolved"),children:"Resolve"})]}),R.status!=="resolved"&&R.status!=="dismissed"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>G(R.id,"dismissed"),children:"Dismiss"})]})]},R.id))]})]}),x&&i.jsxs(me,{children:[i.jsx(Ce,{title:"Resolution Notes",subtitle:`For report: ${x.title}`}),i.jsxs(ve,{className:"space-y-4",children:[i.jsx(dr,{label:"Resolution Summary",rows:3,placeholder:"Explain action taken, evidence reviewed, outcome...",value:C,onChange:R=>N(R.target.value)}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>G(x.id,"resolved"),disabled:l,children:"Mark Resolved"}),i.jsx(oe,{variant:"ghost",onClick:()=>G(x.id,"escalated"),disabled:l,children:"Escalate"})]})]})]})]})}const l0e=["new","under_review","escalated","resolved","closed"];function d0e(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(null),[x,S]=O.useState(null),[C,N]=O.useState(""),M=async()=>{u(!0);try{const{data:R,error:D}=await ie.from("disputes").select("*").order("created_at",{ascending:!1});if(D){console.error("Error fetching disputes:",D);return}const V=new Set;for(const ne of R??[])V.add(ne.complainant_id),V.add(ne.respondent_id);const{data:W}=V.size?await ie.from("profiles").select("user_id, display_name, username").in("user_id",Array.from(V)):{data:[]},{data:q}=V.size?await ie.from("users").select("id, role").in("id",Array.from(V)):{data:[]},H=new Map,J=new Map;for(const ne of W??[])H.set(ne.user_id,ne.display_name||ne.username||"User");for(const ne of q??[])J.set(ne.id,ne.role);const ee=(R??[]).map(ne=>({id:ne.id,complainantId:ne.complainant_id,complainantName:`${J.get(ne.complainant_id)==="creator"?"Creator":"Fan"}  ${H.get(ne.complainant_id)??"Unknown"}`,respondentId:ne.respondent_id,respondentName:`${J.get(ne.respondent_id)==="creator"?"Creator":"Fan"}  ${H.get(ne.respondent_id)??"Unknown"}`,eventId:ne.event_id,disputeType:ne.dispute_type,title:ne.title,description:ne.description,amount:ne.amount??0,priority:ne.priority,status:ne.status,resolution:ne.resolution,createdAt:ne.created_at}));o(ee)}finally{u(!1)}};O.useEffect(()=>{M()},[]);const G=async(R,D)=>{if(window.confirm(`Update dispute status to "${D.replace("_"," ")}"?`)){u(!0);try{const W={status:D,updated_at:new Date().toISOString()};(D==="resolved"||D==="closed")&&(W.resolved_at=new Date().toISOString(),W.resolved_by=r==null?void 0:r.id,C.trim()&&(W.resolution=C.trim()));const{error:q}=await ie.from("disputes").update(W).eq("id",R);if(q){console.error("Error updating dispute:",q),alert("Failed to update dispute");return}await M(),N(""),alert("Dispute updated successfully")}finally{u(!1)}}},I=n.filter(R=>{if(E&&R.status!==E)return!1;if(m){const D=m.toLowerCase();return R.title.toLowerCase().includes(D)||R.complainantName.toLowerCase().includes(D)||R.respondentName.toLowerCase().includes(D)||R.id.toLowerCase().includes(D)}return!0}),P={new:"primary",under_review:"warning",escalated:"danger",resolved:"success",closed:"success"},L={low:"primary",medium:"warning",high:"warning",critical:"danger"};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Dispute Management"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Resolve conflicts between fans and creators fairly."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs($e,{variant:"warning",children:[n.filter(R=>R.status==="new"||R.status==="under_review").length," active"]}),i.jsxs($e,{variant:"danger",children:[n.filter(R=>R.status==="escalated").length," escalated"]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Filters",subtitle:"Identify disputes based on status"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Search",placeholder:"Dispute ID, title, names...",value:m,onChange:R=>g(R.target.value)}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{size:"sm",variant:E===null?"secondary":"ghost",onClick:()=>y(null),children:"All"}),l0e.map(R=>i.jsx(oe,{size:"sm",variant:E===R?"secondary":"ghost",onClick:()=>y(R),children:R.replace("_"," ")},R))]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Active Disputes",subtitle:`${I.length} disputes`}),i.jsx(ve,{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left text-sm",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Dispute"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Complainant"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Respondent"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Amount"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Priority"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Created"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[I.map(R=>i.jsxs("tr",{className:`border-b border-[#E9ECEF] cursor-pointer hover:bg-[#F8F9FA] ${(x==null?void 0:x.id)===R.id?"bg-[#F4E6FF]/30":""}`,onClick:()=>S(R),children:[i.jsx("td",{className:"py-3 text-[#212529]",children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"font-semibold",children:R.title}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:R.disputeType})]})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:R.complainantName}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:R.respondentName}),i.jsx("td",{className:"py-3 text-[#212529]",children:Be(R.amount)}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:P[R.status]??"primary",children:R.status.replace("_"," ")})}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:L[R.priority]??"primary",children:R.priority})}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:Mt(R.createdAt)}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[R.status==="new"&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:D=>{D.stopPropagation(),G(R.id,"under_review")},children:"Review"}),R.status==="under_review"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:D=>{D.stopPropagation(),G(R.id,"escalated")},children:"Escalate"}),R.status!=="resolved"&&R.status!=="closed"&&i.jsx(oe,{size:"sm",variant:"ghost",onClick:D=>{D.stopPropagation(),G(R.id,"resolved")},children:"Resolve"})]})})]},R.id)),I.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:8,className:"py-8 text-center text-[#6C757D]",children:l?"Loading...":"No disputes found"})})]})]})})]}),x&&i.jsxs(me,{children:[i.jsx(Ce,{title:"Dispute Detail",subtitle:x.title}),i.jsxs(ve,{className:"grid gap-4 lg:grid-cols-2",children:[i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-6 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[i.jsx($e,{variant:P[x.status]??"primary",children:x.status.replace("_"," ")}),i.jsx($e,{variant:L[x.priority]??"primary",children:x.priority}),i.jsx($e,{variant:"primary",children:x.disputeType})]}),i.jsxs("div",{className:"space-y-2 text-[#6C757D]",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Complainant:"})," ",x.complainantName]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Respondent:"})," ",x.respondentName]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Amount:"})," ",Be(x.amount)]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Created:"})," ",Mt(x.createdAt)]})]}),x.description&&i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold",children:"Description"}),i.jsx("p",{className:"text-[#6C757D]",children:x.description})]}),x.resolution&&i.jsxs("div",{className:"rounded-[12px] bg-white p-4",children:[i.jsx("p",{className:"font-semibold text-[#28A745]",children:"Resolution"}),i.jsx("p",{className:"text-[#6C757D]",children:x.resolution})]})]}),i.jsxs("div",{className:"space-y-4 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Resolution"}),i.jsx(dr,{label:"Decision & Outcome",rows:4,placeholder:"Describe resolution, compensation, actions taken...",value:C,onChange:R=>N(R.target.value)}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>G(x.id,"resolved"),disabled:l,children:"Mark Resolved"}),x.status!=="escalated"&&i.jsx(oe,{variant:"ghost",onClick:()=>G(x.id,"escalated"),disabled:l,children:"Escalate"}),i.jsx(oe,{variant:"ghost",onClick:()=>G(x.id,"closed"),disabled:l,children:"Close"})]})]})]})]})]})}function u0e(){const{user:r}=fs(),[n,o]=O.useState({platform_name:"FanMeet Five",support_email:"support@fanmeet.com",support_phone:"+91 98765 43210",default_timezone:"Asia/Kolkata",maintenance_mode:!1,welcome_message:"",default_commission:10,cancellation_window:12,auto_refund_percentage:90}),[l,u]=O.useState(!1),[m,g]=O.useState(!1);O.useEffect(()=>{(async()=>{u(!0);try{const{data:S,error:C}=await ie.from("platform_settings").select("key, value").in("key",["platform_name","support_email","support_phone","default_timezone","maintenance_mode","welcome_message","default_commission","cancellation_window","auto_refund_percentage"]);if(C){console.error("Error fetching settings:",C);return}const N={...n};for(const M of S??[])try{N[M.key]=JSON.parse(M.value)}catch{N[M.key]=M.value}o(N)}finally{u(!1)}})()},[]);const E=async()=>{g(!0);try{const x=Object.entries(n).map(([S,C])=>({key:S,value:JSON.stringify(C),updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}));for(const S of x){const{error:C}=await ie.from("platform_settings").update({value:S.value,updated_by:S.updated_by,updated_at:S.updated_at}).eq("key",S.key);C&&console.error("Error updating setting:",S.key,C)}alert("Settings saved successfully!")}finally{g(!1)}},y=async()=>{const x=!n.maintenance_mode;if(!window.confirm(`Are you sure you want to ${x?"enable":"disable"} maintenance mode?`))return;o({...n,maintenance_mode:x});const{error:C}=await ie.from("platform_settings").update({value:JSON.stringify(x),updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}).eq("key","maintenance_mode");C&&(console.error("Error toggling maintenance mode:",C),o({...n,maintenance_mode:!x}),alert("Failed to update maintenance mode"))};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"General Settings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Configure platform basics, support contacts, and global defaults."})]}),i.jsx(oe,{onClick:E,disabled:m,children:m?"Saving...":"Save Changes"})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Platform Info",subtitle:"Branding and contact details"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Platform Name",value:n.platform_name,onChange:x=>o({...n,platform_name:x.target.value})}),i.jsx(nt,{label:"Support Email",value:n.support_email,onChange:x=>o({...n,support_email:x.target.value})}),i.jsx(nt,{label:"Support Phone",value:n.support_phone,onChange:x=>o({...n,support_phone:x.target.value})}),i.jsx(nt,{label:"Default Timezone",value:n.default_timezone,onChange:x=>o({...n,default_timezone:x.target.value})}),i.jsx("div",{className:"md:col-span-2",children:i.jsx(dr,{label:"Welcome Message",rows:3,placeholder:"Displayed to new users",value:n.welcome_message,onChange:x=>o({...n,welcome_message:x.target.value})})})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Sessions & Commission",subtitle:"Monetization and scheduling settings"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Cancellation Window (hours)",type:"number",value:n.cancellation_window.toString(),onChange:x=>o({...n,cancellation_window:parseInt(x.target.value)||0})}),i.jsx(nt,{label:"Default Commission (%)",type:"number",value:n.default_commission.toString(),onChange:x=>o({...n,default_commission:parseInt(x.target.value)||0})}),i.jsx(nt,{label:"Auto Refund Percentage",type:"number",value:n.auto_refund_percentage.toString(),onChange:x=>o({...n,auto_refund_percentage:parseInt(x.target.value)||0})}),i.jsxs("div",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm font-semibold text-[#212529]",children:["Auto Refunds: ",n.auto_refund_percentage,"%"]}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:["Retain ",100-n.auto_refund_percentage,"% commission from non-winning bids"]})]}),i.jsx($e,{variant:"success",children:"Active"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Maintenance Mode",subtitle:"Temporarily pause user access during updates"}),i.jsxs(ve,{className:`flex flex-wrap items-center justify-between gap-4 rounded-[16px] border p-5 ${n.maintenance_mode?"border-[#DC3545] bg-[#DC3545]/10":"border-[#28A745] bg-[#28A745]/10"}`,children:[i.jsxs("div",{children:[i.jsxs("p",{className:`text-sm font-semibold ${n.maintenance_mode?"text-[#DC3545]":"text-[#28A745]"}`,children:["Maintenance mode is currently ",n.maintenance_mode?"ON":"OFF"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:n.maintenance_mode?"Users cannot access the platform. Disable to restore access.":"Platform is operational. Enable to block user access."})]}),i.jsx(oe,{variant:n.maintenance_mode?"secondary":"danger",onClick:y,children:n.maintenance_mode?"Disable Maintenance":"Enable Maintenance"})]})]})]})}function h0e(){const{user:r}=fs(),[n,o]=O.useState({default_commission:10,min_bid_increment:20,fast_payout_fee:20,auto_refund_percentage:90}),[l,u]=O.useState(!1),[m,g]=O.useState(!1),E=[{basePrice:50,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage},{basePrice:100,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage},{basePrice:200,commission:n.default_commission,creatorShare:0,autoRefund:n.auto_refund_percentage}].map(x=>({...x,creatorShare:x.basePrice*(1-x.commission/100)}));O.useEffect(()=>{(async()=>{u(!0);try{const{data:S,error:C}=await ie.from("platform_settings").select("key, value").in("key",["default_commission","min_bid_increment","fast_payout_fee","auto_refund_percentage"]);if(C){console.error("Error fetching settings:",C);return}const N={...n};for(const M of S??[])try{N[M.key]=JSON.parse(M.value)}catch{N[M.key]=M.value}o(N)}finally{u(!1)}})()},[]);const y=async()=>{g(!0);try{const x=Object.entries(n).map(([S,C])=>({key:S,value:JSON.stringify(C),updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}));for(const S of x){const{error:C}=await ie.from("platform_settings").update({value:S.value,updated_by:S.updated_by,updated_at:S.updated_at}).eq("key",S.key);C&&console.error("Error updating setting:",S.key,C)}alert("Pricing settings saved successfully!")}finally{g(!1)}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Pricing & Commission"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control base pricing, creator revenue share, and commission rates."})]}),i.jsx(oe,{onClick:y,disabled:m,children:m?"Saving...":"Save Changes"})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Commission Settings",subtitle:"Configure platform commission and fees"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Default Commission (%)",type:"number",value:n.default_commission.toString(),onChange:x=>o({...n,default_commission:parseInt(x.target.value)||0})}),i.jsx(nt,{label:"Auto Refund (%)",type:"number",value:n.auto_refund_percentage.toString(),onChange:x=>o({...n,auto_refund_percentage:parseInt(x.target.value)||0})}),i.jsx(nt,{label:"Minimum Bid Increment ()",type:"number",value:n.min_bid_increment.toString(),onChange:x=>o({...n,min_bid_increment:parseInt(x.target.value)||0})}),i.jsx(nt,{label:"Fast Payout Fee ()",type:"number",value:n.fast_payout_fee.toString(),onChange:x=>o({...n,fast_payout_fee:parseInt(x.target.value)||0})})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Revenue Split Preview",subtitle:"How revenue is divided based on current settings"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#C045FF]/30 bg-[#C045FF]/10 p-5 text-center",children:[i.jsxs("p",{className:"text-3xl font-bold text-[#C045FF]",children:[n.default_commission,"%"]}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Platform Commission"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-center",children:[i.jsxs("p",{className:"text-3xl font-bold text-[#28A745]",children:[100-n.default_commission,"%"]}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Creator Earnings"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#FFC107]/30 bg-[#FFC107]/10 p-5 text-center",children:[i.jsxs("p",{className:"text-3xl font-bold text-[#FFC107]",children:[n.auto_refund_percentage,"%"]}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Non-Winner Refund"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Pricing Tiers",subtitle:"Example pricing calculations based on current settings"}),i.jsx(ve,{className:"space-y-4",children:E.map(x=>i.jsxs("div",{className:"flex flex-col gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-lg font-semibold",children:[Be(x.basePrice)," Base Price"]}),i.jsx("p",{className:"text-[#6C757D]",children:"Entry-level pricing tier"})]}),i.jsxs($e,{variant:"primary",children:[x.commission,"% commission"]})]}),i.jsxs("div",{className:"grid gap-3 md:grid-cols-3 text-[#6C757D]",children:[i.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[i.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Creator Receives"}),i.jsx("p",{className:"text-lg font-semibold text-[#28A745]",children:Be(x.creatorShare)})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[i.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Platform Gets"}),i.jsx("p",{className:"text-lg font-semibold text-[#C045FF]",children:Be(x.basePrice-x.creatorShare)})]}),i.jsxs("div",{className:"rounded-[12px] bg-white p-3",children:[i.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Non-Winner Refund"}),i.jsx("p",{className:"text-lg font-semibold text-[#FFC107]",children:Be(x.basePrice*x.autoRefund/100)})]})]})]},x.basePrice))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Fee Structure",subtitle:"Current platform fees"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("p",{className:"font-semibold text-[#212529]",children:"Minimum Bid Increment"}),i.jsx("p",{className:"text-2xl font-bold text-[#C045FF]",children:Be(n.min_bid_increment)}),i.jsx("p",{className:"mt-2 text-xs text-[#6C757D]",children:"Minimum amount fans must increase their bids by"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5",children:[i.jsx("p",{className:"font-semibold text-[#212529]",children:"Fast Payout Fee"}),i.jsx("p",{className:"text-2xl font-bold text-[#C045FF]",children:Be(n.fast_payout_fee)}),i.jsx("p",{className:"mt-2 text-xs text-[#6C757D]",children:"Fee for instant withdrawal processing"})]})]})]})]})}const p0e=[{name:"{{fan_name}}",description:"Fan's first name"},{name:"{{creator_name}}",description:"Creator display name"},{name:"{{event_title}}",description:"Event name"},{name:"{{cta_link}}",description:"Primary button URL"},{name:"{{amount}}",description:"Currency amount"}];function m0e(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(null),[E,y]=O.useState(""),[x,S]=O.useState(""),[C,N]=O.useState(""),[M,G]=O.useState(""),[I,P]=O.useState(!1),L=async()=>{u(!0);try{const{data:q,error:H}=await ie.from("email_templates").select("*").order("created_at",{ascending:!1});if(H){console.error("Error fetching templates:",H);return}const J=(q??[]).map(ee=>({id:ee.id,name:ee.name,subject:ee.subject,body:ee.body,audience:ee.audience,status:ee.status,createdAt:ee.created_at,updatedAt:ee.updated_at}));o(J)}finally{u(!1)}};O.useEffect(()=>{L()},[]);const R=q=>{g(q),y(q.name),S(q.subject),N(q.body),G(q.audience),P(!1)},D=()=>{g(null),y(""),S(""),N(""),G("all"),P(!0)},V=async q=>{if(!E.trim()||!x.trim()){alert("Name and subject are required");return}u(!0);try{if(I){const{error:H}=await ie.from("email_templates").insert({name:E.trim(),subject:x.trim(),body:C.trim(),audience:M.trim()||"all",status:q,created_by:r==null?void 0:r.id,updated_by:r==null?void 0:r.id});if(H){console.error("Error creating template:",H),alert("Failed to create template");return}}else if(m){const{error:H}=await ie.from("email_templates").update({name:E.trim(),subject:x.trim(),body:C.trim(),audience:M.trim()||"all",status:q,updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}).eq("id",m.id);if(H){console.error("Error updating template:",H),alert("Failed to update template");return}}await L(),alert(`Template ${I?"created":"updated"} successfully!`),P(!1)}finally{u(!1)}},W=async q=>{if(!window.confirm("Are you sure you want to delete this template?"))return;const{error:J}=await ie.from("email_templates").delete().eq("id",q);if(J){console.error("Error deleting template:",J),alert("Failed to delete template");return}await L(),(m==null?void 0:m.id)===q&&g(null)};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Email Templates"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage transactional and lifecycle emails sent by FanMeet."})]}),i.jsx(oe,{onClick:D,children:"Create New Template"})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Templates",subtitle:`${n.length} templates`}),i.jsxs(ve,{className:"space-y-4",children:[n.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No templates yet. Create your first template."}),n.map(q=>i.jsxs("div",{className:`flex flex-col gap-4 rounded-[16px] border p-5 text-sm text-[#212529] cursor-pointer ${(m==null?void 0:m.id)===q.id?"border-[#C045FF] bg-[#F4E6FF]/30":"border-[#E9ECEF] bg-[#F8F9FA]"}`,onClick:()=>R(q),children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold",children:q.name}),i.jsxs("p",{className:"text-[#6C757D]",children:["Subject: ",q.subject]}),i.jsxs("p",{className:"text-xs text-[#ADB5BD]",children:["Audience: ",q.audience]})]}),i.jsx($e,{variant:q.status==="active"?"success":"warning",children:q.status})]}),i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-[#6C757D]",children:[i.jsxs("span",{children:["Last updated: ",Mt(q.updatedAt)]}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:H=>{H.stopPropagation(),W(q.id)},children:"Delete"})]})]},q.id))]})]}),(m||I)&&i.jsxs(me,{children:[i.jsx(Ce,{title:I?"New Template":"Edit Template",subtitle:I?"Create a new email template":m==null?void 0:m.name}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx(nt,{label:"Template Name",value:E,onChange:q=>y(q.target.value),placeholder:"e.g., Welcome Email"}),i.jsx(nt,{label:"Email Subject",value:x,onChange:q=>S(q.target.value),placeholder:"e.g., Welcome to FanMeet Five!"}),i.jsx(nt,{label:"Audience",value:M,onChange:q=>G(q.target.value),placeholder:"e.g., New fans, Creators"}),i.jsx(dr,{label:"Body",rows:10,value:C,onChange:q=>N(q.target.value),placeholder:`Hi {{fan_name}},

Thanks for joining...`}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>V("draft"),disabled:l,children:"Save Draft"}),i.jsx(oe,{onClick:()=>V("active"),disabled:l,children:"Publish"})]})]}),i.jsxs("div",{className:"space-y-3 rounded-[16px] border border-[#E9ECEF] bg-white p-6 text-sm text-[#212529]",children:[i.jsx("h2",{className:"text-sm font-semibold",children:"Available Snippets"}),i.jsx("ul",{className:"space-y-2 text-[#6C757D]",children:p0e.map(q=>i.jsxs("li",{className:"flex items-center justify-between",children:[i.jsx("code",{className:"bg-[#F8F9FA] px-2 py-1 rounded text-xs",children:q.name}),i.jsx("span",{className:"text-xs",children:q.description})]},q.name))}),i.jsxs("div",{className:"mt-4 rounded-[12px] bg-[#F8F9FA] p-4",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Preview"}),i.jsx("p",{className:"mt-2 whitespace-pre-line text-sm",children:C.replace("{{fan_name}}","Neha").replace("{{creator_name}}","Priya").replace("{{event_title}}","Live Chat Session").replace("{{cta_link}}","https://fanmeet.app").replace("{{amount}}","500")})]})]})]})]})]})}const f0e=[{id:"email",label:"Email",description:"Transactional and marketing emails",enabled:!0},{id:"push",label:"Push Notifications",description:"Mobile push via FanMeet app",enabled:!0},{id:"sms",label:"SMS",description:"Critical alerts and OTP delivery",enabled:!1},{id:"whatsapp",label:"WhatsApp",description:"High priority creator alerts",enabled:!1}],g0e=["bid_placed","bid_won","bid_refunded","event_created","event_cancelled","withdrawal_approved","withdrawal_rejected","meet_scheduled","meet_completed","support_ticket_update","dispute_escalated","creator_approved"];function _0e(){const[r,n]=O.useState([]),[o,l]=O.useState(f0e),[u,m]=O.useState(!1),[g,E]=O.useState(""),[y,x]=O.useState(["email"]),S=async()=>{m(!0);try{const{data:P,error:L}=await ie.from("notification_rules").select("*").order("trigger_event",{ascending:!0});if(L){console.error("Error fetching notification rules:",L);return}const R=(P??[]).map(D=>({id:D.id,triggerEvent:D.trigger_event,channels:D.channels??[],templateId:D.template_id,status:D.status}));n(R)}finally{m(!1)}};O.useEffect(()=>{S()},[]);const C=P=>{l(L=>L.map(R=>R.id===P?{...R,enabled:!R.enabled}:R))},N=async()=>{if(!g){alert("Select a trigger event");return}m(!0);try{const{error:P}=await ie.from("notification_rules").insert({trigger_event:g,channels:y,status:"active"});if(P){console.error("Error creating rule:",P),alert("Failed to create rule. It may already exist.");return}await S(),E(""),alert("Rule created successfully!")}finally{m(!1)}},M=async P=>{const L=P.status==="active"?"disabled":"active",{error:R}=await ie.from("notification_rules").update({status:L,updated_at:new Date().toISOString()}).eq("id",P.id);if(R){console.error("Error updating rule:",R),alert("Failed to update rule");return}await S()},G=async P=>{if(!window.confirm("Delete this notification rule?"))return;const{error:R}=await ie.from("notification_rules").delete().eq("id",P);if(R){console.error("Error deleting rule:",R),alert("Failed to delete rule");return}await S()},I=P=>P.split("_").map(L=>L.charAt(0).toUpperCase()+L.slice(1)).join(" ");return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Notification Settings"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control channels, templates, and delivery rules for platform alerts."})]}),i.jsxs($e,{variant:"primary",children:[r.length," rules configured"]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Channels",subtitle:"Enable or disable notification channels"}),i.jsx(ve,{className:"space-y-3",children:o.map(P=>i.jsxs("label",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529] cursor-pointer",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold",children:P.label}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:P.description})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($e,{variant:P.enabled?"success":"warning",children:P.enabled?"Enabled":"Disabled"}),i.jsx("input",{type:"checkbox",checked:P.enabled,onChange:()=>C(P.id),className:"h-5 w-5 rounded border-[#CED4DA]"})]})]},P.id))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Automated Rules",subtitle:"Template and channel mapping per trigger"}),i.jsx(ve,{className:"overflow-x-auto text-sm",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Trigger"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Channel(s)"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[r.map(P=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529] font-medium",children:I(P.triggerEvent)}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:P.channels.length>0?P.channels.join(", "):"-"}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:P.status==="active"?"success":"warning",children:P.status})}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>M(P),children:P.status==="active"?"Disable":"Enable"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>G(P.id),children:"Delete"})]})})]},P.id)),r.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:4,className:"py-8 text-center text-[#6C757D]",children:u?"Loading...":"No notification rules configured"})})]})]})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Add New Rule",subtitle:"Configure a new notification trigger"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Trigger Event"}),i.jsxs("select",{className:"w-full rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",value:g,onChange:P=>E(P.target.value),children:[i.jsx("option",{value:"",children:"Select trigger..."}),g0e.map(P=>i.jsx("option",{value:P,children:I(P)},P))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Channels"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:["email","push","sms"].map(P=>i.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[i.jsx("input",{type:"checkbox",checked:y.includes(P),onChange:L=>{L.target.checked?x([...y,P]):x(y.filter(R=>R!==P))}}),P.toUpperCase()]},P))})]}),i.jsx("div",{className:"md:col-span-2",children:i.jsx(oe,{onClick:N,disabled:u||!g,children:"Create Rule"})})]})]})]})}function v0e(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState({require_2fa:!0,session_timeout:45,password_min_length:12}),[m,g]=O.useState(!1),[E,y]=O.useState(!1);O.useEffect(()=>{(async()=>{g(!0);try{const{data:M}=await ie.from("users").select("id, email, role, created_at, account_status").eq("role","admin");if(M){const{data:I}=await ie.from("profiles").select("user_id, display_name").in("user_id",M.map(R=>R.id)),P=new Map;for(const R of I??[])P.set(R.user_id,R.display_name||"Admin");const L=M.map(R=>({id:R.id,email:R.email,displayName:P.get(R.id)??R.email.split("@")[0],createdAt:R.created_at,accountStatus:R.account_status??"active"}));o(L)}const{data:G}=await ie.from("platform_settings").select("key, value").in("key",["require_2fa","session_timeout","password_min_length"]);if(G){const I={...l};for(const P of G)try{I[P.key]=JSON.parse(P.value)}catch{I[P.key]=P.value}u(I)}}finally{g(!1)}})()},[]);const x=async()=>{y(!0);try{const N=[{key:"require_2fa",value:JSON.stringify(l.require_2fa)},{key:"session_timeout",value:JSON.stringify(l.session_timeout)},{key:"password_min_length",value:JSON.stringify(l.password_min_length)}];for(const M of N)await ie.from("platform_settings").update({value:M.value,updated_by:r==null?void 0:r.id,updated_at:new Date().toISOString()}).eq("key",M.key);alert("Security settings saved!")}finally{y(!1)}},S=async N=>{if(N===(r==null?void 0:r.id)){alert("You cannot suspend yourself");return}if(!window.confirm("Suspend this admin account?"))return;const{error:G}=await ie.from("users").update({account_status:"suspended"}).eq("id",N);if(G){console.error("Error suspending admin:",G),alert("Failed to suspend admin");return}o(I=>I.map(P=>P.id===N?{...P,accountStatus:"suspended"}:P))},C=async N=>{const{error:M}=await ie.from("users").update({account_status:"active"}).eq("id",N);if(M){console.error("Error reactivating admin:",M),alert("Failed to reactivate admin");return}o(G=>G.map(I=>I.id===N?{...I,accountStatus:"active"}:I))};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Security & Access"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Control admin access and authentication policies."})]}),i.jsx(oe,{onClick:x,disabled:E,children:E?"Saving...":"Save Changes"})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Access Policies",subtitle:"Security requirements for admin accounts"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Session Timeout (minutes)",type:"number",value:l.session_timeout.toString(),onChange:N=>u({...l,session_timeout:parseInt(N.target.value)||0})}),i.jsx(nt,{label:"Minimum Password Length",type:"number",value:l.password_min_length.toString(),onChange:N=>u({...l,password_min_length:parseInt(N.target.value)||8})}),i.jsxs("label",{className:"flex items-center justify-between rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 md:col-span-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-[#212529]",children:"Require 2FA for all admins"}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"Mandatory via authenticator app or SMS backup."})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($e,{variant:l.require_2fa?"success":"warning",children:l.require_2fa?"Enabled":"Disabled"}),i.jsx("input",{type:"checkbox",checked:l.require_2fa,onChange:N=>u({...l,require_2fa:N.target.checked}),className:"h-5 w-5 rounded border-[#CED4DA]"})]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Admin Users",subtitle:`${n.length} admin accounts`}),i.jsxs(ve,{className:"space-y-4",children:[n.map(N=>i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold",children:N.displayName}),i.jsx("p",{className:"text-[#6C757D]",children:N.email})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($e,{variant:N.accountStatus==="active"?"success":"danger",children:N.accountStatus}),N.id!==(r==null?void 0:r.id)&&(N.accountStatus==="active"?i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>S(N.id),children:"Suspend"}):i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>C(N.id),children:"Reactivate"})),N.id===(r==null?void 0:r.id)&&i.jsx($e,{variant:"primary",children:"You"})]})]},N.id)),n.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:m?"Loading...":"No admin users found"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Security Overview",subtitle:"Current security status"}),i.jsxs(ve,{className:"grid gap-3 md:grid-cols-3",children:[i.jsxs("div",{className:`rounded-[16px] border p-4 text-sm ${l.require_2fa?"border-[#28A745]/30 bg-[#28A745]/10 text-[#28A745]":"border-[#DC3545]/30 bg-[#DC3545]/10 text-[#DC3545]"}`,children:[i.jsx("p",{className:"font-semibold",children:"2FA Status"}),i.jsx("p",{className:"text-xs",children:l.require_2fa?"Required for all admins":"Not required - Enable for better security"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"font-semibold",children:"Session Timeout"}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[l.session_timeout," minutes"]})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-4 text-sm text-[#212529]",children:[i.jsx("p",{className:"font-semibold",children:"Active Admins"}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[n.filter(N=>N.accountStatus==="active").length," of ",n.length]})]})]})]})]})}function E0e(){const[r,n]=O.useState([]),[o,l]=O.useState(!1),[u,m]=O.useState(""),[g,E]=O.useState(null),y=async()=>{l(!0);try{let I=ie.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(100);g&&(I=I.eq("status",g));const{data:P,error:L}=await I;if(L){console.error("Error fetching logs:",L);return}const R=(P??[]).map(D=>({id:D.id,actorType:D.actor_type,actorName:D.actor_name,action:D.action,actionType:D.action_type,status:D.status,resourceType:D.resource_type,details:D.details,createdAt:D.created_at}));n(R)}finally{l(!1)}};O.useEffect(()=>{y()},[g]);const x=r.filter(I=>{var L;if(!u)return!0;const P=u.toLowerCase();return I.action.toLowerCase().includes(P)||I.actionType.toLowerCase().includes(P)||(((L=I.actorName)==null?void 0:L.toLowerCase().includes(P))??!1)}),S={success:"success",warning:"warning",error:"danger"},C=()=>{const I=`ID,Time,Actor,Action,Type,Status
`+x.map(D=>`${D.id},"${Mt(D.createdAt)}","${D.actorName||D.actorType}","${D.action}",${D.actionType},${D.status}`).join(`
`),P=new Blob([I],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(P),R=document.createElement("a");R.setAttribute("href",L),R.setAttribute("download",`system_logs_${new Date().toISOString().split("T")[0]}.csv`),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)},N=r.filter(I=>I.status==="error").length,M=r.filter(I=>I.status==="warning").length,G=r.filter(I=>I.status==="success").length;return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"System Logs"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Monitor platform activity and system health."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:C,children:"Download Logs"}),i.jsx(oe,{onClick:y,disabled:o,children:o?"Loading...":"Refresh"})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#212529]",children:r.length}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Total Logs"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#28A745]",children:G}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Success"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#FFC107]/30 bg-[#FFC107]/10 p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#FFC107]",children:M}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Warnings"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#DC3545]/30 bg-[#DC3545]/10 p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#DC3545]",children:N}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Errors"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Filters",subtitle:"Search and filter logs"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Search",placeholder:"Action, type, actor...",value:u,onChange:I=>m(I.target.value)}),i.jsxs("div",{children:[i.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Status"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(oe,{size:"sm",variant:g===null?"secondary":"ghost",onClick:()=>E(null),children:"All"}),i.jsx(oe,{size:"sm",variant:g==="success"?"secondary":"ghost",onClick:()=>E("success"),children:"Success"}),i.jsx(oe,{size:"sm",variant:g==="warning"?"secondary":"ghost",onClick:()=>E("warning"),children:"Warning"}),i.jsx(oe,{size:"sm",variant:g==="error"?"secondary":"ghost",onClick:()=>E("error"),children:"Error"})]})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Log Stream",subtitle:`${x.length} entries  Newest first`}),i.jsxs(ve,{className:"space-y-4",children:[x.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:o?"Loading logs...":"No logs found"}),x.map(I=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[i.jsx("div",{className:"font-semibold",children:I.action}),i.jsx($e,{variant:S[I.status]??"primary",children:I.status})]}),i.jsxs("p",{className:"mt-2 text-[#6C757D]",children:[Mt(I.createdAt),"  ",I.actorType,I.actorName&&`  ${I.actorName}`]}),I.details&&Object.keys(I.details).length>0&&i.jsxs("details",{className:"mt-2",children:[i.jsx("summary",{className:"cursor-pointer text-xs text-[#6C757D]",children:"View Details"}),i.jsx("pre",{className:"mt-2 overflow-x-auto rounded bg-white p-2 text-xs",children:JSON.stringify(I.details,null,2)})]}),i.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:[i.jsx($e,{variant:"primary",children:I.actionType}),I.resourceType&&i.jsx($e,{variant:"warning",children:I.resourceType})]})]},I.id))]})]})]})}const y0e=["suspend_users","ban_users","approve_withdrawals","send_notifications","update_status","delete_records","export_data","other"];function x0e(){const{user:r}=fs(),[n,o]=O.useState([]),[l,u]=O.useState(!1),[m,g]=O.useState(""),[E,y]=O.useState(""),[x,S]=O.useState("other"),[C,N]=O.useState(""),M=async()=>{u(!0);try{const{data:D,error:V}=await ie.from("bulk_actions").select("*").order("created_at",{ascending:!1});if(V){console.error("Error fetching bulk actions:",V);return}const W=new Set;for(const ee of D??[])ee.created_by&&W.add(ee.created_by);const{data:q}=W.size?await ie.from("profiles").select("user_id, display_name").in("user_id",Array.from(W)):{data:[]},H=new Map;for(const ee of q??[])H.set(ee.user_id,ee.display_name||"Admin");const J=(D??[]).map(ee=>({id:ee.id,title:ee.title,description:ee.description,actionType:ee.action_type,targetCriteria:ee.target_criteria,affectedCount:ee.affected_count??0,status:ee.status,notes:ee.notes,createdBy:ee.created_by,createdByName:H.get(ee.created_by)??"System",createdAt:ee.created_at}));o(J)}finally{u(!1)}};O.useEffect(()=>{M()},[]);const G=async D=>{if(!m.trim()){alert("Title is required");return}u(!0);try{let V=null;if(C.trim())try{V=JSON.parse(C)}catch{V={description:C}}const{error:W}=await ie.from("bulk_actions").insert({title:m.trim(),description:E.trim()||null,action_type:x,target_criteria:V,status:D,created_by:r==null?void 0:r.id});if(W){console.error("Error creating bulk action:",W),alert("Failed to create bulk action");return}await M(),g(""),y(""),N(""),alert(`Bulk action ${D==="pending"?"saved as draft":"submitted for approval"}!`)}finally{u(!1)}},I=async(D,V)=>{if(!window.confirm(`Update action status to "${V}"?`))return;const q={status:V,updated_at:new Date().toISOString()};V==="approved"&&(q.approved_by=r==null?void 0:r.id),V==="completed"&&(q.executed_at=new Date().toISOString());const{error:H}=await ie.from("bulk_actions").update(q).eq("id",D);if(H){console.error("Error updating bulk action:",H),alert("Failed to update action");return}await M()},P=async D=>{if(!window.confirm("Delete this bulk action?"))return;const{error:W}=await ie.from("bulk_actions").delete().eq("id",D);if(W){console.error("Error deleting bulk action:",W),alert("Failed to delete action");return}await M()},L={pending:"warning",approved:"primary",completed:"success",rejected:"danger",failed:"danger"},R=D=>D.split("_").map(V=>V.charAt(0).toUpperCase()+V.slice(1)).join(" ");return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Bulk Actions"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Execute large-scale updates safely with approval trails."})]}),i.jsxs($e,{variant:"primary",children:[n.filter(D=>D.status==="pending").length," pending"]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Active Actions",subtitle:`${n.length} bulk actions`}),i.jsxs(ve,{className:"space-y-4",children:[n.length===0&&i.jsx("p",{className:"py-8 text-center text-sm text-[#6C757D]",children:l?"Loading...":"No bulk actions created yet"}),n.map(D=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold",children:D.title}),i.jsxs("p",{className:"text-xs text-[#6C757D]",children:[D.createdByName,"  ",Mt(D.createdAt)]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($e,{variant:"primary",children:R(D.actionType)}),i.jsx($e,{variant:L[D.status]??"primary",children:D.status})]})]}),D.description&&i.jsx("p",{className:"mt-3 text-[#6C757D]",children:D.description}),D.notes&&i.jsxs("p",{className:"mt-2 text-xs text-[#ADB5BD]",children:["Notes: ",D.notes]}),i.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[D.status==="pending"&&i.jsxs(i.Fragment,{children:[i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>I(D.id,"approved"),children:"Approve"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>I(D.id,"rejected"),children:"Reject"})]}),D.status==="approved"&&i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>I(D.id,"completed"),children:"Mark Completed"}),i.jsx(oe,{size:"sm",variant:"ghost",onClick:()=>P(D.id),children:"Delete"})]})]},D.id))]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"New Bulk Action",subtitle:"Design and schedule batch operations"}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Action Title",placeholder:"e.g. Suspend flagged accounts",value:m,onChange:D=>g(D.target.value)}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold uppercase tracking-wide text-[#6C757D] mb-1",children:"Action Type"}),i.jsx("select",{className:"w-full rounded-[12px] border border-[#E9ECEF] bg-white px-4 py-3 text-sm",value:x,onChange:D=>S(D.target.value),children:y0e.map(D=>i.jsx("option",{value:D,children:R(D)},D))})]}),i.jsx(dr,{label:"Description",rows:3,placeholder:"Describe what this action will do...",value:E,onChange:D=>y(D.target.value)}),i.jsx(dr,{label:"Target Criteria (JSON or text)",rows:3,placeholder:'{"user_status": "flagged"} or plain text description',value:C,onChange:D=>N(D.target.value)}),i.jsxs("div",{className:"md:col-span-2 flex flex-wrap gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:()=>G("pending"),disabled:l,children:"Save Draft"}),i.jsx(oe,{onClick:()=>G("approved"),disabled:l,children:"Submit for Approval"})]})]})]})]})}function b0e(){const[r,n]=O.useState([]),[o,l]=O.useState({totalTables:0,totalRows:0,projectId:"iktldcrkyphkvxjwmxyb",region:"ap-south-1"}),[u,m]=O.useState(!1),[g,E]=O.useState(null),y=async()=>{m(!0);try{const C=["users","events","bids","meets","profiles","notifications","support_tickets","withdrawal_requests","wallet_transactions","reports","disputes","audit_logs","bulk_actions"],N=[];let M=0;for(const G of C){const{count:I,error:P}=await ie.from(G).select("*",{count:"exact",head:!0});if(!P){const L=I??0;M+=L,N.push({name:G,rowCount:L,size:`~${Math.max(1,Math.round(L*.5))} KB`})}}N.sort((G,I)=>I.rowCount-G.rowCount),n(N),l({totalTables:N.length,totalRows:M,projectId:"iktldcrkyphkvxjwmxyb",region:"ap-south-1"}),E(new Date)}finally{m(!1)}};O.useEffect(()=>{y()},[]);const x=async C=>{m(!0);try{const{data:N,error:M}=await ie.from(C).select("*").limit(1e3);if(M){alert(`Failed to export ${C}: ${M.message}`);return}const G=JSON.stringify(N,null,2),I=new Blob([G],{type:"application/json"}),P=URL.createObjectURL(I),L=document.createElement("a");L.setAttribute("href",P),L.setAttribute("download",`${C}_export_${new Date().toISOString().split("T")[0]}.json`),L.style.visibility="hidden",document.body.appendChild(L),L.click(),document.body.removeChild(L)}finally{m(!1)}},S=async()=>{if(window.confirm("Export all tables? This may take a moment.")){m(!0);try{const N={};for(const L of r){const{data:R}=await ie.from(L.name).select("*").limit(1e3);R&&(N[L.name]=R)}const M=JSON.stringify(N,null,2),G=new Blob([M],{type:"application/json"}),I=URL.createObjectURL(G),P=document.createElement("a");P.setAttribute("href",I),P.setAttribute("download",`full_database_export_${new Date().toISOString().split("T")[0]}.json`),P.style.visibility="hidden",document.body.appendChild(P),P.click(),document.body.removeChild(P),alert("Full database export completed!")}finally{m(!1)}}};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"Database Backup"}),i.jsxs("p",{className:"text-sm text-[#6C757D]",children:["View database statistics and export data.",g&&` Last refreshed: ${Mt(g.toISOString())}`]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",onClick:S,disabled:u,children:"Export All Tables"}),i.jsx(oe,{onClick:y,disabled:u,children:u?"Loading...":"Refresh Stats"})]})]}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#212529]",children:o.totalTables}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Tables"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsx("p",{className:"text-3xl font-bold text-[#C045FF]",children:o.totalRows.toLocaleString()}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Total Rows"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsxs("p",{className:"text-lg font-bold text-[#212529]",children:[o.projectId.slice(0,8),"..."]}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Project ID"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-center",children:[i.jsx("p",{className:"text-lg font-bold text-[#212529]",children:o.region}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Region"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Supabase Managed Backups",subtitle:"Automatic daily backups handled by Supabase"}),i.jsxs(ve,{className:"grid gap-3 md:grid-cols-3",children:[i.jsxs("div",{className:"rounded-[16px] border border-[#28A745]/30 bg-[#28A745]/10 p-5 text-sm",children:[i.jsx("p",{className:"font-semibold text-[#28A745]",children:"Daily Backups"}),i.jsx("p",{className:"mt-2 text-[#6C757D]",children:"Automatic daily point-in-time recovery enabled"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"font-semibold",children:"Retention"}),i.jsx("p",{className:"mt-2 text-[#6C757D]",children:"7 days (Free tier) / 30 days (Pro)"})]}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"font-semibold",children:"PITR"}),i.jsx("p",{className:"mt-2 text-[#6C757D]",children:"Point-in-time recovery available"})]})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Table Statistics",subtitle:`${r.length} tables  Export individual tables`}),i.jsx(ve,{className:"overflow-x-auto text-sm",children:i.jsxs("table",{className:"min-w-full table-auto border-collapse text-left",children:[i.jsx("thead",{className:"text-[#6C757D]",children:i.jsxs("tr",{children:[i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Table"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Rows"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Est. Size"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Status"}),i.jsx("th",{className:"border-b border-[#E9ECEF] py-3",children:"Actions"})]})}),i.jsxs("tbody",{children:[r.map(C=>i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsx("td",{className:"py-3 text-[#212529] font-medium",children:C.name}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:C.rowCount.toLocaleString()}),i.jsx("td",{className:"py-3 text-[#6C757D]",children:C.size}),i.jsx("td",{className:"py-3",children:i.jsx($e,{variant:"success",children:"Active"})}),i.jsx("td",{className:"py-3",children:i.jsx(oe,{size:"sm",variant:"secondary",onClick:()=>x(C.name),disabled:u,children:"Export JSON"})})]},C.name)),r.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"py-8 text-center text-[#6C757D]",children:u?"Loading table statistics...":"No tables found"})})]})]})})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Backup Notes",subtitle:"Important information about data protection"}),i.jsxs(ve,{className:"space-y-3 text-sm text-[#6C757D]",children:[i.jsxs("p",{children:[i.jsx("strong",{className:"text-[#212529]",children:"Automatic Backups:"})," Supabase automatically handles daily backups and point-in-time recovery. No manual intervention is needed for standard backup operations."]}),i.jsxs("p",{children:[i.jsx("strong",{className:"text-[#212529]",children:"Manual Exports:"})," Use the export buttons above to download JSON snapshots of individual tables or the entire database for local backups or data analysis."]}),i.jsxs("p",{children:[i.jsx("strong",{className:"text-[#212529]",children:"Restore:"})," To restore from a backup, contact Supabase support or use the Supabase Dashboard to access point-in-time recovery options."]})]})]})]})}const kd={name:"Megha Sharma",title:"Head of Operations",email:"megha@fanmeet.com",phone:"+91 98765 43210",role:"Super Admin",lastLogin:"Jan 12, 2025  10:15 AM IST",timezone:"Asia/Kolkata"},w0e=[{team:"Support Desk",scope:"Tickets, Reports",status:"Active",expires:"Feb 01, 2025"},{team:"Finance Ops",scope:"Withdrawals, Refunds",status:"Active",expires:"Mar 15, 2025"}],S0e=["Jan 12  Approved withdrawal batch WR-BATCH-24","Jan 12  Updated pricing tier 100 Base","Jan 11  Resolved dispute DSP-311","Jan 10  Published announcement ANN-210"];function C0e(){return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#1B1C1F]",children:"My Profile"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Manage your contact info, access, and delegated permissions."})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",children:"Download Activity Log"}),i.jsx(oe,{children:"Update Security"})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Personal Information",subtitle:"Visible to other admins."}),i.jsxs(ve,{className:"grid gap-4 md:grid-cols-2",children:[i.jsx(nt,{label:"Full Name",defaultValue:kd.name}),i.jsx(nt,{label:"Title",defaultValue:kd.title}),i.jsx(nt,{label:"Email",defaultValue:kd.email}),i.jsx(nt,{label:"Phone",defaultValue:kd.phone}),i.jsx(nt,{label:"Timezone",defaultValue:kd.timezone}),i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-[#F8F9FA] p-5",children:[i.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Role"}),i.jsx($e,{variant:"primary",className:"mt-3 w-fit",children:kd.role}),i.jsxs("p",{className:"mt-3 text-xs text-[#6C757D]",children:["Last login: ",kd.lastLogin]})]}),i.jsx("div",{className:"md:col-span-2",children:i.jsx(dr,{label:"Out of Office Message",rows:3,placeholder:"Optional note for delegating responsibilities."})})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Delegated Access",subtitle:"Teams that can act on your behalf."}),i.jsx(ve,{className:"grid gap-4 md:grid-cols-2",children:w0e.map(r=>i.jsxs("div",{className:"rounded-[16px] border border-[#E9ECEF] bg-white p-5 text-sm text-[#212529]",children:[i.jsx("p",{className:"text-lg font-semibold",children:r.team}),i.jsxs("p",{className:"mt-2 text-[#6C757D]",children:["Scope: ",r.scope]}),i.jsxs("p",{className:"text-xs text-[#ADB5BD]",children:["Expires: ",r.expires]}),i.jsx($e,{variant:"success",className:"mt-3 w-fit",children:r.status}),i.jsxs("div",{className:"mt-4 flex gap-2",children:[i.jsx(oe,{size:"sm",variant:"secondary",children:"Modify"}),i.jsx(oe,{size:"sm",variant:"ghost",children:"Revoke"})]})]},r.team))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Recent Activity",subtitle:"Latest actions performed under this account."}),i.jsx(ve,{children:i.jsx("ul",{className:"space-y-2 text-sm text-[#212529]",children:S0e.map(r=>i.jsxs("li",{className:"flex items-center gap-2 rounded-[12px] bg-[#F8F9FA] px-4 py-3",children:[i.jsx("span",{className:"text-[#C045FF]",children:""}),i.jsx("span",{children:r})]},r))})})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(oe,{variant:"secondary",children:"Save Changes"}),i.jsx(oe,{variant:"ghost",children:"Cancel"}),i.jsx(oe,{variant:"danger",children:"Deactivate Account"})]})]})}function T0e(){const[r,n]=O.useState([]),[o,l]=O.useState(new Map),[u,m]=O.useState(!0),g=async()=>{m(!0);const{data:x,error:S}=await ie.from("meets").select("*").order("created_at",{ascending:!1});if(S)console.error("Error fetching meets:",S);else{n(x||[]);const C=[...new Set((x==null?void 0:x.map(G=>G.creator_id))||[])],N=[...new Set((x==null?void 0:x.map(G=>G.fan_id))||[])],M=[...new Set([...C,...N])];if(M.length>0){const{data:G}=await ie.from("profiles").select("*").in("user_id",M),I=new Map((G==null?void 0:G.map(P=>[P.user_id,P]))||[]);l(I)}}m(!1)};O.useEffect(()=>{g()},[]);const E=async x=>{const{error:S}=await ie.from("meets").update({meeting_link:"https://meet.google.com/abc-defg-hij"}).eq("id",x);S?(console.error("Error updating meeting link:",S),alert("Failed to update meeting link")):(alert("Meeting link updated successfully!"),g())},y=async(x,S)=>{const{error:C}=await ie.from("meets").update({status:S}).eq("id",x);C?(console.error("Error updating status:",C),alert("Failed to update status")):(alert("Status updated successfully!"),g())};return u?i.jsx("div",{className:"p-8 text-center",children:"Loading..."}):i.jsxs("div",{className:"flex flex-col gap-8 p-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-semibold text-[#212529]",children:"Admin: Meets Debug"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"View and manage all meetings in the database"})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:`All Meets (${r.length})`}),i.jsx(ve,{className:"gap-4",children:r.length===0?i.jsx("p",{className:"text-sm text-[#6C757D]",children:"No meets found in database"}):i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-sm",children:[i.jsx("thead",{className:"border-b border-[#E9ECEF]",children:i.jsxs("tr",{className:"text-left",children:[i.jsx("th",{className:"pb-2",children:"ID"}),i.jsx("th",{className:"pb-2",children:"Creator"}),i.jsx("th",{className:"pb-2",children:"Fan"}),i.jsx("th",{className:"pb-2",children:"Scheduled"}),i.jsx("th",{className:"pb-2",children:"Duration"}),i.jsx("th",{className:"pb-2",children:"Status"}),i.jsx("th",{className:"pb-2",children:"Meeting Link"}),i.jsx("th",{className:"pb-2",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(x=>{const S=o.get(x.creator_id),C=o.get(x.fan_id);return i.jsxs("tr",{className:"border-b border-[#E9ECEF]",children:[i.jsxs("td",{className:"py-3 text-xs",children:[x.id.substring(0,8),"..."]}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"text-xs",children:[i.jsx("div",{children:(S==null?void 0:S.display_name)||"Unknown"}),i.jsxs("div",{className:"text-[#6C757D]",children:["@",(S==null?void 0:S.username)||"unknown"]})]})}),i.jsx("td",{className:"py-3",children:i.jsxs("div",{className:"text-xs",children:[i.jsx("div",{children:(C==null?void 0:C.display_name)||"Unknown"}),i.jsxs("div",{className:"text-[#6C757D]",children:["@",(C==null?void 0:C.username)||"unknown"]})]})}),i.jsx("td",{className:"py-3 text-xs",children:Mt(x.scheduled_at)}),i.jsxs("td",{className:"py-3 text-xs",children:[x.duration_minutes," min"]}),i.jsx("td",{className:"py-3",children:i.jsxs("select",{value:x.status,onChange:N=>y(x.id,N.target.value),className:"text-xs rounded border border-[#E9ECEF] px-2 py-1",children:[i.jsx("option",{value:"scheduled",children:"scheduled"}),i.jsx("option",{value:"completed",children:"completed"}),i.jsx("option",{value:"cancelled",children:"cancelled"}),i.jsx("option",{value:"no_show",children:"no_show"})]})}),i.jsx("td",{className:"py-3",children:i.jsx("div",{className:"text-xs break-all max-w-xs",children:x.meeting_link||i.jsx("span",{className:"text-red-500",children:"No link"})})}),i.jsx("td",{className:"py-3",children:!x.meeting_link&&i.jsx(oe,{size:"sm",onClick:()=>E(x.id),children:"Add Link"})})]},x.id)})})]})})})]}),i.jsx(oe,{onClick:g,children:"Refresh Data"})]})}const TN={CREATOR_STREAM_STARTED:"bg-emerald-100 text-emerald-800",CREATOR_JOINED:"bg-blue-100 text-blue-800",FAN_JOINED:"bg-violet-100 text-violet-800",FAN_WAITING_ROOM:"bg-amber-100 text-amber-800",RECORDING_STARTED:"bg-rose-100 text-rose-800",RECORDING_STOPPED:"bg-slate-100 text-slate-800",MEETING_CANCELLED_NO_SHOW_CREATOR:"bg-red-100 text-red-800",REFUND_ISSUED:"bg-orange-100 text-orange-800",MEETING_COMPLETED:"bg-green-100 text-green-800",FAN_JOIN_STATUS_AT_S:"bg-indigo-100 text-indigo-800"},R7={scheduled:{color:"text-blue-600",bg:"bg-blue-500",icon:""},live:{color:"text-green-600",bg:"bg-green-500",icon:""},completed:{color:"text-gray-600",bg:"bg-gray-500",icon:""},cancelled:{color:"text-red-600",bg:"bg-red-500",icon:""},cancelled_no_show_creator:{color:"text-red-600",bg:"bg-red-600",icon:""}};function N0e(){const[r,n]=O.useState([]),[o,l]=O.useState([]),[u,m]=O.useState([]),[g,E]=O.useState(!0),[y,x]=O.useState(null),[S,C]=O.useState("all"),[N,M]=O.useState("overview"),[G,I]=O.useState({total:0,scheduled:0,live:0,completed:0,cancelled:0,totalRefunds:0,totalRefundAmount:0});O.useEffect(()=>{P()},[]);const P=async()=>{E(!0),await Promise.all([L(),R(),D()]),E(!1)},L=async()=>{const{data:H,error:J}=await ie.from("meets").select("*").order("scheduled_at",{ascending:!1}).limit(100);if(J){console.error("Error fetching meets:",J);return}const ee=[...new Set((H||[]).map(fe=>fe.creator_id))],ne=[...new Set((H||[]).map(fe=>fe.fan_id))],pe=[...new Set((H||[]).map(fe=>fe.event_id))],[Ee,ge]=await Promise.all([ie.from("profiles").select("user_id, username, display_name").in("user_id",[...ee,...ne]),ie.from("events").select("id, title").in("id",pe)]),he=new Map((Ee.data||[]).map(fe=>[fe.user_id,fe])),le=new Map((ge.data||[]).map(fe=>[fe.id,fe])),Le=[];for(const fe of H||[]){const{data:ae}=await ie.from("meeting_event_logs").select("*").eq("meet_id",fe.id).order("timestamp",{ascending:!0});Le.push({...fe,logs:ae||[],creator_profile:he.get(fe.creator_id),fan_profile:he.get(fe.fan_id),event:le.get(fe.event_id)})}n(Le),I(fe=>({...fe,total:Le.length,scheduled:Le.filter(ae=>ae.status==="scheduled").length,live:Le.filter(ae=>ae.status==="live").length,completed:Le.filter(ae=>ae.status==="completed").length,cancelled:Le.filter(ae=>ae.status==="cancelled_no_show_creator"||ae.status==="cancelled").length}))},R=async()=>{const{data:H,error:J}=await ie.from("bids").select("*").eq("refund_status","refunded").order("refunded_at",{ascending:!1}).limit(50);if(J){console.error("Error fetching refunds:",J);return}const ee=[...new Set((H||[]).map(fe=>fe.fan_id))],ne=[...new Set((H||[]).map(fe=>fe.event_id))],[pe,Ee]=await Promise.all([ie.from("profiles").select("user_id, username, display_name").in("user_id",ee),ie.from("events").select("id, title").in("id",ne)]),ge=new Map((pe.data||[]).map(fe=>[fe.user_id,fe])),he=new Map((Ee.data||[]).map(fe=>[fe.id,fe])),le=(H||[]).map(fe=>({...fe,fan_profile:ge.get(fe.fan_id),event:he.get(fe.event_id)})),Le=le.reduce((fe,ae)=>fe+(ae.refund_amount||ae.amount),0);l(le),I(fe=>({...fe,totalRefunds:le.length,totalRefundAmount:Le}))},D=async()=>{const{data:H,error:J}=await ie.from("meeting_event_logs").select("*").order("timestamp",{ascending:!1}).limit(200);J||m(H||[])},V=H=>new Date(H).toLocaleString(),W=H=>new Date(H).toLocaleDateString(),q=S==="all"?r:r.filter(H=>H.status===S);return g?i.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-[#C045FF] border-t-transparent rounded-full mx-auto mb-4"}),i.jsx("p",{className:"text-gray-500",children:"Loading dashboard..."})]})}):i.jsxs("div",{className:"flex flex-col gap-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-[#212529]",children:"Meeting Lifecycle"}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Automated meeting management with auto-refunds"})]}),i.jsx(oe,{onClick:P,variant:"secondary",size:"sm",children:" Refresh"})]}),i.jsx("div",{className:"flex gap-1 p-1 bg-gray-100 rounded-lg w-fit",children:["overview","meetings","refunds","logs"].map(H=>i.jsxs("button",{onClick:()=>M(H),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${N===H?"bg-white text-[#C045FF] shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[H==="overview"&&"Overview",H==="meetings"&&`Meetings (${G.total})`,H==="refunds"&&`Refunds (${G.totalRefunds})`,H==="logs"&&`Logs (${u.length})`]},H))}),N==="overview"&&i.jsxs("div",{className:"grid gap-6",children:[i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[i.jsx(me,{className:"p-5 hover:shadow-md transition-shadow",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:G.total}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total"})]})]})}),i.jsx(me,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-blue-500",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-blue-600",children:G.scheduled}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Scheduled"})]})]})}),i.jsx(me,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-green-500",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-50 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-green-600",children:G.live}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Live"})]})]})}),i.jsx(me,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-gray-400",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-gray-600",children:G.completed}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Completed"})]})]})}),i.jsx(me,{className:"p-5 hover:shadow-md transition-shadow border-l-4 border-red-500",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-50 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-red-600",children:G.cancelled}),i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Cancelled"})]})]})})]}),i.jsx(me,{className:"p-6 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"w-14 h-14 rounded-2xl bg-green-500 flex items-center justify-center text-white text-2xl flex-shrink-0",children:""}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-bold text-green-800 text-lg mb-2",children:"Automatic Payment System Active"}),i.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-600 mt-0.5",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-800",children:"Creator No-Show"}),i.jsx("p",{className:"text-green-600",children:"100% auto-refund to fan's wallet"})]})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-600 mt-0.5",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-800",children:"Meeting Completed"}),i.jsx("p",{className:"text-green-600",children:"90% auto-credited to creator (10% platform fee)"})]})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-600 mt-0.5",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-800",children:"Fan No-Show"}),i.jsx("p",{className:"text-green-600",children:"No refund - creator still gets paid on completion"})]})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-600 mt-0.5",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-800",children:"Cron Running"}),i.jsx("p",{className:"text-green-600",children:"Checks every minute for no-shows & completions"})]})]})]})]})]})}),G.totalRefunds>0&&i.jsx(me,{className:"p-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-orange-100 flex items-center justify-center text-2xl",children:""}),i.jsxs("div",{children:[i.jsxs("p",{className:"font-semibold text-gray-800",children:[G.totalRefunds," Auto-Refunds Processed"]}),i.jsxs("p",{className:"text-sm text-gray-500",children:["Total: ",Be(G.totalRefundAmount)]})]})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>M("refunds"),children:"View All "})]})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Recent Activity"}),i.jsx("div",{className:"space-y-2",children:u.slice(0,5).map(H=>i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg border hover:bg-gray-50 transition-colors",children:[i.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${TN[H.event_type]||"bg-gray-100"}`,children:H.event_type.replace(/_/g," ")}),i.jsxs("span",{className:"text-sm text-gray-600 flex-1",children:[H.meet_id.slice(0,8),"..."]}),i.jsx("span",{className:"text-xs text-gray-400",children:V(H.timestamp)})]},H.id))})]})]}),N==="meetings"&&i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"flex flex-wrap gap-2",children:["all","scheduled","live","completed","cancelled_no_show_creator"].map(H=>i.jsx("button",{onClick:()=>C(H),className:`px-4 py-2 text-sm rounded-lg transition-all ${S===H?"bg-[#C045FF] text-white shadow-sm":"bg-white text-gray-600 border hover:border-[#C045FF] hover:text-[#C045FF]"}`,children:H==="all"?"All":H==="cancelled_no_show_creator"?"No-Show":H.charAt(0).toUpperCase()+H.slice(1)},H))}),i.jsxs("div",{className:"space-y-3",children:[q.map(H=>{var J,ee,ne,pe,Ee;return i.jsxs(me,{className:"overflow-hidden hover:shadow-md transition-shadow",children:[i.jsx("div",{className:"p-4 cursor-pointer",onClick:()=>x(y===H.id?null:H.id),children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-10 h-10 rounded-full ${((J=R7[H.status])==null?void 0:J.bg)||"bg-gray-400"} flex items-center justify-center text-white text-lg`,children:((ee=R7[H.status])==null?void 0:ee.icon)||"?"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-900",children:((ne=H.event)==null?void 0:ne.title)||"Untitled"}),i.jsxs("p",{className:"text-sm text-gray-500",children:[((pe=H.creator_profile)==null?void 0:pe.display_name)||"Creator","  ",((Ee=H.fan_profile)==null?void 0:Ee.display_name)||"Fan"]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx($e,{variant:H.status==="live"?"success":H.status==="completed"?"primary":H.status.includes("cancelled")?"danger":"default",children:H.status.replace(/_/g," ")}),i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:W(H.scheduled_at)})]})]})}),y===H.id&&i.jsxs(ve,{className:"bg-gray-50 border-t",children:[i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[i.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Creator Started"}),i.jsx("p",{className:"font-medium text-sm mt-1",children:H.creator_started_at?V(H.creator_started_at):i.jsx("span",{className:"text-red-500",children:"Not started"})})]}),i.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fan Joined"}),i.jsx("p",{className:"font-medium text-sm mt-1",children:H.fan_joined_at?V(H.fan_joined_at):i.jsx("span",{className:"text-red-500",children:"Not joined"})})]}),i.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Recording"}),i.jsx("p",{className:"font-medium text-sm mt-1",children:H.recording_started_at?i.jsx("span",{className:"text-green-600",children:" Recorded"}):i.jsx("span",{className:"text-gray-400",children:"None"})})]}),i.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Duration"}),i.jsxs("p",{className:"font-medium text-sm mt-1",children:[H.duration_minutes," min"]})]})]}),H.cancellation_reason&&i.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[i.jsxs("p",{className:"text-sm font-medium text-red-800",children:["Cancellation: ",H.cancellation_reason]}),H.refund_id&&i.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Refund ID: ",H.refund_id]})]}),i.jsxs("div",{children:[i.jsxs("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:["Event Timeline (",H.logs.length,")"]}),H.logs.length===0?i.jsx("p",{className:"text-sm text-gray-400",children:"No events yet"}):i.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:H.logs.map(ge=>i.jsxs("div",{className:"flex items-start gap-3 p-2 bg-white rounded border text-sm",children:[i.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${TN[ge.event_type]||"bg-gray-100"}`,children:ge.event_type.replace(/_/g," ")}),i.jsx("span",{className:"text-xs text-gray-400",children:V(ge.timestamp)})]},ge.id))})]})]})]},H.id)}),q.length===0&&i.jsxs(me,{className:"p-12 text-center",children:[i.jsx("p",{className:"text-4xl mb-2",children:""}),i.jsx("p",{className:"text-gray-500",children:"No meetings found"})]})]})]}),N==="refunds"&&i.jsxs("div",{className:"space-y-4",children:[i.jsx(me,{className:"p-5 bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-500 flex items-center justify-center text-white text-xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-bold text-green-800",children:"Auto-Refund Active"}),i.jsx("p",{className:"text-sm text-green-600",children:"Creator no-shows trigger 100% instant wallet refund to fans"})]})]})}),G.totalRefunds>0&&i.jsxs("div",{className:"flex gap-4",children:[i.jsxs(me,{className:"flex-1 p-4",children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Total Refunds"}),i.jsx("p",{className:"text-2xl font-bold text-gray-800",children:G.totalRefunds})]}),i.jsxs(me,{className:"flex-1 p-4",children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Total Amount"}),i.jsx("p",{className:"text-2xl font-bold text-green-600",children:Be(G.totalRefundAmount)})]})]}),o.length===0?i.jsxs(me,{className:"p-12 text-center",children:[i.jsx("p",{className:"text-4xl mb-2",children:""}),i.jsx("p",{className:"text-gray-500",children:"No refunds processed yet"}),i.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Refunds appear here when creators miss meetings"})]}):i.jsx("div",{className:"space-y-3",children:o.map(H=>{var J,ee,ne;return i.jsx(me,{className:"p-4 hover:shadow-md transition-shadow",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 text-lg",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-900",children:((J=H.event)==null?void 0:J.title)||"Unknown Event"}),i.jsxs("p",{className:"text-sm text-gray-500",children:["To: ",((ee=H.fan_profile)==null?void 0:ee.display_name)||((ne=H.fan_profile)==null?void 0:ne.username)||"Fan"]}),i.jsx("p",{className:"text-xs text-gray-400",children:V(H.refunded_at)})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-xl font-bold text-green-600",children:Be(H.refund_amount||H.amount)}),i.jsx($e,{variant:"success",children:"Auto-Refunded"})]})]})},H.id)})})]}),N==="logs"&&i.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:u.length===0?i.jsxs(me,{className:"p-12 text-center",children:[i.jsx("p",{className:"text-4xl mb-2",children:""}),i.jsx("p",{className:"text-gray-500",children:"No logs yet"})]}):u.map(H=>i.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border hover:shadow-sm transition-shadow",children:[i.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${TN[H.event_type]||"bg-gray-100"}`,children:H.event_type.replace(/_/g," ")}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[i.jsxs("span",{className:"text-gray-600",children:["Meet: ",i.jsx("code",{className:"bg-gray-100 px-1 rounded",children:H.meet_id.slice(0,8)})]}),i.jsx("span",{className:"text-gray-400",children:V(H.timestamp)})]}),Object.keys(H.metadata||{}).length>0&&i.jsxs("details",{className:"mt-2",children:[i.jsx("summary",{className:"text-xs text-gray-400 cursor-pointer hover:text-gray-600",children:"View metadata"}),i.jsx("pre",{className:"text-xs text-gray-600 mt-1 p-2 bg-gray-50 rounded overflow-x-auto",children:JSON.stringify(H.metadata,null,2)})]})]})]},H.id))})]})}function R0e(){var ge;const{username:r}=nI(),n=Ss(),{getEventsForCreator:o}=Yo(),{getProfile:l,followCreator:u,unfollowCreator:m,following:g}=KI(),{isAuthenticated:E,user:y}=fs(),[x,S]=O.useState(!1),[C,N]=O.useState(0),[M,G]=O.useState(0),I=(r??"").replace(/^@/,"").toLowerCase(),P=I?l(I):void 0;O.useEffect(()=>{I&&S(g.includes(I))},[I,g]),O.useEffect(()=>{(async()=>{if(I)try{const{data:le}=await ie.from("profiles").select("user_id").eq("username",I).single();if(!le)return;const{count:Le}=await ie.from("creator_follows").select("*",{count:"exact",head:!0}).eq("creator_id",le.user_id);N(Le||0);const{count:fe}=await ie.from("meets").select("*",{count:"exact",head:!0}).eq("creator_id",le.user_id).eq("status","completed");G(fe||0)}catch(le){console.error("Error fetching stats:",le)}})()},[I]);const L=I?o(I):[],R=!L.length&&I?Array.from({length:5}).map((he,le)=>{const Le=I.split(/[-_]/).filter(Boolean).map(We=>We.charAt(0).toUpperCase()+We.slice(1)).join(" ")||"Creator",fe=100+le*25,ae=le%2===0?fe+120:0,be=le%2===0?5+le*2:0;return{id:`synthetic-${I}-${le}`,creatorUsername:I,creatorDisplayName:Le,title:le===0?"Meet & Greet  1:1 Fan Session":le===1?"Premium AMA  Ask Me Anything":le===2?"Deep Dive  Strategy Session":le===3?"Behind the Scenes Chat":"Quick Catch-up Call",description:"A quick 1:1 session to say hi, ask a couple of questions, and take a virtual selfie together.",status:le===0?"LIVE":"Upcoming",date:le===0?"Today  8:00 PM IST":"This week  8:00 PM IST",duration:le%2===0?"10 minutes":"5 minutes",basePrice:fe,currentBid:ae,participants:be,endsIn:le===0?"00:35:12 left":"Starts soon"}}):void 0,V=[...L.length>0?L:R??[]].reverse(),W=V[0],q=(P==null?void 0:P.displayName)||(W==null?void 0:W.creatorDisplayName)||"Creator",H=`@${I||"creator"}`,J=(P==null?void 0:P.bio)||(W==null?void 0:W.description)||"Host of intimate FanMeet sessions. Expect honest stories, practical advice, and space for your questions.",ee=he=>{const le=`${window.location.origin}/events/${he}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(le).then(()=>{window.alert("Event link copied. Share it with your fans to start receiving bids.")},()=>{window.prompt("Share this event link with your fans:",le)}):window.prompt("Share this event link with your fans:",le)},ne=!!W,pe=()=>{if(!I)return;const he=`${window.location.origin}/${I}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(he).then(()=>{window.alert("Profile link copied. Share it with your fans.")},()=>{window.prompt("Share this profile link with your fans:",he)}):window.prompt("Share this profile link with your fans:",he)},Ee=async()=>{if(!E){window.confirm(`Please log in to follow creators.

Click OK to go to login page.`)&&n(`/auth?redirect=/${I}`);return}if((y==null?void 0:y.role)!=="fan"){window.alert(`Only fans can follow creators.

Please log in with a fan account.`);return}try{x?(await m(I),S(!1),window.alert(`Unfollowed ${(P==null?void 0:P.displayName)||I} successfully!`)):(await u(I),S(!0),window.alert(`Now following ${(P==null?void 0:P.displayName)||I}! 

You'll see their events in your feed.`))}catch(he){console.error("Error toggling follow:",he),window.alert("Something went wrong. Please try again.")}};return i.jsxs("div",{className:"flex min-h-[calc(100vh-70px)] flex-col bg-white md:bg-gradient-to-b md:from-[#FDEBFF] md:via-[#FFF] md:to-[#F0F2F5]",children:[i.jsxs("div",{className:"relative md:mx-auto md:w-full md:max-w-5xl",children:[i.jsx("div",{className:"h-40 w-full md:h-48 md:rounded-b-lg overflow-hidden",children:P!=null&&P.cover_photo_url?i.jsx("img",{src:P.cover_photo_url,alt:"Cover",className:"h-full w-full object-cover"}):i.jsx("div",{className:"h-full w-full bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF]"})}),i.jsxs("div",{className:"absolute inset-x-0 top-0 flex items-center justify-between bg-gradient-to-b from-black/40 to-transparent px-4 py-3 text-xs font-medium text-white md:rounded-t-lg",children:[i.jsx("button",{type:"button",className:"rounded-full bg-black/30 px-3 py-1",onClick:()=>n(-1),children:" Back"}),i.jsxs("div",{className:"flex items-center gap-3 text-[11px]",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[" ",i.jsx("span",{children:C.toLocaleString()})]}),i.jsxs("span",{className:"flex items-center gap-1",children:[" ",i.jsx("span",{children:M})]})]})]}),i.jsx("div",{className:"absolute -bottom-9 left-4 flex items-end gap-3",children:i.jsx("div",{className:"h-20 w-20 overflow-hidden rounded-full border-4 border-white bg-[#050014]",children:P!=null&&P.profilePhotoUrl?i.jsx("img",{src:P.profilePhotoUrl,alt:q,className:"h-full w-full object-cover"}):i.jsx("div",{className:"h-full w-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-2xl",children:((ge=q==null?void 0:q.charAt(0))==null?void 0:ge.toUpperCase())||"?"})})})]}),i.jsx("div",{className:"px-4 pt-12 pb-3 md:mx-auto md:w-full md:max-w-5xl md:bg-white md:shadow-sm",children:i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("h1",{className:"text-lg font-semibold text-[#212529]",children:q}),i.jsxs("span",{className:"text-xs text-[#6C757D]",children:[H,"  Seen 9 minutes ago"]}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:J}),ne?i.jsxs("span",{className:"mt-1 text-[11px] font-medium uppercase tracking-wide text-[#C045FF]",children:[V.length," active events"]}):null]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(oe,{variant:"secondary",size:"sm",className:"rounded-full px-3 py-1 text-xs",onClick:pe,children:"Share profile"}),i.jsx(oe,{size:"sm",className:"rounded-full px-3 py-1 text-xs",variant:x?"primary":"secondary",onClick:Ee,children:x?" Following":"Follow"})]})]})}),i.jsx("div",{className:"flex-1 px-4 py-4 md:mx-auto md:w-full md:max-w-5xl md:bg-[#F6EBFF]/70 md:rounded-b-xl",children:i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-[#6C757D]",children:"Upcoming events"}),V.map(he=>i.jsx(me,{elevated:!0,className:"border-none",children:i.jsxs(ve,{className:"gap-3",children:[i.jsxs("div",{className:"flex items-center justify-between text-[11px] text-[#6C757D]",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[he.status==="Accepting Bids"?i.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-2 py-1",children:i.jsx("span",{className:"text-xs font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx($e,{variant:he.status==="LIVE"?"danger":"primary",children:he.status==="LIVE"?" LIVE":he.status}),i.jsx("span",{children:he.date}),i.jsxs("span",{children:[" ",he.duration]})]}),i.jsx("button",{type:"button",className:"rounded-full bg-[#F8F9FA] px-3 py-1 font-medium text-[#C045FF]",onClick:()=>ee(he.id),children:"Share"})]}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("h2",{className:"text-sm font-semibold text-[#212529]",children:he.title}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:he.description})]}),i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-[11px] text-[#6C757D]",children:[i.jsxs("span",{children:["Base ",Be(he.basePrice)]}),i.jsxs("span",{children:["Highest bid"," ",he.currentBid?Be(he.currentBid):"No bids yet"]}),i.jsxs("span",{children:[" ",he.participants," participants"]})]}),i.jsx("div",{className:"mt-2 flex gap-2",children:i.jsx(oe,{size:"sm",className:"flex-1 rounded-full",onClick:()=>n(`/events/${he.id}`),disabled:String(he.status).toLowerCase()==="completed"||String(he.status).toLowerCase()==="cancelled",children:String(he.status).toLowerCase()==="completed"?"Event Ended":String(he.status).toLowerCase()==="cancelled"?"Event Cancelled":"View & bid"})})]})},he.id)),V.length===0&&i.jsx(me,{children:i.jsx(ve,{children:i.jsx("p",{className:"text-sm text-[#6C757D]",children:"This creator has not set up any bidding events yet. Check back soon for upcoming sessions."})})})]})})})]})}const tz="https://iktldcrkyphkvxjwmxyb.supabase.co",A0e=()=>new Promise(r=>{if(window.Razorpay){r(!0);return}const n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>r(!0),n.onerror=()=>r(!1),document.body.appendChild(n)}),I0e=async r=>{const{data:{session:n}}=await ie.auth.getSession();if(!n)throw new Error("Please log in to continue.");const o=await fetch(`${tz}/functions/v1/razorpay-create-order`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({amount:r.amount})});if(!o.ok){const l=await o.json();throw new Error(l.error||"Failed to create order.")}return await o.json()},D0e=async r=>{const{data:{session:n}}=await ie.auth.getSession();if(!n)throw new Error("Please log in to continue.");const o=await fetch(`${tz}/functions/v1/razorpay-verify-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify(r)});if(!o.ok){const l=await o.json();throw new Error(l.error||"Payment verification failed.")}return await o.json()},O0e=r=>{const n={key:r.keyId,amount:r.amount*100,currency:"INR",name:"FanMeet",description:r.description||"Payment",order_id:r.orderId,handler:r.onSuccess,prefill:{email:r.userEmail||""},theme:{color:"#C045FF"},modal:{ondismiss:r.onDismiss||(()=>{})}};new window.Razorpay(n).open()};function j0e(){const{eventId:r}=nI(),n=Ss(),{isAuthenticated:o,user:l}=fs(),{events:u,placeBid:m,isLoading:g,getBidHistory:E,bidHistory:y,getUserCurrentBidForEvent:x}=Yo(),{getProfile:S}=KI();let C=u.find(ge=>ge.id===r);if(!C&&r&&r.startsWith("synthetic-")){const ge=r.replace(/^synthetic-/,""),he=ge.lastIndexOf("-");if(he>0){const le=ge.slice(0,he),Le=ge.slice(he+1),fe=Number(Le);if(le&&Number.isFinite(fe)){const ae=le.split(/[-_]/).filter(Boolean).map(Ge=>Ge.charAt(0).toUpperCase()+Ge.slice(1)).join(" ")||"Creator",be=100+fe*25,We=fe%2===0?be+120:0,it=fe%2===0?5+fe*2:0;C={id:r,creatorUsername:le,creatorDisplayName:ae,title:fe===0?"Meet & Greet  1:1 Fan Session":fe===1?"Premium AMA  Ask Me Anything":fe===2?"Deep Dive  Strategy Session":fe===3?"Behind the Scenes Chat":"Quick Catch-up Call",description:"A quick 1:1 session to say hi, ask a couple of questions, and take a virtual selfie together.",status:fe===0?"LIVE":"Upcoming",date:fe===0?"Today  8:00 PM IST":"This week  8:00 PM IST",duration:fe%2===0?"10 minutes":"5 minutes",basePrice:be,currentBid:We,participants:it,endsIn:fe===0?"00:35:12 left":"Starts soon"}}}}const[N,M]=O.useState(""),[G,I]=O.useState(!1),[P,L]=O.useState(!1),R=C?S(C.creatorUsername):void 0,D=C?x(C.id):0,V=Number(N)||0,W=D+V,q=50,H=!!(C&&C.currentBid===0),J=!!(C&&String(C.status).toLowerCase()==="completed"),ee=C?C.currentBid>0?C.currentBid:C.basePrice:0,ne=C?H?C.basePrice:ee+q:0;if(O.useEffect(()=>{C&&H&&M(String(C.basePrice))},[C==null?void 0:C.id,C==null?void 0:C.currentBid,C==null?void 0:C.basePrice]),O.useEffect(()=>{C!=null&&C.id&&!C.id.startsWith("synthetic-")&&E(C.id)},[C==null?void 0:C.id]),g)return i.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-4 px-4 py-8",children:i.jsx(me,{elevated:!0,children:i.jsxs(ve,{className:"gap-4 p-8 text-center",children:[i.jsx("div",{className:"text-lg font-semibold text-[#212529]",children:"Loading event..."}),i.jsx("p",{className:"text-sm text-[#6C757D]",children:"Please wait while we fetch the event details."})]})})});if(!C)return i.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-4 px-4 py-8",children:i.jsxs(me,{elevated:!0,children:[i.jsx(Ce,{title:"Event not found",subtitle:"This event may have expired or been removed."}),i.jsxs(ve,{className:"gap-4",children:[i.jsx("p",{className:"text-sm text-[#6C757D]",children:"If you followed an older link, ask the creator for their latest event or visit their profile for current sessions."}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(oe,{variant:"secondary",onClick:()=>n(-1),children:"Go back"}),i.jsx(oe,{onClick:()=>n("/"),children:"Go to homepage"})]})]})]})});const pe=()=>{const ge=`${window.location.origin}/events/${C.id}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(ge).then(()=>{window.alert("Event link copied. Share it with your fans to start receiving bids.")},()=>{window.prompt("Share this event link with your fans:",ge)}):window.prompt("Share this event link with your fans:",ge)},Ee=async()=>{if(J){window.alert("This event has been completed. Bidding is closed.");return}const ge=Number(N),he=D>0?W:ge;if(D>0){if(ge%q!==0){window.alert(`Bid increments must be in multiples of ${q}.`);return}}else if(ge!==C.basePrice){window.alert(`The first bid must be exactly ${C.basePrice}.`);return}if(!he||Number.isNaN(he)){window.alert("Enter a valid bid amount to continue.");return}if(he<C.currentBid){window.alert(`Your bid must be at least the current bid of ${Be(C.currentBid)}.`);return}if(!o||(l==null?void 0:l.role)!=="fan"){I(!0);return}L(!0);try{if(!await A0e())throw new Error("Failed to load payment gateway");const{orderId:Le,keyId:fe}=await I0e({amount:he,userId:l.id,userEmail:l.email});O0e({amount:he,orderId:Le,keyId:fe,userEmail:l.email,description:`Bid of ${Be(he)} for ${C.title}`,onSuccess:async ae=>{try{await D0e(ae),await m(C.id,he),window.alert(` Payment successful! Bid of ${Be(he)} placed!

You'll be notified if someone outbids you.

 If you don't win, 90% will be auto-refunded.`),M("")}catch(be){console.error("Error after payment:",be),window.alert("Payment received but bid placement failed. Please contact support.")}finally{L(!1)}},onDismiss:()=>{L(!1)}})}catch(le){console.error("Bid error:",le),window.alert("Failed to initiate payment. Please try again."),L(!1)}};return i.jsxs("div",{className:"mx-auto flex min-h-[calc(100vh-70px)] max-w-3xl flex-col bg-white pb-6",children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"h-40 w-full bg-gradient-to-br from-[#FFE5D9] via-white to-[#F4E6FF] md:h-48"}),i.jsxs("div",{className:"absolute inset-x-0 top-0 flex items-center justify-between bg-gradient-to-b from-black/40 to-transparent px-4 py-3 text-xs font-medium text-white",children:[i.jsx("button",{type:"button",className:"rounded-full bg-black/30 px-3 py-1",onClick:()=>n(-1),children:" Back"}),i.jsxs("div",{className:"flex flex-col items-end gap-1 text-right",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-wide text-white/80",children:"Bidding event"}),i.jsx("span",{className:"text-sm font-semibold",children:C.title})]})]})]}),i.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-4 pt-4",children:[i.jsx(me,{elevated:!0,className:"border-none",children:i.jsxs(ve,{className:"gap-4",children:[i.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group",onClick:()=>n(`/${C.creatorUsername}`),children:[i.jsx("div",{className:"relative flex-shrink-0",children:R!=null&&R.profilePhotoUrl?i.jsx("img",{src:R.profilePhotoUrl,alt:C.creatorDisplayName,className:"h-16 w-16 rounded-full object-cover ring-2 ring-[#C045FF]/20 group-hover:ring-[#C045FF]/40 transition-all"}):i.jsx("div",{className:"h-16 w-16 rounded-full bg-gradient-to-br from-[#C045FF] to-[#7B2CBF] flex items-center justify-center text-white font-bold text-xl ring-2 ring-[#C045FF]/20 group-hover:ring-[#C045FF]/40 transition-all",children:C.creatorDisplayName.charAt(0).toUpperCase()})}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-[#6C757D]",children:"Hosted by"}),i.jsx("span",{className:"text-sm font-semibold text-[#212529] group-hover:text-[#C045FF] transition-colors",children:C.creatorDisplayName}),i.jsxs("span",{className:"text-xs text-[#C045FF] underline decoration-dotted group-hover:decoration-solid transition-all",children:["@",C.creatorUsername]}),i.jsx("span",{className:"text-[10px] text-[#6C757D] mt-0.5 group-hover:text-[#C045FF] transition-colors",children:" Click to view profile"})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-[#6C757D]",children:[i.jsxs("span",{className:"rounded-full bg-[#F8F9FA] px-3 py-1",children:[" ",C.participants," participants"]}),i.jsxs("span",{className:"rounded-full bg-[#F8F9FA] px-3 py-1",children:[" ",C.duration]})]})]}),i.jsxs("div",{className:"grid gap-3 text-xs text-[#6C757D] md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-3",children:[i.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide",children:"Schedule"}),i.jsx("div",{className:"mt-1 text-sm text-[#212529]",children:C.date})]}),i.jsxs("div",{className:"rounded-[12px] bg-[#F8F9FA] p-3",children:[i.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide",children:"Status"}),i.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-[#212529]",children:[C.status==="Accepting Bids"?i.jsx("div",{className:"rounded-[8px] bg-[#1E4620] px-3 py-1.5",children:i.jsx("span",{className:"text-sm font-semibold text-[#4ADE80]",children:" Accepting Bids"})}):i.jsx($e,{variant:C.status==="LIVE"?"danger":"primary",children:C.status==="LIVE"?" LIVE":C.status}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:C.endsIn})]})]})]})]})}),C.description?i.jsxs(me,{children:[i.jsx(Ce,{title:"About this event"}),i.jsxs(ve,{className:"gap-3",children:[i.jsx("p",{className:"text-sm text-[#495057]",children:C.description}),i.jsx("p",{className:"text-xs text-[#6C757D]",children:"This is a demo environment. In a real product, this section would outline the exact flow of the experience, how long the interaction lasts, and any preparation required before joining."})]})]}):null,y.length>0&&i.jsxs(me,{children:[i.jsx(Ce,{title:"Recent Bids",subtitle:"Live bidding activity"}),i.jsx(ve,{className:"gap-3",children:y.map(ge=>i.jsxs("div",{className:`flex items-center justify-between p-3 rounded-[12px] ${ge.isCurrentLeader?"bg-[#C045FF]/10 border border-[#C045FF]/30":"bg-[#F8F9FA]"}`,children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("span",{className:"text-sm font-semibold text-[#212529]",children:["@",ge.fanUsername]}),i.jsx("span",{className:"text-xs text-[#6C757D]",children:new Date(ge.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1",children:[i.jsx("span",{className:"text-lg font-semibold text-[#C045FF]",children:Be(ge.amount)}),ge.isCurrentLeader&&i.jsx("span",{className:"text-[10px] font-semibold text-[#C045FF] bg-white px-2 py-0.5 rounded-full",children:" Leading"})]})]},ge.id))})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"What you'll get"}),i.jsxs(ve,{className:"gap-3 text-sm text-[#495057]",children:[i.jsxs("ul",{className:"space-y-1 text-xs text-[#495057]",children:[i.jsx("li",{children:" A 1:1 micro-meet with the creator with room for your questions."}),i.jsx("li",{children:" Optional screenshot / selfie moment at the end of the call."}),i.jsx("li",{children:" Priority chat placement during the live session."})]}),i.jsx("p",{className:"text-[11px] text-[#6C757D]",children:"Exact perks are for demo only and can be customised per creator event."})]})]}),i.jsxs(me,{children:[i.jsx(Ce,{title:"Small print"}),i.jsxs(ve,{className:"gap-2 text-[11px] text-[#6C757D]",children:[i.jsx("p",{children:"Bids placed in this sandbox are not real payments. In production, only the top bidders would be charged after the auction window ends."}),i.jsx("p",{children:"By placing a bid you agree to follow community guidelines and respect the creator's time and boundaries."})]})]}),i.jsx(me,{elevated:!0,className:"sticky bottom-0 border-none shadow-[0_-8px_24px_rgba(15,23,42,0.12)] md:static md:shadow-none",children:i.jsxs(ve,{className:"gap-4",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-[#6C757D]",children:"Current highest bid"}),i.jsx("span",{className:"text-xl font-semibold text-[#C045FF]",children:Be(ee||C.basePrice)}),i.jsxs("span",{className:"text-[11px] text-[#6C757D]",children:["Base price ",Be(C.basePrice),"  ",C.participants," participants"]}),i.jsxs("span",{className:"mt-1 text-[11px] text-[#6C757D]",children:["Next bid: ",i.jsx("strong",{className:"text-[#212529]",children:Be(ne)})," (step ",Be(q),")"]})]}),i.jsx(oe,{variant:"secondary",size:"sm",className:"rounded-full text-xs",onClick:pe,children:"Share event link"})]}),i.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(nt,{type:"number",label:D>0?"Add to your bid":"Your bid amount",placeholder:String(C.basePrice),value:N,onChange:ge=>M(ge.target.value),disabled:H||J}),H&&i.jsx("div",{className:"mt-2 text-[11px] text-[#6C757D]",children:"First bid is fixed to the creator's base price."}),J&&i.jsx("div",{className:"mt-2 text-[11px] text-[#DC3545]",children:"This event is completed. Bidding is no longer available."}),V>0&&i.jsx("div",{className:"mt-2 text-sm",children:D>0?i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("span",{className:"text-[#6C757D]",children:["Your current bid: ",i.jsx("strong",{className:"text-[#212529]",children:Be(D)})]}),i.jsxs("span",{className:"text-[#C045FF] font-semibold",children:["Adding ",Be(V),"  New total: ",Be(W)]})]}):i.jsxs("span",{className:"text-[#C045FF] font-semibold",children:["Your bid: ",Be(V)]})})]}),i.jsx(oe,{className:"md:w-40",onClick:Ee,disabled:P||J,children:J?"Event Completed":P?"Processing...":"Place Bid "})]})]})})]}),G&&i.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4",children:i.jsxs("div",{className:"max-w-sm flex-1 rounded-2xl bg-white p-6 shadow-2xl",children:[i.jsx("h2",{className:"text-lg font-semibold text-[#212529]",children:"Login to place your bid"}),i.jsx("p",{className:"mt-2 text-sm text-[#6C757D]",children:"You'll need a fan account to place bids and join this meet. We'll take you to the login page and bring you back here after you're done."}),i.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[i.jsx(oe,{onClick:()=>n(`/auth?redirect=/events/${C.id}`),className:"w-full",children:"Continue to login / signup"}),i.jsx(oe,{variant:"secondary",className:"w-full",onClick:()=>I(!1),children:"Cancel"})]})]})})]})}/**
 * @license agora-rtc-react
 * @version 2.5.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var P0e=Object.create,qI=Object.defineProperty,k0e=Object.getOwnPropertyDescriptor,L0e=Object.getOwnPropertyNames,M0e=Object.getPrototypeOf,F0e=Object.prototype.hasOwnProperty,U0e=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),V0e=(r,n)=>{for(var o in n)qI(r,o,{get:n[o],enumerable:!0})},sz=(r,n,o,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of L0e(n))!F0e.call(r,u)&&u!==o&&qI(r,u,{get:()=>n[u],enumerable:!(l=k0e(n,u))||l.enumerable});return r},B0e=(r,n,o)=>(sz(r,n,"default"),o),pu=(r,n,o)=>(o=r!=null?P0e(M0e(r)):{},sz(!r||!r.__esModule?qI(o,"default",{value:r,enumerable:!0}):o,r)),mu=U0e((r,n)=>{(function(o,l){typeof r=="object"&&typeof n<"u"?n.exports=l():typeof define=="function"&&define.amd?define(l):(o=typeof globalThis<"u"?globalThis:o||self).AgoraRTC=l()})(r,function(){function o(e,t){return t.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in e)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(e,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var m=function(e){try{return!!e()}catch{return!0}},g=!m(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=g,y=Function.prototype,x=y.call,S=E&&y.bind.bind(x,x),C=E?S:function(e){return function(){return x.apply(e,arguments)}},N=C({}.isPrototypeOf),M=function(e){return e&&e.Math===Math&&e},G=M(typeof globalThis=="object"&&globalThis)||M(typeof window=="object"&&window)||M(typeof self=="object"&&self)||M(typeof l=="object"&&l)||M(typeof l=="object"&&l)||function(){return this}()||Function("return this")(),I=g,P=Function.prototype,L=P.apply,R=P.call,D=typeof Reflect=="object"&&Reflect.apply||(I?R.bind(L):function(){return R.apply(L,arguments)}),V=C,W=V({}.toString),q=V("".slice),H=function(e){return q(W(e),8,-1)},J=H,ee=C,ne=function(e){if(J(e)==="Function")return ee(e)},pe=typeof document=="object"&&document.all,Ee=pe===void 0&&pe!==void 0?function(e){return typeof e=="function"||e===pe}:function(e){return typeof e=="function"},ge={},he=!m(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),le=g,Le=Function.prototype.call,fe=le?Le.bind(Le):function(){return Le.apply(Le,arguments)},ae={},be={}.propertyIsEnumerable,We=Object.getOwnPropertyDescriptor,it=We&&!be.call({1:2},1);ae.f=it?function(e){var t=We(this,e);return!!t&&t.enumerable}:be;var Ge,pt,Ze=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Me=m,Ue=H,ke=Object,Ie=C("".split),Xe=Me(function(){return!ke("z").propertyIsEnumerable(0)})?function(e){return Ue(e)==="String"?Ie(e,""):ke(e)}:ke,ye=function(e){return e==null},Oe=ye,qe=TypeError,Ct=function(e){if(Oe(e))throw new qe("Can't call method on "+e);return e},Ft=Xe,zt=Ct,vt=function(e){return Ft(zt(e))},ds=Ee,kt=function(e){return typeof e=="object"?e!==null:ds(e)},Ps={},Jn=Ps,$o=G,uo=Ee,Qr=function(e){return uo(e)?e:void 0},br=function(e,t){return arguments.length<2?Qr(Jn[e])||Qr($o[e]):Jn[e]&&Jn[e][t]||$o[e]&&$o[e][t]},ho=G.navigator,Kl=ho&&ho.userAgent,ln=Kl?String(Kl):"",us=G,Ds=ln,En=us.process,hs=us.Deno,Gi=En&&En.versions||hs&&hs.version,_u=Gi&&Gi.v8;_u&&(pt=(Ge=_u.split("."))[0]>0&&Ge[0]<4?1:+(Ge[0]+Ge[1])),!pt&&Ds&&(!(Ge=Ds.match(/Edge\/(\d+)/))||Ge[1]>=74)&&(Ge=Ds.match(/Chrome\/(\d+)/))&&(pt=+Ge[1]);var Ta=pt,vu=Ta,vb=m,zr=G.String,Qn=!!Object.getOwnPropertySymbols&&!vb(function(){var e=Symbol("symbol detection");return!zr(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&vu&&vu<41}),Na=Qn&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Tz=br,Nz=Ee,Rz=N,Az=Object,Jp=Na?function(e){return typeof e=="symbol"}:function(e){var t=Tz("Symbol");return Nz(t)&&Rz(t.prototype,Az(e))},Iz=String,Eu=function(e){try{return Iz(e)}catch{return"Object"}},Dz=Ee,Oz=Eu,jz=TypeError,Zn=function(e){if(Dz(e))return e;throw new jz(Oz(e)+" is not a function")},Pz=Zn,kz=ye,t_=function(e,t){var s=e[t];return kz(s)?void 0:Pz(s)},eD=fe,tD=Ee,sD=kt,Lz=TypeError,rD={exports:{}},nD=G,Mz=Object.defineProperty,Fz=G,Uz=function(e,t){try{Mz(nD,e,{value:t,configurable:!0,writable:!0})}catch{nD[e]=t}return t},iD="__core-js_shared__",aD=rD.exports=Fz[iD]||Uz(iD,{});(aD.versions||(aD.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Eb=rD.exports,oD=Eb,yu=function(e,t){return oD[e]||(oD[e]=t||{})},Vz=Ct,Bz=Object,po=function(e){return Bz(Vz(e))},Wz=po,Gz=C({}.hasOwnProperty),Ur=Object.hasOwn||function(e,t){return Gz(Wz(e),t)},Hz=C,zz=0,Kz=Math.random(),qz=Hz(1 .toString),yb=function(e){return"Symbol("+(e===void 0?"":e)+")_"+qz(++zz+Kz,36)},Yz=yu,cD=Ur,$z=yb,Xz=Qn,Jz=Na,xu=G.Symbol,xb=Yz("wks"),Qz=Jz?xu.for||xu:xu&&xu.withoutSetter||$z,qs=function(e){return cD(xb,e)||(xb[e]=Xz&&cD(xu,e)?xu[e]:Qz("Symbol."+e)),xb[e]},Zz=fe,lD=kt,dD=Jp,eK=t_,tK=function(e,t){var s,a;if(tD(s=e.toString)&&!sD(a=eD(s,e))||tD(s=e.valueOf)&&!sD(a=eD(s,e))||t!=="string")return a;throw new Lz("Can't convert object to primitive value")},sK=TypeError,rK=qs("toPrimitive"),nK=function(e,t){if(!lD(e)||dD(e))return e;var s,a=eK(e,rK);if(a){if(s=Zz(a,e,t),!lD(s)||dD(s))return s;throw new sK("Can't convert object to primitive value")}return tK(e,t)},iK=Jp,bb=function(e){var t=nK(e,"string");return iK(t)?t:t+""},uD=kt,wb=G.document,aK=uD(wb)&&uD(wb.createElement),Sb=function(e){return aK?wb.createElement(e):{}},oK=Sb,hD=!he&&!m(function(){return Object.defineProperty(oK("div"),"a",{get:function(){return 7}}).a!==7}),cK=he,lK=fe,dK=ae,uK=Ze,hK=vt,pK=bb,mK=Ur,fK=hD,pD=Object.getOwnPropertyDescriptor;ge.f=cK?pD:function(e,t){if(e=hK(e),t=pK(t),fK)try{return pD(e,t)}catch{}if(mK(e,t))return uK(!lK(dK.f,e,t),e[t])};var gK=m,_K=Ee,vK=/#|\.prototype\./,Qp=function(e,t){var s=yK[EK(e)];return s===bK||s!==xK&&(_K(t)?gK(t):!!t)},EK=Qp.normalize=function(e){return String(e).replace(vK,".").toLowerCase()},yK=Qp.data={},xK=Qp.NATIVE="N",bK=Qp.POLYFILL="P",mD=Qp,wK=Zn,SK=g,CK=ne(ne.bind),Rc=function(e,t){return wK(e),t===void 0?e:SK?CK(e,t):function(){return e.apply(t,arguments)}},Hi={},fD=he&&m(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),TK=kt,NK=String,RK=TypeError,Ln=function(e){if(TK(e))return e;throw new RK(NK(e)+" is not an object")},AK=he,IK=hD,DK=fD,s_=Ln,gD=bb,OK=TypeError,Cb=Object.defineProperty,jK=Object.getOwnPropertyDescriptor,Tb="enumerable",Nb="configurable",Rb="writable";Hi.f=AK?DK?function(e,t,s){if(s_(e),t=gD(t),s_(s),typeof e=="function"&&t==="prototype"&&"value"in s&&Rb in s&&!s[Rb]){var a=jK(e,t);a&&a[Rb]&&(e[t]=s.value,s={configurable:Nb in s?s[Nb]:a[Nb],enumerable:Tb in s?s[Tb]:a[Tb],writable:!1})}return Cb(e,t,s)}:Cb:function(e,t,s){if(s_(e),t=gD(t),s_(s),IK)try{return Cb(e,t,s)}catch{}if("get"in s||"set"in s)throw new OK("Accessors not supported");return"value"in s&&(e[t]=s.value),e};var PK=Hi,kK=Ze,ql=he?function(e,t,s){return PK.f(e,t,kK(1,s))}:function(e,t,s){return e[t]=s,e},Zp=G,LK=D,MK=ne,FK=Ee,UK=ge.f,VK=mD,bu=Ps,BK=Rc,wu=ql,_D=Ur,WK=function(e){var t=function(s,a,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(s);case 2:return new e(s,a)}return new e(s,a,c)}return LK(e,this,arguments)};return t.prototype=e.prototype,t},qt=function(e,t){var s,a,c,d,h,p,f,_,v,b=e.target,w=e.global,T=e.stat,U=e.proto,k=w?Zp:T?Zp[b]:Zp[b]&&Zp[b].prototype,F=w?bu:bu[b]||wu(bu,b,{})[b],z=F.prototype;for(d in t)a=!(s=VK(w?d:b+(T?".":"#")+d,e.forced))&&k&&_D(k,d),p=F[d],a&&(f=e.dontCallGetSet?(v=UK(k,d))&&v.value:k[d]),h=a&&f?f:t[d],(s||U||typeof p!=typeof h)&&(_=e.bind&&a?BK(h,Zp):e.wrap&&a?WK(h):U&&FK(h)?MK(h):h,(e.sham||h&&h.sham||p&&p.sham)&&wu(_,"sham",!0),wu(F,d,_),U&&(_D(bu,c=b+"Prototype")||wu(bu,c,{}),wu(bu[c],d,h),e.real&&z&&(s||!z[d])&&wu(z,d,h)))},GK=Math.ceil,HK=Math.floor,zK=Math.trunc||function(e){var t=+e;return(t>0?HK:GK)(t)},KK=zK,Ab=function(e){var t=+e;return t!=t||t===0?0:KK(t)},qK=Ab,YK=Math.max,$K=Math.min,Ib=function(e,t){var s=qK(e);return s<0?YK(s+t,0):$K(s,t)},XK=Ab,JK=Math.min,vD=function(e){var t=XK(e);return t>0?JK(t,9007199254740991):0},QK=vD,Ac=function(e){return QK(e.length)},ZK=vt,eq=Ib,tq=Ac,ED=function(e){return function(t,s,a){var c=ZK(t),d=tq(c);if(d===0)return!e&&-1;var h,p=eq(a,d);if(e&&s!=s){for(;d>p;)if((h=c[p++])!=h)return!0}else for(;d>p;p++)if((e||p in c)&&c[p]===s)return e||p||0;return!e&&-1}},Db={includes:ED(!0),indexOf:ED(!1)},sq=Db.includes;qt({target:"Array",proto:!0,forced:m(function(){return!Array(1).includes()})},{includes:function(e){return sq(this,e,arguments.length>1?arguments[1]:void 0)}});var rq=G,nq=Ps,zi=function(e,t){var s=nq[e+"Prototype"],a=s&&s[t];if(a)return a;var c=rq[e],d=c&&c.prototype;return d&&d[t]},iq=zi("Array","includes"),aq=kt,oq=H,cq=qs("match"),yD=function(e){var t;return aq(e)&&((t=e[cq])!==void 0?!!t:oq(e)==="RegExp")},lq=yD,dq=TypeError,xD={};xD[qs("toStringTag")]="z";var Ob=String(xD)==="[object z]",uq=Ob,hq=Ee,r_=H,pq=qs("toStringTag"),mq=Object,fq=r_(function(){return arguments}())==="Arguments",Ic=uq?r_:function(e){var t,s,a;return e===void 0?"Undefined":e===null?"Null":typeof(s=function(c,d){try{return c[d]}catch{}}(t=mq(e),pq))=="string"?s:fq?r_(t):(a=r_(t))==="Object"&&hq(t.callee)?"Arguments":a},gq=Ic,_q=String,ei=function(e){if(gq(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return _q(e)},vq=qs("match"),Eq=qt,yq=function(e){if(lq(e))throw new dq("The method doesn't accept regular expressions");return e},xq=Ct,bD=ei,bq=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[vq]=!1,"/./"[e](t)}catch{}}return!1},wq=C("".indexOf);Eq({target:"String",proto:!0,forced:!bq("includes")},{includes:function(e){return!!~wq(bD(xq(this)),bD(yq(e)),arguments.length>1?arguments[1]:void 0)}});var Sq=zi("String","includes"),wD=N,Cq=iq,Tq=Sq,jb=Array.prototype,Pb=String.prototype,Nq=function(e){var t=e.includes;return e===jb||wD(jb,e)&&t===jb.includes?Cq:typeof e=="string"||e===Pb||wD(Pb,e)&&t===Pb.includes?Tq:t},je=u(Nq),Rq=Zn,Aq=po,Iq=Xe,Dq=Ac,SD=TypeError,CD="Reduce of empty array with no initial value",Oq=function(e){return function(t,s,a,c){var d=Aq(t),h=Iq(d),p=Dq(d);if(Rq(s),p===0&&a<2)throw new SD(CD);var f=0,_=1;if(a<2)for(;;){if(f in h){c=h[f],f+=_;break}if(f+=_,p<=f)throw new SD(CD)}for(;p>f;f+=_)f in h&&(c=s(c,h[f],f,d));return c}},jq={left:Oq()},Pq=m,n_=function(e,t){var s=[][e];return!!s&&Pq(function(){s.call(null,t||function(){return 1},1)})},em=G,kq=ln,Lq=H,i_=function(e){return kq.slice(0,e.length)===e},kb=i_("Bun/")?"BUN":i_("Cloudflare-Workers")?"CLOUDFLARE":i_("Deno/")?"DENO":i_("Node.js/")?"NODE":em.Bun&&typeof Bun.version=="string"?"BUN":em.Deno&&typeof Deno.version=="object"?"DENO":Lq(em.process)==="process"?"NODE":em.window&&em.document?"BROWSER":"REST",a_=kb==="NODE",Mq=jq.left;qt({target:"Array",proto:!0,forced:!a_&&Ta>79&&Ta<83||!n_("reduce")},{reduce:function(e){var t=arguments.length;return Mq(this,e,t,t>1?arguments[1]:void 0)}});var Fq=zi("Array","reduce"),Uq=N,Vq=Fq,Lb=Array.prototype,Bq=function(e){var t=e.reduce;return e===Lb||Uq(Lb,e)&&t===Lb.reduce?Vq:t},TD=Bq,Ki=u(TD),Wq=H,tm=Array.isArray||function(e){return Wq(e)==="Array"},Gq=qt,Hq=tm,zq=C([].reverse),ND=[1,2];Gq({target:"Array",proto:!0,forced:String(ND)===String(ND.reverse())},{reverse:function(){return Hq(this)&&(this.length=this.length),zq(this)}});var Kq=zi("Array","reverse"),qq=N,Yq=Kq,Mb=Array.prototype,$q=function(e){var t=e.reverse;return e===Mb||qq(Mb,e)&&t===Mb.reverse?Yq:t},RD=$q,AD=u(RD),Xq=yb,ID=yu("keys"),o_=function(e){return ID[e]||(ID[e]=Xq(e))},Jq=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Qq=Ur,Zq=Ee,eY=po,tY=Jq,DD=o_("IE_PROTO"),Fb=Object,sY=Fb.prototype,Ub=tY?Fb.getPrototypeOf:function(e){var t=eY(e);if(Qq(t,DD))return t[DD];var s=t.constructor;return Zq(s)&&t instanceof s?s.prototype:t instanceof Fb?sY:null},rY=C,nY=Zn,iY=kt,aY=function(e){return iY(e)||e===null},oY=String,cY=TypeError,lY=function(e,t,s){try{return rY(nY(Object.getOwnPropertyDescriptor(e,t)[s]))}catch{}},dY=kt,uY=Ct,hY=function(e){if(aY(e))return e;throw new cY("Can't set "+oY(e)+" as a prototype")},pY=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,s={};try{(e=lY(Object.prototype,"__proto__","set"))(s,[]),t=s instanceof Array}catch{}return function(a,c){return uY(a),hY(c),dY(a)&&(t?e(a,c):a.__proto__=c),a}}():void 0),c_={},l_={},Vb=Ur,mY=vt,fY=Db.indexOf,gY=l_,OD=C([].push),jD=function(e,t){var s,a=mY(e),c=0,d=[];for(s in a)!Vb(gY,s)&&Vb(a,s)&&OD(d,s);for(;t.length>c;)Vb(a,s=t[c++])&&(~fY(d,s)||OD(d,s));return d},Bb=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_Y=jD,vY=Bb.concat("length","prototype");c_.f=Object.getOwnPropertyNames||function(e){return _Y(e,vY)};var sm={};sm.f=Object.getOwnPropertySymbols;var EY=br,yY=c_,xY=sm,bY=Ln,wY=C([].concat),SY=EY("Reflect","ownKeys")||function(e){var t=yY.f(bY(e)),s=xY.f;return s?wY(t,s(e)):t},PD=Ur,CY=SY,TY=ge,NY=Hi,Wb={},RY=jD,AY=Bb,d_=Object.keys||function(e){return RY(e,AY)},IY=he,DY=fD,OY=Hi,jY=Ln,PY=vt,kY=d_;Wb.f=IY&&!DY?Object.defineProperties:function(e,t){jY(e);for(var s,a=PY(t),c=kY(t),d=c.length,h=0;d>h;)OY.f(e,s=c[h++],a[s]);return e};var u_,kD=br("document","documentElement"),LY=Ln,MY=Wb,LD=Bb,FY=l_,UY=kD,VY=Sb,Gb="prototype",Hb="script",MD=o_("IE_PROTO"),zb=function(){},FD=function(e){return"<"+Hb+">"+e+"</"+Hb+">"},UD=function(e){e.write(FD("")),e.close();var t=e.parentWindow.Object;return e=null,t},h_=function(){try{u_=new ActiveXObject("htmlfile")}catch{}var e,t,s;h_=typeof document<"u"?document.domain&&u_?UD(u_):(t=VY("iframe"),s="java"+Hb+":",t.style.display="none",UY.appendChild(t),t.src=String(s),(e=t.contentWindow.document).open(),e.write(FD("document.F=Object")),e.close(),e.F):UD(u_);for(var a=LD.length;a--;)delete h_[Gb][LD[a]];return h_()};FY[MD]=!0;var rm=Object.create||function(e,t){var s;return e!==null?(zb[Gb]=LY(e),s=new zb,zb[Gb]=null,s[MD]=e):s=h_(),t===void 0?s:MY.f(s,t)},BY=kt,WY=ql,VD=Error,GY=C("".replace),HY=String(new VD("zxcasd").stack),BD=/\n\s*at [^:]*:[^\n]*/,zY=BD.test(HY),KY=Ze,qY=!m(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",KY(1,7)),e.stack!==7)}),YY=ql,$Y=function(e,t){if(zY&&typeof e=="string"&&!VD.prepareStackTrace)for(;t--;)e=GY(e,BD,"");return e},XY=qY,WD=Error.captureStackTrace,Su={},JY=Su,QY=qs("iterator"),ZY=Array.prototype,GD=function(e){return e!==void 0&&(JY.Array===e||ZY[QY]===e)},e$=Ic,HD=t_,t$=ye,s$=Su,r$=qs("iterator"),p_=function(e){if(!t$(e))return HD(e,r$)||HD(e,"@@iterator")||s$[e$(e)]},n$=fe,i$=Zn,a$=Ln,o$=Eu,c$=p_,l$=TypeError,Kb=function(e,t){var s=arguments.length<2?c$(e):t;if(i$(s))return a$(n$(s,e));throw new l$(o$(e)+" is not iterable")},d$=fe,zD=Ln,u$=t_,KD=function(e,t,s){var a,c;zD(e);try{if(!(a=u$(e,"return"))){if(t==="throw")throw s;return s}a=d$(a,e)}catch(d){c=!0,a=d}if(t==="throw")throw s;if(c)throw a;return zD(a),s},h$=Rc,p$=fe,m$=Ln,f$=Eu,g$=GD,_$=Ac,qD=N,v$=Kb,E$=p_,YD=KD,y$=TypeError,m_=function(e,t){this.stopped=e,this.result=t},$D=m_.prototype,nm=function(e,t,s){var a,c,d,h,p,f,_,v=s&&s.that,b=!(!s||!s.AS_ENTRIES),w=!(!s||!s.IS_RECORD),T=!(!s||!s.IS_ITERATOR),U=!(!s||!s.INTERRUPTED),k=h$(t,v),F=function(Y){return a&&YD(a,"normal",Y),new m_(!0,Y)},z=function(Y){return b?(m$(Y),U?k(Y[0],Y[1],F):k(Y[0],Y[1])):U?k(Y,F):k(Y)};if(w)a=e.iterator;else if(T)a=e;else{if(!(c=E$(e)))throw new y$(f$(e)+" is not iterable");if(g$(c)){for(d=0,h=_$(e);h>d;d++)if((p=z(e[d]))&&qD($D,p))return p;return new m_(!1)}a=v$(e,c)}for(f=w?e.next:a.next;!(_=p$(f,a)).done;){try{p=z(_.value)}catch(Y){YD(a,"throw",Y)}if(typeof p=="object"&&p&&qD($D,p))return p}return new m_(!1)},x$=ei,b$=qt,w$=N,S$=Ub,f_=pY,C$=function(e,t,s){for(var a=CY(t),c=NY.f,d=TY.f,h=0;h<a.length;h++){var p=a[h];PD(e,p)||s&&PD(s,p)||c(e,p,d(t,p))}},XD=rm,qb=ql,Yb=Ze,T$=function(e,t){BY(t)&&"cause"in t&&WY(e,"cause",t.cause)},N$=function(e,t,s,a){XY&&(WD?WD(e,t):YY(e,"stack",$Y(s,a)))},R$=nm,A$=function(e,t){return e===void 0?arguments.length<2?"":t:x$(e)},I$=qs("toStringTag"),g_=Error,D$=[].push,Cu=function(e,t){var s,a=w$($b,this);f_?s=f_(new g_,a?S$(this):$b):(s=a?this:XD($b),qb(s,I$,"Error")),t!==void 0&&qb(s,"message",A$(t)),N$(s,Cu,s.stack,1),arguments.length>2&&T$(s,arguments[2]);var c=[];return R$(e,D$,{that:c}),qb(s,"errors",c),s};f_?f_(Cu,g_):C$(Cu,g_,{name:!0});var $b=Cu.prototype=XD(g_.prototype,{constructor:Yb(1,Cu),message:Yb(1,""),name:Yb(1,"AggregateError")});b$({global:!0},{AggregateError:Cu});var __,im,v_,O$=Ee,JD=G.WeakMap,j$=O$(JD)&&/native code/.test(String(JD)),QD=G,P$=kt,k$=ql,Xb=Ur,Jb=Eb,L$=o_,M$=l_,ZD="Object already initialized",Qb=QD.TypeError,F$=QD.WeakMap;if(j$||Jb.state){var mo=Jb.state||(Jb.state=new F$);mo.get=mo.get,mo.has=mo.has,mo.set=mo.set,__=function(e,t){if(mo.has(e))throw new Qb(ZD);return t.facade=e,mo.set(e,t),t},im=function(e){return mo.get(e)||{}},v_=function(e){return mo.has(e)}}else{var Tu=L$("state");M$[Tu]=!0,__=function(e,t){if(Xb(e,Tu))throw new Qb(ZD);return t.facade=e,k$(e,Tu,t),t},im=function(e){return Xb(e,Tu)?e[Tu]:{}},v_=function(e){return Xb(e,Tu)}}var Yl,eO,tO,$l={set:__,get:im,has:v_,enforce:function(e){return v_(e)?im(e):__(e,{})},getterFor:function(e){return function(t){var s;if(!P$(t)||(s=im(t)).type!==e)throw new Qb("Incompatible receiver, "+e+" required");return s}}},Zb=he,U$=Ur,sO=Function.prototype,V$=Zb&&Object.getOwnPropertyDescriptor,rO=U$(sO,"name"),nO={PROPER:rO&&(function(){}).name==="something",CONFIGURABLE:rO&&(!Zb||Zb&&V$(sO,"name").configurable)},B$=ql,Dc=function(e,t,s,a){return a&&a.enumerable?e[t]=s:B$(e,t,s),e},W$=m,G$=Ee,H$=kt,z$=rm,iO=Ub,K$=Dc,ew=qs("iterator"),aO=!1;[].keys&&("next"in(tO=[].keys())?(eO=iO(iO(tO)))!==Object.prototype&&(Yl=eO):aO=!0);var q$=!H$(Yl)||W$(function(){var e={};return Yl[ew].call(e)!==e});G$((Yl=q$?{}:z$(Yl))[ew])||K$(Yl,ew,function(){return this});var oO={IteratorPrototype:Yl,BUGGY_SAFARI_ITERATORS:aO},Y$=Ic,$$=Ob?{}.toString:function(){return"[object "+Y$(this)+"]"},X$=Ob,J$=Hi.f,Q$=ql,Z$=Ur,eX=$$,cO=qs("toStringTag"),Xo=function(e,t,s,a){var c=s?e:e&&e.prototype;c&&(Z$(c,cO)||J$(c,cO,{configurable:!0,value:t}),a&&!X$&&Q$(c,"toString",eX))},tX=oO.IteratorPrototype,sX=rm,rX=Ze,nX=Xo,iX=Su,aX=function(){return this},tw=function(e,t,s,a){var c=t+" Iterator";return e.prototype=sX(tX,{next:rX(+!a,s)}),nX(e,c,!1,!0),iX[c]=aX,e},oX=qt,cX=fe,lX=nO,dX=tw,uX=Ub,hX=Xo,lO=Dc,dO=Su,pX=oO,mX=lX.PROPER,E_=pX.BUGGY_SAFARI_ITERATORS,sw=qs("iterator"),uO="keys",y_="values",hO="entries",fX=function(){return this},pO=function(e,t,s,a,c,d,h){dX(s,t,a);var p,f,_,v=function(z){if(z===c&&k)return k;if(!E_&&z&&z in T)return T[z];switch(z){case uO:case y_:case hO:return function(){return new s(this,z)}}return function(){return new s(this)}},b=t+" Iterator",w=!1,T=e.prototype,U=T[sw]||T["@@iterator"]||c&&T[c],k=!E_&&U||v(c),F=t==="Array"&&T.entries||U;if(F&&(p=uX(F.call(new e)))!==Object.prototype&&p.next&&(hX(p,b,!0,!0),dO[b]=fX),mX&&c===y_&&U&&U.name!==y_&&(w=!0,k=function(){return cX(U,this)}),c)if(f={values:v(y_),keys:d?k:v(uO),entries:v(hO)},h)for(_ in f)(E_||w||!(_ in T))&&lO(T,_,f[_]);else oX({target:t,proto:!0,forced:E_||w},f);return h&&T[sw]!==k&&lO(T,sw,k,{}),dO[t]=k,f},x_=function(e,t){return{value:e,done:t}},gX=vt,mO=Su,fO=$l;Hi.f;var _X=pO,b_=x_,gO="Array Iterator",vX=fO.set,EX=fO.getterFor(gO);_X(Array,"Array",function(e,t){vX(this,{type:gO,target:gX(e),index:0,kind:t})},function(){var e=EX(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,b_(void 0,!0);switch(e.kind){case"keys":return b_(s,!1);case"values":return b_(t[s],!1)}return b_([s,t[s]],!1)},"values"),mO.Arguments=mO.Array;var yX=Hi,w_=function(e,t,s){return yX.f(e,t,s)},xX=br,bX=w_,wX=he,_O=qs("species"),SX=N,CX=TypeError,rw=function(e,t){if(SX(t,e))return e;throw new CX("Incorrect invocation")},TX=Ee,nw=Eb,NX=C(Function.toString);TX(nw.inspectSource)||(nw.inspectSource=function(e){return NX(e)});var vO=nw.inspectSource,RX=C,AX=m,EO=Ee,IX=Ic,DX=vO,yO=function(){},xO=br("Reflect","construct"),iw=/^\s*(?:class|function)\b/,OX=RX(iw.exec),jX=!iw.test(yO),am=function(e){if(!EO(e))return!1;try{return xO(yO,[],e),!0}catch{return!1}},bO=function(e){if(!EO(e))return!1;switch(IX(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return jX||!!OX(iw,DX(e))}catch{return!0}};bO.sham=!0;var om,Nu,wO,aw,S_=!xO||AX(function(){var e;return am(am.call)||!am(Object)||!am(function(){e=!0})||e})?bO:am,PX=S_,kX=Eu,LX=TypeError,SO=Ln,MX=function(e){if(PX(e))return e;throw new LX(kX(e)+" is not a constructor")},FX=ye,UX=qs("species"),ow=function(e,t){var s,a=SO(e).constructor;return a===void 0||FX(s=SO(a)[UX])?t:MX(s)},Oc=C([].slice),VX=TypeError,Xl=function(e,t){if(e<t)throw new VX("Not enough arguments");return e},CO=/(?:ipad|iphone|ipod).*applewebkit/i.test(ln),bi=G,BX=D,WX=Rc,TO=Ee,GX=Ur,NO=m,RO=kD,HX=Oc,AO=Sb,zX=Xl,KX=CO,qX=a_,cw=bi.setImmediate,lw=bi.clearImmediate,YX=bi.process,dw=bi.Dispatch,$X=bi.Function,IO=bi.MessageChannel,XX=bi.String,uw=0,cm={},DO="onreadystatechange";NO(function(){om=bi.location});var hw=function(e){if(GX(cm,e)){var t=cm[e];delete cm[e],t()}},pw=function(e){return function(){hw(e)}},OO=function(e){hw(e.data)},jO=function(e){bi.postMessage(XX(e),om.protocol+"//"+om.host)};cw&&lw||(cw=function(e){zX(arguments.length,1);var t=TO(e)?e:$X(e),s=HX(arguments,1);return cm[++uw]=function(){BX(t,void 0,s)},Nu(uw),uw},lw=function(e){delete cm[e]},qX?Nu=function(e){YX.nextTick(pw(e))}:dw&&dw.now?Nu=function(e){dw.now(pw(e))}:IO&&!KX?(aw=(wO=new IO).port2,wO.port1.onmessage=OO,Nu=WX(aw.postMessage,aw)):bi.addEventListener&&TO(bi.postMessage)&&!bi.importScripts&&om&&om.protocol!=="file:"&&!NO(jO)?(Nu=jO,bi.addEventListener("message",OO,!1)):Nu=DO in AO("script")?function(e){RO.appendChild(AO("script"))[DO]=function(){RO.removeChild(this),hw(e)}}:function(e){setTimeout(pw(e),0)});var C_={set:cw,clear:lw},PO=G,JX=he,QX=Object.getOwnPropertyDescriptor,kO=function(e){if(!JX)return PO[e];var t=QX(PO,e);return t&&t.value},LO=function(){this.head=null,this.tail=null};LO.prototype={add:function(e){var t={item:e,next:null},s=this.tail;s?s.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Ru,mw,fw,gw,MO,FO=LO,ZX=/ipad|iphone|ipod/i.test(ln)&&typeof Pebble<"u",eJ=/web0s(?!.*chrome)/i.test(ln),Au=G,tJ=kO,UO=Rc,_w=C_.set,sJ=FO,rJ=CO,nJ=ZX,iJ=eJ,vw=a_,VO=Au.MutationObserver||Au.WebKitMutationObserver,BO=Au.document,WO=Au.process,T_=Au.Promise,Ew=tJ("queueMicrotask");if(!Ew){var N_=new sJ,R_=function(){var e,t;for(vw&&(e=WO.domain)&&e.exit();t=N_.get();)try{t()}catch(s){throw N_.head&&Ru(),s}e&&e.enter()};rJ||vw||iJ||!VO||!BO?!nJ&&T_&&T_.resolve?((gw=T_.resolve(void 0)).constructor=T_,MO=UO(gw.then,gw),Ru=function(){MO(R_)}):vw?Ru=function(){WO.nextTick(R_)}:(_w=UO(_w,Au),Ru=function(){_w(R_)}):(mw=!0,fw=BO.createTextNode(""),new VO(R_).observe(fw,{characterData:!0}),Ru=function(){fw.data=mw=!mw}),Ew=function(e){N_.head||Ru(),N_.add(e)}}var GO=Ew,Iu=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Jl=G.Promise,aJ=G,lm=Jl,oJ=Ee,cJ=mD,lJ=vO,dJ=qs,HO=kb,yw=Ta,zO=lm&&lm.prototype,uJ=dJ("species"),KO=oJ(aJ.PromiseRejectionEvent),hJ=cJ("Promise",function(){var e=lJ(lm),t=e!==String(lm);if(!t&&yw===66||!zO.catch||!zO.finally)return!0;if(!yw||yw<51||!/native code/.test(e)){var s=new lm(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((s.constructor={})[uJ]=a,!(s.then(function(){})instanceof a))return!0}return!(t||HO!=="BROWSER"&&HO!=="DENO"||KO)}),dm={CONSTRUCTOR:hJ,REJECTION_EVENT:KO},fo={},qO=Zn,pJ=TypeError,mJ=function(e){var t,s;this.promise=new e(function(a,c){if(t!==void 0||s!==void 0)throw new pJ("Bad Promise constructor");t=a,s=c}),this.resolve=qO(t),this.reject=qO(s)};fo.f=function(e){return new mJ(e)};var xw,YO,fJ=qt,A_=a_,jc=G,um=fe,gJ=Dc,_J=Xo,vJ=function(e){var t=xX(e);wX&&t&&!t[_O]&&bX(t,_O,{configurable:!0,get:function(){return this}})},EJ=Zn,bw=Ee,yJ=kt,xJ=rw,bJ=ow,$O=C_.set,ww=GO,wJ=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},SJ=Iu,CJ=FO,XO=$l,Sw=Jl,JO=dm,QO=fo,I_="Promise",ZO=JO.CONSTRUCTOR,TJ=JO.REJECTION_EVENT,Cw=XO.getterFor(I_),NJ=XO.set,RJ=Sw&&Sw.prototype,hm=Sw,Tw=RJ,ej=jc.TypeError,Nw=jc.document,Rw=jc.process,Aw=QO.f,AJ=Aw,IJ=!!(Nw&&Nw.createEvent&&jc.dispatchEvent),tj="unhandledrejection",sj=function(e){var t;return!(!yJ(e)||!bw(t=e.then))&&t},rj=function(e,t){var s,a,c,d=t.value,h=t.state===1,p=h?e.ok:e.fail,f=e.resolve,_=e.reject,v=e.domain;try{p?(h||(t.rejection===2&&OJ(t),t.rejection=1),p===!0?s=d:(v&&v.enter(),s=p(d),v&&(v.exit(),c=!0)),s===e.promise?_(new ej("Promise-chain cycle")):(a=sj(s))?um(a,s,f,_):f(s)):_(d)}catch(b){v&&!c&&v.exit(),_(b)}},nj=function(e,t){e.notified||(e.notified=!0,ww(function(){for(var s,a=e.reactions;s=a.get();)rj(s,e);e.notified=!1,t&&!e.rejection&&DJ(e)}))},ij=function(e,t,s){var a,c;IJ?((a=Nw.createEvent("Event")).promise=t,a.reason=s,a.initEvent(e,!1,!0),jc.dispatchEvent(a)):a={promise:t,reason:s},!TJ&&(c=jc["on"+e])?c(a):e===tj&&wJ("Unhandled promise rejection",s)},DJ=function(e){um($O,jc,function(){var t,s=e.facade,a=e.value;if(aj(e)&&(t=SJ(function(){A_?Rw.emit("unhandledRejection",a,s):ij(tj,s,a)}),e.rejection=A_||aj(e)?2:1,t.error))throw t.value})},aj=function(e){return e.rejection!==1&&!e.parent},OJ=function(e){um($O,jc,function(){var t=e.facade;A_?Rw.emit("rejectionHandled",t):ij("rejectionhandled",t,e.value)})},Du=function(e,t,s){return function(a){e(t,a,s)}},Ou=function(e,t,s){e.done||(e.done=!0,s&&(e=s),e.value=t,e.state=2,nj(e,!0))},Iw=function(e,t,s){if(!e.done){e.done=!0,s&&(e=s);try{if(e.facade===t)throw new ej("Promise can't be resolved itself");var a=sj(t);a?ww(function(){var c={done:!1};try{um(a,t,Du(Iw,c,e),Du(Ou,c,e))}catch(d){Ou(c,d,e)}}):(e.value=t,e.state=1,nj(e,!1))}catch(c){Ou({done:!1},c,e)}}};ZO&&(Tw=(hm=function(e){xJ(this,Tw),EJ(e),um(xw,this);var t=Cw(this);try{e(Du(Iw,t),Du(Ou,t))}catch(s){Ou(t,s)}}).prototype,(xw=function(e){NJ(this,{type:I_,done:!1,notified:!1,parent:!1,reactions:new CJ,rejection:!1,state:0,value:null})}).prototype=gJ(Tw,"then",function(e,t){var s=Cw(this),a=Aw(bJ(this,hm));return s.parent=!0,a.ok=!bw(e)||e,a.fail=bw(t)&&t,a.domain=A_?Rw.domain:void 0,s.state===0?s.reactions.add(a):ww(function(){rj(a,s)}),a.promise}),YO=function(){var e=new xw,t=Cw(e);this.promise=e,this.resolve=Du(Iw,t),this.reject=Du(Ou,t)},QO.f=Aw=function(e){return e===hm||e===void 0?new YO(e):AJ(e)}),fJ({global:!0,wrap:!0,forced:ZO},{Promise:hm}),_J(hm,I_,!1,!0),vJ(I_);var oj=qs("iterator"),cj=!1;try{var jJ=0,lj={next:function(){return{done:!!jJ++}},return:function(){cj=!0}};lj[oj]=function(){return this},Array.from(lj,function(){throw 2})}catch{}var PJ=Jl,kJ=function(e,t){try{if(!t&&!cj)return!1}catch{return!1}var s=!1;try{var a={};a[oj]=function(){return{next:function(){return{done:s=!0}}}},e(a)}catch{}return s},D_=dm.CONSTRUCTOR||!kJ(function(e){PJ.all(e).then(void 0,function(){})}),LJ=fe,MJ=Zn,FJ=fo,UJ=Iu,VJ=nm;qt({target:"Promise",stat:!0,forced:D_},{all:function(e){var t=this,s=FJ.f(t),a=s.resolve,c=s.reject,d=UJ(function(){var h=MJ(t.resolve),p=[],f=0,_=1;VJ(e,function(v){var b=f++,w=!1;_++,LJ(h,t,v).then(function(T){w||(w=!0,p[b]=T,--_||a(p))},c)}),--_||a(p)});return d.error&&c(d.value),s.promise}});var BJ=qt,WJ=dm.CONSTRUCTOR;Jl&&Jl.prototype,BJ({target:"Promise",proto:!0,forced:WJ,real:!0},{catch:function(e){return this.then(void 0,e)}});var GJ=fe,HJ=Zn,zJ=fo,KJ=Iu,qJ=nm;qt({target:"Promise",stat:!0,forced:D_},{race:function(e){var t=this,s=zJ.f(t),a=s.reject,c=KJ(function(){var d=HJ(t.resolve);qJ(e,function(h){GJ(d,t,h).then(s.resolve,a)})});return c.error&&a(c.value),s.promise}});var YJ=fo;qt({target:"Promise",stat:!0,forced:dm.CONSTRUCTOR},{reject:function(e){var t=YJ.f(this);return(0,t.reject)(e),t.promise}});var $J=Ln,XJ=kt,JJ=fo,dj=function(e,t){if($J(e),XJ(t)&&t.constructor===e)return t;var s=JJ.f(e);return(0,s.resolve)(t),s.promise},QJ=qt,ZJ=Jl,eQ=dm.CONSTRUCTOR,tQ=dj,sQ=br("Promise"),rQ=!eQ;QJ({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return tQ(rQ&&this===sQ?ZJ:this,e)}});var nQ=fe,iQ=Zn,aQ=fo,oQ=Iu,cQ=nm;qt({target:"Promise",stat:!0,forced:D_},{allSettled:function(e){var t=this,s=aQ.f(t),a=s.resolve,c=s.reject,d=oQ(function(){var h=iQ(t.resolve),p=[],f=0,_=1;cQ(e,function(v){var b=f++,w=!1;_++,nQ(h,t,v).then(function(T){w||(w=!0,p[b]={status:"fulfilled",value:T},--_||a(p))},function(T){w||(w=!0,p[b]={status:"rejected",reason:T},--_||a(p))})}),--_||a(p)});return d.error&&c(d.value),s.promise}});var lQ=fe,dQ=Zn,uQ=br,hQ=fo,pQ=Iu,mQ=nm,uj="No one promise resolved";qt({target:"Promise",stat:!0,forced:D_},{any:function(e){var t=this,s=uQ("AggregateError"),a=hQ.f(t),c=a.resolve,d=a.reject,h=pQ(function(){var p=dQ(t.resolve),f=[],_=0,v=1,b=!1;mQ(e,function(w){var T=_++,U=!1;v++,lQ(p,t,w).then(function(k){U||b||(b=!0,c(k))},function(k){U||b||(U=!0,f[T]=k,--v||d(new s(f,uj)))})}),--v||d(new s(f,uj))});return h.error&&d(h.value),a.promise}});var fQ=qt,gQ=D,_Q=Oc,vQ=fo,EQ=Zn,hj=Iu,Dw=G.Promise,pj=!1;fQ({target:"Promise",stat:!0,forced:!Dw||!Dw.try||hj(function(){Dw.try(function(e){pj=e===8},8)}).error||!pj},{try:function(e){var t=arguments.length>1?_Q(arguments,1):[],s=vQ.f(this),a=hj(function(){return gQ(EQ(e),void 0,t)});return(a.error?s.reject:s.resolve)(a.value),s.promise}});var yQ=fo;qt({target:"Promise",stat:!0},{withResolvers:function(){var e=yQ.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var xQ=qt,Ow=Jl,bQ=m,wQ=br,SQ=Ee,CQ=ow,mj=dj,TQ=Ow&&Ow.prototype;xQ({target:"Promise",proto:!0,real:!0,forced:!!Ow&&bQ(function(){TQ.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=CQ(this,wQ("Promise")),s=SQ(e);return this.then(s?function(a){return mj(t,e()).then(function(){return a})}:e,s?function(a){return mj(t,e()).then(function(){throw a})}:e)}});var jw=C,NQ=Ab,RQ=ei,AQ=Ct,IQ=jw("".charAt),fj=jw("".charCodeAt),DQ=jw("".slice),gj=function(e){return function(t,s){var a,c,d=RQ(AQ(t)),h=NQ(s),p=d.length;return h<0||h>=p?e?"":void 0:(a=fj(d,h))<55296||a>56319||h+1===p||(c=fj(d,h+1))<56320||c>57343?e?IQ(d,h):a:e?DQ(d,h,h+2):c-56320+(a-55296<<10)+65536}},Pw={codeAt:gj(!1),charAt:gj(!0)},OQ=Pw.charAt,jQ=ei,_j=$l,PQ=pO,vj=x_,Ej="String Iterator",kQ=_j.set,LQ=_j.getterFor(Ej);PQ(String,"String",function(e){kQ(this,{type:Ej,string:jQ(e),index:0})},function(){var e,t=LQ(this),s=t.string,a=t.index;return a>=s.length?vj(void 0,!0):(e=OQ(s,a),t.index+=e.length,vj(e,!1))});var MQ=Ps.Promise,FQ={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},UQ=G,VQ=Xo,yj=Su;for(var kw in FQ)VQ(UQ[kw],kw),yj[kw]=yj.Array;var xj=MQ,Ve=u(xj),BQ=zi("Array","values"),WQ=Ic,GQ=Ur,HQ=N,zQ=BQ,Lw=Array.prototype,KQ={DOMTokenList:!0,NodeList:!0},qQ=function(e){var t=e.values;return e===Lw||HQ(Lw,e)&&t===Lw.values||GQ(KQ,WQ(e))?zQ:t},Mn=u(qQ),bj=Eu,YQ=TypeError,wj=Oc,$Q=Math.floor,Mw=function(e,t){var s=e.length;if(s<8)for(var a,c,d=1;d<s;){for(c=d,a=e[d];c&&t(e[c-1],a)>0;)e[c]=e[--c];c!==d++&&(e[c]=a)}else for(var h=$Q(s/2),p=Mw(wj(e,0,h),t),f=Mw(wj(e,h),t),_=p.length,v=f.length,b=0,w=0;b<_||w<v;)e[b+w]=b<_&&w<v?t(p[b],f[w])<=0?p[b++]:f[w++]:b<_?p[b++]:f[w++];return e},Sj=Mw,Cj=ln.match(/firefox\/(\d+)/i),XQ=!!Cj&&+Cj[1],JQ=/MSIE|Trident/.test(ln),Tj=ln.match(/AppleWebKit\/(\d+)\./),QQ=!!Tj&&+Tj[1],ZQ=qt,Nj=C,eZ=Zn,tZ=po,Rj=Ac,sZ=function(e,t){if(!delete e[t])throw new YQ("Cannot delete property "+bj(t)+" of "+bj(e))},Aj=ei,Fw=m,rZ=Sj,nZ=n_,Ij=XQ,iZ=JQ,Dj=Ta,Oj=QQ,Pc=[],jj=Nj(Pc.sort),aZ=Nj(Pc.push),oZ=Fw(function(){Pc.sort(void 0)}),cZ=Fw(function(){Pc.sort(null)}),lZ=nZ("sort"),Pj=!Fw(function(){if(Dj)return Dj<70;if(!(Ij&&Ij>3)){if(iZ)return!0;if(Oj)return Oj<603;var e,t,s,a,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)Pc.push({k:t+a,v:s})}for(Pc.sort(function(d,h){return h.v-d.v}),a=0;a<Pc.length;a++)t=Pc[a].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}});ZQ({target:"Array",proto:!0,forced:oZ||!cZ||!lZ||!Pj},{sort:function(e){e!==void 0&&eZ(e);var t=tZ(this);if(Pj)return e===void 0?jj(t):jj(t,e);var s,a,c=[],d=Rj(t);for(a=0;a<d;a++)a in t&&aZ(c,t[a]);for(rZ(c,function(h){return function(p,f){return f===void 0?-1:p===void 0?1:h!==void 0?+h(p,f)||0:Aj(p)>Aj(f)?1:-1}}(e)),s=Rj(c),a=0;a<s;)t[a]=c[a++];for(;a<d;)sZ(t,a++);return t}});var dZ=zi("Array","sort"),uZ=N,hZ=dZ,Uw=Array.prototype,pZ=function(e){var t=e.sort;return e===Uw||uZ(Uw,e)&&t===Uw.sort?hZ:t},Ql=u(pZ),mZ=qt,fZ=C,gZ=Ib,_Z=RangeError,kj=String.fromCharCode,Lj=String.fromCodePoint,vZ=fZ([].join);mZ({target:"String",stat:!0,forced:!!Lj&&Lj.length!==1},{fromCodePoint:function(e){for(var t,s=[],a=arguments.length,c=0;a>c;){if(t=+arguments[c++],gZ(t,1114111)!==t)throw new _Z(t+" is not a valid code point");s[c]=t<65536?kj(t):kj(55296+((t-=65536)>>10),t%1024+56320)}return vZ(s,"")}});var EZ=m,yZ=qs("iterator"),O_=!EZ(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),a="";return e.pathname="c%20d",t.forEach(function(c,d){t.delete("b"),a+=d+c}),s.delete("a",2),s.delete("b",void 0),!e.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[yZ]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"}),xZ=Dc,Vw=qt,Mj=G,Bw=kO,bZ=br,j_=fe,Ra=C,pm=he,Fj=O_,Uj=Dc,wZ=w_,SZ=function(e,t,s){for(var a in t)s&&s.unsafe&&e[a]?e[a]=t[a]:xZ(e,a,t[a],s);return e},CZ=Xo,TZ=tw,Ww=$l,Vj=rw,Gw=Ee,NZ=Ur,RZ=Rc,AZ=Ic,IZ=Ln,Bj=kt,Fn=ei,DZ=rm,Wj=Ze,Gj=Kb,OZ=p_,P_=x_,ju=Xl,jZ=Sj,PZ=qs("iterator"),Pu="URLSearchParams",Hj=Pu+"Iterator",zj=Ww.set,qi=Ww.getterFor(Pu),kZ=Ww.getterFor(Hj),Kj=Bw("fetch"),k_=Bw("Request"),mm=Bw("Headers"),Hw=k_&&k_.prototype,qj=mm&&mm.prototype,LZ=Mj.TypeError,MZ=Mj.encodeURIComponent,FZ=String.fromCharCode,UZ=bZ("String","fromCodePoint"),VZ=parseInt,L_=Ra("".charAt),Yj=Ra([].join),kc=Ra([].push),$j=Ra("".replace),BZ=Ra([].shift),Xj=Ra([].splice),Jj=Ra("".split),Qj=Ra("".slice),WZ=Ra(/./.exec),GZ=/\+/g,HZ=/^[0-9a-f]+$/i,Zj=function(e,t){var s=Qj(e,t,t+2);return WZ(HZ,s)?VZ(s,16):NaN},zZ=function(e){for(var t=0,s=128;s>0&&e&s;s>>=1)t++;return t},KZ=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},eP=function(e){for(var t=(e=$j(e,GZ," ")).length,s="",a=0;a<t;){var c=L_(e,a);if(c==="%"){if(L_(e,a+1)==="%"||a+3>t){s+="%",a++;continue}var d=Zj(e,a+1);if(d!=d){s+=c,a++;continue}a+=2;var h=zZ(d);if(h===0)c=FZ(d);else{if(h===1||h>4){s+="",a++;continue}for(var p=[d],f=1;f<h&&!(++a+3>t||L_(e,a)!=="%");){var _=Zj(e,a+1);if(_!=_){a+=3;break}if(_>191||_<128)break;kc(p,_),a+=2,f++}if(p.length!==h){s+="";continue}var v=KZ(p);v===null?s+="":c=UZ(v)}}s+=c,a++}return s},qZ=/[!'()~]|%20/g,YZ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},$Z=function(e){return YZ[e]},tP=function(e){return $j(MZ(e),qZ,$Z)},zw=TZ(function(e,t){zj(this,{type:Hj,target:qi(e).entries,index:0,kind:t})},Pu,function(){var e=kZ(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,P_(void 0,!0);var a=t[s];switch(e.kind){case"keys":return P_(a.key,!1);case"values":return P_(a.value,!1)}return P_([a.key,a.value],!1)},!0),sP=function(e){this.entries=[],this.url=null,e!==void 0&&(Bj(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?L_(e,0)==="?"?Qj(e,1):e:Fn(e)))};sP.prototype={type:Pu,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,s,a,c,d,h,p,f=this.entries,_=OZ(e);if(_)for(s=(t=Gj(e,_)).next;!(a=j_(s,t)).done;){if(d=(c=Gj(IZ(a.value))).next,(h=j_(d,c)).done||(p=j_(d,c)).done||!j_(d,c).done)throw new LZ("Expected sequence with length 2");kc(f,{key:Fn(h.value),value:Fn(p.value)})}else for(var v in e)NZ(e,v)&&kc(f,{key:v,value:Fn(e[v])})},parseQuery:function(e){if(e)for(var t,s,a=this.entries,c=Jj(e,"&"),d=0;d<c.length;)(t=c[d++]).length&&(s=Jj(t,"="),kc(a,{key:eP(BZ(s)),value:eP(Yj(s,"="))}))},serialize:function(){for(var e,t=this.entries,s=[],a=0;a<t.length;)e=t[a++],kc(s,tP(e.key)+"="+tP(e.value));return Yj(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var M_=function(){Vj(this,ku);var e=zj(this,new sP(arguments.length>0?arguments[0]:void 0));pm||(this.size=e.entries.length)},ku=M_.prototype;if(SZ(ku,{append:function(e,t){var s=qi(this);ju(arguments.length,2),kc(s.entries,{key:Fn(e),value:Fn(t)}),pm||this.length++,s.updateURL()},delete:function(e){for(var t=qi(this),s=ju(arguments.length,1),a=t.entries,c=Fn(e),d=s<2?void 0:arguments[1],h=d===void 0?d:Fn(d),p=0;p<a.length;){var f=a[p];if(f.key!==c||h!==void 0&&f.value!==h)p++;else if(Xj(a,p,1),h!==void 0)break}pm||(this.size=a.length),t.updateURL()},get:function(e){var t=qi(this).entries;ju(arguments.length,1);for(var s=Fn(e),a=0;a<t.length;a++)if(t[a].key===s)return t[a].value;return null},getAll:function(e){var t=qi(this).entries;ju(arguments.length,1);for(var s=Fn(e),a=[],c=0;c<t.length;c++)t[c].key===s&&kc(a,t[c].value);return a},has:function(e){for(var t=qi(this).entries,s=ju(arguments.length,1),a=Fn(e),c=s<2?void 0:arguments[1],d=c===void 0?c:Fn(c),h=0;h<t.length;){var p=t[h++];if(p.key===a&&(d===void 0||p.value===d))return!0}return!1},set:function(e,t){var s=qi(this);ju(arguments.length,1);for(var a,c=s.entries,d=!1,h=Fn(e),p=Fn(t),f=0;f<c.length;f++)(a=c[f]).key===h&&(d?Xj(c,f--,1):(d=!0,a.value=p));d||kc(c,{key:h,value:p}),pm||(this.size=c.length),s.updateURL()},sort:function(){var e=qi(this);jZ(e.entries,function(t,s){return t.key>s.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,s=qi(this).entries,a=RZ(e,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((t=s[c++]).value,t.key,this)},keys:function(){return new zw(this,"keys")},values:function(){return new zw(this,"values")},entries:function(){return new zw(this,"entries")}},{enumerable:!0}),Uj(ku,PZ,ku.entries,{}),Uj(ku,"toString",function(){return qi(this).serialize()},{enumerable:!0}),pm&&wZ(ku,"size",{get:function(){return qi(this).entries.length},configurable:!0,enumerable:!0}),CZ(M_,Pu),Vw({global:!0,forced:!Fj},{URLSearchParams:M_}),!Fj&&Gw(mm)){var XZ=Ra(qj.has),JZ=Ra(qj.set),rP=function(e){if(Bj(e)){var t,s=e.body;if(AZ(s)===Pu)return t=e.headers?new mm(e.headers):new mm,XZ(t,"content-type")||JZ(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),DZ(e,{body:Wj(0,Fn(s)),headers:Wj(0,t)})}return e};if(Gw(Kj)&&Vw({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Kj(e,arguments.length>1?rP(arguments[1]):{})}}),Gw(k_)){var Kw=function(e){return Vj(this,Hw),new k_(e,arguments.length>1?rP(arguments[1]):{})};Hw.constructor=Kw,Kw.prototype=Hw,Vw({global:!0,dontCallGetSet:!0,forced:!0},{Request:Kw})}}var Yi,QZ={URLSearchParams:M_,getState:qi},ZZ=Ps.URLSearchParams,nP=he,eee=C,tee=fe,see=m,qw=d_,ree=sm,nee=ae,iee=po,aee=Xe,Lu=Object.assign,iP=Object.defineProperty,oee=eee([].concat),cee=!Lu||see(function(){if(nP&&Lu({b:1},Lu(iP({},"a",{enumerable:!0,get:function(){iP(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},s=Symbol("assign detection"),a="abcdefghijklmnopqrst";return e[s]=7,a.split("").forEach(function(c){t[c]=c}),Lu({},e)[s]!==7||qw(Lu({},t)).join("")!==a})?function(e,t){for(var s=iee(e),a=arguments.length,c=1,d=ree.f,h=nee.f;a>c;)for(var p,f=aee(arguments[c++]),_=d?oee(qw(f),d(f)):qw(f),v=_.length,b=0;v>b;)p=_[b++],nP&&!tee(h,f,p)||(s[p]=f[p]);return s}:Lu,lee=Ln,dee=KD,uee=he,hee=Hi,pee=Ze,Yw=function(e,t,s){uee?hee.f(e,t,pee(0,s)):e[t]=s},mee=Rc,fee=fe,gee=po,_ee=function(e,t,s,a){try{return a?t(lee(s)[0],s[1]):t(s)}catch(c){dee(e,"throw",c)}},vee=GD,Eee=S_,yee=Ac,aP=Yw,xee=Kb,bee=p_,oP=Array,Zl=C,$w=2147483647,wee=/[^\0-\u007E]/,cP=/[.\u3002\uFF0E\uFF61]/g,lP="Overflow: input needs wider integers to process",dP=RangeError,See=Zl(cP.exec),Mu=Math.floor,Xw=String.fromCharCode,uP=Zl("".charCodeAt),hP=Zl([].join),Lc=Zl([].push),Cee=Zl("".replace),Tee=Zl("".split),Nee=Zl("".toLowerCase),pP=function(e){return e+22+75*(e<26)},Ree=function(e,t,s){var a=0;for(e=s?Mu(e/700):e>>1,e+=Mu(e/t);e>455;)e=Mu(e/35),a+=36;return Mu(a+36*e/(e+38))},Aee=function(e){var t=[];e=function(z){for(var Y=[],X=0,re=z.length;X<re;){var te=uP(z,X++);if(te>=55296&&te<=56319&&X<re){var Z=uP(z,X++);(64512&Z)==56320?Lc(Y,((1023&te)<<10)+(1023&Z)+65536):(Lc(Y,te),X--)}else Lc(Y,te)}return Y}(e);var s,a,c=e.length,d=128,h=0,p=72;for(s=0;s<e.length;s++)(a=e[s])<128&&Lc(t,Xw(a));var f=t.length,_=f;for(f&&Lc(t,"-");_<c;){var v=$w;for(s=0;s<e.length;s++)(a=e[s])>=d&&a<v&&(v=a);var b=_+1;if(v-d>Mu(($w-h)/b))throw new dP(lP);for(h+=(v-d)*b,d=v,s=0;s<e.length;s++){if((a=e[s])<d&&++h>$w)throw new dP(lP);if(a===d){for(var w=h,T=36;;){var U=T<=p?1:T>=p+26?26:T-p;if(w<U)break;var k=w-U,F=36-U;Lc(t,Xw(pP(U+k%F))),w=Mu(k/F),T+=36}Lc(t,Xw(pP(w))),p=Ree(h,b,_===f),h=0,_++}}h++,d++}return hP(t,"")},Iee=qt,Jw=he,Dee=O_,Qw=G,mP=Rc,$i=C,F_=Dc,Xi=w_,Oee=rw,Zw=Ur,eS=cee,Fu=function(e){var t=gee(e),s=Eee(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=mee(c,a>2?arguments[2]:void 0));var h,p,f,_,v,b,w=bee(t),T=0;if(!w||this===oP&&vee(w))for(h=yee(t),p=s?new this(h):oP(h);h>T;T++)b=d?c(t[T],T):t[T],aP(p,T,b);else for(p=s?new this:[],v=(_=xee(t,w)).next;!(f=fee(v,_)).done;T++)b=d?_ee(_,c,[f.value,T],!0):f.value,aP(p,T,b);return p.length=T,p},Aa=Oc,jee=Pw.codeAt,Pee=function(e){var t,s,a=[],c=Tee(Cee(Nee(e),cP,"."),".");for(t=0;t<c.length;t++)s=c[t],Lc(a,See(wee,s)?"xn--"+Aee(s):s);return hP(a,".")},Jo=ei,kee=Xo,Lee=Xl,fP=QZ,gP=$l,Mee=gP.set,U_=gP.getterFor("URL"),Fee=fP.URLSearchParams,Uee=fP.getState,fm=Qw.URL,tS=Qw.TypeError,V_=Qw.parseInt,Vee=Math.floor,_P=Math.pow,Ji=$i("".charAt),Ia=$i(/./.exec),gm=$i([].join),Bee=$i(1 .toString),Wee=$i([].pop),Uu=$i([].push),sS=$i("".replace),Gee=$i([].shift),Hee=$i("".split),_m=$i("".slice),B_=$i("".toLowerCase),zee=$i([].unshift),rS="Invalid scheme",vm="Invalid host",vP="Invalid port",EP=/[a-z]/i,Kee=/[\d+-.a-z]/i,nS=/\d/,qee=/^0x/i,Yee=/^[0-7]+$/,$ee=/^\d+$/,yP=/^[\da-f]+$/i,Xee=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Jee=/[\0\t\n\r #/:<>?@[\\\]^|]/,Qee=/^[\u0000-\u0020]+/,Zee=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,ete=/[\t\n\r]/g,Em=function(e){var t,s,a,c;if(typeof e=="number"){for(t=[],s=0;s<4;s++)zee(t,e%256),e=Vee(e/256);return gm(t,".")}if(typeof e=="object"){for(t="",a=function(d){for(var h=null,p=1,f=null,_=0,v=0;v<8;v++)d[v]!==0?(_>p&&(h=f,p=_),f=null,_=0):(f===null&&(f=v),++_);return _>p?f:h}(e),s=0;s<8;s++)c&&e[s]===0||(c&&(c=!1),a===s?(t+=s?":":"::",c=!0):(t+=Bee(e[s],16),s<7&&(t+=":")));return"["+t+"]"}return e},W_={},xP=eS({},W_,{" ":1,'"':1,"<":1,">":1,"`":1}),bP=eS({},xP,{"#":1,"?":1,"{":1,"}":1}),iS=eS({},bP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Mc=function(e,t){var s=jee(e,0);return s>32&&s<127&&!Zw(t,e)?e:encodeURIComponent(e)},G_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ym=function(e,t){var s;return e.length===2&&Ia(EP,Ji(e,0))&&((s=Ji(e,1))===":"||!t&&s==="|")},wP=function(e){var t;return e.length>1&&ym(_m(e,0,2))&&(e.length===2||(t=Ji(e,2))==="/"||t==="\\"||t==="?"||t==="#")},tte=function(e){return e==="."||B_(e)==="%2e"},aS={},SP={},oS={},CP={},TP={},cS={},NP={},RP={},H_={},z_={},lS={},dS={},uS={},hS={},AP={},pS={},Vu={},go={},IP={},ed={},Qo={},mS=function(e,t,s){var a,c,d,h=Jo(e);if(t){if(c=this.parse(h))throw new tS(c);this.searchParams=null}else{if(s!==void 0&&(a=new mS(s,!0)),c=this.parse(h,null,a))throw new tS(c);(d=Uee(new Fee)).bindURL(this),this.searchParams=d}};mS.prototype={type:"URL",parse:function(e,t,s){var a,c,d,h,p,f=this,_=t||aS,v=0,b="",w=!1,T=!1,U=!1;for(e=Jo(e),t||(f.scheme="",f.username="",f.password="",f.host=null,f.port=null,f.path=[],f.query=null,f.fragment=null,f.cannotBeABaseURL=!1,e=sS(e,Qee,""),e=sS(e,Zee,"$1")),e=sS(e,ete,""),a=Fu(e);v<=a.length;){switch(c=a[v],_){case aS:if(!c||!Ia(EP,c)){if(t)return rS;_=oS;continue}b+=B_(c),_=SP;break;case SP:if(c&&(Ia(Kee,c)||c==="+"||c==="-"||c==="."))b+=B_(c);else{if(c!==":"){if(t)return rS;b="",_=oS,v=0;continue}if(t&&(f.isSpecial()!==Zw(G_,b)||b==="file"&&(f.includesCredentials()||f.port!==null)||f.scheme==="file"&&!f.host))return;if(f.scheme=b,t)return void(f.isSpecial()&&G_[f.scheme]===f.port&&(f.port=null));b="",f.scheme==="file"?_=hS:f.isSpecial()&&s&&s.scheme===f.scheme?_=CP:f.isSpecial()?_=RP:a[v+1]==="/"?(_=TP,v++):(f.cannotBeABaseURL=!0,Uu(f.path,""),_=IP)}break;case oS:if(!s||s.cannotBeABaseURL&&c!=="#")return rS;if(s.cannotBeABaseURL&&c==="#"){f.scheme=s.scheme,f.path=Aa(s.path),f.query=s.query,f.fragment="",f.cannotBeABaseURL=!0,_=Qo;break}_=s.scheme==="file"?hS:cS;continue;case CP:if(c!=="/"||a[v+1]!=="/"){_=cS;continue}_=H_,v++;break;case TP:if(c==="/"){_=z_;break}_=go;continue;case cS:if(f.scheme=s.scheme,c===Yi)f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,f.path=Aa(s.path),f.query=s.query;else if(c==="/"||c==="\\"&&f.isSpecial())_=NP;else if(c==="?")f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,f.path=Aa(s.path),f.query="",_=ed;else{if(c!=="#"){f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,f.path=Aa(s.path),f.path.length--,_=go;continue}f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,f.path=Aa(s.path),f.query=s.query,f.fragment="",_=Qo}break;case NP:if(!f.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){f.username=s.username,f.password=s.password,f.host=s.host,f.port=s.port,_=go;continue}_=z_}else _=H_;break;case RP:if(_=H_,c!=="/"||Ji(b,v+1)!=="/")continue;v++;break;case H_:if(c!=="/"&&c!=="\\"){_=z_;continue}break;case z_:if(c==="@"){w&&(b="%40"+b),w=!0,d=Fu(b);for(var k=0;k<d.length;k++){var F=d[k];if(F!==":"||U){var z=Mc(F,iS);U?f.password+=z:f.username+=z}else U=!0}b=""}else if(c===Yi||c==="/"||c==="?"||c==="#"||c==="\\"&&f.isSpecial()){if(w&&b==="")return"Invalid authority";v-=Fu(b).length+1,b="",_=lS}else b+=c;break;case lS:case dS:if(t&&f.scheme==="file"){_=pS;continue}if(c!==":"||T){if(c===Yi||c==="/"||c==="?"||c==="#"||c==="\\"&&f.isSpecial()){if(f.isSpecial()&&b==="")return vm;if(t&&b===""&&(f.includesCredentials()||f.port!==null))return;if(h=f.parseHost(b))return h;if(b="",_=Vu,t)return;continue}c==="["?T=!0:c==="]"&&(T=!1),b+=c}else{if(b==="")return vm;if(h=f.parseHost(b))return h;if(b="",_=uS,t===dS)return}break;case uS:if(!Ia(nS,c)){if(c===Yi||c==="/"||c==="?"||c==="#"||c==="\\"&&f.isSpecial()||t){if(b!==""){var Y=V_(b,10);if(Y>65535)return vP;f.port=f.isSpecial()&&Y===G_[f.scheme]?null:Y,b=""}if(t)return;_=Vu;continue}return vP}b+=c;break;case hS:if(f.scheme="file",c==="/"||c==="\\")_=AP;else{if(!s||s.scheme!=="file"){_=go;continue}switch(c){case Yi:f.host=s.host,f.path=Aa(s.path),f.query=s.query;break;case"?":f.host=s.host,f.path=Aa(s.path),f.query="",_=ed;break;case"#":f.host=s.host,f.path=Aa(s.path),f.query=s.query,f.fragment="",_=Qo;break;default:wP(gm(Aa(a,v),""))||(f.host=s.host,f.path=Aa(s.path),f.shortenPath()),_=go;continue}}break;case AP:if(c==="/"||c==="\\"){_=pS;break}s&&s.scheme==="file"&&!wP(gm(Aa(a,v),""))&&(ym(s.path[0],!0)?Uu(f.path,s.path[0]):f.host=s.host),_=go;continue;case pS:if(c===Yi||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&ym(b))_=go;else if(b===""){if(f.host="",t)return;_=Vu}else{if(h=f.parseHost(b))return h;if(f.host==="localhost"&&(f.host=""),t)return;b="",_=Vu}continue}b+=c;break;case Vu:if(f.isSpecial()){if(_=go,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==Yi&&(_=go,c!=="/"))continue}else f.fragment="",_=Qo;else f.query="",_=ed;break;case go:if(c===Yi||c==="/"||c==="\\"&&f.isSpecial()||!t&&(c==="?"||c==="#")){if((p=B_(p=b))===".."||p==="%2e."||p===".%2e"||p==="%2e%2e"?(f.shortenPath(),c==="/"||c==="\\"&&f.isSpecial()||Uu(f.path,"")):tte(b)?c==="/"||c==="\\"&&f.isSpecial()||Uu(f.path,""):(f.scheme==="file"&&!f.path.length&&ym(b)&&(f.host&&(f.host=""),b=Ji(b,0)+":"),Uu(f.path,b)),b="",f.scheme==="file"&&(c===Yi||c==="?"||c==="#"))for(;f.path.length>1&&f.path[0]==="";)Gee(f.path);c==="?"?(f.query="",_=ed):c==="#"&&(f.fragment="",_=Qo)}else b+=Mc(c,bP);break;case IP:c==="?"?(f.query="",_=ed):c==="#"?(f.fragment="",_=Qo):c!==Yi&&(f.path[0]+=Mc(c,W_));break;case ed:t||c!=="#"?c!==Yi&&(c==="'"&&f.isSpecial()?f.query+="%27":f.query+=c==="#"?"%23":Mc(c,W_)):(f.fragment="",_=Qo);break;case Qo:c!==Yi&&(f.fragment+=Mc(c,xP))}v++}},parseHost:function(e){var t,s,a;if(Ji(e,0)==="["){if(Ji(e,e.length-1)!=="]"||(t=function(c){var d,h,p,f,_,v,b,w=[0,0,0,0,0,0,0,0],T=0,U=null,k=0,F=function(){return Ji(c,k)};if(F()===":"){if(Ji(c,1)!==":")return;k+=2,U=++T}for(;F();){if(T===8)return;if(F()!==":"){for(d=h=0;h<4&&Ia(yP,F());)d=16*d+V_(F(),16),k++,h++;if(F()==="."){if(h===0||(k-=h,T>6))return;for(p=0;F();){if(f=null,p>0){if(!(F()==="."&&p<4))return;k++}if(!Ia(nS,F()))return;for(;Ia(nS,F());){if(_=V_(F(),10),f===null)f=_;else{if(f===0)return;f=10*f+_}if(f>255)return;k++}w[T]=256*w[T]+f,++p!=2&&p!==4||T++}if(p!==4)return;break}if(F()===":"){if(k++,!F())return}else if(F())return;w[T++]=d}else{if(U!==null)return;k++,U=++T}}if(U!==null)for(v=T-U,T=7;T!==0&&v>0;)b=w[T],w[T--]=w[U+v-1],w[U+--v]=b;else if(T!==8)return;return w}(_m(e,1,-1)),!t))return vm;this.host=t}else if(this.isSpecial()){if(e=Pee(e),Ia(Xee,e)||(t=function(c){var d,h,p,f,_,v,b,w=Hee(c,".");if(w.length&&w[w.length-1]===""&&w.length--,(d=w.length)>4)return c;for(h=[],p=0;p<d;p++){if((f=w[p])==="")return c;if(_=10,f.length>1&&Ji(f,0)==="0"&&(_=Ia(qee,f)?16:8,f=_m(f,_===8?1:2)),f==="")v=0;else{if(!Ia(_===10?$ee:_===8?Yee:yP,f))return c;v=V_(f,_)}Uu(h,v)}for(p=0;p<d;p++)if(v=h[p],p===d-1){if(v>=_P(256,5-d))return null}else if(v>255)return null;for(b=Wee(h),p=0;p<h.length;p++)b+=h[p]*_P(256,3-p);return b}(e),t===null))return vm;this.host=t}else{if(Ia(Jee,e))return vm;for(t="",s=Fu(e),a=0;a<s.length;a++)t+=Mc(s[a],W_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Zw(G_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&ym(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,s=e.username,a=e.password,c=e.host,d=e.port,h=e.path,p=e.query,f=e.fragment,_=t+":";return c!==null?(_+="//",e.includesCredentials()&&(_+=s+(a?":"+a:"")+"@"),_+=Em(c),d!==null&&(_+=":"+d)):t==="file"&&(_+="//"),_+=e.cannotBeABaseURL?h[0]:h.length?"/"+gm(h,"/"):"",p!==null&&(_+="?"+p),f!==null&&(_+="#"+f),_},setHref:function(e){var t=this.parse(e);if(t)throw new tS(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Bu(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Em(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Jo(e)+":",aS)},getUsername:function(){return this.username},setUsername:function(e){var t=Fu(Jo(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<t.length;s++)this.username+=Mc(t[s],iS)}},getPassword:function(){return this.password},setPassword:function(e){var t=Fu(Jo(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<t.length;s++)this.password+=Mc(t[s],iS)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Em(e):Em(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,lS)},getHostname:function(){var e=this.host;return e===null?"":Em(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,dS)},getPort:function(){var e=this.port;return e===null?"":Jo(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Jo(e))===""?this.port=null:this.parse(e,uS))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+gm(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Vu))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Jo(e))===""?this.query=null:(Ji(e,0)==="?"&&(e=_m(e,1)),this.query="",this.parse(e,ed)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Jo(e))!==""?(Ji(e,0)==="#"&&(e=_m(e,1)),this.fragment="",this.parse(e,Qo)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Bu=function(e){var t=Oee(this,Un),s=Lee(arguments.length,1)>1?arguments[1]:void 0,a=Mee(t,new mS(e,!1,s));Jw||(t.href=a.serialize(),t.origin=a.getOrigin(),t.protocol=a.getProtocol(),t.username=a.getUsername(),t.password=a.getPassword(),t.host=a.getHost(),t.hostname=a.getHostname(),t.port=a.getPort(),t.pathname=a.getPathname(),t.search=a.getSearch(),t.searchParams=a.getSearchParams(),t.hash=a.getHash())},Un=Bu.prototype,Qi=function(e,t){return{get:function(){return U_(this)[e]()},set:t&&function(s){return U_(this)[t](s)},configurable:!0,enumerable:!0}};if(Jw&&(Xi(Un,"href",Qi("serialize","setHref")),Xi(Un,"origin",Qi("getOrigin")),Xi(Un,"protocol",Qi("getProtocol","setProtocol")),Xi(Un,"username",Qi("getUsername","setUsername")),Xi(Un,"password",Qi("getPassword","setPassword")),Xi(Un,"host",Qi("getHost","setHost")),Xi(Un,"hostname",Qi("getHostname","setHostname")),Xi(Un,"port",Qi("getPort","setPort")),Xi(Un,"pathname",Qi("getPathname","setPathname")),Xi(Un,"search",Qi("getSearch","setSearch")),Xi(Un,"searchParams",Qi("getSearchParams")),Xi(Un,"hash",Qi("getHash","setHash"))),F_(Un,"toJSON",function(){return U_(this).serialize()},{enumerable:!0}),F_(Un,"toString",function(){return U_(this).serialize()},{enumerable:!0}),fm){var DP=fm.createObjectURL,OP=fm.revokeObjectURL;DP&&F_(Bu,"createObjectURL",mP(DP,fm)),OP&&F_(Bu,"revokeObjectURL",mP(OP,fm))}kee(Bu,"URL"),Iee({global:!0,forced:!Dee,sham:!Jw},{URL:Bu});var ste=qt,jP=m,rte=Xl,PP=ei,nte=O_,fS=br("URL"),ite=nte&&jP(function(){fS.canParse()}),ate=jP(function(){return fS.canParse.length!==1});ste({target:"URL",stat:!0,forced:!ite||ate},{canParse:function(e){var t=rte(arguments.length,1),s=PP(e),a=t<2||arguments[1]===void 0?void 0:PP(arguments[1]);try{return!!new fS(s,a)}catch{return!1}}});var ote=qt,cte=Xl,kP=ei,lte=O_,dte=br("URL");ote({target:"URL",stat:!0,forced:!lte},{parse:function(e){var t=cte(arguments.length,1),s=kP(e),a=t<2||arguments[1]===void 0?void 0:kP(arguments[1]);try{return new dte(s,a)}catch{return null}}});var K_=u(Ps.URL);let LP=!0,MP=!0;function q_(e,t,s){let a=e.match(t);return a&&a.length>=s&&parseInt(a[s],10)}function td(e,t,s){if(!e.RTCPeerConnection)return;let a=e.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,p){if(h!==t)return c.apply(this,arguments);let f=_=>{let v=s(_);v&&(p.handleEvent?p.handleEvent(v):p(v))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(p,f),c.apply(this,[h,f])};let d=a.removeEventListener;a.removeEventListener=function(h,p){if(h!==t||!this._eventMap||!this._eventMap[t])return d.apply(this,arguments);if(!this._eventMap[t].has(p))return d.apply(this,arguments);let f=this._eventMap[t].get(p);return this._eventMap[t].delete(p),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,f])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function ute(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(LP=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function hte(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(MP=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function FP(){if(typeof window=="object"){if(LP)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function gS(e,t){MP&&console.warn(e+" is deprecated, please use "+t+" instead.")}function UP(e){return Object.prototype.toString.call(e)==="[object Object]"}function VP(e){var t;return UP(e)?Ki(t=Object.keys(e)).call(t,function(s,a){let c=UP(e[a]),d=c?VP(e[a]):e[a],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})},{}):e}function _S(e,t,s){t&&!s.has(t.id)&&(s.set(t.id,t),Object.keys(t).forEach(a=>{a.endsWith("Id")?_S(e,e.get(t[a]),s):a.endsWith("Ids")&&t[a].forEach(c=>{_S(e,e.get(c),s)})}))}function BP(e,t,s){let a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;let d=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&d.push(h)}),d.forEach(h=>{e.forEach(p=>{p.type===a&&p.trackId===h.id&&_S(e,p,c)})}),c}let WP=FP;function GP(e,t){let s=e&&e.navigator;if(!s.mediaDevices)return;let a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;let p={};return Object.keys(h).forEach(f=>{if(f==="require"||f==="advanced"||f==="mediaSource")return;let _=typeof h[f]=="object"?h[f]:{ideal:h[f]};_.exact!==void 0&&typeof _.exact=="number"&&(_.min=_.max=_.exact);let v=function(b,w){return b?b+w.charAt(0).toUpperCase()+w.slice(1):w==="deviceId"?"sourceId":w};if(_.ideal!==void 0){p.optional=p.optional||[];let b={};typeof _.ideal=="number"?(b[v("min",f)]=_.ideal,p.optional.push(b),b={},b[v("max",f)]=_.ideal,p.optional.push(b)):(b[v("",f)]=_.ideal,p.optional.push(b))}_.exact!==void 0&&typeof _.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[v("",f)]=_.exact):["min","max"].forEach(b=>{_[b]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[v(b,f)]=_[b])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},c=function(h,p){if(t.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){let f=function(_,v,b){v in _&&!(b in _)&&(_[b]=_[v],delete _[v])};f((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),f(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let f=h.video.facingMode;f=f&&(typeof f=="object"?f:{ideal:f});let _=t.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||_)){let v;if(delete h.video.facingMode,f.exact==="environment"||f.ideal==="environment"?v=["back","rear"]:f.exact!=="user"&&f.ideal!=="user"||(v=["front"]),v)return s.mediaDevices.enumerateDevices().then(b=>{b=b.filter(T=>T.kind==="videoinput");let w=b.find(T=>v.some(U=>{var k;return je(k=T.label.toLowerCase()).call(k,U)}));return!w&&b.length&&je(v).call(v,"back")&&(w=b[b.length-1]),w&&(h.video.deviceId=f.exact?{exact:w.deviceId}:{ideal:w.deviceId}),h.video=a(h.video),WP("chrome: "+JSON.stringify(h)),p(h)})}h.video=a(h.video)}return WP("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,p,f){c(h,_=>{s.webkitGetUserMedia(_,p,v=>{f&&f(d(v))})})}).bind(s),s.mediaDevices.getUserMedia){let h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(p){return c(p,f=>h(f).then(_=>{if(f.audio&&!_.getAudioTracks().length||f.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return _},_=>Ve.reject(d(_))))}}}function HP(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function zP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};let d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(a=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};let d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else td(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function KP(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,p){let f=c.apply(this,arguments);return f||(f=t(this,h),this._senders.push(f)),f};let d=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);let p=this._senders.indexOf(h);p!==-1&&this._senders.splice(p,1)}}let s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(t(this,d))})};let a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(d=>{let h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let s=t.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function qP(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof s!="function"))return t.apply(this,[]);let d=function(p){let f={};return p.result().forEach(_=>{let v={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(b=>{v[b]=_.stat(b)}),f[v.id]=v}),f},h=function(p){return new Map(Object.keys(p).map(f=>[f,p[f]]))};if(arguments.length>=2){let p=function(f){a(h(d(f)))};return t.apply(this,[p,s])}return new Ve((p,f)=>{t.apply(this,[function(_){p(h(d(_)))},f])}).then(a,c)}}function YP(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){let c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c});let a=e.RTCPeerConnection.prototype.addTrack;a&&(e.RTCPeerConnection.prototype.addTrack=function(){let c=a.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){let c=this;return this._pc.getStats().then(d=>BP(d,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){let a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a}),td(e,"track",a=>(a.receiver._pc=a.srcElement,a)),e.RTCRtpReceiver.prototype.getStats=function(){let a=this;return this._pc.getStats().then(c=>BP(c,a.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let s=arguments[0],a,c,d;return this.getSenders().forEach(h=>{h.track===s&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?d=!0:c=h),h.track===s)),d||a&&c?Ve.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():Ve.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function $P(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let p=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(p)===-1&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};let s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(f=>{if(this.getSenders().find(_=>_.track===f))throw new DOMException("Track already exists.","InvalidAccessError")});let h=this.getSenders();s.apply(this,arguments);let p=this.getSenders().filter(f=>h.indexOf(f)===-1);this._shimmedLocalStreams[d.id]=[d].concat(p)};let a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};let c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{let p=this._shimmedLocalStreams[h].indexOf(d);p!==-1&&this._shimmedLocalStreams[h].splice(p,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function XP(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return $P(e);let s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let f=s.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(_=>this._reverseStreams[_.id])};let a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(_=>{if(this.getSenders().find(v=>v.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){let _=new e.MediaStream(f.getTracks());this._streams[f.id]=_,this._reverseStreams[_.id]=f,f=_}a.apply(this,[f])};let c=e.RTCPeerConnection.prototype.removeStream;function d(f,_){let v=_.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{let w=f._reverseStreams[b],T=f._streams[w.id];v=v.replace(new RegExp(T.id,"g"),w.id)}),new RTCSessionDescription({type:_.type,sdp:v})}e.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},e.RTCPeerConnection.prototype.addTrack=function(f,_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(w=>w===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let b=this._streams[_.id];if(b)b.addTrack(f),Ve.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let w=new e.MediaStream([f]);this._streams[_.id]=w,this._reverseStreams[w.id]=_,this.addStream(w)}return this.getSenders().find(w=>w.track===f)},["createOffer","createAnswer"].forEach(function(f){let _=e.RTCPeerConnection.prototype[f],v={[f](){let b=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[w=>{let T=d(this,w);b[0].apply(null,[T])},w=>{b[1]&&b[1].apply(null,w)},arguments[2]]):_.apply(this,arguments).then(w=>d(this,w))}};e.RTCPeerConnection.prototype[f]=v[f]});let h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(f,_){let v=_.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{let w=f._reverseStreams[b],T=f._streams[w.id];v=v.replace(new RegExp(w.id,"g"),T.id)}),new RTCSessionDescription({type:_.type,sdp:v})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};let p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let f=p.get.apply(this);return f.type===""?f:d(this,f)}}),e.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(f._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(b=>f.track===b)&&(_=this._streams[v])}),_&&(_.getTracks().length===1?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function vS(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){let a=e.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=c[s]})}function JP(e,t){td(e,"negotiationneeded",s=>{let a=s.target;if(!(t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var QP=Object.freeze({__proto__:null,fixNegotiationNeeded:JP,shimAddTrackRemoveTrack:XP,shimAddTrackRemoveTrackWithNative:$P,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(s){return t(s).then(a=>{let c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),e.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:KP,shimGetStats:qP,shimGetUserMedia:GP,shimMediaStream:HP,shimOnTrack:zP,shimPeerConnection:vS,shimSenderReceiverGetStats:YP});function ZP(e,t){let s=e&&e.navigator,a=e&&e.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){gS("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(t.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){let c=function(h,p,f){p in h&&!(f in h)&&(h[f]=h[p],delete h[p])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){let h=a.prototype.getSettings;a.prototype.getSettings=function(){let p=h.apply(this,arguments);return c(p,"mozAutoGainControl","autoGainControl"),c(p,"mozNoiseSuppression","noiseSuppression"),p}}if(a&&a.prototype.applyConstraints){let h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),c(p,"autoGainControl","mozAutoGainControl"),c(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function ek(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ES(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){let d=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});let s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[c,d,h]=arguments;return a.apply(this,[c||null]).then(p=>{if(t.version<53&&!d)try{p.forEach(f=>{f.type=s[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;p.forEach((_,v)=>{p.set(v,Object.assign({},_,{type:s[_.type]||_.type}))})}return p}).then(d,h)}}function tk(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let a=t.apply(this,[]);return a.forEach(c=>c._pc=this),a});let s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){let a=s.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ve.resolve(new Map)}}function sk(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let s=t.apply(this,[]);return s.forEach(a=>a._pc=this),s}),td(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function rk(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){gS("removeStream","removeTrack"),this.getSenders().forEach(s=>{var a;s.track&&je(a=t.getTracks()).call(a,s.track)&&this.removeTrack(s)})})}function nk(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ik(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];let a=s.length>0;a&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let c=t.apply(this,arguments);if(a){let{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function ak(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let s=t.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function ok(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ve.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function ck(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ve.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var lk=Object.freeze({__proto__:null,shimAddTransceiver:ik,shimCreateAnswer:ck,shimCreateOffer:ok,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){let a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Ve.reject(a)}return s.video===!0?s.video={mediaSource:t}:s.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:ak,shimGetUserMedia:ZP,shimOnTrack:ek,shimPeerConnection:ES,shimRTCDataChannel:nk,shimReceiverGetStats:sk,shimRemoveStream:rk,shimSenderGetStats:tk});function dk(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),je(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>t.call(this,c,s)),s.getVideoTracks().forEach(c=>t.call(this,c,s))},e.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var p;this._localStreams?je(p=this._localStreams).call(p,h)||this._localStreams.push(h):this._localStreams=[h]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let s=this._localStreams.indexOf(t);if(s===-1)return;this._localStreams.splice(s,1);let a=t.getTracks();this.getSenders().forEach(c=>{je(a).call(a,c.track)&&this.removeTrack(c)})})}}function uk(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),je(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);let h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);let d=new Event("addstream");d.stream=c,s.dispatchEvent(d)})}),t.apply(s,arguments)}}}function hk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,s=t.createOffer,a=t.createAnswer,c=t.setLocalDescription,d=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(f,_){let v=arguments.length>=2?arguments[2]:arguments[0],b=s.apply(this,[v]);return _?(b.then(f,_),Ve.resolve()):b},t.createAnswer=function(f,_){let v=arguments.length>=2?arguments[2]:arguments[0],b=a.apply(this,[v]);return _?(b.then(f,_),Ve.resolve()):b};let p=function(f,_,v){let b=c.apply(this,[f]);return v?(b.then(_,v),Ve.resolve()):b};t.setLocalDescription=p,p=function(f,_,v){let b=d.apply(this,[f]);return v?(b.then(_,v),Ve.resolve()):b},t.setRemoteDescription=p,p=function(f,_,v){let b=h.apply(this,[f]);return v?(b.then(_,v),Ve.resolve()):b},t.addIceCandidate=p}function pk(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let s=t.mediaDevices,a=s.getUserMedia.bind(s);t.mediaDevices.getUserMedia=c=>a(mk(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(s,a,c){t.mediaDevices.getUserMedia(s).then(a,c)}).bind(t))}function mk(e){return e&&e.video!==void 0?Object.assign({},e,{video:VP(e.video)}):e}function fk(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(s,a){if(s&&s.iceServers){let c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(gS("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new t(s,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function gk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _k(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);let a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);let c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function vk(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Ek=Object.freeze({__proto__:null,shimAudioContext:vk,shimCallbacksAPI:hk,shimConstraints:mk,shimCreateOfferLegacy:_k,shimGetUserMedia:pk,shimLocalStreamsAPI:dk,shimRTCIceServerUrls:fk,shimRemoteStreamsAPI:uk,shimTrackEventTransceiver:gk}),yk=`	
\v\f\r \u2028\u2029\uFEFF`,pte=Ct,mte=ei,yS=yk,xk=C("".replace),fte=RegExp("^["+yS+"]+"),gte=RegExp("(^|[^"+yS+"])["+yS+"]+$"),_te=function(e){return function(t){var s=mte(pte(t));return s=xk(s,fte,""),s=xk(s,gte,"$1"),s}},vte={trim:_te()},Ete=nO.PROPER,yte=m,bk=yk,xte=vte.trim;qt({target:"String",proto:!0,forced:function(e){return yte(function(){return!!bk[e]()||""[e]()!==""||Ete&&bk[e].name!==e})}("trim")},{trim:function(){return xte(this)}});var bte=zi("String","trim"),wte=N,Ste=bte,xS=String.prototype,Cte=function(e){var t=e.trim;return typeof e=="string"||e===xS||wte(xS,e)&&t===xS.trim?Ste:t},Kr=u(Cte),wk={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(s){return s.trim().split(`
`).map(a=>a.trim())},t.splitSections=function(s){return s.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},t.getDescription=function(s){let a=t.splitSections(s);return a&&a[0]},t.getMediaSections=function(s){let a=t.splitSections(s);return a.shift(),a},t.matchPrefix=function(s,a){return t.splitLines(s).filter(c=>c.indexOf(a)===0)},t.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");let c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},t.writeCandidate=function(s){let a=[];a.push(s.foundation);let c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);let d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(s){return s.substring(14).split(" ")},t.parseRtpMap=function(s){let a=s.substring(9).split(" "),c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);let c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(s){let a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},t.parseFmtp=function(s){let a={},c,d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},t.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){let d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},t.parseRtcpFb=function(s){let a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},t.parseSsrcMedia=function(s){let a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},d=s.indexOf(":",a);return d>-1?(c.attribute=s.substring(a+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(a+1),c},t.parseSsrcGroup=function(s){let a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},t.getMid=function(s){let a=t.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(s){let a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:t.matchPrefix(s+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},t.parseCryptoLine=function(s){let a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?t.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;let a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},t.getCryptoParameters=function(s,a){return t.matchPrefix(s+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(s,a){let c=t.matchPrefix(s+a,"a=ice-ufrag:")[0],d=t.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},t.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(s){let a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){let p=c[h],f=t.matchPrefix(s,"a=rtpmap:"+p+" ")[0];if(f){let _=t.parseRtpMap(f),v=t.matchPrefix(s,"a=fmtp:"+p+" ");switch(_.parameters=v.length?t.parseFmtp(v[0]):{},_.rtcpFeedback=t.matchPrefix(s,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),a.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(_.name.toUpperCase())}}}t.matchPrefix(s,"a=extmap:").forEach(h=>{a.headerExtensions.push(t.parseExtmap(h))});let d=t.matchPrefix(s,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(f=>f.type===p.type&&f.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),a},t.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=t.writeRtpMap(h),c+=t.writeFmtp(h),c+=t.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=t.writeExtmap(h)}),c},t.parseRtpEncodingParameters=function(s){let a=[],c=t.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,p=t.matchPrefix(s,"a=ssrc:").map(w=>t.parseSsrcMedia(w)).filter(w=>w.attribute==="cname"),f=p.length>0&&p[0].ssrc,_,v=t.matchPrefix(s,"a=ssrc-group:FID").map(w=>w.substring(17).split(" ").map(T=>parseInt(T,10)));v.length>0&&v[0].length>1&&v[0][0]===f&&(_=v[0][1]),c.codecs.forEach(w=>{if(w.name.toUpperCase()==="RTX"&&w.parameters.apt){let T={ssrc:f,codecPayloadType:parseInt(w.parameters.apt,10)};f&&_&&(T.rtx={ssrc:_}),a.push(T),d&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:f,mechanism:h?"red+ulpfec":"red"},a.push(T))}}),a.length===0&&f&&a.push({ssrc:f});let b=t.matchPrefix(s,"b=");return b.length&&(b=b[0].indexOf("b=TIAS:")===0?parseInt(b[0].substring(7),10):b[0].indexOf("b=AS:")===0?1e3*parseInt(b[0].substring(5),10)*.95-16e3:void 0,a.forEach(w=>{w.maxBitrate=b})),a},t.parseRtcpParameters=function(s){let a={},c=t.matchPrefix(s,"a=ssrc:").map(p=>t.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);let d=t.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;let h=t.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},t.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},t.parseMsid=function(s){let a,c=t.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};let d=t.matchPrefix(s,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},t.parseSctpDescription=function(s){let a=t.parseMLine(s),c=t.matchPrefix(s,"a=max-message-size:"),d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);let h=t.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};let p=t.matchPrefix(s,"a=sctpmap:");if(p.length>0){let f=p[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:d}}},t.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(s,a,c){let d,h=a!==void 0?a:2;return d=s||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(s,a){let c=t.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(s){return t.splitLines(s)[0].split(" ")[0].substring(2)},t.isRejected=function(s){return s.split(" ",2)[1]==="0"},t.parseMLine=function(s){let a=t.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},t.parseOLine=function(s){let a=t.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},t.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;let a=t.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(wk);var Sk=wk.exports,Wu=u(Sk),Tte=o({__proto__:null,default:Wu},[Sk]);function Y_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){let a=new t(s),c=Wu.parseCandidate(s.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new t(s)},e.RTCIceCandidate.prototype=t.prototype,td(e,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new e.RTCIceCandidate(s.candidate),writable:"false"}),s))}function bS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||td(e,"icecandidate",t=>{if(t.candidate){let s=Wu.parseCandidate(t.candidate.candidate);s.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return t})}function $_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let s=function(p){if(!p||!p.sdp)return!1;let f=Wu.splitSections(p.sdp);return f.shift(),f.some(_=>{let v=Wu.parseMLine(_);return v&&v.kind==="application"&&v.protocol.indexOf("SCTP")!==-1})},a=function(p){let f=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;let _=parseInt(f[1],10);return _!=_?-1:_},c=function(p){let f=65536;return t.browser==="firefox"&&(f=t.version<57?p===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),f},d=function(p,f){let _=65536;t.browser==="firefox"&&t.version===57&&(_=65535);let v=Wu.matchPrefix(p.sdp,"a=max-message-size:");return v.length>0?_=parseInt(v[0].substr(19),10):t.browser==="firefox"&&f!==-1&&(_=2147483637),_},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){let p=a(arguments[0]),f=c(p),_=d(arguments[0],p),v;v=f===0&&_===0?Number.POSITIVE_INFINITY:f===0||_===0?Math.max(f,_):Math.min(f,_);let b={};Object.defineProperty(b,"maxMessageSize",{get:()=>v}),this._sctp=b}return h.apply(this,arguments)}}function X_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(a,c){let d=a.send;a.send=function(){let h=arguments[0],p=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&p>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}let s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let a=s.apply(this,arguments);return t(a,this),a},td(e,"datachannel",a=>(t(a.channel,a.target),a))}function wS(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{let a=t[s];t[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{let d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;let h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function SS(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let c=a.sdp.split(`
`).filter(d=>Kr(d).call(d)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&a instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function J_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let s=e.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ve.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ve.resolve())})}function Q_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let s=e.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var Nte=Object.freeze({__proto__:null,removeExtmapAllowMixed:SS,shimAddIceCandidateNullOrEmpty:J_,shimConnectionState:wS,shimMaxMessageSize:$_,shimParameterlessSetLocalDescription:Q_,shimRTCIceCandidate:Y_,shimRTCIceCandidateRelayProtocol:bS,shimSendThrowTypeError:X_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},s=FP,a=function(d){let h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;let{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=q_(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=q_(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=q_(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:a,commonShim:Nte,extractVersion:q_,disableLog:ute,disableWarnings:hte,sdp:Tte};switch(a.browser){case"chrome":if(!QP||!vS||!t.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=QP,J_(e,a),Q_(e),GP(e,a),HP(e),vS(e,a),zP(e),XP(e,a),KP(e),qP(e),YP(e),JP(e,a),Y_(e),bS(e),wS(e),$_(e,a),X_(e),SS(e,a);break;case"firefox":if(!lk||!ES||!t.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=lk,J_(e,a),Q_(e),ZP(e,a),ES(e,a),ek(e),rk(e),tk(e),sk(e),nk(e),ik(e),ak(e),ok(e),ck(e),Y_(e),wS(e),$_(e,a),X_(e);break;case"safari":if(!Ek||!t.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=Ek,J_(e,a),Q_(e),fk(e),_k(e),hk(e),dk(e),uk(e),gk(e),pk(e),vk(e),Y_(e),bS(e),$_(e,a),X_(e),SS(e,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var CS=G;qt({global:!0,forced:CS.globalThis!==CS},{globalThis:CS});var Ck=u(G),TS={exports:{}};(function(e,t){(function(s,a){var c="function",d="undefined",h="object",p="string",f="major",_="model",v="name",b="type",w="vendor",T="version",U="architecture",k="console",F="mobile",z="tablet",Y="smarttv",X="wearable",re="embedded",te="Amazon",Z="Apple",de="ASUS",xe="BlackBerry",Se="Browser",Ae="Chrome",yt="Firefox",bt="Google",dt="Huawei",Wt="LG",Ut="Microsoft",Lr="Motorola",we="Opera",Pe="Samsung",Ke="Sharp",Te="Sony",j="Xiaomi",Q="Zebra",se="Facebook",De="Chromium OS",gt="Mac OS",cs=" Browser",Xs=function(Ks){for(var Js={},ls=0;ls<Ks.length;ls++)Js[Ks[ls].toUpperCase()]=Ks[ls];return Js},ji=function(Ks,Js){return typeof Ks===p&&ha(Js).indexOf(ha(Ks))!==-1},ha=function(Ks){return Ks.toLowerCase()},Cf=function(Ks,Js){if(typeof Ks===p)return Ks=Ks.replace(/^\s\s*/,""),typeof Js===d?Ks:Ks.substring(0,500)},Ad=function(Ks,Js){for(var ls,Tn,Ka,Ls,hc,Dt,qa=0;qa<Js.length&&!hc;){var Id=Js[qa],jo=Js[qa+1];for(ls=Tn=0;ls<Id.length&&!hc&&Id[ls];)if(hc=Id[ls++].exec(Ks))for(Ka=0;Ka<jo.length;Ka++)Dt=hc[++Tn],typeof(Ls=jo[Ka])===h&&Ls.length>0?Ls.length===2?typeof Ls[1]==c?this[Ls[0]]=Ls[1].call(this,Dt):this[Ls[0]]=Ls[1]:Ls.length===3?typeof Ls[1]!==c||Ls[1].exec&&Ls[1].test?this[Ls[0]]=Dt?Dt.replace(Ls[1],Ls[2]):a:this[Ls[0]]=Dt?Ls[1].call(this,Dt,Ls[2]):a:Ls.length===4&&(this[Ls[0]]=Dt?Ls[3].call(this,Dt.replace(Ls[1],Ls[2])):a):this[Ls]=Dt||a;qa+=2}},kh=function(Ks,Js){for(var ls in Js)if(typeof Js[ls]===h&&Js[ls].length>0){for(var Tn=0;Tn<Js[ls].length;Tn++)if(ji(Js[ls][Tn],Ks))return ls==="?"?a:ls}else if(ji(Js[ls],Ks))return ls==="?"?a:ls;return Js.hasOwnProperty("*")?Js["*"]:Ks},QE={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ZE={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,T],[/opios[\/ ]+([\w\.]+)/i],[T,[v,we+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[T,[v,we+" GX"]],[/\bopr\/([\w\.]+)/i],[T,[v,we]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[T,[v,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[T,[v,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[v,T],[/quark(?:pc)?\/([-\w\.]+)/i],[T,[v,"Quark"]],[/\bddg\/([\w\.]+)/i],[T,[v,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[v,"UC"+Se]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[T,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[v,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[T,[v,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[T,[v,"Smart Lenovo "+Se]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+Se],T],[/\bfocus\/([\w\.]+)/i],[T,[v,yt+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[v,we+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[v,we+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[v,"MIUI"+cs]],[/fxios\/([\w\.-]+)/i],[T,[v,yt]],[/\bqihoobrowser\/?([\w\.]*)/i],[T,[v,"360"]],[/\b(qq)\/([\w\.]+)/i],[[v,/(.+)/,"$1Browser"],T],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1"+cs],T],[/samsungbrowser\/([\w\.]+)/i],[T,[v,Pe+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[T,[v,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[v,"Sogou Mobile"],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[v,T],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[v],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[T,v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,se],T],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[v,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[v,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[T,[v,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[v,Ae+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,Ae+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[v,"Android "+Se]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[T,kh,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],T],[/(wolvic|librewolf)\/([\w\.]+)/i],[v,T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[v,yt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[v,[T,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[v,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[U,"amd64"]],[/(ia32(?=;))/i],[[U,ha]],[/((?:i[346]|x)86)[;\)]/i],[[U,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[U,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[U,"armhf"]],[/windows (ce|mobile); ppc;/i],[[U,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[U,/ower/,"",ha]],[/(sun4\w)[;\)]/i],[[U,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[U,ha]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[w,Pe],[b,z]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[_,[w,Pe],[b,F]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[_,[w,Z],[b,F]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[w,Z],[b,z]],[/(macintosh);/i],[_,[w,Z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[w,Ke],[b,F]],[/(?:honor)([-\w ]+)[;\)]/i],[_,[w,"Honor"],[b,F]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[w,dt],[b,z]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[w,dt],[b,F]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[_,/_/g," "],[w,j],[b,F]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[w,j],[b,z]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[w,"OPPO"],[b,F]],[/\b(opd2\d{3}a?) bui/i],[_,[w,"OPPO"],[b,z]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[w,"Vivo"],[b,F]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[_,[w,"Realme"],[b,F]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[w,Lr],[b,F]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[w,Lr],[b,z]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[w,Wt],[b,z]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[w,Wt],[b,F]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[w,"Lenovo"],[b,z]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[w,"Nokia"],[b,F]],[/(pixel c)\b/i],[_,[w,bt],[b,z]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[w,bt],[b,F]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[w,Te],[b,F]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[w,Te],[b,z]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[w,"OnePlus"],[b,F]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[w,te],[b,z]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[w,te],[b,F]],[/(playbook);[-\w\),; ]+(rim)/i],[_,w,[b,z]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[w,xe],[b,F]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[w,de],[b,z]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[w,de],[b,F]],[/(nexus 9)/i],[_,[w,"HTC"],[b,z]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[w,[_,/_/g," "],[b,F]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[_,[w,"TCL"],[b,z]],[/(itel) ((\w+))/i],[[w,ha],_,[b,kh,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[w,"Acer"],[b,z]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[w,"Meizu"],[b,F]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[_,[w,"Ulefone"],[b,F]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[_,[w,"Energizer"],[b,F]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[_,[w,"Cat"],[b,F]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[_,[w,"Smartfren"],[b,F]],[/droid.+; (a(?:015|06[35]|142p?))/i],[_,[w,"Nothing"],[b,F]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[w,_,[b,F]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[w,_,[b,z]],[/(surface duo)/i],[_,[w,Ut],[b,z]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[w,"Fairphone"],[b,F]],[/(u304aa)/i],[_,[w,"AT&T"],[b,F]],[/\bsie-(\w*)/i],[_,[w,"Siemens"],[b,F]],[/\b(rct\w+) b/i],[_,[w,"RCA"],[b,z]],[/\b(venue[\d ]{2,7}) b/i],[_,[w,"Dell"],[b,z]],[/\b(q(?:mv|ta)\w+) b/i],[_,[w,"Verizon"],[b,z]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[w,"Barnes & Noble"],[b,z]],[/\b(tm\d{3}\w+) b/i],[_,[w,"NuVision"],[b,z]],[/\b(k88) b/i],[_,[w,"ZTE"],[b,z]],[/\b(nx\d{3}j) b/i],[_,[w,"ZTE"],[b,F]],[/\b(gen\d{3}) b.+49h/i],[_,[w,"Swiss"],[b,F]],[/\b(zur\d{3}) b/i],[_,[w,"Swiss"],[b,z]],[/\b((zeki)?tb.*\b) b/i],[_,[w,"Zeki"],[b,z]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[w,"Dragon Touch"],_,[b,z]],[/\b(ns-?\w{0,9}) b/i],[_,[w,"Insignia"],[b,z]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[w,"NextBook"],[b,z]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[w,"Voice"],_,[b,F]],[/\b(lvtel\-)?(v1[12]) b/i],[[w,"LvTel"],_,[b,F]],[/\b(ph-1) /i],[_,[w,"Essential"],[b,F]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[w,"Envizen"],[b,z]],[/\b(trio[-\w\. ]+) b/i],[_,[w,"MachSpeed"],[b,z]],[/\btu_(1491) b/i],[_,[w,"Rotor"],[b,z]],[/(shield[\w ]+) b/i],[_,[w,"Nvidia"],[b,z]],[/(sprint) (\w+)/i],[w,_,[b,F]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[w,Ut],[b,F]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[w,Q],[b,z]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[w,Q],[b,F]],[/smart-tv.+(samsung)/i],[w,[b,Y]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[w,Pe],[b,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[w,Wt],[b,Y]],[/(apple) ?tv/i],[w,[_,Z+" TV"],[b,Y]],[/crkey/i],[[_,Ae+"cast"],[w,bt],[b,Y]],[/droid.+aft(\w+)( bui|\))/i],[_,[w,te],[b,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[w,Ke],[b,Y]],[/(bravia[\w ]+)( bui|\))/i],[_,[w,Te],[b,Y]],[/(mitv-\w{5}) bui/i],[_,[w,j],[b,Y]],[/Hbbtv.*(technisat) (.*);/i],[w,_,[b,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[w,Cf],[_,Cf],[b,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[w,_,[b,k]],[/droid.+; (shield) bui/i],[_,[w,"Nvidia"],[b,k]],[/(playstation [345portablevi]+)/i],[_,[w,Te],[b,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[w,Ut],[b,k]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[_,[w,Pe],[b,X]],[/((pebble))app/i],[w,_,[b,X]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[w,Z],[b,X]],[/droid.+; (glass) \d/i],[_,[w,bt],[b,X]],[/droid.+; (wt63?0{2,3})\)/i],[_,[w,Q],[b,X]],[/droid.+; (glass) \d/i],[_,[w,bt],[b,X]],[/(pico) (4|neo3(?: link|pro)?)/i],[w,_,[b,X]],[/; (quest( \d| pro)?)/i],[_,[w,se],[b,X]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[w,[b,re]],[/(aeobc)\b/i],[_,[w,te],[b,re]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[_,[b,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[b,z]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,z]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,F]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[w,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[v,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[v,T],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[v,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,T],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[v,[T,kh,QE]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,kh,QE],[v,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,gt],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,T],[/\(bb(10);/i],[T,[v,xe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[v,yt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[v,Ae+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,De],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,T],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[v,T]]},Pi=function(Ks,Js){if(typeof Ks===h&&(Js=Ks,Ks=a),!(this instanceof Pi))return new Pi(Ks,Js).getResult();var ls=typeof s!==d&&s.navigator?s.navigator:a,Tn=Ks||(ls&&ls.userAgent?ls.userAgent:""),Ka=ls&&ls.userAgentData?ls.userAgentData:a,Ls=Js?function(Dt,qa){var Id={};for(var jo in Dt)qa[jo]&&qa[jo].length%2==0?Id[jo]=qa[jo].concat(Dt[jo]):Id[jo]=Dt[jo];return Id}(ZE,Js):ZE,hc=ls&&ls.userAgent==Tn;return this.getBrowser=function(){var Dt={};return Dt[v]=a,Dt[T]=a,Ad.call(Dt,Tn,Ls.browser),Dt[f]=function(qa){return typeof qa===p?qa.replace(/[^\d\.]/g,"").split(".")[0]:a}(Dt[T]),hc&&ls&&ls.brave&&typeof ls.brave.isBrave==c&&(Dt[v]="Brave"),Dt},this.getCPU=function(){var Dt={};return Dt[U]=a,Ad.call(Dt,Tn,Ls.cpu),Dt},this.getDevice=function(){var Dt={};return Dt[w]=a,Dt[_]=a,Dt[b]=a,Ad.call(Dt,Tn,Ls.device),hc&&!Dt[b]&&Ka&&Ka.mobile&&(Dt[b]=F),hc&&Dt[_]=="Macintosh"&&ls&&typeof ls.standalone!==d&&ls.maxTouchPoints&&ls.maxTouchPoints>2&&(Dt[_]="iPad",Dt[b]=z),Dt},this.getEngine=function(){var Dt={};return Dt[v]=a,Dt[T]=a,Ad.call(Dt,Tn,Ls.engine),Dt},this.getOS=function(){var Dt={};return Dt[v]=a,Dt[T]=a,Ad.call(Dt,Tn,Ls.os),hc&&!Dt[v]&&Ka&&Ka.platform&&Ka.platform!="Unknown"&&(Dt[v]=Ka.platform.replace(/chrome os/i,De).replace(/macos/i,gt)),Dt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Tn},this.setUA=function(Dt){return Tn=typeof Dt===p&&Dt.length>500?Cf(Dt,500):Dt,this},this.setUA(Tn),this};Pi.VERSION="0.7.40",Pi.BROWSER=Xs([v,T,f]),Pi.CPU=Xs([U]),Pi.DEVICE=Xs([_,w,b,k,F,Y,z,X,re]),Pi.ENGINE=Pi.OS=Xs([v,T]),e.exports&&(t=e.exports=Pi),t.UAParser=Pi;var uc=typeof s!==d&&(s.jQuery||s.Zepto);if(uc&&!uc.ua){var ey=new Pi;uc.ua=ey.getResult(),uc.ua.get=function(){return ey.getUA()},uc.ua.set=function(Ks){ey.setUA(Ks);var Js=ey.getResult();for(var ls in Js)uc.ua[ls]=Js[ls]}}})(typeof window=="object"?window:l)})(TS,TS.exports);var Rte=u(TS.exports),Tk=C_.clear;qt({global:!0,bind:!0,forced:G.clearImmediate!==Tk},{clearImmediate:Tk});var Nk=G,Ate=D,Ite=Ee,Dte=kb,Ote=ln,jte=Oc,Pte=Xl,kte=Nk.Function,Lte=/MSIE .\./.test(Ote)||Dte==="BUN"&&function(){var e=Nk.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Mte=qt,Rk=G,Ak=C_.set,Fte=function(e,t){var s=1;return Lte?function(a,c){var d=Pte(arguments.length,1)>s,h=Ite(a)?a:kte(a),p=d?jte(arguments,s):[],f=d?function(){Ate(h,this,p)}:h;return e(f)}:e},Ik=Rk.setImmediate?Fte(Ak):Ak;Mte({global:!0,bind:!0,forced:Rk.setImmediate!==Ik},{setImmediate:Ik});var Dk=u(Ps.setImmediate),Ute=G,Vte=GO,Bte=Zn,Wte=Xl,Gte=he;qt({global:!0,dontCallGetSet:!0,forced:m(function(){return Gte&&Object.getOwnPropertyDescriptor(Ute,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){Wte(arguments.length,1),Vte(Bte(e))}});var Ok=u(Ps.queueMicrotask);function jk(e,t){return function(){return e.apply(t,arguments)}}let{toString:Hte}=Object.prototype,{getPrototypeOf:NS}=Object,{iterator:Z_,toStringTag:Pk}=Symbol,ev=(RS=Object.create(null),e=>{let t=Hte.call(e);return RS[t]||(RS[t]=t.slice(8,-1).toLowerCase())});var RS;let Da=e=>(e=e.toLowerCase(),t=>ev(t)===e),tv=e=>t=>typeof t===e,{isArray:Gu}=Array,xm=tv("undefined"),kk=Da("ArrayBuffer"),zte=tv("string"),ti=tv("function"),Lk=tv("number"),sv=e=>e!==null&&typeof e=="object",rv=e=>{if(ev(e)!=="object")return!1;let t=NS(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Pk in e||Z_ in e)},Kte=Da("Date"),qte=Da("File"),Yte=Da("Blob"),$te=Da("FileList"),Xte=Da("URLSearchParams"),[Jte,Qte,Zte,ese]=["ReadableStream","Request","Response","Headers"].map(Da);function bm(e,t){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Gu(e))for(s=0,a=e.length;s<a;s++)t.call(null,e[s],s,e);else{let d=c?Object.getOwnPropertyNames(e):Object.keys(e),h=d.length,p;for(s=0;s<h;s++)p=d[s],t.call(null,e[p],p,e)}}function Mk(e,t){t=t.toLowerCase();let s=Object.keys(e),a,c=s.length;for(;c-- >0;)if(a=s[c],t===a.toLowerCase())return a;return null}let sd=Ck!==void 0?Ck:typeof self<"u"?self:typeof window<"u"?window:global,Fk=e=>!xm(e)&&e!==sd,tse=(AS=typeof Uint8Array<"u"&&NS(Uint8Array),e=>AS&&e instanceof AS);var AS;let sse=Da("HTMLFormElement"),Uk=(e=>{let{hasOwnProperty:t}=e;return(s,a)=>t.call(s,a)})(Object.prototype),rse=Da("RegExp"),Vk=(e,t)=>{let s=Object.getOwnPropertyDescriptors(e),a={};bm(s,(c,d)=>{let h;(h=t(c,d,e))!==!1&&(a[d]=h||c)}),Object.defineProperties(e,a)},nse=Da("AsyncFunction"),Bk=(Wk=typeof Dk=="function",Gk=ti(sd.postMessage),Wk?Dk:Gk?(IS="axios@".concat(Math.random()),nv=[],sd.addEventListener("message",e=>{let{source:t,data:s}=e;t===sd&&s===IS&&nv.length&&nv.shift()()},!1),e=>{nv.push(e),sd.postMessage(IS,"*")}):e=>setTimeout(e));var Wk,Gk,IS,nv;let ise=Ok!==void 0?Ok.bind(sd):typeof process<"u"&&process.nextTick||Bk;var Fe={isArray:Gu,isArrayBuffer:kk,isBuffer:function(e){return e!==null&&!xm(e)&&e.constructor!==null&&!xm(e.constructor)&&ti(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ti(e.append)&&((t=ev(e))==="formdata"||t==="object"&&ti(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&kk(e.buffer),t},isString:zte,isNumber:Lk,isBoolean:e=>e===!0||e===!1,isObject:sv,isPlainObject:rv,isReadableStream:Jte,isRequest:Qte,isResponse:Zte,isHeaders:ese,isUndefined:xm,isDate:Kte,isFile:qte,isBlob:Yte,isRegExp:rse,isFunction:ti,isStream:e=>sv(e)&&ti(e.pipe),isURLSearchParams:Xte,isTypedArray:tse,isFileList:$te,forEach:bm,merge:function e(){let{caseless:t}=Fk(this)&&this||{},s={},a=(c,d)=>{let h=t&&Mk(s,d)||d;rv(s[h])&&rv(c)?s[h]=e(s[h],c):rv(c)?s[h]=e({},c):Gu(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&bm(arguments[c],a);return s},extend:function(e,t,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return bm(t,(c,d)=>{s&&ti(c)?e[d]=jk(c,s):e[d]=c},{allOwnKeys:a}),e},trim:e=>Kr(e)?Kr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,s,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,a)=>{let c,d,h,p={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),d=c.length;d-- >0;)h=c[d],a&&!a(h,e,t)||p[h]||(t[h]=e[h],p[h]=!0);e=s!==!1&&NS(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:ev,kindOfTest:Da,endsWith:(e,t,s)=>{e=String(e),(s===void 0||s>e.length)&&(s=e.length),s-=t.length;let a=e.indexOf(t,s);return a!==-1&&a===s},toArray:e=>{if(!e)return null;if(Gu(e))return e;let t=e.length;if(!Lk(t))return null;let s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{let s=(e&&e[Z_]).call(e),a;for(;(a=s.next())&&!a.done;){let c=a.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let s,a=[];for(;(s=e.exec(t))!==null;)a.push(s);return a},isHTMLForm:sse,hasOwnProperty:Uk,hasOwnProp:Uk,reduceDescriptors:Vk,freezeMethods:e=>{Vk(e,(t,s)=>{if(ti(e)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;let a=e[s];ti(a)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{let s={},a=c=>{c.forEach(d=>{s[d]=!0})};return Gu(e)?a(e):a(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,a){return s.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:Mk,global:sd,isContextDefined:Fk,isSpecCompliantForm:function(e){return!!(e&&ti(e.append)&&e[Pk]==="FormData"&&e[Z_])},toJSONObject:e=>{let t=new Array(10),s=(a,c)=>{if(sv(a)){if(t.indexOf(a)>=0)return;if(!("toJSON"in a)){t[c]=a;let d=Gu(a)?[]:{};return bm(a,(h,p)=>{let f=s(h,c+1);!xm(f)&&(d[p]=f)}),t[c]=void 0,d}}return a};return s(e,0)},isAsyncFn:nse,isThenable:e=>e&&(sv(e)||ti(e))&&ti(e.then)&&ti(e.catch),setImmediate:Bk,asap:ise,isIterable:e=>e!=null&&ti(e[Z_])};function Jt(e,t,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}Fe.inherits(Jt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Fe.toJSONObject(this.config),code:this.code,status:this.status}}});let Hk=Jt.prototype,zk={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{zk[e]={value:e}}),Object.defineProperties(Jt,zk),Object.defineProperty(Hk,"isAxiosError",{value:!0}),Jt.from=(e,t,s,a,c,d)=>{let h=Object.create(Hk);return Fe.toFlatObject(e,h,function(p){return p!==Error.prototype},p=>p!=="isAxiosError"),Jt.call(h,e.message,t,s,a,c),h.cause=e,h.name=e.name,d&&Object.assign(h,d),h};function DS(e){return Fe.isPlainObject(e)||Fe.isArray(e)}function Kk(e){return Fe.endsWith(e,"[]")?e.slice(0,-2):e}function qk(e,t,s){return e?e.concat(t).map(function(a,c){return a=Kk(a),!s&&c?"["+a+"]":a}).join(s?".":""):t}let ase=Fe.toFlatObject(Fe,{},null,function(e){return/^is[A-Z]/.test(e)});function iv(e,t,s){if(!Fe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let a=(s=Fe.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,T){return!Fe.isUndefined(T[w])})).metaTokens,c=s.visitor||_,d=s.dots,h=s.indexes,p=(s.Blob||typeof Blob<"u"&&Blob)&&Fe.isSpecCompliantForm(t);if(!Fe.isFunction(c))throw new TypeError("visitor must be a function");function f(w){if(w===null)return"";if(Fe.isDate(w))return w.toISOString();if(!p&&Fe.isBlob(w))throw new Jt("Blob is not supported. Use a Buffer instead.");return Fe.isArrayBuffer(w)||Fe.isTypedArray(w)?p&&typeof Blob=="function"?new Blob([w]):Buffer.from(w):w}function _(w,T,U){let k=w;if(w&&!U&&typeof w=="object"){if(Fe.endsWith(T,"{}"))T=a?T:T.slice(0,-2),w=JSON.stringify(w);else if(Fe.isArray(w)&&function(F){return Fe.isArray(F)&&!F.some(DS)}(w)||(Fe.isFileList(w)||Fe.endsWith(T,"[]"))&&(k=Fe.toArray(w)))return T=Kk(T),k.forEach(function(F,z){!Fe.isUndefined(F)&&F!==null&&t.append(h===!0?qk([T],z,d):h===null?T:T+"[]",f(F))}),!1}return!!DS(w)||(t.append(qk(U,T,d),f(w)),!1)}let v=[],b=Object.assign(ase,{defaultVisitor:_,convertValue:f,isVisitable:DS});if(!Fe.isObject(e))throw new TypeError("data must be an object");return function w(T,U){if(!Fe.isUndefined(T)){if(v.indexOf(T)!==-1)throw Error("Circular reference detected in "+U.join("."));v.push(T),Fe.forEach(T,function(k,F){(!(Fe.isUndefined(k)||k===null)&&c.call(t,k,Fe.isString(F)?Kr(F).call(F):F,U,b))===!0&&w(k,U?U.concat(F):[F])}),v.pop()}}(e),t}function Yk(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function OS(e,t){this._pairs=[],e&&iv(e,this,t)}let $k=OS.prototype;function ose(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Xk(e,t,s){if(!t)return e;let a=s&&s.encode||ose;Fe.isFunction(s)&&(s={serialize:s});let c=s&&s.serialize,d;if(d=c?c(t,s):Fe.isURLSearchParams(t)?t.toString():new OS(t,s).toString(a),d){let h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+d}return e}$k.append=function(e,t){this._pairs.push([e,t])},$k.toString=function(e){let t=e?function(s){return e.call(this,s,Yk)}:Yk;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};var Jk=class{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Fe.forEach(this.handlers,function(t){t!==null&&e(t)})}},Qk={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Zk={exports:{}},cse=qt,lse=he,e1=Hi.f;cse({target:"Object",stat:!0,forced:Object.defineProperty!==e1,sham:!lse},{defineProperty:e1});var t1=Ps.Object,dse=Zk.exports=function(e,t,s){return t1.defineProperty(e,t,s)};t1.defineProperty.sham&&(dse.sham=!0);var s1=u(Zk.exports),use=TypeError,r1=tm,hse=S_,pse=kt,mse=qs("species"),n1=Array,fse=function(e){var t;return r1(e)&&(t=e.constructor,(hse(t)&&(t===n1||r1(t.prototype))||pse(t)&&(t=t[mse])===null)&&(t=void 0)),t===void 0?n1:t},i1=function(e,t){return new(fse(e))(t===0?0:t)},gse=m,_se=Ta,vse=qs("species"),a1=function(e){return _se>=51||!gse(function(){var t=[];return(t.constructor={})[vse]=function(){return{foo:1}},t[e](Boolean).foo!==1})},Ese=qt,yse=m,xse=tm,bse=kt,wse=po,Sse=Ac,o1=function(e){if(e>9007199254740991)throw use("Maximum allowed index exceeded");return e},c1=Yw,Cse=i1,Tse=a1,Nse=Ta,l1=qs("isConcatSpreadable"),Rse=Nse>=51||!yse(function(){var e=[];return e[l1]=!1,e.concat()[0]!==e}),Ase=function(e){if(!bse(e))return!1;var t=e[l1];return t!==void 0?!!t:xse(e)};Ese({target:"Array",proto:!0,forced:!Rse||!Tse("concat")},{concat:function(e){var t,s,a,c,d,h=wse(this),p=Cse(h,0),f=0;for(t=-1,a=arguments.length;t<a;t++)if(Ase(d=t===-1?h:arguments[t]))for(c=Sse(d),o1(f+c),s=0;s<c;s++,f++)s in d&&c1(p,f,d[s]);else o1(f+1),c1(p,f++,d);return p.length=f,p}});var d1={},Ise=H,Dse=vt,u1=c_.f,Ose=Oc,h1=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];d1.f=function(e){return h1&&Ise(e)==="Window"?function(t){try{return u1(t)}catch{return Ose(h1)}}(e):u1(Dse(e))};var Hu={},jse=qs;Hu.f=jse;var p1=Ps,Pse=Ur,kse=Hu,Lse=Hi.f,ur=function(e){var t=p1.Symbol||(p1.Symbol={});Pse(t,e)||Lse(t,e,{value:kse.f(e)})},Mse=fe,Fse=br,Use=qs,Vse=Dc,m1=function(){var e=Fse("Symbol"),t=e&&e.prototype,s=t&&t.valueOf,a=Use("toPrimitive");t&&!t[a]&&Vse(t,a,function(c){return Mse(s,this)},{})},Bse=Rc,Wse=Xe,Gse=po,Hse=Ac,zse=i1;C([].push);var Kse=function(e){return function(t,s,a,c){for(var d,h,p=Gse(t),f=Wse(p),_=Hse(f),v=Bse(s,a),b=0,w=c||zse,T=void 0;_>b;b++)b in f&&(h=v(d=f[b],b,p));return T}},f1={forEach:Kse(0)},av=qt,wm=G,jS=fe,qse=C,zu=he,Ku=Qn,Yse=m,Zr=Ur,$se=N,PS=Ln,ov=vt,kS=bb,Xse=ei,LS=Ze,qu=rm,g1=d_,Jse=c_,_1=d1,Qse=sm,v1=ge,E1=Hi,Zse=Wb,y1=ae,x1=Dc,ere=w_,MS=yu,b1=l_,w1=yb,tre=qs,sre=Hu,rre=ur,nre=m1,ire=Xo,S1=$l,cv=f1.forEach,si=o_("hidden"),lv="Symbol",Sm="prototype",are=S1.set,C1=S1.getterFor(lv),Oa=Object[Sm],rd=wm.Symbol,dv=rd&&rd[Sm],ore=wm.RangeError,cre=wm.TypeError,FS=wm.QObject,T1=v1.f,nd=E1.f,N1=_1.f,lre=y1.f,R1=qse([].push),Zo=MS("symbols"),Cm=MS("op-symbols"),dre=MS("wks"),US=!FS||!FS[Sm]||!FS[Sm].findChild,A1=function(e,t,s){var a=T1(Oa,t);a&&delete Oa[t],nd(e,t,s),a&&e!==Oa&&nd(Oa,t,a)},VS=zu&&Yse(function(){return qu(nd({},"a",{get:function(){return nd(this,"a",{value:7}).a}})).a!==7})?A1:nd,BS=function(e,t){var s=Zo[e]=qu(dv);return are(s,{type:lv,tag:e,description:t}),zu||(s.description=t),s},uv=function(e,t,s){e===Oa&&uv(Cm,t,s),PS(e);var a=kS(t);return PS(s),Zr(Zo,a)?(s.enumerable?(Zr(e,si)&&e[si][a]&&(e[si][a]=!1),s=qu(s,{enumerable:LS(0,!1)})):(Zr(e,si)||nd(e,si,LS(1,qu(null))),e[si][a]=!0),VS(e,a,s)):nd(e,a,s)},WS=function(e,t){PS(e);var s=ov(t),a=g1(s).concat(j1(s));return cv(a,function(c){zu&&!jS(I1,s,c)||uv(e,c,s[c])}),e},I1=function(e){var t=kS(e),s=jS(lre,this,t);return!(this===Oa&&Zr(Zo,t)&&!Zr(Cm,t))&&(!(s||!Zr(this,t)||!Zr(Zo,t)||Zr(this,si)&&this[si][t])||s)},D1=function(e,t){var s=ov(e),a=kS(t);if(s!==Oa||!Zr(Zo,a)||Zr(Cm,a)){var c=T1(s,a);return!c||!Zr(Zo,a)||Zr(s,si)&&s[si][a]||(c.enumerable=!0),c}},O1=function(e){var t=N1(ov(e)),s=[];return cv(t,function(a){Zr(Zo,a)||Zr(b1,a)||R1(s,a)}),s},j1=function(e){var t=e===Oa,s=N1(t?Cm:ov(e)),a=[];return cv(s,function(c){!Zr(Zo,c)||t&&!Zr(Oa,c)||R1(a,Zo[c])}),a};Ku||(rd=function(){if($se(dv,this))throw new cre("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Xse(arguments[0]):void 0,t=w1(e),s=function(a){var c=this===void 0?wm:this;c===Oa&&jS(s,Cm,a),Zr(c,si)&&Zr(c[si],t)&&(c[si][t]=!1);var d=LS(1,a);try{VS(c,t,d)}catch(h){if(!(h instanceof ore))throw h;A1(c,t,d)}};return zu&&US&&VS(Oa,t,{configurable:!0,set:s}),BS(t,e)},x1(dv=rd[Sm],"toString",function(){return C1(this).tag}),x1(rd,"withoutSetter",function(e){return BS(w1(e),e)}),y1.f=I1,E1.f=uv,Zse.f=WS,v1.f=D1,Jse.f=_1.f=O1,Qse.f=j1,sre.f=function(e){return BS(tre(e),e)},zu&&ere(dv,"description",{configurable:!0,get:function(){return C1(this).description}})),av({global:!0,wrap:!0,forced:!Ku,sham:!Ku},{Symbol:rd}),cv(g1(dre),function(e){rre(e)}),av({target:lv,stat:!0,forced:!Ku},{useSetter:function(){US=!0},useSimple:function(){US=!1}}),av({target:"Object",stat:!0,forced:!Ku,sham:!zu},{create:function(e,t){return t===void 0?qu(e):WS(qu(e),t)},defineProperty:uv,defineProperties:WS,getOwnPropertyDescriptor:D1}),av({target:"Object",stat:!0,forced:!Ku},{getOwnPropertyNames:O1}),nre(),ire(rd,lv),b1[si]=!0;var P1=Qn&&!!Symbol.for&&!!Symbol.keyFor,ure=qt,hre=br,pre=Ur,mre=ei,k1=yu,fre=P1,GS=k1("string-to-symbol-registry"),gre=k1("symbol-to-string-registry");ure({target:"Symbol",stat:!0,forced:!fre},{for:function(e){var t=mre(e);if(pre(GS,t))return GS[t];var s=hre("Symbol")(t);return GS[t]=s,gre[s]=t,s}});var _re=qt,vre=Ur,Ere=Jp,yre=Eu,xre=P1,L1=yu("symbol-to-string-registry");_re({target:"Symbol",stat:!0,forced:!xre},{keyFor:function(e){if(!Ere(e))throw new TypeError(yre(e)+" is not a symbol");if(vre(L1,e))return L1[e]}});var M1=tm,bre=Ee,F1=H,wre=ei,U1=C([].push),Sre=qt,V1=br,B1=D,Cre=fe,Tm=C,W1=m,G1=Ee,H1=Jp,z1=Oc,Tre=function(e){if(bre(e))return e;if(M1(e)){for(var t=e.length,s=[],a=0;a<t;a++){var c=e[a];typeof c=="string"?U1(s,c):typeof c!="number"&&F1(c)!=="Number"&&F1(c)!=="String"||U1(s,wre(c))}var d=s.length,h=!0;return function(p,f){if(h)return h=!1,f;if(M1(this))return f;for(var _=0;_<d;_++)if(s[_]===p)return f}}},Nre=Qn,Rre=String,Fc=V1("JSON","stringify"),hv=Tm(/./.exec),K1=Tm("".charAt),Are=Tm("".charCodeAt),Ire=Tm("".replace),Dre=Tm(1 .toString),Ore=/[\uD800-\uDFFF]/g,q1=/^[\uD800-\uDBFF]$/,Y1=/^[\uDC00-\uDFFF]$/,$1=!Nre||W1(function(){var e=V1("Symbol")("stringify detection");return Fc([e])!=="[null]"||Fc({a:e})!=="{}"||Fc(Object(e))!=="{}"}),X1=W1(function(){return Fc("\uDF06\uD834")!=='"\\udf06\\ud834"'||Fc("\uDEAD")!=='"\\udead"'}),jre=function(e,t){var s=z1(arguments),a=Tre(t);if(G1(a)||e!==void 0&&!H1(e))return s[1]=function(c,d){if(G1(a)&&(d=Cre(a,this,Rre(c),d)),!H1(d))return d},B1(Fc,null,s)},Pre=function(e,t,s){var a=K1(s,t-1),c=K1(s,t+1);return hv(q1,e)&&!hv(Y1,c)||hv(Y1,e)&&!hv(q1,a)?"\\u"+Dre(Are(e,0),16):e};Fc&&Sre({target:"JSON",stat:!0,forced:$1||X1},{stringify:function(e,t,s){var a=z1(arguments),c=B1($1?jre:Fc,null,a);return X1&&typeof c=="string"?Ire(c,Ore,Pre):c}});var J1=sm,kre=po;qt({target:"Object",stat:!0,forced:!Qn||m(function(){J1.f(1)})},{getOwnPropertySymbols:function(e){var t=J1.f;return t?t(kre(e)):[]}}),ur("asyncIterator"),ur("hasInstance"),ur("isConcatSpreadable"),ur("iterator"),ur("match"),ur("matchAll"),ur("replace"),ur("search"),ur("species"),ur("split");var Lre=m1;ur("toPrimitive"),Lre();var Mre=br,Fre=Xo;ur("toStringTag"),Fre(Mre("Symbol"),"Symbol"),ur("unscopables"),Xo(G.JSON,"JSON",!0);var Ure=Ps.Symbol,Vre=qs,Bre=Hi.f,Q1=Vre("metadata"),Z1=Function.prototype;Z1[Q1]===void 0&&Bre(Z1,Q1,{value:null}),ur("asyncDispose"),ur("dispose"),ur("metadata");var Wre=Ure,Gre=C,HS=br("Symbol"),Hre=HS.keyFor,zre=Gre(HS.prototype.valueOf),e2=HS.isRegisteredSymbol||function(e){try{return Hre(zre(e))!==void 0}catch{return!1}};qt({target:"Symbol",stat:!0},{isRegisteredSymbol:e2});for(var Kre=yu,t2=br,qre=C,Yre=Jp,$re=qs,pv=t2("Symbol"),s2=pv.isWellKnownSymbol,r2=t2("Object","getOwnPropertyNames"),Xre=qre(pv.prototype.valueOf),n2=Kre("wks"),zS=0,i2=r2(pv),Jre=i2.length;zS<Jre;zS++)try{var a2=i2[zS];Yre(pv[a2])&&$re(a2)}catch{}var o2=function(e){if(s2&&s2(e))return!0;try{for(var t=Xre(e),s=0,a=r2(n2),c=a.length;s<c;s++)if(n2[a[s]]==t)return!0}catch{}return!1};qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:o2}),ur("customMatcher"),ur("observable"),qt({target:"Symbol",stat:!0},{isRegistered:e2}),qt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:o2}),ur("matcher"),ur("metadataKey"),ur("patternMatch"),ur("replaceAll");var Yu=u(Wre),c2=u(Hu.f("iterator"));function Nm(e){return Nm=typeof Yu=="function"&&typeof c2=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Yu=="function"&&t.constructor===Yu&&t!==Yu.prototype?"symbol":typeof t},Nm(e)}var Qre=u(Hu.f("toPrimitive"));function Zre(e){var t=function(s,a){if(Nm(s)!="object"||!s)return s;var c=s[Qre];if(c!==void 0){var d=c.call(s,a);if(Nm(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}(e,"string");return Nm(t)=="symbol"?t:t+""}function B(e,t,s){return(t=Zre(t))in e?s1(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var l2=u(ZZ),ene={isBrowser:!0,classes:{URLSearchParams:l2!==void 0?l2:OS,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let KS=typeof window<"u"&&typeof document<"u",qS=typeof navigator=="object"&&navigator||void 0,tne=KS&&(!qS||["ReactNative","NativeScript","NS"].indexOf(qS.product)<0),sne=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",rne=KS&&window.location.href||"http://localhost";function d2(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function u2(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?d2(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):d2(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}var yn=u2(u2({},Object.freeze({__proto__:null,hasBrowserEnv:KS,hasStandardBrowserEnv:tne,hasStandardBrowserWebWorkerEnv:sne,navigator:qS,origin:rne})),ene),nne=Ln,ine=fe,ane=Ur,one=N,cne=function(){var e=nne(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},h2=RegExp.prototype,p2=function(e){var t=e.flags;return t!==void 0||"flags"in h2||ane(e,"flags")||!one(h2,e)?t:ine(cne,e)},lne=Pw.charAt,m2=fe,dne=Ln,une=Ee,hne=H,pne=/./.exec,mne=TypeError,fne=qt,f2=fe,g2=ne,gne=tw,mv=x_,_2=Ct,v2=vD,Rm=ei,_ne=Ln,vne=kt,Ene=H,yne=yD,E2=p2,xne=t_,bne=m,wne=ow,Sne=function(e,t,s){return t+(s?lne(e,t).length:1)},Cne=function(e,t){var s=e.exec;if(une(s)){var a=m2(s,e,t);return a!==null&&dne(a),a}if(hne(e)==="RegExp")return m2(pne,e,t);throw new mne("RegExp#exec called on incompatible receiver")},y2=$l,Tne=qs("matchAll"),x2="RegExp String",b2=x2+" Iterator",Nne=y2.set,Rne=y2.getterFor(b2),Ane=TypeError,YS=g2("".indexOf),fv=g2("".matchAll),$S=!!fv&&!bne(function(){fv("a",/./)}),Ine=gne(function(e,t,s,a){Nne(this,{type:b2,regexp:e,string:t,global:s,unicode:a,done:!1})},x2,function(){var e=Rne(this);if(e.done)return mv(void 0,!0);var t=e.regexp,s=e.string,a=Cne(t,s);return a===null?(e.done=!0,mv(void 0,!0)):e.global?(Rm(a[0])===""&&(t.lastIndex=Sne(s,v2(t.lastIndex),e.unicode)),mv(a,!1)):(e.done=!0,mv(a,!1))}),w2=function(e){var t,s,a,c=_ne(this),d=Rm(e),h=wne(c,RegExp),p=Rm(E2(c));return t=new h(h===RegExp?c.source:c,p),s=!!~YS(p,"g"),a=!!~YS(p,"u"),t.lastIndex=v2(c.lastIndex),new Ine(t,d,s,a)};fne({target:"String",proto:!0,forced:$S},{matchAll:function(e){var t,s,a,c,d=_2(this);if(vne(e)){if(yne(e)&&(t=Rm(_2(E2(e))),!~YS(t,"g")))throw new Ane("`.matchAll` does not allow non-global regexes");if($S)return fv(d,e);if((a=xne(e,Tne))===void 0&&Ene(e)==="RegExp"&&(a=w2),a)return f2(a,e,d)}else if($S)return fv(d,e);return s=Rm(d),c=new RegExp(e,"g"),f2(w2,c,s)}});var Dne=zi("String","matchAll"),One=N,jne=Dne,XS=String.prototype,Pne=function(e){var t=e.matchAll;return typeof e=="string"||e===XS||One(XS,e)&&t===XS.matchAll?jne:t},kne=u(Pne);function S2(e){function t(s,a,c,d){let h=s[d++];if(h==="__proto__")return!0;let p=Number.isFinite(+h),f=d>=s.length;return h=!h&&Fe.isArray(c)?c.length:h,f?(Fe.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!p):(c[h]&&Fe.isObject(c[h])||(c[h]=[]),t(s,a,c[h],d)&&Fe.isArray(c[h])&&(c[h]=function(_){let v={},b=Object.keys(_),w,T=b.length,U;for(w=0;w<T;w++)U=b[w],v[U]=_[U];return v}(c[h])),!p)}if(Fe.isFormData(e)&&Fe.isFunction(e.entries)){let s={};return Fe.forEachEntry(e,(a,c)=>{t(function(d){return kne(Fe).call(Fe,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,s,0)}),s}return null}let JS={transitional:Qk,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let s=t.getContentType()||"",a=s.indexOf("application/json")>-1,c=Fe.isObject(e);if(c&&Fe.isHTMLForm(e)&&(e=new FormData(e)),Fe.isFormData(e))return a?JSON.stringify(S2(e)):e;if(Fe.isArrayBuffer(e)||Fe.isBuffer(e)||Fe.isStream(e)||Fe.isFile(e)||Fe.isBlob(e)||Fe.isReadableStream(e))return e;if(Fe.isArrayBufferView(e))return e.buffer;if(Fe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,p){return iv(h,new yn.classes.URLSearchParams,Object.assign({visitor:function(f,_,v,b){return yn.isNode&&Fe.isBuffer(f)?(this.append(_,f.toString("base64")),!1):b.defaultVisitor.apply(this,arguments)}},p))}(e,this.formSerializer).toString();if((d=Fe.isFileList(e))||s.indexOf("multipart/form-data")>-1){let h=this.env&&this.env.FormData;return iv(d?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||a?(t.setContentType("application/json",!1),function(h,p,f){if(Fe.isString(h))try{return(p||JSON.parse)(h),Kr(Fe).call(Fe,h)}catch(_){if(_.name!=="SyntaxError")throw _}return(f||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){let t=this.transitional||JS.transitional,s=t&&t.forcedJSONParsing,a=this.responseType==="json";if(Fe.isResponse(e)||Fe.isReadableStream(e))return e;if(e&&Fe.isString(e)&&(s&&!this.responseType||a)){let c=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(d){if(c)throw d.name==="SyntaxError"?Jt.from(d,Jt.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:yn.classes.FormData,Blob:yn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Fe.forEach(["delete","get","head","post","put","patch"],e=>{JS.headers[e]={}});var QS=JS;let Lne=Fe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),C2=Symbol("internals");function Am(e){var t;return e&&Kr(t=String(e)).call(t).toLowerCase()}function gv(e){return e===!1||e==null?e:Fe.isArray(e)?e.map(gv):String(e)}function ZS(e,t,s,a,c){return Fe.isFunction(a)?a.call(this,t,s):(c&&(t=s),Fe.isString(t)?Fe.isString(a)?t.indexOf(a)!==-1:Fe.isRegExp(a)?a.test(t):void 0:void 0)}class _v{constructor(t){t&&this.set(t)}set(t,s,a){let c=this;function d(f,_,v){let b=Am(_);if(!b)throw new Error("header name must be a non-empty string");let w=Fe.findKey(c,b);(!w||c[w]===void 0||v===!0||v===void 0&&c[w]!==!1)&&(c[w||_]=gv(f))}let h=(f,_)=>Fe.forEach(f,(v,b)=>d(v,b,_));if(Fe.isPlainObject(t)||t instanceof this.constructor)h(t,s);else if(Fe.isString(t)&&(t=Kr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Kr(p=t).call(p)))h((f=>{let _={},v,b,w;return f&&f.split(`
`).forEach(function(T){var U,k;w=T.indexOf(":"),v=Kr(U=T.substring(0,w)).call(U).toLowerCase(),b=Kr(k=T.substring(w+1)).call(k),!v||_[v]&&Lne[v]||(v==="set-cookie"?_[v]?_[v].push(b):_[v]=[b]:_[v]=_[v]?_[v]+", "+b:b)}),_})(t),s);else if(Fe.isObject(t)&&Fe.isIterable(t)){let f,_,v={};for(let b of t){if(!Fe.isArray(b))throw TypeError("Object iterator must return a key-value pair");v[_=b[0]]=(f=v[_])?Fe.isArray(f)?[...f,b[1]]:[f,b[1]]:b[1]}h(v,s)}else t!=null&&d(s,t,a);var p;return this}get(t,s){if(t=Am(t)){let a=Fe.findKey(this,t);if(a){let c=this[a];if(!s)return c;if(s===!0)return function(d){let h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,f;for(;f=p.exec(d);)h[f[1]]=f[2];return h}(c);if(Fe.isFunction(s))return s.call(this,c,a);if(Fe.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,s){if(t=Am(t)){let a=Fe.findKey(this,t);return!(!a||this[a]===void 0||s&&!ZS(0,this[a],a,s))}return!1}delete(t,s){let a=this,c=!1;function d(h){if(h=Am(h)){let p=Fe.findKey(a,h);!p||s&&!ZS(0,a[p],p,s)||(delete a[p],c=!0)}}return Fe.isArray(t)?t.forEach(d):d(t),c}clear(t){let s=Object.keys(this),a=s.length,c=!1;for(;a--;){let d=s[a];t&&!ZS(0,this[d],d,t,!0)||(delete this[d],c=!0)}return c}normalize(t){let s=this,a={};return Fe.forEach(this,(c,d)=>{var h;let p=Fe.findKey(a,d);if(p)return s[p]=gv(c),void delete s[d];let f=t?function(_){return Kr(_).call(_).toLowerCase().replace(/([a-z\d])(\w*)/g,(v,b,w)=>b.toUpperCase()+w)}(d):Kr(h=String(d)).call(h);f!==d&&delete s[d],s[f]=gv(c),a[f]=!0}),this}concat(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(t){let s=Object.create(null);return Fe.forEach(this,(a,c)=>{a!=null&&a!==!1&&(s[c]=t&&Fe.isArray(a)?a.join(", "):a)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[s,a]=t;return s+": "+a}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let s=new this(t);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach(h=>s.set(h)),s}static accessor(t){let s=(this[C2]=this[C2]={accessors:{}}).accessors,a=this.prototype;function c(d){let h=Am(d);s[h]||(function(p,f){let _=Fe.toCamelCase(" "+f);["get","set","has"].forEach(v=>{Object.defineProperty(p,v+_,{value:function(b,w,T){return this[v].call(this,f,b,w,T)},configurable:!0})})}(a,d),s[h]=!0)}return Fe.isArray(t)?t.forEach(c):c(t),this}}_v.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Fe.reduceDescriptors(_v.prototype,(e,t)=>{let{value:s}=e,a=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(c){this[a]=c}}}),Fe.freezeMethods(_v);var ja=_v;function e0(e,t){let s=this||QS,a=t||s,c=ja.from(a.headers),d=a.data;return Fe.forEach(e,function(h){d=h.call(s,d,c.normalize(),t?t.status:void 0)}),c.normalize(),d}function T2(e){return!(!e||!e.__CANCEL__)}function $u(e,t,s){Jt.call(this,e??"canceled",Jt.ERR_CANCELED,t,s),this.name="CanceledError"}function N2(e,t,s){let a=s.config.validateStatus;s.status&&a&&!a(s.status)?t(new Jt("Request failed with status code "+s.status,[Jt.ERR_BAD_REQUEST,Jt.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}Fe.inherits($u,Jt,{__CANCEL__:!0});let vv=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0,c=function(d,h){d=d||10;let p=new Array(d),f=new Array(d),_,v=0,b=0;return h=h!==void 0?h:1e3,function(w){let T=Date.now(),U=f[b];_||(_=T),p[v]=w,f[v]=T;let k=b,F=0;for(;k!==v;)F+=p[k++],k%=d;if(v=(v+1)%d,v===b&&(b=(b+1)%d),T-_<h)return;let z=U&&T-U;return z?Math.round(1e3*F/z):void 0}}(50,250);return function(d,h){let p,f,_=0,v=1e3/h,b=function(w){_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),p=null,f&&(clearTimeout(f),f=null),d.apply(null,w)};return[function(){let w=Date.now(),T=w-_;for(var U=arguments.length,k=new Array(U),F=0;F<U;F++)k[F]=arguments[F];T>=v?b(k,w):(p=k,f||(f=setTimeout(()=>{f=null,b(p)},v-T)))},()=>p&&b(p)]}(d=>{let h=d.loaded,p=d.lengthComputable?d.total:void 0,f=h-a,_=c(f);a=h,e({loaded:h,total:p,progress:p?h/p:void 0,bytes:f,rate:_||void 0,estimated:_&&p&&h<=p?(p-h)/_:void 0,event:d,lengthComputable:p!=null,[t?"download":"upload"]:!0})},s)},R2=(e,t)=>{let s=e!=null;return[a=>t[0]({lengthComputable:s,total:e,loaded:a}),t[1]]},A2=e=>function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return Fe.asap(()=>e(...s))};var Mne=yn.hasStandardBrowserEnv?((e,t)=>s=>(s=new K_(s,yn.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new K_(yn.origin),yn.navigator&&/(msie|trident)/i.test(yn.navigator.userAgent)):()=>!0,Fne=yn.hasStandardBrowserEnv?{write(e,t,s,a,c,d){let h=[e+"="+encodeURIComponent(t)];Fe.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),Fe.isString(a)&&h.push("path="+a),Fe.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function I2(e,t,s){let a=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(t);return e&&(a||s==0)?function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}(e,t):t}function D2(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}let O2=e=>e instanceof ja?function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?D2(Object(a),!0).forEach(function(c){B(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):D2(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}({},e):e;function id(e,t){t=t||{};let s={};function a(_,v,b,w){return Fe.isPlainObject(_)&&Fe.isPlainObject(v)?Fe.merge.call({caseless:w},_,v):Fe.isPlainObject(v)?Fe.merge({},v):Fe.isArray(v)?v.slice():v}function c(_,v,b,w){return Fe.isUndefined(v)?Fe.isUndefined(_)?void 0:a(void 0,_,0,w):a(_,v,0,w)}function d(_,v){if(!Fe.isUndefined(v))return a(void 0,v)}function h(_,v){return Fe.isUndefined(v)?Fe.isUndefined(_)?void 0:a(void 0,_):a(void 0,v)}function p(_,v,b){return b in t?a(_,v):b in e?a(void 0,_):void 0}let f={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p,headers:(_,v,b)=>c(O2(_),O2(v),0,!0)};return Fe.forEach(Object.keys(Object.assign({},e,t)),function(_){let v=f[_]||c,b=v(e[_],t[_],_);Fe.isUndefined(b)&&v!==p||(s[_]=b)}),s}var j2=e=>{let t=id({},e),s,{data:a,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:p,auth:f}=t;if(t.headers=p=ja.from(p),t.url=Xk(I2(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),f&&p.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):""))),Fe.isFormData(a)){if(yn.hasStandardBrowserEnv||yn.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if((s=p.getContentType())!==!1){let[_,...v]=s?s.split(";").map(b=>Kr(b).call(b)).filter(Boolean):[];p.setContentType([_||"multipart/form-data",...v].join("; "))}}if(yn.hasStandardBrowserEnv&&(c&&Fe.isFunction(c)&&(c=c(t)),c||c!==!1&&Mne(t.url))){let _=d&&h&&Fne.read(h);_&&p.set(d,_)}return t},Une=typeof XMLHttpRequest<"u"&&function(e){return new Ve(function(t,s){let a=j2(e),c=a.data,d=ja.from(a.headers).normalize(),h,p,f,_,v,{responseType:b,onUploadProgress:w,onDownloadProgress:T}=a;function U(){_&&_(),v&&v(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let k=new XMLHttpRequest;function F(){if(!k)return;let Y=ja.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders());N2(function(X){t(X),U()},function(X){s(X),U()},{data:b&&b!=="text"&&b!=="json"?k.response:k.responseText,status:k.status,statusText:k.statusText,headers:Y,config:e,request:k}),k=null}k.open(a.method.toUpperCase(),a.url,!0),k.timeout=a.timeout,"onloadend"in k?k.onloadend=F:k.onreadystatechange=function(){k&&k.readyState===4&&(k.status!==0||k.responseURL&&k.responseURL.indexOf("file:")===0)&&setTimeout(F)},k.onabort=function(){k&&(s(new Jt("Request aborted",Jt.ECONNABORTED,e,k)),k=null)},k.onerror=function(){s(new Jt("Network Error",Jt.ERR_NETWORK,e,k)),k=null},k.ontimeout=function(){let Y=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded",X=a.transitional||Qk;a.timeoutErrorMessage&&(Y=a.timeoutErrorMessage),s(new Jt(Y,X.clarifyTimeoutError?Jt.ETIMEDOUT:Jt.ECONNABORTED,e,k)),k=null},c===void 0&&d.setContentType(null),"setRequestHeader"in k&&Fe.forEach(d.toJSON(),function(Y,X){k.setRequestHeader(X,Y)}),Fe.isUndefined(a.withCredentials)||(k.withCredentials=!!a.withCredentials),b&&b!=="json"&&(k.responseType=a.responseType),T&&([f,v]=vv(T,!0),k.addEventListener("progress",f)),w&&k.upload&&([p,_]=vv(w),k.upload.addEventListener("progress",p),k.upload.addEventListener("loadend",_)),(a.cancelToken||a.signal)&&(h=Y=>{k&&(s(!Y||Y.type?new $u(null,e,k):Y),k.abort(),k=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));let z=function(Y){let X=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return X&&X[1]||""}(a.url);z&&yn.protocols.indexOf(z)===-1?s(new Jt("Unsupported protocol "+z+":",Jt.ERR_BAD_REQUEST,e)):k.send(c||null)})},Vne=(e,t)=>{let{length:s}=e=e?e.filter(Boolean):[];if(t||s){let a,c=new AbortController,d=function(_){if(!a){a=!0,p();let v=_ instanceof Error?_:this.reason;c.abort(v instanceof Jt?v:new $u(v instanceof Error?v.message:v))}},h=t&&setTimeout(()=>{h=null,d(new Jt("timeout ".concat(t," of ms exceeded"),Jt.ETIMEDOUT))},t),p=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(_=>{_.unsubscribe?_.unsubscribe(d):_.removeEventListener("abort",d)}),e=null)};e.forEach(_=>_.addEventListener("abort",d));let{signal:f}=c;return f.unsubscribe=()=>Fe.asap(p),f}},t0=u(xj),P2=Hu.f("asyncIterator"),Bne=u(P2);function s0(e,t){this.v=e,this.k=t}function wi(e){return function(){return new Im(e.apply(this,arguments))}}function Im(e){var t,s;function a(d,h){try{var p=e[d](h),f=p.value,_=f instanceof s0;t0.resolve(_?f.v:f).then(function(v){if(_){var b=d==="return"?"return":"next";if(!f.k||v.done)return a(b,v);v=e[b](v).value}c(p.done?"return":"normal",v)},function(v){a("throw",v)})}catch(v){c("throw",v)}}function c(d,h){switch(d){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?a(t.key,t.arg):s=null}this._invoke=function(d,h){return new t0(function(p,f){var _={key:d,arg:h,resolve:p,reject:f,next:null};s?s=s.next=_:(t=s=_,a(d,h))})},typeof e.return!="function"&&(this.return=void 0)}function Ot(e){return new s0(e,0)}function Ev(e){var t={},s=!1;function a(c,d){return s=!0,d=new t0(function(h){h(e[c](d))}),{done:!1,value:new s0(d,1)}}return t[Yu!==void 0&&c2||"@@iterator"]=function(){return this},t.next=function(c){return s?(s=!1,c):a("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return s?(s=!1,c):a("return",c)}),t}Im.prototype[typeof Yu=="function"&&Bne||"@@asyncIterator"]=function(){return this},Im.prototype.next=function(e){return this._invoke("next",e)},Im.prototype.throw=function(e){return this._invoke("throw",e)},Im.prototype.return=function(e){return this._invoke("return",e)};var r0=u(P2);function n0(e){var t,s,a,c=2;for(typeof Symbol<"u"&&(s=r0,a=Symbol.iterator);c--;){if(s&&(t=e[s])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new yv(t.call(e));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function yv(e){function t(s){if(Object(s)!==s)return Ve.reject(new TypeError(s+" is not an object."));var a=s.done;return Ve.resolve(s.value).then(function(c){return{value:c,done:a}})}return yv=function(s){this.s=s,this.n=s.next},yv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?Ve.resolve({value:s,done:!0}):t(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?Ve.reject(s):t(a.apply(this.s,arguments))}},new yv(e)}let Wne=function*(e,t){let s=e.byteLength;if(!t||s<t)return void(yield e);let a,c=0;for(;c<s;)a=c+t,yield e.slice(c,a),c=a},Gne=function(){var e=wi(function*(t,s){var a,c=!1,d=!1;try{for(var h,p=n0(Hne(t));c=!(h=yield Ot(p.next())).done;c=!1){let f=h.value;yield*Ev(n0(Wne(f,s)))}}catch(f){d=!0,a=f}finally{try{c&&p.return!=null&&(yield Ot(p.return()))}finally{if(d)throw a}}});return function(t,s){return e.apply(this,arguments)}}(),Hne=function(){var e=wi(function*(t){if(t[r0])return void(yield*Ev(n0(t)));let s=t.getReader();try{for(;;){let{done:a,value:c}=yield Ot(s.read());if(a)break;yield c}}finally{yield Ot(s.cancel())}});return function(t){return e.apply(this,arguments)}}(),k2=(e,t,s,a)=>{let c=Gne(e,t),d,h=0,p=f=>{d||(d=!0,a&&a(f))};return new ReadableStream({async pull(f){try{let{done:_,value:v}=await c.next();if(_)return p(),void f.close();let b=v.byteLength;if(s){let w=h+=b;s(w)}f.enqueue(new Uint8Array(v))}catch(_){throw p(_),_}},cancel:f=>(p(f),c.return())},{highWaterMark:2})};function L2(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function M2(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?L2(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):L2(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let xv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",F2=xv&&typeof ReadableStream=="function",zne=xv&&(typeof TextEncoder=="function"?(U2=new TextEncoder,e=>U2.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var U2;let V2=function(e){try{for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];return!!e(...s)}catch{return!1}},Kne=F2&&V2(()=>{let e=!1,t=new Request(yn.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),i0=F2&&V2(()=>Fe.isReadableStream(new Response("").body)),bv={stream:i0&&(e=>e.body)};var B2;xv&&(B2=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!bv[e]&&(bv[e]=Fe.isFunction(B2[e])?t=>t[e]():(t,s)=>{throw new Jt("Response type '".concat(e,"' is not supported"),Jt.ERR_NOT_SUPPORT,s)})}));let qne=async(e,t)=>Fe.toFiniteNumber(e.getContentLength())??(async a=>a==null?0:Fe.isBlob(a)?a.size:Fe.isSpecCompliantForm(a)?(await new Request(yn.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:Fe.isArrayBufferView(a)||Fe.isArrayBuffer(a)?a.byteLength:(Fe.isURLSearchParams(a)&&(a+=""),Fe.isString(a)?(await zne(a)).byteLength:void 0))(t);var Yne=xv&&(async e=>{let{url:t,method:s,data:a,signal:c,cancelToken:d,timeout:h,onDownloadProgress:p,onUploadProgress:f,responseType:_,headers:v,withCredentials:b="same-origin",fetchOptions:w}=j2(e);_=_?(_+"").toLowerCase():"text";let T,U=Vne([c,d&&d.toAbortSignal()],h),k=U&&U.unsubscribe&&(()=>{U.unsubscribe()}),F;try{if(f&&Kne&&s!=="get"&&s!=="head"&&(F=await qne(v,a))!==0){let te,Z=new Request(t,{method:"POST",body:a,duplex:"half"});if(Fe.isFormData(a)&&(te=Z.headers.get("content-type"))&&v.setContentType(te),Z.body){let[de,xe]=R2(F,vv(A2(f)));a=k2(Z.body,65536,de,xe)}}Fe.isString(b)||(b=b?"include":"omit");let z="credentials"in Request.prototype;T=new Request(t,M2(M2({},w),{},{signal:U,method:s.toUpperCase(),headers:v.normalize().toJSON(),body:a,duplex:"half",credentials:z?b:void 0}));let Y=await fetch(T),X=i0&&(_==="stream"||_==="response");if(i0&&(p||X&&k)){let te={};["status","statusText","headers"].forEach(Se=>{te[Se]=Y[Se]});let Z=Fe.toFiniteNumber(Y.headers.get("content-length")),[de,xe]=p&&R2(Z,vv(A2(p),!0))||[];Y=new Response(k2(Y.body,65536,de,()=>{xe&&xe(),k&&k()}),te)}_=_||"text";let re=await bv[Fe.findKey(bv,_)||"text"](Y,e);return!X&&k&&k(),await new Ve((te,Z)=>{N2(te,Z,{data:re,headers:ja.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:T})})}catch(z){throw k&&k(),z&&z.name==="TypeError"&&/Load failed|fetch/i.test(z.message)?Object.assign(new Jt("Network Error",Jt.ERR_NETWORK,e,T),{cause:z.cause||z}):Jt.from(z,z&&z.code,e,T)}});let a0={http:null,xhr:Une,fetch:Yne};Fe.forEach(a0,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let W2=e=>"- ".concat(e),$ne=e=>Fe.isFunction(e)||e===null||e===!1;var G2={getAdapter:e=>{e=Fe.isArray(e)?e:[e];let{length:t}=e,s,a,c={};for(let d=0;d<t;d++){let h;if(s=e[d],a=s,!$ne(s)&&(a=a0[(h=String(s)).toLowerCase()],a===void 0))throw new Jt("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+d]=a}if(!a){let d=Object.entries(c).map(h=>{let[p,f]=h;return"adapter ".concat(p," ")+(f===!1?"is not supported by the environment":"is not available in the build")});throw new Jt("There is no suitable adapter to dispatch the request "+(t?d.length>1?`since :
`+d.map(W2).join(`
`):" "+W2(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:a0};function o0(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new $u(null,e)}function H2(e){return o0(e),e.headers=ja.from(e.headers),e.data=e0.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),G2.getAdapter(e.adapter||QS.adapter)(e).then(function(t){return o0(e),t.data=e0.call(e,e.transformResponse,t),t.headers=ja.from(t.headers),t},function(t){return T2(t)||(o0(e),t&&t.response&&(t.response.data=e0.call(e,e.transformResponse,t.response),t.response.headers=ja.from(t.response.headers))),Ve.reject(t)})}let z2="1.9.0",wv={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{wv[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});let K2={};wv.transitional=function(e,t,s){function a(c,d){return"[Axios v"+z2+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(e===!1)throw new Jt(a(d," has been removed"+(t?" in "+t:"")),Jt.ERR_DEPRECATED);return t&&!K2[d]&&(K2[d]=!0,console.warn(a(d," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,d,h)}},wv.spelling=function(e){return(t,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};var Sv={assertOptions:function(e,t,s){if(typeof e!="object")throw new Jt("options must be an object",Jt.ERR_BAD_OPTION_VALUE);let a=Object.keys(e),c=a.length;for(;c-- >0;){let d=a[c],h=t[d];if(h){let p=e[d],f=p===void 0||h(p,d,e);if(f!==!0)throw new Jt("option "+d+" must be "+f,Jt.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new Jt("Unknown option "+d,Jt.ERR_BAD_OPTION)}},validators:wv};let _o=Sv.validators,Cv=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Jk,response:new Jk}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;let c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=id(this.defaults,t);let{transitional:s,paramsSerializer:a,headers:c}=t;s!==void 0&&Sv.assertOptions(s,{silentJSONParsing:_o.transitional(_o.boolean),forcedJSONParsing:_o.transitional(_o.boolean),clarifyTimeoutError:_o.transitional(_o.boolean)},!1),a!=null&&(Fe.isFunction(a)?t.paramsSerializer={serialize:a}:Sv.assertOptions(a,{encode:_o.function,serialize:_o.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Sv.assertOptions(t,{baseUrl:_o.spelling("baseURL"),withXsrfToken:_o.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let d=c&&Fe.merge(c.common,c[t.method]);c&&Fe.forEach(["delete","get","head","post","put","patch","common"],T=>{delete c[T]}),t.headers=ja.concat(d,c);let h=[],p=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(p=p&&T.synchronous,h.unshift(T.fulfilled,T.rejected))});let f=[],_;this.interceptors.response.forEach(function(T){f.push(T.fulfilled,T.rejected)});let v,b=0;if(!p){let T=[H2.bind(this),void 0];for(T.unshift.apply(T,h),T.push.apply(T,f),v=T.length,_=Ve.resolve(t);b<v;)_=_.then(T[b++],T[b++]);return _}v=h.length;let w=t;for(b=0;b<v;){let T=h[b++],U=h[b++];try{w=T(w)}catch(k){U.call(this,k);break}}try{_=H2.call(this,w)}catch(T){return Ve.reject(T)}for(b=0,v=f.length;b<v;)_=_.then(f[b++],f[b++]);return _}getUri(e){return Xk(I2((e=id(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Fe.forEach(["delete","get","head","options"],function(e){Cv.prototype[e]=function(t,s){return this.request(id(s||{},{method:e,url:t,data:(s||{}).data}))}}),Fe.forEach(["post","put","patch"],function(e){function t(s){return function(a,c,d){return this.request(id(d||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}Cv.prototype[e]=t(),Cv.prototype[e+"Form"]=t(!0)});var Tv=Cv;class c0{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Ve(function(c){s=c});let a=this;this.promise.then(c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null}),this.promise.then=c=>{let d,h=new Ve(p=>{a.subscribe(p),d=p}).then(c);return h.cancel=function(){a.unsubscribe(d)},h},t(function(c,d,h){a.reason||(a.reason=new $u(c,d,h),s(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let s=this._listeners.indexOf(t);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){let t=new AbortController,s=a=>{t.abort(a)};return this.subscribe(s),t.signal.unsubscribe=()=>this.unsubscribe(s),t.signal}static source(){let t;return{token:new c0(function(s){t=s}),cancel:t}}}var Xne=c0;let l0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(l0).forEach(e=>{let[t,s]=e;l0[s]=t});var Jne=l0;let Vr=function e(t){let s=new Tv(t),a=jk(Tv.prototype.request,s);return Fe.extend(a,Tv.prototype,s,{allOwnKeys:!0}),Fe.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return e(id(t,c))},a}(QS);Vr.Axios=Tv,Vr.CanceledError=$u,Vr.CancelToken=Xne,Vr.isCancel=T2,Vr.VERSION=z2,Vr.toFormData=iv,Vr.AxiosError=Jt,Vr.Cancel=Vr.CanceledError,Vr.all=function(e){return Ve.all(e)},Vr.spread=function(e){return function(t){return e.apply(null,t)}},Vr.isAxiosError=function(e){return Fe.isObject(e)&&e.isAxiosError===!0},Vr.mergeConfig=id,Vr.AxiosHeaders=ja,Vr.formToJSON=e=>S2(Fe.isHTMLForm(e)?new FormData(e):e),Vr.getAdapter=G2.getAdapter,Vr.HttpStatusCode=Jne,Vr.default=Vr;var dn=Vr;let Qne=()=>{};function Dm(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Qne};return e.promise=new Ve((t,s)=>{e.resolve=a=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(a),e.value=a)},e.reject=a=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,s(a))}}),e}let Nv=new Map,Rv=new Map,vo=new Map,sr=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Lt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),q2=new Rte,Pa=q2.getResult(),d0=null;function At(e){if(!d0){Pa=q2.getResult();let t=function(p){if(p.engine.name==="Blink"&&p.browser.name!=="WeChat")return Lt.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Lt.CHROME;case"Safari":case"Mobile Safari":return Lt.SAFARI;case"Edge":return Lt.EDGE;case"Firefox":return Lt.FIREFOX;case"QQ":case"QQBrowser":return Lt.QQ;case"Opera":return Lt.OPERA;case"WeChat":return Lt.WECHAT;default:return p.browser.name||""}}(Pa),s=Y2(Pa),a=function(p){return p.os.name==="Windows"?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||""}(Pa),c=Pa.os.version,d=Y2(Pa,!1),h=Pa.device.type;if(!(t&&s&&a&&c))return{name:t,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h};d0={name:t,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h}}return d0}function Y2(e){let t,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",s?t.split(".")[0]:t}function Av(){return At().os}function $2(){let e=At();return"".concat(e.os," ").concat(e.osVersion)}function Iv(){let e=At();return!!(Pa.engine.name==="WebKit"&&e.os===sr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Lt.SAFARI||Br()&&e.name!==Lt.SAFARI)}function ec(){return At().name===Lt.CHROME}function wr(){return At().name===Lt.SAFARI}function X2(){let e=At();if(e.name!==Lt.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function J2(){return At().name===Lt.EDGE}function Cs(){return At().name===Lt.FIREFOX}function Br(){return At().os===sr.IOS}function Xu(e){let t=At();return!(t.name!==Lt.CHROME||!t.osVersion)&&Number(t.version)>=e}function Q2(e){let t=At();return!(t.name!==Lt.CHROME||!t.osVersion)&&Number(t.version)<e}function u0(e,t,s){let a=At();return!(a.name!==e||!a.osVersion)&&(s?Number(a.version)>=t&&Number(a.version)<=s:Number(a.version)===t)}function h0(e){let t=At();return!(t.name!==Lt.EDGE||!t.osVersion)&&Number(t.version)>=e}function p0(e){let t=At();return!(t.name!==Lt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function Z2(e){let t=At();return!(t.name!==Lt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function eL(e,t,s){let a=At();if(a.os!==sr.IOS||!a.osVersion)return!1;let c=a.osVersion.split(".");return s?t&&Number(c[0])===e&&Number(c[1])>t||Number(c[0])>e:t?Number(c[0])===e&&Number(c[1])>=t||Number(c[0])>e:Number(c[0])>=e}function tL(e,t,s){let a=At();if(a.os!==sr.IOS||!a.osVersion)return!1;let c=a.osVersion.split(".");return t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e}function m0(e,t,s){let a=At();if(a.name!==Lt.SAFARI||!a.osVersion||!a.browserVersion)return!1;let c=a.browserVersion.split(".");return s?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function f0(e){let t=At();return!(t.name!==Lt.OPERA||!t.osVersion)&&Number(t.version)>=e}function sL(){let e=At();if(e.os!==sr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Ju(){let e=At();if(e.os!==sr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function g0(){let e=At();if(e.os!==sr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function rL(){let e=At();if(e.os!==sr.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Zi(){return wr()&&navigator.maxTouchPoints>0}function nL(){return At().name===Lt.WECHAT}function iL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function _0(){let e=Av();return function(){let{deviceType:t}=At();return t==="mobile"||t==="tablet"}()||e===sr.ANDROID||e===sr.IOS||e===sr.HARMONY_OS}function tc(){let e=At();return e.name!==Lt.EDGE&&e.name!==Lt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Dv(){return Av()===sr.ANDROID}function Om(){let e=At();return Dv()&&(e.name===Lt.CHROME||e.name===Lt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function ht(e,t,s){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var f=p.call(d,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function aL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Re(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?aL(Object(s),!0).forEach(function(a){ht(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):aL(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let K=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),_e=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(t),ht(this,"code",void 0),ht(this,"message",void 0),ht(this,"data",void 0),ht(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function ka(e,t){if(typeof e!="boolean")throw new _e(K.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Qs(e,t,s){if(!je(s).call(s,e))throw new _e(K.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(s)))}function Qt(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<s||e>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new _e(K.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function v0(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new _e(K.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Qt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Qt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Qt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Qt(e.ideal,"".concat(t,".ideal"),1,1/0)}else Qt(e,t,1,1/0)}function hr(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new _e(K.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!oL(e,s,a,c))throw new _e(K.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function sc(e,t){if(!Array.isArray(e))throw new _e(K.INVALID_PARAMS,"".concat(t," should be an array"))}function Ts(e){return e==null}function oL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=s&&e.length>=t&&(!a||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){let h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(e))}var jm=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(jm||{}),E0=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(E0||{});let cL=new class{constructor(){ht(this,"_clientSize",null),ht(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),ht(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),ht(this,"getStyle",e=>window.getComputedStyle(e,null)),ht(this,"checkCssVisibleProperty",e=>{var t;let s=!0,a=this.getStyle(e),{display:c,visibility:d,opacity:h,filter:p}=a;return(c==="none"||je(t=["hidden","collapse"]).call(t,d)||Number(h)<.1)&&(s=!1),!!s&&(p&&p.split(" ").filter(f=>{var _;let v=f.split("(")[0];return je(_=["brightness","blur","opacity"]).call(_,v)}).map(f=>{let[_,v]=f.split(/\(|\)/);return[_,Number(v.match(/^[0-9\.]+/))]}).forEach(f=>{let[_,v]=f;switch(_){case"brightness":(v<.1||v>3)&&(s=!1);break;case"blur":v>3&&(s=!1);break;case"opacity":v<.1&&(s=!1)}}),s)}),ht(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let s=!0,a=!0,c=h=>t(h),d=e;for(;d&&a;)c(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s}),ht(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),ht(this,"getSizeAboutClient",e=>{let{width:t,height:s,left:a,right:c,top:d,bottom:h}=e.getBoundingClientRect(),p=this.getClientWidth(),f=this.getClientHeight();return{width:t,height:s,left:a,right:c,top:d,bottom:h,clientWidth:p,clientHeight:f,clientMin:Math.min(p,f)}}),ht(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(e,t,s)}),ht(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),ht(this,"checkCoverForAPoint",(e,t,s)=>{let a=this.elementFromPoint(e,t);return a!==null&&a!==s}),ht(this,"getPointPositionList",()=>{let{width:e,height:t,left:s,top:a}=this._clientSize,c=e/6,d=t/6,h=[],p=10**6;for(let f=0;f<5;f++)for(let _=0;_<5;_++){let v=(s*p+(f===0?.1:f===4?(c*f*p-1e5)/p:c*f)*p)/p,b=(a*p+(_===0?.1:_===4?(d*_*p-1e5)/p:d*_)*p)/p;h.push({x:v,y:b})}return[...h]}),ht(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),ht(this,"checkSizeIsVisible",(e,t,s)=>(e>50||s/e<=10)&&(t>50||s/t<=10)),ht(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:s,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize,p,f,_,v;if(e<0)p=0;else{if(!(e<d))return!1;p=e}if(t<0)return!1;if(f=t<d?t:d,s<0)_=0;else{if(!(s<c))return!1;_=s}if(a<0)return!1;v=a<c?a:c;let b=f-p,w=v-_;return this.checkSizeIsVisible(b,w,h)}),ht(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),ht(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(jm.COVERED);{let t=this.checkActualSize(),s=this.checkSizeOfPartInClient();return t&&!s?this.returnHiddenResult(jm.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(jm.SIZE)}}return this.returnHiddenResult(jm.STYLE)}return this.returnHiddenResult(E0.UNMOUNTED)}return this.returnHiddenResult(E0.INVALID_HTML_ELEMENT)}),ht(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function y0(e){return new TextEncoder().encode(e)}let lL=function(e,t){let s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s},x0=async e=>function(t,s){let a="";return new Uint8Array(t).forEach(c=>{a+=c.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",y0(e)),16);class bs{constructor(){ht(this,"_events",{}),ht(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(s=>s.listener):[]}on(t,s){this._events[t]||(this._events[t]=[]);let a=this._events[t];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!1})}once(t,s){this._events[t]||(this._events[t]=[]);let a=this._events[t];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!0})}off(t,s){if(!this._events[t])return;let a=this._events[t],c=this._indexOfListener(a,s);c!==-1&&a.splice(c,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);let s=this._events[t].map(h=>h);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];for(let h=0;h<s.length;h+=1){let p=s[h];p.once&&this.off(t,p.listener),p.listener.apply(this,c||[])}}safeEmit(t){for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];[...this._events[t]||[]].forEach(d=>{d.once&&this.off(t,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(t," error ").concat(h==null?void 0:h.toString()))}})}_indexOfListener(t,s){let a=t.length;for(;a--;)if(t[a].listener===s)return a;return-1}}let Pm=null;function dL(){if(Pm)return Pm;if(window.electron)return Pm=window.electron;if(!window.require)return null;try{return Pm=window.require("electron"),Pm}catch{return null}}let Os=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),vs=function(e){return e.TRACER="tracer",e}({});function uL(e){return Qt(e.timeout,"config.timeout",0,1e5),Qt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Qt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Qt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Zne=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Gt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function km(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function hL(e){return hr(e.turnServerURL,"turnServerURL"),hr(e.username,"username"),hr(e.password,"password"),e.udpport&&Qt(e.udpport,"udpport",1,99999,!0),e.forceturn&&ka(e.forceturn,"forceturn"),e.security&&ka(e.security,"security"),e.tcpport&&Qt(e.tcpport,"tcpport",1,99999,!0),!0}function b0(e){return e.level!==void 0&&Qs(e.level,"level",[1,2,3]),e.delay!==void 0&&Qt(e.delay,"delay",0,3e3,!0),!0}let Tt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Sr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Vn=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Qu=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Cr(e,t){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return e.getListeners(t).length===0?Ve.reject(new _e(K.UNEXPECTED_ERROR,"can not emit promise")):new Ve((d,h)=>{e.emit(t,...a,d,h)})}function es(e,t){if(e.getListeners(t).length===0)return Ve.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Cr(e,t,...a)}function ri(e,t){if(e.getListeners(t).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Lm(e,t,...a)}function Lm(e,t){let s=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(e.emit(t,...d,p=>{s=p},p=>{a=p}),a!==null)throw a;if(s===null)throw new _e(K.UNEXPECTED_ERROR,"handler is not sync");return s}let Fs=new class extends bs{set networkState(e){this.emit(Qu.NETWORK_STATE_CHANGE,e,this._networkState),e===Vn.ONLINE?this.emit(Qu.ONLINE):e===Vn.OFFLINE&&(this.onlineWaiter=new Ve(t=>{this.once(Qu.ONLINE,()=>{this.onlineWaiter=void 0,t(Vn.ONLINE)})}),this.emit(Qu.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Vn.ONLINE}constructor(){super(),ht(this,"_moduleName","network-indicator"),ht(this,"_networkState",Vn.ONLINE),ht(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Vn.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Vn.OFFLINE})}};function Ov(e,t){let s=e.indexOf(t);s!==-1&&e.splice(s,1)}function Zu(e){let t=[];return e.forEach(s=>{t.indexOf(s)===-1&&t.push(s)}),t}function jv(e){Ve!==void 0?Ve.resolve().then(e):setTimeout(e,0)}function Es(e){return JSON.parse(JSON.stringify(e))}function ad(e){try{return Es(e)}catch{return e}}let pL={};function Uc(e,t){pL[t]||(pL[t]=!0,e())}function od(e){let t=window.atob(e),s=new Uint8Array(new ArrayBuffer(t.length));for(let a=0;a<t.length;a+=1)s[a]=t.charCodeAt(a);return s}function Vc(e){let t="";for(let s=0;s<e.length;s+=1)t+=String.fromCharCode(e[s]);return window.btoa(t)}function mL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(e);if(s.length>t)s=s.slice(0,t);else if(s.length<t){let a=new Uint8Array(t);a.set(s),s=a}return s}function fL(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=Ki(t).call(t,(h,p)=>h+p.length,0),c=new Uint8Array(new ArrayBuffer(a)),d=0;return t.forEach(h=>{c.set(h,d),d+=h.length}),c}function Eo(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function gL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(s=>{t+=typeof s=="string"?Eo(s):s.size}),t+138}function eie(e){let t=new _e(K.TIMEOUT,"timeout");return new Ve((s,a)=>{window.setTimeout(()=>a(t),e)})}function pr(e){return new Ve(t=>{window.setTimeout(t,e)})}function ts(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,s=Math.random().toString(16).substr(2,e).toLowerCase();return s.length===e?"".concat(t).concat(s):"".concat(t).concat(s)+ts(e-s.length,"")}function cd(){return ts(32,"").toUpperCase()}let Pv=()=>{},_L=new class{constructor(){ht(this,"fnMap",new Map)}throttleByKey(e,t,s,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(t)){let p=this.fnMap.get(t);if(p.threshold!==s){p.fn(...p.args),clearTimeout(p.timer);let f=window.setTimeout(()=>{let _=this.fnMap.get(t);_&&_.fn(..._.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:f,args:d,skipFn:a})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(t,Re(Re({},p),{},{fn:e,args:d,skipFn:a}))}else{let p=window.setTimeout(()=>{let f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:p,args:d,skipFn:a})}}},vL=_L.throttleByKey.bind(_L);function EL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function w0(e,t){if(!EL(e)||!EL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let s=[...e];for(let a=0;a<t.length;a++)s[a]=w0(e[a],t[a]);return s}{let s=Re({},e);for(let a in t)Object.prototype.hasOwnProperty.call(t,a)&&(Object.prototype.hasOwnProperty.call(e,a)?s[a]=w0(e[a],t[a]):s[a]=t[a]);return s}}function yL(e,t){let s=[0];if(s=new Array(t).fill(0),e===0)return s;let a=0;for(;e>0&&(s[a]=255&e,e>>=8,a++,a!==t););return s}function eh(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function S0(e){return Ki(e).call(e,(t,s)=>t+s,0)}function xL(e){let t="0123456789abcdef";function s(X){let re,te="";for(re=0;re<=3;re++)te+=t.charAt(X>>8*re+4&15)+t.charAt(X>>8*re&15);return te}function a(X,re){let te=(65535&X)+(65535&re);return(X>>16)+(re>>16)+(te>>16)<<16|65535&te}function c(X,re,te,Z,de,xe){return a(function(Se,Ae){return Se<<Ae|Se>>>32-Ae}(a(a(re,X),a(Z,xe)),de),te)}function d(X,re,te,Z,de,xe,Se){return c(re&te|~re&Z,X,re,de,xe,Se)}function h(X,re,te,Z,de,xe,Se){return c(re&Z|te&~Z,X,re,de,xe,Se)}function p(X,re,te,Z,de,xe,Se){return c(re^te^Z,X,re,de,xe,Se)}function f(X,re,te,Z,de,xe,Se){return c(te^(re|~Z),X,re,de,xe,Se)}let _=function(X){let re,te=1+(X.length+8>>6),Z=new Array(16*te);for(re=0;re<16*te;re++)Z[re]=0;for(re=0;re<X.length;re++)Z[re>>2]|=X.charCodeAt(re)<<re%4*8;return Z[re>>2]|=128<<re%4*8,Z[16*te-2]=8*X.length,Z}(e),v,b,w,T,U,k=1732584193,F=-271733879,z=-1732584194,Y=271733878;for(v=0;v<_.length;v+=16)b=k,w=F,T=z,U=Y,k=d(k,F,z,Y,_[v+0],7,-680876936),Y=d(Y,k,F,z,_[v+1],12,-389564586),z=d(z,Y,k,F,_[v+2],17,606105819),F=d(F,z,Y,k,_[v+3],22,-1044525330),k=d(k,F,z,Y,_[v+4],7,-176418897),Y=d(Y,k,F,z,_[v+5],12,1200080426),z=d(z,Y,k,F,_[v+6],17,-1473231341),F=d(F,z,Y,k,_[v+7],22,-45705983),k=d(k,F,z,Y,_[v+8],7,1770035416),Y=d(Y,k,F,z,_[v+9],12,-1958414417),z=d(z,Y,k,F,_[v+10],17,-42063),F=d(F,z,Y,k,_[v+11],22,-1990404162),k=d(k,F,z,Y,_[v+12],7,1804603682),Y=d(Y,k,F,z,_[v+13],12,-40341101),z=d(z,Y,k,F,_[v+14],17,-1502002290),F=d(F,z,Y,k,_[v+15],22,1236535329),k=h(k,F,z,Y,_[v+1],5,-165796510),Y=h(Y,k,F,z,_[v+6],9,-1069501632),z=h(z,Y,k,F,_[v+11],14,643717713),F=h(F,z,Y,k,_[v+0],20,-373897302),k=h(k,F,z,Y,_[v+5],5,-701558691),Y=h(Y,k,F,z,_[v+10],9,38016083),z=h(z,Y,k,F,_[v+15],14,-660478335),F=h(F,z,Y,k,_[v+4],20,-405537848),k=h(k,F,z,Y,_[v+9],5,568446438),Y=h(Y,k,F,z,_[v+14],9,-1019803690),z=h(z,Y,k,F,_[v+3],14,-187363961),F=h(F,z,Y,k,_[v+8],20,1163531501),k=h(k,F,z,Y,_[v+13],5,-1444681467),Y=h(Y,k,F,z,_[v+2],9,-51403784),z=h(z,Y,k,F,_[v+7],14,1735328473),F=h(F,z,Y,k,_[v+12],20,-1926607734),k=p(k,F,z,Y,_[v+5],4,-378558),Y=p(Y,k,F,z,_[v+8],11,-2022574463),z=p(z,Y,k,F,_[v+11],16,1839030562),F=p(F,z,Y,k,_[v+14],23,-35309556),k=p(k,F,z,Y,_[v+1],4,-1530992060),Y=p(Y,k,F,z,_[v+4],11,1272893353),z=p(z,Y,k,F,_[v+7],16,-155497632),F=p(F,z,Y,k,_[v+10],23,-1094730640),k=p(k,F,z,Y,_[v+13],4,681279174),Y=p(Y,k,F,z,_[v+0],11,-358537222),z=p(z,Y,k,F,_[v+3],16,-722521979),F=p(F,z,Y,k,_[v+6],23,76029189),k=p(k,F,z,Y,_[v+9],4,-640364487),Y=p(Y,k,F,z,_[v+12],11,-421815835),z=p(z,Y,k,F,_[v+15],16,530742520),F=p(F,z,Y,k,_[v+2],23,-995338651),k=f(k,F,z,Y,_[v+0],6,-198630844),Y=f(Y,k,F,z,_[v+7],10,1126891415),z=f(z,Y,k,F,_[v+14],15,-1416354905),F=f(F,z,Y,k,_[v+5],21,-57434055),k=f(k,F,z,Y,_[v+12],6,1700485571),Y=f(Y,k,F,z,_[v+3],10,-1894986606),z=f(z,Y,k,F,_[v+10],15,-1051523),F=f(F,z,Y,k,_[v+1],21,-2054922799),k=f(k,F,z,Y,_[v+8],6,1873313359),Y=f(Y,k,F,z,_[v+15],10,-30611744),z=f(z,Y,k,F,_[v+6],15,-1560198380),F=f(F,z,Y,k,_[v+13],21,1309151649),k=f(k,F,z,Y,_[v+4],6,-145523070),Y=f(Y,k,F,z,_[v+11],10,-1120210379),z=f(z,Y,k,F,_[v+2],15,718787259),F=f(F,z,Y,k,_[v+9],21,-343485551),k=a(k,b),F=a(F,w),z=a(z,T),Y=a(Y,U);return s(k)+s(F)+s(z)+s(Y)}let tie=1,bL=console,Dr=class{static setLogger(e){bL=e}constructor(e,t){ht(this,"id",void 0),ht(this,"lockingPromise",Ve.resolve()),ht(this,"locks",0),ht(this,"name",""),ht(this,"lockId",void 0),this.lockId=tie++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");bL.debug("".concat(s," ").concat(a))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let s=new Ve(c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),a=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>s),a}};function th(e,t){return function(s,a,c){let d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){let h=this[t];if(!h)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let p=await h.lock("From ".concat(e,".").concat(a));try{for(var f=arguments.length,_=new Array(f),v=0;v<f;v++)_[v]=arguments[v];return await d.apply(this,_)}finally{p()}},c}}let Hs={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function C0(e,t){let s=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,s)}function La(e,t,s,a){let c=Object.assign({},Hs,a),d=c.timeout,h=async()=>{await function(_){return new Ve(v=>{window.setTimeout(v,_)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)},p=!1,f=new Ve(async(_,v)=>{t=t||(()=>!1),s=s||(()=>!0);for(let b=0;b<c.maxRetryCount;b+=1){if(p)return v(new _e(K.OPERATION_ABORTED));try{let w=await e();if(!t(w,b)||b+1===c.maxRetryCount)return _(w);await h()}catch(w){if(!s(w,b)||b+1===c.maxRetryCount)return v(w);await h()}}});return f.cancel=()=>p=!0,f}let kv,wL=class{constructor(e){ht(this,"input",[]),ht(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ki(e=this.input).call(e,(t,s)=>t+s)/this.input.length}},Lv=0,T0=0;function N0(e,t,s,a){return new Ve((c,d)=>{t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),Lv+=Eo(t.data)):s&&(t.data.size?Lv+=t.data.size:t.data instanceof FormData?Lv+=gL(t.data):Lv+=Eo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,dn.request(t).then(h=>{typeof h.data=="string"?T0+=Eo(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?T0+=h.data.byteLength:T0+=Eo(JSON.stringify(h.data)),c(h.data)}).catch(h=>{dn.isCancel(h)?d(new _e(K.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new _e(K.NETWORK_TIMEOUT,h.message)):h.response?d(new _e(K.NETWORK_RESPONSE_ERROR,h.response.status)):d(new _e(K.NETWORK_ERROR,h.message))})})}async function sie(e,t){let s=new Blob([t.data],{type:"buffer"});return await N0(e,Re(Re({},t),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}let SL=()=>window.isSecureContext!==void 0;function ea(e){if(Array.isArray(e))return e.map(s=>s);if(!CL(e))return e;let t={};for(let s in e){let a=e[s];CL(a)||Array.isArray(a)?t[s]=ea(a):t[s]=a}return t}function CL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let R0=class{constructor(e){ht(this,"input",[]),ht(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},yo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Mm={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:yo,remoteCandidate:yo},updateInterval:0},TL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},NL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},RL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},AL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},A0=class{constructor(e,t){ht(this,"onFirstVideoReceived",void 0),ht(this,"onFirstVideoDecoded",void 0),ht(this,"onFirstAudioReceived",void 0),ht(this,"onFirstVideoDecodedTimeout",void 0),ht(this,"onFirstAudioDecoded",void 0),ht(this,"onSelectedLocalCandidateChanged",void 0),ht(this,"onSelectedRemoteCandidateChanged",void 0),ht(this,"videoIsReady",!1),ht(this,"videoIsReady2",{}),ht(this,"pc",void 0),ht(this,"options",void 0),ht(this,"intervalTimer",void 0),ht(this,"stats",ea(Mm)),ht(this,"isFirstVideoReceived",{}),ht(this,"isFirstVideoDecoded",{}),ht(this,"isFirstAudioReceived",{}),ht(this,"isFirstAudioDecoded",{}),ht(this,"isFirstVideoDecodedTimeout",{}),ht(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ve(e=>{e({local:Re({},yo),remote:Re({},yo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"],a=0,c=0,d=0,h=0;for(let p of s)e[p].forEach((f,_)=>{if(!this.lossRateWindowStats[t-1][p][_]||!this.lossRateWindowStats[0][p][_])return;let v=this.lossRateWindowStats[t-1][p][_].packets-this.lossRateWindowStats[0][p][_].packets,b=this.lossRateWindowStats[t-1][p][_].packetsLost-this.lossRateWindowStats[0][p][_].packetsLost;p==="videoSend"||p==="audioSend"?(a+=v,d+=b):(c+=v,h+=b),Number.isNaN(v)||Number.isNaN(v)?f.packetLostRate=0:f.packetLostRate=v<=0||b<=0?0:b/(v+b)});e.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},rie=class extends A0{constructor(){super(...arguments),ht(this,"_stats",Mm),ht(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=ea(Mm);let s=t.filter(c=>c.type==="ssrc");this.processSSRCStats(s);let a=t.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var s;let a=je(s=t.id).call(s,"send");switch("".concat(t.mediaType,"_").concat(a?"send":"recv")){case"video_send":{let c=ea(NL);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{let c=ea(TL),d=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){let h=d.stats,p=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=p,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Re({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{let c=ea(AL);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{let c=ea(RL);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new Ve((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(s=>{let a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{a[c]=s.stat(c)}),t.push(a)}),t}},Fm=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Mv=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),I0=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),ni=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var sh=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(sh||{});function Um(e,t,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:sh.kNone;if(!t)return;let d=Number(t[s]);if(typeof d!="number")return;let h=Number(t[a]);if(typeof h!="number")return;if(!e)return h?d/h*c:void 0;let p=Number(e[s]);if(typeof p!="number")return;let f=Number(e[a]);if(typeof f!="number")return;let _=h-f;return _?(d-p)/_*c:void 0}let IL=class extends A0{constructor(){super(...arguments),ht(this,"_stats",Mm),ht(this,"report",void 0),ht(this,"lastDecodeVideoReceiverStats",new Map),ht(this,"lastVideoFramesRecv",new Map),ht(this,"lastVideoFramesSent",new Map),ht(this,"lastVideoFramesDecode",new Map),ht(this,"lastVideoFramesOutput",new Map),ht(this,"lastVideoJBDelay",new Map),ht(this,"lastAudioJBDelay",new Map),ht(this,"mediaBytesSent",new Map),ht(this,"mediaBytesRetransmit",new Map),ht(this,"mediaBytesTargetEncode",new Map),ht(this,"lastDecodeAudioReceiverStats",new Map),ht(this,"lastAudioConcealment",new Map),ht(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ea(Mm),this.report.forEach(e=>{switch(e.type){case ni.OUTBOUND:case ni.INBOUND:{let t=e.mediaType||e.kind,s=!t&&"frameWidth"in e,a=!t&&!("frameWidth"in e);e.type===ni.OUTBOUND?t==="audio"||a?this.processAudioOutboundStats(e):(t==="video"||s)&&this.processVideoOutboundStats(e):e.type===ni.INBOUND&&(t==="audio"||a?this.processAudioInboundStats(e):(t==="video"||s)&&this.processVideoInboundStats(e));break}case ni.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case ni.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:Re({},yo),remote:Re({},yo)};return e.forEach(s=>{let a;if(s.type===ni.TRANSPORT&&(a=e.get(s.selectedCandidatePairId)),s.type===ni.CANDIDATE_PAIR&&s.selected&&(a=s),a){let c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){let d=e.get(a.localCandidateId);d&&c(t.local,d)}if(a.remoteCandidateId){let d=e.get(a.remoteCandidateId);d&&c(t.remote,d)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===ni.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ni.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ni.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Re({},t),Re({},this.stats.selectedCandidatePair.localCandidate)),e.type===ni.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Re({},t),Re({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(a=>a.ssrc===e.ssrc);t||(t=ea(AL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let s=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Um(s,t,"totalProcessingDelay","jitterBufferEmittedCount",sh.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,s,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Re({},t))}calculateAudioFreeze(e,t,s){let a=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&a!=null){let c=a.lts,d=s.timestamp,h=d-c;if(h<=0)return;let p=e.concealedSamples-t.concealedSamples-0,f=a.nonSilent+p,_=e.totalSamplesReceived-t.totalSamplesReceived;if(_<=0)return;let v=80*_/h,b=200*_/h,w=h/_,T=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,f>v&&(a.plc80>0?(e.freezeSamples80+=p,e.freezeMs80+=Math.round(p*w)):(e.freezeSamples80+=f,e.freezeMs80+=Math.round(f*w)),T=a.plc80+1);let U=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,f>b&&(a.plc200>0?(e.freezeSamples200+=p,e.freezeMs200+=Math.round(p*w)):(e.freezeSamples200+=f,e.freezeMs200+=Math.round(f*w)),U=a.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:p,lts:d,plc80:T,plc200:U})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);t||(t=ea(TL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let s=this.lastDecodeVideoReceiverStats.get(t.ssrc),a=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),d=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let h=t.decodedFrame?t.decodedFrame.width:0,p=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,h,p),this.isFirstVideoDecoded[t.ssrc]=!0}if(s){let h=s.stats,p=d-s.lts;t.framesDecodeFreezeTime=h.framesDecodeFreezeTime,t.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(s.lts=Date.now(),t.framesDecodeInterval=p,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<h.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(s.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-s.qpSum)/(e.framesDecoded-s.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Um(s==null?void 0:s.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Um(s==null?void 0:s.stats,t,"totalProcessingDelay","framesDecodeCount",sh.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Um(s==null?void 0:s.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",sh.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Um(s==null?void 0:s.stats,t,"totalInterFrameDelay","framesDecodeCount",sh.kMillisecondsFromSeconds),a&&d-a.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:t.decodeFrameRate})):a?t.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&d-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Re({},t),lts:s?s.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(a=>a.ssrc===e.ssrc);t||(t=ea(NL),this._stats.videoSend.push(t));let s=this.mediaBytesSent.get(e.ssrc);if(s)s.add(e.bytesSent);else{let a=new R0(10);a.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,a)}if(e.retransmittedBytesSent!==void 0){let a=this.mediaBytesRetransmit.get(e.ssrc);if(a)a.add(e.retransmittedBytesSent);else{let c=new R0(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){let a=this.mediaBytesTargetEncode.get(e.ssrc);if(a)a.add(e.totalEncodedBytesTarget);else{let c=new R0(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){let a=this.lastEncoderMs.get(e.ssrc);if(!a||a.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let c=e.framesEncoded-a.lastFrameCount,d=e.totalEncodeTime-a.lastEncoderTime;t.avgEncodeMs=1e3*d/c}}if(e.framesEncoded&&e.qpSum){let a=this.lastEncoderMs.get(e.ssrc);!a||a.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-a.lastQpSum)/(e.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let a=this.findRemoteStatsId(e.ssrc,ni.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(s=>s.ssrc===e.ssrc);if(t||(t=ea(RL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let s=this.findRemoteStatsId(e.ssrc,ni.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}findRemoteStatsId(e,t){var s;let a=Array.from(Mn(s=this.report).call(s)).find(c=>c.type===t&&c.ssrc===e);return a?a.id:null}processVideoMediaSource(e,t){let s=this.report.get(e);s&&s.width&&s.height&&s.framesPerSecond&&(t.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(e,t){let s=this.report.get(e);s&&(t.inputLevel=s.audioLevel)}processVideoTrackSenderStats(e,t,s){var a,c,d,h;let p=t?this.report.get(t):void 0,f=(a=p==null?void 0:p.framesSent)!==null&&a!==void 0?a:e.framesSent;if(typeof f!="number")return;let _=(c=p==null?void 0:p.frameWidth)!==null&&c!==void 0?c:e.frameWidth,v=(d=p==null?void 0:p.frameHeight)!==null&&d!==void 0?d:e.frameHeight,b=(h=p==null?void 0:p.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof _=="number"&&typeof v=="number"||(_=0,v=0),b==null){let w=Date.now(),T=this.lastVideoFramesSent.get(s.ssrc);T&&w-T.lts>=800?(b=Math.round((f-T.count)/((w-T.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:f,lts:w,rate:b})):T?b=T.rate:this.lastVideoFramesSent.set(s.ssrc,{count:f,lts:w,rate:0})}s.sentFrame={width:_,height:v,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(e,t,s){var a,c,d,h,p;let f=t?this.report.get(t):void 0,_=(a=f==null?void 0:f.framesReceived)!==null&&a!==void 0?a:e.framesReceived,v=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:e.frameWidth,b=(d=f==null?void 0:f.frameHeight)!==null&&d!==void 0?d:e.frameHeight,w=(h=f==null?void 0:f.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,T=(p=f==null?void 0:f.jitterBufferEmittedCount)!==null&&p!==void 0?p:e.jitterBufferEmittedCount;if(typeof _=="number"){let U=this.lastVideoFramesRecv.get(s.ssrc),k=Date.now();s.framesReceivedCount=_;let F=0;U&&k-U.lts>=800?(F=Math.round((_-U.count)/((k-U.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:_,lts:k,rate:F})):U?F=U.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:_,lts:k,rate:0}),s.receivedFrame={width:v||0,height:b||0,frameRate:F||0},s.decodedFrame={width:v||0,height:b||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:v||0,height:b||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(w&&T){let U=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},k=U.jitterBufferMs,F=T-U.jitterBufferEmittedCount;F>0&&(k=1e3*(w-U.jitterBufferDelay)/F),s.jitterBufferMs=k,s.currentDelayMs=Math.round(k),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:T,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(e,t,s){var a,c,d,h;let p=t?this.report.get(t):void 0,f=(a=(c=p==null?void 0:p.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&a!==void 0?a:0,_=(d=(h=p==null?void 0:p.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=f,s.aecReturnLossEnhancement=_}processAudioTrackReceiverStats(e,t,s){var a,c,d,h,p,f,_,v,b;let w=t?this.report.get(t):void 0,T=(a=w==null?void 0:w.removedSamplesForAcceleration)!==null&&a!==void 0?a:e.removedSamplesForAcceleration,U=(c=w==null?void 0:w.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(d=w==null?void 0:w.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,F=(h=w==null?void 0:w.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,z=(p=w==null?void 0:w.audioLevel)!==null&&p!==void 0?p:e==null?void 0:e.audioLevel,Y=(f=w==null?void 0:w.totalSamplesDuration)!==null&&f!==void 0?f:e==null?void 0:e.totalSamplesDuration,X=(_=w==null?void 0:w.concealedSamples)!==null&&_!==void 0?_:e.concealedSamples,re=(v=w==null?void 0:w.silentConcealedSamples)!==null&&v!==void 0?v:e.silentConcealedSamples,te=(b=w==null?void 0:w.concealmentEvents)!==null&&b!==void 0?b:e.concealmentEvents;if(typeof U=="number"&&(s.totalSamplesReceived=U),typeof re=="number"&&(s.silentConcealedSamples=re),typeof te=="number"&&(s.concealmentEvents=te),typeof X=="number"&&(s.concealedSamples=X),T&&U&&(s.accelerateRate=T/U),k&&F){let de=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},xe=de.jitterBufferMs,Se=F-de.jitterBufferEmittedCount;Se>0&&(xe=1e3*(k-de.jitterBufferDelay)/Se),s.jitterBufferMs=Math.round(xe),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:F,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=z;let Z=1920;Y&&U&&(Z=U/Y/50,s.receivedFrames=Math.round(U/Z)),X&&(s.droppedFrames=Math.round(X/Z))}processRemoteInboundStats(e,t){let s=this.report.get(e);s&&(t.packetsLost=s.packetsLost,s.roundTripTime&&(t.rttMs=1e3*s.roundTripTime),s.jitter&&(t.jitterMs=1e3*s.jitter),s.timestamp&&(t.timestamp=s.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let s=t.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let e=0,t=null,s=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{t=t===null?c.diffMean():t+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});let a=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},nie=class extends A0{updateStats(){return Ve.resolve()}};function D0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,d=function(){let h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new rie(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new IL(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;let p=h.getStats();return!!(p instanceof Ve||function(f){return!!f&&(typeof f=="object"||typeof f=="function")&&typeof f.then=="function"}(p))}(e)?new IL(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new nie(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}let DL="websdk_ng_install_id";function O0(){try{if($("INSTALL_ID"))return $("INSTALL_ID");let e=window.localStorage.getItem(DL);return e||(e=cd(),window.localStorage.setItem(DL,e)),$t("INSTALL_ID",e),e}catch{return}}let Si=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let s=t[1],a=t[2];return"".concat(s,".").concat(a)}return"4.0.0.999"}("4.24.0"),j0=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),ld=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),Tr=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");let a=s.join(""),c=[];for(let p=0;p<6;p++)c.push("1");let d=c.join(""),h={};return h[e]=a,h[t]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Tr;let Fv={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},P0={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},k0="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",L0={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},gs=Re(Re(Re(Re({},L0),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:P0,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Fv),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function $t(e,t,s){var a,c,d;je(a=Object.keys(gs)).call(a,e)&&(!s&&je(c=Object.keys(Ma)).call(c,e)||(gs[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(gs.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(d=!!t,gs.USE_NEW_NETWORK_CONFIG=d,d&&(gs.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],gs.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],gs.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],gs.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],gs.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",gs.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",gs.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(gs.ENABLE_INSTANT_VIDEO=!0,gs.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(gs.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(gs.NEW_TURN_MODE||(gs.NEW_TURN_MODE=4))))}function $(e){return gs[e]}j0||(gs.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],gs.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],gs.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],gs.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],gs.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],gs.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],gs.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",gs.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",gs.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",gs.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",gs.AREAS=["NORTH_AMERICA","OVERSEA"]);let OL=function(e){return e[e.REALTIME=1]="REALTIME",e}({}),Ma={};var mt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(mt||{});let Vm=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let jL=128,iie=96,PL=1e3,rh=10,aie=0;var kL=(()=>{var e={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>Se,Printer:()=>Wt,parse:()=>Pe,print:()=>Ke});let h=`
`,p="".concat("\r").concat(h),f=" ",_;function v(Te){return Te>="0"&&Te<="9"}function b(Te){return Te>="!"&&Te<="~"}function w(Te){return b(Te)||Te>=""&&Te<=""}function T(Te){return Te==="!"||Te>="#"&&Te<="'"||Te>="*"&&Te<="+"||Te>="-"&&Te<="."||Te>="0"&&Te<="9"||Te>="A"&&Te<="Z"||Te>="^"&&Te<="~"}function U(Te){return Te>="1"&&Te<="9"}function k(Te){return Te>="A"&&Te<="Z"||Te>="a"&&Te<="z"}function F(Te){return Te==="d"||Te==="h"||Te==="m"||Te==="s"}function z(Te){return Te>""&&Te<"	"||Te>"\v"&&Te<"\f"||Te>""&&Te<""}function Y(Te){return k(Te)||v(Te)||Te==="+"||Te==="/"}function X(Te){return v(Te)||k(Te)||Te==="+"||Te==="/"||Te==="-"||Te==="_"}function re(Te){return k(Te)||v(Te)||Te==="+"||Te==="/"}function te(Te,j){var Q=Object.keys(Te);if(Object.getOwnPropertySymbols){var se=Object.getOwnPropertySymbols(Te);j&&(se=se.filter(function(De){return Object.getOwnPropertyDescriptor(Te,De).enumerable})),Q.push.apply(Q,se)}return Q}function Z(Te){for(var j=1;j<arguments.length;j++){var Q=arguments[j]!=null?arguments[j]:{};j%2?te(Object(Q),!0).forEach(function(se){de(Te,se,Q[se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Te,Object.getOwnPropertyDescriptors(Q)):te(Object(Q)).forEach(function(se){Object.defineProperty(Te,se,Object.getOwnPropertyDescriptor(Q,se))})}return Te}function de(Te,j,Q){return j in Te?Object.defineProperty(Te,j,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Te[j]=Q,Te}(function(Te){Te.VERSION="v",Te.ORIGIN="o",Te.SESSION_NAME="s",Te.INFORMATION="i",Te.URI="u",Te.EMAIL="e",Te.PHONE="p",Te.CONNECTION="c",Te.BANDWIDTH="b",Te.TIME="t",Te.REPEAT="r",Te.ZONE_ADJUSTMENTS="z",Te.KEY="k",Te.ATTRIBUTE="a",Te.MEDIA="m"})(_||(_={}));class xe{consumeText(j,Q){let se=Q;for(;se<j.length;){let De=j[se];if(De==="\0"||De==="\r"||De===h)break;se+=1}if(se-Q==0)throw new Error("Invalid text, at ".concat(j));return se}consumeUnicastAddress(j,Q,se){return this.consumeTill(j,Q,f)}consumeOneOrMore(j,Q,se){let De=Q;for(;se(j[De]);)De++;if(De-Q==0)throw new Error("Invalid rule at ".concat(Q,"."));return De}consumeSpace(j,Q){if(j[Q]===f)return Q+1;throw new Error("Invalid space at ".concat(Q,"."))}consumeIP4Address(j,Q){let se=Q;for(let De=0;De<4;De++)if(se=this.consumeDecimalUChar(j,se),De!==3){if(j[se]!==".")throw new Error("Invalid IP4 address.");se++}return se}consumeDecimalUChar(j,Q){let se=Q;for(let gt=0;gt<3&&v(j[se]);gt++,se++);if(se-Q==0)throw new Error("Invalid decimal uchar.");let De=parseInt(j.slice(Q,se));if(De>=0&&De<=255)return se;throw new Error("Invalid decimal uchar")}consumeIP6Address(j,Q){let se=this.consumeHexpart(j,Q);return j[se]===":"&&(se+=1,se=this.consumeIP4Address(j,se)),se}consumeHexpart(j,Q){let se=Q;if(j[se]===":"&&j[se+1]===":"){se+=2;try{se=this.consumeHexseq(j,se)}catch{}return se}if(se=this.consumeHexseq(j,se),j[se]===":"&&j[se+1]===":"){se+=2;try{se=this.consumeHexseq(j,se)}catch{}return se}return se}consumeHexseq(j,Q){let se=Q;for(;se=this.consumeHex4(j,se),j[se]===":"&&j[se+1]!==":";)se+=1;return se}consumeHex4(j,Q){let se=0;for(;se<4;se++)if(!((De=j[Q+se])>="0"&&De<="9"||De>="a"&&De<="f"||De>="A"&&De<="F")){if(se===0)throw new Error("Invalid hex 4");break}var De;return Q+se}consumeFQDN(j,Q){let se=Q;for(;v(j[se])||k(j[se])||j[se]==="-"||j[se]===".";)se+=1;if(se-Q<4)throw new Error("Invalid FQDN");return se}consumeExtnAddr(j,Q){return this.consumeOneOrMore(j,Q,w)}consumeMulticastAddress(j,Q,se){switch(se){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(j,Q);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(j,Q);default:try{return this.consumeFQDN(j,Q)}catch{return this.consumeExtnAddr(j,Q)}}}consumeIP6MulticastAddress(j,Q){let se=this.consumeHexpart(j,Q);return j[se]==="/"?this.consumeInteger(j,se+1):se}consumeIP4MulticastAddress(j,Q){let se=Q+3,De=j.slice(Q,se),gt=parseInt(De);if(gt<224||gt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let cs=0;cs<3;cs++){if(j[se]!==".")throw new Error("Invalid IP4 multicast address.");se+=1,se=this.consumeDecimalUChar(j,se)}return j[se]==="/"&&(se+=1),se=this.consumeTTL(j,se),j[se]==="/"&&(se=this.consumeInteger(j,se)),se}consumeInteger(j,Q){if(!U(j[Q]))throw new Error("Invalid integer.");for(Q+=1;v(j[Q]);)Q+=1;return Q}consumeTTL(j,Q){if(j[Q]==="0")return Q+1;if(!U(j[Q]))throw new Error("Invalid TTL.");Q+=1;for(let se=0;se<2&&v(j[Q]);se++)Q+=1;return Q}consumeToken(j,Q){return this.consumeOneOrMore(j,Q,T)}consumeTime(j,Q){let se=Q;if(j[se]==="0")return se+1;for(U(j[se])&&(se+=1);v(j[se]);)se++;if(se-Q<10)throw new Error("Invalid time");return se}consumeAddress(j,Q){return this.consumeTill(j,Q,f)}consumeTypedTime(j,Q){let se=Q;return se=this.consumeOneOrMore(j,se,v),F(j[se])?se+1:se}consumeRepeatInterval(j,Q){if(!U(j[Q]))throw new Error("Invalid repeat interval");for(Q+=1;v(j[Q]);)Q+=1;return F(j[Q])&&(Q+=1),Q}consumePort(j,Q){return this.consumeOneOrMore(j,Q,v)}consume(j,Q,se){for(let De=0;De<se.length;De++){if(Q+De>=j.length)throw new Error("consume exceeding value length");if(j[Q+De]!==se[De])throw new Error("consume ".concat(se," failed at ").concat(De))}return Q+se.length}consumeTill(j,Q,se){let De=Q;for(;De<j.length&&(typeof se!="string"||j[De]!==se)&&(typeof se!="function"||!se(j[De]));)De++;return De}}class Se extends xe{constructor(){super(),de(this,"records",[]),de(this,"currentLine",0)}parse(j){let Q=this.probeEOL(j);this.records=j.split(Q).filter(uc=>!!Kr(uc).call(uc)).map(this.parseLine),this.currentLine=0;let se=this.parseVersion(),De=this.parseOrigin(),gt=this.parseSessionName(),cs=this.parseInformation(),Xs=this.parseUri(),ji=this.parseEmail(),ha=this.parsePhone(),Cf=this.parseConnection(),Ad=this.parseBandWidth(),kh=this.parseTimeFields(),QE=this.parseKey(),ZE=this.parseSessionAttribute(),Pi=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:se,origin:De,sessionName:gt,information:cs,uri:Xs,emails:ji,phones:ha,connection:Cf,bandwidths:Ad,timeFields:kh,key:QE,attributes:ZE,mediaDescriptions:Pi}}getCurrentRecord(){let j=this.records[this.currentLine];if(!j)throw new Error("Record doesn't exit.");return j}probeEOL(j){for(let Q=0;Q<j.length;Q++)if(j[Q]===h)return j[Q-1]==="\r"?p:h;throw new Error("Invalid newline character.")}parseLine(j,Q){if(j.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let se=j[0];if(j[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:se,value:j.slice(2),line:Q,cur:0}}parseSessionAttribute(){let j=new yt;for(;this.currentLine<this.records.length;){let Q=this.getCurrentRecord();if(Q.type!==_.ATTRIBUTE)break;let se={attField:this.extractOneOrMore(Q,De=>T(De)&&De!==":"),_cur:0};Q.value[Q.cur]===":"&&(Q.cur+=1,se.attValue=this.extractOneOrMore(Q,z)),j.parse(se),this.currentLine++}return j.digest()}parseMediaAttributes(j){let Q=new bt(j);for(;this.currentLine<this.records.length;){let se=this.getCurrentRecord();if(se.type!==_.ATTRIBUTE)break;let De={attField:this.extractOneOrMore(se,gt=>T(gt)&&gt!==":"),_cur:0};se.value[se.cur]===":"&&(se.cur+=1,De.attValue=this.extractOneOrMore(se,z)),Q.parse(De),this.currentLine++}return Q.digest()}parseKey(){let j=this.getCurrentRecord();if(j.type===_.KEY){if(j.value==="prompt"||j.value==="clear:"||j.value==="base64:"||j.value==="uri:")return j.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let j=this.getCurrentRecord();if(j.type===_.ZONE_ADJUSTMENTS){let Q=[];for(;;)try{let se=this.extract(j,this.consumeTime);this.consumeSpaceForRecord(j);let De=!1;j.value[j.cur]==="-"&&(De=!0,j.cur+=1);let gt=this.extract(j,this.consumeTypedTime);Q.push({time:se,typedTime:gt,back:De})}catch{break}if(Q.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,Q}return[]}parseRepeat(){let j=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.REPEAT)break;{let se=this.extract(Q,this.consumeRepeatInterval),De=this.parseTypedTime(Q);j.push({repeatInterval:se,typedTimes:De}),this.currentLine++}}return j}parseTypedTime(j){let Q=[];for(;;)try{this.consumeSpaceForRecord(j),Q.push(this.extract(j,this.consumeTypedTime))}catch{break}if(Q.length===0)throw new Error("Invalid typed time.");return Q}parseTime(){let j=this.getCurrentRecord(),Q=this.extract(j,this.consumeTime);this.consumeSpaceForRecord(j);let se=this.extract(j,this.consumeTime);return this.currentLine++,{startTime:Q,stopTime:se}}parseBandWidth(){let j=[];for(;this.currentLine<this.records.length;){let Q=this.getCurrentRecord();if(Q.type!==_.BANDWIDTH)break;{let se=this.extractOneOrMore(Q,T);if(Q.value[Q.cur]!==":")throw new Error("Invalid bandwidth field.");Q.cur++;let De=this.extractOneOrMore(Q,v);j.push({bwtype:se,bandwidth:De}),this.currentLine++}}return j}parseVersion(){let j=this.getCurrentRecord();if(j.type!==_.VERSION)throw new Error("first sdp record must be version");let Q=j.value.slice(0,this.consumeOneOrMore(j.value,0,v));if(Q.length!==j.value.length)throw new Error('invalid proto version, "v='.concat(j.value,'"'));return this.currentLine++,Q}parseOrigin(){let j=this.getCurrentRecord();if(j.type!==_.ORIGIN)throw new Error("second line of sdp must be origin");let Q=this.extractOneOrMore(j,w);this.consumeSpaceForRecord(j);let se=this.extractOneOrMore(j,v);this.consumeSpaceForRecord(j);let De=this.extractOneOrMore(j,v);this.consumeSpaceForRecord(j);let gt=this.extractOneOrMore(j,T);this.consumeSpaceForRecord(j);let cs=this.extractOneOrMore(j,T);this.consumeSpaceForRecord(j);let Xs=this.extract(j,this.consumeUnicastAddress);return this.currentLine++,{username:Q,sessId:se,sessVersion:De,nettype:gt,addrtype:cs,unicastAddress:Xs}}parseSessionName(){let j=this.getCurrentRecord();if(j.type===_.SESSION_NAME){let Q=this.extract(j,this.consumeText);return this.currentLine++,Q}}parseInformation(){let j=this.getCurrentRecord();if(j.type!==_.INFORMATION)return;let Q=this.extract(j,this.consumeText);return this.currentLine++,Q}parseUri(){let j=this.getCurrentRecord();if(j.type===_.URI)return this.currentLine++,j.value}parseEmail(){let j=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.EMAIL)break;j.push(Q.value),this.currentLine++}return j}parsePhone(){let j=[];for(;;){let Q=this.getCurrentRecord();if(Q.type!==_.PHONE)break;j.push(Q.value),this.currentLine++}return j}parseConnection(){let j=this.getCurrentRecord();if(j.type===_.CONNECTION){let Q=this.extractOneOrMore(j,T);this.consumeSpaceForRecord(j);let se=this.extractOneOrMore(j,T);this.consumeSpaceForRecord(j);let De=this.extract(j,this.consumeAddress);return this.currentLine++,{nettype:Q,addrtype:se,address:De}}}parseMedia(){let j=this.getCurrentRecord(),Q=this.extract(j,this.consumeToken);this.consumeSpaceForRecord(j);let se=this.extract(j,this.consumePort);j.value[j.cur]==="/"&&(j.cur+=1,se+=this.extract(j,this.consumeInteger)),this.consumeSpaceForRecord(j);let De=[];for(De.push(this.extract(j,this.consumeToken));j.value[j.cur]==="/";)j.cur+=1,De.push(this.extract(j,this.consumeToken));if(De.length===0)throw new Error("Invalid proto");let gt=this.parseFmt(j);return this.currentLine++,{mediaType:Q,port:se,protos:De,fmts:gt}}parseTimeFields(){let j=[];for(;this.getCurrentRecord().type===_.TIME;){let Q=this.parseTime(),se=this.parseRepeat(),De=this.parseZone();j.push({time:Q,repeats:se,zones:De})}return j}parseMediaDescription(){let j=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.MEDIA;){let Q=this.parseMedia(),se=this.parseInformation(),De=this.parseConnections(),gt=this.parseBandWidth(),cs=this.parseKey(),Xs=this.parseMediaAttributes(Q);j.push({media:Q,information:se,connections:De,bandwidths:gt,key:cs,attributes:Xs})}return j}parseConnections(){let j=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.CONNECTION;)j.push(this.parseConnection());return j}parseFmt(j){let Q=[];for(;;)try{this.consumeSpaceForRecord(j),Q.push(this.extract(j,this.consumeToken))}catch{break}if(Q.length===0)throw new Error("Invalid fmts");return Q}extract(j,Q){for(var se=arguments.length,De=new Array(se>2?se-2:0),gt=2;gt<se;gt++)De[gt-2]=arguments[gt];let cs=Q.call(this,j.value,j.cur,...De),Xs=j.value.slice(j.cur,cs);return j.cur=cs,Xs}extractOneOrMore(j,Q){let se=this.consumeOneOrMore(j.value,j.cur,Q),De=j.value.slice(j.cur,se);return j.cur=se,De}consumeSpaceForRecord(j){if(j.value[j.cur]!==f)throw new Error("Invalid space at ".concat(j.cur,"."));j.cur+=1}}class Ae extends xe{constructor(){super(...arguments),de(this,"attributes",void 0),de(this,"digested",!1)}extractOneOrMore(j,Q,se){let De=this.consumeOneOrMore(j.attValue,j._cur,Q),gt=j.attValue.slice(j._cur,De),[cs,Xs]=se||[];if(typeof cs=="number"&&gt.length<cs)throw new Error("error in length, should be more or equal than ".concat(cs," characters."));if(typeof Xs=="number"&&gt.length>Xs)throw new Error("error in length, should be less or equal than ".concat(Xs," characters."));return j._cur=De,gt}consumeAttributeSpace(j){if(j.attValue[j._cur]!==f)throw new Error("Invalid space at ".concat(j._cur,"."));j._cur+=1}extract(j,Q){if(!j.attValue)throw new Error("Nothing to extract from attValue.");for(var se=arguments.length,De=new Array(se>2?se-2:0),gt=2;gt<se;gt++)De[gt-2]=arguments[gt];let cs=Q.call(this,j.attValue,j._cur,...De),Xs=j.attValue.slice(j._cur,cs);return j._cur=cs,Xs}atEnd(j){if(!j.attValue)throw new Error;return j._cur>=j.attValue.length}peekChar(j){if(!j.attValue)throw new Error;return j.attValue[j._cur]}peek(j,Q){if(!j.attValue)throw new Error;for(let se=0;se<Q.length;se++)if(Q[se]!==j.attValue[j._cur+se])return!1;return!0}parseIceUfrag(j){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(j,Y,[4,256])}parseIcePwd(j){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(j,Y,[22,256])}parseIceOptions(j){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let Q=[];for(;!this.atEnd(j);){Q.push(this.extractOneOrMore(j,Y));try{this.consumeAttributeSpace(j)}catch(se){if(this.atEnd(j))break;throw se}}this.attributes.iceOptions=Q}parseFingerprint(j){let Q=this.extract(j,this.consumeToken);this.consumeAttributeSpace(j);let se=this.extract(j,this.consumeTill);this.attributes.fingerprints.push({hashFunction:Q,fingerprint:se})}parseExtmap(j){let Q=this.extractOneOrMore(j,v),se;this.peekChar(j)==="/"&&(this.extract(j,this.consume,"/"),se=this.extract(j,this.consumeToken)),this.consumeAttributeSpace(j);let De=this.extract(j,this.consumeTill,f),gt=Z(Z({entry:parseInt(Q,10)},se&&{direction:se}),{},{extensionName:De});this.peekChar(j)===f&&(this.consumeAttributeSpace(j),gt.extensionAttributes=this.extract(j,this.consumeTill)),this.attributes.extmaps.push(gt)}parseSetup(j){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let Q=this.extract(j,this.consumeTill);if(Q!=="active"&&Q!=="passive"&&Q!=="actpass"&&Q!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=Q}}class yt extends Ae{constructor(){super(...arguments),de(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(j){if(this.digested)throw new Error("already digested");try{switch(j.attField){case"group":this.parseGroup(j);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(j);break;case"ice-pwd":this.parseIcePwd(j);break;case"ice-options":this.parseIceOptions(j);break;case"fingerprint":this.parseFingerprint(j);break;case"setup":this.parseSetup(j);break;case"tls-id":this.parseTlsId(j);break;case"identity":this.parseIdentity(j);break;case"extmap":this.parseExtmap(j);break;case"msid-semantic":this.parseMsidSemantic(j);break;default:j.ignored=!0,this.attributes.unrecognized.push(j)}}catch(Q){throw console.error("parsing session attribute ".concat(j.attField,' error, "a=').concat(j.attField,":").concat(j.attValue,'"')),Q}if(!j.ignored&&j.attValue&&!this.atEnd(j))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(j){let Q=this.extract(j,this.consumeToken),se=[];for(;!this.atEnd(j)&&this.peekChar(j)===f;)this.consumeAttributeSpace(j),se.push(this.extract(j,this.consumeToken));this.attributes.groups.push({semantic:Q,identificationTag:se})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(j){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(j,X)}parseIdentity(j){let Q=this.extractOneOrMore(j,re),se=[];for(;!this.atEnd(j)&&this.peekChar(j)===f;){this.consumeAttributeSpace(j);let De=this.extract(j,this.consumeToken);this.extract(j,this.consume,"=");let gt=this.extractOneOrMore(j,cs=>cs!==f&&z(cs));se.push({name:De,value:gt})}this.attributes.identities.push({assertionValue:Q,extensions:se})}parseMsidSemantic(j){this.peekChar(j)===f&&this.consumeAttributeSpace(j);let Q={semantic:this.extract(j,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(j)}catch{break}if(this.peekChar(j)==="*"){this.extract(j,this.consume,"*"),Q.applyForAll=!0;break}{let se=this.extract(j,this.consumeTill,f);Q.identifierList.push(se)}}this.attributes.msidSemantic=Q}}class bt extends Ae{constructor(j){super(),de(this,"attributes",void 0),j.protos.indexOf("RTP")!==-1||j.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(j){if(this.digested)throw new Error("already digested");try{switch(j.attField){case"extmap":this.parseExtmap(j);break;case"setup":this.parseSetup(j);break;case"ice-ufrag":this.parseIceUfrag(j);break;case"ice-pwd":this.parseIcePwd(j);break;case"ice-options":this.parseIceOptions(j);break;case"candidate":this.parseCandidate(j);break;case"remote-candidate":this.parseRemoteCandidate(j);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(j);break;case"rtpmap":this.parseRtpmap(j);break;case"ptime":this.parsePtime(j);break;case"maxptime":this.parseMaxPtime(j);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(j);break;case"ssrc":this.parseSSRC(j);break;case"fmtp":this.parseFmtp(j);break;case"rtcp-fb":this.parseRtcpFb(j);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(j);break;case"mid":this.parseMid(j);break;case"msid":this.parseMsid(j);break;case"imageattr":this.parseImageAttr(j);break;case"rid":this.parseRid(j);break;case"simulcast":this.parseSimulcast(j);break;case"sctp-port":this.parseSctpPort(j);break;case"max-message-size":this.parseMaxMessageSize(j);break;case"ssrc-group":this.parseSSRCGroup(j);break;default:j.ignored=!0,this.attributes.unrecognized.push(j)}}catch(Q){throw console.error("parsing media attribute ".concat(j.attField,' error, "a=').concat(j.attField,":").concat(j.attValue,'"')),Q}if(!j.ignored&&j.attValue&&!this.atEnd(j))throw new Error("attribute parsing error")}parseCandidate(j){let Q=this.extractOneOrMore(j,Y,[1,32]);this.consumeAttributeSpace(j);let se=this.extractOneOrMore(j,v,[1,5]);this.consumeAttributeSpace(j);let De=this.extract(j,this.consumeToken);this.consumeAttributeSpace(j);let gt=this.extractOneOrMore(j,v,[1,10]);this.consumeAttributeSpace(j);let cs=this.extract(j,this.consumeAddress);this.consumeAttributeSpace(j);let Xs=this.extract(j,this.consumePort);this.consumeAttributeSpace(j),this.extract(j,this.consume,"typ"),this.consumeAttributeSpace(j);let ji={foundation:Q,componentId:se,transport:De,priority:gt,connectionAddress:cs,port:Xs,type:this.extract(j,this.consumeToken),extension:{}};for(this.peek(j," raddr")&&(this.extract(j,this.consume," raddr"),this.consumeAttributeSpace(j),ji.relAddr=this.extract(j,this.consumeAddress)),this.peek(j," rport")&&(this.extract(j,this.consume," rport"),this.consumeAttributeSpace(j),ji.relPort=this.extract(j,this.consumePort));this.peekChar(j)===f;){this.consumeAttributeSpace(j);let ha=this.extract(j,this.consumeToken);this.consumeAttributeSpace(j),ji.extension[ha]=this.extractOneOrMore(j,b)}this.attributes.candidates.push(ji)}parseRemoteCandidate(j){let Q=[];for(;;){let se=this.extractOneOrMore(j,v,[1,5]);this.consumeAttributeSpace(j);let De=this.extract(j,this.consumeAddress);this.consumeAttributeSpace(j);let gt=this.extract(j,this.consumePort);Q.push({componentId:se,connectionAddress:De,port:gt});try{this.consumeAttributeSpace(j)}catch{break}}this.attributes.remoteCandidatesList.push(Q)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(j){let Q=this.extract(j,this.consumeToken);this.consumeAttributeSpace(j);let se=this.extract(j,this.consumeTill,"/");this.extract(j,this.consume,"/");let De={encodingName:se,clockRate:this.extractOneOrMore(j,v)};this.atEnd(j)||this.peekChar(j)!=="/"||(this.extract(j,this.consume,"/"),De.encodingParameters=parseInt(this.extract(j,this.consumeTill),10));let gt=this.attributes.payloads.find(cs=>cs.payloadType===parseInt(Q,10));gt?gt.rtpMap=De:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtpMap:De,rtcpFeedbacks:[]})}parsePtime(j){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(j,this.consumeTill)}parseMaxPtime(j){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(j,this.consumeTill)}parseDirection(j){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=j.attField}parseSSRC(j){let Q=this.extractOneOrMore(j,v);this.consumeAttributeSpace(j);let se=this.extract(j,this.consumeTill,":"),De;this.peekChar(j)===":"&&(this.extract(j,this.consume,":"),De=this.extract(j,this.consumeTill));let gt=this.attributes.ssrcs.find(cs=>cs.ssrcId===parseInt(Q,10));gt?gt.attributes[se]=De:this.attributes.ssrcs.push({ssrcId:parseInt(Q,10),attributes:{[se]:De}})}parseFmtp(j){let Q=this.extract(j,this.consumeTill,f);this.consumeAttributeSpace(j);let se=this.extract(j,this.consumeTill),De={};se.split(";").forEach(cs=>{let[Xs,ji]=cs.split("=");Xs=Kr(Xs).call(Xs);let ha=typeof ji=="string"?Kr(ji).call(ji):null;typeof Xs=="string"&&Xs.length>0&&(De[Xs]=ha)});let gt=this.attributes.payloads.find(cs=>cs.payloadType===parseInt(Q,10));gt?gt.fmtp={parameters:De}:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[],fmtp:{parameters:De}})}parseFmtParameters(j){let Q={},se=this.extract(j,this.consumeTill,"=");j._cur++;let De=this.extract(j,this.consumeTill,";");for(Q[se]=De;j.attValue[j._cur]===";";){let gt=this.extract(j,this.consumeTill,"=");j._cur++;let cs=this.extract(j,this.consumeTill,";");Q[gt]=cs}return Q}parseRtcpFb(j){let Q="";Q=this.peekChar(j)==="*"?this.extract(j,this.consume,"*"):this.extract(j,this.consumeTill,f),this.consumeAttributeSpace(j);let se=this.extract(j,this.consumeTill,f),De;if(se==="trr-int")De={type:se,interval:this.extract(j,this.consumeTill)};else{let gt={type:se};this.peekChar(j)===f&&(this.consumeAttributeSpace(j),gt.parameter=this.extract(j,this.consumeToken),this.peekChar(j)===f&&(gt.additional=this.extract(j,this.consumeTill))),De=gt}if(Q==="*")this.attributes.rtcpFeedbackWildcards.push(De);else{let gt=this.attributes.payloads.find(cs=>cs.payloadType===parseInt(Q,10));gt?gt.rtcpFeedbacks.push(De):this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[De]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(j){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let Q={port:this.extract(j,this.consumePort)};this.peekChar(j)===f&&(this.consumeAttributeSpace(j),Q.netType=this.extractOneOrMore(j,T),this.consumeAttributeSpace(j),Q.addressType=this.extractOneOrMore(j,T),this.consumeAttributeSpace(j),Q.address=this.extract(j,this.consumeAddress)),this.attributes.rtcp=Q}parseMsid(j){let Q={id:this.extractOneOrMore(j,T,[1,64])};this.peekChar(j)===f&&(this.consumeAttributeSpace(j),Q.appdata=this.extractOneOrMore(j,T,[1,64])),this.attributes.msids.push(Q)}parseImageAttr(j){this.attributes.imageattr.push(j.attValue)}parseRid(j){let Q=this.extractOneOrMore(j,De=>k(De)||v(De)||De==="_"||De==="-");this.consumeAttributeSpace(j);let se={id:Q,direction:this.extract(j,this.consumeToken),params:[]};if(this.peekChar(j)===f){if(this.consumeAttributeSpace(j),this.peek(j,"pt=")){this.extract(j,this.consume,"pt=");let De=[];for(;;){let gt=this.extract(j,this.consumeToken);De.push(gt);try{this.extract(j,this.consume,",")}catch{break}}se.payloads=De,this.peekChar(j)===f&&this.extract(j,this.consume,f)}for(;;){let De=this.extract(j,this.consumeToken);switch(De){case"depend":{let gt={type:De,rids:this.extract(j,this.consume,"=").split(",")};se.params.push(gt);break}default:{let gt={type:De};this.peekChar(j)==="="&&(this.extract(j,this.consume,"="),gt.val=this.extract(j,this.consumeTill,";")),se.params.push(gt)}}try{this.extract(j,this.consume,";")}catch{break}}}this.attributes.rids.push(se)}parseSimulcast(j){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=j.attValue,this.extract(j,this.consumeTill)}parseSctpPort(j){this.attributes.sctpPort=this.extractOneOrMore(j,v,[1,5])}parseMaxMessageSize(j){this.attributes.maxMessageSize=this.extractOneOrMore(j,v,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(j){this.attributes.mid=this.extract(j,this.consumeToken)}parseSSRCGroup(j){let Q=this.extract(j,this.consumeToken),se=[];for(;;)try{this.consumeAttributeSpace(j);let De=this.extract(j,this.consumeInteger);se.push(parseInt(De,10))}catch{break}this.attributes.ssrcGroups.push({semantic:Q,ssrcIds:se})}}function dt(Te,j,Q){return j in Te?Object.defineProperty(Te,j,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Te[j]=Q,Te}class Wt{constructor(){dt(this,"eol",p)}print(j,Q){let se="";return Q&&(this.eol=Q),se+=this.printVersion(j.version),se+=this.printOrigin(j.origin),se+=this.printSessionName(j.sessionName),se+=this.printInformation(j.information),se+=this.printUri(j.uri),se+=this.printEmail(j.emails),se+=this.printPhone(j.phones),se+=this.printConnection(j.connection),se+=this.printBandwidth(j.bandwidths),se+=this.printTimeFields(j.timeFields),se+=this.printKey(j.key),se+=this.printSessionAttributes(j.attributes),se+=this.printMediaDescription(j.mediaDescriptions),se}printVersion(j){return"v=".concat(j).concat(this.eol)}printOrigin(j){return"o=".concat(j.username," ").concat(j.sessId," ").concat(j.sessVersion," ").concat(j.nettype," ").concat(j.addrtype," ").concat(j.unicastAddress).concat(this.eol)}printSessionName(j){return j?"s=".concat(j).concat(this.eol):""}printInformation(j){return j?"i=".concat(j).concat(this.eol):""}printUri(j){return j?"u=".concat(j).concat(this.eol):""}printEmail(j){let Q="";for(let se of j)Q+="e=".concat(se).concat(this.eol);return Q}printPhone(j){let Q="";for(let se of j)Q+="e=".concat(se).concat(this.eol);return Q}printConnection(j){return j?"c=".concat(j.nettype," ").concat(j.addrtype," ").concat(j.address).concat(this.eol):""}printBandwidth(j){let Q="";for(let se of j)Q+="b=".concat(se.bwtype,":").concat(se.bandwidth).concat(this.eol);return Q}printTimeFields(j){let Q="";for(let se of j){Q+="t=".concat(se.time.startTime," ").concat(se.time.startTime).concat(this.eol);for(let De of se.repeats)Q+="r=".concat(De.repeatInterval," ").concat(De.typedTimes.join(" ")).concat(this.eol);se.zoneAdjustments&&(Q+="z=",Q+="z=".concat(se.zoneAdjustments.map(De=>"".concat(De.time," ").concat(De.back?"-":""," ").concat(De.typedTime)).join(" ")).concat(this.eol),Q+=this.eol)}return Q}printKey(j){return j?"k=".concat(j).concat(this.eol):""}printAttributes(j){let Q="";for(let se of j)Q+="a=".concat(se.attField).concat(se.attValue?":".concat(se.attValue):"").concat(this.eol);return Q}printMediaDescription(j){let Q="";for(let se of j)Q+=this.printMedia(se.media),Q+=this.printInformation(se.information),Q+=this.printConnections(se.connections),Q+=this.printBandwidth(se.bandwidths),Q+=this.printKey(se.key),Q+=this.printMediaAttributes(se);return Q}printConnections(j){let Q="";for(let se of j)Q+=this.printConnection(se);return Q}printMedia(j){return"m=".concat(j.mediaType," ").concat(j.port," ").concat(j.protos.join("/")," ").concat(j.fmts.join(" ")).concat(this.eol)}printSessionAttributes(j){return new Lr(this.eol).print(j)}printMediaAttributes(j){return new we(this.eol).print(j)}}class Ut{constructor(j){dt(this,"eol",void 0),this.eol=j}printIceUfrag(j){return j===void 0?"":"a=ice-ufrag:".concat(j).concat(this.eol)}printIcePwd(j){return j===void 0?"":"a=ice-pwd:".concat(j).concat(this.eol)}printIceOptions(j){return j===void 0?"":"a=ice-options:".concat(j.join(f)).concat(this.eol)}printFingerprints(j){return j.length>0?j.map(Q=>"a=fingerprint:".concat(Q.hashFunction).concat(f).concat(Q.fingerprint)).join(this.eol)+this.eol:""}printExtmap(j){return j.map(Q=>"a=extmap:".concat(Q.entry).concat(Q.direction?"/".concat(Q.direction):"").concat(f).concat(Q.extensionName).concat(Q.extensionAttributes?"".concat(f).concat(Q.extensionAttributes):"").concat(this.eol)).join("")}printSetup(j){return j===void 0?"":"a=setup:".concat(j).concat(this.eol)}printUnrecognized(j){return j.map(Q=>"a=".concat(Q.attField).concat(Q.attValue?":".concat(Q.attValue):"").concat(this.eol)).join("")}}class Lr extends Ut{print(j){let Q="";return Q+=this.printGroups(j.groups),Q+=this.printMsidSemantic(j.msidSemantic),Q+=this.printIceLite(j.iceLite),Q+=this.printIceUfrag(j.iceUfrag),Q+=this.printIcePwd(j.icePwd),Q+=this.printIceOptions(j.iceOptions),Q+=this.printFingerprints(j.fingerprints),Q+=this.printSetup(j.setup),Q+=this.printTlsId(j.tlsId),Q+=this.printIdentity(j.identities),Q+=this.printExtmap(j.extmaps),Q+=this.printUnrecognized(j.unrecognized),Q}printGroups(j){let Q="";return j.length>0&&(Q+=j.map(se=>"a=group:".concat(se.semantic).concat(se.identificationTag.map(De=>"".concat(f).concat(De)).join("")).concat(this.eol)).join("")),Q}printIceLite(j){return j===void 0?"":"a=ice-lite"+this.eol}printTlsId(j){return j?"a=tls-id:".concat(j).concat(this.eol):""}printIdentity(j){return j.length===0?"":j.map(Q=>"a=identity:".concat(Q.assertionValue).concat(Q.extensions.map(se=>"".concat(f).concat(se.name).concat(se.value?"=".concat(se.value):"")))).join(this.eol)+this.eol}printMsidSemantic(j){if(!j)return"";let Q="a=msid-semantic:".concat(j.semantic);return j.applyForAll?Q+="".concat(f,"*"):j.identifierList.length>0&&(Q+=j.identifierList.map(se=>"".concat(f).concat(se))),Q+this.eol}}class we extends Ut{print(j){let Q=j.attributes,se="";return se+=this.printRTCP(Q.rtcp),se+=this.printIceUfrag(Q.iceUfrag),se+=this.printIcePwd(Q.icePwd),se+=this.printIceOptions(Q.iceOptions),se+=this.printCandidates(Q.candidates),se+=this.printRemoteCandidatesList(Q.remoteCandidatesList),se+=this.printEndOfCandidates(Q.endOfCandidates),se+=this.printFingerprints(Q.fingerprints),se+=this.printSetup(Q.setup),se+=this.printMid(Q.mid),se+=this.printExtmap(Q.extmaps),se+=this.printRTPRelated(Q),se+=this.printPtime(Q.ptime),se+=this.printMaxPtime(Q.maxPtime),se+=this.printDirection(Q.direction),se+=this.printSSRCGroups(Q.ssrcGroups),se+=this.printSSRC(Q.ssrcs),se+=this.printRTCPMux(Q.rtcpMux),se+=this.printRTCPMuxOnly(Q.rtcpMuxOnly),se+=this.printRTCPRsize(Q.rtcpRsize),se+=this.printMSId(Q.msids),se+=this.printImageattr(Q.imageattr),se+=this.printRid(Q.rids),se+=this.printSimulcast(Q.simulcast),se+=this.printSCTPPort(Q.sctpPort),se+=this.printMaxMessageSize(Q.maxMessageSize),se+=this.printUnrecognized(Q.unrecognized),se}printCandidates(j){return j.map(Q=>"a=candidate:".concat(Q.foundation).concat(f).concat(Q.componentId).concat(f).concat(Q.transport).concat(f).concat(Q.priority).concat(f).concat(Q.connectionAddress).concat(f).concat(Q.port).concat(f,"typ").concat(f).concat(Q.type).concat(Q.relAddr?"".concat(f,"raddr").concat(f).concat(Q.relAddr):"").concat(Q.relPort?"".concat(f,"rport").concat(f).concat(Q.relPort):"").concat(Object.keys(Q.extension).map(se=>"".concat(f).concat(se).concat(f).concat(Q.extension[se])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(j){return j.map(Q=>"a=remote-candidates:".concat(Q.join(f)).concat(this.eol)).join("")}printEndOfCandidates(j){return j===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(j){if(!j.payloads)return"";let Q=j.payloads,se="";se+=j.rtcpFeedbackWildcards.map(De=>this.printRTCPFeedback("*",De)).join("");for(let De of Q)se+=this.printRtpMap(De.payloadType,De.rtpMap),se+=this.printFmtp(De.payloadType,De.fmtp),se+=De.rtcpFeedbacks.map(gt=>this.printRTCPFeedback(De.payloadType,gt)).join("");return se}printFmtp(j,Q){if(!Q)return"";let se=Object.keys(Q.parameters);return se.length===1&&Q.parameters[se[0]]===null?"a=fmtp:".concat(j).concat(f).concat(se[0]).concat(this.eol):"a=fmtp:".concat(j).concat(f).concat(Object.keys(Q.parameters).map(De=>"".concat(De,"=").concat(Q.parameters[De])).join(";")).concat(this.eol)}printRtpMap(j,Q){return Q?"a=rtpmap:".concat(j).concat(f).concat(Q.encodingName,"/").concat(Q.clockRate).concat(Q.encodingParameters?"/".concat(Q.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(j,Q){let se="a=rtcp-fb:".concat(j).concat(f),De=Q;return De.type==="trr-int"?se+="ttr-int".concat(f).concat(De.interval):(se+="".concat(De.type),De.parameter&&(se+="".concat(f).concat(De.parameter),De.additional&&(se+="".concat(f).concat(De.additional)))),se+this.eol}printPtime(j){return j===void 0?"":"a=ptime:".concat(j).concat(this.eol)}printMaxPtime(j){return j===void 0?"":"a=maxptime:".concat(j).concat(this.eol)}printDirection(j){return j===void 0?"":"a=".concat(j).concat(this.eol)}printSSRC(j){return j.map(Q=>Object.keys(Q.attributes).map(se=>"a=ssrc:".concat(Q.ssrcId.toString(10)).concat(f).concat(se).concat(Q.attributes[se]?":".concat(Q.attributes[se]):"").concat(this.eol)).join("")).join("")}printRTCPMux(j){return j===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(j){return j===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(j){return j===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(j){if(j===void 0)return"";let Q="a=rtcp:".concat(j.port);return j.netType&&(Q+="".concat(f).concat(j.netType)),j.addressType&&(Q+="".concat(f).concat(j.addressType)),j.address&&(Q+="".concat(f).concat(j.address)),Q+this.eol}printMSId(j){return j.map(Q=>"a=msid:".concat(Q.id).concat(Q.appdata?"".concat(f).concat(Q.appdata):"").concat(this.eol)).join("")}printImageattr(j){return j.map(Q=>"a=imageattr:".concat(Q).concat(this.eol)).join("")}printRid(j){return j.map(Q=>{let se="a=rid:".concat(Q.id).concat(f).concat(Q.direction);return Q.payloads&&(se+="".concat(f,"pt=").concat(Q.payloads.join(","))),Q.params.length>0&&(se+="".concat(f).concat(Q.params.map(De=>De.type==="depend"?"depend=".concat(De.rids.join(",")):"".concat(De.type,"=").concat(De.val)).join(";"))),se+this.eol}).join("")}printSimulcast(j){return j===void 0?"":"a=simulcast:".concat(j).concat(this.eol)}printSCTPPort(j){return j===void 0?"":"a=sctp-port:".concat(j).concat(this.eol)}printMaxMessageSize(j){return j===void 0?"":"a=max-message-size:".concat(j).concat(this.eol)}printMid(j){return j===void 0?"":"a=mid:".concat(j).concat(this.eol)}printSSRCGroups(j){return j.map(Q=>"a=ssrc-group:".concat(Q.semantic).concat(Q.ssrcIds.map(se=>"".concat(f).concat(se.toString(10))).join("")).concat(this.eol)).join("")}}function Pe(Te){return new Se().parse(Te)}function Ke(Te,j){return new Wt().print(Te,j)}}},t={};function s(a){if(t[a])return t[a].exports;var c=t[a]={exports:{}};return e[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var d in c)s.o(c,d)&&!s.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function xn(e){return kL.parse(e)}function Bc(e,t){return kL.print(e,t)}var oie=zi("Array","keys"),cie=Ic,lie=Ur,die=N,uie=oie,M0=Array.prototype,hie={DOMTokenList:!0,NodeList:!0},pie=function(e){var t=e.keys;return e===M0||die(M0,e)&&t===M0.keys||lie(hie,cie(e))?uie:t},bn=u(pie);function Ns(e,t,s){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var f=p.call(d,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function LL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Et(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?LL(Object(s),!0).forEach(function(a){Ns(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):LL(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let ML=new class extends bs{constructor(){super(...arguments),Ns(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class mie{constructor(t){Ns(this,"logger",void 0),Ns(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function F0(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function FL(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let Ci={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Uv=Date.now(),Bm=e=>{for(let t in Ci)if(Object.prototype.hasOwnProperty.call(Ci,t)&&Ci[t]===e)return t;return"DEFAULT"},A=new class{constructor(){Ns(this,"proxyServerURL",void 0),Ns(this,"logLevel",Ci.DEBUG),Ns(this,"uploadState","collecting"),Ns(this,"uploadLogWaitingList",[]),Ns(this,"uploadLogUploadingList",[]),Ns(this,"uploadErrorCount",0),Ns(this,"currentLogID",0),Ns(this,"url",void 0),Ns(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Ci.DEBUG].concat(t);this.log.apply(this,a)}info(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Ci.INFO].concat(t);this.log.apply(this,a)}warning(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Ci.WARNING].concat(t);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Ci.ERROR].concat(t);this.log.apply(this,a)}upload(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=[Ci.DEBUG].concat(t);this.uploadLog.apply(this,a)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){$t("UPLOAD_LOG",!0)}disableLogUpload(){$t("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new mie(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-Uv<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Uv);let a=Math.max(0,Math.min(4,t[0]));if(t[0]=F0()+" Agora-SDK [".concat(Bm(a),"]:"),this.appendLogToWaitingList(a,...t),a<this.logLevel)return;let c=F0()+" %cAgora-SDK [".concat(Bm(a),"]:"),d=[];if(!$("USE_NEW_LOG"))switch(a){case Ci.DEBUG:d=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,d);break;case Ci.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,d);break;case Ci.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,d);break;case Ci.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-Uv<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Uv);let a=Math.max(0,Math.min(4,t[0]));t[0]=F0()+" Agora-SDK [".concat(Bm(a),"]:"),this.appendLogToWaitingList(a,...t)}appendLogToWaitingList(e){if(!$("UPLOAD_LOG"))return;for(var t=arguments.length,s=new Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=FL()+" Agora-SDK [".concat(Bm(e),"]:"):s[0]=FL()+" Agora-SDK [".concat(Bm(e),"]:");let c="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Si,process_id:$("PROCESS_ID"),payload:JSON.stringify(e)};return La(async()=>{let s=await dn.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat($("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat($("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(s.data!=="OK"){let a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>{let a={status:-1,message:s.message,errorRange:e.map(c=>c.log_item_id)};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),ML.reportLogUploadError(a),!0},{timeout:$("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:$("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,$("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var UL;function fie(e){return hr(e.reportId,"params.reportId",0,100,!1),hr(e.category,"params.category",0,100,!1),hr(e.event,"params.event",0,100,!1),hr(e.label,"params.label",0,100,!1),Qt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(UL={}).FREE="free",UL.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let gie={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Zs=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),_s=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let _ie=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function ct(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,s,a){let c=a.value;if(typeof c=="function"){let d=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);a.value=function(){for(var h,p=arguments.length,f=new Array(p),_=0;_<p;_++)f[_]=arguments[_];let v=f;if(e.argsMap)try{v=e.argsMap(this,...f)}catch(w){A.warning(w),v=[]}try{JSON.stringify(v)}catch{A.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),v=[]}let b=(e.report||Qe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:v,tag:vs.TRACER,reportResult:e.reportResult},e.throttleTime);try{let w=c.apply(this,f);return w instanceof Ve?w.then(T=>(b.onSuccess(e.reportResult&&T),T)).catch(T=>{throw b.onError(T),T}):(b.onSuccess(e.reportResult&&w),w)}catch(w){throw b.onError(w),w}}}return a}}let Qe=new class{constructor(){Ns(this,"baseInfoMap",new Map),Ns(this,"proxyServer",void 0),Ns(this,"eventUploadTimer",void 0),Ns(this,"setSessionIdTimer",void 0),Ns(this,"url",void 0),Ns(this,"sids",new Set),Ns(this,"backupUrl",void 0),Ns(this,"_appId",void 0),Ns(this,"_aid",0),Ns(this,"keyEventUploadPendingItems",[]),Ns(this,"normalEventUploadPendingItems",[]),Ns(this,"apiInvokeUploadPendingItems",[]),Ns(this,"apiInvokeCount",0),Ns(this,"apiInvokeLoggedCount",0),Ns(this,"ltsList",[]),Ns(this,"lastSendNormalEventTime",Date.now()),Ns(this,"customReportCounterTimer",void 0),Ns(this,"customReportCount",0),Ns(this,"extApiInvoke",async e=>{for(let t of e){let s=Et(Et({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:vs.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),$("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),$("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[s,a]=t;return s+a}),16)||0}reportApiInvoke(e,t,s){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let a=Date.now();this.apiInvokeCount+=1;let c=this.apiInvokeCount,d=!!$("SHOW_REPORT_INVOKER_LOG"),h=!!$("SHOW_REPORT_USER_INVOKER_LOG"),p=d||h&&t.id;p&&(this.apiInvokeLoggedCount+=1);let f=this.apiInvokeLoggedCount;function _(T,U){if(p){let k="[apiInvoke-".concat(f,"]");if(t.id&&(k+="[".concat(t.id,"]")),t.name&&(k+="[".concat(t.name,"]"),t.name===Os.JOIN))return A.info("".concat(k," ").concat(T));A.info("".concat(k," ").concat(T),T==="start"?t.options:U||"")}}let v=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:a,options:t.options,states:t.states||null});_("start");let b=!1;pr(t.timeout).then(()=>{b||(this.sendApiInvoke(Et(Et({},v()),{},{error:K.API_INVOKE_TIMEOUT,success:!1})),_("timeout"))});let w=new _e(K.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:T=>{let U=()=>{if(b)throw w;return b=!0,this.sendApiInvoke(Et(Et({},v()),{},{success:!0},t.reportResult&&{result:T})),_("onSuccess"),T};return s?vL(U,t.name+"Success",s,()=>b=!0):U()},onError:T=>{let U=()=>{if(b)throw T;b=!0,this.sendApiInvoke(Et(Et({},v()),{},{success:!1,error:T})),_("onFailure",T.toString())};return s?vL(U,t.name+"Error",s,()=>b=!0):U()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let s=Date.now(),a=this.createBaseInfo(e,s);a.cname=t.cname;let c=Object.assign({},{willUploadConsoleLog:$("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:j0?"global":"oversea",areas:$("AREAS")&&$("AREAS").join(",")},t.extend),{stringUid:d,channelProfile:h,channelMode:p,isABTestSuccess:f,lsid:_,clientRole:v}=t,b=Date.now(),w=Et(Et({},a),{},{eventType:Zs.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:k0,lts:b,elapse:b-s,extend:JSON.stringify(c),mode:t.mode,process:$("PROCESS_ID"),appType:$("APP_TYPE"),success:!0,version:Si,stringUid:d,channelProfile:h,channelMode:p,isABTestSuccess:f,lsid:_,clientType:je(T=window.navigator.userAgent).call(T,"AgoraWebView")?42:20,clientRole:v,serviceId:$("PROCESS_ID"),extensionID:$("PLUGIN_INFO").join(",")||""});var T;this.send({type:_s.SESSION,data:w},!0)}joinChooseServer(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et({},a),{},{role:t.role,eventType:Zs.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-s.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:_s.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et({},a),{},{eventType:Zs.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-s.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:_s.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info;t.vid&&(a.vid=t.vid),a.uid=t.uid,a.cid=t.cid;let c=Date.now(),{firstSuccess:d,addr:h,isProxy:p}=t,f=c-s.startTime,_=Et(Et({},a),{},{eventType:Zs.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:f,eventElapse:c-t.lts,firstSuccess:d,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:O0(),isABTestSuccess:t.isABTestSuccess?1:0}),v=_.success?1:0;if(t.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:_s.JOIN_GATEWAY,data:_},!0);else{let b;if(h)if(p){let T=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=h.match(/p=[0-9]{1,6}/g);b={isSuccess:v,gatewayIp:T&&T.length?T[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:p?1:0}}else{let T=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=h.match(/(:|p=)[0-9]{1,6}/g);b={isSuccess:v,gatewayIp:T&&T.length?T[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:p?1:0}}else b={isSuccess:v,gatewayIp:"",port:"",isProxy:p?1:0};delete _.success,delete _.eventType,delete _.firstSuccess,_.vid=Number(_.vid);let w=Object.assign({},_,b,{eventType:Zs.REJOIN_GATEWAY});this.send({type:_s.RE_JOIN_GATEWAY,data:w},!0)}}joinChannelTimeout(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=Date.now(),c=Et(Et({},s.info),{},{lts:a,timeout:t,elapse:a-s.startTime});this.send({type:_s.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et({},a),{},{eventType:Zs.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-s.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:_s.PUBLISH,data:d},!0)}subscribe(e,t,s){let a=this.baseInfoMap.get(e);if(!a)return;let c=a.info,d=Date.now(),h=Et(Et({},c),{},{eventType:Zs.SUBSCRIBE,lts:d,eventElapse:t.eventElapse,elapse:d-a.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?h.peerSuid=t.peerid:h.peer=t.peerid,this.send({type:_s.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var t;let s=[...bn(t=this.baseInfoMap).call(t)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;let d=c.info,h=Date.now(),p=Et(Et({},d),{},{eventType:Zs.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:_s.WS_COMPRESSOR_INIT,data:p},!0)}firstXLAPeerFirstVideoFrame(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=t.peerPubStatusMs-(s.lastJoinSuccessTime||c),h=Et(Et({},a),{},{elapse:c-s.startTime,eventType:Zs.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>d?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:_s.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(e,t,s,a){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=Et(Et(Et({},d),a),{},{elapse:h-c.startTime,eventType:t,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:p},!0)}firstRemoteFrame(e,t,s,a){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=Et(Et(Et({},d),a),{},{elapse:h-c.startTime,eventType:t,lts:h});this.send({type:s,data:p},!0)}abTest(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et(Et({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Zs.AB_TEST,lts:c});this.send({type:_s.AB_TEST,data:d},!0)}pcStats(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et(Et({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Zs.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:_s.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(e,t){if(e){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et(Et({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Zs.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:_s.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(e,t,s,a){let c=this.baseInfoMap.get(e);if(!c)return;let d=c.info,h=Date.now(),p=Et(Et(Et({},d),a),{},{eventType:t,lts:h});this.send({type:s,data:p},!0)}streamSwitch(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et({},a),{},{eventType:Zs.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-s.startTime,success:t.succ});this.send({type:_s.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et({},a),{},{eventType:Zs.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-s.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:_s.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et({},a),{},{eventType:Zs.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-s.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:_s.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(e){this.proxyServer=e,e?A.debug("reportProxyServerurl: ".concat(e)):A.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et({},a),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:_s.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now();(function(d,h,p){let f=d[h];if(!f||typeof f!="string")return[d];d[h]="";let _=Eo(JSON.stringify(d)),v=0,b=[],w=0;for(let T=0;T<f.length;T++)w+=f.charCodeAt(T)<=127?1:3,w<=p-_||(b[b.length]=Re(Re({},d),{},{[h]:f.substring(v,T)}),v=T,w=f.charCodeAt(T)<=127?1:3);return v!==f.length-1&&(b[b.length]=Re(Re({},d),{},{[h]:f.substring(v)})),b})(Et(Et(Et({},a),t),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:_s.WORKER_EVENT,data:d},!0))}apworkerEvent(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et(Et({},a),t),{},{elapse:c-s.startTime,lts:c});this.send({type:_s.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et(Et({},a),t),{},{elapse:c-s.startTime,lts:c,extend:t.extend||void 0});this.send({type:_s.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(e,t){let s=this.baseInfoMap.get(e);if(!s)return;let a=s.info,c=Date.now(),d=Et(Et(Et({},a),t),{},{elapse:c-s.startTime,lts:c});this.send({type:_s.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>$("CUSTOM_REPORT_LIMIT"))throw new _e(K.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let s=Date.now(),a=t.map(c=>({type:_s.USER_ANALYTICS,data:Et(Et({sid:e},c),{},{lts:s})}));try{$("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw A.error("send custom report message failed",c.toString()),new _e(K.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){let t=$("NOT_REPORT_EVENT");if(e.tag&&je(t)&&je(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let s=this.baseInfoMap.get(e.sid);if(!s)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:a,uid:c,cid:d}=s.info,h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof _e){let{code:f,message:_}=e.error;h=f||_||e.error.toString()}else h=e.error.toString();let p={invokeId:e.invokeId,sid:e.sid,cname:a,cid:d,uid:c,lts:e.lts,success:e.success,elapse:e.lts-s.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:_s.API_INVOKE,data:p},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(s=>s!==null);t&&e.forEach(s=>{s&&(s.sid=t,this.sendApiInvoke(Object.assign({},s)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let s=[],a=[];for(;e.length;){let d=e.shift();s.length<20?s.push(d):a.push(d)}e.push(...a);for(let d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),Ql(c=this.ltsList).call(c,(h,p)=>h-p))}return t||(this.lastSendNormalEventTime=Date.now()),$("ENABLE_EVENT_REPORT")&&s.length&&($("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{$("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-$("NORMAL_EVENT_QUEUE_CAPACITY")),A.warning("report: drop normal events"))))})(s)),e}async postDataToStatsCollector2(e){Fs.networkState===Vn.OFFLINE&&await Ve.race([Fs.onlineWaiter,pr(2*Hs.maxRetryTimeout)]);let t=c=>{let d=new Uint8Array;return c.forEach(h=>{let p=y0(JSON.stringify(h.data)),f=new ArrayBuffer(5),_=(b=>{let w=0;return Object.entries(_s).forEach(T=>{let[U,k]=T;k===b.type&&(w=_ie[U])}),w})(h),v=new DataView(f);v.setUint16(0,p.byteLength,!0),v.setUint8(2,255&_),v.setUint8(3,_>>>8&255),v.setUint8(4,_>>>16&255),d=lL(d,new Uint8Array(f)),d=lL(d,p)}),d},s="event",a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await N0(a,{timeout:1e4,data:t(e),headers:Et(Et({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=(p=>{let f=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return f&&f.info.vid&&+f.info.vid||0})(e[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(p=>JSON.stringify(p)),vid:s,aid:a};Fs.networkState===Vn.OFFLINE&&await Ve.race([Fs.onlineWaiter,pr(2*Hs.maxRetryTimeout)]);let d=t?"/events/proto-raws":"/events/messages",h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat($("EVENT_REPORT_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(d));for(let p=0;p<2;p+=1){p===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat($("EVENT_REPORT_BACKUP_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(d)));try{t?await sie(h,{timeout:1e4,data:c}):await N0(h,{timeout:1e4,data:c})}catch(f){if(p===1)throw f;continue}return}}createBaseInfo(e,t){let s=Object.assign({},gie);return s.sid=e,this.baseInfoMap.set(e,{info:s,startTime:t}),s}reportResourceTiming(e,t){let s=performance.getEntriesByName(e),a=s[s.length-1];a&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:a,tag:vs.TRACER}).onSuccess()}};ML.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Fs.networkState,Qe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:vs.TRACER}).onSuccess("logUploadError")});class ue extends _e{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ns(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,A)}throw(){super.throw(A)}}let mr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function jt(){return mr}function VL(){return"setSinkId"in HTMLAudioElement.prototype&&(!$("RESTRICTION_SET_PLAYBACK_DEVICE")||(ec()||J2())&&!_0())}function Vv(){return!mr.supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&tc()}function U0(e){return!(Cs()||Q2(87)||Vv()||!$("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB")))}function BL(e){return!!$("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB"))}let fr=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function nh(e,t,s){return{sampleRate:e,stereo:t,bitrate:s}}function Pt(e,t,s,a,c){return{width:e,height:t,frameRate:s,bitrateMin:a,bitrateMax:c}}function ta(e,t,s,a,c){return{width:{max:e},height:{max:t},frameRate:s,bitrateMin:a,bitrateMax:c}}function V0(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let vie={"90p":Pt(160,90),"90p_1":Pt(160,90),"120p":Pt(160,120,15,30,65),"120p_1":Pt(160,120,15,30,65),"120p_3":Pt(120,120,15,30,50),"120p_4":Pt(212,120),"180p":Pt(320,180,15,30,140),"180p_1":Pt(320,180,15,30,140),"180p_3":Pt(180,180,15,30,100),"180p_4":Pt(240,180,15,30,120),"240p":Pt(320,240,15,40,200),"240p_1":Pt(320,240,15,40,200),"240p_3":Pt(240,240,15,40,140),"240p_4":Pt(424,240,15,40,220),"360p":Pt(640,360,15,80,400),"360p_1":Pt(640,360,15,80,400),"360p_3":Pt(360,360,15,80,260),"360p_4":Pt(640,360,30,80,600),"360p_6":Pt(360,360,30,80,400),"360p_7":Pt(480,360,15,80,320),"360p_8":Pt(480,360,30,80,490),"360p_9":Pt(640,360,15,80,800),"360p_10":Pt(640,360,24,80,800),"360p_11":Pt(640,360,24,80,1e3),"480p":Pt(640,480,15,100,500),"480p_1":Pt(640,480,15,100,500),"480p_2":Pt(640,480,30,100,1e3),"480p_3":Pt(480,480,15,100,400),"480p_4":Pt(640,480,30,100,750),"480p_6":Pt(480,480,30,100,600),"480p_8":Pt(848,480,15,100,610),"480p_9":Pt(848,480,30,100,930),"480p_10":Pt(640,480,10,100,400),"720p":Pt(1280,720,15,120,1130),"720p_auto":Pt(1280,720,30,900,3e3),"720p_1":Pt(1280,720,15,120,1130),"720p_2":Pt(1280,720,30,120,2e3),"720p_3":Pt(1280,720,30,120,1710),"720p_5":Pt(960,720,15,120,910),"720p_6":Pt(960,720,30,120,1380),"1080p":Pt(1920,1080,15,120,2080),"1080p_1":Pt(1920,1080,15,120,2080),"1080p_2":Pt(1920,1080,30,120,3e3),"1080p_3":Pt(1920,1080,30,120,3150),"1080p_5":Pt(1920,1080,60,120,4780),"1440p":Pt(2560,1440,30,120,4850),"1440p_1":Pt(2560,1440,30,120,4850),"1440p_2":Pt(2560,1440,60,120,7350),"4k":Pt(3840,2160,30,120,8910),"4k_1":Pt(3840,2160,30,120,8910),"4k_3":Pt(3840,2160,60,120,13500)},Eie={"480p":ta(640,480,5),"480p_1":ta(640,480,5),"480p_2":ta(640,480,30),"480p_3":ta(640,480,15),"720p":ta(1280,720,5),"720p_auto":Pt(1280,720,30,900,3e3),"720p_1":ta(1280,720,5),"720p_2":ta(1280,720,30),"720p_3":ta(1280,720,15),"1080p":ta(1920,1080,5),"1080p_1":ta(1920,1080,5),"1080p_2":ta(1920,1080,30),"1080p_3":ta(1920,1080,15)},yie={"1SL1TL":V0(1,1),"3SL3TL":V0(3,3),"2SL3TL":V0(2,3)};function sa(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},vie[e]):e}function B0(e){return typeof e=="string"?Object.assign({},Eie[e]):e}function Bv(e){return typeof e=="string"?Object.assign({},yie[e]):e}let xie={speech_low_quality:nh(16e3,!1),speech_standard:nh(32e3,!1,18),music_standard:nh(48e3,!1),standard_stereo:nh(48e3,!0,56),high_quality:nh(48e3,!1,128),high_quality_stereo:nh(48e3,!0,192)};function Wv(e){return typeof e=="string"?Object.assign({},xie[e]):e}let ih=[];function WL(e){return Qs(e,"mediaSource",["screen","window","application"]),!0}let Ye=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Zt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),ah=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),bie=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),wie=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),dd=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),oh=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Ti=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),ch=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),ii=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let W0={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},G0={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},GL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Sie={uplinkNetworkQuality:0,downlinkNetworkQuality:0},HL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},en=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),ai=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Wm=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),ud=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Or=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),xo=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),H0={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},Gv=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Rt(e,t,s,a,c){var d,h,p={};return Object.keys(a).forEach(function(f){p[f]=a[f]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=Ki(d=AD(h=s.slice()).call(h)).call(d,function(f,_){return _(e,t,f)||f},p),c&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(c):void 0,p.initializer=void 0),p.initializer===void 0?(Object.defineProperty(e,t,p),null):p}function ce(e,t,s){return(t=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var p=d[Symbol.toPrimitive];if(p!==void 0){var f=p.call(d,"string");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function zL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function ns(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?zL(Object(s),!0).forEach(function(a){ce(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):zL(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class KL extends bs{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(dd.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,s){super(),ce(this,"trackMediaType",void 0),ce(this,"_ID",void 0),ce(this,"_rtpTransceiver",void 0),ce(this,"_lowRtpTransceiver",void 0),ce(this,"_hints",[]),ce(this,"_isClosed",!1),ce(this,"_originMediaStreamTrack",void 0),ce(this,"mediaStreamTrack",void 0),ce(this,"_external",{}),this._ID=s||ts(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(a){je(ih).call(ih,a)||ih.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Uc(()=>{var s;Qe.reportApiInvoke(null,{name:Os.GET_MEDIA_STREAM_TRACK,options:[],tag:vs.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===ah.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){let s=ih.indexOf(t);s!==-1&&ih.splice(s,1)}(this),this.emit(oh.CLOSED),this.removeAllListeners(dd.SEI_RECEIVED)}_updateRtpTransceiver(t,s){if(s===ah.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(dd.TRANSCEIVER_UPDATED,t,s)}}class lh extends KL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,s){super(t,s),ce(this,"_enabled",!0),ce(this,"_muted",!1),ce(this,"_isExternalTrack",!1),ce(this,"_isClosed",!1),ce(this,"_enabledMutex",void 0),ce(this,"processor",void 0),ce(this,"_processorContext",void 0),ce(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Dr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,s;return(t=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,A.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ye.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await es(this,Ye.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}stateCheck(t,s){if(A.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(s,"]")),ka(s,t),this._enabled&&this._muted&&t==="enabled"&&s===!1)throw new _e(K.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",A);if(!this._enabled&&!this._muted&&t==="muted"&&s===!0)throw new _e(K.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",A)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ve.resolve([])}}let qL=window.AudioContext||window.webkitAudioContext,oi=null,Xt=new class extends bs{constructor(){super(...arguments),ce(this,"prevState",void 0),ce(this,"curState",void 0),ce(this,"currentTime",void 0),ce(this,"currentTimeStuckAt",void 0),ce(this,"interruptDetectorTrack",void 0),ce(this,"onLocalAudioTrackMute",()=>{A.info("ios15-interruption-start"),this.emit(fr.IOS_15_16_INTERRUPTION_START)}),ce(this,"onLocalAudioTrackUnmute",async()=>{A.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?A.info("ios15-interruption-end-canceled"):(oi&&await oi.suspend(),this.emit(fr.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){A.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){A.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function dh(){if(!oi){if(function(){if(!qL)return void A.error("your browser is not support web audio");A.info("create audio context");let e=ns({},$("WEBAUDIO_INIT_OPTIONS"));A.debug("audio context init option:",JSON.stringify(e)),oi=new qL(e),Xt.curState=oi.state,oi.onstatechange=()=>{Xt.prevState=Xt.curState,Xt.curState=oi?oi.state:void 0;let{prevState:t,curState:s}=Xt,a=s==="running",c=s==="interrupted",d=t==="running",h=t==="suspended",p=t==="interrupted",f=At().osVersion;(Br()||Zi())&&d&&c&&(A.info("ios".concat(f,"-interruption-start")),Xt.emit(fr.IOS_INTERRUPTION_START)),(Br()||Zi())&&(h||p)&&a&&(A.info("ios".concat(f,"-interruption-end")),Xt.emit(fr.IOS_INTERRUPTION_END)),t!==s&&Xt.emit(fr.STATE_CHANGE,s,t)},setInterval(()=>{var t;let s=(t=oi)===null||t===void 0?void 0:t.currentTime;Xt.currentTime!==s?(Xt.currentTimeStuckAt&&(A.debug("AudioContext current time resume at ".concat(s)),Xt.currentTimeStuckAt=void 0),Xt.currentTime=s):(s!==Xt.currentTimeStuckAt&&(Qe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:vs.TRACER}).onSuccess(),A.warning("AudioContext current time stuck at ".concat(s))),Xt.currentTimeStuckAt=s)},5e3),async function(t){let s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],a,c=!1,d=!1,h=!1;function p(k){t.state==="running"?f(!1):Br()||Zi()?t.state==="suspended"&&(f(!0),k&&t.resume().then(_,_)):t.state!=="closed"&&(f(!0),k&&t.resume().then(_,_))}function f(k){if(c!==k){c=k;for(let F=0,z=s;F<z.length;F+=1){let Y=z[F];k?window.addEventListener(Y,v,{capture:!0,passive:!0}):window.removeEventListener(Y,v,{capture:!0,passive:!0})}}}function _(){p(!1)}function v(){p(!0)}function b(k){if(!h)if(a.paused)if(k){let F;w(!1),h=!0;try{F=a.play(),F?F.then(T,T):(a.addEventListener("playing",T),a.addEventListener("abort",T),a.addEventListener("error",T))}catch{T()}}else w(!0);else w(!1)}function w(k){if(d!==k){d=k;for(let F=0,z=s;F<z.length;F++){let Y=z[F];k?window.addEventListener(Y,U,{capture:!0,passive:!0}):window.removeEventListener(Y,U,{capture:!0,passive:!0})}}}function T(){a.removeEventListener("playing",T),a.removeEventListener("abort",T),a.removeEventListener("error",T),h=!1,b(!1)}function U(){b(!0)}if(Br()){let k=t.createMediaStreamDestination(),F=document.createElement("div");F.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=F.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=k.stream,b(!0)}Xt.on(fr.STATE_CHANGE,function(){p(!0)}),p(!1)}(oi)}(),!oi)throw new _e(K.NOT_SUPPORTED,"can not create audio context");return oi}return oi}function hd(e){if(function(){if(z0!==null)return z0;let a=dh(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let p=!1;try{c.disconnect(d)}catch{p=!0}return c.disconnect(),z0=p,p}())return;let t=e.connect,s=e.disconnect;e.connect=(a,c,d)=>{var h;return e._inputNodes||(e._inputNodes=[]),je(h=e._inputNodes).call(h,a)||(a instanceof AudioNode?(e._inputNodes.push(a),t.call(e,a,c,d)):t.call(e,a,c)),e},e.disconnect=(a,c,d)=>{s.call(e),a?Ov(e._inputNodes,a):e._inputNodes=[];for(let h of e._inputNodes)t.call(e,h)}}let z0=null;function K0(e,t){let s=!1,a=1/t;if($("DISABLE_WEBAUDIO")){let c=window.setInterval(()=>{s?window.clearInterval(c):e(performance.now()/1e3)},1e3*a)}else{let c=dh(),d=c.createGain();d.gain.value=0,d.connect(c.destination);let h=()=>{if(s)return void(d=null);let p=c.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(c.currentTime+a),e(c.currentTime)};h()}return()=>{s=!0}}class YL{constructor(){ce(this,"context",void 0),ce(this,"analyserNode",void 0),ce(this,"sourceNode",void 0),this.context=dh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Br()||Zi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<t.length;++c)t[c]=a[c]/128-1}let s=Ki(t).call(t,(a,c)=>a+c*c,0)/t.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,s;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{A.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class $L extends bs{get processSourceNode(){return this.sourceNode}set processedNode(t){var s;if(!this.isDestroyed&&this._processedNode!==t){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ce(this,"outputNode",void 0),ce(this,"outputTrack",void 0),ce(this,"isPlayed",!1),ce(this,"sourceNode",void 0),ce(this,"context",void 0),ce(this,"audioBufferNode",void 0),ce(this,"destNode",void 0),ce(this,"audioOutputLevel",0),ce(this,"volumeLevelAnalyser",void 0),ce(this,"_processedNode",void 0),ce(this,"playNode",void 0),ce(this,"isDestroyed",!1),ce(this,"onNoAudioInput",void 0),ce(this,"isNoAudioInput",!1),ce(this,"_noAudioInputCount",0),this.context=dh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),hd(this.outputNode),this.volumeLevelAnalyser=new YL}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(ii.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){let d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!jt().webAudioMediaStreamDest)throw new _e(K.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&jv(()=>{Xt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Br()||Zi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let s=this.volumeLevelAnalyser.getAnalyserNode(),a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await pr(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,s;(t=this.processedNode)===null||t===void 0||t.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class XL extends $L{get isFreeze(){return!1}constructor(t,s,a){var c;if(super(),ce(this,"sourceNode",void 0),ce(this,"track",void 0),ce(this,"clonedTrack",void 0),ce(this,"audioElement",void 0),ce(this,"isCurrentTrackCloned",!1),ce(this,"isRemoteTrack",!1),ce(this,"originVolumeLevelAnalyser",void 0),ce(this,"rebuildWebAudio",async()=>{if(A.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void A.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>A.info("resume success")),A.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let p=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?p.stop():this.isCurrentTrackCloned=!0;let f=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(f),hd(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let _=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(_,this.context.currentTime),hd(this.outputNode),this.emit(ii.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=f,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new _e(K.UNEXPECTED_ERROR);this.track=t;let d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),hd(this.sourceNode),a){let p=a.clone();p.enabled=!0,this.clonedTrack=p,A.debug("create an unmuted track ".concat(p.id," from the original track ").concat(a.id," to get the volume"));let f=this.context.createMediaStreamSource(new MediaStream([p]));hd(f),this.originVolumeLevelAnalyser=new YL,this.originVolumeLevelAnalyser.updateSource(f)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;let h=At();s&&h.os===sr.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Xt.on(fr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(p=>{p||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let s=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(s),hd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ii.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Xt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let s=t.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),A.debug("create an unmuted track ".concat(s.id," from the original track ").concat(t.id," to get the volume"));let a=this.context.createMediaStreamSource(new MediaStream([s]));hd(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function JL(e,t,s){let a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:a(t.height,1080),maxWidth:a(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Cie(e,t){let s=await QL(e.mediaSource),{sourceId:a,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ve((p,f)=>{let _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let b=document.createElement("div");b.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",b.setAttribute("style","height: 12%;");let w=document.createElement("div");w.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let U=document.createElement("button");U.innerHTML="cancel",U.setAttribute("style","width: 85px;"),U.onclick=()=>{document.body.removeChild(z);let Y=new Error("NotAllowedError");Y.name="NotAllowedError",f(Y)};let k=h,F=document.createElement("div");if(h){let Y=document.createElement("input");Y.setAttribute("type","checkbox");let X=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),X.innerText="Share audio",Y.checked=k,Y.onchange=()=>{k=Y.checked},F.appendChild(Y),F.appendChild(X)}T.appendChild(F),T.appendChild(U),v.appendChild(b),v.appendChild(w),v.appendChild(T);let z=document.createElement("div");z.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),z.appendChild(_),z.appendChild(v),document.body.appendChild(z),d.map(Y=>{if(Y.id){let X=document.createElement("div");X.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let re=Y.thumbnail;try{let{width:te}=re.getSize();te>1920&&(re=re.resize({width:1920}))}catch(te){throw te&&te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),te}X.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+re.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(te){return"&#"+te.charCodeAt(0)+";"})+"</span>",X.onclick=()=>{document.body.removeChild(z),p({sourceId:Y.id,audio:k})},w.appendChild(X)}})})}(s,t);return await JL(a,e,c)}async function QL(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let s=dL();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new _e(K.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{a=null}a&&a.then||(a=new Ve((d,h)=>{s.desktopCapturer.getSources({types:t},(p,f)=>{p?h(p):d(f)})}));try{return await a}catch(d){throw new _e(K.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}let q0=new Dr("safari"),ZL=!1,eM=!1;async function ci(e,t){let s=0,a=null;for(;s<2;)try{a=await Tie(e,t,s>0);break}catch(c){if(c instanceof _e)throw A.error("[".concat(t,"] ").concat(c.toString())),c;let d=Hv(c.name||c.code||c,c.message);if(d.code===K.MEDIA_OPTION_INVALID){A.debug("[".concat(t,"] detect media option invalid, retry")),s+=1,await pr(500);continue}throw A.error("[".concat(t,"] ").concat(d.toString())),d}if(!a)throw new _e(K.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function Tie(e,t,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new _e(K.NOT_SUPPORTED,"can not find getUserMedia");s&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let a=jt(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return A.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(dL())e.screen.sourceId?uh(c,await JL(e.screen.sourceId,e.screen,!!e.screenAudio)):uh(c,await Cie(e.screen,!!e.screenAudio));else if(ec()&&e.screen.extensionId&&e.screen.mandatory){if(!a.getStreamFromExtension)throw new _e(K.NOT_SUPPORTED,"This browser does not support screen sharing");A.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let w=await(h=e.screen.extensionId,p=t,new Ve((T,U)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},k=>{if(!k||!k.streamId)return A.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),k),void U(new _e(K.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(k.streamId)})}catch(k){A.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),k.toString()),U(new _e(K.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=w,uh(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(a.getDisplayMedia){var d;e.screen.mediaSource&&WL(e.screen.mediaSource);let w={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(d=e.screen.displaySurface)!==null&&d!==void 0?d:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:U,systemAudio:k,preferCurrentTab:F}=e.screen,z={selfBrowserSurface:T,surfaceSwitching:U,systemAudio:k,preferCurrentTab:F};!T&&delete z.selfBrowserSurface,!U&&delete z.surfaceSwitching,!k&&delete z.systemAudio,!F&&delete z.preferCurrentTab,A.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:w,audio:e.screenAudio,controls:z})),uh(c,await navigator.mediaDevices.getDisplayMedia(ns({video:w,audio:e.screenAudio},z)))}else{if(!Cs())throw A.error("[".concat(t,"] This browser does not support screenSharing")),new _e(K.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&WL(e.screen.mediaSource);let w={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};A.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(w))),uh(c,await navigator.mediaDevices.getUserMedia(w))}}var h,p;if(!e.video&&!e.audio)return c;let f={video:e.video,audio:e.audio},_=$("MEDIA_DEVICE_CONSTRAINTS");if(_)try{typeof _=="string"&&(_=JSON.parse(_)),f=w0(f,_)}catch{}A.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(f)),At();let v,b=null;(wr()||Br()||Iv())&&(b=await q0.lock());try{v=await navigator.mediaDevices.getUserMedia(f)}catch(w){throw b&&b(),w}return f.audio&&(ZL=!0),f.video&&(eM=!0),uh(c,v),b&&b(),c}function Hv(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new _e(K.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new _e(K.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new _e(K.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new _e(K.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new _e(K.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new _e(K.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return A.error("getUserMedia unexpected error",e),new _e(K.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function uh(e,t){let s=e.getVideoTracks()[0],a=e.getAudioTracks()[0],c=t.getVideoTracks()[0],d=t.getAudioTracks()[0];d&&(a&&e.removeTrack(a),e.addTrack(d)),c&&(s&&e.removeTrack(s),e.addTrack(c))}let li=new class extends bs{get state(){return this._state}set state(e){e!==this._state&&(this.emit(ud.STATE_CHANGE,e),this._state=e)}constructor(){super(),ce(this,"_state",Wm.IDLE),ce(this,"isAccessMicrophonePermission",!1),ce(this,"isAccessCameraPermission",!1),ce(this,"lastAccessMicrophonePermission",!1),ce(this,"lastAccessCameraPermission",!1),ce(this,"checkdeviceMatched",!1),ce(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{($("ENUMERATE_DEVICES_INTERVAL")||(Dv()||Av()===sr.HARMONY_OS)&&tc())&&this.updateDevicesInfo()},$("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>A.error(e.toString()))}async enumerateDevices(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new _e(K.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a),d=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;c.audio&&(d=!1),c.video&&(h=!1);let p=null,f=null,_=null;if(!s&&(d||h)){if(q0.isLocked&&(A.debug("[device manager] wait GUM lock"),(await q0.lock())(),A.debug("[device manager] GUM unlock")),ZL&&(d=!1,this.isAccessMicrophonePermission=!0),eM&&(h=!1,this.isAccessCameraPermission=!0),A.debug("[device manager] check media device permissions",e,t,d,h),d&&h){try{_=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(v){let b=Hv(v.name||v.code||v,v.message);if(b.code===K.PERMISSION_DENIED)throw b;A.warning("getUserMedia failed in getDevices",b)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({audio:e})}catch(v){let b=Hv(v.name||v.code||v,v.message);if(b.code===K.PERMISSION_DENIED)throw b;A.warning("getUserMedia failed in getDevices",b)}this.isAccessMicrophonePermission=!0}else if(h){try{f=await navigator.mediaDevices.getUserMedia({video:t})}catch(v){let b=Hv(v.name||v.code||v,v.message);if(b.code===K.PERMISSION_DENIED)throw b;A.warning("getUserMedia failed in getDevices",b)}this.isAccessCameraPermission=!0}A.debug("[device manager] mic permission",e,"cam permission",t)}try{let v=await navigator.mediaDevices.enumerateDevices();return p&&p.getTracks().forEach(b=>b.stop()),f&&f.getTracks().forEach(b=>b.stop()),_&&_.getTracks().forEach(b=>b.stop()),p=null,f=null,_=null,v}catch(v){return p&&p.getTracks().forEach(b=>b.stop()),f&&f.getTracks().forEach(b=>b.stop()),_&&_.getTracks().forEach(b=>b.stop()),p=null,f=null,_=null,new _e(K.ENUMERATE_DEVICES_FAILED,v.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(s=>{s.device.label===e&&(t=s.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===e);if(!t)throw new _e(K.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Wm.INITING;try{await this.updateDevicesInfo(),this.state=Wm.INITEND}catch(e){throw A.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Wm.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new _e(K.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),s=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?A.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):A.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):A.debug("[device-check] default input or output not found")}let a=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;let d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){let h={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=t)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",s.push(c))}),this.state!==Wm.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ud.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ud.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ud.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(c=>c.kind==="audioinput"),s=e.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(let c of t)if(c.label&&c.deviceId){a.audio=!0;break}for(let c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}},Y0=!1,di=new class extends bs{constructor(){super(...arguments),ce(this,"onAutoplayFailed",void 0),ce(this,"onAudioAutoplayFailed",void 0)}};function tM(){if(At(),!Y0){let e=t=>{t.preventDefault(),Y0=!1,Om()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Y0=!0,Om()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),A.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),di.onAutoplayFailed?di.onAutoplayFailed():di.onAudioAutoplayFailed?A.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):A.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),di.emit("autoplay-failed")}}function sM(e,t,s,a){if(!e)return;let c=Qe.getBaseInfoBySessionId(e);if(!c)return;let d=c.info,h=Date.now(),p=ns(ns({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:di.onAutoplayFailed||di.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:t,trackId:a,extend:void 0});Qe.send({type:_s.AUTOPLAY_FAILED,data:p},!0)}let Nie=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],un=new class{constructor(){ce(this,"onAutoplayFailed",void 0),ce(this,"elementMap",new Map),ce(this,"elementStateMap",new Map),ce(this,"elementsNeedToResume",[]),ce(this,"sinkIdMap",new Map),ce(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[s,a]=t,c=this.elementStateMap.get(s),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(A.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return a.pause(),void a.play();if(Xt.curState==="running")return Ju()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),ce(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,s]=e,a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(A.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),Xt.on(fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xt.on(fr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Xt.on(fr.STATE_CHANGE,()=>{Br()&&Xt.prevState==="suspended"&&Xt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let s=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),s)try{await s.setSinkId(t)}catch(a){throw new _e(K.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(e,t,s,a){if(this.elementMap.has(t))return;let c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,Or.INIT),this.setVolume(t,s);let d=this.sinkIdMap.get(t);if(d)try{c.setSinkId(d).catch(p=>{A.warning("[".concat(t,"] set sink id failed"),p.toString())})}catch(p){A.warning("[".concat(t,"] set sink id failed"),p.toString())}let h=c.play();h&&h.then&&h.catch(p=>{a&&sM(a,"audio",p.message,t),A.warning("audio element play warning",p.toString()),this.elementMap.has(t)&&p.name==="NotAllowedError"&&(A.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),jv(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),tM()}))})}updateTrack(e,t){let s=this.elementMap.get(e);s&&(s.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let s=this.elementMap.get(e);s&&(t=Math.max(0,Math.min(100,t)),s.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let s=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(s,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Nie.forEach(s=>{t.addEventListener(s,a=>{let c=this.elementStateMap.get(e),d=a.type==="pause"?"paused":a.type;if(A.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){let h=t==null?void 0:t.error;h&&A.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,d)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(s=>{A.debug("Auto resume audio element success")}).catch(s=>{A.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new Ve(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Om()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function As(){return function(e,t,s){let a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new _e(K.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",A);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];let p=a.apply(this,d);return p instanceof Ve?new Ve((f,_)=>{p.then(f).catch(_)}):p}),s}}class rM extends bs{constructor(t){super(),ce(this,"name","VideoProcessorDestination"),ce(this,"ID","0"),ce(this,"_source",void 0),ce(this,"videoContext",void 0),ce(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new _e(K.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new _e(K.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(en.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(en.ON_TRACK,void 0)}}class nM extends bs{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,s){super(),ce(this,"constraintsMap",new Map),ce(this,"statsRegistry",[]),ce(this,"usageRegistry",[]),ce(this,"trackId",void 0),ce(this,"direction",void 0),ce(this,"_chained",!1),this.trackId=t,this.direction=s}async getConstraints(){return await Cr(this,ai.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,s){var a;return A.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(s,t),es(this,ai.REQUEST_UPDATE_CONSTRAINTS,Array.from(Mn(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var s;if(this.constraintsMap.has(t))return A.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),es(this,ai.REQUEST_UPDATE_CONSTRAINTS,Array.from(Mn(s=this.constraintsMap).call(s)))}registerStats(t,s,a){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===s)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:s,cb:a})}unregisterStats(t,s){let a=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){let t=[];for(let{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{let h=d();t.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){A.error(new _e(K.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,s){this.usageRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:s})}unregisterUsage(t){let s=this.usageRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:s}of this.usageRegistry)try{let a=s();a instanceof Ve&&(a=await a),t.push(ns(ns({},a),{},{direction:this.direction}))}catch(a){A.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class iM extends bs{constructor(t){super(),ce(this,"name","AudioProcessorDestination"),ce(this,"ID","0"),ce(this,"inputTrack",void 0),ce(this,"inputNode",void 0),ce(this,"audioProcessorContext",void 0),ce(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new _e(K.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new _e(K.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(en.ON_TRACK,void 0),this.emit(en.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(en.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(en.ON_NODE,this.inputNode))}}class aM extends bs{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,s,a){super(),ce(this,"constraintsMap",new Map),ce(this,"statsRegistry",[]),ce(this,"audioContext",void 0),ce(this,"trackId",void 0),ce(this,"direction",void 0),ce(this,"usageRegistry",[]),ce(this,"_chained",!1),this.audioContext=t,this.trackId=s,this.direction=a}async getConstraints(){return Cr(this,ai.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,s){var a;return A.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(s,t),es(this,ai.REQUEST_UPDATE_CONSTRAINTS,Array.from(Mn(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var s;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),es(this,ai.REQUEST_UPDATE_CONSTRAINTS,Array.from(Mn(s=this.constraintsMap).call(s)))}registerStats(t,s,a){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===s)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:s,cb:a})}unregisterStats(t,s){let a=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){let t=[];for(let{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{let h=d();t.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){A.error(new _e(K.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,s){this.usageRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:s})}unregisterUsage(t){let s=this.usageRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:s}of this.usageRegistry)try{let a=s();a instanceof Ve&&(a=await a),t.push(ns(ns({},a),{},{direction:this.direction}))}catch(a){A.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class $0 extends bs{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ce(this,"context",void 0),ce(this,"processSourceNode",void 0),ce(this,"outputTrack",void 0),ce(this,"processedNode",void 0),ce(this,"clonedTrack",void 0),ce(this,"outputNode",void 0),this.outputNode=new Rie}setVolume(){}createOutputTrack(){throw new _e(K.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Rie{disconnect(){}connect(){}}function oM(e){return new Ve((t,s)=>{let a=!1,c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);let d=Br()?"canplay":"playing";c.addEventListener(d,()=>{let h=c.videoWidth,p=c.videoHeight;!h&&Cs()||(a=!0,c.srcObject=null,c.remove(),t([h,p]))}),c.srcObject=new MediaStream([e]),c.play().catch(Pv),setTimeout(()=>{a||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function zv(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let s=sa(e.encoderConfig);return s.width!=null&&(t.width=s.width),s.height!=null&&(t.height=s.height),!iL()&&s.frameRate&&(t.frameRate=s.frameRate),J2()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Cs()&&(t.frameRate={ideal:30,max:30}),t}function cM(e){let t={};return iL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,ec()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function lM(e){let t=cM(e);if(e.encoderConfig){let s=Wv(e.encoderConfig);t.channelCount=s.stereo?2:1,t.sampleRate=s.sampleRate,t.sampleSize=s.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Dv()&&(t.sampleRate=void 0),t}let Aie=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:s,width:a,height:c}=e.getMediaStreamTrackSettings(),{frameRate:d=s,width:h=a,height:p=c}=t;if(!d||!h||!p)return;h=eh(h),p=eh(p),d=eh(d);let{max:f,min:_}=function(T,U,k){let F=200*Math.pow(k/15,.6)*Math.pow(T*U/640/360,.75);return{min:Math.floor(F),max:Math.floor(4*F)}}(h,p,d),{bitrateMax:v,bitrateMin:b}=t||{};v||A.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(p,", fps: ").concat(d,"] => [brMax: ").concat(v,", brMin: ").concat(b,"]"));let{maxFramerate:w}=$("ENCODER_CONFIG_LIMIT");return w&&typeof w=="number"&&(d=Math.min(d,w)),{frameRate:d,bitrateMax:v||f,bitrateMin:b||_,scaleResolutionDownBy:1,scale:0}},dM=async(e,t,s)=>await(async(a,c,d)=>{let h=function(_){let v=[];for(let b=0;b<_.length;b+=2)v.push(parseInt(_.slice(b,b+2),16));return Uint8Array.from(v)}(xL(""+c+d)).slice(0,16),p=h.slice(0,12),f=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},f,a))})(e.buffer,t,s),X0=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new Ve((s,a)=>{t.toBlob(async c=>{if(t.remove(),c){let d=await uM(c);s({buffer:d,width:t.width,height:t.height})}else a(new _e(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},uM=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var hM,pM,mM,fM,gM,_M,vM,EM,yM,xM,bM,wM,SM,CM,TM,NM,RM,AM,ws,IM,DM,OM,jM,PM,kM,bo,LM,MM,FM,UM,VM,BM,WM,GM,HM,zM,KM,qM,YM,Nr;let Is=(hM=ct({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),pM=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),mM=As(),fM=th("LocalAudioTrack","_enabledMutex"),gM=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),_M=As(),vM=th("LocalAudioTrack","_enabledMutex"),EM=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),yM=As(),xM=As(),bM=As(),wM=ct({argsMap:e=>[e.getTrackId()]}),SM=As(),CM=ct({argsMap:e=>[e.getTrackId()]}),TM=As(),NM=ct({argsMap:e=>[e.getTrackId()]}),RM=ct({argsMap:(e,t)=>[e.getTrackId(),t.name]}),AM=ct({argsMap:e=>[e.getTrackId()]}),Rt((ws=class extends lh{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?un.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,s,a){super(e,s),ce(this,"trackMediaType",ch.AUDIO),ce(this,"_encoderConfig",void 0),ce(this,"_trackSource",void 0),ce(this,"metadata",[]),ce(this,"_enabled",!0),ce(this,"_volume",100),ce(this,"_useAudioElement",!0),ce(this,"_bypassWebAudio",!1),ce(this,"processor",void 0),ce(this,"_processorContext",void 0),ce(this,"_processorDestination",void 0),ce(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!a,this._trackSource=new $0,$("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),$("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),wr()&&!oi?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Qt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&un.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void A.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,es(this,Ye.NEED_REPLACE_TRACK,this).then(()=>{A.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{A.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!VL())throw new _e(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await un.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,s){return this._setEnabled(e,t,s)}async _setEnabled(e,t,s){if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await es(this,Ye.NEED_ENABLE_TRACK,this),A.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(a){throw s||(this._enabled=!1),A.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await es(this,Ye.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,A.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await es(this,Ye.NEED_MUTE_TRACK,this):await es(this,Ye.NEED_UNMUTE_TRACK,this))}getStats(){return Uc(()=>{A.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ri(this,Ye.GET_STATS)||ns({},W0)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ii.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ii.ON_AUDIO_BUFFER),this._source.on(ii.ON_AUDIO_BUFFER,s=>e(s))}play(){A.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(A.debug("[".concat(this.getTrackId(),"] start audio playback in element")),un.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){A.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?un.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];A.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&un.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await es(this,Ye.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ve.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new _e(K.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new _e(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(en.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await es(this,Ye.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await es(this,Ye.NEED_REPLACE_TRACK,this))}),e.on(en.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(en.ON_TRACK),e.removeAllListeners(en.ON_NODE)}bindProcessorContextEvents(e){e.on(ai.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(ai.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof $0&&(this._trackSource=new XL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new aM(this._source.context,this.getTrackId(),"local"),t=new iM(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ii.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(un.stop(this.getTrackId()),this._source.play()),es(this,Ye.NEED_REPLACE_MIXING_TRACK,this).then(()=>{A.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{A.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[hM],Object.getOwnPropertyDescriptor(ws.prototype,"setVolume"),ws.prototype),Rt(ws.prototype,"setPlaybackDevice",[pM,mM],Object.getOwnPropertyDescriptor(ws.prototype,"setPlaybackDevice"),ws.prototype),Rt(ws.prototype,"setEnabled",[fM,gM,_M],Object.getOwnPropertyDescriptor(ws.prototype,"setEnabled"),ws.prototype),Rt(ws.prototype,"setMuted",[vM,EM,yM],Object.getOwnPropertyDescriptor(ws.prototype,"setMuted"),ws.prototype),Rt(ws.prototype,"getStats",[xM],Object.getOwnPropertyDescriptor(ws.prototype,"getStats"),ws.prototype),Rt(ws.prototype,"setAudioFrameCallback",[bM],Object.getOwnPropertyDescriptor(ws.prototype,"setAudioFrameCallback"),ws.prototype),Rt(ws.prototype,"play",[wM,SM],Object.getOwnPropertyDescriptor(ws.prototype,"play"),ws.prototype),Rt(ws.prototype,"stop",[CM,TM],Object.getOwnPropertyDescriptor(ws.prototype,"stop"),ws.prototype),Rt(ws.prototype,"close",[NM],Object.getOwnPropertyDescriptor(ws.prototype,"close"),ws.prototype),Rt(ws.prototype,"pipe",[RM],Object.getOwnPropertyDescriptor(ws.prototype,"pipe"),ws.prototype),Rt(ws.prototype,"unpipe",[AM],Object.getOwnPropertyDescriptor(ws.prototype,"unpipe"),ws.prototype),ws),Gm=(IM=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),DM=As(),OM=th("MicrophoneAudioTrack","_enabledMutex"),jM=ct({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),PM=As(),kM=ct({argsMap:e=>[e.getTrackId()]}),Rt((bo=class extends Is{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,s,a){super(e,t.encoderConfig?Wv(t.encoderConfig):{},a,$("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ce(this,"_config",void 0),ce(this,"_deviceName","default"),ce(this,"_constraints",void 0),ce(this,"_originalConstraints",void 0),ce(this,"_enabled",!0),this._config=t,this._constraints=s,this._originalConstraints=s,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Ju()||g0())&&Xt.bindInterruptDetectorTrack(this)}async setDevice(e){if(A.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await li.getDeviceById(e),s={};s.audio=ns({},this._constraints),s.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let a=null;try{a=await ci(s,this.getTrackId())}catch(c){throw A.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await ci({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await li.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}A.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,s){if(t)return A.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),e),$("AUTO_RESET_AUDIO_ROUTE")&&(Br()||Zi())){let h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await es(this,Ye.NEED_DISABLE_TRACK,this)}catch(h){throw A.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}let c=ns({},this._constraints),d=li.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);let h=await ci({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await es(this,Ye.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),A.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}A.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ju()||g0())&&Xt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Br()||Zi())&&this._enabled&&!this._isClosed&&Xt.duringInterruption){let e=async()=>{Xt.off(fr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Xt.on(fr.IOS_INTERRUPTION_END,e)}else A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,s=li.searchDeviceIdByName(this._deviceName);if(s&&!t.deviceId&&(t.deviceId=s),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let a=await ci({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(ai.REQUEST_UPDATE_CONSTRAINTS,async(t,s,a)=>{try{let c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(ai.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[IM,DM],Object.getOwnPropertyDescriptor(bo.prototype,"setDevice"),bo.prototype),Rt(bo.prototype,"setEnabled",[OM,jM,PM],Object.getOwnPropertyDescriptor(bo.prototype,"setEnabled"),bo.prototype),Rt(bo.prototype,"close",[kM],Object.getOwnPropertyDescriptor(bo.prototype,"close"),bo.prototype),bo),Iie=(LM=ct({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),MM=As(),FM=ct({argsMap:e=>[e.getTrackId()]}),UM=As(),VM=ct({argsMap:e=>[e.getTrackId()]}),BM=As(),WM=ct({argsMap:e=>[e.getTrackId()]}),GM=As(),HM=ct({argsMap:e=>[e.getTrackId()]}),zM=As(),KM=ct({argsMap:e=>[e.getTrackId()]}),qM=ct({argsMap:e=>[e.getTrackId()]}),YM=As(),Rt((Nr=class extends Is{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,s,a){super(t.createOutputTrack(),s,a),ce(this,"source",void 0),ce(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ii.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(oh.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Qt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[LM,MM],Object.getOwnPropertyDescriptor(Nr.prototype,"startProcessAudioBuffer"),Nr.prototype),Rt(Nr.prototype,"pauseProcessAudioBuffer",[FM,UM],Object.getOwnPropertyDescriptor(Nr.prototype,"pauseProcessAudioBuffer"),Nr.prototype),Rt(Nr.prototype,"seekAudioBuffer",[VM,BM],Object.getOwnPropertyDescriptor(Nr.prototype,"seekAudioBuffer"),Nr.prototype),Rt(Nr.prototype,"resumeProcessAudioBuffer",[WM,GM],Object.getOwnPropertyDescriptor(Nr.prototype,"resumeProcessAudioBuffer"),Nr.prototype),Rt(Nr.prototype,"stopProcessAudioBuffer",[HM,zM],Object.getOwnPropertyDescriptor(Nr.prototype,"stopProcessAudioBuffer"),Nr.prototype),Rt(Nr.prototype,"close",[KM],Object.getOwnPropertyDescriptor(Nr.prototype,"close"),Nr.prototype),Rt(Nr.prototype,"setAudioBufferPlaybackSpeed",[qM,YM],Object.getOwnPropertyDescriptor(Nr.prototype,"setAudioBufferPlaybackSpeed"),Nr.prototype),Nr);class Ys extends Is{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=dh().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ts(8,"track-mix-")),ce(this,"trackList",void 0),ce(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(A.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):A.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){A.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Ov(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(s=>{s instanceof Ys?s.emit(dd.TRANSCEIVER_UPDATED,t):s._updateRtpTransceiver(t)}))}}class Die extends $L{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ii.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ce(this,"audioBuffer",void 0),ce(this,"sourceNode",void 0),ce(this,"startPlayTime",0),ce(this,"startPlayOffset",0),ce(this,"pausePlayTime",0),ce(this,"options",void 0),ce(this,"currentLoopCount",0),ce(this,"currentPlaybackSpeed",100),ce(this,"_currentState","stopped"),this.audioBuffer=t,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):A.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let $M=new Map;function XM(e,t){if(e.length===0||t.length===0)return 1/0;let s=S0(e),a=S0(t);return Math.floor(a/s)}class J0{get rendFrameRate(){let t=Math.max(1,XM(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Or.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(A.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var s;t!==this._videoState&&(this._videoState=t,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(t){ce(this,"trackId",void 0),ce(this,"config",void 0),ce(this,"onFirstVideoFrameDecoded",void 0),ce(this,"onFirstVideoFrameRender",void 0),ce(this,"onVideoStateChanged",void 0),ce(this,"freezeTimeCounterList",[]),ce(this,"renderFreezeAccTime",0),ce(this,"renderFreezeAccTime2",0),ce(this,"isKeepLastFrame",!1),ce(this,"isDestroyed",!1),ce(this,"timeUpdatedCount",0),ce(this,"freezeTime",0),ce(this,"playbackTime",0),ce(this,"lastTimeUpdatedTime",0),ce(this,"autoplayFailed",!1),ce(this,"videoTrack",void 0),ce(this,"videoElement",void 0),ce(this,"cacheVideoElement",void 0),ce(this,"internal",!1),ce(this,"_render_interframe_delays",[]),ce(this,"_render_interframe_delays_sizes",[]),ce(this,"_videoState",xo.VideoStateStopped),ce(this,"videoElementCheckInterval",void 0),ce(this,"videoElementFreezeTimeout",void 0),ce(this,"_videoElementStatus",Or.NONE),ce(this,"_isInPage",!0),ce(this,"isGettingVideoDimensions",!1),ce(this,"startGetVideoDimensions",()=>{let s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return A.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),ce(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Xt.curState==="running"&&(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat($2())),rL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ce(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":s.type==="play"&&A.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Or.PLAYING;break;case"loadeddata":if(this.videoState=xo.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Or.CANPLAY;break;case"stalled":this.videoElementStatus=Or.STALLED;break;case"suspend":this.videoElementStatus=Or.SUSPEND;break;case"pause":this.videoElementStatus=Or.PAUSED,Br()||Zi()||wr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Or.WAITING;break;case"abort":this.videoElementStatus=Or.ABORT;break;case"ended":this.videoElementStatus=Or.ENDED;break;case"emptied":this.videoElementStatus=Or.EMPTIED;break;case"error":{let a=this.videoElement.error;a&&(this.videoElementStatus=Or.ERROR,A.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{let a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);let c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,wo.lastVisibleTime<wo.lastHiddenTime||d<wo.lastHiddenTime||d<wo.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>$("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;let h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ce(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat($2())),rL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Xt.on(fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xt.on(fr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let s=this.videoElement.play();s&&s.catch&&s.catch(c=>{t&&sM(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(A.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):A.warning("[".concat(this.trackId,"] play warning: "),c)});let a=At();if((a.name==="Safari"&&Number(a.version)===15||Ju())&&s&&s.then){let c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let s=t.getContext("2d");if(!s)return A.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,t.width,t.height);let a=s.getImageData(0,0,t.width,t.height);return t.remove(),a}async getCurrentFrameToUint8Array(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;let c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new Ve((d,h)=>{a.toBlob(async p=>{if(a.remove(),p){let f=await uM(p);d({buffer:f,width:a.width,height:a.height})}else h(new _e(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,s<0?.1:s>1?1:s)})):await X0(t)}destroy(){this.isDestroyed=!0,Xt.off(fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xt.off(fr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=xo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Or.INIT,!this.videoElementCheckInterval&&(JM.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(d){return d!==document.body&&document.body.contains(d)}(this.videoElement)},1e3),$("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,s;let d,h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===xo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=xo.VideoStateFrozen:document.addEventListener("visibilitychange",h))},f=(_,v)=>{if(this.videoElementStatus===Or.PLAYING){if(d){let T=v.presentationTime-d.presentationTime,U=v.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(U),this._render_interframe_delays.push(T);let k=S0(this._render_interframe_delays_sizes),F=k-this._render_interframe_delays_sizes[0];if(k>30&&F>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===xo.VideoStateStarting&&(this.videoState=xo.VideoStateDecoding),this.videoState===xo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,$("VIDEO_FREEZE_DURATION"))),T<$("VIDEO_FREEZE_DURATION")&&this.videoState===xo.VideoStateFrozen&&(this.videoState=xo.VideoStateDecoding),T>$("VIDEO_FREEZE_DURATION")&&wo.lastVisibleTime>=wo.lastHiddenTime&&d.timestamp>wo.lastVisibleTime&&d.timestamp>wo.lastHiddenTime){let z=Math.min(66,XM(this._render_interframe_delays_sizes,this._render_interframe_delays)),Y=Math.max(0,T-(U-1)*z);this.renderFreezeAccTime2+=Y>z?Y:0,this.renderFreezeAccTime+=T}}d=ns(ns({},v),{},{timestamp:_})}else this.isSkipCalcRenderFreezeTime()&&(d=ns(ns({},v),{},{timestamp:_}));var b,w;$("ENABLE_VIDEO_FRAME_CALLBACK")&&((b=(w=this.videoElement).requestVideoFrameCallback)===null||b===void 0||b.call(w,f))};(t=(s=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(s,f)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Dv()&&!$("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let a=At();a.name==="Safari"&&Number(a.version)===15||Ju()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Cs()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Cs()&&this.videoElement.load());let c=this.videoElement.play();c!==void 0&&c.catch(d=>{A.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){JM.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Or.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Or.DESTROYED||this.internal}handleAutoPlayFailed(){let t=s=>{s.preventDefault(),this.videoElement.play().then(()=>{A.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{A.error(a)}),this.autoplayFailed=!1,Om()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Om()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),tM()}}let JM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Q0 extends J0{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),ce(this,"container",void 0),ce(this,"slot",void 0),this.slot=t.element,this.internal=s,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let s=t.element;var a;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(a=this.slot)===null||a===void 0||a.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,a):await X0(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",$("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var QM,ZM,eF,tF,sF,rF,nF,iF,aF,oF,cF,lF,dF,uF,hF,pF,mF,fF,gF,_F,vF,EF,yF,xF,bF,wF,SF,CF,wt,TF,NF,RF,AF,IF,DF,OF,jF,ui;let as=(QM=ct({argsMap:(e,t,s)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),ZM=As(),eF=ct({argsMap:e=>[e.getTrackId()]}),tF=th("LocalVideoTrack","_enabledMutex"),sF=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),rF=As(),nF=th("LocalVideoTrack","_enabledMutex"),iF=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),aF=As(),oF=ct({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),cF=As(),lF=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),dF=As(),uF=As(),hF=ct({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),pF=As(),mF=As(),fF=As(),gF=ct({argsMap:e=>[e.getTrackId()]}),_F=As(),vF=As(),EF=As(),yF=As(),xF=As(),bF=ct({argsMap:(e,t)=>[e.getTrackId(),t.name]}),wF=ct({argsMap:e=>[e.getTrackId()]}),SF=ct({argsMap:e=>[e.getTrackId()]}),CF=ct({argsMap:(e,t,s)=>[e.getTrackId(),t.label,s]}),wt=class rz extends lh{get videoHeight(){if(wr()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(wr()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Or.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,s,a,c,d,h){if(super(t,d),ce(this,"trackMediaType",ch.VIDEO),ce(this,"_player",void 0),ce(this,"isUseScaleResolutionDownBy",!1),ce(this,"_videoVisibleTimer",null),ce(this,"_previousVideoVisibleStatus",void 0),ce(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ce(this,"_encoderConfig",void 0),ce(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ce(this,"_optimizationMode",void 0),ce(this,"_saveEncodeBitrateRatio",1),ce(this,"_videoHeight",void 0),ce(this,"_videoWidth",void 0),ce(this,"_forceBitrateLimit",void 0),ce(this,"_enabled",!0),ce(this,"_processorDestination",void 0),ce(this,"_processorContext",void 0),wr()){let{width:p,height:f}=t.getSettings();this._videoWidth=p,this._videoHeight=f}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],s&&this._hints.indexOf(Zt.CUSTOM_TRACK)!==-1?this._encoderConfig=Es(s):this._encoderConfig=s,this._hints.indexOf(Zt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(u0(Lt.CHROME,115)&&Av().indexOf("Windows")!==-1){let p=function(f,_){if("VideoFrame"in window&&"TransformStream"in window&&jt().supportWebRTCInsertableStream){let v=new MediaStreamTrackProcessor(f),b=new MediaStreamTrackGenerator({kind:"video"}),w,T,U=Date.now(),k=()=>{F&&(clearInterval(F),F=void 0),w&&(w.close(),w=void 0),f.stop(),T=void 0,b.removeEventListener("ended",k)},F=window.setInterval(()=>{if(T&&w&&Date.now()-U>1e3)try{b.readyState==="live"?T.enqueue(w.clone()):k()}catch{k()}},1e3),z=new TransformStream({transform:(Y,X)=>{b.readyState==="live"?(T=X,U=Date.now(),w===void 0?(w=Y,X.enqueue(Y.clone())):(X.enqueue(w),w=Y)):Y.close()}});return b.addEventListener("ended",k),v.readable.pipeThrough(z).pipeTo(b.writable),b}}(t);p&&(A.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}s&&this._hints.indexOf(Zt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new nM(this.getTrackId(),"local"),this._processorDestination=new rM(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let c=document.getElementById(t);c?t=c:(A.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}A.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));let a=ns(ns(ns({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(a):(t instanceof HTMLVideoElement?this._player=new J0(a):this._player=new Q0(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let c=this.getVideoElementVisibleStatus();this.safeEmit(oh.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,A.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await es(this,Ye.NEED_DISABLE_TRACK,this)}catch(a){throw A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void A.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await es(this,Ye.NEED_ENABLE_TRACK,this)}catch(a){throw A.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}A.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,A.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await es(this,Ye.NEED_MUTE_TRACK,this):await es(this,Ye.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),A.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await es(this,Ye.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(A)}}}async setEncoderConfiguration(t,s){if(!this._enabled)throw new _e(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=sa(t),$("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let a=zv({encoderConfig:t});(wr()||Br()||Zi())&&(a.deviceId=void 0),A.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){let d=new _e(K.UNEXPECTED_ERROR,c.toString());throw A.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await es(this,Ye.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(A)}}getStats(){return Uc(()=>{A.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ri(this,Ye.GET_STATS)||ns({},G0)}async setBeautyEffect(t){A.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,s):await X0(t)}async findClosestProfile(){let{width:t,height:s,frameRate:a}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},p=eh(this._videoWidth||t||c||0),f=eh(this._videoHeight||s||d||0),_=function(v,b,w){if(!Array.isArray($("VIDEO_ENCODER_CONFIG_LIST"))||$("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let T=Math.min(v,b);return!(T>=480)&&ns(ns({},$("VIDEO_ENCODER_CONFIG_LIST").find(U=>U.height>T)),{},{frameRate:w})}(p,f,eh(a||h||15));if(_)return A.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(p,"x").concat(f," => ").concat(JSON.stringify(_))),this.setEncoderConfiguration(_)}async setBitrateLimit(t){A.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void A.error(K.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let s=this._optimizationMode;try{this._optimizationMode=t,await es(this,Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,A.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}A.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return A.error(K.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,A.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){oM(this._originMediaStreamTrack).then(t=>{let[s,a]=t;this._videoHeight=a,this._videoWidth=s}).catch(Pv)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new _e(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");A.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=sa(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await es(this,Ye.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(A)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!t||!s||!a)return;let{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){let{max:h,min:p}=function(f,_,v,b,w){let T=$("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:b,max:w};if(w===void 0){let U=Math.floor(200*Math.pow(v/15,.6)*Math.pow(f*_/640/360,.75));w=T==="STANDARD_BITRATE"?4*U:2*U,b=b??U}else b=b??Math.floor(w/10);return{min:b,max:w}}(t,s,a,d,c);if(this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=h,$("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){let[f,_]=function(v,b,w){let T=4*Math.floor(2e5*Math.pow(w/15,.6)*Math.pow(v*b/230400,.75)),U=v*b,k=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),F=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),z=Mn(k).call(k).next().value,Y=1;if(k.has(U))z=k.get(U);else{var X;let Ae=Ql(X=Array.from(k.entries())).call(X,(bt,dt)=>{let[Wt]=bt,[Ut]=dt;return Wt-Ut}),yt=Ae.find(bt=>{let[dt]=bt;return dt>U});if(yt){let bt=Ae.indexOf(yt);if(bt>0){let dt=Ae[bt-1],Wt=(U-dt[0])/(yt[0]-dt[0]);z=dt[1]+Wt*(yt[1]-dt[1])}else z=yt[1]}else z=Ae[Ae.length-1][1]}if(F.has(U))Y=F.get(U);else{var re;let Ae=Ql(re=Array.from(F.entries())).call(re,(bt,dt)=>{let[Wt]=bt,[Ut]=dt;return Wt-Ut}),yt=Ae.find(bt=>{let[dt]=bt;return dt>U});if(yt){let bt=Ae.indexOf(yt);if(bt>0){let dt=Ae[bt-1],Wt=(U-dt[0])/(yt[0]-dt[0]);Y=dt[1]+Wt*(yt[1]-dt[1])}else Y=yt[1]}else Y=Ae[Ae.length-1][1]}let te=$("VIDEO_NEW_BITRATE_RATIO");te&&te>0&&(z=te/100);let Z=Math.floor(T*z),de=Math.floor(65e4*Math.pow(v*b/230400,.5)*Math.pow(w/15,.69)),xe=Z,Se=$("VIDEO_STANDARD_BITRATE_VERSION");return Se&&Se>0&&(Se===1?xe=T:Se===2?xe=Z:Se===3&&(xe=de)),[Math.floor(xe/1e3),Y]}(t,s,a);this._encoderConfig.bitrateMax=f,this._encoderConfig.bitrateMin=p?Math.min(p,f):f,this._saveEncodeBitrateRatio=_,A.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else A.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(p,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,s;let a=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){let p=cL.checkOneElementVisible(d),f=Object.assign({},p);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;let _=Qe.reportApiInvoke(null,{tag:vs.TRACER,name:Os.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(a){throw new _e(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new _e(K.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=ns(ns({},a),sa(t))),a=ad(a);let c=ts(8,"track-video-cloned-"),d=new rz(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,ad(this._scalabilityMode),this._optimizationMode,c,ad(this._hints));return t&&a&&d.setEncoderConfiguration(a),A.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(t,s){if(!(t instanceof MediaStreamTrack))throw new _e(K.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new _e(K.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Uc(()=>{Qe.reportApiInvoke(null,{name:Os.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:vs.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!$("ENABLE_VIDEO_SEI")||!$("ENABLE_ENCODED_TRANSFORM"))return void A.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new _e(K.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let s=this.getRTCRtpTransceiver();if(!s)return void A.warning("Video track is not published, SEI can not be send");let a=s.sender.getParameters();if(a.codecs.length===0)return;let c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",t):A.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(en.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await es(this,Ye.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await es(this,Ye.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(en.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ai.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ai.REQUEST_CONSTRAINTS)}},Rt(wt.prototype,"play",[QM,ZM],Object.getOwnPropertyDescriptor(wt.prototype,"play"),wt.prototype),Rt(wt.prototype,"stop",[eF],Object.getOwnPropertyDescriptor(wt.prototype,"stop"),wt.prototype),Rt(wt.prototype,"setEnabled",[tF,sF,rF],Object.getOwnPropertyDescriptor(wt.prototype,"setEnabled"),wt.prototype),Rt(wt.prototype,"setMuted",[nF,iF,aF],Object.getOwnPropertyDescriptor(wt.prototype,"setMuted"),wt.prototype),Rt(wt.prototype,"setSaveEncodeBitrateRatio",[oF,cF],Object.getOwnPropertyDescriptor(wt.prototype,"setSaveEncodeBitrateRatio"),wt.prototype),Rt(wt.prototype,"setEncoderConfiguration",[lF,dF],Object.getOwnPropertyDescriptor(wt.prototype,"setEncoderConfiguration"),wt.prototype),Rt(wt.prototype,"getStats",[uF],Object.getOwnPropertyDescriptor(wt.prototype,"getStats"),wt.prototype),Rt(wt.prototype,"setBeautyEffect",[hF,pF],Object.getOwnPropertyDescriptor(wt.prototype,"setBeautyEffect"),wt.prototype),Rt(wt.prototype,"getCurrentFrameData",[mF],Object.getOwnPropertyDescriptor(wt.prototype,"getCurrentFrameData"),wt.prototype),Rt(wt.prototype,"getCurrentFrameImage",[fF],Object.getOwnPropertyDescriptor(wt.prototype,"getCurrentFrameImage"),wt.prototype),Rt(wt.prototype,"findClosestProfile",[gF,_F],Object.getOwnPropertyDescriptor(wt.prototype,"findClosestProfile"),wt.prototype),Rt(wt.prototype,"setBitrateLimit",[vF],Object.getOwnPropertyDescriptor(wt.prototype,"setBitrateLimit"),wt.prototype),Rt(wt.prototype,"setOptimizationMode",[EF],Object.getOwnPropertyDescriptor(wt.prototype,"setOptimizationMode"),wt.prototype),Rt(wt.prototype,"setScalabiltyMode",[yF],Object.getOwnPropertyDescriptor(wt.prototype,"setScalabiltyMode"),wt.prototype),Rt(wt.prototype,"updateMediaStreamTrackResolution",[xF],Object.getOwnPropertyDescriptor(wt.prototype,"updateMediaStreamTrackResolution"),wt.prototype),Rt(wt.prototype,"pipe",[bF],Object.getOwnPropertyDescriptor(wt.prototype,"pipe"),wt.prototype),Rt(wt.prototype,"unpipe",[wF],Object.getOwnPropertyDescriptor(wt.prototype,"unpipe"),wt.prototype),Rt(wt.prototype,"close",[SF],Object.getOwnPropertyDescriptor(wt.prototype,"close"),wt.prototype),Rt(wt.prototype,"replaceTrack",[CF],Object.getOwnPropertyDescriptor(wt.prototype,"replaceTrack"),wt.prototype),wt),Kv=(TF=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),NF=As(),RF=th("CameraVideoTrack","_enabledMutex"),AF=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),IF=As(),DF=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),OF=As(),jF=ct({argsMap:e=>[e.getTrackId()]}),ui=class nz extends as{get __className__(){return"CameraVideoTrack"}constructor(t,s,a,c,d,h){super(t,sa(s.encoderConfig),c,d,h),ce(this,"_config",void 0),ce(this,"_originalConstraints",void 0),ce(this,"_constraints",void 0),ce(this,"_enabled",!0),ce(this,"_deviceName","default"),ce(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ju()||g0())&&!function(){let p=At();if(p.os!==sr.IOS||!p.osVersion)return!1;let f=p.osVersion.split(".");return Number(f[0])===15&&Number(f[1])>=2}()&&nL()&&this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=t.label,this._encoderConfig=sa(this._config.encoderConfig),Xt.on(fr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Xt.on(fr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(A.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let s=await li.getDeviceById(t),a={};a.video=ns({},this._constraints),a.video.deviceId={exact:t},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await ci(a,this.getTrackId())}catch(d){throw A.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await ci({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{let s=await li.getDeviceById(t);this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}A.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){A.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let s={video:ns(ns({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await ci(s,this.getTrackId())}catch(c){throw A.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await ci({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=ns({},s.video),A.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let a=await ci({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await es(this,Ye.NEED_ENABLE_TRACK,this)}catch(a){throw A.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),A.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await es(this,Ye.NEED_DISABLE_TRACK,this)}catch(a){throw A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}A.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,s){if(!this._enabled)throw new _e(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=sa(t),$("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let a=Es(this._config);a.encoderConfig=t;let c=zv(a);(wr()||Br()||Zi())&&(c.deviceId=void 0),A.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){let h=new _e(K.UNEXPECTED_ERROR,d.toString());throw A.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(Zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await es(this,Ye.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(A)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Br()||Zi())&&this._enabled&&!this._isClosed&&Xt.duringInterruption){let t=async()=>{Xt.off(fr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Xt.on(fr.IOS_INTERRUPTION_END,t)}else A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oh.TRACK_ENDED)}async renewMediaStreamTrack(t){let s=t||this._constraints,a=li.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){let c=await ci({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Xt.off(fr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Xt.off(fr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=ns(ns({},a),sa(t))),a=ad(a);let c=ts(8,"track-cam-cloned-"),d=new nz(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,ad(ns(ns({},this._config),{},{encoderConfig:a})),ad(this._constraints),ad(this._scalabilityMode),this._optimizationMode,c);return t&&a&&d.setEncoderConfiguration(a),A.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(ai.REQUEST_UPDATE_CONSTRAINTS,async(t,s,a)=>{try{let c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}),this.processorContext.on(ai.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Rt(ui.prototype,"setDevice",[TF,NF],Object.getOwnPropertyDescriptor(ui.prototype,"setDevice"),ui.prototype),Rt(ui.prototype,"setEnabled",[RF,AF,IF],Object.getOwnPropertyDescriptor(ui.prototype,"setEnabled"),ui.prototype),Rt(ui.prototype,"setEncoderConfiguration",[DF,OF],Object.getOwnPropertyDescriptor(ui.prototype,"setEncoderConfiguration"),ui.prototype),Rt(ui.prototype,"close",[jF],Object.getOwnPropertyDescriptor(ui.prototype,"close"),ui.prototype),ui);function Z0(e,t,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=ns(ns({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(t.contentHint=s.optimizationMode,t.contentHint===s.optimizationMode?A.debug("[".concat(e,"] set content hint to"),s.optimizationMode):A.debug("[".concat(e,"] set content hint failed")))):A.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var PF,kF,LF,MF,Ni,FF,UF,VF,BF,WF,GF,qr;class HF extends KL{getUserId(){return this._userId}constructor(t,s,a,c){super(t,"track-".concat(t.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(ts(5,""))),ce(this,"_userId",void 0),ce(this,"_uintId",void 0),ce(this,"_isDestroyed",!1),ce(this,"store",void 0),ce(this,"processor",void 0),ce(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,A.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let hh=(PF=ct({argsMap:(e,t,s)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),kF=ct({argsMap:e=>[e.getTrackId()]}),LF=ct({argsMap:(e,t)=>[e.getTrackId(),t.name]}),MF=ct({argsMap:e=>[e.getTrackId()]}),Rt((Ni=class extends HF{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Or.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,s,a,c){super(e,t,s,a),ce(this,"_videoVisibleTimer",null),ce(this,"_previousVideoVisibleStatus",void 0),ce(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ce(this,"trackMediaType",ch.VIDEO),ce(this,"_videoWidth",void 0),ce(this,"_videoHeight",void 0),ce(this,"_player",void 0),ce(this,"_prePlayer",void 0),ce(this,"processorDestination",void 0),ce(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new nM(this.getTrackId(),"remote"),this.processorDestination=new rM(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Uc(()=>{A.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ri(this,Ye.GET_STATS)||ns({},HL)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Ti.PLAY_START),typeof e=="string"){let a=document.getElementById(e);a?e=a:(A.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}A.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let s=ns(ns({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(s);else{let a=!1,c=!1;e instanceof HTMLVideoElement?(this._player=new J0(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,a=this._player.videoState>0,this._player.updateConfig(s)):this._player=new Q0(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ti.FIRST_FRAME_DECODED),c&&this.safeEmit(Ti.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Ti.VIDEO_STATE_CHANGED,d)},a&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let a=this.getVideoElementVisibleStatus();this.safeEmit(Ti.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Ti.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,A.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){oM(this._originMediaStreamTrack).then(e=>{let[t,s]=e;this._videoHeight=s,this._videoWidth=t}).catch(Pv)}_updatePlayerSource(){A.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let s=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),a={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){let h=cL.checkOneElementVisible(c),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;let f=Qe.reportApiInvoke(null,{tag:vs.TRACER,name:Os.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(s){throw new _e(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new _e(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(en.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(en.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(dd.SEI_RECEIVED,e)}}).prototype,"play",[PF],Object.getOwnPropertyDescriptor(Ni.prototype,"play"),Ni.prototype),Rt(Ni.prototype,"stop",[kF],Object.getOwnPropertyDescriptor(Ni.prototype,"stop"),Ni.prototype),Rt(Ni.prototype,"pipe",[LF],Object.getOwnPropertyDescriptor(Ni.prototype,"pipe"),Ni.prototype),Rt(Ni.prototype,"unpipe",[MF],Object.getOwnPropertyDescriptor(Ni.prototype,"unpipe"),Ni.prototype),Ni),ph=(FF=ct({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),UF=ct({argsMap:(e,t)=>[e.getTrackId(),t]}),VF=ct({argsMap:e=>[e.getTrackId()]}),BF=ct({argsMap:e=>[e.getTrackId()]}),WF=ct({argsMap:(e,t)=>[e.getTrackId(),t.name]}),GF=ct({argsMap:e=>[e.getTrackId()]}),Rt((qr=class extends HF{get isPlaying(){return this._useAudioElement?un.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,s,a){super(e,t,s,a),ce(this,"trackMediaType",ch.AUDIO),ce(this,"_source",void 0),ce(this,"_useAudioElement",!0),ce(this,"_volume",100),ce(this,"processorContext",void 0),ce(this,"processorDestination",void 0),ce(this,"_played",!1),ce(this,"_bypassWebAudio",!1),$("DISABLE_WEBAUDIO")?(this._source=new $0,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new XL(e,!0),$("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ii.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ti.FIRST_FRAME_DECODED)}),this.processorContext=new aM(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new iM(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ii.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ii.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ii.ON_AUDIO_BUFFER),this._source.on(ii.ON_AUDIO_BUFFER,s=>e(s))}setVolume(e){this._volume=e,this._useAudioElement?un.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!VL())throw new _e(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await un.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Uc(()=>{A.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ri(this,Ye.GET_STATS)||ns({},GL)}play(){A.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(A.debug("[".concat(this.getTrackId(),"] use audio element to play")),un.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){A.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?un.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];A.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&un.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new _e(K.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new _e(K.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new _e(K.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(en.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(en.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(en.ON_TRACK),this.processorDestination.removeAllListeners(en.ON_NODE)}}).prototype,"setVolume",[FF],Object.getOwnPropertyDescriptor(qr.prototype,"setVolume"),qr.prototype),Rt(qr.prototype,"setPlaybackDevice",[UF],Object.getOwnPropertyDescriptor(qr.prototype,"setPlaybackDevice"),qr.prototype),Rt(qr.prototype,"play",[VF],Object.getOwnPropertyDescriptor(qr.prototype,"play"),qr.prototype),Rt(qr.prototype,"stop",[BF],Object.getOwnPropertyDescriptor(qr.prototype,"stop"),qr.prototype),Rt(qr.prototype,"pipe",[WF],Object.getOwnPropertyDescriptor(qr.prototype,"pipe"),qr.prototype),Rt(qr.prototype,"unpipe",[GF],Object.getOwnPropertyDescriptor(qr.prototype,"unpipe"),qr.prototype),qr),wo=new class extends bs{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ce(this,"_lastHiddenTime",0),ce(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),A.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class zF extends bs{constructor(t,s){super(),ce(this,"trackMediaType",ch.DATA),ce(this,"_version",1),ce(this,"_type",3),ce(this,"_config",void 0),ce(this,"_originDataChannel",void 0),ce(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ce(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),ce(this,"_datachannelEventMap",new Map),this._config=t,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return $("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,s;return(t=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,s;return(t=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ve((t,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let a=setTimeout(()=>{var c;s(new _e(K.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new _e(K.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new _e(K.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Gv.OPEN,Gv.CLOSE,Gv.ERROR].forEach(s=>{let a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),t.addEventListener(s,a)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[a,c]=s;t.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class Oie extends zF{constructor(t){super(t),ce(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void($("SHOW_DATASTREAM2_LOG")&&A.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(Gv.MESSAGE,d)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class jie extends zF{send(t){if(this._originDataChannel){let s=t;s=this._dataStreamPacketHandler.serialize(t);let a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function qv(){let e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>K_.revokeObjectURL(e),0),new Worker(K_.createObjectURL(e))}let KF=71,eC=1,tC=2,sC=1,qF=2;var Wc=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Wc||{});function rC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=e.getUint8(0);if(s!==KF)return;let a=e.getUint16(1),c=eC+tC+a,d=new Uint8Array(e.byteLength-c);d.set(new Uint8Array(e.buffer,c,e.byteLength-c));let h={m:s,tlvLen:a,tlv:[],frame:d},p=eC+tC;for(;p<c;){let f=e.getUint8(p),_=e.getUint16(p+sC),v=sC+qF;if(f===Wc.AUDIO_LEVEL){let b=e.getUint8(p+v);for(let w=1;w<_;w++)b=b<<8|e.getUint8(p+v+w);h.tlv.push({tag:f,length:_,value:t?127^b>>1:127&b})}else if(f===Wc.METADATA||f===Wc.AUDIO_64_BIT_PTS){let b=new Uint8Array(_);for(let w=0;w<_;w++)b[w]=e.getUint8(p+v+w);h.tlv.push({tag:f,length:_,value:b})}p+=v+_}return h}let Yv=new Map,$v=127,pd=1e-10,nC=139/13,Xv=new Map;function iC(e,t,s){let a="".concat(e,"-").concat(t,"-").concat(s),c=0;return Xv.has(a)?c=Xv.get(a):(c=Math.log(function(d,h){let p=d-h;h<p&&(h=p);let f=1;for(let _=d,v=1;_>h;_--,v++)f=f*_/v;return f}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(s)+s*e,Xv.set(a,c)),c<pd&&(c=pd),c}function YF(e,t,s){let a=t.length,c=e.length/a,d=!1;for(let h=0,p=0;h<a;h++){let f=0;for(let _=p+c;p<_;p++)e[p]>s&&f++;t[h]!==f&&(t[h]=f,d=!0)}return d}window.cache=Xv;let Pie=0;class $F{constructor(t){ce(this,"id",void 0),ce(this,"immediates",[]),ce(this,"lastNonSilence",-1),ce(this,"immediateSpeechActivityScore",pd),ce(this,"lastLevelChangedTime",Date.now()),ce(this,"levels",[]),ce(this,"longs",[]),ce(this,"longSpeechActivityScore",pd),ce(this,"mediums",[]),ce(this,"mediumSpeechActivityScore",pd),ce(this,"minLevel",0),ce(this,"nextMinLevel",0),ce(this,"nextMinLevelWindowLength",0),ce(this,"energyScore",0),this.id=t||"".concat(Pie++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,s=this.levels,a=this.minLevel+nC,c=!1;for(let d=0;d<t.length;++d){let h=s[d];h<a&&(h=0);let p=Math.floor(h/nC);t[d]!==p&&(t[d]=p,c=!0)}return c}computeLongs(){return YF(this.mediums,this.longs,4)}computeMediums(){return YF(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=iC(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=iC(this.longs[0],10,47),this.longSpeechActivityScore>pd&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=iC(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(AD(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=t;return t<0&&(a=0),t>$v&&(a=$v),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+nC?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>$v&&(s=$v),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class kie{constructor(t){ce(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let s=this.algorithm.runInDecisionMaker(this);s<=0?t=!0:setTimeout(this.execute.bind(this),s)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class aC{constructor(t,s,a){ce(this,"isDominant",void 0),ce(this,"energyRanking",void 0),ce(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=s,this.energyScore=a}}class Lie extends bs{constructor(t){super(),ce(this,"dominantId",null),ce(this,"lastDecisionTime",0),ce(this,"lastLevelChangedTime",0),ce(this,"lastLevelIdleTime",0),ce(this,"relativeSpeechActivities",[]),ce(this,"speakers",new Map),ce(this,"enableSilence",!1),ce(this,"timeoutToSilenceInterval",0),ce(this,"decisionMaker",null),ce(this,"loudest",[]),ce(this,"numLoudestToTrack",3),ce(this,"energyExpireTimeMs",250),ce(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(s=>s.id===t)}levelChanged(t,s){let a=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());let d=c.levelChanged(s,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(t){t.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(t){let s=this.speakers.get(t);return s||(s=new $F(t),this.speakers.set(t,s),this.maybeStartDecisionMaker()),s}updateLoudestList(t,s,a){let c=t.id===this.dominantId;if(s<0){let f=0;for(;f<this.loudest.length&&this.loudest[f]!==t;)++f;return new aC(c,f,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new aC(c,0,t.energyScore);let d=a-this.energyExpireTimeMs,h=0;for(;h<this.loudest.length;){let f=this.loudest[h];if(f.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(f.id!==t.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let p=0;for(;p<this.loudest.length&&!(this.loudest[p].energyScore<t.energyScore);)++p;return p<this.numLoudestToTrack&&(this.loudest.splice(p,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new aC(c,p,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new kie(this),this.decisionMaker.execute())}makeDecision(t){let s=null,a=null,c=this.speakers.size,d=null;if(c===0)d=null;else if(c===1){var h;let p=Mn(h=this.speakers).call(h).next().value;this.enableSilence&&p&&(d=p.id,p.evaluateSpeechActivityScores(t),t-p.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let p=this.dominantId==null?null:this.speakers.get(this.dominantId);if(p==null){let v=this.speakers.entries().next();v.value&&(d=v.value[0],p=v.value[1])}else d=p.id;p==null||p.evaluateSpeechActivityScores(t);let f=this.relativeSpeechActivities,_=2;for(let v of this.speakers.entries()){let[b,w]=v;if(w===p)continue;w.evaluateSpeechActivityScores(t);for(let F=0;F<f.length;++F){let z=p==null?pd:p.getSpeechActivityScore(F);f[F]=Math.log(w.getSpeechActivityScore(F)/z)}let T=f[0],U=f[1],k=f[2];T>3&&U>2&&k>0&&U>_&&(_=U,d=b)}this.enableSilence&&p!=null&&d===p.id&&t-p.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){let t=Date.now(),s=300-(t-this.lastLevelIdleTime),a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):a=s;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(t){let s=[];for(let c of Mn(a=this.speakers).call(a)){var a;let d=t-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}let mh=new Map,Fa=null,Jv=null,XF=3,md=[],Ua=new Map,Qv=new Map;class Mie{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,s){ce(this,"id",void 0),ce(this,"track",void 0),ce(this,"score",0),ce(this,"active",!0),ce(this,"muted",!1),ce(this,"timer",0),ce(this,"actives",0),ce(this,"inactives",0),this.id=t,this.track=s,this.setActive(Ua.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:s,inactives:a}=function(){let c=[],d=[];return Array.from(Mn(Ua).call(Ua)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(s.length>3){let c;s.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=function(s){let a;return Array.from(Mn(Ua).call(Ua)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=function(s){let a;return Array.from(Mn(Ua).call(Ua)).forEach(c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Zv;function JF(e){let t=Ua.get(e);t&&(Ua.delete(e),t.clearTimer())}let eE=new Map,Fie=new Map,oC="video/h264",cC="video/h265";function QF(e,t,s){let a=new Uint8Array(e,t,s),c=[],d=0;for(;c.length<s;)d+3<s&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}function ZF(e){let t=e.length,s=[],a=0;for(;a<t;)a+2<t&&e[a]===0&&e[a+1]===0&&(e[a+2]===0||e[a+2]===1||e[a+2]===2||e[a+2]===3)?(s.push(e[a],e[a+1],3,e[a+2]),a+=3):(s.push(e[a]),a++);return new Uint8Array(s)}function eU(e){if(e.length<5)return"";let t=-1;for(let c=0;c<e.length-3;c++){if(e[c]===0&&e[c+1]===0&&e[c+2]===1){t=c;break}if(c<e.length-4&&e[c]===0&&e[c+1]===0&&e[c+2]===0&&e[c+3]===1){t=c;break}}if(t===-1)return"";let s=t+(e[t+2]===0?4:3);if(s>=e.length)return"";let a=e[s];return 128&a?"":(a>>1&63)>=32||s+1<e.length&&!(248&e[s+1])?cC:(31&a)<=31?oC:""}let tE=new Map,Hm=new Map;(function(){let e=At();mr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),mr.getStreamFromExtension=e.name===Lt.CHROME&&Number(e.version)>34,mr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,s=!1;try{t.addTransceiver("audio"),s=!0}catch{}return t.close(),s}(),mr.supportMinBitrate=e.name===Lt.CHROME||e.name===Lt.EDGE,mr.supportSetRtpSenderParameters=function(){let t=At();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!tc()||!(!wr()&&!Iv())||t.name===Lt.FIREFOX&&Number(t.version)>=64)}(),e.name===Lt.SAFARI&&(Number(e.version)>=14?mr.supportDualStream=!0:mr.supportDualStream=!1),mr.webAudioMediaStreamDest=function(){let t=At();return!(t.name===Lt.SAFARI&&Number(t.version)<12)}(),mr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",mr.supportWebGL=typeof WebGLRenderingContext<"u",mr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,tc()||(mr.webAudioWithAEC=!0),mr.supportShareAudio=function(){let t=At();return(t.os===sr.WIN_10||t.os===sr.WIN_81||t.os===sr.WIN_7||t.os===sr.LINUX||t.os===sr.MAC_OS||t.os===sr.CHROMIUM_OS)&&t.name===Lt.CHROME&&Number(t.version)>=74}(),mr.supportDataChannel=!!(Xu(76)||p0(68)||Z2(14)),mr.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!Cs()&&!!t&&t.prototype.setConfiguration instanceof Function}(),mr.supportWebRTCEncodedTransform=Xu(87)||X2()||p0(117),mr.supportWebRTCInsertableStream=function(){let t=At();return(t.name===Lt.CHROME||t.name===Lt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),mr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,mr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,jv(()=>{mr.supportDualStreamEncoding=function(){let t=At();return!!$("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&$("CHROME_DUAL_STREAM_USE_ENCODING"))}(),A.debug("browser ua: ",navigator.userAgent),A.info("browser info: ",e),A.info("browser compatibility: ",mr)})})();let Uie=["CHINA","GLOBAL"],tU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],fd=[],fh=[];function gd(e,t){return!!t&&fd.some(s=>s.uid===e&&s.channelName===t)}function lC(){return fh.length>0}var Vie=f1.forEach,sU=n_("forEach")?[].forEach:function(e){return Vie(this,e,arguments.length>1?arguments[1]:void 0)};qt({target:"Array",proto:!0,forced:[].forEach!==sU},{forEach:sU});var Bie=zi("Array","forEach"),Wie=Ic,Gie=Ur,Hie=N,zie=Bie,dC=Array.prototype,Kie={DOMTokenList:!0,NodeList:!0},qie=function(e){var t=e.forEach;return e===dC||Hie(dC,e)&&t===dC.forEach||Gie(Kie,Wie(e))?zie:t},Yie=u(qie),$ie=po,rU=d_;qt({target:"Object",stat:!0,forced:m(function(){rU(1)})},{keys:function(e){return rU($ie(e))}});var Xie=u(Ps.Object.keys),Jie=u(TD),Qie=u(RD),Zie=qt,nU=tm,eae=S_,tae=kt,iU=Ib,sae=Ac,rae=vt,nae=Yw,iae=qs,aae=Oc,oae=a1("slice"),cae=iae("species"),uC=Array,lae=Math.max;Zie({target:"Array",proto:!0,forced:!oae},{slice:function(e,t){var s,a,c,d=rae(this),h=sae(d),p=iU(e,h),f=iU(t===void 0?h:t,h);if(nU(d)&&(s=d.constructor,(eae(s)&&(s===uC||nU(s.prototype))||tae(s)&&(s=s[cae])===null)&&(s=void 0),s===uC||s===void 0))return aae(d,p,f);for(a=new(s===void 0?uC:s)(lae(f-p,0)),c=0;p<f;p++,c++)p in d&&nae(a,c,d[p]);return a.length=c,a}});var dae=zi("Array","slice"),uae=N,hae=dae,hC=Array.prototype,pae=function(e){var t=e.slice;return e===hC||uae(hC,e)&&t===hC.slice?hae:t},mae=u(pae);function Je(e,t,s,a,c){var d,h,p,f={};return Yie(d=Xie(a)).call(d,function(_){f[_]=a[_]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=Jie(h=Qie(p=mae(s).call(s)).call(p)).call(h,function(_,v){return v(e,t,_)||_},f),c&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(c):void 0,f.initializer=void 0),f.initializer===void 0?(s1(e,t,f),null):f}let sE=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),pC=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ra=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),tn=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),at=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),is=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ut=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),lt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),zm=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Nt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),sn=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),_t=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function rE(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw A.error("Invalid Channel Name ".concat(e)),new ue(K.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function nE(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||oL(e,1,255)))throw new ue(K.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&A.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let rc=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),fae={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},mC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function fC(e,t){hr(e.url,"".concat(t,".url"),1,1e3,!1),Ts(e.x)||Qt(e.x,"".concat(t,".x"),0,1e4),Ts(e.y)||Qt(e.y,"".concat(t,".y"),0,1e4),Ts(e.width)||Qt(e.width,"".concat(t,".width"),0,1e4),Ts(e.height)||Qt(e.height,"".concat(t,".height"),0,1e4),Ts(e.zOrder)||Qt(e.zOrder,"".concat(t,".zOrder"),0,255),Ts(e.alpha)||Qt(e.alpha,"".concat(t,".alpha"),0,1,!1)}let gae={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Gc=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),gC=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),$s=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function aU(e){if(!e.channelName)throw new ue(K.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ue(K.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&hr(e.token,"info.token",1,2047),nE(e.uid),rE(e.channelName),!0}let rn=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),nc=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),wn=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),gh=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Kt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),ar=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),iE=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),rr=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Vt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),oU=[Vt.AFRICA,Vt.ASIA,Vt.CHINA,Vt.EUROPE,Vt.GLOBAL,Vt.INDIA,Vt.JAPAN,Vt.NORTH_AMERICA,Vt.OCEANIA,Vt.OVERSEA,Vt.SOUTH_AMERICA],jr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),aE={CHINA:{},ASIA:{CODE:jr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:jr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:jr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:jr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:jr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:jr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:jr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:jr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:jr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:jr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:jr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:jr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:jr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};j0&&(aE.CHINA={CODE:jr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Km=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function cU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class lU extends bs{constructor(t,s){super(),B(this,"onICEConnectionStateChange",void 0),B(this,"onConnectionStateChange",void 0),B(this,"onDTLSTransportStateChange",void 0),B(this,"onDTLSTransportError",void 0),B(this,"onICETransportStateChange",void 0),B(this,"onFirstAudioReceived",void 0),B(this,"onFirstVideoReceived",void 0),B(this,"onFirstAudioDecoded",void 0),B(this,"onFirstVideoDecoded",void 0),B(this,"onFirstVideoRender",void 0),B(this,"onFirstVideoDecodedTimeout",void 0),B(this,"onSelectedLocalCandidateChanged",void 0),B(this,"onSelectedRemoteCandidateChanged",void 0),B(this,"onICECandidateError",void 0),B(this,"getLocalVideoStats",void 0)}}class dU extends lU{constructor(t,s){super(t,s),B(this,"establishPromise",void 0)}}let ze=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Pr=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),ic=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),uU=["disconnected","failed"],Ne=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Ht=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),tt=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),na=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ia=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),or=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),hU=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),So=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Ri=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Va=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),_h=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ks=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),vh=function(e){return e.ABORT="abort",e}({}),Hc=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),_ae=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),vae={[sE.ACCESS_POINT]:{[tn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[tn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[tn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[tn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[tn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[tn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[tn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[sE.UNILBS]:{[ra.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ra.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ra.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ra.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ra.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ra.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ra.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ra.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ra.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ra.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ra.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ra.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[sE.STRING_UID_ALLOCATOR]:{[pC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[pC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[pC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Eh(e){let t=vae[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let s=t[e%1e4];if(!s){if(Math.floor(e/1e4)===sE.ACCESS_POINT){let a=e%1e4;if(a.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}let Eae={[at.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[at.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[at.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[at.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[at.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[at.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[at.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[at.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[at.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[at.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[at.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[at.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[at.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[at.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[at.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[at.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[at.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[at.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[at.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[at.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[at.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[at.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[at.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[at.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[at.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[at.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[at.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[at.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[at.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[at.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[at.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[at.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[at.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[at.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[at.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[at.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[at.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[at.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[at.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[at.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[at.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[at.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[at.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[at.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[at.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[at.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[at.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[at.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[at.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[at.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[at.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[at.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[at.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[at.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[at.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[at.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[at.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[at.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[at.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[at.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[at.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[at.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[at.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[at.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function qm(e){return Eae[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function pU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function _C(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?pU(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):pU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function vC(e,t){if(typeof e=="string")return e;let{proxy:s,host:a,port:c}=e;if(t){let d=$("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}let yae=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,xae=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,bae=/wss:\/\/(.+):([0-9]+)\/?/,wae=/wss:\/\/(.[^\/]+)\/?/,Sae=0;class Cae{constructor(t,s){B(this,"id",0),B(this,"store",void 0),B(this,"recordIndex",void 0),B(this,"websockets",[]),B(this,"try443PortDuration",2e3),B(this,"forceCloseWSDuration",5e3),B(this,"try443PortTimeout",null),B(this,"forceCloseTimeout",null),B(this,"isTry443PortFailed",!1),B(this,"isNormalPortFailed",!1),B(this,"useDoubleDomain",!1),B(this,"useProxy",!1),B(this,"startTime",Date.now()),this.id=++Sae,this.try443PortDuration=$("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];A.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(t,s,a){this.logger("createWebSocket:",t,{isTry443Port:s,hasTimeoutDetection:a});let c=$("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=c.find(w=>{var T;return je(T=t.host).call(T,w)});p||(this.useDoubleDomain=!1);let f=[];if(this.useDoubleDomain)c.forEach(w=>{f.push(vC(_C(_C({},t),{},{host:t.host.replace(p,w)}),s))});else{let w=_C({},t);if(s&&p){let T=c.find(U=>U!==p);T&&(w.host=w.host.replace(p,T))}f.push(vC(w,s))}try{f.forEach(w=>{let T=new WebSocket(w);T.binaryType="arraybuffer",h.push(T),this.logger("ws is connecting:",T.url)})}catch(w){if(this.logger("ws create failed"),h.forEach(T=>T.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,s,a);if(!s&&Number(t.port)!==443)return this.createWebSocket(t,!0,a);throw new ue(K.WS_ERR,"init websocket failed! Error: ".concat(w.toString()))}let _=Dm();this.store&&this.store.recordJoinChannelService({urls:h.map(w=>w.url),service:"gateway"},this.recordIndex),h.forEach(w=>{w.onopen=()=>{this.logger("onopen: ws ".concat(w.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(T=>{T!==w&&(T.onopen=null,T.onclose=null,T.onmessage=null,T.close(),this.logger("close backup websocket: ".concat(T.url)))}),this.websockets.length=0,_.resolve(w)},w.onclose=T=>{this.logger("onclose: ws ".concat(w.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(w.readyState));let U=h.every(k=>k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(U)),U&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(T.reason)),_.reject({code:T.code,reason:iE.A_ROUND_WS_FAILED})):!s&&U&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),b()),s?this.isTry443PortFailed=U:this.isNormalPortFailed=U},w.onmessage=T=>this.logger("".concat(w.url," onmessage: ").concat(T.data))}),this.websockets.push(...h);let v=()=>{this.websockets.forEach(w=>w.readyState!==WebSocket.OPEN&&w.close())},b=()=>{if(_.isResolved)return v();At().os===sr.MAC_OS&&Cs()&&v(),this.createWebSocket(t,!0,!0).then(w=>{_.resolve(w)}).catch(w=>{this.isNormalPortFailed&&_.reject(w),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.forceCloseTimeout=null,v()},this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,v()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",_.isResolved),this.try443PortTimeout=null,b()},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(t,s,a,c){return this.useDoubleDomain=!!s,typeof t=="string"&&(t=function(d){let h,p,f;return[,h,p,f]=d.match(yae)||[],h||([,p,f]=d.match(xae)||[]),p&&f||([,p,f]=d.match(bae)||[]),p&&f||([,p]=d.match(wae)||[]),p||A.warning("un-destructible url: ",d),{proxy:h,host:p,port:f||"443"}}(t)),this.recordIndex=c,this.useProxy=!!t.proxy,a&&this.useProxy&&(A.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(t,!!a,!1).finally(()=>this.clearTimeout())}}function mU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}class fU extends bs{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var s;je(s=["tryNext","recover"]).call(s,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(_t.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(_t.CONNECTED):this._state==="closed"?this.emit(_t.CLOSED):this._state==="failed"&&this.emit(_t.FAILED))}resetReconnectCount(t){A.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),B(this,"_websocketUrl",null),B(this,"connectionID",0),B(this,"currentURLIndex",0),B(this,"urls",[]),B(this,"_reconnectMode","tryNext"),B(this,"reconnectReason",void 0),B(this,"_initMutex",void 0),B(this,"name",void 0),B(this,"_state","closed"),B(this,"reconnectInterrupter",void 0),B(this,"websocket",void 0),B(this,"retryConfig",void 0),B(this,"reconnectCount",0),B(this,"forceCloseTimeout",5e3),B(this,"onlineReconnectListener",void 0),B(this,"useCompress",void 0),B(this,"tryDoubleDomain",!1),B(this,"use443PortOnly",!1),B(this,"wsInflateLength",0),B(this,"wsDeflateLength",0),B(this,"closeEstablishingWs",()=>{}),B(this,"store",void 0),B(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=t,this.retryConfig=function(b){for(var w=1;w<arguments.length;w++){var T=arguments[w]!=null?arguments[w]:{};w%2?mU(Object(T),!0).forEach(function(U){B(b,U,T[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(T)):mU(Object(T)).forEach(function(U){Object.defineProperty(b,U,Object.getOwnPropertyDescriptor(T,U))})}return b}({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Dr("websocket",h?h.clientId:void 0);let{timeout:p,timeoutFactor:f}=s,_=Math.max(300,Math.floor(3*p/5)),v=Math.max(1.2,Math.floor(8*f)/10);Vn.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=v),Fs.on(Qu.NETWORK_STATE_CHANGE,(b,w)=>{b!==w&&(this.resetReconnectCount("network state change: ".concat(w," -> ").concat(b)),b===Vn.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=f))})}getConnection(){return this.websocket||void 0}async init(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=t,this.state="connecting";try{var c;let d=Dm(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(p){return!(Vv()||$("USE_NEW_TOKEN")||!$("ENABLE_PREALLOC_PC")&&(p==null||!p.autoSubscribe||$("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(hU.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(_t.CLOSED,()=>{d.reject(new _e(K.WS_DISCONNECT))}),this.once(_t.CONNECTED,d.resolve),await d.promise}catch{}finally{a()}}close(t,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,s){if(!this.websocket)return void A.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),A.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);let a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new _e(K.WS_ABORT,"websocket is not ready");try{s||(t=JSON.stringify(t)),this.websocket.send(t)}catch(a){throw new _e(K.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var s;let a=Dm();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let c=v=>{var b;(b=this.store)===null||b===void 0||b.signalChannelOpen(),A.debug("[".concat(this.name,"] websocket opened:"),v),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async v=>{var b;if(A.debug("[".concat(this.name,"] websocket close ").concat((b=this.websocket)===null||b===void 0?void 0:b.url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new _e(K.WS_DISCONNECT,"websocket close: ".concat(v.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");let w=ri(this,_t.WILL_RECONNECT,this.reconnectMode,v.reason)||this.reconnectMode,T=await this.reconnectWithAction(w);if(this.state==="closed")return void A.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return a.reject(new _e(K.WS_DISCONNECT,"websocket reconnect failed: ".concat(v.code))),this.close(!0);a.resolve()}},h=v=>{this.emit(_t.ON_MESSAGE,v)},p=v=>{A.warn("[".concat(this.connectionID,"] ws open error ").concat(v))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),$("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=$("GATEWAY_WSS_ADDRESS")),A.debug("[".concat(this.name,"] start connect, url:"),t);let f=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var _;this._websocketUrl=vC(t);let v=await this.chooseBestWebsocketConnection(t);this.websocket=v,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=p,(_=this.store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},f),this.joinGatewayRecordIndex=f}catch(v){let b=this.state==="closed",w=v instanceof _e,T=w&&v.code===K.WS_ABORT,U=w&&v.code===K.WS_ERR,k=w?v.message:v&&(v.reason||v.toString());A.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(k)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[v]},f),b||U?(a.reject(b?new _e(K.WS_DISCONNECT,"websocket is closed: ".concat(k)):new _e(K.WS_ERR,"init websocket failed: ".concat(k))),U&&A.error("[".concat(this.name,"] init websocket failed: ").concat(k))):d&&d(v)}return a.promise}async reconnectWithAction(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;A.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Fs.isOnline||!Fs.onlineWaiter||(this.onlineReconnectListener=Fs.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){let h=C0(this.reconnectCount,this.retryConfig);A.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(t)),await Ve.race([pr(h),this.onlineReconnectListener||new Ve(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;let c=async(h,p)=>{this.emit(_t.RECONNECT_CREATE_CONNECTION,p),await this.createWebSocketConnection(h)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);A.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(A.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Cr(this,_t.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(h){var d;A.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));let p=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(p)&&je(p).call(p,"dynamic key expired")?(this.emit(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,s)}return!0}}class EC extends fU{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,s){let a=Dm(),c=function(h,p){return new Cae(h,p)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{A.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new _e(K.WS_ABORT,"choose best websocket aborted"))};let d=$("GATEWAY_DOMAINS");return A.debug("[choose-best-ws] currentDomain: ",t,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Ym extends fU{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,s){return new Ve((a,c)=>{let d=!1,h=[];this.closeEstablishingWs=()=>{A.debug("[choose-best-ws] close establishing websockets"),h.forEach(U=>{U.onclose=null,U.onopen=null,U.onmessage=null,U.close()}),c(new _e(K.WS_ABORT,"choose best websocket aborted"))};let p=$("GATEWAY_DOMAINS"),f,_=t.indexOf("?h="),v=p.find(U=>_!==-1?je(t).call(t,U,_):je(t).call(t,U));A.debug("[choose-best-ws] currentDomain: ",v,", domains: ",p);let b=!this.tryDoubleDomain||!v;if(!b&&v){var w;let U=Date.now();try{p.forEach(k=>{let F=_===-1?t.replace(v,k):t.substr(0,_)+t.substr(_).replace(v,k),z=new WebSocket(F);z.binaryType="arraybuffer",h.push(z),A.debug("[choose-best-ws] ws is connecting:",z.url)})}catch{for(A.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(k=>k.close());h.length;)h.pop();b=!0}(w=this.store)===null||w===void 0||w.recordJoinChannelService({urls:h.map(k=>k.url),service:"gateway"},s),h.forEach(k=>{k.onopen=()=>{if(d)return;let F=Date.now()-U;A.debug("[choose-best-ws] ws open cost ".concat(F,"ms")),h.filter(z=>z!==k).forEach(z=>{A.debug("[choose-best-ws]close backup websocket: ".concat(z.url)),z.close()}),d=!0,a(k)},k.onclose=F=>{f=F,!d&&(h.find(z=>!(z.readyState===WebSocket.CLOSED||z.readyState===WebSocket.CLOSING))||(A.debug("[choose-best-ws] all websocket is closed"),d=!0,c(f)))},k.onmessage=F=>{A.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(F.data))}}),pr(this.forceCloseTimeout).then(()=>{h.forEach(k=>{k.readyState!==WebSocket.OPEN&&k.close()})})}if(b){var T;let U;A.debug("[choose-best-ws] use single url: ",t),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[t],service:"gateway"},s);try{U=new WebSocket(t),h.push(U),U.binaryType="arraybuffer"}catch(k){let F=new _e(K.WS_ERR,"init websocket failed! Error: ".concat(k.toString()));return A.error("[".concat(this.name,"]").concat(F)),void c(F)}U.onopen=()=>{a(U)},U.onclose=k=>{c(k)},U.onmessage=k=>{A.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(k.data))},pr(this.forceCloseTimeout).then(()=>{U&&U.readyState!==WebSocket.OPEN&&U.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class Tae extends bs{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===is.CONNECTED?this.emit(ut.WS_CONNECTED):t===is.RECONNECTING?this.emit(ut.WS_RECONNECTING,this._websocketReconnectReason):t===is.CLOSED&&this.emit(ut.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,s){super(),B(this,"_disconnectedReason",void 0),B(this,"_websocketReconnectReason",void 0),B(this,"_connectionState",is.CLOSED),B(this,"reconnectToken",void 0),B(this,"websocket",void 0),B(this,"openConnectionTime",void 0),B(this,"clientId",void 0),B(this,"lastMsgTime",Date.now()),B(this,"uploadCache",[]),B(this,"uploadCacheInterval",void 0),B(this,"rttRolling",new wL(5)),B(this,"pingpongTimer",void 0),B(this,"wsInflateDataTimer",void 0),B(this,"pingpongTimeoutCount",0),B(this,"ortc",void 0),B(this,"joinResponse",void 0),B(this,"multiIpOption",void 0),B(this,"initError",void 0),B(this,"spec",void 0),B(this,"store",void 0),B(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(ut.ON_BINARY_DATA,a.data);let c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Nt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Nt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Gt.UID_BANNED);break;case 15:this.close(Gt.IP_BANNED);break;case 16:this.close(Gt.CHANNEL_BANNED)}if(c._type===Nt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case at.ERR_LICENSE_MISSING:this.close(Gt.LICENSE_MISSING);break;case at.ERR_LICENSE_EXPIRED:this.close(Gt.LICENSE_EXPIRED);break;case at.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Gt.LICENSE_MINUTES_EXCEEDED);break;case at.ERR_LICENSE_PERIOD_INVALID:this.close(Gt.LICENSE_PERIOD_INVALID);break;case at.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Gt.LICENSE_MULTIPLE_SDK_SERVICE);break;case at.ERR_LICENSE_ILLEGAL:this.close(Gt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new EC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===is.CONNECTED&&this.reconnect("retry",Sr.OFFLINE)})}async request(t,s,a,c){let d=ts(6,""),h={_id:d,_type:t,_message:s},p=this.websocket.connectionID,f=()=>new Ve((U,k)=>{if(this.connectionState===is.CONNECTED)return U();let F=()=>{this.off(ut.WS_CLOSED,z),U()},z=()=>{this.off(ut.WS_CONNECTED,F),k(new ue(K.WS_ABORT))};this.once(ut.WS_CONNECTED,F),this.once(ut.WS_CLOSED,z),t!==lt.PUBLISH&&t!==lt.PUBLISH_DATASTREAM&&t!==lt.SUBSCRIBE&&t!==lt.SUBSCRIBE_DATASTREAM&&t!==lt.UNSUBSCRIBE&&t!==lt.UNSUBSCRIBE_DATASTREAM&&t!==lt.UNPUBLISH&&t!==lt.UNPUBLISH_DATASTREAM&&t!==lt.CONTROL&&t!==lt.RESTART_ICE||this.once(ut.DISCONNECT_P2P,()=>{k(new ue(K.DISCONNECT_P2P))}),t!==lt.PUBLISH&&t!==lt.RESTART_ICE||this.once(ut.ABORT_P2P_EXECUTION,()=>{k(new ue(K.DISCONNECT_P2P))})});if(this.connectionState!==is.CONNECTING&&this.connectionState!==is.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await f(),this.websocket.sendMessage(h,!0),c)return;let _=new Ve((U,k)=>{let F=!1,z=(X,re)=>{F=!0,U({isSuccess:X==="success",message:re||{}}),this.off(ut.WS_CLOSED,Y),this.off(ut.WS_RECONNECTING,Y),this.emit(ut.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(d),z);let Y=()=>{k(new ue(K.WS_ABORT,"type: ".concat(t))),this.off(ut.WS_CLOSED,Y),this.off(ut.WS_RECONNECTING,Y),this.off("res-@".concat(d),z)};this.once(ut.WS_CLOSED,Y),this.once(ut.WS_RECONNECTING,Y),pr($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||F||(A.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ut.REQUEST_TIMEOUT,t,s))})}),v=null;try{v=await _}catch(U){if(this.connectionState===is.CLOSED||t===lt.LEAVE)throw new ue(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?U.throw():t===lt.JOIN||t===lt.REJOIN?null:(await f(),await this.request(t,s))}if(v.isSuccess)return v.message;let b=Number(v.message.error_code||v.message.code),w=qm(b),T=new ue(K.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(v.message.error_str),{code:b,data:v.message,desc:w.desc});return w.action==="success"?v.message:(A.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(w.desc,", action: ").concat(w.action)),b===at.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=T,this.close()),T.throw()):w.action==="failed"?T.throw():w.action==="quit"?(this.initError=T,this.close(),T.throw()):(b===at.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Sr.MULTI_IP)):this.reconnect(w.action,Sr.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new Ve(a=>{let c=d=>{(!s||s(d))&&(this.off(t,c),a(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(zm.WRTC_STATS,s)}upload(t,s){let a={_type:t,_message:s};try{this.websocket.sendMessage(a)}catch{let c=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==is.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,s){let a={_type:t,_message:s};this.websocket.sendMessage(a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ve((s,a)=>{this.once(ut.WS_CONNECTED,()=>s(this.joinResponse)),this.once(ut.WS_CLOSED,c=>a(this.initError||new ue(K.WS_ABORT,c))),this.connectionState=is.CONNECTING,this.websocket.init(t).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Gt.LEAVE,this.connectionState=is.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ut.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await Cr(this,ut.REQUEST_JOIN_INFO);this.store.joinReq();let s=await this.request(lt.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!s)return this.emit(ut.REPORT_JOIN_GATEWAY,iE.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(ut.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=is.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ue(K.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=Lm(this,ut.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let s=await this.request(lt.REJOIN,t);return!!s&&(this.connectionState=is.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(Nt.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Nt.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Nt.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Nt.MUTE_AUDIO,{uid:a.uid}):this.emit(Nt.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Nt.MUTE_VIDEO,{uid:a.uid}):this.emit(Nt.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Nt.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Nt.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Nt.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Nt.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Nt.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){if(!this.ortc)return!1;let s={downgrade_codec:t,ortc:this.ortc};return!!await this.request(lt.DOWNGRADE_CODEC,s)}handleNotification(t){A.debug("[".concat(this.clientId,"] receive notification: "),t);let s=qm(t.code);if(t.code===28&&"detail"in t&&(A.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ut.RECOVER_NOTIFICATION,t.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Gt.UID_BANNED),void this.close()):void this.reconnect(s.action,Sr.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=$("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(A.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Sr.TIMEOUT):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let a=Date.now()-s;this.rttRolling.add(a),$("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:s}=this.websocket.getWsInflateData();t!==0&&s!==0&&this.upload(zm.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ut.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=is.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Gt.NETWORK_ERROR,this.connectionState=is.CLOSED}),this.websocket.on(_t.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===is.CONNECTED?this.connectionState=is.RECONNECTING:this.connectionState=is.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(t,s,a)=>{let c=Lm(this,ut.IS_P2P_DISCONNECTED),d=c||t!=="retry";c&&t==="retry"&&(A.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",s=iE.P2P_DISCONNECTED),d&&(A.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ut.REPORT_JOIN_GATEWAY,s||iE.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ut.DISCONNECT_P2P)),a(t)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{A.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Sr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ut.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ue){if(t.code===K.UNEXPECTED_RESPONSE&&t.data.code===at.ERR_NO_AUTHORIZED)return this.initError=new ue(K.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Gt.TOKEN_EXPIRE);A.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Sr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(_t.REQUEST_NEW_URLS,(t,s)=>{Cr(this,ut.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(hU.PRE_CONNECT_PC,()=>{this.emit(ut.PRE_CONNECT_PC)})}}let Nae=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Us=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function gU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function oE(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?gU(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):gU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function zc(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat($("TURN_DOMAIN")):(A.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function cE(e){try{let t=$("GATEWAY_DOMAINS").concat($("TURN_DOMAIN")).find(s=>je(e).call(e,s));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return A.debug("serverUrlToIp error, fallback to url",e),e}}function yC(e,t){e.addresses||(e.addresses=[]);let s=function(p,f){if($("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return p.map(b=>{let{ip:w,port:T}=b;return{address:"".concat(w,":").concat(T)}});let _=$("GATEWAY_DOMAINS"),v=_[1]&&je(f).call(f,_[1])?1:0;return p.map(b=>{let{domain_prefix:w,port:T,ip:U}=b;if(w)return{address:"".concat(w,".").concat(_[v++%_.length],":").concat(T)};let k=/^[\.\:\d]+$/.test(U),F=k?"".concat(U.replace(/[^\d]/g,"-"),".").concat(_[v++%_.length],":").concat(T):"".concat(U,":").concat(T);return k||A.debug("Cannot recognized as ip address: ".concat(U,", use as host3")),{ip:U,port:T,address:F}})}(e.addresses,t),a=Array.isArray(e.detail)&&e.detail[18];if(a&&typeof a=="string"){let p=a.split(";");for(let f=0;f<p.length;f++){var c;let _=Kr(c=p[f]).call(c);s[f]&&_&&(s[f].ip6=_)}}let d=e.detail&&e.detail.candidate,h;if(d){let[p,f]=d.split(":");p&&f&&(h={port:Number(f),ip:p,address:"".concat(p,":").concat(f)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Bn(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function _U(e){let t=e._encoderConfig;if(!t)return{};let s={resolution:t.width&&t.height?"".concat(Bn(t.width),"x").concat(Bn(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(s.maxFrameRate=t.frameRate,s.minFrameRate=t.frameRate):t.frameRate&&(s.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,s.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),s}function vU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function $m(e,t){let s,a,c;switch(t){case Us.CHOOSE_SERVER:a=4096,c="choose server";break;case Us.CLOUD_PROXY:a=1048576,c="proxy";break;case Us.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case Us.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new ue(K.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>oE(oE({},h),{},{ticket:d.buffer.cert})),server_ts:e.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:oE(oE({},d.buffer.detail),e.detail),flag:d.buffer.flag,opid:e.opid,cert:d.buffer.cert})}),!s)throw new ue(K.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return s}async function EU(e,t){return await Ve.all(e.addresses.map(async s=>({address:zc(s.ip),tcpport:s.port,udpport:s.port,username:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Tr.username,password:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await x0(t.toString()):Tr.password})))}function xC(e,t){let s=t.getMediaStreamTrack(!0).getSettings(),a=t.videoHeight||s.height,c=t.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(Bn(e.height),Bn(e.width)),1):(A.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Kc(e){let{candidateType:t,relayProtocol:s,type:a,address:c,port:d,protocol:h}=e,p={candidateType:t,relayProtocol:s,protocol:h};if(a!=="local-candidate"){let f=c.split(".");f.length>=4&&(f[1]="*",f[2]="*"),p.address=f.join("."),p.port=d}return p}function _d(e){let t=e.split(":"),s=e.split(/[-.]/),a=je(e).call(e,"-")?"-":".",c=e;return t.length>1?s.length>1?(s[1]="**",c=s[0]+a+"**:"+t[t.length-1]):c=t.length>2?t[0]+a+"**:"+t[t.length-1]:"**:"+t[t.length-1]:s.length>1&&(c=s[0]+a+"**"),c}function lE(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$("SVC_MODE");if($("ENABLE_SVC"))return function(t){return t in Mv}(e)?e:Mv.L1T3}let yU={[ze.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ze.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function dE(e,t,s){t.forEach(a=>{var c;let d=yU[e].find(p=>{var f;let{key:_}=p;return je(f=a.extensionName).call(f,_)});if(!d)return;let h=s.find(p=>{let{extensionName:f}=p;return je(f).call(f,d.key)});h&&je(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function yh(e,t){t.forEach(s=>{var a;let c=yU[e].find(d=>{var h;let{key:p}=d;return je(h=s.extensionName).call(h,p)});je(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function xU(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||je(e).call(e,"abs-send-time")}function uE(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||je(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function bU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function wU(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?bU(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):bU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function Xm(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:f,unsupportedVideoUplinkCodec:_,unsupportedVideoDownlinkCodec:v}=t,{useXR:b}=s,w=[],T=[],U=[],k=[],F=!1,z=!1;if(xn(e).mediaDescriptions.forEach(X=>{a&&a!==X.attributes.direction||(X.media.mediaType!=="video"||F||(T=X.attributes.payloads,k=X.attributes.extmaps,F=!0),X.media.mediaType!=="audio"||z||(w=X.attributes.payloads,U=X.attributes.extmaps,z=!0))}),!k||T.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!U||w.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(T.forEach(X=>{var re;(re=X.rtpMap)!==null&&re!==void 0&&re.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),b&&X.rtcpFeedbacks.push({type:"rrtr"})}),w.forEach(X=>{var re;(re=X.rtpMap)!==null&&re!==void 0&&re.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),b&&X.rtcpFeedbacks.push({type:"rrtr"})}),c&&(w=w.filter(X=>{var re;return((re=X.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())!=="rtx"}),T=T.filter(X=>{var re;return((re=X.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())!=="rtx"})),d){let X=T.filter(Z=>{var de;return/(red)|(ulpfec)|(flexfec)/i.test(((de=Z.rtpMap)===null||de===void 0?void 0:de.encodingName)||"")}),re=Yc(X,T).map(Z=>Z.payloadType),te=[...X.map(Z=>Z.payloadType),...re];T=T.filter(Z=>!je(te).call(te,Z.payloadType))}if(h&&(w=w.filter(X=>{var re;return!/(red)|(ulpfec)|(flexfec)/i.test(((re=X.rtpMap)===null||re===void 0?void 0:re.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(w=w.filter(X=>{var re;return je(p).call(p,((re=X.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())||"")})),f&&(f==null?void 0:f.length)>0){let X=T.filter(re=>{var te;return je(f).call(f,((te=re.rtpMap)===null||te===void 0?void 0:te.encodingName.toLowerCase())||"")});T=X.concat(c?[]:Yc(X,T))}let Y=$("UNSUPPORTED_VIDEO_CODEC");if(Y&&Y.length>0){let X=T.filter(Z=>Z.rtpMap&&je(Y).call(Y,Z.rtpMap.encodingName.toLowerCase())),re=Yc(X,T),te=X.concat(re).map(Z=>Z.payloadType);T=T.filter(Z=>!je(te).call(te,Z.payloadType)),A.debug("unsupportedVideoCodec: ".concat(Y,", toBeRemoved: ").concat(te))}if(_&&_.length>0&&a==="sendonly"){let X=T.filter(Z=>Z.rtpMap&&je(_).call(_,Z.rtpMap.encodingName.toLowerCase())),re=Yc(X,T),te=X.concat(re).map(Z=>Z.payloadType);T=T.filter(Z=>!je(te).call(te,Z.payloadType)),A.debug("unsupportedVideoUplinkCodec: ".concat(_,", toBeRemoved: ").concat(te))}if(v&&v.length>0&&a==="recvonly"){let X=T.filter(Z=>Z.rtpMap&&je(v).call(v,Z.rtpMap.encodingName.toLowerCase())),re=Yc(X,T),te=X.concat(re).map(Z=>Z.payloadType);T=T.filter(Z=>!je(te).call(te,Z.payloadType)),A.debug("unsupportedVideoDownlinkCodec: ".concat(v,", toBeRemoved: ").concat(te))}return{audioCodecs:w,videoCodecs:T,audioExtensions:U,videoExtensions:k}}function qc(e){let t=xn(e),s,a;for(let c of t.mediaDescriptions){if(!s){let d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){let d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&t.attributes.fingerprints.length>0&&(a={fingerprints:t.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function SU(e,t){let s=[],a=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var p;let f=(p=a.find(_=>_.ssrcIds[0]===h))===null||p===void 0?void 0:p.ssrcIds[1];s.push({ssrcId:h,rtx:t?f:void 0})});else if(a.length>0){let h=a[0].ssrcIds[0],p=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:t?p:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function CU(e,t,s){let{cname:a}=e,c=[];t&&(c=TU(t)),c.length===0&&(c=e.iceParameters.candidates.map(v=>({foundation:v.foundation,componentId:"1",transport:v.protocol,priority:v.priority.toString(),connectionAddress:v.ip,port:v.port.toString(),type:v.type,extension:{}})),A.debug("Using candidates from gateway."));let d={fingerprints:e.dtlsParameters.fingerprints.map(v=>({hashFunction:v.algorithm,fingerprint:v.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},p;switch(e.dtlsParameters.role){case"server":p="passive";break;case"client":p="active";break;case"auto":p="actpass"}let f=pE(e.rtpCapabilities),_=[];return Array.isArray(s)&&s.length>0&&s.forEach(v=>{_.push({kind:ze.VIDEO,ssrcMsg:[{ssrcId:v.v,rtx:v.v_rtx}],mslabel:"".concat(v.v,"_").concat(v.a)},{kind:ze.AUDIO,ssrcMsg:[{ssrcId:v.a}],mslabel:"".concat(v.v,"_").concat(v.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:f,setup:p,cname:a,preSSRCs:_}}function TU(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],A.debug("Using remote candidate from AP ".concat(_d(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),A.debug("Using IPV6 remote candidate from AP ".concat(_d(e.ip6),":").concat(e.port)))),t}function Jm(e,t,s){let a=[],c=[];return e.forEach(d=>{let{ssrcId:h,rtx:p}=d,f=ts(8,"track-"),_={ssrcId:h,attributes:wU({label:f,mslabel:s=s||ts(10,""),msid:"".concat(s," ").concat(f)},t&&{cname:t})};if(a.push(_),p!==void 0){let v={ssrcId:p,attributes:wU({label:f,mslabel:s,msid:"".concat(s," ").concat(f)},t&&{cname:t})};a.push(v),c.push({semantic:"FID",ssrcIds:[h,p]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:c}}function xh(e,t){t instanceof Is&&e.attributes.payloads.forEach(s=>{var a;let c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),c==="opus"&&typeof $("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=$("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";let d=t._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!Cs()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),t instanceof Gm&&c==="opus"&&t._config.DTX&&(s.fmtp.parameters.usedtx="1"))})}function bC(e){let t=e.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function wC(e,t){var s;if(!(t instanceof as&&t._encoderConfig&&t._hints.indexOf(Zt.SCREEN_TRACK)===-1))return;let a=t._encoderConfig;jt().supportMinBitrate&&a.bitrateMin&&e.attributes.payloads.forEach(c=>{var d,h;je(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),jt().supportMinBitrate&&!je(s=t._hints).call(s,Zt.LOW_STREAM)&&a.bitrateMax&&e.attributes.payloads.forEach(c=>{var d,h;je(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat($("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function NU(e){if(e.media.mediaType!=="video")return;let t=At();if(t.name!==Lt.SAFARI&&t.os!==sr.IOS)return;let s=e.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1)}function hE(e,t,s){if(!t)return;let a,c;if(e.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),t.twcc===!0){let d=a.find(h=>uE(h.extensionName));if(d){let h=d.extensionName;e.attributes.extmaps.find(p=>uE(p.extensionName))||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(p,f){return f.filter(_=>!!p.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(b=>b.type==="transport-cc")))}(c,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(f=>f.type==="transport-cc")||p.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let d=e.attributes.extmaps.findIndex(h=>uE(h.extensionName));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach(h=>{let p=h.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}if(t.remb===!0){let d=a.find(h=>xU(h.extensionName));if(d){let h=d.extensionName;e.attributes.extmaps.find(p=>p.extensionName===h)||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(p,f){return f.filter(_=>!!p.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(b=>b.type==="goog-remb")))}(c,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(f=>f.type==="goog-remb")||p.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let d=e.attributes.extmaps.findIndex(h=>xU(h.extensionName));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach(h=>{let p=h.rtcpFeedbacks.findIndex(f=>f.type==="goog-remb");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}}function RU(e,t,s){if(Cs()||e.media.mediaType!=="video"||!(t instanceof as)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!$("SIMULCAST")||s==="vp9"&&$("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let a=s==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],d=e.attributes.ssrcGroups.find(p=>p.semantic==="FID"&&p.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let p=1;p<a;p++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+p,attributes:Es(c.attributes)}),h.ssrcIds.push(c.ssrcId+p),d&&(e.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:Es(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+p,d.ssrcIds[1]+p]}));e.attributes.ssrcGroups.unshift(h)}async function AU(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});let a=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0,v=Xm(_,p,f,"sendonly"),b=Xm(_,p,f,"recvonly"),w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(aa(v,b,"videoExtensions",w,T,U),aa(v,b,"videoCodecs",w,T,U),aa(v,b,"audioExtensions",w,T,U),aa(v,b,"audioCodecs",w,T,U),$("RAISE_H264_BASELINE_PRIORITY")){let k=[],F=[];if(U.videoCodecs.forEach((z,Y)=>{var X;if(((X=z.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"){var re,te;let Z=U.videoCodecs[Y+1],de=Z&&PU(z,Z),xe=(re=z.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"],Se=(te=z.fmtp)===null||te===void 0?void 0:te.parameters["packetization-mode"];!xe||xe!==$("FIRST_H264_PROFILE_LEVEL_ID")||$("FIRST_PACKETIZATION_MODE")&&Se!==$("FIRST_PACKETIZATION_MODE")?de?F.push([z,Z]):F.push([z]):de?k.push([z,Z]):k.push([z])}}),k.length>0&&F.length>0){A.debug("raising H264 baseline profile priority"),U.videoCodecs.forEach((Y,X)=>{var re;if(((re=Y.rtpMap)===null||re===void 0?void 0:re.encodingName.toLocaleLowerCase())==="h264"){let te=PU(Y,U.videoCodecs[X+1]),Z=k.shift()||F.shift()||[];Z.length>0&&(te?U.videoCodecs.splice(X,2,...Z):U.videoCodecs.splice(X,1,...Z))}});let z=T.videoCodecs.filter(Y=>{var X,re;return((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((re=Y.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"])!==$("FIRST_H264_PROFILE_LEVEL_ID")});if(z.length>0){let Y=Yc(z,T.videoCodecs).map(re=>re.payloadType),X=[...z.map(re=>re.payloadType),...Y];T.videoCodecs=T.videoCodecs.filter(re=>!je(X).call(X,re.payloadType))}$("FILTER_SEND_H264_BASELINE")&&(w.videoCodecs=w.videoCodecs.filter(Y=>{var X,re;return!(((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((re=Y.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"])!==$("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:w,recv:T,sendrecv:U}}return{send:w,recv:T,sendrecv:U}}(e,t,a);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function IU(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Xm(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(aa(e,t,"videoExtensions",s,a,c),aa(e,t,"videoCodecs",s,a,c),aa(e,t,"audioExtensions",s,a,c),aa(e,t,"audioCodecs",s,a,c),$("RAISE_H264_BASELINE_PRIORITY")){let d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){let h=c.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){A.debug("raising H264 baseline profile priority");let p=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,p)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(p=>!(p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:a,sendrecv:c}}function aa(e,t,s,a,c,d){if(s==="videoExtensions"||s==="audioExtensions"){let h=[];return e[s].forEach(p=>{t[s].some((f,_)=>{if(p.entry===f.entry&&p.extensionName===f.extensionName)return h.push(_),!0})?d[s].push(p):a[s].push(p)}),void t[s].forEach((p,f)=>{h.indexOf(f)===-1&&c[s].push(p)})}if(s==="videoCodecs"||s==="audioCodecs"){let h=[];return e[s].forEach(p=>{t[s].some((f,_)=>{if(p.payloadType===f.payloadType&&JSON.stringify(p)===JSON.stringify(f))return h.push(_),!0})?d[s].push(p):a[s].push(p)}),void t[s].forEach((p,f)=>{h.indexOf(f)===-1&&c[s].push(p)})}}function pE(e){let{send:t,recv:s,sendrecv:a}=e;if(!a){if(!t||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:s}}let c,d;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...a.audioCodecs],c.videoCodecs=[...t.videoCodecs,...a.videoCodecs],c.audioExtensions=[...t.audioExtensions,...a.audioExtensions],c.videoExtensions=[...t.videoExtensions,...a.videoExtensions]):c=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:c,recv:d}}function bh(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var s;return((s=t.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Qm(e,t,s,a){let c=[];if(e===ze.VIDEO){if($("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=t.videoCodecs.filter(d=>{var h;return je(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===$("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[],h=[],p=[],f=[];if(s.videoCodecs.forEach(_=>{let v=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"";je(v).call(v,a)?d.push(_):je(v).call(v,"vp9")?h.push(_):je(v).call(v,"vp8")?p.push(_):je(v).call(v,"h264")&&f.push(_)}),d.length===0){let _="";h.length!==0?(d=h,_="vp9"):p.length!==0?(d=p,_="vp8"):f.length!==0&&(d=f,_="h264"),A.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(_))}d.length!==0&&(c=t.videoCodecs.filter(_=>d.some(v=>v.payloadType===_.payloadType)))}if(c.length===0&&(A.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),$("USE_PUB_RTX")||$("USE_SUB_RTX")){let d=Yc(c,t.videoCodecs);c=[...c,...d]}}else{c=t.audioCodecs.filter(h=>{var p;return je(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,a)});let d=t.audioCodecs.filter(h=>{var p;return je(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"red")});c.length===0&&(A.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter(h=>{var p;return je(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"opus")})),$("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function Yc(e,t){let s=e.map(a=>a.payloadType.toString());return t.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&je(s).call(s,a.fmtp&&a.fmtp.parameters.apt))}async function $c(e,t,s){let a=t.toString(),c=OU(a,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:a});let d=await e.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=DU(h,s||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function DU(e,t,s){let a=xn(e),{useXR:c}=t;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!je(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&bh(d),c&&je(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(p=>{p.rtcpFeedbacks.findIndex(f=>f.type==="rrtr")===-1&&p.rtcpFeedbacks.push({type:"rrtr"})})))}),Bc(a)}function OU(e,t,s,a){if($("SDP_LOGGING"))return A.upload("exchanging ".concat(s," ").concat(t," SDP during P2PConnection.").concat(a,`
`),e),t==="offer"?c=>{OU(c,"answer",s==="local"?"remote":"local",a)}:void 0}function jU(e){let t=$("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(s=>je(e).call(e,s))}function PU(e,t){try{var s;return((s=e.fmtp)===null||s===void 0?void 0:s.parameters.apt)===t.payloadType.toString()}catch{return!1}}function kU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function hi(e,t){return typeof $(e)===t?$(e):void 0}function Rae(){try{let e=$("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?kU(Object(a),!0).forEach(function(c){B(t,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):kU(Object(a)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(a,c))})}return t}({},e)}catch(e){return A.debug("handle gateway attributes failed: ",e),{}}}let LU={};function Xc(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&A.debug("install service ".concat(e.name)),LU[e.name]=e}function ac(e){let t=LU[e];if(!t)throw new _e(K.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function MU(e,t){return ac("DataStream").create(e,t)}function mE(){return ac("InterceptFrame").create()}function FU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Wr(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?FU(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):FU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let SC=new Map;class Aae extends bs{get state(){return this._state}set state(t){if(t===this._state)return;let s=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(ar.CONNECTION_STATE_CHANGE,t,s,this._disconnectedReason):this.emit(ar.CONNECTION_STATE_CHANGE,t,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){A.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,s){var a,c,d;super(),B(this,"store",void 0),B(this,"joinInfo",void 0),B(this,"key",void 0),B(this,"ntpOffset",0),B(this,"signal",void 0),B(this,"role",void 0),B(this,"isPreallocation",void 0),B(this,"isPreSub",void 0),B(this,"inChannelInfo",{joinAt:null,duration:0}),B(this,"spec",void 0),B(this,"_state","DISCONNECTED"),B(this,"_statsCollector",void 0),B(this,"_disconnectedReason",void 0),B(this,"isSignalRecover",!1),B(this,"hasChangeBGPAddress",!1),B(this,"trafficStatsInterval",void 0),B(this,"networkQualityInterval",void 0),B(this,"_joinGatewayStartTime",0),B(this,"_signalTimeout",!1),B(this,"_clientRoleOptions",void 0),B(this,"_isProactiveJoin",!1),this.store=t,this.spec=s,this.signal=this.store.useP2P?(a={spec:Wr(Wr({},s),{},{retryConfig:s.websocketRetryConfig}),store:t},(c=(d=ac("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):new Tae(Wr(Wr({},s),{},{retryConfig:s.websocketRetryConfig}),t),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(t,s,a){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let c=Date.now(),d=SC.get(t.cname);if(d||(d=new Map,SC.set(t.cname,d)),this._isProactiveJoin=!0,d.has(t.uid)){let _=new ue(K.UID_CONFLICT);throw Qe.joinGateway(t.sid,{lts:c,succ:!1,ec:_.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),_}d.set(t.uid,!0),this.joinInfo=t,this.key=s;let h=0;this.joinGatewayStartTime=c;let p=t.proxyServer;try{A.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));let _=t.gatewayAddrs.map(v=>{let{address:b}=v,[w,T]=b.split(":"),U={host:w,port:T};return t.proxyServer&&(U.proxy=t.proxyServer),U});h=(await this.signal.init(_)).uid,A.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var f;throw A.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),Qe.joinGateway(t.sid,{lts:c,succ:!1,ec:((f=_.data)===null||f===void 0?void 0:f.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!p,signalChannel:"0",preload:t.preload}),d.delete(t.uid),this.signal.close(),_}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),A.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{A.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ar.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ar.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ar.NETWORK_QUALITY,{uplinkNetworkQuality:vU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:vU(this._statsCollector.trafficStats.B_dnq)}):this.emit(ar.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Gt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==is.CONNECTED||await function(a,c){return c===1/0?a:Ve.race([a,eie(c)])}(this.signal.request(lt.LEAVE,void 0,!0),3e3)}catch(a){A.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==Gt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:$("PUB_EXTEND"),twcc:!!$("PUBLISH_TWCC"),rtx:!!$("USE_PUB_RTX")};try{return(await this.signal.request(lt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===at.ERR_PUBLISH_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(t,s),this.publish(t,s,!1);throw d}}async publishDataChannel(t,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(lt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===at.ERR_PUBLISH_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(t,s),this.publishDataChannel(t,s,!1);throw h}}async unpublish(t,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(lt.UNPUBLISH,{stream_id:s,ortc:t},!0)}catch(a){A.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ve.all(t.map(s=>this.signal.request(lt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){A.warning("unpublish datachannels warning: ",s)}}async presubscribe(t,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let c={stream_id:t,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX")||void 0,extend:$("SUB_EXTEND"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(lt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===at.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(t,s,!1);throw d}}async subscribe(t,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let c={stream_id:t,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX"),extend:$("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return(await this.signal.request(lt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===at.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(t,s),await this.subscribe(t,s,!1);throw d}}async subscribeDataChannel(t,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let c={uid:t,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(lt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===at.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(t,s),await this.subscribeDataChannel(t,s,!1);throw d}}async subscribeAll(t,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let a={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!$("USE_SUB_RTX"),twcc:!!$("SUBSCRIBE_TWCC"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(lt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===at.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){let s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,p=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(p=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(p=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(p=!1)),p?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(t);if(s)return this.signal.request(lt.SET_VIDEO_PROFILE,s);A.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,s){try{await this.signal.request(lt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:s},!0)}catch(a){A.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(t,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ve.all(t.map(a=>this.signal.request(lt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0)))}catch(a){A.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(t){try{await this.signal.request(lt.UNSUBSCRIBE_STREAMS,t,!0)}catch(s){A.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(t){let{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(lt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(lt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(lt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,s){s&&(this._clientRoleOptions=Object.assign({},s)),$("CLIENT_ROLE_OPTIONS")&&(A.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify($("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},$("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),$("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},$("CLIENT_ROLE_OPTIONS")),A.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify($("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let a,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;let d=Object.assign({},s);delete d.delay,delete d.level,await this.signal.request(lt.SET_CLIENT_ROLE,Wr(Wr({role:t,level:c,delay:a},d),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,s){await this.signal.request(lt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:s})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(lt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,s){await this.signal.request(lt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:s})}async pickSVCLayer(t,s){await this.signal.request(lt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(t){await this.signal.request(lt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Wr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(lt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=SC.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Tr.username,password:Tr.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Wr(Wr({},Tr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(lt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(s=>{let a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&jv(()=>{this.emit(ar.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var s,a;if(!this.joinInfo||!this.key)throw new ue(K.UNEXPECTED_ERROR,"can not generate join message, no join info");let c=Object.assign({},this.joinInfo.apResponse),d=$("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var h;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ar.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,je(fh).call(fh,h)||fh.push(h);let p=U0(this.store),f=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),_=BL(this.store),v=Rae(),b=Xu(87)||X2()||p0(117),w=(function(){let U=At();if(U.name!==Lt.SAFARI||!U.browserVersion)return!1;let k=U.browserVersion.split(".");return Number(k[0])>18||Number(k[0])===18&&Number(k[1])>=4}()||eL(18,4,!1))&&m0(18,6,!0)&&this.spec.codec==="h264"&&$("ENABLE_ABSSENDTIME_AS_SENTTS"),T=Wr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Si,browser:navigator.userAgent,process_id:$("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:$("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:Wr(Wr({enableEncodedTransform:(!!$("ENABLE_AUDIO_METADATA")||!!$("ENABLE_AUDIO_PTS"))&&b||!!$("ENABLE_AUDIO_TOPN")&&u0(Lt.CHROME,87,116)||void 0,enableAudioMetadata:!!$("ENABLE_AUDIO_METADATA")&&b,enableAudioPts:!!$("ENABLE_AUDIO_PTS")&&b,topnSmoothLevel:$("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:$("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:$("TOPN_SWITCH_HOLD_MS"),topnAudioGain:$("TOPN_AUDIO_GAIN"),enablePublishedUserList:$("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:$("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:hi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:hi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:hi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:$("USE_PUB_RTX")===!0||$("USE_SUB_RTX")===!0||void 0,disableFEC:$("DISABLE_FEC"),enableNTPReport:!!$("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:_,enableFulllinkAvSync:!!$("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:hi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!$("FORCE_ENABLE_AUT_CC")||!Vv()&&(!!$("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!$("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:hi("USE_XR","boolean"),enableLossbasedBwe:hi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!$("FORCE_ENABLE_AUT_CC")||!Vv()&&(!!$("ENABLE_AUT_CC")||void 0),enableCCFallback:hi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:f,preSubNum:p?hi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:hi("PUBLISH_TWCC","boolean"),enableSubTWCC:hi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:hi("USE_PUB_RTX","boolean"),enableSubRTX:hi("USE_SUB_RTX","boolean"),enableSubSVC:$("ENABLE_SVC")?$("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0,enableSvcExtended:$("ENABLE_SVC")&&Array.isArray($("SVC_EXTENDED"))&&$("SVC_EXTENDED").length!==0?$("SVC_EXTENDED"):void 0},v),{},{audioDuplicate:hi("ENABLE_AUDIO_RED","boolean")?(a=hi("AUDIO_DUPLICATE_NUM","number"))!==null&&a!==void 0?a:2:void 0,senttsUsesAbsSendTime:!!w||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(T.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(T.aes_mode=this.joinInfo.aesmode,$("ENCRYPT_AES")?(T.aes_secret=this.joinInfo.aespassword,T.aes_encrypt=!0):T.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(T.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(T.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(T.default_video_stream=this.joinInfo.defaultVideoStream),T}getRejoinMessage(){if(!this.joinInfo)throw new ue(K.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ut.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ut.WS_RECONNECTING,t=>{this.joinInfo&&Qe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Sr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Qe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ut.WS_CLOSED,t=>{let s;switch(t){case Gt.LEAVE:s=Sr.LEAVE;break;case Gt.UID_BANNED:case Gt.IP_BANNED:case Gt.CHANNEL_BANNED:case Gt.SERVER_ERROR:s=Sr.SERVER_ERROR;break;case Gt.FALLBACK:s=Sr.FALLBACK;break;case Gt.LICENSE_MISSING:case Gt.LICENSE_EXPIRED:case Gt.LICENSE_MINUTES_EXCEEDED:case Gt.LICENSE_PERIOD_INVALID:case Gt.LICENSE_MULTIPLE_SDK_SERVICE:case Gt.LICENSE_ILLEGAL:case Gt.TOKEN_EXPIRE:s=t;break;default:s=Sr.NETWORK_ERROR}A.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Sr.NETWORK_ERROR)),this.joinInfo&&Qe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Gt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=t,t!==Gt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ut.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=$("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(A.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Qe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void A.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));$t("EVENT_REPORT_DOMAIN",t[1]),$t("EVENT_REPORT_BACKUP_DOMAIN",t[1]),$t("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Nt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ut.REQUEST_RECOVER,(t,s,a)=>{if(!this.joinInfo)return a(new ue(K.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Cr(this,ar.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on(ut.REQUEST_JOIN_INFO,async(t,s,a)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let p=Es((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if($("NEW_TURN_MODE")&&p&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var f;let w=p.servers.map(k=>"turnServerURL"in k&&$("USE_TURN_IP")?Wr(Wr({},k),{},{turnServerURL:cE(k.turnServerURL)}):k),T=(f=p.serversFromGateway)===null||f===void 0?void 0:f.map(k=>$("USE_TURN_IP")?Wr(Wr({},k),{},{turnServerURL:cE(k.turnServerURL)}):k),U=this.signal.currentURLIndex;w.length>0&&(w=[w[U%w.length]],p.servers=w),Array.isArray(T)&&T.length>0&&(T=[T[0]],p.serversFromGateway=T),A.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(U))}let{iceParameters:_,dtlsParameters:v,rtpCapabilities:b}=await Cr(this,ar.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:p,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:_,dtlsParameters:v,rtpCapabilities:b,version:"2"}}))}catch(w){s(w)}}),this.signal.on(ut.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ut.REPORT_JOIN_GATEWAY,(t,s)=>{if(!this.joinInfo)return;let a,c="";var d;t instanceof ue?(a=((d=t.data)===null||d===void 0?void 0:d.desc)||t.code,c=t.message):a=t,Qe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ut.IS_P2P_DISCONNECTED,t=>{t(Lm(this,ar.IS_P2P_DISCONNECTED))}),this.signal.on(ut.DISCONNECT_P2P,()=>{this.emit(ar.DISCONNECT_P2P)}),this.signal.on(ut.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ut.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ut.JOIN_RESPONSE,t=>{let s=this.getCurrentGatewayAddress();this.emit(ar.JOIN_RESPONSE,t,s)}),this.signal.on(ut.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,s;this.updateTurnConfigFromSignal();let c=this.getCurrentGatewayAddress(),d=Es((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if($("NEW_TURN_MODE")&&d&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var a;let p=d.servers.map(v=>"turnServerURL"in v&&$("USE_TURN_IP")?Wr(Wr({},v),{},{turnServerURL:cE(v.turnServerURL)}):v),f=(a=d.serversFromGateway)===null||a===void 0?void 0:a.map(v=>$("USE_TURN_IP")?Wr(Wr({},v),{},{turnServerURL:cE(v.turnServerURL)}):v),_=this.signal.currentURLIndex;p.length>0&&(p=[p[_%p.length]],d.servers=p),Array.isArray(f)&&f.length>0&&(f=[f[0]],d.serversFromGateway=f),A.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(_,",in pre pc"))}let h=$("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){let p=TU(c);this.emit(ar.PRE_CONNECT_PC,{candidates:p,fingerprint:h,turnServer:d})}}}),this.signal.on(ut.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof $("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat($("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,s){try{await this.signal.request(lt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[s]},!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(t,s){try{await this.signal.request(lt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw A.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(t,s){try{await this.signal.request(lt.UNPUBLISH,{stream_id:t,ortc:s},!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(t,s){try{await this.signal.request(lt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw A.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(t){let s={users:t.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(lt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(t,s){let a={action:t.find(c=>c.stream_type===Kt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:s};try{await this.signal.request(lt.CONTROL,a,!0,!0)}catch(c){throw A.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,s){let a={action:t.find(c=>c.stream_type===Kt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:s};try{await this.signal.request(lt.CONTROL,a,!0,!0)}catch(c){throw A.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,s){let a={action:t===ze.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(lt.CONTROL,a,!0,!0)}catch(c){throw A.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,s){let a={action:t===ze.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(lt.CONTROL,a,!0,!0)}catch(c){throw A.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,s){this.signal.upload(t,s)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(lt.RESTART_ICE,s,!0)}catch(a){throw A.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(t,s){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,s||Sr.P2P_FAILED)}getCurrentGatewayAddress(){var t,s;if(!$("GATEWAY_WSS_ADDRESS"))return $("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(A.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(lt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let fE=0,CC=0;function Ba(e,t,s,a){return new Ve((c,d)=>{t.timeout=t.timeout||$("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),fE+=Eo(t.data)):s&&(t.data.size?fE+=t.data.size:t.data instanceof FormData?fE+=gL(t.data):fE+=Eo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,dn.request(t).then(h=>{typeof h.data=="string"?CC+=Eo(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?CC+=h.data.byteLength:CC+=Eo(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{dn.isCancel(h)?d(new ue(K.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new ue(K.NETWORK_TIMEOUT,h.message)):h.response?d(new ue(K.NETWORK_RESPONSE_ERROR,h.response.status)):d(new ue(K.NETWORK_ERROR,h.message))})})}(function(){var e;function t(we){var Pe=0;return function(){return Pe<we.length?{done:!1,value:we[Pe++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(we,Pe,Ke){return we==Array.prototype||we==Object.prototype||(we[Pe]=Ke.value),we},a,c=function(we){we=[typeof globalThis=="object"&&globalThis,we,typeof window=="object"&&window,typeof self=="object"&&self,typeof l=="object"&&l];for(var Pe=0;Pe<we.length;++Pe){var Ke=we[Pe];if(Ke&&Ke.Math==Math)return Ke}throw Error("Cannot find global object")}(this);function d(we,Pe){if(Pe)e:{var Ke=c;we=we.split(".");for(var Te=0;Te<we.length-1;Te++){var j=we[Te];if(!(j in Ke))break e;Ke=Ke[j]}(Pe=Pe(Te=Ke[we=we[we.length-1]]))!=Te&&Pe!=null&&s(Ke,we,{configurable:!0,writable:!0,value:Pe})}}function h(we){return(we={next:we})[Symbol.iterator]=function(){return this},we}function p(we){var Pe=typeof Symbol<"u"&&Symbol.iterator&&we[Symbol.iterator];return Pe?Pe.call(we):{next:t(we)}}if(d("Symbol",function(we){function Pe(j,Q){this.A=j,s(this,"description",{configurable:!0,writable:!0,value:Q})}if(we)return we;Pe.prototype.toString=function(){return this.A};var Ke="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Te=0;return function j(Q){if(this instanceof j)throw new TypeError("Symbol is not a constructor");return new Pe(Ke+(Q||"")+"_"+Te++,Q)}}),d("Symbol.iterator",function(we){if(we)return we;we=Symbol("Symbol.iterator");for(var Pe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ke=0;Ke<Pe.length;Ke++){var Te=c[Pe[Ke]];typeof Te=="function"&&typeof Te.prototype[we]!="function"&&s(Te.prototype,we,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return we}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var f;e:{var _={};try{_.__proto__={a:!0},f=_.a;break e}catch{}f=!1}a=f?function(we,Pe){if(we.__proto__=Pe,we.__proto__!==Pe)throw new TypeError(we+" is not extensible");return we}:null}var v=a;function b(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function w(we){if(we.m)throw new TypeError("Generator is already running");we.m=!0}function T(we,Pe){return we.h=3,{value:Pe}}function U(we){this.g=new b,this.G=we}function k(we,Pe,Ke,Te){try{var j=Pe.call(we.g.j,Ke);if(!(j instanceof Object))throw new TypeError("Iterator result "+j+" is not an object");if(!j.done)return we.g.m=!1,j;var Q=j.value}catch(se){return we.g.j=null,we.g.s(se),F(we)}return we.g.j=null,Te.call(we.g,Q),F(we)}function F(we){for(;we.g.h;)try{var Pe=we.G(we.g);if(Pe)return we.g.m=!1,{value:Pe.value,done:!1}}catch(Ke){we.g.v=void 0,we.g.s(Ke)}if(we.g.m=!1,we.g.l){if(Pe=we.g.l,we.g.l=null,Pe.F)throw Pe.D;return{value:Pe.return,done:!0}}return{value:void 0,done:!0}}function z(we){this.next=function(Pe){return we.o(Pe)},this.throw=function(Pe){return we.s(Pe)},this.return=function(Pe){return function(Ke,Te){w(Ke.g);var j=Ke.g.j;return j?k(Ke,"return"in j?j.return:function(Q){return{value:Q,done:!0}},Te,Ke.g.return):(Ke.g.return(Te),F(Ke))}(we,Pe)},this[Symbol.iterator]=function(){return this}}function Y(we,Pe){return Pe=new z(new U(Pe)),v&&we.prototype&&v(Pe,we.prototype),Pe}if(b.prototype.o=function(we){this.v=we},b.prototype.s=function(we){this.l={D:we,F:!0},this.h=this.C||this.u},b.prototype.return=function(we){this.l={return:we},this.h=this.u},U.prototype.o=function(we){return w(this.g),this.g.j?k(this,this.g.j.next,we,this.g.o):(this.g.o(we),F(this))},U.prototype.s=function(we){return w(this.g),this.g.j?k(this,this.g.j.throw,we,this.g.o):(this.g.s(we),F(this))},d("Array.prototype.entries",function(we){return we||function(){return function(Pe,Ke){Pe instanceof String&&(Pe+="");var Te=0,j=!1,Q={next:function(){if(!j&&Te<Pe.length){var se=Te++;return{value:Ke(se,Pe[se]),done:!1}}return j=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q}(this,function(Pe,Ke){return[Pe,Ke]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var X=function(we,Pe){for(var Ke=0;Ke<we.length;Ke++)Pe(we[Ke])},re=function(we){return we.replace(/\r?\n|\r/g,`\r
`)},te=function(we,Pe,Ke){return Pe instanceof Blob?(Ke=Ke!==void 0?Ke+"":typeof Pe.name=="string"?Pe.name:"blob",Pe.name===Ke&&Object.prototype.toString.call(Pe)!=="[object Blob]"||(Pe=new File([Pe],Ke)),[String(we),Pe]):[String(we),String(Pe)]},Z=function(we,Pe){if(we.length<Pe)throw new TypeError(Pe+" argument required, but only "+we.length+" present.")},de=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,xe=de.FormData,Se=de.XMLHttpRequest&&de.XMLHttpRequest.prototype.send,Ae=de.Request&&de.fetch,yt=de.navigator&&de.navigator.sendBeacon,bt=de.Element&&de.Element.prototype,dt=de.Symbol&&Symbol.toStringTag;dt&&(Blob.prototype[dt]||(Blob.prototype[dt]="Blob"),"File"in de&&!File.prototype[dt]&&(File.prototype[dt]="File"));try{new File([],"")}catch{de.File=function(we,Pe,Ke){return we=new Blob(we,Ke||{}),Object.defineProperties(we,{name:{value:Pe},lastModified:{value:+(Ke&&Ke.lastModified!==void 0?new Date(Ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),dt&&Object.defineProperty(we,dt,{value:"File"}),we}}var Wt=function(we){return we.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ut=function(we){this.i=[];var Pe=this;we&&X(we.elements,function(Ke){if(Ke.name&&!Ke.disabled&&Ke.type!=="submit"&&Ke.type!=="button"&&!Ke.matches("form fieldset[disabled] *"))if(Ke.type==="file"){var Te=Ke.files&&Ke.files.length?Ke.files:[new File([],"",{type:"application/octet-stream"})];X(Te,function(j){Pe.append(Ke.name,j)})}else Ke.type==="select-multiple"||Ke.type==="select-one"?X(Ke.options,function(j){!j.disabled&&j.selected&&Pe.append(Ke.name,j.value)}):Ke.type==="checkbox"||Ke.type==="radio"?Ke.checked&&Pe.append(Ke.name,Ke.value):(Te=Ke.type==="textarea"?re(Ke.value):Ke.value,Pe.append(Ke.name,Te))})};if((e=Ut.prototype).append=function(we,Pe,Ke){Z(arguments,2),this.i.push(te(we,Pe,Ke))},e.delete=function(we){Z(arguments,1);var Pe=[];we=String(we),X(this.i,function(Ke){Ke[0]!==we&&Pe.push(Ke)}),this.i=Pe},e.entries=function we(){var Pe,Ke=this;return Y(we,function(Te){if(Te.h==1&&(Pe=0),Te.h!=3)return Pe<Ke.i.length?Te=T(Te,Ke.i[Pe]):(Te.h=0,Te=void 0),Te;Pe++,Te.h=2})},e.forEach=function(we,Pe){Z(arguments,1);for(var Ke=p(this),Te=Ke.next();!Te.done;Te=Ke.next()){var j=p(Te.value);Te=j.next().value,j=j.next().value,we.call(Pe,j,Te,this)}},e.get=function(we){Z(arguments,1);var Pe=this.i;we=String(we);for(var Ke=0;Ke<Pe.length;Ke++)if(Pe[Ke][0]===we)return Pe[Ke][1];return null},e.getAll=function(we){Z(arguments,1);var Pe=[];return we=String(we),X(this.i,function(Ke){Ke[0]===we&&Pe.push(Ke[1])}),Pe},e.has=function(we){Z(arguments,1),we=String(we);for(var Pe=0;Pe<this.i.length;Pe++)if(this.i[Pe][0]===we)return!0;return!1},e.keys=function we(){var Pe,Ke,Te,j,Q=this;return Y(we,function(se){if(se.h==1&&(Pe=p(Q),Ke=Pe.next()),se.h!=3)return Ke.done?void(se.h=0):(Te=Ke.value,j=p(Te),T(se,j.next().value));Ke=Pe.next(),se.h=2})},e.set=function(we,Pe,Ke){Z(arguments,2),we=String(we);var Te=[],j=te(we,Pe,Ke),Q=!0;X(this.i,function(se){se[0]===we?Q&&(Q=!Te.push(j)):Te.push(se)}),Q&&Te.push(j),this.i=Te},e.values=function we(){var Pe,Ke,Te,j,Q=this;return Y(we,function(se){if(se.h==1&&(Pe=p(Q),Ke=Pe.next()),se.h!=3)return Ke.done?void(se.h=0):(Te=Ke.value,(j=p(Te)).next(),T(se,j.next().value));Ke=Pe.next(),se.h=2})},Ut.prototype._asNative=function(){for(var we=new xe,Pe=p(this),Ke=Pe.next();!Ke.done;Ke=Pe.next()){var Te=p(Ke.value);Ke=Te.next().value,Te=Te.next().value,we.append(Ke,Te)}return we},Ut.prototype._blob=function(){var we="----formdata-polyfill-"+Math.random(),Pe=[],Ke="--"+we+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Te,j){return typeof Te=="string"?Pe.push(Ke+Wt(re(j))+`"\r
\r
`+re(Te)+`\r
`):Pe.push(Ke+Wt(re(j))+'"; filename="'+Wt(Te.name)+`"\r
Content-Type: `+(Te.type||"application/octet-stream")+`\r
\r
`,Te,`\r
`)}),Pe.push("--"+we+"--"),new Blob(Pe,{type:"multipart/form-data; boundary="+we})},Ut.prototype[Symbol.iterator]=function(){return this.entries()},Ut.prototype.toString=function(){return"[object FormData]"},bt&&!bt.matches&&(bt.matches=bt.matchesSelector||bt.mozMatchesSelector||bt.msMatchesSelector||bt.oMatchesSelector||bt.webkitMatchesSelector||function(we){for(var Pe=(we=(this.document||this.ownerDocument).querySelectorAll(we)).length;0<=--Pe&&we.item(Pe)!==this;);return-1<Pe}),dt&&(Ut.prototype[dt]="FormData"),Se){var Lr=de.XMLHttpRequest.prototype.setRequestHeader;de.XMLHttpRequest.prototype.setRequestHeader=function(we,Pe){Lr.call(this,we,Pe),we.toLowerCase()==="content-type"&&(this.B=!0)},de.XMLHttpRequest.prototype.send=function(we){we instanceof Ut?(we=we._blob(),this.B||this.setRequestHeader("Content-Type",we.type),Se.call(this,we)):Se.call(this,we)}}Ae&&(de.fetch=function(we,Pe){return Pe&&Pe.body&&Pe.body instanceof Ut&&(Pe.body=Pe.body._blob()),Ae.call(this,we,Pe)}),yt&&(de.navigator.sendBeacon=function(we,Pe){return Pe instanceof Ut&&(Pe=Pe._asNative()),yt.call(this,we,Pe)}),de.FormData=Ut}})();let Zm=()=>{let e=$("AREAS");return e.length===0&&e.push(Vt.GLOBAL),Ki(e).call(e,(t,s,a)=>{let c=UU(s);return c?a===0?c:"".concat(t,",").concat(c):t},"")},UU=e=>e===Vt.OVERSEA?"".concat(jr.ASIA,",").concat(jr.EUROPE,",").concat(jr.AFRICA,",").concat(jr.NORTH_AMERICA,",").concat(jr.SOUTH_AMERICA,",").concat(jr.OCEANIA):jr[e],Iae=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(s=>{let a=aE[s],c=Object.keys(a);c&&c.map(d=>{d!=="CODE"&&(t[d]=t[d].concat(a[d]))})}),t},gE={GLOBAL:{ASIA:[Vt.CHINA,Vt.JAPAN,Vt.INDIA,Vt.KOREA,Vt.HKMC],EUROPE:[],NORTH_AMERICA:[Vt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},_E=Object.keys(gE[Vt.GLOBAL]),TC=[Vt.CHINA,Vt.NORTH_AMERICA,Vt.EUROPE,Vt.ASIA,Vt.JAPAN,Vt.INDIA,Vt.OCEANIA,Vt.SOUTH_AMERICA,Vt.AFRICA,Vt.KOREA,Vt.HKMC,Vt.US],Dae=function(e,t){let s=[];if(je(e).call(e,Vt.GLOBAL)){let d=[Vt.GLOBAL,Vt.OVERSEA],h=Object.keys(aE);if(t===Vt.GLOBAL)throw new ue(K.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Vt.CHINA)s=[Vt.OVERSEA];else if(c=t,je(_E).call(_E,c)){let p=(a=t,gE[Vt.GLOBAL][a]||[]),f=[...d,t,...p];s=h.filter(_=>!je(f).call(f,_))}else if(function(p){let f=!1;return _E.forEach(_=>{var v;je(v=gE[Vt.GLOBAL][_]).call(v,p)&&(f=!0)}),f}(t)){let p=function(_){let v;return _E.forEach(b=>{var w;je(w=gE[Vt.GLOBAL][b]).call(w,_)&&(v=b)}),v}(t),f=[...d,p,t];s=h.filter(_=>!je(f).call(f,_))}else s=e;s=function(p){let f=[];return TC.forEach(_=>{je(p).call(p,_)&&f.push(_)}),f.concat(p.filter(_=>!je(TC).call(TC,_)))}(s)}else s=e;var a,c;return s};function VU(e){var t,s;if(!e&&je(t=$("AREAS")).call(t,Vt.EXTENSIONS))return A.debug("update area from ap : reset"),void NC(Uie,!0);if(!je(s=$("AREAS")).call(s,Vt.GLOBAL)||!e)return;let a=aE.EXTENSIONS;a&&(a={CODE:UU(Vt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},A.debug("update area from ap success: ".concat(e,",config is "),a),$t("AREAS",[Vt.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?$t(c,a[c][0]):$t(c,a[c])}))}function NC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=Qe.reportApiInvoke(null,{name:Os.SET_AREA,options:e,tag:vs.TRACER});try{let a=[];if(typeof e=="string"&&(a=[e]),Array.isArray(e)&&(e.forEach(d=>{if(!je(oU).call(oU,d))throw new ue(K.INVALID_PARAMS,"invalid area code")}),a=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:d,excludedArea:h}=e;if(!d)throw new ue(K.INVALID_PARAMS,"area code is needed");let p=d;typeof d=="string"&&(p=[d]),a=h?Dae(p,h):p}if(!t){if(Ma.AREAS){let d=new ue(K.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void A.warning("setArea is prohibited because of config-distribute")}if(je(a).call(a,Vt.GLOBAL)&&$("AREAS")===Vt.EXTENSIONS){let d=new ue(K.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void A.warning("setArea is prohibited because of ap extensions")}}$t("AREAS",a,t);let c=Iae(a);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?$t(d,c[d][0]):$t(d,c[d])}),A.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function BU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Co(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?BU(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):BU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let RC=1;function Oae(e,t,s,a,c){RC+=1;let d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:RC,requestId:RC,version:Si,cname:s.cname},h={service_name:t,json_body:JSON.stringify(d)},p,f,_=e[0];return La(async()=>{p=Date.now();let v=await Ba(_,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(f=Date.now()-p,v.code!==0){let T=new ue(K.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:f});throw A.error(T.toString()),T}let b=JSON.parse(v.json_body);if(b.code!==200){let T=new ue(K.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(b.code,", reason: ").concat(b.reason),{code:b.code,responseTime:f});throw A.error(T.toString()),T}if(!b.servers||b.servers.length===0){let T=new ue(K.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:b.code,responseTime:f});throw A.error(T.toString()),T}let w=function(T,U){return{addressList:T.servers.map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(k.wss,"?serviceName=").concat(encodeURIComponent(U))),workerToken:T.workerToken,vid:T.vid}}(b,t);return $("LIVE_STREAMING_ADDRESS")&&(w.addressList=$("LIVE_STREAMING_ADDRESS")instanceof Array?$("LIVE_STREAMING_ADDRESS"):[$("LIVE_STREAMING_ADDRESS")]),Co(Co({},w),{},{responseTime:f})},(v,b)=>(Qe.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(v.addressList),firstSuccess:b===0,responseTime:f,serverIp:e[b%e.length]}),!1),(v,b)=>(Qe.apworkerEvent(s.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:t,responseTime:f,serverIp:e[b%e.length]}),!!(v.code!==K.OPERATION_ABORTED&&v.code!==K.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(_=e[(b+1)%e.length],!0)),c)}let AC=1;function WU(e,t,s,a){let{url:c,areaCode:d}=e,{clientId:h,sid:p}=t,f=Date.now(),_,v=t.role,[b,w]=DC(t,d,[Us.CHOOSE_SERVER]),T=Fs.networkState;return La(async()=>{T&&Fs.networkState===Vn.OFFLINE&&Fs.onlineWaiter&&await Ve.race([Fs.onlineWaiter,pr(a&&a.maxRetryTimeout||Hs.maxRetryTimeout)]),T=Fs.networkState;let{data:U,headers:k}=await Ba(c,{data:b,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=k.http3==="1"?1:-1,Qe.reportResourceTiming(c,p),HU(U,c,t,f,[Us.CHOOSE_SERVER],_);let F=$m(U,Us.CHOOSE_SERVER);return IC(F),yC(F,c)},U=>(U&&Qe.joinChooseServer(p,{role:v,lts:f,succ:!0,csAddr:c,opid:w,serverList:U.gatewayAddrs.map(k=>k.address),ec:null,cid:U.cid.toString(),uid:U.uid.toString(),csIp:U.csIp,unilbsServerIds:[Us.CHOOSE_SERVER].toString(),isHttp3:_,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:U.res.detail&&U.res.detail[38]}),!1),U=>U.code!==K.OPERATION_ABORTED&&(U.code===K.CAN_NOT_GET_GATEWAY_SERVER?U.data.retry:(Qe.joinChooseServer(p,{role:v,lts:f,succ:!1,csAddr:c,serverList:null,opid:w,ec:U.code,csIp:U.data&&U.data.csIp,unilbsServerIds:[Us.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:T}),isHttp3:_,corssRegionTagReq:t.apRequestDetail}),A.warning("[".concat(h||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),U),!0)),a)}function GU(e,t,s,a){let c,{url:d,areaCode:h,serviceIds:p}=e,f=Date.now(),_=t.role,[v,b]=DC(t,h,p),w;return La(async()=>{w&&Fs.networkState===Vn.OFFLINE&&Fs.onlineWaiter&&await Ve.race([Fs.onlineWaiter,pr(a&&a.maxRetryTimeout||Hs.maxRetryTimeout)]),w=Fs.networkState;let{data:T,headers:U}=await Ba(d,{data:v,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=U.http3==="1"?1:-1,Qe.reportResourceTiming(d,t.sid),HU(T,d,t,f,p,c);let k=$m(T,Us.CHOOSE_SERVER),F=$m(T,t.cloudProxyServer==="proxy5"?Us.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Us.CLOUD_PROXY:Us.CLOUD_PROXY_FALLBACK),z=performance.getEntriesByName(d),Y=z[z.length-1],X;return Y&&(X={name:Y.name,protocol:"nextHopProtocol"in Y?Y.nextHopProtocol:"",dnscost:"domainLookupEnd"in Y&&"domainLookupStart"in Y&&typeof Y.domainLookupEnd=="number"&&typeof Y.domainLookupStart=="number"?Y.domainLookupEnd-Y.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Y&&"connectStart"in Y&&typeof Y.connectEnd=="number"&&typeof Y.connectStart=="number"?Y.connectEnd-Y.connectStart:-1,reqCost:"requestStart"in Y&&typeof Y.requestStart=="number"&&"responseEnd"in Y&&typeof Y.responseEnd=="number"?Y.responseEnd-Y.requestStart:-1,handleCost:"leave_ts"in T&&"enter_ts"in T&&typeof T.leave_ts=="number"&&typeof T.enter_ts=="number"?T.leave_ts-T.enter_ts:-1}),IC(k),{gatewayInfo:yC(k,d),proxyInfo:F,url:d,resourceTimingInfo:X}},T=>(T.gatewayInfo&&Qe.joinChooseServer(t.sid,{role:_,lts:f,succ:!0,csAddr:d,serverList:T.gatewayInfo.gatewayAddrs.map(U=>U.address),ec:null,opid:b,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:T.gatewayInfo.res.detail&&T.gatewayInfo.res.detail[38],resourceTimingInfo:T.resourceTimingInfo?JSON.stringify(T.resourceTimingInfo):void 0}),T.proxyInfo&&Qe.joinWebProxyAP(t.sid,{lts:f,sucess:1,apServerAddr:d,turnServerAddrList:T.proxyInfo.addresses.map(U=>U.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:p.toString()}),!1),T=>T.code!==K.OPERATION_ABORTED&&(T.code===K.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(Qe.joinWebProxyAP(t.sid,{lts:f,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:T.code,eventType:t.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:w})}),A.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),T),!0)),a)}let HU=(e,t,s,a,c,d)=>{let{sid:h,clientId:p,cloudProxyServer:f}=s,_=[],v=b=>{b.flag===4096?Qe.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:b.error.message,csIp:b.error.data&&b.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):b.flag!==1048576&&b.flag!==4194304&&b.flag!==4194310||Qe.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:b.error.code,eventType:f,unilbsServerIds:c.toString()})};if(e.response_body.forEach(b=>{let w=b.buffer.code;if(b.uri===23&&w===0&&!b.buffer.edges_services)if(b.buffer.flag===4194310)A.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),b.buffer.edges_services=[];else{let T={error:new ue(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:b.buffer.flag};_.push(T),v(T)}if(w!==0){let T=Eh(w),U={error:new ue(K.CAN_NOT_GET_GATEWAY_SERVER,T.desc,{desc:T.desc,retry:T.retry,csIp:e.detail[502]}),flag:b.buffer.flag};b.buffer.flag===4194310?A.warning(U.error.toString()):_.push(U),v(U)}}),_.length)throw A.warning("[".concat(p||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(_.map(b=>"flag: ".concat(b.flag,", message: ").concat(b.error.message,", retry: ").concat(b.error.data.retry)).join(" | "))),new ue(K.CAN_NOT_GET_GATEWAY_SERVER,_.map(b=>"flag: ".concat(b.flag,", message: ").concat(b.error.message)).join(" | "),{retry:!!_.find(b=>b.error.data.retry),csIp:e.detail[502],desc:[...new Set(_.map(b=>{var w;return b==null||(w=b.error)===null||w===void 0||(w=w.data)===null||w===void 0?void 0:w.desc}).filter(b=>!!b))]})},IC=e=>{var t,s,a,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ue(K.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if($("AP_AREA")&&((a=e.detail)!==null&&a!==void 0&&a[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?VU(e.detail[23].toLowerCase()):VU()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((s=e.detail)===null||s===void 0?void 0:s[19])=="string"){let h=e.detail[19],p=h==null?void 0:h.split(";");for(let f=0;f<p.length;f++){var d;let _=Kr(d=p[f]).call(d);e.addresses[f]&&p&&(e.addresses[f].fingerprint=_)}}if($("GATEWAY_ADDRESS")&&$("GATEWAY_ADDRESS").length>0){A.debug("assign gateway address to",$("GATEWAY_ADDRESS"));let h=$("GATEWAY_ADDRESS").map(p=>{var f,_;let v=(f=(_=e.addresses.find(b=>b.ip===p.ip&&b.port===p.port))===null||_===void 0?void 0:_.fingerprint)!==null&&f!==void 0?f:"";return{ip:p.ip,port:p.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:v}});e.addresses=h}},jae=(e,t)=>{if(e.response_body&&e.response_body.length){let s=e.response_body[0];if(s.buffer.code!==0){let a=Eh(s.buffer.code);throw new ue(K.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw A.debug("update ticket request received ap response without response body:",t),new ue(K.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},DC=(e,t,s)=>{let a=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,d={appid:e.appId,client_ts:Date.now(),opid:a,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Co(Co(Co({6:e.stringUid,11:t,12:$("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:s,uid:e.uid||0}}]};d.request_bodies.forEach(p=>{e.multiIP&&e.multiIP.gateway_ip&&(p.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},Pae=(e,t)=>{let s=Math.floor(Math.random()*1e12),a={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]},wh=0;function Sh(e){return Ve.all(e.map(t=>t.then(s=>{throw s},s=>s))).then(t=>{throw t},t=>t)}let ef=async e=>{let{fragementLength:t,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=e,h=0,p=t,f,_=0,v=async()=>{let b=(()=>{let w=h*p,T=w+p;return s.slice(w,T).map(a)})();d&&d.push(...b);try{f=await Sh(b)}catch(w){if(_+=p,h++,!(_>=s.length))return void await v();c(w)}b.forEach(w=>w.cancel())};return await v(),f},zU=async e=>{let{referenceList:t,asyncMapHandler:s,closeFn:a}=e,c=t.length,d=0,h=async()=>{let p=s(t.shift());try{return await p}catch(f){if(d++,d>=c||a!=null&&a(f))throw f;return h()}};return h()};async function kae(){if(typeof VideoDecoder>"u")return!0;let e,t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],a=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Ve((p,f)=>{let _;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:b=>{b.close(),clearTimeout(_),p(!0)},error:b=>{clearTimeout(_),p(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();let v=[t,s,a,c,d,h];for(let b=0;b<v.length;b++){let w=new EncodedVideoChunk({type:b==0?"key":"delta",timestamp:33333*b,duration:33333,data:new Uint8Array(v[b])});try{await e.decode(w)}catch{return void p(!1)}}})(),_=setTimeout(()=>{p(!1)},5e3)})}async function OC(e,t,s,a){return{gatewayInfo:await async function(c,d,h,p){let f=null,_=[],v=async()=>{let w=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(k=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Zm()})),T=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(k=>k.url)}),U=await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:k=>(A.debug("[".concat(c.clientId,"] Connect to choose_server:"),k.url),WU(k,c,d,h)),allFailedhandler:k=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},T),k[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},T),U},b=async()=>{if(await pr(1e3),f!==null)return f;let w=$("WEBCS_DOMAIN_BACKUP_LIST").map(k=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Zm()})),T=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:w.map(k=>k.url)}),U=await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:k=>(A.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),k.url),WU(k,c,d,h)),allFailedhandler:k=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},T),k[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},T),U};try{return f=await Sh([v(),b()]),_.length&&_.forEach(w=>w.cancel&&typeof w.cancel=="function"&&w.cancel()),f}catch(w){throw w[0]}}(e,t,s,a)}}async function KU(e,t,s,a,c){let d=e.cloudProxyServer;if(d==="disabled"){if(e.useLocalAccessPoint)return await OC(e,t,s,c);if($("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:w,proxyInfo:T}=await $U(e,t,s,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:w};let U=T.map(k=>({turnServerURL:k.address,tcpport:k.tcpport||Tr.tcpport,udpport:k.udpport||Tr.udpport,username:k.username||Tr.username,password:k.password||Tr.password,forceturn:!1,security:!0}));if(c.useP2P){var h;let k=(h=e.uid)!==null&&h!==void 0?h:w.uid,F="glb:".concat(k.toString()),z=await x0(F),Y=T.map(X=>({turnServerURL:X.address,tcpport:X.tcpport||Tr.tcpport,udpport:X.udpport||Tr.udpport,username:F,password:z,forceturn:!1,security:!0}));U.push(...Y)}return e.turnServer={mode:"manual",servers:U},{gatewayInfo:w}}return await OC(e,t,s,c)}let{proxyInfo:p,gatewayInfo:f}=await $U(e,t,s,c),_={gatewayInfo:f},v=p.map(w=>({turnServerURL:w.address,tcpport:d==="proxy3"?void 0:w.tcpport?w.tcpport:Tr.tcpport,udpport:d==="proxy4"?void 0:w.udpport?w.udpport:Tr.udpport,username:w.username||Tr.username,password:w.password||Tr.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var b;let w=(b=e.uid)!==null&&b!==void 0?b:f.uid,T="glb:".concat(w.toString()),U=await x0(T),k=p.map(F=>({turnServerURL:F.address,tcpport:d==="proxy3"?void 0:F.tcpport||Tr.tcpport,udpport:d==="proxy4"?void 0:F.udpport||Tr.udpport,username:T,password:U,forceturn:d!=="proxy4",security:d==="proxy5"}));v.push(...k)}return e.turnServer={mode:"manual",servers:v},A.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(d)),_}async function qU(e,t,s,a,c){let d=$("ACCOUNT_REGISTER").slice(0,$("AJAX_REQUEST_CONCURRENT")),h=[];h=t.proxyServer?d.map(f=>"https://".concat(t.proxyServer,"/ap/?url=").concat(f+"/api/v1")):d.map(f=>"https://".concat(f,"/api/v1"));let p=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{let f=await async function(_,v,b,w,T){let U=Date.now(),k={sid:b.sid,opid:10,appid:b.appId,string_uid:v},F=_[0],z=await La(()=>Ba(F+"".concat(F.indexOf("?")===-1?"?":"&","action=stringuid"),{data:k,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,X)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw A.error("Invalid Uint Uid ".concat(v," => ").concat(Y.uid),Y),Qe.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:F,stringUid:k.string_uid,uid:Y.uid,errorCode:K.INVALID_UINT_UID_FROM_STRING_UID,extend:k}),new ue(K.INVALID_UINT_UID_FROM_STRING_UID);return Qe.reqUserAccount(k.sid,{lts:U,success:!0,serverAddr:F,stringUid:k.string_uid,uid:Y.uid,errorCode:null,extend:k}),!1}let re=Eh(Y.code);return re.retry&&(F=_[(X+1)%_.length]),Qe.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:F,stringUid:k.string_uid,uid:Y.uid,errorCode:re.desc,extend:k}),re.retry},(Y,X)=>Y.code!==K.OPERATION_ABORTED&&(Qe.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:F,stringUid:k.string_uid,uid:null,errorCode:Y.code,extend:k}),F=_[(X+1)%_.length],!0),T);if(z.code!==0){let Y=Eh(z.code);throw new ue(K.UNEXPECTED_RESPONSE,Y.desc)}return z}(h,e,t,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},p),f.uid}catch(f){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[f]},p),f}}async function Lae(e,t,s){let a=$("ACCOUNT_REGISTER"),c=[];c=t.proxyServer?a.map(d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));try{return await zU({referenceList:c,asyncMapHandler:d=>async function(h,p,f,_){let v=Date.now(),b={sid:f.sid,opid:10,appid:f.appId,string_uid:p};try{let w=await Ba(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:b,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(w.code!==0){let T=Eh(w.code);throw new ue(K.UNEXPECTED_RESPONSE,"preload sua error:".concat(T.desc),T)}if(w.uid<=0||w.uid>=Math.pow(2,32))throw new ue(K.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:v,url:h,req:b,uid:w.uid,elapse:Date.now()-v}}catch(w){throw w}}(d,e,t,s),closeFn:d=>d.code===K.OPERATION_ABORTED||d.code===K.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(d){throw d}}async function Mae(e,t,s){let a=$("CDS_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(f=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")),c=a.map(f=>function(_,v,b,w){let T=At(),U={flag:64,cipher_method:0,features:Co(Co(Co(Co(Co({install_id:O0(),device:T.name,system:T.os,system_general:navigator.userAgent,vendor:v.appId,version:Si,cname:v.cname,session_id:v.sid,proxyServer:v.proxyServer,sdk_type:Nae.WEB_RTC,browser_name:T.name,browser_version:T.version,user_agent:navigator.userAgent,channel_name:v.cname},v.stringUid&&{string_uid:v.stringUid}),v.uid&&{uid:v.uid+""}),T.os&&{os_name:T.os}),T.osVersion&&{os_version:T.osVersion}),{},{detail:""})};return La(()=>Ba(_,{data:U,timeout:1e3,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,k=>k.code!==K.OPERATION_ABORTED,w)}(f,e,t,s)),d=null,h=null,p={};try{d=await Sh(c)}catch(f){if(f.code===K.OPERATION_ABORTED)throw f;h=f}if(c.forEach(f=>f.cancel()),Qe.reportApiInvoke(e.sid,{name:Os.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{p=function(f){if(!f.test_tags)return{};let _=f.test_tags,v=Object.keys(_),b={};return v.forEach(w=>{var T;let U=Kr(T=w.slice(4)).call(T),k=JSON.parse(_[w]),F=k[1];b[U]={tag:k[0]||"",value:F}}),b}(d)}catch{}return p}async function YU(e,t){let s=$("WEBCS_DOMAIN").concat($("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:Zm(),serviceIds:[Us.CHOOSE_SERVER,Us.CLOUD_PROXY_FALLBACK]}));try{return await zU({referenceList:s,asyncMapHandler:a=>async function(c,d,h){let p,{url:f,areaCode:_,serviceIds:v}=c,b=Date.now(),[w,T]=DC(d,_,v),U=Fs.networkState;try{U&&Fs.networkState===Vn.OFFLINE&&Fs.onlineWaiter&&await Ve.race([Fs.onlineWaiter,pr(Hs.maxRetryTimeout)]),U=Fs.networkState;let{data:k,headers:F}=await Ba(f,{data:w,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=F.http3==="1"?1:-1,(X=>{let re=[];if(X.response_body.forEach(te=>{let Z=te.buffer.code;if(te.uri===23&&Z===0&&!te.buffer.edges_services)if(te.buffer.flag===4194310)te.buffer.edges_services=[];else{let de={error:new ue(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:X.detail[502]}),flag:te.buffer.flag};re.push(de)}if(Z!==0){let de=Eh(Z),xe={error:new ue(K.CAN_NOT_GET_GATEWAY_SERVER,de.desc,{desc:de.desc,retry:de.retry,csIp:X.detail[502]}),flag:te.buffer.flag};te.buffer.flag===4194310?A.warning(xe.error.toString()):re.push(xe)}}),re.length)throw new ue(K.CAN_NOT_GET_GATEWAY_SERVER,re.map(te=>"flag: ".concat(te.flag,", message: ").concat(te.error.message)).join(" | "),{retry:!!re.find(te=>te.error.data.retry),csIp:X.detail[502],desc:[...new Set(re.map(te=>{var Z;return te==null||(Z=te.error)===null||Z===void 0||(Z=Z.data)===null||Z===void 0?void 0:Z.desc}).filter(te=>!!te))]})})(k);let z=$m(k,Us.CHOOSE_SERVER),Y=$m(k,Us.CLOUD_PROXY_FALLBACK);return IC(z),{gatewayInfo:yC(z,f),proxyInfo:Y,opid:T,requestTime:b,url:f,isHttp3:p,elapse:Date.now()-b}}catch(k){throw k}}(a,e,t),closeFn:a=>a.code===K.OPERATION_ABORTED||a.code===K.CAN_NOT_GET_GATEWAY_SERVER&&!a.data.retry})}catch(a){throw a}}async function $U(e,t,s,a){let c=$("PROXY_SERVER_TYPE3"),d=(T,U,k)=>{let F=k||c;return Array.isArray(F)&&(F=U%2==0&&c[1]||c[0]),"https://".concat(F,"/ap/?url=").concat(T)},h=null,p=[],f=async()=>{let T=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map((F,z)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(F,"/api/v2/transpond/webrtc?v=2"),z,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(F,"/api/v2/transpond/webrtc?v=2"):d("".concat(F,"/api/v2/transpond/webrtc?v=2"),z),{url:Y,areaCode:Zm(),serviceIds:[Us.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Us.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Us.CLOUD_PROXY:Us.CLOUD_PROXY_FALLBACK]}}),U=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(F=>F.url)}),k=await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:F=>(A.debug("[".concat(e.clientId,"] Connect to choose_server:"),F.url),GU(F,e,t,s)),allFailedhandler:F=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},U),F[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},_=async()=>{if(await pr(1e3),h!==null)return h;let T=$("WEBCS_DOMAIN_BACKUP_LIST").map((F,z)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(F,"/api/v2/transpond/webrtc?v=2"),z,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(F,"/api/v2/transpond/webrtc?v=2"):d("".concat(F,"/api/v2/transpond/webrtc?v=2"),z),{url:Y,areaCode:Zm(),serviceIds:[Us.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Us.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Us.CLOUD_PROXY:Us.CLOUD_PROXY_FALLBACK]}}),U=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(F=>F.url)}),k=await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:F=>(A.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),F.url),GU(F,e,t,s)),allFailedhandler:F=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},U),F[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},v,b,w;try{({gatewayInfo:v,proxyInfo:b,url:w}=await Sh([f(),_()]))}catch(T){throw T[0]}if(p.length&&p.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!v||!b)throw new ue(K.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=w,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&w){let T=/^https?:\/\/(.+?)(\/.*)?$/.exec(w)[1];je(c).call(c,T)&&(e.proxyServer=T,A.setProxyServer(T),Qe.setProxyServer(T))}return h={gatewayInfo:v,proxyInfo:await EU(b,v.uid)},h}async function Fae(e,t,s){let a=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=a.map(d=>function(h,p,f,_){let v={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:Si,cname:p.cname,uid:p.uid.toString(),requestId:AC,seq:AC};AC+=1;let b={service_name:"tele_channel",json_body:JSON.stringify(v)};return La(async()=>{let w=await Ba(h,{data:b,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(w.code!==0){let U=new ue(K.UNEXPECTED_RESPONSE,"cross channel ap error, code"+w.code,{retry:!0});throw A.error(U.toString()),U}let T=JSON.parse(w.json_body);if(T.code!==200){let U=new ue(K.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw A.error(U.toString()),U}if(!T.servers||T.servers.length===0){let U=new ue(K.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw A.error(U.toString()),U}return{vid:T.vid,workerToken:T.workerToken,addressList:($("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(U.wss))}},void 0,w=>!!(w.code!==K.OPERATION_ABORTED&&w.code!==K.UNEXPECTED_RESPONSE||w.data&&w.data.retry),_)}(d,e,t,s));try{let d=await Sh(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function Uae(e,t,s){let a=null,c=[],d=async h=>{let p=$(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(f=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(f+"/api/v2/transpond/webrtc?v=2"):"https://".concat(f,"/api/v2/transpond/webrtc?v=2"));return h&&(await pr(1e3),a!==null)?a:await ef({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:f=>(A.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),f),function(_,v,b,w){let[T]=Pae(v,[Us.CHOOSE_SERVER]),U=Fs.networkState;return La(async()=>{U&&Fs.networkState===Vn.OFFLINE&&Fs.onlineWaiter&&await Ve.race([Fs.onlineWaiter,pr(w&&w.maxRetryTimeout||Hs.maxRetryTimeout)]),U=Fs.networkState;let k=await Ba(_,{data:T,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return jae(k,_)},()=>!1,k=>k.code!==K.OPERATION_ABORTED&&(k.code===K.UPDATE_TICKET_FAILED?k.data.retry:(A.warning("[".concat(v.clientId,"] update ticket network error, retry"),k),!0)),w)}(f,e,t,s)),allFailedhandler:f=>{throw f[0]},promisesCollector:c})};try{return a=await Sh([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function XU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function jC(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?XU(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):XU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class Vae extends bs{get isSuccess(){return!!this.configs}constructor(t,s){super(),B(this,"configs",void 0),B(this,"store",void 0),B(this,"joinInfo",void 0),B(this,"cancelToken",void 0),B(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),B(this,"interval",void 0),B(this,"mutex",void 0),B(this,"mutableParamsRead",!1),B(this,"configCache",{}),B(this,"limit_bitrate",void 0),this.mutex=new Dr("config-distribute",t),this.store=s}startGetConfigDistribute(t,s){this.joinInfo=t,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),$("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},$("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Qe.reportApiInvoke(null,{options:void 0,name:Os.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:vs.TRACER}).onSuccess(JSON.stringify(Ma))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void A.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,s=await this.mutex.lock();try{t=await Mae(this.joinInfo,this.cancelToken,this.retryConfig),A.debug("[config-distribute] get config distribute",JSON.stringify(t));let a=function(c){var d;let h=Ql(d=Object.keys(c).filter(_=>/^webrtc_ng_global_parameter/.test(_))).call(d);for(let _=0;_<h.length;_++)for(let v=h.length-1;v>_;v--){let b=h[v],w=c[b].value;if(typeof w.__priority=="number"){let T=w.__priority,U=h[v-1],k=c[U].value;if(typeof k.__priority=="number"){if(!(T>k.__priority))continue;{let F=b;h[v]=h[v-1],h[v-1]=F}}else{let F=b;h[v]=h[v-1],h[v-1]=F}}}let p=Date.now(),f={};return h.forEach(_=>{let v=c[_].value.__expires;v&&v<=p||(f[_]=c[_])}),f}(t);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){let c=new ue(K.NETWORK_RESPONSE_ERROR,a);A.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){cU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Km.UPDATE_BITRATE_LIMIT,t):this.emit(Km.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&jC({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let s={},a=Object.keys(t),c=[];a.forEach(d=>{let h=t[d].value;s[d]=h;let p=h.__id;if(p&&this.configCache[d]&&this.configCache[d].__id===p)return;let f=h.__type,_=t[d].value,v=t[d].tag,b=0;f?f===OL.REALTIME&&(b=1):Object.keys(_).some(w=>Object.prototype.hasOwnProperty.call(L0,w)||!lC()&&Object.prototype.hasOwnProperty.call(Fv,w)?(b=1,!0):void 0),c.push({tag:v,isApplied:b,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:p,params:f,isApplied:_}=d;this.store.sessionId&&Qe.abTest(this.store.sessionId,{intSucc:1,isApplied:_,tag:h,feature:p,params:f,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){A.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(t){let s=function(c){let d={};return Object.keys(c).forEach(h=>{let p=c[h].value,f=p.__expires,_=p.__type;Object.keys(p).forEach(v=>{v==="__id"||v==="__type"||v==="__priority"||v==="__expires"||Object.prototype.hasOwnProperty.call(d,v)||(d[v]=jC(jC({value:p[v]},f&&{expires:f}),_&&{type:_}))})}),d}(t);try{var a;let c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&cU(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(t),function(p){try{let f=Date.now();Object.keys(p).forEach(_=>{let{value:v,type:b,expires:w}=p[_];w&&w<=f||((b===OL.REALTIME||Object.prototype.hasOwnProperty.call(L0,_))&&(Ma[_]=v,gs[_]=v,A.debug("Update realtime parameters from config distribute",_,v)),b||lC()||!Object.prototype.hasOwnProperty.call(Fv,_)||(Ma[_]=v,gs[_]=v,A.debug("Update gateway parameters from config distribute",_,v)))})}catch(f){A.error("Error update config immediately: ".concat(p),f.message)}}(s);let d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),A.debug("Caching global parameters ".concat(d))}catch(c){A.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{let s=Date.now();Object.keys(t).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(gs,a)){let{value:c,expires:d}=t[a];if(d&&d<=s)return;(function(h,p){try{return typeof h=="object"&&typeof p=="object"&&JSON.stringify(h)===JSON.stringify(p)}catch{return!1}})(gs[a],c)||(Ma[a]=c,gs[a]=c,this.emit(Km.UPDATE_CLIENT_ROLE_OPTIONS,c),A.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){A.error("Error handling global parameter config:",s.message)}}}class Bae extends bs{constructor(){super(...arguments),B(this,"resultStorage",new Map)}setLocalAudioStats(t,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(t,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(a)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(a))}setRemoteAudioStats(t,s){let a=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(t,s){let a=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(t,s,a){if($("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let c=this.resultStorage.get(t);if(!c)return;c.result.push(a);let d=t==="VIDEO_ENCODE_FAILED"?$("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;let p=je(h=c.result).call(h,!0);c.isPrevNormal&&!p&&this.emit("exception",PC[t],t,s),!c.isPrevNormal&&p&&this.emit("exception",PC[t]+2e3,t+"_RECOVER",s),c.isPrevNormal=p,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,s){return s instanceof Ys&&!s.isActive||!!s.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=Bn(s._encoderConfig.frameRate));let c=t.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var s;return!(!t.codecType||je(s=$("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,s){return!!s.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,s){return s instanceof Ys&&!s.isActive||!!s.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let PC={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},kr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(s.length>0){let a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(e,t){let s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(s.length>0){let a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function JU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function vd(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?JU(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):JU(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class tf{constructor(t){B(this,"store",void 0),B(this,"onStatsException",void 0),B(this,"onUploadPublishDuration",void 0),B(this,"onStatsChanged",void 0),B(this,"onVideoCodecChanged",void 0),B(this,"localStats",new Map),B(this,"remoteStats",new Map),B(this,"updateStatsInterval",void 0),B(this,"trafficStats",void 0),B(this,"trafficStatsPeerList",[]),B(this,"uplinkStats",void 0),B(this,"exceptionMonitor",void 0),B(this,"p2pChannel",void 0),B(this,"scalabilityMode",Mv.L1T1),B(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Bae,this.exceptionMonitor.on("exception",(s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ne.LocalAudioTrack)||vd({},W0)}getLocalVideoTrackStats(){return this.localStats.get(Ne.LocalVideoTrack)||vd({},G0)}getRemoteAudioTrackStats(t){let s=(d,h)=>{if(!this.trafficStats)return h;let p=this.trafficStats.peer_delay.find(f=>f.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(t){var c;let d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;d&&(a[t]=s(t,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(a[h]=s(h,p))});return a}getRemoteNetworkQualityStats(t){let s={};if(t){var a;let c=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.networkStats;c&&(s[t]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(t){let s=(d,h)=>{if(!this.trafficStats)return h;let p=this.trafficStats.peer_delay.find(f=>f.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(t){var c;let d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;d&&(a[t]=s(t,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(a[h]=s(h,p))});return a}getRTCStats(){let t=0,s=0,a=0,c=0,d=this.localStats.get(Ne.LocalAudioTrack);d&&(t+=d.sendBytes,s+=d.sendBitrate);let h=this.localStats.get(Ne.LocalVideoTrack);h&&(t+=h.sendBytes,s+=h.sendBitrate);let p=this.localStats.get(Ne.LocalVideoLowTrack);p&&(t+=p.sendBytes,s+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:v,videoStats:b}=_;v&&(a+=v.receiveBytes,c+=v.receiveBitrate),b&&(a+=b.receiveBytes,c+=b.receiveBitrate)});let f=1;return this.trafficStats&&(f+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:f,SendBitrate:s,SendBytes:t,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),t.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;let c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?kr.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?kr.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&A.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,s,a){if(!t)return!1;let c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(s=>{let[a,c]=s;switch(a){case Ne.LocalVideoTrack:case Ne.LocalVideoLowTrack:{let p=c,f=vd({},G0),_=t.getStats(),v=t.getLocalMedia(a);if(_){let b=_.videoSend.find(w=>w.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(b){let w=t.getLocalVideoSize(),T=t.getEncoderConfig(Ne.LocalVideoTrack);var d;(b.codec==="H264"||b.codec==="H265"||b.codec==="VP8"||b.codec==="VP9"||b.codec==="AV1X"||b.codec==="AV1")&&(f.codecType=b.codec,(p==null?void 0:p.codecType)!==b.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,b.codec.toLocaleLowerCase()))),f.sendBytes=b.bytes,f.sendBitrate=p?8*Math.max(0,f.sendBytes-p.sendBytes):0,b.inputFrame?(f.captureFrameRate=b.inputFrame.frameRate,f.captureResolutionHeight=b.inputFrame.height,f.captureResolutionWidth=b.inputFrame.width):w&&(f.captureResolutionWidth=w.width,f.captureResolutionHeight=w.height),b.sentFrame?(f.sendFrameRate=b.sentFrame.frameRate,f.sendResolutionHeight=b.sentFrame.height,f.sendResolutionWidth=b.sentFrame.width):w&&(f.sendResolutionWidth=w.width,f.sendResolutionHeight=w.height),b.avgEncodeMs&&(f.encodeDelay=b.avgEncodeMs),T&&T.bitrateMax?f.targetSendBitrate=1e3*T.bitrateMax:b.targetBitrate&&(f.targetSendBitrate=b.targetBitrate),f.sendPackets=b.packets,f.sendPacketsLost=b.packetsLost,f.sendJitterMs=b.jitterMs,f.sendRttMs=b.rttMs,f.totalDuration=p?p.totalDuration+1:1,f.totalFreezeTime=p?p.totalFreezeTime:0,this.isLocalVideoFreeze(b)&&(f.totalFreezeTime+=1),b.scalabilityMode&&this.scalabilityMode!==b.scalabilityMode&&(A.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(b.scalabilityMode)),this.scalabilityMode=b.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(a,f),((p==null?void 0:p.sendResolutionWidth)!==f.sendResolutionWidth||(p==null?void 0:p.sendResolutionHeight)!==f.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,f);break}case Ne.LocalAudioTrack:{let p=c,f=vd({},W0),_=t.getStats(),v=t.getLocalMedia(a);if(_){let b=_.audioSend.find(w=>w.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(b){if(b.codec!=="opus"&&b.codec!=="aac"&&b.codec!=="PCMU"&&b.codec!=="PCMA"&&b.codec!=="G722"||(f.codecType=b.codec),b.inputLevel)f.sendVolumeLevel=Math.round(32767*b.inputLevel);else{let w=t.getLocalAudioVolume();w&&(f.sendVolumeLevel=Math.round(32767*w))}f.sendBytes=b.bytes,f.sendPackets=b.packets,f.sendPacketsLost=b.packetsLost,f.sendJitterMs=b.jitterMs,f.sendRttMs=b.rttMs,f.sendBitrate=p?8*Math.max(0,f.sendBytes-p.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ne.LocalAudioTrack,f),f&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,f);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(s=>{var a,c;let[d,{videoStats:h,audioStats:p,videoPcStats:f}]=s,_=p,v=h,b=f,w=vd({},GL),T=vd({},HL),U=vd({},Sie),{audioTrack:k,videoTrack:F,audioSSRC:z,videoSSRC:Y}=t.getRemoteMedia(d),X;X=this.store.useP2P?t.getStats(!0):t.getStats();let re=(a=X)===null||a===void 0?void 0:a.audioRecv.find(xe=>xe.ssrc===z),te=(c=X)===null||c===void 0?void 0:c.videoRecv.find(xe=>xe.ssrc===Y),Z=this.trafficStats&&this.trafficStats.peer_delay.find(xe=>xe.peer_uid===d);if(re&&(re.codec!=="opus"&&re.codec!=="aac"&&re.codec!=="PCMU"&&re.codec!=="PCMA"&&re.codec!=="G722"||(w.codecType=re.codec),re.outputLevel?w.receiveLevel=Math.round(32767*re.outputLevel):k&&(w.receiveLevel=Math.round(32767*k.getVolumeLevel())),w.receiveBytes=re.bytes,w.receivePackets=re.packets,w.receivePacketsLost=re.packetsLost,w.receivePacketsDiscarded=re.packetsDiscarded,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost),w.receiveBitrate=_?8*Math.max(0,w.receiveBytes-_.receiveBytes):0,w.totalDuration=_?_.totalDuration+1:1,w.totalFreezeTime=_?_.totalFreezeTime:0,w.freezeRate=w.totalFreezeTime/w.totalDuration,w.receiveDelay=re.jitterBufferMs,w.totalDuration>10&&tf.isRemoteAudioFreeze(k)&&(w.totalFreezeTime+=1)),te){var de;te.codec!=="H264"&&te.codec!=="H265"&&te.codec!=="VP8"&&te.codec!=="VP9"&&te.codec!=="AV1X"&&te.codec!=="AV1"||(T.codecType=te.codec),T.receiveBytes=te.bytes,T.receiveBitrate=v?8*Math.max(0,T.receiveBytes-v.receiveBytes):0,T.decodeFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,T.renderFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,te.outputFrame&&(T.renderFrameRate=te.outputFrame.frameRate),te.receivedFrame?(T.receiveFrameRate=te.receivedFrame.frameRate,T.receiveResolutionHeight=te.receivedFrame.height,T.receiveResolutionWidth=te.receivedFrame.width):F&&(T.receiveResolutionHeight=F._videoHeight||0,T.receiveResolutionWidth=F._videoWidth||0),te.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(te.framesRateFirefox)),T.receivePackets=te.packets,T.receivePacketsLost=te.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost);let xe=v?v.totalFreezeTime:0,Se=v?v.totalDuration:0;T.totalDuration=v?v.totalDuration+1:1,T.totalFreezeTime=(de=te.totalFreezesDuration)!==null&&de!==void 0?de:xe||0,T.receiveDelay=te.jitterBufferMs||0;let Ae=!!Y&&t.getRemoteVideoIsReady(Y);te.totalFreezesDuration===void 0&&F&&Ae&&tf.isRemoteVideoFreeze(F,te,b)&&(T.totalFreezeTime+=1),T.freezeRate=Math.max(0,Math.min((T.totalFreezeTime-xe)/(T.totalDuration-Se),1))}Z&&(w.end2EndDelay=Z.B_ad,T.end2EndDelay=Z.B_vd,w.transportDelay=Z.B_ed,T.transportDelay=Z.B_ed,w.currentPacketLossRate=Z.B_ealr4/100,T.currentPacketLossRate=Z.B_evlr4/100,U.uplinkNetworkQuality=Z.B_punq?Z.B_punq:0,U.downlinkNetworkQuality=Z.B_pdnq?Z.B_pdnq:0),this.remoteStats.set(d,{audioStats:w,videoStats:T,videoPcStats:te,networkStats:U}),k&&this.exceptionMonitor.setRemoteAudioStats(k,w),F&&this.exceptionMonitor.setRemoteVideoStats(F,T)})}}class QU{constructor(){B(this,"destChannelMediaInfos",new Map),B(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){aU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){aU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){rE(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function ZU(e){if(!(e instanceof QU))return new ue(K.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),s=e.getDestChannelMediaInfo();if(!t)return new ue(K.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new ue(K.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Jc{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,s){B(this,"uid",void 0),B(this,"_uintid",void 0),B(this,"_trust_in_room_",!0),B(this,"_trust_audio_enabled_state_",!0),B(this,"_trust_video_enabled_state_",!0),B(this,"_trust_audio_mute_state_",!0),B(this,"_trust_video_mute_state_",!0),B(this,"_audio_muted_",!1),B(this,"_video_muted_",!1),B(this,"_audio_enabled_",!0),B(this,"_video_enabled_",!0),B(this,"_audio_added_",!1),B(this,"_video_added_",!1),B(this,"_is_pre_created",!1),B(this,"_video_pre_subscribed",!1),B(this,"_audio_pre_subscribed",!1),B(this,"_trust_video_stream_added_state_",!0),B(this,"_trust_audio_stream_added_state_",!0),B(this,"_audioTrack",void 0),B(this,"_videoTrack",void 0),B(this,"_dataChannels",[]),B(this,"_audioSSRC",void 0),B(this,"_videoSSRC",void 0),B(this,"_audioOrtc",void 0),B(this,"_videoOrtc",void 0),B(this,"_cname",void 0),B(this,"_rtxSsrcId",void 0),B(this,"_videoMid",void 0),B(this,"_audioMid",void 0),this.uid=t,this._uintid=s}}function e5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function kC(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?e5(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):e5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let vE="9",LC=2e4,EE=4e4;function t5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function oc(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?t5(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):t5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}var Ch=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Ch||{});let yE=new Map;function s5(e,t,s,a){let{scale:c}=e;if(c===0&&a===Ch.UP||c>=t.length-1&&a===Ch.DOWN)return e;let d=oc(oc({},e),{},{scale:a===Ch.DOWN?++c:--c});switch(s){case"maintain-framerate":d=oc(oc({},d),t[c].motion);break;case"maintain-resolution":d=oc(oc({},d),t[c].detail);break;case"balanced":d=oc(oc({},d),t[c].balanced)}return d}function r5(e,t){if(t){let s={overUse:0,underUse:0,adaptationList:n5(t)};yE.set(e,s)}else yE.delete(e)}function n5(e){let t=oc({},e),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=t,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:f,BITRATE_MIN_THRESHOLD:_,BITRATE_MAX_THRESHOLD:v,BWE_SCALE_UP_THRESHOLD:b,BWE_SCALE_DOWN_THRESHOLD:w,PERF_SCALE_DOWN_THRESHOLD:T,PERF_SCALE_UP_THRESHOLD:U,BALANCE_BITRATE_FACTOR:k,BALANCE_FRAMERATE_FACTOR:F,BALANCE_RESOLUTION_FACTOR:z,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:X,DETAIL_FRAMERATE_FACTOR:re,DETAIL_BITRATE_FACTOR:te}=P0,Z=Math.min(t.frameRate,p),de=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(w,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(T,1)*Z),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d}}];for(let xe=1;xe<=f;xe++){let Se={bwe_up:Math.round(Math.pow(b,xe)*s),bwe_down:Math.round(Math.pow(w,xe+1)*s),fps_up:Math.round(Math.pow(U,xe)*Z),fps_down:Math.round(Math.pow(T,xe+1)*Z)},Ae={scaleResolutionDownBy:c/Math.pow(z,xe),frameRate:Math.max(Math.round(Math.pow(F,xe)*a),h),bitrateMax:Math.max(Math.round(Math.pow(k,xe)*s),v),bitrateMin:Math.max(Math.round(Math.pow(k,xe)*d),_)},yt={scaleResolutionDownBy:c/Math.pow(Y,xe),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(X,xe)*s),v),bitrateMin:Math.max(Math.round(Math.pow(X,xe)*d),_)},bt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(re,xe)*a),h),bitrateMax:Math.max(Math.round(Math.pow(te,xe)*s),v),bitrateMin:Math.max(Math.round(Math.pow(te,xe)*d),_)};de.push({scale:xe,threshold:Se,balanced:Ae,motion:yt,detail:bt})}return de}function Wae(e,t,s,a,c,d){let h=yE.get(e)||{overUse:0,underUse:0,adaptationList:n5(c)},{adaptationList:p}=h;yE.set(e,h);let{OVERUSE_TIMES_THRESHOLD:f,UNDERUSE_TIMES_THRESHOLD:_}=P0,{scale:v}=a,b,w;return typeof t=="number"&&t>0&&function(T,U,k,F){if(U>=k.length)return!1;let{threshold:{fps_down:z}}=k[U];return $("FORCE_AG_HIGH_FRAMERATE")&&F==="maintain-framerate"&&(z=k[0].threshold.fps_down),T<z}(t,v,p,d)&&(h.overUse++,w=Fm.CPU,h.overUse>f)||typeof s=="number"&&s>0&&function(T,U,k){if(U>=k.length)return!1;let{threshold:{bwe_down:F}}=k[U];return T<F}(s,v,p)&&(h.overUse++,w=Fm.BANDWIDTH,h.overUse>f)?(h.overUse=0,h.underUse=0,b=s5(a,p,d,Ch.DOWN),[b,w]):(typeof t=="number"&&t>0&&typeof s=="number"&&s>0&&function(T,U,k,F){if(U===0)return;let{threshold:{fps_up:z}}=k[U];return $("FORCE_AG_HIGH_FRAMERATE")&&F==="maintain-framerate"&&(z=k[1].threshold.fps_up),T>z}(t,v,p,d)&&function(T,U,k){if(U===0)return;let{threshold:{bwe_up:F}}=k[U];return T>F}(s,v,p)&&(h.underUse++,h.underUse>_&&(h.overUse=0,h.underUse=0,b=s5(a,p,d,Ch.UP),b.scale===0&&(w=Fm.NONE))),[b,w])}function i5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function MC(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?i5(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let xE=new Map;function bE(e,t){let s=xE.get(e);if(s){let{timer:a}=s;window.clearTimeout(a),xE.delete(e)}t.qualityLimitationReason=Fm.NONE,r5(e)}function Gae(e,t){var s;let a;switch(t){case Ne.LocalAudioTrack:a=Kt.Audio;break;case Ne.LocalVideoTrack:a=je(s=e._hints).call(s,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High;break;case Ne.LocalVideoLowTrack:a=Kt.Low}return a}function FC(e){let t=jt();if(e.some(s=>s._bypassWebAudio))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function UC(e,t){FC(e);let s=new Ys;return e.forEach(a=>s.addAudioTrack(a)),s}let Hae=!jt().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&tc();function wE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return Hae?(s={spec:t,store:e},ac("PlanBConnection").create(s)):new Ai(t,e)}function VC(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function a5(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(km(e.turnServer.servers))return!1;if($("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var It;function o5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Wa(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?o5(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let Ai=(It=class Bd extends dU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return je(s=Object.keys(Vm)).call(s,t)}))]}constructor(t,s){super(t,s),B(this,"id",ts(5,"connection-")),B(this,"store",void 0),B(this,"peerConnection",void 0),B(this,"forceTurn",!1),B(this,"remoteSDP",void 0),B(this,"initialOffer",void 0),B(this,"transportEventReceiver",void 0),B(this,"statsFilter",void 0),B(this,"extension",{useXR:$("USE_XR")}),B(this,"localCapabilities",void 0),B(this,"remoteCodecs",void 0),B(this,"localCandidateCount",0),B(this,"allCandidatesReceived",!1),B(this,"isPreallocation",!1),B(this,"preMediaMap",new Map),B(this,"dataStreamChannelMap",new Map),B(this,"establishPromise",void 0),B(this,"recoveredDataChannelIds",[]),B(this,"currentDataChannelId",1),B(this,"supportAV1RtpSpec",!1),B(this,"mutex",void 0),B(this,"qualityLimitationReason",Fm.NONE),B(this,"isFirstConnected",!1),this.store=s,this.forceTurn=a5(t),this.mutex=new Dr("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Bd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=D0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Cs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,s){if(this.remoteCodecs=s,!this.remoteSDP)return void A.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(t,s,this.store.codec)){let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else A.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let c=qc(a.sdp),d=await AU({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:$("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:$("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=pE(d),this.initialOffer=a,$("ENABLE_SVC")&&this.store.codec=="av1"){let p=await async function(){try{let f=new RTCPeerConnection;f.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Mv.L1T3}]});let _=await f.createOffer();if(!_.sdp)return void f.close();let v=xn(_.sdp).mediaDescriptions[0];if(!v)return;let b=v.attributes.extmaps.find(w=>w.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return f.close(),b}catch{return}}();var t;p&&(this.supportAV1RtpSpec=!0,(t=d.send)===null||t===void 0||t.videoExtensions.push(p))}let h;return a.sdp&&jU(a.sdp)&&(h=Es(d),(s=h).send&&(yh(ze.VIDEO,s.send.videoExtensions),yh(ze.AUDIO,s.send.audioExtensions)),s.recv&&(yh(ze.VIDEO,s.recv.videoExtensions),yh(ze.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(yh(ze.VIDEO,s.sendrecv.videoExtensions),yh(ze.AUDIO,s.sendrecv.audioExtensions))),Wa(Wa({},c),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new _e(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&jU(this.initialOffer.sdp)&&(s=t.rtpCapabilities,a=this.localCapabilities,s.send&&(dE(ze.VIDEO,s.send.videoExtensions,a.send.videoExtensions),dE(ze.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(dE(ze.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),dE(ze.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Es(this._localCapabilities)}get rtpCapabilities(){return Es(this._rtpCapabilities)}get candidates(){return Es(this._candidates)}get iceParameters(){return Es(this._iceParameters)}get dtlsParameters(){return Es(this._dtlsParameters)}constructor(f){let _=arguments.length>1&&arguments[1]!==void 0&&arguments[1],v=arguments.length>2&&arguments[2]!==void 0&&arguments[2];B(this,"sessionDesc",void 0),B(this,"_localCapabilities",void 0),B(this,"_rtpCapabilities",void 0),B(this,"_candidates",void 0),B(this,"_originCandidates",void 0),B(this,"_iceParameters",void 0),B(this,"_isUseExtmapAllowMixed",void 0),B(this,"_isUseLocalCodecs",void 0),B(this,"_dtlsParameters",void 0),B(this,"setup",void 0),B(this,"currentMidIndex",void 0),B(this,"cname",void 0),B(this,"useLocalCodecsMids",[]),B(this,"preloadSsrcs",[]),B(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=_,this._isUseLocalCodecs=v,f=Es(f);let{iceParameters:b,dtlsParameters:w,candidates:T,rtpCapabilities:U,setup:k,localCapabilities:F,cname:z}=f;this._rtpCapabilities=U,this._candidates=T,this._originCandidates=Es(T),this._iceParameters=b,this._dtlsParameters=w,this._localCapabilities=F,this.setup=k,this.cname=z,[this.sessionDesc]=this.updateRemoteRTPCapabilities(U),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(f){return f.length===this.preloadSsrcs.length&&f.every(_=>{var v;return je(v=this.preloadSsrcs).call(v,_)})}preloadRemoteMedia(f){let _=0,v=[],b=[];for(;f>0;){let w=[kC({ssrcId:EE+_},$("USE_SUB_RTX")?{rtx:EE+_+1}:{})],T="".concat(EE+_,"_").concat(LC+_),{ssrcs:U,ssrcGroups:k}=Jm(w,this.cname,$("SYNC_GROUP")?T:void 0),F=this.preCreateOrRecycleSendMedia("video",U,k,void 0),z=[{ssrcId:LC+_}],Y="".concat(EE+_,"_").concat(LC+_),{ssrcs:X,ssrcGroups:re}=Jm(z,this.cname,$("SYNC_GROUP")?Y:void 0),te=this.preCreateOrRecycleSendMedia("audio",X,re,void 0);f--,_+=2,v.push(F,te),b.push(U[0].ssrcId,X[0].ssrcId)}return this.useLocalCodecsMids.push(...v),this.preloadSsrcs=b,{mids:v,preSSRCs:b,isAvailable:!0}}preCreateOrRecycleSendMedia(f,_,v,b){let w=this.rtpCapabilities.send.videoCodecs,T=this._isUseLocalCodecs||w.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;A.debug("create or recycle send media without remote rtp capabilities, ssrcs ",_[0].ssrcId);let U=f===ze.VIDEO?T.videoCodecs:T.audioCodecs,k=f===ze.VIDEO?T.videoExtensions:T.audioExtensions;this.currentMidIndex+=1;let F="".concat(this.currentMidIndex),z={media:{mediaType:f,port:vE,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(Y=>Y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:k,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(F)}};return z=this.mungSendMediaDesc(z,b),this.sessionDesc.mediaDescriptions.push(z),this.updateBundleMids(),F}toString(){return Bc(this.sessionDesc)}send(f,_,v,b){let{ssrcs:w,ssrcGroups:T}=Jm(_,this.cname,$("SYNC_GROUP")?v:void 0),U=this.findPreloadMediaDesc(w);if(U){if(Cs()&&this.firefoxSsrcMidMap.set(w[0].ssrcId,U.attributes.mid),b&&(b.twcc||b.remb)){let k=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[k]=this.mungSendMediaDesc(U,b),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{let k=this.findAvailableMediaIndex(f,w),F;return k===-1||k===1&&(wr()||function(){let z=At();return!(z.name!==Lt.CHROME||!z.osVersion)&&Number(z.version)<=90}()||$("ENABLE_ENCODED_TRANSFORM")&&ec())||k===0&&!function(z){let Y=At();return!(Y.name!==Lt.FIREFOX||!Y.osVersion)&&Number(Y.version)===z}(138)&&$("USE_SUB_RTX")||sL()?(F=this.createOrRecycleSendMedia(f,w,T,"sendonly",b),this.updateBundleMids()):(F=Es(this.sessionDesc.mediaDescriptions[k]),F.attributes.direction="sendonly",F.attributes.ssrcs=w,F.attributes.ssrcGroups=T,this.sessionDesc.mediaDescriptions[k]=this.mungSendMediaDesc(F,b)),Cs()&&this.firefoxSsrcMidMap.set(w[0].ssrcId,F.attributes.mid),{mid:F.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:f,needExchangeSDP:_}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:f.attributes.mid,needExchangeSDP:_}}batchSend(f){let _=f.map(w=>{let{kind:T,ssrcMsg:U,mslabel:k}=w;return this.send(T,U,k)}),v=[],b=!1;return _.forEach(w=>{let{mid:T,needExchangeSDP:U}=w;U&&(b=!0),v.push(T)}),{mids:v,needExchangeSDP:b}}stopSending(f){let _=this.sessionDesc.mediaDescriptions.filter(v=>v.attributes.mid&&f.indexOf(v.attributes.mid)!==-1);if(_.length!==f.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");_.forEach(v=>{v.attributes.mid==="0"||Cs()||sL()?v.attributes.ssrcs=[]:(v.attributes.ssrcs=[],v.attributes.direction="inactive",v.media.port="0")}),this.updateBundleMids()}mute(f){let _=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===f);if(!_)throw new Error("mediaDescription not found with ".concat(f," in remote SDP when calling RemoteSDP.mute."));_.attributes.direction="inactive"}unmute(f){let _=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===f);if(!_)throw new Error("mediaDescription not found with ".concat(f," in remote SDP when calling RemoteSDP.unmute."));_.attributes.direction="sendonly"}muteRemote(f){let _=this.sessionDesc.mediaDescriptions.filter(v=>je(f).call(f,v.attributes.mid||""));if(_.length!==f.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_.forEach(v=>{v.attributes.direction="inactive"})}unmuteRemote(f){let _=this.sessionDesc.mediaDescriptions.filter(v=>je(f).call(f,v.attributes.mid||""));if(_.length!==f.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_.forEach(v=>{v.attributes.direction="recvonly"})}receive(f,_,v,b){f.forEach((w,T)=>{this.createOrRecycleRecvMedia(w,[],"recvonly",_,v,b[T])}),this.updateBundleMids()}stopReceiving(f){let _=this.sessionDesc.mediaDescriptions.filter(v=>f.indexOf(v.attributes.mid)!==-1);if(_.length!==f.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");_.forEach(v=>{v.media.port="0",v.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(f){let _=this.sessionDesc||xn((v=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(v?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var v;this._rtpCapabilities=f;let b=!1,w=this.rtpCapabilities.send,T=this.localCapabilities.send,U=this.localCapabilities.recv,k=U.videoCodecs,F=U.audioCodecs,z=U.videoExtensions,Y=U.audioExtensions;for(let Z of _.mediaDescriptions){var X;if(Z.attributes.direction!=="sendonly"||typeof Z.attributes.mid!="string"||!je(X=this.useLocalCodecsMids).call(X,Z.attributes.mid)){if(b=!0,Z.attributes.iceUfrag=this._iceParameters.iceUfrag,Z.attributes.icePwd=this._iceParameters.icePwd,Z.attributes.fingerprints=this._dtlsParameters.fingerprints,Z.attributes.candidates=this._candidates,Z.attributes.setup=this.setup,Z.media.mediaType==="application"&&(Z.attributes.sctpPort="5000"),Z.media.mediaType==="video")if(this._isUseLocalCodecs&&Z.attributes.direction==="sendonly"){var re;Z.media.fmts=k.map(xe=>xe.payloadType.toString(10)),Z.attributes.payloads=k,Z.attributes.extmaps=z;let de=Z.attributes.mid;typeof de!="string"||je(re=this.useLocalCodecsMids).call(re,de)||this.useLocalCodecsMids.push(de)}else if(w.videoCodecs.length===0){let de=T.videoCodecs.filter(xe=>{var Se,Ae;return(Se=xe.rtpMap)===null||Se===void 0?void 0:je(Ae=Se.encodingName.toLowerCase()).call(Ae,"vp8")})||[T.videoCodecs[0]];Z.media.fmts=de.map(xe=>xe.payloadType.toString(10)),Z.attributes.payloads=de,Z.attributes.extmaps=[]}else Z.media.fmts=w.videoCodecs.map(de=>de.payloadType.toString(10)),Z.attributes.payloads=w.videoCodecs,Z.attributes.extmaps=w.videoExtensions;if(Z.media.mediaType==="audio")if(this._isUseLocalCodecs&&Z.attributes.direction==="sendonly"){var te;Z.media.fmts=F.map(xe=>xe.payloadType.toString(10)),Z.attributes.payloads=F,Z.attributes.extmaps=Y;let de=Z.attributes.mid;typeof de!="string"||je(te=this.useLocalCodecsMids).call(te,de)||this.useLocalCodecsMids.push(de)}else if(w.audioCodecs.length===0){let de=T.audioCodecs.filter(xe=>{var Se,Ae;return(Se=xe.rtpMap)===null||Se===void 0?void 0:je(Ae=Se.encodingName.toLowerCase()).call(Ae,"opus")})||[T.audioCodecs[0]];Z.media.fmts=de.map(xe=>xe.payloadType.toString(10)),Z.attributes.payloads=de,Z.attributes.extmaps=[]}else Z.media.fmts=w.audioCodecs.map(de=>de.payloadType.toString(10)),Z.attributes.payloads=w.audioCodecs,Z.attributes.extmaps=w.audioExtensions,bh(Z)}}return this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1,[this.sessionDesc,b]}updateCandidates(f){let _=this._originCandidates.filter(b=>b.transport==="udp"),v=[];if(_.forEach(b=>{v.push(kC(kC({},b),{},{foundation:"tcpcandidate",priority:Number(b.priority)-1+"",transport:"tcp",port:Number(b.port)+90+""}))}),_.length!==0){switch(f){case Pr.TCP_RELAY:this._candidates=v;break;case Pr.UDP_TCP_RELAY:case Pr.RELAY:this._candidates=[..._,...v];break;default:this._candidates=_}for(let b of this.sessionDesc.mediaDescriptions)b.attributes.candidates=this.candidates}}restartICE(f){f=Es(f),this._iceParameters=f,this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.iceUfrag=f.iceUfrag,_.attributes.icePwd=f.icePwd})}predictReceivingMids(f){let _=[];for(let v=0;v<f;v++)_.push((this.currentMidIndex+v+1).toString(10));return _}findAvailableMediaIndex(f,_){return this.sessionDesc.mediaDescriptions.findIndex(v=>{let b=v.media.mediaType===f&&v.media.port!=="0"&&(v.attributes.direction==="sendonly"||v.attributes.direction==="sendrecv")&&v.attributes.ssrcs.length===0;if(Cs()){if(b){let w=this.firefoxSsrcMidMap.get(_[0].ssrcId);return!(w||v.attributes.mid!=="0"&&v.attributes.mid!=="1")||!(!w||w!==v.attributes.mid)}return!1}return b})}createOrRecycleDataChannel(){for(let v of this.sessionDesc.mediaDescriptions)if(v.media.mediaType==="application")return{mediaDesc:v,needExchangeSDP:!1};this.currentMidIndex+=1;let f="".concat(this.currentMidIndex),_={media:{mediaType:"application",port:vE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(f),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(_),{mediaDesc:_,needExchangeSDP:!0}}createOrRecycleRecvMedia(f,_,v,b,w,T){let U=f._mediaStreamTrack.kind,k=this.rtpCapabilities.recv,F=Qm(U,k,this.localCapabilities.send,U===ze.VIDEO?b:w),z=U===ze.VIDEO?k.videoExtensions:k.audioExtensions;this.currentMidIndex+=1;let Y="".concat(this.currentMidIndex),X={media:{mediaType:U,port:vE,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(te=>te.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:v,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};X=this.mungRecvMediaDsec(X,f,T);let re=this.findFirstClosedMedia(U);if(re){let te=this.sessionDesc.mediaDescriptions.indexOf(re);this.sessionDesc.mediaDescriptions[te]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}updateRemoteDtlsParameters(f){let _=new Set(this._dtlsParameters.fingerprints.map(w=>w.fingerprint)),v=new Set(f.map(w=>w.fingerprint)),b=!1;_.size!==v.size&&(b=!0);for(let w of _)v.has(w)||(b=!0);return b}updateRemoteCodec(f,_,v){let b=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(X=>X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||"").filter(X=>{var re;return je(re=Object.keys(Vm)).call(re,X)}))],w=new Set(_);if(b.every(X=>w.has(X)))return A.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(_)),!1;let T=this._rtpCapabilities.recv.videoCodecs.filter(X=>_.some(re=>{var te;return je(te=X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||"").call(te,re)}));if(T.length===0)return A.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(b," codecs: ").concat(_)),!1;let U=[...new Set(T.map(X=>X.rtpMap&&X.rtpMap.encodingName.toLowerCase()||""))],k;if(A.debug("updateRemoteCodec, from ".concat(b," to ").concat(U)),f.length===0)k=this.sessionDesc.mediaDescriptions.filter(X=>X.media.mediaType==="video"&&X.attributes.direction==="recvonly");else if(k=this.sessionDesc.mediaDescriptions.filter(X=>X.attributes.mid&&X.media.mediaType==="video"&&je(f).call(f,X.attributes.mid)&&X.attributes.direction==="recvonly"),k.length!==f.length)return A.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(f,", codecs: ").concat(_)),!1;if($("USE_PUB_RTX")||$("USE_SUB_RTX")){let X=Yc(T,this.rtpCapabilities.recv.videoCodecs);T.push(...X)}this._rtpCapabilities.recv.videoCodecs=T;let F=this.localCapabilities.send,z=this.rtpCapabilities.recv,Y=Qm(ze.VIDEO,z,F,v);return k.forEach(X=>{let re=Y.map(te=>te.payloadType.toString(10));A.debug("updateRemoteCodec mid: ".concat(X.attributes.mid,", from"),X.attributes.payloads,"to",Y),X.attributes.payloads=Y,X.media.fmts=re}),!0}createOrRecycleSendMedia(f,_,v,b,w){let T=this.rtpCapabilities.send.videoCodecs,U=this._isUseLocalCodecs||T.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,k=f===ze.VIDEO?U.videoCodecs:U.audioCodecs,F=f===ze.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;let z="".concat(this.currentMidIndex),Y={media:{mediaType:f,port:vE,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(re=>re.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};Y=this.mungSendMediaDesc(Y,w);let X=this.findFirstClosedMedia(f);if(X){let re=this.sessionDesc.mediaDescriptions.indexOf(X);this.sessionDesc.mediaDescriptions[re]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(f=>f.media.port!=="0").map(f=>f.attributes.mid)}mungRecvMediaDsec(f,_,v){let b=Es(f);return bC(b),xh(b,_),wC(b,_),NU(b),hE(b,v,this.localCapabilities.send),b}mungSendMediaDesc(f,_){let v=Es(f);return hE(v,_,this.localCapabilities.recv),bh(v),v}updateRecvMedia(f,_){let v=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===f);if(v!==-1){let b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],_);this.sessionDesc.mediaDescriptions[v]=b}}bumpMid(f){this.currentMidIndex+=f}findFirstClosedMedia(f){return this.sessionDesc.mediaDescriptions.find(_=>Cs()?_.media.port==="0"&&_.media.mediaType===f:_.media.port==="0")}findPreloadMediaDesc(f){return this.sessionDesc.mediaDescriptions.find(_=>{var v;return((v=_.attributes)===null||v===void 0||(v=v.ssrcs[0])===null||v===void 0?void 0:v.ssrcId)===f[0].ssrcId})}getSSRC(f){var _;return(_=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===f))===null||_===void 0?void 0:_.attributes.ssrcs}}(Wa(Wa({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!$("ENABLE_PRE_SUB_WITH_PRE_PC")||!$("PRE_USE_LOCAL_CODECS"))&&U0(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let c=this.remoteSDP.toString(),d=DU(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});let p=this.peerConnection.getTransceivers()[0];if(p!=null&&p.receiver&&this.tryBindTransportEvents(p.receiver),U0(this.store))if(t.preallocation&&$("ENABLE_PRE_SUB_WITH_PRE_PC")){let f=$("PRE_SUB_NUM"),{mids:_,preSSRCs:v}=this.remoteSDP.preloadRemoteMedia(f);await $c(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(v)),this.presetMedia(_,v)}else{let{preSSRCs:f=[]}=t,_=f.map(b=>b.ssrcMsg[0].ssrcId);if(f.length===0)return;let{mids:v}=this.remoteSDP.batchSend(f.map(b=>Object.assign({},b)));await $c(this.peerConnection,this.remoteSDP,this.extension),A.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(_)),this.presetMedia(v,_)}}catch(c){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}presetMedia(t,s){t.forEach((a,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&a===d.mid&&d.receiver.track){let h=d.receiver.track,p;h.kind==="video"&&$("ENABLE_PRE_RENDER")&&(p=new Q0({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(ts(5,""))},!0),p.updateVideoTrack(h),p.onFirstVideoFrameRender=()=>{var f;let _=this.preMediaMap.get(s[c]);_&&(_.firstVideoRender=Date.now()),(f=this.onFirstVideoRender)===null||f===void 0||f.call(this,s[c])},p.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[c],{mid:a,track:h,player:p,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1,{rtpCapabilities:a}=t;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||h}let{preSSRCs:c=[]}=t,d=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){let h=[],p=[];if(Array.from(this.preMediaMap.entries()).every(f=>{let[_,{mid:v,player:b,track:w}]=f;return h.push(v),p.push(_),this.preMediaMap.delete(_),b&&b.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await $c(this.peerConnection,this.remoteSDP,this.extension),A.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(p)),Qe.reportApiInvoke(this.store.sessionId,{name:Os.PRELOAD_MEDIA_FAILED,options:[c,p],tag:vs.TRACER}).onSuccess()),c.length>0){let{mids:f}=this.remoteSDP.batchSend(c.map(_=>Object.assign({},_)));await $c(this.peerConnection,this.remoteSDP,this.extension),A.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(f,d)}}s?(await $c(this.peerConnection,this.remoteSDP,this.extension),A.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):A.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(t,s,a){var c=this;return wi(function*(){let d=yield Ot(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let h=[],p=lE();t.forEach(F=>{let z=c.peerConnection.addTransceiver(F._mediaStreamTrack,Wa({direction:"sendonly"},F.trackMediaType==="video"&&c.supportAV1RtpSpec&&p?{sendEncodings:[{scalabilityMode:p}]}:{}));h.push(z),F._updateRtpTransceiver(z)}),Cs()&&$("SIMULCAST")===!0&&(yield Ot(c.applySimulcastForFirefox(h,t)));let f=yield Ot(c.peerConnection.createOffer()),_=c.remoteSDP.predictReceivingMids(t.length),v=c.mungSendOfferSDP(f.sdp,t,_),b=xn(v),w=_.map(F=>{let z=b.mediaDescriptions.find(Y=>Y.attributes.mid===F);if(!z)throw new Error("Cannot extract ssrc from mediaDescription.");return SU(z,$("USE_PUB_RTX"))}),T;try{T=yield w}catch(F){T=[],c.remoteSDP.receive(t,s,a,T);let z=c.remoteSDP.toString();throw yield Ot(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ot(c.peerConnection.setRemoteDescription({type:"answer",sdp:z})),yield Ot(c.stopSending(_,!0)),F}c.remoteSDP.receive(t,s,a,T);let U=c.remoteSDP.toString(),k=c.logSDPExchange(v,"offer","local","send");return yield Ot(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ot(c.applySimulcastEncodings(h,t)),yield Ot(c.applySendEncodings(h,t)),k==null||k(U),yield Ot(c.peerConnection.setRemoteDescription({type:"answer",sdp:U})),h.map((F,z)=>{let Y=_[z];return{localSSRC:w[z],id:Y,transceiver:F}})}catch(h){throw h instanceof _e?h:new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(t);if(a&&a.readyState==="open")A.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,a)}s.forEach(d=>{d._updateOriginDataChannel(a)});let{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){let d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),A.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else A.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof _e?a:new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(t){try{let s=this.dataStreamChannelMap.get(t);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(t)}catch(s){throw s instanceof _e?s:new _e(K.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(t,s){let a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(f=>t.indexOf(f.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(f=>{var _;bE(this.id+f.mid,this),f.direction="inactive",(_=f.stop)===null||_===void 0||_.call(f)});let d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);let p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,s,a,c);h&&(await $c(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let p=this.peerConnection.getTransceivers().find(f=>f.mid===d);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:d,transceiver:p}}catch(d){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(t);return a&&(await $c(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{let d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(d=>{Array.from(this.preMediaMap.entries()).some(h=>{let[p,{mid:f,player:_}]=h;if(f===d)return this.preMediaMap.delete(p),_&&_.destroy(),!0})}),this.remoteSDP.stopSending(t);let s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let s=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let s=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,p)=>{h.direction="sendonly"});let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return wi(function*(){let a=yield Ot(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=jt().supportPCSetConfiguration,d=$("FORCE_TURN_TCP")||s.forceTurn;if(t===Pr.RELAY&&!c)return;if(c&&!d){let b=t===Pr.RELAY?"relay":"all",w=s.peerConnection.getConfiguration();w.iceTransportPolicy!==b&&(A.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(w.iceTransportPolicy,"] to [").concat(b,"]")),w.iceTransportPolicy=b,s.peerConnection.setConfiguration(w))}s.remoteSDP.updateCandidates(t);let h=yield Ot(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let p=qc(h.sdp),{remoteIceParameters:f}=yield p.iceParameters;s.remoteSDP.restartICE(f);let _=s.remoteSDP.toString(),v=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Ot(s.peerConnection.setLocalDescription(h)),v==null||v(_),yield Ot(s.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){A.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Pr.TCP_RELAY),await $c(this.peerConnection,this.remoteSDP,this.extension)}catch(s){A.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(s=>{bE(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:a}=s;a&&a.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Wa(Wa({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);let d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new _e(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,s){let a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(s)?Cs()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){let a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let s=t[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:Wa(Wa({},yo),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Wa(Wa({},yo),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var s;let a="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"",d=_d(t.url||"");A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(d||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let s={iceServers:[]},a=t.cloudProxyServer||"disabled";return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&(km(t.turnServer.servers)?s.iceServers=t.turnServer.servers:$("NEW_TURN_MODE")&&s.iceServers&&a==="disabled"?($("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&s.iceServers.push(...Bd.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):s.iceServers.push(...Bd.newTurnServerConfigToIceServers(t.turnServer.servers)),$("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Bd.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Bd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&jt().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(t){let s=[];return t.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(zc(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!$("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(t){let s=[];return t.forEach(a=>{let c=$("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(zc(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(zc(a.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(t){let s=t.transport;if(s){this.transportEventReceiver=t,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};let a=s.iceTransport;a&&(a.onstatechange=()=>{let c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){let{local:c,remote:d}=a.getSelectedCandidatePair()||{};if(c&&d){let h=c.address+":"+c.port,p=d.address+":"+d.port;A.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(_d(h)),", remote ").concat(JSON.stringify(_d(p))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var a,c;if(s||(s=this.peerConnection.getSenders().find(k=>k.track===t._mediaStreamTrack)),!s)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return A.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jt().supportSetRtpSenderParameters)return A.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let d={},h={};switch(t._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}let p=function(k,F){return k.getTransceivers().find(z=>z.sender.track===F||z.receiver.track===F)}(this.peerConnection,t._mediaStreamTrack),f=Aie(t);if(function(k){var F;return!(!$("ENABLE_AG_ADAPTATION")||!(k instanceof Kv||je(F=k._hints).call(F,Zt.CUSTOM_TRACK))||!$("FORCE_SUPPORT_AG_ADAPTATION")&&!(eL(14,0,!1)&&tL(17,4)||Z2(14)&&m0(17,4,!0)))}(t)&&p&&s&&f&&this.getLocalVideoStats&&je(a=["vp8","vp9"]).call(a,this.store.codec)){var _;let k=d.degradationPreference||(je(_=t._hints).call(_,Zt.CUSTOM_TRACK)?$("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(F,z,Y,X,re,te){if(bE(F,Y),re(z),X!=="balanced"&&X!=="maintain-framerate"&&X!=="maintain-resolution")return;let Z=-1;r5(F,z);let de=window.setInterval(()=>{let Se=xE.get(F);if(!$("ENABLE_AG_ADAPTATION")||!Se)return bE(F,Y),void re(z);let Ae=te();if(Ae.sendPackets>0&&Ae.OutgoingAvailableBandwidth>0){if(Z===-1)return void(Z=Date.now());if(Date.now()-Z<1e3)return;let yt=Ae.sendFrameRate,bt=Ae.OutgoingAvailableBandwidth,[dt,Wt]=Wae(F,yt,bt,Se.adaptationConfig,z,X);Wt&&(Y.qualityLimitationReason=Wt),dt&&Se.adaptationConfig.scale!==dt.scale&&(A.debug("[".concat(F,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(yt,", bwe ").concat(bt,", switch from ").concat(Se.adaptationConfig.scale," to ").concat(dt.scale," ")),Se.adaptationConfig=MC(MC({},Se.adaptationConfig),dt),re(dt))}},$("CHECK_LOCAL_STATS_INTERVAL")),xe=MC({},z);xE.set(F,{timer:de,adaptationConfig:xe,originConfig:z,adaptationFunc:re}),A.debug("[".concat(F,"] start adaptation, originConfig: ").concat(JSON.stringify(z),", degradationPreference: ").concat(X))})(this.id+p.mid,f,this,k,F=>{s&&this.updateAdaptation(s,F)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var v;let{bitrateMax:k,frameRate:F,scaleResolutionDownBy:z}=t._encoderConfig;k&&(h.maxBitrate=1e3*k),(je(v=t._hints).call(v,Zt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(F&&(h.maxFramerate=Bn(F)),z&&z>=1&&(h.scaleResolutionDownBy=z))}let{maxFramerate:b}=$("ENCODER_CONFIG_LIMIT");if(b&&typeof b=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,b):b),$("DSCP_TYPE")&&tc()){var w;let k=$("DSCP_TYPE");je(w=["very-low","low","medium","high"]).call(w,k)&&(h.networkPriority=k)}let T=s.getParameters(),U=(c=T.encodings)===null||c===void 0?void 0:c[0];Cs()&&!U&&(d.encodings=[h]),U&&Object.assign(U,h),Object.assign(T,d),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(T.encodings))),await s.setParameters(T),await async function(k,F,z){try{var Y;if(!jt().supportSetRtpSenderParameters||!function(de){return de==="vp9"||de==="av1"}(k)||!$("ENABLE_SVC"))return;let X={},re={},te=F.getParameters(),Z=(Y=te.encodings)===null||Y===void 0?void 0:Y[0];re.scalabilityMode=lE(z),Z&&Object.assign(Z,re),Object.assign(te,X),await F.setParameters(te),A.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(te.encodings)))}catch(X){A.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",X)}}(this.store.codec,s,$("SVC_MODE"))}async updateAdaptation(t,s){var a,c;if(!t)return A.debug("[updateAdaptation] no rtpSender found");if(!jt().supportSetRtpSenderParameters)return A.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let d={},{bitrateMax:h,frameRate:p,scaleResolutionDownBy:f}=s;h&&(d.maxBitrate=1e3*h),p&&(d.maxFramerate=Bn(p)),f&&f>=1&&je(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=f);let _=t.getParameters(),v=(c=_.encodings)===null||c===void 0?void 0:c[0];v&&Object.assign(v,d),Object.assign(_,{});try{await t.setParameters(_),A.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(_.encodings)))}catch(b){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?A.debug("[updateAdaptation] peerConnection not connected}"):A.debug("[updateAdaptation] updateRtpSenderEncodings failed",b):A.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,s){try{if(!jt().supportSetRtpSenderParameters||t.length!==s.length)return;for(let a=0;a<t.length;a++){let c=t[a],d=s[a];d instanceof as&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,a){let c=xn(t);return s.forEach((d,h)=>{let p=a[h],f=c.mediaDescriptions.find(_=>_.attributes.mid===p);f&&(xh(f,d),RU(f,d,this.store.codec))}),Bc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let f=0;f<t.length;f++){var a,c,d,h,p;let _=t[f],v=s[f];if(v instanceof as&&!je(a=v._hints).call(a,Zt.LOW_STREAM)&&(c=v._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=v._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=v._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){let b={},w={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];let T=_.sender.getParameters();await _.sender.setParameters(Object.assign(T,b))}}}async applySimulcastEncodings(t,s){if(!Cs()&&t.length===s.length)for(let a=0;a<t.length;a++){let c=s[a];if(c instanceof as&&this.isVP8Simulcast(c)){let d=t[a],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];let f=d.sender.getParameters();await d.sender.setParameters(Object.assign(f,h))}}}isVP8Simulcast(t){var s,a,c,d,h;return!!(t instanceof as&&$("SIMULCAST")&&this.store.codec==="vp8"&&!je(s=t._hints).call(s,Zt.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,s,a,c){if($("SDP_LOGGING"))return A.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),t),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let s=this.remoteSDP.getSSRC(t);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(t){if(jt().supportPCSetConfiguration){let s=Bd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}t.isPreallocation&&(this.isPreallocation=!0)}},Je(It.prototype,"updateRemoteRTPCapabilities",[hn],Object.getOwnPropertyDescriptor(It.prototype,"updateRemoteRTPCapabilities"),It.prototype),Je(It.prototype,"connect",[hn],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),Je(It.prototype,"updateRemoteConnect",[hn],Object.getOwnPropertyDescriptor(It.prototype,"updateRemoteConnect"),It.prototype),Je(It.prototype,"createDataChannels",[hn],Object.getOwnPropertyDescriptor(It.prototype,"createDataChannels"),It.prototype),Je(It.prototype,"receive",[hn],Object.getOwnPropertyDescriptor(It.prototype,"receive"),It.prototype),Je(It.prototype,"batchReceive",[hn],Object.getOwnPropertyDescriptor(It.prototype,"batchReceive"),It.prototype),Je(It.prototype,"stopReceiving",[hn],Object.getOwnPropertyDescriptor(It.prototype,"stopReceiving"),It.prototype),Je(It.prototype,"muteRemote",[hn],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),Je(It.prototype,"unmuteRemote",[hn],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),Je(It.prototype,"muteLocal",[hn],Object.getOwnPropertyDescriptor(It.prototype,"muteLocal"),It.prototype),Je(It.prototype,"unmuteLocal",[hn],Object.getOwnPropertyDescriptor(It.prototype,"unmuteLocal"),It.prototype),Je(It.prototype,"close",[hn],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),Je(It.prototype,"updateEncoderConfig",[hn],Object.getOwnPropertyDescriptor(It.prototype,"updateEncoderConfig"),It.prototype),Je(It.prototype,"updateSendParameters",[hn],Object.getOwnPropertyDescriptor(It.prototype,"updateSendParameters"),It.prototype),Je(It.prototype,"replaceTrack",[hn],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),Je(It.prototype,"updateAdaptation",[hn],Object.getOwnPropertyDescriptor(It.prototype,"updateAdaptation"),It.prototype),Je(It.prototype,"getRemoteSSRC",[hn],Object.getOwnPropertyDescriptor(It.prototype,"getRemoteSSRC"),It.prototype),It);function hn(e,t,s){let a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},s}function BC(e,t){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=Bn(t.width),a.height=Bn(t.height);let c=Bn(t.framerate||15);document.body.append(s),document.body.append(a);let d=e._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();let h=a.getContext("2d");if(!h)throw new ue(K.UNEXPECTED_ERROR,"can not get canvas context");let p=jt(),f=a.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0];f.canvas||(f.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){let v=s.videoWidth,b=s.videoHeight/v,w=a.width*b;Math.abs(w-a.height)>=2&&(A.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(w)),a.height=w)}h.drawImage(s,0,0,a.width,a.height),f.requestFrame&&f.requestFrame(),d!==e._mediaStreamTrack&&(d=e._mediaStreamTrack,s.srcObject=new MediaStream([d]))},a.stopCapture=K0(()=>a.startCapture&&a.startCapture(),c);let _=f.stop;return f.stop=()=>{_.call(f),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),A.debug("clean low stream renderer")},f}var c5=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(c5||{}),Ga=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Ga||{}),ft=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(ft||{}),gr=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(gr||{}),pn=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(pn||{}),SE=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(SE||{});let Ed=1e3,CE=6,sf=3,zae=Math.max(CE,sf,60);function ot(e,t,s){s!=null&&Number.isFinite(s)&&(e[t]=Math.round(Math.max(0,s)))}function l5(e){let t={[pn.CONN_TYPE]:0,[pn.RTT]:e.rtt,[pn.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let s=e.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(t[pn.CONN_TYPE]=1),s==="tcp"&&(t[pn.CONN_TYPE]=3),s==="tls"&&(t[pn.CONN_TYPE]=4);break}case"srflx":t[pn.CONN_TYPE]=2;break;case"unknown":t[pn.CONN_TYPE]=5;break;default:t[pn.CONN_TYPE]=0}return t}function d5(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class u5 extends bs{constructor(t){super(),B(this,"store",void 0),B(this,"uploadWRTCStatsTimer",void 0),B(this,"uploadOutboundDenoiserStatsTimer",void 0),B(this,"uploadExtStatsTimer",void 0),B(this,"uploadExtUsageStatsTimer",void 0),B(this,"uploadInboundExtStatsTimer",void 0),B(this,"requestStats",void 0),B(this,"requestTransportStats",void 0),B(this,"requestLocalMedia",void 0),B(this,"requestRemoteMedia",void 0),B(this,"requestAllTracks",void 0),B(this,"requestVideoIsReady",void 0),B(this,"requestUploadStats",void 0),B(this,"requestUpload",void 0),B(this,"uploadOutboundStarted",!1),B(this,"uploadInboundStarted",!1),B(this,"uploadTransportStarted",!1),B(this,"uploadBaseStatsStarted",!1),B(this,"uploadExtensionUsageStarted",!1),B(this,"lastRecvStats",void 0),B(this,"lastSendStats",void 0),B(this,"lastRefRecvStats",void 0),B(this,"lastRefSendStats",void 0),B(this,"lastNormalRecvStats",void 0),B(this,"lastNormalSendStats",void 0),B(this,"lastExtendStats",{}),B(this,"needUploadStats",{}),B(this,"needUploadRenderFreezeTime",!0),B(this,"lastUploadCompensateTime",-1),B(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let s=t%sf==0,a=t%CE==0,c=t%60==0,d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var p;let f={};if(this.uploadTransportStarted&&d){let v=this.getTransportStats(d,h,s);v&&(f.misc=[v])}if(this.uploadOutboundStarted&&d){let v=this.getOutboundStats(d,a?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,c);v&&(f.outbound=[v])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(t);let v=this.getInboundStats(h,a?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);v&&(f.inbound=v)}let _=(p=this.requestTransportStats)===null||p===void 0?void 0:p.call(this).connectState;_&&(Array.isArray(f.misc)?f.misc[0]&&f.misc[0].addition&&(f.misc[0].addition[SE.RTC_PEER_CONNECTION_STATE]=I0[_]):f.misc=[{addition:{[SE.RTC_PEER_CONNECTION_STATE]:I0[_]}}]),this.needUploadStats.sendType&&(Array.isArray(f.outbound)&&f.outbound[0]&&f.outbound[0].high&&(f.outbound[0].high[c5.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(f)}this.lastRecvStats=h,this.lastSendStats=d,a&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),s&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;let c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[SE.RTC_PEER_CONNECTION_STATE]:I0[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===zae+1&&(t=1)},Ed)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let s=t%sf==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;let d=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let h={};if(this.uploadInboundStarted&&d){let p=this.requestRemoteMedia()||[],f=[];p.forEach(_=>{let[v,b]=_,w={peer:v.uid};if(v._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(v._videoSSRC)&&b.has(ze.VIDEO)&&v.videoTrack){let T=function(U,k,F){if(!k.videoRecv.find(Y=>Y.ssrc===U))return;let z={};if(F&&F._player){let Y=F._player,{renderFreezeAccTime2:X,videoElementStatus:re}=Y;if(wo.visibility==="visible"&&re===Or.PLAYING&&jt().supportRequestVideoFrameCallback){let te=Math.min(6e3,X);Y.renderFreezeAccTime2=Math.max(0,X-te),ot(z,Ga.Video_Render_Freeze_Time_Render2,te),$("USE_NEW_RENDER_FREEZE_TIME")&&ot(z,Ga.Video_Render_Freeze_Time_Render,te)}}return z}(v._videoSSRC,d,v.videoTrack);T&&(w.video=T)}w.video&&f.push(w)}),f.length>0&&(h.inbound=f,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,s,a){if(!this.requestStats)return;if(!a)return t.rtt==null?void 0:{addition:{[pn.RTT]:t.rtt,[pn.CONN_TYPE]:void 0,[pn.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let c=l5(t);if(this.store.useP2P){if(s){let d=l5(s);c[pn.CONN_TYPE]+=d[pn.CONN_TYPE]<<3}c[pn.CONN_TYPE]+=110}else c[pn.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(t,s,a,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;let h=this.requestLocalMedia();if(!h||h.length===0)return;let p,f,_;return h.forEach(v=>{let[b,{track:w,ssrcs:T}]=v;switch(b){case Ne.LocalVideoLowTrack:case Ne.LocalVideoTrack:if(b===Ne.LocalVideoTrack){var U;let k=function(X,re,te,Z,de,xe){let Se=re.videoSend.find(dt=>dt.ssrc===X);if(!Se)return;let Ae={},{sentFrame:yt,inputFrame:bt}=Se;if(Z&&(ot(Ae,Ga.Video_Send_Qp_Sum,Se.qpSumPerFrame),bt&&yt)){let dt=bt.frameRate,Wt=yt.frameRate;Ae[Ga.Video_Send_Freeze]=function(Ut,Lr){let we=!0;return we=!(Ut<=5)&&(Ut<=10?Lr<3:Ut<=20?Lr<4:Lr<5),we}(dt,Wt)?1:0}if(de){switch(yt&&(ot(Ae,ft.Video_Send_Height,yt.height),ot(Ae,ft.Video_Send_Width,yt.width),ot(Ae,ft.Video_Send_Frame_Rate,yt.frameRate)),Ae[ft.Video_Send_Disabled]=te._originMediaStreamTrack&&!te._originMediaStreamTrack.enabled||te._mediaStreamTrack&&!te._mediaStreamTrack.enabled?1:0,Se.adaptionChangeReason){case"none":Ae[ft.Video_Send_Adaptation]=0;break;case"cpu":Ae[ft.Video_Send_Adaptation]=1;break;case"bandwidth":Ae[ft.Video_Send_Adaptation]=2;break;case"other":Ae[ft.Video_Send_Adaptation]=3}let dt=0;Se.adaptionChangeReason&&(dt+=d5(Se.adaptionChangeReason)),re.qualityLimitationReason&&(dt+=d5(re.qualityLimitationReason)<<3),Ae[ft.Video_Send_Adaptation]=dt,Ae[ft.Video_Send_Player_Status]=H0[te._player?te._player.videoElementStatus:"uninit"],ot(Ae,ft.Video_Send_Nacks,Se.nacksCount),ot(Ae,ft.Video_Send_Plis,Se.plisCount),ot(Ae,ft.Video_Send_Firs,Se.firsCount),ot(Ae,ft.Video_Send_Avg_Encode,Se.avgEncodeMs),ot(Ae,ft.Video_Send_Huge_Frame_Sent,Se.hugeFramesSent),ot(Ae,ft.Video_Send_Bytes_Retransmit,Se.retransmittedBytesSent),ot(Ae,ft.Video_Send_Packages_Retransmit,Se.retransmittedPacketsSent),ot(Ae,ft.Video_Send_Key_Frames_Encoded,Se.keyFramesEncoded);let Wt=de.videoSend.find(Ut=>Ut.ssrc===X);if(Wt){let Ut=Ed*sf;Wt.timestamp&&Se.timestamp&&(Ut=Se.timestamp-Wt.timestamp),Wt.packets!=null&&Se.packets!=null&&ot(Ae,ft.Video_Send_Package_Rate,1e3*(Se.packets-Wt.packets)/Ut),Se.packetsLost!=null&&Wt.packetsLost!=null&&ot(Ae,ft.Video_Send_Package_Lost,Se.packetsLost-Wt.packetsLost),Wt.bytes!=null&&Se.bytes!=null&&ot(Ae,ft.Video_Send_Bitrate,8*(Se.bytes-Wt.bytes)/Ut)}}return Ae}(T[0].ssrcId,t,w,s,a),F=w.__className__==="CameraVideoTrack"?3:je(U=w._hints).call(U,Zt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==F||d)&&(this.needUploadStats={sendType:F},this.lastExtendStats.sendType=F);let z=w&&function(X,re,te,Z){let de=re.videoSend.find(Se=>Se.ssrc===X);if(!de)return null;let xe={};if(Z){let Se=de.inputFrame,Ae=Se&&Se.height||te.videoHeight||0,yt=Se&&Se.width||te.videoWidth||0,bt=Se&&Se.frameRate||0;ot(xe,ft.Video_Capture_Height,Ae),ot(xe,ft.Video_Capture_Width,yt),ot(xe,ft.Video_Capture_Frame_Rate,bt)}return xe}(T[0].ssrcId,t,w,!!a),Y=function(X,re){let te={};return re&&(ot(te,ft.Video_Send_Retransmit,X.bitrate.retransmit),ot(te,ft.Video_Send_Target_Encoded,X.bitrate.targetEncoded),ot(te,ft.Video_Send_Actual_Encoded,X.bitrate.actualEncoded),ot(te,ft.Video_Send_Transmit,X.bitrate.transmit),ot(te,ft.Video_Send_Bandwidth,X.sendBandwidth)),te}(t,!!a);f=Object.assign({},k,z,Y)}else _=function(k,F,z,Y,X){let re=F.videoSend.find(Z=>Z.ssrc===k);if(!re)return;let te={};if(Y){let Z=re.sentFrame;Z&&(ot(te,ft.Video_Send_Low_Height,Z.height),ot(te,ft.Video_Send_Low_Width,Z.width),ot(te,ft.Video_Send_Low_Frame_Rate,Z.frameRate));let de=Y.videoSend.find(xe=>xe.ssrc===k);if(de){let xe=Ed*CE;de.timestamp&&re.timestamp&&(xe=re.timestamp-de.timestamp),de.packets!=null&&re.packets!=null&&ot(te,ft.Video_Send_Low_Package_Rate,1e3*(re.packets-de.packets)/xe),re.packetsLost!=null&&de.packetsLost!=null&&ot(te,ft.Video_Send_Low_Package_Lost,re.packetsLost-de.packetsLost),de.bytes!=null&&re.bytes!=null&&ot(te,ft.Video_Send_Low_Bitrate,8*(re.bytes-de.bytes)/xe)}}return te}(T[0].ssrcId,t,0,a);break;case Ne.LocalAudioTrack:p=w&&function(k,F,z,Y,X,re){let te=F.audioSend.find(de=>de.ssrc===k);if(!te)return;let Z={};if(X){Z[ft.Audio_Send_Disabled]=z._originMediaStreamTrack&&!z._originMediaStreamTrack.enabled||z._mediaStreamTrack&&!z._mediaStreamTrack.enabled?1:0;let de=100*z._source.getAccurateVolumeLevel(),xe=te.inputLevel;if(xe!=null){let Ae=Math.ceil(50*Math.log10(100*xe+1));ot(Z,ft.Audio_Send_Level,Ae)}ot(Z,ft.Audio_Capture_PCM_Level,de),ot(Z,ft.Audio_Send_AEC_Return_Loss,te.aecReturnLoss),ot(Z,ft.Audio_Send_AEC_Return_Loss_Enhancement,te.aecReturnLossEnhancement),ot(Z,ft.Audio_Send_Bytes_Retransmit,te.retransmittedBytesSent),ot(Z,ft.Audio_Send_Packages_Retransmit,te.retransmittedPacketsSent),Z[ft.Audio_Send_Freeze]=0;let Se=X.audioSend.find(Ae=>Ae.ssrc===k);if(Se){let Ae=Ed*CE;Se.timestamp&&te.timestamp&&(Ae=te.timestamp-Se.timestamp),Se.bytes!=null&&te.bytes!=null&&ot(Z,ft.Audio_Send_Bitrate,8*(te.bytes-Se.bytes)/Ae),Se.packets!=null&&te.packets!=null&&ot(Z,ft.Audio_Send_Package_Rate,1e3*(te.packets-Se.packets)/Ae)}}return Z}(T[0].ssrcId,t,w,0,a)}}),{high:f,low:_,audio:p}}getInboundStats(t,s,a,c){if(!this.requestRemoteMedia)return;let d=this.requestRemoteMedia()||[],h=[];return d.forEach(p=>{let[f,_]=p,v={peer:f.uid};if(_.has(ze.VIDEO)&&f.videoTrack){let b=f._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(f._videoSSRC)||!1,w=f.videoTrack?function(T,U,k,F,z,Y,X,re){let te=U.videoRecv.find(dt=>dt.ssrc===T);if(!te)return;let Z={},{receivedFrame:de,outputFrame:xe,decodeFrameRate:Se}=te;ot(Z,gr.Video_Render_Frame_Rate_Decode,Se),te.framesRateFirefox&&ot(Z,gr.Video_Recv_Frame_Rate,te.framesRateFirefox),de&&ot(Z,gr.Video_Recv_Frame_Rate,de.frameRate),ot(Z,gr.Video_Recv_Frame_Dropped,te.framesDroppedCount),ot(Z,gr.Video_Recv_Bytes_Retransmit,te.retransmittedBytesReceived),ot(Z,gr.Video_Recv_Packages_Retransmit,te.retransmittedPacketsReceived),ot(Z,gr.Video_Recv_Packages_Discarded,te.packetsDiscarded),ot(Z,gr.Video_Recv_Avg_Decode,te.avgDecodeMs),ot(Z,gr.Video_Recv_Avg_Processing_Delay,te.avgProcessingDelayMs),ot(Z,gr.Video_Recv_Avg_Assembly_Time,te.avgFramesAssembledFromMultiplePacketsMs),ot(Z,gr.Video_Recv_Avg_Inter_Frame_Delay,te.avgInterFrameDelayMs),ot(Z,gr.Video_Recv_Key_Frames_Decoded,te.keyFramesDecoded);let Ae=re&&re.videoRecv.find(dt=>dt.ssrc===T);if(Ae){let dt=U.timestamp-re.timestamp||Ed;te.packetsLost!=null&&Ae.packetsLost!=null&&ot(Z,gr.Video_Recv_Package_Lost,te.packetsLost-Ae.packetsLost),Ae.bytes!=null&&te.bytes!=null&&ot(Z,gr.Video_Recv_Bitrate,8*(te.bytes-Ae.bytes)/dt),Ae.packets!=null&&te.packets!=null&&ot(Z,gr.Video_Recv_Package_Rate,1e3*(te.packets-Ae.packets)/dt)}let yt=Y&&Y.videoRecv.find(dt=>dt.ssrc===T);if(yt&&(ot(Z,Ga.Video_Recv_Qp_Sum,te.qpSumPerFrame),Z[Ga.Video_Recv_Freeze]=F&&tf.isRemoteVideoFreeze(k,te,yt)?1:0),X){var bt;let dt=X.videoRecv.find(Ut=>Ut.ssrc===T);de?(ot(Z,ft.Video_Recv_Height,de.height),ot(Z,ft.Video_Recv_Width,de.width)):k&&(ot(Z,ft.Video_Recv_Height,k._videoHeight||0),ot(Z,ft.Video_Recv_Width,k._videoWidth||0)),xe&&ot(Z,ft.Video_Recv_Frame_Rate_Output,xe.frameRate);let Wt=(bt=k._player)===null||bt===void 0?void 0:bt.rendFrameRate.toFixed(0);if(Wt&&ot(Z,ft.Video_Render_Frame_Rate_Render,+Wt),ot(Z,ft.Video_Recv_Jitter_Buffer,te.jitterBufferMs),ot(Z,ft.Video_Recv_Current_Delay,te.currentDelayMs),ot(Z,ft.Video_Recv_Firs,te.firsCount),ot(Z,ft.Video_Recv_Nacks,te.nacksCount),ot(Z,ft.Video_Recv_Plis,te.plisCount),k){Z[ft.Video_Recv_Disabled]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1;let Ut=k._player;if(Ut){let{freezeTimeCounterList:Lr,renderFreezeAccTime:we,renderFreezeAccTime2:Pe,videoElementStatus:Ke}=Ut;if(Lr&&Lr.length>0&&ot(Z,Ga.Video_Render_Freeze_Time,Lr.splice(0,1)[0]),z&&wo.visibility==="visible"&&Ke===Or.PLAYING&&jt().supportRequestVideoFrameCallback){let Te=Math.min(6e3,Pe);Ut.renderFreezeAccTime2=Math.max(0,Pe-Te),ot(Z,Ga.Video_Render_Freeze_Time_Render2,Te);let j=Math.min(6e3,we);Ut.renderFreezeAccTime=Math.max(0,we-j),ot(Z,Ga.Video_Render_Freeze_Time_Render,$("USE_NEW_RENDER_FREEZE_TIME")?Te:j)}if(typeof te.totalFreezesDuration=="number"){let Te=dt&&dt.totalFreezesDuration?te.totalFreezesDuration-dt.totalFreezesDuration:te.totalFreezesDuration;ot(Z,ft.Video_Render_Freeze_Duration,1e3*Te)}}}if(Z[ft.Video_Recv_Player_Status]=H0[k._player?k._player.videoElementStatus:"uninit"],dt&&te.totalInterFrameDelay!==void 0&&te.totalSquaredInterFrameDelay!==void 0&&dt.totalInterFrameDelay!==void 0&&dt.totalSquaredInterFrameDelay!==void 0){let Ut=te.totalInterFrameDelay-dt.totalInterFrameDelay,Lr=te.totalSquaredInterFrameDelay-dt.totalSquaredInterFrameDelay,we=te.framesDecodeCount-dt.framesDecodeCount,Pe=Ut/we*1e3,Ke=Math.round(1e3*Math.sqrt((Lr-Math.pow(Ut,2)/we)/we));!isNaN(Ke)&&Pe+Ke>Math.max(3*Pe,Pe+150)&&(Z[ft.Video_Recv_I_Frame_Delay]=Ke)}}return Z}(f._videoSSRC,t,f.videoTrack,b===!0,this.needUploadRenderFreezeTime,s,a,c):void 0;w&&(v.video=w)}if(_.has(ze.AUDIO)&&f.audioTrack){let b=f.audioTrack?function(w,T,U,k,F,z){let Y=T.audioRecv.find(Z=>Z.ssrc===w);if(!Y)return;let X={};ot(X,gr.Audio_Recv_Jitter,Y.jitterMs),ot(X,gr.Audio_Recv_Bytes_Retransmit,Y.retransmittedBytesReceived),ot(X,gr.Audio_Recv_Packages_Retransmit,Y.retransmittedPacketsReceived),ot(X,gr.Audio_Recv_Packages_Discarded,Y.packetsDiscarded),ot(X,gr.Audio_Recv_Avg_Processing_Delay,Y.avgProcessingDelayMs);let re=z&&z.audioRecv.find(Z=>Z.ssrc===w);if(re){let Z=Ed;Y.packets!=null&&re.packets!=null&&ot(X,gr.Audio_Recv_Package_Rate,1e3*(Y.packets-re.packets)/Z),Y.packetsLost!=null&&re.packetsLost!=null&&ot(X,gr.Audio_Recv_Package_Lost,Y.packetsLost-re.packetsLost)}if(k){let{receivedFrames:Z,droppedFrames:de}=Y;Z!=null&&de!=null&&(X[Ga.Audio_Recv_Freeze]=(te=Z)===0||100*de/te>20?1:0)}var te;if(F){let Z=100*U._source.getAccurateVolumeLevel(),de=Y.outputLevel;if(de!=null){let Se=Math.ceil(50*Math.log10(100*de+1));ot(X,ft.Audio_Render_Level,Se)}ot(X,ft.Audio_Recv_PCM_Level,Z),U&&(X[ft.Audio_Recv_Disabled]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),ot(X,ft.Audio_Recv_Jitter_Buffer,Y.jitterBufferMs),ot(X,ft.Audio_Recv_Current_Delay,Y.jitterBufferMs),X[ft.Audio_Recv_Player_Status]=H0[un.getPlayerState(U.getTrackId())];let xe=F.audioRecv.find(Se=>Se.ssrc===w);if(xe){xe.bytes!=null&&Y.bytes!=null&&ot(X,ft.Audio_Recv_Bitrate,8*(Y.bytes-xe.bytes)/(Ed*sf));let Se=Y.concealedSamples-xe.concealedSamples;Se>0&&ot(X,ft.Audio_Recv_Concealed_Samples,Se);let Ae=Y.totalSamplesReceived-xe.totalSamplesReceived;Ae>0&&ot(X,ft.Audio_Recv_Total_Samples_Received,Ae);let yt=Y.freezeSamples80-xe.freezeSamples80;yt>0&&ot(X,ft.Audio_Render_Freeze_Samples_80ms,yt);let bt=Y.freezeSamples200-xe.freezeSamples200;bt>0&&ot(X,ft.Audio_Render_Freeze_Samples_200ms,bt);let dt=Y.freezeMs80-xe.freezeMs80;ot(X,ft.Audio_Render_Freeze_Time_80ms,dt<0?0:dt);let Wt=Y.freezeMs200-xe.freezeMs200;ot(X,ft.Audio_Render_Freeze_Time_200ms,Wt<0?0:Wt)}}return X}(f._audioSSRC,t,f.audioTrack,s,a,c):void 0;b&&(v.audio=b)}(v.video||v.audio)&&h.push(v)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(s=>s instanceof Gm);if(t&&t._external.getDenoiserStats){let s=t._external.getDenoiserStats();s&&this.requestUpload(zm.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[s,a]=t;a.has(ze.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(ze.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let s=Date.now(),a={connectionInterval:$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s},c=[],d=this.requestAllTracks&&this.requestAllTracks()||[];for(let _ of d)!_.muted&&_.enabled&&(c=c.concat(await _.getProcessorUsage()));let h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[_,v]of h)v.has(ze.VIDEO)&&_.videoTrack&&(c=c.concat(await _.videoTrack.getProcessorUsage())),v.has(ze.AUDIO)&&_.audioTrack&&(c=c.concat(await _.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(_,v){let b={};for(let{id:k,value:F,level:z,direction:Y}of _){var w;let X=(w=v.get(k))!==null&&w!==void 0?w:0,re=F===2?X+$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:X;var T,U;v.set(k,re),b[k]?(F===2&&(b[k].value=F),z>b[k].level&&(b[k].level=z),Y==="remote"&&(b[k].remoteUidCount+=1),b[k].totalTs=(T=v.get(k))!==null&&T!==void 0?T:0):b[k]={value:F,level:z,remoteUidCount:Y==="local"?0:1,totalTs:(U=v.get(k))!==null&&U!==void 0?U:0}}return Object.keys(b).map(k=>{let{level:F,value:z,totalTs:Y}=b[k];return{id:k,level:F,value:z,totalTs:Y}})}(c,t);let p=Date.now(),f=p>s?p:s+1;this.requestUpload&&this.requestUpload(zm.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:f})},$("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let Kae=$("ICE_RESTART_INTERVAL"),TE=new Map,Th=new Map,Qc=[Pr.UDP_TCP_RELAY,Pr.TCP_RELAY,Pr.RELAY],WC=$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jt().supportPCSetConfiguration;function h5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=TE.get(e.id);s&&(window.clearTimeout(s),TE.delete(e.id));let a=Th.get(e.id);t&&a&&a.index===Qc.length-1&&(A.debug("[".concat(e.id,"] reset ICE restart policy")),Th.delete(e.id))}function p5(e,t,s){if(TE.size===0&&Th.size===0&&(Array.isArray($("RESTART_SEQUENCE"))&&$("RESTART_SEQUENCE").length>0&&!function(p,f){if(p.length!==f.length)return!1;for(let _=0;_<p.length;_+=1){let v=p[_];if(p.filter(b=>b===v).length!==f.filter(b=>b===v).length)return!1}return!0}(Qc,$("RESTART_SEQUENCE"))&&(Qc=$("RESTART_SEQUENCE").filter(p=>{var f;if(je(f=Object.values(Pr)).call(f,p))return!0}),A.debug("use reconnection policy from config distribution, queues: ".concat(Qc.join(" => ")))),WC=$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jt().supportPCSetConfiguration),Qc.length===0)return void s();let a,{index:c=0,type:d}=Th.get(e.id)||{};if(WC&&d===Pr.RELAY)return void s();let h=d&&c>=Qc.length-1;if(WC)d=Pr.RELAY;else{if(h)return void s();d?(c++,d=Qc[c]):(d=Qc[0],c=0)}A.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),t(d),Th.set(e.id,{index:c,type:d}),a=window.setTimeout(()=>p5(e,t,s),Kae),TE.set(e.id,a)}var St;function m5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function To(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?m5(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function f5(e){var t,s,a,c=2;for(typeof Symbol<"u"&&(s=r0,a=Symbol.iterator);c--;){if(s&&(t=e[s])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new NE(t.call(e));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function NE(e){function t(s){if(Object(s)!==s)return Ve.reject(new TypeError(s+" is not an object."));var a=s.done;return Ve.resolve(s.value).then(function(c){return{value:c,done:a}})}return NE=function(s){this.s=s,this.n=s.next},NE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?Ve.resolve({value:s,done:!0}):t(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?Ve.reject(s):t(a.apply(this.s,arguments))}},new NE(e)}let rf=(St=class extends bs{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(tt.StateChange,t,this._state)}constructor(e,t){super(),B(this,"isPlanB",void 0),B(this,"store",void 0),B(this,"statsUploader",void 0),B(this,"connection",void 0),B(this,"localTrackMap",new Map),B(this,"remoteUserMap",new Map),B(this,"localDataChannels",[]),B(this,"remoteDataChannelMap",new Map),B(this,"pendingLocalTracks",[]),B(this,"pendingRemoteTracks",[]),B(this,"pendingLocalDataChannels",[]),B(this,"pendingRemoteDataChannels",[]),B(this,"statsCollector",void 0),B(this,"shouldForwardP2PCreation",void 0),B(this,"iceFailedCount",0),B(this,"dtlsFailedCount",0),B(this,"mutex",void 0),B(this,"_state",Ht.Disconnected),B(this,"_pcStatsUploadType",$("NEW_ICE_RESTART")?ic.FIRST_CONNECTION:ic.OLD_FIRST_CONNECTION),B(this,"_isStartRestartIce",!1),B(this,"_restartTimer",void 0),B(this,"_isTryConnecting",!1),B(this,"_iceError",null),B(this,"_forceTurn",!1),B(this,"_isWaitPcToRePub",!1),B(this,"handleMuteLocalTrack",async(s,a,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ht.Connected)return void c(new _e(K.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();let p=h.find(_=>_[0]==="videoLowTrack");if(p){let _=p[1];this.store.enableInstantMuteRestore?(_.track._originMediaStreamTrack.enabled=!1,A.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):_.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?A.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(_=>{let[,{id:v}]=_;return v}));let f=this.createMuteMessage(h);await es(this,tt.RequestMuteLocal,f),a()}catch(h){c(h)}finally{d()}}),B(this,"handleUnmuteLocalTrack",async(s,a,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ht.Connected)return void c(new _e(K.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();let p=h.find(_=>_[0]==="videoLowTrack");if(p){let _=p[1];if(this.store.enableInstantMuteRestore)_.track._originMediaStreamTrack.enabled=!0,A.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(_.track._originMediaStreamTrack.stop(),!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding){let v=s._mediaStreamTrack.clone();_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v}else{let v=BC(s,Lm(this,tt.RequestLowStreamParameter));_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v}await new Ve((v,b)=>{this.handleReplaceTrack(_.track,v,b,!0)})}}this.store.enableInstantMuteRestore?A.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(_=>{let[,{id:v}]=_;return v}));let f=this.createUnmuteMessage(h);await es(this,tt.RequestUnmuteLocal,f),a()}catch(h){c(h)}finally{d()}}),B(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let f=this.localTrackMap.get(Ne.LocalVideoTrack);if(!this.connection||!f||f.track!==s||this.state!==Ht.Connected)return void a();let{id:_,track:v}=f;await this.connection.updateSendParameters(_,v),await this.connection.updateEncoderConfig(_,v),this.emit(tt.UpdateVideoEncoder,v),a()}catch(f){c(f)}finally{var p;(p=h)===null||p===void 0||p()}}),B(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{let d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let h=this.localTrackMap.get(Ne.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Ht.Connected)return void a();let{id:p,track:f}=h;await this.connection.updateSendParameters(p,f),a()}catch(h){c(h)}finally{d()}}),B(this,"handleReplaceMixingTrack",async(s,a,c,d)=>{if(!this.connection||this.state!==Ht.Connected)return void a();let h=UC([s]),p;A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(p=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(_){c(_)}finally{var f;(f=p)===null||f===void 0||f()}}),B(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;A.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var p;let _=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:b}]=v;return s===b});if(!this.connection||!_||this.state!==Ht.Connected)return void a();if(await((p=this.connection)===null||p===void 0?void 0:p.replaceTrack(s,_[1].id)),this.isPlanB){let v=_[1];v.id=s._mediaStreamTrack.id,this.localTrackMap.set(_[0],v)}if(_[0]===Ne.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding){let v=this.localTrackMap.get(Ne.LocalVideoLowTrack);if(v){let b=s._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=b,v.track._originMediaStreamTrack=b,await new Ve((w,T)=>{this.handleReplaceTrack(v.track,w,T,!0)})}}a()}catch(_){c(_)}finally{var f;(f=h)===null||f===void 0||f()}}),B(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),B(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),B(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),B(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),B(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new u5(this.store),this.bindStatsUploaderEvents(),this.mutex=new Dr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!jt().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&tc(),this.shouldForwardP2PCreation=$("FORWARD_P2P_CREATION")&&jt().supportPCSetConfiguration&&_0(),this.shouldForwardP2PCreation&&(this.connection=wE(this.store),this.emit(tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var s;this.state=Ht.New,this._forceTurn=a5(e),A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let a=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||a||t)&&((a||t)&&this.connection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=wE(this.store,e),this.emit(tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=$("NEW_ICE_RESTART")?ic.FIRST_CONNECTION:ic.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Ht.Connected){if(this.connection instanceof Ai&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Qe.reportApiInvoke(this.store.sessionId,{name:Os.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:vs.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(tt.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ht.Connected}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return je(d=[Ne.LocalVideoLowTrack,Ne.LocalVideoTrack]).call(d,h)}),s=t.map(c=>{let[,{id:d}]=c;return d}),a=t.map(c=>{let[d]=c;return d});if(this.connection instanceof Ai){if(Qe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!je(e).call(e,this.store.codec)){let c=["vp9","vp8","h264"].find(d=>je(e).call(e,d));c&&(this.store.codec=c,A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ai&&this.connection.peerConnectionState!=="closed"&&je(e=[Ht.New,Ht.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Ht.Connected){if(this.state===Ht.Disconnected)throw new _e(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(s=>{var a;je(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(s=>{let a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(s=>{this.localDataChannels.push(s);let a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)}),e.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(e,t,s){var a=this;return wi(function*(){let c=yield Ot(a.mutex.lock("From P2PChannel.publish"));try{var d;let h=a.connection&&je(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==Ht.Connected||h){if(a.state===Ht.Disconnected)throw new _e(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(e);let f=e.filter(_=>a.pendingLocalTracks.indexOf(_)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(f),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,kr.markPublishStart(a.store.clientId,a.store.pubId);let p=a.filterTobePublishedTracks(e,t,s);if(p.length===0)return void(yield Ot(a.tryToUnmuteAudio(e)));yield*Ev(f5(a.doPublish(a.connection,p)))}finally{c()}})()}doPublish(e,t){var s=this;return wi(function*(){t.forEach(w=>{let{track:T,type:U}=w,k=Date.now();s.store.publish(T.getTrackId(),U===Ne.LocalAudioTrack?"audio":"video",k)}),s.bindLocalTrackEvents(t);let a=t.map(w=>{let{track:T}=w;return T}),c=yield Ot(e.send(a,s.store.codec,s.store.audioCodec)),d=(yield Ot(c.next())).value,h=s.createGatewayPublishMessage(t,d),p;try{p=yield h}catch(w){throw c.throw(w),(w==null?void 0:w.code)===K.WS_ABORT&&t.forEach(T=>{let{track:U}=T;s.pendingLocalTracks.indexOf(U)===-1&&s.pendingLocalTracks.push(U)}),s.unbindLocalTrackEvents(t),w}let f=s.mapPubResToRemoteConfig(h,p,a),_=(yield Ot(c.next(f))).value;if(s.state===Ht.Disconnected)throw new _e(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");$("ENABLE_VIDEO_SEI");let v=$("ENABLE_ENCODED_TRANSFORM"),b=$("ENABLE_AUDIO_METADATA");a.forEach(async w=>{let T=w.getRTCRtpTransceiver();if(!T||!v)return;let{interceptLocalVideoFrame:U,interceptLocalAudioFrame:k}=mE();w.trackMediaType===ze.VIDEO?await U(T.sender,w):w.trackMediaType===ze.AUDIO&&await k(T.sender,{metadata:b?()=>{let F=w.metadata.shift();return F&&F.value}:void 0})}),t.forEach(w=>{let{type:T}=w;s.statsCollector.addLocalStats(T)}),s.assignLocalTracks(t,_),s.statsUploader.startUploadOutboundStats(),t.forEach(w=>{let{track:T,type:U}=w,k=Date.now();s.store.publish(T.getTrackId(),U===Ne.LocalAudioTrack?"audio":"video",void 0,k)})})()}async updateVideoStreamParameter(e,t){let s=this.localTrackMap.get(t);if(!s||!this.connection)return;if(!(s.track instanceof as))return A.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:a}=s,c=function(d,h){let p={};return d.height&&d.width&&(p.scaleResolutionDownBy=xC(d,h)),p.maxFramerate=d.framerate?Bn(d.framerate):void 0,p.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,p}(e,a);if(a._encoderConfig||(a._encoderConfig={}),t!==Ne.LocalVideoLowTrack||!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{let d=a._originMediaStreamTrack;if(!d.canvas)return A.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,p){let f=h.canvas;p.width&&(f.width=Bn(p.width)),p.height&&(f.height=Bn(p.height)),p.framerate&&(f.stopCapture&&f.stopCapture(),f.stopCapture=K0(()=>{!f.startCapture&&f.stopCapture&&f.stopCapture(),f.startCapture&&f.startCapture()},Bn(p.framerate)))})(d,e)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),A.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(e){var t=this;return wi(function*(){if(!t.connection||t.state!==Ht.Connected)return;let s=yield Ot(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let c=t.localTrackMap.get(Ne.LocalVideoTrack);if(!c)throw new _e(K.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Ne.LocalVideoLowTrack))throw new _e(K.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let d=[{track:t.getLowVideoTrack(c.track,e),type:Ne.LocalVideoLowTrack}];if(yield*Ev(f5(t.doPublish(t.connection,d))),c.track.muted||!c.track.enabled){var a;let h=(a=t.localTrackMap.get(Ne.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield Ot(t.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(A.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Cr(this,tt.RequestRePublish,this.pendingLocalTracks),this.emit(tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(A.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Cr(this,tt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:s,kind:a}=this.pendingRemoteTracks[t];(a!==ze.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==ze.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Cr(this,tt.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:s}of this.pendingRemoteTracks)await this.subscribe(t,s,s===ze.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:s}=t;this.emit(tt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Ht.Connected)return void e.forEach(a=>{let c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let s=t.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Ht.Connected)return void e.forEach(s=>{let a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(s=>{let a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ht.Connected)return;let e=this.localTrackMap.get(Ne.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[Ne.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let s=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[c,{track:d}]=a;return{type:c,track:d}})),t.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Ht.Connected)throw new _e(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let s=t.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(a.id))});if(s.length!==0)return await this.connection.createDataChannels(e.uid,s),s.forEach(a=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(e,new Map([[a.id,a]]));let d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:p,id:f}=h;return p.uid===e.uid&&f===a.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),s.map(a=>a.id)}async subscribe(e,t,s,a,c){var d;if(!this.connection||this.state!==Ht.Connected)throw new _e(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(e))!==null&&d!==void 0&&d.has(t))return;let h,p,f,_,v=this.connection.getPreMedia(s);if(v)A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),f=v.transceiver,h=v.track,p=v.mid,_=v.player,v.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:v.firstVideoRender});else if(c){let T=c.find(k=>{let{stream_type:F}=k;return F===t});if(!T)throw new _e(K.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let U=await this.connection.receive(t,T.ssrcs,String(e._uintid),T.attributes);this.connection instanceof Ai&&(f=U.transceiver),h=U.track,p=U.id}else{let T=await this.connection.receive(t,[{ssrcId:s,rtx:a}],String(e._uintid),void 0);this.connection instanceof Ai&&(f=T.transceiver),h=T.track,p=T.id}if(t===ze.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new ph(h,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new hh(h,e.uid,e._uintid,this.store,_),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Ti.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Ti.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),_?e._videoTrack.once(Ti.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Ti.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack)),f&&$("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:T,interceptRemoteAudioFrame:U}=mE();t==ze.VIDEO?await T(f.receiver,{onSei:$("ENABLE_VIDEO_SEI")&&(k=>{var F;return(F=e._videoTrack)===null||F===void 0?void 0:F._onSei(k)})}):t==ze.AUDIO&&await U(f.receiver,{enableTopn:!!$("ENABLE_AUDIO_TOPN"),enableMetadata:!!$("ENABLE_AUDIO_METADATA"),enablePts:!!$("ENABLE_AUDIO_PTS"),onMetadata:k=>{this.safeEmit(tt.AudioMetadata,k)},onPts:k=>{this.safeEmit(tt.AudioPts,k)}})}let b=this.remoteUserMap.get(e);b?b.set(t,p):this.remoteUserMap.set(e,new Map([[t,p]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let w=this.pendingRemoteTracks.findIndex(T=>{let{user:U,kind:k}=T;return U.uid===e.uid&&t===k});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(tt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Ht.Connected)throw new _e(K.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var d;let{user:h,mediaType:p}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(p))});let t=[],s=new Map;e.forEach(c=>{if(!this.connection)return;let d=this.connection.getPreMedia(c.ssrcId);if(d){let{track:h,mid:p,transceiver:f,player:_}=d;s.set(c.ssrcId,{track:h,id:p,transceiver:f,player:_})}else t.push(c)});let a=await this.connection.batchReceive(t.map(c=>{let{user:d,mediaType:h,ssrcId:p,rtxSsrcId:f}=c;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:f}],mslabel:String(d._uintid)}}));t.forEach((c,d)=>{s.set(c.ssrcId,a[d])});for(let{user:c,mediaType:d,ssrcId:h}of e){let p=s.get(h);if(!p)return void A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));let{track:f,id:_,transceiver:v,player:b}=p;if(v&&$("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:k}=mE();d==ze.VIDEO?await U(v.receiver,{onSei:$("ENABLE_VIDEO_SEI")&&(F=>{var z;return(z=c._videoTrack)===null||z===void 0?void 0:z._onSei(F)})}):d==ze.AUDIO&&await k(v.receiver,{enableTopn:!!$("ENABLE_AUDIO_TOPN"),enableMetadata:!!$("ENABLE_AUDIO_METADATA"),enablePts:!!$("ENABLE_AUDIO_PTS"),onMetadata:F=>{this.safeEmit(tt.AudioMetadata,F)},onPts:F=>{this.safeEmit(tt.AudioPts,F)}})}if(d===ze.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(f):(c._audioTrack=new ph(f,c.uid,c._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),v&&c._audioTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(f):(c._videoTrack=new hh(f,c.uid,c._uintid,this.store,b),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),v&&c._videoTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(c,c._videoTrack)),$("ENABLE_VIDEO_SEI")&&v){let{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:k}=mE();d==ze.VIDEO?await U(v.receiver,{onSei:F=>{var z;(z=c._videoTrack)===null||z===void 0||z._onSei(F)}}):d==ze.AUDIO&&await k(v.receiver)}let w=this.remoteUserMap.get(c);w?w.set(d,_):this.remoteUserMap.set(c,new Map([[d,_]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();let T=this.pendingRemoteTracks.findIndex(U=>{let{user:k,kind:F}=U;return k.uid===c.uid&&d===F});T!==-1&&(this.pendingRemoteTracks.splice(T,1),this.emit(tt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,s){let a=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:f}=h;return t!==void 0?p.uid===e.uid&&t===f:p.uid===e.uid});if(a.forEach(h=>{let p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),this.connection&&this.state===Ht.Connected||s||a.forEach(h=>{let{kind:p}=h;var f;if(p===ze.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(p===ze.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Ht.Connected)return;let c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:p}]=h;return p}));let d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[p,{kind:f}]=h;var _,v;if(f===ze.VIDEO&&p._videoSSRC&&((_=this.connection)===null||_===void 0||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),f===ze.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),s||((v=p._videoTrack)===null||v===void 0||v._destroy(),p._videoTrack=void 0);else if(f===ze.AUDIO){var b;this.unbindRemoteTrackEvents(p._audioTrack),!s&&((b=p._audioTrack)===null||b===void 0||b._destroy(),p._audioTrack=void 0)}}),d}async unsubscribeDataChannel(e,t){if(t.forEach(c=>{let d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;let s=this.filterTobeUnSubscribedDataChannels(e,t);if(s.length===0)return;t.forEach(c=>{c._close()});let a=this.remoteDataChannelMap.get(e);return s.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),s.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:c,mediaType:d}of e){let h=this.pendingRemoteTracks.filter(p=>{let{user:f,kind:_}=p;return d!==void 0?f.uid===c.uid&&d===_:f.uid===c.uid});h.forEach(p=>{let f=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(f,1)}),t=t.concat(h)}if(!this.connection||this.state!==Ht.Connected)return void t.forEach(c=>{let{user:d,kind:h}=c;var p;if(h===ze.AUDIO)(p=d._audioTrack)===null||p===void 0||p._destroy(),d._audioTrack=void 0;else if(h===ze.VIDEO){var f;(f=d._videoTrack)===null||f===void 0||f._destroy(),d._videoTrack=void 0}});let s=Ki(e).call(e,(c,d)=>{let{user:h,mediaType:p}=d,f=this.filterTobeUnSubscribedTracks(h,p);return c.concat(f)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));let a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:h}]=c;var p,f;if(h===ze.VIDEO&&d._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===ze.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(f=d._videoTrack)===null||f===void 0||f._destroy(),d._videoTrack=void 0;else if(h===ze.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),(_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0}}),a}isPreSubScribe(e){return!this.connection||this.state!==Ht.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let s=this.remoteUserMap.get(e);if(!s)return void A.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void A.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let a=t===ze.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let s=this.remoteUserMap.get(e);if(!s)return void A.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(t)||A.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(Ne.LocalAudioTrack),s=t&&t.track;s&&s.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(Ne.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ys){let s=t.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ne.LocalAudioTrack}).filter(a=>{let[c]=a;return!(e&&c===Ne.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(e&&a===Ne.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,s,a,c){if(e){let h=this.localTrackMap.get(Ne.LocalAudioTrack),p=a?this.localTrackMap.get(Ne.LocalVideoLowTrack):this.localTrackMap.get(Ne.LocalVideoTrack);Qe.publish(this.store.sessionId,{eventElapse:kr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(Zt.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);let h=s.find(f=>f instanceof Is),p=a?(d=this.localTrackMap.get(Ne.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(f=>f instanceof as);Qe.publish(this.store.sessionId,{eventElapse:kr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(Zt.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,s,a){let c=a===ze.VIDEO?s._videoSSRC:s._audioSSRC;c&&Qe.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===ze.VIDEO,audio:a===ze.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:kr.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){A.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Dr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=wE(this.store),this.emit(tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Ne.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ys){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(s=>{t.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ht.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Ne.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Ne.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof as||t&&t.track instanceof Is?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;let s=Array.from(bn(t=this.remoteUserMap).call(t)).find(a=>a.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Ne.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ql(e).call(e,(s,a)=>s.level-a.level),e}async disconnectForReconnect(){this.connection&&(A.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ht.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&((s=t._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=wE(this.store),this.emit(tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:a}]=e;switch(s){case Ne.LocalVideoTrack:je(t=a._hints).call(t,Zt.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ne.LocalAudioTrack:a instanceof Ys?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ne.LocalVideoLowTrack:}}),this.emit(tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(bn(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(t,a)}),this.emit(tt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,s]=e;Array.from(bn(s).call(s)).forEach(a=>{this.setPendingRemoteDataChannel(t,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),A.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let s of this.pendingRemoteDataChannels){let{user:a,id:c}=s;if((e instanceof Jc?e.uid:e)===a.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let s of this.pendingRemoteTracks){let{user:a,kind:c}=s;if((e instanceof Jc?e.uid:e)===a.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return wi(function*(){if(!t.connection||t.state!==Ht.Connected)return;let s=yield Ot(t.mutex.lock("From P2PChannel.restartICE")),a;try{a=yield Ot(t.connection.restartICE(e));let d=yield Ot(a.next());if(d.done)return;let h=d.value,p=yield h;switch(VC(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Pr.UDP_TCP_RELAY:t._pcStatsUploadType=ic.UDP_TCP_RESTART;break;case Pr.TCP_RELAY:t._pcStatsUploadType=ic.TCP_RESTART;break;case Pr.RELAY:t._pcStatsUploadType=ic.RELAY_RESTART;break;default:t._pcStatsUploadType=ic.OLD_RESTART}t._isTryConnecting=!0,a.next(p)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(Ne.LocalVideoTrack),s=this.localTrackMap.get(Ne.LocalAudioTrack),a=e.videoSend.find(T=>T.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),c=e.audioSend.find(T=>T.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!c)return 1;let d=ri(this,tt.NeedSignalRTT),h=a?a.rttMs:void 0,p=c?c.rttMs:void 0,f=h&&p?(h+p)/2:h||p,_=(f&&d?(f+d)/2:f||d)||0,v=100*e.sendPacketLossRate*.7/50+.3*_/1500,b=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,w=t==null?void 0:t.track;if(w&&w._encoderConfig&&w._hints.indexOf(Zt.SCREEN_TRACK)===-1){let T=w._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(T&&U){let k=(1e3*T-U)/(1e3*T);return tU[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s,c=a._audioSSRC,d=a._videoSSRC,h=e.audioRecv.find(U=>U.ssrc===c),p=e.videoRecv.find(U=>U.ssrc===d);if(!h&&!p)return void(t+=1);let f=ri(this,tt.NeedSignalRTT),_=e.rtt,v=(_&&f?(_+f)/2:_||f)||0,b=h?h.jitterMs:void 0,w=e.recvPacketLossRate,T=.7*w*100/50+.3*v/1500;b&&(T=.6*w*100/50+.2*v/1500+.2*b/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ve((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}async replaceTrack(e,t){var s;if(A.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Ht.Connected)return;let a=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return e===h});if(!a)return;let c=a[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),a[1].track=t),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(t,a[1].id)),this.isPlanB){let d=a[1];d.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Ne.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding){let d=this.localTrackMap.get(Ne.LocalVideoLowTrack);if(d){let h=e._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new Ve((p,f)=>{this.handleReplaceTrack(d.track,p,f,!0)})}}}filterTobePublishedTracks(e,t,s){let a=[],c=this.getAllTracks();e=Zu(e=e.filter(f=>c.indexOf(f)===-1));let d,h=!1,p=this.localTrackMap.get(Ne.LocalAudioTrack);for(let f of e){if(f instanceof as&&(this.localTrackMap.has(Ne.LocalVideoTrack)||h?new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:f,type:Ne.LocalVideoTrack}),h=!0),t)){let _=this.getLowVideoTrack(f,s);a.push({track:_,type:Ne.LocalVideoLowTrack})}if(f instanceof Is)if(p){let _=p.track;if(_ instanceof Ys)FC([f]),_.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0);else{let v=UC([_,f]);A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(v.getTrackId(),"]")),this.replaceTrack(_,v)}}else d instanceof Ys?(FC([f]),d.addAudioTrack(f)):d||!f._useAudioElement&&jt().webAudioMediaStreamDest&&!f._bypassWebAudio?d=UC(d?[f,d]:[f]):d=f}return d&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:Ne.LocalAudioTrack})),a}filterTobeUnpublishedTracks(e){let t=[],s=this.getAllTracks();e=Zu(e=e.filter(a=>s.indexOf(a)!==-1));for(let a of e){if(a instanceof Is){let c=this.localTrackMap.get(Ne.LocalAudioTrack);if(!c)continue;c.track instanceof Ys?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(t.push([Ne.LocalAudioTrack,c]),c.track.close())):t.push([Ne.LocalAudioTrack,c])}if(a instanceof as){let c=this.localTrackMap.get(Ne.LocalVideoTrack);if(!c)continue;t.push([Ne.LocalVideoTrack,c]);let d=this.localTrackMap.get(Ne.LocalVideoLowTrack);d&&t.push([Ne.LocalVideoLowTrack,d])}}return t}filterTobePublishedDataChannels(e){return e=(e=Zu(e)).filter(t=>this.localDataChannels.findIndex(s=>s.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Zu(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:s,type:a}=t;switch(a){case Ne.LocalVideoTrack:s.addListener(Ye.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Ye.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ye.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ne.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ys?e.trackList.forEach(s=>{s.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ye.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ye.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ye.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[s,{track:a}]=t;return{track:a,type:s}})),e.forEach(t=>{let{track:s,type:a}=t;switch(a){case Ne.LocalVideoTrack:s.off(Ye.GET_STATS,this.handleGetLocalVideoStats),s.off(Ye.GET_RTC_STATS,this.handleGetRTCStats),s.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Ye.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ne.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ys?e.trackList.forEach(t=>{t.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ye.GET_STATS,this.handleGetLocalAudioStats),t.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ye.GET_STATS,this.handleGetLocalAudioStats),e.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ye.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof hh&&t.addListener(Ye.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),t instanceof ph&&t.addListener(Ye.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ye.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(ze.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(ze.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((s,a)=>{var c;let d,h,{track:p,type:f}=s;switch(f){case Ne.LocalAudioTrack:d=Kt.Audio,h={dtx:p instanceof Gm&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ne.LocalVideoTrack:d=je(c=p._hints).call(c,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High,h=To(To({},_U(p)),{},{codec:this.store.codec,svc_mode:lE()});break;case Ne.LocalVideoLowTrack:d=Kt.Low,h=To(To({},_U(p)),{},{codec:this.store.codec,svc_mode:lE()})}return{stream_type:d,attributes:h,ssrcs:t[a]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ne.LocalVideoTrack:a=je(s=d._hints).call(s,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High;break;case Ne.LocalAudioTrack:a=Kt.Audio;break;case Ne.LocalVideoLowTrack:a=Kt.Low}return{stream_type:a,ssrcs:h,mid:p}})}assignLocalTracks(e,t){e.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:t[a].id,ssrcs:t[a].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[s]=t;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(tt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ai&&!Cs()&&$("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},$("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ai&&h5(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=ic.DISCONNECTED_OR_FAILED,ri(this,tt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let s=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Qe.reportApiInvoke(this.store.sessionId,{name:Os.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:vs.TRACER}).onSuccess(),this.republish()}if($("NEW_ICE_RESTART")&&e instanceof Ai&&!Cs()&&!this._forceTurn){if(je(uU).call(uU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let s=c=>{VC(e)&&(A.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),ri(this,tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(tt.RequestRestartICE,c))},a=()=>{VC(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),A.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{p5(e,s,a)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&$("ICE_RESTART")&&ri(this,tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(tt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Qe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:vs.TRACER}).onSuccess(),this.emit(tt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var s;let a=Array.from(bn(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===t);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Ti.FIRST_FRAME_DECODED),Qe.firstRemoteFrame(this.store.sessionId,Zs.FIRST_AUDIO_DECODE,_s.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:kr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var s;let a=Array.from(bn(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===t);a&&Qe.firstRemoteFrame(this.store.sessionId,Zs.FIRST_AUDIO_RECEIVED,_s.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:kr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,s,a)=>{var c;let d=Array.from(bn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,s,a)},e.onFirstVideoRender=t=>{var s;let a=Array.from(bn(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===t);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(a))},e.onFirstVideoReceived=t=>{var s;let a=Array.from(bn(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===t);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstReceived:Date.now()}),Qe.firstRemoteFrame(this.store.sessionId,Zs.FIRST_VIDEO_RECEIVED,_s.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:kr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,s)=>{let a=t.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(tt.ConnectionTypeChange,a),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Kc(s))," -> ").concat(JSON.stringify(Kc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,s)=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Kc(s))," -> ").concat(JSON.stringify(Kc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return To(To({},t),s)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Ai&&function(t){Th.delete(t.id),h5(t)}(e),e.close(),this.emit(tt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let s=this.localTrackMap.get(Ne.LocalAudioTrack);if(e instanceof Is&&(s==null?void 0:s.track)instanceof Ys)return s.track.isActive||t.push([Ne.LocalAudioTrack,s]),t;let a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a&&(t.push(a),a[0]===Ne.LocalVideoTrack)){let c=this.localTrackMap.get(Ne.LocalVideoLowTrack);c&&t.push([Ne.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){let t=[],s=this.localTrackMap.get(Ne.LocalAudioTrack);if(e instanceof Is&&(s==null?void 0:s.track)instanceof Ys)return s.track.isActive&&t.push([Ne.LocalAudioTrack,s]),t;let a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a)if(a[0]===Ne.LocalVideoTrack){t.push(a);let c=this.localTrackMap.get(Ne.LocalVideoLowTrack);c&&t.push([Ne.LocalVideoLowTrack,c])}else t.push(a);return t}createMuteMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ne.LocalAudioTrack:a=Kt.Audio;break;case Ne.LocalVideoTrack:a=je(s=d._hints).call(s,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High;break;case Ne.LocalVideoLowTrack:a=Kt.Low}return{stream_type:a,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ne.LocalAudioTrack:a=Kt.Audio;break;case Ne.LocalVideoTrack:a=je(s=d._hints).call(s,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High;break;case Ne.LocalVideoLowTrack:a=Kt.Low}return{stream_type:a,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,t){let s=[],a=this.remoteUserMap.get(e);if(!a)return s;if(t){let c=a.get(t);if(!c)return s;s.push([e,{kind:t,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([e,{kind:d,id:h}])});return s}filterTobeUnSubscribedDataChannels(e,t){let s=[];return t.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)}),s}createUnsubscribeMessage(e){let t=[];return e.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case ze.VIDEO:return void(a._videoSSRC&&t.push({stream_type:ze.VIDEO,ssrcId:a._videoSSRC}));case ze.AUDIO:return void(a._audioSSRC&&t.push({stream_type:ze.AUDIO,ssrcId:a._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(s=>{let[a,{kind:c}]=s;if(t.has(a)){let d=t.get(a);c===ze.VIDEO?d|=rr.Video:d|=rr.Audio,t.set(a,d)}else c===ze.VIDEO?t.set(a,rr.Video):t.set(a,rr.Audio)}),{users:Array.from(t.entries()).map(s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[s,{kind:a}]=t,c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Ne.LocalVideoTrack),s=this.localTrackMap.get(Ne.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ve((a,c)=>{this.handleUpdateVideoEncoder(t.track,a,c,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ve((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Ai&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Ai&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,s){return e.map((a,c)=>{var d;let{stream_type:h}=a,p=(d=t.find(f=>{let{stream_type:_}=f;return h===_}))===null||d===void 0?void 0:d.attributes;if(p&&$("DISABLE_SCREEN_SHARE_REMB")){let f=s[c]._hints;(je(f).call(f,Zt.SCREEN_TRACK)||je(f).call(f,Zt.SCREEN_LOW_TRACK))&&(p.remb=!1,A.debug("disable remb for screen share, hints:",f))}return p})}async tryToUnmuteAudio(e){for(let s=0;s<e.length;s++)if(e[s]instanceof Is){var t;let a=this.filterTobeUnmutedTracks(e[s]);if(a.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(a.map(d=>{let[,{id:h}]=d;return h})));let c=this.createUnmuteMessage(a);return void await es(this,tt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(tt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(tt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await pr(C0(this.dtlsFailedCount,Hs)),this.emit(tt.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Cr(this,tt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(tt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ne.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof as)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof as).length>1)throw new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Is).length>1&&(e.some(t=>t instanceof Is&&t._bypassWebAudio)||!jt().webAudioMediaStreamDest))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof as&&this.pendingLocalTracks.some(s=>s instanceof as))throw new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Is&&this.pendingLocalTracks.some(s=>s instanceof Is)&&(!jt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Is&&s._bypassWebAudio)))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var s;let a=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding,c=To(To({},{width:160,height:120,framerate:15,bitrate:50}),t),d;d=a?e._mediaStreamTrack.clone():BC(e,c);let h=ts(8,"track-low-"),p=new as(d,To(To({},a&&{scaleResolutionDownBy:xC(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(dd.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,ah.LOW_STREAM)}),p._hints.push(Zt.LOW_STREAM),je(s=e._hints).call(s,Zt.SCREEN_TRACK)&&p._hints.push(Zt.SCREEN_LOW_TRACK),e.on("sei-to-send",f=>{p.emit("sei-to-send",f)}),e.addListener(Ye.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ai){var c,d,h,p;let f=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_,dtlsTransportState:v,peerConnectionState:b}=this.connection,{local:w,remote:T}=await this.connection.getSelectedCandidatePair();Qe.pcStats(this.store.sessionId,{startTime:f,eventElapse:e-f||0,iceconnectionsate:_,dtlsstate:v,connectionstate:b,intSucc:t?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=w==null?void 0:w.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=w.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(w.address,":").concat(w.port),selectedRemoteCandidateProtocol:(h=T.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(p=T.candidateType)!==null&&p!==void 0?p:"",selectedRemoteCandidateAddress:"".concat(T.address,":").concat(T.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){let t=this.store.keyMetrics,s=t.firstVideoFrameDecoded.find(v=>v.userId===e.uid);if(!s)return;let{isInternalUpload:a,isExternalUpload:c}=s;if(a&&c)return;let{subscribeEnd:d,firstPreRender:h,peerPublishDuration:p,peerPubStatusMs:f}=s,{firstRender:_=0}=s;if(d&&(_||h)&&p&&f){s.isInternalUpload=!0;let{playEnd:v}=s;v&&(s.isExternalUpload=!0);let{firstPreRender:b=0}=s;_=b||_;let w=e.videoTrack,T={peer:e._uintid,width:(w==null?void 0:w._videoWidth)||0,height:(w==null?void 0:w._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:p,peerPubStatusMs:f,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:b||0,firstRender:v?Math.max(_,v):Math.max(_,d),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:BL(this.store)};Qe.firstXLAPeerFirstVideoFrame(this.store.sessionId,T)}}reportVideoFirstFrameDecoded(e,t,s,a){var c;let d=Array.from(bn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());let h=this.store.keyMetrics,p=h.subscribe.find(f=>f.userId===d.uid&&f.type==="video");Qe.firstRemoteVideoDecode(this.store.sessionId,Zs.FIRST_VIDEO_DECODE,_s.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:s,subscribeElapse:kr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:a?1:0,firstFrame:(p==null?void 0:p.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.connection)return!1;let a=this.remoteUserMap.get(e);if(!a)return!1;let c=a.get(t);if(!c)return!1;let d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===Ne.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ah.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Je(St.prototype,"startP2PConnection",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"startP2PConnection"),St.prototype),Je(St.prototype,"connect",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"connect"),St.prototype),Je(St.prototype,"updateRemoteRTPCapabilities",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"updateRemoteRTPCapabilities"),St.prototype),Je(St.prototype,"publishDataChannel",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"publishDataChannel"),St.prototype),Je(St.prototype,"unpublish",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"unpublish"),St.prototype),Je(St.prototype,"unpublishDataChannel",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"unpublishDataChannel"),St.prototype),Je(St.prototype,"unpublishLowStream",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"unpublishLowStream"),St.prototype),Je(St.prototype,"subscribeDataChannel",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"subscribeDataChannel"),St.prototype),Je(St.prototype,"subscribe",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"subscribe"),St.prototype),Je(St.prototype,"massSubscribe",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"massSubscribe"),St.prototype),Je(St.prototype,"unsubscribe",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"unsubscribe"),St.prototype),Je(St.prototype,"unsubscribeDataChannel",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"unsubscribeDataChannel"),St.prototype),Je(St.prototype,"massUnsubscribe",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"massUnsubscribe"),St.prototype),Je(St.prototype,"muteRemote",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"muteRemote"),St.prototype),Je(St.prototype,"unmuteRemote",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"unmuteRemote"),St.prototype),Je(St.prototype,"hasRemoteMediaWithLock",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"hasRemoteMediaWithLock"),St.prototype),Je(St.prototype,"disconnectForReconnect",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"disconnectForReconnect"),St.prototype),Je(St.prototype,"updateBitrateLimit",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"updateBitrateLimit"),St.prototype),Je(St.prototype,"remoteMediaSsrcChanged",[Yr],Object.getOwnPropertyDescriptor(St.prototype,"remoteMediaSsrcChanged"),St.prototype),St);function Yr(e,t,s){let a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let c=this.mutex,d=await c.lock("From P2PChannel.".concat(t));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},s}function g5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function _5(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?g5(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):g5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let qae=Date.now(),Yae=20,GC=new Map,RE=new Map;async function v5(e){let t=GC.get(e),s=Array.isArray(t)&&t[t.length-1],a=RE.get(e);if(!s)return void(a.isSyncing=!1);let c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);let d=s.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let p=s.mediaDelay+h;p<=0?(t.pop(),E5(s.context,c),p=0):p=Math.min(p,Yae),setTimeout(()=>t.length&&v5(e),p)}function E5(e,t){e.safeEmit(Tt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function $ae(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return E5(s,{uid:e.uid,payload:e.payload});let a="".concat(s.id,"-").concat(e.uid),c=GC.get(a)||[],d=c.findIndex(_=>e.sendTs>=_.sendTs),h=_5(_5({},e),{},{context:s,mediaDelay:t,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),GC.set(a,c);let p=!1;var f;RE.has(a)?p=!((f=RE.get(a))===null||f===void 0||!f.isSyncing):RE.set(a,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||v5(a)}let Xae=At().name;function y5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function x5(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?y5(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):y5(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let Nh="websdk_ng_cache_parameter",Jae=$("MAX_PRELOAD_ASYNC_LENGTH"),Qae=1e4,yd=new Map,xd=[],HC=null,zC=0,KC=0,AE=new Map,Zae=function(e,t){let s=[],a=0,c=async()=>{let d=s.shift();d&&await d(),s.length>0&&a<t?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return new Ve(async(f,_)=>{s.push(async()=>{try{let v=await e(...h);f(v)}catch(v){_(v)}}),a<t&&(a++,c())})}}(b5,Jae),qC=dn.CancelToken.source();async function b5(e,t,s,a,c,d){try{if(!$("ENABLE_PRELOAD"))return;if(!jt().supportWebCrypto)return void Uc(()=>{A.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new _e(K.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&hr(s,"token",1,2047),hr(e,"appid",1,2047),rE(t),a&&nE(a);let h=cd();A.debug("preload channel ".concat(t,", uid is ").concat(a));let p={appId:e,cname:t,token:s||e,uid:typeof a!="string"?a:null,sid:h,proxyServer:c},f,_;typeof a=="string"?(p.stringUid=a,[_,f]=await Ve.all([Lae(a,{sid:h,appId:e},qC.token),YU(x5(x5({},p),{},{token:s||e,uid:0}),qC.token)]),p.uid=_.uid,f.gatewayInfo.uid=p.uid,f.gatewayInfo.res.uid=p.uid):(d&&(p.stringUid=d),f=await YU(p,qC.token));let v={sid:h,appId:e,cname:t,token:s||e,uid:p.stringUid||a,intUid:p.uid||f.gatewayInfo.uid,stringUid:p.stringUid,ts:Date.now(),sua:_,ap:f};await async function(b){let w;try{b.uid&&S5({appId:b.appId,cname:b.cname,token:b.token,uid:b.uid,stringUid:b.stringUid});let T=R5(b),U=await async function(F,z){try{let Y=await window.crypto.subtle.importKey("raw",mL(z),"AES-GCM",!1,["encrypt"]),X=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,od(window.btoa(JSON.stringify(F))));return Vc(new Uint8Array(X))}catch{return}}(b,b.token||b.appId);if(!U)return;w=N5(Nh);let k=w?JSON.parse(w):[];k.push({[T]:U}),k.length>$("AP_CACHE_NUM")&&k.shift(),IE(Nh,JSON.stringify(k))}catch(T){A.warn("Error caching server parameters:",T.message),IE(Nh,"")}}(v),zC++}catch(h){throw KC++,function(p){HC||(HC=window.setTimeout(()=>{let _="";AE.forEach((v,b)=>{_+="".concat(b,": ").concat(v," ;")}),Qe.reportApiInvoke(null,{name:Os.PRELOAD,options:{success:zC,failed:KC,err:_}}).onError(p),zC=0,KC=0,AE.clear(),HC=null},Qae));let f=AE.get(p.code)||0;AE.set(p.code,f+1)}(h),h}}async function w5(e){try{if($("AP_REQUEST_DETAIL")||$("ENABLE_ROLE_SELECT_EDGE"))return;let t=S5(e);if(!t||e.cloudProxyServer!=="disabled")return;let s=await async function(a,c){try{let d=await window.crypto.subtle.importKey("raw",mL(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,od(a));return JSON.parse(window.atob(Vc(new Uint8Array(h))))}catch{return}}(t,e.token||e.appId);if(!s||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(s,e))return;if(s&&Date.now()-s.ts<$("AP_CACHE_LIFETIME"))return s}catch(t){A.warn("Error get preloadInfo",t.message)}}function S5(e){let t;try{if(t=N5(Nh),!t)return;let s=JSON.parse(t),a=R5(e),c=function(h,p){for(let f=h.length-1;f>=0;f--)if(p(h[f]))return f;return-1}(s,h=>a in h);if(c===-1)return;let d=s.splice(c,1)[0];return IE(Nh,JSON.stringify(s)),d[a]}catch(s){A.warn("Error delete preload info: ".concat(t),s.message),IE(Nh,"")}}function YC(e){if(e){let t=yd.get(e);t&&(window.clearTimeout(t),t=null,yd.delete(e)),je(xd).call(xd,e)||e.cloudProxyServer!=="disabled"||xd.push(e)}if(yd.size<$("AP_CACHE_NUM")&&xd.length>0){let t=xd.shift();yd.set(t,window.setTimeout(async()=>{let{appId:s,cname:a,token:c,stringUid:d,uid:h,proxyServer:p}=t;try{await Zae(s,a,c,h,p,d),yd.has(t)&&YC(t)}catch(f){A.warn("update preload failed",f.message),C5(t)}},$("AP_UPDATE_INTERVAL")))}}function C5(e){let t=xd.indexOf(e);t!==-1&&xd.splice(t,1);let s=yd.get(e);s&&(window.clearTimeout(s),s=null,yd.delete(e),YC())}function T5(e,t){let s=e.sua,a=e.ap;t&&s&&Qe.reqUserAccount(e.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:t,uid:e.intUid,errorCode:null,extend:s.req}),Qe.reportResourceTiming(e.ap.url,e.sid),Qe.joinWebProxyAP(e.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Us.CHOOSE_SERVER,Us.CLOUD_PROXY_FALLBACK].toString()}),Qe.joinChooseServer(e.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[Us.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function N5(e){return window.atob(window.localStorage.getItem(e)||"")}function IE(e,t){window.localStorage.setItem(e,window.btoa(t))}function R5(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),xL(t)}function eoe(e){let t=function(){let s=roe.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,a){let c=s.appId;c!==void 0&&(Vs(a,10),Zc(a,c));let d=s.cid;d!==void 0&&(Vs(a,16),Vs(a,d));let h=s.cname;h!==void 0&&(Vs(a,26),Zc(a,h));let p=s.deviceId;p!==void 0&&(Vs(a,34),Zc(a,p));let f=s.elapse;f!==void 0&&(Vs(a,40),el(a,f));let _=s.fileSize;_!==void 0&&(Vs(a,48),el(a,Rh(_)));let v=s.height;v!==void 0&&(Vs(a,56),el(a,Rh(v)));let b=s.jpg;b!==void 0&&(Vs(a,66),Vs(a,b.length),I5(a,b));let w=s.networkType;w!==void 0&&(Vs(a,72),el(a,Rh(w)));let T=s.osType;T!==void 0&&(Vs(a,80),el(a,Rh(T)));let U=s.requestId;U!==void 0&&(Vs(a,90),Zc(a,U));let k=s.sdkVersion;k!==void 0&&(Vs(a,98),Zc(a,k));let F=s.sequence;F!==void 0&&(Vs(a,104),el(a,Rh(F)));let z=s.sid;z!==void 0&&(Vs(a,114),Zc(a,z));let Y=s.timestamp;Y!==void 0&&(Vs(a,120),el(a,Y));let X=s.uid;X!==void 0&&(Vs(a,128),Vs(a,X));let re=s.vid;re!==void 0&&(Vs(a,136),Vs(a,re));let te=s.width;te!==void 0&&(Vs(a,144),el(a,Rh(te)));let Z=s.service;Z!==void 0&&(Vs(a,152),Vs(a,Z));let de=s.callbackData;de!==void 0&&(Vs(a,162),Vs(a,de.length),I5(a,de));let xe=s.ticket;xe!==void 0&&(Vs(a,170),Zc(a,xe));let Se=s.vendorConfigs;Se!==void 0&&(Vs(a,178),Zc(a,Se))}(e,t),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(t)}function toe(e){return function(s){let a={};e:for(;!noe(s);){let c=nf(s);switch(c>>>3){case 0:break e;case 1:a.code=nf(s);break;case 2:a.msg=D5(s,nf(s));break;case 3:a.requestId=D5(s,nf(s));break;case 4:a.timestamp=ioe(s,!1);break;default:soe(s,7&c)}}return a}({bytes:t=e,offset:0,limit:t.length});var t}function soe(e,t){switch(t){case 0:for(;128&oa(e););break;case 2:$C(e,nf(e));break;case 5:$C(e,4);break;case 1:$C(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Rh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let roe=[];function $C(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function noe(e){return e.offset>=e.limit}function DE(e,t){let s=e.bytes,a=e.offset,c=e.limit,d=a+t;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),a}function A5(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function I5(e,t){let s=DE(e,t.length);e.bytes.set(t,s)}function D5(e,t){let s=A5(e,t),a=String.fromCharCode,c=e.bytes,d="",h="";for(let p=0;p<t;p++){let f,_,v,b,w=c[p+s];128&w?(224&w)==192?p+1>=t?h+=d:(f=c[p+s+1],(192&f)!=128?h+=d:(b=(31&w)<<6|63&f,b<128?h+=d:(h+=a(b),p++))):(240&w)==224?p+2>=t?h+=d:(f=c[p+s+1],_=c[p+s+2],(49344&(f|_<<8))!=32896?h+=d:(b=(15&w)<<12|(63&f)<<6|63&_,b<2048||b>=55296&&b<=57343?h+=d:(h+=a(b),p+=2))):(248&w)==240?p+3>=t?h+=d:(f=c[p+s+1],_=c[p+s+2],v=c[p+s+3],(12632256&(f|_<<8|v<<16))!=8421504?h+=d:(b=(7&w)<<18|(63&f)<<12|(63&_)<<6|63&v,b<65536||b>1114111?h+=d:(b-=65536,h+=a(55296+(b>>10),56320+(1023&b)),p+=3))):h+=d:h+=a(w)}return h}function Zc(e,t){let s=t.length,a=0;for(let h=0;h<s;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<s&&(p=(p<<10)+t.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Vs(e,a);let c=DE(e,a),d=e.bytes;for(let h=0;h<s;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<s&&(p=(p<<10)+t.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function oa(e){return e.bytes[A5(e,1)]}function O5(e,t){let s=DE(e,1);e.bytes[s]=t}function nf(e){let t,s=0,a=0;do t=oa(e),s<32&&(a|=(127&t)<<s),s+=7;while(128&t);return a}function Vs(e,t){for(t>>>=0;t>=128;)O5(e,127&t|128),t>>>=7;O5(e,t)}function ioe(e,t){let s,a=0,c=0,d=0;return s=oa(e),a=127&s,128&s&&(s=oa(e),a|=(127&s)<<7,128&s&&(s=oa(e),a|=(127&s)<<14,128&s&&(s=oa(e),a|=(127&s)<<21,128&s&&(s=oa(e),c=127&s,128&s&&(s=oa(e),c|=(127&s)<<7,128&s&&(s=oa(e),c|=(127&s)<<14,128&s&&(s=oa(e),c|=(127&s)<<21,128&s&&(s=oa(e),d=127&s,128&s&&(s=oa(e),d|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:t}}function el(e,t){let s=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=DE(e,d),p=e.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=d!==9?128|c:127&c;case 8:p[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:p[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:p[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:p[h+4]=d!==5?128|a:127&a;case 4:p[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:p[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:p[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:p[h]=d!==1?128|s:127&s}}let j5={},P5={},OE=4294967296,aoe=OE*OE,ooe=aoe/2;L5(0,!0);let k5=L5(0),coe=af(0,-2147483648,!1),loe=af(-1,2147483647,!1);function L5(e,t){let s,a,c;return t?(c=0<=(e>>>=0)&&e<256)&&(a=P5[e],a)?a:(s=af(e,0,!0),c&&(P5[e]=s),s):(c=-128<=(e|=0)&&e<128)&&(a=j5[e],a)?a:(s=af(e,e<0?-1:0,!1),c&&(j5[e]=s),s)}function af(e,t,s){return{low:0|e,high:0|t,unsigned:!!s}}function M5(e,t){if(isNaN(e))return k5;{if(e<=-9223372036854776e3)return coe;if(e+1>=ooe)return loe}return e<0?k5:af(e%OE|0,e/OE|0,t)}function F5(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}class XC extends bs{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let s=this._connectionState;this._connectionState=t,this.emit(Va.CONNECTION_STATE_CHANGE,t,s)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var s;super(),B(this,"name","AgoraRTCImageModeration"),B(this,"_connectionState",Ri.CONNECTING),B(this,"_sequence",0),B(this,"_moderationStartTime",void 0),B(this,"_workerConnection",void 0),B(this,"_workerMessageLengthLimit",void 0),B(this,"_qualityRatio",void 0),B(this,"_connectInfo",void 0),B(this,"_cancelTokenSource",dn.CancelToken.source()),B(this,"_retryConfig",void 0),B(this,"_moderationInterval",void 0),B(this,"_moderationTimer",null),B(this,"_moderationMode",1),B(this,"_quality",1),B(this,"_qualityTimer",null),B(this,"_ticket",void 0),B(this,"_moderationIntervalMinimum",void 0),B(this,"_uploadFailedNum",0),B(this,"_uploadNum",0),B(this,"_uploadTimer",null),B(this,"_extraInfo",void 0),B(this,"_vendor",""),B(this,"_encoder",new TextEncoder),B(this,"_moderationId",void 0),B(this,"inspectImage",()=>{if(this.connectionState!==Ri.CONNECTED)throw new ue(K.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ri.CONNECTED?this.requestToInspectImage():A.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ts(5,"image-moderation-"),this._workerMessageLengthLimit=$("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=$("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=t.interval)!==null&&s!==void 0?s:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=$("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ym("worker-"+this._moderationId,Hs),this.on(Va.STATE_CHANGE,(a,c)=>{A.debug("[".concat(this._moderationId,"] Moderation operation :").concat(_h[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(t,s){this.emit(Va.STATE_CHANGE,_h.CONNECT_AP),this._connectInfo=t;let a=this._cancelTokenSource.token;return this._retryConfig=s,new Ve((c,d)=>{this.on(Va.CONNECTION_STATE_CHANGE,(h,p)=>{h===Ri.CONNECTED&&c()}),this.requestAP(t,a,s).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(t){var s;this._moderationInterval=(s=t.interval)!==null&&s!==void 0?s:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),A.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Ri.CONNECTED&&this.inspectImage()}async requestAP(t,s,a){let c=$("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),d=await function(f,_,v,b){let{appId:w,areaCode:T,cname:U,sid:k,token:F,uid:z}=_;wh++;let Y="moderation_plugin",X={service_name:Y,json_body:JSON.stringify({appId:w,areaCode:T,cname:U,command:"allocateEdge",requestId:wh,seq:wh,sid:k,appToken:F,ts:Date.now(),uid:z+""})},re,te,Z=f[0];return La(async()=>{re=Date.now();let de=await Ba(Z,{data:X,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(te=Date.now()-re,de.code!==0){let Ae=new ue(K.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+de.code,{retry:!0,responseTime:te});throw A.error(Ae.toString()),Ae}let xe=JSON.parse(de.json_body);if(xe.code!==200){let Ae=new ue(K.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(xe.code,", reason: ").concat(xe.reason),{code:xe.code,responseTime:te});throw A.error(Ae.toString()),Ae}if(!xe.servers||!Array.isArray(xe.servers)||xe.servers.length===0){let Ae=new ue(K.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:xe.code,responseTime:te});throw A.error(Ae.toString()),Ae}if(!xe.servers.some(Ae=>!!Ae.wss)){let Ae=new ue(K.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:xe.code,responseTime:te});throw A.error(Ae.toString()),Ae}let Se=$("IMAGE_MODERATION_WORKER_HOST");return{addressList:xe.servers.map(Ae=>{let{address:yt,wss:bt}=Ae;if(yt&&bt)return"wss://".concat(yt.replace(/\./g,"-"),".").concat(Se,":").concat(bt,"/moderation")}).filter(Ae=>!!Ae),workerToken:xe.workerToken,vid:xe.vid,ticket:xe.appTicket,responseTime:te}},(de,xe)=>(Qe.apworkerEvent(k,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(de.addressList),firstSuccess:xe===0,responseTime:te,serverIp:f[xe%f.length]}),!1),(de,xe)=>(Qe.apworkerEvent(k,{success:!1,sc:de.data&&de.data.code||200,serviceName:Y,responseTime:te,serverIp:f[xe%f.length]}),!!(de.code!==K.OPERATION_ABORTED&&de.code!==K.UNEXPECTED_RESPONSE||de.data&&de.data.retry)&&(Z=f[(xe+1)%f.length],!0)),b)}(c,t,s,a);this.emit(Va.STATE_CHANGE,_h.AP_CONNECTED);let{addressList:h,ticket:p}=d;return this._ticket=p,h}async connectWorker(t){this.emit(Va.STATE_CHANGE,_h.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(_t.CONNECTED,async()=>{this.emit(Va.STATE_CHANGE,_h.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ri.CONNECTED}),this._workerConnection.on(_t.CLOSED,()=>{this.connectionState=Ri.CLOSED}),this._workerConnection.on(_t.FAILED,()=>{this.connectionState=Ri.CLOSED}),this._workerConnection.on(_t.RECONNECTING,()=>{this.connectionState=this.connectionState===Ri.CONNECTED?Ri.RECONNECTING:Ri.CONNECTING}),this._workerConnection.on(_t.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let s=toe(new Uint8Array(t.data));$("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,A.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Qe.reportApiInvoke(this._connectInfo.sid||null,{name:Os.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:vs.TRACER}).onError(new ue(K.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},$("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else A.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(_t.WILL_RECONNECT,(t,s,a)=>{t==="recover"&&a(t),a("tryNext")}),this._workerConnection.on(_t.REQUEST_NEW_URLS,(t,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(s)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=ri(this,Va.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("Only the track being played can be inspected"));this._sequence++;let a=await this.generateRequestData(t,s);this._workerConnection.sendMessage(a,!0,!0)}else $("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("Only the track being published can be inspected")}async generateRequestData(t,s){let{appId:a,cname:c,cid:d,vid:h,sid:p,uid:f}=s,_=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),b=await dM(v,a,c),w=this._sequence+"-"+d+"-"+f+"-"+_+"-"+ts(12,""),T={appId:a,cid:d,cname:c,deviceId:"",elapse:XC.intToLong(Number(_-this._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:b,networkType:6,osType:7,requestId:w,sdkVersion:"4.24.0",sequence:this._sequence,sid:p,timestamp:M5(_),uid:f,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;let U=eoe(T);if(U.byteLength<this._workerMessageLengthLimit){if($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let k=function(F){for(var z=1;z<arguments.length;z++){var Y=arguments[z]!=null?arguments[z]:{};z%2?F5(Object(Y),!0).forEach(function(X){B(F,X,Y[X])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(Y)):F5(Object(Y)).forEach(function(X){Object.defineProperty(F,X,Object.getOwnPropertyDescriptor(Y,X))})}return F}({},T);delete k.jpg,A.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(k))}return U}{let k=this.quality*this._qualityRatio;return this.quality=k,await this.generateRequestData(t,{appId:a,cname:c,cid:d,vid:h,sid:p,uid:f})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=dn.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ri.CLOSED,this.emit(Va.STATE_CHANGE,_h.CLOSED)}}function U5(e){if(Qt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ue(K.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ue(K.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let doe={name:"ImageModeration",create:function(e){let{config:t}=e;return U5(t),new XC(t)}};var V5,B5,W5,G5,H5,z5,K5,q5,Y5,$5,X5,J5,Q5,Z5,eV,tV,sV,rV,nV,iV,aV,oV,cV,lV,dV,uV,hV,pV,mV,fV,gV,_V,vV,EV,yV,xV,bV,wV,SV,CV,TV,He;function NV(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function ca(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?NV(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):NV(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}Dr.setLogger(A);let uoe=(V5=ct(),B5=ct({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof lh))return[t];t=[t]}return t.map(s=>s?Object(s).toString():"null")}}),W5=ct({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==ch.DATA?(Array.isArray(t)||(t=[t]),t.map(s=>s.getTrackId())):[t.getChannelId()])}),G5=ct({argsMap:(e,t,s,a)=>[typeof t=="object"?t.uid:t,s,a]}),H5=ct({argsMap:(e,t,s)=>[t,s]}),z5=ct({argsMap:(e,t)=>t.map(s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]})}),K5=ct({argsMap:(e,t,s,a)=>[typeof t=="object"?t.uid:t,s,a]}),q5=ct({argsMap:(e,t)=>t.map(s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}})}),Y5=ct(),$5=ct(),X5=ct(),J5=ct(),Q5=ct(),Z5=ct(),eV=ct(),tV=ct(),sV=ct(),rV=ct(),nV=ct(),iV=ct(),aV=ct(),oV=ct(),cV=ct(),lV=ct({argsMap:(e,t)=>[t]}),dV=ct(),uV=ct(),hV=ct(),pV=ct(),mV=ct(),fV=ct(),gV=ct(),_V=ct(),vV=ct({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),EV=ct(),yV=ct(),xV=ct(),bV=ct(),wV=ct(),SV=ct(),CV=ct({reportResult:!0}),TV=ct(),He=class extends bs{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let s;if(super(),B(this,"store",void 0),B(this,"_uid",void 0),B(this,"_channelName",void 0),B(this,"_uintUid",void 0),B(this,"_users",[]),B(this,"_config",void 0),B(this,"_clientId",void 0),B(this,"_appId",void 0),B(this,"_sessionId",null),B(this,"_key",void 0),B(this,"_rtmConfig",{}),B(this,"_joinInfo",void 0),B(this,"_gateway",void 0),B(this,"_statsCollector",void 0),B(this,"_configDistribute",void 0),B(this,"_leaveMutex",void 0),B(this,"_publishMutex",void 0),B(this,"_renewTokenMutex",void 0),B(this,"_subscribeMutex",void 0),B(this,"_encryptionMode","none"),B(this,"_encryptionSecret",null),B(this,"_encryptionSalt",null),B(this,"_encryptDataStream",!1),B(this,"_encryptDataStreamKey",null),B(this,"_encryptDataStreamIv",null),B(this,"_proxyServer",void 0),B(this,"_turnServer",{servers:[],mode:"auto"}),B(this,"_cloudProxyServerMode","disabled"),B(this,"_isDualStreamEnabled",!1),B(this,"_defaultStreamFallbackType",void 0),B(this,"_lowStreamParameter",void 0),B(this,"_streamFallbackTypeCacheMap",new Map),B(this,"_remoteStreamTypeCacheMap",new Map),B(this,"_axiosCancelSource",dn.CancelToken.source()),B(this,"_audioVolumeIndicationInterval",void 0),B(this,"_networkQualityInterval",void 0),B(this,"_userOfflineTimeout",void 0),B(this,"_streamRemovedTimeout",void 0),B(this,"_liveTranscodeStreamingClient",void 0),B(this,"_liveRawStreamingClient",void 0),B(this,"_channelMediaRelayClient",void 0),B(this,"_networkQualitySensitivity","normal"),B(this,"_p2pChannel",void 0),B(this,"_useLocalAccessPoint",!1),B(this,"_setLocalAPVersion",void 0),B(this,"_joinAndNotLeaveYet",!1),B(this,"_numberOfJoinCount",0),B(this,"_joinResponse",null),B(this,"_remoteDefaultVideoStreamType",void 0),B(this,"_inspect",void 0),B(this,"_moderation",void 0),B(this,"_license",void 0),B(this,"_pendingPublishedUsers",[]),B(this,"ntpAlignErrorCount",0),B(this,"remoteInboundOffset",0),B(this,"_peerConnectionState",void 0),B(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),B(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),B(this,"_handleUserOnline",c=>{if($("BLOCK_LOCAL_CLIENT")&&gd(c.uid,this.channelName))return void A.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&A.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Tt.USER_JOINED,d));else{let h=new Jc(c.uid,c.uint_id||c.uid);this._users.push(h),A.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(Tt.USER_JOINED,h)}}),B(this,"_handleUserOffline",c=>{if($("BLOCK_LOCAL_CLIENT")&&gd(c.uid,this.channelName))return;let d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:Ov(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),A.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Tt.USER_LEAVED,d,c.reason))}),B(this,"_handleAddAudioOrVideoStream",(c,d,h,p,f,_,v,b)=>{if($("BLOCK_LOCAL_CLIENT")&&gd(d,this.channelName))return;let w=this._users.find(U=>U.uid===d);if(!w)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));A.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(w.uid,{videoAddNotify:Date.now()});let T=c==="audio"?w.hasAudio:w.hasVideo;if(w._uintid||(w._uintid=_||d),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,h!==void 0&&(w._audioSSRC=h),p!==void 0&&(w._cname=p),v&&(w._audioOrtc=v)):(w._video_added_=!0,h!==void 0&&(w._videoSSRC=h),p!==void 0&&(w._cname=p),b!==void 0&&(w._rtxSsrcId=b),v&&(w._videoOrtc=v)),(c==="audio"?w.hasAudio:w.hasVideo)&&!T&&(A.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(Tt.USER_PUBLISHED,w,c)),c==="video"?Qe.onGatewayStream(this._sessionId,Zs.ON_ADD_VIDEO_STREAM,_s.ON_ADD_VIDEO_STREAM,{peer:_||d,ssrc:w._videoSSRC}):Qe.onGatewayStream(this._sessionId,Zs.ON_ADD_AUDIO_STREAM,_s.ON_ADD_AUDIO_STREAM,{peer:_||d,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,h).then(U=>{if(U&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof rf))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(k=>{A.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(U=>{A.error("[".concat(this._clientId,"] resubscribe error"),U.toString())})),c==="video"&&!wr()&&!Br()){let U=this._getEncodingName(f);(U==null?void 0:U.toLocaleLowerCase())==Vm.av1&&kae().then(k=>{k||this._gateway.downgradeCodec(U)})}}),B(this,"_handleRemoveStream",c=>{if($("BLOCK_LOCAL_CLIENT")&&gd(c.uid,this.channelName))return;let d=this._users.find(p=>p.uid===c.uid);if(!d)return void A.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));A.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Tt.USER_UNPUBLISHED,d,"audio"),A.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Tt.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Tt.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Tt.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof rf&&this._p2pChannel.unsubscribe(d).then(p=>{if(p)return this._gateway.unsubscribe(p,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),Qe.onGatewayStream(this._sessionId,Zs.ON_REMOVE_STREAM,_s.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),B(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if($("BLOCK_LOCAL_CLIENT")&&gd(d,this.channelName))return;let p=this._users.find(v=>v.uid===d);if(!p)return void A.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));A.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));let f=c==="audio"?p.hasAudio:p.hasVideo;if(c==="audio"){p._trust_audio_enabled_state_=!0;let v=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===v)return;{let b=p._audio_enabled_?"enable-local-audio":"disable-local-audio";A.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(b)),this.safeEmit(Tt.USER_INFO_UPDATED,d,b)}}else{p._trust_video_enabled_state_=!0;let v=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===v)return;{let b=p._video_enabled_?"enable-local-video":"disable-local-video";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(b)),this.safeEmit(Tt.USER_INFO_UPDATED,d,b)}}let _=c==="audio"?p.hasAudio:p.hasVideo;return f!==_?!f&&_?(A.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(Tt.USER_PUBLISHED,p,c)):(c==="video"&&p._videoTrack&&p._videoTrack._destroy(),c==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,c),A.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(Tt.USER_UNPUBLISHED,p,c)):void 0}),B(this,"_handleMuteStream",(c,d,h)=>{if($("BLOCK_LOCAL_CLIENT")&&gd(c,this.channelName))return;A.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);let p=this._users.find(v=>v.uid===c);if(!p)return void A.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));let f=d==="audio"?p.hasAudio:p.hasVideo;if(d==="audio"){p._trust_audio_mute_state_=!0;let v=p._audio_muted_;if(p._audio_muted_=h,p._audio_muted_===v)return;{let b=p._audio_muted_?"mute-audio":"unmute-audio";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(b)),this.safeEmit(Tt.USER_INFO_UPDATED,c,b)}}else{p._trust_video_mute_state_=!0;let v=p._video_muted_;if(p._video_muted_=h,p._video_muted_===v)return;{let b=p._video_muted_?"mute-video":"unmute-video";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(b)),this.safeEmit(Tt.USER_INFO_UPDATED,c,b)}}let _=d==="audio"?p.hasAudio:p.hasVideo;if(f!==_){if(!f&&_)return(d==="audio"?p._audioSSRC:p._videoSSRC)?(A.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(Tt.USER_PUBLISHED,p,d)):void A.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),d==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,d),A.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(Tt.USER_UNPUBLISHED,p,d)}}),B(this,"_handleP2PLost",async c=>{A.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():A.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),B(this,"_handleTokenWillExpire",()=>{A.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Tt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),B(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),A.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),B(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Tt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Tt.NETWORK_QUALITY,c)}),B(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,p)=>{let f=this._users.find(v=>v.uid===d);if(!f)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));A.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(f.uid,c,void 0,void 0,void 0,Date.now());let _=c==="audio"?f.hasAudio:f.hasVideo;c==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,c==="audio"?(f._audio_added_=!0,h!==void 0&&(f._audioSSRC=h),p!==void 0&&(f._audioMid=p)):(f._video_added_=!0,h!==void 0&&(f._videoSSRC=h),p!==void 0&&(f._videoMid=p)),(c==="audio"?f.hasAudio:f.hasVideo)&&!_&&(A.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(c)),this.safeEmit(Tt.USER_PUBLISHED,f,c)),this._p2pChannel.hasPendingRemoteMedia(f,c)&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,c,!0).catch(v=>{A.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=e,this._clientId=t||ts(5,"client-"),this.store=new class{constructor(c,d,h,p){ht(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:p,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ld.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case mt.SET_SESSION_ID:return Re(Re({},d),{},{sessionId:h.sessionId});case mt.SET_P2P_ID:return Re(Re({},d),{},{p2pId:h.p2pId});case mt.SET_UID:return Re(Re({},d),{},{uid:h.uid});case mt.SET_INT_UID:return Re(Re({},d),{},{intUid:h.intUid});case mt.SET_PUB_ID:return Re(Re({},d),{},{pubId:h.pubId});case mt.KEY_METRIC_CLIENT_CREATED:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{clientCreated:h.metric})});case mt.KEY_METRIC_JOIN_START:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{joinStart:h.metric})});case mt.KEY_METRIC_PRELOAD_START:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{preloadStart:h.metric})});case mt.KEY_METRIC_PRELOAD_END:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{preloadEnd:h.metric})});case mt.KEY_METRIC_JOIN_END:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{joinEnd:h.metric})});case mt.KEY_METRIC_REQUEST_AP_START:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{requestAPStart:h.metric})});case mt.KEY_METRIC_REQUEST_AP_END:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{requestAPEnd:h.metric})});case mt.KEY_METRIC_REQUEST_SUA_END:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case mt.KEY_METRIC_BEFORE_CONNECT:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{beforeConnect:h.metric})});case mt.KEY_METRIC_PEER_RECEIVER:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{peerReceiver:h.metric})});case mt.KEY_METRIC_SIGNAL_CONNECTED:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{signalConnected:h.metric})});case mt.KEY_METRIC_JOIN_REQ:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{joinReq:h.metric})});case mt.KEY_METRIC_JOIN_REP:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{joinRep:h.metric})});case mt.KEY_METRIC_JOIN_GATEWAY_START:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case mt.KEY_METRIC_JOIN_GATEWAY_END:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case mt.KEY_METRIC_PEER_CONNECTION_START:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case mt.KEY_METRIC_PEER_CONNECTION_END:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case mt.KEY_METRIC_DESCRIPTION_START:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{descriptionStart:h.metric})});case mt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case mt.KEY_METRIC_ICE_CONNECTION_END:return Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case mt.KEY_METRIC_PUBLISH:{let p=d.keyMetrics.publish,f=p.findIndex(_=>_.trackId===h.metric.trackId);return f!==-1?(p[f]=Re(Re({},p[f]),h.metric),Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{publish:[...p]})})):Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case mt.KEY_METRIC_SUBSCRIBE:{let p=d.keyMetrics.subscribe,f=p.findIndex(_=>_.userId===h.metric.userId&&_.type===h.metric.type);return f!==-1?(p[f]=Re(Re({},p[f]),h.metric),Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{subscribe:[...p]})})):Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case mt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let p=d.keyMetrics.firstVideoFrameDecoded,f=p.findIndex(_=>_.userId===h.metric.userId);return f!==-1?(p[f]=Re(Re({},p[f]),h.metric),Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{firstVideoFrameDecoded:[...p]})})):Re(Re({},d),{},{keyMetrics:Re(Re({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case mt.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case mt.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case mt.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=Re(Re({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case mt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case mt.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case mt.SET_USE_P2P:return Re(Re({},d),{},{useP2P:h.val});case mt.SET_TRANSPORT_TYPE:return Re(Re({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:mt.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:mt.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:mt.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:mt.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:mt.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:mt.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:mt.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:mt.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:mt.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:mt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:mt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:mt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:mt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:mt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:mt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:mt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:mt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:mt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:mt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:mt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:mt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:mt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:mt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:mt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:mt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:mt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:mt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Re({userId:c},d)})}descriptionStart(){this.dispatch({type:mt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:mt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:mt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,p){this.dispatch({type:mt.KEY_METRIC_PUBLISH,metric:Re(Re({trackId:c,type:d},h&&{publishStart:h}),p&&{publishEnd:p})})}subscribe(c,d,h,p,f,_,v){this.dispatch({type:mt.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re(Re(Re({userId:c,type:d},h&&{subscribeStart:h}),p&&{subscribeEnd:p}),f&&{firstFrame:f}),_&&{streamAdded:_}),v&&{firstDecoded:v})})}massSubscribe(c,d,h,p){c.forEach(f=>{this.dispatch({type:mt.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re({userId:f.userId,type:f.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),p&&{firstFrame:p})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:mt.RECORD_JOIN_CHANNEL_SERVICE,record:Re(Re({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:mt.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:mt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:mt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:mt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Dr("client-leave",this._clientId),this._publishMutex=new Dr("client-publish",this._clientId),this._renewTokenMutex=new Dr("client-renewtoken",this._clientId),this._subscribeMutex=new Dr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),A.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Si," build: ").concat(k0,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{b0(e.clientRoleOptions),s=Object.assign({},e.clientRoleOptions)}catch(c){A.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new tf(this.store),this._statsCollector.onStatsException=(c,d,h)=>{A.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===PC.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(p=>{p instanceof Kv&&$("ENABLE_ENCODE_EXCEPTION")&&p.findClosestProfile()}),this.safeEmit(Tt.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,p)=>{let f=this._users.find(_=>_.uid===c);f&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(f._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(f)),Qe.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:f._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if($("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){let d=this.localTracks.find(h=>h instanceof as);d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?$("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Aae(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Hs,httpRetryConfig:e.httpRetryConfig||Hs,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:s}),this._configDistribute=new Vae(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},ac("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new rf(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,s,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];$t("JOIN_GATEWAY_USE_443PORT_ONLY",d),$t("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);let p=this._gateway.signal.websocket;return p instanceof EC&&(p.use443PortOnly=d,p.tryDoubleDomain=h),async function(f,_,v){Nv.get(f)||Nv.set(f,[]),Rv.get(f)||Rv.set(f,_),vo.get(f)||vo.set(f,0);let b=Nv.get(f),w=Rv.get(f);if(!b||!w)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(vo.get(f)===w){let z=Dm();b.push(z),await z.promise}vo.set(f,vo.get(f)+1);for(var T=arguments.length,U=new Array(T>3?T-3:0),k=3;k<T;k++)U[k-3]=arguments[k];let F=await v(...U);return vo.set(f,vo.get(f)-1),vo.get(f)===w-1&&b.length>0&&(b[0].resolve(),b.shift()),vo.get(f)===0&&(Nv.set(f,[]),Rv.set(f,0),vo.set(f,0)),F}("client.join",$("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,s,a,c)}async join(e,t,s,a,c){let d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);let h=(kv||kv||(kv=(window.location.protocol.split(":")[0]||"").toUpperCase(),kv))==="HTTPS",p=SL()?window.isSecureContext:"Browser Not Support";(!SL()&&!h||!window.isSecureContext)&&A.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let f;Qe.setAppId(e);try{if(!s&&s!==null)throw new ue(K.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&hr(s,"token",1,2047),hr(e,"appid",1,2047),rE(t),a&&nE(a),c)if(typeof c=="string")hr(c,"optionalInfo",1,256),f=c;else{if(typeof c!="object")throw new ue(K.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:F,enableInstantMuteRestore:z}=c;F&&(ka(F,"autoSubscribe"),A.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(F)),this.store.autoSubscribe=F),z&&(ka(z,"enableInstantMuteRestore"),A.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(z)),this.store.enableInstantMuteRestore=z)}}}catch(F){throw Qe.reportApiInvoke(cd(),{name:Os.JOIN,options:[e,t,s,a],states:{isHttps:h,isSecureContext:p},tag:vs.TRACER}).onError(F),F}if(this._leaveMutex.isLocked&&(A.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),A.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let F=new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Qe.reportApiInvoke(cd(),{name:Os.JOIN,options:[e,t,s,a],states:{isHttps:h,isSecureContext:p},tag:vs.TRACER}).onError(F),F}this._gateway.state="CONNECTING",this.store.preloadStart();let _=await w5({appId:e,cname:t,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let v=(_==null?void 0:_.sid)||cd();A.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(d)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);let b=Qe.reportApiInvoke(v,{id:this._clientId,name:Os.JOIN,options:[e,t,s,a],states:{isHttps:h,isSecureContext:p},tag:vs.TRACER}),w=ca(ca(ca({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:f,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:$("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(w.stringUid=a,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async F=>{let z=function(te){let Z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),de=new Uint8Array(new ArrayBuffer(Z.length));for(let xe=0;xe<Z.length;xe+=1)de[xe]=Z.charCodeAt(xe);return de}(),Y=await window.crypto.subtle.importKey("spki",z,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),X=y0(F),re=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,X);return function(te){let Z="";for(let de=0;de<te.length;de+=1)Z+=String.fromCharCode(te[de]);return window.btoa(Z)}(new Uint8Array(re))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let F=new TextEncoder,z=$("USE_PURE_ENCRYPTION_MASTER_KEY")?F.encode(w.appId+this._encryptionSecret+this._encryptionSecret):F.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,X,re){let te=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=Y==="aes-128-gcm2"?128:256,de=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:PL,hash:"SHA-256",salt:re},te,Z+iie);return new Uint8Array(de).subarray(Z/8)}(this._encryptionMode,z,od(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,X,re){let te=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:PL,hash:"SHA-256",salt:re},te,{name:"AES-GCM",length:Z},!0,["encrypt","decrypt"])}(this._encryptionMode,z,od(this._encryptionSalt))}else p?A.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):A.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,A.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:w.stringUid});let T=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&T===this._sessionId&&Qe.joinChannelTimeout(this._sessionId,5)},5e3);try{var U;let F,z=w.cloudProxyServer;if(je(U=["proxy3","proxy4","proxy5"]).call(U,z)){let Z=$("PROXY_SERVER_TYPE3");Array.isArray(Z)?w.proxyServer=Z[0]:w.proxyServer=Z}if(Qe.setProxyServer(w.proxyServer),A.setProxyServer(w.proxyServer),this.store.requestAPStart(),_){if(A.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(_.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=_.intUid),F={gatewayInfo:_.ap.gatewayInfo},$("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)A.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let Z=(await EU(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(de=>({turnServerURL:de.address,tcpport:de.tcpport||Tr.tcpport,udpport:de.udpport||Tr.udpport,username:de.username||Tr.username,password:de.password||Tr.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:Z}}T5(_,w.stringUid)}else{if(w.stringUid&&!w.uid){let Z;[Z,F]=await Ve.all([qU(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||Hs,this.store).finally(()=>{this.store.requestSUAEnd()}),KU(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Hs,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),A.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(Z)),w.uid=Z,F.gatewayInfo.uid=Z,F.gatewayInfo.res.uid=Z}else F=await KU(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Hs,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(Km.UPDATE_BITRATE_LIMIT,Z=>{this._p2pChannel.updateBitrateLimit(Z)}),this._configDistribute.on(Km.UPDATE_CLIENT_ROLE_OPTIONS,Z=>{this._setClientRoleOptions(Z)})},0),this._key=s||e;let Y=F.gatewayInfo,X=w.uid?w.uid:Y.uid;this._joinInfo=ca(ca({},w),{},{cid:Y.cid,uid:X,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=X,this.store.cid=Y.cid;let re=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));b.onSuccess(re),this._appId=e,this._channelName=w.cname,this._uid=re,this.store.uid=re,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(wr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let te=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return A.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(te)),setTimeout(()=>{A.startUpload()},5e3),this.store.joinEnd(),k=this,je(fd).call(fd,k)||fd.push(k),this._cloudProxyServerMode==="disabled"&&jt().supportWebCrypto&&$("ENABLE_PRELOAD")&&YC(this._joinInfo),re}catch(F){let z=Array.isArray(F)?F[0]:F;throw z&&z.code===K.OPERATION_ABORTED?A.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),z):A.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),z),z.code!==K.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),b.onError(z),z}var k}_joinGateway(){if(!this._joinInfo||!this._key)throw new ue(K.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!$("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){A.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(wr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let s=fd.indexOf(t);s!==-1&&fd.splice(s,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return A.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Gt.LEAVE),A.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof lh))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ue(K.INVALID_PARAMS,"param list is empty");let s=e;if(this._gateway.role==="audience")throw new ue(K.INVALID_OPERATION,"audience can not publish stream");for(let c of s){if(!(c instanceof lh))throw new ue(K.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new ue(K.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}A.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));let a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&s.forEach(c=>{let d=this._configDistribute.getBitrateLimit();c instanceof as&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(s),A.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw A.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(e){if(e==null)throw new ue(K.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Qt(e.id,"id",0,65535,!0),ka(e.ordered,"ordered"),hr(e.metadata,"metadata",0,512),A.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new ue(K.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ue(K.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new ue(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let s=function(c){return MU(c,!1)}(e),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw A.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ue(K.CREATE_DATACHANNEL_ERROR);try{await Ve.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==K.DISCONNECT_P2P)throw c}}return A.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw A.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ue(K.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof lh))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);A.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(a=>"".concat(a.getTrackId()," "))," "));let s=await this._publishMutex.lock();try{if(this.store.useP2P){let a=await this._p2pChannel.unpublish(t);a&&await this._gateway.sendExtensionMessage(ks.UNPUBLISH,{unpubMsg:a},!0)}else{let a=await this._p2pChannel.unpublish(t);a&&await this._gateway.unpublish(a,this._uid),A.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw A.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),A.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(s=>"".concat(s.id," "))," "));let t=await this._publishMutex.lock();try{let s=await this._p2pChannel.unpublishDataChannel(e);s&&await this._gateway.unpublishDataChannel(s),A.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(a=>"".concat(a.id))))}catch(s){throw A.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{t&&t()}}async subscribe(e,t,s){if(!(e instanceof Jc)){let a=this.remoteUsers.find(c=>c.uid===e);if(!a)throw new ue(K.INVALID_REMOTE_USER,"user is not in the channel");e=a}return t==="datachannel"?this._subscribeDataChannel(e,s):this._subscribe(e,t)}async presubscribe(e,t){if(Qs(t,"mediaType",["audio","video"]),this.store.useP2P)throw new ue(K.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ue(K.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let s=t===ze.AUDIO,a=t===ze.VIDEO,c=await this._subscribeMutex.lock();try{let{ssrcId:d,ortc:h,rtxSsrcId:p,cname:f,uint_id:_}=await this._gateway.presubscribe(e,t,!0);if(d==null)throw new ue(K.UNEXPECTED_RESPONSE,"no ssrc id");let v=this._users.find(w=>w.uid===e);v||(v=new Jc(e,_||e),v._is_pre_created=!0,this._users.push(v)),f&&(v._cname=f),v._uintid||(v._uintid=_||e),s&&(v._audioSSRC=d,v._audio_pre_subscribed=!0,h&&(v._audioOrtc=h)),a&&(v._videoSSRC=d,v._video_pre_subscribed=!0,h&&(v._videoOrtc=h),p!=null&&(v._rtxSsrcId=p)),A.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(v,t,d,p,h);let b=s?v._audioTrack:v._videoTrack;if(!b)throw new ue(K.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(v._trust_audio_stream_added_state_=!0,v._audio_added_=!0),a&&(v._trust_video_stream_added_state_=!0,v._video_added_=!0),b}catch(d){throw A.error("[".concat(this._clientId,"] presub user ").concat(e," error"),d),d}finally{c()}}async _subscribeDataChannel(e,t){var s;if(Qt(t,"channelId",0,65535,!0),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ue(K.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ue(K.INVALID_REMOTE_USER,"user is not published");let a=(s=e._dataChannels)===null||s===void 0?void 0:s.find(h=>h.id===t);if(!a)throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ue(K.REMOTE_USER_IS_NOT_PUBLISHED);let c=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let h=await this._p2pChannel.subscribeDataChannel(e,[a]);if(h&&je(h).call(h,a.id))try{var d;if(typeof a._originDataChannelId!="number")throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ue(K.CREATE_DATACHANNEL_ERROR);let p={id:a.id,datachannelId:a._originDataChannelId,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:(d=a.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(e.uid,p,!0),await a._waitTillOpen()}catch(p){if((p==null?void 0:p.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[a]),p;await this._p2pChannel.unsubscribeDataChannel(e,[a]),this._p2pChannel.setPendingRemoteDataChannel(e,a.id)}return A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),a}finally{c()}}async _p2pSubscribe(e,t,s){if(Qs(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){let c=new ue(K.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){let c=new ue(K.INVALID_REMOTE_USER,"user is not published");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!s&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let c=new ue(K.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}let a=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let d=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,d,h)}catch(d){throw d}A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{A.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});let c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new ue(K.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw A.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{a()}}async _subscribe(e,t,s){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Qs(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){let f=new ue(K.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){let f=new ue(K.INVALID_REMOTE_USER,"user is not published");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(s||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let f=new ue(K.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let a=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?ze.AUDIO:ze.VIDEO,ssrcId:a};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});let p=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let _=t==="audio"?e._audioSSRC:e._videoSSRC;_!==void 0&&_!==a&&(a=_,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?ze.AUDIO:ze.VIDEO,ssrcId:a}),kr.markSubscribeStart(this.store.clientId,a),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,a,d,c);try{this._p2pChannel.isPreSubScribe(a)||await this._gateway.subscribe(e.uid,h,!0)}catch(v){if((v==null?void 0:v.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),v;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,e,t),_}A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(_=>{A.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});let f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new ue(K.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),f}catch(f){throw A.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{p()}}async massSubscribe(e){if(sc(e,"subscribeList"),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),s=new Map,a=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(p=>{let{user:f,mediaType:_}=p;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(_)}).join("; ")));let c=(e=[...e]).map(p=>{let{user:f,mediaType:_}=p;return{user:f,mediaType:_}}),d=await this._p2pChannel.globalLock();try{var h;for(let f=e.length-1;f>=0;f--){let _=e[f],{user:v,mediaType:b}=_;if(Qs(b,"mediaType",["audio","video"]),!v){let U=new ue(K.INVALID_PARAMS,"user property does not exist in subscribeList item");throw A.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===v)){let U=new ue(K.INVALID_REMOTE_USER,"user is not in the channel");A.error("[".concat(this._clientId,"] can not massSubscribe ").concat(v.uid,", this user is not in the channel")),c[f].error=U,e.splice(f,1);continue}if(b==="audio"&&(!v.hasAudio||v._audioSSRC===void 0)||b==="video"&&(!v.hasVideo||v._videoSSRC===void 0)){let U=new ue(K.REMOTE_USER_IS_NOT_PUBLISHED);A.error("[".concat(this._clientId,"] can not subscribe ").concat(v.uid," with mediaType ").concat(b,", remote user is not published")),c[f].error=U,e.splice(f,1);continue}let w=rr.Video|rr.LwoVideo,T=s.get(v);if(T){if(b==="video"?T&w:T&rr.Audio){e.splice(f,1),A.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(v.uid,", mediaType:").concat(b," twice"));continue}s.set(v,T|(b==="video"?w:rr.Audio))}else s.set(v,b==="video"?w:rr.Audio)}for(let f=e.length-1;f>=0;f--){let _=e[f],{user:v,mediaType:b}=_,w=rr.Video|rr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(v,b)){await this._p2pChannel.unmuteRemoteNoLock(v,b);let T=s.get(v);s.set(v,b==="video"?T^w:T^rr.Audio),e.splice(f,1)}}this.store.massSubscribe(e.map(f=>({userId:f.user.uid,type:f.mediaType})),t);let p=Ki(h=Array.from(s.entries())).call(h,(f,_)=>{let[v,b]=_;if(b===0)return f;let w={stream_id:v.uid,stream_type:b};return b&rr.Audio&&(w.audio_ssrc=v._audioSSRC),b&rr.Video&&(w.video_ssrc=v._videoSSRC),f.push(w),f},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(_=>{let{user:v,mediaType:b}=_;return{user:v,mediaType:b,ssrcId:b===ze.VIDEO?v._videoSSRC:v._audioSSRC,rtxSsrcId:b===ze.VIDEO?v._rtxSsrcId:void 0}}));let f=new Map;if(p=p.filter(_=>_.video_ssrc&&!this._p2pChannel.isPreSubScribe(_.video_ssrc)||_.audio_ssrc&&!this._p2pChannel.isPreSubScribe(_.audio_ssrc)||!_.video_ssrc&&!_.audio_ssrc),p.length>0){let _=await this._gateway.subscribeAll(p,!0);((_==null?void 0:_.users)||[]).forEach(v=>{let{stream_id:b,video_error_code:w,audio_error_code:T,error_code:U}=v;(w||T||U)&&f.set(b,{video_error_code:w,audio_error_code:T,error_code:U})})}if(Array.from(f.entries()).length>0){let _=[];Array.from(f.entries()).forEach(v=>{let[b,w]=v,T=this.remoteUsers.find(U=>U.uid===b);if(T){let U;w.error_code||w.video_error_code&&w.audio_error_code?U=void 0:w.video_error_code?U=ze.VIDEO:w.audio_error_code&&(U=ze.AUDIO),_.push({user:T,mediaType:U})}}),_.length>0&&await this._p2pChannel.massUnsubscribeNoLock(_)}for(let _ of c){let v=f.get(_.user.uid);if(v){let b=v.error_code||_.mediaType==="audio"&&v.audio_error_code||_.mediaType==="video"&&v.video_error_code;if(b){let w=qm(b);A.error("user:".concat(_.user.uid," mediaType:").concat(_.mediaType," has massSubscribe error ").concat(w.desc)),_.error=new ue(K.SUBSCRIBE_FAILED,"code ".concat(b,": ").concat(w.desc))}}_.error||(_.mediaType==="video"?_.track=_.user.videoTrack:_.track=_.user.audioTrack)}return this.store.massSubscribe(c.filter(_=>!_.error).map(_=>({userId:_.user.uid,type:_.mediaType})),void 0,Date.now()),c.forEach(_=>{var v;Qe.subscribe(this.store.sessionId,{succ:!!_.error,ec:((v=_.error)===null||v===void 0?void 0:v.code)||null,video:_.mediaType===ze.VIDEO,audio:_.mediaType===ze.AUDIO,peerid:_.user.uid,subscribeRequestid:_.mediaType===ze.VIDEO?_.user._videoSSRC:_.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(_.user._videoSSRC)},!0)}),A.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(_=>{let{user:v,mediaType:b}=_;return"user: ".concat(v==null?void 0:v.uid,", mediaType: ").concat(b)}).join("; "))),c}catch(f){throw await this._p2pChannel.massUnsubscribeNoLock(e),f}}finally{d(),a()}}async unsubscribe(e,t,s){if(!(e instanceof Jc)){let c=this.remoteUsers.find(d=>d.uid===e);if(!c)throw new ue(K.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,s)}else await this._unsubscribeDataChannel(e,s);if(t&&Qs(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){let c=new ue(K.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}A.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let a=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let c=await this._p2pChannel.unsubscribe(e,t);c&&await this._gateway.unsubscribe(c,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Ov(this._users,e),A.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===K.DISCONNECT_P2P)return void A.warning("disconnecting p2p, abort unsubscribe request.");throw A.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{a()}}async _unsubscribeDataChannel(e,t){if(t&&Qt(t,"id",0,65535,!0),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(a=>a===e)){let a=new ue(K.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}let s;if(typeof t=="number"){let a=e._dataChannels.find(c=>c.id===t);a&&(s=[a])}else s=e._dataChannels;if(s===void 0){let a=new ue(K.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),a}A.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s.map(a=>a.id)));try{let a=await this._p2pChannel.unsubscribeDataChannel(e,s);a&&await this._gateway.unsubscribeDataChannel(a,e.uid),A.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a))}catch(a){if(a.code===K.DISCONNECT_P2P)return void A.warning("disconnecting p2p, abort unsubscribe request.");throw A.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}}async massUnsubscribe(e){if(sc(e,"unsubscribeList"),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");A.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];let t=new Map;for(let s=e.length-1;s>=0;s--){let{user:a,mediaType:c}=e[s];if(!a){let h=new ue(K.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw A.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(Qs(c,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===a)){A.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),e.splice(s,1);continue}let d=rr.Video|rr.LwoVideo;if(t.has(a)){let h=t.get(a),p;switch(c){case"video":p=h&d;break;case"audio":p=h&rr.Audio;break;default:p=h&(rr.Audio|d)}if(p){A.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),e.splice(s,1);continue}c?c==="audio"?t.set(a,h|rr.Audio):c==="video"&&t.set(a,h|d):t.set(a,h|rr.Audio|d)}else c?c==="audio"?t.set(a,rr.Audio):c==="video"&&t.set(a,d):t.set(a,rr.Audio|d)}try{let s=await this._p2pChannel.massUnsubscribe(e);s&&await this._gateway.massUnsubscribe(s),A.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===K.DISCONNECT_P2P)return void A.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw A.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(e){(function(s){if(!s)throw new _e(K.INVALID_PARAMS);Ts(s.width)||v0(s.width,"streamParameter.width"),Ts(s.height)||v0(s.height,"streamParameter.height"),Ts(s.framerate)||v0(s.framerate,"streamParameter.framerate"),Ts(s.bitrate)||Qt(s.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&A.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),A.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ne.LocalVideoLowTrack)}async enableDualStream(){if(!jt().supportDualStream)throw Qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ue(K.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ue(K.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),A.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ue(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ne.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),A.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(a){Qs(a,"role",["audience","host"])}(e),t&&b0(t),this.mode==="rtc"||this.mode==="p2p")throw A.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ue(K.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ue(K.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ue(K.INVALID_OPERATION,"can not set client role to audience when publishing stream");let s=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==s&&$("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Sr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),A.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&b0(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{A.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let s=t.timestamp-Date.now();return Math.abs(s)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(hr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ue(K.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ue(K.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Qe.setProxyServer(this._proxyServer),A.setProxyServer(this._proxyServer),A.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ue(K.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ue(K.INVALID_OPERATION,"You have already set the proxy")}if(km(e))return this._turnServer={servers:e,mode:"original-manual"},void A.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(s=>s.urls).join(","),"."));e.forEach(s=>hL(s)),this._turnServer={servers:e,mode:"manual"},A.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ue(K.INVALID_OPERATION,"you should set license before join channel");if(hr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ue(K.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,A.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ue(K.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ue(K.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],s;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ue(K.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new ue(K.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,A.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ue(K.INVALID_OPERATION,"Stop proxy server after leave channel");Qe.setProxyServer(),A.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",A.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ue(K.INVALID_PARAMS,"accessPoints is required.");sc(e.accessPoints.serverList,"accessPoints.serverList"),hr(e.accessPoints.domain,"accessPoints.domain");let t=(w,T)=>{Qt(w,T,0,65535,!0)},s=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),s=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ue(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");$("CLOSE_AFB_FOR_LOCAL_AP")&&($t("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),$t("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,d=e.accessPoints.serverList.map(w=>a.test(w)?"".concat(w.replace(/\./g,"-"),".").concat(c):w),h=d.map(w=>"".concat(w,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,$t("WEBCS_DOMAIN",h),$t("WEBCS_DOMAIN_BACKUP_LIST",h),$t("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(sc(e.report.hostname,"report.hostname"),$t("EVENT_REPORT_DOMAIN",e.report.hostname[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):($t("EVENT_REPORT_DOMAIN",d[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let p=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),p=e.report.port),$t("STATS_COLLECTOR_PORT",p),e.report?$t("ENABLE_EVENT_REPORT",!0):$t("ENABLE_EVENT_REPORT",!1);let f="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(sc(e.log.hostname,"log.hostname"),f=e.log.hostname[0]):f=d[0];let _=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),_=e.log.port),$t("LOG_UPLOAD_SERVER","".concat(f,":").concat(_));let v=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(sc(e.cds.hostname,"cds.hostname"),v=e.cds.hostname):v=d;let b=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),b=e.cds.port),$t("CDS_AP",v.map(w=>"".concat(w,":").concat(b))),e.cds?$t("ENABLE_CONFIG_DISTRIBUTE",!0):$t("ENABLE_CONFIG_DISTRIBUTE",!1),A.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(sc(e,"serverList"),hr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ue(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(t):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,$t("WEBCS_DOMAIN",e),$t("WEBCS_DOMAIN_BACKUP_LIST",e),$t("GATEWAY_DOMAINS",[t]),$t("EVENT_REPORT_DOMAIN",e[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),$t("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),A.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Qs(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw A.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else A.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Qs(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let s=this._users.find(a=>a.uid===e);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw A.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}A.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Qs(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(s){throw A.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}A.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,s,a){(function(d){Qs(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),hr(t,"secret");let c=["aes-128-gcm2","aes-256-gcm2"];if(je(c).call(c,e)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new ue(K.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new ue(K.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(ka(a,"encryptDataStream"),!je(c).call(c,e))throw new ue(K.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||A.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,s&&(this._encryptionSalt=Vc(s))}async renewToken(e){if(hr(e,"token",1,2047),!this._key||!this._joinInfo)throw new ue(K.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let s=await this._renewTokenMutex.lock();try{if($("USE_NEW_TOKEN")){A.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let a=await Uae(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Hs);A.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:a})}else A.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});A.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=t,this._joinInfo.token=t,A.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?A.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(Tt.VOLUME_INDICATOR,e)},$("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ue(K.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ue(K.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ue(K.LIVE_STREAMING_TASK_CONFLICT);let s=t?rc.TRANSCODE:rc.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(e,s)}setLiveTranscoding(e){return this._createLiveStreamingClient(rc.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(e));if(!t.length)throw new ue(K.INVALID_PARAMS,"can not find live streaming url to stop");await Ve.all(t.map(s=>s&&s.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){ZU(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){ZU(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof rf&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ue(K.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let c=new TextEncoder;e.payload=c.encode(e.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&je(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(a=!0,e.payload=await async function(c,d,h){var p;let f=Ki(p=Array.from(h)).call(p,(k,F)=>k+F,0),_={serverTs:0,seq:aie++,length:h.length,checkSum:f},v=new Uint8Array(yL(f,2)),b=new ArrayBuffer(rh),w=new DataView(b);w.setUint32(0,_.serverTs),w.setUint16(4,_.seq),w.setUint16(6,_.length),w.setUint16(8,_.checkSum);let T=16-h.length%16;h=fL(h,new Uint8Array(T));let U=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:jL,additionalData:v},d,h);return fL(new Uint8Array(b),new Uint8Array(U))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ue(K.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(lt.DATA_STREAM,{payload:Vc(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-qae},!s)}sendMetadata(e){if(!this._joinInfo)throw new ue(K.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ue(K.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(lt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Vc(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(fie),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"can not send custom report, not joined");await Qe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let e=this._statsCollector.getRemoteNetworkQualityStats();if($("DELETE_NEQ_AFTER_USER_LEAVE")){let t=this._users.map(s=>s.uid+"");Object.keys(e).forEach(s=>{je(t).call(t,s)||delete e[s]})}return e}async pickSVCLayer(e,t){Qs(t.spatialLayer,"spatialLayer",[0,1,2,3]),Qs(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(s){throw A.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:s}=e;if(ka(t,"apRTM"),Qt(s,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=s,A.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(A.debug("[".concat(this._clientId,"] reset client")),function(e){let t=fh.indexOf(e);t!==-1&&fh.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=dn.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&C5(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Qe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Dr("client-publish",this._clientId),this._subscribeMutex=new Dr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var s;let a=e||cd();e?A.debug("[".concat(this._clientId,"] new Session ").concat(a)):A.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));let c=e?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,Qe.addSid(a);let d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Qe.sessionInit(this._sessionId,ca({cname:t.channel,appid:t.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ue(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new ue(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");A.debug("[".concat(this._clientId,"] publish high stream"));try{let s=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(ks.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let a=(await s.next()).value;if(a){var t;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==K.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let c of e)c instanceof as&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{A.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,e),(s==null?void 0:s.code)===K.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ue(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ue(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));A.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var t;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==K.DISCONNECT_P2P)throw s.throw(d),d}s.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===K.WS_ABORT)return;throw s}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new ue(K.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ac("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,d)=>{Qe.reportApiInvoke(this._sessionId,{name:Os.ON_LIVE_STREAM_ERROR,options:[c,d],tag:vs.TRACER}).onSuccess(),this.safeEmit(Tt.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{Qe.reportApiInvoke(this._sessionId,{name:Os.ON_LIVE_STREAM_WARNING,options:[c,d],tag:vs.TRACER}).onSuccess(),this.safeEmit(Tt.LIVE_STREAMING_WARNING,c,d)},s.on(gC.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new ue(K.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(p,f,_,v){let b=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(w=>f.proxyServer?"https://".concat(f.proxyServer,"/ap/?url=").concat(w+"/api/v1?action=uap"):"https://".concat(w,"/api/v1?action=uap"));return await Oae(b,p,f,_,v)})(c,this._joinInfo,this._axiosCancelSource.token,Hs).then(d).catch(h)}),s};return e===rc.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ue(K.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:s}},ac("ChannelMediaRelay").create(e));a.on("state",c=>{c===wn.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Tt.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(Tt.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:s,deleted:a}=e,c=[];if(t){let d=[];this._users.forEach(h=>{h._dataChannels.forEach(p=>{s.every(f=>f.uid!==h._uintid||f.stream_id!==p.id)&&d.push({uid:h._uintid,stream_id:p.id,ordered:p.ordered,max_retrans_times:p.maxRetransmits,metadata:p.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach(d=>{let{uid:h,stream_id:p,ordered:f,max_retrans_times:_,metadata:v}=d,b=this._users.find(w=>w._uintid===h);if(!b)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(A.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),je(c).call(c,b)||c.push(b),b._uintid||(b._uintid=h),b._dataChannels.findIndex(w=>w.id===d.stream_id)===-1){let w={id:p,ordered:!!f,maxRetransmits:_,metadata:v},T=function(U){return MU(U,!0)}(w);b._dataChannels.push(T),A.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published datachannel")),t||this.safeEmit(Tt.USER_PUBLISHED,b,"datachannel",w)}this._p2pChannel.hasPendingRemoteDataChannel(b,d.stream_id)&&(A.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(b.uid," after reconnect.")),this._subscribeDataChannel(b,d.stream_id).catch(w=>{A.error("[".concat(this._clientId,"] resubscribe datachannel error"),w.toString())}))}),t&&(this.safeEmit(Tt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{let{uid:h,stream_id:p}=d,f=this._users.find(v=>v._uintid===h);if(!f)return void A.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let _=f._dataChannels.find(v=>v.id===d.stream_id);_&&(A.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(f,[_]).then(v=>{if(f._dataChannels=f._dataChannels.filter(b=>b!==_),v)return this._gateway.unsubscribeDataChannel(v,f.uid)}),A.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(_.id)),this.safeEmit(Tt.USER_UNPUBLISHED,f,"datachannel",_._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;let s=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(s)for(let c of s){var a;if(c.payloadType===e)return c==null||(a=c.rtpMap)===null||a===void 0?void 0:a.encodingName}}_handleRemoveDataChannels(e){let t=this._users.find(s=>s.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){A.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let s=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(a=>{this.safeEmit(Tt.USER_UNPUBLISHED,t,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,t.uid)}),s()}}else A.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ar.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void A.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),s=Date.now();Object.keys(t).forEach(a=>{let{value:c,type:d,expires:h}=t[a];h&&h<=s||d||lC()||!Object.prototype.hasOwnProperty.call(Fv,a)||(Ma[a]=c,gs[a]=c,A.debug("Update gateway parameters from config distribute",a,c))})}catch(t){A.error("Error update config from local cache",t.message)}})()}),this._gateway.on(ar.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ar.CONNECTION_STATE_CHANGE,(e,t,s)=>{var a;if(s===Gt.FALLBACK)return;let c=()=>{this.safeEmit(Tt.CONNECTION_STATE_CHANGE,e,t,s)};if(Qe.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:Os.CONNECTION_STATE_CHANGE,options:[e,t,s],tag:vs.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:s})),A.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,p)=>{this._gateway.setStreamFallbackOption(p,h).catch(f=>{A.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),f)})}),this._remoteStreamTypeCacheMap.forEach((h,p)=>{this._gateway.setRemoteVideoStreamType(p,h).catch(f=>{A.warning("[".concat(this._clientId,"] auto set remote stream type failed"),f)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{A.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{A.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{A.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(A.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ze.AUDIO,!1)),h._trust_video_mute_state_||(A.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ze.VIDEO,!1)),h._trust_audio_enabled_state_||(A.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(A.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(A.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(A.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(A.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(ar.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ue(K.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s,a=await w5(ca(ca({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,T5(a),this._joinInfo.preload=!0):(s=await OC(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Hs,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);let c=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d,[p,f]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:p,port:f}):c.push({host:p,port:f})}),e(c)}catch(s){t(s)}}),this._gateway.on(ar.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Tt.NETWORK_QUALITY,e)}),this._gateway.on(ar.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Tt.STREAM_TYPE_CHANGED,e,t),Qe.reportApiInvoke(this._sessionId,{name:Os.STREAM_TYPE_CHANGE,options:[e,t],tag:vs.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(ar.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(ar.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,s)=>{try{let a=await this._p2pChannel.getEstablishParams();a&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(a=await this._p2pChannel.startP2PConnection(e)),t(a)}catch(a){s(a)}}),this._gateway.on(ar.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let s;this._joinResponse=e,e.attributes?s=e.attributes.userAttributes.preSubSsrcs:A.debug("no attributes in joinResponse");let a=CU(e.ortc,t,s);this._p2pChannel.connect(a)}),this._gateway.on(ar.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:s,turnServer:a}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){let{cert:d,cid:h}=this._joinInfo.apResponse,p="".concat(h,"_").concat(d);if(p.length<4||p.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(d),icePwd:"".concat(h,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=$("FINGERPRINT"))!==null&&c!==void 0?c:s}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(f){f.code&&f.code===K.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Nt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Nt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Nt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Nt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Nt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Nt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Nt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Nt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Nt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,ze.AUDIO,!0)),this._gateway.signal.on(Nt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,ze.AUDIO,!1)),this._gateway.signal.on(Nt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,ze.VIDEO,!0)),this._gateway.signal.on(Nt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,ze.VIDEO,!1)),this._gateway.signal.on(Nt.RECEIVE_METADATA,e=>{let t=od(e.metadata);this.safeEmit(Tt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Nt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let s=od(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&je(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<rh)throw new ue(K.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(rh));s=await async function(c,d,h){let p=h.subarray(0,rh),f=p.slice(8,rh),_=(f[0]<<8)+f[1],v=(p[6]<<8)+p[7],b=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:jL,additionalData:new Uint8Array(yL(_,2))},d,h.subarray(rh));return new Uint8Array(b).subarray(0,v)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(e.ordered||e.syncWithAudio){let c=this._p2pChannel.getStats(),d=this.remoteUsers.find(p=>p.uid===e.uid),h=c==null?void 0:c.audioRecv.find(p=>p.ssrc===(d==null?void 0:d._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),$ae(ca(ca({},e),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Nt.ON_CRYPT_ERROR,()=>{Uc(()=>{A.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Tt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Nt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{A.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Gt.TOKEN_EXPIRE),this.safeEmit(Tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Nt.ON_STREAM_FALLBACK_UPDATE,e=>{A.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Tt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Nt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),A.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Nt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Nt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ut.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case lt.PUBLISH:{if(!t)return;let c=t.ortc;if(c){var s,a;let d=c.some(f=>{let{stream_type:_}=f;return _===Kt.Audio}),h=c.some(f=>{let{stream_type:_}=f;return _!==Kt.Audio}),p=c.some(f=>{let{stream_type:_}=f;return _===Kt.Screen||_===Kt.ScreenLow});t.state==="offer"&&Qe.publish(this._joinInfo.sid,{eventElapse:kr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:K.TIMEOUT,audio:d,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:d?(s=c.find(f=>{let{stream_type:_}=f;return _===Kt.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find(f=>{let{stream_type:_}=f;return _!==Kt.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case lt.SUBSCRIBE:t&&Qe.subscribe(this._joinInfo.sid,{succ:!1,ec:K.TIMEOUT,audio:t.stream_type===ze.AUDIO,video:t.stream_type===ze.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:kr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Nt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Nt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;$("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(a=>!gd(a.string_id||a.stream_id,this.channelName)));let t=[],s=[];for(let a of e.users){let c=this._users.find(v=>v._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new Jc(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Tt.PUBLISHED_USER_LIST).length===0&&(A.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(Tt.USER_JOINED,c)));let d=rr.Audio&a.stream_type,h=(rr.Video|rr.LwoVideo)&a.stream_type,p=(65280&a.stream_type)!=0,f=d&&c.hasAudio,_=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!f&&this.getListeners(Tt.PUBLISHED_USER_LIST).length===0&&(A.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Tt.USER_PUBLISHED,c,"audio")),h&&!_&&this.getListeners(Tt.PUBLISHED_USER_LIST).length===0&&(A.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Tt.USER_PUBLISHED,c,"video")),(d&&!f||h&&!_||p)&&t.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(A.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{A.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(Tt.PUBLISHED_USER_LIST).length>0?$("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(A.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(a=>a.uid).join(", "))),this.safeEmit(Tt.PUBLISHED_USER_LIST,t)):A.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(Nt.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof rf&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(s=>s.toLowerCase()).filter(s=>{var a;return je(a=Object.keys(Vm)).call(a,s)}))})}_handleP2PEvents(){this._gateway.signal.on(Nt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ks.PUBLISH,(e,t,s)=>{let{uid:a}=e;e.forEach(c=>{let{kind:d,ssrcs:h,mid:p,isMuted:f}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,p);let _=this._users.find(v=>v.uid===a);return _&&this.store.useP2P?this._p2pChannel.mockSubscribe(_,d,h[0].ssrcId,p).then(()=>{t()}).catch(s):t(),this._handleMuteStream(a,d,!!f)})}),this._gateway.signal.on(ks.CALL,async(e,t,s)=>{if(this.store.useP2P)try{var a;t(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},e))}catch(c){s(c)}}),this._gateway.signal.on(ut.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(ks.UNPUBLISH,async(e,t,s)=>{if(this.store.useP2P){let{unpubMsg:a,uid:c}=e,d=this._users.find(h=>h.uid===c);if(!d)return A.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{a.forEach(async h=>{let{stream_type:p}=h,f=p===Kt.Audio?ze.AUDIO:ze.VIDEO;await this._p2pChannel.unsubscribe(d,f),this._handleMuteStream(c,f,!0)}),t()}catch(h){s(h)}}}),this._gateway.signal.on(ks.CONTROL,async(e,t)=>{let{action:s}=e;switch(s){case Hc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,ze.VIDEO,!0);break;case Hc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,ze.AUDIO,!0);break;case Hc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,ze.VIDEO,!1);break;case Hc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,ze.AUDIO,!1)}}),this._gateway.signal.on(ks.RESTART_ICE,async(e,t,s)=>{if(this.store.useP2P)try{let{direction:a,iceParameter:c}=e;a!==sn.SEND_ONLY||c?t(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),t())}catch(a){s(a)}}),this._gateway.signal.on(ks.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:s}=e;this._p2pChannel.addRemoteCandidate(t,s)}}),this._p2pChannel.on(tt.RequestP2PRestartICE,async(e,t,s)=>{try{let{direction:a}=e;t(await this._gateway.sendExtensionMessage(ks.RESTART_ICE,e,a===sn.SEND_ONLY))}catch(a){s(a)}}),this._p2pChannel.on(tt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(ks.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(tt.RequestP2PMuteLocal,async(e,t,s)=>{try{await this._gateway.sendExtensionMessage(ks.CONTROL,e,!0),t()}catch(a){s(a)}}),this._p2pChannel.on(tt.RequestP2PUnmuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():s(a)}else t()}),this._p2pChannel.on(tt.RequestP2PMuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():s(a)}else t()}),this._p2pChannel.on(tt.StateChange,(e,t)=>{t===Ht.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(tt.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(Tt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(tt.RequestMuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():s(a)}else t()}),this._p2pChannel.on(tt.RequestUnmuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===K.DISCONNECT_P2P?t():s(a)}else t()}),this._p2pChannel.on(tt.RequestRePublish,(e,t,s)=>{this.publish(e,!1).then(t).catch(s)}),this._p2pChannel.on(tt.RequestRePublishDataChannel,(e,t,s)=>{Ve.all(e.map(async a=>{let c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==K.DISCONNECT_P2P)throw d}})).then(t).catch(s)}),this._p2pChannel.on(tt.RequestReSubscribe,async(e,t,s)=>{try{for(let{user:a,kind:c}of e)c===ze.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");t()}catch(a){s(a)}}),this._p2pChannel.on(tt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(tt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(tt.MediaReconnectStart,e=>{this.safeEmit(Tt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(tt.MediaReconnectEnd,e=>{this.safeEmit(Tt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(tt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(tt.RequestRestartICE,async e=>{if(this.store.useP2P)return;let t=await this._p2pChannel.restartICE(e),s=await t.next();if(s.done)return;let a=s.value,c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void t.throw(h)}let{iceParameters:d}=function(h){let p=h.iceParameters;return{iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd}}}(c);await t.next({remoteIceParameters:d})}),this._p2pChannel.on(tt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(tt.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:s,rtpCapabilities:a}),h=CU(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(tt.RequestUnpublishForReconnectPC,async(e,t,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):s()}),this._p2pChannel.on(tt.P2PLost,()=>{this.safeEmit(Tt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(tt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(tt.ConnectionTypeChange,e=>{this.safeEmit(Tt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(tt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(tt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(tt.AudioMetadata,e=>{this.safeEmit(Tt.AUDIO_METADATA,e)}),this._p2pChannel.on(tt.AudioPts,e=>{this.safeEmit(Tt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let s=(t={config:e},ac("ContentInspect").create(t));this._inspect=s,this.handleVideoInspectEvents(s);let{appId:a,cname:c,sid:d,token:h,uid:p,cid:f,vid:_}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:p,cid:f,vid:_?Number(_):0},Hs)}catch(s){throw Array.isArray(s)?s[0]:s}var t}handleVideoInspectEvents(e){e.on(or.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(Tt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,s),s===na.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Tt.CONTENT_INSPECT_ERROR,new ue(K.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(or.INSPECT_RESULT,(t,s)=>{var a;if((s==null?void 0:s.code)===K.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return A.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(Tt.CONTENT_INSPECT_RESULT,t,s)}),e.on(or.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(ka(e,"enabled"),e){if(!t)throw new ue(K.INVALID_PARAMS,"config is required");if(U5(t),!this._joinInfo)throw new ue(K.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let a=(s={config:t},ac("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);let{appId:c,cname:d,sid:h,token:p,uid:f,cid:_,vid:v}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:p,uid:f,cid:_,vid:v?Number(v):0},Hs)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new ue(K.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(e){e.on(Va.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(Tt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,s),t===Ri.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ue(K.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Va.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Qs(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ue(K.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,A.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return A.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ka(e,"enabled"),$t("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Je(He.prototype,"leave",[V5],Object.getOwnPropertyDescriptor(He.prototype,"leave"),He.prototype),Je(He.prototype,"publish",[B5],Object.getOwnPropertyDescriptor(He.prototype,"publish"),He.prototype),Je(He.prototype,"unpublish",[W5],Object.getOwnPropertyDescriptor(He.prototype,"unpublish"),He.prototype),Je(He.prototype,"subscribe",[G5],Object.getOwnPropertyDescriptor(He.prototype,"subscribe"),He.prototype),Je(He.prototype,"presubscribe",[H5],Object.getOwnPropertyDescriptor(He.prototype,"presubscribe"),He.prototype),Je(He.prototype,"massSubscribe",[z5],Object.getOwnPropertyDescriptor(He.prototype,"massSubscribe"),He.prototype),Je(He.prototype,"unsubscribe",[K5],Object.getOwnPropertyDescriptor(He.prototype,"unsubscribe"),He.prototype),Je(He.prototype,"massUnsubscribe",[q5],Object.getOwnPropertyDescriptor(He.prototype,"massUnsubscribe"),He.prototype),Je(He.prototype,"setLowStreamParameter",[Y5],Object.getOwnPropertyDescriptor(He.prototype,"setLowStreamParameter"),He.prototype),Je(He.prototype,"enableDualStream",[$5],Object.getOwnPropertyDescriptor(He.prototype,"enableDualStream"),He.prototype),Je(He.prototype,"disableDualStream",[X5],Object.getOwnPropertyDescriptor(He.prototype,"disableDualStream"),He.prototype),Je(He.prototype,"setClientRole",[J5],Object.getOwnPropertyDescriptor(He.prototype,"setClientRole"),He.prototype),Je(He.prototype,"_setClientRoleOptions",[Q5],Object.getOwnPropertyDescriptor(He.prototype,"_setClientRoleOptions"),He.prototype),Je(He.prototype,"setProxyServer",[Z5],Object.getOwnPropertyDescriptor(He.prototype,"setProxyServer"),He.prototype),Je(He.prototype,"setTurnServer",[eV],Object.getOwnPropertyDescriptor(He.prototype,"setTurnServer"),He.prototype),Je(He.prototype,"setLicense",[tV],Object.getOwnPropertyDescriptor(He.prototype,"setLicense"),He.prototype),Je(He.prototype,"startProxyServer",[sV],Object.getOwnPropertyDescriptor(He.prototype,"startProxyServer"),He.prototype),Je(He.prototype,"stopProxyServer",[rV],Object.getOwnPropertyDescriptor(He.prototype,"stopProxyServer"),He.prototype),Je(He.prototype,"setLocalAccessPointsV2",[nV],Object.getOwnPropertyDescriptor(He.prototype,"setLocalAccessPointsV2"),He.prototype),Je(He.prototype,"setLocalAccessPoints",[iV],Object.getOwnPropertyDescriptor(He.prototype,"setLocalAccessPoints"),He.prototype),Je(He.prototype,"setRemoteDefaultVideoStreamType",[aV],Object.getOwnPropertyDescriptor(He.prototype,"setRemoteDefaultVideoStreamType"),He.prototype),Je(He.prototype,"setRemoteVideoStreamType",[oV],Object.getOwnPropertyDescriptor(He.prototype,"setRemoteVideoStreamType"),He.prototype),Je(He.prototype,"setStreamFallbackOption",[cV],Object.getOwnPropertyDescriptor(He.prototype,"setStreamFallbackOption"),He.prototype),Je(He.prototype,"setEncryptionConfig",[lV],Object.getOwnPropertyDescriptor(He.prototype,"setEncryptionConfig"),He.prototype),Je(He.prototype,"renewToken",[dV],Object.getOwnPropertyDescriptor(He.prototype,"renewToken"),He.prototype),Je(He.prototype,"enableAudioVolumeIndicator",[uV],Object.getOwnPropertyDescriptor(He.prototype,"enableAudioVolumeIndicator"),He.prototype),Je(He.prototype,"startLiveStreaming",[hV],Object.getOwnPropertyDescriptor(He.prototype,"startLiveStreaming"),He.prototype),Je(He.prototype,"setLiveTranscoding",[pV],Object.getOwnPropertyDescriptor(He.prototype,"setLiveTranscoding"),He.prototype),Je(He.prototype,"stopLiveStreaming",[mV],Object.getOwnPropertyDescriptor(He.prototype,"stopLiveStreaming"),He.prototype),Je(He.prototype,"startChannelMediaRelay",[fV],Object.getOwnPropertyDescriptor(He.prototype,"startChannelMediaRelay"),He.prototype),Je(He.prototype,"updateChannelMediaRelay",[gV],Object.getOwnPropertyDescriptor(He.prototype,"updateChannelMediaRelay"),He.prototype),Je(He.prototype,"stopChannelMediaRelay",[_V],Object.getOwnPropertyDescriptor(He.prototype,"stopChannelMediaRelay"),He.prototype),Je(He.prototype,"sendCustomReportMessage",[vV],Object.getOwnPropertyDescriptor(He.prototype,"sendCustomReportMessage"),He.prototype),Je(He.prototype,"pickSVCLayer",[EV],Object.getOwnPropertyDescriptor(He.prototype,"pickSVCLayer"),He.prototype),Je(He.prototype,"setRTMConfig",[yV],Object.getOwnPropertyDescriptor(He.prototype,"setRTMConfig"),He.prototype),Je(He.prototype,"enableContentInspect",[xV],Object.getOwnPropertyDescriptor(He.prototype,"enableContentInspect"),He.prototype),Je(He.prototype,"disableContentInspect",[bV],Object.getOwnPropertyDescriptor(He.prototype,"disableContentInspect"),He.prototype),Je(He.prototype,"setImageModeration",[wV],Object.getOwnPropertyDescriptor(He.prototype,"setImageModeration"),He.prototype),Je(He.prototype,"setP2PTransport",[SV],Object.getOwnPropertyDescriptor(He.prototype,"setP2PTransport"),He.prototype),Je(He.prototype,"getJoinChannelServiceRecords",[CV],Object.getOwnPropertyDescriptor(He.prototype,"getJoinChannelServiceRecords"),He.prototype),Je(He.prototype,"setPublishAudioFilterEnabled",[TV],Object.getOwnPropertyDescriptor(He.prototype,"setPublishAudioFilterEnabled"),He.prototype),He);class of{constructor(t,s){B(this,"id",0),B(this,"element",void 0),B(this,"peerPair",void 0),B(this,"context",void 0),B(this,"audioPlayerElement",void 0),B(this,"audioTrack",void 0),of.count+=1,this.id=of.count,this.element=t,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let s=document.createElement("audio");s.srcObject=new MediaStream([t.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;let t=async(a,c)=>{let d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new Ve(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,c)=>await a.setRemoteDescription(c);try{let a=await t(this.peerPair[0],"offer");await s(this.peerPair[1],a);let c=await t(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new ue(K.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let s;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(s)}catch(c){throw new ue(K.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new ue(K.LOCAL_AEC_ERROR,"no dest node when local aec").print();let a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,s=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){A.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var RV,jE;B(of,"count",0);let hoe=window.AudioContext||window.webkitAudioContext,poe=new(RV=ct({report:Qe}),Je((jE=class{constructor(){B(this,"units",[]),B(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return A.debug("the system does not need to process local aec"),-1;this.context||(this.context=new hoe);let t=this.units.find(s=>s&&s.getElement()===e);return t||(t=new of(e,this.context),this.units.push(t)),t.startEchoCancellation(),A.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return At().name!==Lt.SAFARI}}).prototype,"processExternalMediaAEC",[RV],Object.getOwnPropertyDescriptor(jE.prototype,"processExternalMediaAEC"),jE.prototype),jE);function AV(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function IV(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?AV(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):AV(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let JC=window||document;function DV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!JC)return;let s=zs._cspEventHandlerPointer;if(s&&t)return void console.error(s,t);let a=c=>{if(!(c&&c.blockedURI&&(zs.onSecurityPolicyViolation||zs.getListeners(So.SECURITY_POLICY_VIOLATION).length>0)))return;let d=c.blockedURI;$("CSP_DETECTED_HOSTNAME_LIST").some(h=>je(d).call(d,h))&&(zs.onSecurityPolicyViolation&&typeof zs.onSecurityPolicyViolation=="function"&&zs.onSecurityPolicyViolation(c),zs.getListeners(So.SECURITY_POLICY_VIOLATION).length>0&&zs.safeEmit(So.SECURITY_POLICY_VIOLATION,c))};s&&JC.removeEventListener("securitypolicyviolation",s),(t||e&&typeof e=="function"||zs.getListeners(So.SECURITY_POLICY_VIOLATION).length>0)&&JC.addEventListener("securitypolicyviolation",a),zs._cspEventHandlerPointer=a}var moe=N,foe=p2,OV=RegExp.prototype,goe=function(e){return e===OV||moe(OV,e)?foe(e):e.flags},$r=u(goe);function Ah(e){let t=e.length;for(;--t>=0;)e[t]=0}let QC=256,jV=286,cf=30,lf=15,ZC=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),PE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),_oe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),PV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cc=new Array(576);Ah(cc);let df=new Array(60);Ah(df);let uf=new Array(512);Ah(uf);let hf=new Array(256);Ah(hf);let eT=new Array(29);Ah(eT);let kE=new Array(cf);function tT(e,t,s,a,c){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=e&&e.length}let kV,LV,MV;function sT(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ah(kE);let FV=e=>e<256?uf[e]:uf[256+(e>>>7)],pf=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},pi=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,pf(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},No=(e,t,s)=>{pi(e,s[2*t],s[2*t+1])},UV=(e,t)=>{let s=0;do s|=1&e,e>>>=1,s<<=1;while(--t>0);return s>>>1},VV=(e,t,s)=>{let a=new Array(16),c,d,h=0;for(c=1;c<=lf;c++)h=h+s[c-1]<<1,a[c]=h;for(d=0;d<=t;d++){let p=e[2*d+1];p!==0&&(e[2*d]=UV(a[p]++,p))}},BV=e=>{let t;for(t=0;t<jV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<cf;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},WV=e=>{e.bi_valid>8?pf(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},GV=(e,t,s,a)=>{let c=2*t,d=2*s;return e[c]<e[d]||e[c]===e[d]&&a[t]<=a[s]},rT=(e,t,s)=>{let a=e.heap[s],c=s<<1;for(;c<=e.heap_len&&(c<e.heap_len&&GV(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!GV(t,a,e.heap[c],e.depth));)e.heap[s]=e.heap[c],s=c,c<<=1;e.heap[s]=a},HV=(e,t,s)=>{let a,c,d,h,p=0;if(e.sym_next!==0)do a=255&e.pending_buf[e.sym_buf+p++],a+=(255&e.pending_buf[e.sym_buf+p++])<<8,c=e.pending_buf[e.sym_buf+p++],a===0?No(e,c,t):(d=hf[c],No(e,d+QC+1,t),h=ZC[d],h!==0&&(c-=eT[d],pi(e,c,h)),a--,d=FV(a),No(e,d,s),h=PE[d],h!==0&&(a-=kE[d],pi(e,a,h)));while(p<e.sym_next);No(e,256,t)},nT=(e,t)=>{let s=t.dyn_tree,a=t.stat_desc.static_tree,c=t.stat_desc.has_stree,d=t.stat_desc.elems,h,p,f,_=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(e.heap[++e.heap_len]=_=h,e.depth[h]=0):s[2*h+1]=0;for(;e.heap_len<2;)f=e.heap[++e.heap_len]=_<2?++_:0,s[2*f]=1,e.depth[f]=0,e.opt_len--,c&&(e.static_len-=a[2*f+1]);for(t.max_code=_,h=e.heap_len>>1;h>=1;h--)rT(e,s,h);f=d;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],rT(e,s,1),p=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=p,s[2*f]=s[2*h]+s[2*p],e.depth[f]=(e.depth[h]>=e.depth[p]?e.depth[h]:e.depth[p])+1,s[2*h+1]=s[2*p+1]=f,e.heap[1]=f++,rT(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((v,b)=>{let w=b.dyn_tree,T=b.max_code,U=b.stat_desc.static_tree,k=b.stat_desc.has_stree,F=b.stat_desc.extra_bits,z=b.stat_desc.extra_base,Y=b.stat_desc.max_length,X,re,te,Z,de,xe,Se=0;for(Z=0;Z<=lf;Z++)v.bl_count[Z]=0;for(w[2*v.heap[v.heap_max]+1]=0,X=v.heap_max+1;X<573;X++)re=v.heap[X],Z=w[2*w[2*re+1]+1]+1,Z>Y&&(Z=Y,Se++),w[2*re+1]=Z,re>T||(v.bl_count[Z]++,de=0,re>=z&&(de=F[re-z]),xe=w[2*re],v.opt_len+=xe*(Z+de),k&&(v.static_len+=xe*(U[2*re+1]+de)));if(Se!==0){do{for(Z=Y-1;v.bl_count[Z]===0;)Z--;v.bl_count[Z]--,v.bl_count[Z+1]+=2,v.bl_count[Y]--,Se-=2}while(Se>0);for(Z=Y;Z!==0;Z--)for(re=v.bl_count[Z];re!==0;)te=v.heap[--X],te>T||(w[2*te+1]!==Z&&(v.opt_len+=(Z-w[2*te+1])*w[2*te],w[2*te+1]=Z),re--)}})(e,t),VV(s,_,e.bl_count)},zV=(e,t,s)=>{let a,c,d=-1,h=t[1],p=0,f=7,_=4;for(h===0&&(f=138,_=3),t[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=t[2*(a+1)+1],++p<f&&c===h||(p<_?e.bl_tree[2*c]+=p:c!==0?(c!==d&&e.bl_tree[2*c]++,e.bl_tree[32]++):p<=10?e.bl_tree[34]++:e.bl_tree[36]++,p=0,d=c,h===0?(f=138,_=3):c===h?(f=6,_=3):(f=7,_=4))},KV=(e,t,s)=>{let a,c,d=-1,h=t[1],p=0,f=7,_=4;for(h===0&&(f=138,_=3),a=0;a<=s;a++)if(c=h,h=t[2*(a+1)+1],!(++p<f&&c===h)){if(p<_)do No(e,c,e.bl_tree);while(--p!=0);else c!==0?(c!==d&&(No(e,c,e.bl_tree),p--),No(e,16,e.bl_tree),pi(e,p-3,2)):p<=10?(No(e,17,e.bl_tree),pi(e,p-3,3)):(No(e,18,e.bl_tree),pi(e,p-11,7));p=0,d=c,h===0?(f=138,_=3):c===h?(f=6,_=3):(f=7,_=4)}},qV=!1,YV=(e,t,s,a)=>{pi(e,0+(a?1:0),3),WV(e),pf(e,s),pf(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var voe=e=>{qV||((()=>{let t,s,a,c,d,h=new Array(16);for(a=0,c=0;c<28;c++)for(eT[c]=a,t=0;t<1<<ZC[c];t++)hf[a++]=c;for(hf[a-1]=c,d=0,c=0;c<16;c++)for(kE[c]=d,t=0;t<1<<PE[c];t++)uf[d++]=c;for(d>>=7;c<cf;c++)for(kE[c]=d<<7,t=0;t<1<<PE[c]-7;t++)uf[256+d++]=c;for(s=0;s<=lf;s++)h[s]=0;for(t=0;t<=143;)cc[2*t+1]=8,t++,h[8]++;for(;t<=255;)cc[2*t+1]=9,t++,h[9]++;for(;t<=279;)cc[2*t+1]=7,t++,h[7]++;for(;t<=287;)cc[2*t+1]=8,t++,h[8]++;for(VV(cc,287,h),t=0;t<cf;t++)df[2*t+1]=5,df[2*t]=UV(t,5);kV=new tT(cc,ZC,257,jV,lf),LV=new tT(df,PE,0,cf,lf),MV=new tT(new Array(0),_oe,0,19,7)})(),qV=!0),e.l_desc=new sT(e.dyn_ltree,kV),e.d_desc=new sT(e.dyn_dtree,LV),e.bl_desc=new sT(e.bl_tree,MV),e.bi_buf=0,e.bi_valid=0,BV(e)},Eoe=(e,t,s,a)=>{let c,d,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(p=>{let f,_=4093624447;for(f=0;f<=31;f++,_>>>=1)if(1&_&&p.dyn_ltree[2*f]!==0)return 0;if(p.dyn_ltree[18]!==0||p.dyn_ltree[20]!==0||p.dyn_ltree[26]!==0)return 1;for(f=32;f<QC;f++)if(p.dyn_ltree[2*f]!==0)return 1;return 0})(e)),nT(e,e.l_desc),nT(e,e.d_desc),h=(p=>{let f;for(zV(p,p.dyn_ltree,p.l_desc.max_code),zV(p,p.dyn_dtree,p.d_desc.max_code),nT(p,p.bl_desc),f=18;f>=3&&p.bl_tree[2*PV[f]+1]===0;f--);return p.opt_len+=3*(f+1)+5+5+4,f})(e),c=e.opt_len+3+7>>>3,d=e.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&t!==-1?YV(e,t,s,a):e.strategy===4||d===c?(pi(e,2+(a?1:0),3),HV(e,cc,df)):(pi(e,4+(a?1:0),3),((p,f,_,v)=>{let b;for(pi(p,f-257,5),pi(p,_-1,5),pi(p,v-4,4),b=0;b<v;b++)pi(p,p.bl_tree[2*PV[b]+1],3);KV(p,p.dyn_ltree,f-1),KV(p,p.dyn_dtree,_-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),HV(e,e.dyn_ltree,e.dyn_dtree)),BV(e),a&&WV(e)},yoe=(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,t===0?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(hf[s]+QC+1)]++,e.dyn_dtree[2*FV(t)]++),e.sym_next===e.sym_end),xoe=e=>{pi(e,2,3),No(e,256,cc),(t=>{t.bi_valid===16?(pf(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},boe={_tr_init:voe,_tr_stored_block:YV,_tr_flush_block:Eoe,_tr_tally:yoe,_tr_align:xoe},mf=(e,t,s,a)=>{let c=65535&e|0,d=e>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+t[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};let woe=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var nn=(e,t,s,a)=>{let c=woe,d=a+s;e^=-1;for(let h=a;h<d;h++)e=e>>>8^c[255&(e^t[h])];return-1^e},bd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},LE={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:Soe,_tr_stored_block:iT,_tr_flush_block:Coe,_tr_tally:tl,_tr_align:Toe}=boe,{Z_NO_FLUSH:sl,Z_PARTIAL_FLUSH:Noe,Z_FULL_FLUSH:Roe,Z_FINISH:la,Z_BLOCK:$V,Z_OK:mn,Z_STREAM_END:XV,Z_STREAM_ERROR:Ro,Z_DATA_ERROR:Aoe,Z_BUF_ERROR:aT,Z_DEFAULT_COMPRESSION:Ioe,Z_FILTERED:Doe,Z_HUFFMAN_ONLY:ME,Z_RLE:Ooe,Z_FIXED:joe,Z_DEFAULT_STRATEGY:Poe,Z_UNKNOWN:koe,Z_DEFLATED:FE}=LE,oT=286,Loe=30,Moe=19,Foe=2*oT+1,Uoe=15,wd=258,Ao=262,Ih=42,Sd=113,ff=666,Cd=(e,t)=>(e.msg=bd[t],t),JV=e=>2*e-(e>4?9:0),rl=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Voe=e=>{let t,s,a,c=e.w_size;t=e.hash_size,a=t;do s=e.head[--a],e.head[a]=s>=c?s-c:0;while(--t);t=c,a=t;do s=e.prev[--a],e.prev[a]=s>=c?s-c:0;while(--t)},nl=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask,Ii=e=>{let t=e.state,s=t.pending;s>e.avail_out&&(s=e.avail_out),s!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,t.pending===0&&(t.pending_out=0))},Di=(e,t)=>{Coe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ii(e.strm)},js=(e,t)=>{e.pending_buf[e.pending++]=t},gf=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},cT=(e,t,s,a)=>{let c=e.avail_in;return c>a&&(c=a),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),s),e.state.wrap===1?e.adler=mf(e.adler,t,c,s):e.state.wrap===2&&(e.adler=nn(e.adler,t,c,s)),e.next_in+=c,e.total_in+=c,c)},QV=(e,t)=>{let s,a,c=e.max_chain_length,d=e.strstart,h=e.prev_length,p=e.nice_match,f=e.strstart>e.w_size-Ao?e.strstart-(e.w_size-Ao):0,_=e.window,v=e.w_mask,b=e.prev,w=e.strstart+wd,T=_[d+h-1],U=_[d+h];e.prev_length>=e.good_match&&(c>>=2),p>e.lookahead&&(p=e.lookahead);do if(s=t,_[s+h]===U&&_[s+h-1]===T&&_[s]===_[d]&&_[++s]===_[d+1]){d+=2,s++;do;while(_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&_[++d]===_[++s]&&d<w);if(a=wd-(w-d),d=w-wd,a>h){if(e.match_start=t,h=a,a>=p)break;T=_[d+h-1],U=_[d+h]}}while((t=b[t&v])>f&&--c!=0);return h<=e.lookahead?h:e.lookahead},Dh=e=>{let t=e.w_size,s,a,c;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ao)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Voe(e),a+=t),e.strm.avail_in===0)break;if(s=cT(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=s,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=nl(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=nl(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ao&&e.strm.avail_in!==0)},ZV=(e,t)=>{let s,a,c,d=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,p=e.strm.avail_in;do{if(s=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,a=e.strstart-e.block_start,s>a+e.strm.avail_in&&(s=a+e.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&t!==la||t===sl||s!==a+e.strm.avail_in)))break;h=t===la&&s===a+e.strm.avail_in?1:0,iT(e,0,0,h),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,Ii(e.strm),a&&(a>s&&(a=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,s-=a),s&&(cT(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(h===0);return p-=e.strm.avail_in,p&&(p>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=p&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-p,e.strm.next_in),e.strstart),e.strstart+=p,e.insert+=p>e.w_size-e.insert?e.w_size-e.insert:p),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:t!==sl&&t!==la&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(cT(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,d=c>e.w_size?e.w_size:c,a=e.strstart-e.block_start,(a>=d||(a||t===la)&&t!==sl&&e.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=t===la&&e.strm.avail_in===0&&s===a?1:0,iT(e,e.block_start,s,h),e.block_start+=s,Ii(e.strm)),h?3:1)},lT=(e,t)=>{let s,a;for(;;){if(e.lookahead<Ao){if(Dh(e),e.lookahead<Ao&&t===sl)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=nl(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),s!==0&&e.strstart-s<=e.w_size-Ao&&(e.match_length=QV(e,s)),e.match_length>=3)if(a=tl(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=nl(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=nl(e,e.ins_h,e.window[e.strstart+1]);else a=tl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(Di(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===la?(Di(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Di(e,!1),e.strm.avail_out===0)?1:2},Oh=(e,t)=>{let s,a,c;for(;;){if(e.lookahead<Ao){if(Dh(e),e.lookahead<Ao&&t===sl)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=nl(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,s!==0&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Ao&&(e.match_length=QV(e,s),e.match_length<=5&&(e.strategy===Doe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,a=tl(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=nl(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(Di(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(a=tl(e,0,e.window[e.strstart-1]),a&&Di(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=tl(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===la?(Di(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Di(e,!1),e.strm.avail_out===0)?1:2};function Io(e,t,s,a,c){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=a,this.func=c}let _f=[new Io(0,0,0,0,ZV),new Io(4,4,8,4,lT),new Io(4,5,16,8,lT),new Io(4,6,32,32,lT),new Io(4,4,16,16,Oh),new Io(8,16,32,32,Oh),new Io(8,16,128,128,Oh),new Io(8,32,128,256,Oh),new Io(32,128,258,1024,Oh),new Io(32,258,258,4096,Oh)];function Boe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=FE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Foe),this.dyn_dtree=new Uint16Array(2*(2*Loe+1)),this.bl_tree=new Uint16Array(2*(2*Moe+1)),rl(this.dyn_ltree),rl(this.dyn_dtree),rl(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Uoe+1),this.heap=new Uint16Array(2*oT+1),rl(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*oT+1),rl(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let vf=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Ih&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Sd&&t.status!==ff?1:0},e4=e=>{if(vf(e))return Cd(e,Ro);e.total_in=e.total_out=0,e.data_type=koe;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Ih:Sd,e.adler=t.wrap===2?0:1,t.last_flush=-2,Soe(t),mn},t4=e=>{let t=e4(e);return t===mn&&(s=>{s.window_size=2*s.w_size,rl(s.head),s.max_lazy_match=_f[s.level].max_lazy,s.good_match=_f[s.level].good_length,s.nice_match=_f[s.level].nice_length,s.max_chain_length=_f[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(e.state),t},s4=(e,t,s,a,c,d)=>{if(!e)return Ro;let h=1;if(t===Ioe&&(t=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==FE||a<8||a>15||t<0||t>9||d<0||d>joe||a===8&&h!==1)return Cd(e,Ro);a===8&&(a=9);let p=new Boe;return e.state=p,p.strm=e,p.status=Ih,p.wrap=h,p.gzhead=null,p.w_bits=a,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=c+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<c+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=t,p.strategy=d,p.method=s,t4(e)};var Woe=(e,t)=>{if(vf(e)||t>$V||t<0)return e?Cd(e,Ro):Ro;let s=e.state;if(!e.output||e.avail_in!==0&&!e.input||s.status===ff&&t!==la)return Cd(e,e.avail_out===0?aT:Ro);let a=s.last_flush;if(s.last_flush=t,s.pending!==0){if(Ii(e),e.avail_out===0)return s.last_flush=-1,mn}else if(e.avail_in===0&&JV(t)<=JV(a)&&t!==la)return Cd(e,aT);if(s.status===ff&&e.avail_in!==0)return Cd(e,aT);if(s.status===Ih&&s.wrap===0&&(s.status=Sd),s.status===Ih){let c=FE+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=ME||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,gf(s,c),s.strstart!==0&&(gf(s,e.adler>>>16),gf(s,65535&e.adler)),e.adler=1,s.status=Sd,Ii(e),s.pending!==0)return s.last_flush=-1,mn}if(s.status===57){if(e.adler=0,js(s,31),js(s,139),js(s,8),s.gzhead)js(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),js(s,255&s.gzhead.time),js(s,s.gzhead.time>>8&255),js(s,s.gzhead.time>>16&255),js(s,s.gzhead.time>>24&255),js(s,s.level===9?2:s.strategy>=ME||s.level<2?4:0),js(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(js(s,255&s.gzhead.extra.length),js(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=nn(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(js(s,0),js(s,0),js(s,0),js(s,0),js(s,0),js(s,s.level===9?2:s.strategy>=ME||s.level<2?4:0),js(s,3),s.status=Sd,Ii(e),s.pending!==0)return s.last_flush=-1,mn}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let p=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+p),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(e.adler=nn(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=p,Ii(e),s.pending!==0)return s.last_flush=-1,mn;c=0,d-=p}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(e.adler=nn(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(e.adler=nn(e.adler,s.pending_buf,s.pending-d,d)),Ii(e),s.pending!==0)return s.last_flush=-1,mn;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,js(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(e.adler=nn(e.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(e.adler=nn(e.adler,s.pending_buf,s.pending-d,d)),Ii(e),s.pending!==0)return s.last_flush=-1,mn;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,js(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(e.adler=nn(e.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Ii(e),s.pending!==0))return s.last_flush=-1,mn;js(s,255&e.adler),js(s,e.adler>>8&255),e.adler=0}if(s.status=Sd,Ii(e),s.pending!==0)return s.last_flush=-1,mn}if(e.avail_in!==0||s.lookahead!==0||t!==sl&&s.status!==ff){let c=s.level===0?ZV(s,t):s.strategy===ME?((d,h)=>{let p;for(;;){if(d.lookahead===0&&(Dh(d),d.lookahead===0)){if(h===sl)return 1;break}if(d.match_length=0,p=tl(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(Di(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===la?(Di(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Di(d,!1),d.strm.avail_out===0)?1:2})(s,t):s.strategy===Ooe?((d,h)=>{let p,f,_,v,b=d.window;for(;;){if(d.lookahead<=wd){if(Dh(d),d.lookahead<=wd&&h===sl)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(_=d.strstart-1,f=b[_],f===b[++_]&&f===b[++_]&&f===b[++_])){v=d.strstart+wd;do;while(f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&f===b[++_]&&_<v);d.match_length=wd-(v-_),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=tl(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=tl(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(Di(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===la?(Di(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Di(d,!1),d.strm.avail_out===0)?1:2})(s,t):_f[s.level].func(s,t);if(c!==3&&c!==4||(s.status=ff),c===1||c===3)return e.avail_out===0&&(s.last_flush=-1),mn;if(c===2&&(t===Noe?Toe(s):t!==$V&&(iT(s,0,0,!1),t===Roe&&(rl(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Ii(e),e.avail_out===0))return s.last_flush=-1,mn}return t!==la?mn:s.wrap<=0?XV:(s.wrap===2?(js(s,255&e.adler),js(s,e.adler>>8&255),js(s,e.adler>>16&255),js(s,e.adler>>24&255),js(s,255&e.total_in),js(s,e.total_in>>8&255),js(s,e.total_in>>16&255),js(s,e.total_in>>24&255)):(gf(s,e.adler>>>16),gf(s,65535&e.adler)),Ii(e),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?mn:XV)},Goe=(e,t)=>{let s=t.length;if(vf(e))return Ro;let a=e.state,c=a.wrap;if(c===2||c===1&&a.status!==Ih||a.lookahead)return Ro;if(c===1&&(e.adler=mf(e.adler,t,s,0)),a.wrap=0,s>=a.w_size){c===0&&(rl(a.head),a.strstart=0,a.block_start=0,a.insert=0);let f=new Uint8Array(a.w_size);f.set(t.subarray(s-a.w_size,s),0),t=f,s=a.w_size}let d=e.avail_in,h=e.next_in,p=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Dh(a);a.lookahead>=3;){let f=a.strstart,_=a.lookahead-2;do a.ins_h=nl(a,a.ins_h,a.window[f+3-1]),a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++;while(--_);a.strstart=f,a.lookahead=2,Dh(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=h,e.input=p,e.avail_in=d,a.wrap=c,mn},Ef={deflateInit:(e,t)=>s4(e,t,FE,15,8,Poe),deflateInit2:s4,deflateReset:t4,deflateResetKeep:e4,deflateSetHeader:(e,t)=>vf(e)||e.state.wrap!==2?Ro:(e.state.gzhead=t,mn),deflate:Woe,deflateEnd:e=>{if(vf(e))return Ro;let t=e.state.status;return e.state=null,t===Sd?Cd(e,Aoe):mn},deflateSetDictionary:Goe,deflateInfo:"pako deflate (from Nodeca project)"};let Hoe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var UE={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let s=t.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(let a in s)Hoe(s,a)&&(e[a]=s[a])}}return e},flattenChunks:e=>{let t=0;for(let a=0,c=e.length;a<c;a++)t+=e[a].length;let s=new Uint8Array(t);for(let a=0,c=0,d=e.length;a<d;a++){let h=e[a];s.set(h,c),c+=h.length}return s}};let r4=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r4=!1}let yf=new Uint8Array(256);for(let e=0;e<256;e++)yf[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;yf[254]=yf[254]=1;var xf={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,s,a,c,d,h=e.length,p=0;for(c=0;c<h;c++)s=e.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=e.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),p+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(p),d=0,c=0;d<p;c++)s=e.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=e.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?t[d++]=s:s<2048?(t[d++]=192|s>>>6,t[d++]=128|63&s):s<65536?(t[d++]=224|s>>>12,t[d++]=128|s>>>6&63,t[d++]=128|63&s):(t[d++]=240|s>>>18,t[d++]=128|s>>>12&63,t[d++]=128|s>>>6&63,t[d++]=128|63&s);return t},buf2string:(e,t)=>{let s=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let a,c,d=new Array(2*s);for(c=0,a=0;a<s;){let h=e[a++];if(h<128){d[c++]=h;continue}let p=yf[h];if(p>4)d[c++]=65533,a+=p-1;else{for(h&=p===2?31:p===3?15:7;p>1&&a<s;)h=h<<6|63&e[a++],p--;p>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&r4)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let f="";for(let _=0;_<p;_++)f+=String.fromCharCode(h[_]);return f})(d,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&(192&e[s])==128;)s--;return s<0||s===0?t:s+yf[e[s]]>t?s:t}},n4=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let i4=Object.prototype.toString,{Z_NO_FLUSH:zoe,Z_SYNC_FLUSH:Koe,Z_FULL_FLUSH:qoe,Z_FINISH:Yoe,Z_OK:VE,Z_STREAM_END:$oe,Z_DEFAULT_COMPRESSION:Xoe,Z_DEFAULT_STRATEGY:Joe,Z_DEFLATED:Qoe}=LE;function BE(e){this.options=UE.assign({level:Xoe,method:Qoe,chunkSize:16384,windowBits:15,memLevel:8,strategy:Joe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n4,this.strm.avail_out=0;let s=Ef.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==VE)throw new Error(bd[s]);if(t.header&&Ef.deflateSetHeader(this.strm,t.header),t.dictionary){let a;if(a=typeof t.dictionary=="string"?xf.string2buf(t.dictionary):i4.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,s=Ef.deflateSetDictionary(this.strm,a),s!==VE)throw new Error(bd[s]);this._dict_set=!0}}function Zoe(e,t){let s=new BE(t);if(s.push(e,!0),s.err)throw s.msg||bd[s.err];return s.result}BE.prototype.push=function(e,t){let s=this.strm,a=this.options.chunkSize,c,d;if(this.ended)return!1;for(d=t===~~t?t:t===!0?Yoe:zoe,typeof e=="string"?s.input=xf.string2buf(e):i4.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(d===Koe||d===qoe)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=Ef.deflate(s,d),c===$oe)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=Ef.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===VE;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},BE.prototype.onData=function(e){this.chunks.push(e)},BE.prototype.onEnd=function(e){e===VE&&(this.result=UE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ece={deflate:Zoe};let WE=16209;var tce=function(e,t){let s,a,c,d,h,p,f,_,v,b,w,T,U,k,F,z,Y,X,re,te,Z,de,xe,Se,Ae=e.state;s=e.next_in,xe=e.input,a=s+(e.avail_in-5),c=e.next_out,Se=e.output,d=c-(t-e.avail_out),h=c+(e.avail_out-257),p=Ae.dmax,f=Ae.wsize,_=Ae.whave,v=Ae.wnext,b=Ae.window,w=Ae.hold,T=Ae.bits,U=Ae.lencode,k=Ae.distcode,F=(1<<Ae.lenbits)-1,z=(1<<Ae.distbits)-1;e:do{T<15&&(w+=xe[s++]<<T,T+=8,w+=xe[s++]<<T,T+=8),Y=U[w&F];t:for(;;){if(X=Y>>>24,w>>>=X,T-=X,X=Y>>>16&255,X===0)Se[c++]=65535&Y;else{if(!(16&X)){if(!(64&X)){Y=U[(65535&Y)+(w&(1<<X)-1)];continue t}if(32&X){Ae.mode=16191;break e}e.msg="invalid literal/length code",Ae.mode=WE;break e}re=65535&Y,X&=15,X&&(T<X&&(w+=xe[s++]<<T,T+=8),re+=w&(1<<X)-1,w>>>=X,T-=X),T<15&&(w+=xe[s++]<<T,T+=8,w+=xe[s++]<<T,T+=8),Y=k[w&z];s:for(;;){if(X=Y>>>24,w>>>=X,T-=X,X=Y>>>16&255,!(16&X)){if(!(64&X)){Y=k[(65535&Y)+(w&(1<<X)-1)];continue s}e.msg="invalid distance code",Ae.mode=WE;break e}if(te=65535&Y,X&=15,T<X&&(w+=xe[s++]<<T,T+=8,T<X&&(w+=xe[s++]<<T,T+=8)),te+=w&(1<<X)-1,te>p){e.msg="invalid distance too far back",Ae.mode=WE;break e}if(w>>>=X,T-=X,X=c-d,te>X){if(X=te-X,X>_&&Ae.sane){e.msg="invalid distance too far back",Ae.mode=WE;break e}if(Z=0,de=b,v===0){if(Z+=f-X,X<re){re-=X;do Se[c++]=b[Z++];while(--X);Z=c-te,de=Se}}else if(v<X){if(Z+=f+v-X,X-=v,X<re){re-=X;do Se[c++]=b[Z++];while(--X);if(Z=0,v<re){X=v,re-=X;do Se[c++]=b[Z++];while(--X);Z=c-te,de=Se}}}else if(Z+=v-X,X<re){re-=X;do Se[c++]=b[Z++];while(--X);Z=c-te,de=Se}for(;re>2;)Se[c++]=de[Z++],Se[c++]=de[Z++],Se[c++]=de[Z++],re-=3;re&&(Se[c++]=de[Z++],re>1&&(Se[c++]=de[Z++]))}else{Z=c-te;do Se[c++]=Se[Z++],Se[c++]=Se[Z++],Se[c++]=Se[Z++],re-=3;while(re>2);re&&(Se[c++]=Se[Z++],re>1&&(Se[c++]=Se[Z++]))}break}}break}}while(s<a&&c<h);re=T>>3,s-=re,T-=re<<3,w&=(1<<T)-1,e.next_in=s,e.next_out=c,e.avail_in=s<a?a-s+5:5-(s-a),e.avail_out=c<h?h-c+257:257-(c-h),Ae.hold=w,Ae.bits=T};let GE=15,sce=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),rce=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),nce=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ice=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var bf=(e,t,s,a,c,d,h,p)=>{let f=p.bits,_,v,b,w,T,U,k=0,F=0,z=0,Y=0,X=0,re=0,te=0,Z=0,de=0,xe=0,Se=null,Ae=new Uint16Array(16),yt=new Uint16Array(16),bt,dt,Wt,Ut=null;for(k=0;k<=GE;k++)Ae[k]=0;for(F=0;F<a;F++)Ae[t[s+F]]++;for(X=f,Y=GE;Y>=1&&Ae[Y]===0;Y--);if(X>Y&&(X=Y),Y===0)return c[d++]=20971520,c[d++]=20971520,p.bits=1,0;for(z=1;z<Y&&Ae[z]===0;z++);for(X<z&&(X=z),Z=1,k=1;k<=GE;k++)if(Z<<=1,Z-=Ae[k],Z<0)return-1;if(Z>0&&(e===0||Y!==1))return-1;for(yt[1]=0,k=1;k<GE;k++)yt[k+1]=yt[k]+Ae[k];for(F=0;F<a;F++)t[s+F]!==0&&(h[yt[t[s+F]]++]=F);if(e===0?(Se=Ut=h,U=20):e===1?(Se=sce,Ut=rce,U=257):(Se=nce,Ut=ice,U=0),xe=0,F=0,k=z,T=d,re=X,te=0,b=-1,de=1<<X,w=de-1,e===1&&de>852||e===2&&de>592)return 1;for(;;){bt=k-te,h[F]+1<U?(dt=0,Wt=h[F]):h[F]>=U?(dt=Ut[h[F]-U],Wt=Se[h[F]-U]):(dt=96,Wt=0),_=1<<k-te,v=1<<re,z=v;do v-=_,c[T+(xe>>te)+v]=bt<<24|dt<<16|Wt|0;while(v!==0);for(_=1<<k-1;xe&_;)_>>=1;if(_!==0?(xe&=_-1,xe+=_):xe=0,F++,--Ae[k]==0){if(k===Y)break;k=t[s+h[F]]}if(k>X&&(xe&w)!==b){for(te===0&&(te=X),T+=z,re=k-te,Z=1<<re;re+te<Y&&(Z-=Ae[re+te],!(Z<=0));)re++,Z<<=1;if(de+=1<<re,e===1&&de>852||e===2&&de>592)return 1;b=xe&w,c[b]=X<<24|re<<16|T-d|0}}return xe!==0&&(c[T+xe]=k-te<<24|64<<16|0),p.bits=X,0};let{Z_FINISH:a4,Z_BLOCK:ace,Z_TREES:HE,Z_OK:Td,Z_STREAM_END:oce,Z_NEED_DICT:cce,Z_STREAM_ERROR:da,Z_DATA_ERROR:o4,Z_MEM_ERROR:c4,Z_BUF_ERROR:lce,Z_DEFLATED:l4}=LE,zE=16180,KE=16190,lc=16191,dT=16192,uT=16194,qE=16199,YE=16200,hT=16206,cr=16209,d4=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function dce(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Nd=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<zE||t.mode>16211?1:0},u4=e=>{if(Nd(e))return da;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=zE,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Td},h4=e=>{if(Nd(e))return da;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,u4(e)},p4=(e,t)=>{let s;if(Nd(e))return da;let a=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?da:(a.window!==null&&a.wbits!==t&&(a.window=null),a.wrap=s,a.wbits=t,h4(e))},m4=(e,t)=>{if(!e)return da;let s=new dce;e.state=s,s.strm=e,s.window=null,s.mode=zE;let a=p4(e,t);return a!==Td&&(e.state=null),a},pT,mT,f4=!0,uce=e=>{if(f4){pT=new Int32Array(512),mT=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(bf(1,e.lens,0,288,pT,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;bf(2,e.lens,0,32,mT,0,e.work,{bits:5}),f4=!1}e.lencode=pT,e.lenbits=9,e.distcode=mT,e.distbits=5},g4=(e,t,s,a)=>{let c,d=e.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(t.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(t.subarray(s-a,s-a+c),d.wnext),(a-=c)?(d.window.set(t.subarray(s-a,s),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var hce=(e,t)=>{let s,a,c,d,h,p,f,_,v,b,w,T,U,k,F,z,Y,X,re,te,Z,de,xe=0,Se=new Uint8Array(4),Ae,yt,bt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Nd(e)||!e.output||!e.input&&e.avail_in!==0)return da;s=e.state,s.mode===lc&&(s.mode=dT),h=e.next_out,c=e.output,f=e.avail_out,d=e.next_in,a=e.input,p=e.avail_in,_=s.hold,v=s.bits,b=p,w=f,de=Td;e:for(;;)switch(s.mode){case zE:if(s.wrap===0){s.mode=dT;break}for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(2&s.wrap&&_===35615){s.wbits===0&&(s.wbits=15),s.check=0,Se[0]=255&_,Se[1]=_>>>8&255,s.check=nn(s.check,Se,2,0),_=0,v=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",s.mode=cr;break}if((15&_)!==l4){e.msg="unknown compression method",s.mode=cr;break}if(_>>>=4,v-=4,Z=8+(15&_),s.wbits===0&&(s.wbits=Z),Z>15||Z>s.wbits){e.msg="invalid window size",s.mode=cr;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&_?16189:lc,_=0,v=0;break;case 16181:for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(s.flags=_,(255&$r(s))!==l4){e.msg="unknown compression method",s.mode=cr;break}if(57344&$r(s)){e.msg="unknown header flags set",s.mode=cr;break}s.head&&(s.head.text=_>>8&1),512&$r(s)&&4&s.wrap&&(Se[0]=255&_,Se[1]=_>>>8&255,s.check=nn(s.check,Se,2,0)),_=0,v=0,s.mode=16182;case 16182:for(;v<32;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.head&&(s.head.time=_),512&$r(s)&&4&s.wrap&&(Se[0]=255&_,Se[1]=_>>>8&255,Se[2]=_>>>16&255,Se[3]=_>>>24&255,s.check=nn(s.check,Se,4,0)),_=0,v=0,s.mode=16183;case 16183:for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.head&&(s.head.xflags=255&_,s.head.os=_>>8),512&$r(s)&&4&s.wrap&&(Se[0]=255&_,Se[1]=_>>>8&255,s.check=nn(s.check,Se,2,0)),_=0,v=0,s.mode=16184;case 16184:if(1024&$r(s)){for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.length=_,s.head&&(s.head.extra_len=_),512&$r(s)&&4&s.wrap&&(Se[0]=255&_,Se[1]=_>>>8&255,s.check=nn(s.check,Se,2,0)),_=0,v=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&$r(s)&&(T=s.length,T>p&&(T=p),T&&(s.head&&(Z=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(d,d+T),Z)),512&$r(s)&&4&s.wrap&&(s.check=nn(s.check,a,T,d)),p-=T,d+=T,s.length-=T),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&$r(s)){if(p===0)break e;T=0;do Z=a[d+T++],s.head&&Z&&s.length<65536&&(s.head.name+=String.fromCharCode(Z));while(Z&&T<p);if(512&$r(s)&&4&s.wrap&&(s.check=nn(s.check,a,T,d)),p-=T,d+=T,Z)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&$r(s)){if(p===0)break e;T=0;do Z=a[d+T++],s.head&&Z&&s.length<65536&&(s.head.comment+=String.fromCharCode(Z));while(Z&&T<p);if(512&$r(s)&&4&s.wrap&&(s.check=nn(s.check,a,T,d)),p-=T,d+=T,Z)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&$r(s)){for(;v<16;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(4&s.wrap&&_!==(65535&s.check)){e.msg="header crc mismatch",s.mode=cr;break}_=0,v=0}s.head&&(s.head.hcrc=$r(s)>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=lc;break;case 16189:for(;v<32;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}e.adler=s.check=d4(_),_=0,v=0,s.mode=KE;case KE:if(s.havedict===0)return e.next_out=h,e.avail_out=f,e.next_in=d,e.avail_in=p,s.hold=_,s.bits=v,cce;e.adler=s.check=1,s.mode=lc;case lc:if(t===ace||t===HE)break e;case dT:if(s.last){_>>>=7&v,v-=7&v,s.mode=hT;break}for(;v<3;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}switch(s.last=1&_,_>>>=1,v-=1,3&_){case 0:s.mode=16193;break;case 1:if(uce(s),s.mode=qE,t===HE){_>>>=2,v-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=cr}_>>>=2,v-=2;break;case 16193:for(_>>>=7&v,v-=7&v;v<32;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",s.mode=cr;break}if(s.length=65535&_,_=0,v=0,s.mode=uT,t===HE)break e;case uT:s.mode=16195;case 16195:if(T=s.length,T){if(T>p&&(T=p),T>f&&(T=f),T===0)break e;c.set(a.subarray(d,d+T),h),p-=T,d+=T,f-=T,h+=T,s.length-=T;break}s.mode=lc;break;case 16196:for(;v<14;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(s.nlen=257+(31&_),_>>>=5,v-=5,s.ndist=1+(31&_),_>>>=5,v-=5,s.ncode=4+(15&_),_>>>=4,v-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=cr;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;v<3;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.lens[bt[s.have++]]=7&_,_>>>=3,v-=3}for(;s.have<19;)s.lens[bt[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,Ae={bits:s.lenbits},de=bf(0,s.lens,0,19,s.lencode,0,s.work,Ae),s.lenbits=Ae.bits,de){e.msg="invalid code lengths set",s.mode=cr;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;xe=s.lencode[_&(1<<s.lenbits)-1],F=xe>>>24,z=xe>>>16&255,Y=65535&xe,!(F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(Y<16)_>>>=F,v-=F,s.lens[s.have++]=Y;else{if(Y===16){for(yt=F+2;v<yt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(_>>>=F,v-=F,s.have===0){e.msg="invalid bit length repeat",s.mode=cr;break}Z=s.lens[s.have-1],T=3+(3&_),_>>>=2,v-=2}else if(Y===17){for(yt=F+3;v<yt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}_>>>=F,v-=F,Z=0,T=3+(7&_),_>>>=3,v-=3}else{for(yt=F+7;v<yt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}_>>>=F,v-=F,Z=0,T=11+(127&_),_>>>=7,v-=7}if(s.have+T>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=cr;break}for(;T--;)s.lens[s.have++]=Z}}if(s.mode===cr)break;if(s.lens[256]===0){e.msg="invalid code -- missing end-of-block",s.mode=cr;break}if(s.lenbits=9,Ae={bits:s.lenbits},de=bf(1,s.lens,0,s.nlen,s.lencode,0,s.work,Ae),s.lenbits=Ae.bits,de){e.msg="invalid literal/lengths set",s.mode=cr;break}if(s.distbits=6,s.distcode=s.distdyn,Ae={bits:s.distbits},de=bf(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,Ae),s.distbits=Ae.bits,de){e.msg="invalid distances set",s.mode=cr;break}if(s.mode=qE,t===HE)break e;case qE:s.mode=YE;case YE:if(p>=6&&f>=258){e.next_out=h,e.avail_out=f,e.next_in=d,e.avail_in=p,s.hold=_,s.bits=v,tce(e,w),h=e.next_out,c=e.output,f=e.avail_out,d=e.next_in,a=e.input,p=e.avail_in,_=s.hold,v=s.bits,s.mode===lc&&(s.back=-1);break}for(s.back=0;xe=s.lencode[_&(1<<s.lenbits)-1],F=xe>>>24,z=xe>>>16&255,Y=65535&xe,!(F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(z&&!(240&z)){for(X=F,re=z,te=Y;xe=s.lencode[te+((_&(1<<X+re)-1)>>X)],F=xe>>>24,z=xe>>>16&255,Y=65535&xe,!(X+F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}_>>>=X,v-=X,s.back+=X}if(_>>>=F,v-=F,s.back+=F,s.length=Y,z===0){s.mode=16205;break}if(32&z){s.back=-1,s.mode=lc;break}if(64&z){e.msg="invalid literal/length code",s.mode=cr;break}s.extra=15&z,s.mode=16201;case 16201:if(s.extra){for(yt=s.extra;v<yt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.length+=_&(1<<s.extra)-1,_>>>=s.extra,v-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;xe=s.distcode[_&(1<<s.distbits)-1],F=xe>>>24,z=xe>>>16&255,Y=65535&xe,!(F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(!(240&z)){for(X=F,re=z,te=Y;xe=s.distcode[te+((_&(1<<X+re)-1)>>X)],F=xe>>>24,z=xe>>>16&255,Y=65535&xe,!(X+F<=v);){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}_>>>=X,v-=X,s.back+=X}if(_>>>=F,v-=F,s.back+=F,64&z){e.msg="invalid distance code",s.mode=cr;break}s.offset=Y,s.extra=15&z,s.mode=16203;case 16203:if(s.extra){for(yt=s.extra;v<yt;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}s.offset+=_&(1<<s.extra)-1,_>>>=s.extra,v-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=cr;break}s.mode=16204;case 16204:if(f===0)break e;if(T=w-f,s.offset>T){if(T=s.offset-T,T>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=cr;break}T>s.wnext?(T-=s.wnext,U=s.wsize-T):U=s.wnext-T,T>s.length&&(T=s.length),k=s.window}else k=c,U=h-s.offset,T=s.length;T>f&&(T=f),f-=T,s.length-=T;do c[h++]=k[U++];while(--T);s.length===0&&(s.mode=YE);break;case 16205:if(f===0)break e;c[h++]=s.length,f--,s.mode=YE;break;case hT:if(s.wrap){for(;v<32;){if(p===0)break e;p--,_|=a[d++]<<v,v+=8}if(w-=f,e.total_out+=w,s.total+=w,4&s.wrap&&w&&(e.adler=s.check=$r(s)?nn(s.check,c,w,h-w):mf(s.check,c,w,h-w)),w=f,4&s.wrap&&($r(s)?_:d4(_))!==s.check){e.msg="incorrect data check",s.mode=cr;break}_=0,v=0}s.mode=16207;case 16207:if(s.wrap&&$r(s)){for(;v<32;){if(p===0)break e;p--,_+=a[d++]<<v,v+=8}if(4&s.wrap&&_!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=cr;break}_=0,v=0}s.mode=16208;case 16208:de=oce;break e;case cr:de=o4;break e;case 16210:return c4;default:return da}return e.next_out=h,e.avail_out=f,e.next_in=d,e.avail_in=p,s.hold=_,s.bits=v,(s.wsize||w!==e.avail_out&&s.mode<cr&&(s.mode<hT||t!==a4))&&g4(e,e.output,e.next_out,w-e.avail_out),b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,s.total+=w,4&s.wrap&&w&&(e.adler=s.check=$r(s)?nn(s.check,c,w,e.next_out-w):mf(s.check,c,w,e.next_out-w)),e.data_type=s.bits+(s.last?64:0)+(s.mode===lc?128:0)+(s.mode===qE||s.mode===uT?256:0),(b===0&&w===0||t===a4)&&de===Td&&(de=lce),de},dc={inflateReset:h4,inflateReset2:p4,inflateResetKeep:u4,inflateInit:e=>m4(e,15),inflateInit2:m4,inflate:hce,inflateEnd:e=>{if(Nd(e))return da;let t=e.state;return t.window&&(t.window=null),e.state=null,Td},inflateGetHeader:(e,t)=>{if(Nd(e))return da;let s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,Td):da},inflateSetDictionary:(e,t)=>{let s=t.length,a,c,d;return Nd(e)?da:(a=e.state,a.wrap!==0&&a.mode!==KE?da:a.mode===KE&&(c=1,c=mf(c,t,s,0),c!==a.check)?o4:(d=g4(e,t,s,s),d?(a.mode=16210,c4):(a.havedict=1,Td)))},inflateInfo:"pako inflate (from Nodeca project)"},pce=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let _4=Object.prototype.toString,{Z_NO_FLUSH:mce,Z_FINISH:fce,Z_OK:wf,Z_STREAM_END:fT,Z_NEED_DICT:gT,Z_STREAM_ERROR:gce,Z_DATA_ERROR:v4,Z_MEM_ERROR:_ce}=LE;function $E(e){this.options=UE.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n4,this.strm.avail_out=0;let s=dc.inflateInit2(this.strm,t.windowBits);if(s!==wf)throw new Error(bd[s]);if(this.header=new pce,dc.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=xf.string2buf(t.dictionary):_4.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=dc.inflateSetDictionary(this.strm,t.dictionary),s!==wf)))throw new Error(bd[s])}function vce(e,t){let s=new $E(t);if(s.push(e),s.err)throw s.msg||bd[s.err];return s.result}$E.prototype.push=function(e,t){let s=this.strm,a=this.options.chunkSize,c=this.options.dictionary,d,h,p;if(this.ended)return!1;for(h=t===~~t?t:t===!0?fce:mce,_4.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),d=dc.inflate(s,h),d===gT&&c&&(d=dc.inflateSetDictionary(s,c),d===wf?d=dc.inflate(s,h):d===v4&&(d=gT));s.avail_in>0&&d===fT&&s.state.wrap>0&&e[s.next_in]!==0;)dc.inflateReset(s),d=dc.inflate(s,h);switch(d){case gce:case v4:case gT:case _ce:return this.onEnd(d),this.ended=!0,!1}if(p=s.avail_out,s.next_out&&(s.avail_out===0||d===fT))if(this.options.to==="string"){let f=xf.utf8border(s.output,s.next_out),_=s.next_out-f,v=xf.buf2string(s.output,f);s.next_out=_,s.avail_out=a-_,_&&s.output.set(s.output.subarray(f,f+_),0),this.onData(v)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==wf||p!==0){if(d===fT)return d=dc.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},$E.prototype.onData=function(e){this.chunks.push(e)},$E.prototype.onEnd=function(e){e===wf&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=UE.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ece={inflate:vce};let{deflate:yce}=ece,{inflate:xce}=Ece;var bce=yce,wce=xce,E4=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(E4||{});class Sce{constructor(){B(this,"_sequence",0),B(this,"_startTime",Date.now()),B(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let p=new Uint8Array(4);p.set([1,0,0,0]);let f={id:0,length:4,data:p.buffer},_={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[f]};s.commonPacketHeader.extension=1,s.extension=_,s.payload=this.compress(t),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;$("SHOW_DATASTREAM2_LOG")&&A.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));let a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a),h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){let p=this.serializeExtension(s.extension);c.set(new Uint8Array(p),h),h+=p.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let s=new DataView(t),a=0,c=s.getUint16(a,!0);a+=2;let d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)},h,p;if(a+=4,$("SHOW_DATASTREAM2_LOG")&&A.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(a,!0),a+=2,d.extension){p=this.deserializeExtension(t.slice(a)),a+=2+p.length,h=t.slice(a);let f=!1;if(p.datas.length>0){let _=p.datas.find(v=>v.id===0);_&&(f=(1&new DataView(_.data).getUint32(0,!0))==1)}h=f?this.decompress(h):h}else h=t.slice(8);return h}serializeExtension(t){let{profile:s,length:a,datas:c}=t,d=new ArrayBuffer(a+2),h=new Uint8Array(d),p=new DataView(d),f=0;if(p.setUint8(f++,s),p.setUint8(f++,a),c.forEach(_=>{s?(p.setUint8(f++,_.id),p.setUint8(f++,_.length),h.set(new Uint8Array(_.data),f),f+=_.data.byteLength):(p.setUint8(f++,_.id|_.length<<4),h.set(new Uint8Array(_.data),f),f+=_.data.byteLength)}),f!==a+2)throw Error("serialize extension error, is ".concat(f,"!==").concat(a+2));return d}deserializeExtension(t){let s=new DataView(t),a=0,c=s.getUint8(a);a++;let d=s.getUint8(a);a++;let h=c===E4.TWO_BYTE,p=[],f=new DataView(t,2),_=0;for(;_<d;){let v=0,b=0,w=new ArrayBuffer(0);h?(v=f.getUint8(_),_++,b=f.getUint8(_),_++):(v=15&f.getUint8(_),b=f.getUint8(_)>>4,_++),b>0&&(w=f.buffer.slice(_+2,_+2+b),_+=w.byteLength),p.push({id:v,length:b,data:w})}if(_!==d)throw Error("parse error");return{profile:c,length:d,datas:p}}decompress(t){return wce(new Uint8Array(t))}compress(t){return bce(new Uint8Array(t))}}let Cce={name:"DataStream",create:(e,t)=>{let s=t?new Oie(e):new jie(e);return s.useDataStream(new Sce),s}};class Tce extends bs{constructor(t,s,a){super(),B(this,"ws",void 0),B(this,"requestId",1),B(this,"heartBeatTimer",void 0),B(this,"joinInfo",void 0),B(this,"clientId",void 0),B(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),B(this,"onClose",c=>{this.emit("close"),this.dispose()}),B(this,"onMessage",c=>{let d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=t,this.clientId=s,this.ws=new Ym("cross-channel-".concat(this.clientId),a),this.ws.on(_t.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(_t.CONNECTED,this.onOpen),this.ws.on(_t.ON_MESSAGE,this.onMessage),this.ws.on(_t.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let s=this.requestId++;return t.requestId=s,t.seq=s,this.ws.sendMessage(t),s}waitStatus(t){return new Ve((s,a)=>{let c=window.setTimeout(()=>{a(new ue(K.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new ue(K.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new ue(K.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ue(K.WS_DISCONNECT);let s=()=>new Ve((h,p)=>{this.ws.once(_t.CLOSED,()=>p(new ue(K.WS_ABORT))),this.ws.once(_t.CONNECTED,h)});this.ws.state!=="connected"&&await s();let a=this.sendMessage(t),c=new Ve((h,p)=>{let f=()=>{p(new ue(K.WS_ABORT))};this.ws.once(_t.RECONNECTING,f),this.ws.once(_t.CLOSED,f),this.once("req_".concat(a),h),pr(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(_t.RECONNECTING,f),this.ws.off(_t.CLOSED,f),p(new ue(K.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new ue(K.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(t){this.ws.removeAllListeners(_t.REQUEST_NEW_URLS),this.ws.on(_t.REQUEST_NEW_URLS,s=>{s(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let s=this.requestId++;return t.requestId=s,this.ws.sendMessage(t),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Nce extends bs{set state(t){t!==this._state&&(t!==wn.RELAY_STATE_FAILURE&&(this.errorCode=gh.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,s,a,c,d){super(),B(this,"joinInfo",void 0),B(this,"sid",void 0),B(this,"clientId",void 0),B(this,"cancelToken",dn.CancelToken.source()),B(this,"workerToken",void 0),B(this,"requestId",0),B(this,"signal",void 0),B(this,"prevChannelMediaConfig",void 0),B(this,"httpRetryConfig",void 0),B(this,"_resolution",void 0),B(this,"_state",wn.RELAY_STATE_IDLE),B(this,"errorCode",gh.RELAY_OK),B(this,"onStatus",h=>{A.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",nc.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",nc.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=gh.SRC_TOKEN_EXPIRED,this.state=wn.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=gh.DEST_TOKEN_EXPIRED,this.state=wn.RELAY_STATE_FAILURE))}),B(this,"onReconnect",async()=>{A.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",nc.NETWORK_DISCONNECTED),this.state=wn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==wn.RELAY_STATE_IDLE&&(A.error("auto restart channel media relay failed",h.toString()),this.errorCode=gh.SERVER_CONNECTION_LOST,this.state=wn.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=s,this.sid=cd(),this.signal=new Tce(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(t){if(this.state!==wn.RELAY_STATE_IDLE)throw new ue(K.INVALID_OPERATION);this.state=wn.RELAY_STATE_CONNECTING,await this.connect(),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new ue(K.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new ue(K.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new ue(K.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==wn.RELAY_STATE_RUNNING)throw new ue(K.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==wn.RELAY_STATE_RUNNING)throw new ue(K.INVALID_OPERATION);let s=this.genMessage(rn.SetVideoProfile);await this.signal.request(s),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),A.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=wn.RELAY_STATE_IDLE,this.dispose()}dispose(){A.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=dn.CancelToken.source(),this.state=wn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await Fae(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",nc.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let s=this.genMessage(rn.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let a=this.genMessage(rn.SetSdkProfile,t);await this.signal.request(a),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let c=this.genMessage(rn.SetSourceChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",nc.PACKET_JOINED_SRC_CHANNEL),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let d=this.genMessage(rn.SetSourceUserId,t);await this.signal.request(d),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let h=this.genMessage(rn.SetDestChannel,t);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",nc.PACKET_JOINED_DEST_CHANNEL),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let p=this.genMessage(rn.StartPacketTransfer,t);await this.signal.request(p),this.emit("event",nc.PACKET_SENT_TO_DEST_CHANNEL),this.state=wn.RELAY_STATE_RUNNING,A.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let s=this.genMessage(rn.UpdateDestChannel,t);await this.signal.request(s),this.emit("event",nc.PACKET_UPDATE_DEST_CHANNEL),A.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(rn.StopPacketTransfer);await this.signal.request(t),A.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,s){let a=[],c=[],d=[];this.requestId+=1;let h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Si,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let p=null,f=null;switch(t){case rn.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case rn.SetSourceChannel:if(f=s&&s.getSrcChannelMediaInfo(),!f)throw new ue(K.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:f.channelName,token:f.token||this.joinInfo.appId},h;case rn.SetSourceUserId:if(f=s&&s.getSrcChannelMediaInfo(),!f)throw new ue(K.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:f.uid+""},h;case rn.SetDestChannel:if(p=s&&s.getDestChannelMediaInfo(),!p)throw new ue(K.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{a.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case rn.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case rn.Reconnect:return h.clientRequest={command:"Reconnect"},h;case rn.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case rn.UpdateDestChannel:if(p=s&&s.getDestChannelMediaInfo(),!p)throw new ue(K.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{a.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case rn.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}let Rce={name:"ChannelMediaRelay",create:function(e){return new Nce(e.joinInfo,e.clientId,e.websocketRetryConfig||Hs,e.httpRetryConfig||Hs,e.resolution)}};function y4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Sf(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?y4(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):y4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class Ace extends bs{constructor(t,s,a,c){super(),B(this,"spec",void 0),B(this,"token",void 0),B(this,"websocket",void 0),B(this,"pingpongTimer",void 0),B(this,"reconnectMode","retry"),B(this,"serviceMode",void 0),B(this,"reqId",0),B(this,"commandReqId",0),B(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),B(this,"handleWebSocketMessage",d=>{if(!d.data)return;let h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Qe.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===rc.TRANSCODE?1:2}),this.emit(Gc.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=t,this.serviceMode=c,this.websocket=new Ym("live-streaming",a),this.websocket.on(_t.CONNECTED,this.handleWebSocketOpen),this.websocket.on(_t.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(_t.REQUEST_NEW_URLS,(d,h)=>{Cr(this,Gc.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(_t.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,s,a,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new ue(K.UNEXPECTED_ERROR);let p=Sf({command:t,sdkVersion:Si==="4.24.0"?"0.0.1":Si,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new ue(K.WS_DISCONNECT);let f=()=>new Ve((w,T)=>{this.websocket.once(_t.CLOSED,()=>T(new ue(K.WS_ABORT))),this.websocket.once(_t.CONNECTED,w)});this.websocket.state!=="connected"&&await f(),p.clientRequest&&(p.clientRequest.workerToken=this.token);let _=new Ve((w,T)=>{let U=()=>{T(new ue(K.WS_ABORT))};this.websocket.once(_t.RECONNECTING,U),this.websocket.once(_t.CLOSED,U),this.once("@".concat(h,"-").concat(this.spec.sid),k=>{w(k)})});c&&Qe.workerEvent(this.spec.sid,Sf(Sf({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));let v=Date.now();this.websocket.sendMessage(p);let b=null;try{b=await _}catch(w){if(this.websocket.state==="closed")throw w;return await f(),await this.request(t,s,a)}return c&&Qe.workerEvent(this.spec.sid,Sf(Sf({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:b.code===200,responseTime:Date.now()-v})),b.code!==200&&this.handleResponseError(b),b}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Si==="4.24.0"?"0.0.1":Si;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case $s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void A.warning("live stream response already exists stream");case $s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case $s.LIVE_STREAM_RESPONSE_BAD_STREAM:case $s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ue(K.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case $s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ue(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case $s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ue(K.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case $s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let s=new ue(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Gc.WARNING,s,t.serverResponse.url)}case $s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let s=new ue(K.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Gc.WARNING,s,t.serverResponse.url)}case $s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ue(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case $s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ue(K.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case $s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let s=new ue(K.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Gc.WARNING,s,t.serverResponse.url)}case $s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ue(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case $s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ue(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case $s.LIVE_STREAM_RESPONSE_WORKER_LOST:case $s.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ue(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case $s.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ue(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ue(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case $s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case $s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case $s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case $s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ue(K.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Pv)},6e3)}}function x4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function Sn(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?x4(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):x4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class Ice extends bs{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hs,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Hs;super(),B(this,"onLiveStreamWarning",void 0),B(this,"onLiveStreamError",void 0),B(this,"spec",void 0),B(this,"retryTimeout",1e4),B(this,"connection",void 0),B(this,"httpRetryConfig",void 0),B(this,"wsRetryConfig",void 0),B(this,"streamingTasks",new Map),B(this,"isStartingStreamingTask",!1),B(this,"taskMutex",new Dr("live-streaming")),B(this,"cancelToken",dn.CancelToken.source()),B(this,"transcodingConfig",void 0),B(this,"uapResponse",void 0),B(this,"lastTaskId",1),B(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(t){let s=Sn(Sn({},gae),t);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(A.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Sn(Sn(Sn({},fae),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Ts(h.width)||Qt(h.width,"config.width",0,1e4),Ts(h.height)||Qt(h.height,"config.height",0,1e4),Ts(h.videoBitrate)||Qt(h.videoBitrate,"config.videoBitrate",1,1e6),Ts(h.videoFrameRate)||Qt(h.videoFrameRate,"config.videoFrameRate"),Ts(h.lowLatency)||ka(h.lowLatency,"config.lowLatency"),Ts(h.audioSampleRate)||Qs(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ts(h.audioBitrate)||Qt(h.audioBitrate,"config.audioBitrate",1,128),Ts(h.audioChannels)||Qs(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ts(h.videoGop)||Qt(h.videoGop,"config.videoGop"),Ts(h.videoCodecProfile)||Qs(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ts(h.userCount)||Qt(h.userCount,"config.userCount",0,17),Ts(h.backgroundColor)||Qt(h.backgroundColor,"config.backgroundColor",0,16777215),Ts(h.userConfigExtraInfo)||hr(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Ts(h.transcodingUsers)&&(sc(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((p,f)=>{nE(p.uid),Ts(p.x)||Qt(p.x,"transcodingUser[".concat(f,"].x"),0,1e4),Ts(p.y)||Qt(p.y,"transcodingUser[".concat(f,"].y"),0,1e4),Ts(p.width)||Qt(p.width,"transcodingUser[".concat(f,"].width"),0,1e4),Ts(p.height)||Qt(p.height,"transcodingUser[".concat(f,"].height"),0,1e4),Ts(p.zOrder)||Qt(p.zOrder-1,"transcodingUser[".concat(f,"].zOrder"),0,100),Ts(p.alpha)||Qt(p.alpha,"transcodingUser[".concat(f,"].alpha"),0,1,!1)})),Ts(h.watermark)||fC(h.watermark,"watermark"),Ts(h.backgroundImage)||fC(h.backgroundImage,"backgroundImage"),h.images&&!Ts(h.images)&&(sc(h.images,"config.images"),h.images.forEach((p,f)=>{fC(p,"images[".concat(f,"]"))}))}(s);let a=[];s.images&&a.push(...s.images.map(h=>Sn(Sn(Sn({},mC),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(Sn(Sn(Sn({},mC),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(Sn(Sn(Sn({},mC),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Sn({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);let c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?Ve.resolve(h.uid):qU(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ve.all(c)).forEach((h,p)=>{s.userConfigs&&s.userConfigs[p]&&(s.userConfigs[p].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;let h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Mn(d=this.streamingTasks).call(d)).map(p=>p.taskId).join("#")});A.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(p=>{A.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,h).then(()=>{A.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(p.url," success"))}).catch(f=>{A.error("[".concat(this.spec.clientId,"] live streaming republish failed"),p.url,f.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,f)})})}}async startLiveStreamingTask(t,s,a){if(!this.transcodingConfig&&s===rc.TRANSCODE)throw new ue(K.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};A.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(s));let d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(t)&&!a)return d(),new ue(K.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(p){throw d(),p}switch(s){case rc.TRANSCODE:c.transcodingConfig=Sn({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let h=this.lastTaskId++;try{let p=new Ve((_,v)=>{pr(this.retryTimeout).then(()=>{if(a)return v(a);let b=this.statusError.get(t);return b?(this.statusError.delete(t),v(b)):void 0})}),f=await Ve.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:s===rc.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),p]);this.isStartingStreamingTask=!1,A.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(t,{clientRequest:c,mode:s,url:t,taskId:h}),d()}catch(p){if(d(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||a)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,s,p)):await this.startLiveStreamingTask(t,s,p)}}stopLiveStreamingTask(t){return new Ve((s,a)=>{let c=this.streamingTasks.get(t);if(!c||!this.connection)return new ue(K.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let d=c.mode;c.abortTask=()=>{A.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:d===rc.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{A.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(a)})}resetAllTask(){var t;let s=Array.from(Mn(t=this.streamingTasks).call(t));this.terminate();for(let a of s)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=dn.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ue(K.UNEXPECTED_ERROR,"live streaming connection has already connected");let s=await Cr(this,gC.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=s,this.connection=new Ace(s.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Gc.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(Gc.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(Gc.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new ue(K.UNEXPECTED_ERROR,"can not get new live streaming address list"));Cr(this,gC.REQUEST_WORKER_MANAGER_LIST,t).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(t){let s=t.serverStatus&&t.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=t.reason;switch(t.code){case $s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case $s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case $s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case $s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let h=new ue(K.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(a)return A.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case $s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let h=new ue(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case $s.LIVE_STREAM_RESPONSE_WORKER_LOST:case $s.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();let h=Array.from(Mn(d=this.streamingTasks).call(d));for(let p of h)p.abortTask?p.abortTask():(A.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new ue(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{A.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(f=>{A.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,f)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let Dce={name:"LiveStreaming",create:function(e){return new Ice(e.joinInfo,e.websocketRetryConfig||Hs,e.httpRetryConfig||Hs)}};function Oce(e){let t=S4();return function(s,a){let c=s.appId;c!==void 0&&(Yt(a,10),Do(a,c));let d=s.cid;d!==void 0&&(Yt(a,16),Yt(a,d));let h=s.cname;h!==void 0&&(Yt(a,26),Do(a,h));let p=s.deviceId;p!==void 0&&(Yt(a,34),Do(a,p));let f=s.elapse;f!==void 0&&(Yt(a,40),il(a,f));let _=s.fileSize;_!==void 0&&(Yt(a,48),il(a,jh(_)));let v=s.height;v!==void 0&&(Yt(a,56),il(a,jh(v)));let b=s.jpg;b!==void 0&&(Yt(a,66),Yt(a,b.length),function(Lr,we){let Pe=Ph(Lr,we.length);Lr.bytes.set(we,Pe)}(a,b));let w=s.networkType;w!==void 0&&(Yt(a,72),il(a,jh(w)));let T=s.osType;T!==void 0&&(Yt(a,80),il(a,jh(T)));let U=s.requestId;U!==void 0&&(Yt(a,90),Do(a,U));let k=s.sdkVersion;k!==void 0&&(Yt(a,98),Do(a,k));let F=s.sequence;F!==void 0&&(Yt(a,104),il(a,jh(F)));let z=s.sid;z!==void 0&&(Yt(a,114),Do(a,z));let Y=s.timestamp;Y!==void 0&&(Yt(a,120),il(a,Y));let X=s.uid;X!==void 0&&(Yt(a,128),Yt(a,X));let re=s.vid;re!==void 0&&(Yt(a,136),Yt(a,re));let te=s.width;te!==void 0&&(Yt(a,144),il(a,jh(te)));let Z=s.service;Z!==void 0&&(Yt(a,152),Yt(a,Z));let de=s.callbackData;de!==void 0&&(Yt(a,162),Do(a,de));let xe=s.jpgEncryption;xe!==void 0&&(Yt(a,168),Yt(a,xe));let Se=s.requestType;Se!==void 0&&(Yt(a,176),Yt(a,Se));let Ae=s.scorePorn;Ae!==void 0&&(Yt(a,185),xT(a,Ae));let yt=s.scoreSexy;yt!==void 0&&(Yt(a,193),xT(a,yt));let bt=s.scoreNeutral;bt!==void 0&&(Yt(a,201),xT(a,bt));let dt=s.scene;dt!==void 0&&(Yt(a,208),Yt(a,dt));let Wt=s.ossFilePrefix;Wt!==void 0&&(Yt(a,218),Do(a,Wt));let Ut=s.serviceVendor;if(Ut!==void 0)for(let Lr of Ut){Yt(a,226);let we=S4();kce(Lr,we),Yt(a,we.limit),Uce(a,we),Fce(we)}}(e,t),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(t)}function jce(e){return function(s){let a={};e:for(;!C4(s);){let c=Oo(s);switch(c>>>3){case 0:break e;case 1:a.code=Oo(s);break;case 2:a.msg=T4(s,Oo(s));break;case 3:{let d=Lce(s);a.data=Pce(s),s.limit=d;break}default:b4(s,7&c)}}return a}({bytes:t=e,offset:0,limit:t.length});var t}function Pce(e){let t={};e:for(;!C4(e);){let s=Oo(e);switch(s>>>3){case 0:break e;case 1:t.requestId=T4(e,Oo(e));break;case 2:t.requestType=Oo(e)>>>0;break;case 3:t.scorePorn=yT(e);break;case 4:t.scoreSexy=yT(e);break;case 5:t.scoreNeutral=yT(e);break;case 6:t.requestScene=Oo(e)>>>0;break;case 7:t.scene=Oo(e)>>>0;break;default:b4(e,7&s)}}return t}function kce(e,t){let s=e.service;s!==void 0&&(Yt(t,8),Yt(t,s));let a=e.vendor;a!==void 0&&(Yt(t,16),Yt(t,a));let c=e.token;c!==void 0&&(Yt(t,26),Do(t,c));let d=e.callbackUrl;d!==void 0&&(Yt(t,34),Do(t,d))}function Lce(e){let t=Oo(e),s=e.limit;return e.limit=e.offset+t,s}function b4(e,t){switch(t){case 0:for(;128&N4(e););break;case 2:vT(e,Oo(e));break;case 5:vT(e,4);break;case 1:vT(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Mce=new Float32Array(1);new Uint8Array(Mce.buffer);let _T=new Float64Array(1),Cn=new Uint8Array(_T.buffer);function jh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let w4=[];function S4(){let e=w4.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Fce(e){w4.push(e)}function vT(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function C4(e){return e.offset>=e.limit}function Ph(e,t){let s=e.bytes,a=e.offset,c=e.limit,d=a+t;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),a}function ET(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function T4(e,t){let s=ET(e,t),a=String.fromCharCode,c=e.bytes,d="",h="";for(let p=0;p<t;p++){let f,_,v,b,w=c[p+s];128&w?(224&w)==192?p+1>=t?h+=d:(f=c[p+s+1],(192&f)!=128?h+=d:(b=(31&w)<<6|63&f,b<128?h+=d:(h+=a(b),p++))):(240&w)==224?p+2>=t?h+=d:(f=c[p+s+1],_=c[p+s+2],(49344&(f|_<<8))!=32896?h+=d:(b=(15&w)<<12|(63&f)<<6|63&_,b<2048||b>=55296&&b<=57343?h+=d:(h+=a(b),p+=2))):(248&w)==240?p+3>=t?h+=d:(f=c[p+s+1],_=c[p+s+2],v=c[p+s+3],(12632256&(f|_<<8|v<<16))!=8421504?h+=d:(b=(7&w)<<18|(63&f)<<12|(63&_)<<6|63&v,b<65536||b>1114111?h+=d:(b-=65536,h+=a(55296+(b>>10),56320+(1023&b)),p+=3))):h+=d:h+=a(w)}return h}function Do(e,t){let s=t.length,a=0;for(let h=0;h<s;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<s&&(p=(p<<10)+t.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Yt(e,a);let c=Ph(e,a),d=e.bytes;for(let h=0;h<s;h++){let p=t.charCodeAt(h);p>=55296&&p<=56319&&h+1<s&&(p=(p<<10)+t.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function Uce(e,t){let s=Ph(e,t.limit),a=e.bytes,c=t.bytes;for(let d=0,h=t.limit;d<h;d++)a[d+s]=c[d]}function N4(e){return e.bytes[ET(e,1)]}function R4(e,t){let s=Ph(e,1);e.bytes[s]=t}function yT(e){let t=ET(e,8),s=e.bytes;return Cn[0]=s[t++],Cn[1]=s[t++],Cn[2]=s[t++],Cn[3]=s[t++],Cn[4]=s[t++],Cn[5]=s[t++],Cn[6]=s[t++],Cn[7]=s[t++],_T[0]}function xT(e,t){let s=Ph(e,8),a=e.bytes;_T[0]=t,a[s++]=Cn[0],a[s++]=Cn[1],a[s++]=Cn[2],a[s++]=Cn[3],a[s++]=Cn[4],a[s++]=Cn[5],a[s++]=Cn[6],a[s++]=Cn[7]}function Oo(e){let t,s=0,a=0;do t=N4(e),s<32&&(a|=(127&t)<<s),s+=7;while(128&t);return a}function Yt(e,t){for(t>>>=0;t>=128;)R4(e,127&t|128),t>>>=7;R4(e,t)}function il(e,t){let s=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=Ph(e,d),p=e.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=d!==9?128|c:127&c;case 8:p[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:p[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:p[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:p[h+4]=d!==5?128|a:127&a;case 4:p[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:p[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:p[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:p[h]=d!==1?128|s:127&s}}function A4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}let Vce=new Map([["moderation",1],["supervise",2]]);class Bce extends bs{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let s=this._connectionState;this._connectionState=t,this.emit(or.CONNECTION_STATE_CHANGE,s,t)}get inspectType(){return this._inspectType}set inspectType(t){var s;this._inspectMode=Ki(s=t.map(a=>Vce.get(a)||0)).call(s,(a,c)=>a+c),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),B(this,"name","AgoraRTCVideoContentInspect"),B(this,"_connectionState",na.CONNECTING),B(this,"_innerConnectionState",void 0),B(this,"sequence",0),B(this,"inspectStartTime",void 0),B(this,"workerManagerConnection",void 0),B(this,"workerConnection",void 0),B(this,"workerMessageLengthLimit",void 0),B(this,"inspectIntervalMinimum",void 0),B(this,"qualityRatio",void 0),B(this,"_connectInfo",void 0),B(this,"_cancelTokenSource",dn.CancelToken.source()),B(this,"_retryConfig",void 0),B(this,"wmSequence",0),B(this,"inspectInterval",void 0),B(this,"inspectTimer",null),B(this,"ossFilePrefix",void 0),B(this,"extraInfo",void 0),B(this,"_inspectType",void 0),B(this,"_inspectMode",void 0),B(this,"_quality",1),B(this,"qualityTimer",null),B(this,"_inspectId",void 0),B(this,"_needWorkUrlOnly",!1),B(this,"inspectImage",()=>{if(this.connectionState!==na.CONNECTED)throw new ue(K.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===na.CONNECTED?this.requestToInspectImage():A.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ts(5,"inspect-"),this.workerMessageLengthLimit=$("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=$("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=$("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ym("worker-manager-"+this._inspectId,Hs),this.on(or.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,A.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ia[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ym("worker-"+this._inspectId,Hs),this.handleWorkerEvents()}async init(t,s){this.emit(or.STATE_CHANGE,ia.CONNECT_AP),this._connectInfo=t;let a=this._cancelTokenSource.token;return this._retryConfig=s,new Ve((c,d)=>{this.on(or.CONNECTION_STATE_CHANGE,(h,p)=>{p===na.CONNECTED&&c()}),this.requestAP(t,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(t,s,a){let c=$("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),d=await function(p,f,_,v){let{appId:b,areaCode:w,cname:T,sid:U,token:k,uid:F}=f;wh++;let z="image_moderation_api",Y={service_name:z,json_body:JSON.stringify({appId:b,areaCode:w,cname:T,command:"allocateEdge",requestId:wh,seq:wh,sid:U,token:k,ts:Date.now(),uid:F+""})},X,re,te=p[0];return La(async()=>{X=Date.now();let Z=await Ba(te,{data:Y,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(re=Date.now()-X,Z.code!==0){let Ae=new ue(K.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Z.code,{retry:!0,responseTime:re});throw A.error(Ae.toString()),Ae}let de=JSON.parse(Z.json_body);if(de.code!==200){let Ae=new ue(K.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(de.code,", reason: ").concat(de.reason),{code:de.code,responseTime:re});throw A.error(Ae.toString()),Ae}if(!de.servers||!Array.isArray(de.servers)||de.servers.length===0){let Ae=new ue(K.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:de.code,responseTime:re});throw A.error(Ae.toString()),Ae}let xe=$("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Se=$("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:de.servers.map(Ae=>{let{address:yt,wss:bt}=Ae;if(yt&&bt)return"wss://".concat(yt.replace(/\./g,"-"),".").concat(xe,":").concat(Se||bt)}).filter(Ae=>!!Ae),workerToken:de.workerToken,vid:de.vid,responseTime:re}},(Z,de)=>(Qe.apworkerEvent(U,{success:!0,sc:200,serviceName:z,responseDetail:JSON.stringify(Z.addressList),firstSuccess:de===0,responseTime:re,serverIp:p[de%p.length]}),!1),(Z,de)=>(Qe.apworkerEvent(U,{success:!1,sc:Z.data&&Z.data.code||200,serviceName:z,responseTime:re,serverIp:p[de%p.length]}),!!(Z.code!==K.OPERATION_ABORTED&&Z.code!==K.UNEXPECTED_RESPONSE||Z.data&&Z.data.retry)&&(te=p[(de+1)%p.length],!0)),v)}(c,t,s,a);this.emit(or.STATE_CHANGE,ia.AP_CONNECTED);let{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(t){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(or.STATE_CHANGE,ia.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(_t.CONNECTED,async()=>{this.emit(or.STATE_CHANGE,ia.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(_t.CLOSED,()=>{this._innerConnectionState<ia.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(_t.FAILED,()=>{this._innerConnectionState<ia.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(_t.RECONNECTING,()=>{this._innerConnectionState<ia.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(_t.ON_MESSAGE,async t=>{this.emit(or.STATE_CHANGE,ia.GET_WORKER_MANAGER_RESPONSE);let s=this.workerManagerConnection.url;this.workerManagerConnection.close();let a=JSON.parse(t.data);if(a.code!==200)throw A.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new ue(K.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw A.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new ue(K.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{let c=$("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(or.STATE_CHANGE,ia.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(or.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(_t.WILL_RECONNECT,(t,s,a)=>{a(t)}),this.workerManagerConnection.on(_t.REQUEST_NEW_URLS,(t,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(s)})}handleWorkerEvents(){this.workerConnection.on(_t.CONNECTED,async()=>{this.emit(or.STATE_CHANGE,ia.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=na.CONNECTED}),this.workerConnection.on(_t.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let a=jce(new Uint8Array(t.data));if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&A.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(or.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;let c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=Ki(s=Object.keys(c)).call(s,(p,f)=>c[p]>c[f]?p:f,"porn"),h=Object.keys(c).find(p=>p===d);this.emit(or.INSPECT_RESULT,h)}else this.emit(or.INSPECT_RESULT,void 0,new ue(K.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(or.INSPECT_RESULT,void 0,new ue(K.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else A.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(or.INSPECT_RESULT,void 0,new ue(K.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(_t.CLOSED,()=>{this.connectionState=na.CLOSED}),this.workerConnection.on(_t.FAILED,()=>{this.connectionState=na.CLOSED}),this.workerConnection.on(_t.RECONNECTING,()=>{this.connectionState=this.connectionState===na.CONNECTED?na.RECONNECTING:na.CONNECTING}),this.workerConnection.on(_t.WILL_RECONNECT,(t,s,a)=>{t==="recover"&&a(t),a("tryNext")}),this.workerConnection.on(_t.REQUEST_NEW_URLS,(t,s)=>{this.workerManagerConnection.close(),this.once(or.REQUEST_NEW_WORKER_URL,a=>{t([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}async requestToInspectImage(){this.sequence++;let t=ri(this,or.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(or.INSPECT_RESULT,void 0,new ue(K.INVALID_OPERATION,"Only the track being played can be inspected"));let a=await this.generateRequestData(t,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(or.INSPECT_RESULT,void 0,new ue(K.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,s){let{appId:a,cname:c,cid:d,vid:h,sid:p,uid:f}=s,_=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),b=await dM(v,a,c),w=this.sequence+"-"+d+"-"+f+"-"+_+"-"+ts(12,""),T={appId:a,cid:d,cname:c,deviceId:"",elapse:(U=Number(_-this.inspectStartTime),{low:U|=0,high:U>>31,unsigned:U>=0}),fileSize:b.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:b,networkType:6,osType:7,requestId:w,sdkVersion:"4.24.0",sequence:this.sequence,sid:p,timestamp:M5(_),uid:f,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var U;this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;let k=Oce(T);if(k.byteLength<this.workerMessageLengthLimit){if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let F=function(z){for(var Y=1;Y<arguments.length;Y++){var X=arguments[Y]!=null?arguments[Y]:{};Y%2?A4(Object(X),!0).forEach(function(re){B(z,re,X[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(X)):A4(Object(X)).forEach(function(re){Object.defineProperty(z,re,Object.getOwnPropertyDescriptor(X,re))})}return z}({},T);delete F.jpg,A.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(F))}return k}{let F=this.quality*this.qualityRatio;return this.quality=F,await this.generateRequestData(t,{appId:a,cname:c,cid:d,vid:h,sid:p,uid:f})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=dn.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=na.CLOSED,this.emit(or.STATE_CHANGE,ia.CLOSED)}}let Wce={name:"ContentInspect",create:function(e){let{config:t}=e;return function(s){if(!s)throw new ue(K.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new ue(K.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let a=[...new Set(s.inspectType)];a.forEach(c=>{var d;if(!je(d=["supervise","moderation"]).call(d,c))throw new ue(K.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new ue(K.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Bce(t)}};var I4=u(Ps.Object.getOwnPropertySymbols),Gce=qt,Hce=Db.indexOf,zce=n_,bT=ne([].indexOf),D4=!!bT&&1/bT([1],1,-0)<0;Gce({target:"Array",proto:!0,forced:D4||!zce("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return D4?bT(this,e,t)||0:Hce(this,e,t)}});var Kce=zi("Array","indexOf"),qce=N,Yce=Kce,wT=Array.prototype,$ce=function(e){var t=e.indexOf;return e===wT||qce(wT,e)&&t===wT.indexOf?Yce:t},O4=u($ce);function Xce(e,t){if(e==null)return{};var s,a,c=function(h,p){if(h==null)return{};var f={};for(var _ in h)if({}.hasOwnProperty.call(h,_)){if(O4(p).call(p,_)!==-1)continue;f[_]=h[_]}return f}(e,t);if(I4){var d=I4(e);for(a=0;a<d.length;a++)s=d[a],O4(t).call(t,s)===-1&&{}.propertyIsEnumerable.call(e,s)&&(c[s]=e[s])}return c}let j4=class{get localCapabilities(){return Es(this._localCapabilities)}get rtpCapabilities(){return Es(this._rtpCapabilities)}get candidates(){return Es(this._candidates)}get iceParameters(){return Es(this._iceParameters)}get dtlsParameters(){return Es(this._dtlsParameters)}constructor(e){B(this,"sessionDesc",void 0),B(this,"_localCapabilities",void 0),B(this,"_rtpCapabilities",void 0),B(this,"_candidates",void 0),B(this,"_iceParameters",void 0),B(this,"_dtlsParameters",void 0),B(this,"setup",void 0),B(this,"currentMidIndex",void 0),B(this,"cname","o/i14u9pJrxRKAsu"),B(this,"firefoxSsrcMidMap",new Map),e=Es(e);let{remoteIceParameters:t,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:p,videoCodec:f,audioCodec:_}=e,v;this.setup=p,v=h===sn.RECEIVE_ONLY?xn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):xn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=t,this._dtlsParameters=s,this._localCapabilities=d;let b=h===sn.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,w=h===sn.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=h===sn.RECEIVE_ONLY?c.send.videoCodecs:Qm(ze.VIDEO,b,w,f),U=h===sn.RECEIVE_ONLY?c.send.audioCodecs:Qm(ze.AUDIO,b,w,_);for(let k of v.mediaDescriptions)k.attributes.iceUfrag=t.iceUfrag,k.attributes.icePwd=t.icePwd,k.attributes.fingerprints=s.fingerprints,k.attributes.candidates=a,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video"&&(k.media.fmts=T.map(F=>F.payloadType.toString(10)),k.attributes.payloads=T,k.attributes.extmaps=b.videoExtensions),k.media.mediaType==="audio"&&(k.media.fmts=U.map(F=>F.payloadType.toString(10)),k.attributes.payloads=U,k.attributes.extmaps=b.audioExtensions,bh(k));this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return Bc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,s,a,c){s=s.replace(/ /g,"-");let{ssrcs:d,ssrcGroups:h}=Jm(t,this.cname,$("SYNC_GROUP")?s:void 0),p=this.findPreloadMediaDesc(d);if(p){if(Cs()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),c&&(c.twcc||c.remb)){let f=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{let f=this.findAvailableMediaIndex(e,d,a),_;return f===-1?(_=this.createOrRecycleSendMedia(e,d,h,"sendonly",a,c),this.updateBundleMids()):(_=Es(this.sessionDesc.mediaDescriptions[f]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(_,c)),Cs()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{needExchangeSDP:!0,mid:_.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,s){let a=[];return e.forEach(c=>{let d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d),p,f=!1;h===-1?(f=!0,p=this.createOrRecycleRecvMedia(c,[],"recvonly",t,s),this.updateBundleMids()):(p=Es(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="recvonly"),a.push({mid:p.attributes.mid,needCreateTransceiver:f})}),a}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(s=>e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:s,address:a,port:c,type:d,relatedAddress:h,relatedPort:p,priority:f}=new RTCIceCandidate(e),_={foundation:t??"",componentId:"1",transport:s??"",priority:f?f+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:p?p+"":"",extension:{}};this.candidates.some(v=>v.priority===_.priority&&v.connectionAddress===_.connectionAddress&&v.port===_.port)||(this._candidates.push(_),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,s,a,c){let d=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=Qm(d,h,this.localCapabilities.send,d===ze.AUDIO?c:a),f=d===ze.VIDEO?h.videoExtensions:h.audioExtensions,_="".concat(++this.currentMidIndex),v={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungRecvMediaDsec(v,e);let b=this.findFirstClosedMedia(d);if(b){let w=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[w]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(s=>je(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(s=>je(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{let c=a.media.mediaType===e&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(Cs()){if(c){let d=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let s=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&s})}predictReceivingMids(e){let t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}restartICE(e){e=Es(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,s,a,c,d){let h=this.rtpCapabilities.send,p=e===ze.VIDEO?h.videoCodecs:h.audioCodecs,f=e===ze.VIDEO?h.videoExtensions:h.audioExtensions;Cs()&&(c="".concat(++this.currentMidIndex));let _={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};_=this.mungSendMediaDesc(_,d);let v=this.findFirstClosedMedia(e);if(v){let b=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[b]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}mungRecvMediaDsec(e,t,s){let a=Es(e);return bC(a),xh(a,t),wC(a,t),NU(a),hE(a,s,this.localCapabilities.send),a}mungSendMediaDesc(e,t){let s=Es(e);return hE(s,t,this.localCapabilities.recv),bh(s),s}updateRecvMedia(e,t){let s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===e);if(s!==-1){let a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var s;return((s=t.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Cs()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},Jce=["sdp"];var os;function P4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function al(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?P4(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):P4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let k4=(os=class Wh extends lU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,s,a){super(t,s),B(this,"direction",void 0),B(this,"name",void 0),B(this,"store",void 0),B(this,"spec",void 0),B(this,"peerConnection",void 0),B(this,"initialOffer",void 0),B(this,"transport",void 0),B(this,"statsFilter",void 0),B(this,"localCandidateCount",0),B(this,"_isInRestartIce",!1),B(this,"mutex",void 0),B(this,"onLocalCandidate",void 0),B(this,"remoteSDP",void 0),B(this,"pendingCandidates",[]),B(this,"localCapabilities",void 0),B(this,"isReady",!1),B(this,"restartCnt",0),B(this,"curTurnServerIndex",0),this.store=s,this.spec=t,this.mutex=new Dr("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Wh.resolvePCConfiguration(t,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??sn.SEND_ONLY,this.name=this.direction===sn.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=D0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Cs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let s=await AU();if(this.localCapabilities=pE(s),t){let{sdp:a}=t,c=Xce(t,Jce),d=function(){let v={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},b=Xm(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(aa(b,v,"videoExtensions",w,T,U),aa(b,v,"videoCodecs",w,T,U),aa(b,v,"audioExtensions",w,T,U),aa(b,v,"audioCodecs",w,T,U),$("RAISE_H264_BASELINE_PRIORITY")){let k=U.videoCodecs.findIndex(F=>F.rtpMap&&F.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&F.fmtp&&F.fmtp.parameters["profile-level-id"]==="42001f");if(k!==-1){let F=U.videoCodecs.findIndex(z=>z.rtpMap&&z.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(F<k){A.debug("raising H264 baseline profile priority");let z=U.videoCodecs[k];U.videoCodecs.splice(k,1),U.videoCodecs.splice(F,0,z)}F!==-1&&$("FILTER_SEND_H264_BASELINE")&&(w.videoCodecs=w.videoCodecs.filter(z=>!(z.rtpMap&&z.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&z.fmtp&&z.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:w,recv:T,sendrecv:U}}({},{},a);this.remoteSDP=new j4({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let p=qc(h.sdp);await this.peerConnection.setLocalDescription(h);let f=await IU({},{},h.sdp);this.localCapabilities=pE(f);let _=this.peerConnection.getTransceivers()[0];return _!=null&&_.receiver&&_.receiver.transport&&this.tryBindTransportEvents(_.receiver.transport),al(al({},p),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let c=qc(a.sdp);return this.initialOffer=a,al(al({},c),{},{sdp:a.sdp})}}catch(s){throw new _e(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:s,iceParameters:a,dtlsParameters:c}=t,d=await IU({},{},s);this.remoteSDP=new j4({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new _e(K.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(t,s,a){var c=this;return wi(function*(){let d=yield Ot(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let h=[],p=c.remoteSDP.receive(t,s,a);t.forEach((F,z)=>{if(p[z].needCreateTransceiver){let Y=c.peerConnection.addTransceiver(F._mediaStreamTrack,{direction:"sendonly"});h.push(Y),F._updateRtpTransceiver(Y)}else{let Y=c.peerConnection.getTransceivers().find(X=>X.mid===p[z].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[z].mid));h.push(Y),F._updateRtpTransceiver(Y)}}),Cs()&&$("SIMULCAST")===!0&&(yield Ot(c.applySimulcastForFirefox(h,t)));let f=p.map(F=>F.mid),_=yield Ot(c.peerConnection.createOffer()),v=c.mungSendOfferSDP(_.sdp,t,f),b=xn(v),w=f.map(F=>{let z=b.mediaDescriptions.find(Y=>Y.attributes.mid===F);if(!z)throw new Error("Cannot extract ssrc from mediaDescription.");return SU(z,$("USE_PUB_RTX"))}),T=h.map((F,z)=>{let Y=f[z];return{localSSRC:w[z],id:Y}});yield Ot(c.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield T}catch(F){let z=c.remoteSDP.toString();throw yield Ot(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ot(c.peerConnection.setRemoteDescription({type:"answer",sdp:z})),yield Ot(c.stopSending(f,!0)),F}yield Ot(c.applySimulcastEncodings(h,t)),yield Ot(c.applySendEncodings(h,t));let U=c.remoteSDP.toString(),k=c.logSDPExchange(v,"offer","local","send");return k==null||k(U),yield Ot(c.setRemoteDescription({type:"answer",sdp:U})),h.map((F,z)=>{let Y=f[z];return{localSSRC:w[z],id:Y}})}catch(h){throw h instanceof _e?h:new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(t,s){let a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(f=>t.indexOf(f.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map(f=>{var _;f.direction="inactive",(_=f.stop)===null||_===void 0||_.call(f)});let d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);let p=this.remoteSDP.toString();h==null||h(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(t,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,s,a,c);if(h){let f=this.remoteSDP.toString(),_=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});let v=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(v.sdp,d,t);_==null||_(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let p=this.peerConnection.getTransceivers().find(f=>f.mid===d);if(!p||p.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,transceiver:p}}catch(d){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(t,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,s,a,c);if(h){let p=this.remoteSDP.toString(),f=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});let _=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(_.sdp,d,t);f==null||f(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(d){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});let c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===ld.Auto&&(this.store.p2pTransport=ld.SdRtn,jt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Wh.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,jt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Wh.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:a}=qc(s.sdp);return this.store.descriptionStart(),this.direction===sn.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===sn.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:a}=qc(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);let d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new _e(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,s){let a=this.peerConnection.getTransceivers().filter(c=>c.mid===t);a.length===1&&(this.isVP8Simulcast(s)?Cs()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){let a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let s=t[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:al(al({},yo),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:al(al({},yo),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,s;je(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var s;t.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c={iceServers:[]};var d;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(km(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...Wh.turnServerConfigToIceServers(t.turnServer.servers,s,a)),$("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...Wh.turnServerConfigToIceServers(t.turnServer.serversFromGateway,s,a)),je(d=[ld.Relay,ld.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),$("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&jt().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),A.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(t,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=[],d=t.filter(p=>p.tcpport);A.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));let h=d.length>a?d[a]:d[0];switch(s){case ld.SdRtn:let p=t.filter(_=>{var v;return je(v=_.username).call(v,"glb:")&&_.turnServerURL==_.turnServerURL}),f=p.length>a?p[a]:p[0];f&&(c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(zc(f.turnServerURL),":").concat(f.tcpport,"?transport=udp")}),c.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(zc(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}));break;case ld.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(zc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(zc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var a;t!=null&&t.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,t.state))},t.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};let s=t.iceTransport;s&&(s.onstatechange=()=>{let a=t==null?void 0:t.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){let{local:a,remote:c}=s.getSelectedCandidatePair()||{};if(a&&c){let d=a.address+":"+a.port,h=c.address+":"+c.port;A.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(_d(d)),", remote ").concat(JSON.stringify(_d(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var a;if(s||(s=this.peerConnection.getSenders().find(v=>v.track===t._mediaStreamTrack)),!s)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return A.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jt().supportSetRtpSenderParameters)return A.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var h;let{bitrateMax:v,frameRate:b,scaleResolutionDownBy:w}=t._encoderConfig;v&&(d.maxBitrate=1e3*v),je(h=t._hints).call(h,Zt.LOW_STREAM)&&(b&&(d.maxFramerate=Bn(b)),w&&w>=1&&(d.scaleResolutionDownBy=w))}if($("DSCP_TYPE")&&tc()){var p;let v=$("DSCP_TYPE");je(p=["very-low","low","medium","high"]).call(p,v)&&(d.networkPriority=v)}let f=s.getParameters(),_=(a=f.encodings)===null||a===void 0?void 0:a[0];Cs()&&!_&&(c.encodings=[d]),_&&Object.assign(_,d),Object.assign(f,c),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await s.setParameters(f)}async applySendEncodings(t,s){try{if(!jt().supportSetRtpSenderParameters||t.length!==s.length)return;for(let a=0;a<t.length;a++){let c=t[a],d=s[a];d instanceof as&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,a){let c=xn(t);return s.forEach((d,h)=>{let p=a[h],f=c.mediaDescriptions.find(_=>_.attributes.mid===p);f&&(xh(f,d),RU(f,d,this.store.codec))}),Bc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let f=0;f<t.length;f++){var a,c,d,h,p;let _=t[f],v=s[f];if(v instanceof as&&!je(a=v._hints).call(a,Zt.LOW_STREAM)&&(c=v._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=v._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=v._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){let b={},w={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];let T=_.sender.getParameters();await _.sender.setParameters(Object.assign(T,b))}}}async applySimulcastEncodings(t,s){if(!Cs()&&t.length===s.length)for(let a=0;a<t.length;a++){let c=s[a];if(c instanceof as&&this.isVP8Simulcast(c)){let d=t[a],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];let f=d.sender.getParameters();await d.sender.setParameters(Object.assign(f,h))}}}isVP8Simulcast(t){var s,a,c,d,h;return!!(t instanceof as&&$("SIMULCAST")&&this.store.codec==="vp8"&&!je(s=t._hints).call(s,Zt.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,s,a,c){if($("SDP_LOGGING"))return A.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),t),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let s=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let s=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});let a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t);let d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(t,s){var a;if(s=s??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var c;let d=(c=xn(s).mediaDescriptions.find(h=>h.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(t){var s;await this.peerConnection.setRemoteDescription(t),je(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,s,a){let c=xn(t),d=c.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&a===ze.AUDIO&&d.media.mediaType==="audio"&&bh(d),Bc(c)}},Je(os.prototype,"establish",[ua],Object.getOwnPropertyDescriptor(os.prototype,"establish"),os.prototype),Je(os.prototype,"connect",[ua],Object.getOwnPropertyDescriptor(os.prototype,"connect"),os.prototype),Je(os.prototype,"receive",[ua],Object.getOwnPropertyDescriptor(os.prototype,"receive"),os.prototype),Je(os.prototype,"mockReceive",[ua],Object.getOwnPropertyDescriptor(os.prototype,"mockReceive"),os.prototype),Je(os.prototype,"stopReceiving",[ua],Object.getOwnPropertyDescriptor(os.prototype,"stopReceiving"),os.prototype),Je(os.prototype,"restartICE",[ua],Object.getOwnPropertyDescriptor(os.prototype,"restartICE"),os.prototype),Je(os.prototype,"close",[ua],Object.getOwnPropertyDescriptor(os.prototype,"close"),os.prototype),Je(os.prototype,"updateEncoderConfig",[ua],Object.getOwnPropertyDescriptor(os.prototype,"updateEncoderConfig"),os.prototype),Je(os.prototype,"updateSendParameters",[ua],Object.getOwnPropertyDescriptor(os.prototype,"updateSendParameters"),os.prototype),Je(os.prototype,"replaceTrack",[ua],Object.getOwnPropertyDescriptor(os.prototype,"replaceTrack"),os.prototype),Je(os.prototype,"muteLocal",[ua],Object.getOwnPropertyDescriptor(os.prototype,"muteLocal"),os.prototype),Je(os.prototype,"unmuteLocal",[ua],Object.getOwnPropertyDescriptor(os.prototype,"unmuteLocal"),os.prototype),os);function ua(e,t,s){let a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},s}let Ha=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var L4,M4,F4,U4,V4,B4,W4,G4,H4,z4,K4,ys;function q4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function XE(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?q4(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):q4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let Qce=(L4=za(Ha.SEND_ONLY),M4=za(Ha.SEND_ONLY),F4=za(),U4=za(Ha.RECEIVE_ONLY),V4=za(Ha.RECEIVE_ONLY),B4=za(Ha.RECEIVE_ONLY),W4=za(Ha.RECEIVE_ONLY),G4=za(Ha.RECEIVE_ONLY),H4=za(Ha.RECEIVE_ONLY),z4=za(),K4=za(Ha.RECEIVE_ONLY),ys=class extends bs{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(tt.StateChange,t,this._state)}constructor(e,t){super(),B(this,"isPlanB",!1),B(this,"store",void 0),B(this,"statsUploader",void 0),B(this,"sendConnection",void 0),B(this,"recvConnection",void 0),B(this,"localTrackMap",new Map),B(this,"remoteUserMap",new Map),B(this,"localDataChannels",[]),B(this,"pendingLocalTracks",[]),B(this,"pendingRemoteTracks",[]),B(this,"statsCollector",void 0),B(this,"dtlsFailedCount",0),B(this,"sendMutex",void 0),B(this,"recvMutex",void 0),B(this,"_state",Ht.Disconnected),B(this,"_restartStates",["disconnected","failed"]),B(this,"reconnectInterval",void 0),B(this,"uploadUnplinkStarted",!1),B(this,"uploadDownlinkStarted",!1),B(this,"uplinkStateUploadInterval",void 0),B(this,"downlinkStatsUploadInterval",void 0),B(this,"handleMuteLocalTrack",async(s,a,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ht.Connected)return void c(new _e(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let f=this.filterTobeMutedTracks(s);if(f.length===0)return void a();let _=f.find(T=>T[0]==="videoLowTrack");_&&_[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(f.map(T=>{let[,{id:U}]=T;return U}));let v=!1;var h,p;s.trackMediaType==="video"?v=!((h=this.localTrackMap.get(Ne.LocalAudioTrack))===null||h===void 0||!h.track._muted):v=((p=this.localTrackMap.get(Ne.LocalVideoTrack))===null||p===void 0?void 0:p.id)===void 0;let b=this.createMuteMessage(f);await es(this,tt.RequestMuteLocal,b);let w=s.trackMediaType==="video"?Hc.MUTE_LOCAL_VIDEO:Hc.MUTE_LOCAL_AUDIO;await es(this,tt.RequestP2PMuteLocal,{action:w,message:b,isMuteAll:v}),a()}catch(f){c(f)}finally{d()}}),B(this,"handleUnmuteLocalTrack",async(s,a,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ht.Connected)return void c(new _e(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(_=>{let[,{id:v}]=_;return v}));let p=this.createUnmuteMessage(h),f=s.trackMediaType==="video"?Hc.UNMUTE_LOCAL_VIDEO:Hc.UNMUTE_LOCAL_AUDIO;await es(this,tt.RequestP2PMuteLocal,{action:f,message:p}),a()}catch(h){c(h)}finally{d()}}),B(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let f=this.localTrackMap.get(Ne.LocalVideoTrack);if(!this.sendConnection||!f||f.track!==s||this.state!==Ht.Connected)return void a();let{id:_,track:v}=f;_&&(await this.sendConnection.updateSendParameters(_,v),await this.sendConnection.updateEncoderConfig(_,v),this.emit(tt.UpdateVideoEncoder,v)),a()}catch(f){c(f)}finally{var p;(p=h)===null||p===void 0||p()}}),B(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{let d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let h=this.localTrackMap.get(Ne.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Ht.Connected)return void a();let{id:p,track:f}=h;p&&await this.sendConnection.updateSendParameters(p,f),a()}catch(h){c(h)}finally{d()}}),B(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;A.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var p;let _=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:b}]=v;return s===b});if(!this.sendConnection||!_||_[1].id===void 0||this.state!==Ht.Connected)return void a();if(await((p=this.sendConnection)===null||p===void 0?void 0:p.replaceTrack(s,_[1].id)),_[0]===Ne.LocalVideoTrack&&jt().supportDualStreamEncoding){let v=this.localTrackMap.get(Ne.LocalVideoLowTrack);if(v){let b=s._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=b,v.track._originMediaStreamTrack=b,await new Ve((w,T)=>{this.handleReplaceTrack(v.track,w,T,!0)})}}a()}catch(_){c(_)}finally{var f;(f=h)===null||f===void 0||f()}}),B(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),B(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),B(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),B(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new u5(e),this.bindStatsUploaderEvents(),this.sendMutex=new Dr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Dr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},$("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let s;try{if(t){this.recvConnection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new k4(e,this.store,sn.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let a=await this.recvConnection.establish(t);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=Ht.New,this.sendConnection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new k4(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(e){if(!this.sendConnection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ht.Connected}async addRemoteCandidate(e,t){if(t===sn.RECEIVE_ONLY){if(!this.sendConnection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new _e(K.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,s){var a=this;return wi(function*(){let c=yield Ot(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==Ht.Connected){a.throwIfTrackTypeNotMatch(e);let _=e.filter(v=>a.pendingLocalTracks.indexOf(v)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(_))}a.store.pubId=a.store.pubId+1,kr.markPublishStart(a.store.clientId,a.store.pubId);let d=a.filterTobePublishedTracks(e,t,s);if(d.length===0)return void(yield Ot(a.tryToUnmuteAudio(e)));d.forEach(_=>{let{track:v,type:b}=_,w=Date.now();a.store.publish(v.getTrackId(),b===Ne.LocalAudioTrack?"audio":"video",w)}),a.bindLocalTrackEvents(d);let h=yield Ot(a.sendConnection.send(d.map(_=>{let{track:v}=_;return v}),a.store.codec,a.store.audioCodec)),p=(yield Ot(h.next())).value,f=a.createGatewayPublishMessage(d,p);try{yield f}catch(_){throw h.throw(_),(_==null?void 0:_.code)===K.WS_ABORT&&d.forEach(v=>{let{track:b}=v;a.pendingLocalTracks.indexOf(b)===-1&&a.pendingLocalTracks.push(b)}),a.unbindLocalTrackEvents(d),_}yield Ot(h.next()),d.forEach(_=>{let{type:v}=_;a.statsCollector.addLocalStats(v)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,p),d.forEach(_=>{let{track:v,type:b}=_,w=Date.now();a.store.publish(v.getTrackId(),b===Ne.LocalAudioTrack?"audio":"video",void 0,w)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Ht.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!je(e).call(e,c)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let s=t.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();let a=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),t.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ht.Connected)return s&&s[1].track.close(),a;e.forEach(c=>{let d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],s=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:d,ssrcs:h}]=a,p={stream_type:Gae(d,c),ssrcs:h};d._muted||!d._enabled?t.push(p):s.push(p)}),t.length>0&&t.forEach(a=>{es(this,tt.RequestMuteLocal,[a])}),s.length>0&&s.forEach(a=>{es(this,tt.RequestUnmuteLocal,[a])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return wi(function*(){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(A.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Cr(this,tt.RequestRePublish,this.pendingLocalTracks),this.emit(tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,s,a){var c;if(!this.recvConnection)throw new _e(K.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let{track:d,mid:h,transceiver:p}=await this.recvConnection.receive(t,[{ssrcId:s}],String(e.uid),a);t===ze.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new ph(d,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=s,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new hh(d,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack));let f=this.remoteUserMap.get(e);f?f.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let _=this.pendingRemoteTracks.findIndex(v=>{let{user:b,kind:w}=v;return b.uid===e.uid&&t===w});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(tt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,s,a){if(!this.recvConnection)throw new _e(K.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:s}],String(e.uid),a)}async unsubscribe(e,t,s){let a=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:p}=d;return t!==void 0?h.uid===e.uid&&t===p:h.uid===e.uid});if(a.forEach(d=>{let h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||a.forEach(d=>{let{kind:h}=d;var p;if(h===ze.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===ze.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:p}]=d;var f,_;if(p===ze.VIDEO&&h._videoSSRC&&((f=this.recvConnection)===null||f===void 0||f.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===ze.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(p===ze.AUDIO){var v;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;es(this,tt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,s]=t;[ze.VIDEO,ze.AUDIO].forEach(a=>{s.has(a)?es(this,tt.RequestP2PUnmuteRemote,a):es(this,tt.RequestP2PMuteRemote,a)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new _e(K.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let s=this.remoteUserMap.get(e);if(!s)return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let a=t===ze.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let s=this.remoteUserMap.get(e);if(!s)return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(t)||A.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(Ne.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ys){let s=t.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ne.LocalAudioTrack}).filter(a=>{let[c]=a;return!(e&&c===Ne.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(e&&a===Ne.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(e,t,s,a,c){if(e){let h=this.localTrackMap.get(Ne.LocalAudioTrack),p=a?this.localTrackMap.get(Ne.LocalVideoLowTrack):this.localTrackMap.get(Ne.LocalVideoTrack);Qe.publish(this.store.sessionId,{eventElapse:kr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(Zt.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);let h=s.find(f=>f instanceof Is),p=a?(d=this.localTrackMap.get(Ne.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(f=>f instanceof as);Qe.publish(this.store.sessionId,{eventElapse:kr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(Zt.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,s,a){let c=a===ze.VIDEO?s._videoSSRC:s._audioSSRC;c&&Qe.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===ze.VIDEO,audio:a===ze.AUDIO,peerid:s.uid,subscribeRequestid:a===ze.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:kr.measureFromSubscribeStart(this.store.clientId,c)})}reset(){A.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Dr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Dr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Ne.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ys){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(s=>{t.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ht.Disconnected}getStats(e){var t,s;return e?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Ne.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Ne.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof as||t&&t.track instanceof Is?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;let s=Array.from(bn(t=this.remoteUserMap).call(t)).find(a=>a.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Ne.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ql(e).call(e,(s,a)=>s.level-a.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(A.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ht.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&((s=t._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:a}]=e;switch(s){case Ne.LocalVideoTrack:je(t=a._hints).call(t,Zt.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ne.LocalAudioTrack:a instanceof Ys?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ne.LocalVideoLowTrack:}}),this.emit(tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(bn(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(t,a)}),this.emit(tt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),A.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let s of this.pendingRemoteTracks){let{user:a,kind:c}=s;if((e instanceof Jc?e.uid:e)===a.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let s,a;if(e===sn.SEND_ONLY){if(!this.sendConnection)throw new _e(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new _e(K.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(t){let c=await a.restartICE(t);return a.isInRestartIce=!1,c}{let c=await a.restartICE();if(c){let d=await Cr(this,tt.RequestP2PRestartICE,{direction:sn.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(Ne.LocalVideoTrack),s=this.localTrackMap.get(Ne.LocalAudioTrack),a=e.videoSend.find(T=>{var U;return T.ssrc===(t==null||(U=t.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)}),c=e.audioSend.find(T=>{var U;return T.ssrc===(s==null||(U=s.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)});if(!a||!c)return 1;let d=ri(this,tt.NeedSignalRTT),h=a?a.rttMs:void 0,p=c?c.rttMs:void 0,f=h&&p?(h+p)/2:h||p,_=(f&&d?(f+d)/2:f||d)||0,v=100*e.sendPacketLossRate*.7/50+.3*_/1500,b=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,w=t==null?void 0:t.track;if(w&&w._encoderConfig&&w._hints.indexOf(Zt.SCREEN_TRACK)===-1){let T=w._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(T&&U){let k=(1e3*T-U)/(1e3*T);return tU[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s,c=a._audioSSRC,d=a._videoSSRC,h=e.audioRecv.find(U=>U.ssrc===c),p=e.videoRecv.find(U=>U.ssrc===d);if(!h&&!p)return void(t+=1);let f=ri(this,tt.NeedSignalRTT),_=e.rtt,v=(_&&f?(_+f)/2:_||f)||0,b=h?h.jitterMs:void 0,w=e.recvPacketLossRate,T=.7*w*100/50+.3*v/1500;b&&(T=.6*w*100/50+.2*v/1500+.2*b/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ve((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}filterTobePublishedTracks(e,t,s){let a=[],c=jt(),d=this.getAllTracks();e=Zu(e=e.filter(f=>d.indexOf(f)===-1));let h=!1,p=!1;for(let f of e){if(f instanceof as&&(this.localTrackMap.has(Ne.LocalVideoTrack)||h?new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:f,type:Ne.LocalVideoTrack}),h=!0),t)){let _=this.getLowVideoTrack(f,s);a.push({track:_,type:Ne.LocalVideoLowTrack})}if(f instanceof Is){let _=this.localTrackMap.get(Ne.LocalAudioTrack);if(_){if(!(_.track instanceof Ys))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0)}else if(p){let v=a.find(b=>{let{type:w}=b;return w===Ne.LocalAudioTrack});if(!(v.track instanceof Ys))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(f)}else{if(!c.webAudioMediaStreamDest||f instanceof Ys||f._bypassWebAudio)a.push({track:f,type:Ne.LocalAudioTrack});else{let v=new Ys;v.addAudioTrack(f),a.push({track:v,type:Ne.LocalAudioTrack})}p=!0}}}return a}filterTobeUnpublishedTracks(e){let t=[],s=this.getAllTracks();e=Zu(e=e.filter(a=>s.indexOf(a)!==-1));for(let a of e){if(a instanceof Is){let c=this.localTrackMap.get(Ne.LocalAudioTrack);if(!c)continue;c.track instanceof Ys?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(t.push([Ne.LocalAudioTrack,c]),c.track.close())):t.push([Ne.LocalAudioTrack,c])}if(a instanceof as){let c=this.localTrackMap.get(Ne.LocalVideoTrack);if(!c)continue;t.push([Ne.LocalVideoTrack,c]);let d=this.localTrackMap.get(Ne.LocalVideoLowTrack);d&&t.push([Ne.LocalVideoLowTrack,d])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:s,type:a}=t;switch(a){case Ne.LocalVideoTrack:s.addListener(Ye.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ye.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ne.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ys?e.trackList.forEach(s=>{s.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ye.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ye.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[s,{track:a}]=t;return{track:a,type:s}})),e.forEach(t=>{let{track:s,type:a}=t;switch(a){case Ne.LocalVideoTrack:s.off(Ye.GET_STATS,this.handleGetLocalVideoStats),s.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Ye.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Ye.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ne.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ys?e.trackList.forEach(t=>{t.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ye.GET_STATS,this.handleGetLocalAudioStats),t.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ye.GET_STATS,this.handleGetLocalAudioStats),e.off(Ye.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ye.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ye.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ye.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ye.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof hh&&t.addListener(Ye.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),t instanceof ph&&t.addListener(Ye.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ye.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(ze.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(ze.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((s,a)=>{var c;let d,{track:h,type:p}=s;switch(p){case Ne.LocalAudioTrack:d=Kt.Audio;break;case Ne.LocalVideoTrack:d=je(c=h._hints).call(c,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High;break;case Ne.LocalVideoLowTrack:d=Kt.Low}return{kind:p===Ne.LocalAudioTrack?ze.AUDIO:ze.VIDEO,stream_type:d,mid:t[a].id,ssrcs:t[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ne.LocalVideoTrack:a=je(s=d._hints).call(s,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High;break;case Ne.LocalAudioTrack:a=Kt.Audio;break;case Ne.LocalVideoLowTrack:a=Kt.Low}return{stream_type:a,ssrcs:h,mid:p}})}assignLocalTracks(e,t){e.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:t[a].id,ssrcs:t[a].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[s]=t;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var s;A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(tt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),je(s=this._restartStates).call(s,t)&&!e.isInRestartIce&&(t==="disconnected"&&await pr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Qe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:vs.TRACER}).onSuccess(),this.emit(tt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var s;let a=Array.from(bn(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===t);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Ti.FIRST_FRAME_DECODED),Qe.firstRemoteFrame(this.store.sessionId,Zs.FIRST_AUDIO_DECODE,_s.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:kr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var s;let a=Array.from(bn(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===t);a&&Qe.firstRemoteFrame(this.store.sessionId,Zs.FIRST_AUDIO_RECEIVED,_s.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:kr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,s,a)=>{this.reportVideoFirstFrameDecoded(t,s,a)},e.onFirstVideoReceived=t=>{var s;let a=Array.from(bn(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===t);a&&Qe.firstRemoteFrame(this.store.sessionId,Zs.FIRST_VIDEO_RECEIVED,_s.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:kr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,s)=>{let a=t.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(tt.ConnectionTypeChange,a),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Kc(s))," -> ").concat(JSON.stringify(Kc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,s)=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Kc(s))," -> ").concat(JSON.stringify(Kc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(tt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===sn.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,A.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===sn.SEND_ONLY?this.restartICE(e):Cr(this,tt.RequestP2PRestartICE,{direction:sn.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let s=this.localTrackMap.get(Ne.LocalAudioTrack);if(e instanceof Is&&(s==null?void 0:s.track)instanceof Ys)return s.track.isActive||t.push([Ne.LocalAudioTrack,s]),t;let a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a&&(t.push(a),a[0]===Ne.LocalVideoTrack)){let c=this.localTrackMap.get(Ne.LocalVideoLowTrack);c&&t.push([Ne.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){let t=[],s=this.localTrackMap.get(Ne.LocalAudioTrack);if(e instanceof Is&&(s==null?void 0:s.track)instanceof Ys)return s.track.isActive&&t.push([Ne.LocalAudioTrack,s]),t;let a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(a)if(a[0]===Ne.LocalVideoTrack){t.push(a);let c=this.localTrackMap.get(Ne.LocalVideoLowTrack);c&&t.push([Ne.LocalVideoLowTrack,c])}else t.push(a);return t}createMuteMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ne.LocalAudioTrack:a=Kt.Audio;break;case Ne.LocalVideoTrack:a=je(s=d._hints).call(s,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High;break;case Ne.LocalVideoLowTrack:a=Kt.Low}return{stream_type:a,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(t=>{var s;let a,[c,{track:d,ssrcs:h,id:p}]=t;switch(c){case Ne.LocalAudioTrack:a=Kt.Audio;break;case Ne.LocalVideoTrack:a=je(s=d._hints).call(s,Zt.SCREEN_TRACK)?Kt.Screen:Kt.High;break;case Ne.LocalVideoLowTrack:a=Kt.Low}return{stream_type:a,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,t){let s=[],a=this.remoteUserMap.get(e);if(!a)return s;if(t){let c=a.get(t);if(!c)return s;s.push([e,{kind:t,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([e,{kind:d,id:h}])});return s}createUnsubscribeMessage(e){let t=[];return e.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case ze.VIDEO:return void(a._videoSSRC&&t.push({stream_type:ze.VIDEO,ssrcId:a._videoSSRC}));case ze.AUDIO:return void(a._audioSSRC&&t.push({stream_type:ze.AUDIO,ssrcId:a._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[s,{kind:a}]=t,c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Ne.LocalVideoTrack),s=this.localTrackMap.get(Ne.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ve((a,c)=>{this.handleUpdateVideoEncoder(t.track,a,c,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ve((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Is){let s=this.filterTobeUnmutedTracks(e[t]);if(s.length===0)continue;let a=this.createUnmuteMessage(s);return void await es(this,tt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(tt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(tt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await pr(C0(this.dtlsFailedCount,Hs)),this.emit(tt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ne.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof as)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof as).length>1)throw new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Is).length>1&&(e.some(t=>t instanceof Is&&t._bypassWebAudio)||!jt().webAudioMediaStreamDest))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof as&&this.pendingLocalTracks.some(s=>s instanceof as))throw new _e(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Is&&this.pendingLocalTracks.some(s=>s instanceof Is)&&(!jt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Is&&s._bypassWebAudio)))throw new _e(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let s=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding,a=XE(XE({},{width:160,height:120,framerate:15,bitrate:50}),t),c;c=s?e._mediaStreamTrack.clone():BC(e,a);let d=ts(8,"track-low-"),h=new as(c,XE(XE({},s&&{scaleResolutionDownBy:xC(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(dd.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,ah.LOW_STREAM)}),h._hints.push(Zt.LOW_STREAM),e.addListener(Ye.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,s,a){var c;let d=Array.from(bn(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());let h=this.store.keyMetrics,p=h.subscribe.find(f=>f.userId===d.uid&&f.type==="video");Qe.firstRemoteVideoDecode(this.store.sessionId,Zs.FIRST_VIDEO_DECODE,_s.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:s,subscribeElapse:kr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.recvConnection)return!1;let a=this.remoteUserMap.get(e);if(!a)return!1;let c=a.get(t);if(!c)return!1;let d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new _e(K.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new _e(K.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new _e(K.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new _e(K.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new _e(K.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new _e(K.NOT_SUPPORTED)}async preConnect(e){throw new _e(K.NOT_SUPPORTED)}getEstablishParams(){throw new _e(K.NOT_SUPPORTED)}async reSubscribe(e){throw new _e(K.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new _e(K.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===Ne.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ah.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Je(ys.prototype,"p2pConnect",[L4],Object.getOwnPropertyDescriptor(ys.prototype,"p2pConnect"),ys.prototype),Je(ys.prototype,"unpublish",[M4],Object.getOwnPropertyDescriptor(ys.prototype,"unpublish"),ys.prototype),Je(ys.prototype,"unpublishLowStream",[F4],Object.getOwnPropertyDescriptor(ys.prototype,"unpublishLowStream"),ys.prototype),Je(ys.prototype,"subscribe",[U4],Object.getOwnPropertyDescriptor(ys.prototype,"subscribe"),ys.prototype),Je(ys.prototype,"mockSubscribe",[V4],Object.getOwnPropertyDescriptor(ys.prototype,"mockSubscribe"),ys.prototype),Je(ys.prototype,"unsubscribe",[B4],Object.getOwnPropertyDescriptor(ys.prototype,"unsubscribe"),ys.prototype),Je(ys.prototype,"muteRemote",[W4],Object.getOwnPropertyDescriptor(ys.prototype,"muteRemote"),ys.prototype),Je(ys.prototype,"unmuteRemote",[G4],Object.getOwnPropertyDescriptor(ys.prototype,"unmuteRemote"),ys.prototype),Je(ys.prototype,"hasRemoteMediaWithLock",[H4],Object.getOwnPropertyDescriptor(ys.prototype,"hasRemoteMediaWithLock"),ys.prototype),Je(ys.prototype,"disconnectForReconnect",[z4],Object.getOwnPropertyDescriptor(ys.prototype,"disconnectForReconnect"),ys.prototype),Je(ys.prototype,"remoteMediaSsrcChanged",[K4],Object.getOwnPropertyDescriptor(ys.prototype,"remoteMediaSsrcChanged"),ys.prototype),ys);function za(e){return function(t,s,a){let c=t[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(e){case Ha.SEND_ONLY:{let f=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{f()}}case Ha.RECEIVE_ONLY:{let f=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{f()}}default:{let f=await this.sendMutex.lock("From P2PChannel2.".concat(s)),_=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{f(),_()}}}},a}}class Rd extends bs{constructor(t,s){super(),B(this,"signal",void 0),B(this,"token",void 0),B(this,"tokenTimeout",void 0),B(this,"tokenInterval",void 0),B(this,"_sequence",0),B(this,"userMap",new Map),B(this,"encoder",new TextEncoder),this.signal=t,this.token=s;let a=()=>{this.signal.connectionState===is.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*$("P2P_TOKEN_INTERVAL"))};a()}async send(t,s,a,c,d){var h;if(this.userMap.size===0)return;let p=Array.from(Mn(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=c??ts(6,""),d=d??this._sequence++;let f={_id:c,_type:t,_seq:d,_message:s,token:"".concat(this.token,"_").concat(p)};$("SHOW_P2P_LOG")&&A.debug("send message",f,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(f)).forEach(v=>{this.signal.request(lt.DATA_STREAM,{payload:Vc(this.encoder.encode(v))})});let _=new Ve((v,b)=>{let w=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),T),this.off("res-@".concat(c),k),this.off(vh.ABORT,U),A.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?b(new _e(K.INVALID_REMOTE_USER)):b(new _e(K.TIMEOUT))},$("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{w&&window.clearTimeout(w),this.off(vh.ABORT,U),a&&v()},U=()=>{w&&window.clearTimeout(w),this.off("res-@".concat(c,"_ack"),T),this.off("res-@".concat(c),k),b(new _e(K.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(vh.ABORT,U),this.once("res-@".concat(c,"_ack"),T);let k=(z,Y)=>{F=!0,w&&window.clearTimeout(w),this.off("res-@".concat(c,"_ack"),T),this.off(vh.ABORT,U),z==="success"?v(Y):b(new _e(K.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))},F=!1;a||(this.once("res-@".concat(c),k),pr($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{F||A.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(f))}))});try{return await _}catch(v){if(v.code===K.TIMEOUT)return await this.send(t,s,a,c,d);throw v}}onMessage(t){var s;let{_uid:a}=t,c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==ks.CHECK)return;let{token:_}=t;c=new Map,d={uid:a,isStart:!0,token:_,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(Nt.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in t&&"total"in t){var h;let{id:_,total:v}=t,b=(h=c.get(_))!==null&&h!==void 0?h:[];if(b.push(t),c.has(_)||c.set(_,b),b.length!==v)return;{let w=Ql(b).call(b,(T,U)=>T.index-U.index).map(T=>T.payload).join("");c.delete(_),(t=JSON.parse(w))._uid=a}}let{_type:p,token:f}=t;if(je(s=[ks.ACK,ks.CHECK]).call(s,p))return p===ks.CHECK&&this.handleCheckToken(d,f),void this.receiveMessage(t);f==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(t):A.debug('Receive unexpected message", '.concat(f,", cur_token: ").concat(d.token,"_").concat(this.token),t)}check(){let t={_id:ts(6,""),token:this.token,_type:ks.CHECK};$("SHOW_P2P_LOG")&&A.debug("send message",t),this.signal.request(lt.DATA_STREAM,{payload:Vc(this.encoder.encode(JSON.stringify(t)))})}ack(t){let s={_id:t,_type:ks.ACK,token:this.token};$("SHOW_P2P_LOG")&&A.debug("send message",s),this.signal.request(lt.DATA_STREAM,{payload:Vc(this.encoder.encode(JSON.stringify(s)))})}response(t,s,a){this.send(ks.RESPONSE,JSON.stringify({success:!a,message:s}),!0,t)}handleReceivedMessage(t){let s=()=>{this.userMap.forEach(_=>{let{receivedMessagesMap:v,nextExpectedSequenceNumber:b}=_;for(;v.has(b);){let w=v.get(b);v.delete(b),this.receiveMessage(w),_.nextExpectedSequenceNumber++}})};if(!t)return void s();let{_uid:a,_seq:c}=t,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:f}=d;if(c<f)return this.ack(t._id),void A.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));h.set(c,t),p&&c===f&&(this.receiveMessage(t),h.delete(f),d.nextExpectedSequenceNumber++,s())}receiveMessage(t){let{_id:s,_type:a,_message:c,_uid:d}=t;if($("SHOW_P2P_LOG")&&A.debug("receive message",t),s){let h;switch(t._type!==ks.ACK&&(c&&(h=JSON.parse(c)),this.ack(t._id)),t._type){case ks.CANDIDATE:case ks.CONTROL:this.signal.emit(a,h,d);break;case ks.PUBLISH:case ks.UNPUBLISH:case ks.RESTART_ICE:case ks.CALL:h.uid=d,Cr(this.signal,a,h).then(p=>{this.response(t._id,p)}).catch(()=>{this.response(t._id,void 0,!0)});break;case ks.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case ks.RESPONSE:{let{success:p,message:f}=h;this.emit("res-@".concat(s),p?"success":"failed",f);break}}}}splitMessage(t){if(t.length<Rd.MAX_MESSAGE_SIZE)return[t];let s=[],{remoteToken:a}=JSON.parse(t),c=ts(6,""),d=0,h=800,p=Math.ceil(t.length/h);for(;t.length>0;){d++;let f={id:c,index:d,total:p,payload:t.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(f).length>Rd.MAX_MESSAGE_SIZE?h-=50:(s.push(f),t=t.slice(h))}return s.map(f=>JSON.stringify(f))}handleCheckToken(t,s){return t.token!==s?(A.debug("token changed, from ".concat(t.token," to ").concat(s)),this.reset(t.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{A.debug("token timeout, ".concat(s)),this.reset(t.uid)},$("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await Cr(this.signal,ks.CALL,void 0),s=await this.send(ks.CALL,t);this.signal.emit(ut.P2P_CONNECTION,s,!0)}async reset(t,s){let a=this.userMap.get(t);a&&(this.emit(vh.ABORT),this.signal.emit(Nt.ON_USER_OFFLINE,{uid:a.uid,reason:_ae.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(A.debug("change local token from ".concat(s," to ").concat(s)),this.token=ts(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(vh.ABORT)}}B(Rd,"MAX_SIZE",1),B(Rd,"MAX_MESSAGE_SIZE",1024);class Zce extends bs{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===is.CONNECTED?this.emit(ut.WS_CONNECTED):t===is.RECONNECTING?this.emit(ut.WS_RECONNECTING,this._websocketReconnectReason):t===is.CLOSED&&this.emit(ut.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,s){super(),B(this,"_disconnectedReason",void 0),B(this,"_websocketReconnectReason",void 0),B(this,"_connectionState",is.CLOSED),B(this,"reconnectToken",void 0),B(this,"p2pToken",void 0),B(this,"websocket",void 0),B(this,"openConnectionTime",void 0),B(this,"clientId",void 0),B(this,"lastMsgTime",Date.now()),B(this,"uploadCache",[]),B(this,"uploadCacheInterval",void 0),B(this,"rttRolling",new wL(5)),B(this,"pingpongTimer",void 0),B(this,"pingpongTimeoutCount",0),B(this,"joinResponse",void 0),B(this,"multiIpOption",void 0),B(this,"initError",void 0),B(this,"spec",void 0),B(this,"store",void 0),B(this,"_external_signal",void 0),B(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(ut.ON_BINARY_DATA,a.data);let c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Nt.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Nt.MUTE_AUDIO:case Nt.MUTE_VIDEO:case Nt.ON_P2P_LOST:case Nt.ON_USER_ONLINE:return;case Nt.ON_USER_OFFLINE:let{uid:d}=c._message;return A.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===Nt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Nt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Gt.UID_BANNED);break;case 15:this.close(Gt.IP_BANNED);break;case 16:this.close(Gt.CHANNEL_BANNED)}if(c._type===Nt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case at.ERR_LICENSE_MISSING:this.close(Gt.LICENSE_MISSING);break;case at.ERR_LICENSE_EXPIRED:this.close(Gt.LICENSE_EXPIRED);break;case at.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Gt.LICENSE_MINUTES_EXCEEDED);break;case at.ERR_LICENSE_PERIOD_INVALID:this.close(Gt.LICENSE_PERIOD_INVALID);break;case at.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Gt.LICENSE_MULTIPLE_SDK_SERVICE);break;case at.ERR_LICENSE_ILLEGAL:this.close(Gt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new EC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===is.CONNECTED&&this.reconnect("retry",Sr.OFFLINE)}),this.p2pToken=ts(6,""),this._external_signal=new Rd(this,this.p2pToken)}async request(t,s,a,c){let d=ts(6,""),h={_id:d,_type:t,_message:s},p=this.websocket.connectionID,f=()=>new Ve((U,k)=>{if(this.connectionState===is.CONNECTED)return U();let F=()=>{this.off(ut.WS_CLOSED,z),U()},z=()=>{this.off(ut.WS_CONNECTED,F),k(new _e(K.WS_ABORT))};this.once(ut.WS_CONNECTED,F),this.once(ut.WS_CLOSED,z)});if(this.connectionState!==is.CONNECTING&&this.connectionState!==is.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await f(),this.websocket.sendMessage(h,!0),c)return;let _=new Ve((U,k)=>{let F=!1,z=(X,re)=>{F=!0,U({isSuccess:X==="success",message:re||{}}),this.off(ut.WS_CLOSED,Y),this.off(ut.WS_RECONNECTING,Y),this.emit(ut.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(d),z);let Y=()=>{k(new _e(K.WS_ABORT,"type: ".concat(t))),this.off(ut.WS_CLOSED,Y),this.off(ut.WS_RECONNECTING,Y),this.off("res-@".concat(d),z)};this.once(ut.WS_CLOSED,Y),this.once(ut.WS_RECONNECTING,Y),pr($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||F||(A.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ut.REQUEST_TIMEOUT,t,s))})}),v=null;try{v=await _}catch(U){if(this.connectionState===is.CLOSED||t===lt.LEAVE)throw new _e(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?U.throw():t===lt.JOIN||t===lt.REJOIN?null:(await f(),await this.request(t,s))}if(v.isSuccess)return v.message;let b=Number(v.message.error_code||v.message.code),w=qm(b),T=new _e(K.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(v.message.error_str),{code:b,data:v.message,desc:w.desc});return w.action==="success"?v.message:(A.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(b,", message: ").concat(w.desc,", action: ").concat(w.action)),b===at.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=T,this.close()),T.throw()):w.action==="failed"?T.throw():w.action==="quit"?(this.initError=T,this.close(),T.throw()):(b===at.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Sr.MULTI_IP)):this.reconnect(w.action,Sr.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new Ve(a=>{let c=d=>{(!s||s(d))&&(this.off(t,c),a(d))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(zm.WRTC_STATS,s)}upload(t,s){let a={_type:t,_message:s};try{this.websocket.sendMessage(a)}catch{let c=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==is.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,s){let a={_type:t,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(t,s,a){return await this._external_signal.send(t,s,a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ve((s,a)=>{this.once(ut.WS_CONNECTED,()=>s(this.joinResponse)),this.once(ut.WS_CLOSED,()=>a(this.initError||new _e(K.WS_ABORT))),this.connectionState=is.CONNECTING,this.websocket.init(t).catch(a)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Gt.LEAVE,this.connectionState=is.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ts(6,""),this._external_signal.clear(),this._external_signal=new Rd(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ut.ABORT_P2P_EXECUTION);let t=await Cr(this,ut.REQUEST_JOIN_INFO),s=await this.request(lt.JOIN,t);if(!s)return this.emit(ut.REPORT_JOIN_GATEWAY,K.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(ut.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=is.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){return!1}handleDataStream(t){try{var s;let a=od(t.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||je(s=Object.values(ks)).call(s,d._type)?(d._uid=t.uid,this._external_signal.onMessage(d)):this.emit(Nt.ON_DATA_STREAM,t)}catch{this.emit(Nt.ON_DATA_STREAM,t)}}handleNotification(t){A.debug("[".concat(this.clientId,"] receive notification: "),t);let s=qm(t.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Gt.UID_BANNED),void this.close()):void this.reconnect(s.action,Sr.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=$("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(A.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Sr.TIMEOUT):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let a=Date.now()-s;this.rttRolling.add(a),$("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ut.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=is.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Gt.NETWORK_ERROR,this.connectionState=is.CLOSED}),this.websocket.on(_t.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===is.CONNECTED?this.connectionState=is.RECONNECTING:this.connectionState=is.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(t,s,a)=>{t!=="retry"?(A.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):A.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(t)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ut.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof _e&&t.code===K.UNEXPECTED_RESPONSE&&t.data.code===at.ERR_NO_AUTHORIZED)return A.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Sr.SERVER_ERROR);A.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Sr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(_t.REQUEST_NEW_URLS,(t,s)=>{Cr(this,ut.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let ele={name:"P2PChannel",create:function(e){let{store:t,statsCollector:s}=e;return new Qce(t,s)},createSubmodule:function(e){let{store:t,spec:s}=e;return new Zce(s,t)}};function Y4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function $4(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Y4(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Y4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}class tle{constructor(t){B(this,"sessionDesc",void 0),B(this,"localCapabilities",void 0),B(this,"rtpCapabilities",void 0),B(this,"candidates",void 0),B(this,"_originCandidates",void 0),B(this,"iceParameters",void 0),B(this,"dtlsParameters",void 0),B(this,"setup",void 0),B(this,"currentMidIndex",void 0),B(this,"cname",void 0),t=Es(t);let{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:p,sdkCodec:f,cname:_}=t,v=xn(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=Es(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=p,this.cname=_;for(let b=0;b<v.mediaDescriptions.length;b++){let w=v.mediaDescriptions[b];if(w.attributes.iceUfrag=s.iceUfrag,w.attributes.icePwd=s.icePwd,w.attributes.fingerprints=a.fingerprints,w.attributes.candidates=c,w.attributes.setup=h,w.media.mediaType==="video"){w.media.fmts=d.videoCodecs.map(k=>k.payloadType.toString(10));let T=d.videoCodecs.filter(k=>{var F,z;return(F=k.rtpMap)===null||F===void 0?void 0:je(z=F.encodingName.toLowerCase()).call(z,f)}),U=d.videoCodecs.filter(k=>!je(T).call(T,k));w.attributes.payloads=[...T,...U],w.attributes.extmaps=d.videoExtensions}w.media.mediaType==="audio"&&(w.media.fmts=d.audioCodecs.map(T=>T.payloadType.toString(10)),w.attributes.payloads=d.audioCodecs,w.attributes.extmaps=d.audioExtensions),v.mediaDescriptions[b]=this.mungMediaDesc(w)}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return Bc(this.sessionDesc)}send(t,s,a){let{ssrcs:c,ssrcGroups:d}=Jm(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(_=>t===ze.VIDEO?_.media.mediaType==="video":_.media.mediaType==="audio"),p=c[0].attributes.label,f=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:p,mslabel:f}}batchSend(t){return t.map(s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(s=>{let a=[],c=[],d=[];s.attributes.ssrcs.forEach(h=>{je(t).call(t,h.attributes.label||"")?d.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var p;je(p=d.map(f=>f.ssrcId)).call(p,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c})}mute(t){let s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(t){let s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(t,s,a){t.forEach((c,d)=>{let h=c._mediaStreamTrack,p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===h.kind),f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],c);this.sessionDesc.mediaDescriptions[p]=f})}stopReceiving(t){}updateCandidates(t){let s=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(s.forEach(c=>{a.push($4($4({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(t){case Pr.TCP_RELAY:this.candidates=a;break;case Pr.UDP_TCP_RELAY:case Pr.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(let c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=Es(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=t.iceUfrag,s.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let s=[];for(let a=0;a<t;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(t,s){let a=Es(t);return xh(a,s),wC(a,s),a}updateRecvMedia(t,s){let a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===t);if(a!==-1){let c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,s,a){let c=this.sessionDesc.mediaDescriptions.find(h=>t===ze.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){let h=c.attributes.ssrcs.find(p=>p.attributes.label===s);var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(t){let s=Es(t);return bC(s),function(a){let c=a.attributes.extmaps.find(d=>uE(d.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(d=>{let h=d.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(t){for(let s of this.sessionDesc.mediaDescriptions)for(let a of s.attributes.ssrcs)if(a.attributes.label===t)return[a]}}var ss;function X4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,a)}return s}function JE(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?X4(Object(s),!0).forEach(function(a){B(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):X4(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}let sle=(ss=class Yf extends dU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return je(s=Object.keys(Vm)).call(s,t)}))]}constructor(t,s){super(t,s),B(this,"store",void 0),B(this,"peerConnection",void 0),B(this,"remoteSDP",void 0),B(this,"initialOffer",void 0),B(this,"statsFilter",void 0),B(this,"useRTX",!1),B(this,"localCapabilities",void 0),B(this,"localCandidateCount",0),B(this,"allCandidatesReceived",!1),B(this,"establishPromise",void 0),B(this,"mutex",void 0),this.store=s,this.mutex=new Dr("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Yf.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=D0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,Cs()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let s=qc(t.sdp),a=Xm(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=t,JE(JE({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:t.sdp})}catch(t){throw new _e(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new tle(JE(JE({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(t,s){throw new _e(K.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,s){var a=this;return wi(function*(){let c=yield Ot(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=t.map(w=>a.peerConnection.addTrack(w._mediaStreamTrack)),h=yield Ot(a.peerConnection.createOffer()),p=xn(h.sdp),f=t.map(w=>{let T=w._mediaStreamTrack,U=p.mediaDescriptions.find(k=>k.attributes.mid===T.kind);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return function(k,F,z){let Y=k.attributes.ssrcs.filter(re=>re.attributes.label===F),X=k.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(X&&Y.length>1){let re=X.find(te=>te.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return re?[{ssrcId:re.ssrcIds[0],rtx:z?re.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(U,T.id,a.useRTX)}),_;try{_=yield f}catch(w){throw d.forEach(T=>{wr()&&T.replaceTrack(null),a.peerConnection.removeTrack(T)}),w}let v=a.mungSendOfferSDP(h.sdp,t);a.remoteSDP.receive(t,s,_);let b=a.remoteSDP.toString();return yield Ot(a.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ot(a.applySendEncodings(d,t)),yield Ot(a.peerConnection.setRemoteDescription({type:"answer",sdp:b})),t.map((w,T)=>{let U=w._mediaStreamTrack.id;return{localSSRC:f[T],id:U}})}catch(d){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let s=this.peerConnection.getSenders().filter(d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{wr()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});let a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(t,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:d,mslabel:h}=this.remoteSDP.send(t,s,c),p=new Ve((v,b)=>{let w=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(d)))},1e4),T=U=>{let k=At();if((k.name==="Safari"&&Number(k.version)===11||Br())&&U.track.id!==d&&U.streams[0].id===h){var F;let z=U.streams[0].getTracks()[0];return(F=this.remoteSDP)===null||F===void 0||F.updateTrackLabel(t,d,U.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(w),void v(z)}if(U.track.id===d)return this.peerConnection.removeEventListener("track",T),clearTimeout(w),void v(U.track)};this.peerConnection.addEventListener("track",T)}),f=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:f});let _=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(_),{track:await p,id:d}}catch(d){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let s=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==t.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(wr()&&a.track)a.track.enabled=!1;else{let c=a.getParameters();c.encodings.forEach(d=>d.active=!1),a.setParameters(c)}})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let s=this.peerConnection.getSenders().filter(d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(wr()&&d.track)d.track.enabled=!0;else{let h=d.getParameters();h.encodings.forEach(p=>p.active=!0),await d.setParameters(h)}});let a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return wi(function*(){let a=yield Ot(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=jt().supportPCSetConfiguration;if(t===Pr.RELAY&&!c)return;if(c){let _=s.peerConnection.getConfiguration(),v=t===Pr.RELAY?"relay":"all";_.iceTransportPolicy!==v&&(A.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(v,"]")),_.iceTransportPolicy=v,s.peerConnection.setConfiguration(_))}t!==Pr.RELAY&&s.remoteSDP.updateCandidates(t);let d=yield Ot(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let h=qc(d.sdp),{remoteIceParameters:p}=yield h.iceParameters;s.remoteSDP.restartICE(p);let f=s.remoteSDP.toString();yield Ot(s.peerConnection.setLocalDescription(d)),yield Ot(s.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(c){A.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);let d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new _e(K.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,s){let a=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===t});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){let a=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s});a&&await a.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,s){throw new _e(K.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new _e(K.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let s={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(km(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...Yf.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Yf.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(t){let s=[];return t.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(t,s){var a;if(s||(s=this.peerConnection.getSenders().find(_=>{var v;return((v=_.track)===null||v===void 0?void 0:v.id)===t._mediaStreamTrack.id})),!s)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!jt().supportSetRtpSenderParameters)return A.warn("Browser not support set rtp-sender parameters");let c={},d={};if(t instanceof as)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if($("DSCP_TYPE")&&tc()){var h;let _=$("DSCP_TYPE");je(h=["very-low","low","medium","high"]).call(h,_)&&(d.networkPriority=_)}let p=s.getParameters(),f=(a=p.encodings)===null||a===void 0?void 0:a[0];f&&Object.assign(f,d),Object.assign(p,c),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await s.setParameters(p)}async applySendEncodings(t,s){try{if(!jt().supportSetRtpSenderParameters||t.length!==s.length)return;for(let a=0;a<t.length;a++){let c=t[a],d=s[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s){let a=xn(t);return s.forEach((c,d)=>{let h=c._mediaStreamTrack,p=a.mediaDescriptions.find(f=>f.attributes.mid===h.kind);p&&xh(p,c)}),Bc(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let s=this.remoteSDP.batchSend(t).map((d,h)=>{let{id:p,mslabel:f}=d,{kind:_}=t[h];return new Ve((v,b)=>{let w=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(p)))},1e4),T=U=>{let k=At();if(k.name==="Safari"&&Number(k.version)===11&&U.track.id!==p&&U.streams[0].id===f){var F;let z=U.streams[0].getTracks()[0];return(F=this.remoteSDP)===null||F===void 0||F.updateTrackLabel(_,p,U.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(w),void v({track:z,id:p})}if(U.track.id===p)return this.peerConnection.removeEventListener("track",T),clearTimeout(w),void v({track:U.track,id:p})};this.peerConnection.addEventListener("track",T)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});let c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await Ve.all(s)}catch(s){throw new _e(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let s=this.remoteSDP.getSSRC(t);return s==null?void 0:s[0].ssrcId}setConfiguration(t){if(jt().supportPCSetConfiguration){let s=Yf.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}}},Je(ss.prototype,"connect",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"connect"),ss.prototype),Je(ss.prototype,"stopSending",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"stopSending"),ss.prototype),Je(ss.prototype,"receive",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"receive"),ss.prototype),Je(ss.prototype,"stopReceiving",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"stopReceiving"),ss.prototype),Je(ss.prototype,"muteRemote",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"muteRemote"),ss.prototype),Je(ss.prototype,"unmuteRemote",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"unmuteRemote"),ss.prototype),Je(ss.prototype,"muteLocal",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"muteLocal"),ss.prototype),Je(ss.prototype,"unmuteLocal",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"unmuteLocal"),ss.prototype),Je(ss.prototype,"close",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"close"),ss.prototype),Je(ss.prototype,"updateEncoderConfig",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"updateEncoderConfig"),ss.prototype),Je(ss.prototype,"updateSendParameters",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"updateSendParameters"),ss.prototype),Je(ss.prototype,"replaceTrack",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"replaceTrack"),ss.prototype),Je(ss.prototype,"getRemoteSSRC",[Oi],Object.getOwnPropertyDescriptor(ss.prototype,"getRemoteSSRC"),ss.prototype),ss);function Oi(e,t,s){let a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(t));try{for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{d()}},s}let rle={name:"PlanBConnection",create:function(e){let{store:t,spec:s}=e;return new sle(s,t)}},nle={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jt().supportWebRTCEncodedTransform)return void A.warning("browser not support audio encoded transform");if(Yv.has(e)||!e.track)return;let s={track:e.track};if(ec()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void A.error("create audio-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){s.controller||(s.controller=p),e.track&&e.track.id!==s.track.id&&(A.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a));let f=t.metadata&&t.metadata();f?function(_,v){let{chunk:b,controller:w}=v,T=Wc.METADATA;b.data=function(U,k,F){let z=F.byteLength,Y=z+sC+qF,X=eC+tC+Y,re=new ArrayBuffer(U.byteLength+X),te=new DataView(re);te.setUint8(0,KF),te.setUint16(1,Y),te.setUint8(3,k),te.setUint16(4,z);for(let de=0;de<z;de++)te.setUint8(6+de,F[de]);let Z=new Uint8Array(te.buffer);return Z.set(new Uint8Array(U),X),Z.buffer}(b.data,T,_),w.enqueue(b)}(f,{chunk:h,controller:p}):p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(wr()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");let c=qv(),d=new MessageChannel;await new Ve(p=>c.onmessage=f=>{f.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);e.transform=h,await new Ve(p=>c.onmessage=f=>{f.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var f;if(p.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==s.track.id)A.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a);else if(p.data.getMetadata){let _=t.metadata&&t.metadata();_&&d.port1.postMessage({metadata:_})}},s.worker=c}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}let c=Yv.get(e);if(c){Yv.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){A.warning(p&&p.message)}}}Yv.set(e,s),e.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jt().supportWebRTCEncodedTransform)return void A.warning("browser not support audio encoded transform");if(eE.has(e))return;let s={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ec()&&!Br()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");u0(Lt.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void A.error("create audio-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){s.controller||(s.controller=p),e.track&&e.track.id!==s.track.id&&(A.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a)),t.enableTopn?function(f,_,v){var b;let w=rC(new DataView(_.data));if(!w)return v.enqueue(_);let T=f.track.id;Fie.set(T,f.track);let U=(b=w.tlv.find(re=>re.tag===Wc.AUDIO_LEVEL))===null||b===void 0?void 0:b.value,k=0;typeof U=="number"&&(k=127-U);let F=Math.round(Math.pow(10,k/60)-1),{selected:z,speaker:Y}=function(re,te){let Z=mh.get(re);if(Z||(Z=function(de){let xe=new $F;return mh.set(de,xe),Fa||(Fa=new Lie($("TOPN_SILENCE_THRESHOLD")||500),Fa.on("ActiveSpeakerChanged",Se=>{Se!=null&&(Jv=Se)})),Fa.addSpeakers([xe]),xe}(re)),mh.size<=XF)return{selected:!0,speaker:Z};if(!Fa)throw new Error("no active speaker detector");return Fa.levelChanged(Z.id,te),md=Fa.loudest.map(de=>de.id),Jv&&!je(md).call(md,Jv)&&md.length>=XF&&md.pop(),{selected:je(md).call(md,Z.id)||Z.id===Jv,speaker:Z}}(f,F),X=function(re,te,Z){let de=Ua.get(re)||new Mie(re,te);return de.score=Z,Ua.set(re,de),function(xe){if(Qv.set(xe,!0),!Zv)return void(Zv=Date.now());let Se=Date.now();Se-Zv>1e3&&(Qv.get(xe)?Qv.set(xe,!1):(JF(xe),Qv.delete(xe)),Zv=Se)}(re),de}(T,f.track,Y.energyScore);X.addSample(z),X.active&&(_.data=w.frame.buffer,v.enqueue(_))}(e,h,p):t.enableMetadata||t.enablePts?function(f,_,v,b){let w=new DataView(f.data),T=w.getUint8(0),U;if(128&T&&T!==71){let z=function(Y){if(Y.byteLength<=0)return[];let X=[],re=0;for(;re<Y.byteLength;){let Z=(128&Y.getUint8(re))>>7,de=127&Y.getUint8(re);if(!(Z&&re+4<=Y.byteLength)){re++;break}{let xe=Y.getUint32(re,!1),Se=(16776192&xe)>>10,Ae=1023&xe;X.push({pt:de,ts_offset:Se,length:Ae,data:new Uint8Array}),re+=4}}let te=Y.byteLength-re;for(let Z of X){if(Z.length>te)return console.warn("Broken red payload"),[];Z.length>0&&(Z.data=new Uint8Array(Y.buffer,Y.byteOffset+re,Z.length),re+=Z.length,te-=Z.length)}if(te>0){let Z={pt:X.length>0?X[X.length-1].pt:0,ts_offset:0,length:te,data:new Uint8Array(Y.buffer,Y.byteOffset+re,te)};X.push(Z)}return X}(w);if(z.length>0){let Y=function(X){let re=0;for(let de=0;de<X.length;de++)re+=de<X.length-1?4:1,re+=X[de].length;let te=new Uint8Array(re),Z=0;for(let de=0;de<X.length;de++)if(de<X.length-1){let xe=(2147483648|(127&X[de].pt)<<24|(262143&X[de].ts_offset)<<10|1023&X[de].length)>>>0;te[Z++]=xe>>24&255,te[Z++]=xe>>16&255,te[Z++]=xe>>8&255,te[Z++]=255&xe}else te[Z++]=127&X[de].pt;for(let de of X)te.set(de.data,Z),Z+=de.length;return te}(z.map(X=>{let re=new Uint8Array(X.length);re.set(X.data);let te=rC(new DataView(re.buffer));return te!=null&&te.frame&&(X.data=te==null?void 0:te.frame),U=te,X}));f.data=Y.buffer}}else U=rC(w),U&&(f.data=U.frame.buffer);if(_.enqueue(f),!U)return;let k=U.tlv.find(z=>z.tag===Wc.METADATA);k&&v&&k.value instanceof Uint8Array&&v(k.value);let F=U.tlv.find(z=>z.tag===Wc.AUDIO_64_BIT_PTS);F&&b&&F.value instanceof Uint8Array&&F.value.length==8&&b(new DataView(F.value.buffer).getBigUint64(0,!0))}(h,p,t.onMetadata,t.onPts):p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");let c=qv(),d=new MessageChannel;await new Ve(p=>c.onmessage=f=>{f.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);e.transform=h,await new Ve(p=>c.onmessage=f=>{f.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var f;p.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==s.track.id?(A.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a)):p.data.metadata&&s.onMetadata?s.onMetadata(p.data.metadata):p.data.pts&&s.onPts&&s.onPts(p.data.pts)},s.worker=c}function a(){e.track.removeEventListener("ended",a),function(c){let d=eE.get(c);if(d){(function(f){let _=mh.get(f);_&&(mh.delete(f),Fa&&(Fa.removeSpeakers([_]),mh.size===0&&(Fa.destroy(),Fa=null)))})(c),JF(c.track.id),eE.delete(c);try{var h,p;(h=d.controller)===null||h===void 0||h.terminate(),(p=d.worker)===null||p===void 0||p.terminate()}catch(f){A.warning(f&&f.message)}}}(e)}eE.set(e,s),e.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(e,t){if(!jt().supportWebRTCEncodedTransform)return void A.warning("browser not support video encoded transform");if(tE.has(e)||!e.track)return;let s={track:e.track};if(ec()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(p){return void A.error("create video-encoded-streams error",p&&p.message)}let d=[];t.on("sei-to-send",p=>{d.push(p)});let h=new TransformStream({transform(p,f){s.controller||(s.controller=f),e.track&&e.track.id!==s.track.id&&(A.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a));let _=eU(new Uint8Array(p.data)),v=d.shift();if(v){let b=function(w,T,U){switch(U){case oC:return function(k,F){let z=ZF(F),Y=z.length,X=Math.floor(Y/255),re=Y%255,te=new Uint8Array(6+X+1+Y+k.byteLength);te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=6,te[5]=101;let Z=0;for(;Z<X;)te[6+Z]=255,Z++;return te[6+Z]=re,Z++,te.set(z,6+Z),te.set(new Uint8Array(k),6+Z+Y),te.buffer}(w,T);case cC:return function(k,F){let z=ZF(F),Y=z.length,X=Math.floor(Y/255),re=Y%255,te=new Uint8Array(7+X+1+Y+1+k.byteLength);te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=78,te[5]=1,te[6]=101;let Z=0;for(;Z<X;)te[7+Z]=255,Z++;return te[7+Z]=re,Z++,te.set(z,7+Z),Z+=Y,te[7+Z]=128,Z++,te.set(new Uint8Array(k),7+Z),te.buffer}(w,T);default:return null}}(p.data,v,_);b&&(p.data=b)}f.enqueue(p)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!wr())return;{if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");let c=qv(),d=new MessageChannel;await new Ve(p=>c.onmessage=f=>{f.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);e.transform=h,await new Ve(p=>c.onmessage=f=>{f.data==="started"&&p(void 0)}),t.on("sei-to-send",p=>{d.port1.postMessage({sei:p})}),d.port1.onmessage=p=>{var f;p.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==s.track.id&&(A.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}let c=tE.get(e);if(c){tE.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){A.warning(p&&p.message)}}}tE.set(e,s),e.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jt().supportWebRTCEncodedTransform)return void A.warning("browser not support video encoded transform");if(!e.track)return;if(Hm.has(e)){let c=Hm.get(e);return void(c&&(c.onSei=t.onSei))}let s={track:e.track,onSei:t.onSei};if(ec()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void A.error("create video-encoded-streams error",h&&h.message)}let d=new TransformStream({transform(h,p){s.controller||(s.controller=p),e.track&&e.track.id!==s.track.id&&(A.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a));let f=function(_,v){switch(v){case oC:return function(b){let w=new DataView(b.data),T=0;for(;T+4<b.data.byteLength;){if(w.getUint8(T+0)===0&&w.getUint8(T+1)===0&&w.getUint8(T+2)===0&&w.getUint8(T+3)===1&&w.getUint8(T+4)===6){let U=T+6,k=0,F=0;for(;(F=w.getUint8(U++))===255;)k+=255;k+=F;let z=QF(b.data,U,k);return new Uint8Array(z)}T++}return null}(_);case cC:return function(b){let w=new DataView(b.data),T=0;for(;T+5<b.data.byteLength;){if(w.getUint8(T+0)===0&&w.getUint8(T+1)===0&&w.getUint8(T+2)===0&&w.getUint8(T+3)===1&&w.getUint8(T+4)===78&&w.getUint8(T+5)===1&&w.getUint8(T+6)===101){let U=T+7,k=0,F=0;for(;(F=w.getUint8(U++))===255;)k+=255;k+=F;let z=QF(b.data,U,k);return new Uint8Array(z)}T++}return null}(_);default:return null}}(h,eU(new Uint8Array(h.data)));f&&s.onSei&&s.onSei(f),p.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(wr()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");let c=qv(),d=new MessageChannel;await new Ve(p=>c.onmessage=f=>{f.data==="registered"&&p(void 0)});let h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);e.transform=h,await new Ve(p=>c.onmessage=f=>{f.data==="started"&&p(void 0)}),d.port1.onmessage=p=>{var f;p.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==s.track.id?(A.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",a),s.track=e.track,s.track.addEventListener("ended",a)):p.data.sei&&s.onSei&&s.onSei(p.data.sei)},s.worker=c}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}(function(c){let d=Hm.get(c);if(d){Hm.delete(c);try{var h,p;(h=d.controller)===null||h===void 0||h.terminate(),(p=d.worker)===null||p===void 0||p.terminate()}catch(f){A.warning(f&&f.message)}}})(e)}Hm.set(e,s),e.track.addEventListener("ended",a)}},ile={name:"InterceptFrame",create:()=>nle};O0(),$t("PROCESS_ID","process-".concat(ts(8,""),"-").concat(ts(4,""),"-").concat(ts(4,""),"-").concat(ts(4,""),"-").concat(ts(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void A.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),s=Date.now();A.debug("Loading global parameters from cache",t),Object.keys(t).forEach(a=>{if(Object.prototype.hasOwnProperty.call(gs,a)){let{value:c,expires:d}=t[a];if(d&&d<=s)return;Ma[a]=c,gs[a]=c}})}catch(t){A.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Ma.AREAS)&&Ma.AREAS.length>0&&NC(Ma.AREAS,!0);let J4=(e,t,s)=>{A.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),$t(e,t,s)};Xc(Rce,!1),Xc(Dce,!1),Xc(doe,!1),Xc(Wce,!1),Xc(Cce,!1),Xc(ele,!1),Xc(rle,!1),Xc(ile,!1);let zs=function(e){let t=new bs,s=e,a={getListeners:t.getListeners.bind(t),on:(c,d)=>(function(h,p){h===So.SECURITY_POLICY_VIOLATION&&DV(p,!0)}(c,d),t.on.bind(t)(c,d)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return IV(IV({},s),a)}({__TRACK_LIST__:ih,VERSION:Si,BUILD:k0,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:J4,getParameter:$,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,s=await async function(a){let c;return jt().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(t);if(!s)return e;t.close(),t=null,e=function(a){let c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(t){throw new ue(K.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=Qe.reportApiInvoke(null,{name:Os.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:vs.TRACER}),t=!1;try{let d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;t=!!(d&&h&&p),t&&_0()&&Q2(75)&&new d().close()}catch(d){return A.error("check system requirement failed: ",d),!1}let s=!1,a=At();a.name===Lt.CHROME&&Number(a.version)>=58&&(Pa.engine.name!=="WebKit"||function(){let d=At();if(Iv()){if(d.os===sr.MAC_OS)return!0;if(d.os===sr.IOS){let h=Pa.os.version&&Pa.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(a.name===Lt.FIREFOX&&Number(a.version)>=56||a.name===Lt.OPERA&&Number(a.version)>=45||a.name===Lt.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(Br()||Zi())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||nL()||At().name===Lt.QQ)&&(s=!0),A.debug("checkSystemRequirements, api:",t,"browser",s);let c=t&&s;return e.onSuccess(c),c},getDevices:function(e){return li.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return li.getRecordingDevices(e)},getCameras:function(e){return li.getCamerasDevices(e)},getElectronScreenSources:QL,getPlaybackDevices:function(e){return li.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},s=ts(5,"client-"),a=Qe.reportApiInvoke(null,{id:s,name:Os.CREATE_CLIENT,options:[t],tag:vs.TRACER});try{(function(c){Qs(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Qs(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Qs(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&hr(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&hL(c.turnServer),c.httpRetryConfig!==void 0&&uL(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&uL(c.websocketRetryConfig)})(t)}catch(c){throw a.onError(c),c}return(tL(16,0)||m0(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",A.debug("browser not support vp9, force use vp8")),$t("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),a.onSuccess(),new uoe(ca(ca({forceWaitGatewayResponse:!0},t),{},{role:je(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),s)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=$("CAMERA_CAPTURE_CONFIG"),s=ts(8,"track-cam-"),a=Qe.reportApiInvoke(null,{id:s,tag:vs.TRACER,name:Os.CREATE_CAM_VIDEO_TRACK,options:[ns({},e),t]});t&&(e.encoderConfig=t);let c=zv(e),d=null;A.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{d=(await ci({video:c},s)).getVideoTracks()[0]||null}catch(p){throw a.onError(p),p}if(!d){let p=new _e(K.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(p),p.throw(A)}if(e.optimizationMode&&Z0(s,d,e,sa(e.encoderConfig)),$("USE_STANDARD_BITRATE_DEFAULT")){let p=sa(e.encoderConfig);e.encoderConfig=p,delete p.bitrateMax,delete p.bitrateMin}let h=new Kv(d,e,c,e.scalabiltyMode?Bv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return a.onSuccess(h.getTrackId()),A.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(e){let t=ts(8,"track-cus-"),s=Qe.reportApiInvoke(null,{id:t,tag:vs.TRACER,name:Os.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});$("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);let a=new as(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Bv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Zt.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),A.info("create custom video track success with config",e,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",s=typeof t=="object"?function(w){return cM(w)}(t):void 0;s&&(t="auto");let a=ts(8,"track-scr-v-"),c=Qe.reportApiInvoke(null,{id:a,tag:vs.TRACER,name:Os.CREATE_SCREEN_VIDEO_TRACK,options:[ns({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let d=function(w){let T={};w.screenSourceType&&(T.mediaSource=w.screenSourceType),w.extensionId&&ec()&&(T.extensionId=w.extensionId);let{displaySurface:U,selfBrowserSurface:k,surfaceSwitching:F,systemAudio:z,preferCurrentTab:Y}=w;(Xu(107)||h0(107)||f0(93))&&(U&&(Qs(U,"displaySurface",["browser","window","monitor"]),T.displaySurface=U),k?(Qs(k,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=k):T.selfBrowserSurface="include",F&&(Qs(F,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=F)),(Xu(105)||h0(105)||f0(91))&&z&&(Qs(z,"systemAudio",["exclude","include"]),T.systemAudio=z),(Xu(94)||h0(94)||f0(80))&&Y&&(T.preferCurrentTab=!0),w.electronScreenSourceId&&(T.sourceId=w.electronScreenSourceId);let X=w.encoderConfig?B0(w.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:X?X.width:void 0,maxHeight:X?X.height:void 0},X&&(X.frameRate&&(typeof X.frameRate=="number"?(T.mandatory.maxFrameRate=X.frameRate,T.mandatory.minFrameRate=X.frameRate):(T.mandatory.maxFrameRate=X.frameRate.max||X.frameRate.ideal||X.frameRate.exact||void 0,T.mandatory.minFrameRate=X.frameRate.min||X.frameRate.ideal||X.frameRate.exact||void 0),T.frameRate=X.frameRate),X.width&&(T.width=X.width),X.height&&(T.height=X.height)),T}(e),h=null,p=null,f=jt();if(!f.supportShareAudio&&t==="enable"){let w=new _e(K.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(w),w.throw(A)}A.info("start create screen video track with config",e,"withAudio",t,"trackId",a);let _=f.supportShareAudio&&t!=="disable";try{let w=await ci({screen:d,screenAudio:_?s||!0:void 0},a);h=w.getVideoTracks()[0]||null,p=w.getAudioTracks()[0]||null}catch(w){throw c.onError(w),w}if(!h){let w=new _e(K.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(w),w.throw(A)}if(!p&&t==="enable"){h&&h.stop();let w=new _e(K.SHARE_AUDIO_NOT_ALLOWED);return c.onError(w),w.throw(A)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Z0(a,h,e,e.encoderConfig&&B0(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let v=new as(h,e.encoderConfig?B0(e.encoderConfig):{},e.scalabiltyMode?Bv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a,[Zt.SCREEN_TRACK]);if(!p)return c.onSuccess(v.getTrackId()),A.info("create screen video track success","video:",v.getTrackId()),v;let b=new Is(p,void 0,ts(8,"track-scr-a-"),!1);return c.onSuccess([v.getTrackId(),b.getTrackId()]),A.info("create screen video track success","video:",v.getTrackId(),"audio:",b.getTrackId()),[v,b]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=$("CAMERA_CAPTURE_CONFIG"),a=ts(8,"track-mic-"),c=ts(8,"track-cam-"),d=Qe.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:vs.TRACER,name:Os.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,s]});s&&(t.encoderConfig=s);let h=zv(t),p=lM(e),f=null,_=null;A.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let w=await ci({audio:p,video:h},"".concat(a,"-").concat(c));f=w.getAudioTracks()[0],_=w.getVideoTracks()[0]}catch(w){throw d.onError(w),w}if(!f||!_){let w=new _e(K.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(w),w.throw(A)}if(t.optimizationMode&&Z0(c,_,t,sa(t.encoderConfig)),$("USE_STANDARD_BITRATE_DEFAULT")){let w=sa(t.encoderConfig);t.encoderConfig=w,delete w.bitrateMax,delete w.bitrateMin}let v=new Gm(f,e,p,a),b=new Kv(_,t,h,t.scalabiltyMode?Bv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return d.onSuccess([v.getTrackId(),b.getTrackId()]),A.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[v,b]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=ts(8,"track-mic-"),s=Qe.reportApiInvoke(null,{id:t,tag:vs.TRACER,name:Os.CREATE_MIC_AUDIO_TRACK,options:[e]}),a=lM(e),c=null;A.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await ci({audio:a},t)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){let h=new _e(K.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(A)}let d=new Gm(c,e,a,t);return s.onSuccess(d.getTrackId()),A.info("create microphone audio track success, trackId:",t),d},createCustomAudioTrack:function(e){let t=ts(8,"track-cus-"),s=Qe.reportApiInvoke(null,{id:t,tag:vs.TRACER,name:Os.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),a=new Is(e.mediaStreamTrack,e.encoderConfig?Wv(e.encoderConfig):{},t,!1);return A.info("create custom audio track success with config",e,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:s,encoderConfig:a}=e,{source:c}=e,d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:s,encoderConfig:a},h=ts(8,"track-buf-"),p=Qe.reportApiInvoke(null,{id:h,tag:vs.TRACER,name:Os.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if($("DISABLE_WEBAUDIO"))throw new _e(K.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");A.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);let f=c;if(!(c instanceof AudioBuffer))try{c=await async function(b,w){let T=null;if(typeof b=="string"){let k=$M.get(b);if(k)return A.debug("use cached audio resource: ",b),k;try{T=(await La(()=>dn.get(b,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(F){throw new _e(K.FETCH_AUDIO_FILE_FAILED,F.toString())}}else T=await new Ve((k,F)=>{let z=new FileReader;z.onload=Y=>{Y.target?k(Y.target.result):F(new _e(K.READ_LOCAL_AUDIO_FILE_ERROR))},z.onerror=()=>{F(new _e(K.READ_LOCAL_AUDIO_FILE_ERROR))},z.readAsArrayBuffer(b)});let U=await function(k){let F=dh();return new Ve((z,Y)=>{F.decodeAudioData(k,X=>{z(X)},X=>{Y(new _e(K.DECODE_AUDIO_FILE_FAILED,X.toString()))})})}(T);return typeof b=="string"&&w&&$M.set(b,U),U}(c,s)}catch(b){return p.onError(b),b.throw(A)}let _=new Die(c),v=new Iie(f,_,a?Wv(a):{},h);return A.info("create buffer source audio track success, trackId:",h),p.onSuccess(v.getTrackId()),v},setAppType:function(e){if(A.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw A.debug("Invalid appType"),new ue(K.INVALID_PARAMS,"invalid app type",e);$t("APP_TYPE",Math.floor(e))},setLogLevel:function(e){A.setLogLevel(e)},enableLogUpload:function(){$("USE_NEW_LOG")?$t("UPLOAD_LOG",!0):A.enableLogUpload()},disableLogUpload:function(){$("USE_NEW_LOG")?$t("UPLOAD_LOG",!1):A.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new QU},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,s=Qe.reportApiInvoke(null,{tag:vs.TRACER,name:Os.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Is||e instanceof ph)){let f=new ue(K.INVALID_TRACK,"the parameter is not a audio track");return s.onError(f),f.throw()}t&&t<1e3&&(t=1e3);let a=e instanceof Is?e.getTrackLabel():"remote_track",c=e.getVolumeLevel(),d=c,h=c,p=Date.now();return new Ve(f=>{let _=setInterval(()=>{let v=e.getVolumeLevel();d=v>d?v:d,h=v<h?v:h;let b=d-h>1e-4,w=Date.now()-p;if(b||w>t){clearInterval(_);let T=b,U={duration:w,deviceLabel:a,maxVolumeLevel:d,result:T};A.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(U))),s.onSuccess(U),f(T)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,s=Qe.reportApiInvoke(null,{tag:vs.TRACER,name:Os.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof as||e instanceof hh)){let b=new ue(K.INVALID_TRACK,"the parameter is not a video track");return s.onError(b),b.throw()}t&&t<1e3&&(t=1e3);let a=e instanceof as?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(wr()||Iv())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();let h=document.createElement("canvas");h.width=160,h.height=120;let p=0,f=0;try{let b=Date.now();p=await function(w,T,U,k){let F,z=0,Y=null;return new Ve((X,re)=>{function te(){z>k&&F&&(F(),X(z));let Z=U.getContext("2d");if(!Z){let Se=new ue(K.UNEXPECTED_ERROR,"can not get canvas 2d context.");return A.error(Se.toString()),void re(Se)}Z.drawImage(w,0,0,160,120);let de=Z.getImageData(0,0,U.width,U.height),xe=Math.floor(de.data.length/3);if(Y){for(let Se=0;Se<xe;Se+=3)if(de.data[Se]!==Y[Se])return z+=1,void(Y=de.data);Y=de.data}else Y=de.data}setTimeout(()=>{F&&(F(),X(z))},T),F=K0(()=>{te()},30)})}(d,t,h,4),f=Date.now()-b}catch(b){throw s.onError(b),b}Xae===Lt.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;let _=p>4,v={duration:f,changedPicNum:p,deviceLabel:a,result:_};return A.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),s.onSuccess(v),_},setArea:NC,audioElementPlayCenter:un,resumeAudioContext:function(){un.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){poe.processExternalMediaAEC(e)},registerExtensions:function(e){let t=$("PLUGIN_INFO")||[];e.forEach(s=>{"name"in s&&!je(t).call(t,s.name)&&t.push(s.name);let a=s;a.__registered__=!0,a.logger.hookLog=A.extLog,a.reporter.hookApiInvoke=Qe.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=$(c)})}),J4("PLUGIN_INFO",t)},ChannelMediaRelayError:gh,ChannelMediaRelayEvent:nc,ChannelMediaRelayState:wn,RemoteStreamFallbackType:wie,RemoteStreamType:bie,ConnectionDisconnectedReason:Gt,AudienceLatencyLevelType:Zne,AREAS:Vt,preload:async function(e,t,s,a){return b5(e,t,s,a)}});return Object.defineProperties(zs,{onAudioAutoplayFailed:{get:()=>di.onAudioAutoplayFailed,set:e=>{di.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>di.onAutoplayFailed,set:e=>{di.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>zs._onSecurityPolicyViolation,set(e){zs._onSecurityPolicyViolation=e,DV(e)}},__CLIENT_LIST__:{get:()=>$("SHOW_GLOBAL_CLIENT_LIST")?fd:[]}}),li.on(ud.CAMERA_DEVICE_CHANGED,e=>{A.info("camera device changed",JSON.stringify(e)),zs.onCameraChanged&&zs.onCameraChanged(e),zs.safeEmit(So.CAMERA_CHANGED,e)}),li.on(ud.RECORDING_DEVICE_CHANGED,e=>{A.info("microphone device changed",JSON.stringify(e)),zs.onMicrophoneChanged&&zs.onMicrophoneChanged(e),zs.safeEmit(So.MICROPHONE_CHANGED,e)}),li.on(ud.PLAYOUT_DEVICE_CHANGED,e=>{A.debug("playout device changed",JSON.stringify(e)),zs.onPlaybackDeviceChanged&&zs.onPlaybackDeviceChanged(e),zs.safeEmit(So.PLAYBACK_DEVICE_CHANGED,e)}),un.onAutoplayFailed=()=>{A.info("detect audio element autoplay failed"),di.onAudioAutoplayFailed&&di.onAudioAutoplayFailed()},Xt.on("autoplay-failed",()=>{A.info("detect webaudio autoplay failed"),di.onAudioAutoplayFailed&&di.onAudioAutoplayFailed(),zs.safeEmit(So.AUTOPLAY_FAILED)}),Xt.on(fr.STATE_CHANGE,(e,t)=>{A.info("audio context state changed: ".concat(t," => ").concat(e)),zs.onAudioContextStateChanged&&zs.onAudioContextStateChanged(e,t),zs.safeEmit(So.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Fs.on(Qu.NETWORK_STATE_CHANGE,(e,t)=>{A.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=zs),zs})}),iz={};V0e(iz,{AgoraRTCProvider:()=>cz,AgoraRTCReactError:()=>qn,AgoraRTCScreenShareProvider:()=>J0e,LocalAudioTrack:()=>fz,LocalUser:()=>yz,LocalVideoTrack:()=>vz,RemoteAudioTrack:()=>xz,RemoteUser:()=>iA,RemoteVideoTrack:()=>bz,TrackBoundary:()=>uCe,VERSION:()=>gCe,default:()=>wz,useAutoPlayAudioTrack:()=>JI,useAutoPlayVideoTrack:()=>XI,useClientEvent:()=>Y0e,useConnectionState:()=>Z0e,useCurrentUID:()=>eCe,useIsConnected:()=>Xp,useJoin:()=>dz,useLocalCameraTrack:()=>pz,useLocalMicrophoneTrack:()=>hz,useLocalScreenTrack:()=>lCe,useNetworkQuality:()=>tCe,usePublish:()=>uz,useRTCClient:()=>lo,useRTCScreenShareClient:()=>Q0e,useRemoteAudioTracks:()=>aCe,useRemoteUserTrack:()=>nA,useRemoteUsers:()=>mz,useRemoteVideoTracks:()=>oCe,useTrackEvent:()=>$0e,useVolumeLevel:()=>rCe});var W0e=pu(mu());function Pn(r,n,o){return r.on(n,o),()=>r.off(n,o)}function G0e(r){try{return r()}catch(n){console.error(n)}}function fu(r){return()=>r.forEach(G0e)}function H0e(r,n){let o=setInterval(r,n);return()=>clearInterval(o)}function mb(r,n){let o=setTimeout(r,n);return()=>clearTimeout(o)}function YI(){let r,n,o;function l(){if(n){let x=n;n=void 0,x()}}async function u(){if(o){let x=o;o=void 0;try{await x()}catch(S){console.error(S)}}}async function m(x){r=!0,await u();try{o=await x()}catch(S){console.error(S)}r=!1,l()}async function g(){r=!0,await u(),r=!1,l()}function E(x){r?n=()=>m(x):m(x)}function y(){r?n=g:g()}return{run:E,dispose:y}}var fb=typeof document<"u"?O.useLayoutEffect:O.useEffect;function z0e(r){return r!=null&&typeof r.then=="function"}function zl(){let r=O.useRef(!1);return O.useEffect(()=>(r.current=!1,()=>{r.current=!0}),[]),r}function K0e(){let r=zl();function n(o,l){return new Promise(async(u,m)=>{try{let g=await o;r.current||u(g)}catch(g){r.current?l&&l(g):m(g)}})}return O.useCallback(n,[r])}function az(r){let n=K0e(),[o,l]=O.useState();return fb(()=>{z0e(r)?n(r).then(l):l(r)},[r,n]),o}function gu(r,n){let o=O.useRef();O.useEffect(()=>{let{run:l,dispose:u}=o.current||(o.current=YI());return l(r),u},n)}function q0e(r,n){let o=r.split("."),l=n.split("."),u=Math.max(o.length,l.length);for(let m=0;m<u;m++){let g=parseInt(o[m]||"0"),E=parseInt(l[m]||"0");if(g>E)return 1;if(g<E)return-1}return 0}function Y0e(r,n,o){let l=O.useRef(o);fb(()=>{l.current=o},[o]),O.useEffect(()=>{if(r)return Pn(r,n,(...u)=>{l.current&&l.current(...u)})},[n,r])}function $0e(r,n,o){let l=O.useRef(o);fb(()=>{l.current=o},[o]),O.useEffect(()=>{if(r)return Pn(r,n,(...u)=>{l.current&&l.current(...u)})},[n,r])}var oz=O.createContext(null);function cz({client:r,children:n}){return i.jsx(oz.Provider,{value:r,children:n})}function X0e(r){let n=O.useContext(oz);return r||n}function lo(r){let n=X0e(r);if(!n)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return n}var lz=O.createContext(null);function J0e({client:r,children:n}){return i.jsx(lz.Provider,{value:r,children:n})}function Q0e(r){let n=O.useContext(lz);return r||n}function Z0e(r){let n=lo(r),[o,l]=O.useState(n?n.connectionState:"DISCONNECTED");return O.useEffect(()=>{if(n){l(n.connectionState);let u;return fu([Pn(n,"connection-state-change",m=>{u==null||u(),m==="CONNECTED"?u=mb(()=>l(m),0):l(m)}),()=>u==null?void 0:u()])}else l("DISCONNECTED")},[n]),o}function Xp(r){let n=lo(r),[o,l]=O.useState(n?n.connectionState==="CONNECTED":!1);return O.useEffect(()=>{if(n){l(n.connectionState==="CONNECTED");let u;return fu([Pn(n,"connection-state-change",m=>{u==null||u(),u=mb(()=>l(m==="CONNECTED"),0)}),()=>u==null?void 0:u()])}else l(!1)},[n]),o}function eCe(r){let n=lo(r),[o,l]=O.useState(n==null?void 0:n.uid);return O.useEffect(()=>{if(n)return Pn(n,"connection-state-change",u=>{if(u==="CONNECTED")return mb(()=>l(n.uid),0);u==="DISCONNECTED"&&l(void 0)})},[n]),o}var qn=class extends Error{constructor(n,o){var r=(...FTe)=>(super(...FTe),Tf(this,"rtcMethod"),Tf(this,"rtcError"),Tf(this,"name","AgoraRTCReactException"),this);r(typeof o=="string"?o:o.message),this.rtcMethod=n,this.rtcError=o}log(n){console[n](this)}};function dz(r,n=!0,o){let l=lo(o),u=Xp(o),m=O.useRef(),[g,E]=O.useState(!1),[y,x]=O.useState(0),[S,C]=O.useState(null),N=zl();return gu(async()=>{if(N.current||(C(null),x(0),E(!1)),n&&l){try{N.current||E(!0);let{appid:G,channel:I,token:P,uid:L}=typeof r=="function"?await r():r,R=await l.join(G,I,P,L);N.current||x(R)}catch(G){console.error(G),N.current||C(new qn("IAgoraRTCClient.join",G))}N.current||E(!1);let M=m.current||(m.current=YI());return fu([()=>{M.dispose()},()=>{M.run(()=>l.unpublish(l.localTracks))},()=>{for(let G of l.localTracks)G.isPlaying&&G.stop(),G.close();M.run(()=>l.leave())}])}},[n,o]),{data:y,isLoading:g,isConnected:u,error:S}}var A7=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function tCe(r){let n=lo(r),[o,l]=O.useState(A7);return O.useEffect(()=>{if(n)return Pn(n,"network-quality",u=>l({uplinkNetworkQuality:u.uplinkNetworkQuality,downlinkNetworkQuality:u.downlinkNetworkQuality,delay:n.getRTCStats().RTT??0}));l(A7())},[n]),o}var sCe=pu(mu());function uz(r,n=!0,o){let l=lo(o),u=Xp(o),m=O.useRef([]),[g,E]=O.useState(!1),[y,x]=O.useState(null),S=zl();return gu(async()=>{if(S.current||(E(!1),x(null)),!l||!u||!n)return;let C=r.filter(Boolean),N=I=>{let P=q0e(sCe.default.VERSION,"4.18.2")>=0;return P||new qn("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),P?l.mode!=="live"||l.role!=="audience":!0},M=I=>m.current.some(P=>P&&P.getTrackId()===I.getTrackId()),G=I=>N()&&I.enabled&&n&&!M(I);for(let I=0;I<C.length;I++){let P=C[I];if(P&&G(P)){await l.unpublish(m.current.filter(L=>(L==null?void 0:L.trackMediaType)===P.trackMediaType));try{S.current||E(!0),await l.publish(P)}catch(L){console.error(L),S.current||x(new qn("IAgoraRTCClient.publish",L))}S.current||E(!1)}}m.current=C},[u,n,l,r]),{isLoading:g,error:y}}function rCe(r){let[n,o]=O.useState(0);return O.useEffect(()=>{if(r)return H0e(()=>{o(r.getVolumeLevel())},1e3)},[r]),n}var nCe=pu(mu());function hz(r=!0,n={ANS:!0,AEC:!0}){let[o,l]=O.useState(null),[u,m]=O.useState(!1),[g,E]=O.useState(null),y=zl();return gu(async()=>{if(y.current||(m(!1),E(null)),r&&!o){try{y.current||m(!0);let x=await nCe.default.createMicrophoneAudioTrack(n);y.current||l(x)}catch(x){console.error(x),y.current||E(new qn("IAgoraRTC.createMicrophoneAudioTrack",x))}y.current||m(!1)}},[r]),{localMicrophoneTrack:o,isLoading:u,error:g}}var iCe=pu(mu());function pz(r=!0,n){let[o,l]=O.useState(null),[u,m]=O.useState(!1),[g,E]=O.useState(null),y=zl();return gu(async()=>{if(y.current||(m(!1),E(null)),r&&!o){try{y.current||m(!0);let x=await iCe.default.createCameraVideoTrack(n);y.current||l(x)}catch(x){console.error(x),y.current||E(new qn("IAgoraRTC.createCameraVideoTrack",x))}y.current||m(!1)}},[r]),{localCameraTrack:o,isLoading:u,error:g}}function aCe(r,n){let o=lo(n),[l,u]=O.useState([]),m=Xp(),g=O.useRef([]),[E,y]=O.useState(!1),[x,S]=O.useState(null),C=zl();return gu(async()=>{if(C.current||S(null),!Array.isArray(r)||!m)return;let N=async I=>{if(!I.audioTrack&&r.some(({uid:P})=>I.uid===P)){try{C.current||y(!0),await o.subscribe(I,"audio")}catch(P){console.error(P),C.current||S(new qn("IAgoraRTCClient.subscribe",P))}I.audioTrack&&!g.current.some(P=>P.getUserId()===I.uid)&&g.current.push(I.audioTrack),g.current=g.current.map(P=>I.audioTrack&&P.getUserId()===I.uid&&P.getTrackId()!==I.audioTrack.getTrackId()?I.audioTrack:P),C.current||(u([...g.current]),y(!1))}},M=async I=>{if(r.some(({uid:P})=>I.uid===P)){C.current||(g.current=g.current.filter(P=>P.getUserId()!==I.uid),u([...g.current]));try{C.current||y(!0),await o.unsubscribe(I,"audio")}catch(P){console.error(P),C.current||S(new qn("IAgoraRTCClient.unsubscribe",P))}C.current||y(!1)}};r.map(I=>{!I.audioTrack&&I.hasAudio&&N(I)});let G=[];for(let I=0;I<g.current.length;I++){let P=g.current[I];if(!r.some(L=>L.uid===P.getUserId())){let L=o.remoteUsers.find(R=>R.uid===P.getUserId());L&&G.push({user:L,mediaType:"audio"}),g.current.splice(I,1),I--}}if(G.length>0){try{C.current||y(!0),await o.massUnsubscribe(G)}catch(I){console.error(I),C.current||S(new qn("IAgoraRTCClient.massUnsubscribe",I))}C.current||(u(g.current.slice()),y(!1))}return fu([Pn(o,"user-published",(I,P)=>{r.find(L=>L.uid===I.uid)&&P==="audio"&&N(I)}),Pn(o,"user-unpublished",(I,P)=>{r.find(L=>L.uid===I.uid)&&P==="audio"&&M(I)})])},[m,o,r]),{audioTracks:l,isLoading:E,error:x}}function oCe(r,n){let o=lo(n),[l,u]=O.useState([]),m=Xp(),g=O.useRef([]),[E,y]=O.useState(!1),[x,S]=O.useState(null),C=zl();return gu(async()=>{if(C.current||S(null),!Array.isArray(r)||!m)return;let N=async I=>{if(!I.videoTrack&&r.some(({uid:P})=>I.uid===P)){try{C.current||y(!0),await o.subscribe(I,"video")}catch(P){console.error(P),C.current||S(new qn("IAgoraRTCClient.subscribe",P))}I.videoTrack&&!g.current.some(P=>P.getUserId()===I.uid)&&g.current.push(I.videoTrack),g.current=g.current.map(P=>I.videoTrack&&P.getUserId()===I.uid&&P.getTrackId()!==I.videoTrack.getTrackId()?I.videoTrack:P),C.current||(u([...g.current]),y(!1))}},M=async I=>{if(r.some(({uid:P})=>I.uid===P)){C.current||(g.current=g.current.filter(P=>P.getUserId()!==I.uid),u([...g.current]));try{C.current||y(!0),await o.unsubscribe(I,"video")}catch(P){console.error(P),C.current||S(new qn("IAgoraRTCClient.unsubscribe",P))}C.current||y(!1)}};r.map(I=>{!I.videoTrack&&I.hasVideo&&N(I)});let G=[];for(let I=0;I<g.current.length;I++){let P=g.current[I];if(!r.some(L=>L.uid===P.getUserId())){let L=o.remoteUsers.find(R=>R.uid===P.getUserId());L&&G.push({user:L,mediaType:"video"}),g.current.splice(I,1),I--}}if(G.length>0){try{C.current||y(!0),await o.massUnsubscribe(G)}catch(I){console.error(I),C.current||S(new qn("IAgoraRTCClient.massUnsubscribe",I))}C.current||(u(g.current.slice()),y(!1))}return fu([Pn(o,"user-published",(I,P)=>{r.find(L=>L.uid===I.uid)&&P==="video"&&N(I)}),Pn(o,"user-unpublished",(I,P)=>{r.find(L=>L.uid===I.uid)&&P==="video"&&M(I)})])},[m,o,r]),{videoTracks:l,isLoading:E,error:x}}function nA(r,n,o){let l=lo(o),u=n==="audio"?"audioTrack":"videoTrack",[m,g]=O.useState(r&&r[u]),E=Xp(),y=O.useRef(),[x,S]=O.useState(!1),[C,N]=O.useState(null);return O.useEffect(()=>{if(!r||!E)return;let M=!1;M||N(null);let G=n==="audio"?"hasAudio":"hasVideo",I=r.uid,P=async(D,V)=>{if(D[u]&&l.remoteUsers.some(({uid:W})=>D.uid===W))try{M||S(!0),await l.unsubscribe(D,V)}catch(W){M||N(new qn("IAgoraRTCClient.unsubscribe",W)),console.error(W)}M||(g(void 0),S(!1))},L=async(D,V)=>{try{!D[u]&&l.remoteUsers.some(({uid:W})=>D.uid===W)&&(M||S(!0),await l.subscribe(D,V)),M||g(D[u])}catch(W){M||N(new qn("IAgoraRTCClient.subscribe",W)),console.error(W)}M||S(!1)},R=y.current||(y.current=YI());return!r[u]&&r[G]?R.run(()=>L(r,n)):g(r[u]),fu([()=>{M=!0,R.dispose()},Pn(l,"user-published",(D,V)=>{D.uid===I&&V===n&&R.run(()=>L(D,n))}),Pn(l,"user-unpublished",(D,V)=>{D.uid===I&&V===n&&R.run(()=>P(D,n))})])},[E,l,r,n,u]),{track:m,isLoading:x,error:C}}function mz(r){let n=lo(r),[o,l]=O.useState(n?n.remoteUsers:[]);return O.useEffect(()=>{if(n){let u=()=>l(n.remoteUsers.slice());return fu([Pn(n,"user-joined",u),Pn(n,"user-left",u),Pn(n,"user-published",u),Pn(n,"user-unpublished",u)])}},[n]),o}var cCe=pu(mu());function lCe(r=!0,n,o){let[l,u]=O.useState(null),[m,g]=O.useState(!1),[E,y]=O.useState(null),x=zl();return gu(async()=>{if(x.current||(g(!1),y(null)),r&&!l){try{x.current||g(!0);let S=await cCe.default.createScreenVideoTrack(n,o);x.current||u(S)}catch(S){console.error(S),x.current||y(new qn("IAgoraRTC.createScreenVideoTrack",S))}x.current||g(!1)}},[r]),{screenTrack:l,isLoading:m,error:E}}function dCe(){let r=new Map,n=1500;return{onMount:o=>{let l=r.get(o);l&&(l(),r.delete(o))},onUnmount:o=>{let l=r.get(o);l&&l(),r.set(o,mb(()=>{o.isPlaying&&o.stop(),r.delete(o)},n))},dispose:()=>{for(let[o,l]of r)o.isPlaying&&o.stop(),l&&l();r.clear()}}}var $I=O.createContext(void 0);function uCe({children:r}){let[n]=O.useState(dCe);return O.useEffect(()=>n.dispose,[n]),i.jsx($I.Provider,{value:n,children:r})}function XI(r,n,o,l){let u=O.useContext($I);O.useEffect(()=>{if(r)return l&&n?r.play(l,o||void 0):r.stop(),u?(u.onMount(r),()=>u.onUnmount(r)):()=>{r.isPlaying&&r.stop()}},[r,l,n,u,o])}function JI(r,n){let o=O.useContext($I);fb(()=>{if(r)return n?r.play():r.stop(),o?(o.onMount(r),()=>o.onUnmount(r)):()=>{r.isPlaying&&r.stop()}},[r,n,o])}function fz({track:r,play:n=!1,volume:o,disabled:l,muted:u,children:m}){let g=az(r);return JI(g,n),O.useEffect(()=>{g&&o!=null&&g.setVolume(o)},[g,o]),O.useEffect(()=>{g&&l!=null&&g.setEnabled(!l).catch(console.warn)},[l,g]),O.useEffect(()=>{g&&u!=null&&g.setMuted(u).catch(console.warn)},[u,g]),m?i.jsx(i.Fragment,{children:m}):null}var gz={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},_z={width:"100%",height:"100%"},QI={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},gb=(r,n)=>O.useMemo(()=>({...r,...n}),[r,n]);function vz({track:r,play:n,disabled:o,muted:l,style:u,videoPlayerConfig:m,...g}){let E=gb(_z,u),[y,x]=O.useState(null),S=az(r);return XI(S,n,m,y),O.useEffect(()=>{S&&o!=null&&S.setEnabled(!o).catch(console.warn)},[o,S]),O.useEffect(()=>{S&&l!=null&&S.setMuted(l).catch(console.warn)},[l,S]),i.jsx("div",{...g,ref:x,style:E})}var hCe={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},pCe={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function Ez({cover:r}){return i.jsx("div",{style:QI,children:typeof r=="string"?i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{...hCe,backgroundImage:`url(${r})`}}),i.jsx("img",{src:r,style:pCe})]}):r()})}function yz({micOn:r,cameraOn:n,audioTrack:o,videoTrack:l,playAudio:u,playVideo:m,volume:g,cover:E,children:y,style:x,...S}){let C=gb(gz,x);return m=m??!!n,u=u??!!r,i.jsxs("div",{...S,style:C,children:[i.jsx(vz,{disabled:!n,play:m,track:l}),i.jsx(fz,{disabled:!r,play:u,track:o,volume:g}),E&&!n&&i.jsx(Ez,{cover:E}),i.jsx("div",{style:QI,children:y})]})}function xz({track:r,play:n=!1,playbackDeviceId:o,volume:l,children:u}){return JI(r,n),O.useEffect(()=>{r&&o!=null&&r.setPlaybackDevice(o).catch(console.warn)},[r,o]),O.useEffect(()=>{r&&l!=null&&r.setVolume(l)},[r,l]),u?i.jsx(i.Fragment,{children:u}):null}function bz({track:r,play:n,style:o,videoPlayerConfig:l,...u}){let m=gb(_z,o),[g,E]=O.useState(null);return XI(r,n,l,g),i.jsx("div",{...u,ref:E,style:m})}function iA({user:r,playVideo:n,playAudio:o,playbackDeviceId:l,volume:u,cover:m,style:g,children:E,videoPlayerConfig:y,...x}){let S=gb(gz,g),{track:C}=nA(r,"video"),{track:N}=nA(r,"audio");return n=n??(r==null?void 0:r.hasVideo),o=o??(r==null?void 0:r.hasAudio),i.jsxs("div",{...x,style:S,children:[i.jsx(bz,{play:n,track:C,videoPlayerConfig:y}),i.jsx(xz,{play:o,playbackDeviceId:l,track:N,volume:u}),m&&!n&&i.jsx(Ez,{cover:m}),i.jsx("div",{style:QI,children:E})]})}var mCe=pu(mu()),fCe=class{constructor(){Tf(this,"appType",1001);mCe.default.setAppType(this.appType)}};new fCe;var gCe="2.5.0";B0e(iz,pu(mu()));var wz=W0e.default;async function Vg(r,n,o={}){const{error:l}=await ie.from("meeting_event_logs").insert({meet_id:r,event_type:n,timestamp:new Date().toISOString(),metadata:o});l&&console.error(`Error logging meeting event ${n}:`,l)}async function _b(r){const{data:n,error:o}=await ie.from("meets").select("*").eq("id",r).single();return o||!n?(console.error("Error fetching meeting:",o),null):{id:n.id,status:n.status,scheduledAt:n.scheduled_at,durationMinutes:n.duration_minutes,creatorId:n.creator_id,fanId:n.fan_id,creatorStartedAt:n.creator_started_at,creatorJoinedAt:n.creator_joined_at,fanJoinedAt:n.fan_joined_at,recordingStartedAt:n.recording_started_at,recordingStoppedAt:n.recording_stopped_at,recordingResourceId:n.recording_resource_id,recordingSid:n.recording_sid,recordingMode:n.recording_mode,recordingStatus:n.recording_status,recordingFileList:n.recording_file_list,recordingUrl:n.recording_url}}async function I7(r){const{data:n,error:o}=await ie.from("meets").select("*").ilike("meeting_link",`%${r}%`).single();return o||!n?(console.error("Error fetching meeting by link:",o),null):{id:n.id,status:n.status,scheduledAt:n.scheduled_at,durationMinutes:n.duration_minutes,creatorId:n.creator_id,fanId:n.fan_id,creatorStartedAt:n.creator_started_at,creatorJoinedAt:n.creator_joined_at,fanJoinedAt:n.fan_joined_at,recordingStartedAt:n.recording_started_at,recordingStoppedAt:n.recording_stopped_at,recordingResourceId:n.recording_resource_id,recordingSid:n.recording_sid,recordingMode:n.recording_mode,recordingStatus:n.recording_status,recordingFileList:n.recording_file_list,recordingUrl:n.recording_url}}const _Ce="agora-cloud-recording";async function vCe(r,n,o={}){try{const{data:l,error:u}=await ie.functions.invoke(_Ce,{body:{action:n,meetId:r,...o}});return u?(console.error(`Edge function error (${n}):`,u),{success:!1,error:u.message}):l!=null&&l.success?{success:!0,data:l}:(console.error(`Edge function responded with failure for ${n}:`,l),{success:!1,error:(l==null?void 0:l.error)||"Unknown recording error"})}catch(l){const u=l;return console.error(`Failed to invoke recording action ${n}:`,u),{success:!1,error:u.message}}}async function ECe(r){console.log(" onCreatorStreamStarted called with meetId:",r);const n=new Date,o=await _b(r);if(!o)return console.error(" Meeting not found for id:",r),{success:!1,error:"Meeting not found"};if(console.log(" Meeting found:",{id:o.id,status:o.status,scheduledAt:o.scheduledAt}),o.status!=="scheduled"&&o.status!=="live")return console.error(" Meeting not in startable state:",o.status),{success:!1,error:`Meeting is not in a startable state (current: ${o.status})`};if(o.status==="live")return console.log(" Meeting already live, returning success"),{success:!0};const l=new Date(o.scheduledAt),u=new Date(o.scheduledAt);if(u.setMinutes(u.getMinutes()+o.durationMinutes),n>=u)return console.error(" Meeting past end time"),{success:!1,error:"Cannot start meeting after scheduled end time"};const m=n<l,g=m?Math.floor((l.getTime()-n.getTime())/1e3):-Math.floor((n.getTime()-l.getTime())/1e3);console.log(" Attempting to update meeting to live...");const{error:E,data:y}=await ie.from("meets").update({status:"live",creator_started_at:n.toISOString()}).eq("id",r).select();return E?(console.error(" Error updating meeting status:",E),{success:!1,error:`Failed to update meeting: ${E.message}`}):(console.log(" Update result:",y),await Vg(r,"CREATOR_STREAM_STARTED",{started_at:n.toISOString(),scheduled_start:o.scheduledAt,started_early:m,seconds_from_scheduled:g}),await ZI(r),console.log(" onCreatorStreamStarted completed successfully"),{success:!0})}async function yCe(r,n){const o=new Date,l=await _b(r);if(!l)return{success:!1,error:"Meeting not found"};if(l.creatorId!==n)return{success:!1,error:"User is not the creator of this meeting"};const{error:u}=await ie.from("meets").update({creator_joined_at:o.toISOString()}).eq("id",r);return u?(console.error("Error updating creator joined time:",u),{success:!1,error:"Failed to update meeting"}):(await Vg(r,"CREATOR_JOINED",{creator_id:n,joined_at:o.toISOString()}),await ZI(r),{success:!0})}async function NN(r,n){const o=new Date,l=await _b(r);if(!l)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting not found"};if(l.fanId!==n)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"User is not the fan for this meeting"};if(l.status==="cancelled_no_show_creator"||l.status==="cancelled")return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting has been cancelled",meetingEnded:!0};if(l.status==="completed")return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting has already ended",meetingEnded:!0};const u=new Date(l.scheduledAt);if(u.setMinutes(u.getMinutes()+l.durationMinutes),o>=u)return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Meeting time has ended",meetingEnded:!0};if(l.status==="scheduled")return await Vg(r,"FAN_WAITING_ROOM",{fan_id:n,attempted_at:o.toISOString()}),{success:!0,showWaitingRoom:!0,canJoin:!1};if(l.status==="live"){if(!l.fanJoinedAt){const{error:m}=await ie.from("meets").update({fan_joined_at:o.toISOString()}).eq("id",r);m&&console.error("Error updating fan joined time:",m),await Vg(r,"FAN_JOINED",{fan_id:n,joined_at:o.toISOString(),scheduled_start:l.scheduledAt,joined_late_by_seconds:o>new Date(l.scheduledAt)?Math.floor((o.getTime()-new Date(l.scheduledAt).getTime())/1e3):0}),await ZI(r)}return{success:!0,showWaitingRoom:!1,canJoin:!0}}return{success:!1,showWaitingRoom:!1,canJoin:!1,error:"Unknown meeting state"}}async function ZI(r){const n=await _b(r);if(!n||n.status!=="live"||n.recordingStartedAt||!(await vCe(r,"start",n.recordingMode?{mode:n.recordingMode}:{})).success)return;const l=new Date().toISOString();await Vg(r,"RECORDING_STARTED",{started_at:l}),console.log(`Recording start requested for meeting ${r}`)}function RN(r){const n=new Date,o=new Date(r.scheduledAt);o.setMinutes(o.getMinutes()+r.durationMinutes);const l=o.getTime()-n.getTime();return Math.max(0,Math.floor(l/1e3))}function Sz(r){const n=new Date,o=new Date(r.scheduledAt),l=new Date(r.scheduledAt);l.setMinutes(l.getMinutes()+r.durationMinutes);const u=Math.floor((o.getTime()-n.getTime())/1e3),m=Math.floor((l.getTime()-n.getTime())/1e3);return{beforeStart:n<o,duringMeeting:n>=o&&n<l,afterEnd:n>=l,secondsUntilStart:u,secondsUntilEnd:m}}const AN={},Cz=(AN==null?void 0:AN.VITE_AGORA_APP_ID)||"4cc829c3ab144792a3f65fea1f905671";console.log(" Agora APP_ID:",Cz);const xCe=()=>{const{meetId:r}=nI(),n=Ss(),{user:o}=fs(),l=O.useMemo(()=>wz.createClient({mode:"rtc",codec:"vp8"}),[]),u=O.useCallback(()=>(o==null?void 0:o.role)==="creator"?"/creator/meets":(o==null?void 0:o.role)==="fan"?"/fan/meets":"/",[o==null?void 0:o.role]);return r?o?i.jsx(cz,{client:l,children:i.jsx(bCe,{user:o,meetId:r,onLeave:()=>n(u())})}):i.jsx(Dx,{message:"Please log in to join the meeting",onBack:()=>n("/login")}):i.jsx(Dx,{message:"Invalid Meeting Link",onBack:()=>n("/")})};function bCe({user:r,meetId:n,onLeave:o}){const[l,u]=O.useState("loading"),[m,g]=O.useState(null),[E,y]=O.useState(!1),[x,S]=O.useState(null),[C,N]=O.useState(null),M=O.useRef(null),G=O.useRef(null),I=()=>{M.current&&(clearInterval(M.current),M.current=null)},P=()=>{G.current&&(console.log(" Cleaning up Realtime subscription"),ie.removeChannel(G.current),G.current=null)},L=D=>{if(G.current)return;console.log(" Setting up Supabase Realtime for meeting:",D);const V=ie.channel(`meeting-${D}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"meets",filter:`id=eq.${D}`},async W=>{console.log(" Realtime update received:",W.new);const q=W.new;if(g(H=>H?{...H,status:q.status,creatorStartedAt:q.creator_started_at,creatorJoinedAt:q.creator_joined_at,fanJoinedAt:q.fan_joined_at}:null),q.status==="live"&&q.creator_started_at&&(console.log(" Creator started meeting! (Realtime)"),I(),(await NN(D,r.id)).canJoin)){u("live");const J=new Date(q.scheduled_at);J.setMinutes(J.getMinutes()+q.duration_minutes);const ee=Math.max(0,Math.floor((J.getTime()-Date.now())/1e3));S(ee)}(q.status==="cancelled_no_show_creator"||q.status==="cancelled")&&(console.log(" Meeting cancelled (Realtime)"),I(),u("cancelled")),q.status==="completed"&&(console.log(" Meeting completed (Realtime)"),u("ended")),q.fan_joined_at&&console.log(" Fan joined the meeting! (Realtime)")}).subscribe(W=>{console.log(" Realtime subscription status:",W)});G.current=V},R=D=>{M.current||(console.log(" Starting polling + Realtime for meeting updates..."),L(D),M.current=setInterval(async()=>{const V=await I7(n);V&&(V.status==="live"&&V.creatorStartedAt&&(console.log(" Creator started! (Polling)"),I(),(await NN(V.id,r.id)).canJoin&&(g(V),u("live"),S(RN(V)))),V.status==="cancelled_no_show_creator"&&(console.log(" Meeting cancelled (Polling)"),I(),u("cancelled")))},3e3))};return O.useEffect(()=>{async function D(){const V=await I7(n);if(!V){N("Meeting not found"),u("error");return}g(V);const W=V.creatorId===r.id,q=V.fanId===r.id;if(y(W),!W&&!q){N("You are not a participant of this meeting"),u("error");return}if(V.status==="cancelled_no_show_creator"||V.status==="cancelled"){u("cancelled");return}if(V.status==="completed"){u("ended");return}if(Sz(V).afterEnd){u("ended");return}if(W)L(V.id),u("live"),S(RN(V));else if(V.status==="live"&&V.creatorStartedAt){const J=await NN(V.id,r.id);J.canJoin?(u("live"),S(RN(V))):J.meetingEnded?u("ended"):(u("waiting_room"),R(V.id))}else u("waiting_room"),R(V.id)}return D(),()=>{I(),P()}},[n,r.id]),O.useEffect(()=>{if(l!=="live"||x===null)return;const D=setInterval(()=>{S(V=>V===null||V<=1?(clearInterval(D),u("ended"),0):V-1)},1e3);return()=>clearInterval(D)},[l,x]),l==="loading"?i.jsx(wCe,{}):l==="error"?i.jsx(Dx,{message:C||"An error occurred",onBack:o}):l==="cancelled"?i.jsx(SCe,{isCreator:E,onBack:o}):l==="ended"?i.jsx(CCe,{onBack:o}):l==="waiting_room"&&m?i.jsx(TCe,{meeting:m,onBack:o}):l==="live"&&m?i.jsx(NCe,{user:r,meeting:m,meetId:n,isCreator:E,timeLeft:x,onLeave:o}):i.jsx(Dx,{message:"Unknown state",onBack:o})}function wCe(){return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs("div",{className:"text-center text-white",children:[i.jsx("div",{className:"mb-4 text-4xl",children:""}),i.jsx("p",{className:"text-lg",children:"Loading meeting..."})]})})}function Dx({message:r,onBack:n}){return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs(me,{className:"max-w-md bg-gray-800 p-8 text-center",children:[i.jsx("div",{className:"mb-4 text-4xl",children:""}),i.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Error"}),i.jsx("p",{className:"mb-6 text-gray-400",children:r}),i.jsx(oe,{onClick:n,children:"Go Back"})]})})}function SCe({isCreator:r,onBack:n}){return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs(me,{className:"max-w-md bg-gray-800 p-8 text-center",children:[i.jsx("div",{className:"mb-4 text-4xl",children:""}),i.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Meeting Cancelled"}),i.jsx("p",{className:"mb-6 text-gray-400",children:r?"This meeting was cancelled because you did not start before the scheduled time.":"This meeting was cancelled because the creator did not show up. A refund has been issued."}),i.jsx(oe,{onClick:n,children:"Go Back"})]})})}function CCe({onBack:r}){return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs(me,{className:"max-w-md bg-gray-800 p-8 text-center",children:[i.jsx("div",{className:"mb-4 text-4xl",children:""}),i.jsx("h2",{className:"mb-2 text-xl font-semibold text-white",children:"Meeting Ended"}),i.jsx("p",{className:"mb-6 text-gray-400",children:"This meeting has ended. Thank you for participating!"}),i.jsx(oe,{onClick:r,children:"Go Back"})]})})}function TCe({meeting:r,onBack:n}){const o=Sz(r),l=new Date(r.scheduledAt).toLocaleString();return i.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-gray-900",children:i.jsxs(me,{className:"max-w-lg bg-gray-800 p-8 text-center",children:[i.jsx("div",{className:"mb-4 text-6xl",children:""}),i.jsx("h2",{className:"mb-2 text-2xl font-semibold text-white",children:"Waiting Room"}),i.jsx("p",{className:"mb-4 text-gray-400",children:"The creator hasn't started the meeting yet. Please wait..."}),i.jsxs("div",{className:"mb-6 rounded-lg bg-gray-700 p-4",children:[i.jsxs("p",{className:"text-sm text-gray-300",children:[i.jsx("strong",{children:"Scheduled Start:"})," ",l]}),i.jsxs("p",{className:"text-sm text-gray-300",children:[i.jsx("strong",{children:"Duration:"})," ",r.durationMinutes," minutes"]}),o.beforeStart&&i.jsxs("p",{className:"mt-2 text-sm text-yellow-400",children:[" Meeting starts in ",Math.ceil(o.secondsUntilStart/60)," minutes"]})]}),i.jsxs("div",{className:"mb-4 flex items-center justify-center gap-2",children:[i.jsx("div",{className:"h-3 w-3 animate-pulse rounded-full bg-yellow-500"}),i.jsx("span",{className:"text-sm text-yellow-400",children:"Waiting for creator to start..."})]}),i.jsx("p",{className:"mb-6 text-xs text-gray-500",children:"You'll automatically join when the creator starts the meeting."}),i.jsx(oe,{variant:"secondary",onClick:n,children:"Leave Waiting Room"})]})})}function NCe({user:r,meeting:n,meetId:o,isCreator:l,timeLeft:u,onLeave:m}){const[g,E]=O.useState(!1),[y,x]=O.useState(!1),[S,C]=O.useState("preparing"),[N,M]=O.useState(null),[G,I]=O.useState(null),[P,L]=O.useState(!0),[R,D]=O.useState(!0),[V,W]=O.useState(!0),q=n.id;console.log(" Agora channel name:",q,"(meeting.id, not URL param)"),O.useEffect(()=>{console.log(" Testing mode - using null token for channel:",q),L(!1),E(!0)},[q]);const{isConnected:H}=dz({appid:Cz,channel:q,token:null},g),{localMicrophoneTrack:J}=hz(g),{localCameraTrack:ee}=pz(g);uz([J,ee]);const ne=mz();O.useEffect(()=>{J&&J.setEnabled(R)},[J,R]),O.useEffect(()=>{ee&&ee.setEnabled(V)},[ee,V]),O.useEffect(()=>{console.log(" Agora connection status:",H?"CONNECTED":"DISCONNECTED"),console.log(" Remote users count:",ne.length),ne.length>0&&console.log(" Remote users:",ne.map(fe=>fe.uid))},[H,ne]),O.useEffect(()=>{l&&!y&&(x(!0),console.log(" Creator entered LiveCall view, marking meeting as LIVE immediately"),console.log(" Meeting ID:",n.id),ECe(n.id).then(fe=>{fe.success?console.log(" Meeting marked as LIVE in database - fan can now join"):console.error(" Failed to mark meeting as LIVE:",fe.error)}).catch(fe=>{console.error(" Error calling onCreatorStreamStarted:",fe)}),yCe(n.id,r.id).catch(fe=>{console.error("Error in onCreatorJoined:",fe)}),pe())},[l,y,n.id,r.id]),O.useEffect(()=>{n&&(n.recordingStartedAt&&!n.recordingStoppedAt?C("recording"):n.recordingStoppedAt?C("stopped"):C("preparing"))},[n.recordingStartedAt,n.recordingStoppedAt]);async function pe(){try{C("preparing");const{data:fe,error:ae}=await ie.functions.invoke("agora-cloud-recording",{body:{action:"query",meetId:n.id}});if(ae||!(fe!=null&&fe.success)){M((ae==null?void 0:ae.message)||(fe==null?void 0:fe.error)||"Unable to verify recording"),C("error");return}C("recording"),M(null)}catch(fe){const ae=fe instanceof Error?fe.message:"Unknown recording error";console.error("Recording status check failed:",fe),M(ae),C("error")}}async function Ee(){try{C("preparing");const{data:fe,error:ae}=await ie.functions.invoke("agora-cloud-recording",{body:{action:"stop",meetId:n.id}});if(ae||!(fe!=null&&fe.success)){M((ae==null?void 0:ae.message)||(fe==null?void 0:fe.error)||"Failed to stop recording"),C("error");return}C("stopped"),M(null)}catch(fe){const ae=fe instanceof Error?fe.message:"Unknown recording error";console.error("Recording stop failed:",fe),M(ae),C("error")}}const ge=fe=>{const ae=Math.floor(fe/60),be=fe%60;return`${ae}:${be.toString().padStart(2,"0")}`},he=ne[0],le=ne.slice(1),Le=S==="recording"?"bg-red-500 animate-pulse":S==="error"?"bg-amber-400":S==="stopped"?"bg-gray-400":"bg-emerald-400 animate-pulse";return i.jsxs("div",{className:"relative flex h-screen w-full flex-col overflow-hidden bg-[#040308] text-white",children:[i.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(88,111,255,0.25),_rgba(4,3,8,0.95))]"}),i.jsxs("div",{className:"relative z-10 flex h-full flex-col",children:[i.jsxs("header",{className:"flex items-center justify-between px-5 pb-2 pt-6 sm:px-8",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs uppercase tracking-[0.35em] text-white/50",children:"FanMeet Live"}),i.jsx("h1",{className:"text-xl font-semibold text-white sm:text-2xl",children:l?"Chat with your fan":"Live with the creator"}),i.jsx("p",{className:"text-[11px] text-white/60",children:"End-to-end encrypted  Agora powered"})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1 text-right",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-[0.3em] text-emerald-300",children:"Live"}),i.jsx("span",{className:`text-2xl font-bold ${u!==null&&u<60?"text-rose-300":"text-white"}`,children:u!==null?ge(u):"--:--"}),i.jsxs("span",{className:"text-xs text-white/60",children:[ne.length+1," participant",ne.length!==0?"s":""]})]})]}),i.jsxs("main",{className:"relative flex-1 px-4 pb-36 pt-2 sm:px-8",children:[i.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-[32px] border border-white/10 bg-black/40 shadow-[0_30px_120px_rgba(0,0,0,0.45)]",children:[he?i.jsx(iA,{user:he,className:"h-full w-full object-cover"}):i.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-center",children:[i.jsx("div",{className:"mb-4 text-5xl",children:""}),i.jsxs("p",{className:"text-base font-semibold",children:["Waiting for ",l?"fan":"creator"," to connect"]}),i.jsx("p",{className:"mt-2 max-w-xs text-sm text-white/70",children:"Well pull them in the moment their camera is active."})]}),i.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-transparent to-black/40"}),i.jsxs("div",{className:"absolute left-5 top-5 flex flex-col gap-1 rounded-2xl bg-black/30 px-4 py-3 backdrop-blur",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-[0.3em] text-white/70",children:he?"Connected":"Calling"}),i.jsxs("p",{className:"text-lg font-semibold",children:[l?"Fan":"Creator"," view"]}),i.jsx("p",{className:"text-xs text-white/70",children:new Date(n.scheduledAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),le.length>0&&i.jsxs("div",{className:"absolute right-5 top-5 flex gap-2",children:[le.slice(0,2).map(fe=>i.jsx("div",{className:"h-12 w-12 rounded-2xl border border-white/20 bg-white/15 backdrop-blur",children:i.jsx(iA,{user:fe,className:"h-full w-full rounded-2xl object-cover"})},fe.uid)),le.length>2&&i.jsxs("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl border border-white/20 bg-black/30 text-xs font-semibold text-white/70",children:["+",le.length-2]})]}),i.jsxs("div",{className:"absolute bottom-5 left-5 flex max-w-[70%] items-center gap-3 rounded-2xl bg-black/35 px-4 py-2 text-xs text-white/80 backdrop-blur",children:[i.jsx("div",{className:`h-2 w-2 rounded-full ${ne.length?"bg-emerald-400":"bg-yellow-400"}`}),i.jsx("p",{className:"truncate",children:ne.length?"All good  video stabilized":"Linking you both together"})]})]}),i.jsxs("div",{className:"absolute bottom-24 right-6 w-32 rounded-[22px] border border-white/20 bg-black/50 p-2 shadow-2xl backdrop-blur sm:right-12 sm:w-40",children:[i.jsx(yz,{audioTrack:J,videoTrack:ee,cameraOn:V,micOn:R,playAudio:!1,playVideo:V,className:"h-40 w-full rounded-2xl object-cover"}),i.jsxs("div",{className:"absolute bottom-4 left-4 flex items-center gap-2 rounded-full bg-black/60 px-2 py-1 text-[11px] font-medium",children:["You",i.jsx("span",{className:`h-2 w-2 rounded-full ${R?"bg-emerald-400":"bg-rose-400"}`})]})]})]}),i.jsxs("footer",{className:"pointer-events-auto absolute inset-x-0 bottom-0 flex flex-col gap-4 rounded-t-[32px] bg-black/60 px-6 pb-8 pt-6 backdrop-blur-2xl sm:flex-row sm:items-center sm:justify-between sm:px-10",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/70 sm:text-sm",children:[i.jsx("div",{className:`h-2 w-2 rounded-full ${Le}`}),i.jsxs("span",{children:[S==="recording"&&"Recording  Cloud backup active",S==="preparing"&&"Arming recording...",S==="stopped"&&"Recording stopped",S==="error"&&(N||"Recording unavailable")]}),S==="recording"&&l&&i.jsx("button",{onClick:Ee,className:"ml-3 text-xs font-semibold text-white/90 underline-offset-2 hover:text-white",children:"Stop"})]}),i.jsxs("div",{className:"flex flex-1 flex-wrap items-center justify-center gap-4 sm:justify-end",children:[i.jsxs("button",{onClick:()=>D(fe=>!fe),className:`flex h-16 w-16 flex-col items-center justify-center rounded-full text-xs font-semibold transition ${R?"bg-white/15 text-white":"bg-rose-600 text-white shadow-lg shadow-rose-900/40"}`,children:[R?i.jsx(sbe,{className:"mb-1 h-5 w-5"}):i.jsx(ebe,{className:"mb-1 h-5 w-5"}),R?"Mute":"Unmute"]}),i.jsxs("button",{onClick:()=>W(fe=>!fe),className:`flex h-16 w-16 flex-col items-center justify-center rounded-full text-xs font-semibold transition ${V?"bg-white/15 text-white":"bg-rose-600 text-white shadow-lg shadow-rose-900/40"}`,children:[V?i.jsx(hbe,{className:"mb-1 h-5 w-5"}):i.jsx(dbe,{className:"mb-1 h-5 w-5"}),V?"Video":"Off"]}),i.jsxs("button",{onClick:m,className:"flex h-16 flex-1 items-center justify-center rounded-2xl bg-rose-600 text-sm font-semibold uppercase tracking-wide text-white shadow-2xl shadow-rose-900/40 sm:h-14 sm:flex-none sm:px-10",children:[i.jsx(nbe,{className:"mr-2 h-5 w-5"}),"Leave"]})]})]})]})]})}function RCe(){const r=Ss();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Privacy Policy"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Last updated: December 15, 2024"}),i.jsxs("div",{className:"prose prose-sm max-w-none text-[#495057]",children:[i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"1. Introduction"}),i.jsx("p",{className:"mb-4",children:'Welcome to FanMeet ("we," "our," or "us"). FanMeet is a platform that connects fans with their favorite creators through live video calls. We are committed to protecting your privacy and ensuring the security of your personal information.'}),i.jsx("p",{className:"mb-4",children:'This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our website and services located at fanmeet.live (the "Platform"). Please read this policy carefully. By using our Platform, you consent to the practices described in this Privacy Policy.'}),i.jsx("p",{children:"FanMeet is operated by FanMeet Technologies Private Limited, a company registered in India under the Companies Act, 2013."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"2. Information We Collect"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"2.1 Personal Information You Provide"}),i.jsxs("ul",{className:"mb-4 list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Account Information:"})," Name, email address, phone number, username, and password when you create an account."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Profile Information:"})," Profile photo, bio, social media links, and category preferences."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Payment Information:"})," Bank account details, UPI ID, and transaction history for processing payouts and refunds. We use Razorpay as our payment processor; your card details are never stored on our servers."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Identity Verification:"})," For creators, we may collect government-issued ID proof, PAN card details, and social media verification for KYC compliance."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Communication Data:"})," Messages, support tickets, and any correspondence with our team."]})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"2.2 Information Collected Automatically"}),i.jsxs("ul",{className:"mb-4 list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Device Information:"})," IP address, browser type, operating system, device identifiers."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Usage Data:"})," Pages visited, time spent on pages, click patterns, search queries."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Video Call Metadata:"})," Call duration, connection quality metrics (video content is NOT recorded or stored)."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Cookies and Tracking:"})," We use cookies and similar technologies for authentication, preferences, and analytics."]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"3. How We Use Your Information"}),i.jsx("p",{className:"mb-4",children:"We use the collected information for the following purposes:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Service Delivery:"})," To facilitate video calls between fans and creators, process bids, and manage event scheduling."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Payment Processing:"})," To process payments, refunds, and creator payouts through our payment partners."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Account Management:"})," To create and manage your account, verify your identity, and maintain security."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Communication:"})," To send transactional emails, event reminders, bid updates, and customer support responses."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Platform Improvement:"})," To analyze usage patterns, fix bugs, and improve our services."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Legal Compliance:"})," To comply with applicable laws, regulations, and legal processes in India."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fraud Prevention:"})," To detect and prevent fraudulent activities, abuse, and security threats."]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"4. Information Sharing and Disclosure"}),i.jsx("p",{className:"mb-4",children:"We do not sell your personal information. We may share your information in the following circumstances:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"With Creators/Fans:"})," Limited profile information is shared between parties for scheduled video calls (name, profile photo, username)."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Payment Processors:"})," We share necessary payment details with Razorpay for processing transactions."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Service Providers:"})," We work with trusted third parties for hosting (Supabase), video calls (Daily.co), and analytics who process data on our behalf."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Legal Requirements:"})," We may disclose information if required by law, court order, or government request in India."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Business Transfers:"})," In case of merger, acquisition, or sale of assets, user data may be transferred to the new entity."]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"5. Data Security"}),i.jsx("p",{className:"mb-4",children:"We implement robust security measures to protect your information:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"All data transmission is encrypted using SSL/TLS (HTTPS)."}),i.jsx("li",{children:"Payment processing is PCI-DSS compliant through Razorpay."}),i.jsx("li",{children:"Database access is restricted and monitored."}),i.jsx("li",{children:"Regular security audits and vulnerability assessments."}),i.jsx("li",{children:"Two-factor authentication available for accounts."})]}),i.jsx("p",{className:"mt-4",children:"While we strive to protect your information, no method of transmission over the Internet is 100% secure. We cannot guarantee absolute security."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"6. Data Retention"}),i.jsx("p",{className:"mb-4",children:"We retain your personal information for as long as necessary to:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Provide our services to you"}),i.jsx("li",{children:"Comply with legal obligations (tax records: 7 years as per Indian law)"}),i.jsx("li",{children:"Resolve disputes and enforce agreements"}),i.jsx("li",{children:"Maintain business records"})]}),i.jsx("p",{className:"mt-4",children:"You may request deletion of your account and associated data at any time, subject to legal retention requirements."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"7. Your Rights"}),i.jsx("p",{className:"mb-4",children:"Under applicable Indian data protection laws, you have the right to:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Access:"})," Request a copy of the personal data we hold about you."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Correction:"})," Request correction of inaccurate or incomplete data."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Deletion:"})," Request deletion of your personal data (subject to legal requirements)."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Portability:"})," Request your data in a portable format."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Withdraw Consent:"})," Withdraw consent for data processing where applicable."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Opt-out:"})," Unsubscribe from marketing communications at any time."]})]}),i.jsx("p",{className:"mt-4",children:"To exercise these rights, contact us at privacy@fanmeet.live or through our support portal."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"8. Cookies Policy"}),i.jsx("p",{className:"mb-4",children:"We use the following types of cookies:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Essential Cookies:"})," Required for authentication and basic platform functionality."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Functional Cookies:"})," Remember your preferences and settings."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Analytics Cookies:"})," Help us understand how users interact with our Platform."]})]}),i.jsx("p",{className:"mt-4",children:"You can manage cookie preferences through your browser settings. Disabling essential cookies may affect Platform functionality."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"9. Children's Privacy"}),i.jsx("p",{children:"FanMeet is not intended for users under 18 years of age. We do not knowingly collect personal information from children. If we become aware that we have collected data from a minor, we will take steps to delete it promptly."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"10. Changes to This Policy"}),i.jsx("p",{children:'We may update this Privacy Policy from time to time. We will notify you of any material changes by posting the updated policy on this page with a new "Last updated" date. Your continued use of the Platform after changes constitutes acceptance of the updated policy.'})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"11. Contact Us"}),i.jsx("p",{className:"mb-4",children:"If you have questions about this Privacy Policy or our data practices, please contact us:"}),i.jsxs("div",{className:"rounded-lg bg-[#F8F9FA] p-4",children:[i.jsx("p",{className:"font-medium text-[#212529]",children:"FanMeet Technologies Private Limited"}),i.jsx("p",{children:"Email: privacy@fanmeet.live"}),i.jsx("p",{children:"Support: support@fanmeet.live"}),i.jsx("p",{children:"Address: Bangalore, Karnataka, India"})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"12. Grievance Officer"}),i.jsx("p",{className:"mb-4",children:"In accordance with the Information Technology Act, 2000 and rules made thereunder, the name and contact details of the Grievance Officer are provided below:"}),i.jsxs("div",{className:"rounded-lg bg-[#F8F9FA] p-4",children:[i.jsx("p",{className:"font-medium text-[#212529]",children:"Grievance Officer"}),i.jsx("p",{children:"Name: FanMeet Support Team"}),i.jsx("p",{children:"Email: grievance@fanmeet.live"}),i.jsx("p",{children:"Response Time: Within 24 hours of receipt"})]})]})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}function ACe(){const r=Ss();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Terms of Service"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Last updated: December 15, 2024"}),i.jsxs("div",{className:"prose prose-sm max-w-none text-[#495057]",children:[i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"1. Acceptance of Terms"}),i.jsx("p",{className:"mb-4",children:'Welcome to FanMeet! These Terms of Service ("Terms") constitute a legally binding agreement between you and FanMeet Technologies Private Limited ("FanMeet," "we," "our," or "us") governing your use of the FanMeet platform, website, and services (collectively, the "Platform").'}),i.jsx("p",{className:"mb-4",children:"By creating an account, accessing, or using our Platform, you acknowledge that you have read, understood, and agree to be bound by these Terms. If you do not agree to these Terms, please do not use our Platform."}),i.jsx("p",{children:"We reserve the right to modify these Terms at any time. Changes will be effective upon posting to the Platform. Your continued use after changes constitutes acceptance of the modified Terms."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"2. Eligibility"}),i.jsx("p",{className:"mb-4",children:"To use FanMeet, you must:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Be at least 18 years of age"}),i.jsx("li",{children:"Be a resident of India (currently, FanMeet operates only in India)"}),i.jsx("li",{children:"Have the legal capacity to enter into a binding agreement"}),i.jsx("li",{children:"Not be prohibited from using the Platform under applicable laws"}),i.jsx("li",{children:"Provide accurate and complete registration information"})]}),i.jsx("p",{className:"mt-4",children:"By using the Platform, you represent and warrant that you meet all eligibility requirements."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"3. Account Registration"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"3.1 Account Creation"}),i.jsx("p",{className:"mb-4",children:"You must create an account to access most features of the Platform. You agree to provide accurate, current, and complete information during registration and keep your account information updated."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"3.2 Account Security"}),i.jsx("p",{className:"mb-4",children:"You are responsible for maintaining the confidentiality of your login credentials and for all activities under your account. Notify us immediately of any unauthorized access or security breach."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"3.3 Account Types"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Fan Account:"})," For users who want to participate in events and connect with creators."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Creator Account:"})," For content creators who want to host events and meet their fans. Creator accounts require additional verification and approval."]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"4. Platform Services"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"4.1 How FanMeet Works"}),i.jsx("p",{className:"mb-4",children:"FanMeet is a marketplace that facilitates live video calls between fans and creators through an auction-based system:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2 mb-4",children:[i.jsx("li",{children:"Creators list events with specified time slots and base prices"}),i.jsx("li",{children:"Fans place bids to win video call opportunities"}),i.jsx("li",{children:"The highest bidder wins the call when the bidding period ends"}),i.jsx("li",{children:"Non-winning bidders receive automatic refunds (90% of bid amount)"}),i.jsx("li",{children:"Video calls are conducted through our integrated video platform"})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"4.2 Free Events"}),i.jsx("p",{children:"Some creators may offer free events where winners are selected through a random draw. No payment is required for entry into free events."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"5. Bidding and Payments"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"5.1 Bidding Rules"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2 mb-4",children:[i.jsx("li",{children:"All bids are binding commitments to pay if you win"}),i.jsx("li",{children:"Bids cannot be cancelled or withdrawn once placed"}),i.jsx("li",{children:"The bid amount is charged immediately upon placement"}),i.jsx("li",{children:"Multiple bids on the same event are allowed (only your highest bid counts)"}),i.jsx("li",{children:"Minimum bid amounts are set by creators (starting from 50 or 100)"})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"5.2 Payment Processing"}),i.jsx("p",{className:"mb-4",children:"All payments are processed securely through Razorpay, our authorized payment gateway. We accept UPI, credit cards, debit cards, and net banking. By making a payment, you agree to Razorpay's terms of service."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"5.3 Platform Fee"}),i.jsx("p",{children:"FanMeet charges a 10% platform fee on successful transactions. Creators receive 90% of the winning bid amount. This fee covers payment processing, platform maintenance, and support services."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"6. Refund Policy"}),i.jsxs("p",{className:"mb-4",children:["Please refer to our detailed ",i.jsx("a",{href:"/refund-policy",className:"text-[#C045FF] underline",children:"Refund Policy"})," for complete information. Key points include:"]}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Non-Winning Bids:"})," 90% refund processed automatically within 5-7 business days"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Creator Cancellation:"})," 100% refund if the creator cancels the event"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Technical Issues:"})," 100% refund or reschedule for platform-caused technical failures"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"No-Show by Creator:"})," 100% refund if the creator fails to attend"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"10% Processing Fee:"})," Retained on non-winning bids to cover payment gateway charges"]})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"7. Creator Terms"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"7.1 Creator Eligibility"}),i.jsx("p",{className:"mb-4",children:"To become a creator on FanMeet, you must:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2 mb-4",children:[i.jsx("li",{children:"Have a minimum of 1,000 followers on any social media platform, OR"}),i.jsx("li",{children:"Demonstrate a unique skill or expertise that fans would pay to learn about"}),i.jsx("li",{children:"Complete identity verification (KYC) process"}),i.jsx("li",{children:"Provide valid bank account or UPI details for payouts"}),i.jsx("li",{children:"Receive approval from our team"})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"7.2 Creator Responsibilities"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2 mb-4",children:[i.jsx("li",{children:"Attend all scheduled video calls on time"}),i.jsx("li",{children:"Maintain professional and respectful conduct during calls"}),i.jsx("li",{children:"Not engage in any illegal, inappropriate, or harmful activities"}),i.jsx("li",{children:"Not solicit fans to transact outside the Platform"}),i.jsx("li",{children:"Respond to fan messages within reasonable timeframes"})]}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"7.3 Payouts"}),i.jsx("p",{children:"Creator earnings (90% of winning bids) are available for withdrawal 48 hours after successful event completion. Payouts are processed within 2-3 business days via bank transfer or UPI."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"8. User Conduct"}),i.jsx("p",{className:"mb-4",children:"You agree NOT to:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Use the Platform for any illegal purpose or in violation of any laws"}),i.jsx("li",{children:"Harass, abuse, threaten, or intimidate other users or creators"}),i.jsx("li",{children:"Share explicit, obscene, or inappropriate content during video calls"}),i.jsx("li",{children:"Impersonate any person or entity, or falsely represent your affiliation"}),i.jsx("li",{children:"Attempt to manipulate bidding through fake accounts or collusion"}),i.jsx("li",{children:"Record, screenshot, or distribute video call content without consent"}),i.jsx("li",{children:"Circumvent the Platform to arrange direct transactions with creators"}),i.jsx("li",{children:"Use bots, scripts, or automated tools to interact with the Platform"}),i.jsx("li",{children:"Interfere with or disrupt the Platform's security or functionality"}),i.jsx("li",{children:"Upload viruses, malware, or other harmful code"})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"9. Intellectual Property"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"9.1 FanMeet's IP"}),i.jsx("p",{className:"mb-4",children:"The Platform, including its design, features, content, and code, is owned by FanMeet and protected by intellectual property laws. You may not copy, modify, distribute, or create derivative works without our written permission."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"9.2 User Content"}),i.jsx("p",{children:"You retain ownership of content you create. By posting content on FanMeet, you grant us a non-exclusive, worldwide, royalty-free license to use, display, and distribute such content for Platform operation and promotion."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"10. Disclaimers"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:'The Platform is provided "as is" without warranties of any kind'}),i.jsx("li",{children:"We do not guarantee continuous, uninterrupted, or error-free service"}),i.jsx("li",{children:"We are not responsible for the conduct of creators or fans during video calls"}),i.jsx("li",{children:"We do not endorse or verify the accuracy of creator claims or content"}),i.jsx("li",{children:"Video call quality depends on participants' internet connections"})]})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"11. Limitation of Liability"}),i.jsx("p",{className:"mb-4",children:"To the maximum extent permitted by law, FanMeet shall not be liable for any indirect, incidental, special, consequential, or punitive damages, including loss of profits, data, or goodwill, arising from:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Your use or inability to use the Platform"}),i.jsx("li",{children:"Any conduct or content of third parties on the Platform"}),i.jsx("li",{children:"Unauthorized access to your account or data"}),i.jsx("li",{children:"Technical failures or service interruptions"})]}),i.jsx("p",{className:"mt-4",children:"Our total liability shall not exceed the amount you paid to FanMeet in the 12 months preceding the claim."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"12. Indemnification"}),i.jsx("p",{children:"You agree to indemnify and hold harmless FanMeet, its officers, directors, employees, and agents from any claims, damages, losses, or expenses arising from your use of the Platform, violation of these Terms, or infringement of any third-party rights."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"13. Termination"}),i.jsx("p",{className:"mb-4",children:"We may suspend or terminate your account at our discretion, with or without notice, for:"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsx("li",{children:"Violation of these Terms"}),i.jsx("li",{children:"Fraudulent or illegal activity"}),i.jsx("li",{children:"Harmful conduct towards other users"}),i.jsx("li",{children:"Extended inactivity"}),i.jsx("li",{children:"Any other reason we deem appropriate"})]}),i.jsx("p",{className:"mt-4",children:"You may close your account at any time through account settings. Upon termination, your right to use the Platform ceases immediately. Pending payouts will be processed according to our policies."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"14. Dispute Resolution"}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"14.1 Governing Law"}),i.jsx("p",{className:"mb-4",children:"These Terms are governed by the laws of India. Any disputes shall be subject to the exclusive jurisdiction of the courts in Bangalore, Karnataka."}),i.jsx("h3",{className:"mb-2 text-lg font-medium text-[#212529]",children:"14.2 Informal Resolution"}),i.jsx("p",{children:"Before initiating formal proceedings, you agree to contact us at support@fanmeet.live to attempt to resolve any dispute informally within 30 days."})]}),i.jsxs("section",{className:"mb-8",children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"15. General Provisions"}),i.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Entire Agreement:"})," These Terms constitute the entire agreement between you and FanMeet."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Severability:"})," If any provision is found unenforceable, the remaining provisions remain in effect."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Waiver:"})," Our failure to enforce any right does not constitute a waiver of that right."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Assignment:"})," You may not assign your rights under these Terms without our consent."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-4 text-xl font-semibold text-[#212529]",children:"16. Contact Information"}),i.jsx("p",{className:"mb-4",children:"For questions about these Terms, please contact us:"}),i.jsxs("div",{className:"rounded-lg bg-[#F8F9FA] p-4",children:[i.jsx("p",{className:"font-medium text-[#212529]",children:"FanMeet Technologies Private Limited"}),i.jsx("p",{children:"Email: legal@fanmeet.live"}),i.jsx("p",{children:"Support: support@fanmeet.live"}),i.jsx("p",{children:"Address: Bangalore, Karnataka, India"})]})]})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}function ICe(){const r=Ss();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Refund Policy"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Last updated: December 15, 2024"}),i.jsxs("div",{className:"space-y-8 text-sm text-[#495057]",children:[i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"1. Overview"}),i.jsx("p",{children:"FanMeet runs paid creator events using bidding (auction-style). To make bidding low-risk, we provide automatic refunds for non-winning bids and full refunds in specific failure cases."})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"2. Refund Cases"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"A) You do not win the bid  90% refund"}),i.jsxs("div",{className:"mt-1",children:["If you placed a bid but did not win, we automatically refund ",i.jsx("strong",{children:"90%"})," of your bid amount. The remaining 10% covers payment gateway and processing costs."]})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"B) Creator cancels the event  100% refund"}),i.jsx("div",{className:"mt-1",children:"All bidders receive a full refund if the creator cancels the event."})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"C) Creator no-show  100% refund (winner)"}),i.jsx("div",{className:"mt-1",children:"If the creator does not join at the scheduled time, the event winner gets a full refund."})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"D) Platform technical failure  100% refund or reschedule"}),i.jsx("div",{className:"mt-1",children:"If the call fails due to FanMeet platform issues, we may provide either a full refund or a rescheduled call."})]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"3. Non-Refundable Cases"}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Winner completed the call successfully:"})," no refund."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fan no-show:"})," if you win but do not join, the payment is not refundable."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fan-side connectivity/device issues:"})," issues caused by your internet/device are not refundable."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Policy violations:"})," abusive or prohibited conduct can void eligibility."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"4. Processing Time"}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsx("li",{children:"Refunds are typically initiated within 24-48 hours after eligibility is confirmed."}),i.jsx("li",{children:"Bank/payment providers may take 5-7 business days to complete the refund."}),i.jsx("li",{children:"Refunds are always sent to the original payment method."})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"5. Contact"}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"Need help with a refund?"}),i.jsx("div",{className:"mt-1",children:"Email: support@fanmeet.live"})]})]})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}function DCe(){const r=Ss();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Cancellation & Rescheduling Policy"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Last updated: December 15, 2024"}),i.jsxs("div",{className:"space-y-8 text-sm text-[#495057]",children:[i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"1. Overview"}),i.jsx("p",{children:"FanMeet events are scheduled, time-bound live video calls. Because creators block time and fans bid for limited slots, cancellations and reschedules are handled with clear rules to protect both sides."})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"2. Creator Cancellations"}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Creator cancels before the event:"})," all bidders receive a 100% refund."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Creator no-show:"})," the winner receives a 100% refund and the creator account may be reviewed."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Repeated cancellations/no-shows:"})," may lead to suspension or removal from the Platform."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"3. Fan Cancellations"}),i.jsx("p",{className:"mb-3",children:"Bids are commitments. Once you place a bid, you cannot cancel it because it impacts the auction and other bidders."}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Non-winning bids:"})," automatically get 90% refund as per Refund Policy."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Winning bids:"})," are not refundable if the call is successfully completed."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fan no-show:"})," if you win but do not join the call, the payment is not refundable."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"4. Rescheduling"}),i.jsxs("ul",{className:"list-disc space-y-2 pl-5",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Platform-side technical issue:"})," we may offer rescheduling or a 100% refund."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Creator requests reschedule:"})," we may reschedule with winner consent; otherwise, a 100% refund is processed."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Fan requests reschedule:"})," not guaranteed and handled case-by-case through support."]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"mb-3 text-xl font-semibold text-[#212529]",children:"5. How to Request Support"}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-white p-4",children:[i.jsx("div",{className:"font-semibold text-[#212529]",children:"Need help?"}),i.jsx("div",{className:"mt-1",children:"Email: support@fanmeet.live"})]})]})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}function OCe(){const r=Ss();return i.jsxs("div",{className:"min-h-screen bg-[#F8F9FA]",children:[i.jsx("header",{className:"bg-[#050014] text-white",children:i.jsxs("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-6 py-4",children:[i.jsxs("button",{type:"button",onClick:()=>r("/"),className:"flex items-center gap-2 text-lg font-semibold",children:[i.jsx("span",{className:"h-8 w-8 rounded-2xl bg-gradient-to-br from-[#C045FF] via-[#FF6B9D] to-[#8B3FFF]"}),i.jsx("span",{children:"FanMeet"})]}),i.jsx(oe,{variant:"secondary",size:"sm",onClick:()=>r(-1),children:" Back"})]})}),i.jsx("main",{className:"mx-auto max-w-4xl px-6 py-12",children:i.jsxs("div",{className:"rounded-2xl bg-white p-8 shadow-sm md:p-12",children:[i.jsx("h1",{className:"mb-2 text-3xl font-bold text-[#212529]",children:"Contact Us"}),i.jsx("p",{className:"mb-8 text-sm text-[#6C757D]",children:"Need help? We respond fast. Use the details below to reach FanMeet support."}),i.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Support"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Email: support@fanmeet.live"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"Response time: within 24 hours"})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Business / Partnerships"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Email: partners@fanmeet.live"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"For brands and creators onboarding"})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Legal"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Email: legal@fanmeet.live"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"Privacy & policy requests"})]}),i.jsxs("div",{className:"rounded-xl border border-[#E9ECEF] bg-[#F8F9FA] p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Registered Office"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Bangalore, Karnataka, India"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"(Address can be updated once finalized)"})]})]}),i.jsxs("div",{className:"mt-8 rounded-xl border border-[#E9ECEF] bg-white p-6",children:[i.jsx("div",{className:"text-sm font-semibold text-[#212529]",children:"Grievance Officer (India)"}),i.jsx("div",{className:"mt-2 text-sm text-[#495057]",children:"Email: grievance@fanmeet.live"}),i.jsx("div",{className:"mt-1 text-sm text-[#495057]",children:"We acknowledge complaints within 24 hours."})]})]})}),i.jsx("footer",{className:"bg-[#1B1C1F] px-6 py-8 text-center text-sm text-[#6C757D]",children:i.jsxs("p",{children:[" ",new Date().getFullYear()," FanMeet. Made with  in India. All rights reserved."]})})]})}const IN=({allowedRoles:r,children:n})=>{const{isAuthenticated:o,user:l,isLoading:u}=fs(),m=Nc();if(u)return null;if(!o||!l){const g=encodeURIComponent(m.pathname+m.search);return i.jsx(tp,{to:`/auth?redirect=${g}`,replace:!0})}if(r&&!r.includes(l.role)){const g={fan:"/fan",creator:"/creator",admin:"/admin"};return i.jsx(tp,{to:g[l.role],replace:!0})}return i.jsx(i.Fragment,{children:n})},jCe=()=>i.jsx("div",{className:"flex h-full w-full items-center justify-center",children:i.jsxs("div",{className:"flex flex-col items-center gap-3 text-[#6C757D]",children:[i.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-[#FFE5D9] border-l-[#FF6B35]"}),i.jsx("span",{children:"Loading"})]})});function PCe(){return i.jsx(O.Suspense,{fallback:i.jsx(jCe,{}),children:i.jsx(vfe,{children:i.jsx(Fbe,{children:i.jsx(Mwe,{children:i.jsx(bfe,{children:i.jsxs(Xhe,{children:[i.jsx(st,{path:"meet/:meetId",element:i.jsx(xCe,{})}),i.jsxs(st,{element:i.jsx(xfe,{}),children:[i.jsx(st,{index:!0,element:i.jsx(Ibe,{})}),i.jsx(st,{path:"auth",element:i.jsx(Obe,{})}),i.jsx(st,{path:"auth/forgot-password",element:i.jsx(jbe,{})}),i.jsx(st,{path:"auth/update-password",element:i.jsx(Pbe,{})}),i.jsx(st,{path:"auth/callback",element:i.jsx(kbe,{})}),i.jsx(st,{path:"fanmeet/admin/superadmin",element:i.jsx(Lbe,{})}),i.jsx(st,{path:"browse-events",element:i.jsx(Ube,{})}),i.jsx(st,{path:"how-it-works",element:i.jsx(Vbe,{})}),i.jsx(st,{path:"for-creators",element:i.jsx(Wbe,{})}),i.jsx(st,{path:"pricing",element:i.jsx(Gbe,{})}),i.jsx(st,{path:"faq",element:i.jsx(zbe,{})}),i.jsx(st,{path:"free-events",element:i.jsx(Kbe,{})}),i.jsx(st,{path:"apply",element:i.jsx(qbe,{})}),i.jsx(st,{path:"creator-guide",element:i.jsx(Ybe,{})}),i.jsx(st,{path:"earnings-calculator",element:i.jsx($be,{})}),i.jsx(st,{path:"success-stories",element:i.jsx(Jbe,{})}),i.jsx(st,{path:"about",element:i.jsx(Qbe,{})}),i.jsx(st,{path:"team",element:i.jsx(ewe,{})}),i.jsx(st,{path:"press",element:i.jsx(swe,{})}),i.jsx(st,{path:"careers",element:i.jsx(nwe,{})}),i.jsx(st,{path:"blog",element:i.jsx(awe,{})}),i.jsx(st,{path:"help-center",element:i.jsx(cwe,{})}),i.jsx(st,{path:"privacy-policy",element:i.jsx(RCe,{})}),i.jsx(st,{path:"terms-of-service",element:i.jsx(ACe,{})}),i.jsx(st,{path:"refund-policy",element:i.jsx(ICe,{})}),i.jsx(st,{path:"cancellation-policy",element:i.jsx(DCe,{})}),i.jsx(st,{path:"contact",element:i.jsx(OCe,{})}),i.jsx(st,{path:"events/:eventId",element:i.jsx(j0e,{})}),i.jsx(st,{path:":username",element:i.jsx(R0e,{})})]}),i.jsxs(st,{path:"fan",element:i.jsx(IN,{allowedRoles:["fan"],children:i.jsx(oN,{role:"fan"})}),children:[i.jsx(st,{index:!0,element:i.jsx(uwe,{})}),i.jsx(st,{path:"all-events",element:i.jsx(Rwe,{})}),i.jsx(st,{path:"bids",element:i.jsx(hwe,{})}),i.jsx(st,{path:"meets",element:i.jsx(mwe,{})}),i.jsx(st,{path:"wallet",element:i.jsx(fwe,{})}),i.jsx(st,{path:"following",element:i.jsx(gwe,{})}),i.jsx(st,{path:"history",element:i.jsx(vwe,{})}),i.jsx(st,{path:"messages",element:i.jsx(wwe,{})}),i.jsx(st,{path:"notifications",element:i.jsx(Ewe,{})}),i.jsx(st,{path:"settings",element:i.jsx(ywe,{})}),i.jsx(st,{path:"support",element:i.jsx(Cwe,{})}),i.jsx(st,{path:"*",element:i.jsx(tp,{to:".",replace:!0})})]}),i.jsxs(st,{path:"creator",element:i.jsx(IN,{allowedRoles:["creator"],children:i.jsx(oN,{role:"creator"})}),children:[i.jsx(st,{index:!0,element:i.jsx(Dwe,{})}),i.jsx(st,{path:"events",element:i.jsx(Owe,{})}),i.jsx(st,{path:"events/new",element:i.jsx(kwe,{})}),i.jsx(st,{path:"profile-setup",element:i.jsx(Fwe,{})}),i.jsx(st,{path:"earnings",element:i.jsx(Bwe,{})}),i.jsx(st,{path:"withdrawals",element:i.jsx(Kwe,{})}),i.jsx(st,{path:"meets",element:i.jsx($we,{})}),i.jsx(st,{path:"followers",element:i.jsx(Xwe,{})}),i.jsx(st,{path:"messages",element:i.jsx(ASe,{})}),i.jsx(st,{path:"notifications",element:i.jsx(Jwe,{})}),i.jsx(st,{path:"settings",element:i.jsx(Zwe,{})}),i.jsx(st,{path:"support",element:i.jsx(DSe,{})}),i.jsx(st,{path:"*",element:i.jsx(tp,{to:".",replace:!0})})]}),i.jsxs(st,{path:"admin",element:i.jsx(IN,{allowedRoles:["admin"],children:i.jsx(oN,{role:"admin"})}),children:[i.jsx(st,{index:!0,element:i.jsx(OSe,{})}),i.jsx(st,{path:"users",element:i.jsx(kSe,{})}),i.jsx(st,{path:"creators",element:i.jsx(MSe,{})}),i.jsx(st,{path:"fans",element:i.jsx(USe,{})}),i.jsx(st,{path:"events",element:i.jsx(BSe,{})}),i.jsx(st,{path:"featured",element:i.jsx(WSe,{})}),i.jsx(st,{path:"announcements",element:i.jsx(HSe,{})}),i.jsx(st,{path:"payments",element:i.jsx(KSe,{})}),i.jsx(st,{path:"withdrawals",element:i.jsx(qSe,{})}),i.jsx(st,{path:"refunds",element:i.jsx($Se,{})}),i.jsx(st,{path:"revenue-analytics",element:i.jsx(XSe,{})}),i.jsx(st,{path:"platform-commission",element:i.jsx(JSe,{})}),i.jsx(st,{path:"business-analytics",element:i.jsx(QSe,{})}),i.jsx(st,{path:"user-analytics",element:i.jsx(ZSe,{})}),i.jsx(st,{path:"revenue-reports",element:i.jsx(e0e,{})}),i.jsx(st,{path:"event-analytics",element:i.jsx(t0e,{})}),i.jsx(st,{path:"audit-logs",element:i.jsx(r0e,{})}),i.jsx(st,{path:"support-tickets",element:i.jsx(a0e,{})}),i.jsx(st,{path:"reports-flags",element:i.jsx(c0e,{})}),i.jsx(st,{path:"disputes",element:i.jsx(d0e,{})}),i.jsx(st,{path:"settings/general",element:i.jsx(u0e,{})}),i.jsx(st,{path:"settings/pricing",element:i.jsx(h0e,{})}),i.jsx(st,{path:"settings/email-templates",element:i.jsx(m0e,{})}),i.jsx(st,{path:"settings/notifications",element:i.jsx(_0e,{})}),i.jsx(st,{path:"settings/security",element:i.jsx(v0e,{})}),i.jsx(st,{path:"system/logs",element:i.jsx(E0e,{})}),i.jsx(st,{path:"system/bulk-actions",element:i.jsx(x0e,{})}),i.jsx(st,{path:"system/backup",element:i.jsx(b0e,{})}),i.jsx(st,{path:"debug/meets",element:i.jsx(T0e,{})}),i.jsx(st,{path:"meeting-logs",element:i.jsx(N0e,{})}),i.jsx(st,{path:"profile",element:i.jsx(C0e,{})}),i.jsx(st,{path:"*",element:i.jsx(tp,{to:".",replace:!0})})]}),i.jsx(st,{path:"*",element:i.jsx(tp,{to:"/",replace:!0})})]})})})})})})}const kCe=new nhe;DN.createRoot(document.getElementById("root")).render(i.jsx(dA.StrictMode,{children:i.jsx(ahe,{client:kCe,children:i.jsx(ipe,{children:i.jsx(PCe,{})})})}));export{U7 as g};
